{
    "author": "dhepper",
    "message": "Fixed #18433 -- Fixed \"View on Site\" link in inline admin for models with custom PK",
    "sha": "0ae727beda8b34deb5061d87fbbeb40e5ac80db3",
    "files": [
        {
            "sha": "55463d97b14e38278ea0254216ac5631a1019fbc",
            "filename": "django/contrib/admin/templates/admin/edit_inline/stacked.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html",
            "raw_url": "https://github.com/django/django/raw/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html?ref=0ae727beda8b34deb5061d87fbbeb40e5ac80db3",
            "patch": "@@ -6,7 +6,7 @@ <h2>{{ inline_admin_formset.opts.verbose_name_plural|title }}</h2>\n \n {% for inline_admin_form in inline_admin_formset %}<div class=\"inline-related{% if forloop.last %} empty-form last-related{% endif %}\" id=\"{{ inline_admin_formset.formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}\">\n   <h3><b>{{ inline_admin_formset.opts.verbose_name|title }}:</b>&nbsp;<span class=\"inline_label\">{% if inline_admin_form.original %}{{ inline_admin_form.original }}{% else %}#{{ forloop.counter }}{% endif %}</span>\n-    {% if inline_admin_form.show_url %}<a href=\"../../../r/{{ inline_admin_form.original_content_type_id }}/{{ inline_admin_form.original.id }}/\">{% trans \"View on site\" %}</a>{% endif %}\n+    {% if inline_admin_form.show_url %}<a href=\"../../../r/{{ inline_admin_form.original_content_type_id }}/{{ inline_admin_form.original.pk }}/\">{% trans \"View on site\" %}</a>{% endif %}\n     {% if inline_admin_formset.formset.can_delete and inline_admin_form.original %}<span class=\"delete\">{{ inline_admin_form.deletion_field.field }} {{ inline_admin_form.deletion_field.label_tag }}</span>{% endif %}\n   </h3>\n   {% if inline_admin_form.form.non_field_errors %}{{ inline_admin_form.form.non_field_errors }}{% endif %}"
        },
        {
            "sha": "d5ac9b0fb69d53a528dfdad1913eebb3f151ee81",
            "filename": "django/contrib/admin/templates/admin/edit_inline/tabular.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "raw_url": "https://github.com/django/django/raw/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html?ref=0ae727beda8b34deb5061d87fbbeb40e5ac80db3",
            "patch": "@@ -27,7 +27,7 @@ <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}</h2>\n         <td class=\"original\">\n           {% if inline_admin_form.original or inline_admin_form.show_url %}<p>\n           {% if inline_admin_form.original %} {{ inline_admin_form.original }}{% endif %}\n-          {% if inline_admin_form.show_url %}<a href=\"../../../r/{{ inline_admin_form.original_content_type_id }}/{{ inline_admin_form.original.id }}/\">{% trans \"View on site\" %}</a>{% endif %}\n+          {% if inline_admin_form.show_url %}<a href=\"../../../r/{{ inline_admin_form.original_content_type_id }}/{{ inline_admin_form.original.pk }}/\">{% trans \"View on site\" %}</a>{% endif %}\n             </p>{% endif %}\n           {% if inline_admin_form.has_auto_field %}{{ inline_admin_form.pk_field.field }}{% endif %}\n           {{ inline_admin_form.fk_field.field }}"
        },
        {
            "sha": "cf51fa49b44b766bade555b9f13f24676519093c",
            "filename": "tests/regressiontests/admin_inlines/admin.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/tests%2Fregressiontests%2Fadmin_inlines%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/tests%2Fregressiontests%2Fadmin_inlines%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Fadmin.py?ref=0ae727beda8b34deb5061d87fbbeb40e5ac80db3",
            "patch": "@@ -115,6 +115,16 @@ class ProfileInline(admin.TabularInline):\n     model = Profile\n     extra = 1\n \n+\n+# admin for #18433\n+class ChildModel1Inline(admin.TabularInline):\n+    model = ChildModel1\n+\n+\n+class ChildModel2Inline(admin.StackedInline):\n+    model = ChildModel2\n+\n+\n site.register(TitleCollection, inlines=[TitleInline])\n # Test bug #12561 and #12778\n # only ModelAdmin media\n@@ -130,4 +140,5 @@ class ProfileInline(admin.TabularInline):\n site.register(Holder4, Holder4Admin)\n site.register(Author, AuthorAdmin)\n site.register(CapoFamiglia, inlines=[ConsigliereInline, SottoCapoInline])\n-site.register(ProfileCollection, inlines=[ProfileInline])\n\\ No newline at end of file\n+site.register(ProfileCollection, inlines=[ProfileInline])\n+site.register(ParentModelWithCustomPk, inlines=[ChildModel1Inline, ChildModel2Inline])\n\\ No newline at end of file"
        },
        {
            "sha": "5a0f4d84b9a940adae2d09e3ca4569c26f3570f6",
            "filename": "tests/regressiontests/admin_inlines/models.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py?ref=0ae727beda8b34deb5061d87fbbeb40e5ac80db3",
            "patch": "@@ -139,6 +139,31 @@ class SottoCapo(models.Model):\n     name = models.CharField(max_length=100)\n     capo_famiglia = models.ForeignKey(CapoFamiglia, related_name='+')\n \n+# Models for #18433\n+\n+class ParentModelWithCustomPk(models.Model):\n+    my_own_pk = models.CharField(max_length=100, primary_key=True)\n+    name = models.CharField(max_length=100)\n+\n+\n+class ChildModel1(models.Model):\n+    my_own_pk = models.CharField(max_length=100, primary_key=True)\n+    name = models.CharField(max_length=100)\n+    parent = models.ForeignKey(ParentModelWithCustomPk)\n+\n+    def get_absolute_url(self):\n+        return '/child_model1/'\n+\n+\n+class ChildModel2(models.Model):\n+    my_own_pk = models.CharField(max_length=100, primary_key=True)\n+    name = models.CharField(max_length=100)\n+    parent = models.ForeignKey(ParentModelWithCustomPk)\n+\n+    def get_absolute_url(self):\n+        return '/child_model2/'\n+\n+\n # Other models\n \n class ProfileCollection(models.Model):"
        },
        {
            "sha": "4f25d3dbfb4f8e973fd5c071e63a5cbcd8df2a0d",
            "filename": "tests/regressiontests/admin_inlines/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0ae727beda8b34deb5061d87fbbeb40e5ac80db3/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py?ref=0ae727beda8b34deb5061d87fbbeb40e5ac80db3",
            "patch": "@@ -11,7 +11,7 @@\n from .admin import InnerInline\n from .models import (Holder, Inner, Holder2, Inner2, Holder3, Inner3, Person,\n     OutfitItem, Fashionista, Teacher, Parent, Child, Author, Book, Profile,\n-    ProfileCollection)\n+    ProfileCollection, ParentModelWithCustomPk, ChildModel1, ChildModel2)\n \n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n@@ -147,6 +147,21 @@ def test_non_related_name_inline(self):\n                 '<input id=\"id_-2-0-name\" type=\"text\" class=\"vTextField\" '\n                 'name=\"-2-0-name\" maxlength=\"100\" />', html=True)\n \n+    def test_custom_pk_shortcut(self):\n+        \"\"\"\n+        Ensure that the \"View on Site\" link is correct for models with a\n+        custom primary key field. Bug #18433.\n+        \"\"\"\n+        parent = ParentModelWithCustomPk.objects.create(my_own_pk=\"foo\", name=\"Foo\")\n+        child1 = ChildModel1.objects.create(my_own_pk=\"bar\", name=\"Bar\", parent=parent)\n+        child2 = ChildModel2.objects.create(my_own_pk=\"baz\", name=\"Baz\", parent=parent)\n+        response = self.client.get('/admin/admin_inlines/parentmodelwithcustompk/foo/')\n+        child1_shortcut = 'r/%s/%s/'%(ContentType.objects.get_for_model(child1).pk, child1.pk)\n+        child2_shortcut = 'r/%s/%s/'%(ContentType.objects.get_for_model(child2).pk, child2.pk)\n+        self.assertContains(response, child1_shortcut)\n+        self.assertContains(response, child2_shortcut)\n+\n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class TestInlineMedia(TestCase):\n     urls = \"regressiontests.admin_inlines.urls\""
        }
    ],
    "stats": {
        "total": 59,
        "additions": 55,
        "deletions": 4
    }
}