{
    "author": "freakboy3742",
    "message": "Fixed #15234 -- Ensure that years in a date heirarchy don't use commas for thousand separators, regardless of the value of USE_THOUSAND_SEPARATOR. Thanks to Julien Phalip for the report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15451 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77",
    "files": [
        {
            "sha": "806be241447200f2a157ab67935b22c90251d516",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77",
            "patch": "@@ -261,7 +261,7 @@ def date_hierarchy(cl):\n                 'show': True,\n                 'back': {\n                     'link': link({year_field: year_lookup}),\n-                    'title': year_lookup\n+                    'title': str(year_lookup)\n                 },\n                 'choices': [{\n                     'link': link({year_field: year_lookup, month_field: month_lookup, day_field: day.day}),"
        },
        {
            "sha": "a05f40f702c8ef0f095d74defebea4073ede014c",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 39,
            "deletions": 15,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=a105ca5d7a232edd4713f37fbbe9ee3fec5f9e77",
            "patch": "@@ -2587,6 +2587,21 @@ class DateHierarchyTests(TestCase):\n \n     def setUp(self):\n         self.client.login(username='super', password='secret')\n+        self.old_USE_THOUSAND_SEPARATOR = settings.USE_THOUSAND_SEPARATOR\n+        self.old_USE_L10N = settings.USE_L10N\n+        settings.USE_THOUSAND_SEPARATOR = True\n+        settings.USE_L10N = True\n+\n+    def tearDown(self):\n+        settings.USE_THOUSAND_SEPARATOR = self.old_USE_THOUSAND_SEPARATOR\n+        settings.USE_L10N = self.old_USE_L10N\n+\n+    def assert_non_localized_year(self, url, year):\n+        \"\"\"Ensure that the year is not localized with\n+        USE_THOUSAND_SEPARATOR. Refs #15234.\n+        \"\"\"\n+        response = self.client.get(url)\n+        self.assertNotContains(response, formats.number_format(year))\n \n     def assert_contains_year_link(self, response, date):\n         self.assertContains(response, '?release_date__year=%d\"' % (date.year,))\n@@ -2618,9 +2633,10 @@ def test_single(self):\n         \"\"\"\n         DATE = datetime.date(2000, 6, 30)\n         Podcast.objects.create(release_date=DATE)\n-        response = self.client.get(\n-            reverse('admin:admin_views_podcast_changelist'))\n+        url = reverse('admin:admin_views_podcast_changelist')\n+        response = self.client.get(url)\n         self.assert_contains_day_link(response, DATE)\n+        self.assert_non_localized_year(url, 2000)\n \n     def test_within_month(self):\n         \"\"\"\n@@ -2631,10 +2647,11 @@ def test_within_month(self):\n                  datetime.date(2000, 6, 3))\n         for date in DATES:\n             Podcast.objects.create(release_date=date)\n-        response = self.client.get(\n-            reverse('admin:admin_views_podcast_changelist'))\n+        url = reverse('admin:admin_views_podcast_changelist')\n+        response = self.client.get(url)\n         for date in DATES:\n             self.assert_contains_day_link(response, date)\n+        self.assert_non_localized_year(url, 2000)\n \n     def test_within_year(self):\n         \"\"\"\n@@ -2645,12 +2662,13 @@ def test_within_year(self):\n                  datetime.date(2000, 5, 3))\n         for date in DATES:\n             Podcast.objects.create(release_date=date)\n-        response = self.client.get(\n-            reverse('admin:admin_views_podcast_changelist'))\n+        url = reverse('admin:admin_views_podcast_changelist')\n+        response = self.client.get(url)\n         # no day-level links\n         self.assertNotContains(response, 'release_date__day=')\n         for date in DATES:\n             self.assert_contains_month_link(response, date)\n+        self.assert_non_localized_year(url, 2000)\n \n     def test_multiple_years(self):\n         \"\"\"\n@@ -2671,14 +2689,20 @@ def test_multiple_years(self):\n \n         # and make sure GET parameters still behave correctly\n         for date in DATES:\n-            response = self.client.get(\n-                '%s?release_date__year=%d' % (\n-                    reverse('admin:admin_views_podcast_changelist'),\n-                    date.year))\n+            url = '%s?release_date__year=%d' % (\n+                  reverse('admin:admin_views_podcast_changelist'),\n+                  date.year)\n+            response = self.client.get(url)\n             self.assert_contains_month_link(response, date)\n-\n-            response = self.client.get(\n-                '%s?release_date__year=%d&release_date__month=%d' % (\n-                    reverse('admin:admin_views_podcast_changelist'),\n-                    date.year, date.month))\n+            self.assert_non_localized_year(url, 2000)\n+            self.assert_non_localized_year(url, 2003)\n+            self.assert_non_localized_year(url, 2005)\n+\n+            url = '%s?release_date__year=%d&release_date__month=%d' % (\n+                  reverse('admin:admin_views_podcast_changelist'),\n+                  date.year, date.month)\n+            response = self.client.get(url)\n             self.assert_contains_day_link(response, date)\n+            self.assert_non_localized_year(url, 2000)\n+            self.assert_non_localized_year(url, 2003)\n+            self.assert_non_localized_year(url, 2005)"
        }
    ],
    "stats": {
        "total": 56,
        "additions": 40,
        "deletions": 16
    }
}