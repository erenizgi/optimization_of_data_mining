{
    "author": "jezdez",
    "message": "Fixed #14461 -- Look also in LOCALE_PATHS when checking if a language is supported. Thanks to Diego BÃºrigo for the initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15507 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e1e3f243715c400bc6e2cec5bd650ac90ecb7f44",
    "files": [
        {
            "sha": "66cc305aabe68a3b4df46c6845118fc7936c23bf",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 20,
            "deletions": 13,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/e1e3f243715c400bc6e2cec5bd650ac90ecb7f44/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/e1e3f243715c400bc6e2cec5bd650ac90ecb7f44/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=e1e3f243715c400bc6e2cec5bd650ac90ecb7f44",
            "patch": "@@ -335,19 +335,26 @@ def npgettext(context, singular, plural, number):\n         result = do_ntranslate(singular, plural, number, 'ungettext')\n     return result\n \n+def all_locale_paths():\n+    \"\"\"\n+    Returns a list of paths to user-provides languages files.\n+    \"\"\"\n+    from django.conf import settings\n+    globalpath = os.path.join(\n+        os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n+    return [globalpath] + list(settings.LOCALE_PATHS)\n+\n def check_for_language(lang_code):\n     \"\"\"\n     Checks whether there is a global language file for the given language\n     code. This is used to decide whether a user-provided language is\n     available. This is only used for language codes from either the cookies or\n-    session.\n+    session and during format localization.\n     \"\"\"\n-    from django.conf import settings\n-    globalpath = os.path.join(os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n-    if gettext_module.find('django', globalpath, [to_locale(lang_code)]) is not None:\n-        return True\n-    else:\n-        return False\n+    for path in all_locale_paths():\n+        if gettext_module.find('django', path, [to_locale(lang_code)]) is not None:\n+            return True\n+    return False\n \n def get_language_from_request(request):\n     \"\"\"\n@@ -358,7 +365,8 @@ def get_language_from_request(request):\n     \"\"\"\n     global _accepted\n     from django.conf import settings\n-    globalpath = os.path.join(os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n+    globalpath = os.path.join(\n+        os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n     supported = dict(settings.LANGUAGES)\n \n     if hasattr(request, 'session'):\n@@ -401,11 +409,10 @@ def get_language_from_request(request):\n                 (accept_lang.split('-')[0], normalized.split('_')[0])):\n             if lang.lower() not in supported:\n                 continue\n-            langfile = os.path.join(globalpath, dirname, 'LC_MESSAGES',\n-                    'django.mo')\n-            if os.path.exists(langfile):\n-                _accepted[normalized] = lang\n-                return lang\n+            for path in all_locale_paths():\n+                if os.path.exists(os.path.join(path, dirname, 'LC_MESSAGES', 'django.mo')):\n+                    _accepted[normalized] = lang\n+                    return lang\n \n     return settings.LANGUAGE_CODE\n "
        }
    ],
    "stats": {
        "total": 33,
        "additions": 20,
        "deletions": 13
    }
}