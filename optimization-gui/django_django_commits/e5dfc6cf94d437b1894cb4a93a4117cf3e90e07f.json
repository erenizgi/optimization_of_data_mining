{
    "author": "alex",
    "message": "Revert [15653], which was absolutely not ready to be committed.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15655 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f",
    "files": [
        {
            "sha": "2e820a677943903fae518545cf77b6b596ca28a5",
            "filename": "tests/modeltests/model_forms/models.py",
            "status": "modified",
            "additions": 1358,
            "deletions": 1,
            "changes": 1359,
            "blob_url": "https://github.com/django/django/blob/e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py?ref=e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f",
            "patch": "@@ -240,4 +240,1361 @@ class FlexibleDatePost(models.Model):\n     title = models.CharField(max_length=50, unique_for_date='posted', blank=True)\n     slug = models.CharField(max_length=50, unique_for_year='posted', blank=True)\n     subtitle = models.CharField(max_length=50, unique_for_month='posted', blank=True)\n-    posted = models.DateField(blank=True, null=True)\n\\ No newline at end of file\n+    posted = models.DateField(blank=True, null=True)\n+\n+__test__ = {'API_TESTS': \"\"\"\n+>>> from django import forms\n+>>> from django.forms.models import ModelForm, model_to_dict\n+>>> from django.core.files.uploadedfile import SimpleUploadedFile\n+\n+The bare bones, absolutely nothing custom, basic case.\n+\n+>>> class CategoryForm(ModelForm):\n+...     class Meta:\n+...         model = Category\n+>>> CategoryForm.base_fields.keys()\n+['name', 'slug', 'url']\n+\n+\n+Extra fields.\n+\n+>>> class CategoryForm(ModelForm):\n+...     some_extra_field = forms.BooleanField()\n+...\n+...     class Meta:\n+...         model = Category\n+\n+>>> CategoryForm.base_fields.keys()\n+['name', 'slug', 'url', 'some_extra_field']\n+\n+Extra field that has a name collision with a related object accessor.\n+\n+>>> class WriterForm(ModelForm):\n+...     book = forms.CharField(required=False)\n+...\n+...     class Meta:\n+...         model = Writer\n+\n+>>> wf = WriterForm({'name': 'Richard Lockridge'})\n+>>> wf.is_valid()\n+True\n+\n+Replacing a field.\n+\n+>>> class CategoryForm(ModelForm):\n+...     url = forms.BooleanField()\n+...\n+...     class Meta:\n+...         model = Category\n+\n+>>> CategoryForm.base_fields['url'].__class__\n+<class 'django.forms.fields.BooleanField'>\n+\n+\n+Using 'fields'.\n+\n+>>> class CategoryForm(ModelForm):\n+...\n+...     class Meta:\n+...         model = Category\n+...         fields = ['url']\n+\n+>>> CategoryForm.base_fields.keys()\n+['url']\n+\n+\n+Using 'exclude'\n+\n+>>> class CategoryForm(ModelForm):\n+...\n+...     class Meta:\n+...         model = Category\n+...         exclude = ['url']\n+\n+>>> CategoryForm.base_fields.keys()\n+['name', 'slug']\n+\n+\n+Using 'fields' *and* 'exclude'. Not sure why you'd want to do this, but uh,\n+\"be liberal in what you accept\" and all.\n+\n+>>> class CategoryForm(ModelForm):\n+...\n+...     class Meta:\n+...         model = Category\n+...         fields = ['name', 'url']\n+...         exclude = ['url']\n+\n+>>> CategoryForm.base_fields.keys()\n+['name']\n+\n+Using 'widgets'\n+\n+>>> class CategoryForm(ModelForm):\n+...\n+...     class Meta:\n+...         model = Category\n+...         fields = ['name', 'url', 'slug']\n+...         widgets = {\n+...             'name': forms.Textarea,\n+...             'url': forms.TextInput(attrs={'class': 'url'})\n+...         }\n+\n+>>> str(CategoryForm()['name'])\n+'<textarea id=\"id_name\" rows=\"10\" cols=\"40\" name=\"name\"></textarea>'\n+\n+>>> str(CategoryForm()['url'])\n+'<input id=\"id_url\" type=\"text\" class=\"url\" name=\"url\" maxlength=\"40\" />'\n+\n+>>> str(CategoryForm()['slug'])\n+'<input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" />'\n+\n+Don't allow more than one 'model' definition in the inheritance hierarchy.\n+Technically, it would generate a valid form, but the fact that the resulting\n+save method won't deal with multiple objects is likely to trip up people not\n+familiar with the mechanics.\n+\n+>>> class CategoryForm(ModelForm):\n+...     class Meta:\n+...         model = Category\n+\n+>>> class OddForm(CategoryForm):\n+...     class Meta:\n+...         model = Article\n+\n+OddForm is now an Article-related thing, because BadForm.Meta overrides\n+CategoryForm.Meta.\n+>>> OddForm.base_fields.keys()\n+['headline', 'slug', 'pub_date', 'writer', 'article', 'status', 'categories']\n+\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+\n+First class with a Meta class wins.\n+\n+>>> class BadForm(ArticleForm, CategoryForm):\n+...     pass\n+>>> OddForm.base_fields.keys()\n+['headline', 'slug', 'pub_date', 'writer', 'article', 'status', 'categories']\n+\n+Subclassing without specifying a Meta on the class will use the parent's Meta\n+(or the first parent in the MRO if there are multiple parent classes).\n+\n+>>> class CategoryForm(ModelForm):\n+...     class Meta:\n+...         model = Category\n+>>> class SubCategoryForm(CategoryForm):\n+...     pass\n+>>> SubCategoryForm.base_fields.keys()\n+['name', 'slug', 'url']\n+\n+We can also subclass the Meta inner class to change the fields list.\n+\n+>>> class CategoryForm(ModelForm):\n+...     checkbox = forms.BooleanField()\n+...\n+...     class Meta:\n+...         model = Category\n+>>> class SubCategoryForm(CategoryForm):\n+...     class Meta(CategoryForm.Meta):\n+...         exclude = ['url']\n+\n+>>> print SubCategoryForm()\n+<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_checkbox\">Checkbox:</label></th><td><input type=\"checkbox\" name=\"checkbox\" id=\"id_checkbox\" /></td></tr>\n+\n+# test using fields to provide ordering to the fields\n+>>> class CategoryForm(ModelForm):\n+...     class Meta:\n+...         model = Category\n+...         fields = ['url', 'name']\n+\n+>>> CategoryForm.base_fields.keys()\n+['url', 'name']\n+\n+\n+>>> print CategoryForm()\n+<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n+<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n+\n+>>> class CategoryForm(ModelForm):\n+...     class Meta:\n+...         model = Category\n+...         fields = ['slug', 'url', 'name']\n+...         exclude = ['url']\n+\n+>>> CategoryForm.base_fields.keys()\n+['slug', 'name']\n+\n+# Old form_for_x tests #######################################################\n+\n+>>> from django.forms import ModelForm, CharField\n+>>> import datetime\n+\n+>>> Category.objects.all()\n+[]\n+\n+>>> class CategoryForm(ModelForm):\n+...     class Meta:\n+...         model = Category\n+>>> f = CategoryForm()\n+>>> print f\n+<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n+>>> print f.as_ul()\n+<li><label for=\"id_name\">Name:</label> <input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n+<li><label for=\"id_slug\">Slug:</label> <input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n+<li><label for=\"id_url\">The URL:</label> <input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></li>\n+>>> print f['name']\n+<input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" />\n+\n+>>> f = CategoryForm(auto_id=False)\n+>>> print f.as_ul()\n+<li>Name: <input type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n+<li>The URL: <input type=\"text\" name=\"url\" maxlength=\"40\" /></li>\n+\n+>>> f = CategoryForm({'name': 'Entertainment', 'slug': 'entertainment', 'url': 'entertainment'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data['url']\n+u'entertainment'\n+>>> f.cleaned_data['name']\n+u'Entertainment'\n+>>> f.cleaned_data['slug']\n+u'entertainment'\n+>>> obj = f.save()\n+>>> obj\n+<Category: Entertainment>\n+>>> Category.objects.all()\n+[<Category: Entertainment>]\n+\n+>>> f = CategoryForm({'name': \"It's a test\", 'slug': 'its-test', 'url': 'test'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data['url']\n+u'test'\n+>>> f.cleaned_data['name']\n+u\"It's a test\"\n+>>> f.cleaned_data['slug']\n+u'its-test'\n+>>> obj = f.save()\n+>>> obj\n+<Category: It's a test>\n+>>> Category.objects.order_by('name')\n+[<Category: Entertainment>, <Category: It's a test>]\n+\n+If you call save() with commit=False, then it will return an object that\n+hasn't yet been saved to the database. In this case, it's up to you to call\n+save() on the resulting model instance.\n+>>> f = CategoryForm({'name': 'Third test', 'slug': 'third-test', 'url': 'third'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data['url']\n+u'third'\n+>>> f.cleaned_data['name']\n+u'Third test'\n+>>> f.cleaned_data['slug']\n+u'third-test'\n+>>> obj = f.save(commit=False)\n+>>> obj\n+<Category: Third test>\n+>>> Category.objects.order_by('name')\n+[<Category: Entertainment>, <Category: It's a test>]\n+>>> obj.save()\n+>>> Category.objects.order_by('name')\n+[<Category: Entertainment>, <Category: It's a test>, <Category: Third test>]\n+\n+If you call save() with invalid data, you'll get a ValueError.\n+>>> f = CategoryForm({'name': '', 'slug': 'not a slug!', 'url': 'foo'})\n+>>> f.errors['name']\n+[u'This field is required.']\n+>>> f.errors['slug']\n+[u\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"]\n+>>> f.cleaned_data\n+Traceback (most recent call last):\n+...\n+AttributeError: 'CategoryForm' object has no attribute 'cleaned_data'\n+>>> f.save()\n+Traceback (most recent call last):\n+...\n+ValueError: The Category could not be created because the data didn't validate.\n+>>> f = CategoryForm({'name': '', 'slug': '', 'url': 'foo'})\n+>>> f.save()\n+Traceback (most recent call last):\n+...\n+ValueError: The Category could not be created because the data didn't validate.\n+\n+Create a couple of Writers.\n+>>> w_royko = Writer(name='Mike Royko')\n+>>> w_royko.save()\n+>>> w_woodward = Writer(name='Bob Woodward')\n+>>> w_woodward.save()\n+\n+ManyToManyFields are represented by a MultipleChoiceField, ForeignKeys and any\n+fields with the 'choices' attribute are represented by a ChoiceField.\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = ArticleForm(auto_id=False)\n+>>> print f\n+<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n+<tr><th>Slug:</th><td><input type=\"text\" name=\"slug\" maxlength=\"50\" /></td></tr>\n+<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n+<tr><th>Writer:</th><td><select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"...\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+</select></td></tr>\n+<tr><th>Article:</th><td><textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></td></tr>\n+<tr><th>Status:</th><td><select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></td></tr>\n+<tr><th>Categories:</th><td><select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select><br /><span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></td></tr>\n+\n+You can restrict a form to a subset of the complete list of fields\n+by providing a 'fields' argument. If you try to save a\n+model created with such a form, you need to ensure that the fields\n+that are _not_ on the form have default values, or are allowed to have\n+a value of None. If a field isn't specified on a form, the object created\n+from the form can't provide a value for that field!\n+>>> class PartialArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+...         fields = ('headline','pub_date')\n+>>> f = PartialArticleForm(auto_id=False)\n+>>> print f\n+<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n+<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n+\n+When the ModelForm is passed an instance, that instance's current values are\n+inserted as 'initial' data in each Field.\n+>>> w = Writer.objects.get(name='Mike Royko')\n+>>> class RoykoForm(ModelForm):\n+...     class Meta:\n+...         model = Writer\n+>>> f = RoykoForm(auto_id=False, instance=w)\n+>>> print f\n+<tr><th>Name:</th><td><input type=\"text\" name=\"name\" value=\"Mike Royko\" maxlength=\"50\" /><br /><span class=\"helptext\">Use both first and last names.</span></td></tr>\n+\n+>>> art = Article(headline='Test article', slug='test-article', pub_date=datetime.date(1988, 1, 4), writer=w, article='Hello.')\n+>>> art.save()\n+>>> art.id\n+1\n+>>> class TestArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = TestArticleForm(auto_id=False, instance=art)\n+>>> print f.as_ul()\n+<li>Headline: <input type=\"text\" name=\"headline\" value=\"Test article\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" value=\"test-article\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\">---------</option>\n+<option value=\"...\" selected=\"selected\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+>>> f = TestArticleForm({'headline': u'Test headline', 'slug': 'test-headline', 'pub_date': u'1984-02-06', 'writer': unicode(w_royko.pk), 'article': 'Hello.'}, instance=art)\n+>>> f.errors\n+{}\n+>>> f.is_valid()\n+True\n+>>> test_art = f.save()\n+>>> test_art.id\n+1\n+>>> test_art = Article.objects.get(id=1)\n+>>> test_art.headline\n+u'Test headline'\n+\n+You can create a form over a subset of the available fields\n+by specifying a 'fields' argument to form_for_instance.\n+>>> class PartialArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+...         fields=('headline', 'slug', 'pub_date')\n+>>> f = PartialArticleForm({'headline': u'New headline', 'slug': 'new-headline', 'pub_date': u'1988-01-04'}, auto_id=False, instance=art)\n+>>> print f.as_ul()\n+<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n+>>> f.is_valid()\n+True\n+>>> new_art = f.save()\n+>>> new_art.id\n+1\n+>>> new_art = Article.objects.get(id=1)\n+>>> new_art.headline\n+u'New headline'\n+\n+Add some categories and test the many-to-many form output.\n+>>> new_art.categories.all()\n+[]\n+>>> new_art.categories.add(Category.objects.get(name='Entertainment'))\n+>>> new_art.categories.all()\n+[<Category: Entertainment>]\n+>>> class TestArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = TestArticleForm(auto_id=False, instance=new_art)\n+>>> print f.as_ul()\n+<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\">---------</option>\n+<option value=\"...\" selected=\"selected\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\" selected=\"selected\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+\n+Initial values can be provided for model forms\n+>>> f = TestArticleForm(auto_id=False, initial={'headline': 'Your headline here', 'categories': ['1','2']})\n+>>> print f.as_ul()\n+<li>Headline: <input type=\"text\" name=\"headline\" value=\"Your headline here\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"...\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\" selected=\"selected\">Entertainment</option>\n+<option value=\"2\" selected=\"selected\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+\n+>>> f = TestArticleForm({'headline': u'New headline', 'slug': u'new-headline', 'pub_date': u'1988-01-04',\n+...     'writer': unicode(w_royko.pk), 'article': u'Hello.', 'categories': [u'1', u'2']}, instance=new_art)\n+>>> new_art = f.save()\n+>>> new_art.id\n+1\n+>>> new_art = Article.objects.get(id=1)\n+>>> new_art.categories.order_by('name')\n+[<Category: Entertainment>, <Category: It's a test>]\n+\n+Now, submit form data with no categories. This deletes the existing categories.\n+>>> f = TestArticleForm({'headline': u'New headline', 'slug': u'new-headline', 'pub_date': u'1988-01-04',\n+...     'writer': unicode(w_royko.pk), 'article': u'Hello.'}, instance=new_art)\n+>>> new_art = f.save()\n+>>> new_art.id\n+1\n+>>> new_art = Article.objects.get(id=1)\n+>>> new_art.categories.all()\n+[]\n+\n+Create a new article, with categories, via the form.\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n+...     'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [u'1', u'2']})\n+>>> new_art = f.save()\n+>>> new_art.id\n+2\n+>>> new_art = Article.objects.get(id=2)\n+>>> new_art.categories.order_by('name')\n+[<Category: Entertainment>, <Category: It's a test>]\n+\n+Create a new article, with no categories, via the form.\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n+...     'writer': unicode(w_royko.pk), 'article': u'Test.'})\n+>>> new_art = f.save()\n+>>> new_art.id\n+3\n+>>> new_art = Article.objects.get(id=3)\n+>>> new_art.categories.all()\n+[]\n+\n+Create a new article, with categories, via the form, but use commit=False.\n+The m2m data won't be saved until save_m2m() is invoked on the form.\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': u'1967-11-01',\n+...     'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [u'1', u'2']})\n+>>> new_art = f.save(commit=False)\n+\n+# Manually save the instance\n+>>> new_art.save()\n+>>> new_art.id\n+4\n+\n+# The instance doesn't have m2m data yet\n+>>> new_art = Article.objects.get(id=4)\n+>>> new_art.categories.all()\n+[]\n+\n+# Save the m2m data on the form\n+>>> f.save_m2m()\n+>>> new_art.categories.order_by('name')\n+[<Category: Entertainment>, <Category: It's a test>]\n+\n+Here, we define a custom ModelForm. Because it happens to have the same fields as\n+the Category model, we can just call the form's save() to apply its changes to an\n+existing Category instance.\n+>>> class ShortCategory(ModelForm):\n+...     name = CharField(max_length=5)\n+...     slug = CharField(max_length=5)\n+...     url = CharField(max_length=3)\n+>>> cat = Category.objects.get(name='Third test')\n+>>> cat\n+<Category: Third test>\n+>>> cat.id\n+3\n+>>> form = ShortCategory({'name': 'Third', 'slug': 'third', 'url': '3rd'}, instance=cat)\n+>>> form.save()\n+<Category: Third>\n+>>> Category.objects.get(id=3)\n+<Category: Third>\n+\n+Here, we demonstrate that choices for a ForeignKey ChoiceField are determined\n+at runtime, based on the data in the database when the form is displayed, not\n+the data in the database when the form is instantiated.\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = ArticleForm(auto_id=False)\n+>>> print f.as_ul()\n+<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"...\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+>>> Category.objects.create(name='Fourth', url='4th')\n+<Category: Fourth>\n+>>> Writer.objects.create(name='Carl Bernstein')\n+<Writer: Carl Bernstein>\n+>>> print f.as_ul()\n+<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"...\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+<option value=\"...\">Carl Bernstein</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third</option>\n+<option value=\"4\">Fourth</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+\n+# ModelChoiceField ############################################################\n+\n+>>> from django.forms import ModelChoiceField, ModelMultipleChoiceField\n+\n+>>> f = ModelChoiceField(Category.objects.all())\n+>>> list(f.choices)\n+[(u'', u'---------'), (1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third'), (4, u'Fourth')]\n+>>> f.clean('')\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'This field is required.']\n+>>> f.clean(None)\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'This field is required.']\n+>>> f.clean(0)\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n+>>> f.clean(3)\n+<Category: Third>\n+>>> f.clean(2)\n+<Category: It's a test>\n+\n+# Add a Category object *after* the ModelChoiceField has already been\n+# instantiated. This proves clean() checks the database during clean() rather\n+# than caching it at time of instantiation.\n+>>> Category.objects.create(name='Fifth', url='5th')\n+<Category: Fifth>\n+>>> f.clean(5)\n+<Category: Fifth>\n+\n+# Delete a Category object *after* the ModelChoiceField has already been\n+# instantiated. This proves clean() checks the database during clean() rather\n+# than caching it at time of instantiation.\n+>>> Category.objects.get(url='5th').delete()\n+>>> f.clean(5)\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n+\n+>>> f = ModelChoiceField(Category.objects.filter(pk=1), required=False)\n+>>> print f.clean('')\n+None\n+>>> f.clean('')\n+>>> f.clean('1')\n+<Category: Entertainment>\n+>>> f.clean('100')\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n+\n+# queryset can be changed after the field is created.\n+>>> f.queryset = Category.objects.exclude(name='Fourth')\n+>>> list(f.choices)\n+[(u'', u'---------'), (1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third')]\n+>>> f.clean(3)\n+<Category: Third>\n+>>> f.clean(4)\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n+\n+# check that we can safely iterate choices repeatedly\n+>>> gen_one = list(f.choices)\n+>>> gen_two = f.choices\n+>>> gen_one[2]\n+(2L, u\"It's a test\")\n+>>> list(gen_two)\n+[(u'', u'---------'), (1L, u'Entertainment'), (2L, u\"It's a test\"), (3L, u'Third')]\n+\n+# check that we can override the label_from_instance method to print custom labels (#4620)\n+>>> f.queryset = Category.objects.all()\n+>>> f.label_from_instance = lambda obj: \"category \" + str(obj)\n+>>> list(f.choices)\n+[(u'', u'---------'), (1L, 'category Entertainment'), (2L, \"category It's a test\"), (3L, 'category Third'), (4L, 'category Fourth')]\n+\n+# ModelMultipleChoiceField ####################################################\n+\n+>>> f = ModelMultipleChoiceField(Category.objects.all())\n+>>> list(f.choices)\n+[(1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third'), (4, u'Fourth')]\n+>>> f.clean(None)\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'This field is required.']\n+>>> f.clean([])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'This field is required.']\n+>>> f.clean([1])\n+[<Category: Entertainment>]\n+>>> f.clean([2])\n+[<Category: It's a test>]\n+>>> f.clean(['1'])\n+[<Category: Entertainment>]\n+>>> f.clean(['1', '2'])\n+[<Category: Entertainment>, <Category: It's a test>]\n+>>> f.clean([1, '2'])\n+[<Category: Entertainment>, <Category: It's a test>]\n+>>> f.clean((1, '2'))\n+[<Category: Entertainment>, <Category: It's a test>]\n+>>> f.clean(['100'])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 100 is not one of the available choices.']\n+>>> f.clean('hello')\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Enter a list of values.']\n+>>> f.clean(['fail'])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'\"fail\" is not a valid value for a primary key.']\n+\n+# Add a Category object *after* the ModelMultipleChoiceField has already been\n+# instantiated. This proves clean() checks the database during clean() rather\n+# than caching it at time of instantiation.\n+>>> Category.objects.create(id=6, name='Sixth', url='6th')\n+<Category: Sixth>\n+>>> f.clean([6])\n+[<Category: Sixth>]\n+\n+# Delete a Category object *after* the ModelMultipleChoiceField has already been\n+# instantiated. This proves clean() checks the database during clean() rather\n+# than caching it at time of instantiation.\n+>>> Category.objects.get(url='6th').delete()\n+>>> f.clean([6])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 6 is not one of the available choices.']\n+\n+>>> f = ModelMultipleChoiceField(Category.objects.all(), required=False)\n+>>> f.clean([])\n+[]\n+>>> f.clean(())\n+[]\n+>>> f.clean(['10'])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n+>>> f.clean(['3', '10'])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n+>>> f.clean(['1', '10'])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n+\n+# queryset can be changed after the field is created.\n+>>> f.queryset = Category.objects.exclude(name='Fourth')\n+>>> list(f.choices)\n+[(1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third')]\n+>>> f.clean([3])\n+[<Category: Third>]\n+>>> f.clean([4])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 4 is not one of the available choices.']\n+>>> f.clean(['3', '4'])\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 4 is not one of the available choices.']\n+\n+>>> f.queryset = Category.objects.all()\n+>>> f.label_from_instance = lambda obj: \"multicategory \" + str(obj)\n+>>> list(f.choices)\n+[(1L, 'multicategory Entertainment'), (2L, \"multicategory It's a test\"), (3L, 'multicategory Third'), (4L, 'multicategory Fourth')]\n+\n+# OneToOneField ###############################################################\n+\n+>>> class ImprovedArticleForm(ModelForm):\n+...     class Meta:\n+...         model = ImprovedArticle\n+>>> ImprovedArticleForm.base_fields.keys()\n+['article']\n+\n+>>> class ImprovedArticleWithParentLinkForm(ModelForm):\n+...     class Meta:\n+...         model = ImprovedArticleWithParentLink\n+>>> ImprovedArticleWithParentLinkForm.base_fields.keys()\n+[]\n+\n+>>> bw = BetterWriter(name=u'Joe Better', score=10)\n+>>> bw.save()\n+>>> sorted(model_to_dict(bw).keys())\n+['id', 'name', 'score', 'writer_ptr']\n+\n+>>> class BetterWriterForm(ModelForm):\n+...     class Meta:\n+...         model = BetterWriter\n+>>> form = BetterWriterForm({'name': 'Some Name', 'score': 12})\n+>>> form.is_valid()\n+True\n+>>> bw2 = form.save()\n+>>> bw2.delete()\n+\n+\n+>>> class WriterProfileForm(ModelForm):\n+...     class Meta:\n+...         model = WriterProfile\n+>>> form = WriterProfileForm()\n+>>> print form.as_p()\n+<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"...\">Mike Royko</option>\n+<option value=\"...\">Bob Woodward</option>\n+<option value=\"...\">Carl Bernstein</option>\n+<option value=\"...\">Joe Better</option>\n+</select></p>\n+<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" id=\"id_age\" /></p>\n+\n+>>> data = {\n+...     'writer': unicode(w_woodward.pk),\n+...     'age': u'65',\n+... }\n+>>> form = WriterProfileForm(data)\n+>>> instance = form.save()\n+>>> instance\n+<WriterProfile: Bob Woodward is 65>\n+\n+>>> form = WriterProfileForm(instance=instance)\n+>>> print form.as_p()\n+<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n+<option value=\"\">---------</option>\n+<option value=\"...\">Mike Royko</option>\n+<option value=\"...\" selected=\"selected\">Bob Woodward</option>\n+<option value=\"...\">Carl Bernstein</option>\n+<option value=\"...\">Joe Better</option>\n+</select></p>\n+<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" value=\"65\" id=\"id_age\" /></p>\n+\n+# PhoneNumberField ############################################################\n+\n+>>> class PhoneNumberForm(ModelForm):\n+...     class Meta:\n+...         model = PhoneNumber\n+>>> f = PhoneNumberForm({'phone': '(312) 555-1212', 'description': 'Assistance'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data['phone']\n+u'312-555-1212'\n+>>> f.cleaned_data['description']\n+u'Assistance'\n+\n+# FileField ###################################################################\n+\n+# File forms.\n+\n+>>> class TextFileForm(ModelForm):\n+...     class Meta:\n+...         model = TextFile\n+\n+# Test conditions when files is either not given or empty.\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'})\n+>>> f.is_valid()\n+False\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={})\n+>>> f.is_valid()\n+False\n+\n+# Upload a file and ensure it all works as expected.\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n+>>> f.is_valid()\n+True\n+>>> type(f.cleaned_data['file'])\n+<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test1.txt>\n+\n+>>> instance.file.delete()\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n+>>> f.is_valid()\n+True\n+>>> type(f.cleaned_data['file'])\n+<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test1.txt>\n+\n+# Check if the max_length attribute has been inherited from the model.\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test-maxlength.txt', 'hello world')})\n+>>> f.is_valid()\n+False\n+\n+# Edit an instance that already has the file defined in the model. This will not\n+# save the file again, but leave it exactly as it is.\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data['file']\n+<FieldFile: tests/test1.txt>\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test1.txt>\n+\n+# Delete the current file since this is not done by Django.\n+>>> instance.file.delete()\n+\n+# Override the file by uploading a new one.\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test2.txt', 'hello world')}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test2.txt>\n+\n+# Delete the current file since this is not done by Django.\n+>>> instance.file.delete()\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test2.txt', 'hello world')})\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test2.txt>\n+\n+# Delete the current file since this is not done by Django.\n+>>> instance.file.delete()\n+\n+>>> instance.delete()\n+\n+# Test the non-required FileField\n+>>> f = TextFileForm(data={'description': u'Assistance'})\n+>>> f.fields['file'].required = False\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: None>\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test3.txt', 'hello world')}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test3.txt>\n+\n+# Instance can be edited w/out re-uploading the file and existing file should be preserved.\n+\n+>>> f = TextFileForm(data={'description': u'New Description'}, instance=instance)\n+>>> f.fields['file'].required = False\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.description\n+u'New Description'\n+>>> instance.file\n+<FieldFile: tests/test3.txt>\n+\n+# Delete the current file since this is not done by Django.\n+>>> instance.file.delete()\n+>>> instance.delete()\n+\n+>>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test3.txt', 'hello world')})\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.file\n+<FieldFile: tests/test3.txt>\n+\n+# Delete the current file since this is not done by Django.\n+>>> instance.file.delete()\n+>>> instance.delete()\n+\n+# BigIntegerField ################################################################\n+>>> class BigIntForm(forms.ModelForm):\n+...     class Meta:\n+...         model = BigInt\n+...\n+>>> bif = BigIntForm({'biggie': '-9223372036854775808'})\n+>>> bif.is_valid()\n+True\n+>>> bif = BigIntForm({'biggie': '-9223372036854775809'})\n+>>> bif.is_valid()\n+False\n+>>> bif.errors\n+{'biggie': [u'Ensure this value is greater than or equal to -9223372036854775808.']}\n+>>> bif = BigIntForm({'biggie': '9223372036854775807'})\n+>>> bif.is_valid()\n+True\n+>>> bif = BigIntForm({'biggie': '9223372036854775808'})\n+>>> bif.is_valid()\n+False\n+>>> bif.errors\n+{'biggie': [u'Ensure this value is less than or equal to 9223372036854775807.']}\n+\"\"\"}\n+\n+if test_images:\n+    __test__['API_TESTS'] += \"\"\"\n+# ImageField ###################################################################\n+\n+# ImageField and FileField are nearly identical, but they differ slighty when\n+# it comes to validation. This specifically tests that #6302 is fixed for\n+# both file fields and image fields.\n+\n+>>> class ImageFileForm(ModelForm):\n+...     class Meta:\n+...         model = ImageFile\n+\n+>>> image_data = open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb').read()\n+>>> image_data2 = open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb').read()\n+\n+>>> f = ImageFileForm(data={'description': u'An image'}, files={'image': SimpleUploadedFile('test.png', image_data)})\n+>>> f.is_valid()\n+True\n+>>> type(f.cleaned_data['image'])\n+<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test.png>\n+>>> instance.width\n+16\n+>>> instance.height\n+16\n+\n+# Delete the current file since this is not done by Django, but don't save\n+# because the dimension fields are not null=True.\n+>>> instance.image.delete(save=False)\n+\n+>>> f = ImageFileForm(data={'description': u'An image'}, files={'image': SimpleUploadedFile('test.png', image_data)})\n+>>> f.is_valid()\n+True\n+>>> type(f.cleaned_data['image'])\n+<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test.png>\n+>>> instance.width\n+16\n+>>> instance.height\n+16\n+\n+# Edit an instance that already has the (required) image defined in the model. This will not\n+# save the image again, but leave it exactly as it is.\n+\n+>>> f = ImageFileForm(data={'description': u'Look, it changed'}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data['image']\n+<...FieldFile: tests/test.png>\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test.png>\n+>>> instance.height\n+16\n+>>> instance.width\n+16\n+\n+# Delete the current file since this is not done by Django, but don't save\n+# because the dimension fields are not null=True.\n+>>> instance.image.delete(save=False)\n+\n+# Override the file by uploading a new one.\n+\n+>>> f = ImageFileForm(data={'description': u'Changed it'}, files={'image': SimpleUploadedFile('test2.png', image_data2)}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test2.png>\n+>>> instance.height\n+32\n+>>> instance.width\n+48\n+\n+# Delete the current file since this is not done by Django, but don't save\n+# because the dimension fields are not null=True.\n+>>> instance.image.delete(save=False)\n+>>> instance.delete()\n+\n+>>> f = ImageFileForm(data={'description': u'Changed it'}, files={'image': SimpleUploadedFile('test2.png', image_data2)})\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test2.png>\n+>>> instance.height\n+32\n+>>> instance.width\n+48\n+\n+# Delete the current file since this is not done by Django, but don't save\n+# because the dimension fields are not null=True.\n+>>> instance.image.delete(save=False)\n+>>> instance.delete()\n+\n+# Test the non-required ImageField\n+\n+>>> class OptionalImageFileForm(ModelForm):\n+...     class Meta:\n+...         model = OptionalImageFile\n+\n+>>> f = OptionalImageFileForm(data={'description': u'Test'})\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: None>\n+>>> instance.width\n+>>> instance.height\n+\n+>>> f = OptionalImageFileForm(data={'description': u'And a final one'}, files={'image': SimpleUploadedFile('test3.png', image_data)}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test3.png>\n+>>> instance.width\n+16\n+>>> instance.height\n+16\n+\n+# Editing the instance without re-uploading the image should not affect the image or its width/height properties\n+>>> f = OptionalImageFileForm(data={'description': u'New Description'}, instance=instance)\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.description\n+u'New Description'\n+>>> instance.image\n+<...FieldFile: tests/test3.png>\n+>>> instance.width\n+16\n+>>> instance.height\n+16\n+\n+# Delete the current file since this is not done by Django.\n+>>> instance.image.delete()\n+>>> instance.delete()\n+\n+>>> f = OptionalImageFileForm(data={'description': u'And a final one'}, files={'image': SimpleUploadedFile('test4.png', image_data2)})\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: tests/test4.png>\n+>>> instance.width\n+48\n+>>> instance.height\n+32\n+>>> instance.delete()\n+\n+# Test callable upload_to behavior that's dependent on the value of another field in the model\n+>>> f = ImageFileForm(data={'description': u'And a final one', 'path': 'foo'}, files={'image': SimpleUploadedFile('test4.png', image_data)})\n+>>> f.is_valid()\n+True\n+>>> instance = f.save()\n+>>> instance.image\n+<...FieldFile: foo/test4.png>\n+>>> instance.delete()\n+\"\"\"\n+\n+__test__['API_TESTS'] += \"\"\"\n+\n+# Media on a ModelForm ########################################################\n+\n+# Similar to a regular Form class you can define custom media to be used on\n+# the ModelForm.\n+\n+>>> class ModelFormWithMedia(ModelForm):\n+...     class Media:\n+...         js = ('/some/form/javascript',)\n+...         css = {\n+...             'all': ('/some/form/css',)\n+...         }\n+...     class Meta:\n+...         model = PhoneNumber\n+>>> f = ModelFormWithMedia()\n+>>> print f.media\n+<link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/some/form/javascript\"></script>\n+\n+>>> class CommaSeparatedIntegerForm(ModelForm):\n+...    class Meta:\n+...        model = CommaSeparatedInteger\n+\n+>>> f = CommaSeparatedIntegerForm({'field': '1,2,3'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data\n+{'field': u'1,2,3'}\n+>>> f = CommaSeparatedIntegerForm({'field': '1a,2'})\n+>>> f.errors\n+{'field': [u'Enter only digits separated by commas.']}\n+>>> f = CommaSeparatedIntegerForm({'field': ',,,,'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data\n+{'field': u',,,,'}\n+>>> f = CommaSeparatedIntegerForm({'field': '1.2'})\n+>>> f.errors\n+{'field': [u'Enter only digits separated by commas.']}\n+>>> f = CommaSeparatedIntegerForm({'field': '1,a,2'})\n+>>> f.errors\n+{'field': [u'Enter only digits separated by commas.']}\n+>>> f = CommaSeparatedIntegerForm({'field': '1,,2'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data\n+{'field': u'1,,2'}\n+>>> f = CommaSeparatedIntegerForm({'field': '1'})\n+>>> f.is_valid()\n+True\n+>>> f.cleaned_data\n+{'field': u'1'}\n+\n+This Price instance generated by this form is not valid because the quantity\n+field is required, but the form is valid because the field is excluded from\n+the form. This is for backwards compatibility.\n+\n+>>> class PriceForm(ModelForm):\n+...     class Meta:\n+...         model = Price\n+...         exclude = ('quantity',)\n+>>> form = PriceForm({'price': '6.00'})\n+>>> form.is_valid()\n+True\n+>>> price = form.save(commit=False)\n+>>> price.full_clean()\n+Traceback (most recent call last):\n+  ...\n+ValidationError: {'quantity': [u'This field cannot be null.']}\n+\n+The form should not validate fields that it doesn't contain even if they are\n+specified using 'fields', not 'exclude'.\n+...     class Meta:\n+...         model = Price\n+...         fields = ('price',)\n+>>> form = PriceForm({'price': '6.00'})\n+>>> form.is_valid()\n+True\n+\n+The form should still have an instance of a model that is not complete and\n+not saved into a DB yet.\n+\n+>>> form.instance.price\n+Decimal('6.00')\n+>>> form.instance.quantity is None\n+True\n+>>> form.instance.pk is None\n+True\n+\n+# Choices on CharField and IntegerField\n+>>> class ArticleForm(ModelForm):\n+...     class Meta:\n+...         model = Article\n+>>> f = ArticleForm()\n+>>> f.fields['status'].clean('42')\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. 42 is not one of the available choices.']\n+\n+>>> class ArticleStatusForm(ModelForm):\n+...     class Meta:\n+...         model = ArticleStatus\n+>>> f = ArticleStatusForm()\n+>>> f.fields['status'].clean('z')\n+Traceback (most recent call last):\n+...\n+ValidationError: [u'Select a valid choice. z is not one of the available choices.']\n+\n+# Foreign keys which use to_field #############################################\n+\n+>>> apple = Inventory.objects.create(barcode=86, name='Apple')\n+>>> pear = Inventory.objects.create(barcode=22, name='Pear')\n+>>> core = Inventory.objects.create(barcode=87, name='Core', parent=apple)\n+\n+>>> field = ModelChoiceField(Inventory.objects.all(), to_field_name='barcode')\n+>>> for choice in field.choices:\n+...     print choice\n+(u'', u'---------')\n+(86, u'Apple')\n+(22, u'Pear')\n+(87, u'Core')\n+\n+>>> class InventoryForm(ModelForm):\n+...     class Meta:\n+...         model = Inventory\n+>>> form = InventoryForm(instance=core)\n+>>> print form['parent']\n+<select name=\"parent\" id=\"id_parent\">\n+<option value=\"\">---------</option>\n+<option value=\"86\" selected=\"selected\">Apple</option>\n+<option value=\"22\">Pear</option>\n+<option value=\"87\">Core</option>\n+</select>\n+\n+>>> data = model_to_dict(core)\n+>>> data['parent'] = '22'\n+>>> form = InventoryForm(data=data, instance=core)\n+>>> core = form.save()\n+>>> core.parent\n+<Inventory: Pear>\n+\n+>>> class CategoryForm(ModelForm):\n+...     description = forms.CharField()\n+...     class Meta:\n+...         model = Category\n+...         fields = ['description', 'url']\n+\n+>>> CategoryForm.base_fields.keys()\n+['description', 'url']\n+\n+>>> print CategoryForm()\n+<tr><th><label for=\"id_description\">Description:</label></th><td><input type=\"text\" name=\"description\" id=\"id_description\" /></td></tr>\n+<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n+\n+# to_field_name should also work on ModelMultipleChoiceField ##################\n+\n+>>> field = ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n+>>> for choice in field.choices:\n+...     print choice\n+(86, u'Apple')\n+(22, u'Pear')\n+(87, u'Core')\n+>>> field.clean([86])\n+[<Inventory: Apple>]\n+\n+>>> class SelectInventoryForm(forms.Form):\n+...     items = ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n+>>> form = SelectInventoryForm({'items': [87, 22]})\n+>>> form.is_valid()\n+True\n+>>> form.cleaned_data\n+{'items': [<Inventory: Pear>, <Inventory: Core>]}\n+\n+# Model field that returns None to exclude itself with explicit fields ########\n+\n+>>> class CustomFieldForExclusionForm(ModelForm):\n+...     class Meta:\n+...         model = CustomFieldForExclusionModel\n+...         fields = ['name', 'markup']\n+\n+>>> CustomFieldForExclusionForm.base_fields.keys()\n+['name']\n+\n+>>> print CustomFieldForExclusionForm()\n+<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"10\" /></td></tr>\n+\n+# Clean up\n+>>> import shutil\n+>>> shutil.rmtree(temp_storage_dir)\n+\"\"\""
        },
        {
            "sha": "33918ee88cd961778289aab99f059773742e08d0",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1381,
            "changes": 1381,
            "blob_url": "https://github.com/django/django/blob/e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=e5dfc6cf94d437b1894cb4a93a4117cf3e90e07f",
            "patch": "@@ -30,1387 +30,6 @@ class Meta:\n         model = Category\n \n \n-class ModelFormTests(TestCase):\n-    def test_base_fields(self):\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-        self.assertEqual(\n-            CategoryForm.base_fields.keys(),\n-            [\"name\", \"slug\", \"url\"]\n-        )\n-\n-        class CategoryForm(forms.ModelForm):\n-            some_extra_field = forms.BooleanField()\n-\n-            class Meta:\n-                model = Category\n-\n-        self.assertEqual(\n-            CategoryForm.base_fields.keys(),\n-            [\"name\", \"slug\", \"url\", \"some_extra_field\"]\n-        )\n-\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                models = Category\n-                fields = [\"url\"]\n-\n-        self.assertEqual(\n-            CategoryForm.base_fields.keys(),\n-            [\"url\"]\n-        )\n-\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-                exclude = [\"url\"]\n-\n-        self.assertTrue(\n-            CategoryForm.base_fields.keys(),\n-            [\"name\", \"slug\"]\n-        )\n-\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-                fields = [\"name\", \"url\"]\n-                exclude = [\"url\"]\n-\n-        self.assertEqual(\n-            CategoryForm.base_fields.keys(),\n-            [\"name\"]\n-        )\n-\n-\n-    def test_override(self):\n-        class WriterForm(forms.ModelForm):\n-            book = forms.CharField(required=False)\n-\n-            class Meta:\n-                model = Writer\n-\n-        wf = WriterForm({\"name\": \"Richard Lockridge\"})\n-        self.assertTrue(wf.is_valid())\n-\n-        class CategoryForm(ModelForm):\n-            url = forms.BooleanField()\n-\n-            class Meta:\n-                model = Category\n-\n-        self.assertIs(type(CategoryForm.base_fields[\"url\"]), forms.BooleanField)\n-\n-    def test_meta_widgets(self):\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-                fields = [\"name\", \"url\", \"slug\"]\n-                widgets = {\n-                    \"name\": forms.Textarea,\n-                    \"url\": forms.TextInput(attrs={\"class\": \"url\"})\n-                }\n-\n-            self.assertEqual(\n-                str(CategoryForm()[\"name\"]),\n-                '<textarea id=\"id_name\" rows=\"10\" cols=\"40\" name=\"name\"></textarea>'\n-            )\n-            self.assertEqual(\n-                str(CategoryForm()[\"url\"]),\n-                '<input id=\"id_url\" type=\"text\" class=\"url\" name=\"url\" maxlength=\"40\" />'\n-            )\n-            self.assertEqual(\n-                str(CategoryForm()[\"slug\"]),\n-                '<input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" />'\n-            )\n-\n-    def test_subclassing(self):\n-        # Don't allow more than one 'model' definition in the inheritance\n-        # hierarchy. Technically, it would generate a valid form, but the fact\n-        # that the resulting save method won't deal with multiple objects is\n-        # likely to trip up people not familiar with the mechanics.\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-\n-        # OddForm is now an Article-related thing, because BadForm.Meta\n-        # overrides CategoryForm.Meta.\n-        class OddForm(CategoryForm):\n-            class Meta:\n-                model = Article\n-\n-        self.assertEqual(\n-            OddForm.base_fields.keys(),\n-            [\"headline\", \"slug\", \"pub_date\", \"writer\", \"article\", \"status\", \"categories\"]\n-        )\n-\n-        class ArticleForm(forms.ModelForm):\n-            class Meta:\n-                model = Article\n-\n-        # First class with a Meta class wins.\n-        class BadForm(ArticleForm, CategoryForm):\n-            pass\n-        self.assertEqual(\n-            BadForm.base_fields.keys(),\n-            [\"headling\", \"slug\", \"pub_date\", \"writer\", \"article\", \"status\", \"categories\"]\n-        )\n-\n-        # Subclassing without specifying a Meta on the class will use the\n-        # parent's Meta (or the first parent in the MRO if there are multiple\n-        # parent classes).\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-\n-        class SubCategoryForm(CategoryForm):\n-            pass\n-\n-        self.assertEqual(\n-            SubCategoryForm.base_fields.keys(),\n-            [\"name\", \"slug\", \"url\"]\n-        )\n-\n-        # We can also subclass the Meta inner class to change the fields list.\n-        class CategoryForm(forms.ModelForm):\n-            checkbox = forms.BooleanField()\n-\n-            class Meta:\n-                model = Category\n-\n-        class SubCategoryForm(forms.ModelForm):\n-            class Meta(CategoryForm.Meta):\n-                exclude = [\"url\"]\n-\n-        self.assertEqual(\n-            str(SubCategoryForm()),\n-            \"\"\"<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_checkbox\">Checkbox:</label></th><td><input type=\"checkbox\" name=\"checkbox\" id=\"id_checkbox\" /></td></tr>\n-\"\"\"\n-        )\n-\n-    def test_fields_ordering(self):\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-                fields = [\"url\", \"name\"]\n-\n-        self.assertEqual(\n-            CategoryForm.base_fields.keys(),\n-            [\"url\", \"name\"]\n-        )\n-        self.assertEqual(\n-            str(CategoryForm()),\n-            \"\"\"<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n-<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n-\"\"\"\n-        )\n-\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-                fields = [\"slug\", \"url\", \"name\"]\n-                exclude = [\"url\"]\n-\n-        self.assertEqual(\n-            CategoryForm.base_fields.keys(),\n-            [\"slug\", \"name\"]\n-        )\n-\n-    def test_basic(self):\n-        class CategoryForm(forms.ModelForm):\n-            class Meta:\n-                model = Category\n-\n-        f = CategoryForm()\n-        self.assertEqual(\n-            str(CategoryForm()),\n-            \"\"\"<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n-\"\"\"\n-        )\n-        self.assertEqual(\n-            str(CategoryForm().as_url()),\n-            \"\"\"<li><label for=\"id_name\">Name:</label> <input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n-<li><label for=\"id_slug\">Slug:</label> <input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n-<li><label for=\"id_url\">The URL:</label> <input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></li>\n-\"\"\"\n-        )\n-        self.assertEqual(\n-            str(f[\"name\"]),\n-            '<input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" />'\n-        )\n-\n-        f = CategoryForm(auto_id=False)\n-        self.assertEqual(\n-            str(f.as_ul()),\n-            \"\"\"<li>Name: <input type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n-<li>The URL: <input type=\"text\" name=\"url\" maxlength=\"40\" /></li>\n-\"\"\"\n-        )\n-\n-        f = CategoryForm({\"name\": \"Entertainment\", \"slug\": \"entertainment\", \"url\": \"entertainment\"})\n-        self.assertTrue(f.is_valid())\n-        self.assertEqual(f.cleaned_data[\"url\"], \"entertainment\")\n-        self.assertEqual(f.cleaned_data[\"name\"], \"Entertainment\")\n-        self.assertEqual(f.cleaned_data[\"slug\"], \"entertainment\")\n-        obj = f.save()\n-        self.assertEqual(obj.name, \"Entertainment\")\n-        self.assertQuerysetEqual(\n-            Category.objects.all(), [\n-                \"Entertainment\"\n-            ],\n-            attrgetter(\"name\")\n-        )\n-\n-        f = CategoryForm({\"name\": \"It's a test\", \"slug\": \"its-test\", \"url\": \"test\"})\n-        self.assertTrue(f.is_valid())\n-        self.assertEqual(f.cleaned_data[\"url\"], \"test\")\n-        self.assertEqual(f.cleaned_data[\"name\"], \"It's a test\")\n-        self.assertEqual(f.cleaned_data[\"slug\"], \"its-test\")\n-        obj = f.save()\n-        self.assertEqual(obj.name, \"It's a test\")\n-        self.assertQuerysetEqual(\n-            Category.objects.order_by(\"name\"), [\n-                \"Entertainment\",\n-                \"It's a test\"\n-            ],\n-            attrgetter(\"name\")\n-        )\n-\n-        # If you call save() with commit=False, then it will return an object\n-        # that hasn't yet been saved to the database. In this case, it's up to\n-        # you to call save() on the resulting model instance.\n-        f = CategoryForm({\"name\": \"Third test\", \"slug\": \"third-test\", \"url\": \"third\"})\n-        self.assertTrue(f.is_valid())\n-        self.assertEqual(f.cleaned_data[\"url\"], \"third\")\n-        self.assertEqual(f.cleaned_data[\"name\"], \"Third test\")\n-        self.assertEqual(f.cleaned_data[\"slug\"], \"third-test\")\n-        obj = f.save(commit=False)\n-        self.assertEqual(obj.name, \"Third test\")\n-        self.assertQuerysetEqual(\n-            Category.objects.order_by(\"name\"), [\n-                \"Entertainment\",\n-                \"It's a test\"\n-            ],\n-            attrgetter(\"name\")\n-        )\n-        obj.save()\n-        self.assertQuerysetEqual(\n-            Category.objects.order_by(\"name\"), [\n-                \"Entertainment\",\n-                \"It's a test\",\n-                \"Third test\"\n-            ],\n-            attrgetter(\"name\")\n-        )\n-\n-        # If you call save() with invalid data, you'll get a ValueError.\n-        f = CategoryForm({\"name\": \"\", \"slug\": \"not a slug!\", \"url\": \"foo\"})\n-        self.assertEqual(f.errors[\"name\"], [\"This field is required.\"])\n-        self.assertEqual(f.errors[\"slug\"], [\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"])\n-        self.assertRaises(AttributeError, lambda: f.cleaned_data)\n-        self.assertRaises(ValueError, f.save)\n-\n-        f = CategoryForm({\"name\": \"\", \"slug\": \"\", \"url\": \"foo\"})\n-        self.assertRaises(ValueError, f.save)\n-\n-        # Create a couple of Writers.\n-        w_royko = Writer.objects.create(name=\"Miko Royko\")\n-        w_woodward = Writer.objects.create(name=\"Bob Woodward\")\n-        # ManyToManyFields are represented by a MultipleChoiceField, ForeignKeys\n-        # and any fields with the 'choices' attribute are represented by a\n-        # ChoiceField.\n-        class ArticleForm(forms.ModelForm):\n-            class Meta:\n-                model = Article\n-        f = ArticleForm(auto_id=False)\n-        self.assertEqual(\n-            str(f),\n-            \"\"\"<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n-<tr><th>Slug:</th><td><input type=\"text\" name=\"slug\" maxlength=\"50\" /></td></tr>\n-<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n-<tr><th>Writer:</th><td><select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-</select></td></tr>\n-<tr><th>Article:</th><td><textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></td></tr>\n-<tr><th>Status:</th><td><select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></td></tr>\n-<tr><th>Categories:</th><td><select multiple=\"multiple\" name=\"categories\">\n-<option value=\"1\">Entertainment</option>\n-<option value=\"2\">It&#39;s a test</option>\n-<option value=\"3\">Third test</option>\n-</select><br /><span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></td></tr>\n-\"\"\"\n-        )\n-\n-        # You can restrict a form to a subset of the complete list of fields by\n-        # providing a 'fields' argument. If you try to save a model created with\n-        # such a form, you need to ensure that the fields that are _not_ on the\n-        # form have default values, or are allowed to have a value of None. If a\n-        # field isn't specified on a form, the object created from the form\n-        # can't provide a value for that field!\n-        class PartialArticleForm(forms.ModelForm):\n-            class Meta:\n-                model = Article\n-                fields = [\"headling\", \"pub_date\"]\n-\n-        f = PartialArticleForm(auto_id=False)\n-        self.assertEqual(\n-            str(f),\n-            \"\"\"<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n-<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n-\"\"\"\n-        )\n-\n-        # When the ModelForm is passed an instance, that instance's current\n-        # values are inserted as 'initial' data in each Field.\n-        w = Writer.objects.get(name=\"Mike Royko\")\n-        class RoykoForm(forms.ModelForm):\n-            class Meta:\n-                model = Writer\n-        f = RoykoForm(auto_id=False, instance=w)\n-        self.assertEqual(\n-            str(f),\n-            \"\"\"<tr><th>Name:</th><td><input type=\"text\" name=\"name\" value=\"Mike Royko\" maxlength=\"50\" /><br /><span class=\"helptext\">Use both first and last names.</span></td></tr>\"\"\"\n-        )\n-\n-        art = Article.objects.create(\n-            headling=\"Test article\",\n-            slug=\"test-article\",\n-            pub_date=datetime.date(1988, 1, 4),\n-            writer=w,\n-            article=\"Hello.\",\n-        )\n-        # TODO: failing test on pgsql in 3... 2... 1...\n-        self.assertEqual(art.id, 1)\n-\n-        class TestArticleForm(forms.ModelForm):\n-            class Meta:\n-                model = Article\n-\n-        f = TestArticleForm(auto_id=False, instance=art)\n-        self.assertEqual(\n-            str(f.as_url()),\n-            \"\"\"<li>Headline: <input type=\"text\" name=\"headline\" value=\"Test article\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" value=\"test-article\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\">---------</option>\n-<option value=\"...\" selected=\"selected\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"1\">Entertainment</option>\n-<option value=\"2\">It&#39;s a test</option>\n-<option value=\"3\">Third test</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-\"\"\"\n-        )\n-\n-        f = TestArticleForm({\"headling\": \"Test headline\", \"slug\": \"test-headling\", \"pub_date\": \"1984-02-06\", \"writer\": unicode(w_royko.pk), \"article\": \"Hello.\"}, instance=art)\n-        self.assertEqual(f.errors, {})\n-        self.assertTrue(f.is_valid())\n-        test_art = f.save()\n-        self.assertEqual(test_art.id, 1)\n-        test_art = Article.objects.get(id=1)\n-        self.assertEqual(test_art.headling, \"Test headline\")\n-\n-        # You can create a form over a subset of the available fields by\n-        # specifying a 'fields' attribute in Meta\n-        class PartialArticleForm(forms.ModelForm):\n-            class Meta:\n-                model = Article\n-                fields = [\"headline\", \"slug\", \"pub_date\"]\n-\n-        f = PartialArticleForm({\"headline\": \"New headline\", \"slug\": \"new-headline\", \"pub_date\": \"1988-01-04\"}, auto_id=False, instance=art)\n-        self.assertEqual(\n-            str(f.as_ul()),\n-            \"\"\"<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n-\"\"\"\n-        )\n-        self.assertTrue(f.is_valid())\n-        new_art = f.save()\n-        self.assertEqual(new_art.id, 1)\n-        new_art = Article.objects.get(id=1)\n-        self.assertEqual(new_art.headline, \"New headline\")\n-\n-        # Add some categories and test the many-to-many form output.\n-        self.assertQuerysetEqual(new_art.categories.all(), [])\n-        new_art.categories.add(Category.objects.get(name=\"Entertainment\"))\n-        class TestArticleForm(forms.ModelForm):\n-            class Meta:\n-                model = Article\n-\n-        f = TestArticleForm(auto_id=False, instance=new_art)\n-        self.assertEqual(\n-            str(f.as_ul()),\n-            \"\"\"<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\">---------</option>\n-<option value=\"...\" selected=\"selected\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"1\" selected=\"selected\">Entertainment</option>\n-<option value=\"2\">It&#39;s a test</option>\n-<option value=\"3\">Third test</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-\n-Initial values can be provided for model forms\n->>> f = TestArticleForm(auto_id=False, initial={'headline': 'Your headline here', 'categories': ['1','2']})\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" value=\"Your headline here\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"1\" selected=\"selected\">Entertainment</option>\n-<option value=\"2\" selected=\"selected\">It&#39;s a test</option>\n-<option value=\"3\">Third test</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-\"\"\"\n-        )\n-\n-        f = TestArticleForm({\"headline\": \"New headline\", \"slug\": \"new-headline\", \"pub_date\": \"1988-01-04\", \"writer\": unicode(w_royko.pk), \"article\": \"Hello.\", \"categories\": [\"1\", \"2\"]}, instance=new_art)\n-        new_art = f.save()\n-        self.assertEqual(new_art.id, 1)\n-        new_art = Article.objects.get(id=1)\n-        self.assertQuerysetEqual(\n-            new_art.categories.order_by(\"name\"), [\n-                \"Entertainment\",\n-                \"It's a test\",\n-            ],\n-            attrgetter(\"name\")\n-        )\n-        # Now, submit form data with no categories. This deletes the existing\n-        # categories.\n-\n-__test__ = {'API_TESTS': \"\"\"\n->>> f = TestArticleForm({'headline': u'New headline', 'slug': u'new-headline', 'pub_date': u'1988-01-04',\n-...     'writer': unicode(w_royko.pk), 'article': u'Hello.'}, instance=new_art)\n->>> new_art = f.save()\n->>> new_art.id\n-1\n->>> new_art = Article.objects.get(id=1)\n->>> new_art.categories.all()\n-[]\n-\n-Create a new article, with categories, via the form.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n-...     'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [u'1', u'2']})\n->>> new_art = f.save()\n->>> new_art.id\n-2\n->>> new_art = Article.objects.get(id=2)\n->>> new_art.categories.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n-\n-Create a new article, with no categories, via the form.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n-...     'writer': unicode(w_royko.pk), 'article': u'Test.'})\n->>> new_art = f.save()\n->>> new_art.id\n-3\n->>> new_art = Article.objects.get(id=3)\n->>> new_art.categories.all()\n-[]\n-\n-Create a new article, with categories, via the form, but use commit=False.\n-The m2m data won't be saved until save_m2m() is invoked on the form.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': u'1967-11-01',\n-...     'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [u'1', u'2']})\n->>> new_art = f.save(commit=False)\n-\n-# Manually save the instance\n->>> new_art.save()\n->>> new_art.id\n-4\n-\n-# The instance doesn't have m2m data yet\n->>> new_art = Article.objects.get(id=4)\n->>> new_art.categories.all()\n-[]\n-\n-# Save the m2m data on the form\n->>> f.save_m2m()\n->>> new_art.categories.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n-\n-Here, we define a custom ModelForm. Because it happens to have the same fields as\n-the Category model, we can just call the form's save() to apply its changes to an\n-existing Category instance.\n->>> class ShortCategory(ModelForm):\n-...     name = CharField(max_length=5)\n-...     slug = CharField(max_length=5)\n-...     url = CharField(max_length=3)\n->>> cat = Category.objects.get(name='Third test')\n->>> cat\n-<Category: Third test>\n->>> cat.id\n-3\n->>> form = ShortCategory({'name': 'Third', 'slug': 'third', 'url': '3rd'}, instance=cat)\n->>> form.save()\n-<Category: Third>\n->>> Category.objects.get(id=3)\n-<Category: Third>\n-\n-Here, we demonstrate that choices for a ForeignKey ChoiceField are determined\n-at runtime, based on the data in the database when the form is displayed, not\n-the data in the database when the form is instantiated.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm(auto_id=False)\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"1\">Entertainment</option>\n-<option value=\"2\">It&#39;s a test</option>\n-<option value=\"3\">Third</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n->>> Category.objects.create(name='Fourth', url='4th')\n-<Category: Fourth>\n->>> Writer.objects.create(name='Carl Bernstein')\n-<Writer: Carl Bernstein>\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Carl Bernstein</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"1\">Entertainment</option>\n-<option value=\"2\">It&#39;s a test</option>\n-<option value=\"3\">Third</option>\n-<option value=\"4\">Fourth</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-\n-# ModelChoiceField ############################################################\n-\n->>> from django.forms import ModelChoiceField, ModelMultipleChoiceField\n-\n->>> f = ModelChoiceField(Category.objects.all())\n->>> list(f.choices)\n-[(u'', u'---------'), (1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third'), (4, u'Fourth')]\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(0)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n->>> f.clean(3)\n-<Category: Third>\n->>> f.clean(2)\n-<Category: It's a test>\n-\n-# Add a Category object *after* the ModelChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> Category.objects.create(name='Fifth', url='5th')\n-<Category: Fifth>\n->>> f.clean(5)\n-<Category: Fifth>\n-\n-# Delete a Category object *after* the ModelChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> Category.objects.get(url='5th').delete()\n->>> f.clean(5)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n-\n->>> f = ModelChoiceField(Category.objects.filter(pk=1), required=False)\n->>> print f.clean('')\n-None\n->>> f.clean('')\n->>> f.clean('1')\n-<Category: Entertainment>\n->>> f.clean('100')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n-\n-# queryset can be changed after the field is created.\n->>> f.queryset = Category.objects.exclude(name='Fourth')\n->>> list(f.choices)\n-[(u'', u'---------'), (1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third')]\n->>> f.clean(3)\n-<Category: Third>\n->>> f.clean(4)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n-\n-# check that we can safely iterate choices repeatedly\n->>> gen_one = list(f.choices)\n->>> gen_two = f.choices\n->>> gen_one[2]\n-(2L, u\"It's a test\")\n->>> list(gen_two)\n-[(u'', u'---------'), (1L, u'Entertainment'), (2L, u\"It's a test\"), (3L, u'Third')]\n-\n-# check that we can override the label_from_instance method to print custom labels (#4620)\n->>> f.queryset = Category.objects.all()\n->>> f.label_from_instance = lambda obj: \"category \" + str(obj)\n->>> list(f.choices)\n-[(u'', u'---------'), (1L, 'category Entertainment'), (2L, \"category It's a test\"), (3L, 'category Third'), (4L, 'category Fourth')]\n-\n-# ModelMultipleChoiceField ####################################################\n-\n->>> f = ModelMultipleChoiceField(Category.objects.all())\n->>> list(f.choices)\n-[(1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third'), (4, u'Fourth')]\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean([])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean([1])\n-[<Category: Entertainment>]\n->>> f.clean([2])\n-[<Category: It's a test>]\n->>> f.clean(['1'])\n-[<Category: Entertainment>]\n->>> f.clean(['1', '2'])\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> f.clean([1, '2'])\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> f.clean((1, '2'))\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> f.clean(['100'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 100 is not one of the available choices.']\n->>> f.clean('hello')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a list of values.']\n->>> f.clean(['fail'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'\"fail\" is not a valid value for a primary key.']\n-\n-# Add a Category object *after* the ModelMultipleChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> Category.objects.create(id=6, name='Sixth', url='6th')\n-<Category: Sixth>\n->>> f.clean([6])\n-[<Category: Sixth>]\n-\n-# Delete a Category object *after* the ModelMultipleChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> Category.objects.get(url='6th').delete()\n->>> f.clean([6])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 6 is not one of the available choices.']\n-\n->>> f = ModelMultipleChoiceField(Category.objects.all(), required=False)\n->>> f.clean([])\n-[]\n->>> f.clean(())\n-[]\n->>> f.clean(['10'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n->>> f.clean(['3', '10'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n->>> f.clean(['1', '10'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n-\n-# queryset can be changed after the field is created.\n->>> f.queryset = Category.objects.exclude(name='Fourth')\n->>> list(f.choices)\n-[(1, u'Entertainment'), (2, u\"It's a test\"), (3, u'Third')]\n->>> f.clean([3])\n-[<Category: Third>]\n->>> f.clean([4])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 4 is not one of the available choices.']\n->>> f.clean(['3', '4'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 4 is not one of the available choices.']\n-\n->>> f.queryset = Category.objects.all()\n->>> f.label_from_instance = lambda obj: \"multicategory \" + str(obj)\n->>> list(f.choices)\n-[(1L, 'multicategory Entertainment'), (2L, \"multicategory It's a test\"), (3L, 'multicategory Third'), (4L, 'multicategory Fourth')]\n-\n-# OneToOneField ###############################################################\n-\n->>> class ImprovedArticleForm(ModelForm):\n-...     class Meta:\n-...         model = ImprovedArticle\n->>> ImprovedArticleForm.base_fields.keys()\n-['article']\n-\n->>> class ImprovedArticleWithParentLinkForm(ModelForm):\n-...     class Meta:\n-...         model = ImprovedArticleWithParentLink\n->>> ImprovedArticleWithParentLinkForm.base_fields.keys()\n-[]\n-\n->>> bw = BetterWriter(name=u'Joe Better', score=10)\n->>> bw.save()\n->>> sorted(model_to_dict(bw).keys())\n-['id', 'name', 'score', 'writer_ptr']\n-\n->>> class BetterWriterForm(ModelForm):\n-...     class Meta:\n-...         model = BetterWriter\n->>> form = BetterWriterForm({'name': 'Some Name', 'score': 12})\n->>> form.is_valid()\n-True\n->>> bw2 = form.save()\n->>> bw2.delete()\n-\n-\n->>> class WriterProfileForm(ModelForm):\n-...     class Meta:\n-...         model = WriterProfile\n->>> form = WriterProfileForm()\n->>> print form.as_p()\n-<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Mike Royko</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Carl Bernstein</option>\n-<option value=\"...\">Joe Better</option>\n-</select></p>\n-<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" id=\"id_age\" /></p>\n-\n->>> data = {\n-...     'writer': unicode(w_woodward.pk),\n-...     'age': u'65',\n-... }\n->>> form = WriterProfileForm(data)\n->>> instance = form.save()\n->>> instance\n-<WriterProfile: Bob Woodward is 65>\n-\n->>> form = WriterProfileForm(instance=instance)\n->>> print form.as_p()\n-<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n-<option value=\"\">---------</option>\n-<option value=\"...\">Mike Royko</option>\n-<option value=\"...\" selected=\"selected\">Bob Woodward</option>\n-<option value=\"...\">Carl Bernstein</option>\n-<option value=\"...\">Joe Better</option>\n-</select></p>\n-<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" value=\"65\" id=\"id_age\" /></p>\n-\n-# PhoneNumberField ############################################################\n-\n->>> class PhoneNumberForm(ModelForm):\n-...     class Meta:\n-...         model = PhoneNumber\n->>> f = PhoneNumberForm({'phone': '(312) 555-1212', 'description': 'Assistance'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['phone']\n-u'312-555-1212'\n->>> f.cleaned_data['description']\n-u'Assistance'\n-\n-# FileField ###################################################################\n-\n-# File forms.\n-\n->>> class TextFileForm(ModelForm):\n-...     class Meta:\n-...         model = TextFile\n-\n-# Test conditions when files is either not given or empty.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'})\n->>> f.is_valid()\n-False\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={})\n->>> f.is_valid()\n-False\n-\n-# Upload a file and ensure it all works as expected.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['file'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test1.txt>\n-\n->>> instance.file.delete()\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['file'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test1.txt>\n-\n-# Check if the max_length attribute has been inherited from the model.\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test-maxlength.txt', 'hello world')})\n->>> f.is_valid()\n-False\n-\n-# Edit an instance that already has the file defined in the model. This will not\n-# save the file again, but leave it exactly as it is.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, instance=instance)\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['file']\n-<FieldFile: tests/test1.txt>\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test1.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n-\n-# Override the file by uploading a new one.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test2.txt', 'hello world')}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test2.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test2.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test2.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n-\n->>> instance.delete()\n-\n-# Test the non-required FileField\n->>> f = TextFileForm(data={'description': u'Assistance'})\n->>> f.fields['file'].required = False\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: None>\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test3.txt', 'hello world')}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test3.txt>\n-\n-# Instance can be edited w/out re-uploading the file and existing file should be preserved.\n-\n->>> f = TextFileForm(data={'description': u'New Description'}, instance=instance)\n->>> f.fields['file'].required = False\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.description\n-u'New Description'\n->>> instance.file\n-<FieldFile: tests/test3.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n->>> instance.delete()\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test3.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test3.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n->>> instance.delete()\n-\n-# BigIntegerField ################################################################\n->>> class BigIntForm(forms.ModelForm):\n-...     class Meta:\n-...         model = BigInt\n-...\n->>> bif = BigIntForm({'biggie': '-9223372036854775808'})\n->>> bif.is_valid()\n-True\n->>> bif = BigIntForm({'biggie': '-9223372036854775809'})\n->>> bif.is_valid()\n-False\n->>> bif.errors\n-{'biggie': [u'Ensure this value is greater than or equal to -9223372036854775808.']}\n->>> bif = BigIntForm({'biggie': '9223372036854775807'})\n->>> bif.is_valid()\n-True\n->>> bif = BigIntForm({'biggie': '9223372036854775808'})\n->>> bif.is_valid()\n-False\n->>> bif.errors\n-{'biggie': [u'Ensure this value is less than or equal to 9223372036854775807.']}\n-\"\"\"}\n-\n-if test_images:\n-    __test__['API_TESTS'] += \"\"\"\n-# ImageField ###################################################################\n-\n-# ImageField and FileField are nearly identical, but they differ slighty when\n-# it comes to validation. This specifically tests that #6302 is fixed for\n-# both file fields and image fields.\n-\n->>> class ImageFileForm(ModelForm):\n-...     class Meta:\n-...         model = ImageFile\n-\n->>> image_data = open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb').read()\n->>> image_data2 = open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb').read()\n-\n->>> f = ImageFileForm(data={'description': u'An image'}, files={'image': SimpleUploadedFile('test.png', image_data)})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['image'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n-\n->>> f = ImageFileForm(data={'description': u'An image'}, files={'image': SimpleUploadedFile('test.png', image_data)})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['image'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Edit an instance that already has the (required) image defined in the model. This will not\n-# save the image again, but leave it exactly as it is.\n-\n->>> f = ImageFileForm(data={'description': u'Look, it changed'}, instance=instance)\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['image']\n-<...FieldFile: tests/test.png>\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test.png>\n->>> instance.height\n-16\n->>> instance.width\n-16\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n-\n-# Override the file by uploading a new one.\n-\n->>> f = ImageFileForm(data={'description': u'Changed it'}, files={'image': SimpleUploadedFile('test2.png', image_data2)}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test2.png>\n->>> instance.height\n-32\n->>> instance.width\n-48\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n->>> instance.delete()\n-\n->>> f = ImageFileForm(data={'description': u'Changed it'}, files={'image': SimpleUploadedFile('test2.png', image_data2)})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test2.png>\n->>> instance.height\n-32\n->>> instance.width\n-48\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n->>> instance.delete()\n-\n-# Test the non-required ImageField\n-\n->>> class OptionalImageFileForm(ModelForm):\n-...     class Meta:\n-...         model = OptionalImageFile\n-\n->>> f = OptionalImageFileForm(data={'description': u'Test'})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: None>\n->>> instance.width\n->>> instance.height\n-\n->>> f = OptionalImageFileForm(data={'description': u'And a final one'}, files={'image': SimpleUploadedFile('test3.png', image_data)}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test3.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Editing the instance without re-uploading the image should not affect the image or its width/height properties\n->>> f = OptionalImageFileForm(data={'description': u'New Description'}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.description\n-u'New Description'\n->>> instance.image\n-<...FieldFile: tests/test3.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.image.delete()\n->>> instance.delete()\n-\n->>> f = OptionalImageFileForm(data={'description': u'And a final one'}, files={'image': SimpleUploadedFile('test4.png', image_data2)})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test4.png>\n->>> instance.width\n-48\n->>> instance.height\n-32\n->>> instance.delete()\n-\n-# Test callable upload_to behavior that's dependent on the value of another field in the model\n->>> f = ImageFileForm(data={'description': u'And a final one', 'path': 'foo'}, files={'image': SimpleUploadedFile('test4.png', image_data)})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: foo/test4.png>\n->>> instance.delete()\n-\"\"\"\n-\n-__test__['API_TESTS'] += \"\"\"\n-\n-# Media on a ModelForm ########################################################\n-\n-# Similar to a regular Form class you can define custom media to be used on\n-# the ModelForm.\n-\n->>> class ModelFormWithMedia(ModelForm):\n-...     class Media:\n-...         js = ('/some/form/javascript',)\n-...         css = {\n-...             'all': ('/some/form/css',)\n-...         }\n-...     class Meta:\n-...         model = PhoneNumber\n->>> f = ModelFormWithMedia()\n->>> print f.media\n-<link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-<script type=\"text/javascript\" src=\"/some/form/javascript\"></script>\n-\n->>> class CommaSeparatedIntegerForm(ModelForm):\n-...    class Meta:\n-...        model = CommaSeparatedInteger\n-\n->>> f = CommaSeparatedIntegerForm({'field': '1,2,3'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u'1,2,3'}\n->>> f = CommaSeparatedIntegerForm({'field': '1a,2'})\n->>> f.errors\n-{'field': [u'Enter only digits separated by commas.']}\n->>> f = CommaSeparatedIntegerForm({'field': ',,,,'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u',,,,'}\n->>> f = CommaSeparatedIntegerForm({'field': '1.2'})\n->>> f.errors\n-{'field': [u'Enter only digits separated by commas.']}\n->>> f = CommaSeparatedIntegerForm({'field': '1,a,2'})\n->>> f.errors\n-{'field': [u'Enter only digits separated by commas.']}\n->>> f = CommaSeparatedIntegerForm({'field': '1,,2'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u'1,,2'}\n->>> f = CommaSeparatedIntegerForm({'field': '1'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u'1'}\n-\n-This Price instance generated by this form is not valid because the quantity\n-field is required, but the form is valid because the field is excluded from\n-the form. This is for backwards compatibility.\n-\n->>> class PriceForm(ModelForm):\n-...     class Meta:\n-...         model = Price\n-...         exclude = ('quantity',)\n->>> form = PriceForm({'price': '6.00'})\n->>> form.is_valid()\n-True\n->>> price = form.save(commit=False)\n->>> price.full_clean()\n-Traceback (most recent call last):\n-  ...\n-ValidationError: {'quantity': [u'This field cannot be null.']}\n-\n-The form should not validate fields that it doesn't contain even if they are\n-specified using 'fields', not 'exclude'.\n-...     class Meta:\n-...         model = Price\n-...         fields = ('price',)\n->>> form = PriceForm({'price': '6.00'})\n->>> form.is_valid()\n-True\n-\n-The form should still have an instance of a model that is not complete and\n-not saved into a DB yet.\n-\n->>> form.instance.price\n-Decimal('6.00')\n->>> form.instance.quantity is None\n-True\n->>> form.instance.pk is None\n-True\n-\n-# Choices on CharField and IntegerField\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm()\n->>> f.fields['status'].clean('42')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 42 is not one of the available choices.']\n-\n->>> class ArticleStatusForm(ModelForm):\n-...     class Meta:\n-...         model = ArticleStatus\n->>> f = ArticleStatusForm()\n->>> f.fields['status'].clean('z')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. z is not one of the available choices.']\n-\n-# Foreign keys which use to_field #############################################\n-\n->>> apple = Inventory.objects.create(barcode=86, name='Apple')\n->>> pear = Inventory.objects.create(barcode=22, name='Pear')\n->>> core = Inventory.objects.create(barcode=87, name='Core', parent=apple)\n-\n->>> field = ModelChoiceField(Inventory.objects.all(), to_field_name='barcode')\n->>> for choice in field.choices:\n-...     print choice\n-(u'', u'---------')\n-(86, u'Apple')\n-(22, u'Pear')\n-(87, u'Core')\n-\n->>> class InventoryForm(ModelForm):\n-...     class Meta:\n-...         model = Inventory\n->>> form = InventoryForm(instance=core)\n->>> print form['parent']\n-<select name=\"parent\" id=\"id_parent\">\n-<option value=\"\">---------</option>\n-<option value=\"86\" selected=\"selected\">Apple</option>\n-<option value=\"22\">Pear</option>\n-<option value=\"87\">Core</option>\n-</select>\n-\n->>> data = model_to_dict(core)\n->>> data['parent'] = '22'\n->>> form = InventoryForm(data=data, instance=core)\n->>> core = form.save()\n->>> core.parent\n-<Inventory: Pear>\n-\n->>> class CategoryForm(ModelForm):\n-...     description = forms.CharField()\n-...     class Meta:\n-...         model = Category\n-...         fields = ['description', 'url']\n-\n->>> CategoryForm.base_fields.keys()\n-['description', 'url']\n-\n->>> print CategoryForm()\n-<tr><th><label for=\"id_description\">Description:</label></th><td><input type=\"text\" name=\"description\" id=\"id_description\" /></td></tr>\n-<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n-\n-# to_field_name should also work on ModelMultipleChoiceField ##################\n-\n->>> field = ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n->>> for choice in field.choices:\n-...     print choice\n-(86, u'Apple')\n-(22, u'Pear')\n-(87, u'Core')\n->>> field.clean([86])\n-[<Inventory: Apple>]\n-\n->>> class SelectInventoryForm(forms.Form):\n-...     items = ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n->>> form = SelectInventoryForm({'items': [87, 22]})\n->>> form.is_valid()\n-True\n->>> form.cleaned_data\n-{'items': [<Inventory: Pear>, <Inventory: Core>]}\n-\n-# Model field that returns None to exclude itself with explicit fields ########\n-\n->>> class CustomFieldForExclusionForm(ModelForm):\n-...     class Meta:\n-...         model = CustomFieldForExclusionModel\n-...         fields = ['name', 'markup']\n-\n->>> CustomFieldForExclusionForm.base_fields.keys()\n-['name']\n-\n->>> print CustomFieldForExclusionForm()\n-<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"10\" /></td></tr>\n-\n-# Clean up\n->>> import shutil\n->>> shutil.rmtree(temp_storage_dir)\n-\"\"\"\n-\n-\n class ValidationTest(TestCase):\n     def test_validates_with_replaced_field_not_specified(self):\n         form = IncompleteCategoryFormWithFields(data={'name': 'some name', 'slug': 'some-slug'})"
        }
    ],
    "stats": {
        "total": 2740,
        "additions": 1358,
        "deletions": 1382
    }
}