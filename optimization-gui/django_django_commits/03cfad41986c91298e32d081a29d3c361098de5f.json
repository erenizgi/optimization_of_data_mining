{
    "author": "aaugustin",
    "message": "Upgraded django.contrib.auth to be compatible with time zone support.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17122 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "03cfad41986c91298e32d081a29d3c361098de5f",
    "files": [
        {
            "sha": "c82ba12b8aeb132d2fdb0d46e399df40904320cb",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/03cfad41986c91298e32d081a29d3c361098de5f/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/03cfad41986c91298e32d081a29d3c361098de5f/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=03cfad41986c91298e32d081a29d3c361098de5f",
            "patch": "@@ -1,4 +1,3 @@\n-import datetime\n import urllib\n \n from django.core.exceptions import ImproperlyConfigured\n@@ -7,6 +6,7 @@\n from django.db.models.manager import EmptyManager\n from django.utils.encoding import smart_str\n from django.utils.translation import ugettext_lazy as _\n+from django.utils import timezone\n \n from django.contrib import auth\n from django.contrib.auth.signals import user_logged_in\n@@ -21,7 +21,7 @@ def update_last_login(sender, user, **kwargs):\n     A signal receiver which updates the last_login date for\n     the user logging in.\n     \"\"\"\n-    user.last_login = datetime.datetime.now()\n+    user.last_login = timezone.now()\n     user.save()\n user_logged_in.connect(update_last_login)\n \n@@ -91,7 +91,7 @@ def create_user(self, username, email=None, password=None):\n         \"\"\"\n         Creates and saves a User with the given username, email and password.\n         \"\"\"\n-        now = datetime.datetime.now()\n+        now = timezone.now()\n \n         # Normalize the address by lowercasing the domain part of the email\n         # address.\n@@ -181,8 +181,8 @@ class User(models.Model):\n     is_staff = models.BooleanField(_('staff status'), default=False, help_text=_(\"Designates whether the user can log into this admin site.\"))\n     is_active = models.BooleanField(_('active'), default=True, help_text=_(\"Designates whether this user should be treated as active. Unselect this instead of deleting accounts.\"))\n     is_superuser = models.BooleanField(_('superuser status'), default=False, help_text=_(\"Designates that this user has all permissions without explicitly assigning them.\"))\n-    last_login = models.DateTimeField(_('last login'), default=datetime.datetime.now)\n-    date_joined = models.DateTimeField(_('date joined'), default=datetime.datetime.now)\n+    last_login = models.DateTimeField(_('last login'), default=timezone.now)\n+    date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n     groups = models.ManyToManyField(Group, verbose_name=_('groups'), blank=True,\n         help_text=_(\"In addition to the permissions manually assigned, this user will also get all permissions granted to each group he/she is in.\"))\n     user_permissions = models.ManyToManyField(Permission, verbose_name=_('user permissions'), blank=True)"
        },
        {
            "sha": "fa324781d2740d8d20d0e572fa589139da841cec",
            "filename": "django/contrib/auth/tests/remote_user.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/03cfad41986c91298e32d081a29d3c361098de5f/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "raw_url": "https://github.com/django/django/raw/03cfad41986c91298e32d081a29d3c361098de5f/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py?ref=03cfad41986c91298e32d081a29d3c361098de5f",
            "patch": "@@ -4,6 +4,7 @@\n from django.contrib.auth.backends import RemoteUserBackend\n from django.contrib.auth.models import User\n from django.test import TestCase\n+from django.utils import timezone\n \n \n class RemoteUserTest(TestCase):\n@@ -80,6 +81,8 @@ def test_last_login(self):\n         user = User.objects.create(username='knownuser')\n         # Set last_login to something so we can determine if it changes.\n         default_login = datetime(2000, 1, 1)\n+        if settings.USE_TZ:\n+            default_login = default_login.replace(tzinfo=timezone.utc)\n         user.last_login = default_login\n         user.save()\n "
        }
    ],
    "stats": {
        "total": 13,
        "additions": 8,
        "deletions": 5
    }
}