{
    "author": "spookylukey",
    "message": "Fixed #14261 - Added clickjacking protection (X-Frame-Options header)\n\nMany thanks to rniemeyer for the patch!\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16298 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "524c5fa07a38cc68a81a12428befdafcfde1afc3",
    "files": [
        {
            "sha": "8b6f6544cdb5c07b494762c2a02684d3c2d5050b",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -534,6 +534,7 @@ answer newbie questions, and generally made Django that much better:\n     Jarek Zgoda <jarek.zgoda@gmail.com>\n     Cheng Zhang\n     Zlatko Ma≈°ek <zlatko.masek@gmail.com>\n+    Ryan Niemeyer <https://profiles.google.com/ryan.niemeyer/about>\n \n A big THANK YOU goes to:\n "
        },
        {
            "sha": "288dc9a1d9d416e473099941a6d65fca6f14da02",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -406,6 +406,9 @@\n DEFAULT_TABLESPACE = ''\n DEFAULT_INDEX_TABLESPACE = ''\n \n+# Default X-Frame-Options header value\n+X_FRAME_OPTIONS = 'SAMEORIGIN'\n+\n ##############\n # MIDDLEWARE #\n ##############"
        },
        {
            "sha": "e719dec5db1e556e1c88b9a461baab939d8a81c0",
            "filename": "django/conf/project_template/settings.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fconf%2Fproject_template%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fconf%2Fproject_template%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fsettings.py?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -98,6 +98,8 @@\n     'django.middleware.csrf.CsrfViewMiddleware',\n     'django.contrib.auth.middleware.AuthenticationMiddleware',\n     'django.contrib.messages.middleware.MessageMiddleware',\n+    # Uncomment the next line for simple clickjacking protection:\n+    # 'django.middleware.clickjacking.XFrameOptionsMiddleware',\n )\n \n ROOT_URLCONF = '{{ project_name }}.urls'"
        },
        {
            "sha": "81763ef41f1bdd163514c11f89c54b1201ec5a4e",
            "filename": "django/middleware/clickjacking.py",
            "status": "added",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fmiddleware%2Fclickjacking.py",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fmiddleware%2Fclickjacking.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fclickjacking.py?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -0,0 +1,51 @@\n+\"\"\"\n+Clickjacking Protection Middleware.\n+\n+This module provides a middleware that implements protection against a\n+malicious site loading resources from your site in a hidden frame.\n+\"\"\"\n+\n+from django.conf import settings\n+\n+class XFrameOptionsMiddleware(object):\n+    \"\"\"\n+    Middleware that sets the X-Frame-Options HTTP header in HTTP responses.\n+\n+    Does not set the header if it's already set or if the response contains\n+    a xframe_options_exempt value set to True.\n+\n+    By default, sets the X-Frame-Options header to 'SAMEORIGIN', meaning the\n+    response can only be loaded on a frame within the same site. To prevent the\n+    response from being loaded in a frame in any site, set X_FRAME_OPTIONS in\n+    your project's Django settings to 'DENY'.\n+\n+    Note: older browsers will quietly ignore this header, thus other\n+    clickjacking protection techniques should be used if protection in those\n+    browsers is required.\n+\n+    http://en.wikipedia.org/wiki/Clickjacking#Server_and_client\n+    \"\"\"\n+    def process_response(self, request, response):\n+        # Don't set it if it's already in the response\n+        if response.get('X-Frame-Options', None) is not None:\n+            return response\n+\n+        # Don't set it if they used @xframe_options_exempt\n+        if getattr(response, 'xframe_options_exempt', False):\n+            return response\n+\n+        response['X-Frame-Options'] = self.get_xframe_options_value(request,\n+                                                                    response)\n+        return response\n+\n+    def get_xframe_options_value(self, request, response):\n+        \"\"\"\n+        Gets the value to set for the X_FRAME_OPTIONS header.\n+\n+        By default this uses the value from the X_FRAME_OPTIONS Django\n+        settings. If not found in settings, defaults to 'SAMEORIGIN'.\n+\n+        This method can be overridden if needed, allowing it to vary based on\n+        the request or response.\n+        \"\"\"\n+        return getattr(settings, 'X_FRAME_OPTIONS', 'SAMEORIGIN').upper()"
        },
        {
            "sha": "fcd78871ddb4e34521b6b3335d89d5680d6f57af",
            "filename": "django/views/decorators/clickjacking.py",
            "status": "added",
            "additions": 64,
            "deletions": 0,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fviews%2Fdecorators%2Fclickjacking.py",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/django%2Fviews%2Fdecorators%2Fclickjacking.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fclickjacking.py?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -0,0 +1,64 @@\n+from functools import wraps\n+\n+from django.utils.decorators import available_attrs\n+\n+\n+def xframe_options_deny(view_func):\n+    \"\"\"\n+    Modifies a view function so its response has the X-Frame-Options HTTP\n+    header set to 'DENY' as long as the response doesn't already have that\n+    header set.\n+\n+    e.g.\n+\n+    @xframe_options_deny\n+    def some_view(request):\n+        ...\n+\n+    \"\"\"\n+    def wrapped_view(*args, **kwargs):\n+        resp = view_func(*args, **kwargs)\n+        if resp.get('X-Frame-Options', None) is None:\n+            resp['X-Frame-Options'] = 'DENY'\n+        return resp\n+    return wraps(view_func, assigned=available_attrs(view_func))(wrapped_view)\n+\n+\n+def xframe_options_sameorigin(view_func):\n+    \"\"\"\n+    Modifies a view function so its response has the X-Frame-Options HTTP\n+    header set to 'SAMEORIGIN' as long as the response doesn't already have\n+    that header set.\n+\n+    e.g.\n+\n+    @xframe_options_sameorigin\n+    def some_view(request):\n+        ...\n+\n+    \"\"\"\n+    def wrapped_view(*args, **kwargs):\n+        resp = view_func(*args, **kwargs)\n+        if resp.get('X-Frame-Options', None) is None:\n+            resp['X-Frame-Options'] = 'SAMEORIGIN'\n+        return resp\n+    return wraps(view_func, assigned=available_attrs(view_func))(wrapped_view)\n+\n+\n+def xframe_options_exempt(view_func):\n+    \"\"\"\n+    Modifies a view function by setting a response variable that instructs\n+    XFrameOptionsMiddleware to NOT set the X-Frame-Options HTTP header.\n+\n+    e.g.\n+\n+    @xframe_options_exempt\n+    def some_view(request):\n+        ...\n+\n+    \"\"\"\n+    def wrapped_view(*args, **kwargs):\n+        resp = view_func(*args, **kwargs)\n+        resp.xframe_options_exempt = True\n+        return resp\n+    return wraps(view_func, assigned=available_attrs(view_func))(wrapped_view)"
        },
        {
            "sha": "0896806da1a1be57c97b22cd52098c59ee5fa788",
            "filename": "docs/index.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Findex.txt?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -167,8 +167,9 @@ Other batteries included\n     * :doc:`Admin site <ref/contrib/admin/index>` | :doc:`Admin actions <ref/contrib/admin/actions>` | :doc:`Admin documentation generator<ref/contrib/admin/admindocs>`\n     * :doc:`Authentication <topics/auth>`\n     * :doc:`Cache system <topics/cache>`\n-    * :doc:`Conditional content processing <topics/conditional-view-processing>`\n+    * :doc:`Clickjacking protection <ref/clickjacking>`\n     * :doc:`Comments <ref/contrib/comments/index>` | :doc:`Moderation <ref/contrib/comments/moderation>` | :doc:`Custom comments <ref/contrib/comments/custom>`\n+    * :doc:`Conditional content processing <topics/conditional-view-processing>`\n     * :doc:`Content types <ref/contrib/contenttypes>`\n     * :doc:`Cross Site Request Forgery protection <ref/contrib/csrf>`\n     * :doc:`Cryptographic signing <topics/signing>`"
        },
        {
            "sha": "234fab2fa8763a56982710bfdb3e92aacf325c04",
            "filename": "docs/ref/clickjacking.txt",
            "status": "added",
            "additions": 126,
            "deletions": 0,
            "changes": 126,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Fclickjacking.txt",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Fclickjacking.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclickjacking.txt?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -0,0 +1,126 @@\n+========================\n+Clickjacking Protection\n+========================\n+\n+.. module:: django.middleware.clickjacking\n+   :synopsis: Protects against Clickjacking\n+\n+The clickjacking middleware and decorators provide easy-to-use protection\n+against `clickjacking`_.  This type of attack occurs when a malicious site\n+tricks a user into clicking on a concealed element of another site which they\n+have loaded in a hidden frame or iframe.\n+\n+.. versionadded:: 1.4\n+   The clickjacking middleware and decorators were added.\n+\n+.. _clickjacking: http://en.wikipedia.org/wiki/Clickjacking\n+\n+An example of clickjacking\n+==========================\n+\n+Suppose an online store has a page where a logged in user can click \"Buy Now\" to\n+purchase an item. A user has chosen to stay logged into the store all the time\n+for convenience. An attacker site might create an \"I Like Ponies\" button on one\n+of their own pages, and load the store's page in a transparent iframe such that\n+the \"Buy Now\" button is invisibly overlaid on the \"I Like Ponies\" button. If the\n+user visits the attacker site and clicks \"I Like Ponies\" he will inadvertently\n+click on the online store's \"Buy Now\" button and unknowningly purchase the item.\n+\n+Preventing clickjacking\n+=======================\n+\n+Modern browsers honor the `X-Frame-Options`_ HTTP header that indicates whether\n+or not a resource is allowed to load within a frame or iframe. If the response\n+contains the header with a value of SAMEORIGIN then the browser will only load\n+the resource in a frame if the request originated from the same site. If the\n+header is set to DENY then the browser will block the resource from loading in a\n+frame no matter which site made the request.\n+\n+.. _X-Frame-Options: https://developer.mozilla.org/en/The_X-FRAME-OPTIONS_response_header\n+\n+Django provides a few simple ways to include this header in responses from your\n+site:\n+\n+1. A simple middleware that sets the header in all responses.\n+\n+2. A set of view decorators that can be used to override the middleware or to\n+   only set the header for certain views.\n+\n+How to use it\n+=============\n+\n+Setting X-Frame-Options for all responses\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+To set the same X-Frame-Options value for all responses in your site, add\n+``'django.middleware.clickjacking.XFrameOptionsMiddleware'`` to\n+:setting:`MIDDLEWARE_CLASSES`::\n+\n+    MIDDLEWARE_CLASSES = (\n+        ...\n+        'django.middleware.clickjacking.XFrameOptionsMiddleware',\n+        ...\n+    )\n+\n+By default, the middleware will set the X-Frame-Options header to SAMEORIGIN for\n+every outgoing ``HttpResponse``. If you want DENY instead, set the\n+:setting:`X_FRAME_OPTIONS` setting::\n+\n+    X_FRAME_OPTIONS = 'DENY'\n+\n+When using the middleware there may be some views where you do **not** want the\n+X-Frame-Options header set. For those cases, you can use a view decorator that\n+tells the middleware to not set the header::\n+\n+    from django.http import HttpResponse\n+    from django.views.decorators.clickjacking import xframe_options_exempt\n+\n+    @xframe_options_exempt\n+    def ok_to_load_in_a_frame(request):\n+        return HttpResponse(\"This page is safe to load in a frame on any site.\")\n+\n+\n+Setting X-Frame-Options per view\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+To set the X-Frame-Options header on a per view basis, Django provides these\n+decorators::\n+\n+    from django.http import HttpResponse\n+    from django.views.decorators.clickjacking import xframe_options_deny\n+    from django.views.decorators.clickjacking import xframe_options_sameorigin\n+\n+    @xframe_options_deny\n+    def view_one(request):\n+        return HttpResponse(\"I won't display in any frame!\")\n+\n+    @xframe_options_sameorigin\n+    def view_two(request):\n+        return HttpResponse(\"Display in a frame if it's from the same origin as me.\")\n+\n+Note that you can use the decorators in conjunction with the middleware. Use of\n+a decorator overrides the middleware.\n+\n+Limitations\n+===========\n+\n+The `X-Frame-Options` header will only protect against clickjacking in a modern\n+browser. Older browsers will quietly ignore the header and need `other\n+clickjacking prevention techniques`_.\n+\n+Browsers that support X-Frame-Options\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+* Internet Explorer 8+\n+* Firefox\t3.6.9+\n+* Opera\t10.5+\n+* Safari\t4+\n+* Chrome\t4.1+\n+\n+See also\n+~~~~~~~~\n+\n+A `complete list`_ of browsers supporting X-Frame-Options.\n+\n+.. _complete list: https://developer.mozilla.org/en/The_X-FRAME-OPTIONS_response_header#Browser_compatibility\n+.. _other clickjacking prevention techniques: http://en.wikipedia.org/wiki/Clickjacking#Prevention"
        },
        {
            "sha": "db09afe4ac636c5cc950d5a818cae94723b2765b",
            "filename": "docs/ref/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Findex.txt?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -6,6 +6,7 @@ API Reference\n    :maxdepth: 1\n \n    authbackends\n+   clickjacking\n    contrib/index\n    databases\n    django-admin"
        },
        {
            "sha": "7bb70986efd99514cfc0c83d6e8836f45ca0ad80",
            "filename": "docs/ref/middleware.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Fmiddleware.txt",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Fmiddleware.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmiddleware.txt?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -204,3 +204,16 @@ Middleware modules running inside it (coming later in the stack) will be under\n the same transaction control as the view functions.\n \n See the :doc:`transaction management documentation </topics/db/transactions>`.\n+\n+X-Frame-Options middleware\n+--------------------------\n+\n+.. module:: django.middleware.clickjacking\n+   :synopsis: Clickjacking protection\n+\n+.. class:: XFrameOptionsMiddleware\n+\n+.. versionadded:: 1.4\n+   ``XFrameOptionsMiddleware`` was added.\n+\n+Simple :doc:`clickjacking protection via the X-Frame-Options header </ref/clickjacking/>`."
        },
        {
            "sha": "816c3e92ff188177ba88ceb726a9fb3f168e8d2f",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -2023,6 +2023,17 @@ See :tfilter:`allowed date format strings <date>`. See also\n :setting:`DATE_FORMAT`, :setting:`DATETIME_FORMAT`, :setting:`TIME_FORMAT`\n and :setting:`MONTH_DAY_FORMAT`.\n \n+.. setting:: X_FRAME_OPTIONS\n+\n+X_FRAME_OPTIONS\n+---------------\n+\n+Default: ``'SAMEORIGIN'``\n+\n+The default value for the X-Frame-Options header used by\n+:class:`~django.middleware.clickjacking.XFrameOptionsMiddleware`. See the\n+:doc:`clickjacking protection </ref/clickjacking/>` documentation.\n+\n Deprecated settings\n ===================\n "
        },
        {
            "sha": "8742103a36d781631d6792e9461606223f099610",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -55,6 +55,15 @@ signing in Web applications.\n \n See :doc:`cryptographic signing </topics/signing>` docs for more information.\n \n+Simple clickjacking protection\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+We've added a middleware to provide easy protection against `clickjacking\n+<http://en.wikipedia.org/wiki/Clickjacking>`_ using the X-Frame-Options\n+header. It's not enabled by default for backwards compatibility reasons, but\n+you'll almost certainly want to :doc:`enable it </ref/clickjacking/>` to help\n+plug that security hole for browsers that support the header.\n+\n ``reverse_lazy``\n ~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "8a03980f88bd6546fe4bc3b7885bf640b1d0aa64",
            "filename": "tests/regressiontests/decorators/tests.py",
            "status": "modified",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdecorators%2Ftests.py?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -9,6 +9,8 @@\n from django.views.decorators.http import require_http_methods, require_GET, require_POST, require_safe\n from django.views.decorators.vary import vary_on_headers, vary_on_cookie\n from django.views.decorators.cache import cache_page, never_cache, cache_control\n+from django.views.decorators.clickjacking import xframe_options_deny, xframe_options_sameorigin, xframe_options_exempt\n+from django.middleware.clickjacking import XFrameOptionsMiddleware\n \n \n def fully_decorated(request):\n@@ -216,3 +218,47 @@ def method(self):\n \n         self.assertEqual(Test.method.__doc__, 'A method')\n         self.assertEqual(Test.method.im_func.__name__, 'method')\n+\n+\n+class XFrameOptionsDecoratorsTests(TestCase):\n+    \"\"\"\n+    Tests for the X-Frame-Options decorators.\n+    \"\"\"\n+    def test_deny_decorator(self):\n+        \"\"\"\n+        Ensures @xframe_options_deny properly sets the X-Frame-Options header.\n+        \"\"\"\n+        @xframe_options_deny\n+        def a_view(request):\n+            return HttpResponse()\n+        r = a_view(HttpRequest())\n+        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+\n+    def test_sameorigin_decorator(self):\n+        \"\"\"\n+        Ensures @xframe_options_sameorigin properly sets the X-Frame-Options\n+        header.\n+        \"\"\"\n+        @xframe_options_sameorigin\n+        def a_view(request):\n+            return HttpResponse()\n+        r = a_view(HttpRequest())\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+    def test_exempt_decorator(self):\n+        \"\"\"\n+        Ensures @xframe_options_exempt properly instructs the\n+        XFrameOptionsMiddleware to NOT set the header.\n+        \"\"\"\n+        @xframe_options_exempt\n+        def a_view(request):\n+            return HttpResponse()\n+        req = HttpRequest()\n+        resp = a_view(req)\n+        self.assertEqual(resp.get('X-Frame-Options', None), None)\n+        self.assertTrue(resp.xframe_options_exempt)\n+\n+        # Since the real purpose of the exempt decorator is to suppress\n+        # the middleware's functionality, let's make sure it actually works...\n+        r = XFrameOptionsMiddleware().process_response(req, resp)\n+        self.assertEqual(r.get('X-Frame-Options', None), None)"
        },
        {
            "sha": "124eb191f09ea3b9de4e2af4be7073b9c435c244",
            "filename": "tests/regressiontests/middleware/tests.py",
            "status": "modified",
            "additions": 124,
            "deletions": 0,
            "changes": 124,
            "blob_url": "https://github.com/django/django/blob/524c5fa07a38cc68a81a12428befdafcfde1afc3/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/524c5fa07a38cc68a81a12428befdafcfde1afc3/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmiddleware%2Ftests.py?ref=524c5fa07a38cc68a81a12428befdafcfde1afc3",
            "patch": "@@ -5,6 +5,8 @@\n from django.conf import settings\n from django.core import mail\n from django.http import HttpRequest\n+from django.http import HttpResponse\n+from django.middleware.clickjacking import XFrameOptionsMiddleware\n from django.middleware.common import CommonMiddleware\n from django.middleware.http import ConditionalGetMiddleware\n from django.test import TestCase\n@@ -371,3 +373,125 @@ def test_if_modified_since_and_last_modified_in_the_future(self):\n         self.resp['Last-Modified'] = 'Sat, 12 Feb 2011 17:41:44 GMT'\n         self.resp = ConditionalGetMiddleware().process_response(self.req, self.resp)\n         self.assertEqual(self.resp.status_code, 200)\n+\n+\n+class XFrameOptionsMiddlewareTest(TestCase):\n+    \"\"\"\n+    Tests for the X-Frame-Options clickjacking prevention middleware.\n+    \"\"\"\n+    def setUp(self):\n+        self.x_frame_options = settings.X_FRAME_OPTIONS\n+\n+    def tearDown(self):\n+        settings.X_FRAME_OPTIONS = self.x_frame_options\n+\n+    def test_same_origin(self):\n+        \"\"\"\n+        Tests that the X_FRAME_OPTIONS setting can be set to SAMEORIGIN to\n+        have the middleware use that value for the HTTP header.\n+        \"\"\"\n+        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+        settings.X_FRAME_OPTIONS = 'sameorigin'\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+    def test_deny(self):\n+        \"\"\"\n+        Tests that the X_FRAME_OPTIONS setting can be set to DENY to\n+        have the middleware use that value for the HTTP header.\n+        \"\"\"\n+        settings.X_FRAME_OPTIONS = 'DENY'\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+\n+        settings.X_FRAME_OPTIONS = 'deny'\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+\n+    def test_defaults_sameorigin(self):\n+        \"\"\"\n+        Tests that if the X_FRAME_OPTIONS setting is not set then it defaults\n+        to SAMEORIGIN.\n+        \"\"\"\n+        del settings.X_FRAME_OPTIONS\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+    def test_dont_set_if_set(self):\n+        \"\"\"\n+        Tests that if the X-Frame-Options header is already set then the\n+        middleware does not attempt to override it.\n+        \"\"\"\n+        settings.X_FRAME_OPTIONS = 'DENY'\n+        response = HttpResponse()\n+        response['X-Frame-Options'] = 'SAMEORIGIN'\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       response)\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n+        response = HttpResponse()\n+        response['X-Frame-Options'] = 'DENY'\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       response)\n+        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+\n+    def test_response_exempt(self):\n+        \"\"\"\n+        Tests that if the response has a xframe_options_exempt attribute set\n+        to False then it still sets the header, but if it's set to True then\n+        it does not.\n+        \"\"\"\n+        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n+        response = HttpResponse()\n+        response.xframe_options_exempt = False\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       response)\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+        response = HttpResponse()\n+        response.xframe_options_exempt = True\n+        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       response)\n+        self.assertEqual(r.get('X-Frame-Options', None), None)\n+\n+    def test_is_extendable(self):\n+        \"\"\"\n+        Tests that the XFrameOptionsMiddleware method that determines the\n+        X-Frame-Options header value can be overridden based on something in\n+        the request or response.\n+        \"\"\"\n+        class OtherXFrameOptionsMiddleware(XFrameOptionsMiddleware):\n+            # This is just an example for testing purposes...\n+            def get_xframe_options_value(self, request, response):\n+                if getattr(request, 'sameorigin', False):\n+                    return 'SAMEORIGIN'\n+                if getattr(response, 'sameorigin', False):\n+                    return 'SAMEORIGIN'\n+                return 'DENY'\n+\n+        settings.X_FRAME_OPTIONS = 'DENY'\n+        response = HttpResponse()\n+        response.sameorigin = True\n+        r = OtherXFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                            response)\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+        request = HttpRequest()\n+        request.sameorigin = True\n+        r = OtherXFrameOptionsMiddleware().process_response(request,\n+                                                            HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n+        r = OtherXFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                       HttpResponse())\n+        self.assertEqual(r['X-Frame-Options'], 'DENY')"
        }
    ],
    "stats": {
        "total": 454,
        "additions": 453,
        "deletions": 1
    }
}