{
    "author": "jphalip",
    "message": "Fixed #16903 -- Added `--no-location` option to the `makemessages` command to not write '#: filename:line' comment lines in language files. Thanks to alpar for the suggestion and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17081 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1",
    "files": [
        {
            "sha": "a903c3c211e45b43649c52b9f521037632590133",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 16,
            "deletions": 11,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1",
            "patch": "@@ -115,6 +115,7 @@ def copy_plural_forms(msgs, locale, domain, verbosity):\n \n def make_messages(locale=None, domain='django', verbosity='1', all=False,\n         extensions=None, symlinks=False, ignore_patterns=[], no_wrap=False,\n+        no_location=False,\n         no_obsolete=False):\n     \"\"\"\n     Uses the locale directory from the Django SVN tree or an application/\n@@ -163,6 +164,7 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n         languages = [os.path.basename(l) for l in locale_dirs]\n \n     wrap = no_wrap and '--no-wrap' or ''\n+    location = no_location and '--no-location' or ''\n \n     for locale in languages:\n         if verbosity > 0:\n@@ -191,11 +193,11 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                 finally:\n                     f.close()\n                 cmd = (\n-                    'xgettext -d %s -L C %s --keyword=gettext_noop '\n+                    'xgettext -d %s -L C %s %s --keyword=gettext_noop '\n                     '--keyword=gettext_lazy --keyword=ngettext_lazy:1,2 '\n                     '--keyword=pgettext:1c,2 --keyword=npgettext:1c,2,3 '\n                     '--from-code UTF-8 --add-comments=Translators -o - \"%s\"' % (\n-                        domain, wrap, os.path.join(dirpath, thefile)\n+                        domain, wrap, location, os.path.join(dirpath, thefile)\n                     )\n                 )\n                 msgs, errors = _popen(cmd)\n@@ -235,14 +237,14 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                 if verbosity > 1:\n                     sys.stdout.write('processing file %s in %s\\n' % (file, dirpath))\n                 cmd = (\n-                    'xgettext -d %s -L Python %s --keyword=gettext_noop '\n+                    'xgettext -d %s -L Python %s %s --keyword=gettext_noop '\n                     '--keyword=gettext_lazy --keyword=ngettext_lazy:1,2 '\n                     '--keyword=ugettext_noop --keyword=ugettext_lazy '\n                     '--keyword=ungettext_lazy:1,2 --keyword=pgettext:1c,2 '\n                     '--keyword=npgettext:1c,2,3 --keyword=pgettext_lazy:1c,2 '\n                     '--keyword=npgettext_lazy:1c,2,3 --from-code UTF-8 '\n                     '--add-comments=Translators -o - \"%s\"' % (\n-                        domain, wrap, os.path.join(dirpath, thefile))\n+                        domain, wrap, location, os.path.join(dirpath, thefile))\n                 )\n                 msgs, errors = _popen(cmd)\n                 if errors:\n@@ -272,8 +274,8 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                     os.unlink(os.path.join(dirpath, thefile))\n \n         if os.path.exists(potfile):\n-            msgs, errors = _popen('msguniq %s --to-code=utf-8 \"%s\"' %\n-                                  (wrap, potfile))\n+            msgs, errors = _popen('msguniq %s %s --to-code=utf-8 \"%s\"' %\n+                                  (wrap, location, potfile))\n             if errors:\n                 os.unlink(potfile)\n                 raise CommandError(\n@@ -284,8 +286,8 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                     f.write(msgs)\n                 finally:\n                     f.close()\n-                msgs, errors = _popen('msgmerge %s -q \"%s\" \"%s\"' %\n-                                      (wrap, pofile, potfile))\n+                msgs, errors = _popen('msgmerge %s %s -q \"%s\" \"%s\"' %\n+                                      (wrap, location, pofile, potfile))\n                 if errors:\n                     os.unlink(potfile)\n                     raise CommandError(\n@@ -301,8 +303,8 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                 f.close()\n             os.unlink(potfile)\n             if no_obsolete:\n-                msgs, errors = _popen('msgattrib %s -o \"%s\" --no-obsolete \"%s\"' %\n-                                      (wrap, pofile, pofile))\n+                msgs, errors = _popen('msgattrib %s %s -o \"%s\" --no-obsolete \"%s\"' %\n+                                      (wrap, location, pofile, pofile))\n                 if errors:\n                     raise CommandError(\n                         \"errors happened while running msgattrib\\n%s\" % errors)\n@@ -327,6 +329,8 @@ class Command(NoArgsCommand):\n             default=True, help=\"Don't ignore the common glob-style patterns 'CVS', '.*' and '*~'.\"),\n         make_option('--no-wrap', action='store_true', dest='no_wrap',\n             default=False, help=\"Don't break long message lines into several lines\"),\n+        make_option('--no-location', action='store_true', dest='no_location',\n+            default=False, help=\"Don't write '#: filename:line' lines\"),\n         make_option('--no-obsolete', action='store_true', dest='no_obsolete',\n             default=False, help=\"Remove obsolete message strings\"),\n     )\n@@ -351,6 +355,7 @@ def handle_noargs(self, *args, **options):\n             ignore_patterns += ['CVS', '.*', '*~']\n         ignore_patterns = list(set(ignore_patterns))\n         no_wrap = options.get('no_wrap')\n+        no_location = options.get('no_location')\n         no_obsolete = options.get('no_obsolete')\n         if domain == 'djangojs':\n             extensions = handle_extensions(extensions or ['js'])\n@@ -361,4 +366,4 @@ def handle_noargs(self, *args, **options):\n             sys.stdout.write('examining files with the extensions: %s\\n'\n                              % get_text_list(list(extensions), 'and'))\n \n-        make_messages(locale, domain, verbosity, process_all, extensions, symlinks, ignore_patterns, no_wrap, no_obsolete)\n+        make_messages(locale, domain, verbosity, process_all, extensions, symlinks, ignore_patterns, no_wrap, no_location, no_obsolete)"
        },
        {
            "sha": "24fa0d7b3456a6d0e85d4d888468713d6a5d8c68",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1",
            "patch": "@@ -475,6 +475,14 @@ Use the ``--no-default-ignore`` option to disable the default values of\n Use the ``--no-wrap`` option to disable breaking long message lines into\n several lines in language files.\n \n+.. django-admin-option:: --no-location\n+\n+.. versionadded:: 1.4\n+\n+Use the ``--no-location`` option to not write '``#: filename:line``'\n+comment lines in language files. Note that using this option makes it harder\n+for technically skilled translators to understand each message's context.\n+\n reset <appname appname ...>\n ---------------------------\n "
        },
        {
            "sha": "eff5a99ebfe7b923e0af9243423f90388cd9100f",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1",
            "patch": "@@ -477,6 +477,9 @@ Django 1.4 also includes several smaller improvements worth noting:\n   This should make it easier to read when debugging interaction with\n   client-side Javascript code.\n \n+* Added the :djadminopt:`--no-location` option to the :djadmin:`makemessages`\n+  command.\n+\n .. _backwards-incompatible-changes-1.4:\n \n Backwards incompatible changes in 1.4"
        },
        {
            "sha": "fb612a3a4235dfee60e25514bd1217f563edb603",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1",
            "patch": "@@ -214,3 +214,20 @@ def test_no_wrap_disabled(self):\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         po_contents = open(self.PO_FILE, 'r').read()\n         self.assertMsgId('\"\"\\n\"This literal should also be included wrapped or not wrapped depending on the \"\\n\"use of the --no-wrap option.\"', po_contents, use_quotes=False)\n+\n+\n+class NoLocationExtractorTests(ExtractorTests):\n+\n+    def test_no_location_enabled(self):\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0, no_location=True)\n+        self.assertTrue(os.path.exists(self.PO_FILE))\n+        po_contents = open(self.PO_FILE, 'r').read()\n+        self.assertFalse('#: templates/test.html:55' in po_contents)\n+\n+    def test_no_location_disabled(self):\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0, no_location=False)\n+        self.assertTrue(os.path.exists(self.PO_FILE))\n+        po_contents = open(self.PO_FILE, 'r').read()\n+        self.assertTrue('#: templates/test.html:55' in po_contents)"
        },
        {
            "sha": "cefb6b1819fd8649b9a05f872038c7dda001a83a",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=c3df840c20cc17ceb8fdcafb4215a6f3fb87fed1",
            "patch": "@@ -28,7 +28,8 @@\n if can_run_extraction_tests:\n     from .commands.extraction import (ExtractorTests, BasicExtractorTests,\n         JavascriptExtractorTests, IgnoredExtractorTests, SymlinkExtractorTests,\n-        CopyPluralFormsExtractorTests, NoWrapExtractorTests)\n+        CopyPluralFormsExtractorTests, NoWrapExtractorTests,\n+        NoLocationExtractorTests)\n if can_run_compilation_tests:\n     from .commands.compilation import MessageCompilationTests, PoFileTests\n from .contenttypes.tests import ContentTypeTests"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 46,
        "deletions": 12
    }
}