{
    "author": "claudep",
    "message": "Made get_table_description also return the size of char fields on SQLite",
    "sha": "a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb",
    "files": [
        {
            "sha": "5d30382ddfc9e07a30cdb1b322052018dbd5aa03",
            "filename": "django/db/backends/postgresql_psycopg2/introspection.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py?ref=a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb",
            "patch": "@@ -45,8 +45,8 @@ def get_table_description(self, cursor, table_name):\n             WHERE table_name = %s\"\"\", [table_name])\n         null_map = dict(cursor.fetchall())\n         cursor.execute(\"SELECT * FROM %s LIMIT 1\" % self.connection.ops.quote_name(table_name))\n-        return [tuple([item for item in line[:6]] + [null_map[line[0]]=='YES'])\n-            for line in cursor.description]\n+        return [line[:6] + (null_map[line[0]]=='YES',)\n+                for line in cursor.description]\n \n     def get_relations(self, cursor, table_name):\n         \"\"\""
        },
        {
            "sha": "1df4c18c1c541a55c9861aa80dcb602129e58e0e",
            "filename": "django/db/backends/sqlite3/introspection.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb/django%2Fdb%2Fbackends%2Fsqlite3%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb/django%2Fdb%2Fbackends%2Fsqlite3%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fintrospection.py?ref=a9a773ff38a9fd28085e8b62b8a160c4e2ea5efb",
            "patch": "@@ -1,6 +1,14 @@\n import re\n from django.db.backends import BaseDatabaseIntrospection\n \n+field_size_re = re.compile(r'^\\s*(?:var)?char\\s*\\(\\s*(\\d+)\\s*\\)\\s*$')\n+\n+def get_field_size(name):\n+    \"\"\" Extract the size number from a \"varchar(11)\" type name \"\"\"\n+    m = field_size_re.search(name)\n+    return int(m.group(1)) if m else None\n+\n+\n # This light wrapper \"fakes\" a dictionary interface, because some SQLite data\n # types include variables in them -- e.g. \"varchar(30)\" -- and can't be matched\n # as a simple dictionary lookup.\n@@ -32,10 +40,9 @@ def __getitem__(self, key):\n         try:\n             return self.base_data_types_reverse[key]\n         except KeyError:\n-            import re\n-            m = re.search(r'^\\s*(?:var)?char\\s*\\(\\s*(\\d+)\\s*\\)\\s*$', key)\n-            if m:\n-                return ('CharField', {'max_length': int(m.group(1))})\n+            size = get_field_size(key)\n+            if size is not None:\n+                return ('CharField', {'max_length': size})\n             raise KeyError\n \n class DatabaseIntrospection(BaseDatabaseIntrospection):\n@@ -53,7 +60,7 @@ def get_table_list(self, cursor):\n \n     def get_table_description(self, cursor, table_name):\n         \"Returns a description of the table, with the DB-API cursor.description interface.\"\n-        return [(info['name'], info['type'], None, None, None, None,\n+        return [(info['name'], info['type'], None, info['size'], None, None,\n                  info['null_ok']) for info in self._table_info(cursor, table_name)]\n \n     def get_relations(self, cursor, table_name):\n@@ -171,6 +178,7 @@ def _table_info(self, cursor, name):\n         # cid, name, type, notnull, dflt_value, pk\n         return [{'name': field[1],\n                  'type': field[2],\n+                 'size': get_field_size(field[2]),\n                  'null_ok': not field[3],\n                  'pk': field[5]     # undocumented\n                  } for field in cursor.fetchall()]"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 15,
        "deletions": 7
    }
}