{
    "author": "jezdez",
    "message": "Fixed #13969 -- Extended length of salt used when setting the password. Thanks to cyounkins for the initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16453 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "650739ef172049a294f53bf51b70f6bb2d3f5dd5",
    "files": [
        {
            "sha": "01c2e43697e0b5df54f5be709452ffc70be3ab59",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 29,
            "deletions": 8,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/650739ef172049a294f53bf51b70f6bb2d3f5dd5/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/650739ef172049a294f53bf51b70f6bb2d3f5dd5/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=650739ef172049a294f53bf51b70f6bb2d3f5dd5",
            "patch": "@@ -1,10 +1,12 @@\n import datetime\n import hashlib\n+import random\n import urllib\n \n from django.contrib import auth\n from django.contrib.auth.signals import user_logged_in\n from django.core.exceptions import ImproperlyConfigured\n+from django.core.mail import send_mail\n from django.db import models\n from django.db.models.manager import EmptyManager\n from django.contrib.contenttypes.models import ContentType\n@@ -34,6 +36,21 @@ def get_hexdigest(algorithm, salt, raw_password):\n         return hashlib.sha1(salt + raw_password).hexdigest()\n     raise ValueError(\"Got unknown password algorithm type in password.\")\n \n+def get_random_string(length=12, allowed_chars='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'):\n+    \"\"\"\n+    Returns a random string of length characters from the set of a-z, A-Z, 0-9\n+    for use as a salt.\n+\n+    The default length of 12 with the a-z, A-Z, 0-9 character set returns\n+    a 71-bit salt. log_2((26+26+10)^12) =~ 71 bits\n+    \"\"\"\n+    import random\n+    try:\n+        random = random.SystemRandom()\n+    except NotImplementedError:\n+        pass\n+    return ''.join([random.choice(allowed_chars) for i in range(length)])\n+\n def check_password(raw_password, enc_password):\n     \"\"\"\n     Returns a boolean of whether the raw_password was correct. Handles\n@@ -145,11 +162,13 @@ def create_superuser(self, username, email, password):\n         return u\n \n     def make_random_password(self, length=10, allowed_chars='abcdefghjkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789'):\n-        \"Generates a random password with the given length and given allowed_chars\"\n+        \"\"\"\n+        Generates a random password with the given length\n+        and given allowed_chars\n+        \"\"\"\n         # Note that default value of allowed_chars does not have \"I\" or letters\n         # that look like it -- just to avoid confusion.\n-        from random import choice\n-        return ''.join([choice(allowed_chars) for i in range(length)])\n+        return get_random_string(length, allowed_chars)\n \n \n # A few helper functions for common logic between User and AnonymousUser.\n@@ -244,17 +263,18 @@ def is_authenticated(self):\n         return True\n \n     def get_full_name(self):\n-        \"Returns the first_name plus the last_name, with a space in between.\"\n+        \"\"\"\n+        Returns the first_name plus the last_name, with a space in between.\n+        \"\"\"\n         full_name = u'%s %s' % (self.first_name, self.last_name)\n         return full_name.strip()\n \n     def set_password(self, raw_password):\n         if raw_password is None:\n             self.set_unusable_password()\n         else:\n-            import random\n             algo = 'sha1'\n-            salt = get_hexdigest(algo, str(random.random()), str(random.random()))[:5]\n+            salt = get_random_string()\n             hsh = get_hexdigest(algo, salt, raw_password)\n             self.password = '%s$%s$%s' % (algo, salt, hsh)\n \n@@ -346,8 +366,9 @@ def has_module_perms(self, app_label):\n         return _user_has_module_perms(self, app_label)\n \n     def email_user(self, subject, message, from_email=None):\n-        \"Sends an email to this User.\"\n-        from django.core.mail import send_mail\n+        \"\"\"\n+        Sends an email to this User.\n+        \"\"\"\n         send_mail(subject, message, from_email, [self.email])\n \n     def get_profile(self):"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 29,
        "deletions": 8
    }
}