{
    "author": "claudep",
    "message": "Fixed getting default encoding in get_system_username\n\nRefs #19933.",
    "sha": "8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986",
    "files": [
        {
            "sha": "685e50d498d9034f701e9173c0f612c97b317eb4",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986",
            "patch": "@@ -12,6 +12,7 @@\n from django.core.management.base import CommandError\n from django.db import DEFAULT_DB_ALIAS, router\n from django.db.models import get_models, signals\n+from django.utils.encoding import DEFAULT_LOCALE_ENCODING\n from django.utils import six\n from django.utils.six.moves import input\n \n@@ -133,11 +134,8 @@ def get_system_username():\n         # (a very restricted chroot environment, for example).\n         return ''\n     if not six.PY3:\n-        default_locale = locale.getdefaultlocale()[1]\n-        if not default_locale:\n-            return ''\n         try:\n-            result = result.decode(default_locale)\n+            result = result.decode(DEFAULT_LOCALE_ENCODING)\n         except UnicodeDecodeError:\n             # UnicodeDecodeError - preventive treatment for non-latin Windows.\n             return ''"
        },
        {
            "sha": "efc4eccaf960715a2a36554b1a81290439ecac0c",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 14,
            "deletions": 8,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=8e8c9b908a0fe0d2437fcf3f0378eb2a62b81986",
            "patch": "@@ -236,11 +236,17 @@ def filepath_to_uri(path):\n     # some flexibility for hardcoding separators.\n     return quote(force_bytes(path.replace(\"\\\\\", \"/\")), safe=b\"/~!*()'\")\n \n-# The encoding of the default system locale but falls back to the\n-# given fallback encoding if the encoding is unsupported by python or could\n-# not be determined.  See tickets #10335 and #5846\n-try:\n-    DEFAULT_LOCALE_ENCODING = locale.getdefaultlocale()[1] or 'ascii'\n-    codecs.lookup(DEFAULT_LOCALE_ENCODING)\n-except:\n-    DEFAULT_LOCALE_ENCODING = 'ascii'\n+def get_system_encoding():\n+    \"\"\"\n+    The encoding of the default system locale but falls back to the given\n+    fallback encoding if the encoding is unsupported by python or could\n+    not be determined.  See tickets #10335 and #5846\n+    \"\"\"\n+    try:\n+        encoding = locale.getdefaultlocale()[1] or 'ascii'\n+        codecs.lookup(encoding)\n+    except Exception:\n+        encoding = 'ascii'\n+    return encoding\n+\n+DEFAULT_LOCALE_ENCODING = get_system_encoding()"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 16,
        "deletions": 12
    }
}