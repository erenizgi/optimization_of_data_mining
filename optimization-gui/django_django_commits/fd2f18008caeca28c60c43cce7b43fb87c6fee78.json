{
    "author": "jacobian",
    "message": "Fixed #14733: no longer \"validate\" .raw() queries.\n\nTurns out that a lot more than just SELECT can return data, and this list is\nvery hard to define up front in a cross-database manner. So let's just assume\nthat anyone using raw() is at least halfway competant and can deal with\nthe error messages if they don't use a data-returning query.\n\nThanks to Christophe Pettus for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15803 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "fd2f18008caeca28c60c43cce7b43fb87c6fee78",
    "files": [
        {
            "sha": "ea89771ed1b64e786c8eef14b9757c5fcddbf238",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/fd2f18008caeca28c60c43cce7b43fb87c6fee78/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/fd2f18008caeca28c60c43cce7b43fb87c6fee78/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=fd2f18008caeca28c60c43cce7b43fb87c6fee78",
            "patch": "@@ -31,7 +31,6 @@ class RawQuery(object):\n     \"\"\"\n \n     def __init__(self, sql, using, params=None):\n-        self.validate_sql(sql)\n         self.params = params or ()\n         self.sql = sql\n         self.using = using\n@@ -62,11 +61,6 @@ def get_columns(self):\n         return [converter(column_meta[0])\n                 for column_meta in self.cursor.description]\n \n-    def validate_sql(self, sql):\n-        if not sql.lower().strip().startswith('select'):\n-            raise InvalidQuery('Raw queries are limited to SELECT queries. Use '\n-                               'connection.cursor directly for other types of queries.')\n-\n     def __iter__(self):\n         # Always execute a new query for a new iterator.\n         # This could be optimized with a cache at the expense of RAM."
        },
        {
            "sha": "e5f6c21a533c320a9e418c478a8c8ddb54c9ae6b",
            "filename": "docs/topics/db/sql.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/fd2f18008caeca28c60c43cce7b43fb87c6fee78/docs%2Ftopics%2Fdb%2Fsql.txt",
            "raw_url": "https://github.com/django/django/raw/fd2f18008caeca28c60c43cce7b43fb87c6fee78/docs%2Ftopics%2Fdb%2Fsql.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fsql.txt?ref=fd2f18008caeca28c60c43cce7b43fb87c6fee78",
            "patch": "@@ -42,6 +42,10 @@ You could then execute custom SQL like so::\n     John Smith\n     Jane Jones\n \n+Of course, this example isn't very exciting -- it's exactly the same as\n+running ``Person.objects.all()``. However, ``raw()`` has a bunch of other\n+options that make it very powerful.\n+\n .. admonition:: Model table names\n \n     Where'd the name of the ``Person`` table come from in that example?\n@@ -56,9 +60,12 @@ You could then execute custom SQL like so::\n     :attr:`~Options.db_table` option, which also lets you manually set the\n     database table name.\n \n-Of course, this example isn't very exciting -- it's exactly the same as\n-running ``Person.objects.all()``. However, ``raw()`` has a bunch of other\n-options that make it very powerful.\n+.. warning::\n+\n+    No checking is done on the SQL statement that is passed in to ``.raw()``.\n+    Django expects that the statement will return a set of rows from the\n+    database, but does nothing to enforce that. If the query does not\n+    return rows, a (possibly cryptic) error will result.\n \n Mapping query fields to model fields\n ------------------------------------"
        },
        {
            "sha": "aa6aec10b1a4947ccbfa69b3a18228b131f8e73a",
            "filename": "tests/modeltests/raw_query/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/fd2f18008caeca28c60c43cce7b43fb87c6fee78/tests%2Fmodeltests%2Fraw_query%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fd2f18008caeca28c60c43cce7b43fb87c6fee78/tests%2Fmodeltests%2Fraw_query%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fraw_query%2Ftests.py?ref=fd2f18008caeca28c60c43cce7b43fb87c6fee78",
            "patch": "@@ -169,10 +169,6 @@ def testAnnotations(self):\n         authors = Author.objects.all()\n         self.assertSuccessfulRawQuery(Author, query, authors, expected_annotations)\n \n-    def testInvalidQuery(self):\n-        query = \"UPDATE raw_query_author SET first_name='thing' WHERE first_name='Joe'\"\n-        self.assertRaises(InvalidQuery, Author.objects.raw, query)\n-\n     def testWhiteSpaceQuery(self):\n         query = \"    SELECT * FROM raw_query_author\"\n         authors = Author.objects.all()"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 10,
        "deletions": 13
    }
}