{
    "author": "jezdez",
    "message": "Fixed #15010 -- Added current_app parameter to close gap between TemplateResponse and render method. Thanks, acdha.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15153 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a3894945b647c3e07acdd35af1104739a93938a2",
    "files": [
        {
            "sha": "ffcc34d5dd23c1c1764d99cb30a8a2d43a1ef5ca",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -33,6 +33,7 @@ people who have submitted patches, reported bugs, added translations, helped\n answer newbie questions, and generally made Django that much better:\n \n     Gisle Aas <gisle@aas.no>\n+    Chris Adams\n     ajs <adi@sieker.info>\n     alang@bright-green.com\n     A S Alam <aalam@users.sf.net>"
        },
        {
            "sha": "9f97cae95541cf86649c93c14305b0d0974fd03b",
            "filename": "django/shortcuts/__init__.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/django%2Fshortcuts%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/django%2Fshortcuts%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fshortcuts%2F__init__.py?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -29,7 +29,18 @@ def render(request, *args, **kwargs):\n         'content_type': kwargs.pop('content_type', None),\n         'status': kwargs.pop('status', None),\n     }\n-    kwargs['context_instance'] = kwargs.get('context_instance', RequestContext(request))\n+\n+    if 'context_instance' in kwargs:\n+        context_instance = kwargs.pop('context_instance')\n+        if kwargs.get('current_app', None):\n+            raise ValueError('If you provide a context_instance you must '\n+                             'set its current_app before calling render()')\n+    else:\n+        current_app = kwargs.pop('current_app', None)\n+        context_instance = RequestContext(request, current_app=current_app)\n+\n+    kwargs['context_instance'] = context_instance\n+\n     return HttpResponse(loader.render_to_string(*args, **kwargs),\n                         **httpresponse_kwargs)\n "
        },
        {
            "sha": "629461aa5e94813f87a3456bfd83ed39746999d2",
            "filename": "django/template/response.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/django%2Ftemplate%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/django%2Ftemplate%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fresponse.py?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -90,11 +90,14 @@ def _set_content(self, value):\n \n class TemplateResponse(SimpleTemplateResponse):\n     def __init__(self, request, template, context=None, mimetype=None,\n-            status=None, content_type=None):\n+            status=None, content_type=None, current_app=None):\n         # self.request gets over-written by django.test.client.Client - and\n         # unlike context_data and template_name the _request should not\n         # be considered part of the public API.\n         self._request = request\n+        # As a convenience we'll allow callers to provide current_app without\n+        # having to avoid needing to create the RequestContext directly\n+        self._current_app = current_app\n         super(TemplateResponse, self).__init__(\n             template, context, mimetype, status, content_type)\n \n@@ -105,4 +108,4 @@ def resolve_context(self, context):\n         if isinstance(context, Context):\n             return context\n         else:\n-            return RequestContext(self._request, context)\n+            return RequestContext(self._request, context, current_app=self._current_app)"
        },
        {
            "sha": "d4fe2c4ef2c8da4f6eff8e9cecefabe2c70b6681",
            "filename": "docs/ref/template-response.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/docs%2Fref%2Ftemplate-response.txt",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/docs%2Fref%2Ftemplate-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplate-response.txt?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -129,7 +129,7 @@ TemplateResponse objects\n Methods\n -------\n \n-.. method:: TemplateResponse.__init__(request, template, context=None, mimetype=None, status=None, content_type=None)\n+.. method:: TemplateResponse.__init__(request, template, context=None, mimetype=None, status=None, content_type=None, current_app=None)\n \n     Instantiates an ``TemplateResponse`` object with the given\n     template, context, MIME type and HTTP status.\n@@ -158,6 +158,11 @@ Methods\n         ``content_type`` is used. If neither is given,\n         :setting:`DEFAULT_CONTENT_TYPE` is used.\n \n+    ``current_app``\n+        A hint indicating which application contains the current view. See the\n+        :ref:`namespaced URL resolution strategy <topics-http-reversing-url-namespaces>`\n+        for more information.\n+\n \n The rendering process\n ====================="
        },
        {
            "sha": "9d72521c0f8abd5899a3d66a0f2d346f7f24c91c",
            "filename": "docs/topics/http/shortcuts.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/docs%2Ftopics%2Fhttp%2Fshortcuts.txt",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/docs%2Ftopics%2Fhttp%2Fshortcuts.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fshortcuts.txt?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -15,15 +15,15 @@ introduce controlled coupling for convenience's sake.\n ``render``\n ==========\n \n-.. function:: render(request, template[, dictionary][, context_instance][, content_type][, status])\n+.. function:: render(request, template[, dictionary][, context_instance][, content_type][, status][, current_app])\n \n    .. versionadded:: 1.3\n \n    Combines a given template with a given context dictionary and returns an\n    :class:`~django.http.HttpResponse` object with that rendered text.\n \n    :func:`render()` is the same as a call to\n-   :func:`render_to_response()` with a context_instance argument that\n+   :func:`render_to_response()` with a `context_instance` argument that\n    that forces the use of a :class:`RequestContext`.\n \n Required arguments\n@@ -55,6 +55,11 @@ Optional arguments\n ``status``\n     The status code for the response. Defaults to ``200``.\n \n+``current_app``\n+    A hint indicating which application contains the current view. See the\n+    :ref:`namespaced URL resolution strategy <topics-http-reversing-url-namespaces>`\n+    for more information.\n+\n Example\n -------\n "
        },
        {
            "sha": "2f0d2c78224286c287d374b9705a896e6fc5ae84",
            "filename": "tests/regressiontests/templates/response.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Ftemplates%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Ftemplates%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Fresponse.py?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -172,3 +172,10 @@ def test_args(self):\n                                     'application/json', 504)\n         self.assertEqual(response['content-type'], 'application/json')\n         self.assertEqual(response.status_code, 504)\n+\n+    def test_custom_app(self):\n+        response = self._response('{{ foo }}', current_app=\"foobar\")\n+\n+        rc = response.resolve_context(response.context_data)\n+\n+        self.assertEqual(rc.current_app, 'foobar')"
        },
        {
            "sha": "c5f664e80693df783cee920ff0dd2935c8b991c0",
            "filename": "tests/regressiontests/views/tests/shortcuts.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Fviews%2Ftests%2Fshortcuts.py",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Fviews%2Ftests%2Fshortcuts.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fshortcuts.py?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -38,6 +38,7 @@ def test_render(self):\n         self.assertEquals(response.status_code, 200)\n         self.assertEquals(response.content, 'FOO.BAR../path/to/static/media\\n')\n         self.assertEquals(response['Content-Type'], 'text/html; charset=utf-8')\n+        self.assertEquals(response.context.current_app, None)\n \n     def test_render_with_base_context(self):\n         response = self.client.get('/views/shortcuts/render/base_context/')\n@@ -56,3 +57,10 @@ def test_render_with_status(self):\n         self.assertEquals(response.status_code, 403)\n         self.assertEquals(response.content, 'FOO.BAR../path/to/static/media\\n')\n \n+    def test_render_with_current_app(self):\n+        response = self.client.get('/views/shortcuts/render/current_app/')\n+        self.assertEquals(response.context.current_app, \"foobar_app\")\n+\n+    def test_render_with_current_app_conflict(self):\n+        self.assertRaises(ValueError, self.client.get, '/views/shortcuts/render/current_app_conflict/')\n+"
        },
        {
            "sha": "a170efb1fc3d052de08e63d5dd48df0df0d914b0",
            "filename": "tests/regressiontests/views/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Fviews%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Fviews%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Furls.py?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -151,7 +151,8 @@\n     (r'^shortcuts/render/base_context/$', 'render_view_with_base_context'),\n     (r'^shortcuts/render/content_type/$', 'render_view_with_content_type'),\n     (r'^shortcuts/render/status/$', 'render_view_with_status'),\n-\n+    (r'^shortcuts/render/current_app/$', 'render_view_with_current_app'),\n+    (r'^shortcuts/render/current_app_conflict/$', 'render_view_with_current_app_conflict'),\n )\n \n # simple generic views."
        },
        {
            "sha": "e4e7c3d4e4edb0ec7d39b1d8dfffa6bd298eab6b",
            "filename": "tests/regressiontests/views/views.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/a3894945b647c3e07acdd35af1104739a93938a2/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fviews.py?ref=a3894945b647c3e07acdd35af1104739a93938a2",
            "patch": "@@ -101,3 +101,17 @@ def render_view_with_status(request):\n         'foo': 'FOO',\n         'bar': 'BAR',\n     }, status=403)\n+\n+def render_view_with_current_app(request):\n+    return render(request, 'debug/render_test.html', {\n+        'foo': 'FOO',\n+        'bar': 'BAR',\n+    }, current_app=\"foobar_app\")\n+\n+def render_view_with_current_app_conflict(request):\n+    # This should fail because we don't passing both a current_app and\n+    # context_instance:\n+    return render(request, 'debug/render_test.html', {\n+        'foo': 'FOO',\n+        'bar': 'BAR',\n+    }, current_app=\"foobar_app\", context_instance=RequestContext(request))"
        }
    ],
    "stats": {
        "total": 69,
        "additions": 62,
        "deletions": 7
    }
}