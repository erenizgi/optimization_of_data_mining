{
    "author": "jezdez",
    "message": "Fixed #17042 -- Extended startproject and startapp management commands to better handle custom app and project templates. Many thanks to Preston Holmes for his initial patch and Alex Gaynor, Carl Meyer, Donald Stufft, Jacob Kaplan-Moss and Julien Phalip for code reviewing.\n\n* Added ability to pass the project or app directory path as the second argument\n* Added ``--template`` option for specifying custom project and app templates\n* Cleaned up admin_scripts tests a little while I was there\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17246 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
    "files": [
        {
            "sha": "a5a25b95c97d7fdb2e321fae774afff403ef306b",
            "filename": "django/conf/project_template/project_name/settings.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -81,7 +81,7 @@\n )\n \n # Make this unique, and don't share it with anybody.\n-SECRET_KEY = ''\n+SECRET_KEY = '{{ secret_key }}'\n \n # List of callables that know how to import templates from various sources.\n TEMPLATE_LOADERS = ("
        },
        {
            "sha": "367263955c212853b517cd0efa8dc0331cc101c5",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -77,9 +77,7 @@ def get_commands():\n     in that package are registered.\n \n     Core commands are always included. If a settings module has been\n-    specified, user-defined commands will also be included, the\n-    startproject command will be disabled, and the startapp command\n-    will be modified to use the directory in which the settings module appears.\n+    specified, user-defined commands will also be included.\n \n     The dictionary is in the format {command_name: app_name}. Key-value\n     pairs from this dictionary can then be used in calls to"
        },
        {
            "sha": "db855e12941abc0eb4d2ee3f7e7d4e669e635ecd",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 9,
            "deletions": 73,
            "changes": 82,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -3,9 +3,10 @@\n be executed through ``django-admin.py`` or ``manage.py``).\n \n \"\"\"\n-\n+from __future__ import with_statement\n import os\n import sys\n+\n from optparse import make_option, OptionParser\n import traceback\n \n@@ -14,6 +15,7 @@\n from django.core.management.color import color_style\n from django.utils.encoding import smart_str\n \n+\n class CommandError(Exception):\n     \"\"\"\n     Exception class indicating a problem while executing a management\n@@ -29,6 +31,7 @@ class CommandError(Exception):\n     \"\"\"\n     pass\n \n+\n def handle_default_options(options):\n     \"\"\"\n     Include any default options that all commands should accept here\n@@ -41,6 +44,7 @@ def handle_default_options(options):\n     if options.pythonpath:\n         sys.path.insert(0, options.pythonpath)\n \n+\n class BaseCommand(object):\n     \"\"\"\n     The base class from which all management commands ultimately\n@@ -134,7 +138,7 @@ class BaseCommand(object):\n     # Configuration shortcuts that alter various logic.\n     can_import_settings = True\n     requires_model_validation = True\n-    output_transaction = False # Whether to wrap the output in a \"BEGIN; COMMIT;\"\n+    output_transaction = False  # Whether to wrap the output in a \"BEGIN; COMMIT;\"\n \n     def __init__(self):\n         self.style = color_style()\n@@ -275,6 +279,7 @@ def handle(self, *args, **options):\n         \"\"\"\n         raise NotImplementedError()\n \n+\n class AppCommand(BaseCommand):\n     \"\"\"\n     A management command which takes one or more installed application\n@@ -310,6 +315,7 @@ def handle_app(self, app, **options):\n         \"\"\"\n         raise NotImplementedError()\n \n+\n class LabelCommand(BaseCommand):\n     \"\"\"\n     A management command which takes one or more arbitrary arguments\n@@ -345,6 +351,7 @@ def handle_label(self, label, **options):\n         \"\"\"\n         raise NotImplementedError()\n \n+\n class NoArgsCommand(BaseCommand):\n     \"\"\"\n     A command which takes no arguments on the command line.\n@@ -369,74 +376,3 @@ def handle_noargs(self, **options):\n \n         \"\"\"\n         raise NotImplementedError()\n-\n-def copy_helper(style, app_or_project, name, directory):\n-    \"\"\"\n-    Copies either a Django application layout template or a Django project\n-    layout template into the specified directory.\n-\n-    \"\"\"\n-    # style -- A color style object (see django.core.management.color).\n-    # app_or_project -- The string 'app' or 'project'.\n-    # name -- The name of the application or project.\n-    # directory -- The directory to which the layout template should be copied.\n-    import re\n-    import shutil\n-\n-    if not re.search(r'^[_a-zA-Z]\\w*$', name): # If it's not a valid directory name.\n-        # Provide a smart error message, depending on the error.\n-        if not re.search(r'^[_a-zA-Z]', name):\n-            message = 'make sure the name begins with a letter or underscore'\n-        else:\n-            message = 'use only numbers, letters and underscores'\n-        raise CommandError(\"%r is not a valid %s name. Please %s.\" % (name, app_or_project, message))\n-    top_dir = os.path.join(directory, name)\n-    try:\n-        os.mkdir(top_dir)\n-    except OSError, e:\n-        raise CommandError(e)\n-\n-    # Determine where the app or project templates are. Use\n-    # django.__path__[0] because we don't know into which directory\n-    # django has been installed.\n-    template_dir = os.path.join(django.__path__[0], 'conf', '%s_template' % app_or_project)\n-\n-    for d, subdirs, files in os.walk(template_dir):\n-        relative_dir = d[len(template_dir)+1:].replace('%s_name' % app_or_project, name)\n-        if relative_dir:\n-            os.mkdir(os.path.join(top_dir, relative_dir))\n-        for subdir in subdirs[:]:\n-            if subdir.startswith('.'):\n-                subdirs.remove(subdir)\n-        for f in files:\n-            if not f.endswith('.py'):\n-                # Ignore .pyc, .pyo, .py.class etc, as they cause various\n-                # breakages.\n-                continue\n-            path_old = os.path.join(d, f)\n-            path_new = os.path.join(top_dir, relative_dir, f.replace('%s_name' % app_or_project, name))\n-            fp_old = open(path_old, 'r')\n-            fp_new = open(path_new, 'w')\n-            fp_new.write(fp_old.read().replace('{{ %s_name }}' % app_or_project, name))\n-            fp_old.close()\n-            fp_new.close()\n-            try:\n-                shutil.copymode(path_old, path_new)\n-                _make_writeable(path_new)\n-            except OSError:\n-                sys.stderr.write(style.NOTICE(\"Notice: Couldn't set permission bits on %s. You're probably using an uncommon filesystem setup. No problem.\\n\" % path_new))\n-\n-def _make_writeable(filename):\n-    \"\"\"\n-    Make sure that the file is writeable. Useful if our source is\n-    read-only.\n-\n-    \"\"\"\n-    import stat\n-    if sys.platform.startswith('java'):\n-        # On Jython there is no os.access()\n-        return\n-    if not os.access(filename, os.W_OK):\n-        st = os.stat(filename)\n-        new_permissions = stat.S_IMODE(st.st_mode) | stat.S_IWUSR\n-        os.chmod(filename, new_permissions)"
        },
        {
            "sha": "7cd2a9ad0f5d75ab930a0ebb8a1a87e6d935d655",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -13,7 +13,7 @@\n \n plural_forms_re = re.compile(r'^(?P<value>\"Plural-Forms.+?\\\\n\")\\s*$', re.MULTILINE | re.DOTALL)\n \n-def handle_extensions(extensions=('html',)):\n+def handle_extensions(extensions=('html',), ignored=('py',)):\n     \"\"\"\n     Organizes multiple extensions that are separated with commas or passed by\n     using --extension/-e multiple times. Note that the .py extension is ignored\n@@ -31,11 +31,11 @@ def handle_extensions(extensions=('html',)):\n     \"\"\"\n     ext_list = []\n     for ext in extensions:\n-        ext_list.extend(ext.replace(' ','').split(','))\n+        ext_list.extend(ext.replace(' ', '').split(','))\n     for i, ext in enumerate(ext_list):\n         if not ext.startswith('.'):\n             ext_list[i] = '.%s' % ext_list[i]\n-    return set([x for x in ext_list if x != '.py'])\n+    return set([x for x in ext_list if x.strip('.') not in ignored])\n \n def _popen(cmd):\n     \"\"\""
        },
        {
            "sha": "5581331b7b39a60782233a2c7137efe0b273ec56",
            "filename": "django/core/management/commands/startapp.py",
            "status": "modified",
            "additions": 13,
            "deletions": 16,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fcommands%2Fstartapp.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fcommands%2Fstartapp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fstartapp.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -1,28 +1,25 @@\n-import os\n-\n-from django.core.management.base import copy_helper, CommandError, LabelCommand\n+from django.core.management.base import CommandError\n+from django.core.management.templates import TemplateCommand\n from django.utils.importlib import import_module\n \n-class Command(LabelCommand):\n-    help = \"Creates a Django app directory structure for the given app name in the current directory.\"\n-    args = \"[appname]\"\n-    label = 'application name'\n \n-    requires_model_validation = False\n-    # Can't import settings during this command, because they haven't\n-    # necessarily been created.\n-    can_import_settings = False\n+class Command(TemplateCommand):\n+    help = (\"Creates a Django app directory structure for the given app \"\n+            \"name in the current directory or optionally in the given \"\n+            \"directory.\")\n \n-    def handle_label(self, app_name, directory=None, **options):\n-        if directory is None:\n-            directory = os.getcwd()\n+    def handle(self, app_name=None, target=None, **options):\n+        if app_name is None:\n+            raise CommandError(\"you must provide an app name\")\n \n         # Check that the app_name cannot be imported.\n         try:\n             import_module(app_name)\n         except ImportError:\n             pass\n         else:\n-            raise CommandError(\"%r conflicts with the name of an existing Python module and cannot be used as an app name. Please try another name.\" % app_name)\n+            raise CommandError(\"%r conflicts with the name of an existing \"\n+                               \"Python module and cannot be used as an app \"\n+                               \"name. Please try another name.\" % app_name)\n \n-        copy_helper(self.style, 'app', app_name, directory)\n+        super(Command, self).handle('app', app_name, target, **options)"
        },
        {
            "sha": "c849ab69c37f4036d16058ff6c35dbc8b1e07185",
            "filename": "django/core/management/commands/startproject.py",
            "status": "modified",
            "additions": 19,
            "deletions": 24,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -1,37 +1,32 @@\n-from django.core.management.base import copy_helper, CommandError, LabelCommand\n-from django.utils.importlib import import_module\n-import os\n-import re\n from random import choice\n \n-class Command(LabelCommand):\n-    help = \"Creates a Django project directory structure for the given project name in the current directory.\"\n-    args = \"[projectname]\"\n-    label = 'project name'\n+from django.core.management.base import CommandError\n+from django.core.management.templates import TemplateCommand\n+from django.utils.importlib import import_module\n+\n \n-    requires_model_validation = False\n-    # Can't import settings during this command, because they haven't\n-    # necessarily been created.\n-    can_import_settings = False\n+class Command(TemplateCommand):\n+    help = (\"Creates a Django project directory structure for the given \"\n+            \"project name in the current directory or optionally in the \"\n+            \"given directory.\")\n \n-    def handle_label(self, project_name, **options):\n-        directory = os.getcwd()\n+    def handle(self, project_name=None, target=None, *args, **options):\n+        if project_name is None:\n+            raise CommandError(\"you must provide a project name\")\n \n         # Check that the project_name cannot be imported.\n         try:\n             import_module(project_name)\n         except ImportError:\n             pass\n         else:\n-            raise CommandError(\"%r conflicts with the name of an existing Python module and cannot be used as a project name. Please try another name.\" % project_name)\n+            raise CommandError(\"%r conflicts with the name of an existing \"\n+                               \"Python module and cannot be used as a \"\n+                               \"project name. Please try another name.\" %\n+                               project_name)\n \n-        copy_helper(self.style, 'project', project_name, directory)\n+        # Create a random SECRET_KEY hash to put it in the main settings.\n+        chars = 'abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*(-_=+)'\n+        options['secret_key'] = ''.join([choice(chars) for i in range(50)])\n \n-        # Create a random SECRET_KEY hash, and put it in the main settings.\n-        main_settings_file = os.path.join(directory, project_name, project_name, 'settings.py')\n-        settings_contents = open(main_settings_file, 'r').read()\n-        fp = open(main_settings_file, 'w')\n-        secret_key = ''.join([choice('abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*(-_=+)') for i in range(50)])\n-        settings_contents = re.sub(r\"(?<=SECRET_KEY = ')'\", secret_key + \"'\", settings_contents)\n-        fp.write(settings_contents)\n-        fp.close()\n+        super(Command, self).handle('project', project_name, target, **options)"
        },
        {
            "sha": "cf6801d18bce56d1b078f86c59bd74d730a7a695",
            "filename": "django/core/management/templates.py",
            "status": "added",
            "additions": 287,
            "deletions": 0,
            "changes": 287,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1,287 @@\n+from __future__ import with_statement\n+import cgi\n+import mimetypes\n+import os\n+import posixpath\n+import re\n+import shutil\n+import stat\n+import sys\n+import tempfile\n+import urllib\n+\n+from optparse import make_option\n+from os import path\n+\n+import django\n+from django.template import Template, Context\n+from django.utils import archive\n+from django.utils.encoding import smart_str\n+from django.utils._os import rmtree_errorhandler\n+from django.core.management.base import BaseCommand, CommandError\n+from django.core.management.commands.makemessages import handle_extensions\n+\n+\n+_drive_re = re.compile('^([a-z]):', re.I)\n+_url_drive_re = re.compile('^([a-z])[:|]', re.I)\n+\n+\n+class TemplateCommand(BaseCommand):\n+    \"\"\"\n+    Copies either a Django application layout template or a Django project\n+    layout template into the specified directory.\n+\n+    :param style: A color style object (see django.core.management.color).\n+    :param app_or_project: The string 'app' or 'project'.\n+    :param name: The name of the application or project.\n+    :param directory: The directory to which the template should be copied.\n+    :param options: The additional variables passed to project or app templates\n+    \"\"\"\n+    args = \"[name] [optional destination directory]\"\n+    option_list = BaseCommand.option_list + (\n+        make_option('--template',\n+                    action='store', dest='template',\n+                    help='The dotted import path to load the template from.'),\n+        make_option('--extension', '-e', dest='extensions',\n+                    action='append', default=['py'],\n+                    help='The file extension(s) to render (default: \"py\") '\n+                         'Separate multiple extensions with commas, or use '\n+                         '-e multiple times.'),\n+        )\n+    requires_model_validation = False\n+    # Can't import settings during this command, because they haven't\n+    # necessarily been created.\n+    can_import_settings = False\n+    # The supported URL schemes\n+    url_schemes = ['http', 'https', 'ftp']\n+\n+    def handle(self, app_or_project, name, target=None, **options):\n+        self.app_or_project = app_or_project\n+        self.paths_to_remove = []\n+        self.verbosity = int(options.get('verbosity'))\n+\n+        # if some directory is given, make sure it's nicely expanded\n+        if target is None:\n+            target = os.getcwd()\n+        else:\n+            target = path.expanduser(target)\n+\n+        top_dir = path.join(target, name)\n+        try:\n+            os.makedirs(top_dir)\n+        except OSError, e:\n+            raise CommandError(e)\n+\n+        extensions = tuple(\n+            handle_extensions(options.get('extensions'), ignored=()))\n+        if self.verbosity >= 2:\n+            self.stdout.write(\"Rendering %s template files with \"\n+                              \"extensions: %s\\n\" %\n+                              (app_or_project, ', '.join(extensions)))\n+\n+        base_name = '%s_name' % app_or_project\n+        base_subdir = '%s_template' % app_or_project\n+        base_directory = '%s_directory' % app_or_project\n+\n+        context = Context(dict(options, **{\n+            base_name: name,\n+            base_directory: top_dir,\n+        }))\n+\n+        # If it's not a valid directory name.\n+        if not re.search(r'^[_a-zA-Z]\\w*$', name):\n+            # Provide a smart error message, depending on the error.\n+            if not re.search(r'^[_a-zA-Z]', name):\n+                message = ('make sure the name begins '\n+                           'with a letter or underscore')\n+            else:\n+                message = 'use only numbers, letters and underscores'\n+            raise CommandError(\"%r is not a valid %s name. Please %s.\" %\n+                               (name, app_or_project, message))\n+\n+        # Setup a stub settings environment for template rendering\n+        from django.conf import settings\n+        if not settings.configured:\n+            settings.configure()\n+\n+        template_dir = self.handle_template(options.get('template'),\n+                                            base_subdir)\n+        prefix_length = len(template_dir) + 1\n+\n+        for root, dirs, files in os.walk(template_dir):\n+\n+            path_rest = root[prefix_length:]\n+            relative_dir = path_rest.replace(base_name, name)\n+            if relative_dir:\n+                target_dir = path.join(top_dir, relative_dir)\n+                if not path.exists(target_dir):\n+                    os.mkdir(target_dir)\n+\n+            for dirname in dirs[:]:\n+                if dirname.startswith('.'):\n+                    dirs.remove(dirname)\n+\n+            for filename in files:\n+                if filename.endswith(('.pyo', '.pyc', '.py.class')):\n+                    # Ignore some files as they cause various breakages.\n+                    continue\n+                old_path = path.join(root, filename)\n+                new_path = path.join(top_dir, relative_dir,\n+                                     filename.replace(base_name, name))\n+                if path.exists(new_path):\n+                    raise CommandError(\"%s already exists, overlaying a \"\n+                                       \"project or app into an existing \"\n+                                       \"directory won't replace conflicting \"\n+                                       \"files\" % new_path)\n+\n+                # Only render the Python files, as we don't want to\n+                # accidentally render Django templates files\n+                with open(old_path, 'r') as template_file:\n+                    content = template_file.read()\n+                if filename.endswith(extensions):\n+                    template = Template(content)\n+                    content = template.render(context)\n+                with open(new_path, 'w') as new_file:\n+                    new_file.write(content)\n+\n+                if self.verbosity >= 2:\n+                    self.stdout.write(\"Creating %s\\n\" % new_path)\n+                try:\n+                    shutil.copymode(old_path, new_path)\n+                    self.make_writeable(new_path)\n+                except OSError:\n+                    notice = self.style.NOTICE(\n+                        \"Notice: Couldn't set permission bits on %s. You're \"\n+                        \"probably using an uncommon filesystem setup. No \"\n+                        \"problem.\\n\" % new_path)\n+                    sys.stderr.write(smart_str(notice))\n+\n+        if self.paths_to_remove:\n+            if self.verbosity >= 2:\n+                self.stdout.write(\"Cleaning up temporary files.\\n\")\n+            for path_to_remove in self.paths_to_remove:\n+                if os.path.isfile(path_to_remove):\n+                    os.remove(path_to_remove)\n+                else:\n+                    shutil.rmtree(path_to_remove,\n+                                  onerror=rmtree_errorhandler)\n+\n+    def handle_template(self, template, subdir):\n+        \"\"\"\n+        Determines where the app or project templates are.\n+        Use django.__path__[0] as the default because we don't\n+        know into which directory Django has been installed.\n+        \"\"\"\n+        if template is None:\n+            return path.join(django.__path__[0], 'conf', subdir)\n+        else:\n+            if template.startswith('file://'):\n+                template = template[7:]\n+            expanded_template = path.expanduser(template)\n+            if os.path.isdir(expanded_template):\n+                return expanded_template\n+            if self.is_url(template):\n+                # downloads the file and returns the path\n+                absolute_path = self.download(template)\n+            else:\n+                absolute_path = path.abspath(expanded_template)\n+            if os.path.exists(absolute_path):\n+                return self.extract(absolute_path)\n+\n+        raise CommandError(\"couldn't handle %s template %s.\" %\n+                           (self.app_or_project, template))\n+\n+    def download(self, url):\n+        \"\"\"\n+        Downloads the given URL and returns the file name.\n+        \"\"\"\n+        prefix = 'django_%s_template_' % self.app_or_project\n+        tempdir = tempfile.mkdtemp(prefix=prefix, suffix='_download')\n+        self.paths_to_remove.append(tempdir)\n+        filename = url.split('/')[-1]\n+\n+        if self.verbosity >= 2:\n+            self.stdout.write(\"Downloading %s\\n\" % url)\n+        try:\n+            path, info = urllib.urlretrieve(url,\n+                                            os.path.join(tempdir, filename))\n+        except IOError, e:\n+            raise CommandError(\"couldn't download URL %s to %s: %s\" %\n+                               (url, filename, e))\n+\n+        used_name = path.split('/')[-1]\n+\n+        # Trying to get better name from response headers\n+        content_disposition = info.get('content-disposition')\n+        if content_disposition:\n+            _, params = cgi.parse_header(content_disposition)\n+            guessed_filename = params.get('filename') or used_name\n+        else:\n+            guessed_filename = used_name\n+\n+        # Falling back to content type guessing\n+        ext = self.splitext(guessed_filename)[1]\n+        content_type = info.get('content-type')\n+        if not ext and content_type:\n+            ext = mimetypes.guess_extension(content_type)\n+            if ext:\n+                guessed_filename += ext\n+\n+        # Move the temporary file to a filename that has better\n+        # chances of being recognnized by the archive utils\n+        if used_name != guessed_filename:\n+            guessed_path = os.path.join(tempdir, guessed_filename)\n+            shutil.move(path, guessed_path)\n+            return guessed_path\n+\n+        # Giving up\n+        return path\n+\n+    def splitext(self, path):\n+        \"\"\"\n+        Like os.path.splitext, but takes off .tar, too\n+        \"\"\"\n+        base, ext = posixpath.splitext(path)\n+        if base.lower().endswith('.tar'):\n+            ext = base[-4:] + ext\n+            base = base[:-4]\n+        return base, ext\n+\n+    def extract(self, filename):\n+        \"\"\"\n+        Extracts the given file to a temporarily and returns\n+        the path of the directory with the extracted content.\n+        \"\"\"\n+        prefix = 'django_%s_template_' % self.app_or_project\n+        tempdir = tempfile.mkdtemp(prefix=prefix, suffix='_extract')\n+        self.paths_to_remove.append(tempdir)\n+        if self.verbosity >= 2:\n+            self.stdout.write(\"Extracting %s\\n\" % filename)\n+        try:\n+            archive.extract(filename, tempdir)\n+            return tempdir\n+        except (archive.ArchiveException, IOError), e:\n+            raise CommandError(\"couldn't extract file %s to %s: %s\" %\n+                               (filename, tempdir, e))\n+\n+    def is_url(self, template):\n+        \"\"\"\n+        Returns True if the name looks like a URL\n+        \"\"\"\n+        if ':' not in template:\n+            return False\n+        scheme = template.split(':', 1)[0].lower()\n+        return scheme in self.url_schemes\n+\n+    def make_writeable(self, filename):\n+        \"\"\"\n+        Make sure that the file is writeable.\n+        Useful if our source is read-only.\n+        \"\"\"\n+        if sys.platform.startswith('java'):\n+            # On Jython there is no os.access()\n+            return\n+        if not os.access(filename, os.W_OK):\n+            st = os.stat(filename)\n+            new_permissions = stat.S_IMODE(st.st_mode) | stat.S_IWUSR\n+            os.chmod(filename, new_permissions)"
        },
        {
            "sha": "8909cb6db73903bf04ca72792f2e248052cd136d",
            "filename": "django/utils/archive.py",
            "status": "added",
            "additions": 198,
            "deletions": 0,
            "changes": 198,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Futils%2Farchive.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/django%2Futils%2Farchive.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Farchive.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1,198 @@\n+\"\"\"\n+Based on \"python-archive\" -- http://pypi.python.org/pypi/python-archive/\n+\n+Copyright (c) 2010 Gary Wilson Jr. <gary.wilson@gmail.com> and contributers.\n+\n+Permission is hereby granted, free of charge, to any person obtaining a copy\n+of this software and associated documentation files (the \"Software\"), to deal\n+in the Software without restriction, including without limitation the rights\n+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+copies of the Software, and to permit persons to whom the Software is\n+furnished to do so, subject to the following conditions:\n+\n+The above copyright notice and this permission notice shall be included in\n+all copies or substantial portions of the Software.\n+\n+THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+THE SOFTWARE.\n+\"\"\"\n+import os\n+import shutil\n+import sys\n+import tarfile\n+import zipfile\n+\n+\n+class ArchiveException(Exception):\n+    \"\"\"\n+    Base exception class for all archive errors.\n+    \"\"\"\n+\n+\n+class UnrecognizedArchiveFormat(ArchiveException):\n+    \"\"\"\n+    Error raised when passed file is not a recognized archive format.\n+    \"\"\"\n+\n+\n+def extract(path, to_path=''):\n+    \"\"\"\n+    Unpack the tar or zip file at the specified path to the directory\n+    specified by to_path.\n+    \"\"\"\n+    Archive(path).extract(to_path)\n+\n+\n+class Archive(object):\n+    \"\"\"\n+    The external API class that encapsulates an archive implementation.\n+    \"\"\"\n+    def __init__(self, file):\n+        self._archive = self._archive_cls(file)(file)\n+\n+    @staticmethod\n+    def _archive_cls(file):\n+        cls = None\n+        if isinstance(file, basestring):\n+            filename = file\n+        else:\n+            try:\n+                filename = file.name\n+            except AttributeError:\n+                raise UnrecognizedArchiveFormat(\n+                    \"File object not a recognized archive format.\")\n+        base, tail_ext = os.path.splitext(filename.lower())\n+        cls = extension_map.get(tail_ext)\n+        if not cls:\n+            base, ext = os.path.splitext(base)\n+            cls = extension_map.get(ext)\n+        if not cls:\n+            raise UnrecognizedArchiveFormat(\n+                \"Path not a recognized archive format: %s\" % filename)\n+        return cls\n+\n+    def extract(self, to_path=''):\n+        self._archive.extract(to_path)\n+\n+    def list(self):\n+        self._archive.list()\n+\n+\n+class BaseArchive(object):\n+    \"\"\"\n+    Base Archive class.  Implementations should inherit this class.\n+    \"\"\"\n+    def split_leading_dir(self, path):\n+        path = str(path)\n+        path = path.lstrip('/').lstrip('\\\\')\n+        if '/' in path and (('\\\\' in path and path.find('/') < path.find('\\\\'))\n+                            or '\\\\' not in path):\n+            return path.split('/', 1)\n+        elif '\\\\' in path:\n+            return path.split('\\\\', 1)\n+        else:\n+            return path, ''\n+\n+    def has_leading_dir(self, paths):\n+        \"\"\"\n+        Returns true if all the paths have the same leading path name\n+        (i.e., everything is in one subdirectory in an archive)\n+        \"\"\"\n+        common_prefix = None\n+        for path in paths:\n+            prefix, rest = self.split_leading_dir(path)\n+            if not prefix:\n+                return False\n+            elif common_prefix is None:\n+                common_prefix = prefix\n+            elif prefix != common_prefix:\n+                return False\n+        return True\n+\n+    def extract(self):\n+        raise NotImplementedError\n+\n+    def list(self):\n+        raise NotImplementedError\n+\n+\n+class TarArchive(BaseArchive):\n+\n+    def __init__(self, file):\n+        self._archive = tarfile.open(file)\n+\n+    def list(self, *args, **kwargs):\n+        self._archive.list(*args, **kwargs)\n+\n+    def extract(self, to_path):\n+        # note: python<=2.5 doesnt seem to know about pax headers, filter them\n+        members = [member for member in self._archive.getmembers()\n+                   if member.name != 'pax_global_header']\n+        leading = self.has_leading_dir(members)\n+        for member in members:\n+            name = member.name\n+            if leading:\n+                name = self.split_leading_dir(name)[1]\n+            filename = os.path.join(to_path, name)\n+            if member.isdir():\n+                if not os.path.exists(filename):\n+                    os.makedirs(filename)\n+            else:\n+                try:\n+                    extracted = self._archive.extractfile(member)\n+                except (KeyError, AttributeError):\n+                    # Some corrupt tar files seem to produce this\n+                    # (specifically bad symlinks)\n+                    print (\"In the tar file %s the member %s is invalid: %s\" %\n+                           (name, member.name, sys.exc_info()[1]))\n+                else:\n+                    dirname = os.path.dirname(filename)\n+                    if not os.path.exists(dirname):\n+                        os.makedirs(dirname)\n+                    with open(filename, 'wb') as outfile:\n+                        shutil.copyfileobj(extracted, outfile)\n+                finally:\n+                    if extracted:\n+                        extracted.close()\n+\n+\n+class ZipArchive(BaseArchive):\n+\n+    def __init__(self, file):\n+        self._archive = zipfile.ZipFile(file)\n+\n+    def list(self, *args, **kwargs):\n+        self._archive.printdir(*args, **kwargs)\n+\n+    def extract(self, to_path):\n+        namelist = self._archive.namelist()\n+        leading = self.has_leading_dir(namelist)\n+        for name in namelist:\n+            data = self._archive.read(name)\n+            if leading:\n+                name = self.split_leading_dir(name)[1]\n+            filename = os.path.join(to_path, name)\n+            dirname = os.path.dirname(filename)\n+            if dirname and not os.path.exists(dirname):\n+                os.makedirs(dirname)\n+            if filename.endswith(('/', '\\\\')):\n+                # A directory\n+                if not os.path.exists(filename):\n+                    os.makedirs(filename)\n+            else:\n+                with open(filename, 'wb') as outfile:\n+                    outfile.write(data)\n+\n+extension_map = {\n+    '.tar': TarArchive,\n+    '.tar.bz2': TarArchive,\n+    '.tar.gz': TarArchive,\n+    '.tgz': TarArchive,\n+    '.tz2': TarArchive,\n+    '.zip': ZipArchive,\n+}"
        },
        {
            "sha": "2326e827cf9374cfaeaebe48a583addeb626494a",
            "filename": "docs/man/django-admin.1",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Fman%2Fdjango-admin.1",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Fman%2Fdjango-admin.1",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fman%2Fdjango-admin.1?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -99,8 +99,7 @@ Prints the DROP TABLE SQL statements for the given app name(s).\n Prints the custom SQL statements for the given app name(s).\n .TP\n .BI \"sqlflush [\" \"appname ...\" \"]\"\n-Prints the SQL statements that would be executed for the \"flush\" \n-command.\n+Prints the SQL statements that would be executed for the \"flush\" command.\n .TP\n .BI \"sqlindexes [\" \"appname ...\" \"]\"\n Prints the CREATE INDEX SQL statements for the given model module name(s).\n@@ -116,13 +115,13 @@ name(s).\n Prints the SQL statements for resetting PostgreSQL sequences for the\n given app name(s).\n .TP\n-.BI \"startapp [\" \"appname\" \"]\"\n+.BI \"startapp [\" \"\\-\\-template=PATH_OR_URL\" \"] [\" \"\\-\\-extension=EXTENSION\" \"] [\" \"appname\" \"] [\" \"destination\" \"]\"\n Creates a Django app directory structure for the given app name in\n-the current directory.\n+the current directory or the optional destination.\n .TP\n-.BI \"startproject [\" \"projectname\" \"]\"\n+.BI \"startproject [\" \"\\-\\-template=PATH_OR_URL\" \"] [\" \"\\-\\-extension=EXTENSION\" \"] [\" \"projectname\" \"] [\" \"destination\" \"]\"\n Creates a Django project directory structure for the given project name\n-in the current directory.\n+in the current directory or the optional destination.\n .TP\n .BI syncdb\n Creates the database tables for all apps in INSTALLED_APPS whose tables\n@@ -194,7 +193,7 @@ The locale to process when using makemessages or compilemessages.\n The domain of the message files (default: \"django\") when using makemessages.\n .TP\n .I \\-e, \\-\\-extension=EXTENSION\n-The file extension(s) to examine (default: \".html\", separate multiple\n+The file extension(s) to examine (separate multiple\n extensions with commas, or use -e multiple times).\n .TP\n .I \\-s, \\-\\-symlinks\n@@ -214,6 +213,9 @@ Don't break long message lines into several lines.\n .I \\-a, \\-\\-all\n Process all available locales when using makemessages..SH \"ENVIRONMENT\"\n .TP\n+.I \\-a, \\-\\-template=PATH_OR_URL\n+The file or directory path or URL to load the project and app templates from.\n+.TP\n .I DJANGO_SETTINGS_MODULE\n In the absence of the\n .BI \\-\\-settings"
        },
        {
            "sha": "d33b18280a8256da8c1a5a1f7ba3aeba848bf4c5",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 106,
            "deletions": 6,
            "changes": 112,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -907,21 +907,121 @@ of sync with its automatically incremented field data.\n The :djadminopt:`--database` option can be used to specify the database for\n which to print the SQL.\n \n-startapp <appname>\n-------------------\n+startapp <appname> [destination]\n+--------------------------------\n \n .. django-admin:: startapp\n \n Creates a Django app directory structure for the given app name in the current\n+directory or the given destination.\n+\n+.. versionchanged:: 1.4\n+\n+By default the directory created contains a ``models.py`` file and other app\n+template files, see the `source`_ for more details. If only the app\n+name is given, the app directory will be created in the current working\n directory.\n \n-startproject <projectname>\n---------------------------\n+If the optional destination is provided, it will be used to create the\n+the new app directory in. The use of '.' to denote the current working\n+directory is valid for the destination. For example::\n+\n+    django-admin.py startapp myapp /Users/jezdez/Code\n+\n+\n+.. versionadded:: 1.4\n+.. django-admin-option:: --template\n+\n+With the ``--template`` option you can use a custom app template by providing\n+either the path to a directory with the app template file, a path to a\n+compressed file (``.tar.gz``, ``.tar.bz2``, ``.tgz``, ``.tbz``, ``.zip``)\n+containing the app template files.\n+\n+Additionally Django will also accept URLs (``http``, ``https``, ``ftp``) to\n+compressed archives with the app template files, downloading and extracting\n+them on the fly.\n+\n+For example, this would look for an app template in the given directory when creating the ``myapp`` app::\n+\n+    django-admin.py startapp --template=/Users/jezdez/Code/my_app_template myapp\n+\n+.. versionadded:: 1.4\n+\n+When Django copies the app template files it will also render the files\n+whose extension matches those passed with the ``--extension`` option (``py``\n+by default) using the template engine. The :class:`template context\n+<django.template.Context>` used is:\n+\n+- Any option passed to the startapp command\n+- ``app_name`` -- the appp name as passed to the command\n+- ``app_directory`` -- the full path of the newly created app\n+\n+.. _render_warning:\n+\n+.. warning::\n+\n+    When the app template files are rendered with the Django template\n+    engine (by default all ``*.py`` files) it will also replace all\n+    stray template variables contained. If one of the Python files for\n+    example contains a docstring explaining a particular feature related\n+    to template rendering, it might result in an incorrect example.\n+\n+    To work around this problem you can use the :ttag:`templatetag`\n+    templatetag to \"escape\" the various parts of the template syntax.\n+\n+.. _source: https://code.djangoproject.com/browser/django/trunk/django/conf/app_template/\n+\n+startproject <projectname> [destination]\n+----------------------------------------\n \n .. django-admin:: startproject\n \n-Creates a Django project directory structure for the given project name in the\n-current directory.\n+Creates a Django project directory structure for the given project name in\n+the current directory or the given destination.\n+\n+.. versionchanged:: 1.4\n+\n+By default the directory created contains a ``manage.py`` file and a project\n+package (containing ``settings.py`` file and other project template files),\n+see the `template source`_ for more details.\n+\n+If only the project name is given, both the project directory and project\n+package will be named ``<projectname>`` and the project directory\n+will be created in the current working directory.\n+\n+If the optional destination is provided, it will be used to create the\n+the new project directory in. The use of '.' to denote the current working\n+directory is valid for the destination. For example::\n+\n+    django-admin.py startproject myproject /Users/jezdez/Code\n+\n+.. versionadded:: 1.4\n+\n+Similar to the :djadmin:`startapp` command the ``--template`` option is also\n+available for specifying a directory or file path of a custom project\n+template. See the :djadmin:`startapp` documentation for details of supported\n+project template formats.\n+\n+For example, this would look for a project template in the given directory\n+when creating the ``myproject`` project::\n+\n+    django-admin.py startproject --template=/Users/jezdez/Code/my_project_template myproject\n+\n+When Django copies the project template files it will also render the files\n+whose extension matches those passed with the ``--extension`` option (``py``\n+by default) using the template engine. The :class:`template context\n+<django.template.Context>` used is:\n+\n+- Any option passed to the startproject command\n+- ``project_name`` -- the project name as passed to the command\n+- ``project_directory`` -- the full path of the newly created project\n+- ``secret_key`` -- a random key for the :setting:`SECRET_KEY` setting\n+\n+Please also see the :ref:`rendering warning <render_warning>` as mentioned\n+for :djadmin:`startapp`.\n+\n+.. _`template source`: https://code.djangoproject.com/browser/django/trunk/django/conf/project_template/\n+\n \n syncdb\n ------"
        },
        {
            "sha": "d1b5f5eccab705886a01352eb081348b8b0cbf38",
            "filename": "docs/releases/1.4-alpha-1.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Freleases%2F1.4-alpha-1.txt",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Freleases%2F1.4-alpha-1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4-alpha-1.txt?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -429,6 +429,27 @@ callable :djadmin:`runserver` uses.\n (The :djadmin:`runfcgi` management command also internally wraps the WSGI\n callable configured via :setting:`WSGI_APPLICATION`.)\n \n+Custom project and app templates\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :djadmin:`startapp` and :djadmin:`startproject` management commands\n+got a ``--template`` option for specifying paths or URL to custom app or\n+project templates.\n+\n+For example, Django will use the ``/path/to/my_project_template``\n+directorywhen running the following command::\n+\n+    django-admin.py startproject --template=/path/to/my_project_template myproject\n+\n+Additionally you can now provide a destination directory as the second\n+argument to both :djadmin:`startapp` and :djadmin:`startproject`::\n+\n+    django-admin.py startapp myapp /path/to/new/app\n+    django-admin.py startproject myproject /path/to/new/project\n+\n+For more information see the :djadmin:`startapp` and :djadmin:`startproject`\n+documentation.\n+\n Support for time zones\n ~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "93ece428bd9f52c888a8c938868daab3b1e5b0c1",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -420,6 +420,27 @@ callable :djadmin:`runserver` uses.\n (The :djadmin:`runfcgi` management command also internally wraps the WSGI\n callable configured via :setting:`WSGI_APPLICATION`.)\n \n+Custom project and app templates\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :djadmin:`startapp` and :djadmin:`startproject` management commands\n+got a ``--template`` option for specifying paths or URL to custom app or\n+project templates.\n+\n+For example, Django will use the ``/path/to/my_project_template``\n+directorywhen running the following command::\n+\n+    django-admin.py startproject --template=/path/to/my_project_template myproject\n+\n+Additionally you can now provide a destination directory as the second\n+argument to both :djadmin:`startapp` and :djadmin:`startproject`::\n+\n+    django-admin.py startapp myapp /path/to/new/app\n+    django-admin.py startproject myproject /path/to/new/project\n+\n+For more information see the :djadmin:`startapp` and :djadmin:`startproject`\n+documentation.\n+\n Support for time zones\n ~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/app_template/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2F__init__.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "439d935f73f35988d3c129a349ad684f25c17643",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/app_template/api.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2Fapi.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2Fapi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2Fapi.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1 @@\n+# your API code\n\\ No newline at end of file"
        },
        {
            "sha": "92be216cfc9b2faa9455e7bbbce6fcb0603a84c7",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/app_template/models.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fapp_template%2Fmodels.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1 @@\n+# whatever\n\\ No newline at end of file"
        },
        {
            "sha": "2a181c9faadbb8a9cdb3c6b1c692a1549b9c239c",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template.tgz",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template.tgz",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template.tgz",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template.tgz?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "032f0bcd72d9455b967400ac176b79af575b3af0",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/additional_dir/additional_file.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fadditional_dir%2Fadditional_file.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fadditional_dir%2Fadditional_file.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fadditional_dir%2Fadditional_file.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1 @@\n+# some file for {{ project_name }} test project\n\\ No newline at end of file"
        },
        {
            "sha": "ad8aafe233de629743fc48cdddf27fce05a8c89d",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/manage.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fmanage.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fmanage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fmanage.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1 @@\n+# The manage.py of the {{ project_name }} test project\n\\ No newline at end of file"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/project_name/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fproject_name%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fproject_name%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fproject_name%2F__init__.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "ddc216c829fcea934fa84d6d26b0c57fcb7d1f10",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/project_name/settings.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fproject_name%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fproject_name%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fproject_name%2Fsettings.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1 @@\n+# Django settings for {{ project_name }} test project."
        },
        {
            "sha": "8fd74db556e5a14f6acf6a5d263ac586267f3337",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 220,
            "deletions": 133,
            "changes": 353,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -6,24 +6,29 @@\n from __future__ import with_statement\n \n import os\n+import re\n import shutil\n import socket\n import sys\n-import re\n+import urllib\n \n from django import conf, bin, get_version\n from django.conf import settings\n from django.test.simple import DjangoTestSuiteRunner\n from django.utils import unittest\n+from django.test import LiveServerTestCase\n+\n+test_dir = os.path.dirname(os.path.dirname(__file__))\n+expected_query_re = re.compile(r'CREATE TABLE [`\"]admin_scripts_article[`\"]', re.IGNORECASE)\n \n \n class AdminScriptTestCase(unittest.TestCase):\n     def write_settings(self, filename, apps=None, is_dir=False, sdict=None):\n         test_dir = os.path.dirname(os.path.dirname(__file__))\n         if is_dir:\n-            settings_dir = os.path.join(test_dir,filename)\n+            settings_dir = os.path.join(test_dir, filename)\n             os.mkdir(settings_dir)\n-            settings_file = open(os.path.join(settings_dir,'__init__.py'), 'w')\n+            settings_file = open(os.path.join(settings_dir, '__init__.py'), 'w')\n         else:\n             settings_file = open(os.path.join(test_dir, filename), 'w')\n         settings_file.write('# Settings file automatically generated by regressiontests.admin_scripts test case\\n')\n@@ -50,7 +55,6 @@ def write_settings(self, filename, apps=None, is_dir=False, sdict=None):\n         settings_file.close()\n \n     def remove_settings(self, filename, is_dir=False):\n-        test_dir = os.path.dirname(os.path.dirname(__file__))\n         full_name = os.path.join(test_dir, filename)\n         if is_dir:\n             shutil.rmtree(full_name)\n@@ -84,7 +88,6 @@ def _ext_backend_paths(self):\n         return paths\n \n     def run_test(self, script, args, settings_file=None, apps=None):\n-        test_dir = os.path.dirname(os.path.dirname(__file__))\n         project_dir = os.path.dirname(test_dir)\n         base_dir = os.path.dirname(project_dir)\n         ext_backend_base_dirs = self._ext_backend_paths()\n@@ -142,13 +145,12 @@ def run_test(self, script, args, settings_file=None, apps=None):\n \n     def run_django_admin(self, args, settings_file=None):\n         bin_dir = os.path.abspath(os.path.dirname(bin.__file__))\n-        return self.run_test(os.path.join(bin_dir,'django-admin.py'), args, settings_file)\n+        return self.run_test(os.path.join(bin_dir, 'django-admin.py'), args, settings_file)\n \n     def run_manage(self, args, settings_file=None):\n         conf_dir = os.path.dirname(conf.__file__)\n         template_manage_py = os.path.join(conf_dir, 'project_template', 'manage.py')\n \n-        test_dir = os.path.dirname(os.path.dirname(__file__))\n         test_manage_py = os.path.join(test_dir, 'manage.py')\n         shutil.copyfile(template_manage_py, test_manage_py)\n \n@@ -196,22 +198,22 @@ class DjangoAdminNoSettings(AdminScriptTestCase):\n \n     def test_builtin_command(self):\n         \"no settings: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_bad_settings(self):\n         \"no settings: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"no settings: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -228,36 +230,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"default: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_settings(self):\n         \"default: django-admin builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"default: django-admin builtin commands succeed if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"default: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"default: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -278,7 +280,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"default: django-admin can execute user commands if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -294,36 +296,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"fulldefault: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_settings(self):\n         \"fulldefault: django-admin builtin commands succeed if a settings file is provided\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"fulldefault: django-admin builtin commands succeed if the environment contains settings\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"fulldefault: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"fulldefault: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -344,7 +346,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"fulldefault: django-admin can execute user commands if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -353,43 +355,43 @@ class DjangoAdminMinimalSettings(AdminScriptTestCase):\n     doesn't contain the test application.\n     \"\"\"\n     def setUp(self):\n-        self.write_settings('settings.py', apps=['django.contrib.auth','django.contrib.contenttypes'])\n+        self.write_settings('settings.py', apps=['django.contrib.auth', 'django.contrib.contenttypes'])\n \n     def tearDown(self):\n         self.remove_settings('settings.py')\n \n     def test_builtin_command(self):\n         \"minimal: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_settings(self):\n         \"minimal: django-admin builtin commands fail if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'App with label admin_scripts could not be found')\n \n     def test_builtin_with_environment(self):\n         \"minimal: django-admin builtin commands fail if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'App with label admin_scripts could not be found')\n \n     def test_builtin_with_bad_settings(self):\n         \"minimal: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"minimal: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -410,7 +412,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"minimal: django-admin can't execute user commands, even if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Unknown command: 'noargs_command'\")\n \n@@ -426,36 +428,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"alternate: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_settings(self):\n         \"alternate: django-admin builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.alternate_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.alternate_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"alternate: django-admin builtin commands succeed if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'regressiontests.alternate_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'regressiontests.alternate_settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"alternate: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"alternate: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -476,7 +478,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"alternate: django-admin can execute user commands if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_django_admin(args,'regressiontests.alternate_settings')\n+        out, err = self.run_django_admin(args, 'regressiontests.alternate_settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -488,7 +490,7 @@ class DjangoAdminMultipleSettings(AdminScriptTestCase):\n     alternate settings must be used by the running script.\n     \"\"\"\n     def setUp(self):\n-        self.write_settings('settings.py', apps=['django.contrib.auth','django.contrib.contenttypes'])\n+        self.write_settings('settings.py', apps=['django.contrib.auth', 'django.contrib.contenttypes'])\n         self.write_settings('alternate_settings.py')\n \n     def tearDown(self):\n@@ -497,35 +499,35 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"alternate: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_settings(self):\n         \"alternate: django-admin builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.alternate_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.alternate_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"alternate: django-admin builtin commands succeed if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'regressiontests.alternate_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'regressiontests.alternate_settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"alternate: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"alternate: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -546,7 +548,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"alternate: django-admin can execute user commands if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_django_admin(args,'regressiontests.alternate_settings')\n+        out, err = self.run_django_admin(args, 'regressiontests.alternate_settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -565,31 +567,41 @@ def tearDown(self):\n \n     def test_setup_environ(self):\n         \"directory: startapp creates the correct directory\"\n-        test_dir = os.path.dirname(os.path.dirname(__file__))\n-        args = ['startapp','settings_test']\n+        args = ['startapp', 'settings_test']\n         app_path = os.path.join(test_dir, 'settings_test')\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n+        self.addCleanup(shutil.rmtree, app_path)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.exists(app_path))\n+\n+    def test_setup_environ_custom_template(self):\n+        \"directory: startapp creates the correct directory with a custom template\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'app_template')\n+        args = ['startapp', '--template', template_path, 'custom_settings_test']\n+        app_path = os.path.join(test_dir, 'custom_settings_test')\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.addCleanup(shutil.rmtree, app_path)\n         self.assertNoOutput(err)\n         self.assertTrue(os.path.exists(app_path))\n+        self.assertTrue(os.path.exists(os.path.join(app_path, 'api.py')))\n \n     def test_builtin_command(self):\n         \"directory: django-admin builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'environment variable DJANGO_SETTINGS_MODULE is undefined')\n \n     def test_builtin_with_bad_settings(self):\n         \"directory: django-admin builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"directory: django-admin builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -602,15 +614,15 @@ def test_custom_command(self):\n \n     def test_builtin_with_settings(self):\n         \"directory: django-admin builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"directory: django-admin builtin commands succeed if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_django_admin(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_django_admin(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n@@ -626,22 +638,22 @@ class ManageNoSettings(AdminScriptTestCase):\n \n     def test_builtin_command(self):\n         \"no settings: manage.py builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'regressiontests.settings'\")\n \n     def test_builtin_with_bad_settings(self):\n         \"no settings: manage.py builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"no settings: manage.py builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -658,36 +670,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"default: manage.py builtin commands succeed when default settings are appropriate\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_settings(self):\n         \"default: manage.py builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"default: manage.py builtin commands succeed if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"default: manage.py builtin commands succeed if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"default: manage.py builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -708,7 +720,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"default: manage.py can execute user commands when settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_manage(args,'regressiontests.settings')\n+        out, err = self.run_manage(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -725,36 +737,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"fulldefault: manage.py builtin commands succeed when default settings are appropriate\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_settings(self):\n         \"fulldefault: manage.py builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"fulldefault: manage.py builtin commands succeed if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"fulldefault: manage.py builtin commands succeed if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"fulldefault: manage.py builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -775,7 +787,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"fulldefault: manage.py can execute user commands when settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_manage(args,'regressiontests.settings')\n+        out, err = self.run_manage(args, 'regressiontests.settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -784,43 +796,43 @@ class ManageMinimalSettings(AdminScriptTestCase):\n     doesn't contain the test application.\n     \"\"\"\n     def setUp(self):\n-        self.write_settings('settings.py', apps=['django.contrib.auth','django.contrib.contenttypes'])\n+        self.write_settings('settings.py', apps=['django.contrib.auth', 'django.contrib.contenttypes'])\n \n     def tearDown(self):\n         self.remove_settings('settings.py')\n \n     def test_builtin_command(self):\n         \"minimal: manage.py builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'App with label admin_scripts could not be found')\n \n     def test_builtin_with_settings(self):\n         \"minimal: manage.py builtin commands fail if settings are provided as argument\"\n-        args = ['sqlall','--settings=regressiontests.settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=regressiontests.settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'App with label admin_scripts could not be found')\n \n     def test_builtin_with_environment(self):\n         \"minimal: manage.py builtin commands fail if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'regressiontests.settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'regressiontests.settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'App with label admin_scripts could not be found')\n \n     def test_builtin_with_bad_settings(self):\n         \"minimal: manage.py builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"minimal: manage.py builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -841,7 +853,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"minimal: manage.py can't execute user commands, even if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_manage(args,'regressiontests.settings')\n+        out, err = self.run_manage(args, 'regressiontests.settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Unknown command: 'noargs_command'\")\n \n@@ -857,38 +869,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"alternate: manage.py builtin commands fail with an import error when no default settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'regressiontests.settings'\")\n \n     def test_builtin_with_settings(self):\n         \"alternate: manage.py builtin commands work with settings provided as argument\"\n-        args = ['sqlall','--settings=alternate_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=alternate_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n-        expected_query_re = re.compile('CREATE TABLE [`\"]admin_scripts_article[`\"]', re.IGNORECASE)\n         self.assertRegexpMatches(out, expected_query_re)\n         self.assertNoOutput(err)\n \n     def test_builtin_with_environment(self):\n         \"alternate: manage.py builtin commands work if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'alternate_settings')\n-        expected_query_re = re.compile('CREATE TABLE [`\"]admin_scripts_article[`\"]', re.IGNORECASE)\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'alternate_settings')\n         self.assertRegexpMatches(out, expected_query_re)\n         self.assertNoOutput(err)\n \n     def test_builtin_with_bad_settings(self):\n         \"alternate: manage.py builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"alternate: manage.py builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -909,7 +919,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"alternate: manage.py can execute user commands if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_manage(args,'alternate_settings')\n+        out, err = self.run_manage(args, 'alternate_settings')\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand options=[('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n         self.assertNoOutput(err)\n \n@@ -921,7 +931,7 @@ class ManageMultipleSettings(AdminScriptTestCase):\n     alternate settings must be used by the running script.\n     \"\"\"\n     def setUp(self):\n-        self.write_settings('settings.py', apps=['django.contrib.auth','django.contrib.contenttypes'])\n+        self.write_settings('settings.py', apps=['django.contrib.auth', 'django.contrib.contenttypes'])\n         self.write_settings('alternate_settings.py')\n \n     def tearDown(self):\n@@ -930,36 +940,36 @@ def tearDown(self):\n \n     def test_builtin_command(self):\n         \"multiple: manage.py builtin commands fail with an import error when no settings provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, 'App with label admin_scripts could not be found.')\n \n     def test_builtin_with_settings(self):\n         \"multiple: manage.py builtin commands succeed if settings are provided as argument\"\n-        args = ['sqlall','--settings=alternate_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=alternate_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_environment(self):\n         \"multiple: manage.py can execute builtin commands if settings are provided in the environment\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'alternate_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'alternate_settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, 'CREATE TABLE')\n \n     def test_builtin_with_bad_settings(self):\n         \"multiple: manage.py builtin commands fail if settings file (from argument) doesn't exist\"\n-        args = ['sqlall','--settings=bad_settings', 'admin_scripts']\n+        args = ['sqlall', '--settings=bad_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n     def test_builtin_with_bad_environment(self):\n         \"multiple: manage.py builtin commands fail if settings file (from environment) doesn't exist\"\n-        args = ['sqlall','admin_scripts']\n-        out, err = self.run_manage(args,'bad_settings')\n+        args = ['sqlall', 'admin_scripts']\n+        out, err = self.run_manage(args, 'bad_settings')\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"Could not import settings 'bad_settings'\")\n \n@@ -980,7 +990,7 @@ def test_custom_command_with_settings(self):\n     def test_custom_command_with_environment(self):\n         \"multiple: manage.py can execute user commands if settings are provided in environment\"\n         args = ['noargs_command']\n-        out, err = self.run_manage(args,'alternate_settings')\n+        out, err = self.run_manage(args, 'alternate_settings')\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:NoArgsCommand\")\n \n@@ -995,11 +1005,10 @@ def tearDown(self):\n         self.remove_settings('settings.py')\n \n     def write_settings_with_import_error(self, filename, apps=None, is_dir=False, sdict=None):\n-        test_dir = os.path.dirname(os.path.dirname(__file__))\n         if is_dir:\n-            settings_dir = os.path.join(test_dir,filename)\n+            settings_dir = os.path.join(test_dir, filename)\n             os.mkdir(settings_dir)\n-            settings_file = open(os.path.join(settings_dir,'__init__.py'), 'w')\n+            settings_file = open(os.path.join(settings_dir, '__init__.py'), 'w')\n         else:\n             settings_file = open(os.path.join(test_dir, filename), 'w')\n         settings_file.write('# Settings file automatically generated by regressiontests.admin_scripts test case\\n')\n@@ -1009,7 +1018,7 @@ def write_settings_with_import_error(self, filename, apps=None, is_dir=False, sd\n \n     def test_builtin_command(self):\n         \"import error: manage.py builtin commands shows useful diagnostic info when settings with import errors is provided\"\n-        args = ['sqlall','admin_scripts']\n+        args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"No module named foo42bar\")\n@@ -1200,14 +1209,14 @@ def test_short_help(self):\n \n     def test_specific_help(self):\n         \"--help can be used on a specific command\"\n-        args = ['sqlall','--help']\n+        args = ['sqlall', '--help']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"Prints the CREATE TABLE, custom SQL and CREATE INDEX SQL statements for the given model module name(s).\")\n \n     def test_base_command(self):\n         \"User BaseCommands can execute when a label is provided\"\n-        args = ['base_command','testlabel']\n+        args = ['base_command', 'testlabel']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', '1'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n@@ -1221,21 +1230,21 @@ def test_base_command_no_label(self):\n \n     def test_base_command_multiple_label(self):\n         \"User BaseCommands can execute when no labels are provided\"\n-        args = ['base_command','testlabel','anotherlabel']\n+        args = ['base_command', 'testlabel', 'anotherlabel']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel', 'anotherlabel'), options=[('option_a', '1'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_base_command_with_option(self):\n         \"User BaseCommands can execute with options when a label is provided\"\n-        args = ['base_command','testlabel','--option_a=x']\n+        args = ['base_command', 'testlabel', '--option_a=x']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_base_command_with_options(self):\n         \"User BaseCommands can execute with multiple options when a label is provided\"\n-        args = ['base_command','testlabel','-a','x','--option_b=y']\n+        args = ['base_command', 'testlabel', '-a', 'x', '--option_b=y']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', 'y'), ('option_c', '3'), ('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n@@ -1249,7 +1258,7 @@ def test_noargs(self):\n \n     def test_noargs_with_args(self):\n         \"NoArg Commands raise an error if an argument is provided\"\n-        args = ['noargs_command','argument']\n+        args = ['noargs_command', 'argument']\n         out, err = self.run_manage(args)\n         self.assertOutput(err, \"Error: Command doesn't accept any arguments\")\n \n@@ -1259,7 +1268,7 @@ def test_app_command(self):\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:AppCommand app=<module 'django.contrib.auth.models'\")\n-        self.assertOutput(out, os.sep.join(['django','contrib','auth','models.py']))\n+        self.assertOutput(out, os.sep.join(['django', 'contrib', 'auth', 'models.py']))\n         self.assertOutput(out, \"'>, options=[('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_app_command_no_apps(self):\n@@ -1270,14 +1279,14 @@ def test_app_command_no_apps(self):\n \n     def test_app_command_multiple_apps(self):\n         \"User AppCommands raise an error when multiple app names are provided\"\n-        args = ['app_command','auth','contenttypes']\n+        args = ['app_command', 'auth', 'contenttypes']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:AppCommand app=<module 'django.contrib.auth.models'\")\n-        self.assertOutput(out, os.sep.join(['django','contrib','auth','models.py']))\n+        self.assertOutput(out, os.sep.join(['django', 'contrib', 'auth', 'models.py']))\n         self.assertOutput(out, \"'>, options=[('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n         self.assertOutput(out, \"EXECUTE:AppCommand app=<module 'django.contrib.contenttypes.models'\")\n-        self.assertOutput(out, os.sep.join(['django','contrib','contenttypes','models.py']))\n+        self.assertOutput(out, os.sep.join(['django', 'contrib', 'contenttypes', 'models.py']))\n         self.assertOutput(out, \"'>, options=[('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_app_command_invalid_appname(self):\n@@ -1294,7 +1303,7 @@ def test_app_command_some_invalid_appnames(self):\n \n     def test_label_command(self):\n         \"User LabelCommands can execute when a label is provided\"\n-        args = ['label_command','testlabel']\n+        args = ['label_command', 'testlabel']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:LabelCommand label=testlabel, options=[('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n@@ -1307,7 +1316,7 @@ def test_label_command_no_label(self):\n \n     def test_label_command_multiple_label(self):\n         \"User LabelCommands are executed multiple times if multiple labels are provided\"\n-        args = ['label_command','testlabel','anotherlabel']\n+        args = ['label_command', 'testlabel', 'anotherlabel']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:LabelCommand label=testlabel, options=[('pythonpath', None), ('settings', None), ('traceback', None), ('verbosity', '1')]\")\n@@ -1323,7 +1332,7 @@ class ArgumentOrder(AdminScriptTestCase):\n     individual command.\n     \"\"\"\n     def setUp(self):\n-        self.write_settings('settings.py', apps=['django.contrib.auth','django.contrib.contenttypes'])\n+        self.write_settings('settings.py', apps=['django.contrib.auth', 'django.contrib.contenttypes'])\n         self.write_settings('alternate_settings.py')\n \n     def tearDown(self):\n@@ -1332,35 +1341,113 @@ def tearDown(self):\n \n     def test_setting_then_option(self):\n         \"Options passed after settings are correctly handled\"\n-        args = ['base_command','testlabel','--settings=alternate_settings','--option_a=x']\n+        args = ['base_command', 'testlabel', '--settings=alternate_settings', '--option_a=x']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', 'alternate_settings'), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_setting_then_short_option(self):\n         \"Short options passed after settings are correctly handled\"\n-        args = ['base_command','testlabel','--settings=alternate_settings','--option_a=x']\n+        args = ['base_command', 'testlabel', '--settings=alternate_settings', '--option_a=x']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', 'alternate_settings'), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_option_then_setting(self):\n         \"Options passed before settings are correctly handled\"\n-        args = ['base_command','testlabel','--option_a=x','--settings=alternate_settings']\n+        args = ['base_command', 'testlabel', '--option_a=x', '--settings=alternate_settings']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', 'alternate_settings'), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_short_option_then_setting(self):\n         \"Short options passed before settings are correctly handled\"\n-        args = ['base_command','testlabel','-a','x','--settings=alternate_settings']\n+        args = ['base_command', 'testlabel', '-a', 'x', '--settings=alternate_settings']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', '2'), ('option_c', '3'), ('pythonpath', None), ('settings', 'alternate_settings'), ('traceback', None), ('verbosity', '1')]\")\n \n     def test_option_then_setting_then_option(self):\n         \"Options are correctly handled when they are passed before and after a setting\"\n-        args = ['base_command','testlabel','--option_a=x','--settings=alternate_settings','--option_b=y']\n+        args = ['base_command', 'testlabel', '--option_a=x', '--settings=alternate_settings', '--option_b=y']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"EXECUTE:BaseCommand labels=('testlabel',), options=[('option_a', 'x'), ('option_b', 'y'), ('option_c', '3'), ('pythonpath', None), ('settings', 'alternate_settings'), ('traceback', None), ('verbosity', '1')]\")\n+\n+\n+class StartProject(LiveServerTestCase, AdminScriptTestCase):\n+\n+    def test_wrong_args(self):\n+        \"Make sure passing the wrong kinds of arguments raises a CommandError\"\n+        out, err = self.run_django_admin(['startproject'])\n+        self.assertNoOutput(out)\n+        self.assertOutput(err, \"you must provide a project name\")\n+\n+    def test_simple_project(self):\n+        \"Make sure the startproject management command creates a project\"\n+        args = ['startproject', 'testproject']\n+        testproject_dir = os.path.join(test_dir, 'testproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+\n+        # running again..\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(out)\n+        self.assertOutput(err, \"File exists\")\n+\n+    def test_simple_project_different_directory(self):\n+        \"Make sure the startproject management command creates a project in a specific directory\"\n+        args = ['startproject', 'testproject', 'othertestproject']\n+        testproject_dir = os.path.join(test_dir, 'othertestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(os.path.join(testproject_dir, 'testproject')))\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'testproject', 'manage.py')))\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+\n+        # running again..\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(out)\n+        self.assertOutput(err, \"File exists\")\n+\n+    def test_custom_project_template(self):\n+        \"Make sure the startproject management command is able to use a different project template\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template')\n+        args = ['startproject', '--template', template_path, 'customtestproject']\n+        testproject_dir = os.path.join(test_dir, 'customtestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'additional_dir')))\n+\n+    def test_custom_project_template_from_tarball_by_path(self):\n+        \"Make sure the startproject management command is able to use a different project template from a tarball\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template.tgz')\n+        args = ['startproject', '--template', template_path, 'tarballtestproject']\n+        testproject_dir = os.path.join(test_dir, 'tarballtestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'run.py')))\n+\n+    def test_custom_project_template_from_tarball_by_url(self):\n+        \"Make sure the startproject management command is able to use a different project template from a tarball via a url\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template.tgz')\n+        template_url = '%s/admin_scripts/custom_templates/project_template.tgz' % self.live_server_url\n+\n+        args = ['startproject', '--template', template_url, 'urltestproject']\n+        testproject_dir = os.path.join(test_dir, 'urltestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'run.py')))"
        },
        {
            "sha": "692638cecaf6086179f6f96647546b0ab98b348e",
            "filename": "tests/regressiontests/admin_scripts/urls.py",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Fadmin_scripts%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Furls.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1,10 @@\n+import os\n+from django.conf.urls import patterns\n+\n+here = os.path.dirname(__file__)\n+\n+urlpatterns = patterns('',\n+    (r'^custom_templates/(?P<path>.*)$', 'django.views.static.serve', {\n+        'document_root': os.path.join(here, 'custom_templates'),\n+    }),\n+)"
        },
        {
            "sha": "0927c624f3e1c68c5170256bafbfb823b6a14359",
            "filename": "tests/regressiontests/utils/archive.py",
            "status": "added",
            "additions": 69,
            "deletions": 0,
            "changes": 69,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchive.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchive.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Farchive.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -0,0 +1,69 @@\n+import os\n+import shutil\n+import tempfile\n+from django.utils import unittest\n+\n+from django.utils.archive import Archive, extract\n+\n+\n+TEST_DIR = os.path.join(os.path.dirname(__file__), 'archives')\n+\n+\n+class ArchiveTester(object):\n+    archive = None\n+\n+    def setUp(self):\n+        \"\"\"\n+        Create temporary directory for testing extraction.\n+        \"\"\"\n+        self.old_cwd = os.getcwd()\n+        self.tmpdir = tempfile.mkdtemp()\n+        self.addCleanup(shutil.rmtree, self.tmpdir)\n+        self.archive_path = os.path.join(TEST_DIR, self.archive)\n+        # Always start off in TEST_DIR.\n+        os.chdir(TEST_DIR)\n+\n+    def tearDown(self):\n+        os.chdir(self.old_cwd)\n+\n+    def test_extract_method(self):\n+        Archive(self.archive).extract(self.tmpdir)\n+        self.check_files(self.tmpdir)\n+\n+    def test_extract_method_no_to_path(self):\n+        os.chdir(self.tmpdir)\n+        Archive(self.archive_path).extract()\n+        self.check_files(self.tmpdir)\n+\n+    def test_extract_function(self):\n+        extract(self.archive_path, self.tmpdir)\n+        self.check_files(self.tmpdir)\n+\n+    def test_extract_function_no_to_path(self):\n+        os.chdir(self.tmpdir)\n+        extract(self.archive_path)\n+        self.check_files(self.tmpdir)\n+\n+    def check_files(self, tmpdir):\n+        self.assertTrue(os.path.isfile(os.path.join(self.tmpdir, '1')))\n+        self.assertTrue(os.path.isfile(os.path.join(self.tmpdir, '2')))\n+        self.assertTrue(os.path.isfile(os.path.join(self.tmpdir, 'foo', '1')))\n+        self.assertTrue(os.path.isfile(os.path.join(self.tmpdir, 'foo', '2')))\n+        self.assertTrue(os.path.isfile(os.path.join(self.tmpdir, 'foo', 'bar', '1')))\n+        self.assertTrue(os.path.isfile(os.path.join(self.tmpdir, 'foo', 'bar', '2')))\n+\n+\n+class TestZip(ArchiveTester, unittest.TestCase):\n+    archive = 'foobar.zip'\n+\n+\n+class TestTar(ArchiveTester, unittest.TestCase):\n+    archive = 'foobar.tar'\n+\n+\n+class TestGzipTar(ArchiveTester, unittest.TestCase):\n+    archive = 'foobar.tar.gz'\n+\n+\n+class TestBzip2Tar(ArchiveTester, unittest.TestCase):\n+    archive = 'foobar.tar.bz2'"
        },
        {
            "sha": "5418405070f1c410f2751215f73e1e6f778e8526",
            "filename": "tests/regressiontests/utils/archives/foobar.tar",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "693529dcefa2a6be78daa22bc82ae352a64c20f8",
            "filename": "tests/regressiontests/utils/archives/foobar.tar.bz2",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar.bz2",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar.bz2",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar.bz2?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "5b596bd58efd5d4146f91a1b6d69f9cd8a888db5",
            "filename": "tests/regressiontests/utils/archives/foobar.tar.gz",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar.gz",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar.gz",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.tar.gz?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "dc3e2fc0675de899be591ed479cff00c30e626f0",
            "filename": "tests/regressiontests/utils/archives/foobar.zip",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.zip",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.zip",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Farchives%2Ffoobar.zip?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f"
        },
        {
            "sha": "b80b1105850f4c328495f747203a243ab13051e5",
            "filename": "tests/regressiontests/utils/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Fregressiontests%2Futils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftests.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -24,3 +24,4 @@\n from .jslex import JsTokensTest, JsToCForGettextTest\n from .ipv6 import TestUtilsIPv6\n from .timezone import TimezoneTests\n+from .archive import TestZip, TestTar, TestGzipTar, TestBzip2Tar"
        },
        {
            "sha": "4cd603e29f9e43af76c703d75514f61ecc5e19fc",
            "filename": "tests/urls.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/a9a0f0b03f9a02deb03617bf7e9773a307d1328f/tests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Furls.py?ref=a9a0f0b03f9a02deb03617bf7e9773a307d1328f",
            "patch": "@@ -27,4 +27,7 @@\n     # admin custom URL tests\n     (r'^custom_urls/', include('regressiontests.admin_custom_urls.urls')),\n \n+    # admin custom URL tests\n+    (r'^admin_scripts/', include('regressiontests.admin_scripts.urls')),\n+\n )"
        }
    ],
    "stats": {
        "total": 1262,
        "additions": 996,
        "deletions": 266
    }
}