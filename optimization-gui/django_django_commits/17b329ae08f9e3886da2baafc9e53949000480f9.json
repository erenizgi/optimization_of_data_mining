{
    "author": "jezdez",
    "message": "Fixed #10004 and #12320 -- Enabled the makemessages management command to collect comments for translators that start with the \"Translators\" keyword. Thanks for the report and patches, martinb and Claude Paroz.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14595 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "17b329ae08f9e3886da2baafc9e53949000480f9",
    "files": [
        {
            "sha": "8c73d760afbd04b6e1c2b79af7792c560d952c80",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -196,7 +196,7 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                     'xgettext -d %s -L Perl %s --keyword=gettext_noop '\n                     '--keyword=gettext_lazy --keyword=ngettext_lazy:1,2 '\n                     '--keyword=pgettext:1c,2 --keyword=npgettext:1c,2,3 '\n-                    '--from-code UTF-8 -o - \"%s\"' % (\n+                    '--from-code UTF-8 --add-comments=Translators -o - \"%s\"' % (\n                         domain, wrap, os.path.join(dirpath, thefile)\n                     )\n                 )\n@@ -240,8 +240,9 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                     '--keyword=ugettext_noop --keyword=ugettext_lazy '\n                     '--keyword=ungettext_lazy:1,2 --keyword=pgettext:1c,2 '\n                     '--keyword=npgettext:1c,2,3 --keyword=pgettext_lazy:1c,2 '\n-                    '--keyword=npgettext_lazy:1c,2,3 --from-code UTF-8 -o - '\n-                    '\"%s\"' % (domain, wrap, os.path.join(dirpath, thefile))\n+                    '--keyword=npgettext_lazy:1c,2,3 --from-code UTF-8 '\n+                    '--add-comments=Translators -o - \"%s\"' % (\n+                        domain, wrap, os.path.join(dirpath, thefile))\n                 )\n                 msgs, errors = _popen(cmd)\n                 if errors:\n@@ -282,6 +283,8 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                     raise CommandError(\"errors happened while running msgmerge\\n%s\" % errors)\n             elif not invoked_for_django:\n                 msgs = copy_plural_forms(msgs, locale, domain, verbosity)\n+            msgs = msgs.replace(\n+                \"#. #-#-#-#-#  %s.pot (PACKAGE VERSION)  #-#-#-#-#\\n\" % domain, \"\")\n             f = open(pofile, 'wb')\n             try:\n                 f.write(msgs)"
        },
        {
            "sha": "319a521eb39397df1af6c7eb77070f6b6e732014",
            "filename": "django/template/__init__.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/django%2Ftemplate%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/django%2Ftemplate%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2F__init__.py?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -82,6 +82,7 @@\n VARIABLE_TAG_END = '}}'\n COMMENT_TAG_START = '{#'\n COMMENT_TAG_END = '#}'\n+TRANSLATOR_COMMENT_MARK = 'Translators'\n SINGLE_BRACE_START = '{'\n SINGLE_BRACE_END = '}'\n \n@@ -237,7 +238,10 @@ def create_token(self, token_string, in_tag):\n             elif token_string.startswith(BLOCK_TAG_START):\n                 token = Token(TOKEN_BLOCK, token_string[len(BLOCK_TAG_START):-len(BLOCK_TAG_END)].strip())\n             elif token_string.startswith(COMMENT_TAG_START):\n-                token = Token(TOKEN_COMMENT, '')\n+                content = ''\n+                if token_string.find(TRANSLATOR_COMMENT_MARK):\n+                    content = token_string[len(COMMENT_TAG_START):-len(COMMENT_TAG_END)].strip()\n+                token = Token(TOKEN_COMMENT, content)\n         else:\n             token = Token(TOKEN_TEXT, token_string)\n         return token"
        },
        {
            "sha": "832acc76e7372bddd5ea3a87b19a1ba0d81c0264",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -427,14 +427,23 @@ def templatize(src):\n     does so by translating the Django translation tags into standard gettext\n     function invocations.\n     \"\"\"\n-    from django.template import Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK\n+    from django.template import Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK, TOKEN_COMMENT\n     out = StringIO()\n     intrans = False\n     inplural = False\n     singular = []\n     plural = []\n+    incomment = False\n+    comment = []\n     for t in Lexer(src, None).tokenize():\n-        if intrans:\n+        if incomment:\n+            if t.token_type == TOKEN_BLOCK and t.contents == 'endcomment':\n+                out.write(' # %s' % ''.join(comment))\n+                incomment = False\n+                comment = []\n+            else:\n+                comment.append(t.contents)\n+        elif intrans:\n             if t.token_type == TOKEN_BLOCK:\n                 endbmatch = endblock_re.match(t.contents)\n                 pluralmatch = plural_re.match(t.contents)\n@@ -488,6 +497,8 @@ def templatize(src):\n                 elif cmatches:\n                     for cmatch in cmatches:\n                         out.write(' _(%s) ' % cmatch)\n+                elif t.contents == 'comment':\n+                    incomment = True\n                 else:\n                     out.write(blankout(t.contents, 'B'))\n             elif t.token_type == TOKEN_VAR:\n@@ -500,6 +511,8 @@ def templatize(src):\n                         out.write(' %s ' % p.split(':',1)[1])\n                     else:\n                         out.write(blankout(p, 'F'))\n+            elif t.token_type == TOKEN_COMMENT:\n+                out.write(' # %s' % t.contents)\n             else:\n                 out.write(blankout(t.contents, 'X'))\n     return out.getvalue()"
        },
        {
            "sha": "4f71564630f9be83e0b5497abf92780049af01a9",
            "filename": "docs/releases/1.3-alpha-2.txt",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/docs%2Freleases%2F1.3-alpha-2.txt",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/docs%2Freleases%2F1.3-alpha-2.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3-alpha-2.txt?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -39,6 +39,22 @@ See the :doc:`reference documentation of the app </ref/contrib/staticfiles>`\n for more details or learn how to :doc:`manage static files\n </howto/static-files>`.\n \n+Translation comments\n+~~~~~~~~~~~~~~~~~~~~\n+\n+If you would like to give translators hints about a translatable string, you\n+can add a comment prefixed with the ``Translators`` keyword on the line\n+preceding the string, e.g.::\n+\n+    def my_view(request):\n+        # Translators: This message appears on the home page only\n+        output = ugettext(\"Welcome to my site.\")\n+\n+The comment will appear in the resulting .po file and should also be\n+displayed by most translation tools.\n+\n+For more information, see :ref:`translator-comments`.\n+\n Backwards-incompatible changes in 1.3 alpha 2\n =============================================\n "
        },
        {
            "sha": "7c4622f9c51f73f1d1024e355cf615527fe37d92",
            "filename": "docs/releases/1.3.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/docs%2Freleases%2F1.3.txt",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/docs%2Freleases%2F1.3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3.txt?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -121,13 +121,17 @@ value, protect, or do nothing.\n For more information, see the :attr:`~django.db.models.ForeignKey.on_delete`\n documentation.\n \n-Contextual markers in translatable strings\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+Contextual markers and comments for translatable strings\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n For translation strings with ambiguous meaning, you can now\n use the ``pgettext`` function to specify the context of the string.\n \n-For more information, see :ref:`contextual-markers`\n+And if you just want to add some information for translators, you\n+can also add special translator comments in the source.\n+\n+For more information, see :ref:`contextual-markers` and\n+:ref:`translator-comments`.\n \n Everything else\n ~~~~~~~~~~~~~~~"
        },
        {
            "sha": "6d58813e758f47f7069a7ff4804be336a88a0d3b",
            "filename": "docs/topics/i18n/internationalization.txt",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Finternationalization.txt?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -100,6 +100,30 @@ instead of positional interpolation (e.g., ``%s`` or ``%d``) whenever you\n have more than a single parameter. If you used positional interpolation,\n translations wouldn't be able to reorder placeholder text.\n \n+.. _translator-comments:\n+\n+Comments for translators\n+------------------------\n+\n+.. versionadded:: 1.3\n+\n+If you would like to give translators hints about a translatable string, you\n+can add a comment prefixed with the ``Translators`` keyword on the line\n+preceding the string, e.g.::\n+\n+    def my_view(request):\n+        # Translators: This message appears on the home page only\n+        output = ugettext(\"Welcome to my site.\")\n+\n+This also works in templates with the :ttag:`comment` tag:\n+\n+.. code-block:: django+html\n+\n+    {% comment %}Translators: This is a text of the base template {% endcomment %}\n+\n+The comment will then appear in the resulting .po file and should also be\n+displayed by most translation tools.\n+\n Marking strings as no-op\n ------------------------\n "
        },
        {
            "sha": "ffd439140ea7f9949f9fc9f2e9ab8a266a8b29dc",
            "filename": "tests/regressiontests/i18n/commands/__init__.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/tests%2Fregressiontests%2Fi18n%2Fcommands%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/tests%2Fregressiontests%2Fi18n%2Fcommands%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2F__init__.py?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -0,0 +1,8 @@\n+from django.utils.translation import ugettext as _\n+\n+# Translators: This comment should be extracted\n+dummy1 = _(\"This is a translatable string.\")\n+\n+# This comment should not be extracted\n+dummy2 = _(\"This is another translatable string.\")\n+"
        },
        {
            "sha": "3e8d2d62282e4ba3466261c138e0f9594a5ffe5c",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -38,7 +38,18 @@ def assertNotMsgId(self, msgid, s, use_quotes=True):\n         return self.assert_(not re.search('^msgid %s' % msgid, s, re.MULTILINE))\n \n \n-class TemplateExtractorTests(ExtractorTests):\n+class BasicExtractorTests(ExtractorTests):\n+\n+    def test_comments_extractor(self):\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0)\n+        self.assert_(os.path.exists(self.PO_FILE))\n+        po_contents = open(self.PO_FILE, 'r').read()\n+        self.assert_('#. Translators: This comment should be extracted' in po_contents)\n+        self.assert_('This comment should not be extracted' not in po_contents)\n+        # Comments in templates\n+        self.assert_('#. Translators: Django template comment for translators' in po_contents)\n+        self.assert_('#. Translators: Django comment block for translators' in po_contents)\n \n     def test_templatize(self):\n         os.chdir(self.test_dir)"
        },
        {
            "sha": "ff8485ead56c85da9f38c8cd179f7d7e2e75c7ef",
            "filename": "tests/regressiontests/i18n/commands/templates/test.html",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/17b329ae08f9e3886da2baafc9e53949000480f9/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html",
            "raw_url": "https://github.com/django/django/raw/17b329ae08f9e3886da2baafc9e53949000480f9/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html?ref=17b329ae08f9e3886da2baafc9e53949000480f9",
            "patch": "@@ -1,5 +1,8 @@\n {% load i18n %}\n+{% comment %}Translators: Django comment block for translators {% endcomment %}\n {% trans \"This literal should be included.\" %}\n {% trans \"This literal should also be included wrapped or not wrapped depending on the use of the --no-wrap option.\" %}\n-{% blocktrans %}I think that 100% is more that 50% of anything.{% endblocktrans %}\n-{% blocktrans with 'txt' as obj %}I think that 100% is more that 50% of {{ obj }}.{% endblocktrans %}\n\\ No newline at end of file\n+\n+{# Translators: Django template comment for translators #}\n+<p>{% blocktrans %}I think that 100% is more that 50% of anything.{% endblocktrans %}</p>\n+{% blocktrans with 'txt' as obj %}I think that 100% is more that 50% of {{ obj }}.{% endblocktrans %}"
        }
    ],
    "stats": {
        "total": 110,
        "additions": 98,
        "deletions": 12
    }
}