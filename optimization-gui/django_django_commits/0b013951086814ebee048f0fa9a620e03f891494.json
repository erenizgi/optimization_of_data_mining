{
    "author": "andrewgodwin",
    "message": "Test that unique constraints get ported with column rename",
    "sha": "0b013951086814ebee048f0fa9a620e03f891494",
    "files": [
        {
            "sha": "053aa026f70f69095c034202ea4f5e221e217786",
            "filename": "tests/modeltests/schema/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/0b013951086814ebee048f0fa9a620e03f891494/tests%2Fmodeltests%2Fschema%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/0b013951086814ebee048f0fa9a620e03f891494/tests%2Fmodeltests%2Fschema%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fschema%2Fmodels.py?ref=0b013951086814ebee048f0fa9a620e03f891494",
            "patch": "@@ -37,6 +37,15 @@ class Meta:\n         managed = False\n \n \n+class TagUniqueRename(models.Model):\n+    title = models.CharField(max_length=255)\n+    slug2 = models.SlugField(unique=True)\n+\n+    class Meta:\n+        managed = False\n+        db_table = \"schema_tag\"\n+\n+\n class UniqueTest(models.Model):\n     year = models.IntegerField()\n     slug = models.SlugField(unique=False)"
        },
        {
            "sha": "18f1abad63676649c8d0bd78260f23ac4779d213",
            "filename": "tests/modeltests/schema/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/0b013951086814ebee048f0fa9a620e03f891494/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0b013951086814ebee048f0fa9a620e03f891494/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fschema%2Ftests.py?ref=0b013951086814ebee048f0fa9a620e03f891494",
            "patch": "@@ -6,7 +6,7 @@\n from django.db.models.fields import IntegerField, TextField, CharField, SlugField\n from django.db.models.fields.related import ManyToManyField\n from django.db.models.loading import cache\n-from .models import Author, Book, AuthorWithM2M, Tag, UniqueTest\n+from .models import Author, Book, AuthorWithM2M, Tag, TagUniqueRename, UniqueTest\n \n \n class SchemaTests(TestCase):\n@@ -297,6 +297,21 @@ def test_unique(self):\n         Tag.objects.create(title=\"foo\", slug=\"foo\")\n         self.assertRaises(IntegrityError, Tag.objects.create, title=\"bar\", slug=\"foo\")\n         connection.rollback()\n+        # Rename the field\n+        new_field = SlugField(unique=False)\n+        new_field.set_attributes_from_name(\"slug2\")\n+        editor = connection.schema_editor()\n+        editor.start()\n+        editor.alter_field(\n+            Tag,\n+            Tag._meta.get_field_by_name(\"slug\")[0],\n+            TagUniqueRename._meta.get_field_by_name(\"slug2\")[0],\n+        )\n+        editor.commit()\n+        # Ensure the field is still unique\n+        TagUniqueRename.objects.create(title=\"foo\", slug2=\"foo\")\n+        self.assertRaises(IntegrityError, TagUniqueRename.objects.create, title=\"bar\", slug2=\"foo\")\n+        connection.rollback()\n \n     def test_unique_together(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 26,
        "additions": 25,
        "deletions": 1
    }
}