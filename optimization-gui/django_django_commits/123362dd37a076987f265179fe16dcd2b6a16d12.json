{
    "author": "aaugustin",
    "message": "Fixed #18608 -- Reduced monkey-patching in tests.\n\nThanks Claude Paroz for the patch.",
    "sha": "123362dd37a076987f265179fe16dcd2b6a16d12",
    "files": [
        {
            "sha": "1398b43676fd980c2374ed8e5c0c4695badb9be2",
            "filename": "django/contrib/humanize/templatetags/humanize.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/123362dd37a076987f265179fe16dcd2b6a16d12/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "raw_url": "https://github.com/django/django/raw/123362dd37a076987f265179fe16dcd2b6a16d12/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py?ref=123362dd37a076987f265179fe16dcd2b6a16d12",
            "patch": "@@ -184,7 +184,7 @@ def naturaltime(value):\n         if delta.days != 0:\n             return pgettext(\n                 'naturaltime', '%(delta)s ago'\n-            ) % {'delta': defaultfilters.timesince(value)}\n+            ) % {'delta': defaultfilters.timesince(value, now)}\n         elif delta.seconds == 0:\n             return _('now')\n         elif delta.seconds < 60:\n@@ -206,7 +206,7 @@ def naturaltime(value):\n         if delta.days != 0:\n             return pgettext(\n                 'naturaltime', '%(delta)s from now'\n-            ) % {'delta': defaultfilters.timeuntil(value)}\n+            ) % {'delta': defaultfilters.timeuntil(value, now)}\n         elif delta.seconds == 0:\n             return _('now')\n         elif delta.seconds < 60:"
        },
        {
            "sha": "62df2be14344c1d3a36de54a263d3f614ba9aed8",
            "filename": "django/contrib/humanize/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/123362dd37a076987f265179fe16dcd2b6a16d12/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/123362dd37a076987f265179fe16dcd2b6a16d12/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftests.py?ref=123362dd37a076987f265179fe16dcd2b6a16d12",
            "patch": "@@ -130,7 +130,7 @@ class naive(datetime.tzinfo):\n             def utcoffset(self, dt):\n                 return None\n         # we're going to mock datetime.datetime, so use a fixed datetime\n-        now = datetime.datetime(2011, 8, 15)\n+        now = datetime.datetime(2011, 8, 15, 1, 23)\n         test_list = [\n             now,\n             now - datetime.timedelta(seconds=1),\n@@ -185,17 +185,11 @@ def now(self, tz=None):\n                     # equals now.replace(tzinfo=utc)\n                     return now.replace(tzinfo=tz) + tz.utcoffset(now)\n \n-        # naturaltime also calls timesince/timeuntil\n         from django.contrib.humanize.templatetags import humanize\n-        from django.utils import timesince\n         orig_humanize_datetime = humanize.datetime\n-        orig_timesince_datetime = timesince.datetime\n         humanize.datetime = MockDateTime\n-        timesince.datetime = new.module(b\"mock_datetime\")\n-        timesince.datetime.datetime = MockDateTime\n \n         try:\n             self.humanize_tester(test_list, result_list, 'naturaltime')\n         finally:\n             humanize.datetime = orig_humanize_datetime\n-            timesince.datetime = orig_timesince_datetime"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 3,
        "deletions": 9
    }
}