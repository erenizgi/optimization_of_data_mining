{
    "author": "alex",
    "message": "Began converting localflavor doctests into unittests, starting with the German ones.  Also introduced a new base class to facilitate ease of testing form fields. We have always been at war with doctests.  Thanks to Idan Gazit for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14626 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a3e7ee7c4037a390d6ab24932e53682d1c394191",
    "files": [
        {
            "sha": "7c68bcc129cdaa2a11b12260d27a4b0e82c6a25e",
            "filename": "tests/regressiontests/forms/localflavor/de.py",
            "status": "modified",
            "additions": 44,
            "deletions": 30,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fde.py",
            "raw_url": "https://github.com/django/django/raw/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fde.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fde.py?ref=a3e7ee7c4037a390d6ab24932e53682d1c394191",
            "patch": "@@ -1,35 +1,49 @@\n-# -*- coding: utf-8 -*-\n-# Tests for the contrib/localflavor/ DE form fields.\n+from django.contrib.localflavor.de.forms import (DEZipCodeField, DEStateSelect,\n+    DEIdentityCardNumberField)\n \n-tests = r\"\"\"\n-# DEZipCodeField ##############################################################\n+from utils import LocalFlavorTestCase\n \n->>> from django.contrib.localflavor.de.forms import DEZipCodeField\n->>> f = DEZipCodeField()\n->>> f.clean('99423')\n-u'99423'\n->>> f.clean(' 99423')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX.']\n \n-# DEStateSelect #############################################################\n+class DELocalFlavorTests(LocalFlavorTestCase):\n+    def test_DEStateSelect(self):\n+        f = DEStateSelect()\n+        out = u'''<select name=\"states\">\n+<option value=\"BW\">Baden-Wuerttemberg</option>\n+<option value=\"BY\">Bavaria</option>\n+<option value=\"BE\">Berlin</option>\n+<option value=\"BB\">Brandenburg</option>\n+<option value=\"HB\">Bremen</option>\n+<option value=\"HH\">Hamburg</option>\n+<option value=\"HE\">Hessen</option>\n+<option value=\"MV\">Mecklenburg-Western Pomerania</option>\n+<option value=\"NI\">Lower Saxony</option>\n+<option value=\"NW\">North Rhine-Westphalia</option>\n+<option value=\"RP\">Rhineland-Palatinate</option>\n+<option value=\"SL\">Saarland</option>\n+<option value=\"SN\">Saxony</option>\n+<option value=\"ST\">Saxony-Anhalt</option>\n+<option value=\"SH\">Schleswig-Holstein</option>\n+<option value=\"TH\" selected=\"selected\">Thuringia</option>\n+</select>'''\n+        self.assertEqual(f.render('states', 'TH'), out)\n \n->>> from django.contrib.localflavor.de.forms import DEStateSelect\n->>> w = DEStateSelect()\n->>> w.render('states', 'TH')\n-u'<select name=\"states\">\\n<option value=\"BW\">Baden-Wuerttemberg</option>\\n<option value=\"BY\">Bavaria</option>\\n<option value=\"BE\">Berlin</option>\\n<option value=\"BB\">Brandenburg</option>\\n<option value=\"HB\">Bremen</option>\\n<option value=\"HH\">Hamburg</option>\\n<option value=\"HE\">Hessen</option>\\n<option value=\"MV\">Mecklenburg-Western Pomerania</option>\\n<option value=\"NI\">Lower Saxony</option>\\n<option value=\"NW\">North Rhine-Westphalia</option>\\n<option value=\"RP\">Rhineland-Palatinate</option>\\n<option value=\"SL\">Saarland</option>\\n<option value=\"SN\">Saxony</option>\\n<option value=\"ST\">Saxony-Anhalt</option>\\n<option value=\"SH\">Schleswig-Holstein</option>\\n<option value=\"TH\" selected=\"selected\">Thuringia</option>\\n</select>'\n+    def test_DEZipCodeField(self):\n+        error_format = [u'Enter a zip code in the format XXXXX.']\n+        valid = {\n+            '99423': '99423',\n+        }\n+        invalid = {\n+            ' 99423': error_format,\n+        }\n+        self.assertFieldOutput(DEZipCodeField, valid, invalid)\n \n-# DEIdentityCardNumberField #################################################\n-\n->>> from django.contrib.localflavor.de.forms import DEIdentityCardNumberField\n->>> f = DEIdentityCardNumberField()\n->>> f.clean('7549313035D-6004103-0903042-0')\n-u'7549313035D-6004103-0903042-0'\n->>> f.clean('9786324830D 6104243 0910271 2')\n-u'9786324830D-6104243-0910271-2'\n->>> f.clean('0434657485D-6407276-0508137-9')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid German identity card number in XXXXXXXXXXX-XXXXXXX-XXXXXXX-X format.']\n-\"\"\"\n+    def test_DEIdentityCardNumberField(self):\n+        error_format = [u'Enter a valid German identity card number in XXXXXXXXXXX-XXXXXXX-XXXXXXX-X format.']\n+        valid = {\n+            '7549313035D-6004103-0903042-0': '7549313035D-6004103-0903042-0',\n+            '9786324830D 6104243 0910271 2': '9786324830D-6104243-0910271-2',\n+        }\n+        invalid = {\n+            '0434657485D-6407276-0508137-9': error_format,\n+        }\n+        self.assertFieldOutput(DEIdentityCardNumberField, valid, invalid)"
        },
        {
            "sha": "3297d4e10c7cd6dfbbc56f057ced3532124f4582",
            "filename": "tests/regressiontests/forms/localflavor/utils.py",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py?ref=a3e7ee7c4037a390d6ab24932e53682d1c394191",
            "patch": "@@ -0,0 +1,38 @@\n+from django.core.exceptions import ValidationError\n+from django.core.validators import EMPTY_VALUES\n+from django.utils.unittest import TestCase\n+\n+\n+class LocalFlavorTestCase(TestCase):\n+    def assertFieldOutput(self, fieldclass, valid, invalid):\n+        \"\"\"Asserts that a field behaves correctly with various inputs.\n+\n+        Args:\n+            fieldclass: the class of the field to be tested.\n+            valid: a dictionary mapping valid inputs to their expected\n+                    cleaned values.\n+            invalid: a dictionary mapping invalid inputs to one or more\n+                    raised error messages.\n+        \"\"\"\n+\n+        required = fieldclass()\n+        optional = fieldclass(required=False)\n+        # test valid inputs\n+        for input, output in valid.items():\n+            self.assertEqual(required.clean(input), output)\n+            self.assertEqual(optional.clean(input), output)\n+        # test invalid inputs\n+        for input, errors in invalid.items():\n+            self.assertRaisesRegexp(ValidationError, unicode(errors),\n+                required.clean, input\n+            )\n+            self.assertRaisesRegexp(ValidationError, unicode(errors),\n+                optional.clean, input\n+            )\n+        # test required inputs\n+        error_required = u'This field is required'\n+        for e in EMPTY_VALUES:\n+            self.assertRaisesRegexp(ValidationError, error_required,\n+                required.clean, e\n+            )\n+            self.assertEqual(optional.clean(e), u'')"
        },
        {
            "sha": "9dad13d096deb2e43e930d8446110728999496ac",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=a3e7ee7c4037a390d6ab24932e53682d1c394191",
            "patch": "@@ -7,7 +7,7 @@\n from localflavor.ch import tests as localflavor_ch_tests\n from localflavor.cl import tests as localflavor_cl_tests\n from localflavor.cz import tests as localflavor_cz_tests\n-from localflavor.de import tests as localflavor_de_tests\n+from localflavor.de import DELocalFlavorTests\n from localflavor.es import tests as localflavor_es_tests\n from localflavor.fi import tests as localflavor_fi_tests\n from localflavor.fr import tests as localflavor_fr_tests\n@@ -41,7 +41,6 @@\n     'localflavor_ch_tests': localflavor_ch_tests,\n     'localflavor_cl_tests': localflavor_cl_tests,\n     'localflavor_cz_tests': localflavor_cz_tests,\n-    'localflavor_de_tests': localflavor_de_tests,\n     'localflavor_es_tests': localflavor_es_tests,\n     'localflavor_fi_tests': localflavor_fi_tests,\n     'localflavor_fr_tests': localflavor_fr_tests,\n@@ -63,7 +62,3 @@\n     'localflavor_uy_tests': localflavor_uy_tests,\n     'localflavor_za_tests': localflavor_za_tests,\n }\n-\n-if __name__ == \"__main__\":\n-    import doctest\n-    doctest.testmod()"
        },
        {
            "sha": "fbd7a0d9a2447540062160b9e8cc6a6cfdd7a8f2",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a3e7ee7c4037a390d6ab24932e53682d1c394191/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=a3e7ee7c4037a390d6ab24932e53682d1c394191",
            "patch": "@@ -11,5 +11,5 @@\n from validators import TestFieldWithValidators\n from widgets import *\n \n-from regressiontests.forms.localflavortests import __test__\n-from regressiontests.forms.localflavortests import BETests, IsraelLocalFlavorTests\n+from regressiontests.forms.localflavortests import (__test__, BETests,\n+    DELocalFlavorTests, IsraelLocalFlavorTests)"
        }
    ],
    "stats": {
        "total": 123,
        "additions": 85,
        "deletions": 38
    }
}