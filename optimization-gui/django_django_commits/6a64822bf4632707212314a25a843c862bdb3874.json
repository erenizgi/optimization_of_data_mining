{
    "author": "aaugustin",
    "message": "Fixed #13222 -- Repeated iteration of HttpResponse\n\nThanks teepark for the report and grahamd for his insights.",
    "sha": "6a64822bf4632707212314a25a843c862bdb3874",
    "files": [
        {
            "sha": "49145cd82200bd8339e39b944b28684bac19f152",
            "filename": "django/http/response.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a64822bf4632707212314a25a843c862bdb3874/django%2Fhttp%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/6a64822bf4632707212314a25a843c862bdb3874/django%2Fhttp%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fresponse.py?ref=6a64822bf4632707212314a25a843c862bdb3874",
            "patch": "@@ -260,9 +260,9 @@ def content(self, value):\n         else:\n             self._container = [value]\n             self._base_content_is_iter = False\n+        self._iterator = iter(self._container)\n \n     def __iter__(self):\n-        self._iterator = iter(self._container)\n         return self\n \n     def __next__(self):\n@@ -284,7 +284,7 @@ def write(self, content):\n     def tell(self):\n         if self._base_content_is_iter:\n             raise Exception(\"This %s instance cannot tell its position\" % self.__class__.__name__)\n-        return sum([len(chunk) for chunk in self])\n+        return len(self.content)\n \n \n class StreamingHttpResponse(HttpResponseBase):"
        },
        {
            "sha": "803cbf029f95dbe5d7e6ebdf4755621f624de497",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a64822bf4632707212314a25a843c862bdb3874/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a64822bf4632707212314a25a843c862bdb3874/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=6a64822bf4632707212314a25a843c862bdb3874",
            "patch": "@@ -330,6 +330,13 @@ def test_iter_content(self):\n         self.assertRaises(UnicodeEncodeError,\n                           getattr, r, 'content')\n \n+    def test_iterator_isnt_rewound(self):\n+        # Regression test for #13222\n+        r = HttpResponse('abc')\n+        i = iter(r)\n+        self.assertEqual(list(i), [b'abc'])\n+        self.assertEqual(list(i), [])\n+\n     def test_file_interface(self):\n         r = HttpResponse()\n         r.write(b\"hello\")"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 9,
        "deletions": 2
    }
}