{
    "author": "alex",
    "message": "Fixed #14859 -- ITSocialSecurityNumberField and ITVatNumberField didn't handle all EMPTY_VALUES gracefully.  Also converted the Italias localflavor doctests into unittests.  We have always been at war with doctests.  Thanks to Idan Gazit.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14945 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f8caeefff193e4ace0db13c7213194be933584f7",
    "files": [
        {
            "sha": "bf0227608ae0fefba71f3cb03dd5773e969f6dbc",
            "filename": "django/contrib/localflavor/it/forms.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/f8caeefff193e4ace0db13c7213194be933584f7/django%2Fcontrib%2Flocalflavor%2Fit%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/f8caeefff193e4ace0db13c7213194be933584f7/django%2Fcontrib%2Flocalflavor%2Fit%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fit%2Fforms.py?ref=f8caeefff193e4ace0db13c7213194be933584f7",
            "patch": "@@ -50,8 +50,8 @@ def __init__(self, *args, **kwargs):\n \n     def clean(self, value):\n         value = super(ITSocialSecurityNumberField, self).clean(value)\n-        if value == u'':\n-            return value\n+        if value in EMPTY_VALUES:\n+            return u''\n         value = re.sub('\\s', u'', value).upper()\n         try:\n             check_digit = ssn_check_digit(value)\n@@ -71,8 +71,8 @@ class ITVatNumberField(Field):\n \n     def clean(self, value):\n         value = super(ITVatNumberField, self).clean(value)\n-        if value == u'':\n-            return value\n+        if value in EMPTY_VALUES:\n+            return u''\n         try:\n             vat_number = int(value)\n         except ValueError:"
        },
        {
            "sha": "7181e25e84e1ad1e7a8c960ad28eefa19572be04",
            "filename": "tests/regressiontests/forms/localflavor/it.py",
            "status": "modified",
            "additions": 65,
            "deletions": 57,
            "changes": 122,
            "blob_url": "https://github.com/django/django/blob/f8caeefff193e4ace0db13c7213194be933584f7/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fit.py",
            "raw_url": "https://github.com/django/django/raw/f8caeefff193e4ace0db13c7213194be933584f7/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fit.py?ref=f8caeefff193e4ace0db13c7213194be933584f7",
            "patch": "@@ -1,62 +1,70 @@\n-# -*- coding: utf-8 -*-\n-# Tests for the contrib/localflavor/ IT form fields.\n+from django.contrib.localflavor.it.forms import (ITZipCodeField, ITRegionSelect,\n+    ITSocialSecurityNumberField, ITVatNumberField)\n \n-tests = r\"\"\"\n-# ITZipCodeField #############################################################\n+from utils import LocalFlavorTestCase\n \n->>> from django.contrib.localflavor.it.forms import ITZipCodeField\n->>> f = ITZipCodeField()\n->>> f.clean('00100')\n-u'00100'\n->>> f.clean(' 00100')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid zip code.']\n \n-# ITRegionSelect #############################################################\n+class ITLocalFlavorTests(LocalFlavorTestCase):\n+    def test_ITRegionSelect(self):\n+        f = ITRegionSelect()\n+        out = u'''<select name=\"regions\">\n+<option value=\"ABR\">Abruzzo</option>\n+<option value=\"BAS\">Basilicata</option>\n+<option value=\"CAL\">Calabria</option>\n+<option value=\"CAM\">Campania</option>\n+<option value=\"EMR\">Emilia-Romagna</option>\n+<option value=\"FVG\">Friuli-Venezia Giulia</option>\n+<option value=\"LAZ\">Lazio</option>\n+<option value=\"LIG\">Liguria</option>\n+<option value=\"LOM\">Lombardia</option>\n+<option value=\"MAR\">Marche</option>\n+<option value=\"MOL\">Molise</option>\n+<option value=\"PMN\" selected=\"selected\">Piemonte</option>\n+<option value=\"PUG\">Puglia</option>\n+<option value=\"SAR\">Sardegna</option>\n+<option value=\"SIC\">Sicilia</option>\n+<option value=\"TOS\">Toscana</option>\n+<option value=\"TAA\">Trentino-Alto Adige</option>\n+<option value=\"UMB\">Umbria</option>\n+<option value=\"VAO\">Valle d\\u2019Aosta</option>\n+<option value=\"VEN\">Veneto</option>\n+</select>'''\n+        self.assertEqual(f.render('regions', 'PMN'), out)\n \n->>> from django.contrib.localflavor.it.forms import ITRegionSelect\n->>> w = ITRegionSelect()\n->>> w.render('regions', 'PMN')\n-u'<select name=\"regions\">\\n<option value=\"ABR\">Abruzzo</option>\\n<option value=\"BAS\">Basilicata</option>\\n<option value=\"CAL\">Calabria</option>\\n<option value=\"CAM\">Campania</option>\\n<option value=\"EMR\">Emilia-Romagna</option>\\n<option value=\"FVG\">Friuli-Venezia Giulia</option>\\n<option value=\"LAZ\">Lazio</option>\\n<option value=\"LIG\">Liguria</option>\\n<option value=\"LOM\">Lombardia</option>\\n<option value=\"MAR\">Marche</option>\\n<option value=\"MOL\">Molise</option>\\n<option value=\"PMN\" selected=\"selected\">Piemonte</option>\\n<option value=\"PUG\">Puglia</option>\\n<option value=\"SAR\">Sardegna</option>\\n<option value=\"SIC\">Sicilia</option>\\n<option value=\"TOS\">Toscana</option>\\n<option value=\"TAA\">Trentino-Alto Adige</option>\\n<option value=\"UMB\">Umbria</option>\\n<option value=\"VAO\">Valle d\\u2019Aosta</option>\\n<option value=\"VEN\">Veneto</option>\\n</select>'\n+    def test_ITZipCodeField(self):\n+        error_invalid = [u'Enter a valid zip code.']\n+        valid = {\n+            '00100': '00100',\n+        }\n+        invalid = {\n+            ' 00100': error_invalid,\n+        }\n+        self.assertFieldOutput(ITZipCodeField, valid, invalid)\n+    \n+    def test_ITSocialSecurityNumberField(self):\n+        error_invalid = [u'Enter a valid Social Security number.']\n+        valid = {\n+            'LVSGDU99T71H501L': 'LVSGDU99T71H501L',\n+            'LBRRME11A01L736W': 'LBRRME11A01L736W',\n+            'lbrrme11a01l736w': 'LBRRME11A01L736W',\n+            'LBR RME 11A01 L736W': 'LBRRME11A01L736W',\n+        }\n+        invalid = {\n+            'LBRRME11A01L736A': error_invalid,\n+            '%BRRME11A01L736W': error_invalid,\n+        }\n+        self.assertFieldOutput(ITSocialSecurityNumberField, valid, invalid)\n+    \n+    def test_ITVatNumberField(self):\n+        error_invalid = [u'Enter a valid VAT number.']\n+        valid = {\n+            '07973780013': '07973780013',\n+            '7973780013': '07973780013',\n+            7973780013: '07973780013',\n+        }\n+        invalid = {\n+            '07973780014': error_invalid,\n+            'A7973780013': error_invalid,\n+        }\n+        self.assertFieldOutput(ITVatNumberField, valid, invalid)\n \n-# ITSocialSecurityNumberField #################################################\n-\n->>> from django.contrib.localflavor.it.forms import ITSocialSecurityNumberField\n->>> f = ITSocialSecurityNumberField()\n->>> f.clean('LVSGDU99T71H501L')\n-u'LVSGDU99T71H501L'\n->>> f.clean('LBRRME11A01L736W')\n-u'LBRRME11A01L736W'\n->>> f.clean('lbrrme11a01l736w')\n-u'LBRRME11A01L736W'\n->>> f.clean('LBR RME 11A01 L736W')\n-u'LBRRME11A01L736W'\n->>> f.clean('LBRRME11A01L736A')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Social Security number.']\n->>> f.clean('%BRRME11A01L736W')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Social Security number.']\n-\n-# ITVatNumberField ###########################################################\n-\n->>> from django.contrib.localflavor.it.forms import ITVatNumberField\n->>> f = ITVatNumberField()\n->>> f.clean('07973780013')\n-u'07973780013'\n->>> f.clean('7973780013')\n-u'07973780013'\n->>> f.clean(7973780013)\n-u'07973780013'\n->>> f.clean('07973780014')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid VAT number.']\n->>> f.clean('A7973780013')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid VAT number.']\n-\"\"\""
        },
        {
            "sha": "e7d5637392f5c80f9932914351af85b79776661d",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/f8caeefff193e4ace0db13c7213194be933584f7/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/f8caeefff193e4ace0db13c7213194be933584f7/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=f8caeefff193e4ace0db13c7213194be933584f7",
            "patch": "@@ -1,6 +1,5 @@\n # -*- coding: utf-8 -*-\n from localflavor.cz import tests as localflavor_cz_tests\n-from localflavor.it import tests as localflavor_it_tests\n from localflavor.jp import tests as localflavor_jp_tests\n from localflavor.kw import tests as localflavor_kw_tests\n from localflavor.nl import tests as localflavor_nl_tests\n@@ -31,12 +30,12 @@\n from localflavor.ie import IELocalFlavorTests\n from localflavor.il import ILLocalFlavorTests\n from localflavor.is_ import ISLocalFlavorTests\n+from localflavor.it import ITLocalFlavorTests\n from localflavor.tr import TRLocalFlavorTests\n \n \n __test__ = {\n     'localflavor_cz_tests': localflavor_cz_tests,\n-    'localflavor_it_tests': localflavor_it_tests,\n     'localflavor_jp_tests': localflavor_jp_tests,\n     'localflavor_kw_tests': localflavor_kw_tests,\n     'localflavor_nl_tests': localflavor_nl_tests,"
        },
        {
            "sha": "345ed855f51badd8cd8c64d6cebb30a8dbdffd21",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/f8caeefff193e4ace0db13c7213194be933584f7/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/f8caeefff193e4ace0db13c7213194be933584f7/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=f8caeefff193e4ace0db13c7213194be933584f7",
            "patch": "@@ -30,5 +30,6 @@\n     IELocalFlavorTests,\n     ILLocalFlavorTests,\n     ISLocalFlavorTests,\n+    ITLocalFlavorTests,\n     TRLocalFlavorTests,\n )"
        }
    ],
    "stats": {
        "total": 134,
        "additions": 71,
        "deletions": 63
    }
}