{
    "author": "freakboy3742",
    "message": "Fixed #14655 -- Made formsets iterable. This allows a slightly more natural iteration API (`for form in formsets`), and allows you to easily override the form rendering order. Thanks to Kent Hauser for the suggestion and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14986 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "7adffaeaf6dfa22db0b6b2a29632b9150c7ac732",
    "files": [
        {
            "sha": "d7601ca45a2bc5282fe5dd8ccb023fdc6e038551",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=7adffaeaf6dfa22db0b6b2a29632b9150c7ac732",
            "patch": "@@ -216,6 +216,7 @@ answer newbie questions, and generally made Django that much better:\n     Brant Harris\n     Ronny Haryanto <http://ronny.haryan.to/>\n     Hawkeye\n+    Kent Hauser <kent@khauser.net>\n     Joe Heck <http://www.rhonabwy.com/wp/>\n     Joel Heenan <joelh-django@planetjoel.com>\n     Mikko Hellsing <mikko@sorl.net>"
        },
        {
            "sha": "9a1b5a8cacdf5c591e98825cdba2da1d35b5a1dd",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=7adffaeaf6dfa22db0b6b2a29632b9150c7ac732",
            "patch": "@@ -49,6 +49,17 @@ def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n     def __unicode__(self):\n         return self.as_table()\n \n+    def __iter__(self):\n+        \"\"\"Yields the forms in the order they should be rendered\"\"\"\n+        return iter(self.forms)\n+\n+    def __getitem__(self, index):\n+        \"\"\"Returns the form at the given index, based on the rendering order\"\"\"\n+        return list(self)[index]\n+\n+    def __len__(self):\n+        return len(self.forms)\n+\n     def _management_form(self):\n         \"\"\"Returns the ManagementForm instance for this FormSet.\"\"\"\n         if self.is_bound:\n@@ -323,17 +334,17 @@ def as_table(self):\n         # XXX: there is no semantic division between forms here, there\n         # probably should be. It might make sense to render each form as a\n         # table row with each field as a td.\n-        forms = u' '.join([form.as_table() for form in self.forms])\n+        forms = u' '.join([form.as_table() for form in self])\n         return mark_safe(u'\\n'.join([unicode(self.management_form), forms]))\n \n     def as_p(self):\n         \"Returns this formset rendered as HTML <p>s.\"\n-        forms = u' '.join([form.as_p() for form in self.forms])\n+        forms = u' '.join([form.as_p() for form in self])\n         return mark_safe(u'\\n'.join([unicode(self.management_form), forms]))\n \n     def as_ul(self):\n         \"Returns this formset rendered as HTML <li>s.\"\n-        forms = u' '.join([form.as_ul() for form in self.forms])\n+        forms = u' '.join([form.as_ul() for form in self])\n         return mark_safe(u'\\n'.join([unicode(self.management_form), forms]))\n \n def formset_factory(form, formset=BaseFormSet, extra=1, can_order=False,"
        },
        {
            "sha": "8280c7736f789a33b458500d5c887e8a47bbdaf2",
            "filename": "docs/topics/forms/formsets.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 7,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "raw_url": "https://github.com/django/django/raw/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fformsets.txt?ref=7adffaeaf6dfa22db0b6b2a29632b9150c7ac732",
            "patch": "@@ -23,7 +23,7 @@ the ability to iterate over the forms in the formset and display them as you\n would with a regular form::\n \n     >>> formset = ArticleFormSet()\n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ...     print form.as_table()\n     <tr><th><label for=\"id_form-0-title\">Title:</label></th><td><input type=\"text\" name=\"form-0-title\" id=\"id_form-0-title\" /></td></tr>\n     <tr><th><label for=\"id_form-0-pub_date\">Pub date:</label></th><td><input type=\"text\" name=\"form-0-pub_date\" id=\"id_form-0-pub_date\" /></td></tr>\n@@ -35,6 +35,20 @@ display two blank forms::\n \n     >>> ArticleFormSet = formset_factory(ArticleForm, extra=2)\n \n+.. versionchanged:: 1.3\n+\n+Prior to Django 1.3, formset instances were not iterable. To render\n+the formset you iterated over the ``forms`` attribute::\n+\n+    >>> formset = ArticleFormSet()\n+    >>> for form in formset.forms:\n+    ...     print form.as_table()\n+\n+Iterating over ``formset.forms`` will render the forms in the order\n+they were created. The default formset iterator also renders the forms\n+in this order, but you can change this order by providing an alternate\n+implementation for the :method:`__iter__()` method.\n+\n Using initial data with a formset\n ---------------------------------\n \n@@ -50,7 +64,7 @@ example::\n     ...      'pub_date': datetime.date.today()},\n     ... ])\n \n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ...     print form.as_table()\n     <tr><th><label for=\"id_form-0-title\">Title:</label></th><td><input type=\"text\" name=\"form-0-title\" value=\"Django is now open source\" id=\"id_form-0-title\" /></td></tr>\n     <tr><th><label for=\"id_form-0-pub_date\">Pub date:</label></th><td><input type=\"text\" name=\"form-0-pub_date\" value=\"2008-05-12\" id=\"id_form-0-pub_date\" /></td></tr>\n@@ -77,7 +91,7 @@ limit the maximum number of empty forms the formset will display::\n \n     >>> ArticleFormSet = formset_factory(ArticleForm, extra=2, max_num=1)\n     >>> formset = ArticleFormset()\n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ...     print form.as_table()\n     <tr><th><label for=\"id_form-0-title\">Title:</label></th><td><input type=\"text\" name=\"form-0-title\" id=\"id_form-0-title\" /></td></tr>\n     <tr><th><label for=\"id_form-0-pub_date\">Pub date:</label></th><td><input type=\"text\" name=\"form-0-pub_date\" id=\"id_form-0-pub_date\" /></td></tr>\n@@ -250,7 +264,7 @@ Lets create a formset with the ability to order::\n     ...     {'title': u'Article #1', 'pub_date': datetime.date(2008, 5, 10)},\n     ...     {'title': u'Article #2', 'pub_date': datetime.date(2008, 5, 11)},\n     ... ])\n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ...     print form.as_table()\n     <tr><th><label for=\"id_form-0-title\">Title:</label></th><td><input type=\"text\" name=\"form-0-title\" value=\"Article #1\" id=\"id_form-0-title\" /></td></tr>\n     <tr><th><label for=\"id_form-0-pub_date\">Pub date:</label></th><td><input type=\"text\" name=\"form-0-pub_date\" value=\"2008-05-10\" id=\"id_form-0-pub_date\" /></td></tr>\n@@ -306,7 +320,7 @@ Lets create a formset with the ability to delete::\n     ...     {'title': u'Article #1', 'pub_date': datetime.date(2008, 5, 10)},\n     ...     {'title': u'Article #2', 'pub_date': datetime.date(2008, 5, 11)},\n     ... ])\n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ....    print form.as_table()\n     <input type=\"hidden\" name=\"form-TOTAL_FORMS\" value=\"3\" id=\"id_form-TOTAL_FORMS\" /><input type=\"hidden\" name=\"form-INITIAL_FORMS\" value=\"2\" id=\"id_form-INITIAL_FORMS\" /><input type=\"hidden\" name=\"form-MAX_NUM_FORMS\" id=\"id_form-MAX_NUM_FORMS\" />\n     <tr><th><label for=\"id_form-0-title\">Title:</label></th><td><input type=\"text\" name=\"form-0-title\" value=\"Article #1\" id=\"id_form-0-title\" /></td></tr>\n@@ -360,7 +374,7 @@ default fields/attributes of the order and deletion fields::\n \n     >>> ArticleFormSet = formset_factory(ArticleForm, formset=BaseArticleFormSet)\n     >>> formset = ArticleFormSet()\n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ...     print form.as_table()\n     <tr><th><label for=\"id_form-0-title\">Title:</label></th><td><input type=\"text\" name=\"form-0-title\" id=\"id_form-0-title\" /></td></tr>\n     <tr><th><label for=\"id_form-0-pub_date\">Pub date:</label></th><td><input type=\"text\" name=\"form-0-pub_date\" id=\"id_form-0-pub_date\" /></td></tr>\n@@ -393,7 +407,7 @@ The ``manage_articles.html`` template might look like this:\n     <form method=\"post\" action=\"\">\n         {{ formset.management_form }}\n         <table>\n-            {% for form in formset.forms %}\n+            {% for form in formset %}\n             {{ form }}\n             {% endfor %}\n         </table>"
        },
        {
            "sha": "eb55aaf3970e8f644e5db3afc8b2ba8be66ce644",
            "filename": "docs/topics/forms/modelforms.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "raw_url": "https://github.com/django/django/raw/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmodelforms.txt?ref=7adffaeaf6dfa22db0b6b2a29632b9150c7ac732",
            "patch": "@@ -684,7 +684,7 @@ so long as the total number of forms does not exceed ``max_num``::\n \n     >>> AuthorFormSet = modelformset_factory(Author, max_num=4, extra=2)\n     >>> formset = AuthorFormSet(queryset=Author.objects.order_by('name'))\n-    >>> for form in formset.forms:\n+    >>> for form in formset:\n     ...     print form.as_table()\n     <tr><th><label for=\"id_form-0-name\">Name:</label></th><td><input id=\"id_form-0-name\" type=\"text\" name=\"form-0-name\" value=\"Charles Baudelaire\" maxlength=\"100\" /><input type=\"hidden\" name=\"form-0-id\" value=\"1\" id=\"id_form-0-id\" /></td></tr>\n     <tr><th><label for=\"id_form-1-name\">Name:</label></th><td><input id=\"id_form-1-name\" type=\"text\" name=\"form-1-name\" value=\"Paul Verlaine\" maxlength=\"100\" /><input type=\"hidden\" name=\"form-1-id\" value=\"3\" id=\"id_form-1-id\" /></td></tr>\n@@ -778,7 +778,7 @@ itself::\n \n     <form method=\"post\" action=\"\">\n         {{ formset.management_form }}\n-        {% for form in formset.forms %}\n+        {% for form in formset %}\n             {{ form }}\n         {% endfor %}\n     </form>\n@@ -791,7 +791,7 @@ Third, you can manually render each field::\n \n     <form method=\"post\" action=\"\">\n         {{ formset.management_form }}\n-        {% for form in formset.forms %}\n+        {% for form in formset %}\n             {% for field in form %}\n                 {{ field.label_tag }}: {{ field }}\n             {% endfor %}\n@@ -804,7 +804,7 @@ if you were rendering the ``name`` and ``age`` fields of a model::\n \n     <form method=\"post\" action=\"\">\n         {{ formset.management_form }}\n-        {% for form in formset.forms %}\n+        {% for form in formset %}\n             {{ form.id }}\n             <ul>\n                 <li>{{ form.name }}</li>"
        },
        {
            "sha": "4050231844ff610af04a8c7d224eda5b7f19ce10",
            "filename": "tests/regressiontests/forms/tests/formsets.py",
            "status": "modified",
            "additions": 34,
            "deletions": 2,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/7adffaeaf6dfa22db0b6b2a29632b9150c7ac732/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py?ref=7adffaeaf6dfa22db0b6b2a29632b9150c7ac732",
            "patch": "@@ -767,6 +767,38 @@ def test_regression_12878(self):\n         self.assertFalse(formset.is_valid())\n         self.assertEqual(formset.non_form_errors(), [u'You may only specify a drink once.'])\n \n+    def test_formset_iteration(self):\n+        # Regression tests for #16455 -- formset instances are iterable\n+        ChoiceFormset = formset_factory(Choice, extra=3)\n+        formset = ChoiceFormset()\n+\n+        # confirm iterated formset yields formset.forms\n+        forms = list(formset)\n+        self.assertEqual(forms, formset.forms)\n+        self.assertEqual(len(formset), len(forms))\n+\n+        # confirm indexing of formset\n+        self.assertEqual(formset[0], forms[0])\n+        try:\n+            formset[3]\n+            self.fail('Requesting an invalid formset index should raise an exception')\n+        except IndexError:\n+            pass\n+\n+        # Formets can override the default iteration order\n+        class BaseReverseFormSet(BaseFormSet):\n+            def __iter__(self):\n+                for form in reversed(self.forms):\n+                    yield form\n+\n+        ReverseChoiceFormset = formset_factory(Choice, BaseReverseFormSet, extra=3)\n+        reverse_formset = ReverseChoiceFormset()\n+\n+        # confirm that __iter__ modifies rendering order\n+        # compare forms from \"reverse\" formset with forms from original formset\n+        self.assertEqual(str(reverse_formset[0]), str(forms[-1]))\n+        self.assertEqual(str(reverse_formset[1]), str(forms[-2]))\n+        self.assertEqual(len(reverse_formset), len(forms))\n \n data = {\n     'choices-TOTAL_FORMS': '1', # the number of forms rendered\n@@ -802,7 +834,7 @@ def test_as_ul(self):\n <li>Votes: <input type=\"text\" name=\"choices-0-votes\" value=\"100\" /></li>\"\"\")\n \n \n-# Regression test for #11418 ################################################# \n+# Regression test for #11418 #################################################\n class ArticleForm(Form):\n     title = CharField()\n     pub_date = DateField()\n@@ -835,7 +867,7 @@ def test_form_errors_are_cought_by_formset(self):\n             'form-0-title': u'Test',\n             'form-0-pub_date': u'1904-06-16',\n             'form-1-title': u'Test',\n-            'form-1-pub_date': u'', # <-- this date is missing but required \n+            'form-1-pub_date': u'', # <-- this date is missing but required\n         }\n         formset = ArticleFormSet(data)\n         self.assertFalse(formset.is_valid())"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 74,
        "deletions": 16
    }
}