{
    "author": "jezdez",
    "message": "Fixed #9847 -- Added 403 response handler. Many thanks to kgrandis, adamnelson, vkryachko, fvox13  and Chris Beaven.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16606 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "1ca6e9b9e24240033349c93b05902c79c0a25bbb",
    "files": [
        {
            "sha": "6d1d479a11af3622fbfc374fb3d613169cb0001e",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -457,6 +457,7 @@ answer newbie questions, and generally made Django that much better:\n     Ben Slavin <benjamin.slavin@gmail.com>\n     sloonz <simon.lipp@insa-lyon.fr>\n     Paul Smith <blinkylights23@gmail.com>\n+    Steven L. Smith (fvox13) <steven@stevenlsmith.com>\n     Warren Smith <warren@wandrsmith.net>\n     smurf@smurf.noris.de\n     Vsevolod Solovyov"
        },
        {
            "sha": "19f423009784f519042e5315e1c2f7fd7ea63c15",
            "filename": "django/conf/urls/defaults.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fconf%2Furls%2Fdefaults.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fconf%2Furls%2Fdefaults.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Furls%2Fdefaults.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -6,6 +6,7 @@\n \n __all__ = ['handler404', 'handler500', 'include', 'patterns', 'url']\n \n+handler403 = 'django.views.defaults.permission_denied'\n handler404 = 'django.views.defaults.page_not_found'\n handler500 = 'django.views.defaults.server_error'\n "
        },
        {
            "sha": "a6c8044a061f2583c0a6ab4342af7f38d9d140b0",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -154,12 +154,22 @@ def get_response(self, request):\n                         finally:\n                             receivers = signals.got_request_exception.send(sender=self.__class__, request=request)\n             except exceptions.PermissionDenied:\n-                logger.warning('Forbidden (Permission denied): %s' % request.path,\n-                            extra={\n-                                'status_code': 403,\n-                                'request': request\n-                            })\n-                response = http.HttpResponseForbidden('<h1>Permission denied</h1>')\n+                logger.warning(\n+                    'Forbidden (Permission denied): %s' % request.path,\n+                    extra={\n+                        'status_code': 403,\n+                        'request': request\n+                    })\n+                try:\n+                    callback, param_dict = resolver.resolve403()\n+                    response = callback(request, **param_dict)\n+                except:\n+                    try:\n+                        response = self.handle_uncaught_exception(request,\n+                            resolver, sys.exc_info())\n+                    finally:\n+                        receivers = signals.got_request_exception.send(\n+                            sender=self.__class__, request=request)\n             except SystemExit:\n                 # Allow sys.exit() to actually exit. See tickets #1023 and #4701\n                 raise"
        },
        {
            "sha": "73b074f6bebee68672cf58807f7061b049bd6c53",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -331,6 +331,9 @@ def _resolve_special(self, view_type):\n             callback = getattr(defaults, 'handler%s' % view_type)\n         return get_callable(callback), {}\n \n+    def resolve403(self):\n+        return self._resolve_special('403')\n+\n     def resolve404(self):\n         return self._resolve_special('404')\n "
        },
        {
            "sha": "a6d6a624eb9240fdaab69e4fecada4f42b7774bc",
            "filename": "django/views/defaults.py",
            "status": "modified",
            "additions": 26,
            "deletions": 3,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fviews%2Fdefaults.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/django%2Fviews%2Fdefaults.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdefaults.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -1,10 +1,12 @@\n from django import http\n+from django.template import (Context, RequestContext,\n+                             loader, TemplateDoesNotExist)\n from django.views.decorators.csrf import requires_csrf_token\n-from django.template import Context, RequestContext, loader\n \n \n-# This can be called when CsrfViewMiddleware.process_view has not run, therefore\n-# need @requires_csrf_token in case the template needs {% csrf_token %}.\n+# This can be called when CsrfViewMiddleware.process_view has not run,\n+# therefore need @requires_csrf_token in case the template needs\n+# {% csrf_token %}.\n @requires_csrf_token\n def page_not_found(request, template_name='404.html'):\n     \"\"\"\n@@ -31,6 +33,27 @@ def server_error(request, template_name='500.html'):\n     return http.HttpResponseServerError(t.render(Context({})))\n \n \n+# This can be called when CsrfViewMiddleware.process_view has not run,\n+# therefore need @requires_csrf_token in case the template needs\n+# {% csrf_token %}.\n+@requires_csrf_token\n+def permission_denied(request, template_name='403.html'):\n+    \"\"\"\n+    Permission denied (403) handler.\n+\n+    Templates: `403.html`\n+    Context: None\n+\n+    If the template does not exist, an Http403 response containing the text\n+    \"403 Forbidden\" (as per RFC 2616) will be returned.\n+    \"\"\"\n+    try:\n+        template = loader.get_template(template_name)\n+    except TemplateDoesNotExist:\n+        return http.HttpResponseForbidden('<h1>403 Forbidden</h1>')\n+    return http.HttpResponseForbidden(template.render(RequestContext(request)))\n+\n+\n def shortcut(request, content_type_id, object_id):\n     # TODO: Remove this in Django 2.0.\n     # This is a legacy view that depends on the contenttypes framework."
        },
        {
            "sha": "d676ff045c93268daa47f87dabeedccae597d281",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -261,6 +261,11 @@ Django 1.4 also includes several smaller improvements worth noting:\n * It is now possible to load fixtures containing forward references when using\n   MySQL with the InnoDB database engine.\n \n+* A new 403 response handler has been added as\n+  ``'django.views.defaults.permission_denied'``. See the documentation\n+  about :ref:`the 403 (HTTP Forbidden) view<http_forbidden_view>` for more\n+  information.\n+\n .. _backwards-incompatible-changes-1.4:\n \n Backwards incompatible changes in 1.4"
        },
        {
            "sha": "6e033f3bc98dad99e591ed713d8a966d9d8f5c60",
            "filename": "docs/topics/http/views.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fviews.txt?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -197,3 +197,24 @@ Two things to note about 500 views:\n     * If :setting:`DEBUG` is set to ``True`` (in your settings module), then\n       your 500 view will never be used, and the traceback will be displayed\n       instead, with some debug information.\n+\n+.. _http_forbidden_view:\n+\n+The 403 (HTTP Forbidden) view\n+----------------------------\n+\n+.. versionadded:: 1.4\n+\n+In the same vein as the 404 and 500 views, Django has a view to handle 403\n+Forbidden errors. If a view results in a 403 exception then Django will, by\n+default, call the view ``django.views.defaults.permission_denied``.\n+\n+This view loads and renders the template ``403.html`` in your root template\n+directory, or if this file does not exist, instead serves the text\n+\"403 Forbidden\", as per RFC 2616 (the HTTP 1.1 Specification).\n+\n+It is possible to override ``django.views.defaults.permission_denied`` in the\n+same way you can for the 404 and 500 views by specifying a ``handler403`` in\n+your URLconf::\n+\n+    handler403 = 'mysite.views.my_custom_permission_denied_view'"
        },
        {
            "sha": "fc5325d7d78b0368b990567b008520c8140cd431",
            "filename": "tests/regressiontests/views/tests/debug.py",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -6,6 +6,8 @@\n from django.conf import settings\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.test import TestCase, RequestFactory\n+from django.test.utils import (setup_test_template_loader,\n+                               restore_template_loaders)\n from django.core.urlresolvers import reverse\n from django.template import TemplateSyntaxError\n from django.views.debug import ExceptionReporter\n@@ -40,6 +42,26 @@ def test_files(self):\n         self.assertTrue('file_data.txt' in response.content)\n         self.assertFalse('haha' in response.content)\n \n+    def test_403(self):\n+        # Ensure no 403.html template exists to test the default case.\n+        setup_test_template_loader({})\n+        try:\n+            response = self.client.get('/views/raises403/')\n+            self.assertContains(response, '<h1>403 Forbidden</h1>', status_code=403)\n+        finally:\n+            restore_template_loaders()\n+\n+    def test_403_template(self):\n+        # Set up a test 403.html template.\n+        setup_test_template_loader(\n+            {'403.html': 'This is a test template for a 403 Forbidden error.'}\n+        )\n+        try:\n+            response = self.client.get('/views/raises403/')\n+            self.assertContains(response, 'test template', status_code=403)\n+        finally:\n+            restore_template_loaders()\n+\n     def test_404(self):\n         response = self.client.get('/views/raises404/')\n         self.assertEqual(response.status_code, 404)"
        },
        {
            "sha": "6af725357be4347799df44978e08c7ae3f1cfbc9",
            "filename": "tests/regressiontests/views/urls.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/tests%2Fregressiontests%2Fviews%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/tests%2Fregressiontests%2Fviews%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Furls.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -39,8 +39,9 @@\n     (r'^server_error/', 'django.views.defaults.server_error'),\n \n     # a view that raises an exception for the debug view\n-    (r'^raises/$', views.raises),\n-    (r'^raises404/$', views.raises404),\n+    (r'raises/$', views.raises),\n+    (r'raises404/$', views.raises404),\n+    (r'raises403/$', views.raises403),\n \n     # i18n views\n     (r'^i18n/', include('django.conf.urls.i18n')),"
        },
        {
            "sha": "02f765af1c74703f92d85753119dcb6db75c13ea",
            "filename": "tests/regressiontests/views/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/1ca6e9b9e24240033349c93b05902c79c0a25bbb/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/1ca6e9b9e24240033349c93b05902c79c0a25bbb/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fviews.py?ref=1ca6e9b9e24240033349c93b05902c79c0a25bbb",
            "patch": "@@ -1,8 +1,9 @@\n import sys\n \n from django import forms\n-from django.http import HttpResponse, HttpResponseRedirect\n+from django.core.exceptions import PermissionDenied\n from django.core.urlresolvers import get_resolver\n+from django.http import HttpResponse, HttpResponseRedirect\n from django.shortcuts import render_to_response, render\n from django.template import Context, RequestContext, TemplateDoesNotExist\n from django.views.debug import technical_500_response, SafeExceptionReporterFilter\n@@ -53,6 +54,9 @@ def raises404(request):\n     resolver = get_resolver(None)\n     resolver.resolve('')\n \n+def raises403(request):\n+    raise PermissionDenied\n+\n def redirect(request):\n     \"\"\"\n     Forces an HTTP redirect."
        }
    ],
    "stats": {
        "total": 115,
        "additions": 103,
        "deletions": 12
    }
}