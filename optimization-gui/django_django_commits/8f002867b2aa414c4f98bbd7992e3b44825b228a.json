{
    "author": "alex",
    "message": "Cleaned up the QueryDict implementation.\n\n- Use super().\n- Don't poke at internals.\n- Don't override methods for no reason.",
    "sha": "8f002867b2aa414c4f98bbd7992e3b44825b228a",
    "files": [
        {
            "sha": "7ded5546651c384bf646797731666d5d8a9810c4",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 17,
            "deletions": 28,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/8f002867b2aa414c4f98bbd7992e3b44825b228a/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/8f002867b2aa414c4f98bbd7992e3b44825b228a/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=8f002867b2aa414c4f98bbd7992e3b44825b228a",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import absolute_import, unicode_literals\n \n+import copy\n import datetime\n import os\n import re\n@@ -360,6 +361,7 @@ def xreadlines(self):\n     def readlines(self):\n         return list(iter(self))\n \n+\n class QueryDict(MultiValueDict):\n     \"\"\"\n     A specialized MultiValueDict that takes a query string when initialized.\n@@ -374,7 +376,7 @@ class QueryDict(MultiValueDict):\n     _encoding = None\n \n     def __init__(self, query_string, mutable=False, encoding=None):\n-        MultiValueDict.__init__(self)\n+        super(QueryDict, self).__init__()\n         if not encoding:\n             encoding = settings.DEFAULT_CHARSET\n         self.encoding = encoding\n@@ -401,72 +403,58 @@ def __setitem__(self, key, value):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         value = str_to_unicode(value, self.encoding)\n-        MultiValueDict.__setitem__(self, key, value)\n+        super(QueryDict, self).__setitem__(key, value)\n \n     def __delitem__(self, key):\n         self._assert_mutable()\n         super(QueryDict, self).__delitem__(key)\n \n     def __copy__(self):\n         result = self.__class__('', mutable=True, encoding=self.encoding)\n-        for key, value in dict.items(self):\n-            dict.__setitem__(result, key, value)\n+        for key, value in self.iterlists():\n+            result.setlist(key, value)\n         return result\n \n     def __deepcopy__(self, memo):\n-        import copy\n         result = self.__class__('', mutable=True, encoding=self.encoding)\n         memo[id(self)] = result\n-        for key, value in dict.items(self):\n-            dict.__setitem__(result, copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n+        for key, value in self.iterlists():\n+            result.setlist(copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n         return result\n \n     def setlist(self, key, list_):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         list_ = [str_to_unicode(elt, self.encoding) for elt in list_]\n-        MultiValueDict.setlist(self, key, list_)\n+        super(QueryDict, self).setlist(key, list_)\n \n-    def setlistdefault(self, key, default_list=()):\n+    def setlistdefault(self, key, default_list=None):\n         self._assert_mutable()\n-        if key not in self:\n-            self.setlist(key, default_list)\n-        return MultiValueDict.getlist(self, key)\n+        return super(QueryDict, self).setlistdefault(key, default_list)\n \n     def appendlist(self, key, value):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         value = str_to_unicode(value, self.encoding)\n-        MultiValueDict.appendlist(self, key, value)\n-\n-    def update(self, other_dict):\n-        self._assert_mutable()\n-        f = lambda s: str_to_unicode(s, self.encoding)\n-        if hasattr(other_dict, 'lists'):\n-            for key, valuelist in other_dict.lists():\n-                for value in valuelist:\n-                    MultiValueDict.update(self, {f(key): f(value)})\n-        else:\n-            d = dict([(f(k), f(v)) for k, v in other_dict.items()])\n-            MultiValueDict.update(self, d)\n+        super(QueryDict, self).appendlist(key, value)\n \n     def pop(self, key, *args):\n         self._assert_mutable()\n-        return MultiValueDict.pop(self, key, *args)\n+        return super(QueryDict, self).pop(key, *args)\n \n     def popitem(self):\n         self._assert_mutable()\n-        return MultiValueDict.popitem(self)\n+        return super(QueryDict, self).popitem()\n \n     def clear(self):\n         self._assert_mutable()\n-        MultiValueDict.clear(self)\n+        super(QueryDict, self).clear()\n \n     def setdefault(self, key, default=None):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         default = str_to_unicode(default, self.encoding)\n-        return MultiValueDict.setdefault(self, key, default)\n+        return super(QueryDict, self).setdefault(key, default)\n \n     def copy(self):\n         \"\"\"Returns a mutable copy of this object.\"\"\"\n@@ -499,6 +487,7 @@ def urlencode(self, safe=None):\n                            for v in list_])\n         return '&'.join(output)\n \n+\n def parse_cookie(cookie):\n     if cookie == '':\n         return {}"
        },
        {
            "sha": "9a41b4311ce25911e490fe5cd0fdb9abdb25a013",
            "filename": "django/utils/datastructures.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/8f002867b2aa414c4f98bbd7992e3b44825b228a/django%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/8f002867b2aa414c4f98bbd7992e3b44825b228a/django%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdatastructures.py?ref=8f002867b2aa414c4f98bbd7992e3b44825b228a",
            "patch": "@@ -334,7 +334,6 @@ def setlistdefault(self, key, default_list=None):\n             if default_list is None:\n                 default_list = []\n             self.setlist(key, default_list)\n-            return default_list\n         return self.getlist(key)\n \n     def appendlist(self, key, value):"
        },
        {
            "sha": "cc55057d31a9840b148a063444f60607603bf45f",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/8f002867b2aa414c4f98bbd7992e3b44825b228a/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8f002867b2aa414c4f98bbd7992e3b44825b228a/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=8f002867b2aa414c4f98bbd7992e3b44825b228a",
            "patch": "@@ -189,7 +189,7 @@ def test_pickle(self):\n         self.assertEqual(q == q1, True)\n         q = QueryDict('a=b&c=d&a=1')\n         q1 = pickle.loads(pickle.dumps(q, 2))\n-        self.assertEqual(q == q1 , True)\n+        self.assertEqual(q == q1, True)\n \n     def test_update_from_querydict(self):\n         \"\"\"Regression test for #8278: QueryDict.update(QueryDict)\"\"\""
        }
    ],
    "stats": {
        "total": 48,
        "additions": 18,
        "deletions": 30
    }
}