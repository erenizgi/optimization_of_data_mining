{
    "author": "freakboy3742",
    "message": "Fixed #14176 -- Added forwards compatibility to the legacy syndication feed view. This allows class-based feeds to be deployed using the old-style feed view, as long as the feed requires no arguments (i.e., get_object returns None). Thanks to psychcf for the report, cwhaines for the investigation, and Andrew Godwin for the assist.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15189 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2d352444b0354f163ac7d04fcddf84cc744a09d8",
    "files": [
        {
            "sha": "9228e91687e2686e449ba372537fceea858d1a83",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/2d352444b0354f163ac7d04fcddf84cc744a09d8/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/2d352444b0354f163ac7d04fcddf84cc744a09d8/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=2d352444b0354f163ac7d04fcddf84cc744a09d8",
            "patch": "@@ -188,6 +188,7 @@ def get_feed(self, obj, request):\n \n def feed(request, url, feed_dict=None):\n     \"\"\"Provided for backwards compatibility.\"\"\"\n+    from django.contrib.syndication.feeds import Feed as LegacyFeed\n     import warnings\n     warnings.warn('The syndication feed() view is deprecated. Please use the '\n                   'new class based view API.',\n@@ -206,6 +207,18 @@ def feed(request, url, feed_dict=None):\n     except KeyError:\n         raise Http404(\"Slug %r isn't registered.\" % slug)\n \n+    # Backwards compatibility within the backwards compatibility;\n+    # Feeds can be updated to be class-based, but still be deployed\n+    # using the legacy feed view. This only works if the feed takes\n+    # no arguments (i.e., get_object returns None). Refs #14176.\n+    if not issubclass(f, LegacyFeed):\n+        instance = f()\n+        instance.feed_url = getattr(f, 'feed_url', None) or request.path\n+        instance.title_template = f.title_template or ('feeds/%s_title.html' % slug)\n+        instance.description_template = f.description_template or ('feeds/%s_description.html' % slug)\n+\n+        return instance(request)\n+\n     try:\n         feedgen = f(slug, request).get_feed(param)\n     except FeedDoesNotExist:"
        },
        {
            "sha": "921fe03ffae0b0ad3e8ce4769dbcc491121117ee",
            "filename": "docs/ref/contrib/comments/example.txt",
            "status": "modified",
            "additions": 23,
            "deletions": 6,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/2d352444b0354f163ac7d04fcddf84cc744a09d8/docs%2Fref%2Fcontrib%2Fcomments%2Fexample.txt",
            "raw_url": "https://github.com/django/django/raw/2d352444b0354f163ac7d04fcddf84cc744a09d8/docs%2Fref%2Fcontrib%2Fcomments%2Fexample.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Fexample.txt?ref=2d352444b0354f163ac7d04fcddf84cc744a09d8",
            "patch": "@@ -143,19 +143,36 @@ enable it in your project's ``urls.py``:\n   from django.conf.urls.defaults import *\n   from django.contrib.comments.feeds import LatestCommentFeed\n \n-  feeds = {\n-      'latest': LatestCommentFeed,\n-  }\n-\n   urlpatterns = patterns('',\n   # ...\n-      (r'^feeds/(?P<url>.*)/$', 'django.contrib.syndication.views.feed',\n-          {'feed_dict': feeds}),\n+      (r'^feeds/latest/$', LatestCommentFeed()),\n   # ...\n   )\n \n Now you should have the latest comment feeds being served off ``/feeds/latest/``.\n \n+.. versionchanged:: 1.3\n+\n+Prior to Django 1.3, the LatestCommentFeed was deployed using the\n+syndication feed view:\n+\n+.. code-block:: python\n+\n+    from django.conf.urls.defaults import *\n+    from django.contrib.comments.feeds import LatestCommentFeed\n+\n+    feeds = {\n+        'latest': LatestCommentFeed,\n+    }\n+\n+    urlpatterns = patterns('',\n+    # ...\n+        (r'^feeds/(?P<url>.*)/$', 'django.contrib.syndication.views.feed',\n+            {'feed_dict': feeds}),\n+    # ...\n+    )\n+\n+\n Moderation\n ==========\n "
        },
        {
            "sha": "88c6f33203db5f666d27d5a34f795e03949f5223",
            "filename": "tests/regressiontests/comment_tests/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/2d352444b0354f163ac7d04fcddf84cc744a09d8/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/2d352444b0354f163ac7d04fcddf84cc744a09d8/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2F__init__.py?ref=2d352444b0354f163ac7d04fcddf84cc744a09d8",
            "patch": "@@ -81,6 +81,7 @@ def getValidData(self, obj):\n         return d\n \n from regressiontests.comment_tests.tests.app_api_tests import *\n+from regressiontests.comment_tests.tests.feed_tests import *\n from regressiontests.comment_tests.tests.model_tests import *\n from regressiontests.comment_tests.tests.comment_form_tests import *\n from regressiontests.comment_tests.tests.templatetag_tests import *"
        },
        {
            "sha": "0bc6618d9a8e0881bf6f182318aea7bc70eaa5e0",
            "filename": "tests/regressiontests/comment_tests/tests/feed_tests.py",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/2d352444b0354f163ac7d04fcddf84cc744a09d8/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Ffeed_tests.py",
            "raw_url": "https://github.com/django/django/raw/2d352444b0354f163ac7d04fcddf84cc744a09d8/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Ffeed_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Ffeed_tests.py?ref=2d352444b0354f163ac7d04fcddf84cc744a09d8",
            "patch": "@@ -0,0 +1,33 @@\n+import warnings\n+\n+from django.test.utils import get_warnings_state, restore_warnings_state\n+\n+from regressiontests.comment_tests.tests import CommentTestCase\n+\n+\n+class CommentFeedTests(CommentTestCase):\n+    urls = 'regressiontests.comment_tests.urls'\n+    feed_url = '/rss/comments/'\n+\n+    def test_feed(self):\n+        response = self.client.get(self.feed_url)\n+        self.assertEquals(response.status_code, 200)\n+        self.assertEquals(response['Content-Type'], 'application/rss+xml')\n+        self.assertContains(response, '<rss xmlns:atom=\"http://www.w3.org/2005/Atom\" version=\"2.0\">')\n+        self.assertContains(response, '<title>example.com comments</title>')\n+        self.assertContains(response, '<link>http://example.com/</link>')\n+        self.assertContains(response, '</rss>')\n+\n+\n+class LegacyCommentFeedTests(CommentFeedTests):\n+    feed_url = '/rss/legacy/comments/'\n+\n+    def setUp(self):\n+        self._warnings_state = get_warnings_state()\n+        warnings.filterwarnings(\"ignore\", category=DeprecationWarning,\n+                                module='django.contrib.syndication.views')\n+        warnings.filterwarnings(\"ignore\", category=DeprecationWarning,\n+                                module='django.contrib.syndication.feeds')\n+\n+    def tearDown(self):\n+        restore_warnings_state(self._warnings_state)"
        },
        {
            "sha": "052f7cf81d3533bff19325790d49b9d5286c591a",
            "filename": "tests/regressiontests/comment_tests/urls.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/2d352444b0354f163ac7d04fcddf84cc744a09d8/tests%2Fregressiontests%2Fcomment_tests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/2d352444b0354f163ac7d04fcddf84cc744a09d8/tests%2Fregressiontests%2Fcomment_tests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Furls.py?ref=2d352444b0354f163ac7d04fcddf84cc744a09d8",
            "patch": "@@ -1,4 +1,9 @@\n from django.conf.urls.defaults import *\n+from django.contrib.comments.feeds import LatestCommentFeed\n+\n+feeds = {\n+     'comments': LatestCommentFeed,\n+}\n \n urlpatterns = patterns('regressiontests.comment_tests.custom_comments.views',\n     url(r'^post/$',          'custom_submit_comment'),\n@@ -7,3 +12,7 @@\n     url(r'^approve/(\\d+)/$', 'custom_approve_comment'),\n )\n \n+urlpatterns += patterns('',\n+    (r'^rss/legacy/(?P<url>.*)/$', 'django.contrib.syndication.views.feed', {'feed_dict': feeds}),\n+    (r'^rss/comments/$', LatestCommentFeed()),\n+)"
        }
    ],
    "stats": {
        "total": 85,
        "additions": 79,
        "deletions": 6
    }
}