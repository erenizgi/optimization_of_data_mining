{
    "author": "claudep",
    "message": "Fixed #11150 -- Removed dependency on cStringIO in ImageField validation. Thanks vvd for the report.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17825 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "159d1be6567a3696468b77c64169f4f5a5429c14",
    "files": [
        {
            "sha": "1fa8d57dffe8628f3ca4fb3b32b64e0d7ed59661",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/159d1be6567a3696468b77c64169f4f5a5429c14/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/159d1be6567a3696468b77c64169f4f5a5429c14/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=159d1be6567a3696468b77c64169f4f5a5429c14",
            "patch": "@@ -577,8 +577,8 @@ def to_python(self, data):\n \n             # Since we're about to use the file again we have to reset the\n             # file object if possible.\n-            if hasattr(file, 'reset'):\n-                file.reset()\n+            if hasattr(file, 'seek') and callable(file.seek):\n+                file.seek(0)\n \n             # verify() is the only method that can spot a corrupt PNG,\n             #  but it must be called immediately after the constructor"
        },
        {
            "sha": "ff5048eced3bebaa0cdfaa7398ea1843ba5abeb6",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/159d1be6567a3696468b77c64169f4f5a5429c14/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/159d1be6567a3696468b77c64169f4f5a5429c14/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=159d1be6567a3696468b77c64169f4f5a5429c14",
            "patch": "@@ -1370,6 +1370,19 @@ def test_image_field(self):\n         self.assertEqual(instance.image.name, 'foo/test4.png')\n         instance.delete()\n \n+        # Test image field when cStringIO is not available\n+        from django.forms import fields\n+        from StringIO import StringIO\n+        old_StringIO = fields.StringIO\n+        fields.StringIO = StringIO\n+        try:\n+            f = ImageFileForm(\n+                data={'description': u'An image'},\n+                files={'image': SimpleUploadedFile('test.png', image_data)})\n+            self.assertEqual(f.is_valid(), True)\n+        finally:\n+            fields.StringIO = old_StringIO\n+\n     def test_media_on_modelform(self):\n         # Similar to a regular Form class you can define custom media to be used on\n         # the ModelForm."
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}