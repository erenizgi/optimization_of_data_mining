{
    "author": "apollo13",
    "message": "Merge pull request #759 from erikr/master\n\nFix #17751: Added stripping of whitespace for IPAddressField/GenericIPAddressField",
    "sha": "67c39a64e018ee32b9c020615babea9b3ac7215f",
    "files": [
        {
            "sha": "322741be39ff2ce72e03c79ec2c55671bd051fbb",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/67c39a64e018ee32b9c020615babea9b3ac7215f/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/67c39a64e018ee32b9c020615babea9b3ac7215f/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=67c39a64e018ee32b9c020615babea9b3ac7215f",
            "patch": "@@ -129,7 +129,7 @@ def __call__(self, value):\n slug_re = re.compile(r'^[-a-zA-Z0-9_]+$')\n validate_slug = RegexValidator(slug_re, _(\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"), 'invalid')\n \n-ipv4_re = re.compile(r'^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$')\n+ipv4_re = re.compile(r'^\\s*(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}\\s*$')\n validate_ipv4_address = RegexValidator(ipv4_re, _('Enter a valid IPv4 address.'), 'invalid')\n \n "
        },
        {
            "sha": "aa909a8aa5fc7fe6216cf9101a6055f0843bf684",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/67c39a64e018ee32b9c020615babea9b3ac7215f/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/67c39a64e018ee32b9c020615babea9b3ac7215f/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=67c39a64e018ee32b9c020615babea9b3ac7215f",
            "patch": "@@ -1096,6 +1096,10 @@ class IPAddressField(CharField):\n     }\n     default_validators = [validators.validate_ipv4_address]\n \n+    def clean(self, value):\n+        value = self.to_python(value).strip()\n+        return super(IPAddressField, self).clean(value)\n+\n \n class GenericIPAddressField(CharField):\n     default_error_messages = {}\n@@ -1107,6 +1111,10 @@ def __init__(self, protocol='both', unpack_ipv4=False, *args, **kwargs):\n         self.default_error_messages['invalid'] = invalid_error_message\n         super(GenericIPAddressField, self).__init__(*args, **kwargs)\n \n+    def clean(self, value):\n+        value = self.to_python(value).strip()\n+        return super(GenericIPAddressField, self).clean(value)\n+\n     def to_python(self, value):\n         if value in validators.EMPTY_VALUES:\n             return ''"
        },
        {
            "sha": "dca99052e56546679c2a27d49cc8c1f8fe8b3187",
            "filename": "tests/modeltests/validation/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/67c39a64e018ee32b9c020615babea9b3ac7215f/tests%2Fmodeltests%2Fvalidation%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/67c39a64e018ee32b9c020615babea9b3ac7215f/tests%2Fmodeltests%2Fvalidation%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Ftests.py?ref=67c39a64e018ee32b9c020615babea9b3ac7215f",
            "patch": "@@ -116,40 +116,54 @@ class GenericIPAddressFieldTests(ValidationTestCase):\n     def test_correct_generic_ip_passes(self):\n         giptm = GenericIPAddressTestModel(generic_ip=\"1.2.3.4\")\n         self.assertEqual(None, giptm.full_clean())\n+        giptm = GenericIPAddressTestModel(generic_ip=\" 1.2.3.4 \")\n+        self.assertEqual(None, giptm.full_clean())\n         giptm = GenericIPAddressTestModel(generic_ip=\"2001::2\")\n         self.assertEqual(None, giptm.full_clean())\n+        giptm = GenericIPAddressTestModel(generic_ip=\" 2001::2 \")\n+        self.assertEqual(None, giptm.full_clean())\n \n     def test_invalid_generic_ip_raises_error(self):\n         giptm = GenericIPAddressTestModel(generic_ip=\"294.4.2.1\")\n         self.assertFailsValidation(giptm.full_clean, ['generic_ip',])\n+        giptm = GenericIPAddressTestModel(generic_ip=\"1.2.3 .4\")\n+        self.assertFailsValidation(giptm.full_clean, ['generic_ip',])\n         giptm = GenericIPAddressTestModel(generic_ip=\"1:2\")\n         self.assertFailsValidation(giptm.full_clean, ['generic_ip',])\n \n     def test_correct_v4_ip_passes(self):\n         giptm = GenericIPAddressTestModel(v4_ip=\"1.2.3.4\")\n         self.assertEqual(None, giptm.full_clean())\n+        giptm = GenericIPAddressTestModel(v4_ip=\" 1.2.3.4 \")\n+        self.assertEqual(None, giptm.full_clean())\n \n     def test_invalid_v4_ip_raises_error(self):\n         giptm = GenericIPAddressTestModel(v4_ip=\"294.4.2.1\")\n         self.assertFailsValidation(giptm.full_clean, ['v4_ip',])\n+        giptm = GenericIPAddressTestModel(v4_ip=\"294.4 .2.1\")\n+        self.assertFailsValidation(giptm.full_clean, ['v4_ip',])\n         giptm = GenericIPAddressTestModel(v4_ip=\"2001::2\")\n         self.assertFailsValidation(giptm.full_clean, ['v4_ip',])\n \n     def test_correct_v6_ip_passes(self):\n         giptm = GenericIPAddressTestModel(v6_ip=\"2001::2\")\n         self.assertEqual(None, giptm.full_clean())\n+        giptm = GenericIPAddressTestModel(v6_ip=\" 2001::2 \")\n+        self.assertEqual(None, giptm.full_clean())\n \n     def test_invalid_v6_ip_raises_error(self):\n         giptm = GenericIPAddressTestModel(v6_ip=\"1.2.3.4\")\n         self.assertFailsValidation(giptm.full_clean, ['v6_ip',])\n+        giptm = GenericIPAddressTestModel(v6_ip=\"2001:: 2\")\n+        self.assertFailsValidation(giptm.full_clean, ['v6_ip',])\n         giptm = GenericIPAddressTestModel(v6_ip=\"1:2\")\n         self.assertFailsValidation(giptm.full_clean, ['v6_ip',])\n \n     def test_v6_uniqueness_detection(self):\n         # These two addresses are the same with different syntax\n-        giptm = GenericIPAddressTestModel(generic_ip=\"2001::1:0:0:0:0:2\")\n+        giptm = GenericIPAddressTestModel(generic_ip=\" 2001::1:0:0:0:0:2\")\n         giptm.save()\n-        giptm = GenericIPAddressTestModel(generic_ip=\"2001:0:1:2\")\n+        giptm = GenericIPAddressTestModel(generic_ip=\"2001:0:1:2 \")\n         self.assertFailsValidation(giptm.full_clean, ['generic_ip',])\n \n     def test_v4_unpack_uniqueness_detection(self):"
        },
        {
            "sha": "359ad442bc4dd53cf0915ae55ff0c1fea852f58c",
            "filename": "tests/regressiontests/forms/tests/extra.py",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/67c39a64e018ee32b9c020615babea9b3ac7215f/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/67c39a64e018ee32b9c020615babea9b3ac7215f/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py?ref=67c39a64e018ee32b9c020615babea9b3ac7215f",
            "patch": "@@ -474,7 +474,7 @@ def test_ipaddress(self):\n         f = IPAddressField()\n         self.assertFormErrors(['This field is required.'], f.clean, '')\n         self.assertFormErrors(['This field is required.'], f.clean, None)\n-        self.assertEqual(f.clean('127.0.0.1'), '127.0.0.1')\n+        self.assertEqual(f.clean(' 127.0.0.1'), '127.0.0.1')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, 'foo')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, '127.0.0.')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, '1.2.3.4.5')\n@@ -483,7 +483,7 @@ def test_ipaddress(self):\n         f = IPAddressField(required=False)\n         self.assertEqual(f.clean(''), '')\n         self.assertEqual(f.clean(None), '')\n-        self.assertEqual(f.clean('127.0.0.1'), '127.0.0.1')\n+        self.assertEqual(f.clean(' 127.0.0.1'), '127.0.0.1')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, 'foo')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, '127.0.0.')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, '1.2.3.4.5')\n@@ -499,13 +499,13 @@ def test_generic_ipaddress_as_generic(self):\n         f = GenericIPAddressField()\n         self.assertFormErrors(['This field is required.'], f.clean, '')\n         self.assertFormErrors(['This field is required.'], f.clean, None)\n-        self.assertEqual(f.clean('127.0.0.1'), '127.0.0.1')\n+        self.assertEqual(f.clean(' 127.0.0.1 '), '127.0.0.1')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, 'foo')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '127.0.0.')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1.2.3.4.5')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '256.125.1.5')\n-        self.assertEqual(f.clean('fe80::223:6cff:fe8a:2e8a'), 'fe80::223:6cff:fe8a:2e8a')\n-        self.assertEqual(f.clean('2a02::223:6cff:fe8a:2e8a'), '2a02::223:6cff:fe8a:2e8a')\n+        self.assertEqual(f.clean(' fe80::223:6cff:fe8a:2e8a '), 'fe80::223:6cff:fe8a:2e8a')\n+        self.assertEqual(f.clean(' 2a02::223:6cff:fe8a:2e8a '), '2a02::223:6cff:fe8a:2e8a')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '12345:2:3:4')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1::2:3::4')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n@@ -516,7 +516,7 @@ def test_generic_ipaddress_as_ipv4_only(self):\n         f = GenericIPAddressField(protocol=\"IPv4\")\n         self.assertFormErrors(['This field is required.'], f.clean, '')\n         self.assertFormErrors(['This field is required.'], f.clean, None)\n-        self.assertEqual(f.clean('127.0.0.1'), '127.0.0.1')\n+        self.assertEqual(f.clean(' 127.0.0.1 '), '127.0.0.1')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, 'foo')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, '127.0.0.')\n         self.assertFormErrors(['Enter a valid IPv4 address.'], f.clean, '1.2.3.4.5')\n@@ -533,8 +533,8 @@ def test_generic_ipaddress_as_ipv6_only(self):\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '127.0.0.')\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '1.2.3.4.5')\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '256.125.1.5')\n-        self.assertEqual(f.clean('fe80::223:6cff:fe8a:2e8a'), 'fe80::223:6cff:fe8a:2e8a')\n-        self.assertEqual(f.clean('2a02::223:6cff:fe8a:2e8a'), '2a02::223:6cff:fe8a:2e8a')\n+        self.assertEqual(f.clean(' fe80::223:6cff:fe8a:2e8a '), 'fe80::223:6cff:fe8a:2e8a')\n+        self.assertEqual(f.clean(' 2a02::223:6cff:fe8a:2e8a '), '2a02::223:6cff:fe8a:2e8a')\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '12345:2:3:4')\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '1::2:3::4')\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n@@ -550,8 +550,8 @@ def test_generic_ipaddress_as_generic_not_required(self):\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '127.0.0.')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1.2.3.4.5')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '256.125.1.5')\n-        self.assertEqual(f.clean('fe80::223:6cff:fe8a:2e8a'), 'fe80::223:6cff:fe8a:2e8a')\n-        self.assertEqual(f.clean('2a02::223:6cff:fe8a:2e8a'), '2a02::223:6cff:fe8a:2e8a')\n+        self.assertEqual(f.clean(' fe80::223:6cff:fe8a:2e8a '), 'fe80::223:6cff:fe8a:2e8a')\n+        self.assertEqual(f.clean(' 2a02::223:6cff:fe8a:2e8a '), '2a02::223:6cff:fe8a:2e8a')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '12345:2:3:4')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1::2:3::4')\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n@@ -561,13 +561,13 @@ def test_generic_ipaddress_as_generic_not_required(self):\n     def test_generic_ipaddress_normalization(self):\n         # Test the normalising code\n         f = GenericIPAddressField()\n-        self.assertEqual(f.clean('::ffff:0a0a:0a0a'), '::ffff:10.10.10.10')\n-        self.assertEqual(f.clean('::ffff:10.10.10.10'), '::ffff:10.10.10.10')\n-        self.assertEqual(f.clean('2001:000:a:0000:0:fe:fe:beef'), '2001:0:a::fe:fe:beef')\n-        self.assertEqual(f.clean('2001::a:0000:0:fe:fe:beef'), '2001:0:a::fe:fe:beef')\n+        self.assertEqual(f.clean(' ::ffff:0a0a:0a0a  '), '::ffff:10.10.10.10')\n+        self.assertEqual(f.clean(' ::ffff:10.10.10.10  '), '::ffff:10.10.10.10')\n+        self.assertEqual(f.clean(' 2001:000:a:0000:0:fe:fe:beef  '), '2001:0:a::fe:fe:beef')\n+        self.assertEqual(f.clean(' 2001::a:0000:0:fe:fe:beef  '), '2001:0:a::fe:fe:beef')\n \n         f = GenericIPAddressField(unpack_ipv4=True)\n-        self.assertEqual(f.clean('::ffff:0a0a:0a0a'), '10.10.10.10')\n+        self.assertEqual(f.clean(' ::ffff:0a0a:0a0a'), '10.10.10.10')\n \n     def test_smart_text(self):\n         class Test:"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 40,
        "deletions": 18
    }
}