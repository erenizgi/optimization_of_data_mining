{
    "author": "claudep",
    "message": "Replaced pickle by json in form_hmac calculation\n\nRefs #18340",
    "sha": "b109ff8062f4bb225181ec462d69c9dd79339567",
    "files": [
        {
            "sha": "8a3027bc086a0e15717ecd7efc4c0c8d6c4f0742",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b109ff8062f4bb225181ec462d69c9dd79339567/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b109ff8062f4bb225181ec462d69c9dd79339567/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=b109ff8062f4bb225181ec462d69c9dd79339567",
            "patch": "@@ -1,3 +1,4 @@\n+# -*- coding: utf-8 -*-\n from __future__ import unicode_literals\n \n import os\n@@ -165,8 +166,8 @@ def test_textfield_hash(self):\n         leading/trailing whitespace so as to be friendly to broken browsers that\n         submit it (usually in textareas).\n         \"\"\"\n-        f1 = HashTestForm({'name': 'joe', 'bio': 'Nothing notable.'})\n-        f2 = HashTestForm({'name': '  joe', 'bio': 'Nothing notable.  '})\n+        f1 = HashTestForm({'name': 'joe', 'bio': 'Speaking español.'})\n+        f2 = HashTestForm({'name': '  joe', 'bio': 'Speaking español.  '})\n         hash1 = utils.form_hmac(f1)\n         hash2 = utils.form_hmac(f2)\n         self.assertEqual(hash1, hash2)\n@@ -270,7 +271,7 @@ def test_good_hash(self):\n         \"\"\"\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": \"09a53d8de15fc155bad33423e1d2ee2d82484d8a\",\n                 \"wizard_step\": \"1\"}\n         response = self.client.post('/wizard1/', data)\n         self.assertEqual(2, response.context['step0'])\n@@ -295,15 +296,15 @@ def process_step(self, request, form, step):\n         wizard = WizardWithProcessStep([WizardPageOneForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": \"09a53d8de15fc155bad33423e1d2ee2d82484d8a\",\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n \n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n-                \"hash_1\": \"1e6f6315da42e62f33a30640ec7e007ad3fbf1a1\",\n+                \"hash_0\": \"09a53d8de15fc155bad33423e1d2ee2d82484d8a\",\n+                \"hash_1\": \"4c352938f08b0e6467bef3cda578a1d4a82edc66\",\n                 \"wizard_step\": \"2\"}\n         self.assertRaises(http.Http404, wizard, DummyRequest(POST=data))\n \n@@ -325,7 +326,7 @@ def process_step(self, request, form, step):\n                                         WizardPageThreeForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": \"09a53d8de15fc155bad33423e1d2ee2d82484d8a\",\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n@@ -349,7 +350,7 @@ def done(self, request, form_list):\n \n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": \"09a53d8de15fc155bad33423e1d2ee2d82484d8a\",\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n@@ -375,7 +376,7 @@ def process_step(self, request, form, step):\n                                         WizardPageThreeForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": \"09a53d8de15fc155bad33423e1d2ee2d82484d8a\",\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])"
        },
        {
            "sha": "8b37651ab797d4bac085960b41399c43b623f363",
            "filename": "django/contrib/formtools/utils.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b109ff8062f4bb225181ec462d69c9dd79339567/django%2Fcontrib%2Fformtools%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b109ff8062f4bb225181ec462d69c9dd79339567/django%2Fcontrib%2Fformtools%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Futils.py?ref=b109ff8062f4bb225181ec462d69c9dd79339567",
            "patch": "@@ -1,5 +1,6 @@\n-# Do not try cPickle here (see #18340)\n-import pickle\n+from __future__ import unicode_literals\n+\n+import json\n \n from django.utils.crypto import salted_hmac\n from django.utils import six\n@@ -21,6 +22,5 @@ def form_hmac(form):\n             value = value.strip()\n         data.append((bf.name, value))\n \n-    pickled = pickle.dumps(data, pickle.HIGHEST_PROTOCOL)\n     key_salt = 'django.contrib.formtools'\n-    return salted_hmac(key_salt, pickled).hexdigest()\n+    return salted_hmac(key_salt, json.dumps(data)).hexdigest()"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 14,
        "deletions": 13
    }
}