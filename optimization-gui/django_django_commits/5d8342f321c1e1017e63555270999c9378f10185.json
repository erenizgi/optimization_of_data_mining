{
    "author": "aaugustin",
    "message": "Proof-read and adjusted the transactions docs.",
    "sha": "5d8342f321c1e1017e63555270999c9378f10185",
    "files": [
        {
            "sha": "1305d688591d8c65a8bedf0184991d8c7020e25e",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/5d8342f321c1e1017e63555270999c9378f10185/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/5d8342f321c1e1017e63555270999c9378f10185/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=5d8342f321c1e1017e63555270999c9378f10185",
            "patch": "@@ -329,14 +329,19 @@ these changes.\n 1.8\n ---\n \n+* ``django.contrib.comments`` will be removed.\n+\n * The following transaction management APIs will be removed:\n \n   - ``TransactionMiddleware``,\n   - the decorators and context managers ``autocommit``, ``commit_on_success``,\n-    and ``commit_manually``,\n+    and ``commit_manually``, defined in ``django.db.transaction``,\n+  - the functions ``commit_unless_managed`` and ``rollback_unless_managed``,\n+    also defined in ``django.db.transaction``,\n   - the ``TRANSACTIONS_MANAGED`` setting.\n \n-  Upgrade paths are described in :ref:`transactions-upgrading-from-1.5`.\n+  Upgrade paths are described in the :ref:`transaction management docs\n+  <transactions-upgrading-from-1.5>`.\n \n * The :ttag:`cycle` and :ttag:`firstof` template tags will auto-escape their\n   arguments. In 1.6 and 1.7, this behavior is provided by the version of these\n@@ -358,14 +363,11 @@ these changes.\n   ``ChangeList.root_query_set`` and ``ChangeList.query_set``.\n \n * The following private APIs will be removed:\n+\n   - ``django.db.close_connection()``\n   - ``django.db.backends.creation.BaseDatabaseCreation.set_autocommit()``\n   - ``django.db.transaction.is_managed()``\n   - ``django.db.transaction.managed()``\n-  - ``django.db.transaction.commit_unless_managed()``\n-  - ``django.db.transaction.rollback_unless_managed()``\n-\n-* ``django.contrib.comments`` will be removed.\n \n 2.0\n ---"
        },
        {
            "sha": "30c3cc5d2cafda269ea2397c6049961505f387cb",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/5d8342f321c1e1017e63555270999c9378f10185/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/5d8342f321c1e1017e63555270999c9378f10185/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=5d8342f321c1e1017e63555270999c9378f10185",
            "patch": "@@ -36,7 +36,8 @@ Improved transaction management\n Django's transaction management was overhauled. Database-level autocommit is\n now turned on by default. This makes transaction handling more explicit and\n should improve performance. The existing APIs were deprecated, and new APIs\n-were introduced, as described in :doc:`/topics/db/transactions`.\n+were introduced, as described in the :doc:`transaction management docs\n+</topics/db/transactions>`.\n \n Please review carefully the list of :ref:`known backwards-incompatibilities\n <transactions-upgrading-from-1.5>` to determine if you need to make changes in"
        },
        {
            "sha": "697dee49c02241dc4252f9d20e0e0913eb7dc07b",
            "filename": "docs/topics/db/transactions.txt",
            "status": "modified",
            "additions": 32,
            "deletions": 38,
            "changes": 70,
            "blob_url": "https://github.com/django/django/blob/5d8342f321c1e1017e63555270999c9378f10185/docs%2Ftopics%2Fdb%2Ftransactions.txt",
            "raw_url": "https://github.com/django/django/raw/5d8342f321c1e1017e63555270999c9378f10185/docs%2Ftopics%2Fdb%2Ftransactions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Ftransactions.txt?ref=5d8342f321c1e1017e63555270999c9378f10185",
            "patch": "@@ -35,10 +35,10 @@ transaction. Set :setting:`ATOMIC_REQUESTS <DATABASE-ATOMIC_REQUESTS>` to\n ``True`` in the configuration of each database for which you want to enable\n this behavior.\n \n-It works like this. When a request starts, Django starts a transaction. If the\n-response is produced without problems, Django commits the transaction. If the\n-view function produces an exception, Django rolls back the transaction.\n-Middleware always runs outside of this transaction.\n+It works like this. Before calling a view function, Django starts a\n+transaction. If the response is produced without problems, Django commits the\n+transaction. If the view produces an exception, Django rolls back the\n+transaction.\n \n You may perfom partial commits and rollbacks in your view code, typically with\n the :func:`atomic` context manager. However, at the end of the view, either\n@@ -207,13 +207,6 @@ To avoid this, you can :ref:`deactivate the transaction management\n     Before Django 1.6, autocommit was turned off, and it was emulated by\n     forcing a commit after write operations in the ORM.\n \n-.. warning::\n-\n-    If you're using the database API directly — for instance, you're running\n-    SQL queries with ``cursor.execute()`` — be aware that autocommit is on,\n-    and consider wrapping your operations in a transaction, with\n-    :func:`atomic`, to ensure consistency.\n-\n .. _deactivate-transaction-management:\n \n Deactivating transaction management\n@@ -251,8 +244,8 @@ Autocommit\n \n .. versionadded:: 1.6\n \n-Django provides a straightforward API to manage the autocommit state of each\n-database connection, if you need to.\n+Django provides a straightforward API in the :mod:`django.db.transaction`\n+module to manage the autocommit state of each database connection.\n \n .. function:: get_autocommit(using=None)\n \n@@ -287,7 +280,7 @@ start a transaction is to disable autocommit with :func:`set_autocommit`.\n \n Once you're in a transaction, you can choose either to apply the changes\n you've performed until this point with :func:`commit`, or to cancel them with\n-:func:`rollback`.\n+:func:`rollback`. These functions are defined in :mod:`django.db.transaction`.\n \n .. function:: commit(using=None)\n \n@@ -332,10 +325,8 @@ Savepoints are controlled by three functions in :mod:`django.db.transaction`:\n \n .. function:: savepoint(using=None)\n \n-    Creates a new savepoint. This marks a point in the transaction that\n-    is known to be in a \"good\" state.\n-\n-    Returns the savepoint ID (``sid``).\n+    Creates a new savepoint. This marks a point in the transaction that is\n+    known to be in a \"good\" state. Returns the savepoint ID (``sid``).\n \n .. function:: savepoint_commit(sid, using=None)\n \n@@ -388,11 +379,9 @@ While SQLite ≥ 3.6.8 supports savepoints, a flaw in the design of the\n :mod:`sqlite3` makes them hardly usable.\n \n When autocommit is enabled, savepoints don't make sense. When it's disabled,\n-:mod:`sqlite3` commits implicitly before savepoint-related statement. (It\n+:mod:`sqlite3` commits implicitly before savepoint statements. (In fact, it\n commits before any statement other than ``SELECT``, ``INSERT``, ``UPDATE``,\n-``DELETE`` and ``REPLACE``.)\n-\n-This has two consequences:\n+``DELETE`` and ``REPLACE``.) This bug has two consequences:\n \n - The low level APIs for savepoints are only usable inside a transaction ie.\n   inside an :func:`atomic` block.\n@@ -407,22 +396,27 @@ depends on your MySQL version and the table types you're using. (By\n peculiarities are outside the scope of this article, but the MySQL site has\n `information on MySQL transactions`_.\n \n-If your MySQL setup does *not* support transactions, then Django will function\n-in autocommit mode: Statements will be executed and committed as soon as\n-they're called. If your MySQL setup *does* support transactions, Django will\n-handle transactions as explained in this document.\n+If your MySQL setup does *not* support transactions, then Django will always\n+function in autocommit mode: statements will be executed and committed as soon\n+as they're called. If your MySQL setup *does* support transactions, Django\n+will handle transactions as explained in this document.\n \n .. _information on MySQL transactions: http://dev.mysql.com/doc/refman/5.0/en/sql-syntax-transactions.html\n \n Handling exceptions within PostgreSQL transactions\n --------------------------------------------------\n \n-When a call to a PostgreSQL cursor raises an exception (typically\n-``IntegrityError``), all subsequent SQL in the same transaction will fail with\n-the error \"current transaction is aborted, queries ignored until end of\n-transaction block\". Whilst simple use of ``save()`` is unlikely to raise an\n-exception in PostgreSQL, there are more advanced usage patterns which\n-might, such as saving objects with unique fields, saving using the\n+.. note::\n+    This section is relevant only if you're implementing your own transaction\n+    management. This problem cannot occur in Django's default mode and\n+    :func:`atomic` handles it automatically.\n+\n+Inside a transaction, when a call to a PostgreSQL cursor raises an exception\n+(typically ``IntegrityError``), all subsequent SQL in the same transaction\n+will fail with the error \"current transaction is aborted, queries ignored\n+until end of transaction block\". Whilst simple use of ``save()`` is unlikely\n+to raise an exception in PostgreSQL, there are more advanced usage patterns\n+which might, such as saving objects with unique fields, saving using the\n force_insert/force_update flag, or invoking custom SQL.\n \n There are several ways to recover from this sort of error.\n@@ -529,9 +523,9 @@ Django starts in auto mode. ``TransactionMiddleware``,\n Internally, Django keeps a stack of states. Activations and deactivations must\n be balanced.\n \n-For example, ``commit_on_success`` switches to managed mode when entering the\n-block of code it controls; when exiting the block, it commits or rollbacks,\n-and switches back to auto mode.\n+For example, :func:`commit_on_success` switches to managed mode when entering\n+the block of code it controls; when exiting the block, it commits or\n+rollbacks, and switches back to auto mode.\n \n So :func:`commit_on_success` really has two effects: it changes the\n transaction state and it defines an transaction block. Nesting will give the\n@@ -568,7 +562,7 @@ you must now use this pattern::\n     my_view.transactions_per_request = False\n \n The transaction middleware applied not only to view functions, but also to\n-middleware modules that come after it. For instance, if you used the session\n+middleware modules that came after it. For instance, if you used the session\n middleware after the transaction middleware, session creation was part of the\n transaction. :setting:`ATOMIC_REQUESTS <DATABASE-ATOMIC_REQUESTS>` only\n applies to the view itself.\n@@ -651,8 +645,8 @@ same \"automatic transaction\". If you need to enforce atomicity, you must wrap\n the sequence of queries in :func:`commit_on_success`.\n \n To check for this problem, look for calls to ``cursor.execute()``. They're\n-usually followed by a call to ``transaction.commit_unless_managed``, which\n-isn't necessary any more and should be removed.\n+usually followed by a call to ``transaction.commit_unless_managed()``, which\n+isn't useful any more and should be removed.\n \n Select for update\n ~~~~~~~~~~~~~~~~~"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 42,
        "deletions": 45
    }
}