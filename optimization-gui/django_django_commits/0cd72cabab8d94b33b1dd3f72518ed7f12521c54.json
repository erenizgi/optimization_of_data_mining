{
    "author": "alex",
    "message": "Converted the Brazillian localflavor doctests to unittests.  We have always been at war with doctests.  Thanks to Idan Gazit.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14933 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0cd72cabab8d94b33b1dd3f72518ed7f12521c54",
    "files": [
        {
            "sha": "6ae71056a449fb1a1a52a1bc859ffba443e50817",
            "filename": "tests/regressiontests/forms/localflavor/br.py",
            "status": "modified",
            "additions": 136,
            "deletions": 212,
            "changes": 348,
            "blob_url": "https://github.com/django/django/blob/0cd72cabab8d94b33b1dd3f72518ed7f12521c54/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fbr.py",
            "raw_url": "https://github.com/django/django/raw/0cd72cabab8d94b33b1dd3f72518ed7f12521c54/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fbr.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fbr.py?ref=0cd72cabab8d94b33b1dd3f72518ed7f12521c54",
            "patch": "@@ -1,220 +1,144 @@\n-# -*- coding: utf-8 -*-\n-# Tests for the contrib/localflavor/ BR form fields.\n+from django.contrib.localflavor.br.forms import (BRZipCodeField,\n+    BRCNPJField, BRCPFField, BRPhoneNumberField, BRStateSelect,\n+    BRStateChoiceField)\n \n-tests = r\"\"\"\n-# BRZipCodeField ############################################################\n->>> from django.contrib.localflavor.br.forms import BRZipCodeField\n->>> f = BRZipCodeField()\n->>> f.clean('12345-123')\n-u'12345-123'\n->>> f.clean('12345_123')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('1234-123')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('abcde-abc')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('12345-')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('-123')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n+from utils import LocalFlavorTestCase\n \n->>> f = BRZipCodeField(required=False)\n->>> f.clean(None)\n-u''\n->>> f.clean('')\n-u''\n->>> f.clean('-123')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('12345-')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('abcde-abc')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('1234-123')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('12345_123')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX-XXX.']\n->>> f.clean('12345-123')\n-u'12345-123'\n \n-# BRCNPJField ############################################################\n+class BRLocalFlavorTests(LocalFlavorTestCase):\n+    def test_BRZipCodeField(self):\n+        error_format = [u'Enter a zip code in the format XXXXX-XXX.']\n+        valid = {\n+            '12345-123': '12345-123',\n+        }\n+        invalid = {\n+            '12345_123': error_format,\n+            '1234-123': error_format,\n+            'abcde-abc': error_format,\n+            '12345-': error_format,\n+            '-123': error_format,\n+        }\n+        self.assertFieldOutput(BRZipCodeField, valid, invalid)\n \n->>> from django.contrib.localflavor.br.forms import BRCNPJField\n->>> f = BRCNPJField(required=True)\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('12-345-678/9012-10')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Invalid CNPJ number.']\n->>> f.clean('12.345.678/9012-10')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Invalid CNPJ number.']\n->>> f.clean('12345678/9012-10')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Invalid CNPJ number.']\n->>> f.clean('64.132.916/0001-88')\n-'64.132.916/0001-88'\n->>> f.clean('64-132-916/0001-88')\n-'64-132-916/0001-88'\n->>> f.clean('64132916/0001-88')\n-'64132916/0001-88'\n->>> f.clean('64.132.916/0001-XX')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field requires only numbers.']\n->>> f = BRCNPJField(required=False)\n->>> f.clean('')\n-u''\n+    def test_BRCNPJField(self):\n+        error_format = [u'Invalid CNPJ number.']\n+        error_numbersonly = [u'This field requires only numbers.']\n+        valid = {\n+            '64.132.916/0001-88': '64.132.916/0001-88',\n+            '64-132-916/0001-88': '64-132-916/0001-88',\n+            '64132916/0001-88': '64132916/0001-88',\n+        }\n+        invalid = {\n+            '12-345-678/9012-10': error_format,\n+            '12.345.678/9012-10': error_format,\n+            '12345678/9012-10': error_format,\n+            '64.132.916/0001-XX': error_numbersonly,\n+        }\n+        self.assertFieldOutput(BRCNPJField, valid, invalid)\n \n-# BRCPFField #################################################################\n+    def test_BRCPFField(self):\n+        error_format = [u'Invalid CPF number.']\n+        error_numbersonly = [u'This field requires only numbers.']\n+        error_atmost_chars = [u'Ensure this value has at most 14 characters (it has 15).']\n+        error_atleast_chars = [u'Ensure this value has at least 11 characters (it has 10).']\n+        error_atmost = [u'This field requires at most 11 digits or 14 characters.']\n+        valid = {\n+            '663.256.017-26': '663.256.017-26',\n+            '66325601726': '66325601726',\n+            '375.788.573-20': '375.788.573-20',\n+            '84828509895': '84828509895',\n+        }\n+        invalid = {\n+            '489.294.654-54': error_format,\n+            '295.669.575-98': error_format,\n+            '539.315.127-22': error_format,\n+            '375.788.573-XX': error_numbersonly,\n+            '375.788.573-000': error_atmost_chars,\n+            '123.456.78': error_atleast_chars,\n+            '123456789555': error_atmost,\n+        }\n+        self.assertFieldOutput(BRCPFField, valid, invalid)\n \n->>> from django.contrib.localflavor.br.forms import BRCPFField\n->>> f = BRCPFField()\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('489.294.654-54')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Invalid CPF number.']\n->>> f.clean('295.669.575-98')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Invalid CPF number.']\n->>> f.clean('539.315.127-22')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Invalid CPF number.']\n->>> f.clean('663.256.017-26')\n-u'663.256.017-26'\n->>> f.clean('66325601726')\n-u'66325601726'\n->>> f.clean('375.788.573-20')\n-u'375.788.573-20'\n->>> f.clean('84828509895')\n-u'84828509895'\n->>> f.clean('375.788.573-XX')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field requires only numbers.']\n->>> f.clean('375.788.573-000')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Ensure this value has at most 14 characters (it has 15).']\n->>> f.clean('123.456.78')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Ensure this value has at least 11 characters (it has 10).']\n->>> f.clean('123456789555')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field requires at most 11 digits or 14 characters.']\n->>> f = BRCPFField(required=False)\n->>> f.clean('')\n-u''\n->>> f.clean(None)\n-u''\n+    def test_BRPhoneNumberField(self):\n+        # TODO: this doesn't test for any invalid inputs.\n+        valid = {\n+            '41-3562-3464': u'41-3562-3464',\n+            '4135623464': u'41-3562-3464',\n+            '41 3562-3464': u'41-3562-3464',\n+            '41 3562 3464': u'41-3562-3464',\n+            '(41) 3562 3464': u'41-3562-3464',\n+            '41.3562.3464': u'41-3562-3464',\n+            '41.3562-3464': u'41-3562-3464',\n+            ' (41) 3562.3464': u'41-3562-3464',\n+        }\n+        invalid = {}\n+        self.assertFieldOutput(BRPhoneNumberField, valid, invalid)\n \n-# BRPhoneNumberField #########################################################\n+    def test_BRStateSelect(self):\n+        f = BRStateSelect()\n+        out = u'''<select name=\"states\">\n+<option value=\"AC\">Acre</option>\n+<option value=\"AL\">Alagoas</option>\n+<option value=\"AP\">Amap\\xe1</option>\n+<option value=\"AM\">Amazonas</option>\n+<option value=\"BA\">Bahia</option>\n+<option value=\"CE\">Cear\\xe1</option>\n+<option value=\"DF\">Distrito Federal</option>\n+<option value=\"ES\">Esp\\xedrito Santo</option>\n+<option value=\"GO\">Goi\\xe1s</option>\n+<option value=\"MA\">Maranh\\xe3o</option>\n+<option value=\"MT\">Mato Grosso</option>\n+<option value=\"MS\">Mato Grosso do Sul</option>\n+<option value=\"MG\">Minas Gerais</option>\n+<option value=\"PA\">Par\\xe1</option>\n+<option value=\"PB\">Para\\xedba</option>\n+<option value=\"PR\" selected=\"selected\">Paran\\xe1</option>\n+<option value=\"PE\">Pernambuco</option>\n+<option value=\"PI\">Piau\\xed</option>\n+<option value=\"RJ\">Rio de Janeiro</option>\n+<option value=\"RN\">Rio Grande do Norte</option>\n+<option value=\"RS\">Rio Grande do Sul</option>\n+<option value=\"RO\">Rond\\xf4nia</option>\n+<option value=\"RR\">Roraima</option>\n+<option value=\"SC\">Santa Catarina</option>\n+<option value=\"SP\">S\\xe3o Paulo</option>\n+<option value=\"SE\">Sergipe</option>\n+<option value=\"TO\">Tocantins</option>\n+</select>'''\n+        self.assertEqual(f.render('states', 'PR'), out)\n \n->>> from django.contrib.localflavor.br.forms import BRPhoneNumberField\n->>> f = BRPhoneNumberField()\n->>> f.clean('41-3562-3464')\n-u'41-3562-3464'\n->>> f.clean('4135623464')\n-u'41-3562-3464'\n->>> f.clean('41 3562-3464')\n-u'41-3562-3464'\n->>> f.clean('41 3562 3464')\n-u'41-3562-3464'\n->>> f.clean('(41) 3562 3464')\n-u'41-3562-3464'\n->>> f.clean('41.3562.3464')\n-u'41-3562-3464'\n->>> f.clean('41.3562-3464')\n-u'41-3562-3464'\n->>> f.clean(' (41) 3562.3464')\n-u'41-3562-3464'\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n-\n->>> f = BRPhoneNumberField(required=False)\n->>> f.clean('')\n-u''\n->>> f.clean(None)\n-u''\n->>> f.clean(' (41) 3562.3464')\n-u'41-3562-3464'\n->>> f.clean('41.3562-3464')\n-u'41-3562-3464'\n->>> f.clean('(41) 3562 3464')\n-u'41-3562-3464'\n->>> f.clean('4135623464')\n-u'41-3562-3464'\n->>> f.clean('41 3562-3464')\n-u'41-3562-3464'\n-\n-# BRStateSelect ##############################################################\n-\n->>> from django.contrib.localflavor.br.forms import BRStateSelect\n->>> w = BRStateSelect()\n->>> w.render('states', 'PR')\n-u'<select name=\"states\">\\n<option value=\"AC\">Acre</option>\\n<option value=\"AL\">Alagoas</option>\\n<option value=\"AP\">Amap\\xe1</option>\\n<option value=\"AM\">Amazonas</option>\\n<option value=\"BA\">Bahia</option>\\n<option value=\"CE\">Cear\\xe1</option>\\n<option value=\"DF\">Distrito Federal</option>\\n<option value=\"ES\">Esp\\xedrito Santo</option>\\n<option value=\"GO\">Goi\\xe1s</option>\\n<option value=\"MA\">Maranh\\xe3o</option>\\n<option value=\"MT\">Mato Grosso</option>\\n<option value=\"MS\">Mato Grosso do Sul</option>\\n<option value=\"MG\">Minas Gerais</option>\\n<option value=\"PA\">Par\\xe1</option>\\n<option value=\"PB\">Para\\xedba</option>\\n<option value=\"PR\" selected=\"selected\">Paran\\xe1</option>\\n<option value=\"PE\">Pernambuco</option>\\n<option value=\"PI\">Piau\\xed</option>\\n<option value=\"RJ\">Rio de Janeiro</option>\\n<option value=\"RN\">Rio Grande do Norte</option>\\n<option value=\"RS\">Rio Grande do Sul</option>\\n<option value=\"RO\">Rond\\xf4nia</option>\\n<option value=\"RR\">Roraima</option>\\n<option value=\"SC\">Santa Catarina</option>\\n<option value=\"SP\">S\\xe3o Paulo</option>\\n<option value=\"SE\">Sergipe</option>\\n<option value=\"TO\">Tocantins</option>\\n</select>'\n-\n-# BRStateChoiceField #########################################################\n->>> from django.contrib.localflavor.br.forms import BRStateChoiceField\n->>> f = BRStateChoiceField()\n->>> ', '.join([f.clean(s) for s, _ in f.widget.choices])\n-u'AC, AL, AP, AM, BA, CE, DF, ES, GO, MA, MT, MS, MG, PA, PB, PR, PE, PI, RJ, RN, RS, RO, RR, SC, SP, SE, TO'\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('pr')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid brazilian state. That state is not one of the available states.']\n-\"\"\"\n+    def test_BRStateChoiceField(self):\n+        error_invalid = [u'Select a valid brazilian state. That state is not one of the available states.']\n+        valid = {\n+            'AC': 'AC',\n+            'AL': 'AL',\n+            'AP': 'AP',\n+            'AM': 'AM',\n+            'BA': 'BA',\n+            'CE': 'CE',\n+            'DF': 'DF',\n+            'ES': 'ES',\n+            'GO': 'GO',\n+            'MA': 'MA',\n+            'MT': 'MT',\n+            'MS': 'MS',\n+            'MG': 'MG',\n+            'PA': 'PA',\n+            'PB': 'PB',\n+            'PR': 'PR',\n+            'PE': 'PE',\n+            'PI': 'PI',\n+            'RJ': 'RJ',\n+            'RN': 'RN',\n+            'RS': 'RS',\n+            'RO': 'RO',\n+            'RR': 'RR',\n+            'SC': 'SC',\n+            'SP': 'SP',\n+            'SE': 'SE',\n+            'TO': 'TO',\n+        }\n+        invalid = {\n+            'pr': error_invalid,\n+        }\n+        self.assertFieldOutput(BRStateChoiceField, valid, invalid)"
        },
        {
            "sha": "b882dd35e588017f8cb00fad4974c0ef2491aede",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/0cd72cabab8d94b33b1dd3f72518ed7f12521c54/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/0cd72cabab8d94b33b1dd3f72518ed7f12521c54/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=0cd72cabab8d94b33b1dd3f72518ed7f12521c54",
            "patch": "@@ -1,5 +1,4 @@\n # -*- coding: utf-8 -*-\n-from localflavor.br import tests as localflavor_br_tests\n from localflavor.ca import tests as localflavor_ca_tests\n from localflavor.ch import tests as localflavor_ch_tests\n from localflavor.cl import tests as localflavor_cl_tests\n@@ -30,12 +29,12 @@\n from localflavor.de import DELocalFlavorTests\n from localflavor.au import AULocalFlavorTests\n from localflavor.be import BELocalFlavorTests\n+from localflavor.br import BRLocalFlavorTests\n from localflavor.il import ILLocalFlavorTests\n from localflavor.tr import TRLocalFlavorTests\n \n \n __test__ = {\n-    'localflavor_br_tests': localflavor_br_tests,\n     'localflavor_ca_tests': localflavor_ca_tests,\n     'localflavor_ch_tests': localflavor_ch_tests,\n     'localflavor_cl_tests': localflavor_cl_tests,"
        },
        {
            "sha": "64d03175efe24f663331853a822809d02f3d2245",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0cd72cabab8d94b33b1dd3f72518ed7f12521c54/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/0cd72cabab8d94b33b1dd3f72518ed7f12521c54/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=0cd72cabab8d94b33b1dd3f72518ed7f12521c54",
            "patch": "@@ -17,6 +17,7 @@\n     ATLocalFlavorTests,\n     AULocalFlavorTests,\n     BELocalFlavorTests,\n+    BRLocalFlavorTests,\n     DELocalFlavorTests,\n     ILLocalFlavorTests,\n     TRLocalFlavorTests,"
        }
    ],
    "stats": {
        "total": 352,
        "additions": 138,
        "deletions": 214
    }
}