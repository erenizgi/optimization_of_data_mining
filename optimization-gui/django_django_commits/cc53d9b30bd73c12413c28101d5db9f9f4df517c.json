{
    "author": "claudep",
    "message": "Fixed #15877 -- Improved exception when ModelForm has no model class\n\nThanks theaspect at gmail.com for the report and volrath for the\npatch.",
    "sha": "cc53d9b30bd73c12413c28101d5db9f9f4df517c",
    "files": [
        {
            "sha": "75d526d1736009dd786e6c96051b27b96833e92a",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/cc53d9b30bd73c12413c28101d5db9f9f4df517c/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/cc53d9b30bd73c12413c28101d5db9f9f4df517c/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=cc53d9b30bd73c12413c28101d5db9f9f4df517c",
            "patch": "@@ -233,9 +233,9 @@ def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n                  initial=None, error_class=ErrorList, label_suffix=':',\n                  empty_permitted=False, instance=None):\n         opts = self._meta\n+        if opts.model is None:\n+            raise ValueError('ModelForm has no model class specified.')\n         if instance is None:\n-            if opts.model is None:\n-                raise ValueError('ModelForm has no model class specified.')\n             # if we didn't get an instance, instantiate a new one\n             self.instance = opts.model()\n             object_data = {}"
        },
        {
            "sha": "efaf2981e13375608c548ebe343b81d3b30b93e0",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/cc53d9b30bd73c12413c28101d5db9f9f4df517c/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/cc53d9b30bd73c12413c28101d5db9f9f4df517c/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=cc53d9b30bd73c12413c28101d5db9f9f4df517c",
            "patch": "@@ -133,6 +133,9 @@ class ShortCategory(forms.ModelForm):\n     slug = forms.CharField(max_length=5)\n     url = forms.CharField(max_length=3)\n \n+    class Meta:\n+        model = Category\n+\n class ImprovedArticleForm(forms.ModelForm):\n     class Meta:\n         model = ImprovedArticle\n@@ -277,6 +280,19 @@ class BadForm(ArticleForm, BaseCategoryForm):\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n+    def test_invalid_meta_model(self):\n+        class InvalidModelForm(forms.ModelForm):\n+            class Meta:\n+                pass  # no model\n+\n+        # Can't create new form\n+        with self.assertRaises(ValueError):\n+            f = InvalidModelForm()\n+\n+        # Even if you provide a model instance\n+        with self.assertRaises(ValueError):\n+            f = InvalidModelForm(instance=Category)\n+\n     def test_subcategory_form(self):\n         class SubCategoryForm(BaseCategoryForm):\n             \"\"\" Subclassing without specifying a Meta on the class will use"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
    }
}