{
    "author": "aaugustin",
    "message": "[py3] Used six.with_metaclass wherever necessary.",
    "sha": "d11d45aad969be313b9e046d0d42b179a3fb6906",
    "files": [
        {
            "sha": "c13a6bc5cc8f3a255adbe8a7030e728c338b0be8",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=d11d45aad969be313b9e046d0d42b179a3fb6906",
            "patch": "@@ -24,6 +24,7 @@\n from django.utils.datastructures import SortedDict\n from django.utils.html import escape, escapejs\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.text import capfirst, get_text_list\n from django.utils.translation import ugettext as _\n from django.utils.translation import ungettext\n@@ -57,9 +58,8 @@ class IncorrectLookupParameters(Exception):\n \n csrf_protect_m = method_decorator(csrf_protect)\n \n-class BaseModelAdmin(object):\n+class BaseModelAdmin(six.with_metaclass(forms.MediaDefiningClass)):\n     \"\"\"Functionality common to both ModelAdmin and InlineAdmin.\"\"\"\n-    __metaclass__ = forms.MediaDefiningClass\n \n     raw_id_fields = ()\n     fields = None"
        },
        {
            "sha": "04ae4bc96d8477ac96b8bcce402894efd0e88783",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=d11d45aad969be313b9e046d0d42b179a3fb6906",
            "patch": "@@ -24,6 +24,7 @@\n from django.utils.translation import ugettext_lazy as _\n from django.utils.functional import curry\n from django.utils.encoding import smart_str, force_unicode\n+from django.utils import six\n from django.utils.text import get_text_list, capfirst\n \n \n@@ -275,8 +276,8 @@ def __init__(self, db=None):\n         # This impacts validation only; it has no effect on the actual save.\n         self.adding = True\n \n-class Model(object):\n-    __metaclass__ = ModelBase\n+\n+class ModelWithoutMeta(object):\n     _deferred = False\n \n     def __init__(self, *args, **kwargs):\n@@ -369,7 +370,7 @@ def __init__(self, *args, **kwargs):\n                     pass\n             if kwargs:\n                 raise TypeError(\"'%s' is an invalid keyword argument for this function\" % kwargs.keys()[0])\n-        super(Model, self).__init__()\n+        super(ModelWithoutMeta, self).__init__()\n         signals.post_init.send(sender=self.__class__, instance=self)\n \n     def __repr__(self):\n@@ -401,7 +402,7 @@ def __reduce__(self):\n         only module-level classes can be pickled by the default path.\n         \"\"\"\n         if not self._deferred:\n-            return super(Model, self).__reduce__()\n+            return super(ModelWithoutMeta, self).__reduce__()\n         data = self.__dict__\n         defers = []\n         for field in self._meta.fields:\n@@ -876,6 +877,15 @@ def clean_fields(self, exclude=None):\n             raise ValidationError(errors)\n \n \n+# For unknown reasons, six.with_metaclass doesn't work correctly for Model.\n+# Fallback to exec'ing the appropriate syntax for each Python version.\n+\n+if six.PY3:\n+    six.exec_(\"class Model(ModelWithoutMeta, metaclass=ModelBase): pass\")\n+else:\n+    six.exec_(\"class Model(ModelWithoutMeta): __metaclass__ = ModelBase\")\n+\n+\n ############################################\n # HELPER FUNCTIONS (CURRIED MODEL METHODS) #\n ############################################"
        },
        {
            "sha": "0af71918d8c50098aa7b916d7a917792bdd5bf72",
            "filename": "django/forms/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fforms%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fforms%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fforms.py?ref=d11d45aad969be313b9e046d0d42b179a3fb6906",
            "patch": "@@ -14,6 +14,7 @@\n from django.utils.html import conditional_escape, format_html\n from django.utils.encoding import StrAndUnicode, smart_unicode, force_unicode\n from django.utils.safestring import mark_safe\n+from django.utils import six\n \n \n __all__ = ('BaseForm', 'Form')\n@@ -380,14 +381,13 @@ def visible_fields(self):\n         \"\"\"\n         return [field for field in self if not field.is_hidden]\n \n-class Form(BaseForm):\n+class Form(six.with_metaclass(DeclarativeFieldsMetaclass, BaseForm)):\n     \"A collection of Fields, plus their associated data.\"\n     # This is a separate class from BaseForm in order to abstract the way\n     # self.fields is specified. This class (Form) is the one that does the\n     # fancy metaclass stuff purely for the semantic sugar -- it allows one\n     # to define a form using declarative syntax.\n     # BaseForm itself has no way of designating self.fields.\n-    __metaclass__ = DeclarativeFieldsMetaclass\n \n class BoundField(StrAndUnicode):\n     \"A Field plus data\""
        },
        {
            "sha": "1ef308d93a98f086b5d295fe0f93314f987187f8",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=d11d45aad969be313b9e046d0d42b179a3fb6906",
            "patch": "@@ -15,6 +15,7 @@\n     MultipleHiddenInput, media_property)\n from django.utils.encoding import smart_unicode, force_unicode\n from django.utils.datastructures import SortedDict\n+from django.utils import six\n from django.utils.text import get_text_list, capfirst\n from django.utils.translation import ugettext_lazy as _, ugettext\n \n@@ -365,8 +366,8 @@ def save(self, commit=True):\n \n     save.alters_data = True\n \n-class ModelForm(BaseModelForm):\n-    __metaclass__ = ModelFormMetaclass\n+class ModelForm(six.with_metaclass(ModelFormMetaclass, BaseModelForm)):\n+    pass\n \n def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n                       formfield_callback=None,  widgets=None):\n@@ -401,6 +402,7 @@ def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n \n     form_metaclass = ModelFormMetaclass\n \n+    # TODO: this doesn't work under Python 3.\n     if issubclass(form, BaseModelForm) and hasattr(form, '__metaclass__'):\n         form_metaclass = form.__metaclass__\n "
        },
        {
            "sha": "20fa9e973adadccb9f98af2ecd09aba114b4c4c0",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/d11d45aad969be313b9e046d0d42b179a3fb6906/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=d11d45aad969be313b9e046d0d42b179a3fb6906",
            "patch": "@@ -17,6 +17,7 @@\n from django.utils.encoding import StrAndUnicode, force_unicode\n from django.utils.safestring import mark_safe\n from django.utils import datetime_safe, formats\n+from django.utils import six\n \n __all__ = (\n     'Media', 'MediaDefiningClass', 'Widget', 'TextInput', 'PasswordInput',\n@@ -153,8 +154,7 @@ def __unicode__(self):\n             args.append(self.choices)\n         return self.parent_widget.render(*args)\n \n-class Widget(object):\n-    __metaclass__ = MediaDefiningClass\n+class Widget(six.with_metaclass(MediaDefiningClass)):\n     is_hidden = False          # Determines whether this corresponds to an <input type=\"hidden\">.\n     needs_multipart_form = False # Determines does this widget need multipart form\n     is_localized = False"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 24,
        "deletions": 12
    }
}