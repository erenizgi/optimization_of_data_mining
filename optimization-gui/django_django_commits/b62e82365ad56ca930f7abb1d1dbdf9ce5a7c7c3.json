{
    "author": "andrewgodwin",
    "message": "Merge remote-tracking branch 'core/master' into schema-alteration\n\nConflicts:\n\tdjango/db/models/loading.py\n\tdjango/db/models/options.py",
    "sha": "b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
    "files": [
        {
            "sha": "49cb19117c67553f6c64e22437c107c65c51e563",
            "filename": ".gitattributes",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/.gitattributes",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/.gitattributes",
            "contents_url": "https://api.github.com/repos/django/django/contents/.gitattributes?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,2 @@\n+# Normalize line endings to avoid spurious failures in the core test suite on Windows.\n+*html text eol=lf\n\\ No newline at end of file"
        },
        {
            "sha": "0f793cc5f41a311d20ec7e9996e243149be7d3fb",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -91,6 +91,7 @@ answer newbie questions, and generally made Django that much better:\n     James Bennett\n     Danilo Bargen\n     Shai Berger <shai@platonix.com>\n+    berto\n     Julian Bez\n     Arvis Bickovskis <viestards.lists@gmail.com>\n     Natalia Bidart <nataliabidart@gmail.com>\n@@ -231,6 +232,7 @@ answer newbie questions, and generally made Django that much better:\n     Simon Greenhill <dev@simon.net.nz>\n     Owen Griffiths\n     Espen Grindhaug <http://grindhaug.org/>\n+    Mike Grouchy <http://mikegrouchy.com/>\n     Janos Guljas\n     Thomas Güttler <hv@tbz-pariv.de>\n     Horst Gutmann <zerok@zerokspot.com>\n@@ -380,6 +382,7 @@ answer newbie questions, and generally made Django that much better:\n     Christian Metts\n     michal@plovarna.cz\n     Slawek Mikula <slawek dot mikula at gmail dot com>\n+    Katie Miller <katie@sub50.com>\n     Shawn Milochik <shawn@milochik.com>\n     mitakummaa@gmail.com\n     Taylor Mitchell <taylor.mitchell@gmail.com>\n@@ -510,6 +513,7 @@ answer newbie questions, and generally made Django that much better:\n     Johan C. Stöver <johan@nilling.nl>\n     Nowell Strite <http://nowell.strite.org/>\n     Thomas Stromberg <tstromberg@google.com>\n+    Ben Sturmfels <ben@sturm.com.au>\n     Travis Swicegood <travis@domain51.com>\n     Pascal Varet\n     SuperJared\n@@ -528,6 +532,7 @@ answer newbie questions, and generally made Django that much better:\n     Terry Huang <terryh.tp@gmail.com>\n     Travis Terry <tdterry7@gmail.com>\n     thebjorn <bp@datakortet.no>\n+    Lowe Thiderman <lowe.thiderman@gmail.com>\n     Zach Thompson <zthompson47@gmail.com>\n     Michael Thornhill <michael.thornhill@gmail.com>\n     Deepak Thukral <deep.thukral@gmail.com>\n@@ -585,6 +590,7 @@ answer newbie questions, and generally made Django that much better:\n     Gasper Zejn <zejn@kiberpipa.org>\n     Jarek Zgoda <jarek.zgoda@gmail.com>\n     Cheng Zhang\n+    Hannes Struß <x@hannesstruss.de>\n \n A big THANK YOU goes to:\n "
        },
        {
            "sha": "873c328add592b6659fecc27421c782cccf407dd",
            "filename": "django/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,4 +1,4 @@\n-VERSION = (1, 5, 0, 'alpha', 0)\n+VERSION = (1, 6, 0, 'alpha', 0)\n \n def get_version(*args, **kwargs):\n     # Don't litter django/__init__.py with all the get_version stuff."
        },
        {
            "sha": "ac3de00f2c05c47d5a48bc9e33938258cd916086",
            "filename": "django/bin/daily_cleanup.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fbin%2Fdaily_cleanup.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fbin%2Fdaily_cleanup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fbin%2Fdaily_cleanup.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,7 +7,13 @@\n sessions at the moment).\n \"\"\"\n \n+import warnings\n+\n from django.core import management\n \n if __name__ == \"__main__\":\n-    management.call_command('cleanup')\n+    warnings.warn(\n+        \"The `daily_cleanup` script has been deprecated \"\n+        \"in favor of `django-admin.py clearsessions`.\",\n+        PendingDeprecationWarning)\n+    management.call_command('clearsessions')"
        },
        {
            "sha": "b00c8d5046c6cda2fe6f6c7fcf29718c96c86e90",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,6 +6,7 @@\n a list of all possible variables.\n \"\"\"\n \n+import logging\n import os\n import time     # Needed for Windows\n import warnings\n@@ -55,6 +56,15 @@ def _configure_logging(self):\n         \"\"\"\n         Setup logging from LOGGING_CONFIG and LOGGING settings.\n         \"\"\"\n+        try:\n+            # Route warnings through python logging\n+            logging.captureWarnings(True)\n+            # Allow DeprecationWarnings through the warnings filters\n+            warnings.simplefilter(\"default\", DeprecationWarning)\n+        except AttributeError:\n+            # No captureWarnings on Python 2.6, DeprecationWarnings are on anyway\n+            pass\n+\n         if self.LOGGING_CONFIG:\n             from django.utils.log import DEFAULT_LOGGING\n             # First find the logging configuration function ...\n@@ -83,6 +93,7 @@ def configure(self, default_settings=global_settings, **options):\n         for name, value in options.items():\n             setattr(holder, name, value)\n         self._wrapped = holder\n+        self._configure_logging()\n \n     @property\n     def configured(self):\n@@ -99,9 +110,6 @@ class BaseSettings(object):\n     def __setattr__(self, name, value):\n         if name in (\"MEDIA_URL\", \"STATIC_URL\") and value and not value.endswith('/'):\n             raise ImproperlyConfigured(\"If set, %s must end with a slash\" % name)\n-        elif name == \"ADMIN_MEDIA_PREFIX\":\n-            warnings.warn(\"The ADMIN_MEDIA_PREFIX setting has been removed; \"\n-                          \"use STATIC_URL instead.\", DeprecationWarning)\n         elif name == \"ALLOWED_INCLUDE_ROOTS\" and isinstance(value, six.string_types):\n             raise ValueError(\"The ALLOWED_INCLUDE_ROOTS setting must be set \"\n                 \"to a tuple, not a string.\")"
        },
        {
            "sha": "c533efc41cae68cebe3533317d2f4530bd5655c0",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -150,12 +150,8 @@\n # Whether to send broken-link emails.\n SEND_BROKEN_LINK_EMAILS = False\n \n-# Database connection info.\n-DATABASES = {\n-    'default': {\n-        'ENGINE': 'django.db.backends.dummy',\n-    },\n-}\n+# Database connection info. If left empty, will default to the dummy backend.\n+DATABASES = {}\n \n # Classes used to implement DB routing behavior.\n DATABASE_ROUTERS = []\n@@ -449,6 +445,7 @@\n # SESSIONS #\n ############\n \n+SESSION_CACHE_ALIAS = 'default'                         # Cache to store session data if using the cache session backend.\n SESSION_COOKIE_NAME = 'sessionid'                       # Cookie name. This can be whatever you want.\n SESSION_COOKIE_AGE = 60 * 60 * 24 * 7 * 2               # Age of cookie, in seconds (default: 2 weeks).\n SESSION_COOKIE_DOMAIN = None                            # A string like \".example.com\", or None for standard domain cookie."
        },
        {
            "sha": "45e56b6d1904d16960ce21458d62efb3961e9259",
            "filename": "django/conf/locale/__init__.py",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,5 +1,8 @@\n from __future__ import unicode_literals\n \n+# About name_local: capitalize it as if your language name was appearing\n+# inside a sentence in your language.\n+\n LANG_INFO = {\n     'ar': {\n         'bidi': True,\n@@ -53,7 +56,7 @@\n         'bidi': False,\n         'code': 'da',\n         'name': 'Danish',\n-        'name_local': 'Dansk',\n+        'name_local': 'dansk',\n     },\n     'de': {\n         'bidi': False,\n@@ -137,7 +140,7 @@\n         'bidi': False,\n         'code': 'fr',\n         'name': 'French',\n-        'name_local': 'Fran\\xe7ais',\n+        'name_local': 'fran\\xe7ais',\n     },\n     'fy-nl': {\n         'bidi': False,\n@@ -269,7 +272,7 @@\n         'bidi': False,\n         'code': 'nb',\n         'name': 'Norwegian Bokmal',\n-        'name_local': 'Norsk (bokm\\xe5l)',\n+        'name_local': 'norsk (bokm\\xe5l)',\n     },\n     'ne': {\n         'bidi': False,\n@@ -287,13 +290,13 @@\n         'bidi': False,\n         'code': 'nn',\n         'name': 'Norwegian Nynorsk',\n-        'name_local': 'Norsk (nynorsk)',\n+        'name_local': 'norsk (nynorsk)',\n     },\n     'no': {\n         'bidi': False,\n         'code': 'no',\n         'name': 'Norwegian',\n-        'name_local': 'Norsk',\n+        'name_local': 'norsk',\n     },\n     'pa': {\n         'bidi': False,\n@@ -365,7 +368,7 @@\n         'bidi': False,\n         'code': 'sv',\n         'name': 'Swedish',\n-        'name_local': 'Svenska',\n+        'name_local': 'svenska',\n     },\n     'sw': {\n         'bidi': False,"
        },
        {
            "sha": "b9431b5b6781df9b979ddf28bb9ab3e550a62b81",
            "filename": "django/conf/locale/ca/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fca%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fca%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fca%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,10 +19,6 @@\n     # '31/12/2009', '31/12/09'\n     '%d/%m/%Y', '%d/%m/%y'\n )\n-TIME_INPUT_FORMATS = (\n-    # '14:30:59', '14:30'\n-    '%H:%M:%S', '%H:%M'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',\n     '%d/%m/%Y %H:%M',"
        },
        {
            "sha": "ea28718f57c12e6612ff6494e3667926b3141f75",
            "filename": "django/conf/locale/cs/formats.py",
            "status": "modified",
            "additions": 15,
            "deletions": 10,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fcs%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fcs%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fcs%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -17,21 +17,26 @@\n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n-    '%d.%m.%Y', '%d.%m.%y',     # '25.10.2006', '25.10.06'\n-    '%Y-%m-%d', '%y-%m-%d',     # '2006-10-25', '06-10-25'\n+    '%d.%m.%Y', '%d.%m.%y',     # '05.01.2006', '05.01.06'\n+    '%d. %m. %Y', '%d. %m. %y', # '5. 1. 2006', '5. 1. 06'\n     # '%d. %B %Y', '%d. %b. %Y',  # '25. October 2006', '25. Oct. 2006'\n )\n+# Kept ISO formats as one is in first position\n TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n+    '%H:%M:%S', # '04:30:59'\n+    '%H.%M',    # '04.30'\n+    '%H:%M',    # '04:30'\n )\n DATETIME_INPUT_FORMATS = (\n-    '%d.%m.%Y %H:%M:%S',    # '25.10.2006 14:30:59'\n-    '%d.%m.%Y %H:%M',       # '25.10.2006 14:30'\n-    '%d.%m.%Y',             # '25.10.2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n+    '%d.%m.%Y %H:%M:%S',    # '05.01.2006 04:30:59'\n+    '%d.%m.%Y %H.%M',       # '05.01.2006 04.30'\n+    '%d.%m.%Y %H:%M',       # '05.01.2006 04:30'\n+    '%d.%m.%Y',             # '05.01.2006'\n+    '%d. %m. %Y %H:%M:%S',  # '05. 01. 2006 04:30:59'\n+    '%d. %m. %Y %H.%M',     # '05. 01. 2006 04.30'\n+    '%d. %m. %Y %H:%M',     # '05. 01. 2006 04:30'\n+    '%d. %m. %Y',           # '05. 01. 2006'\n+    '%Y-%m-%d %H.%M',       # '2006-01-05 04.30'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '\\xa0' # non-breaking space"
        },
        {
            "sha": "9022eb2ed43f8f9a90b4221d627ee30b6167d64f",
            "filename": "django/conf/locale/da/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fda%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fda%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fda%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,10 +18,6 @@\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y',                         # '25.10.2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',                         # '14:30:59'\n-    '%H:%M',                            # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',                # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',                   # '25.10.2006 14:30'"
        },
        {
            "sha": "a75b806acb4acb8174fa47a8035ed828ab717993",
            "filename": "django/conf/locale/de/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fde%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fde%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fde%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -17,20 +17,12 @@\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y', '%d.%m.%y',     # '25.10.2006', '25.10.06'\n-    '%Y-%m-%d', '%y-%m-%d',     # '2006-10-25', '06-10-25'\n     # '%d. %B %Y', '%d. %b. %Y',  # '25. October 2006', '25. Oct. 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',    # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',       # '25.10.2006 14:30'\n     '%d.%m.%Y',             # '25.10.2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '.'"
        },
        {
            "sha": "667d1eced09366f52998df6374b1e1f28d61482b",
            "filename": "django/conf/locale/de_CH/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fde_CH%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fde_CH%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fde_CH%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,20 +19,12 @@\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y', '%d.%m.%y',     # '25.10.2006', '25.10.06'\n-    '%Y-%m-%d', '%y-%m-%d',     # '2006-10-25', '06-10-25'\n     # '%d. %B %Y', '%d. %b. %Y',  # '25. October 2006', '25. Oct. 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',    # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',       # '25.10.2006 14:30'\n     '%d.%m.%Y',             # '25.10.2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n )\n \n # these are the separators for non-monetary numbers. For monetary numbers,"
        },
        {
            "sha": "6bd693e60ef1876aec418818cf05bb77af23a3d1",
            "filename": "django/conf/locale/en/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fen%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fen%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fen%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,17 +15,14 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%m/%d/%Y', '%m/%d/%y', # '2006-10-25', '10/25/2006', '10/25/06'\n     # '%b %d %Y', '%b %d, %Y',            # 'Oct 25 2006', 'Oct 25, 2006'\n     # '%d %b %Y', '%d %b, %Y',            # '25 Oct 2006', '25 Oct, 2006'\n     # '%B %d %Y', '%B %d, %Y',            # 'October 25 2006', 'October 25, 2006'\n     # '%d %B %Y', '%d %B, %Y',            # '25 October 2006', '25 October, 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'"
        },
        {
            "sha": "b594aafb747f814e5ece1204511e16d089489b66",
            "filename": "django/conf/locale/en_GB/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fen_GB%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fen_GB%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fen_GB%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -17,16 +17,11 @@\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n     '%d/%m/%Y', '%d/%m/%y',             # '25/10/2006', '25/10/06'\n-    '%Y-%m-%d',                         # '2006-10-25'\n     # '%b %d %Y', '%b %d, %Y',          # 'Oct 25 2006', 'Oct 25, 2006'\n     # '%d %b %Y', '%d %b, %Y',          # '25 Oct 2006', '25 Oct, 2006'\n     # '%B %d %Y', '%B %d, %Y',          # 'October 25 2006', 'October 25, 2006'\n     # '%d %B %Y', '%d %B, %Y',          # '25 October 2006', '25 October, 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',                         # '14:30:59'\n-    '%H:%M',                            # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',                # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',                   # '2006-10-25 14:30'"
        },
        {
            "sha": "62411583381e69626dcb9f59f9d46386a2db5f8b",
            "filename": "django/conf/locale/es/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fes%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,10 +19,6 @@\n     # '31/12/2009', '31/12/09'\n     '%d/%m/%Y', '%d/%m/%y'\n )\n-TIME_INPUT_FORMATS = (\n-    # '14:30:59', '14:30'\n-    '%H:%M:%S', '%H:%M'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',\n     '%d/%m/%Y %H:%M',"
        },
        {
            "sha": "651690bfdff35c0683a1855eb0df7507de92f5cb",
            "filename": "django/conf/locale/es_AR/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes_AR%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes_AR%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fes_AR%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,10 +19,6 @@\n     '%d/%m/%Y', # '31/12/2009'\n     '%d/%m/%y', # '31/12/09'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',\n     '%d/%m/%Y %H:%M',"
        },
        {
            "sha": "e0e6d7f16d7547ee0e21785cdfa0ea0f758ff961",
            "filename": "django/conf/locale/es_MX/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes_MX%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes_MX%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fes_MX%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,9 +15,6 @@\n     '%d/%m/%Y', '%d/%m/%y',             # '25/10/2006', '25/10/06'\n     '%Y%m%d',                           # '20061025'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', '%H:%M',\t\t# '14:30:59', '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',\n     '%d/%m/%Y %H:%M',"
        },
        {
            "sha": "a22432a16af578f8200336a3c57ca8cbd19069ac",
            "filename": "django/conf/locale/es_NI/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes_NI%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fes_NI%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fes_NI%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,9 +15,6 @@\n     '%Y%m%d',                          \t# '20061025'\n \n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', '%H:%M',\t\t# '14:30:59', '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',\n     '%d/%m/%Y %H:%M',"
        },
        {
            "sha": "1ef7ecb2427af990c228a1877efdb7f1ce505d2a",
            "filename": "django/conf/locale/fr/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Ffr%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Ffr%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Ffr%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,23 +19,15 @@\n DATE_INPUT_FORMATS = (\n     '%d/%m/%Y', '%d/%m/%y', # '25/10/2006', '25/10/06'\n     '%d.%m.%Y', '%d.%m.%y', # Swiss (fr_CH), '25.10.2006', '25.10.06'\n-    '%Y-%m-%d', '%y-%m-%d', # '2006-10-25', '06-10-25'\n     # '%d %B %Y', '%d %b %Y', # '25 octobre 2006', '25 oct. 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',    # '25/10/2006 14:30:59'\n     '%d/%m/%Y %H:%M',       # '25/10/2006 14:30'\n     '%d/%m/%Y',             # '25/10/2006'\n     '%d.%m.%Y %H:%M:%S',    # Swiss (fr_CH), '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',       # Swiss (fr_CH), '25.10.2006 14:30'\n     '%d.%m.%Y',             # Swiss (fr_CH), '25.10.2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '\\xa0' # non-breaking space"
        },
        {
            "sha": "9f4c74051e19065744790fc96a6b4c47ab9627a8",
            "filename": "django/conf/locale/hr/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fhr%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fhr%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fhr%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,15 +15,12 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d',                     # '2006-10-25'\n     '%d.%m.%Y.', '%d.%m.%y.',       # '25.10.2006.', '25.10.06.'\n     '%d. %m. %Y.', '%d. %m. %y.',   # '25. 10. 2006.', '25. 10. 06.'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',      # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',         # '2006-10-25 14:30'"
        },
        {
            "sha": "de81fa6cdf3d73e4d1ff38c96b9f77b066e08298",
            "filename": "django/conf/locale/it/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fit%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fit%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fit%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -20,10 +20,6 @@\n     '%d-%m-%Y', '%Y-%m-%d',  # '25-10-2006', '2008-10-25'\n     '%d-%m-%y', '%d/%m/%y',  # '25-10-06', '25/10/06'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',     # '25/10/2006 14:30:59'\n     '%d/%m/%Y %H:%M',        # '25/10/2006 14:30'"
        },
        {
            "sha": "c3552e0661c4eb071921a559af857c4ca076fe6f",
            "filename": "django/conf/locale/ka/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fka%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fka%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fka%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,16 +15,13 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%m/%d/%Y', '%m/%d/%y',     # '2006-10-25', '10/25/2006', '10/25/06'\n     # '%d %b %Y', '%d %b, %Y', '%d %b. %Y',   # '25 Oct 2006', '25 Oct, 2006', '25 Oct. 2006'\n     # '%d %B %Y', '%d %B, %Y',                # '25 October 2006', '25 October, 2006'\n     # '%d.%m.%Y', '%d.%m.%y',                 # '25.10.2006', '25.10.06'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'"
        },
        {
            "sha": "b794afe90095be74e793ff0bfb1a86b46cf95a66",
            "filename": "django/conf/locale/ko/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fko%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fko%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fko%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,6 +16,7 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%m/%d/%Y', '%m/%d/%y', # '2006-10-25', '10/25/2006', '10/25/06'\n     # '%b %d %Y', '%b %d, %Y',            # 'Oct 25 2006', 'Oct 25, 2006'"
        },
        {
            "sha": "f115a6e4878cc643ae47cfee3e89511b57e93187",
            "filename": "django/conf/locale/lv/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Flv%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Flv%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Flv%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,6 +16,7 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%d.%m.%Y', '%d.%m.%y', # '2006-10-25', '25.10.2006', '25.10.06'\n )"
        },
        {
            "sha": "44feb512bfa0fe2bdb16ba7ebd5692040bc1cd99",
            "filename": "django/conf/locale/mk/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fmk%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fmk%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fmk%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,12 +18,6 @@\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y.', '%d.%m.%y.',       # '25.10.2006.', '25.10.06.'\n     '%d. %m. %Y.', '%d. %m. %y.',   # '25. 10. 2006.', '25. 10. 06.'\n-    '%Y-%m-%d',                     # '2006-10-25'\n-)\n-\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n )\n \n DATETIME_INPUT_FORMATS = (\n@@ -39,9 +33,6 @@\n     '%d. %m. %y. %H:%M:%S',   # '25. 10. 06. 14:30:59'\n     '%d. %m. %y. %H:%M',      # '25. 10. 06. 14:30'\n     '%d. %m. %y.',            # '25. 10. 06.'\n-    '%Y-%m-%d %H:%M:%S',      # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',         # '2006-10-25 14:30'\n-    '%Y-%m-%d',               # '2006-10-25'\n )\n \n DECIMAL_SEPARATOR = ','"
        },
        {
            "sha": "6bd693e60ef1876aec418818cf05bb77af23a3d1",
            "filename": "django/conf/locale/ml/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fml%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fml%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fml%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,17 +15,14 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%m/%d/%Y', '%m/%d/%y', # '2006-10-25', '10/25/2006', '10/25/06'\n     # '%b %d %Y', '%b %d, %Y',            # 'Oct 25 2006', 'Oct 25, 2006'\n     # '%d %b %Y', '%d %b, %Y',            # '25 Oct 2006', '25 Oct, 2006'\n     # '%B %d %Y', '%B %d, %Y',            # 'October 25 2006', 'October 25, 2006'\n     # '%d %B %Y', '%d %B, %Y',            # '25 October 2006', '25 October, 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'"
        },
        {
            "sha": "9a009dc03a77b390c8ee16deea292c5799b2b4c3",
            "filename": "django/conf/locale/nb/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fnb%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fnb%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fnb%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,22 +16,17 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%d.%m.%Y', '%d.%m.%y', # '2006-10-25', '25.10.2006', '25.10.06'\n-    '%Y-%m-%d',                         # '2006-10-25',\n     # '%d. %b %Y', '%d %b %Y',            # '25. okt 2006', '25 okt 2006'\n     # '%d. %b. %Y', '%d %b. %Y',          # '25. okt. 2006', '25 okt. 2006'\n     # '%d. %B %Y', '%d %B %Y',            # '25. oktober 2006', '25 oktober 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',     # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'\n     '%Y-%m-%d',              # '2006-10-25'\n-    '%Y-%m-%d',              # '2006-10-25'\n     '%d.%m.%Y %H:%M:%S',     # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',        # '25.10.2006 14:30'\n     '%d.%m.%Y',              # '25.10.2006'"
        },
        {
            "sha": "be5a1461042698c73a560c5d1ef68e2aa24906af",
            "filename": "django/conf/locale/nl/formats.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fnl%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fnl%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fnl%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,10 +16,11 @@\n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n-    '%d-%m-%Y', '%d-%m-%y', '%Y-%m-%d', # '20-01-2009', '20-01-09', '2009-01-20'\n-    # '%d %b %Y', '%d %b %y',             # '20 jan 2009', '20 jan 09'\n-    # '%d %B %Y', '%d %B %y',             # '20 januari 2009', '20 januari 09'\n+    '%d-%m-%Y', '%d-%m-%y',             # '20-01-2009', '20-01-09'\n+    # '%d %b %Y', '%d %b %y',           # '20 jan 2009', '20 jan 09'\n+    # '%d %B %Y', '%d %B %y',           # '20 januari 2009', '20 januari 09'\n )\n+# Kept ISO formats as one is in first position\n TIME_INPUT_FORMATS = (\n     '%H:%M:%S',                         # '15:23:35'\n     '%H.%M:%S',                         # '15.23:35'"
        },
        {
            "sha": "a9b8b562fc2c3349d58bce700e117fdf2504534c",
            "filename": "django/conf/locale/nn/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fnn%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fnn%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fnn%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,17 +16,13 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%d.%m.%Y', '%d.%m.%y', # '2006-10-25', '25.10.2006', '25.10.06'\n-    '%Y-%m-%d',                         # '2006-10-25',\n     # '%d. %b %Y', '%d %b %Y',            # '25. okt 2006', '25 okt 2006'\n     # '%d. %b. %Y', '%d %b. %Y',          # '25. okt. 2006', '25 okt. 2006'\n     # '%d. %B %Y', '%d %B %Y',            # '25. oktober 2006', '25 oktober 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',     # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'"
        },
        {
            "sha": "064e75f1ee6ae4839331743fe43eb5406693cf7f",
            "filename": "django/conf/locale/pl/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fpl%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fpl%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fpl%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,20 +18,13 @@\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y', '%d.%m.%y',     # '25.10.2006', '25.10.06'\n-    '%Y-%m-%d', '%y-%m-%d',     # '2006-10-25', '06-10-25'\n+    '%y-%m-%d',                 # '06-10-25'\n     # '%d. %B %Y', '%d. %b. %Y',  # '25. October 2006', '25. Oct. 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',    # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',       # '25.10.2006 14:30'\n     '%d.%m.%Y',             # '25.10.2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = ' '"
        },
        {
            "sha": "2d6ca69647478386d9c58db7831f68266a6f61cc",
            "filename": "django/conf/locale/pt/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fpt%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fpt%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fpt%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,15 +15,12 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d', '%d/%m/%Y', '%d/%m/%y', # '2006-10-25', '25/10/2006', '25/10/06'\n     # '%d de %b de %Y', '%d de %b, %Y',   # '25 de Out de 2006', '25 Out, 2006'\n     # '%d de %B de %Y', '%d de %B, %Y',   # '25 de Outubro de 2006', '25 de Outubro, 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'"
        },
        {
            "sha": "7a6e0877c3b47c437e5b7faffde9e2eef608526b",
            "filename": "django/conf/locale/pt_BR/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fpt_BR%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fpt_BR%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fpt_BR%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -17,24 +17,17 @@\n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n-    '%d/%m/%Y', '%d/%m/%y', '%Y-%m-%d', # '25/10/2006', '25/10/06', '2006-10-25'\n+    '%d/%m/%Y', '%d/%m/%y', # '25/10/2006', '25/10/06'\n     # '%d de %b de %Y', '%d de %b, %Y',   # '25 de Out de 2006', '25 Out, 2006'\n     # '%d de %B de %Y', '%d de %B, %Y',   # '25 de Outubro de 2006', '25 de Outubro, 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',     # '25/10/2006 14:30:59'\n     '%d/%m/%Y %H:%M',        # '25/10/2006 14:30'\n     '%d/%m/%Y',              # '25/10/2006'\n     '%d/%m/%y %H:%M:%S',     # '25/10/06 14:30:59'\n     '%d/%m/%y %H:%M',        # '25/10/06 14:30'\n     '%d/%m/%y',              # '25/10/06'\n-    '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'\n-    '%Y-%m-%d',              # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '.'"
        },
        {
            "sha": "d692e67833dabeed09fb853fc044b7c7ddda4a5e",
            "filename": "django/conf/locale/ru/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fru%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fru%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fru%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,22 +19,14 @@\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y',  # '25.10.2006'\n     '%d.%m.%y',  # '25.10.06'\n-    '%Y-%m-%d',  # '2006-10-25'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',  # '14:30:59'\n-    '%H:%M',     # '14:30'\n-) \n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',  # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',     # '25.10.2006 14:30'\n     '%d.%m.%Y',           # '25.10.2006'\n     '%d.%m.%y %H:%M:%S',  # '25.10.06 14:30:59'\n     '%d.%m.%y %H:%M',     # '25.10.06 14:30'\n     '%d.%m.%y',           # '25.10.06'\n-    '%Y-%m-%d %H:%M:%S',  # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',     # '2006-10-25 14:30'\n-    '%Y-%m-%d',           # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '\\xa0' # non-breaking space"
        },
        {
            "sha": "85e2cd8af9a66220f3773bb4f8f973d54531af0d",
            "filename": "django/conf/locale/sk/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsk%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsk%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fsk%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,20 +18,13 @@\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y', '%d.%m.%y',     # '25.10.2006', '25.10.06'\n-    '%Y-%m-%d', '%y-%m-%d',     # '2006-10-25', '06-10-25'\n+    '%y-%m-%d',                 # '06-10-25'\n     # '%d. %B %Y', '%d. %b. %Y',  # '25. October 2006', '25. Oct. 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',    # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',       # '25.10.2006 14:30'\n     '%d.%m.%Y',             # '25.10.2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '\\xa0' # non-breaking space"
        },
        {
            "sha": "0d6137e1ed741597c7f1dfdac76718ff924bb7fe",
            "filename": "django/conf/locale/sl/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsl%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsl%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fsl%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -21,11 +21,6 @@\n     '%d. %m. %Y', '%d. %m. %y',     # '25. 10. 2006', '25. 10. 06'\n )\n \n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n-\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y %H:%M:%S',            # '25.10.2006 14:30:59'\n     '%d.%m.%Y %H:%M',               # '25.10.2006 14:30'"
        },
        {
            "sha": "227f20d723122233844a767bc64c29fdf614d3cd",
            "filename": "django/conf/locale/sr/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsr%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsr%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fsr%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,15 +18,10 @@\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y.', '%d.%m.%y.',       # '25.10.2006.', '25.10.06.'\n     '%d. %m. %Y.', '%d. %m. %y.',   # '25. 10. 2006.', '25. 10. 06.'\n-    '%Y-%m-%d',                     # '2006-10-25'\n     # '%d. %b %y.', '%d. %B %y.',     # '25. Oct 06.', '25. October 06.'\n     # '%d. %b \\'%y.', '%d. %B \\'%y.', # '25. Oct '06.', '25. October '06.'\n     # '%d. %b %Y.', '%d. %B %Y.',     # '25. Oct 2006.', '25. October 2006.'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y. %H:%M:%S',     # '25.10.2006. 14:30:59'\n     '%d.%m.%Y. %H:%M',        # '25.10.2006. 14:30'\n@@ -40,9 +35,6 @@\n     '%d. %m. %y. %H:%M:%S',   # '25. 10. 06. 14:30:59'\n     '%d. %m. %y. %H:%M',      # '25. 10. 06. 14:30'\n     '%d. %m. %y.',            # '25. 10. 06.'\n-    '%Y-%m-%d %H:%M:%S',      # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',         # '2006-10-25 14:30'\n-    '%Y-%m-%d',               # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '.'"
        },
        {
            "sha": "227f20d723122233844a767bc64c29fdf614d3cd",
            "filename": "django/conf/locale/sr_Latn/formats.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsr_Latn%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsr_Latn%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fsr_Latn%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,15 +18,10 @@\n DATE_INPUT_FORMATS = (\n     '%d.%m.%Y.', '%d.%m.%y.',       # '25.10.2006.', '25.10.06.'\n     '%d. %m. %Y.', '%d. %m. %y.',   # '25. 10. 2006.', '25. 10. 06.'\n-    '%Y-%m-%d',                     # '2006-10-25'\n     # '%d. %b %y.', '%d. %B %y.',     # '25. Oct 06.', '25. October 06.'\n     # '%d. %b \\'%y.', '%d. %B \\'%y.', # '25. Oct '06.', '25. October '06.'\n     # '%d. %b %Y.', '%d. %B %Y.',     # '25. Oct 2006.', '25. October 2006.'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d.%m.%Y. %H:%M:%S',     # '25.10.2006. 14:30:59'\n     '%d.%m.%Y. %H:%M',        # '25.10.2006. 14:30'\n@@ -40,9 +35,6 @@\n     '%d. %m. %y. %H:%M:%S',   # '25. 10. 06. 14:30:59'\n     '%d. %m. %y. %H:%M',      # '25. 10. 06. 14:30'\n     '%d. %m. %y.',            # '25. 10. 06.'\n-    '%Y-%m-%d %H:%M:%S',      # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',         # '2006-10-25 14:30'\n-    '%Y-%m-%d',               # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '.'"
        },
        {
            "sha": "0f52c2c1a5b4d354032f0bd4c733bbdb70e7ad82",
            "filename": "django/conf/locale/sv/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsv%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Fsv%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fsv%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,15 +16,12 @@\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n+# Kept ISO formats as they are in first position\n DATE_INPUT_FORMATS = (\n     '%Y-%m-%d',              # '2006-10-25'\n     '%m/%d/%Y',              # '10/25/2006'\n     '%m/%d/%y',              # '10/25/06'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S',     # '14:30:59'\n-    '%H:%M',        # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%Y-%m-%d %H:%M:%S',     # '2006-10-25 14:30:59'\n     '%Y-%m-%d %H:%M',        # '2006-10-25 14:30'"
        },
        {
            "sha": "705b2ed6595ca2ba156518158a0912dbc4b1edc8",
            "filename": "django/conf/locale/tr/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Ftr%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Flocale%2Ftr%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Ftr%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -17,20 +17,13 @@\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior\n DATE_INPUT_FORMATS = (\n     '%d/%m/%Y', '%d/%m/%y',     # '25/10/2006', '25/10/06'\n-    '%Y-%m-%d', '%y-%m-%d',     # '2006-10-25', '06-10-25'\n+    '%y-%m-%d',                 # '06-10-25'\n     # '%d %B %Y', '%d %b. %Y',  # '25 Ekim 2006', '25 Eki. 2006'\n )\n-TIME_INPUT_FORMATS = (\n-    '%H:%M:%S', # '14:30:59'\n-    '%H:%M',    # '14:30'\n-)\n DATETIME_INPUT_FORMATS = (\n     '%d/%m/%Y %H:%M:%S',    # '25/10/2006 14:30:59'\n     '%d/%m/%Y %H:%M',       # '25/10/2006 14:30'\n     '%d/%m/%Y',             # '25/10/2006'\n-    '%Y-%m-%d %H:%M:%S',    # '2006-10-25 14:30:59'\n-    '%Y-%m-%d %H:%M',       # '2006-10-25 14:30'\n-    '%Y-%m-%d',             # '2006-10-25'\n )\n DECIMAL_SEPARATOR = ','\n THOUSAND_SEPARATOR = '.'"
        },
        {
            "sha": "559e27ca1632baab4559de9c22850cf888124be1",
            "filename": "django/conf/project_template/project_name/settings.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -75,7 +75,7 @@\n STATICFILES_FINDERS = (\n     'django.contrib.staticfiles.finders.FileSystemFinder',\n     'django.contrib.staticfiles.finders.AppDirectoriesFinder',\n-#    'django.contrib.staticfiles.finders.DefaultStorageFinder',\n+    # 'django.contrib.staticfiles.finders.DefaultStorageFinder',\n )\n \n # Make this unique, and don't share it with anybody.\n@@ -85,7 +85,7 @@\n TEMPLATE_LOADERS = (\n     'django.template.loaders.filesystem.Loader',\n     'django.template.loaders.app_directories.Loader',\n-#     'django.template.loaders.eggs.Loader',\n+    # 'django.template.loaders.eggs.Loader',\n )\n \n MIDDLEWARE_CLASSES = ("
        },
        {
            "sha": "ff66d3e3f30f7bb8ad1c0bb3f1742c9d040031b6",
            "filename": "django/contrib/admin/filters.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ffilters.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,7 +9,7 @@\n \n from django.db import models\n from django.core.exceptions import ImproperlyConfigured, ValidationError\n-from django.utils.encoding import smart_text\n+from django.utils.encoding import smart_text, force_text\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n from django.contrib.admin.util import (get_model_from_relation,\n@@ -102,7 +102,7 @@ def choices(self, cl):\n         }\n         for lookup, title in self.lookup_choices:\n             yield {\n-                'selected': self.value() == lookup,\n+                'selected': self.value() == force_text(lookup),\n                 'query_string': cl.get_query_string({\n                     self.parameter_name: lookup,\n                 }, []),"
        },
        {
            "sha": "1fabdce245cb5ee813dbdc3691c50edfd088516d",
            "filename": "django/contrib/admin/forms.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fforms.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,8 +6,8 @@\n from django.contrib.auth.forms import AuthenticationForm\n from django.utils.translation import ugettext_lazy\n \n-ERROR_MESSAGE = ugettext_lazy(\"Please enter the correct username and password \"\n-        \"for a staff account. Note that both fields are case-sensitive.\")\n+ERROR_MESSAGE = ugettext_lazy(\"Please enter the correct %(username)s and password \"\n+        \"for a staff account. Note that both fields may be case-sensitive.\")\n \n \n class AdminAuthenticationForm(AuthenticationForm):\n@@ -26,8 +26,12 @@ def clean(self):\n         if username and password:\n             self.user_cache = authenticate(username=username, password=password)\n             if self.user_cache is None:\n-                raise forms.ValidationError(message)\n+                raise forms.ValidationError(message % {\n+                    'username': self.username_field.verbose_name\n+                })\n             elif not self.user_cache.is_active or not self.user_cache.is_staff:\n-                raise forms.ValidationError(message)\n+                raise forms.ValidationError(message % {\n+                    'username': self.username_field.verbose_name\n+                })\n         self.check_for_test_cookie()\n         return self.cleaned_data"
        },
        {
            "sha": "4203287123d841af6a2a61564be953b491b465ae",
            "filename": "django/contrib/admin/helpers.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fhelpers.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -186,9 +186,7 @@ def contents(self):\n                     if getattr(attr, \"allow_tags\", False):\n                         result_repr = mark_safe(result_repr)\n             else:\n-                if value is None:\n-                    result_repr = EMPTY_CHANGELIST_VALUE\n-                elif isinstance(f.rel, ManyToManyRel):\n+                if isinstance(f.rel, ManyToManyRel) and value is not None:\n                     result_repr = \", \".join(map(six.text_type, value.all()))\n                 else:\n                     result_repr = display_for_field(value, f)"
        },
        {
            "sha": "b697d7bdc82eb04b2be449e4cb59385771a3c692",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -4,7 +4,7 @@\n from django.conf import settings\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.admin.util import quote\n-from django.utils.translation import ugettext_lazy as _\n+from django.utils.translation import ugettext, ugettext_lazy as _\n from django.utils.encoding import smart_text\n from django.utils.encoding import python_2_unicode_compatible\n \n@@ -42,13 +42,16 @@ def __repr__(self):\n \n     def __str__(self):\n         if self.action_flag == ADDITION:\n-            return _('Added \"%(object)s\".') % {'object': self.object_repr}\n+            return ugettext('Added \"%(object)s\".') % {'object': self.object_repr}\n         elif self.action_flag == CHANGE:\n-            return _('Changed \"%(object)s\" - %(changes)s') % {'object': self.object_repr, 'changes': self.change_message}\n+            return ugettext('Changed \"%(object)s\" - %(changes)s') % {\n+                'object': self.object_repr,\n+                'changes': self.change_message,\n+            }\n         elif self.action_flag == DELETION:\n-            return _('Deleted \"%(object)s.\"') % {'object': self.object_repr}\n+            return ugettext('Deleted \"%(object)s.\"') % {'object': self.object_repr}\n \n-        return _('LogEntry Object')\n+        return ugettext('LogEntry Object')\n \n     def is_addition(self):\n         return self.action_flag == ADDITION"
        },
        {
            "sha": "1827d401591ab00de0e222ca676b44a64b4a3b7c",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 32,
            "deletions": 9,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,3 +1,4 @@\n+import copy\n from functools import update_wrapper, partial\n import warnings\n \n@@ -130,7 +131,7 @@ def formfield_for_dbfield(self, db_field, **kwargs):\n         # passed to formfield_for_dbfield override the defaults.\n         for klass in db_field.__class__.mro():\n             if klass in self.formfield_overrides:\n-                kwargs = dict(self.formfield_overrides[klass], **kwargs)\n+                kwargs = dict(copy.deepcopy(self.formfield_overrides[klass]), **kwargs)\n                 return db_field.formfield(**kwargs)\n \n         # For any other type of field, just call its formfield() method.\n@@ -407,8 +408,6 @@ def media(self):\n             js.append('actions%s.js' % extra)\n         if self.prepopulated_fields:\n             js.extend(['urlify.js', 'prepopulate%s.js' % extra])\n-        if self.opts.get_ordered_objects():\n-            js.extend(['getElementsBySelector.js', 'dom-drag.js' , 'admin/ordering.js'])\n         return forms.Media(js=[static('admin/js/%s' % url) for url in js])\n \n     def get_model_perms(self, request):\n@@ -552,7 +551,7 @@ def log_deletion(self, request, object, object_repr):\n         \"\"\"\n         from django.contrib.admin.models import LogEntry, DELETION\n         LogEntry.objects.log_action(\n-            user_id         = request.user.id,\n+            user_id         = request.user.pk,\n             content_type_id = ContentType.objects.get_for_model(self.model).pk,\n             object_id       = object.pk,\n             object_repr     = object_repr,\n@@ -665,6 +664,13 @@ def get_list_display_links(self, request, list_display):\n             # Use only the first item in list_display as link\n             return list(list_display)[:1]\n \n+    def get_list_filter(self, request):\n+        \"\"\"\n+        Returns a sequence containing the fields to be displayed as filters in\n+        the right sidebar of the changelist page.\n+        \"\"\"\n+        return self.list_filter\n+\n     def construct_change_message(self, request, form, formsets):\n         \"\"\"\n         Construct a change message from a changed object.\n@@ -691,12 +697,30 @@ def construct_change_message(self, request, form, formsets):\n         change_message = ' '.join(change_message)\n         return change_message or _('No fields changed.')\n \n-    def message_user(self, request, message):\n+    def message_user(self, request, message, level=messages.INFO, extra_tags='',\n+                     fail_silently=False):\n         \"\"\"\n         Send a message to the user. The default implementation\n         posts a message using the django.contrib.messages backend.\n+\n+        Exposes almost the same API as messages.add_message(), but accepts the\n+        positional arguments in a different order to maintain backwards\n+        compatibility. For convenience, it accepts the `level` argument as\n+        a string rather than the usual level number.\n         \"\"\"\n-        messages.info(request, message)\n+\n+        if not isinstance(level, int):\n+            # attempt to get the level if passed a string\n+            try:\n+                level = getattr(messages.constants, level.upper())\n+            except AttributeError:\n+                levels = messages.constants.DEFAULT_TAGS.values()\n+                levels_repr = ', '.join('`%s`' % l for l in levels)\n+                raise ValueError('Bad message level string: `%s`. '\n+                        'Possible values are: %s' % (level, levels_repr))\n+\n+        messages.add_message(request, level, message, extra_tags=extra_tags,\n+                fail_silently=fail_silently)\n \n     def save_form(self, request, form, change):\n         \"\"\"\n@@ -738,7 +762,6 @@ def save_related(self, request, form, formsets, change):\n     def render_change_form(self, request, context, add=False, change=False, form_url='', obj=None):\n         opts = self.model._meta\n         app_label = opts.app_label\n-        ordered_objects = opts.get_ordered_objects()\n         context.update({\n             'add': add,\n             'change': change,\n@@ -747,7 +770,6 @@ def render_change_form(self, request, context, add=False, change=False, form_url\n             'has_delete_permission': self.has_delete_permission(request, obj),\n             'has_file_field': True, # FIXME - this should check if form or formsets have a FileField,\n             'has_absolute_url': hasattr(self.model, 'get_absolute_url'),\n-            'ordered_objects': ordered_objects,\n             'form_url': form_url,\n             'opts': opts,\n             'content_type_id': ContentType.objects.get_for_model(self.model).id,\n@@ -1174,6 +1196,7 @@ def changelist_view(self, request, extra_context=None):\n \n         list_display = self.get_list_display(request)\n         list_display_links = self.get_list_display_links(request, list_display)\n+        list_filter = self.get_list_filter(request)\n \n         # Check actions to see if any are available on this changelist\n         actions = self.get_actions(request)\n@@ -1184,7 +1207,7 @@ def changelist_view(self, request, extra_context=None):\n         ChangeList = self.get_changelist(request)\n         try:\n             cl = ChangeList(request, self.model, list_display,\n-                list_display_links, self.list_filter, self.date_hierarchy,\n+                list_display_links, list_filter, self.date_hierarchy,\n                 self.search_fields, self.list_select_related,\n                 self.list_per_page, self.list_max_show_all, self.list_editable,\n                 self)"
        },
        {
            "sha": "185417015ab067e1e9f1aabdc2b6b3ad9029acb7",
            "filename": "django/contrib/admin/sites.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fsites.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fsites.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fsites.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -354,6 +354,7 @@ def index(self, request, extra_context=None):\n                     info = (app_label, model._meta.module_name)\n                     model_dict = {\n                         'name': capfirst(model._meta.verbose_name_plural),\n+                        'object_name': model._meta.object_name,\n                         'perms': perms,\n                     }\n                     if perms.get('change', False):\n@@ -371,6 +372,7 @@ def index(self, request, extra_context=None):\n                     else:\n                         app_dict[app_label] = {\n                             'name': app_label.title(),\n+                            'app_label': app_label,\n                             'app_url': reverse('admin:app_list', kwargs={'app_label': app_label}, current_app=self.name),\n                             'has_module_perms': has_module_perms,\n                             'models': [model_dict],\n@@ -389,9 +391,9 @@ def index(self, request, extra_context=None):\n             'app_list': app_list,\n         }\n         context.update(extra_context or {})\n-        return TemplateResponse(request, [\n-            self.index_template or 'admin/index.html',\n-        ], context, current_app=self.name)\n+        return TemplateResponse(request, self.index_template or\n+                                'admin/index.html', context,\n+                                current_app=self.name)\n \n     def app_index(self, request, app_label, extra_context=None):\n         user = request.user\n@@ -408,6 +410,7 @@ def app_index(self, request, app_label, extra_context=None):\n                         info = (app_label, model._meta.module_name)\n                         model_dict = {\n                             'name': capfirst(model._meta.verbose_name_plural),\n+                            'object_name': model._meta.object_name,\n                             'perms': perms,\n                         }\n                         if perms.get('change', False):\n@@ -428,6 +431,7 @@ def app_index(self, request, app_label, extra_context=None):\n                             # information.\n                             app_dict = {\n                                 'name': app_label.title(),\n+                                'app_label': app_label,\n                                 'app_url': '',\n                                 'has_module_perms': has_module_perms,\n                                 'models': [model_dict],"
        },
        {
            "sha": "5ac4032c15541cef9e0e675629c9087fe90871e7",
            "filename": "django/contrib/admin/static/admin/css/base.css",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fbase.css",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fbase.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fbase.css?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -322,6 +322,10 @@ thead th.sorted {\n     background: #c5c5c5 url(../img/nav-bg-selected.gif) top left repeat-x;\n }\n \n+thead th.sorted .text {\n+\tpadding-right: 42px;\n+}\n+\n table thead th .text span {\n     padding: 2px 5px;\n     display:block;"
        },
        {
            "sha": "ba9f1b5ad71b83ba39b9694199cf315504075529",
            "filename": "django/contrib/admin/static/admin/css/rtl.css",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Frtl.css",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Frtl.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Frtl.css?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -84,6 +84,11 @@ table thead th.sorted .sortoptions {\n    float: left;\n }\n \n+thead th.sorted .text {\n+\tpadding-right: 0;\n+\tpadding-left: 42px;\n+}\n+\n /* dashboard styles */\n \n .dashboard .module table td a {"
        },
        {
            "sha": "3b19353e6fcc6cc2ab7dba22761449531377c38d",
            "filename": "django/contrib/admin/static/admin/css/widgets.css",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -225,6 +225,21 @@ table p.datetime {\n     padding-left: 0;\n }\n \n+/* URL */\n+\n+p.url {\n+    line-height: 20px;\n+    margin: 0;\n+    padding: 0;\n+    color: #666;\n+    font-size: 11px;\n+    font-weight: bold;\n+}\n+\n+.url a {\n+    font-weight: normal;\n+}\n+\n /* FILE UPLOADS */\n \n p.file-upload {"
        },
        {
            "sha": "595be4d62bf0eafddb54b94464c50a7b77064514",
            "filename": "django/contrib/admin/static/admin/js/admin/ordering.js",
            "status": "removed",
            "additions": 0,
            "deletions": 137,
            "changes": 137,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Fadmin%2Fordering.js",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Fadmin%2Fordering.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Fadmin%2Fordering.js?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,137 +0,0 @@\n-addEvent(window, 'load', reorder_init);\n-\n-var lis;\n-var top = 0;\n-var left = 0;\n-var height = 30;\n-\n-function reorder_init() {\n-    lis = document.getElementsBySelector('ul#orderthese li');\n-    var input = document.getElementsBySelector('input[name=order_]')[0];\n-    setOrder(input.value.split(','));\n-    input.disabled = true;\n-    draw();\n-    // Now initialize the dragging behavior\n-    var limit = (lis.length - 1) * height;\n-    for (var i = 0; i < lis.length; i++) {\n-        var li = lis[i];\n-        var img = document.getElementById('handle'+li.id);\n-        li.style.zIndex = 1;\n-        Drag.init(img, li, left + 10, left + 10, top + 10, top + 10 + limit);\n-        li.onDragStart = startDrag;\n-        li.onDragEnd = endDrag;\n-        img.style.cursor = 'move';\n-    }\n-}\n-\n-function submitOrderForm() {\n-    var inputOrder = document.getElementsBySelector('input[name=order_]')[0];\n-    inputOrder.value = getOrder();\n-    inputOrder.disabled=false;\n-}\n-\n-function startDrag() {\n-    this.style.zIndex = '10';\n-    this.className = 'dragging';\n-}\n-\n-function endDrag(x, y) {\n-    this.style.zIndex = '1';\n-    this.className = '';\n-    // Work out how far along it has been dropped, using x co-ordinate\n-    var oldIndex = this.index;\n-    var newIndex = Math.round((y - 10 - top) / height);\n-    // 'Snap' to the correct position\n-    this.style.top = (10 + top + newIndex * height) + 'px';\n-    this.index = newIndex;\n-    moveItem(oldIndex, newIndex);\n-}\n-\n-function moveItem(oldIndex, newIndex) {\n-    // Swaps two items, adjusts the index and left co-ord for all others\n-    if (oldIndex == newIndex) {\n-        return; // Nothing to swap;\n-    }\n-    var direction, lo, hi;\n-    if (newIndex > oldIndex) {\n-        lo = oldIndex;\n-        hi = newIndex;\n-        direction = -1;\n-    } else {\n-        direction = 1;\n-        hi = oldIndex;\n-        lo = newIndex;\n-    }\n-    var lis2 = new Array(); // We will build the new order in this array\n-    for (var i = 0; i < lis.length; i++) {\n-        if (i < lo || i > hi) {\n-            // Position of items not between the indexes is unaffected\n-            lis2[i] = lis[i];\n-            continue;\n-        } else if (i == newIndex) {\n-            lis2[i] = lis[oldIndex];\n-            continue;\n-        } else {\n-            // Item is between the two indexes - move it along 1\n-            lis2[i] = lis[i - direction];\n-        }\n-    }\n-    // Re-index everything\n-    reIndex(lis2);\n-    lis = lis2;\n-    draw();\n-//    document.getElementById('hiddenOrder').value = getOrder();\n-    document.getElementsBySelector('input[name=order_]')[0].value = getOrder();\n-}\n-\n-function reIndex(lis) {\n-    for (var i = 0; i < lis.length; i++) {\n-        lis[i].index = i;\n-    }\n-}\n-\n-function draw() {\n-    for (var i = 0; i < lis.length; i++) {\n-        var li = lis[i];\n-        li.index = i;\n-        li.style.position = 'absolute';\n-        li.style.left = (10 + left) + 'px';\n-        li.style.top = (10 + top + (i * height)) + 'px';\n-    }\n-}\n-\n-function getOrder() {\n-    var order = new Array(lis.length);\n-    for (var i = 0; i < lis.length; i++) {\n-        order[i] = lis[i].id.substring(1, 100);\n-    }\n-    return order.join(',');\n-}\n-\n-function setOrder(id_list) {\n-    /* Set the current order to match the lsit of IDs */\n-    var temp_lis = new Array();\n-    for (var i = 0; i < id_list.length; i++) {\n-        var id = 'p' + id_list[i];\n-        temp_lis[temp_lis.length] = document.getElementById(id);\n-    }\n-    reIndex(temp_lis);\n-    lis = temp_lis;\n-    draw();\n-}\n-\n-function addEvent(elm, evType, fn, useCapture)\n-// addEvent and removeEvent\n-// cross-browser event handling for IE5+,  NS6 and Mozilla\n-// By Scott Andrew\n-{\n-  if (elm.addEventListener){\n-    elm.addEventListener(evType, fn, useCapture);\n-    return true;\n-  } else if (elm.attachEvent){\n-    var r = elm.attachEvent(\"on\"+evType, fn);\n-    return r;\n-  } else {\n-    elm['on'+evType] = fn;\n-  }\n-}"
        },
        {
            "sha": "15b57a1908013bf30c616f743d5632ade4c3959a",
            "filename": "django/contrib/admin/static/admin/js/getElementsBySelector.js",
            "status": "removed",
            "additions": 0,
            "deletions": 167,
            "changes": 167,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2FgetElementsBySelector.js",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2FgetElementsBySelector.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2FgetElementsBySelector.js?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,167 +0,0 @@\n-/* document.getElementsBySelector(selector)\n-   - returns an array of element objects from the current document\n-     matching the CSS selector. Selectors can contain element names, \n-     class names and ids and can be nested. For example:\n-     \n-       elements = document.getElementsBySelect('div#main p a.external')\n-     \n-     Will return an array of all 'a' elements with 'external' in their \n-     class attribute that are contained inside 'p' elements that are \n-     contained inside the 'div' element which has id=\"main\"\n-\n-   New in version 0.4: Support for CSS2 and CSS3 attribute selectors:\n-   See http://www.w3.org/TR/css3-selectors/#attribute-selectors\n-\n-   Version 0.4 - Simon Willison, March 25th 2003\n-   -- Works in Phoenix 0.5, Mozilla 1.3, Opera 7, Internet Explorer 6, Internet Explorer 5 on Windows\n-   -- Opera 7 fails \n-*/\n-\n-function getAllChildren(e) {\n-  // Returns all children of element. Workaround required for IE5/Windows. Ugh.\n-  return e.all ? e.all : e.getElementsByTagName('*');\n-}\n-\n-document.getElementsBySelector = function(selector) {\n-  // Attempt to fail gracefully in lesser browsers\n-  if (!document.getElementsByTagName) {\n-    return new Array();\n-  }\n-  // Split selector in to tokens\n-  var tokens = selector.split(' ');\n-  var currentContext = new Array(document);\n-  for (var i = 0; i < tokens.length; i++) {\n-    token = tokens[i].replace(/^\\s+/,'').replace(/\\s+$/,'');;\n-    if (token.indexOf('#') > -1) {\n-      // Token is an ID selector\n-      var bits = token.split('#');\n-      var tagName = bits[0];\n-      var id = bits[1];\n-      var element = document.getElementById(id);\n-      if (!element || (tagName && element.nodeName.toLowerCase() != tagName)) {\n-        // ID not found or tag with that ID not found, return false.\n-        return new Array();\n-      }\n-      // Set currentContext to contain just this element\n-      currentContext = new Array(element);\n-      continue; // Skip to next token\n-    }\n-    if (token.indexOf('.') > -1) {\n-      // Token contains a class selector\n-      var bits = token.split('.');\n-      var tagName = bits[0];\n-      var className = bits[1];\n-      if (!tagName) {\n-        tagName = '*';\n-      }\n-      // Get elements matching tag, filter them for class selector\n-      var found = new Array;\n-      var foundCount = 0;\n-      for (var h = 0; h < currentContext.length; h++) {\n-        var elements;\n-        if (tagName == '*') {\n-            elements = getAllChildren(currentContext[h]);\n-        } else {\n-            try {\n-                elements = currentContext[h].getElementsByTagName(tagName);\n-            }\n-            catch(e) {\n-                elements = [];\n-            }\n-        }\n-        for (var j = 0; j < elements.length; j++) {\n-          found[foundCount++] = elements[j];\n-        }\n-      }\n-      currentContext = new Array;\n-      var currentContextIndex = 0;\n-      for (var k = 0; k < found.length; k++) {\n-        if (found[k].className && found[k].className.match(new RegExp('\\\\b'+className+'\\\\b'))) {\n-          currentContext[currentContextIndex++] = found[k];\n-        }\n-      }\n-      continue; // Skip to next token\n-    }\n-    // Code to deal with attribute selectors\n-    if (token.match(/^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?\"?([^\\]\"]*)\"?\\]$/)) {\n-      var tagName = RegExp.$1;\n-      var attrName = RegExp.$2;\n-      var attrOperator = RegExp.$3;\n-      var attrValue = RegExp.$4;\n-      if (!tagName) {\n-        tagName = '*';\n-      }\n-      // Grab all of the tagName elements within current context\n-      var found = new Array;\n-      var foundCount = 0;\n-      for (var h = 0; h < currentContext.length; h++) {\n-        var elements;\n-        if (tagName == '*') {\n-            elements = getAllChildren(currentContext[h]);\n-        } else {\n-            elements = currentContext[h].getElementsByTagName(tagName);\n-        }\n-        for (var j = 0; j < elements.length; j++) {\n-          found[foundCount++] = elements[j];\n-        }\n-      }\n-      currentContext = new Array;\n-      var currentContextIndex = 0;\n-      var checkFunction; // This function will be used to filter the elements\n-      switch (attrOperator) {\n-        case '=': // Equality\n-          checkFunction = function(e) { return (e.getAttribute(attrName) == attrValue); };\n-          break;\n-        case '~': // Match one of space seperated words \n-          checkFunction = function(e) { return (e.getAttribute(attrName).match(new RegExp('\\\\b'+attrValue+'\\\\b'))); };\n-          break;\n-        case '|': // Match start with value followed by optional hyphen\n-          checkFunction = function(e) { return (e.getAttribute(attrName).match(new RegExp('^'+attrValue+'-?'))); };\n-          break;\n-        case '^': // Match starts with value\n-          checkFunction = function(e) { return (e.getAttribute(attrName).indexOf(attrValue) == 0); };\n-          break;\n-        case '$': // Match ends with value - fails with \"Warning\" in Opera 7\n-          checkFunction = function(e) { return (e.getAttribute(attrName).lastIndexOf(attrValue) == e.getAttribute(attrName).length - attrValue.length); };\n-          break;\n-        case '*': // Match ends with value\n-          checkFunction = function(e) { return (e.getAttribute(attrName).indexOf(attrValue) > -1); };\n-          break;\n-        default :\n-          // Just test for existence of attribute\n-          checkFunction = function(e) { return e.getAttribute(attrName); };\n-      }\n-      currentContext = new Array;\n-      var currentContextIndex = 0;\n-      for (var k = 0; k < found.length; k++) {\n-        if (checkFunction(found[k])) {\n-          currentContext[currentContextIndex++] = found[k];\n-        }\n-      }\n-      // alert('Attribute Selector: '+tagName+' '+attrName+' '+attrOperator+' '+attrValue);\n-      continue; // Skip to next token\n-    }\n-    // If we get here, token is JUST an element (not a class or ID selector)\n-    tagName = token;\n-    var found = new Array;\n-    var foundCount = 0;\n-    for (var h = 0; h < currentContext.length; h++) {\n-      var elements = currentContext[h].getElementsByTagName(tagName);\n-      for (var j = 0; j < elements.length; j++) {\n-        found[foundCount++] = elements[j];\n-      }\n-    }\n-    currentContext = found;\n-  }\n-  return currentContext;\n-}\n-\n-/* That revolting regular expression explained \n-/^(\\w+)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?\"?([^\\]\"]*)\"?\\]$/\n-  \\---/  \\---/\\-------------/    \\-------/\n-    |      |         |               |\n-    |      |         |           The value\n-    |      |    ~,|,^,$,* or =\n-    |   Attribute \n-   Tag\n-*/"
        },
        {
            "sha": "83a9c48ee10302e4c6a64bdd7b0503665944539a",
            "filename": "django/contrib/admin/templates/admin/auth/user/change_password.html",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,5 +1,5 @@\n {% extends \"admin/base_site.html\" %}\n-{% load i18n admin_static admin_modify %}\n+{% load i18n admin_static %}\n {% load admin_urls %}\n \n {% block extrahead %}{{ block.super }}\n@@ -13,7 +13,7 @@\n <a href=\"{% url 'admin:index' %}\">{% trans 'Home' %}</a>\n &rsaquo; <a href=\"{% url 'admin:app_list' app_label=opts.app_label %}\">{{ opts.app_label|capfirst|escape }}</a>\n &rsaquo; <a href=\"{% url opts|admin_urlname:'changelist' %}\">{{ opts.verbose_name_plural|capfirst }}</a>\n-&rsaquo; <a href=\"{% url opts|admin_urlname:'changelist' %}{{ original.pk }}\">{{ original|truncatewords:\"18\" }}</a>\n+&rsaquo; <a href=\"{% url opts|admin_urlname:'change' original.pk|admin_urlquote %}\">{{ original|truncatewords:\"18\" }}</a>\n &rsaquo; {% trans 'Change password' %}\n </div>\n {% endblock %}"
        },
        {
            "sha": "48846960b334acd4d3afdd9faf5c3e4a4b011668",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,7 +9,7 @@\n \n {% block extrastyle %}{{ block.super }}<link rel=\"stylesheet\" type=\"text/css\" href=\"{% static \"admin/css/forms.css\" %}\" />{% endblock %}\n \n-{% block coltype %}{% if ordered_objects %}colMS{% else %}colM{% endif %}{% endblock %}\n+{% block coltype %}colM{% endblock %}\n \n {% block bodyclass %}{{ opts.app_label }}-{{ opts.object_name.lower }} change-form{% endblock %}\n "
        },
        {
            "sha": "71a62ba71a6c909d9e410fd14e0719124911e25e",
            "filename": "django/contrib/admin/templates/admin/edit_inline/tabular.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -46,7 +46,7 @@ <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}</h2>\n             {% for field in line %}\n               <td{% if field.field.name %} class=\"field-{{ field.field.name }}\"{% endif %}>\n               {% if field.is_readonly %}\n-                  <p>{{ field.contents }}</p>\n+                  <p>{{ field.contents|linebreaksbr }}</p>\n               {% else %}\n                   {{ field.field.errors.as_ul }}\n                   {{ field.field }}"
        },
        {
            "sha": "09bc971d2f08c16809079e84c193881e34e4dec7",
            "filename": "django/contrib/admin/templates/admin/includes/fieldset.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fincludes%2Ffieldset.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fincludes%2Ffieldset.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fincludes%2Ffieldset.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,7 +14,7 @@\n                     {% else %}\n                         {{ field.label_tag }}\n                         {% if field.is_readonly %}\n-                            <p>{{ field.contents }}</p>\n+                            <p>{{ field.contents|linebreaksbr }}</p>\n                         {% else %}\n                             {{ field.field }}\n                         {% endif %}"
        },
        {
            "sha": "961e4823e014a2f4e6cc70947940b843617c1e97",
            "filename": "django/contrib/admin/templates/admin/index.html",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Findex.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Findex.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Findex.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,15 +14,15 @@\n \n {% if app_list %}\n     {% for app in app_list %}\n-        <div class=\"module\">\n+        <div class=\"app-{{ app.app_label }} module\">\n         <table>\n         <caption>\n             <a href=\"{{ app.app_url }}\" class=\"section\" title=\"{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}\">\n                 {% blocktrans with name=app.name %}{{ name }}{% endblocktrans %}\n             </a>\n         </caption>\n         {% for model in app.models %}\n-            <tr>\n+            <tr class=\"model-{{ model.object_name|lower }}\">\n             {% if model.admin_url %}\n                 <th scope=\"row\"><a href=\"{{ model.admin_url }}\">{{ model.name }}</a></th>\n             {% else %}"
        },
        {
            "sha": "38a97a1c6abb628533b24e6eeeefde22b2cc2315",
            "filename": "django/contrib/admin/templates/admin/submit_line.html",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,8 +1,8 @@\n {% load i18n admin_urls %}\n <div class=\"submit-row\">\n-{% if show_save %}<input type=\"submit\" value=\"{% trans 'Save' %}\" class=\"default\" name=\"_save\" {{ onclick_attrib }}/>{% endif %}\n+{% if show_save %}<input type=\"submit\" value=\"{% trans 'Save' %}\" class=\"default\" name=\"_save\" />{% endif %}\n {% if show_delete_link %}<p class=\"deletelink-box\"><a href=\"{% url opts|admin_urlname:'delete' original.pk|admin_urlquote %}\" class=\"deletelink\">{% trans \"Delete\" %}</a></p>{% endif %}\n-{% if show_save_as_new %}<input type=\"submit\" value=\"{% trans 'Save as new' %}\" name=\"_saveasnew\" {{ onclick_attrib }}/>{%endif%}\n-{% if show_save_and_add_another %}<input type=\"submit\" value=\"{% trans 'Save and add another' %}\" name=\"_addanother\" {{ onclick_attrib }}/>{% endif %}\n-{% if show_save_and_continue %}<input type=\"submit\" value=\"{% trans 'Save and continue editing' %}\" name=\"_continue\" {{ onclick_attrib }}/>{% endif %}\n+{% if show_save_as_new %}<input type=\"submit\" value=\"{% trans 'Save as new' %}\" name=\"_saveasnew\" />{%endif%}\n+{% if show_save_and_add_another %}<input type=\"submit\" value=\"{% trans 'Save and add another' %}\" name=\"_addanother\" />{% endif %}\n+{% if show_save_and_continue %}<input type=\"submit\" value=\"{% trans 'Save and continue editing' %}\" name=\"_continue\" />{% endif %}\n </div>"
        },
        {
            "sha": "cecc6ed6c4ebb299e0697ba46aa6fd64e346f6ba",
            "filename": "django/contrib/admin/templatetags/admin_modify.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -30,8 +30,6 @@ def submit_row(context):\n     save_as = context['save_as']\n     ctx = {\n         'opts': opts,\n-        'onclick_attrib': (opts.get_ordered_objects() and change\n-                            and 'onclick=\"submitOrderForm();\"' or ''),\n         'show_delete_link': (not is_popup and context['has_delete_permission']\n                               and change and context.get('show_delete', True)),\n         'show_save_as_new': not is_popup and change and save_as,"
        },
        {
            "sha": "b08d13c18fbd64a1e25eae7f7a1410c529f2012a",
            "filename": "django/contrib/admin/templatetags/adminmedia.py",
            "status": "removed",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadminmedia.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadminmedia.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadminmedia.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,15 +0,0 @@\n-import warnings\n-from django.template import Library\n-from django.templatetags.static import PrefixNode\n-\n-register = Library()\n-\n-@register.simple_tag\n-def admin_media_prefix():\n-    \"\"\"\n-    Returns the string contained in the setting ADMIN_MEDIA_PREFIX.\n-    \"\"\"\n-    warnings.warn(\n-        \"The admin_media_prefix template tag is deprecated. \"\n-        \"Use the static template tag instead.\", DeprecationWarning)\n-    return PrefixNode.handle_simple(\"ADMIN_MEDIA_PREFIX\")"
        },
        {
            "sha": "1e6277fb87f398e97d5300e51881572d6f751983",
            "filename": "django/contrib/admin/widgets.py",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fwidgets.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.urlresolvers import reverse\n from django.forms.widgets import RadioFieldRenderer\n from django.forms.util import flatatt\n-from django.utils.html import escape, format_html, format_html_join\n+from django.utils.html import escape, format_html, format_html_join, smart_urlquote\n from django.utils.text import Truncator\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n@@ -306,6 +306,19 @@ def __init__(self, attrs=None):\n             final_attrs.update(attrs)\n         super(AdminURLFieldWidget, self).__init__(attrs=final_attrs)\n \n+    def render(self, name, value, attrs=None):\n+        html = super(AdminURLFieldWidget, self).render(name, value, attrs)\n+        if value:\n+            value = force_text(self._format_value(value))\n+            final_attrs = {'href': mark_safe(smart_urlquote(value))}\n+            html = format_html(\n+                '<p class=\"url\">{0} <a {1}>{2}</a><br />{3} {4}</p>',\n+                _('Currently:'), flatatt(final_attrs), value,\n+                _('Change:'), html\n+            )\n+        return html\n+\n+\n class AdminIntegerFieldWidget(forms.TextInput):\n     class_name = 'vIntegerField'\n "
        },
        {
            "sha": "cb0c1164164fd69ae90087e909b994008578fd71",
            "filename": "django/contrib/admindocs/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Fviews.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,6 +14,7 @@\n from django.contrib.admindocs import utils\n from django.contrib.sites.models import Site\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n from django.utils import six\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n@@ -311,7 +312,7 @@ def load_all_installed_template_libraries():\n         try:\n             libraries = [\n                 os.path.splitext(p)[0]\n-                for p in os.listdir(os.path.dirname(mod.__file__))\n+                for p in os.listdir(os.path.dirname(upath(mod.__file__)))\n                 if p.endswith('.py') and p[0].isalpha()\n             ]\n         except OSError:"
        },
        {
            "sha": "99348d3ae525241dfd814ea7d1ecded5196f3569",
            "filename": "django/contrib/auth/__init__.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,6 +1,6 @@\n import re\n \n-from django.core.exceptions import ImproperlyConfigured\n+from django.core.exceptions import ImproperlyConfigured, PermissionDenied\n from django.utils.importlib import import_module\n from django.contrib.auth.signals import user_logged_in, user_logged_out, user_login_failed\n \n@@ -60,6 +60,9 @@ def authenticate(**credentials):\n         except TypeError:\n             # This backend doesn't accept these credentials as arguments. Try the next one.\n             continue\n+        except PermissionDenied:\n+            # This backend says to stop in our tracks - this user should not be allowed in at all.\n+            return None\n         if user is None:\n             continue\n         # Annotate the user object with the path of the backend.\n@@ -81,14 +84,14 @@ def login(request, user):\n         user = request.user\n     # TODO: It would be nice to support different login methods, like signed cookies.\n     if SESSION_KEY in request.session:\n-        if request.session[SESSION_KEY] != user.id:\n+        if request.session[SESSION_KEY] != user.pk:\n             # To avoid reusing another user's session, create a new, empty\n             # session if the existing session corresponds to a different\n             # authenticated user.\n             request.session.flush()\n     else:\n         request.session.cycle_key()\n-    request.session[SESSION_KEY] = user.id\n+    request.session[SESSION_KEY] = user.pk\n     request.session[BACKEND_SESSION_KEY] = user.backend\n     if hasattr(request, 'user'):\n         request.user = user"
        },
        {
            "sha": "d15a387a7eced275edab54c26dfa67d97b9c1a9a",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -133,7 +133,7 @@ def user_change_password(self, request, id, form_url=''):\n         adminForm = admin.helpers.AdminForm(form, fieldsets, {})\n \n         context = {\n-            'title': _('Change password: %s') % escape(user.username),\n+            'title': _('Change password: %s') % escape(user.get_username()),\n             'adminForm': adminForm,\n             'form_url': form_url,\n             'form': form,\n@@ -148,10 +148,10 @@ def user_change_password(self, request, id, form_url=''):\n             'save_as': False,\n             'show_save': True,\n         }\n-        return TemplateResponse(request, [\n+        return TemplateResponse(request,\n             self.change_user_password_template or\n-            'admin/auth/user/change_password.html'\n-        ], context, current_app=self.admin_site.name)\n+            'admin/auth/user/change_password.html',\n+            context, current_app=self.admin_site.name)\n \n     def response_add(self, request, obj, **kwargs):\n         \"\"\""
        },
        {
            "sha": "3d17fe275484e1b414cf9cdced1f8a8c22008092",
            "filename": "django/contrib/auth/context_processors.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fcontext_processors.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,7 +18,9 @@ def __iter__(self):\n \n     def __bool__(self):\n         return self.user.has_module_perms(self.module_name)\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n \n class PermWrapper(object):"
        },
        {
            "sha": "4e2f476cec8680feb400131ca4987e2d834b720f",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 18,
            "deletions": 9,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -27,7 +27,7 @@ def render(self, name, value, attrs):\n         encoded = value\n         final_attrs = self.build_attrs(attrs)\n \n-        if encoded == '' or encoded == UNUSABLE_PASSWORD:\n+        if not encoded or encoded == UNUSABLE_PASSWORD:\n             summary = mark_safe(\"<strong>%s</strong>\" % ugettext(\"No password set.\"))\n         else:\n             try:\n@@ -52,6 +52,11 @@ def __init__(self, *args, **kwargs):\n         kwargs.setdefault(\"required\", False)\n         super(ReadOnlyPasswordHashField, self).__init__(*args, **kwargs)\n \n+    def bound_data(self, data, initial):\n+        # Always return initial because the widget doesn't\n+        # render an input field.\n+        return initial\n+\n \n class UserCreationForm(forms.ModelForm):\n     \"\"\"\n@@ -143,8 +148,8 @@ class AuthenticationForm(forms.Form):\n     password = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n \n     error_messages = {\n-        'invalid_login': _(\"Please enter a correct username and password. \"\n-                           \"Note that both fields are case-sensitive.\"),\n+        'invalid_login': _(\"Please enter a correct %(username)s and password. \"\n+                           \"Note that both fields may be case-sensitive.\"),\n         'no_cookies': _(\"Your Web browser doesn't appear to have cookies \"\n                         \"enabled. Cookies are required for logging in.\"),\n         'inactive': _(\"This account is inactive.\"),\n@@ -163,8 +168,8 @@ def __init__(self, request=None, *args, **kwargs):\n \n         # Set the label for the \"username\" field.\n         UserModel = get_user_model()\n-        username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n-        self.fields['username'].label = capfirst(username_field.verbose_name)\n+        self.username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n+        self.fields['username'].label = capfirst(self.username_field.verbose_name)\n \n     def clean(self):\n         username = self.cleaned_data.get('username')\n@@ -175,7 +180,9 @@ def clean(self):\n                                            password=password)\n             if self.user_cache is None:\n                 raise forms.ValidationError(\n-                    self.error_messages['invalid_login'])\n+                    self.error_messages['invalid_login'] % {\n+                        'username': self.username_field.verbose_name\n+                    })\n             elif not self.user_cache.is_active:\n                 raise forms.ValidationError(self.error_messages['inactive'])\n         self.check_for_test_cookie()\n@@ -209,10 +216,12 @@ def clean_email(self):\n         \"\"\"\n         UserModel = get_user_model()\n         email = self.cleaned_data[\"email\"]\n-        self.users_cache = UserModel.objects.filter(email__iexact=email,\n-                                                    is_active=True)\n+        self.users_cache = UserModel.objects.filter(email__iexact=email)\n         if not len(self.users_cache):\n             raise forms.ValidationError(self.error_messages['unknown'])\n+        if not any(user.is_active for user in self.users_cache):\n+            # none of the filtered users are active\n+            raise forms.ValidationError(self.error_messages['unknown'])\n         if any((user.password == UNUSABLE_PASSWORD)\n                for user in self.users_cache):\n             raise forms.ValidationError(self.error_messages['unusable'])\n@@ -239,7 +248,7 @@ def save(self, domain_override=None,\n                 'email': user.email,\n                 'domain': domain,\n                 'site_name': site_name,\n-                'uid': int_to_base36(user.id),\n+                'uid': int_to_base36(user.pk),\n                 'user': user,\n                 'token': token_generator.make_token(user),\n                 'protocol': use_https and 'https' or 'http',"
        },
        {
            "sha": "5ee4d609f7bf7d7deb5f06e058e1bdcfa80dfe4e",
            "filename": "django/contrib/auth/handlers/modwsgi.py",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -21,17 +21,12 @@ def check_password(environ, username, password):\n             user = UserModel.objects.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n             return None\n-        try:\n-            if not user.is_active:\n-                return None\n-        except AttributeError as e:\n-            # a custom user may not support is_active\n+        if not user.is_active:\n             return None\n         return user.check_password(password)\n     finally:\n         db.close_connection()\n \n-\n def groups_for_user(environ, username):\n     \"\"\"\n     Authorizes a user based on groups"
        },
        {
            "sha": "ce5d57fa7903d5f2446818435c34e421d005aab1",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,6 +10,7 @@\n from django.contrib.auth import models as auth_app, get_user_model\n from django.core import exceptions\n from django.core.management.base import CommandError\n+from django.db import DEFAULT_DB_ALIAS, router\n from django.db.models import get_models, signals\n from django.utils import six\n from django.utils.six.moves import input\n@@ -57,7 +58,10 @@ def _check_permission_clashing(custom, builtin, ctype):\n                 (codename, ctype.app_label, ctype.model_class().__name__))\n         pool.add(codename)\n \n-def create_permissions(app, created_models, verbosity, **kwargs):\n+def create_permissions(app, created_models, verbosity, db=DEFAULT_DB_ALIAS, **kwargs):\n+    if not router.allow_syncdb(db, auth_app.Permission):\n+        return\n+\n     from django.contrib.contenttypes.models import ContentType\n \n     app_models = get_models(app)\n@@ -68,29 +72,31 @@ def create_permissions(app, created_models, verbosity, **kwargs):\n     # The codenames and ctypes that should exist.\n     ctypes = set()\n     for klass in app_models:\n-        ctype = ContentType.objects.get_for_model(klass)\n+        # Force looking up the content types in the current database\n+        # before creating foreign keys to them.\n+        ctype = ContentType.objects.db_manager(db).get_for_model(klass)\n         ctypes.add(ctype)\n         for perm in _get_all_permissions(klass._meta, ctype):\n             searched_perms.append((ctype, perm))\n \n     # Find all the Permissions that have a context_type for a model we're\n     # looking for.  We don't need to check for codenames since we already have\n     # a list of the ones we're going to create.\n-    all_perms = set(auth_app.Permission.objects.filter(\n+    all_perms = set(auth_app.Permission.objects.using(db).filter(\n         content_type__in=ctypes,\n     ).values_list(\n         \"content_type\", \"codename\"\n     ))\n \n-    objs = [\n+    perms = [\n         auth_app.Permission(codename=codename, name=name, content_type=ctype)\n         for ctype, (codename, name) in searched_perms\n         if (ctype.pk, codename) not in all_perms\n     ]\n-    auth_app.Permission.objects.bulk_create(objs)\n+    auth_app.Permission.objects.using(db).bulk_create(perms)\n     if verbosity >= 2:\n-        for obj in objs:\n-            print(\"Adding permission '%s'\" % obj)\n+        for perm in perms:\n+            print(\"Adding permission '%s'\" % perm)\n \n \n def create_superuser(app, created_models, verbosity, db, **kwargs):"
        },
        {
            "sha": "f38efdd1d2117433f87de9ae83861a4220e1faa9",
            "filename": "django/contrib/auth/middleware.py",
            "status": "modified",
            "additions": 14,
            "deletions": 3,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fmiddleware.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fmiddleware.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmiddleware.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,4 +1,6 @@\n from django.contrib import auth\n+from django.contrib.auth import load_backend\n+from django.contrib.auth.backends import RemoteUserBackend\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.functional import SimpleLazyObject\n \n@@ -47,9 +49,18 @@ def process_request(self, request):\n         try:\n             username = request.META[self.header]\n         except KeyError:\n-            # If specified header doesn't exist then return (leaving\n-            # request.user set to AnonymousUser by the\n-            # AuthenticationMiddleware).\n+            # If specified header doesn't exist then remove any existing\n+            # authenticated remote-user, or return (leaving request.user set to\n+            # AnonymousUser by the AuthenticationMiddleware).\n+            if request.user.is_authenticated():\n+                try:\n+                    stored_backend = load_backend(request.session.get(\n+                        auth.BACKEND_SESSION_KEY, ''))\n+                    if isinstance(stored_backend, RemoteUserBackend):\n+                        auth.logout(request)\n+                except ImproperlyConfigured as e:\n+                    # backend failed to load\n+                    auth.logout(request)\n             return\n         # If the user is already authenticated and that user is the user we are\n         # getting passed in the headers, then the correct user is already"
        },
        {
            "sha": "7d62810923eb3b92c3b47a84c77392949cd195f9",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 86,
            "deletions": 74,
            "changes": 160,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -195,43 +195,13 @@ def create_superuser(self, username, email, password, **extra_fields):\n         return u\n \n \n-# A few helper functions for common logic between User and AnonymousUser.\n-def _user_get_all_permissions(user, obj):\n-    permissions = set()\n-    for backend in auth.get_backends():\n-        if hasattr(backend, \"get_all_permissions\"):\n-            if obj is not None:\n-                permissions.update(backend.get_all_permissions(user, obj))\n-            else:\n-                permissions.update(backend.get_all_permissions(user))\n-    return permissions\n-\n-\n-def _user_has_perm(user, perm, obj):\n-    for backend in auth.get_backends():\n-        if hasattr(backend, \"has_perm\"):\n-            if obj is not None:\n-                if backend.has_perm(user, perm, obj):\n-                    return True\n-            else:\n-                if backend.has_perm(user, perm):\n-                    return True\n-    return False\n-\n-\n-def _user_has_module_perms(user, app_label):\n-    for backend in auth.get_backends():\n-        if hasattr(backend, \"has_module_perms\"):\n-            if backend.has_module_perms(user, app_label):\n-                return True\n-    return False\n-\n-\n @python_2_unicode_compatible\n class AbstractBaseUser(models.Model):\n     password = models.CharField(_('password'), max_length=128)\n     last_login = models.DateTimeField(_('last login'), default=timezone.now)\n \n+    is_active = True\n+\n     REQUIRED_FIELDS = []\n \n     class Meta:\n@@ -288,32 +258,46 @@ def get_short_name(self):\n         raise NotImplementedError()\n \n \n-class AbstractUser(AbstractBaseUser):\n-    \"\"\"\n-    An abstract base class implementing a fully featured User model with\n-    admin-compliant permissions.\n+# A few helper functions for common logic between User and AnonymousUser.\n+def _user_get_all_permissions(user, obj):\n+    permissions = set()\n+    for backend in auth.get_backends():\n+        if hasattr(backend, \"get_all_permissions\"):\n+            if obj is not None:\n+                permissions.update(backend.get_all_permissions(user, obj))\n+            else:\n+                permissions.update(backend.get_all_permissions(user))\n+    return permissions\n \n-    Username, password and email are required. Other fields are optional.\n+\n+def _user_has_perm(user, perm, obj):\n+    for backend in auth.get_backends():\n+        if hasattr(backend, \"has_perm\"):\n+            if obj is not None:\n+                if backend.has_perm(user, perm, obj):\n+                    return True\n+            else:\n+                if backend.has_perm(user, perm):\n+                    return True\n+    return False\n+\n+\n+def _user_has_module_perms(user, app_label):\n+    for backend in auth.get_backends():\n+        if hasattr(backend, \"has_module_perms\"):\n+            if backend.has_module_perms(user, app_label):\n+                return True\n+    return False\n+\n+\n+class PermissionsMixin(models.Model):\n+    \"\"\"\n+    A mixin class that adds the fields and methods necessary to support\n+    Django's Group and Permission model using the ModelBackend.\n     \"\"\"\n-    username = models.CharField(_('username'), max_length=30, unique=True,\n-        help_text=_('Required. 30 characters or fewer. Letters, numbers and '\n-                    '@/./+/-/_ characters'),\n-        validators=[\n-            validators.RegexValidator(re.compile('^[\\w.@+-]+$'), _('Enter a valid username.'), 'invalid')\n-        ])\n-    first_name = models.CharField(_('first name'), max_length=30, blank=True)\n-    last_name = models.CharField(_('last name'), max_length=30, blank=True)\n-    email = models.EmailField(_('email address'), blank=True)\n-    is_staff = models.BooleanField(_('staff status'), default=False,\n-        help_text=_('Designates whether the user can log into this admin '\n-                    'site.'))\n-    is_active = models.BooleanField(_('active'), default=True,\n-        help_text=_('Designates whether this user should be treated as '\n-                    'active. Unselect this instead of deleting accounts.'))\n     is_superuser = models.BooleanField(_('superuser status'), default=False,\n         help_text=_('Designates that this user has all permissions without '\n                     'explicitly assigning them.'))\n-    date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n     groups = models.ManyToManyField(Group, verbose_name=_('groups'),\n         blank=True, help_text=_('The groups this user belongs to. A user will '\n                                 'get all permissions granted to each of '\n@@ -322,30 +306,9 @@ class AbstractUser(AbstractBaseUser):\n         verbose_name=_('user permissions'), blank=True,\n         help_text='Specific permissions for this user.')\n \n-    objects = UserManager()\n-\n-    USERNAME_FIELD = 'username'\n-    REQUIRED_FIELDS = ['email']\n-\n     class Meta:\n-        verbose_name = _('user')\n-        verbose_name_plural = _('users')\n         abstract = True\n \n-    def get_absolute_url(self):\n-        return \"/users/%s/\" % urlquote(self.username)\n-\n-    def get_full_name(self):\n-        \"\"\"\n-        Returns the first_name plus the last_name, with a space in between.\n-        \"\"\"\n-        full_name = '%s %s' % (self.first_name, self.last_name)\n-        return full_name.strip()\n-\n-    def get_short_name(self):\n-        \"Returns the short name for the user.\"\n-        return self.first_name\n-\n     def get_group_permissions(self, obj=None):\n         \"\"\"\n         Returns a list of permission strings that this user has through his/her\n@@ -403,6 +366,55 @@ def has_module_perms(self, app_label):\n \n         return _user_has_module_perms(self, app_label)\n \n+\n+class AbstractUser(AbstractBaseUser, PermissionsMixin):\n+    \"\"\"\n+    An abstract base class implementing a fully featured User model with\n+    admin-compliant permissions.\n+\n+    Username, password and email are required. Other fields are optional.\n+    \"\"\"\n+    username = models.CharField(_('username'), max_length=30, unique=True,\n+        help_text=_('Required. 30 characters or fewer. Letters, numbers and '\n+                    '@/./+/-/_ characters'),\n+        validators=[\n+            validators.RegexValidator(re.compile('^[\\w.@+-]+$'), _('Enter a valid username.'), 'invalid')\n+        ])\n+    first_name = models.CharField(_('first name'), max_length=30, blank=True)\n+    last_name = models.CharField(_('last name'), max_length=30, blank=True)\n+    email = models.EmailField(_('email address'), blank=True)\n+    is_staff = models.BooleanField(_('staff status'), default=False,\n+        help_text=_('Designates whether the user can log into this admin '\n+                    'site.'))\n+    is_active = models.BooleanField(_('active'), default=True,\n+        help_text=_('Designates whether this user should be treated as '\n+                    'active. Unselect this instead of deleting accounts.'))\n+    date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n+\n+    objects = UserManager()\n+\n+    USERNAME_FIELD = 'username'\n+    REQUIRED_FIELDS = ['email']\n+\n+    class Meta:\n+        verbose_name = _('user')\n+        verbose_name_plural = _('users')\n+        abstract = True\n+\n+    def get_absolute_url(self):\n+        return \"/users/%s/\" % urlquote(self.username)\n+\n+    def get_full_name(self):\n+        \"\"\"\n+        Returns the first_name plus the last_name, with a space in between.\n+        \"\"\"\n+        full_name = '%s %s' % (self.first_name, self.last_name)\n+        return full_name.strip()\n+\n+    def get_short_name(self):\n+        \"Returns the short name for the user.\"\n+        return self.first_name\n+\n     def email_user(self, subject, message, from_email=None):\n         \"\"\"\n         Sends an email to this User."
        },
        {
            "sha": "038c8980d9d9b063e6c871e1e3df374dab5b3509",
            "filename": "django/contrib/auth/tests/__init__.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,3 +14,16 @@\n from django.contrib.auth.tests.views import *\n \n # The password for the fixture data users is 'password'\n+\n+from django.dispatch import receiver\n+from django.test.signals import setting_changed\n+\n+\n+@receiver(setting_changed)\n+def user_model_swapped(**kwargs):\n+    if kwargs['setting'] == 'AUTH_USER_MODEL':\n+        from django.db.models.manager import ensure_default_manager\n+        from django.contrib.auth.models import User\n+        # Reset User manager\n+        setattr(User, 'objects', User._default_manager)\n+        ensure_default_manager(User)"
        },
        {
            "sha": "71f18d32cfffb1fca7fe032250881e1bcc68e30e",
            "filename": "django/contrib/auth/tests/auth_backends.py",
            "status": "modified",
            "additions": 74,
            "deletions": 13,
            "changes": 87,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -4,9 +4,10 @@\n from django.conf import settings\n from django.contrib.auth.models import User, Group, Permission, AnonymousUser\n from django.contrib.auth.tests.utils import skipIfCustomUser\n-from django.contrib.auth.tests.custom_user import ExtensionUser\n+from django.contrib.auth.tests.custom_user import ExtensionUser, CustomPermissionsUser\n from django.contrib.contenttypes.models import ContentType\n-from django.core.exceptions import ImproperlyConfigured\n+from django.core.exceptions import ImproperlyConfigured, PermissionDenied\n+from django.contrib.auth import authenticate\n from django.test import TestCase\n from django.test.utils import override_settings\n \n@@ -33,7 +34,7 @@ def tearDown(self):\n         ContentType.objects.clear_cache()\n \n     def test_has_perm(self):\n-        user = self.UserModel.objects.get(username='test')\n+        user = self.UserModel.objects.get(pk=self.user.pk)\n         self.assertEqual(user.has_perm('auth.test'), False)\n         user.is_staff = True\n         user.save()\n@@ -52,14 +53,14 @@ def test_has_perm(self):\n         self.assertEqual(user.has_perm('auth.test'), False)\n \n     def test_custom_perms(self):\n-        user = self.UserModel.objects.get(username='test')\n+        user = self.UserModel.objects.get(pk=self.user.pk)\n         content_type = ContentType.objects.get_for_model(Group)\n         perm = Permission.objects.create(name='test', content_type=content_type, codename='test')\n         user.user_permissions.add(perm)\n         user.save()\n \n         # reloading user to purge the _perm_cache\n-        user = self.UserModel.objects.get(username='test')\n+        user = self.UserModel.objects.get(pk=self.user.pk)\n         self.assertEqual(user.get_all_permissions() == set(['auth.test']), True)\n         self.assertEqual(user.get_group_permissions(), set([]))\n         self.assertEqual(user.has_module_perms('Group'), False)\n@@ -70,7 +71,7 @@ def test_custom_perms(self):\n         perm = Permission.objects.create(name='test3', content_type=content_type, codename='test3')\n         user.user_permissions.add(perm)\n         user.save()\n-        user = self.UserModel.objects.get(username='test')\n+        user = self.UserModel.objects.get(pk=self.user.pk)\n         self.assertEqual(user.get_all_permissions(), set(['auth.test2', 'auth.test', 'auth.test3']))\n         self.assertEqual(user.has_perm('test'), False)\n         self.assertEqual(user.has_perm('auth.test'), True)\n@@ -80,7 +81,7 @@ def test_custom_perms(self):\n         group.permissions.add(perm)\n         group.save()\n         user.groups.add(group)\n-        user = self.UserModel.objects.get(username='test')\n+        user = self.UserModel.objects.get(pk=self.user.pk)\n         exp = set(['auth.test2', 'auth.test', 'auth.test3', 'auth.test_group'])\n         self.assertEqual(user.get_all_permissions(), exp)\n         self.assertEqual(user.get_group_permissions(), set(['auth.test_group']))\n@@ -92,7 +93,7 @@ def test_custom_perms(self):\n \n     def test_has_no_object_perm(self):\n         \"\"\"Regressiontest for #12462\"\"\"\n-        user = self.UserModel.objects.get(username='test')\n+        user = self.UserModel.objects.get(pk=self.user.pk)\n         content_type = ContentType.objects.get_for_model(Group)\n         perm = Permission.objects.create(name='test', content_type=content_type, codename='test')\n         user.user_permissions.add(perm)\n@@ -105,7 +106,7 @@ def test_has_no_object_perm(self):\n \n     def test_get_all_superuser_permissions(self):\n         \"A superuser has all permissions. Refs #14795\"\n-        user = self.UserModel.objects.get(username='test2')\n+        user = self.UserModel.objects.get(pk=self.superuser.pk)\n         self.assertEqual(len(user.get_all_permissions()), len(Permission.objects.all()))\n \n \n@@ -117,12 +118,12 @@ class ModelBackendTest(BaseModelBackendTest, TestCase):\n     UserModel = User\n \n     def create_users(self):\n-        User.objects.create_user(\n+        self.user = User.objects.create_user(\n             username='test',\n             email='test@example.com',\n             password='test',\n         )\n-        User.objects.create_superuser(\n+        self.superuser = User.objects.create_superuser(\n             username='test2',\n             email='test2@example.com',\n             password='test',\n@@ -150,20 +151,45 @@ class ExtensionUserModelBackendTest(BaseModelBackendTest, TestCase):\n     UserModel = ExtensionUser\n \n     def create_users(self):\n-        ExtensionUser.objects.create_user(\n+        self.user = ExtensionUser.objects.create_user(\n             username='test',\n             email='test@example.com',\n             password='test',\n             date_of_birth=date(2006, 4, 25)\n         )\n-        ExtensionUser.objects.create_superuser(\n+        self.superuser = ExtensionUser.objects.create_superuser(\n             username='test2',\n             email='test2@example.com',\n             password='test',\n             date_of_birth=date(1976, 11, 8)\n         )\n \n \n+@override_settings(AUTH_USER_MODEL='auth.CustomPermissionsUser')\n+class CustomPermissionsUserModelBackendTest(BaseModelBackendTest, TestCase):\n+    \"\"\"\n+    Tests for the ModelBackend using the CustomPermissionsUser model.\n+\n+    As with the ExtensionUser test, this isn't a perfect test, because both\n+    the User and CustomPermissionsUser are synchronized to the database,\n+    which wouldn't ordinary happen in production.\n+    \"\"\"\n+\n+    UserModel = CustomPermissionsUser\n+\n+    def create_users(self):\n+        self.user = CustomPermissionsUser.objects.create_user(\n+            email='test@example.com',\n+            password='test',\n+            date_of_birth=date(2006, 4, 25)\n+        )\n+        self.superuser = CustomPermissionsUser.objects.create_superuser(\n+            email='test2@example.com',\n+            password='test',\n+            date_of_birth=date(1976, 11, 8)\n+        )\n+\n+\n class TestObj(object):\n     pass\n \n@@ -323,3 +349,38 @@ def test_has_perm(self):\n     def test_has_module_perms(self):\n         self.assertEqual(self.user1.has_module_perms(\"app1\"), False)\n         self.assertEqual(self.user1.has_module_perms(\"app2\"), False)\n+\n+\n+class PermissionDeniedBackend(object):\n+    \"\"\"\n+    Always raises PermissionDenied.\n+    \"\"\"\n+    supports_object_permissions = True\n+    supports_anonymous_user = True\n+    supports_inactive_user = True\n+\n+    def authenticate(self, username=None, password=None):\n+        raise PermissionDenied\n+\n+\n+@skipIfCustomUser\n+class PermissionDeniedBackendTest(TestCase):\n+    \"\"\"\n+    Tests that other backends are not checked once a backend raises PermissionDenied\n+    \"\"\"\n+    backend = 'django.contrib.auth.tests.auth_backends.PermissionDeniedBackend'\n+\n+    def setUp(self):\n+        self.user1 = User.objects.create_user('test', 'test@example.com', 'test')\n+        self.user1.save()\n+\n+    @override_settings(AUTHENTICATION_BACKENDS=(backend, ) +\n+            tuple(settings.AUTHENTICATION_BACKENDS))\n+    def test_permission_denied(self):\n+        \"user is not authenticated after a backend raises permission denied #2550\"\n+        self.assertEqual(authenticate(username='test', password='test'), None)\n+\n+    @override_settings(AUTHENTICATION_BACKENDS=tuple(\n+            settings.AUTHENTICATION_BACKENDS) + (backend, ))\n+    def test_authenticates(self):\n+        self.assertEqual(authenticate(username='test', password='test'), self.user1)"
        },
        {
            "sha": "2c807cca517e2d5be3df2db7f4dedbf57cf3e78d",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -162,6 +162,8 @@ def test_get_user_model(self):\n     def test_swappable_user(self):\n         \"The current user model can be swapped out for another\"\n         self.assertEqual(get_user_model(), CustomUser)\n+        with self.assertRaises(AttributeError):\n+            User.objects.all()\n \n     @override_settings(AUTH_USER_MODEL='badsetting')\n     def test_swappable_user_bad_setting(self):"
        },
        {
            "sha": "f846a828ddff7b73f470401667d70600a7583efe",
            "filename": "django/contrib/auth/tests/context_processors.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,6 +9,7 @@\n from django.db.models import Q\n from django.test import TestCase\n from django.test.utils import override_settings\n+from django.utils._os import upath\n \n \n class MockUser(object):\n@@ -63,7 +64,7 @@ def test_permlookupdict_in(self):\n @skipIfCustomUser\n @override_settings(\n     TEMPLATE_DIRS=(\n-            os.path.join(os.path.dirname(__file__), 'templates'),\n+            os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n         ),\n     USE_TZ=False,                           # required for loading the fixture\n     PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',),"
        },
        {
            "sha": "7e042e4895c0ee1d568bd5dcbf06382f84bc9ed1",
            "filename": "django/contrib/auth/tests/custom_user.py",
            "status": "modified",
            "additions": 57,
            "deletions": 1,
            "changes": 58,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,5 +1,11 @@\n from django.db import models\n-from django.contrib.auth.models import BaseUserManager, AbstractBaseUser, AbstractUser, UserManager\n+from django.contrib.auth.models import (\n+    BaseUserManager,\n+    AbstractBaseUser,\n+    AbstractUser,\n+    UserManager,\n+    PermissionsMixin\n+)\n \n \n # The custom User uses email as the unique identifier, and requires\n@@ -88,3 +94,53 @@ class ExtensionUser(AbstractUser):\n \n     class Meta:\n         app_label = 'auth'\n+\n+\n+# The CustomPermissionsUser users email as the identifier, but uses the normal\n+# Django permissions model. This allows us to check that the PermissionsMixin\n+# includes everything that is needed to interact with the ModelBackend.\n+\n+class CustomPermissionsUserManager(CustomUserManager):\n+    def create_superuser(self, email, password, date_of_birth):\n+        u = self.create_user(email, password=password, date_of_birth=date_of_birth)\n+        u.is_superuser = True\n+        u.save(using=self._db)\n+        return u\n+\n+\n+class CustomPermissionsUser(AbstractBaseUser, PermissionsMixin):\n+    email = models.EmailField(verbose_name='email address', max_length=255, unique=True)\n+    date_of_birth = models.DateField()\n+\n+    objects = CustomPermissionsUserManager()\n+\n+    USERNAME_FIELD = 'email'\n+    REQUIRED_FIELDS = ['date_of_birth']\n+\n+    class Meta:\n+        app_label = 'auth'\n+\n+    def get_full_name(self):\n+        return self.email\n+\n+    def get_short_name(self):\n+        return self.email\n+\n+    def __unicode__(self):\n+        return self.email\n+\n+\n+class IsActiveTestUser1(AbstractBaseUser):\n+    \"\"\"\n+    This test user class and derivatives test the default is_active behavior\n+    \"\"\"\n+    username = models.CharField(max_length=30, unique=True)\n+\n+    objects = BaseUserManager()\n+\n+    USERNAME_FIELD = 'username'\n+\n+    class Meta:\n+        app_label = 'auth'\n+\n+    # the is_active attr is provided by AbstractBaseUser"
        },
        {
            "sha": "a9f894905aafcdd95a073db32ded77894d50d4bd",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 25,
            "deletions": 3,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -3,13 +3,15 @@\n import os\n from django.contrib.auth.models import User\n from django.contrib.auth.forms import (UserCreationForm, AuthenticationForm,\n-    PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm)\n+    PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm,\n+    ReadOnlyPasswordHashWidget)\n from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.core import mail\n from django.forms.fields import Field, EmailField\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils.encoding import force_text\n+from django.utils._os import upath\n from django.utils import translation\n from django.utils.translation import ugettext as _\n \n@@ -98,7 +100,9 @@ def test_invalid_username(self):\n         form = AuthenticationForm(None, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.non_field_errors(),\n-                         [force_text(form.error_messages['invalid_login'])])\n+                [force_text(form.error_messages['invalid_login'] % {\n+                   'username': User._meta.get_field('username').verbose_name\n+                })])\n \n     def test_inactive_user(self):\n         # The user is inactive.\n@@ -282,6 +286,14 @@ def test_bug_19133(self):\n         self.assertTrue(form.is_valid())\n         self.assertEqual(form.cleaned_data['password'], 'sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161')\n \n+    def test_bug_19349_bound_password_field(self):\n+        user = User.objects.get(username='testclient')\n+        form = UserChangeForm(data={}, instance=user)\n+        # When rendering the bound password field,\n+        # ReadOnlyPasswordHashWidget needs the initial\n+        # value to render correctly\n+        self.assertEqual(form.initial['password'], form['password'].value())\n+\n \n @skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n@@ -322,7 +334,7 @@ def test_cleaned_data(self):\n         self.assertEqual(form.cleaned_data['email'], email)\n \n     def test_custom_email_subject(self):\n-        template_path = os.path.join(os.path.dirname(__file__), 'templates')\n+        template_path = os.path.join(os.path.dirname(upath(__file__)), 'templates')\n         with self.settings(TEMPLATE_DIRS=(template_path,)):\n             data = {'email': 'testclient@example.com'}\n             form = PasswordResetForm(data)\n@@ -362,3 +374,13 @@ def test_unusable_password(self):\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"email\"].errors,\n                          [_(\"The user account associated with this email address cannot reset the password.\")])\n+\n+\n+class ReadOnlyPasswordHashWidgetTest(TestCase):\n+\n+    def test_bug_19349_render_with_none_value(self):\n+        # Rendering the widget with value set to None\n+        # mustn't raise an exception.\n+        widget = ReadOnlyPasswordHashWidget()\n+        html = widget.render(name='password', value=None, attrs={})\n+        self.assertIn(_(\"No password set.\"), html)"
        },
        {
            "sha": "04ab46f75b5f0a4889216c7aedb4ad89c74cf637",
            "filename": "django/contrib/auth/tests/handlers.py",
            "status": "modified",
            "additions": 32,
            "deletions": 11,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -2,46 +2,67 @@\n \n from django.contrib.auth.handlers.modwsgi import check_password, groups_for_user\n from django.contrib.auth.models import User, Group\n+from django.contrib.auth.tests import CustomUser\n from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TransactionTestCase\n+from django.test.utils import override_settings\n \n \n class ModWsgiHandlerTestCase(TransactionTestCase):\n     \"\"\"\n     Tests for the mod_wsgi authentication handler\n     \"\"\"\n-\n-    def setUp(self):\n-        user1 = User.objects.create_user('test', 'test@example.com', 'test')\n-        User.objects.create_user('test1', 'test1@example.com', 'test1')\n-        group = Group.objects.create(name='test_group')\n-        user1.groups.add(group)\n-\n+    @skipIfCustomUser\n     def test_check_password(self):\n         \"\"\"\n         Verify that check_password returns the correct values as per\n         http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Authentication_Provider\n-\n-        because the custom user available in the test framework does not\n-        support the is_active attribute, we can't test this with a custom\n-        user.\n         \"\"\"\n+        User.objects.create_user('test', 'test@example.com', 'test')\n \n         # User not in database\n         self.assertTrue(check_password({}, 'unknown', '') is None)\n \n         # Valid user with correct password\n         self.assertTrue(check_password({}, 'test', 'test'))\n \n+        # correct password, but user is inactive\n+        User.objects.filter(username='test').update(is_active=False)\n+        self.assertFalse(check_password({}, 'test', 'test'))\n+\n         # Valid user with incorrect password\n         self.assertFalse(check_password({}, 'test', 'incorrect'))\n \n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_check_password_custom_user(self):\n+        \"\"\"\n+        Verify that check_password returns the correct values as per\n+        http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Authentication_Provider\n+\n+        with custom user installed\n+        \"\"\"\n+\n+        CustomUser.objects.create_user('test@example.com', '1990-01-01', 'test')\n+\n+        # User not in database\n+        self.assertTrue(check_password({}, 'unknown', '') is None)\n+\n+        # Valid user with correct password'\n+        self.assertTrue(check_password({}, 'test@example.com', 'test'))\n+\n+        # Valid user with incorrect password\n+        self.assertFalse(check_password({}, 'test@example.com', 'incorrect'))\n+\n     @skipIfCustomUser\n     def test_groups_for_user(self):\n         \"\"\"\n         Check that groups_for_user returns correct values as per\n         http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Group_Authorisation\n         \"\"\"\n+        user1 = User.objects.create_user('test', 'test@example.com', 'test')\n+        User.objects.create_user('test1', 'test1@example.com', 'test1')\n+        group = Group.objects.create(name='test_group')\n+        user1.groups.add(group)\n \n         # User not in database\n         self.assertEqual(groups_for_user({}, 'unknown'), [])"
        },
        {
            "sha": "ca65dee71b660a6c83516663e220717641bafbb2",
            "filename": "django/contrib/auth/tests/models.py",
            "status": "modified",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,4 +1,5 @@\n from django.conf import settings\n+from django.contrib.auth import get_user_model\n from django.contrib.auth.models import (Group, User, SiteProfileNotAvailable,\n     UserManager)\n from django.contrib.auth.tests.utils import skipIfCustomUser\n@@ -98,3 +99,36 @@ def test_empty_username(self):\n         self.assertRaisesMessage(ValueError,\n                                  'The given username must be set',\n                                   User.objects.create_user, username='')\n+\n+\n+class IsActiveTestCase(TestCase):\n+    \"\"\"\n+    Tests the behavior of the guaranteed is_active attribute\n+    \"\"\"\n+\n+    @skipIfCustomUser\n+    def test_builtin_user_isactive(self):\n+        user = User.objects.create(username='foo', email='foo@bar.com')\n+        # is_active is true by default\n+        self.assertEqual(user.is_active, True)\n+        user.is_active = False\n+        user.save()\n+        user_fetched = User.objects.get(pk=user.pk)\n+        # the is_active flag is saved\n+        self.assertFalse(user_fetched.is_active)\n+\n+    @override_settings(AUTH_USER_MODEL='auth.IsActiveTestUser1')\n+    def test_is_active_field_default(self):\n+        \"\"\"\n+        tests that the default value for is_active is provided\n+        \"\"\"\n+        UserModel = get_user_model()\n+        user = UserModel(username='foo')\n+        self.assertEqual(user.is_active, True)\n+        # you can set the attribute - but it will not save\n+        user.is_active = False\n+        # there should be no problem saving - but the attribute is not saved\n+        user.save()\n+        user_fetched = UserModel.objects.get(pk=user.pk)\n+        # the attribute is always true for newly retrieved instance\n+        self.assertEqual(user_fetched.is_active, True)"
        },
        {
            "sha": "0e59b291a8b17a1f07bbef14ef1c5929f303716a",
            "filename": "django/contrib/auth/tests/remote_user.py",
            "status": "modified",
            "additions": 23,
            "deletions": 2,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,8 +1,9 @@\n from datetime import datetime\n \n from django.conf import settings\n+from django.contrib.auth import authenticate\n from django.contrib.auth.backends import RemoteUserBackend\n-from django.contrib.auth.models import User\n+from django.contrib.auth.models import User, AnonymousUser\n from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.utils import timezone\n@@ -23,7 +24,7 @@ def setUp(self):\n         self.curr_middleware = settings.MIDDLEWARE_CLASSES\n         self.curr_auth = settings.AUTHENTICATION_BACKENDS\n         settings.MIDDLEWARE_CLASSES += (self.middleware,)\n-        settings.AUTHENTICATION_BACKENDS = (self.backend,)\n+        settings.AUTHENTICATION_BACKENDS += (self.backend,)\n \n     def test_no_remote_user(self):\n         \"\"\"\n@@ -97,6 +98,26 @@ def test_last_login(self):\n         response = self.client.get('/remote_user/', REMOTE_USER=self.known_user)\n         self.assertEqual(default_login, response.context['user'].last_login)\n \n+    def test_header_disappears(self):\n+        \"\"\"\n+        Tests that a logged in user is logged out automatically when\n+        the REMOTE_USER header disappears during the same browser session.\n+        \"\"\"\n+        User.objects.create(username='knownuser')\n+        # Known user authenticates\n+        response = self.client.get('/remote_user/', REMOTE_USER=self.known_user)\n+        self.assertEqual(response.context['user'].username, 'knownuser')\n+        # During the session, the REMOTE_USER header disappears. Should trigger logout.\n+        response = self.client.get('/remote_user/')\n+        self.assertEqual(response.context['user'].is_anonymous(), True)\n+        # verify the remoteuser middleware will not remove a user\n+        # authenticated via another backend\n+        User.objects.create_user(username='modeluser', password='foo')\n+        self.client.login(username='modeluser', password='foo')\n+        authenticate(username='modeluser', password='foo')\n+        response = self.client.get('/remote_user/')\n+        self.assertEqual(response.context['user'].username, 'modeluser')\n+\n     def tearDown(self):\n         \"\"\"Restores settings to avoid breaking other tests.\"\"\"\n         settings.MIDDLEWARE_CLASSES = self.curr_middleware"
        },
        {
            "sha": "dc4c6b17c1f56f0838274bc82f9b0a795735c070",
            "filename": "django/contrib/auth/tests/templates/context_processors/auth_attrs_user.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_user.html",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_user.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_user.html?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,4 +1,4 @@\n unicode: {{ user }}\n-id: {{ user.id }}\n+id: {{ user.pk }}\n username: {{ user.username }}\n url: {% url 'userpage' user %}"
        },
        {
            "sha": "6040a2f5b5fdc360d5a9f6f3bce062bfb0f9d8e1",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.encoding import force_text\n from django.utils.html import escape\n from django.utils.http import urlquote\n+from django.utils._os import upath\n from django.test import TestCase\n from django.test.utils import override_settings\n \n@@ -27,7 +28,7 @@\n     LANGUAGE_CODE='en',\n     TEMPLATE_LOADERS=global_settings.TEMPLATE_LOADERS,\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n     USE_TZ=False,\n     PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',),\n@@ -115,6 +116,8 @@ def test_admin_reset(self):\n         self.assertTrue(\"http://adminsite.com\" in mail.outbox[0].body)\n         self.assertEqual(settings.DEFAULT_FROM_EMAIL, mail.outbox[0].from_email)\n \n+    # Skip any 500 handler action (like sending more mail...)\n+    @override_settings(DEBUG_PROPAGATE_EXCEPTIONS=True)\n     def test_poisoned_http_host(self):\n         \"Poisoned HTTP_HOST headers can't be used for reset emails\"\n         # This attack is based on the way browsers handle URLs. The colon\n@@ -131,6 +134,8 @@ def test_poisoned_http_host(self):\n             )\n         self.assertEqual(len(mail.outbox), 0)\n \n+    # Skip any 500 handler action (like sending more mail...)\n+    @override_settings(DEBUG_PROPAGATE_EXCEPTIONS=True)\n     def test_poisoned_http_host_admin_site(self):\n         \"Poisoned HTTP_HOST headers can't be used for reset emails on admin views\"\n         with self.assertRaises(SuspiciousOperation):\n@@ -243,7 +248,9 @@ def fail_login(self, password='password'):\n             'username': 'testclient',\n             'password': password,\n         })\n-        self.assertContainsEscaped(response, AuthenticationForm.error_messages['invalid_login'])\n+        self.assertContainsEscaped(response, AuthenticationForm.error_messages['invalid_login'] % {\n+                'username': User._meta.get_field('username').verbose_name\n+            })\n \n     def logout(self):\n         response = self.client.get('/logout/')"
        },
        {
            "sha": "6e5bfe7d9daf9719f957fdbb242f7384b19096c2",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -58,7 +58,7 @@ def _make_token_with_timestamp(self, user, timestamp):\n         # Ensure results are consistent across DB backends\n         login_timestamp = user.last_login.replace(microsecond=0, tzinfo=None)\n \n-        value = (six.text_type(user.id) + user.password +\n+        value = (six.text_type(user.pk) + user.password +\n                 six.text_type(login_timestamp) + six.text_type(timestamp))\n         hash = salted_hmac(key_salt, value).hexdigest()[::2]\n         return \"%s-%s\" % (ts_b36, hash)"
        },
        {
            "sha": "8514345d0061b291b4529d55a6dc16ceadb7c022",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 24,
            "deletions": 30,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,7 +7,7 @@\n from django.core.urlresolvers import reverse\n from django.http import HttpResponseRedirect, QueryDict\n from django.template.response import TemplateResponse\n-from django.utils.http import base36_to_int\n+from django.utils.http import base36_to_int, is_safe_url\n from django.utils.translation import ugettext as _\n from django.shortcuts import resolve_url\n from django.views.decorators.debug import sensitive_post_parameters\n@@ -37,18 +37,12 @@ def login(request, template_name='registration/login.html',\n     if request.method == \"POST\":\n         form = authentication_form(data=request.POST)\n         if form.is_valid():\n-            # Use default setting if redirect_to is empty\n-            if not redirect_to:\n-                redirect_to = settings.LOGIN_REDIRECT_URL\n-            redirect_to = resolve_url(redirect_to)\n-\n-            netloc = urlparse(redirect_to)[1]\n-            # Heavier security check -- don't allow redirection to a different\n-            # host.\n-            if netloc and netloc != request.get_host():\n+\n+            # Ensure the user-originating redirection url is safe.\n+            if not is_safe_url(url=redirect_to, host=request.get_host()):\n                 redirect_to = resolve_url(settings.LOGIN_REDIRECT_URL)\n \n-            # Okay, security checks complete. Log the user in.\n+            # Okay, security check complete. Log the user in.\n             auth_login(request, form.get_user())\n \n             if request.session.test_cookie_worked():\n@@ -82,27 +76,27 @@ def logout(request, next_page=None,\n     Logs out the user and displays 'You are logged out' message.\n     \"\"\"\n     auth_logout(request)\n-    redirect_to = request.REQUEST.get(redirect_field_name, '')\n-    if redirect_to:\n-        netloc = urlparse(redirect_to)[1]\n+\n+    if redirect_field_name in request.REQUEST:\n+        next_page = request.REQUEST[redirect_field_name]\n         # Security check -- don't allow redirection to a different host.\n-        if not (netloc and netloc != request.get_host()):\n-            return HttpResponseRedirect(redirect_to)\n+        if not is_safe_url(url=next_page, host=request.get_host()):\n+            next_page = request.path\n \n-    if next_page is None:\n-        current_site = get_current_site(request)\n-        context = {\n-            'site': current_site,\n-            'site_name': current_site.name,\n-            'title': _('Logged out')\n-        }\n-        if extra_context is not None:\n-            context.update(extra_context)\n-        return TemplateResponse(request, template_name, context,\n-                                current_app=current_app)\n-    else:\n+    if next_page:\n         # Redirect to this page until the session has been cleared.\n-        return HttpResponseRedirect(next_page or request.path)\n+        return HttpResponseRedirect(next_page)\n+\n+    current_site = get_current_site(request)\n+    context = {\n+        'site': current_site,\n+        'site_name': current_site.name,\n+        'title': _('Logged out')\n+    }\n+    if extra_context is not None:\n+        context.update(extra_context)\n+    return TemplateResponse(request, template_name, context,\n+        current_app=current_app)\n \n \n def logout_then_login(request, login_url=None, current_app=None, extra_context=None):\n@@ -206,7 +200,7 @@ def password_reset_confirm(request, uidb36=None, token=None,\n         post_reset_redirect = reverse('django.contrib.auth.views.password_reset_complete')\n     try:\n         uid_int = base36_to_int(uidb36)\n-        user = UserModel.objects.get(id=uid_int)\n+        user = UserModel.objects.get(pk=uid_int)\n     except (ValueError, OverflowError, UserModel.DoesNotExist):\n         user = None\n "
        },
        {
            "sha": "1798c1adb5dcc3e85b863fa2ad959dc1d67c7e64",
            "filename": "django/contrib/comments/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -20,9 +20,9 @@ def get_comment_app():\n     # Try to import the package\n     try:\n         package = import_module(comments_app)\n-    except ImportError:\n+    except ImportError as e:\n         raise ImproperlyConfigured(\"The COMMENTS_APP setting refers to \"\\\n-                                   \"a non-existing package.\")\n+                                   \"a non-existing package. (%s)\" % e)\n \n     return package\n "
        },
        {
            "sha": "079afaf03a0d3ed4544fb4b45c85504e9f6c37c6",
            "filename": "django/contrib/comments/signals.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fsignals.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,7 +6,7 @@\n # Sent just before a comment will be posted (after it's been approved and\n # moderated; this can be used to modify the comment (in place) with posting\n # details or other such actions. If any receiver returns False the comment will be\n-# discarded and a 403 (not allowed) response. This signal is sent at more or less\n+# discarded and a 400 response. This signal is sent at more or less\n # the same time (just before, actually) as the Comment object's pre-save signal,\n # except that the HTTP request is sent along with this signal.\n comment_will_be_posted = Signal(providing_args=[\"comment\", \"request\"])"
        },
        {
            "sha": "7c02b21b6a5c7ded5a8447cb8648107312af7f02",
            "filename": "django/contrib/comments/views/comments.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -44,9 +44,6 @@ def post_comment(request, next=None, using=None):\n         if not data.get('email', ''):\n             data[\"email\"] = request.user.email\n \n-    # Check to see if the POST data overrides the view's next argument.\n-    next = data.get(\"next\", next)\n-\n     # Look up the object we're trying to comment about\n     ctype = data.get(\"content_type\")\n     object_pk = data.get(\"object_pk\")\n@@ -100,7 +97,7 @@ def post_comment(request, next=None, using=None):\n             template_list, {\n                 \"comment\": form.data.get(\"comment\", \"\"),\n                 \"form\": form,\n-                \"next\": next,\n+                \"next\": data.get(\"next\", next),\n             },\n             RequestContext(request, {})\n         )\n@@ -131,7 +128,8 @@ def post_comment(request, next=None, using=None):\n         request=request\n     )\n \n-    return next_redirect(data, next, comment_done, c=comment._get_pk_val())\n+    return next_redirect(request, fallback=next or 'comments-comment-done',\n+        c=comment._get_pk_val())\n \n comment_done = confirmation_view(\n     template=\"comments/posted.html\","
        },
        {
            "sha": "31bb98fa633aa781af3ec40269069d2928bd770c",
            "filename": "django/contrib/comments/views/moderation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,7 +10,6 @@\n from django.views.decorators.csrf import csrf_protect\n \n \n-\n @csrf_protect\n @login_required\n def flag(request, comment_id, next=None):\n@@ -27,7 +26,8 @@ def flag(request, comment_id, next=None):\n     # Flag on POST\n     if request.method == 'POST':\n         perform_flag(request, comment)\n-        return next_redirect(request.POST.copy(), next, flag_done, c=comment.pk)\n+        return next_redirect(request, fallback=next or 'comments-flag-done',\n+            c=comment.pk)\n \n     # Render a form on GET\n     else:\n@@ -54,7 +54,8 @@ def delete(request, comment_id, next=None):\n     if request.method == 'POST':\n         # Flag the comment as deleted instead of actually deleting it.\n         perform_delete(request, comment)\n-        return next_redirect(request.POST.copy(), next, delete_done, c=comment.pk)\n+        return next_redirect(request, fallback=next or 'comments-delete-done',\n+            c=comment.pk)\n \n     # Render a form on GET\n     else:\n@@ -81,7 +82,8 @@ def approve(request, comment_id, next=None):\n     if request.method == 'POST':\n         # Flag the comment as approved.\n         perform_approve(request, comment)\n-        return next_redirect(request.POST.copy(), next, approve_done, c=comment.pk)\n+        return next_redirect(request, fallback=next or 'comments-approve-done',\n+            c=comment.pk)\n \n     # Render a form on GET\n     else:"
        },
        {
            "sha": "79f637623203493750693f5bfd2df79c031c7be7",
            "filename": "django/contrib/comments/views/utils.py",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,25 +9,26 @@\n     from urllib import urlencode\n \n from django.http import HttpResponseRedirect\n-from django.core import urlresolvers\n-from django.shortcuts import render_to_response\n+from django.shortcuts import render_to_response, resolve_url\n from django.template import RequestContext\n from django.core.exceptions import ObjectDoesNotExist\n from django.contrib import comments\n+from django.utils.http import is_safe_url\n \n-def next_redirect(data, default, default_view, **get_kwargs):\n+def next_redirect(request, fallback, **get_kwargs):\n     \"\"\"\n     Handle the \"where should I go next?\" part of comment views.\n \n-    The next value could be a kwarg to the function (``default``), or a\n-    ``?next=...`` GET arg, or the URL of a given view (``default_view``). See\n+    The next value could be a\n+    ``?next=...`` GET arg or the URL of a given view (``fallback``). See\n     the view modules for examples.\n \n     Returns an ``HttpResponseRedirect``.\n     \"\"\"\n-    next = data.get(\"next\", default)\n-    if next is None:\n-        next = urlresolvers.reverse(default_view)\n+    next = request.POST.get('next')\n+    if not is_safe_url(url=next, host=request.get_host()):\n+        next = resolve_url(fallback)\n+\n     if get_kwargs:\n         if '#' in next:\n             tmp = next.rsplit('#', 1)"
        },
        {
            "sha": "6aff07e5682ec4df775f510a78bf70a0a3c227d5",
            "filename": "django/contrib/contenttypes/generic.py",
            "status": "modified",
            "additions": 13,
            "deletions": 25,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcontenttypes%2Fgeneric.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcontenttypes%2Fgeneric.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fgeneric.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,20 +5,19 @@\n \n from collections import defaultdict\n from functools import partial\n-from operator import attrgetter\n \n from django.core.exceptions import ObjectDoesNotExist\n from django.db import connection\n from django.db.models import signals\n from django.db import models, router, DEFAULT_DB_ALIAS\n from django.db.models.fields.related import RelatedField, Field, ManyToManyRel\n-from django.db.models.loading import get_model\n from django.forms import ModelForm\n from django.forms.models import BaseModelFormSet, modelformset_factory, save_instance\n from django.contrib.admin.options import InlineModelAdmin, flatten_fieldsets\n from django.contrib.contenttypes.models import ContentType\n from django.utils.encoding import smart_text\n \n+\n class GenericForeignKey(object):\n     \"\"\"\n     Provides a generic relation to any object through content-type/object-id\n@@ -52,9 +51,6 @@ def instance_pre_init(self, signal, sender, args, kwargs, **_kwargs):\n             kwargs[self.fk_field] = value._get_pk_val()\n \n     def get_content_type(self, obj=None, id=None, using=None):\n-        # Convenience function using get_model avoids a circular import when\n-        # using this model\n-        ContentType = get_model(\"contenttypes\", \"contenttype\")\n         if obj:\n             return ContentType.objects.db_manager(obj._state.db).get_for_model(obj)\n         elif id:\n@@ -209,18 +205,16 @@ def db_type(self, connection):\n         # same db_type as well.\n         return None\n \n-    def extra_filters(self, pieces, pos, negate):\n+    def get_content_type(self):\n         \"\"\"\n-        Return an extra filter to the queryset so that the results are filtered\n-        on the appropriate content type.\n+        Returns the content type associated with this field's model.\n         \"\"\"\n-        if negate:\n-            return []\n-        ContentType = get_model(\"contenttypes\", \"contenttype\")\n-        content_type = ContentType.objects.get_for_model(self.model)\n-        prefix = \"__\".join(pieces[:pos + 1])\n-        return [(\"%s__%s\" % (prefix, self.content_type_field_name),\n-            content_type)]\n+        return ContentType.objects.get_for_model(self.model)\n+\n+    def get_extra_join_sql(self, connection, qn, lhs_alias, rhs_alias):\n+        extra_col = self.rel.to._meta.get_field_by_name(self.content_type_field_name)[0].column\n+        contenttype = self.get_content_type().pk\n+        return \" AND %s.%s = %%s\" % (qn(rhs_alias), qn(extra_col)), [contenttype]\n \n     def bulk_related_objects(self, objs, using=DEFAULT_DB_ALIAS):\n         \"\"\"\n@@ -251,9 +245,6 @@ def __get__(self, instance, instance_type=None):\n         if instance is None:\n             return self\n \n-        # This import is done here to avoid circular import importing this module\n-        from django.contrib.contenttypes.models import ContentType\n-\n         # Dynamically create a class that subclasses the related model's\n         # default manager.\n         rel_model = self.field.rel.to\n@@ -329,8 +320,11 @@ def get_prefetch_query_set(self, instances):\n                     set(obj._get_pk_val() for obj in instances)\n                 }\n             qs = super(GenericRelatedObjectManager, self).get_query_set().using(db).filter(**query)\n+            # We (possibly) need to convert object IDs to the type of the\n+            # instances' PK in order to match up instances:\n+            object_id_converter = instances[0]._meta.pk.to_python\n             return (qs,\n-                    attrgetter(self.object_id_field_name),\n+                    lambda relobj: object_id_converter(getattr(relobj, self.object_id_field_name)),\n                     lambda obj: obj._get_pk_val(),\n                     False,\n                     self.prefetch_cache_name)\n@@ -381,8 +375,6 @@ class BaseGenericInlineFormSet(BaseModelFormSet):\n \n     def __init__(self, data=None, files=None, instance=None, save_as_new=None,\n                  prefix=None, queryset=None):\n-        # Avoid a circular import.\n-        from django.contrib.contenttypes.models import ContentType\n         opts = self.model._meta\n         self.instance = instance\n         self.rel_name = '-'.join((\n@@ -411,8 +403,6 @@ def get_default_prefix(cls):\n         ))\n \n     def save_new(self, form, commit=True):\n-        # Avoid a circular import.\n-        from django.contrib.contenttypes.models import ContentType\n         kwargs = {\n             self.ct_field.get_attname(): ContentType.objects.get_for_model(self.instance).pk,\n             self.ct_fk_field.get_attname(): self.instance.pk,\n@@ -434,8 +424,6 @@ def generic_inlineformset_factory(model, form=ModelForm,\n     defaults ``content_type`` and ``object_id`` respectively.\n     \"\"\"\n     opts = model._meta\n-    # Avoid a circular import.\n-    from django.contrib.contenttypes.models import ContentType\n     # if there is no field called `ct_field` let the exception propagate\n     ct_field = opts.get_field(ct_field)\n     if not isinstance(ct_field, models.ForeignKey) or ct_field.rel.to != ContentType:"
        },
        {
            "sha": "8329ab65d9d1e527cc7e23944476dc3f0c7b4f06",
            "filename": "django/contrib/contenttypes/management.py",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcontenttypes%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fcontenttypes%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmanagement.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,14 +1,19 @@\n from django.contrib.contenttypes.models import ContentType\n+from django.db import DEFAULT_DB_ALIAS, router\n from django.db.models import get_apps, get_models, signals\n from django.utils.encoding import smart_text\n from django.utils import six\n from django.utils.six.moves import input\n \n-def update_contenttypes(app, created_models, verbosity=2, **kwargs):\n+\n+def update_contenttypes(app, created_models, verbosity=2, db=DEFAULT_DB_ALIAS, **kwargs):\n     \"\"\"\n     Creates content types for models in the given app, removing any model\n     entries that no longer have a matching model class.\n     \"\"\"\n+    if not router.allow_syncdb(db, ContentType):\n+        return\n+\n     ContentType.objects.clear_cache()\n     app_models = get_models(app)\n     if not app_models:\n@@ -19,26 +24,28 @@ def update_contenttypes(app, created_models, verbosity=2, **kwargs):\n         (model._meta.object_name.lower(), model)\n         for model in app_models\n     )\n+\n     # Get all the content types\n     content_types = dict(\n         (ct.model, ct)\n-        for ct in ContentType.objects.filter(app_label=app_label)\n+        for ct in ContentType.objects.using(db).filter(app_label=app_label)\n     )\n     to_remove = [\n         ct\n         for (model_name, ct) in six.iteritems(content_types)\n         if model_name not in app_models\n     ]\n \n-    cts = ContentType.objects.bulk_create([\n+    cts = [\n         ContentType(\n             name=smart_text(model._meta.verbose_name_raw),\n             app_label=app_label,\n             model=model_name,\n         )\n         for (model_name, model) in six.iteritems(app_models)\n         if model_name not in content_types\n-    ])\n+    ]\n+    ContentType.objects.using(db).bulk_create(cts)\n     if verbosity >= 2:\n         for ct in cts:\n             print(\"Adding content type '%s | %s'\" % (ct.app_label, ct.model))\n@@ -71,6 +78,7 @@ def update_contenttypes(app, created_models, verbosity=2, **kwargs):\n             if verbosity >= 2:\n                 print(\"Stale content types remain.\")\n \n+\n def update_all_contenttypes(verbosity=2, **kwargs):\n     for app in get_apps():\n         update_contenttypes(app, None, verbosity, **kwargs)"
        },
        {
            "sha": "a848875a9fe3bb12d562da09015850953661fc10",
            "filename": "django/contrib/flatpages/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fflatpages%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fflatpages%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Fforms.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -35,7 +35,7 @@ def clean(self):\n             for site in sites:\n                 if same_url.filter(sites=site).exists():\n                     raise forms.ValidationError(\n-                        _('Flatpage with url %(url)s already exists for site %(site)s' %\n-                          {'url': url, 'site': site}))\n+                        _('Flatpage with url %(url)s already exists for site %(site)s') %\n+                          {'url': url, 'site': site})\n \n         return super(FlatpageForm, self).clean()"
        },
        {
            "sha": "aa7d5ff7d444df26c21efb43b20be2f39d9b080a",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,6 +14,7 @@\n from django.test import TestCase\n from django.test.html import parse_html\n from django.test.utils import override_settings\n+from django.utils._os import upath\n from django.utils import unittest\n \n from django.contrib.formtools.tests.wizard import *\n@@ -36,7 +37,7 @@ def done(self, request, cleaned_data):\n \n @override_settings(\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n )\n class PreviewTests(TestCase):\n@@ -214,7 +215,7 @@ def __init__(self, POST=None):\n @override_settings(\n     SECRET_KEY=\"123\",\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n )\n class WizardTests(TestCase):"
        },
        {
            "sha": "4aaea7d56e61e724c6ecc263697cec1eb9cdc336",
            "filename": "django/contrib/formtools/tests/wizard/wizardtests/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,6 +9,7 @@\n from django.contrib.auth.models import User\n from django.contrib.formtools.wizard.views import CookieWizardView\n from django.contrib.formtools.tests.wizard.forms import UserForm, UserFormSet\n+from django.utils._os import upath\n \n \n class WizardTests(object):\n@@ -72,6 +73,10 @@ def test_template_context(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n         self.assertEqual(response.context.get('another_var', None), True)\n \n+        # ticket #19025: `form` should be included in context\n+        form = response.context_data['wizard']['form']\n+        self.assertEqual(response.context_data['form'], form)            \n+\n     def test_form_finish(self):\n         response = self.client.get(self.wizard_url)\n         self.assertEqual(response.status_code, 200)\n@@ -82,7 +87,7 @@ def test_form_finish(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__, 'rb')\n+        post_data['form2-file1'] = open(upath(__file__), 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n@@ -95,7 +100,7 @@ def test_form_finish(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['form_list']\n-        with open(__file__, 'rb') as f:\n+        with open(upath(__file__), 'rb') as f:\n             self.assertEqual(all_data[1]['file1'].read(), f.read())\n         all_data[1]['file1'].close()\n         del all_data[1]['file1']\n@@ -114,7 +119,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        with open(__file__, 'rb') as post_file:\n+        with open(upath(__file__), 'rb') as post_file:\n             post_data['form2-file1'] = post_file\n             response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n@@ -126,7 +131,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['all_cleaned_data']\n-        with open(__file__, 'rb') as f:\n+        with open(upath(__file__), 'rb') as f:\n             self.assertEqual(all_data['file1'].read(), f.read())\n         all_data['file1'].close()\n         del all_data['file1']\n@@ -146,7 +151,7 @@ def test_manipulated_data(self):\n \n         post_data = self.wizard_step_data[1]\n         post_data['form2-file1'].close()\n-        post_data['form2-file1'] = open(__file__, 'rb')\n+        post_data['form2-file1'] = open(upath(__file__), 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n \n@@ -174,7 +179,7 @@ def test_form_refresh(self):\n \n         post_data = self.wizard_step_data[1]\n         post_data['form2-file1'].close()\n-        post_data['form2-file1'] = open(__file__, 'rb')\n+        post_data['form2-file1'] = open(upath(__file__), 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n@@ -287,7 +292,7 @@ def setUp(self):\n         self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n \n     def test_template(self):\n-        templates = os.path.join(os.path.dirname(__file__), 'templates')\n+        templates = os.path.join(os.path.dirname(upath(__file__)), 'templates')\n         with self.settings(\n                 TEMPLATE_DIRS=list(settings.TEMPLATE_DIRS) + [templates]):\n             response = self.client.get(self.wizard_url)"
        },
        {
            "sha": "2e59679d094d0df806663761524a68bdbe7d7044",
            "filename": "django/contrib/formtools/wizard/storage/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -69,7 +69,9 @@ def get_step_files(self, step):\n         wizard_files = self.data[self.step_files_key].get(step, {})\n \n         if wizard_files and not self.file_storage:\n-            raise NoFileStorageConfigured\n+            raise NoFileStorageConfigured(\n+                    \"You need to define 'file_storage' in your \"\n+                    \"wizard view in order to handle file uploads.\")\n \n         files = {}\n         for field, field_dict in six.iteritems(wizard_files):\n@@ -81,7 +83,9 @@ def get_step_files(self, step):\n \n     def set_step_files(self, step, files):\n         if files and not self.file_storage:\n-            raise NoFileStorageConfigured\n+            raise NoFileStorageConfigured(\n+                    \"You need to define 'file_storage' in your \"\n+                    \"wizard view in order to handle file uploads.\")\n \n         if step not in self.data[self.step_files_key]:\n             self.data[self.step_files_key][step] = {}"
        },
        {
            "sha": "cba39151e79a9f37b1ec703c1be34baf4c484fea",
            "filename": "django/contrib/formtools/wizard/views.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -174,7 +174,9 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n             for field in six.itervalues(form.base_fields):\n                 if (isinstance(field, forms.FileField) and\n                         not hasattr(cls, 'file_storage')):\n-                    raise NoFileStorageConfigured\n+                    raise NoFileStorageConfigured(\n+                            \"You need to define 'file_storage' in your \"\n+                            \"wizard view in order to handle file uploads.\")\n \n         # build the kwargs for the wizardview instances\n         kwargs['form_list'] = init_form_list\n@@ -436,8 +438,8 @@ def get_form_step_files(self, form):\n     def get_all_cleaned_data(self):\n         \"\"\"\n         Returns a merged dictionary of all step cleaned_data dictionaries.\n-        If a step contains a `FormSet`, the key will be prefixed with formset\n-        and contain a list of the formset cleaned_data dictionaries.\n+        If a step contains a `FormSet`, the key will be prefixed with\n+        'formset-' and contain a list of the formset cleaned_data dictionaries.\n         \"\"\"\n         cleaned_data = {}\n         for form_key in self.get_form_list():\n@@ -458,8 +460,8 @@ def get_all_cleaned_data(self):\n     def get_cleaned_data_for_step(self, step):\n         \"\"\"\n         Returns the cleaned data for a given `step`. Before returning the\n-        cleaned data, the stored values are being revalidated through the\n-        form. If the data doesn't validate, None will be returned.\n+        cleaned data, the stored values are revalidated through the form.\n+        If the data doesn't validate, None will be returned.\n         \"\"\"\n         if step in self.form_list:\n             form_obj = self.get_form(step=step,\n@@ -528,7 +530,7 @@ def get_context_data(self, form, **kwargs):\n                         context.update({'another_var': True})\n                     return context\n         \"\"\"\n-        context = super(WizardView, self).get_context_data(**kwargs)\n+        context = super(WizardView, self).get_context_data(form=form, **kwargs)\n         context.update(self.storage.extra_data)\n         context['wizard'] = {\n             'form': form,"
        },
        {
            "sha": "98da0163ba06d7d5fb6a91e64431253f51e116f1",
            "filename": "django/contrib/gis/db/backends/oracle/compiler.py",
            "status": "modified",
            "additions": 1,
            "deletions": 23,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Fcompiler.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,29 +7,7 @@ class GeoSQLCompiler(BaseGeoSQLCompiler, SQLCompiler):\n     pass\n \n class SQLInsertCompiler(compiler.SQLInsertCompiler, GeoSQLCompiler):\n-    def placeholder(self, field, val):\n-        if field is None:\n-            # A field value of None means the value is raw.\n-            return val\n-        elif hasattr(field, 'get_placeholder'):\n-            # Some fields (e.g. geo fields) need special munging before\n-            # they can be inserted.\n-            ph = field.get_placeholder(val, self.connection)\n-            if ph == 'NULL':\n-                # If the placeholder returned is 'NULL', then we need to\n-                # to remove None from the Query parameters. Specifically,\n-                # cx_Oracle will assume a CHAR type when a placeholder ('%s')\n-                # is used for columns of MDSYS.SDO_GEOMETRY.  Thus, we use\n-                # 'NULL' for the value, and remove None from the query params.\n-                # See also #10888.\n-                param_idx = self.query.columns.index(field.column)\n-                params = list(self.query.params)\n-                params.pop(param_idx)\n-                self.query.params = tuple(params)\n-            return ph\n-        else:\n-            # Return the common case for the placeholder\n-            return '%s'\n+    pass\n \n class SQLDeleteCompiler(compiler.SQLDeleteCompiler, GeoSQLCompiler):\n     pass"
        },
        {
            "sha": "4e42b4cf0001deb6effcfbd71c4ff12b0e6d53bb",
            "filename": "django/contrib/gis/db/backends/oracle/operations.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -288,3 +288,12 @@ def geometry_columns(self):\n     def spatial_ref_sys(self):\n         from django.contrib.gis.db.backends.oracle.models import SpatialRefSys\n         return SpatialRefSys\n+    \n+    def modify_insert_params(self, placeholders, params):\n+        \"\"\"Drop out insert parameters for NULL placeholder. Needed for Oracle Spatial\n+        backend due to #10888\n+        \"\"\"\n+        # This code doesn't work for bulk insert cases.\n+        assert len(placeholders) == 1\n+        return [[param for pholder,param\n+                 in six.moves.zip(placeholders[0], params[0]) if pholder != 'NULL'], ]"
        },
        {
            "sha": "43ae9a0331fdc2907d8f7fc4c342ace260a1d970",
            "filename": "django/contrib/gis/db/backends/postgis/creation.py",
            "status": "modified",
            "additions": 27,
            "deletions": 2,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fcreation.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,12 +1,23 @@\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n from django.db.backends.postgresql_psycopg2.creation import DatabaseCreation\n+from django.utils.functional import cached_property\n+\n \n class PostGISCreation(DatabaseCreation):\n     geom_index_type = 'GIST'\n     geom_index_ops = 'GIST_GEOMETRY_OPS'\n     geom_index_ops_nd = 'GIST_GEOMETRY_OPS_ND'\n \n+    @cached_property\n+    def template_postgis(self):\n+        template_postgis = getattr(settings, 'POSTGIS_TEMPLATE', 'template_postgis')\n+        cursor = self.connection.cursor()\n+        cursor.execute('SELECT 1 FROM pg_database WHERE datname = %s LIMIT 1;', (template_postgis,))\n+        if cursor.fetchone():\n+            return template_postgis\n+        return None\n+\n     def sql_indexes_for_field(self, model, f, style):\n         \"Return any spatial index creation SQL for the field.\"\n         from django.contrib.gis.db.models.fields import GeometryField\n@@ -67,5 +78,19 @@ def sql_indexes_for_field(self, model, f, style):\n         return output\n \n     def sql_table_creation_suffix(self):\n-        postgis_template = getattr(settings, 'POSTGIS_TEMPLATE', 'template_postgis')\n-        return ' TEMPLATE %s' % self.connection.ops.quote_name(postgis_template)\n+        if self.template_postgis is not None:\n+            return ' TEMPLATE %s' % (\n+                self.connection.ops.quote_name(self.template_postgis),)\n+        return ''\n+\n+    def _create_test_db(self, verbosity, autoclobber):\n+        test_database_name = super(PostGISCreation, self)._create_test_db(verbosity, autoclobber)\n+        if self.template_postgis is None:\n+            # Connect to the test database in order to create the postgis extension\n+            self.connection.close()\n+            self.connection.settings_dict[\"NAME\"] = test_database_name\n+            cursor = self.connection.cursor()\n+            cursor.execute(\"CREATE EXTENSION postgis\")\n+            cursor.connection.commit()\n+\n+        return test_database_name"
        },
        {
            "sha": "b3a53820c1124d9a7ead359860607ccf3351b552",
            "filename": "django/contrib/gis/db/backends/spatialite/base.py",
            "status": "modified",
            "additions": 20,
            "deletions": 26,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -36,29 +36,23 @@ def __init__(self, *args, **kwargs):\n         self.creation = SpatiaLiteCreation(self)\n         self.introspection = SpatiaLiteIntrospection(self)\n \n-    def _cursor(self):\n-        if self.connection is None:\n-            self._sqlite_create_connection()\n-\n-            ## From here on, customized for GeoDjango ##\n-\n-            # Enabling extension loading on the SQLite connection.\n-            try:\n-                self.connection.enable_load_extension(True)\n-            except AttributeError:\n-                raise ImproperlyConfigured('The pysqlite library does not support C extension loading. '\n-                                           'Both SQLite and pysqlite must be configured to allow '\n-                                           'the loading of extensions to use SpatiaLite.'\n-                                           )\n-\n-            # Loading the SpatiaLite library extension on the connection, and returning\n-            # the created cursor.\n-            cur = self.connection.cursor(factory=SQLiteCursorWrapper)\n-            try:\n-                cur.execute(\"SELECT load_extension(%s)\", (self.spatialite_lib,))\n-            except Exception as msg:\n-                raise ImproperlyConfigured('Unable to load the SpatiaLite library extension '\n-                                           '\"%s\" because: %s' % (self.spatialite_lib, msg))\n-            return cur\n-        else:\n-            return self.connection.cursor(factory=SQLiteCursorWrapper)\n+    def get_new_connection(self, conn_params):\n+        conn = super(DatabaseWrapper, self).get_new_connection(conn_params)\n+        # Enabling extension loading on the SQLite connection.\n+        try:\n+            conn.enable_load_extension(True)\n+        except AttributeError:\n+            raise ImproperlyConfigured(\n+                'The pysqlite library does not support C extension loading. '\n+                'Both SQLite and pysqlite must be configured to allow '\n+                'the loading of extensions to use SpatiaLite.')\n+        # Loading the SpatiaLite library extension on the connection, and returning\n+        # the created cursor.\n+        cur = conn.cursor(factory=SQLiteCursorWrapper)\n+        try:\n+            cur.execute(\"SELECT load_extension(%s)\", (self.spatialite_lib,))\n+        except Exception as msg:\n+            raise ImproperlyConfigured('Unable to load the SpatiaLite library extension '\n+                                       '\"%s\" because: %s' % (self.spatialite_lib, msg))\n+        cur.close()\n+        return conn"
        },
        {
            "sha": "c89912b2d9d0a6f26c6a76b18ce355de07162fa1",
            "filename": "django/contrib/gis/db/models/query.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -760,8 +760,10 @@ def _geocol_select(self, geo_field, field_name):\n             self.query.add_select_related([field_name])\n             compiler = self.query.get_compiler(self.db)\n             compiler.pre_sql_setup()\n-            rel_table, rel_col = self.query.related_select_cols[self.query.related_select_fields.index(geo_field)]\n-            return compiler._field_column(geo_field, rel_table)\n+            for (rel_table, rel_col), field in self.query.related_select_cols:\n+                if field == geo_field:\n+                    return compiler._field_column(geo_field, rel_table)\n+            raise ValueError(\"%r not in self.query.related_select_cols\" % geo_field)\n         elif not geo_field in opts.local_fields:\n             # This geographic field is inherited from another model, so we have to\n             # use the db table for the _parent_ model instead."
        },
        {
            "sha": "81a9941c9e9a02e4cd3a1e6088386e8b51b27fd0",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -39,7 +39,7 @@ def get_columns(self, with_aliases=False):\n         if self.query.select:\n             only_load = self.deferred_to_columns()\n             # This loop customized for GeoQuery.\n-            for col, field in zip(self.query.select, self.query.select_fields):\n+            for col, field in self.query.select:\n                 if isinstance(col, (list, tuple)):\n                     alias, column = col\n                     table = self.query.alias_map[alias].table_name\n@@ -85,7 +85,7 @@ def get_columns(self, with_aliases=False):\n         ])\n \n         # This loop customized for GeoQuery.\n-        for (table, col), field in zip(self.query.related_select_cols, self.query.related_select_fields):\n+        for (table, col), field in self.query.related_select_cols:\n             r = self.get_field_select(field, table, col)\n             if with_aliases and col in col_aliases:\n                 c_alias = 'Col%d' % len(col_aliases)\n@@ -101,7 +101,7 @@ def get_columns(self, with_aliases=False):\n         return result\n \n     def get_default_columns(self, with_aliases=False, col_aliases=None,\n-            start_alias=None, opts=None, as_pairs=False, local_only=False):\n+            start_alias=None, opts=None, as_pairs=False, from_parent=None):\n         \"\"\"\n         Computes the default columns for selecting every field in the base\n         model. Will sometimes be called to pull in related models (e.g. via\n@@ -127,7 +127,7 @@ def get_default_columns(self, with_aliases=False, col_aliases=None,\n         if start_alias:\n             seen = {None: start_alias}\n         for field, model in opts.get_fields_with_model():\n-            if local_only and model is not None:\n+            if from_parent and model is not None and issubclass(from_parent, model):\n                 continue\n             if start_alias:\n                 try:"
        },
        {
            "sha": "c890c4f4baf9ec8fc2a4a1a640fb9509a968dc4d",
            "filename": "django/contrib/gis/geoip/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeoip%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeoip%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeoip%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,3 +1,4 @@\n+# -*- coding: utf-8 -*-\n from __future__ import unicode_literals\n \n import os"
        },
        {
            "sha": "e13e8589e692e9e3f4860bc9e3a7db39263159ab",
            "filename": "django/contrib/gis/geometry/test_data.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,13 +7,14 @@\n \n from django.contrib import gis\n from django.utils import six\n+from django.utils._os import upath\n \n \n # This global used to store reference geometry data.\n GEOMETRIES = None\n \n # Path where reference test data is located.\n-TEST_DATA = os.path.join(os.path.dirname(gis.__file__), 'tests', 'data')\n+TEST_DATA = os.path.join(os.path.dirname(upath(gis.__file__)), 'tests', 'data')\n \n \n def tuplize(seq):"
        },
        {
            "sha": "0418282bfe961fb6e3664fe63284e641ff5e6041",
            "filename": "django/contrib/gis/geos/mutable_list.py",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -149,27 +149,30 @@ def __imul__(self, n):\n         return self\n \n     def __eq__(self, other):\n-        for i in range(len(self)):\n+        olen = len(other)\n+        for i in range(olen):\n             try:\n                 c = self[i] == other[i]\n-            except IndexError:\n-                # must be other is shorter\n+            except self._IndexError:\n+                # self must be shorter\n                 return False\n             if not c:\n                 return False\n-        return True\n+        return len(self) == olen\n \n     def __lt__(self, other):\n-        slen = len(self)\n-        for i in range(slen):\n+        olen = len(other)\n+        for i in range(olen):\n             try:\n                 c = self[i] < other[i]\n-            except IndexError:\n-                # must be other is shorter\n-                return False\n+            except self._IndexError:\n+                # self must be shorter\n+                return True\n             if c:\n                 return c\n-        return slen < len(other)\n+            elif other[i] < self[i]:\n+                return False\n+        return len(self) < olen\n \n     ### Public list interface Methods ###\n     ## Non-mutating ##"
        },
        {
            "sha": "ec320f94ec9a48865d6d08dde0e0b5e99fa94efd",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -451,6 +451,21 @@ def test_polygons(self):\n             self.assertEqual(poly.wkt, Polygon(*tuple(r for r in poly)).wkt)\n             self.assertEqual(poly.wkt, Polygon(*tuple(LinearRing(r.tuple) for r in poly)).wkt)\n \n+    def test_polygon_comparison(self):\n+        p1 = Polygon(((0, 0), (0, 1), (1, 1), (1, 0), (0, 0)))\n+        p2 = Polygon(((0, 0), (0, 1), (1, 0), (0, 0)))\n+        self.assertTrue(p1 > p2)\n+        self.assertFalse(p1 < p2)\n+        self.assertFalse(p2 > p1)\n+        self.assertTrue(p2 < p1)\n+\n+        p3 = Polygon(((0, 0), (0, 1), (1, 1), (2, 0), (0, 0)))\n+        p4 = Polygon(((0, 0), (0, 1), (2, 2), (1, 0), (0, 0)))\n+        self.assertFalse(p4 < p3)\n+        self.assertTrue(p3 < p4)\n+        self.assertTrue(p4 > p3)\n+        self.assertFalse(p3 > p4)\n+\n     def test_multipolygons(self):\n         \"Testing MultiPolygon objects.\"\n         prev = fromstr('POINT (0 0)')"
        },
        {
            "sha": "988d8417a2ba3292e9e9191a478f3df109cfba72",
            "filename": "django/contrib/gis/geos/tests/test_mutable_list.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -363,6 +363,7 @@ def test_12_arithmetic(self):\n \n         pl, ul = self.lists_of_len()\n         self.assertEqual(pl, ul, 'cmp for equal')\n+        self.assertFalse(ul == pl + [2], 'cmp for not equal')\n         self.assertTrue(pl >= ul, 'cmp for gte self')\n         self.assertTrue(pl <= ul, 'cmp for lte self')\n         self.assertTrue(ul >= pl, 'cmp for self gte')\n@@ -377,6 +378,14 @@ def test_12_arithmetic(self):\n         self.assertTrue(ul < pl + [2], 'cmp')\n         self.assertTrue(ul <= pl + [2], 'cmp')\n \n+        # Also works with a custom IndexError\n+        ul_longer = ul + [2]\n+        ul_longer._IndexError = TypeError\n+        ul._IndexError = TypeError\n+        self.assertFalse(ul_longer == pl)\n+        self.assertFalse(ul == ul_longer)\n+        self.assertTrue(ul_longer > ul)\n+\n         pl[1] = 20\n         self.assertTrue(pl > ul, 'cmp for gt self')\n         self.assertTrue(ul < pl, 'cmp for self lt')"
        },
        {
            "sha": "e2e6b6bca87463d7d9af17c9480db3172e8a8a98",
            "filename": "django/contrib/gis/measure.py",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmeasure.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -151,19 +151,25 @@ def __truediv__(self, other):\n                 **{self.STANDARD_UNIT: (self.standard / other)})\n         else:\n             raise TypeError('%(class)s must be divided with number or %(class)s' % {\"class\":pretty_name(self)})\n-    __div__ = __truediv__ # Python 2 compatibility\n+\n+    def __div__(self, other):   # Python 2 compatibility\n+        return type(self).__truediv__(self, other)\n \n     def __itruediv__(self, other):\n         if isinstance(other, NUMERIC_TYPES):\n             self.standard /= float(other)\n             return self\n         else:\n             raise TypeError('%(class)s must be divided with number' % {\"class\":pretty_name(self)})\n-    __idiv__ = __itruediv__ # Python 2 compatibility\n+\n+    def __idiv__(self, other):  # Python 2 compatibility\n+        return type(self).__itruediv__(self, other)\n \n     def __bool__(self):\n         return bool(self.standard)\n-    __nonzero__ = __bool__ # Python 2 compatibility\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     def default_units(self, kwargs):\n         \"\"\"\n@@ -314,7 +320,9 @@ def __truediv__(self, other):\n                 **{self.STANDARD_UNIT: (self.standard / other)})\n         else:\n             raise TypeError('%(class)s must be divided by a number' % {\"class\":pretty_name(self)})\n-    __div__ = __truediv__ # Python 2 compatibility\n+\n+    def __div__(self, other):  # Python 2 compatibility\n+        return type(self).__truediv__(self, other)\n \n \n # Shortcuts"
        },
        {
            "sha": "6b40164422d5fb39b6e9449febd562aec21260c9",
            "filename": "django/contrib/gis/tests/geo3d/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,12 +7,13 @@\n from django.contrib.gis.geos import GEOSGeometry, LineString, Point, Polygon\n from django.contrib.gis.utils import LayerMapping, LayerMapError\n from django.test import TestCase\n+from django.utils._os import upath\n \n from .models import (City3D, Interstate2D, Interstate3D, InterstateProj2D,\n     InterstateProj3D, Point2D, Point3D, MultiPoint3D, Polygon2D, Polygon3D)\n \n \n-data_path = os.path.realpath(os.path.join(os.path.dirname(__file__), '..', 'data'))\n+data_path = os.path.realpath(os.path.join(os.path.dirname(upath(__file__)), '..', 'data'))\n city_file = os.path.join(data_path, 'cities', 'cities.shp')\n vrt_file = os.path.join(data_path, 'test_vrt', 'test_vrt.vrt')\n "
        },
        {
            "sha": "a8c607c502a3118bd35b8ea4c0948b5cf72c5939",
            "filename": "django/contrib/gis/tests/geogapp/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -8,6 +8,7 @@\n from django.contrib.gis import gdal\n from django.contrib.gis.measure import D\n from django.test import TestCase\n+from django.utils._os import upath\n \n from .models import City, County, Zipcode\n \n@@ -61,7 +62,7 @@ def test05_geography_layermapping(self):\n         from django.contrib.gis.utils import LayerMapping\n \n         # Getting the shapefile and mapping dictionary.\n-        shp_path = os.path.realpath(os.path.join(os.path.dirname(__file__), '..', 'data'))\n+        shp_path = os.path.realpath(os.path.join(os.path.dirname(upath(__file__)), '..', 'data'))\n         co_shp = os.path.join(shp_path, 'counties', 'counties.shp')\n         co_mapping = {'name' : 'Name',\n                       'state' : 'State',"
        },
        {
            "sha": "470e5be21631afaace474038346280a60f255d93",
            "filename": "django/contrib/gis/tests/layermap/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -13,13 +13,14 @@\n from django.conf import settings\n from django.test import TestCase\n from django.utils import unittest\n+from django.utils._os import upath\n \n from .models import (\n     City, County, CountyFeat, Interstate, ICity1, ICity2, Invalid, State,\n     city_mapping, co_mapping, cofeat_mapping, inter_mapping)\n \n \n-shp_path = os.path.realpath(os.path.join(os.path.dirname(__file__), os.pardir, 'data'))\n+shp_path = os.path.realpath(os.path.join(os.path.dirname(upath(__file__)), os.pardir, 'data'))\n city_shp = os.path.join(shp_path, 'cities', 'cities.shp')\n co_shp = os.path.join(shp_path, 'counties', 'counties.shp')\n inter_shp = os.path.join(shp_path, 'interstates', 'interstates.shp')"
        },
        {
            "sha": "8355b27fd7351484f64e625cc12be37f474e2205",
            "filename": "django/contrib/gis/tests/utils.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Ftests%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Futils.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -26,7 +26,7 @@ def no_spatialite(func): return no_backend(func, 'spatialite')\n spatialite = _default_db == 'spatialite'\n \n HAS_SPATIALREFSYS = True\n-if oracle:\n+if oracle and 'gis' in settings.DATABASES[DEFAULT_DB_ALIAS]['ENGINE']:\n     from django.contrib.gis.db.backends.oracle.models import SpatialRefSys\n elif postgis:\n     from django.contrib.gis.db.backends.postgis.models import SpatialRefSys"
        },
        {
            "sha": "08d3b4039728df8ff4f29bc1298289931ca89991",
            "filename": "django/contrib/gis/utils/ogrinspect.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -123,7 +123,7 @@ def _ogrinspect(data_source, model_name, geom_name='geom', layer_key=0, srid=Non\n     to the given data source.  See the `ogrinspect` docstring for more details.\n     \"\"\"\n     # Getting the DataSource\n-    if isinstance(data_source, str):\n+    if isinstance(data_source, six.string_types):\n         data_source = DataSource(data_source)\n     elif isinstance(data_source, DataSource):\n         pass"
        },
        {
            "sha": "c648f544d73695e61dcc8a31c9529dc93f2d18d3",
            "filename": "django/contrib/humanize/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,6 +1,12 @@\n from __future__ import unicode_literals\n import datetime\n \n+try:\n+    import pytz\n+except ImportError:\n+    pytz = None\n+\n+from django.conf import settings\n from django.contrib.humanize.templatetags import humanize\n from django.template import Template, Context, defaultfilters\n from django.test import TestCase\n@@ -10,6 +16,7 @@\n from django.utils import translation\n from django.utils.translation import ugettext as _\n from django.utils import tzinfo\n+from django.utils.unittest import skipIf\n \n \n # Mock out datetime in some tests so they don't fail occasionally when they\n@@ -141,14 +148,16 @@ def test_naturalday_tz(self):\n         # As 24h of difference they will never be the same\n         self.assertNotEqual(naturalday_one, naturalday_two)\n \n+    @skipIf(settings.TIME_ZONE != \"America/Chicago\" and pytz is None,\n+            \"this test requires pytz when a non-default time zone is set\")\n     def test_naturalday_uses_localtime(self):\n         # Regression for #18504\n-        # This is 2012-03-08HT19:30:00-06:00 in Ameria/Chicago\n+        # This is 2012-03-08HT19:30:00-06:00 in America/Chicago\n         dt = datetime.datetime(2012, 3, 9, 1, 30, tzinfo=utc)\n \n         orig_humanize_datetime, humanize.datetime = humanize.datetime, MockDateTime\n         try:\n-            with override_settings(USE_TZ=True):\n+            with override_settings(TIME_ZONE=\"America/Chicago\", USE_TZ=True):\n                 self.humanize_tester([dt], ['yesterday'], 'naturalday')\n         finally:\n             humanize.datetime = orig_humanize_datetime"
        },
        {
            "sha": "cc6c833de068321a69f868330abc7eae16d05428",
            "filename": "django/contrib/localflavor/ar/forms.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Flocalflavor%2Far%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Flocalflavor%2Far%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Far%2Fforms.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -24,7 +24,9 @@ class ARPostalCodeField(RegexField):\n     \"\"\"\n     A field that accepts a 'classic' NNNN Postal Code or a CPA.\n \n-    See http://www.correoargentino.com.ar/consulta_cpa/home.php\n+    See:\n+        http://www.correoargentino.com.ar/cpa/que_es\n+        http://www.correoargentino.com.ar/cpa/como_escribirlo\n     \"\"\"\n     default_error_messages = {\n         'invalid': _(\"Enter a postal code in the format NNNN or ANNNNAAA.\"),\n@@ -120,8 +122,7 @@ def _calc_cd(self, cuit):\n         return str(result)\n \n     def _format(self, cuit, check_digit=None):\n-        if check_digit == None:\n+        if check_digit is None:\n             check_digit = cuit[-1]\n             cuit = cuit[:-1]\n         return '%s-%s-%s' % (cuit[:2], cuit[2:], check_digit)\n-"
        },
        {
            "sha": "11ffc7b748dd5a42b611de5289069aec5de1ff26",
            "filename": "django/contrib/redirects/tests.py",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fredirects%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fredirects%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fredirects%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,42 @@\n+from django.conf import settings\n+from django.contrib.sites.models import Site\n+from django.test import TestCase\n+from django.test.utils import override_settings\n+from django.utils import six\n+\n+from .models import Redirect\n+\n+\n+@override_settings(\n+    SITE_ID=1,\n+    APPEND_SLASH=True,\n+    MIDDLEWARE_CLASSES=list(settings.MIDDLEWARE_CLASSES) +\n+        ['django.contrib.redirects.middleware.RedirectFallbackMiddleware'],\n+)\n+class RedirectTests(TestCase):\n+\n+    def setUp(self):\n+        self.site = Site.objects.get(pk=settings.SITE_ID)\n+\n+    def test_model(self):\n+        r1 = Redirect.objects.create(\n+            site=self.site, old_path='/initial', new_path='/new_target')\n+        self.assertEqual(six.text_type(r1), \"/initial ---> /new_target\")\n+\n+    def test_redirect_middleware(self):\n+        r1 = Redirect.objects.create(\n+            site=self.site, old_path='/initial', new_path='/new_target')\n+        response = self.client.get('/initial')\n+        self.assertRedirects(response,\n+            '/new_target', status_code=301, target_status_code=404)\n+        # Works also with trailing slash\n+        response = self.client.get('/initial/')\n+        self.assertRedirects(response,\n+            '/new_target', status_code=301, target_status_code=404)\n+\n+    def test_response_gone(self):\n+        \"\"\"When the redirect target is '', return a 410\"\"\"\n+        r1 = Redirect.objects.create(\n+            site=self.site, old_path='/initial', new_path='')\n+        response = self.client.get('/initial')\n+        self.assertEqual(response.status_code, 410)"
        },
        {
            "sha": "f79a2645004ab7016c2ddbf2012f647a9f643ba3",
            "filename": "django/contrib/sessions/backends/base.py",
            "status": "modified",
            "additions": 53,
            "deletions": 14,
            "changes": 67,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,12 +1,12 @@\n from __future__ import unicode_literals\n \n import base64\n-import time\n from datetime import datetime, timedelta\n try:\n     from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n+import string\n \n from django.conf import settings\n from django.core.exceptions import SuspiciousOperation\n@@ -16,6 +16,10 @@\n from django.utils import timezone\n from django.utils.encoding import force_bytes\n \n+# session_key should not be case sensitive because some backends can store it\n+# on case insensitive file systems.\n+VALID_KEY_CHARS = string.ascii_lowercase + string.digits\n+\n class CreateError(Exception):\n     \"\"\"\n     Used internally as a consistent exception type to catch from save (see the\n@@ -133,12 +137,8 @@ def clear(self):\n \n     def _get_new_session_key(self):\n         \"Returns session key that isn't being used.\"\n-        # Todo: move to 0-9a-z charset in 1.5\n-        hex_chars = '1234567890abcdef'\n-        # session_key should not be case sensitive because some backends\n-        # can store it on case insensitive file systems.\n         while True:\n-            session_key = get_random_string(32, hex_chars)\n+            session_key = get_random_string(32, VALID_KEY_CHARS)\n             if not self.exists(session_key):\n                 break\n         return session_key\n@@ -170,24 +170,52 @@ def _get_session(self, no_load=False):\n \n     _session = property(_get_session)\n \n-    def get_expiry_age(self):\n-        \"\"\"Get the number of seconds until the session expires.\"\"\"\n-        expiry = self.get('_session_expiry')\n+    def get_expiry_age(self, **kwargs):\n+        \"\"\"Get the number of seconds until the session expires.\n+\n+        Optionally, this function accepts `modification` and `expiry` keyword\n+        arguments specifying the modification and expiry of the session.\n+        \"\"\"\n+        try:\n+            modification = kwargs['modification']\n+        except KeyError:\n+            modification = timezone.now()\n+        # Make the difference between \"expiry=None passed in kwargs\" and\n+        # \"expiry not passed in kwargs\", in order to guarantee not to trigger\n+        # self.load() when expiry is provided.\n+        try:\n+            expiry = kwargs['expiry']\n+        except KeyError:\n+            expiry = self.get('_session_expiry')\n+\n         if not expiry:   # Checks both None and 0 cases\n             return settings.SESSION_COOKIE_AGE\n         if not isinstance(expiry, datetime):\n             return expiry\n-        delta = expiry - timezone.now()\n+        delta = expiry - modification\n         return delta.days * 86400 + delta.seconds\n \n-    def get_expiry_date(self):\n-        \"\"\"Get session the expiry date (as a datetime object).\"\"\"\n-        expiry = self.get('_session_expiry')\n+    def get_expiry_date(self, **kwargs):\n+        \"\"\"Get session the expiry date (as a datetime object).\n+\n+        Optionally, this function accepts `modification` and `expiry` keyword\n+        arguments specifying the modification and expiry of the session.\n+        \"\"\"\n+        try:\n+            modification = kwargs['modification']\n+        except KeyError:\n+            modification = timezone.now()\n+        # Same comment as in get_expiry_age\n+        try:\n+            expiry = kwargs['expiry']\n+        except KeyError:\n+            expiry = self.get('_session_expiry')\n+\n         if isinstance(expiry, datetime):\n             return expiry\n         if not expiry:   # Checks both None and 0 cases\n             expiry = settings.SESSION_COOKIE_AGE\n-        return timezone.now() + timedelta(seconds=expiry)\n+        return modification + timedelta(seconds=expiry)\n \n     def set_expiry(self, value):\n         \"\"\"\n@@ -281,3 +309,14 @@ def load(self):\n         Loads the session data and returns a dictionary.\n         \"\"\"\n         raise NotImplementedError\n+\n+    @classmethod\n+    def clear_expired(cls):\n+        \"\"\"\n+        Remove expired sessions from the session store.\n+\n+        If this operation isn't possible on a given backend, it should raise\n+        NotImplementedError. If it isn't necessary, because the backend has\n+        a built-in expiration mechanism, it should be a no-op.\n+        \"\"\"\n+        raise NotImplementedError"
        },
        {
            "sha": "596042fcb3220dd196e5a1e06e249f68d2db0708",
            "filename": "django/contrib/sessions/backends/cache.py",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,5 +1,6 @@\n+from django.conf import settings\n from django.contrib.sessions.backends.base import SessionBase, CreateError\n-from django.core.cache import cache\n+from django.core.cache import get_cache\n from django.utils.six.moves import xrange\n \n KEY_PREFIX = \"django.contrib.sessions.cache\"\n@@ -10,7 +11,7 @@ class SessionStore(SessionBase):\n     A cache-based session store.\n     \"\"\"\n     def __init__(self, session_key=None):\n-        self._cache = cache\n+        self._cache = get_cache(settings.SESSION_CACHE_ALIAS)\n         super(SessionStore, self).__init__(session_key)\n \n     @property\n@@ -43,7 +44,9 @@ def create(self):\n                 continue\n             self.modified = True\n             return\n-        raise RuntimeError(\"Unable to create a new session key.\")\n+        raise RuntimeError(\n+            \"Unable to create a new session key. \"\n+            \"It is likely that the cache is unavailable.\")\n \n     def save(self, must_create=False):\n         if must_create:\n@@ -65,3 +68,7 @@ def delete(self, session_key=None):\n                 return\n             session_key = self.session_key\n         self._cache.delete(KEY_PREFIX + session_key)\n+\n+    @classmethod\n+    def clear_expired(cls):\n+        pass"
        },
        {
            "sha": "31c6fbfce30770ea6e19f758cddd9c774829e80b",
            "filename": "django/contrib/sessions/backends/cached_db.py",
            "status": "modified",
            "additions": 21,
            "deletions": 4,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fcached_db.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fcached_db.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fcached_db.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -2,9 +2,10 @@\n Cached, database-backed sessions.\n \"\"\"\n \n-from django.conf import settings\n from django.contrib.sessions.backends.db import SessionStore as DBStore\n from django.core.cache import cache\n+from django.core.exceptions import SuspiciousOperation\n+from django.utils import timezone\n \n KEY_PREFIX = \"django.contrib.sessions.cached_db\"\n \n@@ -28,9 +29,21 @@ def load(self):\n             # Some backends (e.g. memcache) raise an exception on invalid\n             # cache keys. If this happens, reset the session. See #17810.\n             data = None\n+\n         if data is None:\n-            data = super(SessionStore, self).load()\n-            cache.set(self.cache_key, data, settings.SESSION_COOKIE_AGE)\n+            # Duplicate DBStore.load, because we need to keep track\n+            # of the expiry date to set it properly in the cache.\n+            try:\n+                s = Session.objects.get(\n+                    session_key=self.session_key,\n+                    expire_date__gt=timezone.now()\n+                )\n+                data = self.decode(s.session_data)\n+                cache.set(self.cache_key, data,\n+                    self.get_expiry_age(expiry=s.expire_date))\n+            except (Session.DoesNotExist, SuspiciousOperation):\n+                self.create()\n+                data = {}\n         return data\n \n     def exists(self, session_key):\n@@ -40,7 +53,7 @@ def exists(self, session_key):\n \n     def save(self, must_create=False):\n         super(SessionStore, self).save(must_create)\n-        cache.set(self.cache_key, self._session, settings.SESSION_COOKIE_AGE)\n+        cache.set(self.cache_key, self._session, self.get_expiry_age())\n \n     def delete(self, session_key=None):\n         super(SessionStore, self).delete(session_key)\n@@ -58,3 +71,7 @@ def flush(self):\n         self.clear()\n         self.delete(self.session_key)\n         self.create()\n+\n+\n+# At bottom to avoid circular import\n+from django.contrib.sessions.models import Session"
        },
        {
            "sha": "47e89b66e55c6c0ee3803fb65f266d965346f746",
            "filename": "django/contrib/sessions/backends/db.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,7 +14,7 @@ def __init__(self, session_key=None):\n     def load(self):\n         try:\n             s = Session.objects.get(\n-                session_key = self.session_key,\n+                session_key=self.session_key,\n                 expire_date__gt=timezone.now()\n             )\n             return self.decode(s.session_data)\n@@ -71,6 +71,11 @@ def delete(self, session_key=None):\n         except Session.DoesNotExist:\n             pass\n \n+    @classmethod\n+    def clear_expired(cls):\n+        Session.objects.filter(expire_date__lt=timezone.now()).delete()\n+        transaction.commit_unless_managed()\n+\n \n # At bottom to avoid circular import\n from django.contrib.sessions.models import Session"
        },
        {
            "sha": "7d933c678a191d2973e811bf038bbe4daa342e56",
            "filename": "django/contrib/sessions/backends/file.py",
            "status": "modified",
            "additions": 60,
            "deletions": 15,
            "changes": 75,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,32 +1,40 @@\n+import datetime\n import errno\n import os\n import tempfile\n \n from django.conf import settings\n-from django.contrib.sessions.backends.base import SessionBase, CreateError\n+from django.contrib.sessions.backends.base import SessionBase, CreateError, VALID_KEY_CHARS\n from django.core.exceptions import SuspiciousOperation, ImproperlyConfigured\n-\n+from django.utils import timezone\n \n class SessionStore(SessionBase):\n     \"\"\"\n     Implements a file based session store.\n     \"\"\"\n     def __init__(self, session_key=None):\n-        self.storage_path = getattr(settings, \"SESSION_FILE_PATH\", None)\n-        if not self.storage_path:\n-            self.storage_path = tempfile.gettempdir()\n-\n-        # Make sure the storage path is valid.\n-        if not os.path.isdir(self.storage_path):\n-            raise ImproperlyConfigured(\n-                \"The session storage path %r doesn't exist. Please set your\"\n-                \" SESSION_FILE_PATH setting to an existing directory in which\"\n-                \" Django can store session data.\" % self.storage_path)\n-\n+        self.storage_path = type(self)._get_storage_path()\n         self.file_prefix = settings.SESSION_COOKIE_NAME\n         super(SessionStore, self).__init__(session_key)\n \n-    VALID_KEY_CHARS = set(\"abcdef0123456789\")\n+    @classmethod\n+    def _get_storage_path(cls):\n+        try:\n+            return cls._storage_path\n+        except AttributeError:\n+            storage_path = getattr(settings, \"SESSION_FILE_PATH\", None)\n+            if not storage_path:\n+                storage_path = tempfile.gettempdir()\n+\n+            # Make sure the storage path is valid.\n+            if not os.path.isdir(storage_path):\n+                raise ImproperlyConfigured(\n+                    \"The session storage path %r doesn't exist. Please set your\"\n+                    \" SESSION_FILE_PATH setting to an existing directory in which\"\n+                    \" Django can store session data.\" % storage_path)\n+\n+            cls._storage_path = storage_path\n+            return storage_path\n \n     def _key_to_file(self, session_key=None):\n         \"\"\"\n@@ -38,12 +46,24 @@ def _key_to_file(self, session_key=None):\n         # Make sure we're not vulnerable to directory traversal. Session keys\n         # should always be md5s, so they should never contain directory\n         # components.\n-        if not set(session_key).issubset(self.VALID_KEY_CHARS):\n+        if not set(session_key).issubset(set(VALID_KEY_CHARS)):\n             raise SuspiciousOperation(\n                 \"Invalid characters in session key\")\n \n         return os.path.join(self.storage_path, self.file_prefix + session_key)\n \n+    def _last_modification(self):\n+        \"\"\"\n+        Return the modification time of the file storing the session's content.\n+        \"\"\"\n+        modification = os.stat(self._key_to_file()).st_mtime\n+        if settings.USE_TZ:\n+            modification = datetime.datetime.utcfromtimestamp(modification)\n+            modification = modification.replace(tzinfo=timezone.utc)\n+        else:\n+            modification = datetime.datetime.fromtimestamp(modification)\n+        return modification\n+\n     def load(self):\n         session_data = {}\n         try:\n@@ -56,6 +76,15 @@ def load(self):\n                     session_data = self.decode(file_data)\n                 except (EOFError, SuspiciousOperation):\n                     self.create()\n+\n+                # Remove expired sessions.\n+                expiry_age = self.get_expiry_age(\n+                    modification=self._last_modification(),\n+                    expiry=session_data.get('_session_expiry'))\n+                if expiry_age < 0:\n+                    session_data = {}\n+                    self.delete()\n+                    self.create()\n         except IOError:\n             self.create()\n         return session_data\n@@ -142,3 +171,19 @@ def delete(self, session_key=None):\n \n     def clean(self):\n         pass\n+\n+    @classmethod\n+    def clear_expired(cls):\n+        storage_path = cls._get_storage_path()\n+        file_prefix = settings.SESSION_COOKIE_NAME\n+\n+        for session_file in os.listdir(storage_path):\n+            if not session_file.startswith(file_prefix):\n+                continue\n+            session_key = session_file[len(file_prefix):]\n+            session = cls(session_key)\n+            # When an expired session is loaded, its file is removed, and a\n+            # new file is immediately created. Prevent this by disabling\n+            # the create() method.\n+            session.create = lambda: None\n+            session.load()"
        },
        {
            "sha": "c2b7a3123f5c77c4678445e9a8a838a18af6c74f",
            "filename": "django/contrib/sessions/backends/signed_cookies.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fsigned_cookies.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fbackends%2Fsigned_cookies.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fsigned_cookies.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -32,6 +32,7 @@ def load(self):\n         try:\n             return signing.loads(self.session_key,\n                 serializer=PickleSerializer,\n+                # This doesn't handle non-default expiry dates, see #19201\n                 max_age=settings.SESSION_COOKIE_AGE,\n                 salt='django.contrib.sessions.backends.signed_cookies')\n         except (signing.BadSignature, ValueError):\n@@ -91,3 +92,7 @@ def _get_session_key(self):\n         return signing.dumps(session_cache, compress=True,\n             salt='django.contrib.sessions.backends.signed_cookies',\n             serializer=PickleSerializer)\n+\n+    @classmethod\n+    def clear_expired(cls):\n+        pass"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/sessions/management/__init__.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmanagement%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "previous_filename": "tests/modeltests/pagination/__init__.py"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/sessions/management/commands/__init__.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "previous_filename": "tests/regressiontests/pagination_regress/__init__.py"
        },
        {
            "sha": "8eb23dfee017fb39833f98236906c77653a4798c",
            "filename": "django/contrib/sessions/management/commands/clearsessions.py",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2Fclearsessions.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2Fclearsessions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2Fclearsessions.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,15 @@\n+from django.conf import settings\n+from django.core.management.base import NoArgsCommand\n+from django.utils.importlib import import_module\n+\n+\n+class Command(NoArgsCommand):\n+    help = \"Can be run as a cronjob or directly to clean out expired sessions (only with the database backend at the moment).\"\n+\n+    def handle_noargs(self, **options):\n+        engine = import_module(settings.SESSION_ENGINE)\n+        try:\n+            engine.SessionStore.clear_expired()\n+        except NotImplementedError:\n+            self.stderr.write(\"Session engine '%s' doesn't support clearing \"\n+                              \"expired sessions.\\n\" % settings.SESSION_ENGINE)"
        },
        {
            "sha": "da79ac9de6077633a8626fd39b373eb25c4759eb",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 137,
            "deletions": 24,
            "changes": 161,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,4 +1,5 @@\n from datetime import timedelta\n+import os\n import shutil\n import string\n import tempfile\n@@ -12,7 +13,8 @@\n from django.contrib.sessions.backends.signed_cookies import SessionStore as CookieSession\n from django.contrib.sessions.models import Session\n from django.contrib.sessions.middleware import SessionMiddleware\n-from django.core.cache import DEFAULT_CACHE_ALIAS\n+from django.core.cache import get_cache\n+from django.core import management\n from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.http import HttpResponse\n from django.test import TestCase, RequestFactory\n@@ -83,7 +85,7 @@ def test_has_key(self):\n         self.session['some key'] = 1\n         self.session.modified = False\n         self.session.accessed = False\n-        self.assertTrue('some key' in self.session)\n+        self.assertIn('some key', self.session)\n         self.assertTrue(self.session.accessed)\n         self.assertFalse(self.session.modified)\n \n@@ -134,8 +136,8 @@ def test_clear(self):\n         self.assertTrue(self.session.modified)\n \n     def test_save(self):\n-        if (hasattr(self.session, '_cache') and\n-                'DummyCache' in settings.CACHES[DEFAULT_CACHE_ALIAS]['BACKEND']):\n+        if (hasattr(self.session, '_cache') and'DummyCache' in\n+            settings.CACHES[settings.SESSION_CACHE_ALIAS]['BACKEND']):\n             raise unittest.SkipTest(\"Session saving tests require a real cache backend\")\n         self.session.save()\n         self.assertTrue(self.session.exists(self.session.session_key))\n@@ -197,31 +199,43 @@ def test_default_expiry(self):\n         self.assertEqual(self.session.get_expiry_age(), settings.SESSION_COOKIE_AGE)\n \n     def test_custom_expiry_seconds(self):\n-        # Using seconds\n+        modification = timezone.now()\n+\n         self.session.set_expiry(10)\n-        delta = self.session.get_expiry_date() - timezone.now()\n-        self.assertTrue(delta.seconds in (9, 10))\n \n-        age = self.session.get_expiry_age()\n-        self.assertTrue(age in (9, 10))\n+        date = self.session.get_expiry_date(modification=modification)\n+        self.assertEqual(date, modification + timedelta(seconds=10))\n+\n+        age = self.session.get_expiry_age(modification=modification)\n+        self.assertEqual(age, 10)\n \n     def test_custom_expiry_timedelta(self):\n-        # Using timedelta\n-        self.session.set_expiry(timedelta(seconds=10))\n-        delta = self.session.get_expiry_date() - timezone.now()\n-        self.assertTrue(delta.seconds in (9, 10))\n+        modification = timezone.now()\n+\n+        # Mock timezone.now, because set_expiry calls it on this code path.\n+        original_now = timezone.now\n+        try:\n+            timezone.now = lambda: modification\n+            self.session.set_expiry(timedelta(seconds=10))\n+        finally:\n+            timezone.now = original_now\n \n-        age = self.session.get_expiry_age()\n-        self.assertTrue(age in (9, 10))\n+        date = self.session.get_expiry_date(modification=modification)\n+        self.assertEqual(date, modification + timedelta(seconds=10))\n+\n+        age = self.session.get_expiry_age(modification=modification)\n+        self.assertEqual(age, 10)\n \n     def test_custom_expiry_datetime(self):\n-        # Using fixed datetime\n-        self.session.set_expiry(timezone.now() + timedelta(seconds=10))\n-        delta = self.session.get_expiry_date() - timezone.now()\n-        self.assertTrue(delta.seconds in (9, 10))\n+        modification = timezone.now()\n+\n+        self.session.set_expiry(modification + timedelta(seconds=10))\n+\n+        date = self.session.get_expiry_date(modification=modification)\n+        self.assertEqual(date, modification + timedelta(seconds=10))\n \n-        age = self.session.get_expiry_age()\n-        self.assertTrue(age in (9, 10))\n+        age = self.session.get_expiry_age(modification=modification)\n+        self.assertEqual(age, 10)\n \n     def test_custom_expiry_reset(self):\n         self.session.set_expiry(None)\n@@ -258,6 +272,23 @@ def test_decode(self):\n         encoded = self.session.encode(data)\n         self.assertEqual(self.session.decode(encoded), data)\n \n+    def test_actual_expiry(self):\n+        # Regression test for #19200\n+        old_session_key = None\n+        new_session_key = None\n+        try:\n+            self.session['foo'] = 'bar'\n+            self.session.set_expiry(-timedelta(seconds=10))\n+            self.session.save()\n+            old_session_key = self.session.session_key\n+            # With an expiry date in the past, the session expires instantly.\n+            new_session = self.backend(self.session.session_key)\n+            new_session_key = new_session.session_key\n+            self.assertNotIn('foo', new_session)\n+        finally:\n+            self.session.delete(old_session_key)\n+            self.session.delete(new_session_key)\n+\n \n class DatabaseSessionTests(SessionTestsMixin, TestCase):\n \n@@ -290,6 +321,30 @@ def test_sessionmanager_save(self):\n         del self.session._session_cache\n         self.assertEqual(self.session['y'], 2)\n \n+    @override_settings(SESSION_ENGINE=\"django.contrib.sessions.backends.db\")\n+    def test_clearsessions_command(self):\n+        \"\"\"\n+        Test clearsessions command for clearing expired sessions.\n+        \"\"\"\n+        self.assertEqual(0, Session.objects.count())\n+\n+        # One object in the future\n+        self.session['foo'] = 'bar'\n+        self.session.set_expiry(3600)\n+        self.session.save()\n+\n+        # One object in the past\n+        other_session = self.backend()\n+        other_session['foo'] = 'bar'\n+        other_session.set_expiry(-3600)\n+        other_session.save()\n+\n+        # Two sessions are in the database before clearsessions...\n+        self.assertEqual(2, Session.objects.count())\n+        management.call_command('clearsessions')\n+        # ... and one is deleted.\n+        self.assertEqual(1, Session.objects.count())\n+\n \n @override_settings(USE_TZ=True)\n class DatabaseSessionWithTimeZoneTests(DatabaseSessionTests):\n@@ -300,7 +355,8 @@ class CacheDBSessionTests(SessionTestsMixin, TestCase):\n \n     backend = CacheDBSession\n \n-    @unittest.skipIf('DummyCache' in settings.CACHES[DEFAULT_CACHE_ALIAS]['BACKEND'],\n+    @unittest.skipIf('DummyCache' in\n+        settings.CACHES[settings.SESSION_CACHE_ALIAS]['BACKEND'],\n         \"Session saving tests require a real cache backend\")\n     def test_exists_searches_cache_first(self):\n         self.session.save()\n@@ -326,19 +382,23 @@ class FileSessionTests(SessionTestsMixin, unittest.TestCase):\n     backend = FileSession\n \n     def setUp(self):\n-        super(FileSessionTests, self).setUp()\n         # Do file session tests in an isolated directory, and kill it after we're done.\n         self.original_session_file_path = settings.SESSION_FILE_PATH\n         self.temp_session_store = settings.SESSION_FILE_PATH = tempfile.mkdtemp()\n+        # Reset the file session backend's internal caches\n+        if hasattr(self.backend, '_storage_path'):\n+            del self.backend._storage_path\n+        super(FileSessionTests, self).setUp()\n \n     def tearDown(self):\n+        super(FileSessionTests, self).tearDown()\n         settings.SESSION_FILE_PATH = self.original_session_file_path\n         shutil.rmtree(self.temp_session_store)\n-        super(FileSessionTests, self).tearDown()\n \n     @override_settings(\n         SESSION_FILE_PATH=\"/if/this/directory/exists/you/have/a/weird/computer\")\n     def test_configuration_check(self):\n+        del self.backend._storage_path\n         # Make sure the file backend checks for a good storage dir\n         self.assertRaises(ImproperlyConfigured, self.backend)\n \n@@ -352,6 +412,37 @@ def test_invalid_key_forwardslash(self):\n         self.assertRaises(SuspiciousOperation,\n                           self.backend(\"a/b/c\").load)\n \n+    @override_settings(SESSION_ENGINE=\"django.contrib.sessions.backends.file\")\n+    def test_clearsessions_command(self):\n+        \"\"\"\n+        Test clearsessions command for clearing expired sessions.\n+        \"\"\"\n+        storage_path = self.backend._get_storage_path()\n+        file_prefix = settings.SESSION_COOKIE_NAME\n+\n+        def count_sessions():\n+            return len([session_file for session_file in os.listdir(storage_path)\n+                                     if session_file.startswith(file_prefix)])\n+\n+        self.assertEqual(0, count_sessions())\n+\n+        # One object in the future\n+        self.session['foo'] = 'bar'\n+        self.session.set_expiry(3600)\n+        self.session.save()\n+\n+        # One object in the past\n+        other_session = self.backend()\n+        other_session['foo'] = 'bar'\n+        other_session.set_expiry(-3600)\n+        other_session.save()\n+\n+        # Two sessions are in the filesystem before clearsessions...\n+        self.assertEqual(2, count_sessions())\n+        management.call_command('clearsessions')\n+        # ... and one is deleted.\n+        self.assertEqual(1, count_sessions())\n+\n \n class CacheSessionTests(SessionTestsMixin, unittest.TestCase):\n \n@@ -364,6 +455,23 @@ def test_load_overlong_key(self):\n             self.session._session_key = (string.ascii_letters + string.digits) * 20\n             self.assertEqual(self.session.load(), {})\n \n+    def test_default_cache(self):\n+        self.session.save()\n+        self.assertNotEqual(get_cache('default').get(self.session.cache_key), None)\n+\n+    @override_settings(CACHES={\n+        'default': {\n+            'BACKEND': 'django.core.cache.backends.dummy.DummyCache',\n+        },\n+        'sessions': {\n+            'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',\n+        },\n+    }, SESSION_CACHE_ALIAS='sessions')\n+    def test_non_default_cache(self):\n+        self.session.save()\n+        self.assertEqual(get_cache('default').get(self.session.cache_key), None)\n+        self.assertNotEqual(get_cache('sessions').get(self.session.cache_key), None)\n+\n \n class SessionMiddlewareTests(unittest.TestCase):\n \n@@ -452,3 +560,8 @@ def test_cycle(self):\n         testing for this behavior is meaningless.\n         \"\"\"\n         pass\n+\n+    @unittest.expectedFailure\n+    def test_actual_expiry(self):\n+        # The cookie backend doesn't handle non-default expiry dates, see #19201\n+        super(CookieSessionTests, self).test_actual_expiry()"
        },
        {
            "sha": "4a1cf66b17137fb70cd2b0746a4d5237d2066dc9",
            "filename": "django/contrib/sitemaps/tests/http.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -11,6 +11,7 @@\n from django.test.utils import override_settings\n from django.utils.unittest import skipUnless\n from django.utils.formats import localize\n+from django.utils._os import upath\n from django.utils.translation import activate, deactivate\n \n from .base import SitemapTestsBase\n@@ -29,7 +30,7 @@ def test_simple_sitemap_index(self):\n         self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @override_settings(\n-        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'templates'),)\n     )\n     def test_simple_sitemap_custom_index(self):\n         \"A simple sitemap index can be rendered with a custom template\"\n@@ -64,7 +65,7 @@ def test_simple_sitemap(self):\n         self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @override_settings(\n-        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'templates'),)\n     )\n     def test_simple_custom_sitemap(self):\n         \"A simple sitemap can be rendered with a custom template\""
        },
        {
            "sha": "7e87a89f5b9d2cb635e67659f9475032bbd4b7bc",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -19,6 +19,7 @@\n from django.utils.encoding import force_bytes, force_text\n from django.utils.functional import LazyObject\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n \n from django.contrib.staticfiles.utils import check_settings, matches_patterns\n \n@@ -296,7 +297,7 @@ def __init__(self, app, *args, **kwargs):\n         \"\"\"\n         # app is the actual app module\n         mod = import_module(app)\n-        mod_path = os.path.dirname(mod.__file__)\n+        mod_path = os.path.dirname(upath(mod.__file__))\n         location = os.path.join(mod_path, self.source_dir)\n         super(AppStaticStorage, self).__init__(location, *args, **kwargs)\n "
        },
        {
            "sha": "562bcc21bb1e09527b8e465c91e7b827aa6f07f7",
            "filename": "django/core/cache/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -93,8 +93,6 @@ def parse_backend_conf(backend, **kwargs):\n             raise InvalidCacheBackendError(\"Could not find backend '%s'\" % backend)\n         location = kwargs.pop('LOCATION', '')\n         return backend, location, kwargs\n-    raise InvalidCacheBackendError(\n-        \"Couldn't find a cache backend named '%s'\" % backend)\n \n def get_cache(backend, **kwargs):\n     \"\"\"\n@@ -136,11 +134,9 @@ def get_cache(backend, **kwargs):\n             \"Could not find backend '%s': %s\" % (backend, e))\n     cache = backend_cls(location, params)\n     # Some caches -- python-memcached in particular -- need to do a cleanup at the\n-    # end of a request cycle. If the cache provides a close() method, wire it up\n-    # here.\n-    if hasattr(cache, 'close'):\n-        signals.request_finished.connect(cache.close)\n+    # end of a request cycle. If not implemented in a particular backend\n+    # cache.close is a no-op\n+    signals.request_finished.connect(cache.close)\n     return cache\n \n cache = get_cache(DEFAULT_CACHE_ALIAS)\n-"
        },
        {
            "sha": "7234d3c4db8148e03375d4b89c22a3a5bf696560",
            "filename": "django/core/cache/backends/base.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,15 +6,19 @@\n from django.core.exceptions import ImproperlyConfigured, DjangoRuntimeWarning\n from django.utils.importlib import import_module\n \n+\n class InvalidCacheBackendError(ImproperlyConfigured):\n     pass\n \n+\n class CacheKeyWarning(DjangoRuntimeWarning):\n     pass\n \n+\n # Memcached does not accept keys longer than this.\n MEMCACHE_MAX_KEY_LENGTH = 250\n \n+\n def default_key_func(key, key_prefix, version):\n     \"\"\"\n     Default function to generate keys.\n@@ -23,7 +27,8 @@ def default_key_func(key, key_prefix, version):\n     the `key_prefix'. KEY_FUNCTION can be used to specify an alternate\n     function with custom key making behavior.\n     \"\"\"\n-    return ':'.join([key_prefix, str(version), key])\n+    return '%s:%s:%s' % (key_prefix, version, key)\n+\n \n def get_key_func(key_func):\n     \"\"\"\n@@ -40,6 +45,7 @@ def get_key_func(key_func):\n             return getattr(key_func_module, key_func_name)\n     return default_key_func\n \n+\n class BaseCache(object):\n     def __init__(self, params):\n         timeout = params.get('timeout', params.get('TIMEOUT', 300))\n@@ -221,3 +227,7 @@ def decr_version(self, key, delta=1, version=None):\n         the new version.\n         \"\"\"\n         return self.incr_version(key, -delta, version)\n+\n+    def close(self, **kwargs):\n+        \"\"\"Close the cache connection\"\"\"\n+        pass"
        },
        {
            "sha": "c93bc90b18c339b8820f0950bba75e46f5688e01",
            "filename": "django/core/cache/backends/db.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fdb.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -11,7 +11,7 @@\n from django.conf import settings\n from django.core.cache.backends.base import BaseCache\n from django.db import connections, router, transaction, DatabaseError\n-from django.utils import timezone\n+from django.utils import timezone, six\n from django.utils.encoding import force_bytes\n \n \n@@ -104,7 +104,11 @@ def _base_set(self, mode, key, value, timeout=None):\n         if num > self._max_entries:\n             self._cull(db, cursor, now)\n         pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)\n-        encoded = base64.b64encode(pickled).strip()\n+        b64encoded = base64.b64encode(pickled)\n+        # The DB column is expecting a string, so make sure the value is a\n+        # string, not bytes. Refs #19274.\n+        if six.PY3:\n+            b64encoded = b64encoded.decode('latin1')\n         cursor.execute(\"SELECT cache_key, expires FROM %s \"\n                        \"WHERE cache_key = %%s\" % table, [key])\n         try:\n@@ -113,11 +117,11 @@ def _base_set(self, mode, key, value, timeout=None):\n                     (mode == 'add' and result[1] < now)):\n                 cursor.execute(\"UPDATE %s SET value = %%s, expires = %%s \"\n                                \"WHERE cache_key = %%s\" % table,\n-                               [encoded, connections[db].ops.value_to_db_datetime(exp), key])\n+                               [b64encoded, connections[db].ops.value_to_db_datetime(exp), key])\n             else:\n                 cursor.execute(\"INSERT INTO %s (cache_key, value, expires) \"\n                                \"VALUES (%%s, %%s, %%s)\" % table,\n-                               [key, encoded, connections[db].ops.value_to_db_datetime(exp)])\n+                               [key, b64encoded, connections[db].ops.value_to_db_datetime(exp)])\n         except DatabaseError:\n             # To be threadsafe, updates/inserts are allowed to fail silently\n             transaction.rollback_unless_managed(using=db)"
        },
        {
            "sha": "2c3f1988472e7ddb620f7be0adc89b3541693a48",
            "filename": "django/core/cache/backends/memcached.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -90,6 +90,9 @@ def close(self, **kwargs):\n \n     def incr(self, key, delta=1, version=None):\n         key = self.make_key(key, version=version)\n+        # memcached doesn't support a negative delta\n+        if delta < 0:\n+            return self._cache.decr(key, -delta)\n         try:\n             val = self._cache.incr(key, delta)\n \n@@ -105,6 +108,9 @@ def incr(self, key, delta=1, version=None):\n \n     def decr(self, key, delta=1, version=None):\n         key = self.make_key(key, version=version)\n+        # memcached doesn't support a negative delta\n+        if delta < 0:\n+            return self._cache.incr(key, -delta)\n         try:\n             val = self._cache.decr(key, delta)\n "
        },
        {
            "sha": "2d1010001933b68cdeea90cdc19376d037cb6301",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,7 +6,7 @@\n from django.utils.encoding import smart_text\n from django.core.files.utils import FileProxyMixin\n from django.utils import six\n-from django.utils.encoding import python_2_unicode_compatible\n+from django.utils.encoding import force_bytes, python_2_unicode_compatible\n \n @python_2_unicode_compatible\n class File(FileProxyMixin):\n@@ -28,7 +28,9 @@ def __repr__(self):\n \n     def __bool__(self):\n         return bool(self.name)\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     def __len__(self):\n         return self.size\n@@ -132,8 +134,11 @@ class ContentFile(File):\n     A File-like object that takes just raw content, rather than an actual file.\n     \"\"\"\n     def __init__(self, content, name=None):\n-        content = content or b''\n-        stream_class = StringIO if isinstance(content, six.text_type) else BytesIO\n+        if six.PY3:\n+            stream_class = StringIO if isinstance(content, six.text_type) else BytesIO\n+        else:\n+            stream_class = BytesIO\n+            content = force_bytes(content)\n         super(ContentFile, self).__init__(stream_class(content), name=name)\n         self.size = len(content)\n \n@@ -142,7 +147,9 @@ def __str__(self):\n \n     def __bool__(self):\n         return True\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     def open(self, mode=None):\n         self.seek(0)"
        },
        {
            "sha": "0caf6b29fa0912ad8aec9625ef1366ec547fe11b",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -134,7 +134,7 @@ def get_response(self, request):\n                     raise ValueError(\"The view %s.%s didn't return an HttpResponse object.\" % (callback.__module__, view_name))\n \n                 # If the response supports deferred rendering, apply template\n-                # response middleware and the render the response\n+                # response middleware and then render the response\n                 if hasattr(response, 'render') and callable(response.render):\n                     for middleware_method in self._template_response_middleware:\n                         response = middleware_method(request, response)"
        },
        {
            "sha": "4c0710549ac907b9269b9f1a39025875039231b6",
            "filename": "django/core/handlers/wsgi.py",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fwsgi.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import unicode_literals\n \n+import codecs\n import logging\n import sys\n from io import BytesIO\n@@ -144,6 +145,14 @@ def __init__(self, environ):\n         self.META['PATH_INFO'] = path_info\n         self.META['SCRIPT_NAME'] = script_name\n         self.method = environ['REQUEST_METHOD'].upper()\n+        _, content_params = self._parse_content_type(self.META.get('CONTENT_TYPE', ''))\n+        if 'charset' in content_params:\n+            try:\n+                codecs.lookup(content_params['charset'])\n+            except LookupError:\n+                pass\n+            else:\n+                self.encoding = content_params['charset']\n         self._post_parse_error = False\n         try:\n             content_length = int(self.environ.get('CONTENT_LENGTH'))\n@@ -155,6 +164,21 @@ def __init__(self, environ):\n     def _is_secure(self):\n         return 'wsgi.url_scheme' in self.environ and self.environ['wsgi.url_scheme'] == 'https'\n \n+    def _parse_content_type(self, ctype):\n+        \"\"\"\n+        Media Types parsing according to RFC 2616, section 3.7.\n+\n+        Returns the data type and parameters. For example:\n+        Input: \"text/plain; charset=iso-8859-1\"\n+        Output: ('text/plain', {'charset': 'iso-8859-1'})\n+        \"\"\"\n+        content_type, _, params = ctype.partition(';')\n+        content_params = {}\n+        for parameter in params.split(';'):\n+            k, _, v = parameter.strip().partition('=')\n+            content_params[k] = v\n+        return content_type, content_params\n+\n     def _get_request(self):\n         if not hasattr(self, '_request'):\n             self._request = datastructures.MergeDict(self.POST, self.GET)"
        },
        {
            "sha": "b6f7f560ed6273fbf867e9e939966a312f47c444",
            "filename": "django/core/mail/backends/smtp.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,6 +7,7 @@\n from django.core.mail.backends.base import BaseEmailBackend\n from django.core.mail.utils import DNS_NAME\n from django.core.mail.message import sanitize_address\n+from django.utils.encoding import force_bytes\n \n \n class EmailBackend(BaseEmailBackend):\n@@ -102,9 +103,11 @@ def _send(self, email_message):\n         from_email = sanitize_address(email_message.from_email, email_message.encoding)\n         recipients = [sanitize_address(addr, email_message.encoding)\n                       for addr in email_message.recipients()]\n+        message = email_message.message()\n+        charset = message.get_charset().get_output_charset() if message.get_charset() else 'utf-8'\n         try:\n             self.connection.sendmail(from_email, recipients,\n-                    email_message.message().as_string())\n+                    force_bytes(message.as_string(), charset))\n         except:\n             if not self.fail_silently:\n                 raise"
        },
        {
            "sha": "fab50593761e986ec3d2fa949f1d2cbfeaeac65c",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,6 +9,7 @@\n from django.core.management.base import BaseCommand, CommandError, handle_default_options\n from django.core.management.color import color_style\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n from django.utils import six\n \n # For backwards compatibility: get_version() used to be in this module.\n@@ -136,14 +137,15 @@ def call_command(name, *args, **options):\n     # Load the command object.\n     try:\n         app_name = get_commands()[name]\n-        if isinstance(app_name, BaseCommand):\n-            # If the command is already loaded, use it directly.\n-            klass = app_name\n-        else:\n-            klass = load_command_class(app_name, name)\n     except KeyError:\n         raise CommandError(\"Unknown command: %r\" % name)\n \n+    if isinstance(app_name, BaseCommand):\n+        # If the command is already loaded, use it directly.\n+        klass = app_name\n+    else:\n+        klass = load_command_class(app_name, name)\n+\n     # Grab out a list of defaults from the options. optparse does this for us\n     # when the script runs from the command line, but since call_command can\n     # be called programatically, we need to simulate the loading and handling\n@@ -409,10 +411,10 @@ def setup_environ(settings_mod, original_settings_path=None):\n     # Add this project to sys.path so that it's importable in the conventional\n     # way. For example, if this file (manage.py) lives in a directory\n     # \"myproject\", this code would add \"/path/to/myproject\" to sys.path.\n-    if '__init__.py' in settings_mod.__file__:\n-        p = os.path.dirname(settings_mod.__file__)\n+    if '__init__.py' in upath(settings_mod.__file__):\n+        p = os.path.dirname(upath(settings_mod.__file__))\n     else:\n-        p = settings_mod.__file__\n+        p = upath(settings_mod.__file__)\n     project_directory, settings_filename = os.path.split(p)\n     if project_directory == os.curdir or not project_directory:\n         project_directory = os.getcwd()"
        },
        {
            "sha": "f83c64be8f07930fe7c729f73c158a2ba1ce36b7",
            "filename": "django/core/management/commands/cleanup.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Fcleanup.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Fcleanup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcleanup.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,11 +1,11 @@\n-from django.core.management.base import NoArgsCommand\n-from django.utils import timezone\n+import warnings\n \n-class Command(NoArgsCommand):\n-    help = \"Can be run as a cronjob or directly to clean out old data from the database (only expired sessions at the moment).\"\n+from django.contrib.sessions.management.commands import clearsessions\n \n+\n+class Command(clearsessions.Command):\n     def handle_noargs(self, **options):\n-        from django.db import transaction\n-        from django.contrib.sessions.models import Session\n-        Session.objects.filter(expire_date__lt=timezone.now()).delete()\n-        transaction.commit_unless_managed()\n+        warnings.warn(\n+            \"The `cleanup` command has been deprecated in favor of `clearsessions`.\",\n+            PendingDeprecationWarning)\n+        super(Command, self).handle_noargs(**options)"
        },
        {
            "sha": "e1d8a33332b37ca9e4ca161480b0669efd7297bf",
            "filename": "django/core/management/commands/compilemessages.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,6 +5,7 @@\n import sys\n from optparse import make_option\n from django.core.management.base import BaseCommand, CommandError\n+from django.utils._os import npath\n \n def has_bom(fn):\n     with open(fn, 'rb') as f:\n@@ -41,8 +42,8 @@ def compile_messages(stderr, locale=None):\n                     # command, so that we can take advantage of shell quoting, to\n                     # quote any malicious characters/escaping.\n                     # See http://cyberelk.net/tim/articles/cmdline/ar01s02.html\n-                    os.environ['djangocompilemo'] = pf + '.mo'\n-                    os.environ['djangocompilepo'] = pf + '.po'\n+                    os.environ['djangocompilemo'] = npath(pf + '.mo')\n+                    os.environ['djangocompilepo'] = npath(pf + '.po')\n                     if sys.platform == 'win32': # Different shell-variable syntax\n                         cmd = 'msgfmt --check-format -o \"%djangocompilemo%\" \"%djangocompilepo%\"'\n                     else:"
        },
        {
            "sha": "ed47b8fbf11b10eb6e25d4d6487c787c4db10b52",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 143,
            "deletions": 135,
            "changes": 278,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,11 +1,9 @@\n from __future__ import unicode_literals\n \n-import sys\n import os\n import gzip\n import zipfile\n from optparse import make_option\n-import traceback\n \n from django.conf import settings\n from django.core import serializers\n@@ -15,6 +13,7 @@\n       IntegrityError, DatabaseError)\n from django.db.models import get_apps\n from django.utils.encoding import force_text\n+from django.utils._os import upath\n from itertools import product\n \n try:\n@@ -39,19 +38,18 @@ class Command(BaseCommand):\n \n     def handle(self, *fixture_labels, **options):\n \n-        ignore = options.get('ignore')\n-        using = options.get('database')\n+        self.ignore = options.get('ignore')\n+        self.using = options.get('database')\n \n-        connection = connections[using]\n+        connection = connections[self.using]\n \n         if not len(fixture_labels):\n             raise CommandError(\n                 \"No database fixture specified. Please provide the path of at \"\n                 \"least one fixture in the command line.\"\n             )\n \n-        verbosity = int(options.get('verbosity'))\n-        show_traceback = options.get('traceback')\n+        self.verbosity = int(options.get('verbosity'))\n \n         # commit is a stealth option - it isn't really useful as\n         # a command line option, but it can be useful when invoking\n@@ -62,12 +60,10 @@ def handle(self, *fixture_labels, **options):\n         commit = options.get('commit', True)\n \n         # Keep a count of the installed objects and fixtures\n-        fixture_count = 0\n-        loaded_object_count = 0\n-        fixture_object_count = 0\n-        models = set()\n-\n-        humanize = lambda dirname: \"'%s'\" % dirname if dirname else 'absolute path'\n+        self.fixture_count = 0\n+        self.loaded_object_count = 0\n+        self.fixture_object_count = 0\n+        self.models = set()\n \n         # Get a cursor (even though we don't need one yet). This has\n         # the side effect of initializing the test database (if\n@@ -77,9 +73,9 @@ def handle(self, *fixture_labels, **options):\n         # Start transaction management. All fixtures are installed in a\n         # single transaction to ensure that all references are resolved.\n         if commit:\n-            transaction.commit_unless_managed(using=using)\n-            transaction.enter_transaction_management(using=using)\n-            transaction.managed(True, using=using)\n+            transaction.commit_unless_managed(using=self.using)\n+            transaction.enter_transaction_management(using=self.using)\n+            transaction.managed(True, using=self.using)\n \n         class SingleZipReader(zipfile.ZipFile):\n             def __init__(self, *args, **kwargs):\n@@ -89,136 +85,34 @@ def __init__(self, *args, **kwargs):\n             def read(self):\n                 return zipfile.ZipFile.read(self, self.namelist()[0])\n \n-        compression_types = {\n+        self.compression_types = {\n             None:   open,\n             'gz':   gzip.GzipFile,\n             'zip':  SingleZipReader\n         }\n         if has_bz2:\n-            compression_types['bz2'] = bz2.BZ2File\n+            self.compression_types['bz2'] = bz2.BZ2File\n \n         app_module_paths = []\n         for app in get_apps():\n             if hasattr(app, '__path__'):\n                 # It's a 'models/' subpackage\n                 for path in app.__path__:\n-                    app_module_paths.append(path)\n+                    app_module_paths.append(upath(path))\n             else:\n                 # It's a models.py module\n-                app_module_paths.append(app.__file__)\n+                app_module_paths.append(upath(app.__file__))\n \n         app_fixtures = [os.path.join(os.path.dirname(path), 'fixtures') for path in app_module_paths]\n \n         try:\n             with connection.constraint_checks_disabled():\n                 for fixture_label in fixture_labels:\n-                    parts = fixture_label.split('.')\n-\n-                    if len(parts) > 1 and parts[-1] in compression_types:\n-                        compression_formats = [parts[-1]]\n-                        parts = parts[:-1]\n-                    else:\n-                        compression_formats = compression_types.keys()\n-\n-                    if len(parts) == 1:\n-                        fixture_name = parts[0]\n-                        formats = serializers.get_public_serializer_formats()\n-                    else:\n-                        fixture_name, format = '.'.join(parts[:-1]), parts[-1]\n-                        if format in serializers.get_public_serializer_formats():\n-                            formats = [format]\n-                        else:\n-                            formats = []\n-\n-                    if formats:\n-                        if verbosity >= 2:\n-                            self.stdout.write(\"Loading '%s' fixtures...\" % fixture_name)\n-                    else:\n-                        raise CommandError(\n-                            \"Problem installing fixture '%s': %s is not a known serialization format.\" %\n-                                (fixture_name, format))\n-\n-                    if os.path.isabs(fixture_name):\n-                        fixture_dirs = [fixture_name]\n-                    else:\n-                        fixture_dirs = app_fixtures + list(settings.FIXTURE_DIRS) + ['']\n-\n-                    for fixture_dir in fixture_dirs:\n-                        if verbosity >= 2:\n-                            self.stdout.write(\"Checking %s for fixtures...\" % humanize(fixture_dir))\n-\n-                        label_found = False\n-                        for combo in product([using, None], formats, compression_formats):\n-                            database, format, compression_format = combo\n-                            file_name = '.'.join(\n-                                p for p in [\n-                                    fixture_name, database, format, compression_format\n-                                ]\n-                                if p\n-                            )\n-\n-                            if verbosity >= 3:\n-                                self.stdout.write(\"Trying %s for %s fixture '%s'...\" % \\\n-                                    (humanize(fixture_dir), file_name, fixture_name))\n-                            full_path = os.path.join(fixture_dir, file_name)\n-                            open_method = compression_types[compression_format]\n-                            try:\n-                                fixture = open_method(full_path, 'r')\n-                            except IOError:\n-                                if verbosity >= 2:\n-                                    self.stdout.write(\"No %s fixture '%s' in %s.\" % \\\n-                                        (format, fixture_name, humanize(fixture_dir)))\n-                            else:\n-                                try:\n-                                    if label_found:\n-                                        raise CommandError(\"Multiple fixtures named '%s' in %s. Aborting.\" %\n-                                            (fixture_name, humanize(fixture_dir)))\n-\n-                                    fixture_count += 1\n-                                    objects_in_fixture = 0\n-                                    loaded_objects_in_fixture = 0\n-                                    if verbosity >= 2:\n-                                        self.stdout.write(\"Installing %s fixture '%s' from %s.\" % \\\n-                                            (format, fixture_name, humanize(fixture_dir)))\n-\n-                                    objects = serializers.deserialize(format, fixture, using=using, ignorenonexistent=ignore)\n-\n-                                    for obj in objects:\n-                                        objects_in_fixture += 1\n-                                        if router.allow_syncdb(using, obj.object.__class__):\n-                                            loaded_objects_in_fixture += 1\n-                                            models.add(obj.object.__class__)\n-                                            try:\n-                                                obj.save(using=using)\n-                                            except (DatabaseError, IntegrityError) as e:\n-                                                e.args = (\"Could not load %(app_label)s.%(object_name)s(pk=%(pk)s): %(error_msg)s\" % {\n-                                                        'app_label': obj.object._meta.app_label,\n-                                                        'object_name': obj.object._meta.object_name,\n-                                                        'pk': obj.object.pk,\n-                                                        'error_msg': force_text(e)\n-                                                    },)\n-                                                raise\n-\n-                                    loaded_object_count += loaded_objects_in_fixture\n-                                    fixture_object_count += objects_in_fixture\n-                                    label_found = True\n-                                except Exception as e:\n-                                    if not isinstance(e, CommandError):\n-                                        e.args = (\"Problem installing fixture '%s': %s\" % (full_path, e),)\n-                                    raise\n-                                finally:\n-                                    fixture.close()\n-\n-                                # If the fixture we loaded contains 0 objects, assume that an\n-                                # error was encountered during fixture loading.\n-                                if objects_in_fixture == 0:\n-                                    raise CommandError(\n-                                        \"No fixture data found for '%s'. (File format may be invalid.)\" %\n-                                            (fixture_name))\n+                    self.load_label(fixture_label, app_fixtures)\n \n             # Since we disabled constraint checks, we must manually check for\n             # any invalid keys that might have been added\n-            table_names = [model._meta.db_table for model in models]\n+            table_names = [model._meta.db_table for model in self.models]\n             try:\n                 connection.check_constraints(table_names=table_names)\n             except Exception as e:\n@@ -229,35 +123,149 @@ def read(self):\n             raise\n         except Exception as e:\n             if commit:\n-                transaction.rollback(using=using)\n-                transaction.leave_transaction_management(using=using)\n+                transaction.rollback(using=self.using)\n+                transaction.leave_transaction_management(using=self.using)\n             raise\n \n         # If we found even one object in a fixture, we need to reset the\n         # database sequences.\n-        if loaded_object_count > 0:\n-            sequence_sql = connection.ops.sequence_reset_sql(no_style(), models)\n+        if self.loaded_object_count > 0:\n+            sequence_sql = connection.ops.sequence_reset_sql(no_style(), self.models)\n             if sequence_sql:\n-                if verbosity >= 2:\n+                if self.verbosity >= 2:\n                     self.stdout.write(\"Resetting sequences\\n\")\n                 for line in sequence_sql:\n                     cursor.execute(line)\n \n         if commit:\n-            transaction.commit(using=using)\n-            transaction.leave_transaction_management(using=using)\n+            transaction.commit(using=self.using)\n+            transaction.leave_transaction_management(using=self.using)\n \n-        if verbosity >= 1:\n-            if fixture_object_count == loaded_object_count:\n+        if self.verbosity >= 1:\n+            if self.fixture_object_count == self.loaded_object_count:\n                 self.stdout.write(\"Installed %d object(s) from %d fixture(s)\" % (\n-                    loaded_object_count, fixture_count))\n+                    self.loaded_object_count, self.fixture_count))\n             else:\n                 self.stdout.write(\"Installed %d object(s) (of %d) from %d fixture(s)\" % (\n-                    loaded_object_count, fixture_object_count, fixture_count))\n+                    self.loaded_object_count, self.fixture_object_count, self.fixture_count))\n \n         # Close the DB connection. This is required as a workaround for an\n         # edge case in MySQL: if the same connection is used to\n         # create tables, load data, and query, the query can return\n         # incorrect results. See Django #7572, MySQL #37735.\n         if commit:\n             connection.close()\n+\n+    def load_label(self, fixture_label, app_fixtures):\n+\n+        parts = fixture_label.split('.')\n+\n+        if len(parts) > 1 and parts[-1] in self.compression_types:\n+            compression_formats = [parts[-1]]\n+            parts = parts[:-1]\n+        else:\n+            compression_formats = self.compression_types.keys()\n+\n+        if len(parts) == 1:\n+            fixture_name = parts[0]\n+            formats = serializers.get_public_serializer_formats()\n+        else:\n+            fixture_name, format = '.'.join(parts[:-1]), parts[-1]\n+            if format in serializers.get_public_serializer_formats():\n+                formats = [format]\n+            else:\n+                formats = []\n+\n+        if formats:\n+            if self.verbosity >= 2:\n+                self.stdout.write(\"Loading '%s' fixtures...\" % fixture_name)\n+        else:\n+            raise CommandError(\n+                \"Problem installing fixture '%s': %s is not a known serialization format.\" %\n+                    (fixture_name, format))\n+\n+        if os.path.isabs(fixture_name):\n+            fixture_dirs = [fixture_name]\n+        else:\n+            fixture_dirs = app_fixtures + list(settings.FIXTURE_DIRS) + ['']\n+\n+        for fixture_dir in fixture_dirs:\n+            self.process_dir(fixture_dir, fixture_name, compression_formats,\n+                             formats)\n+\n+    def process_dir(self, fixture_dir, fixture_name, compression_formats,\n+                    serialization_formats):\n+\n+        humanize = lambda dirname: \"'%s'\" % dirname if dirname else 'absolute path'\n+\n+        if self.verbosity >= 2:\n+            self.stdout.write(\"Checking %s for fixtures...\" % humanize(fixture_dir))\n+\n+        label_found = False\n+        for combo in product([self.using, None], serialization_formats, compression_formats):\n+            database, format, compression_format = combo\n+            file_name = '.'.join(\n+                p for p in [\n+                    fixture_name, database, format, compression_format\n+                ]\n+                if p\n+            )\n+\n+            if self.verbosity >= 3:\n+                self.stdout.write(\"Trying %s for %s fixture '%s'...\" % \\\n+                    (humanize(fixture_dir), file_name, fixture_name))\n+            full_path = os.path.join(fixture_dir, file_name)\n+            open_method = self.compression_types[compression_format]\n+            try:\n+                fixture = open_method(full_path, 'r')\n+            except IOError:\n+                if self.verbosity >= 2:\n+                    self.stdout.write(\"No %s fixture '%s' in %s.\" % \\\n+                        (format, fixture_name, humanize(fixture_dir)))\n+            else:\n+                try:\n+                    if label_found:\n+                        raise CommandError(\"Multiple fixtures named '%s' in %s. Aborting.\" %\n+                            (fixture_name, humanize(fixture_dir)))\n+\n+                    self.fixture_count += 1\n+                    objects_in_fixture = 0\n+                    loaded_objects_in_fixture = 0\n+                    if self.verbosity >= 2:\n+                        self.stdout.write(\"Installing %s fixture '%s' from %s.\" % \\\n+                            (format, fixture_name, humanize(fixture_dir)))\n+\n+                    objects = serializers.deserialize(format, fixture, using=self.using, ignorenonexistent=self.ignore)\n+\n+                    for obj in objects:\n+                        objects_in_fixture += 1\n+                        if router.allow_syncdb(self.using, obj.object.__class__):\n+                            loaded_objects_in_fixture += 1\n+                            self.models.add(obj.object.__class__)\n+                            try:\n+                                obj.save(using=self.using)\n+                            except (DatabaseError, IntegrityError) as e:\n+                                e.args = (\"Could not load %(app_label)s.%(object_name)s(pk=%(pk)s): %(error_msg)s\" % {\n+                                        'app_label': obj.object._meta.app_label,\n+                                        'object_name': obj.object._meta.object_name,\n+                                        'pk': obj.object.pk,\n+                                        'error_msg': force_text(e)\n+                                    },)\n+                                raise\n+\n+                    self.loaded_object_count += loaded_objects_in_fixture\n+                    self.fixture_object_count += objects_in_fixture\n+                    label_found = True\n+                except Exception as e:\n+                    if not isinstance(e, CommandError):\n+                        e.args = (\"Problem installing fixture '%s': %s\" % (full_path, e),)\n+                    raise\n+                finally:\n+                    fixture.close()\n+\n+                # If the fixture we loaded contains 0 objects, assume that an\n+                # error was encountered during fixture loading.\n+                if objects_in_fixture == 0:\n+                    raise CommandError(\n+                        \"No fixture data found for '%s'. (File format may be invalid.)\" %\n+                            (fixture_name))"
        },
        {
            "sha": "606cbe0b85e5497579ebebb52c6a0c6581cea887",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -301,7 +301,7 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n \n     locales = []\n     if locale is not None:\n-        locales.append(locale)\n+        locales.append(str(locale))\n     elif all:\n         locale_dirs = filter(os.path.isdir, glob.glob('%s/*' % localedir))\n         locales = [os.path.basename(l) for l in locale_dirs]\n@@ -316,8 +316,8 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n         if not os.path.isdir(basedir):\n             os.makedirs(basedir)\n \n-        pofile = os.path.join(basedir, '%s.po' % domain)\n-        potfile = os.path.join(basedir, '%s.pot' % domain)\n+        pofile = os.path.join(basedir, '%s.po' % str(domain))\n+        potfile = os.path.join(basedir, '%s.pot' % str(domain))\n \n         if os.path.exists(potfile):\n             os.unlink(potfile)"
        },
        {
            "sha": "e46f4ae4f5d19b3b61972e42f65f87ee4bb19a56",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -8,6 +8,7 @@\n from django.core.management.base import CommandError\n from django.db import models\n from django.db.models import get_models\n+from django.utils._os import upath\n \n \n def sql_create(app, style, connection):\n@@ -145,21 +146,21 @@ def sql_all(app, style, connection):\n def _split_statements(content):\n     comment_re = re.compile(r\"^((?:'[^']*'|[^'])*?)--.*$\")\n     statements = []\n-    statement = \"\"\n+    statement = []\n     for line in content.split(\"\\n\"):\n         cleaned_line = comment_re.sub(r\"\\1\", line).strip()\n         if not cleaned_line:\n             continue\n-        statement += cleaned_line\n-        if statement.endswith(\";\"):\n-            statements.append(statement)\n-            statement = \"\"\n+        statement.append(cleaned_line)\n+        if cleaned_line.endswith(\";\"):\n+            statements.append(\" \".join(statement))\n+            statement = []\n     return statements\n \n \n def custom_sql_for_model(model, style, connection):\n     opts = model._meta\n-    app_dir = os.path.normpath(os.path.join(os.path.dirname(models.get_app(model._meta.app_label).__file__), 'sql'))\n+    app_dir = os.path.normpath(os.path.join(os.path.dirname(upath(models.get_app(model._meta.app_label).__file__)), 'sql'))\n     output = []\n \n     # Post-creation SQL should come before any initial SQL data is loaded."
        },
        {
            "sha": "f522097b8cc8fdb962a4591fd18330ba423aff14",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -8,8 +8,6 @@\n import stat\n import sys\n import tempfile\n-import codecs\n-\n try:\n     from urllib.request import urlretrieve\n except ImportError:     # Python 2\n@@ -156,12 +154,14 @@ def handle(self, app_or_project, name, target=None, **options):\n \n                 # Only render the Python files, as we don't want to\n                 # accidentally render Django templates files\n-                with codecs.open(old_path, 'r', 'utf-8') as template_file:\n+                with open(old_path, 'rb') as template_file:\n                     content = template_file.read()\n                 if filename.endswith(extensions) or filename in extra_files:\n+                    content = content.decode('utf-8')\n                     template = Template(content)\n                     content = template.render(context)\n-                with codecs.open(new_path, 'w', 'utf-8') as new_file:\n+                    content = content.encode('utf-8')\n+                with open(new_path, 'wb') as new_file:\n                     new_file.write(content)\n \n                 if self.verbosity >= 2:"
        },
        {
            "sha": "c0452c5aa6d221b8ec35c474031184344373c4d3",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 39,
            "deletions": 21,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,3 +1,4 @@\n+import collections\n import sys\n \n from django.conf import settings\n@@ -34,7 +35,7 @@ def get_validation_errors(outfile, app=None):\n     for (app_name, error) in get_app_errors().items():\n         e.add(app_name, error)\n \n-    for cls in models.get_models(app):\n+    for cls in models.get_models(app, include_swapped=True):\n         opts = cls._meta\n \n         # Check swappable attribute.\n@@ -137,16 +138,17 @@ def get_validation_errors(outfile, app=None):\n             # fields, m2m fields, m2m related objects or related objects\n             if f.rel:\n                 if f.rel.to not in models.get_models():\n-                    e.add(opts, \"'%s' has a relation with model %s, which has either not been installed or is abstract.\" % (f.name, f.rel.to))\n+                    # If the related model is swapped, provide a hint;\n+                    # otherwise, the model just hasn't been installed.\n+                    if not isinstance(f.rel.to, six.string_types) and f.rel.to._meta.swapped:\n+                        e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n+                    else:\n+                        e.add(opts, \"'%s' has a relation with model %s, which has either not been installed or is abstract.\" % (f.name, f.rel.to))\n                 # it is a string and we could not find the model it refers to\n                 # so skip the next section\n                 if isinstance(f.rel.to, six.string_types):\n                     continue\n \n-                # Make sure the model we're related hasn't been swapped out\n-                if f.rel.to._meta.swapped:\n-                    e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n-\n                 # Make sure the related field specified by a ForeignKey is unique\n                 if not f.rel.to._meta.get_field(f.rel.field_name).unique:\n                     e.add(opts, \"Field '%s' under model '%s' must have a unique=True constraint.\" % (f.rel.field_name, f.rel.to.__name__))\n@@ -183,16 +185,18 @@ def get_validation_errors(outfile, app=None):\n             # existing fields, m2m fields, m2m related objects or related\n             # objects\n             if f.rel.to not in models.get_models():\n-                e.add(opts, \"'%s' has an m2m relation with model %s, which has either not been installed or is abstract.\" % (f.name, f.rel.to))\n+                # If the related model is swapped, provide a hint;\n+                # otherwise, the model just hasn't been installed.\n+                if not isinstance(f.rel.to, six.string_types) and f.rel.to._meta.swapped:\n+                    e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n+                else:\n+                    e.add(opts, \"'%s' has an m2m relation with model %s, which has either not been installed or is abstract.\" % (f.name, f.rel.to))\n+\n                 # it is a string and we could not find the model it refers to\n                 # so skip the next section\n                 if isinstance(f.rel.to, six.string_types):\n                     continue\n \n-            # Make sure the model we're related hasn't been swapped out\n-            if f.rel.to._meta.swapped:\n-                e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n-\n             # Check that the field is not set to unique.  ManyToManyFields do not support unique.\n             if f.unique:\n                 e.add(opts, \"ManyToManyFields cannot be unique.  Remove the unique argument on '%s'.\" % f.name)\n@@ -327,15 +331,29 @@ def get_validation_errors(outfile, app=None):\n \n         # Check unique_together.\n         for ut in opts.unique_together:\n-            for field_name in ut:\n-                try:\n-                    f = opts.get_field(field_name, many_to_many=True)\n-                except models.FieldDoesNotExist:\n-                    e.add(opts, '\"unique_together\" refers to %s, a field that doesn\\'t exist. Check your syntax.' % field_name)\n-                else:\n-                    if isinstance(f.rel, models.ManyToManyRel):\n-                        e.add(opts, '\"unique_together\" refers to %s. ManyToManyFields are not supported in unique_together.' % f.name)\n-                    if f not in opts.local_fields:\n-                        e.add(opts, '\"unique_together\" refers to %s. This is not in the same model as the unique_together statement.' % f.name)\n+            validate_local_fields(e, opts, \"unique_together\", ut)\n+        if not isinstance(opts.index_together, collections.Sequence):\n+            e.add(opts, '\"index_together\" must a sequence')\n+        else:\n+            for it in opts.index_together:\n+                validate_local_fields(e, opts, \"index_together\", it)\n \n     return len(e.errors)\n+\n+\n+def validate_local_fields(e, opts, field_name, fields):\n+    from django.db import models\n+\n+    if not isinstance(fields, collections.Sequence):\n+        e.add(opts, 'all %s elements must be sequences' % field_name)\n+    else:\n+        for field in fields:\n+            try:\n+                f = opts.get_field(field, many_to_many=True)\n+            except models.FieldDoesNotExist:\n+                e.add(opts, '\"%s\" refers to %s, a field that doesn\\'t exist.' % (field_name, field))\n+            else:\n+                if isinstance(f.rel, models.ManyToManyRel):\n+                    e.add(opts, '\"%s\" refers to %s. ManyToManyFields are not supported in %s.' % (field_name, f.name, field_name))\n+                if f not in opts.local_fields:\n+                    e.add(opts, '\"%s\" refers to %s. This is not in the same model as the %s statement.' % (field_name, f.name, field_name))"
        },
        {
            "sha": "9ccff51a34d97f8be8338512f8ed435ddf376cd2",
            "filename": "django/core/paginator.py",
            "status": "modified",
            "additions": 39,
            "deletions": 38,
            "changes": 77,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fpaginator.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fpaginator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fpaginator.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,24 +1,35 @@\n+import collections\n from math import ceil\n \n+from django.utils import six\n+\n+\n class InvalidPage(Exception):\n     pass\n \n+\n class PageNotAnInteger(InvalidPage):\n     pass\n \n+\n class EmptyPage(InvalidPage):\n     pass\n \n+\n class Paginator(object):\n-    def __init__(self, object_list, per_page, orphans=0, allow_empty_first_page=True):\n+\n+    def __init__(self, object_list, per_page, orphans=0,\n+                 allow_empty_first_page=True):\n         self.object_list = object_list\n         self.per_page = int(per_page)\n         self.orphans = int(orphans)\n         self.allow_empty_first_page = allow_empty_first_page\n         self._num_pages = self._count = None\n \n     def validate_number(self, number):\n-        \"Validates the given 1-based page number.\"\n+        \"\"\"\n+        Validates the given 1-based page number.\n+        \"\"\"\n         try:\n             number = int(number)\n         except (TypeError, ValueError):\n@@ -33,16 +44,29 @@ def validate_number(self, number):\n         return number\n \n     def page(self, number):\n-        \"Returns a Page object for the given 1-based page number.\"\n+        \"\"\"\n+        Returns a Page object for the given 1-based page number.\n+        \"\"\"\n         number = self.validate_number(number)\n         bottom = (number - 1) * self.per_page\n         top = bottom + self.per_page\n         if top + self.orphans >= self.count:\n             top = self.count\n-        return Page(self.object_list[bottom:top], number, self)\n+        return self._get_page(self.object_list[bottom:top], number, self)\n+\n+    def _get_page(self, *args, **kwargs):\n+        \"\"\"\n+        Returns an instance of a single page.\n+\n+        This hook can be used by subclasses to use an alternative to the\n+        standard :cls:`Page` object.\n+        \"\"\"\n+        return Page(*args, **kwargs)\n \n     def _get_count(self):\n-        \"Returns the total number of objects, across all pages.\"\n+        \"\"\"\n+        Returns the total number of objects, across all pages.\n+        \"\"\"\n         if self._count is None:\n             try:\n                 self._count = self.object_list.count()\n@@ -55,7 +79,9 @@ def _get_count(self):\n     count = property(_get_count)\n \n     def _get_num_pages(self):\n-        \"Returns the total number of pages.\"\n+        \"\"\"\n+        Returns the total number of pages.\n+        \"\"\"\n         if self._num_pages is None:\n             if self.count == 0 and not self.allow_empty_first_page:\n                 self._num_pages = 0\n@@ -73,9 +99,12 @@ def _get_page_range(self):\n         return range(1, self.num_pages + 1)\n     page_range = property(_get_page_range)\n \n-QuerySetPaginator = Paginator # For backwards-compatibility.\n \n-class Page(object):\n+QuerySetPaginator = Paginator   # For backwards-compatibility.\n+\n+\n+class Page(collections.Sequence):\n+\n     def __init__(self, object_list, number, paginator):\n         self.object_list = object_list\n         self.number = number\n@@ -88,40 +117,12 @@ def __len__(self):\n         return len(self.object_list)\n \n     def __getitem__(self, index):\n+        if not isinstance(index, (slice,) + six.integer_types):\n+            raise TypeError\n         # The object_list is converted to a list so that if it was a QuerySet\n         # it won't be a database hit per __getitem__.\n         return list(self.object_list)[index]\n \n-    # The following four methods are only necessary for Python <2.6\n-    # compatibility (this class could just extend 2.6's collections.Sequence).\n-\n-    def __iter__(self):\n-        i = 0\n-        try:\n-            while True:\n-                v = self[i]\n-                yield v\n-                i += 1\n-        except IndexError:\n-            return\n-\n-    def __contains__(self, value):\n-        for v in self:\n-            if v == value:\n-                return True\n-        return False\n-\n-    def index(self, value):\n-        for i, v in enumerate(self):\n-            if v == value:\n-                return i\n-        raise ValueError\n-\n-    def count(self, value):\n-        return sum([1 for v in self if v == value])\n-\n-    # End of compatibility methods.\n-\n     def has_next(self):\n         return self.number < self.paginator.num_pages\n "
        },
        {
            "sha": "294934a04a081d97554b0403b3d0a2ebe60719ad",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -112,7 +112,7 @@ def getvalue(self):\n         if callable(getattr(self.stream, 'getvalue', None)):\n             return self.stream.getvalue()\n \n-class Deserializer(object):\n+class Deserializer(six.Iterator):\n     \"\"\"\n     Abstract base deserializer class.\n     \"\"\"\n@@ -138,8 +138,6 @@ def __next__(self):\n         \"\"\"Iteration iterface -- return the next item in the stream\"\"\"\n         raise NotImplementedError\n \n-    next = __next__             # Python 2 compatibility\n-\n class DeserializedObject(object):\n     \"\"\"\n     A deserialized model."
        },
        {
            "sha": "ea333a22bd0fa6293e94fbd8662ed6afdb2ce312",
            "filename": "django/core/serializers/xml_serializer.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fserializers%2Fxml_serializer.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fserializers%2Fxml_serializer.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fxml_serializer.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -161,8 +161,6 @@ def __next__(self):\n                 return self._handle_object(node)\n         raise StopIteration\n \n-    next = __next__             # Python 2 compatibility\n-\n     def _handle_object(self, node):\n         \"\"\"\n         Convert an <object> node to a DeserializedObject."
        },
        {
            "sha": "7387d131998df45c777f91e31e3867d0f4154331",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -138,6 +138,10 @@ def __init__(self, *args, **kwargs):\n         self.style = color_style()\n         super(WSGIRequestHandler, self).__init__(*args, **kwargs)\n \n+    def address_string(self):\n+        # Short-circuit parent method to not call socket.getfqdn\n+        return self.client_address[0]\n+\n     def log_message(self, format, *args):\n         # Don't bother logging requests for admin images or the favicon.\n         if (self.path.startswith(self.admin_static_prefix)"
        },
        {
            "sha": "92ab968123eb35d83ca0b6a10ae5e5c0c75bbe21",
            "filename": "django/core/signing.py",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fsigning.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Fsigning.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fsigning.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -97,10 +97,10 @@ class JSONSerializer(object):\n     signing.loads.\n     \"\"\"\n     def dumps(self, obj):\n-        return json.dumps(obj, separators=(',', ':'))\n+        return json.dumps(obj, separators=(',', ':')).encode('latin-1')\n \n     def loads(self, data):\n-        return json.loads(data)\n+        return json.loads(data.decode('latin-1'))\n \n \n def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer, compress=False):\n@@ -116,8 +116,10 @@ def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer,\n     only valid for a given namespace. Leaving this at the default\n     value or re-using a salt value across different parts of your\n     application without good cause is a security risk.\n+\n+    The serializer is expected to return a bytestring.\n     \"\"\"\n-    data = force_bytes(serializer().dumps(obj))\n+    data = serializer().dumps(obj)\n \n     # Flag for if it's been compressed or not\n     is_compressed = False\n@@ -136,20 +138,22 @@ def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer,\n \n def loads(s, key=None, salt='django.core.signing', serializer=JSONSerializer, max_age=None):\n     \"\"\"\n-    Reverse of dumps(), raises BadSignature if signature fails\n+    Reverse of dumps(), raises BadSignature if signature fails.\n+\n+    The serializer is expected to accept a bytestring.\n     \"\"\"\n     # TimestampSigner.unsign always returns unicode but base64 and zlib\n     # compression operate on bytes.\n     base64d = force_bytes(TimestampSigner(key, salt=salt).unsign(s, max_age=max_age))\n     decompress = False\n-    if base64d[0] == b'.':\n+    if base64d[:1] == b'.':\n         # It's compressed; uncompress it first\n         base64d = base64d[1:]\n         decompress = True\n     data = b64_decode(base64d)\n     if decompress:\n         data = zlib.decompress(data)\n-    return serializer().loads(force_str(data))\n+    return serializer().loads(data)\n \n \n class Signer(object):"
        },
        {
            "sha": "c657fd9a54265d1ce40053dccb0dc9ceb7b66423",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,6 +16,7 @@\n from django.utils.datastructures import MultiValueDict\n from django.utils.encoding import force_str, force_text, iri_to_uri\n from django.utils.functional import memoize, lazy\n+from django.utils.http import urlquote\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n from django.utils.regex_helper import normalize\n@@ -250,9 +251,9 @@ def __repr__(self):\n             urlconf_repr = '<%s list>' % self.urlconf_name[0].__class__.__name__\n         else:\n             urlconf_repr = repr(self.urlconf_name)\n-        return force_str('<%s %s (%s:%s) %s>' % (\n+        return str('<%s %s (%s:%s) %s>') % (\n             self.__class__.__name__, urlconf_repr, self.app_name,\n-            self.namespace, self.regex.pattern))\n+            self.namespace, self.regex.pattern)\n \n     def _populate(self):\n         lookups = MultiValueDict()\n@@ -379,14 +380,15 @@ def _reverse_with_prefix(self, lookup_view, _prefix, *args, **kwargs):\n         except (ImportError, AttributeError) as e:\n             raise NoReverseMatch(\"Error importing '%s': %s.\" % (lookup_view, e))\n         possibilities = self.reverse_dict.getlist(lookup_view)\n-        prefix_norm, prefix_args = normalize(_prefix)[0]\n+\n+        prefix_norm, prefix_args = normalize(urlquote(_prefix))[0]\n         for possibility, pattern, defaults in possibilities:\n             for result, params in possibility:\n                 if args:\n                     if len(args) != len(params) + len(prefix_args):\n                         continue\n                     unicode_args = [force_text(val) for val in args]\n-                    candidate =  (prefix_norm + result) % dict(zip(prefix_args + params, unicode_args))\n+                    candidate = (prefix_norm + result) % dict(zip(prefix_args + params, unicode_args))\n                 else:\n                     if set(kwargs.keys()) | set(defaults.keys()) != set(params) | set(defaults.keys()) | set(prefix_args):\n                         continue\n@@ -398,8 +400,8 @@ def _reverse_with_prefix(self, lookup_view, _prefix, *args, **kwargs):\n                     if not matches:\n                         continue\n                     unicode_kwargs = dict([(k, force_text(v)) for (k, v) in kwargs.items()])\n-                    candidate = (prefix_norm + result) % unicode_kwargs\n-                if re.search('^%s%s' % (_prefix, pattern), candidate, re.UNICODE):\n+                    candidate = (prefix_norm.replace('%', '%%') + result) % unicode_kwargs\n+                if re.search('^%s%s' % (prefix_norm, pattern), candidate, re.UNICODE):\n                     return candidate\n         # lookup_view can be URL label, or dotted path, or callable, Any of\n         # these can be passed in at the top, but callables are not friendly in"
        },
        {
            "sha": "b1980488df69ad292cdabea54339a18d8baa9f39",
            "filename": "django/db/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -8,7 +8,7 @@\n     'IntegrityError', 'DEFAULT_DB_ALIAS')\n \n \n-if DEFAULT_DB_ALIAS not in settings.DATABASES:\n+if settings.DATABASES and DEFAULT_DB_ALIAS not in settings.DATABASES:\n     raise ImproperlyConfigured(\"You must define a '%s' database\" % DEFAULT_DB_ALIAS)\n \n connections = ConnectionHandler(settings.DATABASES)"
        },
        {
            "sha": "0b5ba55cd08c8ddcbdd8918faa253b0967b7a504",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -181,8 +181,6 @@ def is_managed(self):\n         \"\"\"\n         if self.transaction_state:\n             return self.transaction_state[-1]\n-        # Note that this setting isn't documented, and is only used here, and\n-        # in enter_transaction_management()\n         return settings.TRANSACTIONS_MANAGED\n \n     def managed(self, flag=True):\n@@ -904,16 +902,14 @@ def convert_values(self, value, field):\n         Coerce the value returned by the database backend into a consistent type\n         that is compatible with the field type.\n         \"\"\"\n-        internal_type = field.get_internal_type()\n-        if internal_type == 'DecimalField':\n+        if value is None:\n             return value\n-        elif internal_type == 'FloatField':\n+        internal_type = field.get_internal_type()\n+        if internal_type == 'FloatField':\n             return float(value)\n         elif (internal_type and (internal_type.endswith('IntegerField')\n                                  or internal_type == 'AutoField')):\n             return int(value)\n-        elif internal_type in ('DateField', 'DateTimeField', 'TimeField'):\n-            return value\n         return value\n \n     def check_aggregate_support(self, aggregate_func):\n@@ -935,6 +931,11 @@ def combine_expression(self, connector, sub_expressions):\n         conn = ' %s ' % connector\n         return conn.join(sub_expressions)\n \n+    def modify_insert_params(self, placeholders, params):\n+        \"\"\"Allow modification of insert parameters. Needed for Oracle Spatial\n+        backend due to #10888.\n+        \"\"\"\n+        return params\n \n class BaseDatabaseIntrospection(object):\n     \"\"\""
        },
        {
            "sha": "9c3095d0aaedb4339a4eaa69afae56ea1947476a",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 33,
            "deletions": 19,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -179,34 +179,47 @@ def sql_indexes_for_model(self, model, style):\n         output = []\n         for f in model._meta.local_fields:\n             output.extend(self.sql_indexes_for_field(model, f, style))\n+        for fs in model._meta.index_together:\n+            fields = [model._meta.get_field_by_name(f)[0] for f in fs]\n+            output.extend(self.sql_indexes_for_fields(model, fields, style))\n         return output\n \n     def sql_indexes_for_field(self, model, f, style):\n         \"\"\"\n         Return the CREATE INDEX SQL statements for a single model field.\n         \"\"\"\n+        if f.db_index and not f.unique:\n+            return self.sql_indexes_for_fields(model, [f], style)\n+        else:\n+            return []\n+\n+    def sql_indexes_for_fields(self, model, fields, style):\n         from django.db.backends.util import truncate_name\n \n-        if f.db_index and not f.unique:\n-            qn = self.connection.ops.quote_name\n-            tablespace = f.db_tablespace or model._meta.db_tablespace\n-            if tablespace:\n-                tablespace_sql = self.connection.ops.tablespace_sql(tablespace)\n-                if tablespace_sql:\n-                    tablespace_sql = ' ' + tablespace_sql\n-            else:\n-                tablespace_sql = ''\n-            i_name = '%s_%s' % (model._meta.db_table, self._digest(f.column))\n-            output = [style.SQL_KEYWORD('CREATE INDEX') + ' ' +\n-                style.SQL_TABLE(qn(truncate_name(\n-                    i_name, self.connection.ops.max_name_length()))) + ' ' +\n-                style.SQL_KEYWORD('ON') + ' ' +\n-                style.SQL_TABLE(qn(model._meta.db_table)) + ' ' +\n-                \"(%s)\" % style.SQL_FIELD(qn(f.column)) +\n-                \"%s;\" % tablespace_sql]\n+        if len(fields) == 1 and fields[0].db_tablespace:\n+            tablespace_sql = self.connection.ops.tablespace_sql(fields[0].db_tablespace)\n+        elif model._meta.db_tablespace:\n+            tablespace_sql = self.connection.ops.tablespace_sql(model._meta.db_tablespace)\n         else:\n-            output = []\n-        return output\n+            tablespace_sql = \"\"\n+        if tablespace_sql:\n+            tablespace_sql = \" \" + tablespace_sql\n+\n+        field_names = []\n+        qn = self.connection.ops.quote_name\n+        for f in fields:\n+            field_names.append(style.SQL_FIELD(qn(f.column)))\n+\n+        index_name = \"%s_%s\" % (model._meta.db_table, self._digest([f.name for f in fields]))\n+\n+        return [\n+            style.SQL_KEYWORD(\"CREATE INDEX\") + \" \" +\n+            style.SQL_TABLE(qn(truncate_name(index_name, self.connection.ops.max_name_length()))) + \" \" +\n+            style.SQL_KEYWORD(\"ON\") + \" \" +\n+            style.SQL_TABLE(qn(model._meta.db_table)) + \" \" +\n+            \"(%s)\" % style.SQL_FIELD(\", \".join(field_names)) +\n+            \"%s;\" % tablespace_sql,\n+        ]\n \n     def sql_destroy_model(self, model, references_to_delete, style):\n         \"\"\"\n@@ -270,6 +283,7 @@ def create_test_db(self, verbosity=1, autoclobber=False):\n         self._create_test_db(verbosity, autoclobber)\n \n         self.connection.close()\n+        settings.DATABASES[self.connection.alias][\"NAME\"] = test_database_name\n         self.connection.settings_dict[\"NAME\"] = test_database_name\n \n         # Report syncdb messages at one level lower than that requested."
        },
        {
            "sha": "f782ca80ae5ee54d5e6ac705234a51e721b75e0e",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 45,
            "deletions": 37,
            "changes": 82,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -374,47 +374,56 @@ def _valid_connection(self):\n                 self.connection.ping()\n                 return True\n             except DatabaseError:\n-                self.connection.close()\n-                self.connection = None\n+                self.close()\n         return False\n \n+    def get_connection_params(self):\n+        kwargs = {\n+            'conv': django_conversions,\n+            'charset': 'utf8',\n+            'use_unicode': True,\n+        }\n+        settings_dict = self.settings_dict\n+        if settings_dict['USER']:\n+            kwargs['user'] = settings_dict['USER']\n+        if settings_dict['NAME']:\n+            kwargs['db'] = settings_dict['NAME']\n+        if settings_dict['PASSWORD']:\n+            kwargs['passwd'] = force_str(settings_dict['PASSWORD'])\n+        if settings_dict['HOST'].startswith('/'):\n+            kwargs['unix_socket'] = settings_dict['HOST']\n+        elif settings_dict['HOST']:\n+            kwargs['host'] = settings_dict['HOST']\n+        if settings_dict['PORT']:\n+            kwargs['port'] = int(settings_dict['PORT'])\n+        # We need the number of potentially affected rows after an\n+        # \"UPDATE\", not the number of changed rows.\n+        kwargs['client_flag'] = CLIENT.FOUND_ROWS\n+        kwargs.update(settings_dict['OPTIONS'])\n+        return kwargs\n+\n+    def get_new_connection(self, conn_params):\n+        conn = Database.connect(**conn_params)\n+        conn.encoders[SafeText] = conn.encoders[six.text_type]\n+        conn.encoders[SafeBytes] = conn.encoders[bytes]\n+        return conn\n+\n+    def init_connection_state(self):\n+        cursor = self.connection.cursor()\n+        # SQL_AUTO_IS_NULL in MySQL controls whether an AUTO_INCREMENT column\n+        # on a recently-inserted row will return when the field is tested for\n+        # NULL.  Disabling this value brings this aspect of MySQL in line with\n+        # SQL standards.\n+        cursor.execute('SET SQL_AUTO_IS_NULL = 0')\n+        cursor.close()\n+\n     def _cursor(self):\n-        new_connection = False\n         if not self._valid_connection():\n-            new_connection = True\n-            kwargs = {\n-                'conv': django_conversions,\n-                'charset': 'utf8',\n-                'use_unicode': True,\n-            }\n-            settings_dict = self.settings_dict\n-            if settings_dict['USER']:\n-                kwargs['user'] = settings_dict['USER']\n-            if settings_dict['NAME']:\n-                kwargs['db'] = settings_dict['NAME']\n-            if settings_dict['PASSWORD']:\n-                kwargs['passwd'] = force_str(settings_dict['PASSWORD'])\n-            if settings_dict['HOST'].startswith('/'):\n-                kwargs['unix_socket'] = settings_dict['HOST']\n-            elif settings_dict['HOST']:\n-                kwargs['host'] = settings_dict['HOST']\n-            if settings_dict['PORT']:\n-                kwargs['port'] = int(settings_dict['PORT'])\n-            # We need the number of potentially affected rows after an\n-            # \"UPDATE\", not the number of changed rows.\n-            kwargs['client_flag'] = CLIENT.FOUND_ROWS\n-            kwargs.update(settings_dict['OPTIONS'])\n-            self.connection = Database.connect(**kwargs)\n-            self.connection.encoders[SafeText] = self.connection.encoders[six.text_type]\n-            self.connection.encoders[SafeBytes] = self.connection.encoders[bytes]\n+            conn_params = self.get_connection_params()\n+            self.connection = self.get_new_connection(conn_params)\n+            self.init_connection_state()\n             connection_created.send(sender=self.__class__, connection=self)\n         cursor = self.connection.cursor()\n-        if new_connection:\n-            # SQL_AUTO_IS_NULL in MySQL controls whether an AUTO_INCREMENT column\n-            # on a recently-inserted row will return when the field is tested for\n-            # NULL.  Disabling this value brings this aspect of MySQL in line with\n-            # SQL standards.\n-            cursor.execute('SET SQL_AUTO_IS_NULL = 0')\n         return CursorWrapper(cursor)\n \n     def _rollback(self):\n@@ -435,8 +444,7 @@ def mysql_version(self):\n             server_info = self.connection.get_server_info()\n             if new_connection:\n                 # Make sure we close the connection\n-                self.connection.close()\n-                self.connection = None\n+                self.close()\n             m = server_version_re.match(server_info)\n             if not m:\n                 raise Exception('Unable to determine MySQL version from version string %r' % server_info)"
        },
        {
            "sha": "129b5d827b69eecad05f8b41b91121ba8badc109",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 74,
            "deletions": 60,
            "changes": 134,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -257,6 +257,10 @@ def quote_name(self, name):\n         if not name.startswith('\"') and not name.endswith('\"'):\n             name = '\"%s\"' % util.truncate_name(name.upper(),\n                                                self.max_name_length())\n+        # Oracle puts the query text into a (query % args) construct, so % signs\n+        # in names need to be escaped. The '%%' will be collapsed back to '%' at\n+        # that stage so we aren't really making the name longer here.\n+        name = name.replace('%','%%')\n         return name.upper()\n \n     def random_function_sql(self):\n@@ -486,66 +490,78 @@ def _connect_string(self):\n         return \"%s/%s@%s\" % (settings_dict['USER'],\n                              settings_dict['PASSWORD'], dsn)\n \n+    def create_cursor(self, conn):\n+        return FormatStylePlaceholderCursor(conn)\n+\n+    def get_connection_params(self):\n+        conn_params = self.settings_dict['OPTIONS'].copy()\n+        if 'use_returning_into' in conn_params:\n+            del conn_params['use_returning_into']\n+        return conn_params\n+\n+    def get_new_connection(self, conn_params):\n+        conn_string = convert_unicode(self._connect_string())\n+        return Database.connect(conn_string, **conn_params)\n+\n+    def init_connection_state(self):\n+        cursor = self.create_cursor(self.connection)\n+        # Set the territory first. The territory overrides NLS_DATE_FORMAT\n+        # and NLS_TIMESTAMP_FORMAT to the territory default. When all of\n+        # these are set in single statement it isn't clear what is supposed\n+        # to happen.\n+        cursor.execute(\"ALTER SESSION SET NLS_TERRITORY = 'AMERICA'\")\n+        # Set oracle date to ansi date format.  This only needs to execute\n+        # once when we create a new connection. We also set the Territory\n+        # to 'AMERICA' which forces Sunday to evaluate to a '1' in\n+        # TO_CHAR().\n+        cursor.execute(\n+            \"ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS'\"\n+            \" NLS_TIMESTAMP_FORMAT = 'YYYY-MM-DD HH24:MI:SS.FF'\"\n+            + (\" TIME_ZONE = 'UTC'\" if settings.USE_TZ else ''))\n+        cursor.close()\n+        if 'operators' not in self.__dict__:\n+            # Ticket #14149: Check whether our LIKE implementation will\n+            # work for this connection or we need to fall back on LIKEC.\n+            # This check is performed only once per DatabaseWrapper\n+            # instance per thread, since subsequent connections will use\n+            # the same settings.\n+            cursor = self.create_cursor(self.connection)\n+            try:\n+                cursor.execute(\"SELECT 1 FROM DUAL WHERE DUMMY %s\"\n+                               % self._standard_operators['contains'],\n+                               ['X'])\n+            except utils.DatabaseError:\n+                self.operators = self._likec_operators\n+            else:\n+                self.operators = self._standard_operators\n+            cursor.close()\n+\n+        try:\n+            self.oracle_version = int(self.connection.version.split('.')[0])\n+            # There's no way for the DatabaseOperations class to know the\n+            # currently active Oracle version, so we do some setups here.\n+            # TODO: Multi-db support will need a better solution (a way to\n+            # communicate the current version).\n+            if self.oracle_version <= 9:\n+                self.ops.regex_lookup = self.ops.regex_lookup_9\n+            else:\n+                self.ops.regex_lookup = self.ops.regex_lookup_10\n+        except ValueError:\n+            pass\n+        try:\n+            self.connection.stmtcachesize = 20\n+        except:\n+            # Django docs specify cx_Oracle version 4.3.1 or higher, but\n+            # stmtcachesize is available only in 4.3.2 and up.\n+            pass\n+\n     def _cursor(self):\n-        cursor = None\n         if not self._valid_connection():\n-            conn_string = convert_unicode(self._connect_string())\n-            conn_params = self.settings_dict['OPTIONS'].copy()\n-            if 'use_returning_into' in conn_params:\n-                del conn_params['use_returning_into']\n-            self.connection = Database.connect(conn_string, **conn_params)\n-            cursor = FormatStylePlaceholderCursor(self.connection)\n-            # Set the territory first. The territory overrides NLS_DATE_FORMAT\n-            # and NLS_TIMESTAMP_FORMAT to the territory default. When all of\n-            # these are set in single statement it isn't clear what is supposed\n-            # to happen.\n-            cursor.execute(\"ALTER SESSION SET NLS_TERRITORY = 'AMERICA'\")\n-            # Set oracle date to ansi date format.  This only needs to execute\n-            # once when we create a new connection. We also set the Territory\n-            # to 'AMERICA' which forces Sunday to evaluate to a '1' in\n-            # TO_CHAR().\n-            cursor.execute(\n-                \"ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS'\"\n-                \" NLS_TIMESTAMP_FORMAT = 'YYYY-MM-DD HH24:MI:SS.FF'\"\n-                + (\" TIME_ZONE = 'UTC'\" if settings.USE_TZ else ''))\n-\n-            if 'operators' not in self.__dict__:\n-                # Ticket #14149: Check whether our LIKE implementation will\n-                # work for this connection or we need to fall back on LIKEC.\n-                # This check is performed only once per DatabaseWrapper\n-                # instance per thread, since subsequent connections will use\n-                # the same settings.\n-                try:\n-                    cursor.execute(\"SELECT 1 FROM DUAL WHERE DUMMY %s\"\n-                                   % self._standard_operators['contains'],\n-                                   ['X'])\n-                except utils.DatabaseError:\n-                    self.operators = self._likec_operators\n-                else:\n-                    self.operators = self._standard_operators\n-\n-            try:\n-                self.oracle_version = int(self.connection.version.split('.')[0])\n-                # There's no way for the DatabaseOperations class to know the\n-                # currently active Oracle version, so we do some setups here.\n-                # TODO: Multi-db support will need a better solution (a way to\n-                # communicate the current version).\n-                if self.oracle_version <= 9:\n-                    self.ops.regex_lookup = self.ops.regex_lookup_9\n-                else:\n-                    self.ops.regex_lookup = self.ops.regex_lookup_10\n-            except ValueError:\n-                pass\n-            try:\n-                self.connection.stmtcachesize = 20\n-            except:\n-                # Django docs specify cx_Oracle version 4.3.1 or higher, but\n-                # stmtcachesize is available only in 4.3.2 and up.\n-                pass\n+            conn_params = self.get_connection_params()\n+            self.connection = self.get_new_connection(conn_params)\n+            self.init_connection_state()\n             connection_created.send(sender=self.__class__, connection=self)\n-        if not cursor:\n-            cursor = FormatStylePlaceholderCursor(self.connection)\n-        return cursor\n+        return self.create_cursor(self.connection)\n \n     # Oracle doesn't support savepoint commits.  Ignore them.\n     def _savepoint_commit(self, sid):\n@@ -775,7 +791,7 @@ def __iter__(self):\n         return CursorIterator(self.cursor)\n \n \n-class CursorIterator(object):\n+class CursorIterator(six.Iterator):\n \n     \"\"\"Cursor iterator wrapper that invokes our custom row factory.\"\"\"\n \n@@ -789,8 +805,6 @@ def __iter__(self):\n     def __next__(self):\n         return _rowfactory(next(self.iter), self.cursor)\n \n-    next = __next__             # Python 2 compatibility\n-\n \n def _rowfactory(row, cursor):\n     # Cast numeric values as the appropriate Python type based upon the"
        },
        {
            "sha": "50e8d655a0dbdc0d8fbf52b184abd62d33234b39",
            "filename": "django/db/backends/oracle/creation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -111,10 +111,12 @@ def _create_test_db(self, verbosity=1, autoclobber=False):\n                     print(\"Tests cancelled.\")\n                     sys.exit(1)\n \n-        self.connection.settings_dict['SAVED_USER'] = self.connection.settings_dict['USER']\n-        self.connection.settings_dict['SAVED_PASSWORD'] = self.connection.settings_dict['PASSWORD']\n-        self.connection.settings_dict['TEST_USER'] = self.connection.settings_dict['USER'] = TEST_USER\n-        self.connection.settings_dict['PASSWORD'] = TEST_PASSWD\n+        from django.db import settings\n+        real_settings = settings.DATABASES[self.connection.alias]\n+        real_settings['SAVED_USER'] = self.connection.settings_dict['SAVED_USER'] = self.connection.settings_dict['USER']\n+        real_settings['SAVED_PASSWORD'] = self.connection.settings_dict['SAVED_PASSWORD'] = self.connection.settings_dict['PASSWORD']\n+        real_settings['TEST_USER'] = real_settings['USER'] = self.connection.settings_dict['TEST_USER'] = self.connection.settings_dict['USER'] = TEST_USER\n+        real_settings['PASSWORD'] = self.connection.settings_dict['PASSWORD'] = TEST_PASSWD\n \n         return self.connection.settings_dict['NAME']\n "
        },
        {
            "sha": "b9addfc92609387a5dd485016246607a5b436ab4",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 51,
            "deletions": 40,
            "changes": 91,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -159,48 +159,59 @@ def _get_pg_version(self):\n         return self._pg_version\n     pg_version = property(_get_pg_version)\n \n-    def _cursor(self):\n+    def get_connection_params(self):\n+        settings_dict = self.settings_dict\n+        if not settings_dict['NAME']:\n+            from django.core.exceptions import ImproperlyConfigured\n+            raise ImproperlyConfigured(\n+                \"settings.DATABASES is improperly configured. \"\n+                \"Please supply the NAME value.\")\n+        conn_params = {\n+            'database': settings_dict['NAME'],\n+        }\n+        conn_params.update(settings_dict['OPTIONS'])\n+        if 'autocommit' in conn_params:\n+            del conn_params['autocommit']\n+        if settings_dict['USER']:\n+            conn_params['user'] = settings_dict['USER']\n+        if settings_dict['PASSWORD']:\n+            conn_params['password'] = force_str(settings_dict['PASSWORD'])\n+        if settings_dict['HOST']:\n+            conn_params['host'] = settings_dict['HOST']\n+        if settings_dict['PORT']:\n+            conn_params['port'] = settings_dict['PORT']\n+        return conn_params\n+\n+    def get_new_connection(self, conn_params):\n+        return Database.connect(**conn_params)\n+\n+    def init_connection_state(self):\n         settings_dict = self.settings_dict\n+        self.connection.set_client_encoding('UTF8')\n+        tz = 'UTC' if settings.USE_TZ else settings_dict.get('TIME_ZONE')\n+        if tz:\n+            try:\n+                get_parameter_status = self.connection.get_parameter_status\n+            except AttributeError:\n+                # psycopg2 < 2.0.12 doesn't have get_parameter_status\n+                conn_tz = None\n+            else:\n+                conn_tz = get_parameter_status('TimeZone')\n+\n+            if conn_tz != tz:\n+                # Set the time zone in autocommit mode (see #17062)\n+                self.connection.set_isolation_level(\n+                        psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT)\n+                self.connection.cursor().execute(\n+                        self.ops.set_time_zone_sql(), [tz])\n+        self.connection.set_isolation_level(self.isolation_level)\n+        self._get_pg_version()\n+\n+    def _cursor(self):\n         if self.connection is None:\n-            if not settings_dict['NAME']:\n-                from django.core.exceptions import ImproperlyConfigured\n-                raise ImproperlyConfigured(\n-                    \"settings.DATABASES is improperly configured. \"\n-                    \"Please supply the NAME value.\")\n-            conn_params = {\n-                'database': settings_dict['NAME'],\n-            }\n-            conn_params.update(settings_dict['OPTIONS'])\n-            if 'autocommit' in conn_params:\n-                del conn_params['autocommit']\n-            if settings_dict['USER']:\n-                conn_params['user'] = settings_dict['USER']\n-            if settings_dict['PASSWORD']:\n-                conn_params['password'] = force_str(settings_dict['PASSWORD'])\n-            if settings_dict['HOST']:\n-                conn_params['host'] = settings_dict['HOST']\n-            if settings_dict['PORT']:\n-                conn_params['port'] = settings_dict['PORT']\n-            self.connection = Database.connect(**conn_params)\n-            self.connection.set_client_encoding('UTF8')\n-            tz = 'UTC' if settings.USE_TZ else settings_dict.get('TIME_ZONE')\n-            if tz:\n-                try:\n-                    get_parameter_status = self.connection.get_parameter_status\n-                except AttributeError:\n-                    # psycopg2 < 2.0.12 doesn't have get_parameter_status\n-                    conn_tz = None\n-                else:\n-                    conn_tz = get_parameter_status('TimeZone')\n-\n-                if conn_tz != tz:\n-                    # Set the time zone in autocommit mode (see #17062)\n-                    self.connection.set_isolation_level(\n-                            psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT)\n-                    self.connection.cursor().execute(\n-                            self.ops.set_time_zone_sql(), [tz])\n-            self.connection.set_isolation_level(self.isolation_level)\n-            self._get_pg_version()\n+            conn_params = self.get_connection_params()\n+            self.connection = self.get_new_connection(conn_params)\n+            self.init_connection_state()\n             connection_created.send(sender=self.__class__, connection=self)\n         cursor = self.connection.cursor()\n         cursor.tzinfo_factory = utc_tzinfo_factory if settings.USE_TZ else None"
        },
        {
            "sha": "aedf953cfdf9fc99823039ec5d65497ffb3fe493",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 24,
            "deletions": 8,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -123,8 +123,12 @@ def bulk_batch_size(self, fields, objs):\n         \"\"\"\n         SQLite has a compile-time default (SQLITE_LIMIT_VARIABLE_NUMBER) of\n         999 variables per query.\n+\n+        If there is just single field to insert, then we can hit another\n+        limit, SQLITE_MAX_COMPOUND_SELECT which defaults to 500.\n         \"\"\"\n-        return (999 // len(fields)) if len(fields) > 0 else len(objs)\n+        limit = 999 if len(fields) > 1 else 500\n+        return (limit // len(fields)) if len(fields) > 0 else len(objs)\n \n     def date_extract_sql(self, lookup_type, field_name):\n         # sqlite doesn't support extract, so we fake it with the user-defined\n@@ -230,7 +234,7 @@ def bulk_insert_sql(self, fields, num_values):\n         res.append(\"SELECT %s\" % \", \".join(\n             \"%%s AS %s\" % self.quote_name(f.column) for f in fields\n         ))\n-        res.extend([\"UNION SELECT %s\" % \", \".join([\"%s\"] * len(fields))] * (num_values - 1))\n+        res.extend([\"UNION ALL SELECT %s\" % \", \".join([\"%s\"] * len(fields))] * (num_values - 1))\n         return \" \".join(res)\n \n class DatabaseWrapper(BaseDatabaseWrapper):\n@@ -265,7 +269,7 @@ def __init__(self, *args, **kwargs):\n         self.introspection = DatabaseIntrospection(self)\n         self.validation = BaseDatabaseValidation(self)\n \n-    def _sqlite_create_connection(self):\n+    def get_connection_params(self):\n         settings_dict = self.settings_dict\n         if not settings_dict['NAME']:\n             from django.core.exceptions import ImproperlyConfigured\n@@ -292,12 +296,24 @@ def _sqlite_create_connection(self):\n                 RuntimeWarning\n             )\n         kwargs.update({'check_same_thread': False})\n-        self.connection = Database.connect(**kwargs)\n+        return kwargs\n+\n+    def get_new_connection(self, conn_params):\n+        conn = Database.connect(**conn_params)\n         # Register extract, date_trunc, and regexp functions.\n-        self.connection.create_function(\"django_extract\", 2, _sqlite_extract)\n-        self.connection.create_function(\"django_date_trunc\", 2, _sqlite_date_trunc)\n-        self.connection.create_function(\"regexp\", 2, _sqlite_regexp)\n-        self.connection.create_function(\"django_format_dtdelta\", 5, _sqlite_format_dtdelta)\n+        conn.create_function(\"django_extract\", 2, _sqlite_extract)\n+        conn.create_function(\"django_date_trunc\", 2, _sqlite_date_trunc)\n+        conn.create_function(\"regexp\", 2, _sqlite_regexp)\n+        conn.create_function(\"django_format_dtdelta\", 5, _sqlite_format_dtdelta)\n+        return conn\n+\n+    def init_connection_state(self):\n+        pass\n+\n+    def _sqlite_create_connection(self):\n+        conn_params = self.get_connection_params()\n+        self.connection = self.get_new_connection(conn_params)\n+        self.init_connection_state()\n         connection_created.send(sender=self.__class__, connection=self)\n \n     def _cursor(self):"
        },
        {
            "sha": "1ba23060e07d848a319f8f5a63e4aef4dcc8ed57",
            "filename": "django/db/backends/util.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fbackends%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Futil.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -24,11 +24,9 @@ def set_dirty(self):\n             self.db.set_dirty()\n \n     def __getattr__(self, attr):\n-        self.set_dirty()\n-        if attr in self.__dict__:\n-            return self.__dict__[attr]\n-        else:\n-            return getattr(self.cursor, attr)\n+        if attr in ('execute', 'executemany', 'callproc'):\n+            self.set_dirty()\n+        return getattr(self.cursor, attr)\n \n     def __iter__(self):\n         return iter(self.cursor)"
        },
        {
            "sha": "db228b3b5833f335acaecc6edfd2c355783753bd",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -419,6 +419,11 @@ def __repr__(self):\n \n     def __str__(self):\n         if not six.PY3 and hasattr(self, '__unicode__'):\n+            if type(self).__unicode__ == Model.__str__:\n+                klass_name = type(self).__name__\n+                raise RuntimeError(\"%s.__unicode__ is aliased to __str__. Did\"\n+                                   \" you apply @python_2_unicode_compatible\"\n+                                   \" without defining __str__?\" % klass_name)\n             return force_text(self).encode('utf-8')\n         return '%s object' % self.__class__.__name__\n "
        },
        {
            "sha": "3566d777c68cb2c817d7b479d4a7ea1521db50bd",
            "filename": "django/db/models/expressions.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fexpressions.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fexpressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fexpressions.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -62,7 +62,9 @@ def __mul__(self, other):\n \n     def __truediv__(self, other):\n         return self._combine(other, self.DIV, False)\n-    __div__ = __truediv__ # Python 2 compatibility\n+\n+    def __div__(self, other):  # Python 2 compatibility\n+        return type(self).__truediv__(self, other)\n \n     def __mod__(self, other):\n         return self._combine(other, self.MOD, False)\n@@ -94,7 +96,9 @@ def __rmul__(self, other):\n \n     def __rtruediv__(self, other):\n         return self._combine(other, self.DIV, True)\n-    __rdiv__ = __rtruediv__ # Python 2 compatibility\n+\n+    def __rdiv__(self, other):  # Python 2 compatibility\n+        return type(self).__rtruediv__(self, other)\n \n     def __rmod__(self, other):\n         return self._combine(other, self.MOD, True)\n@@ -151,10 +155,10 @@ class DateModifierNode(ExpressionNode):\n         (A custom function is used in order to preserve six digits of fractional\n         second information on sqlite, and to format both date and datetime values.)\n \n-    Note that microsecond comparisons are not well supported with MySQL, since \n+    Note that microsecond comparisons are not well supported with MySQL, since\n     MySQL does not store microsecond information.\n \n-    Only adding and subtracting timedeltas is supported, attempts to use other \n+    Only adding and subtracting timedeltas is supported, attempts to use other\n     operations raise a TypeError.\n     \"\"\"\n     def __init__(self, children, connector, negated=False):"
        },
        {
            "sha": "3bd426d2b313856a448891ddb692dc1794611206",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 46,
            "deletions": 28,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -54,14 +54,16 @@ class MyModel(Model):\n \n     else:\n         # Look for an \"app.Model\" relation\n-        try:\n-            app_label, model_name = relation.split(\".\")\n-        except ValueError:\n-            # If we can't split, assume a model in current app\n-            app_label = cls._meta.app_label\n-            model_name = relation\n-        except AttributeError:\n-            # If it doesn't have a split it's actually a model class\n+\n+        if isinstance(relation, six.string_types):\n+            try:\n+                app_label, model_name = relation.split(\".\")\n+            except ValueError:\n+                # If we can't split, assume a model in current app\n+                app_label = cls._meta.app_label\n+                model_name = relation\n+        else:\n+            # it's actually a model class\n             app_label = relation._meta.app_label\n             model_name = relation._meta.object_name\n \n@@ -573,9 +575,31 @@ def __init__(self, model=None, query_field_name=None, instance=None, symmetrical\n             self.reverse = reverse\n             self.through = through\n             self.prefetch_cache_name = prefetch_cache_name\n-            self._pk_val = self.instance.pk\n-            if self._pk_val is None:\n-                raise ValueError(\"%r instance needs to have a primary key value before a many-to-many relationship can be used.\" % instance.__class__.__name__)\n+            self._fk_val = self._get_fk_val(instance, source_field_name)\n+            if self._fk_val is None:\n+                raise ValueError('\"%r\" needs to have a value for field \"%s\" before '\n+                                 'this many-to-many relationship can be used.' %\n+                                 (instance, source_field_name))\n+            # Even if this relation is not to pk, we require still pk value.\n+            # The wish is that the instance has been already saved to DB,\n+            # although having a pk value isn't a guarantee of that.\n+            if instance.pk is None:\n+                raise ValueError(\"%r instance needs to have a primary key value before \"\n+                                 \"a many-to-many relationship can be used.\" %\n+                                 instance.__class__.__name__)\n+\n+\n+        def _get_fk_val(self, obj, field_name):\n+            \"\"\"\n+            Returns the correct value for this relationship's foreign key. This\n+            might be something else than pk value when to_field is used.\n+            \"\"\"\n+            fk = self.through._meta.get_field(field_name)\n+            if fk.rel.field_name and fk.rel.field_name != fk.rel.to._meta.pk.attname:\n+                attname = fk.rel.get_related_field().get_attname()\n+                return fk.get_prep_lookup('exact', getattr(obj, attname))\n+            else:\n+                return obj.pk\n \n         def get_query_set(self):\n             try:\n@@ -677,15 +701,19 @@ def _add_items(self, source_field_name, target_field_name, *objs):\n                         if not router.allow_relation(obj, self.instance):\n                             raise ValueError('Cannot add \"%r\": instance is on database \"%s\", value is on database \"%s\"' %\n                                                (obj, self.instance._state.db, obj._state.db))\n-                        new_ids.add(obj.pk)\n+                        fk_val = self._get_fk_val(obj, target_field_name)\n+                        if fk_val is None:\n+                            raise ValueError('Cannot add \"%r\": the value for field \"%s\" is None' %\n+                                             (obj, target_field_name))\n+                        new_ids.add(self._get_fk_val(obj, target_field_name))\n                     elif isinstance(obj, Model):\n                         raise TypeError(\"'%s' instance expected, got %r\" % (self.model._meta.object_name, obj))\n                     else:\n                         new_ids.add(obj)\n                 db = router.db_for_write(self.through, instance=self.instance)\n                 vals = self.through._default_manager.using(db).values_list(target_field_name, flat=True)\n                 vals = vals.filter(**{\n-                    source_field_name: self._pk_val,\n+                    source_field_name: self._fk_val,\n                     '%s__in' % target_field_name: new_ids,\n                 })\n                 new_ids = new_ids - set(vals)\n@@ -699,11 +727,12 @@ def _add_items(self, source_field_name, target_field_name, *objs):\n                 # Add the ones that aren't there already\n                 self.through._default_manager.using(db).bulk_create([\n                     self.through(**{\n-                        '%s_id' % source_field_name: self._pk_val,\n+                        '%s_id' % source_field_name: self._fk_val,\n                         '%s_id' % target_field_name: obj_id,\n                     })\n                     for obj_id in new_ids\n                 ])\n+\n                 if self.reverse or source_field_name == self.source_field_name:\n                     # Don't send the signal when we are inserting the\n                     # duplicate data row for symmetrical reverse entries.\n@@ -722,7 +751,7 @@ def _remove_items(self, source_field_name, target_field_name, *objs):\n                 old_ids = set()\n                 for obj in objs:\n                     if isinstance(obj, self.model):\n-                        old_ids.add(obj.pk)\n+                        old_ids.add(self._get_fk_val(obj, target_field_name))\n                     else:\n                         old_ids.add(obj)\n                 # Work out what DB we're operating on\n@@ -736,7 +765,7 @@ def _remove_items(self, source_field_name, target_field_name, *objs):\n                         model=self.model, pk_set=old_ids, using=db)\n                 # Remove the specified objects from the join table\n                 self.through._default_manager.using(db).filter(**{\n-                    source_field_name: self._pk_val,\n+                    source_field_name: self._fk_val,\n                     '%s__in' % target_field_name: old_ids\n                 }).delete()\n                 if self.reverse or source_field_name == self.source_field_name:\n@@ -756,7 +785,7 @@ def _clear_items(self, source_field_name):\n                     instance=self.instance, reverse=self.reverse,\n                     model=self.model, pk_set=None, using=db)\n             self.through._default_manager.using(db).filter(**{\n-                source_field_name: self._pk_val\n+                source_field_name: self._fk_val\n             }).delete()\n             if self.reverse or source_field_name == self.source_field_name:\n                 # Don't send the signal when we are clearing the\n@@ -1026,11 +1055,6 @@ def value_to_string(self, obj):\n     def contribute_to_class(self, cls, name):\n         super(ForeignKey, self).contribute_to_class(cls, name)\n         setattr(cls, self.name, ReverseSingleRelatedObjectDescriptor(self))\n-        if isinstance(self.rel.to, six.string_types):\n-            target = self.rel.to\n-        else:\n-            target = self.rel.to._meta.db_table\n-        cls._meta.duplicate_targets[self.column] = (target, \"o2m\")\n \n     def contribute_to_related_class(self, cls, related):\n         # Internal FK's - i.e., those with a related name ending with '+' -\n@@ -1269,12 +1293,6 @@ def resolve_through_model(field, model, cls):\n                 field.rel.through = model\n             add_lazy_relation(cls, self, self.rel.through, resolve_through_model)\n \n-        if isinstance(self.rel.to, six.string_types):\n-            target = self.rel.to\n-        else:\n-            target = self.rel.to._meta.db_table\n-        cls._meta.duplicate_targets[self.column] = (target, \"m2m\")\n-\n     def contribute_to_related_class(self, cls, related):\n         # Internal M2Ms (i.e., those with a related name ending with '+')\n         # and swapped models don't get a related descriptor."
        },
        {
            "sha": "a36608e3e1d72e70feb8815ef18355c1565eb814",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 15,
            "deletions": 5,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,6 +5,7 @@\n from django.utils.datastructures import SortedDict\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n+from django.utils._os import upath\n from django.utils import six\n \n import imp\n@@ -158,7 +159,7 @@ def get_app_errors(self):\n \n     def get_models(self, app_mod=None,\n                    include_auto_created=False, include_deferred=False,\n-                   only_installed=True):\n+                   only_installed=True, include_swapped=False):\n         \"\"\"\n         Given a module containing models, returns a list of the models.\n         Otherwise returns a list of all installed models.\n@@ -170,8 +171,16 @@ def get_models(self, app_mod=None,\n         By default, models created to satisfy deferred attribute\n         queries are *not* included in the list of models. However, if\n         you specify include_deferred, they will be.\n+\n+        By default, models that aren't part of installed apps will *not*\n+        be included in the list of models. However, if you specify\n+        only_installed=False, they will be.\n+\n+        By default, models that have been swapped out will *not* be\n+        included in the list of models. However, if you specify\n+        include_swapped, they will be.\n         \"\"\"\n-        cache_key = (app_mod, include_auto_created, include_deferred, only_installed)\n+        cache_key = (app_mod, include_auto_created, include_deferred, only_installed, include_swapped)\n         try:\n             return self._get_models_cache[cache_key]\n         except KeyError:\n@@ -194,7 +203,8 @@ def get_models(self, app_mod=None,\n             model_list.extend(\n                 model for model in app.values()\n                 if ((not model._deferred or include_deferred) and\n-                    (not model._meta.auto_created or include_auto_created))\n+                    (not model._meta.auto_created or include_auto_created) and\n+                    (not model._meta.swapped or include_swapped))\n             )\n         self._get_models_cache[cache_key] = model_list\n         return model_list\n@@ -226,8 +236,8 @@ def register_models(self, app_label, *models):\n                 # The same model may be imported via different paths (e.g.\n                 # appname.models and project.appname.models). We use the source\n                 # filename as a means to detect identity.\n-                fname1 = os.path.abspath(sys.modules[model.__module__].__file__)\n-                fname2 = os.path.abspath(sys.modules[model_dict[model_name].__module__].__file__)\n+                fname1 = os.path.abspath(upath(sys.modules[model.__module__].__file__))\n+                fname2 = os.path.abspath(upath(sys.modules[model_dict[model_name].__module__].__file__))\n                 # Since the filename extension could be .py the first time and\n                 # .pyc or .pyo the second time, ignore the extension when\n                 # comparing."
        },
        {
            "sha": "e3b4b7ba1b6a5a281e6506129cf59b1d37d42300",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 14,
            "deletions": 46,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,19 +9,18 @@\n from django.db.models.fields import AutoField, FieldDoesNotExist\n from django.db.models.fields.proxy import OrderWrt\n from django.db.models.loading import get_models, app_cache_ready\n-from django.utils.translation import activate, deactivate_all, get_language, string_concat\n-from django.utils.encoding import force_text, smart_text\n-from django.utils.datastructures import SortedDict\n from django.utils import six\n-from django.utils.encoding import python_2_unicode_compatible\n+from django.utils.datastructures import SortedDict\n+from django.utils.encoding import force_text, smart_text, python_2_unicode_compatible\n+from django.utils.translation import activate, deactivate_all, get_language, string_concat\n \n # Calculate the verbose_name by converting from InitialCaps to \"lowercase with spaces\".\n get_verbose_name = lambda class_name: re.sub('(((?<=[a-z])[A-Z])|([A-Z](?![A-Z]|$)))', ' \\\\1', class_name).lower().strip()\n \n DEFAULT_NAMES = ('verbose_name', 'verbose_name_plural', 'db_table', 'ordering',\n                  'unique_together', 'permissions', 'get_latest_by',\n                  'order_with_respect_to', 'app_label', 'db_tablespace',\n-                 'abstract', 'managed', 'proxy', 'swappable', 'auto_created', 'auto_register')\n+                 'abstract', 'managed', 'proxy', 'swappable', 'auto_created', 'index_together', 'auto_register')\n \n \n @python_2_unicode_compatible\n@@ -34,6 +33,7 @@ def __init__(self, meta, app_label=None):\n         self.db_table = ''\n         self.ordering = []\n         self.unique_together = []\n+        self.index_together = []\n         self.permissions = []\n         self.object_name, self.app_label = None, app_label\n         self.get_latest_by = None\n@@ -58,7 +58,6 @@ def __init__(self, meta, app_label=None):\n         self.concrete_model = None\n         self.swappable = None\n         self.parents = SortedDict()\n-        self.duplicate_targets = {}\n         self.auto_created = False\n \n         # To handle various inheritance situations, we need to track where\n@@ -78,6 +77,7 @@ def contribute_to_class(self, cls, name):\n         from django.db.backends.util import truncate_name\n \n         cls._meta = self\n+        self.model = cls\n         self.installed = re.sub('\\.models$', '', cls.__module__) in settings.INSTALLED_APPS\n         # First, construct the default values for these options.\n         self.object_name = cls.__name__\n@@ -150,24 +150,6 @@ def _prepare(self, model):\n                         auto_created=True)\n                 model.add_to_class('id', auto)\n \n-        # Determine any sets of fields that are pointing to the same targets\n-        # (e.g. two ForeignKeys to the same remote model). The query\n-        # construction code needs to know this. At the end of this,\n-        # self.duplicate_targets will map each duplicate field column to the\n-        # columns it duplicates.\n-        collections = {}\n-        for column, target in six.iteritems(self.duplicate_targets):\n-            try:\n-                collections[target].add(column)\n-            except KeyError:\n-                collections[target] = set([column])\n-        self.duplicate_targets = {}\n-        for elt in six.itervalues(collections):\n-            if len(elt) == 1:\n-                continue\n-            for column in elt:\n-                self.duplicate_targets[column] = elt.difference(set([column]))\n-\n     def add_field(self, field):\n         # Insert the given field in the order in which it was created, using\n         # the \"creation_counter\" attribute of the field.\n@@ -195,6 +177,12 @@ def setup_pk(self, field):\n             self.pk = field\n             field.serialize = False\n \n+    def pk_index(self):\n+        \"\"\"\n+        Returns the index of the primary key field in the self.fields list.\n+        \"\"\"\n+        return self.fields.index(self.pk)\n+\n     def setup_proxy(self, target):\n         \"\"\"\n         Does the internal setup so that the current model is a proxy for\n@@ -481,16 +469,15 @@ def get_base_chain(self, model):\n         a granparent or even more distant relation.\n         \"\"\"\n         if not self.parents:\n-            return\n+            return None\n         if model in self.parents:\n             return [model]\n         for parent in self.parents:\n             res = parent._meta.get_base_chain(model)\n             if res:\n                 res.insert(0, parent)\n                 return res\n-        raise TypeError('%r is not an ancestor of this model'\n-                % model._meta.module_name)\n+        return None\n \n     def get_parent_list(self):\n         \"\"\"\n@@ -522,22 +509,3 @@ def get_ancestor_link(self, ancestor):\n                 # of the chain to the ancestor is that parent\n                 # links\n                 return self.parents[parent] or parent_link\n-\n-    def get_ordered_objects(self):\n-        \"Returns a list of Options objects that are ordered with respect to this object.\"\n-        if not hasattr(self, '_ordered_objects'):\n-            objects = []\n-            # TODO\n-            #for klass in get_models(get_app(self.app_label)):\n-            #    opts = klass._meta\n-            #    if opts.order_with_respect_to and opts.order_with_respect_to.rel \\\n-            #        and self == opts.order_with_respect_to.rel.to._meta:\n-            #        objects.append(opts)\n-            self._ordered_objects = objects\n-        return self._ordered_objects\n-\n-    def pk_index(self):\n-        \"\"\"\n-        Returns the index of the primary key field in the self.fields list.\n-        \"\"\"\n-        return self.fields.index(self.pk)"
        },
        {
            "sha": "f56d5d2842fba8756874b61a5d4fb8064a2e7c5e",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 72,
            "deletions": 45,
            "changes": 117,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,6 +5,7 @@\n import copy\n import itertools\n import sys\n+import warnings\n \n from django.core import exceptions\n from django.db import connections, router, transaction, IntegrityError\n@@ -135,7 +136,9 @@ def __bool__(self):\n         except StopIteration:\n             return False\n         return True\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     def __contains__(self, val):\n         # The 'in' operator works without this method, due to __iter__. This\n@@ -698,6 +701,9 @@ def select_related(self, *fields, **kwargs):\n         If fields are specified, they must be ForeignKey fields and only those\n         related objects are included in the selection.\n         \"\"\"\n+        if 'depth' in kwargs:\n+            warnings.warn('The \"depth\" keyword argument has been deprecated.\\n'\n+                    'Use related field names instead.', PendingDeprecationWarning)\n         depth = kwargs.pop('depth', 0)\n         if kwargs:\n             raise TypeError('Unexpected keyword arguments to select_related: %s'\n@@ -1071,7 +1077,7 @@ def _setup_aggregate_query(self, aggregates):\n \n     def _as_sql(self, connection):\n         \"\"\"\n-        For ValueQuerySet (and subclasses like ValuesListQuerySet), they can\n+        For ValuesQuerySet (and subclasses like ValuesListQuerySet), they can\n         only be used as nested queries if they're already set up to select only\n         a single field (in which case, that is the field column that is\n         returned). This differs from QuerySet.as_sql(), where the column to\n@@ -1294,7 +1300,7 @@ def values_list(self, *fields, **kwargs):\n     value_annotation = False\n \n def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n-                   only_load=None, local_only=False):\n+                   only_load=None, from_parent=None):\n     \"\"\"\n     Helper function that recursively returns an information for a klass, to be\n     used in get_cached_row.  It exists just to compute this information only\n@@ -1314,8 +1320,10 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n      * only_load - if the query has had only() or defer() applied,\n        this is the list of field names that will be returned. If None,\n        the full field list for `klass` can be assumed.\n-     * local_only - Only populate local fields. This is used when\n-       following reverse select-related relations\n+     * from_parent - the parent model used to get to this model\n+\n+    Note that when travelling from parent to child, we will only load child\n+    fields which aren't in the parent.\n     \"\"\"\n     if max_depth and requested is None and cur_depth > max_depth:\n         # We've recursed deeply enough; stop now.\n@@ -1341,7 +1349,9 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n         for field, model in klass._meta.get_fields_with_model():\n             if field.name not in load_fields:\n                 skip.add(field.attname)\n-            elif local_only and model is not None:\n+            elif from_parent and issubclass(from_parent, model.__class__):\n+                # Avoid loading fields already loaded for parent model for\n+                # child models.\n                 continue\n             else:\n                 init_list.append(field.attname)\n@@ -1355,16 +1365,22 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n     else:\n         # Load all fields on klass\n \n-        # We trying to not populate field_names variable for perfomance reason.\n-        # If field_names variable is set, it is used to instantiate desired fields,\n-        # by passing **dict(zip(field_names, fields)) as kwargs to Model.__init__ method.\n-        # But kwargs version of Model.__init__ is slower, so we should avoid using\n-        # it when it is not really neccesary.\n-        if local_only and len(klass._meta.local_fields) != len(klass._meta.fields):\n-            field_count = len(klass._meta.local_fields)\n-            field_names = [f.attname for f in klass._meta.local_fields]\n-        else:\n-            field_count = len(klass._meta.fields)\n+        field_count = len(klass._meta.fields)\n+        # Check if we need to skip some parent fields.\n+        if from_parent and len(klass._meta.local_fields) != len(klass._meta.fields):\n+            # Only load those fields which haven't been already loaded into\n+            # 'from_parent'.\n+            non_seen_models = [p for p in klass._meta.get_parent_list()\n+                               if not issubclass(from_parent, p)]\n+            # Load local fields, too...\n+            non_seen_models.append(klass)\n+            field_names = [f.attname for f in klass._meta.fields\n+                           if f.model in non_seen_models]\n+            field_count = len(field_names)\n+        # Try to avoid populating field_names variable for perfomance reasons.\n+        # If field_names variable is set, we use **kwargs based model init\n+        # which is slower than normal init.\n+        if field_count == len(klass._meta.fields):\n             field_names = ()\n \n     restricted = requested is not None\n@@ -1386,14 +1402,20 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n             if o.field.unique and select_related_descend(o.field, restricted, requested,\n                                                          only_load.get(o.model), reverse=True):\n                 next = requested[o.field.related_query_name()]\n+                parent = klass if issubclass(o.model, klass) else None\n                 klass_info = get_klass_info(o.model, max_depth=max_depth, cur_depth=cur_depth+1,\n-                                            requested=next, only_load=only_load, local_only=True)\n+                                            requested=next, only_load=only_load, from_parent=parent)\n                 reverse_related_fields.append((o.field, klass_info))\n+    if field_names:\n+        pk_idx = field_names.index(klass._meta.pk.attname)\n+    else:\n+        pk_idx = klass._meta.pk_index()\n \n-    return klass, field_names, field_count, related_fields, reverse_related_fields\n+    return klass, field_names, field_count, related_fields, reverse_related_fields, pk_idx\n \n \n-def get_cached_row(row, index_start, using,  klass_info, offset=0):\n+def get_cached_row(row, index_start, using,  klass_info, offset=0,\n+                   parent_data=()):\n     \"\"\"\n     Helper function that recursively returns an object with the specified\n     related attributes already populated.\n@@ -1408,25 +1430,29 @@ def get_cached_row(row, index_start, using,  klass_info, offset=0):\n          * offset - the number of additional fields that are known to\n            exist in row for `klass`. This usually means the number of\n            annotated results on `klass`.\n-        * using - the database alias on which the query is being executed.\n+         * using - the database alias on which the query is being executed.\n          * klass_info - result of the get_klass_info function\n+         * parent_data - parent model data in format (field, value). Used\n+           to populate the non-local fields of child models.\n     \"\"\"\n     if klass_info is None:\n         return None\n-    klass, field_names, field_count, related_fields, reverse_related_fields = klass_info\n+    klass, field_names, field_count, related_fields, reverse_related_fields, pk_idx = klass_info\n+\n \n     fields = row[index_start : index_start + field_count]\n-    # If all the select_related columns are None, then the related\n+    # If the pk column is None (or the Oracle equivalent ''), then the related\n     # object must be non-existent - set the relation to None.\n-    # Otherwise, construct the related object.\n-    if fields == (None,) * field_count:\n+    if fields[pk_idx] == None or fields[pk_idx] == '':\n         obj = None\n+    elif field_names:\n+        fields = list(fields)\n+        for rel_field, value in parent_data:\n+            field_names.append(rel_field.attname)\n+            fields.append(value)\n+        obj = klass(**dict(zip(field_names, fields)))\n     else:\n-        if field_names:\n-            obj = klass(**dict(zip(field_names, fields)))\n-        else:\n-            obj = klass(*fields)\n-\n+        obj = klass(*fields)\n     # If an object was retrieved, set the database state.\n     if obj:\n         obj._state.db = using\n@@ -1456,34 +1482,35 @@ def get_cached_row(row, index_start, using,  klass_info, offset=0):\n     # Only handle the restricted case - i.e., don't do a depth\n     # descent into reverse relations unless explicitly requested\n     for f, klass_info in reverse_related_fields:\n+        # Transfer data from this object to childs.\n+        parent_data = []\n+        for rel_field, rel_model in klass_info[0]._meta.get_fields_with_model():\n+            if rel_model is not None and isinstance(obj, rel_model):\n+                parent_data.append((rel_field, getattr(obj, rel_field.attname)))\n         # Recursively retrieve the data for the related object\n-        cached_row = get_cached_row(row, index_end, using, klass_info)\n+        cached_row = get_cached_row(row, index_end, using, klass_info,\n+                                   parent_data=parent_data)\n         # If the recursive descent found an object, populate the\n         # descriptor caches relevant to the object\n         if cached_row:\n             rel_obj, index_end = cached_row\n             if obj is not None:\n-                # If the field is unique, populate the\n-                # reverse descriptor cache\n+                # populate the reverse descriptor cache\n                 setattr(obj, f.related.get_cache_name(), rel_obj)\n             if rel_obj is not None:\n                 # If the related object exists, populate\n                 # the descriptor cache.\n                 setattr(rel_obj, f.get_cache_name(), obj)\n-                # Now populate all the non-local field values\n-                # on the related object\n-                for rel_field, rel_model in rel_obj._meta.get_fields_with_model():\n-                    if rel_model is not None:\n+                # Populate related object caches using parent data.\n+                for rel_field, _ in parent_data:\n+                    if rel_field.rel:\n                         setattr(rel_obj, rel_field.attname, getattr(obj, rel_field.attname))\n-                        # populate the field cache for any related object\n-                        # that has already been retrieved\n-                        if rel_field.rel:\n-                            try:\n-                                cached_obj = getattr(obj, rel_field.get_cache_name())\n-                                setattr(rel_obj, rel_field.get_cache_name(), cached_obj)\n-                            except AttributeError:\n-                                # Related object hasn't been cached yet\n-                                pass\n+                        try:\n+                            cached_obj = getattr(obj, rel_field.get_cache_name())\n+                            setattr(rel_obj, rel_field.get_cache_name(), cached_obj)\n+                        except AttributeError:\n+                            # Related object hasn't been cached yet\n+                            pass\n     return obj, index_end\n \n "
        },
        {
            "sha": "2ef54a7ca780a4f91f377985e3171ecb7ca6c42c",
            "filename": "django/db/models/signals.py",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsignals.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -2,15 +2,16 @@\n \n class_prepared = Signal(providing_args=[\"class\"])\n \n-pre_init = Signal(providing_args=[\"instance\", \"args\", \"kwargs\"])\n-post_init = Signal(providing_args=[\"instance\"])\n+pre_init = Signal(providing_args=[\"instance\", \"args\", \"kwargs\"], use_caching=True)\n+post_init = Signal(providing_args=[\"instance\"], use_caching=True)\n \n-pre_save = Signal(providing_args=[\"instance\", \"raw\", \"using\", \"update_fields\"])\n-post_save = Signal(providing_args=[\"instance\", \"raw\", \"created\", \"using\", \"update_fields\"])\n+pre_save = Signal(providing_args=[\"instance\", \"raw\", \"using\", \"update_fields\"],\n+                 use_caching=True)\n+post_save = Signal(providing_args=[\"instance\", \"raw\", \"created\", \"using\", \"update_fields\"], use_caching=True)\n \n-pre_delete = Signal(providing_args=[\"instance\", \"using\"])\n-post_delete = Signal(providing_args=[\"instance\", \"using\"])\n+pre_delete = Signal(providing_args=[\"instance\", \"using\"], use_caching=True)\n+post_delete = Signal(providing_args=[\"instance\", \"using\"], use_caching=True)\n \n-post_syncdb = Signal(providing_args=[\"class\", \"app\", \"created_models\", \"verbosity\", \"interactive\"])\n+post_syncdb = Signal(providing_args=[\"class\", \"app\", \"created_models\", \"verbosity\", \"interactive\"], use_caching=True)\n \n-m2m_changed = Signal(providing_args=[\"action\", \"instance\", \"reverse\", \"model\", \"pk_set\", \"using\"])\n+m2m_changed = Signal(providing_args=[\"action\", \"instance\", \"reverse\", \"model\", \"pk_set\", \"using\"], use_caching=True)"
        },
        {
            "sha": "4d846fb438fe5700066feefff8476541a4d53e20",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 79,
            "deletions": 112,
            "changes": 191,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,7 +6,7 @@\n from django.db.models.constants import LOOKUP_SEP\n from django.db.models.query_utils import select_related_descend\n from django.db.models.sql.constants import (SINGLE, MULTI, ORDER_DIR,\n-        GET_ITERATOR_CHUNK_SIZE)\n+        GET_ITERATOR_CHUNK_SIZE, REUSE_ALL, SelectInfo)\n from django.db.models.sql.datastructures import EmptyResultSet\n from django.db.models.sql.expressions import SQLEvaluator\n from django.db.models.sql.query import get_order_dir, Query\n@@ -103,21 +103,12 @@ def as_sql(self, with_limits=True, with_col_aliases=False):\n             result.append('WHERE %s' % where)\n             params.extend(w_params)\n \n-        grouping, gb_params = self.get_grouping()\n+        grouping, gb_params = self.get_grouping(ordering_group_by)\n         if grouping:\n             if distinct_fields:\n                 raise NotImplementedError(\n                     \"annotate() + distinct(fields) not implemented.\")\n-            if ordering:\n-                # If the backend can't group by PK (i.e., any database\n-                # other than MySQL), then any fields mentioned in the\n-                # ordering clause needs to be in the group by clause.\n-                if not self.connection.features.allows_group_by_pk:\n-                    for col, col_params in ordering_group_by:\n-                        if col not in grouping:\n-                            grouping.append(str(col))\n-                            gb_params.extend(col_params)\n-            else:\n+            if not ordering:\n                 ordering = self.connection.ops.force_no_ordering()\n             result.append('GROUP BY %s' % ', '.join(grouping))\n             params.extend(gb_params)\n@@ -188,7 +179,7 @@ def get_columns(self, with_aliases=False):\n             col_aliases = set()\n         if self.query.select:\n             only_load = self.deferred_to_columns()\n-            for col in self.query.select:\n+            for col, _ in self.query.select:\n                 if isinstance(col, (list, tuple)):\n                     alias, column = col\n                     table = self.query.alias_map[alias].table_name\n@@ -233,7 +224,7 @@ def get_columns(self, with_aliases=False):\n             for alias, aggregate in self.query.aggregate_select.items()\n         ])\n \n-        for table, col in self.query.related_select_cols:\n+        for (table, col), _ in self.query.related_select_cols:\n             r = '%s.%s' % (qn(table), qn(col))\n             if with_aliases and col in col_aliases:\n                 c_alias = 'Col%d' % len(col_aliases)\n@@ -249,7 +240,7 @@ def get_columns(self, with_aliases=False):\n         return result\n \n     def get_default_columns(self, with_aliases=False, col_aliases=None,\n-            start_alias=None, opts=None, as_pairs=False, local_only=False):\n+            start_alias=None, opts=None, as_pairs=False, from_parent=None):\n         \"\"\"\n         Computes the default columns for selecting every field in the base\n         model. Will sometimes be called to pull in related models (e.g. via\n@@ -274,15 +265,17 @@ def get_default_columns(self, with_aliases=False, col_aliases=None,\n         if start_alias:\n             seen = {None: start_alias}\n         for field, model in opts.get_fields_with_model():\n-            if local_only and model is not None:\n+            if from_parent and model is not None and issubclass(from_parent, model):\n+                # Avoid loading data for already loaded parents.\n                 continue\n             if start_alias:\n                 try:\n                     alias = seen[model]\n                 except KeyError:\n                     link_field = opts.get_ancestor_link(model)\n                     alias = self.query.join((start_alias, model._meta.db_table,\n-                            link_field.column, model._meta.pk.column))\n+                            link_field.column, model._meta.pk.column),\n+                            join_field=link_field)\n                     seen[model] = alias\n             else:\n                 # If we're starting from the base model of the queryset, the\n@@ -378,7 +371,7 @@ def get_ordering(self):\n                 else:\n                     order = asc\n                 result.append('%s %s' % (field, order))\n-                group_by.append((field, []))\n+                group_by.append((str(field), []))\n                 continue\n             col, order = get_order_dir(field, asc)\n             if col in self.query.aggregate_select:\n@@ -456,8 +449,8 @@ def _setup_joins(self, pieces, opts, alias):\n         \"\"\"\n         if not alias:\n             alias = self.query.get_initial_alias()\n-        field, target, opts, joins, _, _ = self.query.setup_joins(pieces,\n-                opts, alias, False)\n+        field, target, opts, joins, _ = self.query.setup_joins(\n+            pieces, opts, alias, REUSE_ALL)\n         # We will later on need to promote those joins that were added to the\n         # query afresh above.\n         joins_to_promote = [j for j in joins if self.query.alias_refcount[j] < 2]\n@@ -509,20 +502,27 @@ def get_from_clause(self):\n         qn = self.quote_name_unless_alias\n         qn2 = self.connection.ops.quote_name\n         first = True\n+        from_params = []\n         for alias in self.query.tables:\n             if not self.query.alias_refcount[alias]:\n                 continue\n             try:\n-                name, alias, join_type, lhs, lhs_col, col, nullable = self.query.alias_map[alias]\n+                name, alias, join_type, lhs, lhs_col, col, _, join_field = self.query.alias_map[alias]\n             except KeyError:\n                 # Extra tables can end up in self.tables, but not in the\n                 # alias_map if they aren't in a join. That's OK. We skip them.\n                 continue\n             alias_str = (alias != name and ' %s' % alias or '')\n             if join_type and not first:\n-                result.append('%s %s%s ON (%s.%s = %s.%s)'\n-                        % (join_type, qn(name), alias_str, qn(lhs),\n-                           qn2(lhs_col), qn(alias), qn2(col)))\n+                if join_field and hasattr(join_field, 'get_extra_join_sql'):\n+                    extra_cond, extra_params = join_field.get_extra_join_sql(\n+                        self.connection, qn, lhs, alias)\n+                    from_params.extend(extra_params)\n+                else:\n+                    extra_cond = \"\"\n+                result.append('%s %s%s ON (%s.%s = %s.%s%s)' %\n+                              (join_type, qn(name), alias_str, qn(lhs),\n+                               qn2(lhs_col), qn(alias), qn2(col), extra_cond))\n             else:\n                 connector = not first and ', ' or ''\n                 result.append('%s%s%s' % (connector, qn(name), alias_str))\n@@ -536,45 +536,58 @@ def get_from_clause(self):\n                 connector = not first and ', ' or ''\n                 result.append('%s%s' % (connector, qn(alias)))\n                 first = False\n-        return result, []\n+        return result, from_params\n \n-    def get_grouping(self):\n+    def get_grouping(self, ordering_group_by):\n         \"\"\"\n         Returns a tuple representing the SQL elements in the \"group by\" clause.\n         \"\"\"\n         qn = self.quote_name_unless_alias\n         result, params = [], []\n         if self.query.group_by is not None:\n-            if (len(self.query.model._meta.fields) == len(self.query.select) and\n-                self.connection.features.allows_group_by_pk):\n+            select_cols = self.query.select + self.query.related_select_cols\n+            # Just the column, not the fields.\n+            select_cols = [s[0] for s in select_cols]\n+            if (len(self.query.model._meta.fields) == len(self.query.select)\n+                    and self.connection.features.allows_group_by_pk):\n                 self.query.group_by = [\n                     (self.query.model._meta.db_table, self.query.model._meta.pk.column)\n                 ]\n-\n-            group_by = self.query.group_by or []\n-\n-            extra_selects = []\n-            for extra_select, extra_params in six.itervalues(self.query.extra_select):\n-                extra_selects.append(extra_select)\n-                params.extend(extra_params)\n-            cols = (group_by + self.query.select +\n-                self.query.related_select_cols + extra_selects)\n+                select_cols = []\n             seen = set()\n+            cols = self.query.group_by + select_cols\n             for col in cols:\n-                if col in seen:\n-                    continue\n-                seen.add(col)\n                 if isinstance(col, (list, tuple)):\n-                    result.append('%s.%s' % (qn(col[0]), qn(col[1])))\n+                    sql = '%s.%s' % (qn(col[0]), qn(col[1]))\n                 elif hasattr(col, 'as_sql'):\n-                    result.append(col.as_sql(qn, self.connection))\n+                    sql = col.as_sql(qn, self.connection)\n                 else:\n-                    result.append('(%s)' % str(col))\n+                    sql = '(%s)' % str(col)\n+                if sql not in seen:\n+                    result.append(sql)\n+                    seen.add(sql)\n+\n+            # Still, we need to add all stuff in ordering (except if the backend can\n+            # group by just by PK).\n+            if ordering_group_by and not self.connection.features.allows_group_by_pk:\n+                for order, order_params in ordering_group_by:\n+                    # Even if we have seen the same SQL string, it might have\n+                    # different params, so, we add same SQL in \"has params\" case.\n+                    if order not in seen or params:\n+                        result.append(order)\n+                        params.extend(order_params)\n+                        seen.add(order)\n+\n+            # Unconditionally add the extra_select items.\n+            for extra_select, extra_params in self.query.extra_select.values():\n+                sql = '(%s)' % str(extra_select)\n+                result.append(sql)\n+                params.extend(extra_params)\n+\n         return result, params\n \n     def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n-            used=None, requested=None, restricted=None, nullable=None,\n-            dupe_set=None, avoid_set=None):\n+            requested=None, restricted=None, nullable=None):\n         \"\"\"\n         Fill in the information needed for a select_related query. The current\n         depth is measured as the number of connections away from the root model\n@@ -589,14 +602,6 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n             opts = self.query.get_meta()\n             root_alias = self.query.get_initial_alias()\n             self.query.related_select_cols = []\n-            self.query.related_select_fields = []\n-        if not used:\n-            used = set()\n-        if dupe_set is None:\n-            dupe_set = set()\n-        if avoid_set is None:\n-            avoid_set = set()\n-        orig_dupe_set = dupe_set\n         only_load = self.query.get_loaded_field_names()\n \n         # Setup for the case when only particular related fields should be\n@@ -616,12 +621,6 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n             if not select_related_descend(f, restricted, requested,\n                                           only_load.get(field_model)):\n                 continue\n-            # The \"avoid\" set is aliases we want to avoid just for this\n-            # particular branch of the recursion. They aren't permanently\n-            # forbidden from reuse in the related selection tables (which is\n-            # what \"used\" specifies).\n-            avoid = avoid_set.copy()\n-            dupe_set = orig_dupe_set.copy()\n             table = f.rel.to._meta.db_table\n             promote = nullable or f.null\n             if model:\n@@ -637,44 +636,28 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                         int_opts = int_model._meta\n                         continue\n                     lhs_col = int_opts.parents[int_model].column\n-                    dedupe = lhs_col in opts.duplicate_targets\n-                    if dedupe:\n-                        avoid.update(self.query.dupe_avoidance.get((id(opts), lhs_col),\n-                                ()))\n-                        dupe_set.add((opts, lhs_col))\n                     int_opts = int_model._meta\n                     alias = self.query.join((alias, int_opts.db_table, lhs_col,\n-                            int_opts.pk.column), exclusions=used,\n+                            int_opts.pk.column),\n                             promote=promote)\n                     alias_chain.append(alias)\n-                    for (dupe_opts, dupe_col) in dupe_set:\n-                        self.query.update_dupe_avoidance(dupe_opts, dupe_col, alias)\n             else:\n                 alias = root_alias\n \n-            dedupe = f.column in opts.duplicate_targets\n-            if dupe_set or dedupe:\n-                avoid.update(self.query.dupe_avoidance.get((id(opts), f.column), ()))\n-                if dedupe:\n-                    dupe_set.add((opts, f.column))\n-\n             alias = self.query.join((alias, table, f.column,\n                     f.rel.get_related_field().column),\n-                    exclusions=used.union(avoid), promote=promote)\n-            used.add(alias)\n+                    promote=promote, join_field=f)\n             columns, aliases = self.get_default_columns(start_alias=alias,\n                     opts=f.rel.to._meta, as_pairs=True)\n-            self.query.related_select_cols.extend(columns)\n-            self.query.related_select_fields.extend(f.rel.to._meta.fields)\n+            self.query.related_select_cols.extend(\n+                SelectInfo(col, field) for col, field in zip(columns, f.rel.to._meta.fields))\n             if restricted:\n                 next = requested.get(f.name, {})\n             else:\n                 next = False\n             new_nullable = f.null or promote\n-            for dupe_opts, dupe_col in dupe_set:\n-                self.query.update_dupe_avoidance(dupe_opts, dupe_col, alias)\n             self.fill_related_selections(f.rel.to._meta, alias, cur_depth + 1,\n-                    used, next, restricted, new_nullable, dupe_set, avoid)\n+                    next, restricted, new_nullable)\n \n         if restricted:\n             related_fields = [\n@@ -686,14 +669,8 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                 if not select_related_descend(f, restricted, requested,\n                                               only_load.get(model), reverse=True):\n                     continue\n-                # The \"avoid\" set is aliases we want to avoid just for this\n-                # particular branch of the recursion. They aren't permanently\n-                # forbidden from reuse in the related selection tables (which is\n-                # what \"used\" specifies).\n-                avoid = avoid_set.copy()\n-                dupe_set = orig_dupe_set.copy()\n-                table = model._meta.db_table\n \n+                table = model._meta.db_table\n                 int_opts = opts\n                 alias = root_alias\n                 alias_chain = []\n@@ -708,42 +685,30 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                             int_opts = int_model._meta\n                             continue\n                         lhs_col = int_opts.parents[int_model].column\n-                        dedupe = lhs_col in opts.duplicate_targets\n-                        if dedupe:\n-                            avoid.update((self.query.dupe_avoidance.get(id(opts), lhs_col),\n-                                ()))\n-                            dupe_set.add((opts, lhs_col))\n                         int_opts = int_model._meta\n                         alias = self.query.join(\n                             (alias, int_opts.db_table, lhs_col, int_opts.pk.column),\n-                            exclusions=used, promote=True, reuse=used\n+                            promote=True,\n                         )\n                         alias_chain.append(alias)\n-                        for dupe_opts, dupe_col in dupe_set:\n-                            self.query.update_dupe_avoidance(dupe_opts, dupe_col, alias)\n-                    dedupe = f.column in opts.duplicate_targets\n-                    if dupe_set or dedupe:\n-                        avoid.update(self.query.dupe_avoidance.get((id(opts), f.column), ()))\n-                        if dedupe:\n-                            dupe_set.add((opts, f.column))\n                 alias = self.query.join(\n                     (alias, table, f.rel.get_related_field().column, f.column),\n-                    exclusions=used.union(avoid),\n-                    promote=True\n+                    promote=True, join_field=f\n                 )\n-                used.add(alias)\n+                from_parent = (opts.model if issubclass(model, opts.model)\n+                               else None)\n                 columns, aliases = self.get_default_columns(start_alias=alias,\n-                    opts=model._meta, as_pairs=True, local_only=True)\n-                self.query.related_select_cols.extend(columns)\n-                self.query.related_select_fields.extend(model._meta.fields)\n-\n+                    opts=model._meta, as_pairs=True, from_parent=from_parent)\n+                self.query.related_select_cols.extend(\n+                    SelectInfo(col, field) for col, field\n+                    in zip(columns, model._meta.fields))\n                 next = requested.get(f.related_query_name(), {})\n                 # Use True here because we are looking at the _reverse_ side of\n                 # the relation, which is always nullable.\n                 new_nullable = True\n \n                 self.fill_related_selections(model._meta, table, cur_depth+1,\n-                    used, next, restricted, new_nullable)\n+                    next, restricted, new_nullable)\n \n     def deferred_to_columns(self):\n         \"\"\"\n@@ -772,7 +737,7 @@ def results_iter(self):\n                 if resolve_columns:\n                     if fields is None:\n                         # We only set this up here because\n-                        # related_select_fields isn't populated until\n+                        # related_select_cols isn't populated until\n                         # execute_sql() has been called.\n \n                         # We also include types of fields of related models that\n@@ -782,11 +747,11 @@ def results_iter(self):\n \n                         # This code duplicates the logic for the order of fields\n                         # found in get_columns(). It would be nice to clean this up.\n-                        if self.query.select_fields:\n-                            fields = self.query.select_fields\n+                        if self.query.select:\n+                            fields = [f.field for f in self.query.select]\n                         else:\n                             fields = self.query.model._meta.fields\n-                        fields = fields + self.query.related_select_fields\n+                        fields = fields + [f.field for f in self.query.related_select_cols]\n \n                         # If the field was deferred, exclude it from being passed\n                         # into `resolve_columns` because it wasn't selected.\n@@ -902,6 +867,8 @@ def as_sql(self):\n                 [self.placeholder(field, v) for field, v in zip(fields, val)]\n                 for val in values\n             ]\n+            # Oracle Spatial needs to remove some values due to #10888\n+            params = self.connection.ops.modify_insert_params(placeholders, params)\n         if self.return_id and self.connection.features.can_return_id_from_insert:\n             params = params[0]\n             col = \"%s.%s\" % (qn(opts.db_table), qn(opts.pk.column))"
        },
        {
            "sha": "1c34f7016915a03c8f95224b20ffd4cd20d5b85a",
            "filename": "django/db/models/sql/constants.py",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fconstants.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fconstants.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fconstants.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,12 +18,22 @@\n # Larger values are slightly faster at the expense of more storage space.\n GET_ITERATOR_CHUNK_SIZE = 100\n \n-# Constants to make looking up tuple values clearer.\n+# Namedtuples for sql.* internal use.\n+\n # Join lists (indexes into the tuples that are values in the alias_map\n # dictionary in the Query class).\n JoinInfo = namedtuple('JoinInfo',\n                       'table_name rhs_alias join_type lhs_alias '\n-                      'lhs_join_col rhs_join_col nullable')\n+                      'lhs_join_col rhs_join_col nullable join_field')\n+\n+# PathInfo is used when converting lookups (fk__somecol). The contents\n+# describe the join in Model terms (model Options and Fields for both\n+# sides of the join. The rel_field is the field we are joining along.\n+PathInfo = namedtuple('PathInfo',\n+                      'from_field to_field from_opts to_opts join_field')\n+\n+# Pairs of column clauses to select, and (possibly None) field for the clause.\n+SelectInfo = namedtuple('SelectInfo', 'col field')\n \n # How many results to expect from a cursor.execute call\n MULTI = 'multi'\n@@ -34,3 +44,6 @@\n     'ASC': ('ASC', 'DESC'),\n     'DESC': ('DESC', 'ASC'),\n }\n+\n+# A marker for join-reusability.\n+REUSE_ALL = object()"
        },
        {
            "sha": "af7e45e74e26eb1983aca42ec9093ba264fa296e",
            "filename": "django/db/models/sql/expressions.py",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fexpressions.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fexpressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fexpressions.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,14 +1,16 @@\n from django.core.exceptions import FieldError\n from django.db.models.constants import LOOKUP_SEP\n from django.db.models.fields import FieldDoesNotExist\n+from django.db.models.sql.constants import REUSE_ALL\n \n class SQLEvaluator(object):\n-    def __init__(self, expression, query, allow_joins=True):\n+    def __init__(self, expression, query, allow_joins=True, reuse=REUSE_ALL):\n         self.expression = expression\n         self.opts = query.get_meta()\n         self.cols = []\n \n         self.contains_aggregate = False\n+        self.reuse = reuse\n         self.expression.prepare(self, query, allow_joins)\n \n     def prepare(self):\n@@ -48,11 +50,12 @@ def prepare_leaf(self, node, query, allow_joins):\n             self.cols.append((node, query.aggregate_select[node.name]))\n         else:\n             try:\n-                field, source, opts, join_list, last, _ = query.setup_joins(\n+                field, source, opts, join_list, path = query.setup_joins(\n                     field_list, query.get_meta(),\n-                    query.get_initial_alias(), False)\n-                col, _, join_list = query.trim_joins(source, join_list, last, False)\n-\n+                    query.get_initial_alias(), self.reuse)\n+                col, _, join_list = query.trim_joins(source, join_list, path)\n+                if self.reuse is not None and self.reuse != REUSE_ALL:\n+                    self.reuse.update(join_list)\n                 self.cols.append((node, (join_list[-1], col)))\n             except FieldDoesNotExist:\n                 raise FieldError(\"Cannot resolve keyword %r into field. \""
        },
        {
            "sha": "ff56211c5dc5d7336323daf8799aea757873a907",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 378,
            "deletions": 404,
            "changes": 782,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,13 +14,13 @@\n from django.utils.tree import Node\n from django.utils import six\n from django.db import connections, DEFAULT_DB_ALIAS\n-from django.db.models import signals\n from django.db.models.constants import LOOKUP_SEP\n from django.db.models.expressions import ExpressionNode\n from django.db.models.fields import FieldDoesNotExist\n+from django.db.models.loading import get_model\n from django.db.models.sql import aggregates as base_aggregates_module\n from django.db.models.sql.constants import (QUERY_TERMS, ORDER_DIR, SINGLE,\n-        ORDER_PATTERN, JoinInfo)\n+        ORDER_PATTERN, REUSE_ALL, JoinInfo, SelectInfo, PathInfo)\n from django.db.models.sql.datastructures import EmptyResultSet, Empty, MultiJoin\n from django.db.models.sql.expressions import SQLEvaluator\n from django.db.models.sql.where import (WhereNode, Constraint, EverythingNode,\n@@ -103,7 +103,7 @@ class Query(object):\n \n     def __init__(self, model, where=WhereNode):\n         self.model = model\n-        self.alias_refcount = SortedDict()\n+        self.alias_refcount = {}\n         # alias_map is the most important data structure regarding joins.\n         # It's used for recording which joins exist in the query and what\n         # type they are. The key is the alias of the joined table (possibly\n@@ -115,17 +115,19 @@ def __init__(self, model, where=WhereNode):\n         self.default_ordering = True\n         self.standard_ordering = True\n         self.ordering_aliases = []\n-        self.related_select_fields = []\n-        self.dupe_avoidance = {}\n         self.used_aliases = set()\n         self.filter_is_sticky = False\n         self.included_inherited_models = {}\n \n         # SQL-related attributes\n+        # Select and related select clauses as SelectInfo instances.\n+        # The select is used for cases where we want to set up the select\n+        # clause to contain other than default fields (values(), annotate(),\n+        # subqueries...)\n         self.select = []\n-        # For each to-be-selected field in self.select there must be a\n-        # corresponding entry in self.select - git seems to need this.\n-        self.select_fields = []\n+        # The related_select_cols is used for columns needed for\n+        # select_related - this is populated in compile stage.\n+        self.related_select_cols = []\n         self.tables = []    # Aliases in the order they are created.\n         self.where = where()\n         self.where_class = where\n@@ -138,7 +140,6 @@ def __init__(self, model, where=WhereNode):\n         self.select_for_update = False\n         self.select_for_update_nowait = False\n         self.select_related = False\n-        self.related_select_cols = []\n \n         # SQL aggregate-related attributes\n         self.aggregates = SortedDict() # Maps alias -> SQL aggregate function\n@@ -191,16 +192,25 @@ def __getstate__(self):\n         Pickling support.\n         \"\"\"\n         obj_dict = self.__dict__.copy()\n-        obj_dict['related_select_fields'] = []\n         obj_dict['related_select_cols'] = []\n \n         # Fields can't be pickled, so if a field list has been\n         # specified, we pickle the list of field names instead.\n         # None is also a possible value; that can pass as-is\n-        obj_dict['select_fields'] = [\n-            f is not None and f.name or None\n-            for f in obj_dict['select_fields']\n+        obj_dict['select'] = [\n+            (s.col, s.field is not None and s.field.name or None)\n+            for s in obj_dict['select']\n         ]\n+        # alias_map can also contain references to fields.\n+        new_alias_map = {}\n+        for alias, join_info in obj_dict['alias_map'].items():\n+            if join_info.join_field is None:\n+                new_alias_map[alias] = join_info\n+            else:\n+                model = join_info.join_field.model._meta\n+                field_id = (model.app_label, model.object_name, join_info.join_field.name)\n+                new_alias_map[alias] = join_info._replace(join_field=field_id)\n+        obj_dict['alias_map'] = new_alias_map\n         return obj_dict\n \n     def __setstate__(self, obj_dict):\n@@ -209,10 +219,19 @@ def __setstate__(self, obj_dict):\n         \"\"\"\n         # Rebuild list of field instances\n         opts = obj_dict['model']._meta\n-        obj_dict['select_fields'] = [\n-            name is not None and opts.get_field(name) or None\n-            for name in obj_dict['select_fields']\n+        obj_dict['select'] = [\n+            SelectInfo(tpl[0], tpl[1] is not None and opts.get_field(tpl[1]) or None)\n+            for tpl in obj_dict['select']\n         ]\n+        new_alias_map = {}\n+        for alias, join_info in obj_dict['alias_map'].items():\n+            if join_info.join_field is None:\n+                new_alias_map[alias] = join_info\n+            else:\n+                field_id = join_info.join_field\n+                new_alias_map[alias] = join_info._replace(\n+                    join_field=get_model(field_id[0], field_id[1])._meta.get_field(field_id[2]))\n+        obj_dict['alias_map'] = new_alias_map\n \n         self.__dict__.update(obj_dict)\n \n@@ -256,10 +275,8 @@ def clone(self, klass=None, memo=None, **kwargs):\n         obj.standard_ordering = self.standard_ordering\n         obj.included_inherited_models = self.included_inherited_models.copy()\n         obj.ordering_aliases = []\n-        obj.select_fields = self.select_fields[:]\n-        obj.related_select_fields = self.related_select_fields[:]\n-        obj.dupe_avoidance = self.dupe_avoidance.copy()\n         obj.select = self.select[:]\n+        obj.related_select_cols = []\n         obj.tables = self.tables[:]\n         obj.where = copy.deepcopy(self.where, memo=memo)\n         obj.where_class = self.where_class\n@@ -275,7 +292,6 @@ def clone(self, klass=None, memo=None, **kwargs):\n         obj.select_for_update = self.select_for_update\n         obj.select_for_update_nowait = self.select_for_update_nowait\n         obj.select_related = self.select_related\n-        obj.related_select_cols = []\n         obj.aggregates = copy.deepcopy(self.aggregates, memo=memo)\n         if self.aggregate_select_mask is None:\n             obj.aggregate_select_mask = None\n@@ -384,7 +400,6 @@ def get_aggregation(self, using):\n         query.select_for_update = False\n         query.select_related = False\n         query.related_select_cols = []\n-        query.related_select_fields = []\n \n         result = query.get_compiler(using).execute_sql(SINGLE)\n         if result is None:\n@@ -462,24 +477,47 @@ def combine(self, rhs, connector):\n         self.remove_inherited_models()\n         # Work out how to relabel the rhs aliases, if necessary.\n         change_map = {}\n-        used = set()\n         conjunction = (connector == AND)\n-        # Add the joins in the rhs query into the new query.\n-        first = True\n-        for alias in rhs.tables:\n-            if not rhs.alias_refcount[alias]:\n-                # An unused alias.\n-                continue\n-            table, _, join_type, lhs, lhs_col, col, _ = rhs.alias_map[alias]\n-            promote = join_type == self.LOUTER\n+\n+        # Determine which existing joins can be reused. When combining the\n+        # query with AND we must recreate all joins for m2m filters. When\n+        # combining with OR we can reuse joins. The reason is that in AND\n+        # case a single row can't fulfill a condition like:\n+        #     revrel__col=1 & revrel__col=2\n+        # But, there might be two different related rows matching this\n+        # condition. In OR case a single True is enough, so single row is\n+        # enough, too.\n+        #\n+        # Note that we will be creating duplicate joins for non-m2m joins in\n+        # the AND case. The results will be correct but this creates too many\n+        # joins. This is something that could be fixed later on.\n+        reuse = set() if conjunction else set(self.tables)\n+        # Base table must be present in the query - this is the same\n+        # table on both sides.\n+        self.get_initial_alias()\n+        # Now, add the joins from rhs query into the new query (skipping base\n+        # table).\n+        for alias in rhs.tables[1:]:\n+            table, _, join_type, lhs, lhs_col, col, nullable, join_field = rhs.alias_map[alias]\n+            promote = (join_type == self.LOUTER)\n             # If the left side of the join was already relabeled, use the\n             # updated alias.\n             lhs = change_map.get(lhs, lhs)\n-            new_alias = self.join((lhs, table, lhs_col, col),\n-                    conjunction and not first, used, promote, not conjunction)\n-            used.add(new_alias)\n+            new_alias = self.join(\n+                (lhs, table, lhs_col, col), reuse=reuse, promote=promote,\n+                outer_if_first=not conjunction, nullable=nullable,\n+                join_field=join_field)\n+            # We can't reuse the same join again in the query. If we have two\n+            # distinct joins for the same connection in rhs query, then the\n+            # combined query must have two joins, too.\n+            reuse.discard(new_alias)\n             change_map[alias] = new_alias\n-            first = False\n+            if not rhs.alias_refcount[alias]:\n+                # The alias was unused in the rhs query. Unref it so that it\n+                # will be unused in the new query, too. We have to add and\n+                # unref the alias so that join promotion has information of\n+                # the join type for the unused alias.\n+                self.unref_alias(new_alias)\n \n         # So that we don't exclude valid results in an \"or\" query combination,\n         # all joins exclusive to either the lhs or the rhs must be converted\n@@ -527,14 +565,14 @@ def combine(self, rhs, connector):\n \n         # Selection columns and extra extensions are those provided by 'rhs'.\n         self.select = []\n-        for col in rhs.select:\n+        for col, field in rhs.select:\n             if isinstance(col, (list, tuple)):\n-                self.select.append((change_map.get(col[0], col[0]), col[1]))\n+                new_col = change_map.get(col[0], col[0]), col[1]\n+                self.select.append(SelectInfo(new_col, field))\n             else:\n                 item = copy.deepcopy(col)\n                 item.relabel_aliases(change_map)\n-                self.select.append(item)\n-        self.select_fields = rhs.select_fields[:]\n+                self.select.append(SelectInfo(item, field))\n \n         if connector == OR:\n             # It would be nice to be able to handle this, but the queries don't\n@@ -585,17 +623,22 @@ def deferred_to_data(self, target, callback):\n             for name in parts[:-1]:\n                 old_model = cur_model\n                 source = opts.get_field_by_name(name)[0]\n-                cur_model = source.rel.to\n+                if is_reverse_o2o(source):\n+                    cur_model = source.model\n+                else:\n+                    cur_model = source.rel.to\n                 opts = cur_model._meta\n                 # Even if we're \"just passing through\" this model, we must add\n                 # both the current model's pk and the related reference field\n-                # to the things we select.\n-                must_include[old_model].add(source)\n+                # (if it's not a reverse relation) to the things we select.\n+                if not is_reverse_o2o(source):\n+                    must_include[old_model].add(source)\n                 add_to_dict(must_include, cur_model, opts.pk)\n             field, model, _, _ = opts.get_field_by_name(parts[-1])\n             if model is None:\n                 model = cur_model\n-            add_to_dict(seen, model, field)\n+            if not is_reverse_o2o(field):\n+                add_to_dict(seen, model, field)\n \n         if defer:\n             # We need to load all fields for each model, except those that\n@@ -750,29 +793,30 @@ def change_aliases(self, change_map):\n         \"\"\"\n         assert set(change_map.keys()).intersection(set(change_map.values())) == set()\n \n+        def relabel_column(col):\n+            if isinstance(col, (list, tuple)):\n+                old_alias = col[0]\n+                return (change_map.get(old_alias, old_alias), col[1])\n+            else:\n+                col.relabel_aliases(change_map)\n+                return col\n         # 1. Update references in \"select\" (normal columns plus aliases),\n         # \"group by\", \"where\" and \"having\".\n         self.where.relabel_aliases(change_map)\n         self.having.relabel_aliases(change_map)\n-        for columns in [self.select, self.group_by or []]:\n-            for pos, col in enumerate(columns):\n-                if isinstance(col, (list, tuple)):\n-                    old_alias = col[0]\n-                    columns[pos] = (change_map.get(old_alias, old_alias), col[1])\n-                else:\n-                    col.relabel_aliases(change_map)\n-        for mapping in [self.aggregates]:\n-            for key, col in mapping.items():\n-                if isinstance(col, (list, tuple)):\n-                    old_alias = col[0]\n-                    mapping[key] = (change_map.get(old_alias, old_alias), col[1])\n-                else:\n-                    col.relabel_aliases(change_map)\n+        if self.group_by:\n+            self.group_by = [relabel_column(col) for col in self.group_by]\n+        self.select = [SelectInfo(relabel_column(s.col), s.field)\n+                       for s in self.select]\n+        self.aggregates = SortedDict(\n+            (key, relabel_column(col)) for key, col in self.aggregates.items())\n \n         # 2. Rename the alias in the internal table/alias datastructures.\n-        for k, aliases in self.join_map.items():\n+        for ident, aliases in self.join_map.items():\n+            del self.join_map[ident]\n             aliases = tuple([change_map.get(a, a) for a in aliases])\n-            self.join_map[k] = aliases\n+            ident = (change_map.get(ident[0], ident[0]),) + ident[1:]\n+            self.join_map[ident] = aliases\n         for old_alias, new_alias in six.iteritems(change_map):\n             alias_data = self.alias_map[old_alias]\n             alias_data = alias_data._replace(rhs_alias=new_alias)\n@@ -845,10 +889,10 @@ def count_active_tables(self):\n         count. Note that after execution, the reference counts are zeroed, so\n         tables added in compiler will not be seen by this method.\n         \"\"\"\n-        return len([1 for count in six.itervalues(self.alias_refcount) if count])\n+        return len([1 for count in self.alias_refcount.values() if count])\n \n-    def join(self, connection, always_create=False, exclusions=(),\n-            promote=False, outer_if_first=False, nullable=False, reuse=None):\n+    def join(self, connection, reuse=REUSE_ALL, promote=False,\n+             outer_if_first=False, nullable=False, join_field=None):\n         \"\"\"\n         Returns an alias for the join in 'connection', either reusing an\n         existing alias for that join or creating a new one. 'connection' is a\n@@ -858,56 +902,47 @@ def join(self, connection, always_create=False, exclusions=(),\n \n             lhs.lhs_col = table.col\n \n-        If 'always_create' is True and 'reuse' is None, a new alias is always\n-        created, regardless of whether one already exists or not. If\n-        'always_create' is True and 'reuse' is a set, an alias in 'reuse' that\n-        matches the connection will be returned, if possible.  If\n-        'always_create' is False, the first existing alias that matches the\n-        'connection' is returned, if any. Otherwise a new join is created.\n-\n-        If 'exclusions' is specified, it is something satisfying the container\n-        protocol (\"foo in exclusions\" must work) and specifies a list of\n-        aliases that should not be returned, even if they satisfy the join.\n+        The 'reuse' parameter can be used in three ways: it can be REUSE_ALL\n+        which means all joins (matching the connection) are reusable, it can\n+        be a set containing the aliases that can be reused, or it can be None\n+        which means a new join is always created.\n \n         If 'promote' is True, the join type for the alias will be LOUTER (if\n         the alias previously existed, the join type will be promoted from INNER\n         to LOUTER, if necessary).\n \n         If 'outer_if_first' is True and a new join is created, it will have the\n-        LOUTER join type. This is used when joining certain types of querysets\n-        and Q-objects together.\n+        LOUTER join type. Used for example when adding ORed filters, where we\n+        want to use LOUTER joins except if some other join already restricts\n+        the join to INNER join.\n \n         A join is always created as LOUTER if the lhs alias is LOUTER to make\n-        sure we do not generate chains like a LOUTER b INNER c.\n+        sure we do not generate chains like t1 LOUTER t2 INNER t3.\n \n         If 'nullable' is True, the join can potentially involve NULL values and\n         is a candidate for promotion (to \"left outer\") when combining querysets.\n+\n+        The 'join_field' is the field we are joining along (if any).\n         \"\"\"\n         lhs, table, lhs_col, col = connection\n-        if lhs in self.alias_map:\n-            lhs_table = self.alias_map[lhs].table_name\n+        existing = self.join_map.get(connection, ())\n+        if reuse == REUSE_ALL:\n+            reuse = existing\n+        elif reuse is None:\n+            reuse = set()\n         else:\n-            lhs_table = lhs\n-\n-        if reuse and always_create and table in self.table_map:\n-            # Convert the 'reuse' to case to be \"exclude everything but the\n-            # reusable set, minus exclusions, for this table\".\n-            exclusions = set(self.table_map[table]).difference(reuse).union(set(exclusions))\n-            always_create = False\n-        t_ident = (lhs_table, table, lhs_col, col)\n-        if not always_create:\n-            for alias in self.join_map.get(t_ident, ()):\n-                if alias not in exclusions:\n-                    if lhs_table and not self.alias_refcount[self.alias_map[alias].lhs_alias]:\n-                        # The LHS of this join tuple is no longer part of the\n-                        # query, so skip this possibility.\n-                        continue\n-                    if self.alias_map[alias].lhs_alias != lhs:\n-                        continue\n-                    self.ref_alias(alias)\n-                    if promote or (lhs and self.alias_map[lhs].join_type == self.LOUTER):\n-                        self.promote_joins([alias])\n-                    return alias\n+            reuse = [a for a in existing if a in reuse]\n+        for alias in reuse:\n+            if join_field and self.alias_map[alias].join_field != join_field:\n+                # The join_map doesn't contain join_field (mainly because\n+                # fields in Query structs are problematic in pickling), so\n+                # check that the existing join is created using the same\n+                # join_field used for the under work join.\n+                continue\n+            self.ref_alias(alias)\n+            if promote or (lhs and self.alias_map[lhs].join_type == self.LOUTER):\n+                self.promote_joins([alias])\n+            return alias\n \n         # No reuse is possible, so we need a new alias.\n         alias, _ = self.table_alias(table, True)\n@@ -918,18 +953,17 @@ def join(self, connection, always_create=False, exclusions=(),\n         elif (promote or outer_if_first\n               or self.alias_map[lhs].join_type == self.LOUTER):\n             # We need to use LOUTER join if asked by promote or outer_if_first,\n-            # or if the LHS table is left-joined in the query. Adding inner join\n-            # to an existing outer join effectively cancels the effect of the\n-            # outer join.\n+            # or if the LHS table is left-joined in the query.\n             join_type = self.LOUTER\n         else:\n             join_type = self.INNER\n-        join = JoinInfo(table, alias, join_type, lhs, lhs_col, col, nullable)\n+        join = JoinInfo(table, alias, join_type, lhs, lhs_col, col, nullable,\n+                        join_field)\n         self.alias_map[alias] = join\n-        if t_ident in self.join_map:\n-            self.join_map[t_ident] += (alias,)\n+        if connection in self.join_map:\n+            self.join_map[connection] += (alias,)\n         else:\n-            self.join_map[t_ident] = (alias,)\n+            self.join_map[connection] = (alias,)\n         return alias\n \n     def setup_inherited_models(self):\n@@ -1005,11 +1039,11 @@ def add_aggregate(self, aggregate, model, alias, is_summary):\n             #   - this is an annotation over a model field\n             # then we need to explore the joins that are required.\n \n-            field, source, opts, join_list, last, _ = self.setup_joins(\n-                field_list, opts, self.get_initial_alias(), False)\n+            field, source, opts, join_list, path = self.setup_joins(\n+                field_list, opts, self.get_initial_alias(), REUSE_ALL)\n \n             # Process the join chain to see if it can be trimmed\n-            col, _, join_list = self.trim_joins(source, join_list, last, False)\n+            col, _, join_list = self.trim_joins(source, join_list, path)\n \n             # If the aggregate references a model or field that requires a join,\n             # those joins must be LEFT OUTER - empty join rows must be returned\n@@ -1027,8 +1061,8 @@ def add_aggregate(self, aggregate, model, alias, is_summary):\n         # Add the aggregate to the query\n         aggregate.add_to_query(self, alias, col=col, source=source, is_summary=is_summary)\n \n-    def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n-            can_reuse=None, process_extras=True, force_having=False):\n+    def add_filter(self, filter_expr, connector=AND, negate=False,\n+            can_reuse=None, force_having=False):\n         \"\"\"\n         Add a single filter to the query. The 'filter_expr' is a pair:\n         (filter_string, value). E.g. ('name__contains', 'fred')\n@@ -1040,18 +1074,11 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n         should only happen once. So the caller is responsible for this (the\n         caller will normally be add_q(), so that as an example).\n \n-        If 'trim' is True, we automatically trim the final join group (used\n-        internally when constructing nested queries).\n-\n         If 'can_reuse' is a set, we are processing a component of a\n         multi-component filter (e.g. filter(Q1, Q2)). In this case, 'can_reuse'\n         will be a set of table aliases that can be reused in this filter, even\n         if we would otherwise force the creation of new aliases for a join\n         (needed for nested Q-filters). The set is updated by this method.\n-\n-        If 'process_extras' is set, any extra filters returned from the table\n-        joining process will be processed. This parameter is set to False\n-        during the processing of extra filters to avoid infinite recursion.\n         \"\"\"\n         arg, value = filter_expr\n         parts = arg.split(LOOKUP_SEP)\n@@ -1099,7 +1126,7 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n             value = value()\n         elif isinstance(value, ExpressionNode):\n             # If value is a query expression, evaluate it\n-            value = SQLEvaluator(value, self)\n+            value = SQLEvaluator(value, self, reuse=can_reuse)\n             having_clause = value.contains_aggregate\n \n         for alias, aggregate in self.aggregates.items():\n@@ -1113,13 +1140,14 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n \n         opts = self.get_meta()\n         alias = self.get_initial_alias()\n-        allow_many = trim or not negate\n+        allow_many = not negate\n \n         try:\n-            field, target, opts, join_list, last, extra_filters = self.setup_joins(\n-                    parts, opts, alias, True, allow_many, allow_explicit_fk=True,\n-                    can_reuse=can_reuse, negate=negate,\n-                    process_extras=process_extras)\n+            field, target, opts, join_list, path = self.setup_joins(\n+                    parts, opts, alias, can_reuse, allow_many,\n+                    allow_explicit_fk=True)\n+            if can_reuse is not None:\n+                can_reuse.update(join_list)\n         except MultiJoin as e:\n             self.split_exclude(filter_expr, LOOKUP_SEP.join(parts[:e.level]),\n                     can_reuse)\n@@ -1137,10 +1165,10 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n             join_promote = True\n \n         # Process the join list to see if we can remove any inner joins from\n-        # the far end (fewer tables in a query is better).\n-        nonnull_comparison = (lookup_type == 'isnull' and value is False)\n-        col, alias, join_list = self.trim_joins(target, join_list, last, trim,\n-                nonnull_comparison)\n+        # the far end (fewer tables in a query is better). Note that join\n+        # promotion must happen before join trimming to have the join type\n+        # information available when reusing joins.\n+        col, alias, join_list = self.trim_joins(target, join_list, path)\n \n         if connector == OR:\n             # Some joins may need to be promoted when adding a new filter to a\n@@ -1213,12 +1241,6 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n                     # is added in upper layers of the code.\n                     self.where.add((Constraint(alias, col, None), 'isnull', False), AND)\n \n-        if can_reuse is not None:\n-            can_reuse.update(join_list)\n-        if process_extras:\n-            for filter in extra_filters:\n-                self.add_filter(filter, negate=negate, can_reuse=can_reuse,\n-                        process_extras=False)\n \n     def add_q(self, q_object, used_aliases=None, force_having=False):\n         \"\"\"\n@@ -1271,37 +1293,24 @@ def add_q(self, q_object, used_aliases=None, force_having=False):\n         if self.filter_is_sticky:\n             self.used_aliases = used_aliases\n \n-    def setup_joins(self, names, opts, alias, dupe_multis, allow_many=True,\n-            allow_explicit_fk=False, can_reuse=None, negate=False,\n-            process_extras=True):\n+    def names_to_path(self, names, opts, allow_many=False,\n+                      allow_explicit_fk=True):\n         \"\"\"\n-        Compute the necessary table joins for the passage through the fields\n-        given in 'names'. 'opts' is the Options class for the current model\n-        (which gives the table we are joining to), 'alias' is the alias for the\n-        table we are joining to. If dupe_multis is True, any many-to-many or\n-        many-to-one joins will always create a new alias (necessary for\n-        disjunctive filters). If can_reuse is not None, it's a list of aliases\n-        that can be reused in these joins (nothing else can be reused in this\n-        case). Finally, 'negate' is used in the same sense as for add_filter()\n-        -- it indicates an exclude() filter, or something similar. It is only\n-        passed in here so that it can be passed to a field's extra_filter() for\n-        customized behavior.\n-\n-        Returns the final field involved in the join, the target database\n-        column (used for any 'where' constraint), the final 'opts' value and the\n-        list of tables joined.\n+        Walks the names path and turns them PathInfo tuples. Note that a\n+        single name in 'names' can generate multiple PathInfos (m2m for\n+        example).\n+\n+        'names' is the path of names to travle, 'opts' is the model Options we\n+        start the name resolving from, 'allow_many' and 'allow_explicit_fk'\n+        are as for setup_joins().\n+\n+        Returns a list of PathInfo tuples. In addition returns the final field\n+        (the last used join field), and target (which is a field guaranteed to\n+        contain the same value as the final field).\n         \"\"\"\n-        joins = [alias]\n-        last = [0]\n-        dupe_set = set()\n-        exclusions = set()\n-        extra_filters = []\n-        int_alias = None\n+        path = []\n+        multijoin_pos = None\n         for pos, name in enumerate(names):\n-            if int_alias is not None:\n-                exclusions.add(int_alias)\n-            exclusions.add(alias)\n-            last.append(len(joins))\n             if name == 'pk':\n                 name = opts.pk.name\n             try:\n@@ -1315,14 +1324,12 @@ def setup_joins(self, names, opts, alias, dupe_multis, allow_many=True,\n                         field, model, direct, m2m = opts.get_field_by_name(f.name)\n                         break\n                 else:\n-                    names = opts.get_all_field_names() + list(self.aggregate_select)\n+                    available = opts.get_all_field_names() + list(self.aggregate_select)\n                     raise FieldError(\"Cannot resolve keyword %r into field. \"\n-                            \"Choices are: %s\" % (name, \", \".join(names)))\n-\n-            if not allow_many and (m2m or not direct):\n-                for alias in joins:\n-                    self.unref_alias(alias)\n-                raise MultiJoin(pos + 1)\n+                                     \"Choices are: %s\" % (name, \", \".join(available)))\n+            # Check if we need any joins for concrete inheritance cases (the\n+            # field lives in parent, but we are currently in one of its\n+            # children)\n             if model:\n                 # The field lives on a base class of the current model.\n                 # Skip the chain of proxy to the concrete proxied model\n@@ -1332,234 +1339,199 @@ def setup_joins(self, names, opts, alias, dupe_multis, allow_many=True,\n                     if int_model is proxied_model:\n                         opts = int_model._meta\n                     else:\n-                        lhs_col = opts.parents[int_model].column\n-                        dedupe = lhs_col in opts.duplicate_targets\n-                        if dedupe:\n-                            exclusions.update(self.dupe_avoidance.get(\n-                                    (id(opts), lhs_col), ()))\n-                            dupe_set.add((opts, lhs_col))\n+                        final_field = opts.parents[int_model]\n+                        target = final_field.rel.get_related_field()\n                         opts = int_model._meta\n-                        alias = self.join((alias, opts.db_table, lhs_col,\n-                                opts.pk.column), exclusions=exclusions)\n-                        joins.append(alias)\n-                        exclusions.add(alias)\n-                        for (dupe_opts, dupe_col) in dupe_set:\n-                            self.update_dupe_avoidance(dupe_opts, dupe_col,\n-                                    alias)\n-            cached_data = opts._join_cache.get(name)\n-            orig_opts = opts\n-            dupe_col = direct and field.column or field.field.column\n-            dedupe = dupe_col in opts.duplicate_targets\n-            if dupe_set or dedupe:\n-                if dedupe:\n-                    dupe_set.add((opts, dupe_col))\n-                exclusions.update(self.dupe_avoidance.get((id(opts), dupe_col),\n-                        ()))\n-\n-            if process_extras and hasattr(field, 'extra_filters'):\n-                extra_filters.extend(field.extra_filters(names, pos, negate))\n-            if direct:\n-                if m2m:\n-                    # Many-to-many field defined on the current model.\n-                    if cached_data:\n-                        (table1, from_col1, to_col1, table2, from_col2,\n-                                to_col2, opts, target) = cached_data\n-                    else:\n-                        table1 = field.m2m_db_table()\n-                        from_col1 = opts.get_field_by_name(\n-                            field.m2m_target_field_name())[0].column\n-                        to_col1 = field.m2m_column_name()\n-                        opts = field.rel.to._meta\n-                        table2 = opts.db_table\n-                        from_col2 = field.m2m_reverse_name()\n-                        to_col2 = opts.get_field_by_name(\n-                            field.m2m_reverse_target_field_name())[0].column\n-                        target = opts.pk\n-                        orig_opts._join_cache[name] = (table1, from_col1,\n-                                to_col1, table2, from_col2, to_col2, opts,\n-                                target)\n-\n-                    int_alias = self.join((alias, table1, from_col1, to_col1),\n-                            dupe_multis, exclusions, nullable=True,\n-                            reuse=can_reuse)\n-                    if int_alias == table2 and from_col2 == to_col2:\n-                        joins.append(int_alias)\n-                        alias = int_alias\n-                    else:\n-                        alias = self.join(\n-                                (int_alias, table2, from_col2, to_col2),\n-                                dupe_multis, exclusions, nullable=True,\n-                                reuse=can_reuse)\n-                        joins.extend([int_alias, alias])\n-                elif field.rel:\n-                    # One-to-one or many-to-one field\n-                    if cached_data:\n-                        (table, from_col, to_col, opts, target) = cached_data\n-                    else:\n-                        opts = field.rel.to._meta\n-                        target = field.rel.get_related_field()\n-                        table = opts.db_table\n-                        from_col = field.column\n-                        to_col = target.column\n-                        orig_opts._join_cache[name] = (table, from_col, to_col,\n-                                opts, target)\n-\n-                    alias = self.join((alias, table, from_col, to_col),\n-                                      exclusions=exclusions,\n-                                      nullable=self.is_nullable(field))\n-                    joins.append(alias)\n-                else:\n-                    # Non-relation fields.\n-                    target = field\n-                    break\n-            else:\n-                orig_field = field\n-                field = field.field\n-                if m2m:\n-                    # Many-to-many field defined on the target model.\n-                    if cached_data:\n-                        (table1, from_col1, to_col1, table2, from_col2,\n-                                to_col2, opts, target) = cached_data\n-                    else:\n-                        table1 = field.m2m_db_table()\n-                        from_col1 = opts.get_field_by_name(\n-                            field.m2m_reverse_target_field_name())[0].column\n-                        to_col1 = field.m2m_reverse_name()\n-                        opts = orig_field.opts\n-                        table2 = opts.db_table\n-                        from_col2 = field.m2m_column_name()\n-                        to_col2 = opts.get_field_by_name(\n-                            field.m2m_target_field_name())[0].column\n-                        target = opts.pk\n-                        orig_opts._join_cache[name] = (table1, from_col1,\n-                                to_col1, table2, from_col2, to_col2, opts,\n-                                target)\n-\n-                    int_alias = self.join((alias, table1, from_col1, to_col1),\n-                            dupe_multis, exclusions, nullable=True,\n-                            reuse=can_reuse)\n-                    alias = self.join((int_alias, table2, from_col2, to_col2),\n-                            dupe_multis, exclusions, nullable=True,\n-                            reuse=can_reuse)\n-                    joins.extend([int_alias, alias])\n+                        path.append(PathInfo(final_field, target, final_field.model._meta,\n+                                             opts, final_field))\n+            # We have five different cases to solve: foreign keys, reverse\n+            # foreign keys, m2m fields (also reverse) and non-relational\n+            # fields. We are mostly just using the related field API to\n+            # fetch the from and to fields. The m2m fields are handled as\n+            # two foreign keys, first one reverse, the second one direct.\n+            if direct and not field.rel and not m2m:\n+                # Local non-relational field.\n+                final_field = target = field\n+                break\n+            elif direct and not m2m:\n+                # Foreign Key\n+                opts = field.rel.to._meta\n+                target = field.rel.get_related_field()\n+                final_field = field\n+                from_opts = field.model._meta\n+                path.append(PathInfo(field, target, from_opts, opts, field))\n+            elif not direct and not m2m:\n+                # Revere foreign key\n+                final_field = to_field = field.field\n+                opts = to_field.model._meta\n+                from_field = to_field.rel.get_related_field()\n+                from_opts = from_field.model._meta\n+                path.append(\n+                    PathInfo(from_field, to_field, from_opts, opts, to_field))\n+                if from_field.model is to_field.model:\n+                    # Recursive foreign key to self.\n+                    target = opts.get_field_by_name(\n+                        field.field.rel.field_name)[0]\n                 else:\n-                    # One-to-many field (ForeignKey defined on the target model)\n-                    if cached_data:\n-                        (table, from_col, to_col, opts, target) = cached_data\n-                    else:\n-                        local_field = opts.get_field_by_name(\n-                                field.rel.field_name)[0]\n-                        opts = orig_field.opts\n-                        table = opts.db_table\n-                        from_col = local_field.column\n-                        to_col = field.column\n-                        # In case of a recursive FK, use the to_field for\n-                        # reverse lookups as well\n-                        if orig_field.model is local_field.model:\n-                            target = opts.get_field_by_name(\n-                                field.rel.field_name)[0]\n-                        else:\n-                            target = opts.pk\n-                        orig_opts._join_cache[name] = (table, from_col, to_col,\n-                                opts, target)\n-\n-                    alias = self.join((alias, table, from_col, to_col),\n-                            dupe_multis, exclusions, nullable=True,\n-                            reuse=can_reuse)\n-                    joins.append(alias)\n-\n-            for (dupe_opts, dupe_col) in dupe_set:\n-                if int_alias is None:\n-                    to_avoid = alias\n+                    target = opts.pk\n+            elif direct and m2m:\n+                if not field.rel.through:\n+                    # Gotcha! This is just a fake m2m field - a generic relation\n+                    # field).\n+                    from_field = opts.pk\n+                    opts = field.rel.to._meta\n+                    target = opts.get_field_by_name(field.object_id_field_name)[0]\n+                    final_field = field\n+                    # Note that we are using different field for the join_field\n+                    # than from_field or to_field. This is a hack, but we need the\n+                    # GenericRelation to generate the extra SQL.\n+                    path.append(PathInfo(from_field, target, field.model._meta, opts,\n+                                         field))\n                 else:\n-                    to_avoid = int_alias\n-                self.update_dupe_avoidance(dupe_opts, dupe_col, to_avoid)\n+                    # m2m field. We are travelling first to the m2m table along a\n+                    # reverse relation, then from m2m table to the target table.\n+                    from_field1 = opts.get_field_by_name(\n+                        field.m2m_target_field_name())[0]\n+                    opts = field.rel.through._meta\n+                    to_field1 = opts.get_field_by_name(field.m2m_field_name())[0]\n+                    path.append(\n+                        PathInfo(from_field1, to_field1, from_field1.model._meta,\n+                                 opts, to_field1))\n+                    final_field = from_field2 = opts.get_field_by_name(\n+                        field.m2m_reverse_field_name())[0]\n+                    opts = field.rel.to._meta\n+                    target = to_field2 = opts.get_field_by_name(\n+                        field.m2m_reverse_target_field_name())[0]\n+                    path.append(\n+                        PathInfo(from_field2, to_field2, from_field2.model._meta,\n+                                 opts, from_field2))\n+            elif not direct and m2m:\n+                # This one is just like above, except we are travelling the\n+                # fields in opposite direction.\n+                field = field.field\n+                from_field1 = opts.get_field_by_name(\n+                    field.m2m_reverse_target_field_name())[0]\n+                int_opts = field.rel.through._meta\n+                to_field1 = int_opts.get_field_by_name(\n+                    field.m2m_reverse_field_name())[0]\n+                path.append(\n+                    PathInfo(from_field1, to_field1, from_field1.model._meta,\n+                             int_opts, to_field1))\n+                final_field = from_field2 = int_opts.get_field_by_name(\n+                    field.m2m_field_name())[0]\n+                opts = field.opts\n+                target = to_field2 = opts.get_field_by_name(\n+                    field.m2m_target_field_name())[0]\n+                path.append(PathInfo(from_field2, to_field2, from_field2.model._meta,\n+                                     opts, from_field2))\n+\n+            if m2m and multijoin_pos is None:\n+                multijoin_pos = pos\n+            if not direct and not path[-1].to_field.unique and multijoin_pos is None:\n+                multijoin_pos = pos\n \n         if pos != len(names) - 1:\n             if pos == len(names) - 2:\n-                raise FieldError(\"Join on field %r not permitted. Did you misspell %r for the lookup type?\" % (name, names[pos + 1]))\n+                raise FieldError(\n+                    \"Join on field %r not permitted. Did you misspell %r for \"\n+                    \"the lookup type?\" % (name, names[pos + 1]))\n             else:\n                 raise FieldError(\"Join on field %r not permitted.\" % name)\n+        if multijoin_pos is not None and len(path) >= multijoin_pos and not allow_many:\n+            raise MultiJoin(multijoin_pos + 1)\n+        return path, final_field, target\n \n-        return field, target, opts, joins, last, extra_filters\n-\n-    def trim_joins(self, target, join_list, last, trim, nonnull_check=False):\n+    def setup_joins(self, names, opts, alias, can_reuse, allow_many=True,\n+                    allow_explicit_fk=False):\n         \"\"\"\n-        Sometimes joins at the end of a multi-table sequence can be trimmed. If\n-        the final join is against the same column as we are comparing against,\n-        and is an inner join, we can go back one step in a join chain and\n-        compare against the LHS of the join instead (and then repeat the\n-        optimization). The result, potentially, involves fewer table joins.\n+        Compute the necessary table joins for the passage through the fields\n+        given in 'names'. 'opts' is the Options class for the current model\n+        (which gives the table we are starting from), 'alias' is the alias for\n+        the table to start the joining from.\n \n-        The 'target' parameter is the final field being joined to, 'join_list'\n-        is the full list of join aliases.\n+        The 'can_reuse' defines the reverse foreign key joins we can reuse. It\n+        can be sql.constants.REUSE_ALL in which case all joins are reusable\n+        or a set of aliases that can be reused. Note that Non-reverse foreign\n+        keys are always reusable.\n \n-        The 'last' list contains offsets into 'join_list', corresponding to\n-        each component of the filter. Many-to-many relations, for example, add\n-        two tables to the join list and we want to deal with both tables the\n-        same way, so 'last' has an entry for the first of the two tables and\n-        then the table immediately after the second table, in that case.\n+        If 'allow_many' is False, then any reverse foreign key seen will\n+        generate a MultiJoin exception.\n \n-        The 'trim' parameter forces the final piece of the join list to be\n-        trimmed before anything. See the documentation of add_filter() for\n-        details about this.\n+        The 'allow_explicit_fk' controls if field.attname is allowed in the\n+        lookups.\n \n-        The 'nonnull_check' parameter is True when we are using inner joins\n-        between tables explicitly to exclude NULL entries. In that case, the\n-        tables shouldn't be trimmed, because the very action of joining to them\n-        alters the result set.\n+        Returns the final field involved in the joins, the target field (used\n+        for any 'where' constraint), the final 'opts' value, the joins and the\n+        field path travelled to generate the joins.\n+\n+        The target field is the field containing the concrete value. Final\n+        field can be something different, for example foreign key pointing to\n+        that value. Final field is needed for example in some value\n+        conversions (convert 'obj' in fk__id=obj to pk val using the foreign\n+        key field for example).\n+        \"\"\"\n+        joins = [alias]\n+        # First, generate the path for the names\n+        path, final_field, target = self.names_to_path(\n+            names, opts, allow_many, allow_explicit_fk)\n+        # Then, add the path to the query's joins. Note that we can't trim\n+        # joins at this stage - we will need the information about join type\n+        # of the trimmed joins.\n+        for pos, join in enumerate(path):\n+            from_field, to_field, from_opts, opts, join_field = join\n+            direct = join_field == from_field\n+            if direct:\n+                nullable = self.is_nullable(from_field)\n+            else:\n+                nullable = True\n+            connection = alias, opts.db_table, from_field.column, to_field.column\n+            alias = self.join(connection, reuse=can_reuse, nullable=nullable,\n+                              join_field=join_field)\n+            joins.append(alias)\n+        return final_field, target, opts, joins, path\n+\n+    def trim_joins(self, target, joins, path):\n+        \"\"\"\n+        The 'target' parameter is the final field being joined to, 'joins'\n+        is the full list of join aliases. The 'path' contain the PathInfos\n+        used to create the joins.\n \n         Returns the final active column and table alias and the new active\n-        join_list.\n-        \"\"\"\n-        final = len(join_list)\n-        penultimate = last.pop()\n-        if penultimate == final:\n-            penultimate = last.pop()\n-        if trim and final > 1:\n-            extra = join_list[penultimate:]\n-            join_list = join_list[:penultimate]\n-            final = penultimate\n-            penultimate = last.pop()\n-            col = self.alias_map[extra[0]].lhs_join_col\n-            for alias in extra:\n-                self.unref_alias(alias)\n-        else:\n-            col = target.column\n-        alias = join_list[-1]\n-        while final > 1:\n-            join = self.alias_map[alias]\n-            if (col != join.rhs_join_col or join.join_type != self.INNER or\n-                    nonnull_check):\n+        joins.\n+\n+        We will always trim any direct join if we have the target column\n+        available already in the previous table. Reverse joins can't be\n+        trimmed as we don't know if there is anything on the other side of\n+        the join.\n+        \"\"\"\n+        for info in reversed(path):\n+            direct = info.join_field == info.from_field\n+            if info.to_field == target and direct:\n+                target = info.from_field\n+                self.unref_alias(joins.pop())\n+            else:\n                 break\n-            self.unref_alias(alias)\n-            alias = join.lhs_alias\n-            col = join.lhs_join_col\n-            join_list.pop()\n-            final -= 1\n-            if final == penultimate:\n-                penultimate = last.pop()\n-        return col, alias, join_list\n-\n-    def update_dupe_avoidance(self, opts, col, alias):\n-        \"\"\"\n-        For a column that is one of multiple pointing to the same table, update\n-        the internal data structures to note that this alias shouldn't be used\n-        for those other columns.\n-        \"\"\"\n-        ident = id(opts)\n-        for name in opts.duplicate_targets[col]:\n-            try:\n-                self.dupe_avoidance[ident, name].add(alias)\n-            except KeyError:\n-                self.dupe_avoidance[ident, name] = set([alias])\n+        return target.column, joins[-1], joins\n \n     def split_exclude(self, filter_expr, prefix, can_reuse):\n         \"\"\"\n         When doing an exclude against any kind of N-to-many relation, we need\n         to use a subquery. This method constructs the nested query, given the\n         original exclude filter (filter_expr) and the portion up to the first\n         N-to-many relation field.\n+\n+        As an example we could have original filter ~Q(child__name='foo').\n+        We would get here with filter_expr = child_name, prefix = child and\n+        can_reuse is a set of joins we can reuse for filtering in the original\n+        query.\n+\n+        We will turn this into\n+            WHERE pk NOT IN (SELECT parent_id FROM thetable\n+                             WHERE name = 'foo' AND parent_id IS NOT NULL)\n+\n+        It might be worth it to consider using WHERE NOT EXISTS as that has\n+        saner null handling, and is easier for the backend's optimizer to\n+        handle.\n         \"\"\"\n         query = Query(self.model)\n         query.add_filter(filter_expr)\n@@ -1570,10 +1542,21 @@ def split_exclude(self, filter_expr, prefix, can_reuse):\n         # since we are adding a IN <subquery> clause. This prevents the\n         # database from tripping over IN (...,NULL,...) selects and returning\n         # nothing\n-        alias, col = query.select[0]\n+        alias, col = query.select[0].col\n         query.where.add((Constraint(alias, col, None), 'isnull', False), AND)\n+        # We need to trim the last part from the prefix.\n+        trimmed_prefix = LOOKUP_SEP.join(prefix.split(LOOKUP_SEP)[0:-1])\n+        if not trimmed_prefix:\n+            rel, _, direct, m2m = self.model._meta.get_field_by_name(prefix)\n+            if not m2m:\n+                trimmed_prefix = rel.field.rel.field_name\n+            else:\n+                if direct:\n+                    trimmed_prefix = rel.m2m_target_field_name()\n+                else:\n+                    trimmed_prefix = rel.field.m2m_reverse_target_field_name()\n \n-        self.add_filter(('%s__in' % prefix, query), negate=True, trim=True,\n+        self.add_filter(('%s__in' % trimmed_prefix, query), negate=True,\n                 can_reuse=can_reuse)\n \n         # If there's more than one join in the inner query (before any initial\n@@ -1583,11 +1566,11 @@ def split_exclude(self, filter_expr, prefix, can_reuse):\n         # comparison to NULL (e.g. in\n         # Tag.objects.exclude(parent__parent__name='t1'), a tag with no parent\n         # would otherwise be overlooked).\n-        active_positions = [pos for (pos, count) in\n-                enumerate(six.itervalues(query.alias_refcount)) if count]\n-        if active_positions[-1] > 1:\n-            self.add_filter(('%s__isnull' % prefix, False), negate=True,\n-                    trim=True, can_reuse=can_reuse)\n+        active_positions = len([count for count\n+                                in query.alias_refcount.items() if count])\n+        if active_positions > 1:\n+            self.add_filter(('%s__isnull' % trimmed_prefix, False), negate=True,\n+                    can_reuse=can_reuse)\n \n     def set_limits(self, low=None, high=None):\n         \"\"\"\n@@ -1629,7 +1612,6 @@ def clear_select_clause(self):\n         Removes all fields from SELECT clause.\n         \"\"\"\n         self.select = []\n-        self.select_fields = []\n         self.default_cols = False\n         self.select_related = False\n         self.set_extra_mask(())\n@@ -1642,7 +1624,6 @@ def clear_select_fields(self):\n         columns.\n         \"\"\"\n         self.select = []\n-        self.select_fields = []\n \n     def add_distinct_fields(self, *field_names):\n         \"\"\"\n@@ -1661,8 +1642,8 @@ def add_fields(self, field_names, allow_m2m=True):\n \n         try:\n             for name in field_names:\n-                field, target, u2, joins, u3, u4 = self.setup_joins(\n-                        name.split(LOOKUP_SEP), opts, alias, False, allow_m2m,\n+                field, target, u2, joins, u3 = self.setup_joins(\n+                        name.split(LOOKUP_SEP), opts, alias, REUSE_ALL, allow_m2m,\n                         True)\n                 final_alias = joins[-1]\n                 col = target.column\n@@ -1674,8 +1655,7 @@ def add_fields(self, field_names, allow_m2m=True):\n                         col = join.lhs_join_col\n                         joins = joins[:-1]\n                 self.promote_joins(joins[1:])\n-                self.select.append((final_alias, col))\n-                self.select_fields.append(field)\n+                self.select.append(SelectInfo((final_alias, col), field))\n         except MultiJoin:\n             raise FieldError(\"Invalid field name: '%s'\" % name)\n         except FieldError:\n@@ -1731,8 +1711,8 @@ def set_group_by(self):\n         \"\"\"\n         self.group_by = []\n \n-        for sel in self.select:\n-            self.group_by.append(sel)\n+        for col, _ in self.select:\n+            self.group_by.append(col)\n \n     def add_count_column(self):\n         \"\"\"\n@@ -1745,7 +1725,7 @@ def add_count_column(self):\n             else:\n                 assert len(self.select) == 1, \\\n                         \"Cannot add count col with multiple cols in 'select': %r\" % self.select\n-                count = self.aggregates_module.Count(self.select[0])\n+                count = self.aggregates_module.Count(self.select[0].col)\n         else:\n             opts = self.model._meta\n             if not self.select:\n@@ -1757,7 +1737,7 @@ def add_count_column(self):\n                 assert len(self.select) == 1, \\\n                         \"Cannot add count col with multiple cols in 'select'.\"\n \n-                count = self.aggregates_module.Count(self.select[0], distinct=True)\n+                count = self.aggregates_module.Count(self.select[0].col, distinct=True)\n             # Distinct handling is done in Count(), so don't do it at this\n             # level.\n             self.distinct = False\n@@ -1781,7 +1761,6 @@ def add_select_related(self, fields):\n                 d = d.setdefault(part, {})\n         self.select_related = field_dict\n         self.related_select_cols = []\n-        self.related_select_fields = []\n \n     def add_extra(self, select, select_params, where, params, tables, order_by):\n         \"\"\"\n@@ -1954,8 +1933,8 @@ def set_start(self, start):\n         \"\"\"\n         opts = self.model._meta\n         alias = self.get_initial_alias()\n-        field, col, opts, joins, last, extra = self.setup_joins(\n-                start.split(LOOKUP_SEP), opts, alias, False)\n+        field, col, opts, joins, extra = self.setup_joins(\n+                start.split(LOOKUP_SEP), opts, alias, REUSE_ALL)\n         select_col = self.alias_map[joins[1]].lhs_join_col\n         select_alias = alias\n \n@@ -1975,7 +1954,7 @@ def set_start(self, start):\n             self.unref_alias(select_alias)\n             select_alias = join_info.rhs_alias\n             select_col = join_info.rhs_join_col\n-        self.select = [(select_alias, select_col)]\n+        self.select = [SelectInfo((select_alias, select_col), None)]\n         self.remove_inherited_models()\n \n     def is_nullable(self, field):\n@@ -2011,18 +1990,6 @@ def get_order_dir(field, default='ASC'):\n     return field, dirn[0]\n \n \n-def setup_join_cache(sender, **kwargs):\n-    \"\"\"\n-    The information needed to join between model fields is something that is\n-    invariant over the life of the model, so we cache it in the model's Options\n-    class, rather than recomputing it all the time.\n-\n-    This method initialises the (empty) cache when the model is created.\n-    \"\"\"\n-    sender._meta._join_cache = {}\n-\n-signals.class_prepared.connect(setup_join_cache)\n-\n def add_to_dict(data, key, value):\n     \"\"\"\n     A helper function to add \"value\" to the set of values for \"key\", whether or\n@@ -2032,3 +1999,10 @@ def add_to_dict(data, key, value):\n         data[key].add(value)\n     else:\n         data[key] = set([value])\n+\n+def is_reverse_o2o(field):\n+    \"\"\"\n+    A little helper to check if the given field is reverse-o2o. The field is\n+    expected to be some sort of relation field or related object.\n+    \"\"\"\n+    return not hasattr(field, 'rel') and field.field.unique"
        },
        {
            "sha": "39d1ee01163587104d80cb3bfd451546919576a6",
            "filename": "django/db/models/sql/subqueries.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -76,7 +76,7 @@ def delete_qs(self, query, using):\n                 return\n             else:\n                 innerq.clear_select_clause()\n-                innerq.select, innerq.select_fields = [(self.get_initial_alias(), pk.column)], [None]\n+                innerq.select = [SelectInfo((self.get_initial_alias(), pk.column), None)]\n                 values = innerq\n             where = self.where_class()\n             where.add((Constraint(None, pk.column, pk), 'in', values), AND)\n@@ -244,7 +244,7 @@ def add_date_select(self, field_name, lookup_type, order='ASC'):\n         alias = result[3][-1]\n         select = Date((alias, field.column), lookup_type)\n         self.clear_select_clause()\n-        self.select, self.select_fields = [select], [None]\n+        self.select = [SelectInfo(select, None)]\n         self.distinct = True\n         self.order_by = order == 'ASC' and [1] or [-1]\n "
        },
        {
            "sha": "842fd354d62d0de38dcd4af28daa2fde65e90fcf",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,6 +5,7 @@\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n from django.utils import six\n \n \n@@ -27,7 +28,7 @@ def load_backend(backend_name):\n     except ImportError as e_user:\n         # The database backend wasn't found. Display a helpful error message\n         # listing all possible (built-in) database backends.\n-        backend_dir = os.path.join(os.path.dirname(__file__), 'backends')\n+        backend_dir = os.path.join(os.path.dirname(upath(__file__)), 'backends')\n         try:\n             builtin_backends = [\n                 name for _, name, ispkg in pkgutil.iter_modules([backend_dir])\n@@ -53,7 +54,14 @@ class ConnectionDoesNotExist(Exception):\n \n class ConnectionHandler(object):\n     def __init__(self, databases):\n-        self.databases = databases\n+        if not databases:\n+            self.databases = {\n+                DEFAULT_DB_ALIAS: {\n+                    'ENGINE': 'django.db.backends.dummy',\n+                },\n+            }\n+        else:\n+            self.databases = databases\n         self._connections = local()\n \n     def ensure_defaults(self, alias):"
        },
        {
            "sha": "65c5c408ff2c49560d6c18ffc553a00354eb1b48",
            "filename": "django/dispatch/dispatcher.py",
            "status": "modified",
            "additions": 51,
            "deletions": 22,
            "changes": 73,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdispatch%2Fdispatcher.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdispatch%2Fdispatcher.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fdispatcher.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,6 +10,10 @@ def _make_id(target):\n     if hasattr(target, '__func__'):\n         return (id(target.__self__), id(target.__func__))\n     return id(target)\n+NONE_ID = _make_id(None)\n+\n+# A marker for caching\n+NO_RECEIVERS = object()\n \n class Signal(object):\n     \"\"\"\n@@ -20,8 +24,7 @@ class Signal(object):\n         receivers\n             { receriverkey (id) : weakref(receiver) }\n     \"\"\"\n-\n-    def __init__(self, providing_args=None):\n+    def __init__(self, providing_args=None, use_caching=False):\n         \"\"\"\n         Create a new signal.\n \n@@ -33,6 +36,13 @@ def __init__(self, providing_args=None):\n             providing_args = []\n         self.providing_args = set(providing_args)\n         self.lock = threading.Lock()\n+        self.use_caching = use_caching\n+        # For convenience we create empty caches even if they are not used.\n+        # A note about caching: if use_caching is defined, then for each\n+        # distinct sender we cache the receivers that sender has in\n+        # 'sender_receivers_cache'. The cache is cleaned when .connect() or\n+        # .disconnect() is called and populated on send().\n+        self.sender_receivers_cache = {}\n \n     def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):\n         \"\"\"\n@@ -106,6 +116,7 @@ def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):\n                     break\n             else:\n                 self.receivers.append((lookup_key, receiver))\n+            self.sender_receivers_cache = {}\n \n     def disconnect(self, receiver=None, sender=None, weak=True, dispatch_uid=None):\n         \"\"\"\n@@ -140,9 +151,10 @@ def disconnect(self, receiver=None, sender=None, weak=True, dispatch_uid=None):\n                 if r_key == lookup_key:\n                     del self.receivers[index]\n                     break\n+            self.sender_receivers_cache = {}\n \n     def has_listeners(self, sender=None):\n-        return bool(self._live_receivers(_make_id(sender)))\n+        return bool(self._live_receivers(sender))\n \n     def send(self, sender, **named):\n         \"\"\"\n@@ -163,10 +175,10 @@ def send(self, sender, **named):\n         Returns a list of tuple pairs [(receiver, response), ... ].\n         \"\"\"\n         responses = []\n-        if not self.receivers:\n+        if not self.receivers or self.sender_receivers_cache.get(sender) is NO_RECEIVERS:\n             return responses\n \n-        for receiver in self._live_receivers(_make_id(sender)):\n+        for receiver in self._live_receivers(sender):\n             response = receiver(signal=self, sender=sender, **named)\n             responses.append((receiver, response))\n         return responses\n@@ -195,12 +207,12 @@ def send_robust(self, sender, **named):\n         receiver.\n         \"\"\"\n         responses = []\n-        if not self.receivers:\n+        if not self.receivers or self.sender_receivers_cache.get(sender) is NO_RECEIVERS:\n             return responses\n \n         # Call each receiver with whatever arguments it can accept.\n         # Return a list of tuple pairs [(receiver, response), ... ].\n-        for receiver in self._live_receivers(_make_id(sender)):\n+        for receiver in self._live_receivers(sender):\n             try:\n                 response = receiver(signal=self, sender=sender, **named)\n             except Exception as err:\n@@ -209,26 +221,43 @@ def send_robust(self, sender, **named):\n                 responses.append((receiver, response))\n         return responses\n \n-    def _live_receivers(self, senderkey):\n+    def _live_receivers(self, sender):\n         \"\"\"\n         Filter sequence of receivers to get resolved, live receivers.\n \n         This checks for weak references and resolves them, then returning only\n         live receivers.\n         \"\"\"\n-        none_senderkey = _make_id(None)\n-        receivers = []\n-\n-        for (receiverkey, r_senderkey), receiver in self.receivers:\n-            if r_senderkey == none_senderkey or r_senderkey == senderkey:\n-                if isinstance(receiver, WEAKREF_TYPES):\n-                    # Dereference the weak reference.\n-                    receiver = receiver()\n-                    if receiver is not None:\n+        receivers = None\n+        if self.use_caching:\n+            receivers = self.sender_receivers_cache.get(sender)\n+            # We could end up here with NO_RECEIVERS even if we do check this case in\n+            # .send() prior to calling _live_receivers() due to concurrent .send() call.\n+            if receivers is NO_RECEIVERS:\n+                return []\n+        if receivers is None:\n+            with self.lock:\n+                senderkey = _make_id(sender)\n+                receivers = []\n+                for (receiverkey, r_senderkey), receiver in self.receivers:\n+                    if r_senderkey == NONE_ID or r_senderkey == senderkey:\n                         receivers.append(receiver)\n-                else:\n-                    receivers.append(receiver)\n-        return receivers\n+                if self.use_caching:\n+                    if not receivers:\n+                        self.sender_receivers_cache[sender] = NO_RECEIVERS\n+                    else:\n+                        # Note, we must cache the weakref versions.\n+                        self.sender_receivers_cache[sender] = receivers\n+        non_weak_receivers = []\n+        for receiver in receivers:\n+            if isinstance(receiver, WEAKREF_TYPES):\n+                # Dereference the weak reference.\n+                receiver = receiver()\n+                if receiver is not None:\n+                    non_weak_receivers.append(receiver)\n+            else:\n+                non_weak_receivers.append(receiver)\n+        return non_weak_receivers\n \n     def _remove_receiver(self, receiver):\n         \"\"\"\n@@ -246,8 +275,8 @@ def _remove_receiver(self, receiver):\n                 # after we delete some items\n                 for idx, (r_key, _) in enumerate(reversed(self.receivers)):\n                     if r_key == key:\n-                        del self.receivers[last_idx-idx]\n-\n+                        del self.receivers[last_idx - idx]\n+            self.sender_receivers_cache = {}\n \n def receiver(signal, **kwargs):\n     \"\"\""
        },
        {
            "sha": "7423669c968066984dbfaf3ded815858df16691f",
            "filename": "django/dispatch/saferef.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdispatch%2Fsaferef.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fdispatch%2Fsaferef.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fsaferef.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -67,9 +67,9 @@ class BoundMethodWeakref(object):\n             same BoundMethodWeakref instance.\n \n     \"\"\"\n-    \n+\n     _allInstances = weakref.WeakValueDictionary()\n-    \n+\n     def __new__( cls, target, onDelete=None, *arguments,**named ):\n         \"\"\"Create new instance or return current instance\n \n@@ -92,7 +92,7 @@ def __new__( cls, target, onDelete=None, *arguments,**named ):\n             cls._allInstances[key] = base\n             base.__init__( target, onDelete, *arguments,**named)\n             return base\n-    \n+\n     def __init__(self, target, onDelete=None):\n         \"\"\"Return a weak-reference-like instance for a bound method\n \n@@ -132,7 +132,7 @@ def remove(weak, self=self):\n         self.weakFunc = weakref.ref(target.__func__, remove)\n         self.selfName = str(target.__self__)\n         self.funcName = str(target.__func__.__name__)\n-    \n+\n     def calculateKey( cls, target ):\n         \"\"\"Calculate the reference key for this reference\n \n@@ -141,7 +141,7 @@ def calculateKey( cls, target ):\n         \"\"\"\n         return (id(target.__self__),id(target.__func__))\n     calculateKey = classmethod( calculateKey )\n-    \n+\n     def __str__(self):\n         \"\"\"Give a friendly representation of the object\"\"\"\n         return \"\"\"%s( %s.%s )\"\"\"%(\n@@ -157,14 +157,16 @@ def __str__(self):\n     def __bool__( self ):\n         \"\"\"Whether we are still a valid reference\"\"\"\n         return self() is not None\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     def __eq__(self, other):\n         \"\"\"Compare with another reference\"\"\"\n         if not isinstance(other, self.__class__):\n             return self.__class__ == type(other)\n         return self.key == other.key\n-    \n+\n     def __call__(self):\n         \"\"\"Return a strong reference to the bound method\n "
        },
        {
            "sha": "3893cc54ba53562466bd335ab311bcd7137fb4b7",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -69,7 +69,9 @@ def __len__(self):\n     def __bool__(self):\n         \"\"\"All formsets have a management form which is not included in the length\"\"\"\n         return True\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     @property\n     def management_form(self):\n@@ -265,7 +267,7 @@ def _should_delete_form(self, form):\n \n     def is_valid(self):\n         \"\"\"\n-        Returns True if form.errors is empty for every form in self.forms.\n+        Returns True if every form in self.forms is valid.\n         \"\"\"\n         if not self.is_bound:\n             return False\n@@ -280,8 +282,7 @@ def is_valid(self):\n                     # This form is going to be deleted so any of its errors\n                     # should not cause the entire formset to be invalid.\n                     continue\n-            if bool(self.errors[i]):\n-                forms_valid = False\n+            forms_valid &= form.is_valid()\n         return forms_valid and not bool(self.non_form_errors())\n \n     def full_clean(self):"
        },
        {
            "sha": "e9b71ccf2623ed13dfe8063aa1ac87188c210bcb",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -126,7 +126,7 @@ def model_to_dict(instance, fields=None, exclude=None):\n                 data[f.name] = []\n             else:\n                 # MultipleChoiceWidget needs a list of pks, not object instances.\n-                data[f.name] = [obj.pk for obj in f.value_from_object(instance)]\n+                data[f.name] = list(f.value_from_object(instance).values_list('pk', flat=True))\n         else:\n             data[f.name] = f.value_from_object(instance)\n     return data"
        },
        {
            "sha": "c761ea857da9f8b4fa9931f35a1a769fbfedc4f7",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -403,7 +403,7 @@ def __init__(self, attrs=None):\n     def render(self, name, value, attrs=None):\n         if value is None: value = ''\n         final_attrs = self.build_attrs(attrs, name=name)\n-        return format_html('<textarea{0}>{1}</textarea>',\n+        return format_html('<textarea{0}>\\r\\n{1}</textarea>',\n                            flatatt(final_attrs),\n                            force_text(value))\n \n@@ -528,7 +528,7 @@ def value_from_datadict(self, data, files, name):\n         values = {'true': True, 'false': False}\n         if isinstance(value, six.string_types):\n             value = values.get(value.lower(), value)\n-        return value\n+        return bool(value)\n \n     def _has_changed(self, initial, data):\n         # Sometimes data or initial could be None or '' which should be the"
        },
        {
            "sha": "edf98f6e49490f4859b307708e05c3f9f704ceb1",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 11,
            "deletions": 13,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -110,7 +110,7 @@ def parse(self):\n         # HTTP spec says that Content-Length >= 0 is valid\n         # handling content-length == 0 before continuing\n         if self._content_length == 0:\n-            return QueryDict(MultiValueDict(), encoding=self._encoding), MultiValueDict()\n+            return QueryDict('', encoding=self._encoding), MultiValueDict()\n \n         # See if the handler will want to take care of the parsing.\n         # This allows overriding everything if somebody wants it.\n@@ -199,6 +199,12 @@ def parse(self):\n                         for chunk in field_stream:\n                             if transfer_encoding == 'base64':\n                                 # We only special-case base64 transfer encoding\n+                                # We should always read base64 streams by multiple of 4\n+                                over_bytes = len(chunk) % 4\n+                                if over_bytes:\n+                                    over_chunk = field_stream.read(4 - over_bytes)\n+                                    chunk += over_chunk\n+\n                                 try:\n                                     chunk = base64.b64decode(chunk)\n                                 except Exception as e:\n@@ -256,7 +262,7 @@ def IE_sanitize(self, filename):\n         \"\"\"Cleanup filename from Internet Explorer full paths.\"\"\"\n         return filename and filename[filename.rfind(\"\\\\\")+1:].strip()\n \n-class LazyStream(object):\n+class LazyStream(six.Iterator):\n     \"\"\"\n     The LazyStream wrapper allows one to get and \"unget\" bytes from a stream.\n \n@@ -323,8 +329,6 @@ def __next__(self):\n         self.position += len(output)\n         return output\n \n-    next = __next__             # Python 2 compatibility\n-\n     def close(self):\n         \"\"\"\n         Used to invalidate/disable this lazy stream.\n@@ -369,7 +373,7 @@ def _update_unget_history(self, num_bytes):\n                 \" if there is none, report this to the Django developers.\"\n             )\n \n-class ChunkIter(object):\n+class ChunkIter(six.Iterator):\n     \"\"\"\n     An iterable that will yield chunks of data. Given a file-like object as the\n     constructor, this object will yield chunks of read operations from that\n@@ -389,12 +393,10 @@ def __next__(self):\n         else:\n             raise StopIteration()\n \n-    next = __next__             # Python 2 compatibility\n-\n     def __iter__(self):\n         return self\n \n-class InterBoundaryIter(object):\n+class InterBoundaryIter(six.Iterator):\n     \"\"\"\n     A Producer that will iterate over boundaries.\n     \"\"\"\n@@ -411,9 +413,7 @@ def __next__(self):\n         except InputStreamExhausted:\n             raise StopIteration()\n \n-    next = __next__             # Python 2 compatibility\n-\n-class BoundaryIter(object):\n+class BoundaryIter(six.Iterator):\n     \"\"\"\n     A Producer that is sensitive to boundaries.\n \n@@ -489,8 +489,6 @@ def __next__(self):\n                 stream.unget(chunk[-rollback:])\n                 return chunk[:-rollback]\n \n-    next = __next__             # Python 2 compatibility\n-\n     def _find_boundary(self, data, eof = False):\n         \"\"\"\n         Finds a multipart boundary in data."
        },
        {
            "sha": "8f74bddb711e09e34e1042bb3476fefa47e93423",
            "filename": "django/http/request.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fhttp%2Frequest.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fhttp%2Frequest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Frequest.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -25,6 +25,7 @@\n \n RAISE_ERROR = object()\n absolute_http_url_re = re.compile(r\"^https?://\", re.I)\n+host_validation_re = re.compile(r\"^([a-z0-9.-]+|\\[[a-f0-9]*:[a-f0-9:]+\\])(:\\d+)?$\")\n \n \n class UnreadablePostError(IOError):\n@@ -64,7 +65,7 @@ def get_host(self):\n                 host = '%s:%s' % (host, server_port)\n \n         # Disallow potentially poisoned hostnames.\n-        if set(';/?@&=+$,').intersection(host):\n+        if not host_validation_re.match(host.lower()):\n             raise SuspiciousOperation('Invalid HTTP_HOST header: %s' % host)\n \n         return host\n@@ -276,6 +277,9 @@ def __init__(self, query_string, mutable=False, encoding=None):\n             encoding = settings.DEFAULT_CHARSET\n         self.encoding = encoding\n         if six.PY3:\n+            if isinstance(query_string, bytes):\n+                # query_string contains URL-encoded data, a subset of ASCII.\n+                query_string = query_string.decode()\n             for key, value in parse_qsl(query_string or '',\n                                         keep_blank_values=True,\n                                         encoding=encoding):"
        },
        {
            "sha": "df0a955b181a76f22266a392819f0e0c8f64f39f",
            "filename": "django/http/response.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fhttp%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fhttp%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fresponse.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -23,7 +23,7 @@ class BadHeaderError(ValueError):\n     pass\n \n \n-class HttpResponseBase(object):\n+class HttpResponseBase(six.Iterator):\n     \"\"\"\n     An HTTP response base class with dictionary-accessed headers.\n \n@@ -218,8 +218,6 @@ def __next__(self):\n         # Subclasses must define self._iterator for this function.\n         return self.make_bytes(next(self._iterator))\n \n-    next = __next__             # Python 2 compatibility\n-\n     # These methods partially implement the file-like object interface.\n     # See http://docs.python.org/lib/bltin-file-objects.html\n "
        },
        {
            "sha": "de2b86f6304607f9e765285aaeaf754dcb6aea08",
            "filename": "django/middleware/cache.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fmiddleware%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fmiddleware%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcache.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -126,7 +126,6 @@ class FetchFromCacheMiddleware(object):\n     def __init__(self):\n         self.cache_timeout = settings.CACHE_MIDDLEWARE_SECONDS\n         self.key_prefix = settings.CACHE_MIDDLEWARE_KEY_PREFIX\n-        self.cache_anonymous_only = getattr(settings, 'CACHE_MIDDLEWARE_ANONYMOUS_ONLY', False)\n         self.cache_alias = settings.CACHE_MIDDLEWARE_ALIAS\n         self.cache = get_cache(self.cache_alias)\n "
        },
        {
            "sha": "ccc9fbfaadce460ac4f5675c3f2faa13becfac3f",
            "filename": "django/middleware/common.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fmiddleware%2Fcommon.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fmiddleware%2Fcommon.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcommon.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,6 +6,7 @@\n from django import http\n from django.core.mail import mail_managers\n from django.utils.http import urlquote\n+from django.utils import six\n from django.core import urlresolvers\n \n \n@@ -87,7 +88,17 @@ def process_request(self, request):\n         else:\n             newurl = urlquote(new_url[1])\n         if request.META.get('QUERY_STRING', ''):\n-            newurl += '?' + request.META['QUERY_STRING']\n+            if six.PY3:\n+                newurl += '?' + request.META['QUERY_STRING']\n+            else:\n+                # `query_string` is a bytestring. Appending it to the unicode\n+                # string `newurl` will fail if it isn't ASCII-only. This isn't\n+                # allowed; only broken software generates such query strings.\n+                # Better drop the invalid query string than crash (#15152).\n+                try:\n+                    newurl += '?' + request.META['QUERY_STRING'].decode()\n+                except UnicodeDecodeError:\n+                    pass\n         return http.HttpResponsePermanentRedirect(newurl)\n \n     def process_response(self, request, response):"
        },
        {
            "sha": "9f896347a4b7847985d5981c1d17ef7ac834c9ad",
            "filename": "django/shortcuts/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fshortcuts%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fshortcuts%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fshortcuts%2F__init__.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,6 +7,7 @@\n from django.template import loader, RequestContext\n from django.http import HttpResponse, Http404\n from django.http import HttpResponseRedirect, HttpResponsePermanentRedirect\n+from django.db.models.base import ModelBase\n from django.db.models.manager import Manager\n from django.db.models.query import QuerySet\n from django.core import urlresolvers\n@@ -46,7 +47,7 @@ def render(request, *args, **kwargs):\n \n def redirect(to, *args, **kwargs):\n     \"\"\"\n-    Returns an HttpResponseRedirect to the apropriate URL for the arguments\n+    Returns an HttpResponseRedirect to the appropriate URL for the arguments\n     passed.\n \n     The arguments could be:\n@@ -72,13 +73,20 @@ def _get_queryset(klass):\n     \"\"\"\n     Returns a QuerySet from a Model, Manager, or QuerySet. Created to make\n     get_object_or_404 and get_list_or_404 more DRY.\n+\n+    Raises a ValueError if klass is not a Model, Manager, or QuerySet.\n     \"\"\"\n     if isinstance(klass, QuerySet):\n         return klass\n     elif isinstance(klass, Manager):\n         manager = klass\n-    else:\n+    elif isinstance(klass, ModelBase):\n         manager = klass._default_manager\n+    else:\n+        klass__name = klass.__name__ if isinstance(klass, type) \\\n+                      else klass.__class__.__name__\n+        raise ValueError(\"Object is of type '%s', but must be a Django Model, \"\n+                         \"Manager, or QuerySet\" % klass__name)\n     return manager.all()\n \n def get_object_or_404(klass, *args, **kwargs):"
        },
        {
            "sha": "dac4e5ddb41a227a0803bf270f4401dbfe53eda1",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -704,7 +704,7 @@ def get_digit(value, arg):\n @register.filter(expects_localtime=True, is_safe=False)\n def date(value, arg=None):\n     \"\"\"Formats a date according to the given format.\"\"\"\n-    if not value:\n+    if value in (None, ''):\n         return ''\n     if arg is None:\n         arg = settings.DATE_FORMAT"
        },
        {
            "sha": "aca2f41f2db63aabfda4dba3f5052ad9d99be675",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -398,10 +398,14 @@ def render(self, context):\n \n         view_name = self.view_name.resolve(context)\n \n+        if not view_name:\n+            raise NoReverseMatch(\"'url' requires a non-empty first argument. \"\n+                \"The syntax changed in Django 1.5, see the docs.\")\n+\n         # Try to look up the URL twice: once given the view name, and again\n         # relative to what we guess is the \"main\" app. If they both fail,\n         # re-raise the NoReverseMatch unless we're using the\n-        # {% url ... as var %} construct in which cause return nothing.\n+        # {% url ... as var %} construct in which case return nothing.\n         url = ''\n         try:\n             url = reverse(view_name, args=args, kwargs=kwargs, current_app=context.current_app)\n@@ -1258,7 +1262,12 @@ def url(parser, token):\n     if len(bits) < 2:\n         raise TemplateSyntaxError(\"'%s' takes at least one argument\"\n                                   \" (path to a view)\" % bits[0])\n-    viewname = parser.compile_filter(bits[1])\n+    try:\n+        viewname = parser.compile_filter(bits[1])\n+    except TemplateSyntaxError as exc:\n+        exc.args = (exc.args[0] + \". \"\n+                \"The syntax of 'url' changed in Django 1.5, see the docs.\"),\n+        raise\n     args = []\n     kwargs = {}\n     asvar = None"
        },
        {
            "sha": "3b3b41331a9905adc82dba5ca31b665abef27336",
            "filename": "django/template/response.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftemplate%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftemplate%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fresponse.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -40,7 +40,7 @@ def __getstate__(self):\n         rendered, and that the pickled state only includes rendered\n         data, not the data used to construct the response.\n         \"\"\"\n-        obj_dict = self.__dict__.copy()\n+        obj_dict = super(SimpleTemplateResponse, self).__getstate__()\n         if not self._is_rendered:\n             raise ContentNotRenderedError('The response content must be '\n                                           'rendered before it can be pickled.')"
        },
        {
            "sha": "a96bdff3b309fc5515e4e151f6df0932b0c6ae10",
            "filename": "django/test/signals.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftest%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftest%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsignals.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,6 +5,7 @@\n from django.db import connections\n from django.dispatch import receiver, Signal\n from django.utils import timezone\n+from django.utils.functional import empty\n \n template_rendered = Signal(providing_args=[\"template\", \"context\"])\n \n@@ -72,3 +73,9 @@ def language_changed(**kwargs):\n         trans_real._default = None\n         if kwargs['setting'] == 'LOCALE_PATHS':\n             trans_real._translations = {}\n+\n+@receiver(setting_changed)\n+def file_storage_changed(**kwargs):\n+    if kwargs['setting'] in ('MEDIA_ROOT', 'DEFAULT_FILE_STORAGE'):\n+        from django.core.files.storage import default_storage\n+        default_storage._wrapped = empty"
        },
        {
            "sha": "3af6b8c346190f73380db65bfd94dfdcefd84c02",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 63,
            "deletions": 53,
            "changes": 116,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -241,6 +241,40 @@ def message(self):\n \n \n class SimpleTestCase(ut2.TestCase):\n+    def __call__(self, result=None):\n+        \"\"\"\n+        Wrapper around default __call__ method to perform common Django test\n+        set up. This means that user-defined Test Cases aren't required to\n+        include a call to super().setUp().\n+        \"\"\"\n+        testMethod = getattr(self, self._testMethodName)\n+        skipped = (getattr(self.__class__, \"__unittest_skip__\", False) or\n+            getattr(testMethod, \"__unittest_skip__\", False))\n+\n+        if not skipped:\n+            try:\n+                self._pre_setup()\n+            except (KeyboardInterrupt, SystemExit):\n+                raise\n+            except Exception:\n+                result.addError(self, sys.exc_info())\n+                return\n+        super(SimpleTestCase, self).__call__(result)\n+        if not skipped:\n+            try:\n+                self._post_teardown()\n+            except (KeyboardInterrupt, SystemExit):\n+                raise\n+            except Exception:\n+                result.addError(self, sys.exc_info())\n+                return\n+\n+    def _pre_setup(self):\n+        pass\n+\n+    def _post_teardown(self):\n+        pass\n+\n     def save_warnings_state(self):\n         \"\"\"\n         Saves the state of the warnings module\n@@ -412,10 +446,20 @@ def _pre_setup(self):\n               ROOT_URLCONF with it.\n             * Clearing the mail test outbox.\n         \"\"\"\n+        self.client = self.client_class()\n         self._fixture_setup()\n         self._urlconf_setup()\n         mail.outbox = []\n \n+    def _databases_names(self, include_mirrors=True):\n+        # If the test case has a multi_db=True flag, act on all databases,\n+        # including mirrors or not. Otherwise, just on the default DB.\n+        if getattr(self, 'multi_db', False):\n+            return [alias for alias in connections\n+                    if include_mirrors or not connections[alias].settings_dict['TEST_MIRROR']]\n+        else:\n+            return [DEFAULT_DB_ALIAS]\n+\n     def _reset_sequences(self, db_name):\n         conn = connections[db_name]\n         if conn.features.supports_sequence_reset:\n@@ -433,10 +477,7 @@ def _reset_sequences(self, db_name):\n                 transaction.commit_unless_managed(using=db_name)\n \n     def _fixture_setup(self):\n-        # If the test case has a multi_db=True flag, act on all databases.\n-        # Otherwise, just on the default DB.\n-        db_names = connections if getattr(self, 'multi_db', False) else [DEFAULT_DB_ALIAS]\n-        for db_name in db_names:\n+        for db_name in self._databases_names(include_mirrors=False):\n             # Reset sequences\n             if self.reset_sequences:\n                 self._reset_sequences(db_name)\n@@ -453,35 +494,6 @@ def _urlconf_setup(self):\n             settings.ROOT_URLCONF = self.urls\n             clear_url_caches()\n \n-    def __call__(self, result=None):\n-        \"\"\"\n-        Wrapper around default __call__ method to perform common Django test\n-        set up. This means that user-defined Test Cases aren't required to\n-        include a call to super().setUp().\n-        \"\"\"\n-        testMethod = getattr(self, self._testMethodName)\n-        skipped = (getattr(self.__class__, \"__unittest_skip__\", False) or\n-            getattr(testMethod, \"__unittest_skip__\", False))\n-\n-        if not skipped:\n-            self.client = self.client_class()\n-            try:\n-                self._pre_setup()\n-            except (KeyboardInterrupt, SystemExit):\n-                raise\n-            except Exception:\n-                result.addError(self, sys.exc_info())\n-                return\n-        super(TransactionTestCase, self).__call__(result)\n-        if not skipped:\n-            try:\n-                self._post_teardown()\n-            except (KeyboardInterrupt, SystemExit):\n-                raise\n-            except Exception:\n-                result.addError(self, sys.exc_info())\n-                return\n-\n     def _post_teardown(self):\n         \"\"\" Performs any post-test things. This includes:\n \n@@ -502,10 +514,12 @@ def _post_teardown(self):\n             conn.close()\n \n     def _fixture_teardown(self):\n-        # If the test case has a multi_db=True flag, flush all databases.\n-        # Otherwise, just flush default.\n-        databases = connections if getattr(self, 'multi_db', False) else [DEFAULT_DB_ALIAS]\n-        for db in databases:\n+        # Roll back any pending transactions in order to avoid a deadlock\n+        # during flush when TEST_MIRROR is used (#18984).\n+        for conn in connections.all():\n+            conn.rollback_unless_managed()\n+\n+        for db in self._databases_names(include_mirrors=False):\n             call_command('flush', verbosity=0, interactive=False, database=db,\n                          skip_validation=True, reset_sequences=False)\n \n@@ -753,6 +767,12 @@ def assertQuerysetEqual(self, qs, values, transform=repr, ordered=True):\n         items = six.moves.map(transform, qs)\n         if not ordered:\n             return self.assertEqual(set(items), set(values))\n+        values = list(values)\n+        # For example qs.iterator() could be passed as qs, but it does not\n+        # have 'ordered' attribute.\n+        if len(values) > 1 and hasattr(qs, 'ordered') and not qs.ordered:\n+            raise ValueError(\"Trying to compare non-ordered queryset \"\n+                             \"against more than one ordered values\")\n         return self.assertEqual(list(items), values)\n \n     def assertNumQueries(self, num, func=None, *args, **kwargs):\n@@ -790,19 +810,15 @@ def _fixture_setup(self):\n \n         assert not self.reset_sequences, 'reset_sequences cannot be used on TestCase instances'\n \n-        # If the test case has a multi_db=True flag, setup all databases.\n-        # Otherwise, just use default.\n-        db_names = connections if getattr(self, 'multi_db', False) else [DEFAULT_DB_ALIAS]\n-\n-        for db_name in db_names:\n+        for db_name in self._databases_names():\n             transaction.enter_transaction_management(using=db_name)\n             transaction.managed(True, using=db_name)\n         disable_transaction_methods()\n \n         from django.contrib.sites.models import Site\n         Site.objects.clear_cache()\n \n-        for db in db_names:\n+        for db in self._databases_names(include_mirrors=False):\n             if hasattr(self, 'fixtures'):\n                 call_command('loaddata', *self.fixtures,\n                              **{\n@@ -816,15 +832,8 @@ def _fixture_teardown(self):\n         if not connections_support_transactions():\n             return super(TestCase, self)._fixture_teardown()\n \n-        # If the test case has a multi_db=True flag, teardown all databases.\n-        # Otherwise, just teardown default.\n-        if getattr(self, 'multi_db', False):\n-            databases = connections\n-        else:\n-            databases = [DEFAULT_DB_ALIAS]\n-\n         restore_transaction_methods()\n-        for db in databases:\n+        for db in self._databases_names():\n             transaction.rollback(using=db)\n             transaction.leave_transaction_management(using=db)\n \n@@ -1025,6 +1034,7 @@ def run(self):\n                         (self.host, port), QuietWSGIRequestHandler)\n                 except WSGIServerException as e:\n                     if (index + 1 < len(self.possible_ports) and\n+                        hasattr(e.args[0], 'errno') and\n                         e.args[0].errno == errno.EADDRINUSE):\n                         # This port is already in use, so we go on and try with\n                         # the next one in the list.\n@@ -1077,7 +1087,7 @@ def setUpClass(cls):\n         for conn in connections.all():\n             # If using in-memory sqlite databases, pass the connections to\n             # the server thread.\n-            if (conn.settings_dict['ENGINE'] == 'django.db.backends.sqlite3'\n+            if (conn.settings_dict['ENGINE'].rsplit('.', 1)[-1] in ('sqlite3', 'spatialite')\n                 and conn.settings_dict['NAME'] == ':memory:'):\n                 # Explicitly enable thread-shareability for this connection\n                 conn.allow_thread_sharing = True\n@@ -1129,7 +1139,7 @@ def tearDownClass(cls):\n \n         # Restore sqlite connections' non-sharability\n         for conn in connections.all():\n-            if (conn.settings_dict['ENGINE'] == 'django.db.backends.sqlite3'\n+            if (conn.settings_dict['ENGINE'].rsplit('.', 1)[-1] in ('sqlite3', 'spatialite')\n                 and conn.settings_dict['NAME'] == ':memory:'):\n                 conn.allow_thread_sharing = False\n "
        },
        {
            "sha": "8114ae0e6a07ef84952d46e434b4b449f1ffacfb",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -187,8 +187,12 @@ def __exit__(self, exc_type, exc_value, traceback):\n         self.disable()\n \n     def __call__(self, test_func):\n-        from django.test import TransactionTestCase\n-        if isinstance(test_func, type) and issubclass(test_func, TransactionTestCase):\n+        from django.test import SimpleTestCase\n+        if isinstance(test_func, type):\n+            if not issubclass(test_func, SimpleTestCase):\n+                raise Exception(\n+                    \"Only subclasses of Django SimpleTestCase can be decorated \"\n+                    \"with override_settings\")\n             original_pre_setup = test_func._pre_setup\n             original_post_teardown = test_func._post_teardown\n "
        },
        {
            "sha": "6c1cd17a83c0204c6000c4195afdd31ee8bed335",
            "filename": "django/utils/_os.py",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2F_os.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2F_os.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2F_os.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,6 +1,8 @@\n import os\n import stat\n+import sys\n from os.path import join, normcase, normpath, abspath, isabs, sep, dirname\n+\n from django.utils.encoding import force_text\n from django.utils import six\n \n@@ -10,6 +12,9 @@\n     class WindowsError(Exception):\n         pass\n \n+if not six.PY3:\n+    fs_encoding = sys.getfilesystemencoding() or sys.getdefaultencoding()\n+\n \n # Under Python 2, define our own abspath function that can handle joining\n # unicode paths to a current working directory that has non-ASCII characters\n@@ -29,6 +34,23 @@ def abspathu(path):\n             path = join(os.getcwdu(), path)\n         return normpath(path)\n \n+def upath(path):\n+    \"\"\"\n+    Always return a unicode path.\n+    \"\"\"\n+    if not six.PY3:\n+        return path.decode(fs_encoding)\n+    return path\n+\n+def npath(path):\n+    \"\"\"\n+    Always return a native path, that is unicode on Python 3 and bytestring on\n+    Python 2.\n+    \"\"\"\n+    if not six.PY3 and not isinstance(path, bytes):\n+        return path.encode(fs_encoding)\n+    return path\n+\n def safe_join(base, *paths):\n     \"\"\"\n     Joins one or more path components to the base path component intelligently.\n@@ -74,4 +96,3 @@ def rmtree_errorhandler(func, path, exc_info):\n     os.chmod(path, stat.S_IWRITE)\n     # use the original function to repeat the operation\n     func(path)\n-"
        },
        {
            "sha": "617fc9da7d3e3de4aa3fb7def9a677ab94542e74",
            "filename": "django/utils/autoreload.py",
            "status": "modified",
            "additions": 38,
            "deletions": 4,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fautoreload.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fautoreload.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fautoreload.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -28,7 +28,7 @@\n # OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n # OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n \n-import os, sys, time, signal\n+import os, sys, time, signal, traceback\n \n try:\n     from django.utils.six.moves import _thread as thread\n@@ -52,10 +52,17 @@\n _mtimes = {}\n _win = (sys.platform == \"win32\")\n \n+_error_files = []\n+\n def code_changed():\n     global _mtimes, _win\n-    filenames = [getattr(m, \"__file__\", None) for m in sys.modules.values()]\n-    for filename in filter(None, filenames):\n+    filenames = []\n+    for m in sys.modules.values():\n+        try:\n+            filenames.append(m.__file__)\n+        except AttributeError:\n+            pass\n+    for filename in filenames + _error_files:\n         if filename.endswith(\".pyc\") or filename.endswith(\".pyo\"):\n             filename = filename[:-1]\n         if filename.endswith(\"$py.class\"):\n@@ -71,9 +78,34 @@ def code_changed():\n             continue\n         if mtime != _mtimes[filename]:\n             _mtimes = {}\n+            try:\n+                del _error_files[_error_files.index(filename)]\n+            except ValueError:\n+                pass\n             return True\n     return False\n \n+def check_errors(fn):\n+    def wrapper(*args, **kwargs):\n+        try:\n+            fn(*args, **kwargs)\n+        except (ImportError, IndentationError, NameError, SyntaxError,\n+                TypeError, AttributeError):\n+            et, ev, tb = sys.exc_info()\n+\n+            if getattr(ev, 'filename', None) is None:\n+                # get the filename from the last item in the stack\n+                filename = traceback.extract_tb(tb)[-1][0]\n+            else:\n+                filename = ev.filename\n+\n+            if filename not in _error_files:\n+                _error_files.append(filename)\n+\n+            raise\n+\n+    return wrapper\n+\n def ensure_echo_on():\n     if termios:\n         fd = sys.stdin\n@@ -142,5 +174,7 @@ def main(main_func, args=None, kwargs=None):\n         reloader = jython_reloader\n     else:\n         reloader = python_reloader\n-    reloader(main_func, args, kwargs)\n+\n+    wrapped_main_func = check_errors(main_func)\n+    reloader(wrapped_main_func, args, kwargs)\n "
        },
        {
            "sha": "f81fb88a19907a6be98cc6f8413ba1b3deb6d7b7",
            "filename": "django/utils/datastructures.py",
            "status": "modified",
            "additions": 14,
            "deletions": 19,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdatastructures.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,6 +1,5 @@\n import copy\n import warnings\n-from types import GeneratorType\n from django.utils import six\n \n \n@@ -120,27 +119,23 @@ def __new__(cls, *args, **kwargs):\n         return instance\n \n     def __init__(self, data=None):\n-        if data is None:\n-            data = {}\n-        elif isinstance(data, GeneratorType):\n-            # Unfortunately we need to be able to read a generator twice.  Once\n-            # to get the data into self with our super().__init__ call and a\n-            # second time to setup keyOrder correctly\n-            data = list(data)\n-        super(SortedDict, self).__init__(data)\n-        if isinstance(data, dict):\n-            self.keyOrder = list(data)\n+        if data is None or isinstance(data, dict):\n+            data = data or []\n+            super(SortedDict, self).__init__(data)\n+            self.keyOrder = list(data) if data else []\n         else:\n-            self.keyOrder = []\n-            seen = set()\n+            super(SortedDict, self).__init__()\n+            super_set = super(SortedDict, self).__setitem__\n             for key, value in data:\n-                if key not in seen:\n+                # Take the ordering from first key\n+                if key not in self:\n                     self.keyOrder.append(key)\n-                    seen.add(key)\n+                # But override with last value in data (dict() does this)\n+                super_set(key, value)\n \n     def __deepcopy__(self, memo):\n         return self.__class__([(key, copy.deepcopy(value, memo))\n-                               for key, value in six.iteritems(self)])\n+                               for key, value in self.items()])\n \n     def __copy__(self):\n         # The Python's default copy implementation will alter the state\n@@ -199,13 +194,13 @@ def _itervalues(self):\n         itervalues = _itervalues\n \n         def items(self):\n-            return list(self.iteritems())\n+            return [(k, self[k]) for k in self.keyOrder]\n \n         def keys(self):\n-            return list(self.iterkeys())\n+            return self.keyOrder[:]\n \n         def values(self):\n-            return list(self.itervalues())\n+            return [self[k] for k in self.keyOrder]\n \n     def update(self, dict_):\n         for k, v in six.iteritems(dict_):"
        },
        {
            "sha": "15215849b2dabfcf7d0564896d29da4955a8c980",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -216,7 +216,7 @@ def iri_to_uri(iri):\n     return quote(force_bytes(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n \n def filepath_to_uri(path):\n-    \"\"\"Convert an file system path to a URI portion that is suitable for\n+    \"\"\"Convert a file system path to a URI portion that is suitable for\n     inclusion in a URL.\n \n     We are assuming input is either UTF-8 or unicode already."
        },
        {
            "sha": "03b9918edfcfa16f0cb5c6876e058588efdb3cb4",
            "filename": "django/utils/formats.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fformats.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,6 +16,17 @@\n _format_cache = {}\n _format_modules_cache = {}\n \n+ISO_INPUT_FORMATS = {\n+    'DATE_INPUT_FORMATS': ('%Y-%m-%d',),\n+    'TIME_INPUT_FORMATS': ('%H:%M:%S', '%H:%M'),\n+    'DATETIME_INPUT_FORMATS': (\n+        '%Y-%m-%d %H:%M:%S',\n+        '%Y-%m-%d %H:%M:%S.%f',\n+        '%Y-%m-%d %H:%M',\n+        '%Y-%m-%d'\n+    ),\n+}\n+\n def reset_format_cache():\n     \"\"\"Clear any cached formats.\n \n@@ -82,6 +93,11 @@ def get_format(format_type, lang=None, use_l10n=None):\n             for module in get_format_modules(lang):\n                 try:\n                     val = getattr(module, format_type)\n+                    for iso_input in ISO_INPUT_FORMATS.get(format_type, ()):\n+                        if iso_input not in val:\n+                            if isinstance(val, tuple):\n+                                val = list(val)\n+                            val.append(iso_input)\n                     _format_cache[cache_key] = val\n                     return val\n                 except AttributeError:"
        },
        {
            "sha": "661518e3cc1a3b9ade9afc1e38d5d345e8c087cc",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,9 +5,9 @@\n \n from django.utils import six\n \n-# You can't trivially replace this `functools.partial` because this binds to\n-# classes and returns bound instances, whereas functools.partial (on CPython)\n-# is a type and its instances don't bind.\n+# You can't trivially replace this with `functools.partial` because this binds\n+# to classes and returns bound instances, whereas functools.partial (on\n+# CPython) is a type and its instances don't bind.\n def curry(_curried_func, *args, **kwargs):\n     def _curried(*moreargs, **morekwargs):\n         return _curried_func(*(args+moreargs), **dict(kwargs, **morekwargs))\n@@ -33,8 +33,8 @@ def wrapper(*args):\n \n class cached_property(object):\n     \"\"\"\n-    Decorator that creates converts a method with a single\n-    self argument into a property cached on the instance.\n+    Decorator that converts a method with a single self argument into a\n+    property cached on the instance.\n     \"\"\"\n     def __init__(self, func):\n         self.func = func"
        },
        {
            "sha": "25605bea0448a5a07c129f26563016b8c11d8094",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,7 +18,7 @@\n \n # Configuration for urlize() function.\n TRAILING_PUNCTUATION = ['.', ',', ':', ';', '.)']\n-WRAPPING_PUNCTUATION = [('(', ')'), ('<', '>'), ('&lt;', '&gt;')]\n+WRAPPING_PUNCTUATION = [('(', ')'), ('<', '>'), ('[', ']'), ('&lt;', '&gt;')]\n \n # List of possible strings used for bullets in bulleted lists.\n DOTS = ['&middot;', '*', '\\u2022', '&#149;', '&bull;', '&#8226;']\n@@ -33,6 +33,7 @@\n html_gunk_re = re.compile(r'(?:<br clear=\"all\">|<i><\\/i>|<b><\\/b>|<em><\\/em>|<strong><\\/strong>|<\\/?smallcaps>|<\\/?uppercase>)', re.IGNORECASE)\n hard_coded_bullets_re = re.compile(r'((?:<p>(?:%s).*?[a-zA-Z].*?</p>\\s*)+)' % '|'.join([re.escape(x) for x in DOTS]), re.DOTALL)\n trailing_empty_content_re = re.compile(r'(?:<p>(?:&nbsp;|\\s|<br \\/>)*?</p>\\s*)+\\Z')\n+strip_tags_re = re.compile(r'</?\\S([^=]*=(\\s*\"[^\"]*\"|\\s*\\'[^\\']*\\'|\\S*)|[^>])*?>', re.IGNORECASE)\n \n \n def escape(text):\n@@ -117,7 +118,7 @@ def linebreaks(value, autoescape=False):\n \n def strip_tags(value):\n     \"\"\"Returns the given HTML with all tags stripped.\"\"\"\n-    return re.sub(r'<[^>]*?>', '', force_text(value))\n+    return strip_tags_re.sub('', force_text(value))\n strip_tags = allow_lazy(strip_tags)\n \n def remove_tags(html, tags):\n@@ -149,13 +150,17 @@ def fix_ampersands(value):\n def smart_urlquote(url):\n     \"Quotes a URL if it isn't already quoted.\"\n     # Handle IDN before quoting.\n-    scheme, netloc, path, query, fragment = urlsplit(url)\n     try:\n-        netloc = netloc.encode('idna').decode('ascii') # IDN -> ACE\n-    except UnicodeError: # invalid domain part\n+        scheme, netloc, path, query, fragment = urlsplit(url)\n+        try:\n+            netloc = netloc.encode('idna').decode('ascii') # IDN -> ACE\n+        except UnicodeError: # invalid domain part\n+            pass\n+        else:\n+            url = urlunsplit((scheme, netloc, path, query, fragment))\n+    except ValueError:\n+        # invalid IPv6 URL (normally square brackets in hostname part).\n         pass\n-    else:\n-        url = urlunsplit((scheme, netloc, path, query, fragment))\n \n     # An URL is considered unquoted if it contains no % characters or\n     # contains a % not followed by two hexadecimal digits. See #9655."
        },
        {
            "sha": "0ab5198804274adbc42b0c9e4a24fb746e5299f9",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -227,3 +227,15 @@ def same_origin(url1, url2):\n     \"\"\"\n     p1, p2 = urllib_parse.urlparse(url1), urllib_parse.urlparse(url2)\n     return (p1.scheme, p1.hostname, p1.port) == (p2.scheme, p2.hostname, p2.port)\n+\n+def is_safe_url(url, host=None):\n+    \"\"\"\n+    Return ``True`` if the url is a safe redirection (i.e. it doesn't point to\n+    a different host).\n+\n+    Always returns ``False`` on an empty url.\n+    \"\"\"\n+    if not url:\n+        return False\n+    netloc = urllib_parse.urlparse(url)[1]\n+    return not netloc or netloc == host"
        },
        {
            "sha": "736154a178308dcadc022ad524cc72f8263eed1c",
            "filename": "django/utils/log.py",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Flog.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -3,6 +3,7 @@\n \n from django.conf import settings\n from django.core import mail\n+from django.core.mail import get_connection\n from django.views.debug import ExceptionReporter, get_exception_reporter_filter\n \n \n@@ -39,7 +40,7 @@ def emit(self, record):\n         },\n     },\n     'handlers': {\n-        'console':{\n+        'console': {\n             'level': 'INFO',\n             'filters': ['require_debug_true'],\n             'class': 'logging.StreamHandler',\n@@ -62,6 +63,9 @@ def emit(self, record):\n             'level': 'ERROR',\n             'propagate': False,\n         },\n+        'py.warnings': {\n+            'handlers': ['console'],\n+        },\n     }\n }\n \n@@ -73,9 +77,10 @@ class AdminEmailHandler(logging.Handler):\n     request data will be provided in the email report.\n     \"\"\"\n \n-    def __init__(self, include_html=False):\n+    def __init__(self, include_html=False, email_backend=None):\n         logging.Handler.__init__(self)\n         self.include_html = include_html\n+        self.email_backend = email_backend\n \n     def emit(self, record):\n         try:\n@@ -107,7 +112,12 @@ def emit(self, record):\n         message = \"%s\\n\\n%s\" % (stack_trace, request_repr)\n         reporter = ExceptionReporter(request, is_email=True, *exc_info)\n         html_message = self.include_html and reporter.get_traceback_html() or None\n-        mail.mail_admins(subject, message, fail_silently=True, html_message=html_message)\n+        mail.mail_admins(subject, message, fail_silently=True,\n+                         html_message=html_message,\n+                         connection=self.connection())\n+\n+    def connection(self):\n+        return get_connection(backend=self.email_backend)\n \n     def format_subject(self, subject):\n         \"\"\""
        },
        {
            "sha": "cf6270cc0c6f1d04bff58df3380fdc85caddea28",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,6 +10,7 @@\n \n from django.utils.importlib import import_module\n from django.utils.encoding import force_str, force_text\n+from django.utils._os import upath\n from django.utils.safestring import mark_safe, SafeData\n from django.utils import six\n from django.utils.six import StringIO\n@@ -109,7 +110,7 @@ def translation(language):\n \n     from django.conf import settings\n \n-    globalpath = os.path.join(os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n+    globalpath = os.path.join(os.path.dirname(upath(sys.modules[settings.__module__].__file__)), 'locale')\n \n     def _fetch(lang, fallback=None):\n \n@@ -151,7 +152,7 @@ def _merge(path):\n \n         for appname in reversed(settings.INSTALLED_APPS):\n             app = import_module(appname)\n-            apppath = os.path.join(os.path.dirname(app.__file__), 'locale')\n+            apppath = os.path.join(os.path.dirname(upath(app.__file__)), 'locale')\n \n             if os.path.isdir(apppath):\n                 res = _merge(apppath)\n@@ -246,7 +247,8 @@ def do_translate(message, translation_function):\n     \"\"\"\n     global _default\n \n-    eol_message = message.replace('\\r\\n', '\\n').replace('\\r', '\\n')\n+    # str() is allowing a bytestring message to remain bytestring on Python 2\n+    eol_message = message.replace(str('\\r\\n'), str('\\n')).replace(str('\\r'), str('\\n'))\n     t = getattr(_active, \"value\", None)\n     if t is not None:\n         result = getattr(t, translation_function)(eol_message)\n@@ -336,7 +338,7 @@ def all_locale_paths():\n     \"\"\"\n     from django.conf import settings\n     globalpath = os.path.join(\n-        os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n+        os.path.dirname(upath(sys.modules[settings.__module__].__file__)), 'locale')\n     return [globalpath] + list(settings.LOCALE_PATHS)\n \n def check_for_language(lang_code):"
        },
        {
            "sha": "ce490224e0211d60ae5d7dbfebce574c6b9898f2",
            "filename": "django/utils/tree.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Ftree.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Futils%2Ftree.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftree.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -73,7 +73,9 @@ def __bool__(self):\n         For truth value testing.\n         \"\"\"\n         return bool(self.children)\n-    __nonzero__ = __bool__ # Python 2\n+\n+    def __nonzero__(self):      # Python 2 compatibility\n+        return type(self).__bool__(self)\n \n     def __contains__(self, other):\n         \"\"\""
        },
        {
            "sha": "9c82a29d8a5f649a3d8bfcd2949e9f144ba32051",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -54,13 +54,17 @@ def as_view(cls, **initkwargs):\n                                 \"keyword argument to %s(). Don't do that.\"\n                                 % (key, cls.__name__))\n             if not hasattr(cls, key):\n-                raise TypeError(\"%s() received an invalid keyword %r\" % (\n-                    cls.__name__, key))\n+                raise TypeError(\"%s() received an invalid keyword %r. as_view \"\n+                                \"only accepts arguments that are already \"\n+                                \"attributes of the class.\" % (cls.__name__, key))\n \n         def view(request, *args, **kwargs):\n             self = cls(**initkwargs)\n             if hasattr(self, 'get') and not hasattr(self, 'head'):\n                 self.head = self.get\n+            self.request = request\n+            self.args = args\n+            self.kwargs = kwargs\n             return self.dispatch(request, *args, **kwargs)\n \n         # take name and docstring from class\n@@ -79,9 +83,6 @@ def dispatch(self, request, *args, **kwargs):\n             handler = getattr(self, request.method.lower(), self.http_method_not_allowed)\n         else:\n             handler = self.http_method_not_allowed\n-        self.request = request\n-        self.args = args\n-        self.kwargs = kwargs\n         return handler(request, *args, **kwargs)\n \n     def http_method_not_allowed(self, request, *args, **kwargs):"
        },
        {
            "sha": "97a6c0a698fabf481a094ddb0dad7abf9b68437d",
            "filename": "django/views/generic/edit.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fgeneric%2Fedit.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fgeneric%2Fedit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fedit.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,6 +1,7 @@\n from django.forms import models as model_forms\n from django.core.exceptions import ImproperlyConfigured\n from django.http import HttpResponseRedirect\n+from django.utils.encoding import force_text\n from django.views.generic.base import TemplateResponseMixin, ContextMixin, View\n from django.views.generic.detail import (SingleObjectMixin,\n                         SingleObjectTemplateResponseMixin, BaseDetailView)\n@@ -50,7 +51,8 @@ def get_success_url(self):\n         Returns the supplied success URL.\n         \"\"\"\n         if self.success_url:\n-            url = self.success_url\n+            # Forcing possible reverse_lazy evaluation\n+            url = force_text(self.success_url)\n         else:\n             raise ImproperlyConfigured(\n                 \"No URL to redirect to. Provide a success_url.\")"
        },
        {
            "sha": "1f286168f6ded2b21789ae270d3c2306d9accea5",
            "filename": "django/views/generic/list.py",
            "status": "modified",
            "additions": 23,
            "deletions": 7,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fgeneric%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fgeneric%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Flist.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -15,8 +15,10 @@ class MultipleObjectMixin(ContextMixin):\n     queryset = None\n     model = None\n     paginate_by = None\n+    paginate_orphans = 0\n     context_object_name = None\n     paginator_class = Paginator\n+    page_kwarg = 'page'\n \n     def get_queryset(self):\n         \"\"\"\n@@ -38,8 +40,11 @@ def paginate_queryset(self, queryset, page_size):\n         \"\"\"\n         Paginate the queryset, if needed.\n         \"\"\"\n-        paginator = self.get_paginator(queryset, page_size, allow_empty_first_page=self.get_allow_empty())\n-        page = self.kwargs.get('page') or self.request.GET.get('page') or 1\n+        paginator = self.get_paginator(\n+            queryset, page_size, orphans=self.get_paginate_orphans(),\n+            allow_empty_first_page=self.get_allow_empty())\n+        page_kwarg = self.page_kwarg\n+        page = self.kwargs.get(page_kwarg) or self.request.GET.get(page_kwarg) or 1\n         try:\n             page_number = int(page)\n         except ValueError:\n@@ -50,9 +55,10 @@ def paginate_queryset(self, queryset, page_size):\n         try:\n             page = paginator.page(page_number)\n             return (paginator, page, page.object_list, page.has_other_pages())\n-        except InvalidPage:\n-            raise Http404(_('Invalid page (%(page_number)s)') % {\n-                                'page_number': page_number\n+        except InvalidPage as e:\n+            raise Http404(_('Invalid page (%(page_number)s): %(message)s') % {\n+                                'page_number': page_number,\n+                                'message': str(e)\n             })\n \n     def get_paginate_by(self, queryset):\n@@ -61,11 +67,21 @@ def get_paginate_by(self, queryset):\n         \"\"\"\n         return self.paginate_by\n \n-    def get_paginator(self, queryset, per_page, orphans=0, allow_empty_first_page=True):\n+    def get_paginator(self, queryset, per_page, orphans=0,\n+                      allow_empty_first_page=True, **kwargs):\n         \"\"\"\n         Return an instance of the paginator for this view.\n         \"\"\"\n-        return self.paginator_class(queryset, per_page, orphans=orphans, allow_empty_first_page=allow_empty_first_page)\n+        return self.paginator_class(\n+            queryset, per_page, orphans=orphans,\n+            allow_empty_first_page=allow_empty_first_page, **kwargs)\n+\n+    def get_paginate_orphans(self):\n+        \"\"\"\n+        Returns the maximum number of orphans extend the last page by when\n+        paginating.\n+        \"\"\"\n+        return self.paginate_orphans\n \n     def get_allow_empty(self):\n         \"\"\""
        },
        {
            "sha": "c87e3a82db1f5715cb8f5e2c9e6b98a59dc238bc",
            "filename": "django/views/i18n.py",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/django%2Fviews%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fi18n.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -8,6 +8,8 @@\n from django.utils.text import javascript_quote\n from django.utils.encoding import smart_text\n from django.utils.formats import get_format_modules, get_format\n+from django.utils._os import upath\n+from django.utils.http import is_safe_url\n from django.utils import six\n \n def set_language(request):\n@@ -21,11 +23,11 @@ def set_language(request):\n     redirect to the page in the request (the 'next' parameter) without changing\n     any state.\n     \"\"\"\n-    next = request.REQUEST.get('next', None)\n-    if not next:\n-        next = request.META.get('HTTP_REFERER', None)\n-    if not next:\n-        next = '/'\n+    next = request.REQUEST.get('next')\n+    if not is_safe_url(url=next, host=request.get_host()):\n+        next = request.META.get('HTTP_REFERER')\n+        if not is_safe_url(url=next, host=request.get_host()):\n+            next = '/'\n     response = http.HttpResponseRedirect(next)\n     if request.method == 'POST':\n         lang_code = request.POST.get('language', None)\n@@ -99,16 +101,16 @@ def get_formats():\n function gettext_noop(msgid) { return msgid; }\n \n function pgettext(context, msgid) {\n-  var value = gettext(context + '\\x04' + msgid);\n-  if (value.indexOf('\\x04') != -1) {\n+  var value = gettext(context + '\\\\x04' + msgid);\n+  if (value.indexOf('\\\\x04') != -1) {\n     value = msgid;\n   }\n   return value;\n }\n \n function npgettext(context, singular, plural, count) {\n-  var value = ngettext(context + '\\x04' + singular, context + '\\x04' + plural, count);\n-  if (value.indexOf('\\x04') != -1) {\n+  var value = ngettext(context + '\\\\x04' + singular, context + '\\\\x04' + plural, count);\n+  if (value.indexOf('\\\\x04') != -1) {\n     value = ngettext(singular, plural, count);\n   }\n   return value;\n@@ -197,7 +199,7 @@ def javascript_catalog(request, domain='djangojs', packages=None):\n     # paths of requested packages\n     for package in packages:\n         p = importlib.import_module(package)\n-        path = os.path.join(os.path.dirname(p.__file__), 'locale')\n+        path = os.path.join(os.path.dirname(upath(p.__file__)), 'locale')\n         paths.append(path)\n     # add the filesystem paths listed in the LOCALE_PATHS setting\n     paths.extend(list(reversed(settings.LOCALE_PATHS)))"
        },
        {
            "sha": "f6293a8e7f27c045f3a208f7b8987429ad5f5ee7",
            "filename": "docs/Makefile",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2FMakefile",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2FMakefile",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2FMakefile?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -31,6 +31,7 @@ help:\n \t@echo \"  latexpdf   to make LaTeX files and run them through pdflatex\"\n \t@echo \"  text       to make text files\"\n \t@echo \"  man        to make manual pages\"\n+\t@echo \"  texinfo    to make a Texinfo source file\"\n \t@echo \"  gettext    to make PO message catalogs\"\n \t@echo \"  changes    to make an overview of all changed/added/deprecated items\"\n \t@echo \"  linkcheck  to check all external links for integrity\"\n@@ -116,6 +117,11 @@ man:\n \t@echo\n \t@echo \"Build finished. The manual pages are in $(BUILDDIR)/man.\"\n \n+texinfo:\n+\t$(SPHINXBUILD) -b texinfo $(ALLSPHINXOPTS) $(BUILDDIR)/texinfo\n+\t@echo\n+\t@echo \"Build finished; the Texinfo files are in $(BUILDDIR)/texinfo.\"\n+\n gettext:\n \t$(SPHINXBUILD) -b gettext $(I18NSPHINXOPTS) $(BUILDDIR)/locale\n \t@echo"
        },
        {
            "sha": "4efb7e04f3b011e12ebb73da85e364f7da54c679",
            "filename": "docs/_theme/djangodocs/static/djangodocs.css",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2F_theme%2Fdjangodocs%2Fstatic%2Fdjangodocs.css",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2F_theme%2Fdjangodocs%2Fstatic%2Fdjangodocs.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2F_theme%2Fdjangodocs%2Fstatic%2Fdjangodocs.css?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -1,7 +1,7 @@\n /*** setup ***/\n html { background:#092e20;}\n body { font:12px/1.5 Verdana,sans-serif; background:#092e20; color: white;}\n-#custom-doc { width:76.54em;*width:74.69em;min-width:995px; max-width:100em; margin:auto; text-align:left; padding-top:16px; margin-top:0;} \n+#custom-doc { width:76.54em;*width:74.69em;min-width:995px; max-width:100em; margin:auto; text-align:left; padding-top:16px; margin-top:0;}\n #hd { padding: 4px 0 12px 0; }\n #bd { background:#234F32; }\n #ft { color:#487858; font-size:90%; padding-bottom: 2em; }\n@@ -54,7 +54,7 @@ hr { color:#ccc; background-color:#ccc; height:1px; border:0; }\n p, ul, dl { margin-top:.6em; margin-bottom:1em; padding-bottom: 0.1em;}\n #yui-main div.yui-b img { max-width: 50em; margin-left: auto; margin-right: auto; display: block; }\n caption { font-size:1em; font-weight:bold; margin-top:0.5em; margin-bottom:0.5em; margin-left: 2px; text-align: center; }\n-blockquote { padding: 0 1em; margin: 1em 0; font:125%/1.2em \"Trebuchet MS\", sans-serif; color:#234f32; border-left:2px solid #94da3a; } \n+blockquote { padding: 0 1em; margin: 1em 0; font:125%/1.2em \"Trebuchet MS\", sans-serif; color:#234f32; border-left:2px solid #94da3a; }\n strong { font-weight: bold; }\n em { font-style: italic; }\n ins { font-weight: bold; text-decoration: none; }\n@@ -111,6 +111,7 @@ dt .literal, table .literal { background:none; }\n .note, .admonition { padding-left:65px; background:url(docicons-note.png) .8em .8em no-repeat;}\n div.admonition-philosophy { padding-left:65px; background:url(docicons-philosophy.png) .8em .8em no-repeat;}\n div.admonition-behind-the-scenes { padding-left:65px; background:url(docicons-behindscenes.png) .8em .8em no-repeat;}\n+.admonition.warning { background:url(docicons-warning.png) .8em .8em no-repeat; border:1px solid #ffc83c;}\n \n /*** versoinadded/changes ***/\n div.versionadded, div.versionchanged {  }"
        },
        {
            "sha": "031b3e782a8c2a481fd56b7224219928e9efab2f",
            "filename": "docs/_theme/djangodocs/static/docicons-warning.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2F_theme%2Fdjangodocs%2Fstatic%2Fdocicons-warning.png",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2F_theme%2Fdjangodocs%2Fstatic%2Fdocicons-warning.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2F_theme%2Fdjangodocs%2Fstatic%2Fdocicons-warning.png?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3"
        },
        {
            "sha": "f58e4ecb2e762c746aa2e8b1d5379a9e0ab83237",
            "filename": "docs/conf.py",
            "status": "modified",
            "additions": 30,
            "deletions": 5,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fconf.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fconf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fconf.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -14,12 +14,15 @@\n from __future__ import unicode_literals\n \n import sys\n-import os\n+from os.path import abspath, dirname, join\n+\n+# Make sure we get the version of this copy of Django\n+sys.path.insert(1, dirname(dirname(abspath(__file__))))\n \n # If extensions (or modules to document with autodoc) are in another directory,\n # add these directories to sys.path here. If the directory is relative to the\n # documentation root, use os.path.abspath to make it absolute, like shown here.\n-sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), \"_ext\")))\n+sys.path.append(abspath(join(dirname(__file__), \"_ext\")))\n \n # -- General configuration -----------------------------------------------------\n \n@@ -52,11 +55,23 @@\n # built documents.\n #\n # The short X.Y version.\n-version = '1.5'\n+version = '1.6'\n # The full version, including alpha/beta/rc tags.\n-release = '1.5'\n+try:\n+    from django import VERSION, get_version\n+except ImportError:\n+    release = version\n+else:\n+    def django_release():\n+        pep386ver = get_version()\n+        if VERSION[3:5] == ('alpha', 0) and 'dev' not in pep386ver:\n+            return pep386ver + '.dev'\n+        return pep386ver\n+\n+    release = django_release()\n+\n # The next version to be released\n-django_next_version = '1.6'\n+django_next_version = '1.7'\n \n # The language for content autogenerated by Sphinx. Refer to documentation\n # for a list of supported languages.\n@@ -233,6 +248,16 @@\n ]\n \n \n+# -- Options for Texinfo output ------------------------------------------------\n+\n+# List of tuples (startdocname, targetname, title, author, dir_entry,\n+# description, category, toctree_only)\n+texinfo_documents=[(\n+    master_doc, \"django\", \"\", \"\", \"Django\",\n+    \"Documentation of the Django framework\", \"Web development\", False\n+)]\n+\n+\n # -- Options for Epub output ---------------------------------------------------\n \n # Bibliographic Dublin Core info."
        },
        {
            "sha": "30d452cbe2fa37ca74cff858af16d94ac4a51388",
            "filename": "docs/faq/admin.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Fadmin.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Fadmin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Fadmin.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,8 +10,8 @@ things:\n \n * Set the :setting:`SESSION_COOKIE_DOMAIN` setting in your admin config\n   file to match your domain. For example, if you're going to\n-  \"http://www.example.com/admin/\" in your browser, in\n-  \"myproject.settings\" you should set ``SESSION_COOKIE_DOMAIN = 'www.example.com'``.\n+  \"http://www.example.com/admin/\" in your browser, in \"myproject.settings\" you\n+  should set :setting:`SESSION_COOKIE_DOMAIN` = 'www.example.com'.\n \n * Some browsers (Firefox?) don't like to accept cookies from domains that\n   don't have dots in them. If you're running the admin site on \"localhost\"\n@@ -23,8 +23,9 @@ I can't log in. When I enter a valid username and password, it brings up the log\n -----------------------------------------------------------------------------------------------------------------------------------------------------------\n \n If you're sure your username and password are correct, make sure your user\n-account has ``is_active`` and ``is_staff`` set to True. The admin site only\n-allows access to users with those two fields both set to True.\n+account has :attr:`~django.contrib.auth.models.User.is_active` and\n+:attr:`~django.contrib.auth.models.User.is_staff` set to True. The admin site\n+only allows access to users with those two fields both set to True.\n \n How can I prevent the cache middleware from caching the admin site?\n -------------------------------------------------------------------\n@@ -64,9 +65,10 @@ My \"list_filter\" contains a ManyToManyField, but the filter doesn't display.\n Django won't bother displaying the filter for a ``ManyToManyField`` if there\n are fewer than two related objects.\n \n-For example, if your ``list_filter`` includes ``sites``, and there's only one\n-site in your database, it won't display a \"Site\" filter. In that case,\n-filtering by site would be meaningless.\n+For example, if your :attr:`~django.contrib.admin.ModelAdmin.list_filter`\n+includes :doc:`sites </ref/contrib/sites>`, and there's only one site in your\n+database, it won't display a \"Site\" filter. In that case, filtering by site\n+would be meaningless.\n \n Some objects aren't appearing in the admin.\n -------------------------------------------\n@@ -85,9 +87,10 @@ How can I customize the functionality of the admin interface?\n \n You've got several options. If you want to piggyback on top of an add/change\n form that Django automatically generates, you can attach arbitrary JavaScript\n-modules to the page via the model's ``class Admin`` ``js`` parameter. That\n-parameter is a list of URLs, as strings, pointing to JavaScript modules that\n-will be included within the admin form via a ``<script>`` tag.\n+modules to the page via the model's class Admin :ref:`js parameter\n+<modeladmin-media-definitions>`. That parameter is a list of URLs, as strings,\n+pointing to JavaScript modules that will be included within the admin form via\n+a ``<script>`` tag.\n \n If you want more flexibility than simply tweaking the auto-generated forms,\n feel free to write custom views for the admin. The admin is powered by Django"
        },
        {
            "sha": "dc569840d1fd4a320a75117d41fa7e4c17147995",
            "filename": "docs/faq/general.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Fgeneral.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Fgeneral.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Fgeneral.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -68,7 +68,7 @@ Who's behind this?\n Django was originally developed at World Online, the Web department of a\n newspaper in Lawrence, Kansas, USA. Django's now run by an international team of\n volunteers; you can read all about them over at the :doc:`list of committers\n-</internals/committers>`\n+</internals/committers>`.\n \n Which sites use Django?\n -----------------------"
        },
        {
            "sha": "a92c9d87ea649ea2d664f39696b18c2b534ef5c4",
            "filename": "docs/faq/install.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Finstall.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -18,7 +18,7 @@ What are Django's prerequisites?\n \n Django requires Python, specifically Python 2.6.5 - 2.7.x. No other Python\n libraries are required for basic Django usage. Django 1.5 also has\n-experimental support for Python 3.2 and above.\n+experimental support for Python 3.2.3 and above.\n \n For a development environment -- if you just want to experiment with Django --\n you don't need to have a separate Web server installed; Django comes with its\n@@ -69,14 +69,14 @@ Django version Python versions\n 1.2            2.4, 2.5, 2.6, 2.7\n 1.3            2.4, 2.5, 2.6, 2.7\n **1.4**        **2.5, 2.6, 2.7**\n-*1.5 (future)* *2.6, 2.7* and *3.2, 3.3 (experimental)*\n+*1.5 (future)* *2.6, 2.7* and *3.2.3, 3.3 (experimental)*\n ============== ===============\n \n Can I use Django with Python 3?\n -------------------------------\n \n-Django 1.5 introduces experimental support for Python 3.2 and 3.3. However, we\n-don't yet suggest that you use Django and Python 3 in production.\n+Django 1.5 introduces experimental support for Python 3.2.3 and above. However,\n+we don't yet suggest that you use Django and Python 3 in production.\n \n Python 3 support should be considered a \"preview\". It's offered to bootstrap\n the transition of the Django ecosystem to Python 3, and to help you start"
        },
        {
            "sha": "da286cf4e2c5378c6136ff19a0d68e47c04e8dd6",
            "filename": "docs/faq/troubleshooting.txt",
            "status": "modified",
            "additions": 36,
            "deletions": 1,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Ftroubleshooting.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ffaq%2Ftroubleshooting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Ftroubleshooting.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,6 +5,11 @@ Troubleshooting\n This page contains some advice about errors and problems commonly encountered\n during the development of Django applications.\n \n+.. _troubleshooting-django-admin-py:\n+\n+Problems running django-admin.py\n+================================\n+\n \"command not found: django-admin.py\"\n ------------------------------------\n \n@@ -13,4 +18,34 @@ installed Django via ``python setup.py``. If it's not on your path, you can\n find it in ``site-packages/django/bin``, where ``site-packages`` is a directory\n within your Python installation. Consider symlinking to :doc:`django-admin.py\n </ref/django-admin>` from some place on your path, such as\n-:file:`/usr/local/bin`.\n\\ No newline at end of file\n+:file:`/usr/local/bin`.\n+\n+Script name may differ in distribution packages\n+-----------------------------------------------\n+\n+If you installed Django using a Linux distribution's package manager\n+(e.g. ``apt-get`` or ``yum``) ``django-admin.py`` may have been renamed to\n+``django-admin``; use that instead.\n+\n+Mac OS X permissions\n+--------------------\n+\n+If you're using Mac OS X, you may see the message \"permission denied\" when\n+you try to run ``django-admin.py``. This is because, on Unix-based systems like\n+OS X, a file must be marked as \"executable\" before it can be run as a program.\n+To do this, open Terminal.app and navigate (using the ``cd`` command) to the\n+directory where :doc:`django-admin.py </ref/django-admin>` is installed, then\n+run the command ``sudo chmod +x django-admin.py``.\n+\n+Running virtualenv on Windows\n+-----------------------------\n+\n+If you used virtualenv_ to :ref:`install Django <installing-official-release>`\n+on Windows, you may get an ``ImportError`` when you try to run\n+``django-admin.py``. This is because Windows does not run the\n+Python interpreter from your virtual environment unless you invoke it\n+directly. Instead, prefix all commands that use .py files with ``python`` and\n+use the full path to the file, like so:\n+``python C:\\pythonXY\\Scripts\\django-admin.py``.\n+\n+.. _virtualenv: http://www.virtualenv.org/"
        },
        {
            "sha": "090cc089cbad9d6efdd4023b835478149f23dbe3",
            "filename": "docs/howto/custom-file-storage.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 11,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fhowto%2Fcustom-file-storage.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fhowto%2Fcustom-file-storage.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-file-storage.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -27,9 +27,9 @@ You'll need to follow these steps:\n                     option = settings.CUSTOM_STORAGE_OPTIONS\n                 ...\n \n-#. Your storage class must implement the ``_open()`` and ``_save()`` methods,\n-   along with any other methods appropriate to your storage class. See below for\n-   more on these methods.\n+#. Your storage class must implement the :meth:`_open()` and :meth:`_save()`\n+   methods, along with any other methods appropriate to your storage class. See\n+   below for more on these methods.\n \n    In addition, if your class provides local file storage, it must override\n    the ``path()`` method.\n@@ -46,8 +46,7 @@ Your custom storage system may override any of the storage methods explained in\n You'll also usually want to use hooks specifically designed for custom storage\n objects. These are:\n \n-``_open(name, mode='rb')``\n-~~~~~~~~~~~~~~~~~~~~~~~~~~\n+.. method:: _open(name, mode='rb')\n \n **Required**.\n \n@@ -56,8 +55,7 @@ uses to open the file. This must return a ``File`` object, though in most cases,\n you'll want to return some subclass here that implements logic specific to the\n backend storage system.\n \n-``_save(name, content)``\n-~~~~~~~~~~~~~~~~~~~~~~~~\n+.. method:: _save(name, content)\n \n Called by ``Storage.save()``. The ``name`` will already have gone through\n ``get_valid_name()`` and ``get_available_name()``, and the ``content`` will be a\n@@ -67,8 +65,8 @@ Should return the actual name of name of the file saved (usually the ``name``\n passed in, but if the storage needs to change the file name return the new name\n instead).\n \n-``get_valid_name(name)``\n-~~~~~~~~~~~~~~~~~~~~~~~~\n+.. method:: get_valid_name(name)\n+\n \n Returns a filename suitable for use with the underlying storage system. The\n ``name`` argument passed to this method is the original filename sent to the\n@@ -78,8 +76,7 @@ how non-standard characters are converted to safe filenames.\n The code provided on ``Storage`` retains only alpha-numeric characters, periods\n and underscores from the original filename, removing everything else.\n \n-``get_available_name(name)``\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+.. method:: get_available_name(name)\n \n Returns a filename that is available in the storage mechanism, possibly taking\n the provided filename into account. The ``name`` argument passed to this method"
        },
        {
            "sha": "ead04a46439b46056f5d1d62acf20bbda0633241",
            "filename": "docs/howto/deployment/wsgi/modwsgi.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fmodwsgi.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fmodwsgi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fmodwsgi.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -88,12 +88,20 @@ Using mod_wsgi daemon mode\n ==========================\n \n \"Daemon mode\" is the recommended mode for running mod_wsgi (on non-Windows\n-platforms). See the `official mod_wsgi documentation`_ for details on setting\n-up daemon mode. The only change required to the above configuration if you use\n-daemon mode is that you can't use ``WSGIPythonPath``; instead you should use\n-the ``python-path`` option to ``WSGIDaemonProcess``, for example::\n+platforms). To create the required daemon process group and delegate the\n+Django instance to run in it, you will need to add appropriate\n+``WSGIDaemonProcess`` and ``WSGIProcessGroup`` directives. A further change\n+required to the above configuration if you use daemon mode is that you can't\n+use ``WSGIPythonPath``; instead you should use the ``python-path`` option to\n+``WSGIDaemonProcess``, for example::\n \n     WSGIDaemonProcess example.com python-path=/path/to/mysite.com:/path/to/venv/lib/python2.7/site-packages\n+    WSGIProcessGroup example.com\n+\n+See the official mod_wsgi documentation for `details on setting up daemon\n+mode`_.\n+\n+.. _details on setting up daemon mode: http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide#Delegation_To_Daemon_Process\n \n .. _serving-files:\n "
        },
        {
            "sha": "9fea8ff3f2b33d124e759890d33de50d9c6b5d8d",
            "filename": "docs/index.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -44,7 +44,12 @@ Are you new to Django or to programming? This is the place to start!\n   :doc:`Part 1 <intro/tutorial01>` |\n   :doc:`Part 2 <intro/tutorial02>` |\n   :doc:`Part 3 <intro/tutorial03>` |\n-  :doc:`Part 4 <intro/tutorial04>`\n+  :doc:`Part 4 <intro/tutorial04>` |\n+  :doc:`Part 5 <intro/tutorial05>`\n+\n+* **Advanced Tutorials:**\n+  :doc:`How to write reusable apps <intro/reusable-apps>` |\n+  :doc:`Writing your first patch for Django <intro/contributing>`\n \n The model layer\n ==============="
        },
        {
            "sha": "a90dc3260578ff602ef7f06fa937b0b5c3d45186",
            "filename": "docs/internals/contributing/writing-code/submitting-patches.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Finternals%2Fcontributing%2Fwriting-code%2Fsubmitting-patches.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Finternals%2Fcontributing%2Fwriting-code%2Fsubmitting-patches.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-code%2Fsubmitting-patches.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -52,8 +52,15 @@ and time availability), claim it by following these steps:\n      page,\n   2. then click \"Submit changes.\"\n \n+.. note::\n+    The Django software foundation requests that anyone contributing more than\n+    a trivial patch to Django sign and submit a `Contributor License\n+    Agreement`_, this ensures that the Django Software Foundation has clear\n+    license to all contributions allowing for a clear license for all users.\n+\n .. _Create an account: https://www.djangoproject.com/accounts/register/\n .. _password reset page: https://www.djangoproject.com/accounts/password/reset/\n+.. _Contributor License Agreement: https://www.djangoproject.com/foundation/cla/\n \n Ticket claimers' responsibility\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
        },
        {
            "sha": "4e702ff83e79ff1bde53cacba171b4a8de619dc7",
            "filename": "docs/internals/contributing/writing-code/unit-tests.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -9,7 +9,8 @@ The tests cover:\n \n * Models and the database API (``tests/modeltests``),\n * Everything else in core Django code (``tests/regressiontests``),\n-* :ref:`contrib-apps` (``django/contrib/<app>/tests``).\n+* :ref:`contrib-apps` (``django/contrib/<app>/tests`` or\n+  ``tests/regressiontests/<app>_...``).\n \n We appreciate any and all contributions to the test suite!\n \n@@ -38,6 +39,8 @@ with this sample ``settings`` module, ``cd`` into the Django\n If you get an ``ImportError: No module named django.contrib`` error,\n you need to add your install of Django to your ``PYTHONPATH``.\n \n+.. _running-unit-tests-settings:\n+\n Using another ``settings`` module\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -133,6 +136,8 @@ Then, run the tests normally, for example:\n \n     ./runtests.py --settings=test_sqlite admin_inlines\n \n+.. _running-unit-tests-dependencies:\n+\n Running all the tests\n ~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "414da30ff84e0151d18648fe8bac9045e0f2ae1a",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -140,6 +140,11 @@ these changes.\n   removed.  In its place use\n   :class:`~django.contrib.staticfiles.handlers.StaticFilesHandler`.\n \n+* The template tags library ``adminmedia`` and the template tag ``{%\n+  admin_media_prefix %}`` will be removed in favor of the generic static files\n+  handling. (This is faster than the usual deprecation path; see the\n+  :doc:`Django 1.4 release notes</releases/1.4>`.)\n+\n * The :ttag:`url` and :ttag:`ssi` template tags will be\n   modified so that the first argument to each tag is a template variable, not\n   an implied string. In 1.4, this behavior is provided by a version of the tag\n@@ -232,10 +237,6 @@ these changes.\n   :setting:`LOGGING` setting should include this filter explicitly if\n   it is desired.\n \n-* The template tag\n-  :func:`django.contrib.admin.templatetags.adminmedia.admin_media_prefix`\n-  will be removed in favor of the generic static files handling.\n-\n * The builtin truncation functions :func:`django.utils.text.truncate_words`\n   and :func:`django.utils.text.truncate_html_words` will be removed in\n   favor of the ``django.utils.text.Truncator`` class.\n@@ -293,6 +294,14 @@ these changes.\n * The ``AUTH_PROFILE_MODULE`` setting, and the ``get_profile()`` method on\n   the User model, will be removed.\n \n+* The ``cleanup`` management command will be removed. It's replaced by\n+  ``clearsessions``.\n+\n+* The ``daily_cleanup.py`` script will be removed.\n+\n+* The ``depth`` keyword argument will be removed from\n+  :meth:`~django.db.models.query.QuerySet.select_related`.\n+\n 2.0\n ---\n "
        },
        {
            "sha": "a343814c02a59bb7414f6f675ba67fd1fbf15ff8",
            "filename": "docs/intro/contributing.txt",
            "status": "added",
            "additions": 580,
            "deletions": 0,
            "changes": 580,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Fcontributing.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Fcontributing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Fcontributing.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,580 @@\n+===================================\n+Writing your first patch for Django\n+===================================\n+\n+Introduction\n+============\n+\n+Interested in giving back to the community a little? Maybe you've found a bug\n+in Django that you'd like to see fixed, or maybe there's a small feature you\n+want added.\n+\n+Contributing back to Django itself is the best way to see your own concerns\n+addressed. This may seem daunting at first, but it's really pretty simple.\n+We'll walk you through the entire process, so you can learn by example.\n+\n+Who's this tutorial for?\n+------------------------\n+\n+For this tutorial, we expect that you have at least a basic understanding of\n+how Django works. This means you should be comfortable going through the\n+existing tutorials on :doc:`writing your first Django app</intro/tutorial01>`.\n+In addition, you should have a good understanding of Python itself. But if you\n+don't, `Dive Into Python`__ is a fantastic (and free) online book for beginning\n+Python programmers.\n+\n+Those of you who are unfamiliar with version control systems and Trac will find\n+that this tutorial and its links include just enough information to get started.\n+However, you'll probably want to read some more about these different tools if\n+you plan on contributing to Django regularly.\n+\n+For the most part though, this tutorial tries to explain as much as possible,\n+so that it can be of use to the widest audience.\n+\n+.. admonition:: Where to get help:\n+\n+    If you're having trouble going through this tutorial, please post a message\n+    to `django-developers`__ or drop by `#django-dev on irc.freenode.net`__ to\n+    chat with other Django users who might be able to help.\n+\n+__ http://diveintopython.net/toc/index.html\n+__ http://groups.google.com/group/django-developers\n+__ irc://irc.freenode.net/django-dev\n+\n+What does this tutorial cover?\n+------------------------------\n+\n+We'll be walking you through contributing a patch to Django for the first time.\n+By the end of this tutorial, you should have a basic understanding of both the\n+tools and the processes involved. Specifically, we'll be covering the following:\n+\n+* Installing Git.\n+* How to download a development copy of Django.\n+* Running Django's test suite.\n+* Writing a test for your patch.\n+* Writing the code for your patch.\n+* Testing your patch.\n+* Generating a patch file for your changes.\n+* Where to look for more information.\n+\n+Once you're done with the tutorial, you can look through the rest of\n+:doc:`Django's documentation on contributing</internals/contributing/index>`.\n+It contains lots of great information and is a must read for anyone who'd like\n+to become a regular contributor to Django. If you've got questions, it's\n+probably got the answers.\n+\n+Installing Git\n+==============\n+\n+For this tutorial, you'll need Git installed to download the current\n+development version of Django and to generate patch files for the changes you\n+make.\n+\n+To check whether or not you have Git installed, enter ``git`` into the command\n+line. If you get messages saying that this command could be found, you'll have\n+to download and install it, see `Git's download page`__.\n+\n+If you're not that familiar with Git, you can always find out more about its\n+commands (once it's installed) by typing ``git help`` into the command line.\n+\n+__ http://git-scm.com/download\n+\n+Getting a copy of Django's development version\n+==============================================\n+\n+The first step to contributing to Django is to get a copy of the source code.\n+From the command line, use the ``cd`` command to navigate to the directory\n+where you'll want your local copy of Django to live.\n+\n+Download the Django source code repository using the following command::\n+\n+    git clone https://github.com/django/django.git\n+\n+.. note::\n+\n+    For users who wish to use `virtualenv`__, you can use::\n+\n+        pip install -e /path/to/your/local/clone/django/\n+\n+    to link your cloned checkout into a virtual environment. This is a great\n+    option to isolate your development copy of Django from the rest of your\n+    system and avoids potential package conflicts.\n+\n+__ http://www.virtualenv.org\n+\n+Rolling back to a previous revision of Django\n+=============================================\n+\n+For this tutorial, we'll be using `ticket #17549`__ as a case study, so we'll\n+rewind Django's version history in git to before that ticket's patch was\n+applied. This will allow us to go through all of the steps involved in writing\n+that patch from scratch, including running Django's test suite.\n+\n+**Keep in mind that while we'll be using an older revision of Django's trunk\n+for the purposes of the tutorial below, you should always use the current\n+development revision of Django when working on your own patch for a ticket!**\n+\n+.. note::\n+\n+    The patch for this ticket was written by Ulrich Petri, and it was applied\n+    to Django as `commit ac2052ebc84c45709ab5f0f25e685bf656ce79bc`__.\n+    Consequently, we'll be using the revision of Django just prior to that,\n+    `commit 39f5bc7fc3a4bb43ed8a1358b17fe0521a1a63ac`__.\n+\n+__ https://code.djangoproject.com/ticket/17549\n+__ https://github.com/django/django/commit/ac2052ebc84c45709ab5f0f25e685bf656ce79bc\n+__ https://github.com/django/django/commit/39f5bc7fc3a4bb43ed8a1358b17fe0521a1a63ac\n+\n+Navigate into Django's root directory (that's the one that contains ``django``,\n+``docs``, ``tests``, ``AUTHORS``, etc.). You can then check out the older\n+revision of Django that we'll be using in the tutorial below::\n+\n+    git checkout 39f5bc7fc3a4bb43ed8a1358b17fe0521a1a63ac\n+\n+Running Django's test suite for the first time\n+==============================================\n+\n+When contributing to Django it's very important that your code changes don't\n+introduce bugs into other areas of Django.  One way to check that Django still\n+works after you make your changes is by running Django's test suite. If all\n+the tests still pass, then you can be reasonably sure that your changes\n+haven't completely broken Django. If you've never run Django's test suite\n+before, it's a good idea to run it once beforehand just to get familiar with\n+what its output is supposed to look like.\n+\n+We can run the test suite by simply ``cd``-ing into the Django ``tests/``\n+directory and, if you're using GNU/Linux, Mac OS X or some other flavor of\n+Unix, run::\n+\n+    PYTHONPATH=.. python runtests.py --settings=test_sqlite\n+\n+If you're on Windows, the above should work provided that you are using\n+\"Git Bash\" provided by the default Git install. GitHub has a `nice tutorial`__.\n+\n+__ https://help.github.com/articles/set-up-git#platform-windows\n+\n+.. note::\n+\n+    If you're using ``virtualenv``, you can omit ``PYTHONPATH=..`` when running\n+    the tests. This instructs Python to look for Django in the parent directory\n+    of ``tests``. ``virtualenv`` puts your copy of Django on the ``PYTHONPATH``\n+    automatically.\n+\n+Now sit back and relax. Django's entire test suite has over 4800 different\n+tests, so it can take anywhere from 5 to 15 minutes to run, depending on the\n+speed of your computer.\n+\n+While Django's test suite is running, you'll see a stream of characters\n+representing the status of each test as it's run. ``E`` indicates that an error\n+was raised during a test, and ``F`` indicates that a test's assertions failed.\n+Both of these are considered to be test failures. Meanwhile, ``x`` and ``s``\n+indicated expected failures and skipped tests, respectively. Dots indicate\n+passing tests.\n+\n+Skipped tests are typically due to missing external libraries required to run\n+the test; see :ref:`running-unit-tests-dependencies` for a list of dependencies\n+and be sure to install any for tests related to the changes you are making (we\n+won't need any for this tutorial).\n+\n+Once the tests complete, you should be greeted with a message informing you\n+whether the test suite passed or failed. Since you haven't yet made any changes\n+to Django's code, the entire test suite **should** pass. If you get failures or\n+errors make sure you've followed all of the previous steps properly. See\n+:ref:`running-unit-tests` for more information.\n+\n+Note that the latest Django trunk may not always be stable. When developing\n+against trunk, you can check `Django's continuous integration builds`__ to\n+determine if the failures are specific to your machine or if they are also\n+present in Django's official builds. If you click to view a particular build,\n+you can view the \"Configuration Matrix\" which shows failures broken down by\n+Python version and database backend.\n+\n+__ http://ci.djangoproject.com/\n+\n+.. note::\n+\n+    For this tutorial and the ticket we're working on, testing against SQLite\n+    is sufficient, however, it's possible (and sometimes necessary) to\n+    :ref:`run the tests using a different database\n+    <running-unit-tests-settings>`.\n+\n+Writing some tests for your ticket\n+==================================\n+\n+In most cases, for a patch to be accepted into Django it has to include tests.\n+For bug fix patches, this means writing a regression test to ensure that the\n+bug is never reintroduced into Django later on. A regression test should be\n+written in such a way that it will fail while the bug still exists and pass\n+once the bug has been fixed. For patches containing new features, you'll need\n+to include tests which ensure that the new features are working correctly.\n+They too should fail when the new feature is not present, and then pass once it\n+has been implemented.\n+\n+A good way to do this is to write your new tests first, before making any\n+changes to the code. This style of development is called\n+`test-driven development`__ and can be applied to both entire projects and\n+single patches. After writing your tests, you then run them to make sure that\n+they do indeed fail (since you haven't fixed that bug or added that feature\n+yet). If your new tests don't fail, you'll need to fix them so that they do.\n+After all, a regression test that passes regardless of whether a bug is present\n+is not very helpful at preventing that bug from reoccurring down the road.\n+\n+Now for our hands-on example.\n+\n+__ http://en.wikipedia.org/wiki/Test-driven_development\n+\n+Writing some tests for ticket #17549\n+------------------------------------\n+\n+`Ticket #17549`__ describes the following, small feature addition:\n+\n+    It's useful for URLField to give you a way to open the URL; otherwise you\n+    might as well use a CharField.\n+\n+In order to resolve this ticket, we'll add a ``render`` method to the\n+``AdminURLFieldWidget`` in order to display a clickable link above the input\n+widget. Before we make those changes though, we're going to write a couple\n+tests to verify that our modification functions correctly and continues to\n+function correctly in the future.\n+\n+Navigate to Django's ``tests/regressiontests/admin_widgets/`` folder and\n+open the ``tests.py`` file. Add the following code on line 269 right before the\n+``AdminFileWidgetTest`` class::\n+\n+    class AdminURLWidgetTest(DjangoTestCase):\n+        def test_render(self):\n+            w = widgets.AdminURLFieldWidget()\n+            self.assertHTMLEqual(\n+                conditional_escape(w.render('test', '')),\n+                '<input class=\"vURLField\" name=\"test\" type=\"text\" />'\n+            )\n+            self.assertHTMLEqual(\n+                conditional_escape(w.render('test', 'http://example.com')),\n+                '<p class=\"url\">Currently:<a href=\"http://example.com\">http://example.com</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example.com\" /></p>'\n+            )\n+\n+        def test_render_idn(self):\n+            w = widgets.AdminURLFieldWidget()\n+            self.assertHTMLEqual(\n+                conditional_escape(w.render('test', 'http://example-äüö.com')),\n+                '<p class=\"url\">Currently:<a href=\"http://xn--example--7za4pnc.com\">http://example-äüö.com</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example-äüö.com\" /></p>'\n+            )\n+\n+        def test_render_quoting(self):\n+            w = widgets.AdminURLFieldWidget()\n+            self.assertHTMLEqual(\n+                conditional_escape(w.render('test', 'http://example.com/<sometag>some text</sometag>')),\n+                '<p class=\"url\">Currently:<a href=\"http://example.com/%3Csometag%3Esome%20text%3C/sometag%3E\">http://example.com/&lt;sometag&gt;some text&lt;/sometag&gt;</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example.com/<sometag>some text</sometag>\" /></p>'\n+            )\n+            self.assertHTMLEqual(\n+                conditional_escape(w.render('test', 'http://example-äüö.com/<sometag>some text</sometag>')),\n+                '<p class=\"url\">Currently:<a href=\"http://xn--example--7za4pnc.com/%3Csometag%3Esome%20text%3C/sometag%3E\">http://example-äüö.com/&lt;sometag&gt;some text&lt;/sometag&gt;</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example-äüö.com/<sometag>some text</sometag>\" /></p>'\n+            )\n+\n+The new tests check to see that the ``render`` method we'll be adding works\n+correctly in a couple different situations.\n+\n+.. admonition:: But this testing thing looks kinda hard...\n+\n+    If you've never had to deal with tests before, they can look a little hard\n+    to write at first glance. Fortunately, testing is a *very* big subject in\n+    computer programming, so there's lots of information out there:\n+\n+    * A good first look at writing tests for Django can be found in the\n+      documentation on :doc:`Testing Django applications</topics/testing/>`.\n+    * Dive Into Python (a free online book for beginning Python developers)\n+      includes a great `introduction to Unit Testing`__.\n+    * After reading those, if you want something a little meatier to sink\n+      your teeth into, there's always the `Python unittest documentation`__.\n+\n+__ https://code.djangoproject.com/ticket/17549\n+__ http://diveintopython.net/unit_testing/index.html\n+__ http://docs.python.org/library/unittest.html\n+\n+Running your new test\n+---------------------\n+\n+Remember that we haven't actually made any modifications to\n+``AdminURLFieldWidget`` yet, so our tests are going to fail. Let's run all the\n+tests in the ``model_forms_regress`` folder to make sure that's really what\n+happens. From the command line, ``cd`` into the Django ``tests/`` directory\n+and run::\n+\n+    PYTHONPATH=.. python runtests.py --settings=test_sqlite admin_widgets\n+\n+If the tests ran correctly, you should see three failures corresponding to each\n+of the test methods we added. If all of the tests passed, then you'll want to\n+make sure that you added the new test shown above to the appropriate folder and\n+class.\n+\n+Writing the code for your ticket\n+================================\n+\n+Next we'll be adding the functionality described in `ticket #17549`__ to Django.\n+\n+Writing the code for ticket #17549\n+----------------------------------\n+\n+Navigate to the ``django/django/contrib/admin/`` folder and open the\n+``widgets.py`` file. Find the ``AdminURLFieldWidget`` class on line 302 and add\n+the following ``render`` method after the existing ``__init__`` method::\n+\n+    def render(self, name, value, attrs=None):\n+        html = super(AdminURLFieldWidget, self).render(name, value, attrs)\n+        if value:\n+            value = force_text(self._format_value(value))\n+            final_attrs = {'href': mark_safe(smart_urlquote(value))}\n+            html = format_html(\n+                '<p class=\"url\">{0} <a {1}>{2}</a><br />{3} {4}</p>',\n+                _('Currently:'), flatatt(final_attrs), value,\n+                _('Change:'), html\n+            )\n+        return html\n+\n+Verifying your test now passes\n+------------------------------\n+\n+Once you're done modifying Django, we need to make sure that the tests we wrote\n+earlier pass, so we can see whether the code we wrote above is working\n+correctly. To run the tests in the ``admin_widgets`` folder, ``cd`` into the\n+Django ``tests/`` directory and run::\n+\n+    PYTHONPATH=.. python runtests.py --settings=test_sqlite admin_widgets\n+\n+Oops, good thing we wrote those tests! You should still see 3 failures with\n+the following exception::\n+\n+    NameError: global name 'smart_urlquote' is not defined\n+\n+We forgot to add the import for that method.  Go ahead and add the\n+``smart_urlquote`` import at the end of line 13 of\n+``django/contrib/admin/widgets.py`` so it looks as follows::\n+\n+    from django.utils.html import escape, format_html, format_html_join, smart_urlquote\n+\n+Re-run the tests and everything should pass. If it doesn't, make sure you\n+correctly modified the ``AdminURLFieldWidget`` class as shown above and\n+copied the new tests correctly.\n+\n+__ https://code.djangoproject.com/ticket/17549\n+\n+Running Django's test suite for the second time\n+===============================================\n+\n+Once you've verified that your patch and your test are working correctly, it's\n+a good idea to run the entire Django test suite just to verify that your change\n+hasn't introduced any bugs into other areas of Django. While successfully\n+passing the entire test suite doesn't guarantee your code is bug free, it does\n+help identify many bugs and regressions that might otherwise go unnoticed.\n+\n+To run the entire Django test suite, ``cd`` into the Django ``tests/``\n+directory and run::\n+\n+    PYTHONPATH=.. python runtests.py --settings=test_sqlite\n+\n+As long as you don't see any failures, you're good to go. Note that this fix\n+also made a `small CSS change`__ to format the new widget. You can make the\n+change if you'd like, but we'll skip it for now in the interest of brevity.\n+\n+__ https://github.com/django/django/commit/ac2052ebc84c45709ab5f0f25e685bf656ce79bc#diff-0\n+\n+Writing Documentation\n+=====================\n+\n+This is a new feature, so it should be documented.  Add the following on line\n+925 of ``django/docs/ref/models/fields.txt`` beneath the existing docs for\n+``URLField``::\n+\n+    .. versionadded:: 1.5\n+\n+    The current value of the field will be displayed as a clickable link above the\n+    input widget.\n+\n+For more information on writing documentation, including an explanation of what\n+the ``versionadded`` bit is all about, see\n+:doc:`/internals/contributing/writing-documentation`. That page also includes\n+an explanation of how to build a copy of the documentation locally, so you can\n+preview the HTML that will be generated.\n+\n+Generating a patch for your changes\n+===================================\n+\n+Now it's time to generate a patch file that can be uploaded to Trac or applied\n+to another copy of Django. To get a look at the content of your patch, run the\n+following command::\n+\n+    git diff\n+\n+This will display the differences between your current copy of Django (with\n+your changes) and the revision that you initially checked out earlier in the\n+tutorial.\n+\n+Once you're done looking at the patch, hit the ``q`` key to exit back to the\n+command line.  If the patch's content looked okay, you can run the following\n+command to save the patch file to your current working directory::\n+\n+    git diff > 17549.diff\n+\n+You should now have a file in the root Django directory called ``17549.diff``.\n+This patch file contains all your changes and should look this:\n+\n+.. code-block:: diff\n+\n+    diff --git a/django/contrib/admin/widgets.py b/django/contrib/admin/widgets.py\n+    index 1e0bc2d..9e43a10 100644\n+    --- a/django/contrib/admin/widgets.py\n+    +++ b/django/contrib/admin/widgets.py\n+    @@ -10,7 +10,7 @@ from django.contrib.admin.templatetags.admin_static import static\n+     from django.core.urlresolvers import reverse\n+     from django.forms.widgets import RadioFieldRenderer\n+     from django.forms.util import flatatt\n+    -from django.utils.html import escape, format_html, format_html_join\n+    +from django.utils.html import escape, format_html, format_html_join, smart_urlquote\n+     from django.utils.text import Truncator\n+     from django.utils.translation import ugettext as _\n+     from django.utils.safestring import mark_safe\n+    @@ -306,6 +306,18 @@ class AdminURLFieldWidget(forms.TextInput):\n+                 final_attrs.update(attrs)\n+             super(AdminURLFieldWidget, self).__init__(attrs=final_attrs)\n+\n+    +    def render(self, name, value, attrs=None):\n+    +        html = super(AdminURLFieldWidget, self).render(name, value, attrs)\n+    +        if value:\n+    +            value = force_text(self._format_value(value))\n+    +            final_attrs = {'href': mark_safe(smart_urlquote(value))}\n+    +            html = format_html(\n+    +                '<p class=\"url\">{0} <a {1}>{2}</a><br />{3} {4}</p>',\n+    +                _('Currently:'), flatatt(final_attrs), value,\n+    +                _('Change:'), html\n+    +            )\n+    +        return html\n+    +\n+     class AdminIntegerFieldWidget(forms.TextInput):\n+         class_name = 'vIntegerField'\n+\n+    diff --git a/docs/ref/models/fields.txt b/docs/ref/models/fields.txt\n+    index 809d56e..d44f85f 100644\n+    --- a/docs/ref/models/fields.txt\n+    +++ b/docs/ref/models/fields.txt\n+    @@ -922,6 +922,10 @@ Like all :class:`CharField` subclasses, :class:`URLField` takes the optional\n+     :attr:`~CharField.max_length`argument. If you don't specify\n+     :attr:`~CharField.max_length`, a default of 200 is used.\n+\n+    +.. versionadded:: 1.5\n+    +\n+    +The current value of the field will be displayed as a clickable link above the\n+    +input widget.\n+\n+     Relationship fields\n+     ===================\n+    diff --git a/tests/regressiontests/admin_widgets/tests.py b/tests/regressiontests/admin_widgets/tests.py\n+    index 4b11543..94acc6d 100644\n+    --- a/tests/regressiontests/admin_widgets/tests.py\n+    +++ b/tests/regressiontests/admin_widgets/tests.py\n+    @@ -265,6 +265,35 @@ class AdminSplitDateTimeWidgetTest(DjangoTestCase):\n+                         '<p class=\"datetime\">Datum: <input value=\"01.12.2007\" type=\"text\" class=\"vDateField\" name=\"test_0\" size=\"10\" /><br />Zeit: <input value=\"09:30:00\" type=\"text\" class=\"vTimeField\" name=\"test_1\" size=\"8\" /></p>',\n+                     )\n+\n+    +class AdminURLWidgetTest(DjangoTestCase):\n+    +    def test_render(self):\n+    +        w = widgets.AdminURLFieldWidget()\n+    +        self.assertHTMLEqual(\n+    +            conditional_escape(w.render('test', '')),\n+    +            '<input class=\"vURLField\" name=\"test\" type=\"text\" />'\n+    +        )\n+    +        self.assertHTMLEqual(\n+    +            conditional_escape(w.render('test', 'http://example.com')),\n+    +            '<p class=\"url\">Currently:<a href=\"http://example.com\">http://example.com</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example.com\" /></p>'\n+    +        )\n+    +\n+    +    def test_render_idn(self):\n+    +        w = widgets.AdminURLFieldWidget()\n+    +        self.assertHTMLEqual(\n+    +            conditional_escape(w.render('test', 'http://example-äüö.com')),\n+    +            '<p class=\"url\">Currently:<a href=\"http://xn--example--7za4pnc.com\">http://example-äüö.com</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example-äüö.com\" /></p>'\n+    +        )\n+    +\n+    +    def test_render_quoting(self):\n+    +        w = widgets.AdminURLFieldWidget()\n+    +        self.assertHTMLEqual(\n+    +            conditional_escape(w.render('test', 'http://example.com/<sometag>some text</sometag>')),\n+    +            '<p class=\"url\">Currently:<a href=\"http://example.com/%3Csometag%3Esome%20text%3C/sometag%3E\">http://example.com/&lt;sometag&gt;some text&lt;/sometag&gt;</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example.com/<sometag>some text</sometag>\" /></p>'\n+    +        )\n+    +        self.assertHTMLEqual(\n+    +            conditional_escape(w.render('test', 'http://example-äüö.com/<sometag>some text</sometag>')),\n+    +            '<p class=\"url\">Currently:<a href=\"http://xn--example--7za4pnc.com/%3Csometag%3Esome%20text%3C/sometag%3E\">http://example-äüö.com/&lt;sometag&gt;some text&lt;/sometag&gt;</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example-äüö.com/<sometag>some text</sometag>\" /></p>'\n+    +        )\n+\n+     class AdminFileWidgetTest(DjangoTestCase):\n+         def test_render(self):\n+\n+So what do I do next?\n+=====================\n+\n+Congratulations, you've generated your very first Django patch! Now that you've\n+got that under your belt, you can put those skills to good use by helping to\n+improve Django's codebase. Generating patches and attaching them to Trac\n+tickets is useful, however, since we are using git - adopting a more :doc:`git\n+oriented workflow </internals/contributing/writing-code/working-with-git>` is\n+recommended.\n+\n+Since we never committed our changes locally, perform the following to get your\n+git branch back to a good starting point::\n+\n+    git reset --hard HEAD\n+    git checkout master\n+\n+More information for new contributors\n+-------------------------------------\n+\n+Before you get too into writing patches for Django, there's a little more\n+information on contributing that you should probably take a look at:\n+\n+* You should make sure to read Django's documentation on\n+  :doc:`claiming tickets and submitting patches\n+  </internals/contributing/writing-code/submitting-patches>`.\n+  It covers Trac etiquette, how to claim tickets for yourself, expected\n+  coding style for patches, and many other important details.\n+* First time contributors should also read Django's :doc:`documentation\n+  for first time contributors</internals/contributing/new-contributors/>`.\n+  It has lots of good advice for those of us who are new to helping out\n+  with Django.\n+* After those, if you're still hungry for more information about\n+  contributing, you can always browse through the rest of\n+  :doc:`Django's documentation on contributing</internals/contributing/index>`.\n+  It contains a ton of useful information and should be your first source\n+  for answering any questions you might have.\n+\n+Finding your first real ticket\n+------------------------------\n+\n+Once you've looked through some of that information, you'll be ready to go out\n+and find a ticket of your own to write a patch for. Pay special attention to\n+tickets with the \"easy pickings\" criterion. These tickets are often much\n+simpler in nature and are great for first time contributors.  Once you're\n+familiar with contributing to Django, you can move on to writing patches for\n+more difficult and complicated tickets.\n+\n+If you just want to get started already (and nobody would blame you!), try\n+taking a look at the list of `easy tickets that need patches`__ and the\n+`easy tickets that have patches which need improvement`__. If you're familiar\n+with writing tests, you can also look at the list of\n+`easy tickets that need tests`__. Just remember to follow the guidelines about\n+claiming tickets that were mentioned in the link to Django's documentation on\n+:doc:`claiming tickets and submitting patches\n+</internals/contributing/writing-code/submitting-patches>`.\n+\n+__ https://code.djangoproject.com/query?status=new&status=reopened&has_patch=0&easy=1&col=id&col=summary&col=status&col=owner&col=type&col=milestone&order=priority\n+__ https://code.djangoproject.com/query?status=new&status=reopened&needs_better_patch=1&easy=1&col=id&col=summary&col=status&col=owner&col=type&col=milestone&order=priority\n+__ https://code.djangoproject.com/query?status=new&status=reopened&needs_tests=1&easy=1&col=id&col=summary&col=status&col=owner&col=type&col=milestone&order=priority\n+\n+What's next?\n+------------\n+\n+After a ticket has a patch, it needs to be reviewed by a second set of eyes.\n+After uploading a patch or submitting a pull request, be sure to update the\n+ticket metadata by setting the flags on the ticket to say \"has patch\",\n+\"doesn't need tests\", etc, so others can find it for review. Contributing\n+doesn't necessarily always mean writing a patch from scratch. Reviewing\n+existing patches is also a very helpful contribution. See\n+:doc:`/internals/contributing/triaging-tickets` for details."
        },
        {
            "sha": "ea6a3c4d29b78cd146f634cd198cc6ea1a071756",
            "filename": "docs/intro/index.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -6,31 +6,34 @@ place: read this material to quickly get up and running.\n \n .. toctree::\n    :maxdepth: 1\n-    \n+\n    overview\n    install\n    tutorial01\n    tutorial02\n    tutorial03\n    tutorial04\n+   tutorial05\n+   reusable-apps\n    whatsnext\n-   \n+   contributing\n+\n .. seealso::\n \n     If you're new to Python_, you might want to start by getting an idea of what\n     the language is like. Django is 100% Python, so if you've got minimal\n     comfort with Python you'll probably get a lot more out of Django.\n-    \n+\n     If you're new to programming entirely, you might want to start with this\n     `list of Python resources for non-programmers`_\n-    \n+\n     If you already know a few other languages and want to get up to speed with\n     Python quickly, we recommend `Dive Into Python`_ (also available in a\n     `dead-tree version`_). If that's not quite your style, there are quite\n     a few other `books about Python`_.\n-    \n+\n     .. _python: http://python.org/\n     .. _list of Python resources for non-programmers: http://wiki.python.org/moin/BeginnersGuide/NonProgrammers\n     .. _dive into python: http://diveintopython.net/\n     .. _dead-tree version: http://www.amazon.com/exec/obidos/ASIN/1590593561/ref=nosim/jacobian20\n-    .. _books about Python: http://wiki.python.org/moin/PythonBooks\n\\ No newline at end of file\n+    .. _books about Python: http://wiki.python.org/moin/PythonBooks"
        },
        {
            "sha": "ba49e3ccf26525a339f41451642d2db06d3d8601",
            "filename": "docs/intro/overview.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Foverview.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Foverview.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Foverview.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -257,8 +257,7 @@ lookup and function calls.\n Note ``{{ article.pub_date|date:\"F j, Y\" }}`` uses a Unix-style \"pipe\" (the \"|\"\n character). This is called a template filter, and it's a way to filter the value\n of a variable. In this case, the date filter formats a Python datetime object in\n-the given format (as found in PHP's date function; yes, there is one good idea\n-in PHP).\n+the given format (as found in PHP's date function).\n \n You can chain together as many filters as you'd like. You can write custom\n filters. You can write custom template tags, which run custom Python code behind"
        },
        {
            "sha": "6aade4997e3832741e8e42842c23f05675a831a7",
            "filename": "docs/intro/reusable-apps.txt",
            "status": "added",
            "additions": 365,
            "deletions": 0,
            "changes": 365,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Freusable-apps.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Freusable-apps.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Freusable-apps.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,365 @@\n+=============================================\n+Advanced tutorial: How to write reusable apps\n+=============================================\n+\n+This advanced tutorial begins where :doc:`Tutorial 5 </intro/tutorial05>` left\n+off. We'll be turning our Web-poll into a standalone Python package you can\n+reuse in new projects and share with other people.\n+\n+If you haven't recently completed Tutorials 1–5, we encourage you to review\n+these so that your example project matches the one described below.\n+\n+Reusability matters\n+===================\n+\n+It's a lot of work to design, build, test and maintain a web application. Many\n+Python and Django projects share common problems. Wouldn't it be great if we\n+could save some of this repeated work?\n+\n+Reusability is the way of life in Python. `The Python Package Index (PyPI)\n+<http://guide.python-distribute.org/contributing.html#pypi-info>`_ has a vast\n+range of packages you can use in your own Python programs. Check out `Django\n+Packages <http://www.djangopackages.com>`_ for existing reusable apps you could\n+incorporate in your project. Django itself is also just a Python package. This\n+means that you can take existing Python packages or Django apps and compose\n+them into your own web project. You only need to write the parts that make\n+your project unique.\n+\n+Let's say you were starting a new project that needed a polls app like the one\n+we've been working on. How do you make this app reusable? Luckily, you're well\n+on the way already. In :doc:`Tutorial 3 </intro/tutorial03>`, we saw how we\n+could decouple polls from the project-level URLconf using an ``include``.\n+In this tutorial, we'll take further steps to make the app easy to use in new\n+projects and ready to publish for others to install and use.\n+\n+.. admonition:: Package? App?\n+\n+    A Python `package <http://docs.python.org/tutorial/modules.html#packages>`_\n+    provides a way of grouping related Python code for easy reuse. A package\n+    contains one or more files of Python code (also known as \"modules\").\n+\n+    A package can be imported with ``import foo.bar`` or ``from foo import\n+    bar``. For a directory (like ``polls``) to form a package, it must contain\n+    a special file ``__init__.py``, even if this file is empty.\n+\n+    A Django *app* is just a Python package that is specifically intended for\n+    use in a Django project. An app may also use common Django conventions,\n+    such as having a ``models.py`` file.\n+\n+    Later on we use the term *packaging* to describe the process of making a\n+    Python package easy for others to install. It can be a little confusing, we\n+    know.\n+\n+Completing your reusable app\n+============================\n+\n+After the previous tutorials, our project should look like this::\n+\n+    mysite/\n+        manage.py\n+        mysite/\n+            __init__.py\n+            settings.py\n+            urls.py\n+            wsgi.py\n+        polls/\n+            admin.py\n+            __init__.py\n+            models.py\n+            tests.py\n+            urls.py\n+            views.py\n+\n+You also have a directory somewhere called ``mytemplates`` which you created in\n+:doc:`Tutorial 2 </intro/tutorial02>`. You specified its location in the\n+TEMPLATE_DIRS setting. This directory should look like this::\n+\n+    mytemplates/\n+        admin/\n+            base_site.html\n+        polls/\n+            detail.html\n+            index.html\n+            results.html\n+\n+The polls app is already a Python package, thanks to the ``polls/__init__.py``\n+file. That's a great start, but we can't just pick up this package and drop it\n+into a new project. The polls templates are currently stored in the\n+project-wide ``mytemplates`` directory. To make the app self-contained, it\n+should also contain the necessary templates.\n+\n+Inside the ``polls`` app, create a new ``templates`` directory. Now move the\n+``polls`` template directory from ``mytemplates`` into the new\n+``templates``. Your project should now look like this::\n+\n+    mysite/\n+        manage.py\n+        mysite/\n+            __init__.py\n+            settings.py\n+            urls.py\n+            wsgi.py\n+        polls/\n+            admin.py\n+            __init__.py\n+            models.py\n+            templates/\n+                polls/\n+                    detail.html\n+                    index.html\n+                    results.html\n+            tests.py\n+            urls.py\n+            views.py\n+\n+Your project-wide templates directory should now look like this::\n+\n+    mytemplates/\n+        admin/\n+            base_site.html\n+\n+Looking good! Now would be a good time to confirm that your polls application\n+still works correctly.  How does Django know how to find the new location of\n+the polls templates even though we didn't modify :setting:`TEMPLATE_DIRS`?\n+Django has a :setting:`TEMPLATE_LOADERS` setting which contains a list\n+of callables that know how to import templates from various sources.  One of\n+the defaults is :class:`django.template.loaders.app_directories.Loader` which\n+looks for a \"templates\" subdirectory in each of the :setting:`INSTALLED_APPS`.\n+\n+The ``polls`` directory could now be copied into a new Django project and\n+immediately reused. It's not quite ready to be published though. For that, we\n+need to package the app to make it easy for others to install.\n+\n+.. admonition:: Why nested?\n+\n+   Why create a ``polls`` directory under ``templates`` when we're\n+   already inside the polls app? This directory is needed to avoid conflicts in\n+   Django's ``app_directories`` template loader.  For example, if two\n+   apps had a template called ``base.html``, without the extra directory it\n+   wouldn't be possible to distinguish between the two. It's a good convention\n+   to use the name of your app for this directory.\n+\n+.. _installing-reusable-apps-prerequisites:\n+\n+Installing some prerequisites\n+=============================\n+\n+The current state of Python packaging is a bit muddled with various tools. For\n+this tutorial, we're going to use distribute_ to build our package. It's a\n+community-maintained fork of the older ``setuptools`` project. We'll also be\n+using `pip`_ to uninstall it after we're finished. You should install these\n+two packages now. If you need help, you can refer to :ref:`how to install\n+Django with pip<installing-official-release>`. You can install ``distribute``\n+the same way.\n+\n+.. _distribute: http://pypi.python.org/pypi/distribute\n+.. _pip: http://pypi.python.org/pypi/pip\n+\n+Packaging your app\n+==================\n+\n+Python *packaging* refers to preparing your app in a specific format that can\n+be easily installed and used. Django itself is packaged very much like\n+this. For a small app like polls, this process isn't too difficult.\n+\n+1. First, create a parent directory for ``polls``, outside of your Django\n+   project. Call this directory ``django-polls``.\n+\n+.. admonition::  Choosing a name for your app\n+\n+   When choosing a name for your package, check resources like PyPI to avoid\n+   naming conflicts with existing packages. It's often useful to prepend\n+   ``django-`` to your module name when creating a package to distribute.\n+   This helps others looking for Django apps identify your app as Django\n+   specific.\n+\n+2. Move the ``polls`` directory into the ``django-polls`` directory.\n+\n+3. Create a file ``django-polls/README.txt`` with the following contents::\n+\n+    =====\n+    Polls\n+    =====\n+\n+    Polls is a simple Django app to conduct Web-based polls. For each\n+    question, visitors can choose between a fixed number of answers.\n+\n+    Detailed documentation is in the \"docs\" directory.\n+\n+    Quick start\n+    -----------\n+\n+    1. Add \"polls\" to your INSTALLED_APPS setting like this::\n+\n+          INSTALLED_APPS = (\n+              ...\n+              'polls',\n+          )\n+\n+    2. Include the polls URLconf in your project urls.py like this::\n+\n+          url(r'^polls/', include('polls.urls')),\n+\n+    3. Run `python manage.py syncdb` to create the polls models.\n+\n+    4. Start the development server and visit http://127.0.0.1:8000/admin/\n+      to create a poll (you'll need the Admin app enabled).\n+\n+    5. Visit http://127.0.0.1:8000/polls/ to participate in the poll.\n+\n+4. Create a ``django-polls/LICENSE`` file. Choosing a license is beyond the\n+scope of this tutorial, but suffice it to say that code released publicly\n+without a license is *useless*. Django and many Django-compatible apps are\n+distributed under the BSD license; however, you're free to pick your own\n+license. Just be aware that your licensing choice will affect who is able\n+to use your code.\n+\n+5. Next we'll create a ``setup.py`` file which provides details about how to\n+build and install the app.  A full explanation of this file is beyond the\n+scope of this tutorial, but the `distribute docs\n+<http://packages.python.org/distribute/setuptools.html>`_ have a good explanation.\n+Create a file ``django-polls/setup.py`` with the following contents::\n+\n+    import os\n+    from setuptools import setup\n+\n+    README = open(os.path.join(os.path.dirname(__file__), 'README.txt')).read()\n+\n+    # allow setup.py to be run from any path\n+    os.chdir(os.path.normpath(os.path.join(os.path.abspath(__file__), os.pardir)))\n+\n+    setup(\n+        name = 'django-polls',\n+        version = '0.1',\n+        packages = ['polls'],\n+        include_package_data = True,\n+        license = 'BSD License', # example license\n+        description = 'A simple Django app to conduct Web-based polls.',\n+        long_description = README,\n+        url = 'http://www.example.com/',\n+        author = 'Your Name',\n+        author_email = 'yourname@example.com',\n+        classifiers = [\n+            'Environment :: Web Environment',\n+            'Framework :: Django',\n+            'Intended Audience :: Developers',\n+            'License :: OSI Approved :: BSD License', # example license\n+            'Operating System :: OS Independent',\n+            'Programming Language :: Python',\n+            'Programming Language :: Python :: 2.6',\n+            'Programming Language :: Python :: 2.7',\n+            'Topic :: Internet :: WWW/HTTP',\n+            'Topic :: Internet :: WWW/HTTP :: Dynamic Content',\n+        ],\n+    )\n+\n+.. admonition:: I thought you said we were going to use ``distribute``?\n+\n+    Distribute is a drop-in replacement for ``setuptools``. Even though we\n+    appear to import from ``setuptools``, since we have ``distribute``\n+    installed, it will override the import.\n+\n+6. Only Python modules and packages are included in the package by default. To\n+   include additional files, we'll need to create a ``MANIFEST.in`` file. The\n+   distribute docs referred to in the previous step discuss this file in more\n+   details. To include the templates and our LICENSE file, create a file\n+   ``django-polls/MANIFEST.in`` with the following contents::\n+\n+    include LICENSE\n+    recursive-include polls/templates *\n+\n+7. It's optional, but recommended, to include detailed documentation with your\n+   app. Create an empty directory ``django-polls/docs`` for future\n+   documentation. Add an additional line to ``django-polls/MANIFEST.in``::\n+\n+    recursive-include docs *\n+\n+   Note that the ``docs`` directory won't be included in your package unless\n+   you add some files to it. Many Django apps also provide their documentation\n+   online through sites like `readthedocs.org <http://readthedocs.org>`_.\n+\n+8. Try building your package with ``python setup.py sdist`` (run from inside\n+   ``django-polls``). This creates a directory called ``dist`` and builds your\n+   new package, ``django-polls-0.1.tar.gz``.\n+\n+For more information on packaging, see `The Hitchhiker's Guide to Packaging\n+<http://guide.python-distribute.org/quickstart.html>`_.\n+\n+Using your own package\n+======================\n+\n+Since we moved the ``polls`` directory out of the project, it's no longer\n+working. We'll now fix this by installing our new ``django-polls`` package.\n+\n+.. admonition:: Installing as a user library\n+\n+   The following steps install ``django-polls`` as a user library. Per-user\n+   installs have a lot of advantages over installing the package system-wide,\n+   such as being usable on systems where you don't have administrator access\n+   as well as preventing the package from affecting system services and other\n+   users of the machine. Python 2.6 added support for user libraries, so if\n+   you are using an older version this won't work, but Django 1.5 requires\n+   Python 2.6 or newer anyway.\n+\n+   Note that per-user installations can still affect the behavior of system\n+   tools that run as that user, so ``virtualenv`` is a more robust solution\n+   (see below).\n+\n+1. Inside ``django-polls/dist``, untar the new package\n+   ``django-polls-0.1.tar.gz`` (e.g. ``tar xzvf django-polls-0.1.tar.gz``). If\n+   you're using Windows, you can download the command-line tool bsdtar_ to do\n+   this, or you can use a GUI-based tool such as 7-zip_.\n+\n+2. Change into the directory created in step 1 (e.g. ``cd django-polls-0.1``).\n+\n+3. If you're using GNU/Linux, Mac OS X or some other flavor of Unix, enter the\n+   command ``python setup.py install --user`` at the shell prompt.  If you're\n+   using Windows, start up a command shell and run the command\n+   ``setup.py install --user``.\n+\n+   With luck, your Django project should now work correctly again. Run the\n+   server again to confirm this.\n+\n+4. To uninstall the package, use pip (you already :ref:`installed it\n+   <installing-reusable-apps-prerequisites>`, right?)::\n+\n+    pip uninstall django-polls\n+\n+.. _bsdtar: http://gnuwin32.sourceforge.net/packages/bsdtar.htm\n+.. _7-zip: http://www.7-zip.org/\n+.. _pip: http://pypi.python.org/pypi/pip\n+\n+Publishing your app\n+===================\n+\n+Now that we've packaged and tested ``django-polls``, it's ready to share with\n+the world! If this wasn't just an example, you could now:\n+\n+* Email the package to a friend.\n+\n+* Upload the package on your Web site.\n+\n+* Post the package on a public repository, such as `The Python Package Index\n+  (PyPI) <http://guide.python-distribute.org/contributing.html#pypi-info>`_.\n+\n+For more information on PyPI, see the `Quickstart\n+<http://guide.python-distribute.org/quickstart.html#register-your-package-with-the-python-package-index-pypi>`_\n+section of The Hitchhiker's Guide to Packaging. One detail this guide mentions\n+is choosing the license under which your code is distributed.\n+\n+Installing Python packages with virtualenv\n+==========================================\n+\n+Earlier, we installed the polls app as a user library. This has some\n+disadvantages:\n+\n+* Modifying the user libraries can affect other Python software on your system.\n+\n+* You won't be able to run multiple versions of this package (or others with\n+  the same name).\n+\n+Typically, these situations only arise once you're maintaining several Django\n+projects. When they do, the best solution is to use `virtualenv\n+<http://www.virtualenv.org/>`_. This tool allows you to maintain multiple\n+isolated Python environments, each with its own copy of the libraries and\n+package namespace."
        },
        {
            "sha": "9419f9c4ebb58d530dc95a08d3c1db6a7ec97cb8",
            "filename": "docs/intro/tutorial01.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 27,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial01.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial01.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial01.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -52,25 +52,8 @@ code, then run the following command:\n \n    django-admin.py startproject mysite\n \n-This will create a ``mysite`` directory in your current directory.  If it didn't \n-work, see :doc:`Troubleshooting </faq/troubleshooting>`.\n-\n-.. admonition:: Script name may differ in distribution packages\n-\n-   If you installed Django using a Linux distribution's package manager\n-   (e.g. apt-get or yum) ``django-admin.py`` may have been renamed to\n-   ``django-admin``. You may continue through this documentation by omitting\n-   ``.py`` from each command.\n-\n-.. admonition:: Mac OS X permissions\n-\n-   If you're using Mac OS X, you may see the message \"permission denied\" when\n-   you try to run ``django-admin.py startproject``. This is because, on\n-   Unix-based systems like OS X, a file must be marked as \"executable\" before it\n-   can be run as a program. To do this, open Terminal.app and navigate (using\n-   the ``cd`` command) to the directory where :doc:`django-admin.py\n-   </ref/django-admin>` is installed, then run the command\n-   ``sudo chmod +x django-admin.py``.\n+This will create a ``mysite`` directory in your current directory. If it didn't\n+work, see :ref:`troubleshooting-django-admin-py`.\n \n .. note::\n \n@@ -81,12 +64,12 @@ work, see :doc:`Troubleshooting </faq/troubleshooting>`.\n \n .. admonition:: Where should this code live?\n \n-    If your background is in PHP, you're probably used to putting code under the\n-    Web server's document root (in a place such as ``/var/www``). With Django,\n-    you don't do that. It's not a good idea to put any of this Python code\n-    within your Web server's document root, because it risks the possibility\n-    that people may be able to view your code over the Web. That's not good for\n-    security.\n+    If your background is in plain old PHP (with no use of modern frameworks),\n+    you're probably used to putting code under the Web server's document root\n+    (in a place such as ``/var/www``). With Django, you don't do that. It's\n+    not a good idea to put any of this Python code within your Web server's\n+    document root, because it risks the possibility that people may be able\n+    to view your code over the Web. That's not good for security.\n \n     Put your code in some directory **outside** of the document root, such as\n     :file:`/home/mycode`.\n@@ -220,8 +203,8 @@ your database connection settings.\n   SQLite).\n \n * :setting:`HOST` -- The host your database is on. Leave this as\n-  an empty string if your database server is on the same physical\n-  machine (not used for SQLite).\n+  an empty string (or possibly ``127.0.0.1``) if your database server is on the\n+  same physical machine (not used for SQLite). See :setting:`HOST` for details.\n \n If you're new to databases, we recommend simply using SQLite by setting\n :setting:`ENGINE` to ``'django.db.backends.sqlite3'`` and :setting:`NAME` to\n@@ -666,6 +649,7 @@ Save these changes and start a new Python interactive shell by running\n     >>> Poll.objects.get(pub_date__year=2012)\n     <Poll: What's up?>\n \n+    # Request an ID that doesn't exist, this will raise an exception.\n     >>> Poll.objects.get(id=2)\n     Traceback (most recent call last):\n         ..."
        },
        {
            "sha": "2c8d25ae6f920b3ddace035f4e88cb3c39b12fa1",
            "filename": "docs/intro/tutorial02.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial02.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial02.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial02.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -445,11 +445,6 @@ live anywhere on your filesystem that Django can access. (Django runs as\n whatever user your server runs.) However, keeping your templates within the\n project is a good convention to follow.\n \n-When you’ve done that, create a directory polls in your template directory.\n-Within that, create a file called index.html. Note that our\n-``loader.get_template('polls/index.html')`` code from above maps to\n-[template_directory]/polls/index.html” on the filesystem.\n-\n By default, :setting:`TEMPLATE_DIRS` is empty. So, let's add a line to it, to\n tell Django where our templates live::\n "
        },
        {
            "sha": "3159ee88c214754178e5b5c7367f618b15583f6d",
            "filename": "docs/intro/tutorial03.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial03.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial03.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial03.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -235,11 +235,11 @@ be used to identify the matched pattern; and ``\\d+`` is a regular expression to\n match a sequence of digits (i.e., a number).\n \n Because the URL patterns are regular expressions, there really is no limit on\n-what you can do with them. And there's no need to add URL cruft such as ``.php``\n--- unless you have a sick sense of humor, in which case you can do something\n-like this::\n+what you can do with them. And there's no need to add URL cruft such as\n+``.html`` -- unless you want to, in which case you can do something like\n+this::\n \n-    (r'^polls/latest\\.php$', 'polls.views.index'),\n+    (r'^polls/latest\\.html$', 'polls.views.index'),\n \n But, don't do that. It's silly.\n \n@@ -315,6 +315,12 @@ Load the page in your Web browser, and you should see a bulleted-list\n containing the \"What's up\" poll from Tutorial 1. The link points to the poll's\n detail page.\n \n+.. admonition:: Organizing Templates\n+\n+    Rather than one big templates directory, you can also store templates\n+    within each app. We'll discuss this in more detail in the :doc:`reusable\n+    apps tutorial</intro/reusable-apps>`.\n+\n A shortcut: :func:`~django.shortcuts.render`\n --------------------------------------------\n "
        },
        {
            "sha": "1619b599bbeee957acf1634192d1f70c0af30ad1",
            "filename": "docs/intro/tutorial04.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial04.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial04.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial04.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -275,8 +275,5 @@ Run the server, and use your new polling app based on generic views.\n For full details on generic views, see the :doc:`generic views documentation\n </topics/class-based-views/index>`.\n \n-What's next?\n-============\n-\n-The tutorial ends here for the time being. In the meantime, you might want to\n-check out some pointers on :doc:`where to go from here </intro/whatsnext>`.\n+When you're comfortable with forms and generic views, read :doc:`part 5 of this\n+tutorial</intro/tutorial05>` to learn about testing our polls app."
        },
        {
            "sha": "163b7cdd0fc49720acf17634b892c8ad9fedee3a",
            "filename": "docs/intro/tutorial05.txt",
            "status": "added",
            "additions": 650,
            "deletions": 0,
            "changes": 650,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial05.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fintro%2Ftutorial05.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial05.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,650 @@\n+=====================================\n+Writing your first Django app, part 5\n+=====================================\n+\n+This tutorial begins where :doc:`Tutorial 4 </intro/tutorial04>` left off.\n+We've built a Web-poll application, and we'll now create some automated tests\n+for it.\n+\n+Introducing automated testing\n+=============================\n+\n+What are automated tests?\n+-------------------------\n+\n+Tests are simple routines that check the operation of your code.\n+\n+Testing operates at different levels. Some tests might apply to a tiny detail\n+- *does a particular model method return values as expected?*, while others\n+examine the overall operation of the software - *does a sequence of user inputs\n+on the site produce the desired result?* That's no different from the kind of\n+testing you did earlier in :doc:`Tutorial 1 </intro/tutorial01>`, using the\n+shell to examine the behavior of a method, or running the application and\n+entering data to check how it behaves.\n+\n+What's different in *automated* tests is that the testing work is done for\n+you by the system. You create a set of tests once, and then as you make changes\n+to your app, you can check that your code still works as you originally\n+intended, without having to perform time consuming manual testing.\n+\n+Why you need to create tests\n+----------------------------\n+\n+So why create tests, and why now?\n+\n+You may feel that you have quite enough on your plate just learning\n+Python/Django, and having yet another thing to learn and do may seem\n+overwhelming and perhaps unnecessary. After all, our polls application is\n+working quite happily now; going through the trouble of creating automated\n+tests is not going to make it work any better. If creating the polls\n+application is the last bit of Django programming you will ever do, then true,\n+you don't need to know how to create automated tests. But, if that's not the\n+case, now is an excellent time to learn.\n+\n+Tests will save you time\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Up to a certain point, 'checking that it seems to work' will be a satisfactory\n+test. In a more sophisticated application, you might have dozens of complex\n+interactions between components.\n+\n+A change in any of those components could have unexpected consequences on the\n+application's behavior. Checking that it still 'seems to work' could mean\n+running through your code's functionality with twenty different variations of\n+your test data just to make sure you haven't broken something - not a good use\n+of your time.\n+\n+That's especially true when automated tests could do this for you in seconds.\n+If something's gone wrong, tests will also assist in identifying the code\n+that's causing the unexpected behavior.\n+\n+Sometimes it may seem a chore to tear yourself away from your productive,\n+creative programming work to face the unglamorous and unexciting business\n+of writing tests, particularly when you know your code is working properly.\n+\n+However, the task of writing tests is a lot more fulfilling than spending hours\n+testing your application manually or trying to identify the cause of a\n+newly-introduced problem.\n+\n+Tests don't just identify problems, they prevent them\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+It's a mistake to think of tests merely as a negative aspect of development.\n+\n+Without tests, the purpose or intended behavior of an application might be\n+rather opaque. Even when it's your own code, you will sometimes find yourself\n+poking around in it trying to find out what exactly it's doing.\n+\n+Tests change that; they light up your code from the inside, and when something\n+goes wrong, they focus light on the part that has gone wrong - *even if you\n+hadn't even realized it had gone wrong*.\n+\n+Tests make your code more attractive\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+You might have created a brilliant piece of software, but you will find that\n+many other developers will simply refuse to look at it because it lacks tests;\n+without tests, they won't trust it. Jacob Kaplan-Moss, one of Django's\n+original developers, says \"Code without tests is broken by design.\"\n+\n+That other developers want to see tests in your software before they take it\n+seriously is yet another reason for you to start writing tests.\n+\n+Tests help teams work together\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The previous points are written from the point of view of a single developer\n+maintaining an application. Complex applications will be maintained by teams.\n+Tests guarantee that colleagues don't inadvertently break your code (and that\n+you don't break theirs without knowing). If you want to make a living as a\n+Django programmer, you must be good at writing tests!\n+\n+Basic testing strategies\n+========================\n+\n+There are many ways to approach writing tests.\n+\n+Some programmers follow a discipline called \"`test-driven development`_\"; they\n+actually write their tests before they write their code. This might seem\n+counter-intuitive, but in fact it's similar to what most people will often do\n+anyway: they describe a problem, then create some code to solve it. Test-driven\n+development simply formalizes the problem in a Python test case.\n+\n+More often, a newcomer to testing will create some code and later decide that\n+it should have some tests. Perhaps it would have been better to write some\n+tests earlier, but it's never too late to get started.\n+\n+Sometimes it's difficult to figure out where to get started with writing tests.\n+If you have written several thousand lines of Python, choosing something to\n+test might not be easy. In such a case, it's fruitful to write your first test\n+the next time you make a change, either when you add a new feature or fix a bug.\n+\n+So let's do that right away.\n+\n+.. _test-driven development: http://en.wikipedia.org/wiki/Test-driven_development/\n+\n+Writing our first test\n+======================\n+\n+We identify a bug\n+-----------------\n+\n+Fortunately, there's a little bug in the ``polls`` application for us to fix\n+right away: the ``Poll.was_published_recently()`` method returns ``True`` if\n+the ``Poll`` was published within the last day (which is correct) but also if\n+the ``Poll``'s ``pub_date`` field is in the future (which certainly isn't).\n+\n+You can see this in the Admin; create a poll whose date lies in the future;\n+you'll see that the ``Poll`` change list claims it was published recently.\n+\n+You can also see this using the shell::\n+\n+    >>> import datetime\n+    >>> from django.utils import timezone\n+    >>> from polls.models import Poll\n+    >>> # create a Poll instance with pub_date 30 days in the future\n+    >>> future_poll = Poll(pub_date=timezone.now() + datetime.timedelta(days=30))\n+    >>> # was it published recently?\n+    >>> future_poll.was_published_recently()\n+    True\n+\n+Since things in the future are not 'recent', this is clearly wrong.\n+\n+Create a test to expose the bug\n+-------------------------------\n+\n+What we've just done in the shell to test for the problem is exactly what we\n+can do in an automated test, so let's turn that into an automated test.\n+\n+The best place for an application's tests is in the application's ``tests.py``\n+file - the testing system will look there for tests automatically.\n+\n+Put the following in the ``tests.py`` file in the ``polls`` application (you'll\n+notice  ``tests.py`` contains some dummy tests, you can remove those)::\n+\n+    import datetime\n+\n+    from django.utils import timezone\n+    from django.test import TestCase\n+\n+    from polls.models import Poll\n+\n+    class PollMethodTests(TestCase):\n+\n+        def test_was_published_recently_with_future_poll(self):\n+            \"\"\"\n+            was_published_recently() should return False for polls whose\n+            pub_date is in the future\n+            \"\"\"\n+            future_poll = Poll(pub_date=timezone.now() + datetime.timedelta(days=30))\n+            self.assertEqual(future_poll.was_published_recently(), False)\n+\n+What we have done here is created a :class:`django.test.TestCase` subclass\n+with a method that creates a ``Poll`` instance with a ``pub_date`` in the\n+future. We then check the output of ``was_published_recently()`` - which\n+*ought* to be False.\n+\n+Running tests\n+-------------\n+\n+In the terminal, we can run our test::\n+\n+    python manage.py test polls\n+\n+and you'll see something like::\n+\n+    Creating test database for alias 'default'...\n+    F\n+    ======================================================================\n+    FAIL: test_was_published_recently_with_future_poll (polls.tests.PollMethodTests)\n+    ----------------------------------------------------------------------\n+    Traceback (most recent call last):\n+      File \"/path/to/mysite/polls/tests.py\", line 16, in test_was_published_recently_with_future_poll\n+        self.assertEqual(future_poll.was_published_recently(), False)\n+    AssertionError: True != False\n+\n+    ----------------------------------------------------------------------\n+    Ran 1 test in 0.001s\n+\n+    FAILED (failures=1)\n+    Destroying test database for alias 'default'...\n+\n+What happened is this:\n+\n+* ``python manage.py test polls`` looked for tests in the ``polls`` application\n+\n+* it found a subclass of the :class:`django.test.TestCase` class\n+\n+* it created a special database for the purpose of testing\n+\n+* it looked for test methods - ones whose names begin with ``test``\n+\n+* in ``test_was_published_recently_with_future_poll`` it created a ``Poll``\n+  instance whose ``pub_date`` field is 30 days in the future\n+\n+* ... and using the ``assertEqual()`` method, it discovered that its\n+  ``was_published_recently()`` returns ``True``, though we wanted it to return\n+  ``False``\n+\n+The test informs us which test failed and even the line on which the failure\n+occurred.\n+\n+Fixing the bug\n+--------------\n+\n+We already know what the problem is: ``Poll.was_published_recently()`` should\n+return ``False`` if its ``pub_date`` is in the future. Amend the method in\n+``models.py``, so that it will only return ``True`` if the date is also in the\n+past::\n+\n+    def was_published_recently(self):\n+        now = timezone.now()\n+        return now - datetime.timedelta(days=1) <= self.pub_date <  now\n+\n+and run the test again::\n+\n+    Creating test database for alias 'default'...\n+    .\n+    ----------------------------------------------------------------------\n+    Ran 1 test in 0.001s\n+\n+    OK\n+    Destroying test database for alias 'default'...\n+\n+After identifying a bug, we wrote a test that exposes it and corrected the bug\n+in the code so our test passes.\n+\n+Many other things might go wrong with our application in the future, but we can\n+be sure that we won't inadvertently reintroduce this bug, because simply\n+running the test will warn us immediately. We can consider this little portion\n+of the application pinned down safely forever.\n+\n+More comprehensive tests\n+------------------------\n+\n+While we're here, we can further pin down the ``was_published_recently()``\n+method; in fact, it would be positively embarrassing if in fixing one bug we had\n+introduced another.\n+\n+Add two more test methods to the same class, to test the behavior of the method\n+more comprehensively::\n+\n+    def test_was_published_recently_with_old_poll(self):\n+        \"\"\"\n+        was_published_recently() should return False for polls whose pub_date\n+        is older than 1 day\n+        \"\"\"\n+        old_poll = Poll(pub_date=timezone.now() - datetime.timedelta(days=30))\n+        self.assertEqual(old_poll.was_published_recently(), False)\n+\n+    def test_was_published_recently_with_recent_poll(self):\n+        \"\"\"\n+        was_published_recently() should return True for polls whose pub_date\n+        is within the last day\n+        \"\"\"\n+        recent_poll = Poll(pub_date=timezone.now() - datetime.timedelta(hours=1))\n+        self.assertEqual(recent_poll.was_published_recently(), True)\n+\n+And now we have three tests that confirm that ``Poll.was_published_recently()``\n+returns sensible values for past, recent, and future polls.\n+\n+Again, ``polls`` is a simple application, but however complex it grows in the\n+future and whatever other code it interacts with, we now have some guarantee\n+that the method we have written tests for will behave in expected ways.\n+\n+Test a view\n+===========\n+\n+The polls application is fairly undiscriminating: it will publish any poll,\n+including ones whose ``pub_date`` field lies in the future. We should improve\n+this. Setting a ``pub_date`` in the future should mean that the Poll is\n+published at that moment, but invisible until then.\n+\n+A test for a view\n+-----------------\n+\n+When we fixed the bug above, we wrote the test first and then the code to fix\n+it. In fact that was a simple example of test-driven development, but it\n+doesn't really matter in which order we do the work.\n+\n+In our first test, we focused closely on the internal behavior of the code. For\n+this test, we want to check its behavior as it would be experienced by a user\n+through a web browser.\n+\n+Before we try to fix anything, let's have a look at the tools at our disposal.\n+\n+The Django test client\n+----------------------\n+\n+Django provides a test :class:`~django.test.client.Client` to simulate a user\n+interacting with the code at the view level.  We can use it in ``tests.py``\n+or even in the shell.\n+\n+We will start again with the shell, where we need to do a couple of things that\n+won't be necessary in ``tests.py``. The first is to set up the test environment\n+in the shell::\n+\n+    >>> from django.test.utils import setup_test_environment\n+    >>> setup_test_environment()\n+\n+Next we need to import the test client class (later in ``tests.py`` we will use\n+the :class:`django.test.TestCase` class, which comes with its own client, so\n+this won't be required)::\n+\n+    >>> from django.test.client import Client\n+    >>> # create an instance of the client for our use\n+    >>> client = Client()\n+\n+With that ready, we can ask the client to do some work for us::\n+\n+    >>> # get a response from '/'\n+    >>> response = client.get('/')\n+    >>> # we should expect a 404 from that address\n+    >>> response.status_code\n+    404\n+    >>> # on the other hand we should expect to find something at '/polls/'\n+    >>> # we'll use 'reverse()' rather than a harcoded URL\n+    >>> from django.core.urlresolvers import reverse\n+    >>> response = client.get(reverse('polls:index'))\n+    >>> response.status_code\n+    200\n+    >>> response.content\n+    '\\n\\n\\n    <p>No polls are available.</p>\\n\\n'\n+    >>> # note - you might get unexpected results if your ``TIME_ZONE``\n+    >>> # in ``settings.py`` is not correct. If you need to change it,\n+    >>> # you will also need to restart your shell session\n+    >>> from polls.models import Poll\n+    >>> from django.utils import timezone\n+    >>> # create a Poll and save it\n+    >>> p = Poll(question=\"Who is your favorite Beatle?\", pub_date=timezone.now())\n+    >>> p.save()\n+    >>> # check the response once again\n+    >>> response = client.get('/polls/')\n+    >>> response.content\n+    '\\n\\n\\n    <ul>\\n    \\n        <li><a href=\"/polls/1/\">Who is your favorite Beatle?</a></li>\\n    \\n    </ul>\\n\\n'\n+    >>> response.context['latest_poll_list']\n+    [<Poll: Who is your favorite Beatle?>]\n+\n+Improving our view\n+------------------\n+\n+The list of polls shows polls that aren't published yet (i.e. those that have a\n+``pub_date`` in the future). Let's fix that.\n+\n+In :doc:`Tutorial 4 </intro/tutorial04>` we deleted the view functions from\n+``views.py`` in favor of a :class:`~django.views.generic.list.ListView` in\n+``urls.py``::\n+\n+    url(r'^$',\n+        ListView.as_view(\n+            queryset=Poll.objects.order_by('-pub_date')[:5],\n+            context_object_name='latest_poll_list',\n+            template_name='polls/index.html'),\n+        name='index'),\n+\n+``response.context_data['latest_poll_list']`` extracts the data this view\n+places into the context.\n+\n+We need to amend the line that gives us the ``queryset``::\n+\n+    queryset=Poll.objects.order_by('-pub_date')[:5],\n+\n+Let's change the queryset so that it also checks the date by comparing it with\n+``timezone.now()``. First we need to add an import::\n+\n+    from django.utils import timezone\n+\n+and then we must amend the existing ``url`` function to::\n+\n+    url(r'^$',\n+        ListView.as_view(\n+            queryset=Poll.objects.filter(pub_date__lte=timezone.now) \\\n+                .order_by('-pub_date')[:5],\n+            context_object_name='latest_poll_list',\n+            template_name='polls/index.html'),\n+        name='index'),\n+\n+``Poll.objects.filter(pub_date__lte=timezone.now)`` returns a queryset\n+containing Polls whose ``pub_date`` is less than or equal to - that is, earlier\n+than or equal to - ``timezone.now``. Notice that we use a callable queryset\n+argument, ``timezone.now``, which will be evaluated at request time. If we had\n+included the parentheses, ``timezone.now()`` would be evaluated just once when\n+the web server is started.\n+\n+Testing our new view\n+--------------------\n+\n+Now you can satisfy yourself that this behaves as expected by firing up the\n+runserver, loading the site in your browser, creating ``Polls`` with dates in\n+the past and future, and checking that only those that have been published are\n+listed.  You don't want to have to do that *every single time you make any\n+change that might affect this* - so let's also create a test, based on our\n+shell session above.\n+\n+Add the following to ``polls/tests.py``::\n+\n+    from django.core.urlresolvers import reverse\n+\n+and we'll create a factory method to create polls as well as a new test class::\n+\n+    def create_poll(question, days):\n+        \"\"\"\n+        Creates a poll with the given `question` published the given number of\n+        `days` offset to now (negative for polls published in the past,\n+        positive for polls that have yet to be published).\n+        \"\"\"\n+        return Poll.objects.create(question=question,\n+            pub_date=timezone.now() + datetime.timedelta(days=days))\n+\n+    class PollViewTests(TestCase):\n+        def test_index_view_with_no_polls(self):\n+            \"\"\"\n+            If no polls exist, an appropriate message should be displayed.\n+            \"\"\"\n+            response = self.client.get(reverse('polls:index'))\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, \"No polls are available.\")\n+            self.assertQuerysetEqual(response.context['latest_poll_list'], [])\n+\n+        def test_index_view_with_a_past_poll(self):\n+            \"\"\"\n+            Polls with a pub_date in the past should be displayed on the index page.\n+            \"\"\"\n+            create_poll(question=\"Past poll.\", days=-30)\n+            response = self.client.get(reverse('polls:index'))\n+            self.assertQuerysetEqual(\n+                response.context['latest_poll_list'],\n+                ['<Poll: Past poll.>']\n+            )\n+\n+        def test_index_view_with_a_future_poll(self):\n+            \"\"\"\n+            Polls with a pub_date in the future should not be displayed on the\n+            index page.\n+            \"\"\"\n+            create_poll(question=\"Future poll.\", days=30)\n+            response = self.client.get(reverse('polls:index'))\n+            self.assertContains(response, \"No polls are available.\", status_code=200)\n+            self.assertQuerysetEqual(response.context['latest_poll_list'], [])\n+\n+        def test_index_view_with_future_poll_and_past_poll(self):\n+            \"\"\"\n+            Even if both past and future polls exist, only past polls should be\n+            displayed.\n+            \"\"\"\n+            create_poll(question=\"Past poll.\", days=-30)\n+            create_poll(question=\"Future poll.\", days=30)\n+            response = self.client.get(reverse('polls:index'))\n+            self.assertQuerysetEqual(\n+                response.context['latest_poll_list'],\n+                ['<Poll: Past poll.>']\n+            )\n+\n+        def test_index_view_with_two_past_polls(self):\n+            \"\"\"\n+            The polls index page may display multiple polls.\n+            \"\"\"\n+            create_poll(question=\"Past poll 1.\", days=-30)\n+            create_poll(question=\"Past poll 2.\", days=-5)\n+            response = self.client.get(reverse('polls:index'))\n+            self.assertQuerysetEqual(\n+                response.context['latest_poll_list'],\n+                 ['<Poll: Past poll 2.>', '<Poll: Past poll 1.>']\n+            )\n+\n+Let's look at some of these more closely.\n+\n+First is a poll factory method, ``create_poll``, to take some repetition out\n+of the process of creating polls.\n+\n+``test_index_view_with_no_polls`` doesn't create any polls, but checks the\n+message: \"No polls are available.\" and verifies the ``latest_poll_list`` is\n+empty. Note that the :class:`django.test.TestCase` class provides some\n+additional assertion methods. In these examples, we use\n+:meth:`~django.test.TestCase.assertContains()` and\n+:meth:`~django.test.TestCase.assertQuerysetEqual()`.\n+\n+In ``test_index_view_with_a_past_poll``, we create a poll and verify that it\n+appears in the list.\n+\n+In ``test_index_view_with_a_future_poll``, we create a poll with a ``pub_date``\n+in the future. The database is reset for each test method, so the first poll is\n+no longer there, and so again the index shouldn't have any polls in it.\n+\n+And so on. In effect, we are using the tests to tell a story of admin input\n+and user experience on the site, and checking that at every state and for every\n+new change in the state of the system, the expected results are published.\n+\n+Testing the ``DetailView``\n+--------------------------\n+\n+What we have works well; however, even though future polls don't appear in the\n+*index*, users can still reach them if they know or guess the right URL. So we\n+need similar constraints in the ``DetailViews``, by adding::\n+\n+    queryset=Poll.objects.filter(pub_date__lte=timezone.now)\n+\n+to them - for example::\n+\n+    url(r'^(?P<pk>\\d+)/$',\n+        DetailView.as_view(\n+            queryset=Poll.objects.filter(pub_date__lte=timezone.now),\n+            model=Poll,\n+            template_name='polls/detail.html'),\n+        name='detail'),\n+\n+and of course, we will add some tests, to check that a ``Poll`` whose\n+``pub_date`` is in the past can be displayed, and that one with a ``pub_date``\n+in the future is not::\n+\n+    class PollIndexDetailTests(TestCase):\n+        def test_detail_view_with_a_future_poll(self):\n+            \"\"\"\n+            The detail view of a poll with a pub_date in the future should\n+            return a 404 not found.\n+            \"\"\"\n+            future_poll = create_poll(question='Future poll.', days=5)\n+            response = self.client.get(reverse('polls:detail', args=(future_poll.id,)))\n+            self.assertEqual(response.status_code, 404)\n+\n+        def test_detail_view_with_a_past_poll(self):\n+            \"\"\"\n+            The detail view of a poll with a pub_date in the past should display\n+            the poll's question.\n+            \"\"\"\n+            past_poll = create_poll(question='Past Poll.', days=-5)\n+            response = self.client.get(reverse('polls:detail', args=(past_poll.id,)))\n+            self.assertContains(response, past_poll.question, status_code=200)\n+\n+Ideas for more tests\n+--------------------\n+\n+We ought to add similar ``queryset`` arguments to the other ``DetailView``\n+URLs, and create a new test class for each view. They'll be very similar to\n+what we have just created; in fact there will be a lot of repetition.\n+\n+We could also improve our application in other ways, adding tests along the\n+way. For example, it's silly that ``Polls`` can be published on the site that\n+have no ``Choices``. So, our views could check for this, and exclude such\n+``Polls``. Our tests would create a ``Poll`` without ``Choices`` and then test\n+that it's not published, as well as create a similar ``Poll`` *with*\n+``Choices``, and test that it *is* published.\n+\n+Perhaps logged-in admin users should be allowed to see unpublished ``Polls``,\n+but not ordinary visitors. Again: whatever needs to be added to the software to\n+accomplish this should be accompanied by a test, whether you write the test\n+first and then make the code pass the test, or work out the logic in your code\n+first and then write a test to prove it.\n+\n+At a certain point you are bound to look at your tests and wonder whether your\n+code is suffering from test bloat, which brings us to:\n+\n+When testing, more is better\n+============================\n+\n+It might seem that our tests are growing out of control. At this rate there will\n+soon be more code in our tests than in our application, and the repetition\n+is unaesthetic, compared to the elegant conciseness of the rest of our code.\n+\n+**It doesn't matter**. Let them grow. For the most part, you can write a test\n+once and then forget about it. It will continue performing its useful function\n+as you continue to develop your program.\n+\n+Sometimes tests will need to be updated. Suppose that we amend our views so that\n+only ``Polls`` with ``Choices`` are published. In that case, many of our\n+existing tests will fail - *telling us exactly which tests need to be amended to\n+bring them up to date*, so to that extent tests help look after themselves.\n+\n+At worst, as you continue developing, you might find that you have some tests\n+that are now redundant. Even that's not a problem; in testing redundancy is\n+a *good* thing.\n+\n+As long as your tests are sensibly arranged, they won't become unmanageable.\n+Good rules-of-thumb include having:\n+\n+* a separate ``TestClass`` for each model or view\n+* a separate test method for each set of conditions you want to test\n+* test method names that describe their function\n+\n+Further testing\n+===============\n+\n+This tutorial only introduces some of the basics of testing. There's a great\n+deal more you can do, and a number of very useful tools at your disposal to\n+achieve some very clever things.\n+\n+For example, while our tests here have covered some of the internal logic of a\n+model and the way our views publish information, you can use an \"in-browser\"\n+framework such as Selenium_ to test the way your HTML actually renders in a\n+browser. These tools allow you to check not just the behavior of your Django\n+code, but also, for example, of your JavaScript. It's quite something to see\n+the tests launch a browser, and start interacting with your site, as if a human\n+being were driving it! Django includes :class:`~django.test.LiveServerTestCase`\n+to facilitate integration with tools like Selenium.\n+\n+If you have a complex application, you may want to run tests automatically\n+with every commit for the purposes of `continuous integration`_, so that\n+quality control is itself - at least partially - automated.\n+\n+A good way to spot untested parts of your application is to check code\n+coverage. This also helps identify fragile or even dead code. If you can't test\n+a piece of code, it usually means that code should be refactored or removed.\n+Coverage will help to identify dead code. See\n+:ref:`topics-testing-code-coverage` for details.\n+\n+:doc:`Testing Django applications </topics/testing>` has comprehensive\n+information about testing.\n+\n+.. _Selenium: http://seleniumhq.org/\n+.. _continuous integration: http://en.wikipedia.org/wiki/Continuous_integration\n+\n+What's next?\n+============\n+\n+The beginner tutorial ends here for the time being. In the meantime, you might\n+want to check out some pointers on :doc:`where to go from here\n+</intro/whatsnext>`.\n+\n+If you are familiar with Python packaging and interested in learning how to\n+turn polls into a \"reusable app\", check out :doc:`Advanced tutorial: How to\n+write reusable apps</intro/reusable-apps>`."
        },
        {
            "sha": "d7f54b2059390a3de5261b33d9f0167cbaf82c33",
            "filename": "docs/make.bat",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fmake.bat",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fmake.bat",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fmake.bat?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -29,6 +29,7 @@ if \"%1\" == \"help\" (\n \techo.  latex      to make LaTeX files, you can set PAPER=a4 or PAPER=letter\n \techo.  text       to make text files\n \techo.  man        to make manual pages\n+\techo.  texinfo    to make a Texinfo source file\n \techo.  gettext    to make PO message catalogs\n \techo.  changes    to make an overview over all changed/added/deprecated items\n \techo.  linkcheck  to check all external links for integrity\n@@ -143,6 +144,14 @@ if \"%1\" == \"man\" (\n \tgoto end\n )\n \n+if \"%1\" == \"texinfo\" (\n+\t%SPHINXBUILD% -b texinfo %ALLSPHINXOPTS% %BUILDDIR%/texinfo\n+\tif errorlevel 1 exit /b 1\n+\techo.\n+\techo.Build finished. The Texinfo files are in %BUILDDIR%/texinfo.\n+\tgoto end\n+)\n+\n if \"%%1\" == \"gettext\" (\n \t%SPHINXBUILD% -b gettext %I18NSPHINXOPTS% %BUILDDIR%/locale\n \tif errorlevel 1 exit /b 1"
        },
        {
            "sha": "0101da9586d5b7862a5ade3bd298f806c99bc92b",
            "filename": "docs/misc/design-philosophies.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fmisc%2Fdesign-philosophies.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fmisc%2Fdesign-philosophies.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fmisc%2Fdesign-philosophies.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -203,9 +203,6 @@ We see a template system as a tool that controls presentation and\n presentation-related logic -- and that's it. The template system shouldn't\n support functionality that goes beyond this basic goal.\n \n-If we wanted to put everything in templates, we'd be using PHP. Been there,\n-done that, wised up.\n-\n Discourage redundancy\n ---------------------\n "
        },
        {
            "sha": "aa2f51f15662e83964dfe95057eee9bf09fee8e2",
            "filename": "docs/ref/class-based-views/flattened-index.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -116,6 +116,7 @@ ListView\n * :attr:`~django.views.generic.base.View.http_method_names`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -290,6 +291,7 @@ ArchiveIndexView\n * :attr:`~django.views.generic.base.View.http_method_names`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -325,6 +327,7 @@ YearArchiveView\n * :attr:`~django.views.generic.dates.BaseYearArchiveView.make_object_list` [:meth:`~django.views.generic.dates.BaseYearArchiveView.get_make_object_list`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -363,6 +366,7 @@ MonthArchiveView\n * :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n * :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -401,6 +405,7 @@ WeekArchiveView\n * :attr:`~django.views.generic.base.View.http_method_names`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -443,6 +448,7 @@ DayArchiveView\n * :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n * :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -487,6 +493,7 @@ TodayArchiveView\n * :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n * :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`"
        },
        {
            "sha": "0ae0bcdf421313c5808ab72154584914134361ba",
            "filename": "docs/ref/class-based-views/generic-date-based.txt",
            "status": "modified",
            "additions": 297,
            "deletions": 2,
            "changes": 299,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -7,6 +7,21 @@ Generic date views\n Date-based generic views, provided in :mod:`django.views.generic.dates`, are\n views for displaying drilldown pages for date-based data.\n \n+.. note::\n+\n+    Some of the examples on this page assume that an ``Article`` model has been\n+    defined as follows in ``myapp/models.py``::\n+\n+        from django.db import models\n+        from django.core.urlresolvers import reverse\n+\n+        class Article(models.Model):\n+            title = models.CharField(max_length=200)\n+            pub_date = models.DateField()\n+\n+            def get_absolute_url(self):\n+                return reverse('article-detail', kwargs={'pk': self.pk})\n+\n ArchiveIndexView\n ----------------\n \n@@ -35,6 +50,31 @@ ArchiveIndexView\n       month or day using the attribute ``date_list_period``. This also applies\n       to all subclass views.\n \n+    **Example views.py**::\n+\n+        from django.conf.urls import patterns, url\n+        from django.views.generic.dates import ArchiveIndexView\n+\n+        from myapp.models import Article\n+\n+        urlpatterns = patterns('',\n+            url(r'^archive/$',\n+                ArchiveIndexView.as_view(model=Article, date_field=\"pub_date\"),\n+                name=\"article_archive\"),\n+        )\n+\n+    **Example myapp/article_archive.html**:\n+\n+    .. code-block:: html+django\n+\n+        <ul>\n+            {% for article in latest %}\n+                <li>{{ article.pub_date }}: {{ article.title }}</li>\n+            {% endfor %}\n+        </ul>\n+\n+    This will output all articles.\n+\n YearArchiveView\n ---------------\n \n@@ -109,6 +149,49 @@ YearArchiveView\n \n     * Uses a default ``template_name_suffix`` of ``_archive_year``.\n \n+    **Example views.py**::\n+\n+        from django.views.generic.dates import YearArchiveView\n+\n+        from myapp.models import Article\n+\n+        class ArticleYearArchiveView(YearArchiveView):\n+            queryset = Article.objects.all()\n+            date_field = \"pub_date\"\n+            make_object_list = True\n+            allow_future = True\n+\n+    **Example urls.py**::\n+\n+        from django.conf.urls import patterns, url\n+\n+        from myapp.views import ArticleYearArchiveView\n+\n+        urlpatterns = patterns('',\n+            url(r'^(?P<year>\\d{4})/$',\n+                ArticleYearArchiveView.as_view(),\n+                name=\"article_year_archive\"),\n+        )\n+\n+    **Example myapp/article_archive_year.html**:\n+\n+    .. code-block:: html+django\n+\n+        <ul>\n+            {% for date in date_list %}\n+                <li>{{ date|date }}</li>\n+            {% endfor %}\n+        </ul>\n+\n+        <div>\n+            <h1>All Articles for {{ year|date:\"Y\" }}</h1>\n+            {% for obj in object_list %}\n+                <p>\n+                    {{ obj.title }} - {{ obj.pub_date|date:\"F j, Y\" }}\n+                </p>\n+            {% endfor %}\n+        </div>\n+\n MonthArchiveView\n ----------------\n \n@@ -162,6 +245,54 @@ MonthArchiveView\n \n     * Uses a default ``template_name_suffix`` of ``_archive_month``.\n \n+    **Example views.py**::\n+\n+        from django.views.generic.dates import MonthArchiveView\n+\n+        from myapp.models import Article\n+\n+        class ArticleMonthArchiveView(MonthArchiveView):\n+            queryset = Article.objects.all()\n+            date_field = \"pub_date\"\n+            make_object_list = True\n+            allow_future = True\n+\n+    **Example urls.py**::\n+\n+        from django.conf.urls import patterns, url\n+\n+        from myapp.views import ArticleMonthArchiveView\n+\n+        urlpatterns = patterns('',\n+            # Example: /2012/aug/\n+            url(r'^(?P<year>\\d{4})/(?P<month>[-\\w]+)/$',\n+                ArticleMonthArchiveView.as_view(),\n+                name=\"archive_month\"),\n+            # Example: /2012/08/\n+            url(r'^(?P<year>\\d{4})/(?P<month>\\d+)/$',\n+                ArticleMonthArchiveView.as_view(month_format='%m'),\n+                name=\"archive_month_numeric\"),\n+        )\n+\n+    **Example myapp/article_archive_month.html**:\n+\n+    .. code-block:: html+django\n+\n+        <ul>\n+            {% for article in object_list %}\n+                <li>{{ article.pub_date|date:\"F j, Y\" }}: {{ article.title }}</li>\n+            {% endfor %}\n+        </ul>\n+\n+        <p>\n+            {% if previous_month %}\n+                Previous Month: {{ previous_month|date:\"F Y\" }}\n+            {% endif %}\n+            {% if next_month %}\n+                Next Month: {{ next_month|date:\"F Y\" }}\n+            {% endif %}\n+        </p>\n+\n WeekArchiveView\n ---------------\n \n@@ -208,6 +339,65 @@ WeekArchiveView\n \n     * Uses a default ``template_name_suffix`` of ``_archive_week``.\n \n+    **Example views.py**::\n+\n+        from django.views.generic.dates import WeekArchiveView\n+\n+        from myapp.models import Article\n+\n+        class ArticleWeekArchiveView(WeekArchiveView):\n+            queryset = Article.objects.all()\n+            date_field = \"pub_date\"\n+            make_object_list = True\n+            week_format = \"%W\"\n+            allow_future = True\n+\n+    **Example urls.py**::\n+\n+        from django.conf.urls import patterns, url\n+\n+        from myapp.views import ArticleWeekArchiveView\n+\n+        urlpatterns = patterns('',\n+            # Example: /2012/week/23/\n+            url(r'^(?P<year>\\d{4})/week/(?P<week>\\d+)/$',\n+                ArticleWeekArchiveView.as_view(),\n+                name=\"archive_week\"),\n+        )\n+\n+    **Example myapp/article_archive_week.html**:\n+\n+    .. code-block:: html+django\n+\n+        <h1>Week {{ week|date:'W' }}</h1>\n+\n+        <ul>\n+            {% for article in object_list %}\n+                <li>{{ article.pub_date|date:\"F j, Y\" }}: {{ article.title }}</li>\n+            {% endfor %}\n+        </ul>\n+\n+        <p>\n+            {% if previous_week %}\n+                Previous Week: {{ previous_week|date:\"F Y\" }}\n+            {% endif %}\n+            {% if previous_week and next_week %}--{% endif %}\n+            {% if next_week %}\n+                Next week: {{ next_week|date:\"F Y\" }}\n+            {% endif %}\n+        </p>\n+\n+    In this example, you are outputting the week number. The default\n+    ``week_format`` in the ``WeekArchiveView`` uses  week format ``'%U'``\n+    which is based on the United States week system where the week begins on a\n+    Sunday. The ``'%W'`` format uses the ISO week format and its week\n+    begins on a Monday.  The ``'%W'`` format is the same in both the\n+    :func:`~time.strftime` and the :tfilter:`date`.\n+\n+    However, the :tfilter:`date` template filter does not have an equivalent\n+    output format that supports the US based week system. The :tfilter:`date`\n+    filter ``'%U'`` outputs the number of seconds since the Unix epoch.\n+\n DayArchiveView\n --------------\n \n@@ -265,6 +455,53 @@ DayArchiveView\n \n     * Uses a default ``template_name_suffix`` of ``_archive_day``.\n \n+    **Example views.py**::\n+\n+        from django.views.generic.dates import DayArchiveView\n+\n+        from myapp.models import Article\n+\n+        class ArticleDayArchiveView(DayArchiveView):\n+            queryset = Article.objects.all()\n+            date_field = \"pub_date\"\n+            make_object_list = True\n+            allow_future = True\n+\n+    **Example urls.py**::\n+\n+        from django.conf.urls import patterns, url\n+\n+        from myapp.views import ArticleDayArchiveView\n+\n+        urlpatterns = patterns('',\n+            # Example: /2012/nov/10/\n+            url(r'^(?P<year>\\d{4})/(?P<month>[-\\w]+)/(?P<day>\\d+)/$',\n+                ArticleDayArchiveView.as_view(),\n+                name=\"archive_day\"),\n+        )\n+\n+    **Example myapp/article_archive_day.html**:\n+\n+    .. code-block:: html+django\n+\n+        <h1>{{ day }}</h1>\n+\n+        <ul>\n+            {% for article in object_list %}\n+                <li>{{ article.pub_date|date:\"F j, Y\" }}: {{ article.title }}</li>\n+            {% endfor %}\n+        </ul>\n+\n+        <p>\n+            {% if previous_day %}\n+                Previous Day: {{ previous_day }}\n+            {% endif %}\n+            {% if previous_day and next_day %}--{% endif %}\n+            {% if next_day %}\n+                Next Day: {{ next_day }}\n+            {% endif %}\n+        </p>\n+\n TodayArchiveView\n ----------------\n \n@@ -289,6 +526,40 @@ TodayArchiveView\n     * :class:`django.views.generic.dates.DateMixin`\n     * :class:`django.views.generic.base.View`\n \n+    **Notes**\n+\n+    * Uses a default ``template_name_suffix`` of ``_archive_today``.\n+\n+    **Example views.py**::\n+\n+        from django.views.generic.dates import TodayArchiveView\n+\n+        from myapp.models import Article\n+\n+        class ArticleTodayArchiveView(TodayArchiveView):\n+            queryset = Article.objects.all()\n+            date_field = \"pub_date\"\n+            make_object_list = True\n+            allow_future = True\n+\n+    **Example urls.py**::\n+\n+        from django.conf.urls import patterns, url\n+\n+        from myapp.views import ArticleTodayArchiveView\n+\n+        urlpatterns = patterns('',\n+            url(r'^today/$',\n+                ArticleTodayArchiveView.as_view(),\n+                name=\"archive_today\"),\n+        )\n+\n+    .. admonition:: Where is the example template for ``TodayArchiveView``?\n+\n+        This view uses by default the same template as the\n+        :class:`~DayArchiveView`, which is in the previous example. If you need\n+        a different template, set the ``template_name`` attribute to be the\n+        name of the new template.\n \n DateDetailView\n --------------\n@@ -313,6 +584,32 @@ DateDetailView\n     * :class:`django.views.generic.detail.SingleObjectMixin`\n     * :class:`django.views.generic.base.View`\n \n+    **Context**\n+\n+    * Includes the single object associated with the ``model`` specified in\n+      the ``DateDetailView``.\n+\n+    **Notes**\n+\n+    * Uses a default ``template_name_suffix`` of ``_detail``.\n+\n+    **Example urls.py**::\n+\n+        from django.conf.urls import patterns, url\n+        from django.views.generic.dates import DateDetailView\n+\n+        urlpatterns = patterns('',\n+            url(r'^(?P<year>\\d+)/(?P<month>[-\\w]+)/(?P<day>\\d+)/(?P<pk>\\d+)/$',\n+                DateDetailView.as_view(model=Article, date_field=\"pub_date\"),\n+                name=\"archive_date_detail\"),\n+        )\n+\n+    **Example myapp/article_detail.html**:\n+\n+    .. code-block:: html+django\n+\n+        <h1>{{ object.title }}</h1>\n+\n .. note::\n \n     All of the generic views listed above have matching ``Base`` views that\n@@ -332,5 +629,3 @@ DateDetailView\n     .. class:: BaseTodayArchiveView\n \n     .. class:: BaseDateDetailView\n-\n-"
        },
        {
            "sha": "7ce5c1d1bef116b9a8d92579eb349656e49f582b",
            "filename": "docs/ref/class-based-views/generic-editing.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -12,12 +12,11 @@ editing content:\n \n .. note::\n \n-    Some of the examples on this page assume that a model titled 'Author'\n-    has been defined. For these cases we assume the following has been defined\n-    in `myapp/models.py`::\n+    Some of the examples on this page assume that an ``Article`` model has been\n+    defined as follows in ``myapp/models.py``::\n \n-        from django import models\n         from django.core.urlresolvers import reverse\n+        from django.db import models\n \n         class Author(models.Model):\n             name = models.CharField(max_length=200)"
        },
        {
            "sha": "a027953416663a3c3f79ce8c2a0e7c58a9cf6e4b",
            "filename": "docs/ref/class-based-views/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -37,10 +37,11 @@ A class-based view is deployed into a URL pattern using the\n     is modified, the actions of one user visiting your view could have an\n     effect on subsequent users visiting the same view.\n \n-Any argument passed into :meth:`~django.views.generic.base.View.as_view()` will\n+Arguments passed into :meth:`~django.views.generic.base.View.as_view()` will\n be assigned onto the instance that is used to service a request. Using the\n previous example, this means that every request on ``MyView`` is able to use\n-``self.size``.\n+``self.size``. Arguments must correspond to attributes that already exist on\n+the class (return ``True`` on a ``hasattr`` check).\n \n Base vs Generic views\n ---------------------"
        },
        {
            "sha": "c85c962bce6f337a199e5587c5385fd8a188b8a9",
            "filename": "docs/ref/class-based-views/mixins-multiple-object.txt",
            "status": "modified",
            "additions": 29,
            "deletions": 2,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -69,8 +69,27 @@ MultipleObjectMixin\n         An integer specifying how many objects should be displayed per page. If\n         this is given, the view will paginate objects with\n         :attr:`MultipleObjectMixin.paginate_by` objects per page. The view will\n-        expect either a ``page`` query string parameter (via ``GET``) or a\n-        ``page`` variable specified in the URLconf.\n+        expect either a ``page`` query string parameter (via ``request.GET``)\n+        or a ``page`` variable specified in the URLconf.\n+\n+    .. attribute:: paginate_orphans\n+\n+        .. versionadded:: 1.6\n+\n+        An integer specifying the number of \"overflow\" objects the last page\n+        can contain. This extends the :attr:`MultipleObjectMixin.paginate_by`\n+        limit on the last page by up to\n+        :attr:`MultipleObjectMixin.paginate_orphans`, in order to keep the last\n+        page from having a very small number of objects.\n+\n+    .. attribute:: page_kwarg\n+\n+        .. versionadded:: 1.5\n+\n+        A string specifying the name to use for the page parameter.\n+        The view will expect this prameter to be available either as a query\n+        string parameter (via ``request.GET``) or as a kwarg variable specified\n+        in the URLconf. Defaults to ``page``.\n \n     .. attribute:: paginator_class\n \n@@ -110,6 +129,14 @@ MultipleObjectMixin\n         Returns an instance of the paginator to use for this view. By default,\n         instantiates an instance of :attr:`paginator_class`.\n \n+    .. method:: get_paginate_by()\n+\n+        .. versionadded:: 1.6\n+\n+        An integer specifying the number of \"overflow\" objects the last page\n+        can contain. By default this simply returns the value of\n+        :attr:`MultipleObjectMixin.paginate_orphans`.\n+\n     .. method:: get_allow_empty()\n \n         Return a boolean specifying whether to display the page if no objects"
        },
        {
            "sha": "d7eef623d58b8f0037416fd22a90b6e67fa7643f",
            "filename": "docs/ref/contrib/admin/actions.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fadmin%2Factions.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fadmin%2Factions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Factions.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -140,6 +140,15 @@ That's really all there is to it! If you're itching to write your own actions,\n you now know enough to get started. The rest of this document just covers more\n advanced techniques.\n \n+Handling errors in actions\n+--------------------------\n+\n+If there are foreseeable error conditions that may occur while running your\n+action, you should gracefully inform the user of the problem. This means\n+handling exceptions and and using\n+:meth:`django.contrib.admin.ModelAdmin.message_user` to display a user friendly\n+description of the problem in the response.\n+\n Advanced action techniques\n ==========================\n "
        },
        {
            "sha": "6f79e97a3ce9f697ea558a4a096f3ce53de49def",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 87,
            "deletions": 14,
            "changes": 101,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -26,9 +26,10 @@ There are seven steps in activating the Django admin site:\n    in your :setting:`INSTALLED_APPS` list, add them.\n \n 3. Add ``django.contrib.messages.context_processors.messages`` to\n-   :setting:`TEMPLATE_CONTEXT_PROCESSORS` and\n-   :class:`~django.contrib.messages.middleware.MessageMiddleware` to\n-   :setting:`MIDDLEWARE_CLASSES`. (These are both active by default, so\n+   :setting:`TEMPLATE_CONTEXT_PROCESSORS` as well as\n+   :class:`django.contrib.auth.middleware.AuthenticationMiddleware` and\n+   :class:`django.contrib.messages.middleware.MessageMiddleware` to\n+   :setting:`MIDDLEWARE_CLASSES`. (These are all active by default, so\n    you only need to do this if you've manually tweaked the settings.)\n \n 4. Determine which of your application's models should be editable in the\n@@ -569,8 +570,8 @@ subclass::\n \n     .. image:: _images/users_changelist.png\n \n-    ``list_filter`` should be a list of elements, where each element should be\n-    of one of the following types:\n+    ``list_filter`` should be a list or tuple of elements, where each element\n+    should be of one of the following types:\n \n     * a field name, where the specified field should be either a\n       ``BooleanField``, ``CharField``, ``DateField``, ``DateTimeField``,\n@@ -815,15 +816,36 @@ subclass::\n \n     By default the admin shows all fields as editable. Any fields in this\n     option (which should be a ``list`` or ``tuple``) will display its data\n-    as-is and non-editable. This option behaves nearly identical to\n-    :attr:`ModelAdmin.list_display`. Usage is the same, however, when you\n-    specify :attr:`ModelAdmin.fields` or :attr:`ModelAdmin.fieldsets` the\n-    read-only fields must be present to be shown (they are ignored otherwise).\n+    as-is and non-editable; they are also excluded from the\n+    :class:`~django.forms.ModelForm` used for creating and editing. Note that\n+    when specifying :attr:`ModelAdmin.fields` or :attr:`ModelAdmin.fieldsets`\n+    the read-only fields must be present to be shown (they are ignored\n+    otherwise).\n \n     If ``readonly_fields`` is used without defining explicit ordering through\n     :attr:`ModelAdmin.fields` or :attr:`ModelAdmin.fieldsets` they will be\n     added last after all editable fields.\n \n+    A read-only field can not only display data from a model's field, it can\n+    also display the output of a a model's method or a method of the\n+    ``ModelAdmin`` class itself. This is very similar to the way\n+    :attr:`ModelAdmin.list_display` behaves. This provides an easy way to use\n+    the admin interface to provide feedback on the status of the objects being\n+    edited, for example::\n+\n+        class PersonAdmin(ModelAdmin):\n+            readonly_fields = ('address_report',)\n+\n+            def address_report(self, instance):\n+                return \", \".join(instance.get_full_address()) or \\\n+                   \"<span class='errors'>I can't determine this address.</span>\"\n+\n+            # short_description functions like a model field's verbose_name\n+            address_report.short_description = \"Address\"\n+            # in this example, we have used HTML tags in the output\n+            address_report.allow_tags = True\n+\n+\n .. attribute:: ModelAdmin.save_as\n \n     Set ``save_as`` to enable a \"save as\" feature on admin change forms.\n@@ -1054,6 +1076,14 @@ templates used by the :class:`ModelAdmin` views:\n     changelist that will be linked to the change view, as described in the\n     :attr:`ModelAdmin.list_display_links` section.\n \n+.. method:: ModelAdmin.get_list_filter(self, request)\n+\n+    .. versionadded:: 1.5\n+\n+    The ``get_list_filter`` method is given the ``HttpRequest`` and is expected\n+    to return the same kind of sequence type as for the\n+    :attr:`~ModelAdmin.list_filter` attribute.\n+\n .. method:: ModelAdmin.get_inline_instances(self, request, obj=None)\n \n     .. versionadded:: 1.5\n@@ -1213,10 +1243,39 @@ templates used by the :class:`ModelAdmin` views:\n \n .. method:: ModelAdmin.get_changelist(self, request, **kwargs)\n \n-    Returns the Changelist class to be used for listing. By default,\n+    Returns the ``Changelist`` class to be used for listing. By default,\n     ``django.contrib.admin.views.main.ChangeList`` is used. By inheriting this\n     class you can change the behavior of the listing.\n \n+.. method:: ModelAdmin.get_changelist_form(self, request, **kwargs)\n+\n+    Returns a :class:`~django.forms.ModelForm` class for use in the ``Formset``\n+    on the changelist page. To use a custom form, for example::\n+\n+        class MyForm(forms.ModelForm):\n+            class Meta:\n+                model = MyModel\n+\n+        class MyModelAdmin(admin.ModelAdmin):\n+            def get_changelist_form(self, request, **kwargs):\n+                return MyForm\n+\n+.. method::  ModelAdmin.get_changelist_formset(self, request, **kwargs)\n+\n+    Returns a :ref:`ModelFormSet <model-formsets>` class for use on the\n+    changelist page if :attr:`~ModelAdmin.list_editable` is used. To use a\n+    custom formset, for example::\n+\n+        from django.forms.models import BaseModelFormSet\n+\n+        class MyAdminFormSet(BaseModelFormSet):\n+            pass\n+\n+        class MyModelAdmin(admin.ModelAdmin):\n+            def get_changelist_formset(self, request, **kwargs):\n+                kwargs['formset'] = MyAdminFormSet\n+                return super(MyModelAdmin, self).get_changelist_formset(request, **kwargs)\n+\n .. method:: ModelAdmin.has_add_permission(self, request)\n \n     Should return ``True`` if adding an object is permitted, ``False``\n@@ -1252,11 +1311,19 @@ templates used by the :class:`ModelAdmin` views:\n                     return qs\n                 return qs.filter(author=request.user)\n \n-.. method:: ModelAdmin.message_user(request, message)\n+.. method:: ModelAdmin.message_user(request, message, level=messages.INFO, extra_tags='', fail_silently=False)\n+\n+    Sends a message to the user using the :mod:`django.contrib.messages`\n+    backend.  See the :ref:`custom ModelAdmin example <custom-admin-action>`.\n+\n+    .. versionadded:: 1.5\n \n-    Sends a message to the user. The default implementation creates a message\n-    using the :mod:`django.contrib.messages` backend. See the\n-    :ref:`custom ModelAdmin example <custom-admin-action>`.\n+    Keyword arguments allow you to change the message level, add extra CSS\n+    tags, or fail silently if the ``contrib.messages`` framework is not\n+    installed. These keyword arguments match those for\n+    :func:`django.contrib.messages.add_message`, see that function's\n+    documentation for more details. One difference is that the level may be\n+    passed as a string label in addition to integer/constant.\n \n .. method:: ModelAdmin.get_paginator(queryset, per_page, orphans=0, allow_empty_first_page=True)\n \n@@ -1326,6 +1393,8 @@ instances which allow you to easily customize the response data before\n rendering. For more details, see the\n :doc:`TemplateResponse documentation </ref/template-response>`.\n \n+.. _modeladmin-media-definitions:\n+\n ``ModelAdmin`` media definitions\n --------------------------------\n \n@@ -1532,6 +1601,10 @@ The ``InlineModelAdmin`` class adds:\n     Specifies whether or not inline objects can be deleted in the inline.\n     Defaults to ``True``.\n \n+.. method:: InlineModelAdmin.get_formset(self, request, obj=None, **kwargs)\n+\n+    Returns a ``BaseInlineFormSet`` class for use in admin add/change views.\n+    See the example for :class:`ModelAdmin.get_formsets`.\n \n Working with a model with two or more foreign keys to the same parent model\n ---------------------------------------------------------------------------"
        },
        {
            "sha": "8275092d2f7b9736a92d908ed96bb427ba9deb9f",
            "filename": "docs/ref/contrib/comments/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -11,12 +11,6 @@ Django includes a simple, yet customizable comments framework. The built-in\n comments framework can be used to attach comments to any model, so you can use\n it for comments on blog entries, photos, book chapters, or anything else.\n \n-.. note::\n-\n-    If you used to use Django's older (undocumented) comments framework, you'll\n-    need to upgrade. See the :doc:`upgrade guide </ref/contrib/comments/upgrade>`\n-    for instructions.\n-\n Quick start guide\n =================\n \n@@ -209,7 +203,7 @@ default version of which is included with Django.\n Rendering a custom comment form\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n-If you want more control over the look and feel of the comment form, you use use\n+If you want more control over the look and feel of the comment form, you may use\n :ttag:`get_comment_form` to get a :doc:`form object </topics/forms/index>` that\n you can use in the template::\n \n@@ -350,7 +344,6 @@ More information\n    models\n    settings\n    signals\n-   upgrade\n    custom\n    forms\n    moderation"
        },
        {
            "sha": "8274539ed73b693b672ee9d7c6fa17db173bfb6b",
            "filename": "docs/ref/contrib/comments/signals.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fcomments%2Fsignals.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fcomments%2Fsignals.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Fsignals.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -20,8 +20,8 @@ Sent just before a comment will be saved, after it's been sanity checked and\n submitted. This can be used to modify the comment (in place) with posting\n details or other such actions.\n \n-If any receiver returns ``False`` the comment will be discarded and a 403 (not\n-allowed) response will be returned.\n+If any receiver returns ``False`` the comment will be discarded and a 400\n+response will be returned.\n \n This signal is sent at more or less the same time (just before, actually) as the\n ``Comment`` object's :data:`~django.db.models.signals.pre_save` signal."
        },
        {
            "sha": "dadb53f5fa638360173ac8fd013455e1f7491eae",
            "filename": "docs/ref/contrib/comments/upgrade.txt",
            "status": "removed",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Fupgrade.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Fupgrade.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Fupgrade.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,78 +0,0 @@\n-===============================================\n-Upgrading from Django's previous comment system\n-===============================================\n-\n-Prior versions of Django included an outdated, undocumented comment system. Users who reverse-engineered this framework will need to upgrade to use the\n-new comment system; this guide explains how.\n-\n-The main changes from the old system are:\n-\n-* This new system is documented.\n-\n-* It uses modern Django features like :doc:`forms </topics/forms/index>` and\n-  :doc:`modelforms </topics/forms/modelforms>`.\n-\n-* It has a single ``Comment`` model instead of separate ``FreeComment`` and\n-  ``Comment`` models.\n-\n-* Comments have \"email\" and \"URL\" fields.\n-\n-* No ratings, photos and karma. This should only effect World Online.\n-\n-* The ``{% comment_form %}`` tag no longer exists. Instead, there's now two\n-  functions: ``{% get_comment_form %}``, which returns a form for posting a\n-  new comment, and ``{% render_comment_form %}``, which renders said form\n-  using the ``comments/form.html`` template.\n-\n-* The way comments are include in your URLconf have changed; you'll need to\n-  replace::\n-\n-        (r'^comments/', include('django.contrib.comments.urls.comments')),\n-\n-  with::\n-\n-        (r'^comments/', include('django.contrib.comments.urls')),\n-\n-Upgrading data\n---------------\n-\n-The data models for Django's comment system have changed, as have the\n-table names. Before you transfer your existing data into the new comments\n-system, make sure that you have installed the new comments system as\n-explained in the\n-:doc:`quick start guide </ref/contrib/comments/index>`.\n-This will ensure that the new tables have been properly created.\n-\n-To transfer your data into the new comments system, you'll need to directly\n-run the following SQL:\n-\n-.. code-block:: sql\n-\n-    BEGIN;\n-\n-    INSERT INTO django_comments \n-        (content_type_id, object_pk, site_id, user_name, user_email, user_url,\n-        comment, submit_date, ip_address, is_public, is_removed)\n-    SELECT\n-        content_type_id, object_id, site_id, person_name, '', '', comment,\n-        submit_date, ip_address, is_public, not approved\n-    FROM comments_freecomment;\n-\n-    INSERT INTO django_comments \n-        (content_type_id, object_pk, site_id, user_id, user_name, user_email,\n-        user_url, comment, submit_date, ip_address, is_public, is_removed)\n-    SELECT \n-        content_type_id, object_id, site_id, user_id, '', '', '', comment,\n-        submit_date, ip_address, is_public, is_removed\n-    FROM comments_comment;\n-\n-    UPDATE django_comments SET user_name = (\n-        SELECT username FROM auth_user \n-        WHERE django_comments.user_id = auth_user.id\n-    ) WHERE django_comments.user_id is not NULL;\n-    UPDATE django_comments SET user_email = (\n-        SELECT email FROM auth_user \n-        WHERE django_comments.user_id = auth_user.id\n-    ) WHERE django_comments.user_id is not NULL;\n-    \n-    COMMIT;"
        },
        {
            "sha": "3edc019d052082b0a358695907dcae54ae309b44",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 30,
            "deletions": 2,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -493,6 +493,21 @@ Advanced ``WizardView`` methods\n             context = self.get_context_data(form=form, **kwargs)\n             return self.render_to_response(context)\n \n+.. method:: WizardView.get_cleaned_data_for_step(step)\n+\n+    This method returns the cleaned data for a given ``step``. Before returning\n+    the cleaned data, the stored values are revalidated through the form. If\n+    the data doesn't validate, ``None`` will be returned.\n+\n+.. method:: WizardView.get_all_cleaned_data()\n+\n+    This method returns a merged dictionary of all form steps' ``cleaned_data``\n+    dictionaries. If a step contains a ``FormSet``, the key will be prefixed\n+    with ``formset-`` and contain a list of the formset's ``cleaned_data``\n+    dictionaries. Note that if two or more steps have a field with the same\n+    name, the value for that field from the latest step will overwrite the\n+    value from any earlier steps.\n+\n Providing initial data for the forms\n ====================================\n \n@@ -534,6 +549,16 @@ This storage will temporarily store the uploaded files for the wizard. The\n :attr:`file_storage` attribute should be a\n :class:`~django.core.files.storage.Storage` subclass.\n \n+Django provides a built-in storage class (see :ref:`the built-in filesystem\n+storage class <builtin-fs-storage>`)::\n+\n+    from django.conf import settings\n+    from django.core.files.storage import FileSystemStorage\n+\n+    class CustomWizardView(WizardView):\n+        ...\n+        file_storage = FileSystemStorage(location=os.path.join(settings.MEDIA_ROOT, 'photos'))\n+\n .. warning::\n \n     Please remember to take care of removing old files as the\n@@ -622,8 +647,11 @@ Usage of ``NamedUrlWizardView``\n \n .. class:: NamedUrlWizardView\n \n-There is a :class:`WizardView` subclass which adds named-urls support to the wizard.\n-By doing this, you can have single urls for every step.\n+There is a :class:`WizardView` subclass which adds named-urls support to the\n+wizard. By doing this, you can have single urls for every step. You can also\n+use the :class:`NamedUrlSessionWizardView` or :class:`NamedUrlCookieWizardView`\n+classes which preselect the backend used for storing information (server-side\n+sessions and browser cookies respectively).\n \n To use the named urls, you have to change the ``urls.py``.\n "
        },
        {
            "sha": "7d7c32781cba07848d990d81ed90add7a54f2984",
            "filename": "docs/ref/contrib/gis/geos.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -656,6 +656,17 @@ is returned instead.\n \n    Returns the number of interior rings in this geometry.\n \n+.. admonition:: Comparing Polygons\n+\n+    Note that it is possible to compare ``Polygon`` objects directly with ``<``\n+    or ``>``, but as the comparison is made through Polygon's\n+    :class:`LineString`, it does not mean much (but is consistent and quick).\n+    You can always force the comparison with the :attr:`~GEOSGeometry.area`\n+    property::\n+\n+        >>> if poly_1.area > poly_2.area:\n+        >>>     pass\n+\n Geometry Collections\n ====================\n "
        },
        {
            "sha": "100dc2edd0065941e0fe7b983818970b1e827a80",
            "filename": "docs/ref/contrib/gis/install/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -118,7 +118,7 @@ Invoke the Django shell from your project and execute the\n \n .. code-block:: pycon\n \n-    $ python manage shell\n+    $ python manage.py shell\n     >>> from django.contrib.gis.utils import add_srs_entry\n     >>> add_srs_entry(900913)\n "
        },
        {
            "sha": "5000622ad477f7c35242e0c1ba21276e2bbabd80",
            "filename": "docs/ref/contrib/gis/tutorial.txt",
            "status": "modified",
            "additions": 136,
            "deletions": 145,
            "changes": 281,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -5,28 +5,28 @@ GeoDjango Tutorial\n Introduction\n ============\n \n-GeoDjango is an add-on for Django that turns it into a world-class geographic\n-Web framework.  GeoDjango strives to make it as simple as possible to create\n-geographic Web applications, like location-based services.  Some features\n-include:\n+GeoDjango is an included contrib module for Django that turns it into a\n+world-class geographic Web framework.  GeoDjango strives to make it as simple\n+as possible to create geographic Web applications, like location-based services.\n+Its features include:\n \n * Django model fields for `OGC`_ geometries.\n-* Extensions to Django's ORM for the querying and manipulation of spatial data.\n+* Extensions to Django's ORM for querying and manipulating spatial data.\n * Loosely-coupled, high-level Python interfaces for GIS geometry operations and\n   data formats.\n-* Editing of geometry fields inside the admin.\n+* Editing geometry fields from the admin.\n \n-This tutorial assumes a familiarity with Django; thus, if you're brand new to\n-Django please read through the :doc:`regular tutorial </intro/tutorial01>` to\n-introduce yourself with basic Django concepts.\n+This tutorial assumes familiarity with Django; thus, if you're brand new to\n+Django, please read through the :doc:`regular tutorial </intro/tutorial01>` to\n+familiarize yourself with Django first.\n \n .. note::\n \n-    GeoDjango has special prerequisites overwhat is required by Django --\n+    GeoDjango has additional requirements beyond what Django requires --\n     please consult the :ref:`installation documentation <ref-gis-install>`\n     for more details.\n \n-This tutorial will guide you through the creation of a geographic Web\n+This tutorial will guide you through the creation of a geographic web\n application for viewing the `world borders`_. [#]_ Some of the code\n used in this tutorial is taken from and/or inspired by the `GeoDjango\n basic apps`_ project. [#]_\n@@ -51,46 +51,45 @@ Create a Spatial Database\n     MySQL and Oracle users can skip this section because spatial types\n     are already built into the database.\n \n-First, a spatial database needs to be created for our project.  If using\n-PostgreSQL and PostGIS, then the following commands will\n-create the database from a :ref:`spatial database template\n-<spatialdb_template>`:\n+First, create a spatial database for your project.\n+\n+If you are using PostGIS, create the database from the :ref:`spatial database\n+template <spatialdb_template>`:\n \n .. code-block:: bash\n \n     $ createdb -T template_postgis geodjango\n \n .. note::\n \n-    This command must be issued by a database user that has permissions to\n-    create a database.  Here is an example set of commands to create such\n-    a user:\n+    This command must be issued by a database user with enough privileges to\n+    create a database.  To create a user with ``CREATE DATABASE`` privileges in\n+    PostgreSQL, use the following commands:\n \n     .. code-block:: bash\n \n         $ sudo su - postgres\n         $ createuser --createdb geo\n         $ exit\n \n-    Replace ``geo`` with the system login user name that will be\n-    connecting to the database.  For example, ``johndoe`` if that is the\n-    system user that will be running GeoDjango.\n+    Replace ``geo`` with your Postgres database user's username.\n+    (In PostgreSQL, this user will also be an OS-level user.)\n \n-Users of SQLite and SpatiaLite should consult the instructions on how\n+If you are using SQLite and SpatiaLite, consult the instructions on how\n to create a :ref:`SpatiaLite database <create_spatialite_db>`.\n \n-Create GeoDjango Project\n+Create a New Project\n ------------------------\n \n-Use the ``django-admin.py`` script like normal to create a ``geodjango``\n-project:\n+Use the standard ``django-admin.py`` script to create a project called\n+``geodjango``:\n \n .. code-block:: bash\n \n     $ django-admin.py startproject geodjango\n \n-With the project initialized, now create a ``world`` Django application within\n-the ``geodjango`` project:\n+This will initialize a new project. Now, create a ``world`` Django application\n+within the ``geodjango`` project:\n \n .. code-block:: bash\n \n@@ -101,7 +100,7 @@ Configure ``settings.py``\n -------------------------\n \n The ``geodjango`` project settings are stored in the ``geodjango/settings.py``\n-file. Edit the database connection settings appropriately::\n+file. Edit the database connection settings to match your setup::\n \n     DATABASES = {\n         'default': {\n@@ -113,7 +112,7 @@ file. Edit the database connection settings appropriately::\n \n In addition, modify the :setting:`INSTALLED_APPS` setting to include\n :mod:`django.contrib.admin`, :mod:`django.contrib.gis`,\n-and ``world`` (our newly created application)::\n+and ``world`` (your newly created application)::\n \n     INSTALLED_APPS = (\n         'django.contrib.auth',\n@@ -135,9 +134,9 @@ Geographic Data\n World Borders\n -------------\n \n-The world borders data is available in this `zip file`__.  Create a data\n+The world borders data is available in this `zip file`__.  Create a ``data``\n directory in the ``world`` application, download the world borders data, and\n-unzip. On GNU/Linux platforms the following commands should do it:\n+unzip. On GNU/Linux platforms, use the following commands:\n \n .. code-block:: bash\n \n@@ -149,7 +148,7 @@ unzip. On GNU/Linux platforms the following commands should do it:\n \n The world borders ZIP file contains a set of data files collectively known as\n an `ESRI Shapefile`__, one of the most popular geospatial data formats.  When\n-unzipped the world borders data set includes files with the following\n+unzipped, the world borders dataset includes files with the following\n extensions:\n \n * ``.shp``: Holds the vector data for the world borders geometries.\n@@ -165,8 +164,8 @@ __ http://en.wikipedia.org/wiki/Shapefile\n Use ``ogrinfo`` to examine spatial data\n ---------------------------------------\n \n-The GDAL ``ogrinfo`` utility is excellent for examining metadata about\n-shapefiles (or other vector data sources):\n+The GDAL ``ogrinfo`` utility allows examining the metadata of shapefiles or\n+other vector data sources:\n \n .. code-block:: bash\n \n@@ -175,9 +174,9 @@ shapefiles (or other vector data sources):\n           using driver `ESRI Shapefile' successful.\n     1: TM_WORLD_BORDERS-0.3 (Polygon)\n \n-Here ``ogrinfo`` is telling us that the shapefile has one layer, and that such\n-layer contains polygon data.  To find out more we'll specify the layer name\n-and use the ``-so`` option to get only important summary information:\n+``ogrinfo`` tells us that the shapefile has one layer, and that this\n+layer contains polygon data.  To find out more, we'll specify the layer name\n+and use the ``-so`` option to get only the important summary information:\n \n .. code-block:: bash\n \n@@ -208,23 +207,20 @@ and use the ``-so`` option to get only important summary information:\n     LAT: Real (7.3)\n \n This detailed summary information tells us the number of features in the layer\n-(246), the geographical extent, the spatial reference system (\"SRS WKT\"),\n-as well as detailed information for each attribute field.  For example,\n-``FIPS: String (2.0)`` indicates that there's a ``FIPS`` character field\n-with a maximum length of 2; similarly, ``LON: Real (8.3)`` is a floating-point\n-field that holds a maximum of 8 digits up to three decimal places.  Although\n-this information may be found right on the `world borders`_ Web site, this\n-shows you how to determine this information yourself when such metadata is not\n-provided.\n+(246), the geographic bounds of the data, the spatial reference system\n+(\"SRS WKT\"), as well as type information for each attribute field. For example,\n+``FIPS: String (2.0)`` indicates that the ``FIPS`` character field has\n+a maximum length of 2.  Similarly, ``LON: Real (8.3)`` is a floating-point\n+field that holds a maximum of 8 digits up to three decimal places.\n \n Geographic Models\n =================\n \n Defining a Geographic Model\n ---------------------------\n \n-Now that we've examined our world borders data set using ``ogrinfo``, we can\n-create a GeoDjango model to represent this data::\n+Now that you've examined your dataset using ``ogrinfo``, create a GeoDjango\n+model to represent this data::\n \n     from django.contrib.gis.db import models\n \n@@ -252,32 +248,30 @@ create a GeoDjango model to represent this data::\n         def __unicode__(self):\n             return self.name\n \n-Two important things to note:\n+Please note two important things:\n \n 1. The ``models`` module is imported from :mod:`django.contrib.gis.db`.\n-2. The model overrides its default manager with\n-   :class:`~django.contrib.gis.db.models.GeoManager`; this is *required*\n-   to perform spatial queries.\n+2. You must override the model's default manager with\n+   :class:`~django.contrib.gis.db.models.GeoManager` to perform spatial queries.\n \n-When declaring a geometry field on your model the default spatial reference\n-system is WGS84 (meaning the `SRID`__ is 4326) -- in other words, the field\n-coordinates are in longitude/latitude pairs in units of degrees.  If you want\n-the coordinate system to be different, then SRID of the geometry field may be\n-customized by setting the ``srid`` with an integer corresponding to the\n-coordinate system of your choice.\n+The default spatial reference system for geometry fields is WGS84 (meaning\n+the `SRID`__ is 4326) -- in other words, the field coordinates are in\n+longitude, latitude pairs in units of degrees.  To use a different\n+coordinate system, set the SRID of the geometry field with the ``srid``\n+argument. Use an integer representing the coordinate system's EPSG code.\n \n __ http://en.wikipedia.org/wiki/SRID\n \n Run ``syncdb``\n --------------\n \n-After you've defined your model, it needs to be synced with the spatial\n-database. First, let's look at the SQL that will generate the table for the\n+After defining your model, you need to sync it with the database. First,\n+let's look at the SQL that will generate the table for the\n ``WorldBorder`` model::\n \n     $ python manage.py sqlall world\n \n-This management command should produce the following output:\n+This command should produce the following output:\n \n .. code-block:: sql\n \n@@ -302,32 +296,28 @@ This management command should produce the following output:\n     CREATE INDEX \"world_worldborder_mpoly_id\" ON \"world_worldborder\" USING GIST ( \"mpoly\" GIST_GEOMETRY_OPS );\n     COMMIT;\n \n-If satisfied, you may then create this table in the database by running the\n-``syncdb`` management command::\n+If this looks correct, run ``syncdb`` to create this table in the database::\n \n     $ python manage.py syncdb\n     Creating table world_worldborder\n     Installing custom SQL for world.WorldBorder model\n \n-The ``syncdb`` command may also prompt you to create an admin user; go ahead\n-and do so (not required now, may be done at any point in the future using the\n-``createsuperuser`` management command).\n+The ``syncdb`` command may also prompt you to create an admin user. Either\n+do so now, or later by running ``django-admin.py createsuperuser``.\n \n Importing Spatial Data\n ======================\n \n-This section will show you how to take the data from the world borders\n-shapefile and import it into GeoDjango models using the\n+This section will show you how to import the world borders\n+shapefile into the database via GeoDjango models using the\n :ref:`ref-layermapping`.\n-There are many different ways to import data in to a spatial database --\n-besides the tools included within GeoDjango, you may also use the following to\n-populate your spatial database:\n+There are many different ways to import data into a spatial database --\n+besides the tools included within GeoDjango, you may also use the following:\n \n-* `ogr2ogr`_: Command-line utility, included with GDAL, that\n-  supports loading a multitude of vector data formats into\n-  the PostGIS, MySQL, and Oracle spatial databases.\n-* `shp2pgsql`_: This utility is included with PostGIS and only supports\n-  ESRI shapefiles.\n+* `ogr2ogr`_: A command-line utility included with GDAL that\n+  can import many vector data formats into PostGIS, MySQL, and Oracle databases.\n+* `shp2pgsql`_: This utility included with PostGIS imports ESRI shapefiles into\n+  PostGIS.\n \n .. _ogr2ogr: http://www.gdal.org/ogr2ogr.html\n .. _shp2pgsql: http://postgis.refractions.net/documentation/manual-1.5/ch04.html#shp2pgsql_usage\n@@ -337,27 +327,26 @@ populate your spatial database:\n GDAL Interface\n --------------\n \n-Earlier we used the ``ogrinfo`` to explore the contents of the world borders\n-shapefile.  Included within GeoDjango is an interface to GDAL's powerful OGR\n-library -- in other words, you'll be able explore all the vector data sources\n-that OGR supports via a Pythonic API.\n+Earlier, you used ``ogrinfo`` to examine the contents of the world borders\n+shapefile.  GeoDjango also includes a Pythonic interface to GDAL's powerful OGR\n+library that can work with all the vector data sources that OGR supports.\n \n First, invoke the Django shell:\n \n .. code-block:: bash\n \n     $ python manage.py shell\n \n-If the :ref:`worldborders` data was downloaded like earlier in the\n-tutorial, then we can determine the path using Python's built-in\n+If you downloaded the :ref:`worldborders` data earlier in the\n+tutorial, then you can determine its path using Python's built-in\n ``os`` module::\n \n     >>> import os\n     >>> import world\n     >>> world_shp = os.path.abspath(os.path.join(os.path.dirname(world.__file__),\n     ...                             'data/TM_WORLD_BORDERS-0.3.shp'))\n \n-Now, the world borders shapefile may be opened using GeoDjango's\n+Now, open the world borders shapefile using GeoDjango's\n :class:`~django.contrib.gis.gdal.DataSource` interface::\n \n     >>> from django.contrib.gis.gdal import DataSource\n@@ -374,8 +363,7 @@ shapefiles are only allowed to have one layer::\n     >>> print(lyr)\n     TM_WORLD_BORDERS-0.3\n \n-You can see what the geometry type of the layer is and how many features it\n-contains::\n+You can see the layer's geometry type and how many features it contains::\n \n     >>> print(lyr.geom_type)\n     Polygon\n@@ -384,16 +372,16 @@ contains::\n \n .. note::\n \n-    Unfortunately the shapefile data format does not allow for greater\n+    Unfortunately, the shapefile data format does not allow for greater\n     specificity with regards to geometry types.  This shapefile, like\n-    many others, actually includes ``MultiPolygon`` geometries in its\n-    features.  You need to watch out for this when creating your models\n-    as a GeoDjango ``PolygonField`` will not accept a ``MultiPolygon``\n-    type geometry -- thus a ``MultiPolygonField`` is used in our model's\n-    definition instead.\n+    many others, actually includes ``MultiPolygon`` geometries, not Polygons.\n+    It's important to use a more general field type in models: a\n+    GeoDjango ``MultiPolygonField`` will accept a ``Polygon`` geometry, but a\n+    ``PolygonField`` will not accept a ``MultiPolygon`` type geometry.  This\n+    is why the ``WorldBorder`` model defined above uses a ``MultiPolygonField``.\n \n The :class:`~django.contrib.gis.gdal.Layer` may also have a spatial reference\n-system associated with it -- if it does, the ``srs`` attribute will return a\n+system associated with it.  If it does, the ``srs`` attribute will return a\n :class:`~django.contrib.gis.gdal.SpatialReference` object::\n \n     >>> srs = lyr.srs\n@@ -406,18 +394,18 @@ system associated with it -- if it does, the ``srs`` attribute will return a\n     >>> srs.proj4 # PROJ.4 representation\n     '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs '\n \n-Here we've noticed that the shapefile is in the popular WGS84 spatial reference\n-system -- in other words, the data uses units of degrees longitude and\n-latitude.\n+This shapefile is in the popular WGS84 spatial reference\n+system -- in other words, the data uses longitude, latitude pairs in\n+units of degrees.\n \n In addition, shapefiles also support attribute fields that may contain\n additional data.  Here are the fields on the World Borders layer:\n \n     >>> print(lyr.fields)\n     ['FIPS', 'ISO2', 'ISO3', 'UN', 'NAME', 'AREA', 'POP2005', 'REGION', 'SUBREGION', 'LON', 'LAT']\n \n-Here we are examining the OGR types (e.g., whether a field is an integer or\n-a string) associated with each of the fields:\n+The following code will let you examine the OGR types (e.g. integer or\n+string) associated with each of the fields:\n \n     >>> [fld.__name__ for fld in lyr.field_types]\n     ['OFTString', 'OFTString', 'OFTString', 'OFTInteger', 'OFTString', 'OFTInteger', 'OFTInteger', 'OFTInteger', 'OFTInteger', 'OFTReal', 'OFTReal']\n@@ -446,8 +434,7 @@ And individual features may be retrieved by their feature ID::\n     >>> print(feat.get('NAME'))\n     San Marino\n \n-Here the boundary geometry for San Marino is extracted and looking\n-exported to WKT and GeoJSON::\n+Boundary geometries may be exported as WKT and GeoJSON::\n \n     >>> geom = feat.geom\n     >>> print(geom.wkt)\n@@ -459,8 +446,9 @@ exported to WKT and GeoJSON::\n ``LayerMapping``\n ----------------\n \n-We're going to dive right in -- create a file called ``load.py`` inside the\n-``world`` application, and insert the following::\n+To import the data, use a LayerMapping in a Python script.\n+Create a file called ``load.py`` inside the ``world`` application,\n+with the following code::\n \n     import os\n     from django.contrib.gis.utils import LayerMapping\n@@ -492,29 +480,29 @@ We're going to dive right in -- create a file called ``load.py`` inside the\n A few notes about what's going on:\n \n * Each key in the ``world_mapping`` dictionary corresponds to a field in the\n-  ``WorldBorder`` model, and the value is the name of the shapefile field\n+  ``WorldBorder`` model.  The value is the name of the shapefile field\n   that data will be loaded from.\n * The key ``mpoly`` for the geometry field is ``MULTIPOLYGON``, the\n-  geometry type we wish to import as.  Even if simple polygons are encountered\n-  in the shapefile they will automatically be converted into collections prior\n-  to insertion into the database.\n+  geometry type GeoDjango will import the field as.  Even simple polygons in\n+  the shapefile will automatically be converted into collections prior to\n+  insertion into the database.\n * The path to the shapefile is not absolute -- in other words, if you move the\n   ``world`` application (with ``data`` subdirectory) to a different location,\n-  then the script will still work.\n+  the script will still work.\n * The ``transform`` keyword is set to ``False`` because the data in the\n   shapefile does not need to be converted -- it's already in WGS84 (SRID=4326).\n-* The ``encoding`` keyword is set to the character encoding of string values in\n-  the shapefile. This ensures that string values are read and saved correctly\n-  from their original encoding system.\n+* The ``encoding`` keyword is set to the character encoding of the string\n+  values in the shapefile. This ensures that string values are read and saved\n+  correctly from their original encoding system.\n \n Afterwards, invoke the Django shell from the ``geodjango`` project directory:\n \n .. code-block:: bash\n \n    $ python manage.py shell\n \n-Next, import the ``load`` module, call the ``run`` routine, and watch ``LayerMapping``\n-do the work::\n+Next, import the ``load`` module, call the ``run`` routine, and watch\n+``LayerMapping`` do the work::\n \n    >>> from world import load\n    >>> load.run()\n@@ -536,7 +524,7 @@ The general usage of the command goes as follows:\n \n     $ python manage.py ogrinspect [options] <data_source> <model_name> [options]\n \n-Where ``data_source`` is the path to the GDAL-supported data source and\n+``data_source`` is the path to the GDAL-supported data source and\n ``model_name`` is the name to use for the model.  Command-line options may\n be used to further define how the model is generated.\n \n@@ -600,9 +588,9 @@ Spatial Queries\n \n Spatial Lookups\n ---------------\n-GeoDjango extends the Django ORM and allows the use of spatial lookups.\n-Let's do an example where we find the ``WorldBorder`` model that contains\n-a point.  First, fire up the management shell:\n+GeoDjango adds spatial lookups to the Django ORM.  For example, you\n+can find the country in the ``WorldBorder`` table that contains\n+a particular point.  First, fire up the management shell:\n \n .. code-block:: bash\n \n@@ -613,8 +601,8 @@ Now, define a point of interest [#]_::\n     >>> pnt_wkt = 'POINT(-95.3385 29.7245)'\n \n The ``pnt_wkt`` string represents the point at -95.3385 degrees longitude,\n-and 29.7245 degrees latitude.  The geometry is in a format known as\n-Well Known Text (WKT), an open standard issued by the Open Geospatial\n+29.7245 degrees latitude.  The geometry is in a format known as\n+Well Known Text (WKT), a standard issued by the Open Geospatial\n Consortium (OGC). [#]_  Import the ``WorldBorder`` model, and perform\n a ``contains`` lookup using the ``pnt_wkt`` as the parameter::\n \n@@ -623,28 +611,30 @@ a ``contains`` lookup using the ``pnt_wkt`` as the parameter::\n     >>> qs\n     [<WorldBorder: United States>]\n \n-Here we retrieved a ``GeoQuerySet`` that has only one model: the one\n-for the United States (which is what we would expect).  Similarly,\n-a :ref:`GEOS geometry object <ref-geos>` may also be used -- here the\n-``intersects`` spatial lookup is combined with the ``get`` method to retrieve\n-only the ``WorldBorder`` instance for San Marino instead of a queryset::\n+Here, you retrieved a ``GeoQuerySet`` with only one model: the border of\n+the United States (exactly what you would expect).\n+\n+Similarly, you may also use a :ref:`GEOS geometry object <ref-geos>`.\n+Here, you can combine the ``intersects`` spatial lookup with the ``get``\n+method to retrieve only the ``WorldBorder`` instance for San Marino instead\n+of a queryset::\n \n     >>> from django.contrib.gis.geos import Point\n     >>> pnt = Point(12.4604, 43.9420)\n     >>> sm = WorldBorder.objects.get(mpoly__intersects=pnt)\n     >>> sm\n     <WorldBorder: San Marino>\n \n-The ``contains`` and ``intersects`` lookups are just a subset of what's\n-available -- the :ref:`ref-gis-db-api` documentation has more.\n+The ``contains`` and ``intersects`` lookups are just a subset of the\n+available queries -- the :ref:`ref-gis-db-api` documentation has more.\n \n Automatic Spatial Transformations\n ---------------------------------\n-When querying the spatial database GeoDjango automatically transforms\n+When doing spatial queries, GeoDjango automatically transforms\n geometries if they're in a different coordinate system.  In the following\n-example, the coordinate will be expressed in terms of `EPSG SRID 32140`__,\n+example, coordinates will be expressed in `EPSG SRID 32140`__,\n a coordinate system specific to south Texas **only** and in units of\n-**meters** and not degrees::\n+**meters**, not degrees::\n \n     >>> from django.contrib.gis.geos import Point, GEOSGeometry\n     >>> pnt = Point(954158.1, 4215137.1, srid=32140)\n@@ -654,7 +644,7 @@ WKT that includes the SRID::\n \n     >>> pnt = GEOSGeometry('SRID=32140;POINT(954158.1 4215137.1)')\n \n-When using GeoDjango's ORM, it will automatically wrap geometry values\n+GeoDjango's ORM will automatically wrap geometry values\n in transformation SQL, allowing the developer to work at a higher level\n of abstraction::\n \n@@ -675,7 +665,7 @@ __ http://spatialreference.org/ref/epsg/32140/\n \n     When using :doc:`raw queries </topics/db/sql>`, you should generally wrap\n     your geometry fields with the ``asText()`` SQL function (or ``ST_AsText``\n-    for PostGIS) so as the field value will be recognized by GEOS::\n+    for PostGIS) so that the field value will be recognized by GEOS::\n \n         City.objects.raw('SELECT id, name, asText(point) from myapp_city')\n \n@@ -684,8 +674,8 @@ __ http://spatialreference.org/ref/epsg/32140/\n \n Lazy Geometries\n ---------------\n-Geometries come to GeoDjango in a standardized textual representation.  Upon\n-access of the geometry field, GeoDjango creates a `GEOS geometry object\n+GeoDjango loads geometries in a standardized textual representation.  When the\n+geometry field is first accessed, GeoDjango creates a `GEOS geometry object\n <ref-geos>`, exposing powerful functionality, such as serialization properties\n for popular geospatial formats::\n \n@@ -715,31 +705,27 @@ the GEOS library::\n Putting your data on the map\n ============================\n \n-Google\n-------\n-\n Geographic Admin\n ----------------\n \n GeoDjango extends :doc:`Django's admin application </ref/contrib/admin/index>`\n-to enable support for editing geometry fields.\n+with support for editing geometry fields.\n \n Basics\n ^^^^^^\n \n GeoDjango also supplements the Django admin by allowing users to create\n and modify geometries on a JavaScript slippy map (powered by `OpenLayers`_).\n \n-Let's dive in again -- create a file called ``admin.py`` inside the\n-``world`` application, and insert the following::\n+Let's dive right in.  Create a file called ``admin.py`` inside the\n+``world`` application with the following code::\n \n     from django.contrib.gis import admin\n     from models import WorldBorder\n \n     admin.site.register(WorldBorder, admin.GeoModelAdmin)\n \n-Next, edit your ``urls.py`` in the ``geodjango`` application folder to look\n-as follows::\n+Next, edit your ``urls.py`` in the ``geodjango`` application folder as follows::\n \n     from django.conf.urls import patterns, url, include\n     from django.contrib.gis import admin\n@@ -775,24 +761,29 @@ With the :class:`~django.contrib.gis.admin.OSMGeoAdmin`, GeoDjango uses\n a `Open Street Map`_ layer in the admin.\n This provides more context (including street and thoroughfare details) than\n available with the :class:`~django.contrib.gis.admin.GeoModelAdmin`\n-(which uses the `Vector Map Level 0`_ WMS data set hosted at `OSGeo`_).\n+(which uses the `Vector Map Level 0`_ WMS dataset hosted at `OSGeo`_).\n \n-First, there are some important requirements and limitations:\n+First, there are some important requirements:\n \n * :class:`~django.contrib.gis.admin.OSMGeoAdmin` requires that the\n   :ref:`spherical mercator projection be added <addgoogleprojection>`\n   to the ``spatial_ref_sys`` table (PostGIS 1.3 and below, only).\n * The PROJ.4 datum shifting files must be installed (see the\n   :ref:`PROJ.4 installation instructions <proj4>` for more details).\n \n-If you meet these requirements, then just substitute in the ``OSMGeoAdmin``\n+If you meet these requirements, then just substitute the ``OSMGeoAdmin``\n option class in your ``admin.py`` file::\n \n     admin.site.register(WorldBorder, admin.OSMGeoAdmin)\n \n .. rubric:: Footnotes\n \n-.. [#] Special thanks to Bjørn Sandvik of `thematicmapping.org <http://thematicmapping.org>`_ for providing and maintaining this data set.\n-.. [#] GeoDjango basic apps was written by Dane Springmeyer, Josh Livni, and Christopher Schmidt.\n-.. [#] Here the point is for the `University of Houston Law Center <http://www.law.uh.edu/>`_.\n-.. [#] Open Geospatial Consortium, Inc., `OpenGIS Simple Feature Specification For SQL <http://www.opengeospatial.org/standards/sfs>`_.\n+.. [#] Special thanks to Bjørn Sandvik of `thematicmapping.org\n+       <http://thematicmapping.org>`_ for providing and maintaining this\n+       dataset.\n+.. [#] GeoDjango basic apps was written by Dane Springmeyer, Josh Livni, and\n+       Christopher Schmidt.\n+.. [#] This point is the `University of Houston Law Center\n+       <http://www.law.uh.edu/>`_.\n+.. [#] Open Geospatial Consortium, Inc., `OpenGIS Simple Feature Specification\n+       For SQL <http://www.opengeospatial.org/standards/sfs>`_."
        },
        {
            "sha": "4fa733edb562a24205edf6ee28c266916b33f87b",
            "filename": "docs/ref/contrib/messages.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fmessages.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fmessages.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fmessages.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -341,7 +341,7 @@ This sets the minimum message that will be saved in the message storage. See\n MESSAGE_STORAGE\n ---------------\n \n-Default: ``'django.contrib.messages.storage.user_messages.FallbackStorage'``\n+Default: ``'django.contrib.messages.storage.fallback.FallbackStorage'``\n \n Controls where Django stores message data. Valid values are:\n "
        },
        {
            "sha": "7e5448b3d3e8758b346e4096560452c383a61d1f",
            "filename": "docs/ref/contrib/sites.txt",
            "status": "modified",
            "additions": 22,
            "deletions": 7,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fsites.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fsites.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsites.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -127,8 +127,10 @@ For example::\n     def my_view(request):\n         if settings.SITE_ID == 3:\n             # Do something.\n+            pass\n         else:\n             # Do something else.\n+            pass\n \n Of course, it's ugly to hard-code the site IDs like that. This sort of\n hard-coding is best for hackish fixes that you need done quickly. The\n@@ -141,11 +143,13 @@ domain::\n         current_site = get_current_site(request)\n         if current_site.domain == 'foo.com':\n             # Do something\n+            pass\n         else:\n             # Do something else.\n+            pass\n \n-This has also the advantage of checking if the sites framework is installed, and\n-return a :class:`RequestSite` instance if it is not.\n+This has also the advantage of checking if the sites framework is installed,\n+and return a :class:`RequestSite` instance if it is not.\n \n If you don't have access to the request object, you can use the\n ``get_current()`` method of the :class:`~django.contrib.sites.models.Site`\n@@ -158,8 +162,10 @@ the :setting:`SITE_ID` setting. This example is equivalent to the previous one::\n         current_site = Site.objects.get_current()\n         if current_site.domain == 'foo.com':\n             # Do something\n+            pass\n         else:\n             # Do something else.\n+            pass\n \n Getting the current domain for display\n --------------------------------------\n@@ -200,8 +206,8 @@ subscribing to LJWorld.com alerts.\" Same goes for the email's message body.\n \n Note that an even more flexible (but more heavyweight) way of doing this would\n be to use Django's template system. Assuming Lawrence.com and LJWorld.com have\n-different template directories (:setting:`TEMPLATE_DIRS`), you could simply farm out\n-to the template system like so::\n+different template directories (:setting:`TEMPLATE_DIRS`), you could simply\n+farm out to the template system like so::\n \n     from django.core.mail import send_mail\n     from django.template import loader, Context\n@@ -216,9 +222,9 @@ to the template system like so::\n \n         # ...\n \n-In this case, you'd have to create :file:`subject.txt` and :file:`message.txt` template\n-files for both the LJWorld.com and Lawrence.com template directories. That\n-gives you more flexibility, but it's also more complex.\n+In this case, you'd have to create :file:`subject.txt` and :file:`message.txt`\n+template files for both the LJWorld.com and Lawrence.com template directories.\n+That gives you more flexibility, but it's also more complex.\n \n It's a good idea to exploit the :class:`~django.contrib.sites.models.Site`\n objects as much as possible, to remove unneeded complexity and redundancy.\n@@ -240,6 +246,15 @@ To do this, you can use the sites framework. A simple example::\n     >>> 'http://%s%s' % (Site.objects.get_current().domain, obj.get_absolute_url())\n     'http://example.com/mymodel/objects/3/'\n \n+\n+Default site and ``syncdb``\n+===========================\n+\n+``django.contrib.sites`` registers a\n+:data:`~django.db.models.signals.post_syncdb` signal handler which creates a\n+default site named ``example.com`` with the domain ``example.com``. For\n+example, this site will be created after Django creates the test database.\n+\n Caching the current ``Site`` object\n ===================================\n "
        },
        {
            "sha": "2418dba8efb6fd8248b37d91cea8872ae4053eb0",
            "filename": "docs/ref/contrib/syndication.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsyndication.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -53,6 +53,7 @@ This simple example, taken from `chicagocrime.org`_, describes a feed of the\n latest five news items::\n \n     from django.contrib.syndication.views import Feed\n+    from django.core.urlresolvers import reverse\n     from chicagocrime.models import NewsItem\n \n     class LatestEntriesFeed(Feed):\n@@ -69,6 +70,10 @@ latest five news items::\n         def item_description(self, item):\n             return item.description\n \n+        # item_link is only needed if NewsItem has no get_absolute_url method.\n+        def item_link(self, item):\n+            return reverse('news-item', args=[item.pk])\n+\n To connect a URL to this feed, put an instance of the Feed object in\n your :doc:`URLconf </topics/http/urls>`. For example::\n "
        },
        {
            "sha": "352c0f4584476e453698784d995c218a869ed951",
            "filename": "docs/ref/databases.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fdatabases.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fdatabases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdatabases.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -33,6 +33,11 @@ aggregate with a database backend that falls within the affected release range.\n .. _known to be faulty: http://archives.postgresql.org/pgsql-bugs/2007-07/msg00046.php\n .. _Release 8.2.5: http://www.postgresql.org/docs/devel/static/release-8-2-5.html\n \n+PostgreSQL connection settings\n+-------------------------------\n+\n+See :setting:`HOST` for details.\n+\n Optimizing PostgreSQL's configuration\n -------------------------------------\n "
        },
        {
            "sha": "306db8439eb392b71e52c744d758fb7ebdc3ab51",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 39,
            "deletions": 3,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -96,6 +96,9 @@ cleanup\n Can be run as a cronjob or directly to clean out old data from the database\n (only expired sessions at the moment).\n \n+.. versionchanged:: 1.5\n+    :djadmin:`cleanup` is deprecated. Use :djadmin:`clearsessions` instead.\n+\n compilemessages\n ---------------\n \n@@ -876,14 +879,19 @@ either the path to a directory with the app template file, or a path to a\n compressed file (``.tar.gz``, ``.tar.bz2``, ``.tgz``, ``.tbz``, ``.zip``)\n containing the app template files.\n \n+For example, this would look for an app template in the given directory when\n+creating the ``myapp`` app::\n+\n+    django-admin.py startapp --template=/Users/jezdez/Code/my_app_template myapp\n+\n Django will also accept URLs (``http``, ``https``, ``ftp``) to compressed\n archives with the app template files, downloading and extracting them on the\n fly.\n \n-For example, this would look for an app template in the given directory when\n-creating the ``myapp`` app::\n+For example, taking advantage of Github's feature to expose repositories as\n+zip files, you can use a URL like::\n \n-    django-admin.py startapp --template=/Users/jezdez/Code/my_app_template myapp\n+    django-admin.py startapp --template=https://github.com/githubuser/django-app-template/archive/master.zip myapp\n \n .. versionadded:: 1.4\n \n@@ -951,6 +959,15 @@ when creating the ``myproject`` project::\n \n     django-admin.py startproject --template=/Users/jezdez/Code/my_project_template myproject\n \n+Django will also accept URLs (``http``, ``https``, ``ftp``) to compressed\n+archives with the project template files, downloading and extracting them on the\n+fly.\n+\n+For example, taking advantage of Github's feature to expose repositories as\n+zip files, you can use a URL like::\n+\n+    django-admin.py startproject --template=https://github.com/githubuser/django-project-template/archive/master.zip myproject\n+\n When Django copies the project template files, it also renders certain files\n through the template engine: the files whose extensions match the\n ``--extension`` option (``py`` by default) and the files whose names are passed\n@@ -1187,6 +1204,16 @@ This command is only available if :doc:`GeoDjango </ref/contrib/gis/index>`\n Please refer to its :djadmin:`description <ogrinspect>` in the GeoDjango\n documentation.\n \n+``django.contrib.sessions``\n+---------------------------\n+\n+clearsessions\n+~~~~~~~~~~~~~~~\n+\n+.. django-admin:: clearsessions\n+\n+Can be run as a cron job or directly to clean out expired sessions.\n+\n ``django.contrib.sitemaps``\n ---------------------------\n \n@@ -1456,3 +1483,12 @@ Examples::\n       from django.core import management\n       management.call_command('flush', verbosity=0, interactive=False)\n       management.call_command('loaddata', 'test_data', verbosity=0)\n+\n+Output redirection\n+==================\n+\n+Note that you can redirect standard output and error streams as all commands\n+support the ``stdout`` and ``stderr`` options. For example, you could write::\n+\n+    with open('/tmp/command_output') as f:\n+        management.call_command('dumpdata', stdout=f)"
        },
        {
            "sha": "75d05c6829115b035f41beac450c96f9a792cdd6",
            "filename": "docs/ref/forms/fields.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fforms%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fforms%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Ffields.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -683,7 +683,7 @@ For each field, we describe the default widget used if you don't specify\n \n     .. attribute:: unpack_ipv4\n \n-        Unpacks IPv4 mapped addresses like ``::ffff::192.0.2.1``.\n+        Unpacks IPv4 mapped addresses like ``::ffff:192.0.2.1``.\n         If this option is enabled that address would be unpacked to\n         ``192.0.2.1``. Default is disabled. Can only be used\n         when ``protocol`` is set to ``'both'``."
        },
        {
            "sha": "a0ef0731add55f0844af3d6a47c2c091e056d1ef",
            "filename": "docs/ref/forms/widgets.txt",
            "status": "modified",
            "additions": 129,
            "deletions": 63,
            "changes": 192,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fforms%2Fwidgets.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fforms%2Fwidgets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fwidgets.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -214,38 +214,49 @@ foundation for custom widgets.\n         The 'value' given is not guaranteed to be valid input, therefore\n         subclass implementations should program defensively.\n \n+    .. method:: value_from_datadict(self, data, files, name)\n+\n+        Given a dictionary of data and this widget's name, returns the value\n+        of this widget. Returns ``None`` if a value wasn't provided.\n+\n .. class:: MultiWidget(widgets, attrs=None)\n \n     A widget that is composed of multiple widgets.\n     :class:`~django.forms.widgets.MultiWidget` works hand in hand with the\n     :class:`~django.forms.MultiValueField`.\n \n-    .. method:: render(name, value, attrs=None)\n+    :class:`MultiWidget` has one required argument:\n \n-        Argument `value` is handled differently in this method from the\n-        subclasses of :class:`~Widget`.\n+    .. attribute:: MultiWidget.widgets\n \n-        If `value` is a list, output of :meth:`~MultiWidget.render` will be a\n-        concatenation of rendered child widgets. If `value` is not a list, it\n-        will be first processed by the method :meth:`~MultiWidget.decompress()`\n-        to create the list and then processed as above.\n+        An iterable containing the widgets needed.\n \n-        Unlike in the single value widgets, method :meth:`~MultiWidget.render`\n-        need not be implemented in the subclasses.\n+    And one required method:\n \n     .. method:: decompress(value)\n \n-        Returns a list of \"decompressed\" values for the given value of the\n-        multi-value field that makes use of the widget. The input value can be\n-        assumed as valid, but not necessarily non-empty.\n+        This method takes a single \"compressed\" value from the field and\n+        returns a list of \"decompressed\" values. The input value can be\n+        assumed valid, but not necessarily non-empty.\n \n         This method **must be implemented** by the subclass, and since the\n         value may be empty, the implementation must be defensive.\n \n         The rationale behind \"decompression\" is that it is necessary to \"split\"\n-        the combined value of the form field into the values of the individual\n-        field encapsulated within the multi-value field (e.g. when displaying\n-        the partially or fully filled-out form).\n+        the combined value of the form field into the values for each widget.\n+\n+        An example of this is how :class:`SplitDateTimeWidget` turns a\n+        :class:`datetime` value into a list with date and time split into two\n+        separate values::\n+\n+            class SplitDateTimeWidget(MultiWidget):\n+\n+                # ...\n+\n+                def decompress(self, value):\n+                    if value:\n+                        return [value.date(), value.time().replace(microsecond=0)]\n+                    return [None, None]\n \n         .. tip::\n \n@@ -254,6 +265,109 @@ foundation for custom widgets.\n             with the opposite responsibility - to combine cleaned values of\n             all member fields into one.\n \n+    Other methods that may be useful to override include:\n+\n+    .. method:: render(name, value, attrs=None)\n+\n+        Argument ``value`` is handled differently in this method from the\n+        subclasses of :class:`~Widget` because it has to figure out how to\n+        split a single value for display in multiple widgets.\n+\n+        The ``value`` argument used when rendering can be one of two things:\n+\n+        * A ``list``.\n+        * A single value (e.g., a string) that is the \"compressed\" representation\n+          of a ``list`` of values.\n+\n+        If `value` is a list, output of :meth:`~MultiWidget.render` will be a\n+        concatenation of rendered child widgets. If `value` is not a list, it\n+        will be first processed by the method :meth:`~MultiWidget.decompress()`\n+        to create the list and then processed as above.\n+\n+        In the second case -- i.e., if the value is *not* a list --\n+        ``render()`` will first decompress the value into a ``list`` before\n+        rendering it. It does so by calling the ``decompress()`` method, which\n+        :class:`MultiWidget`'s subclasses must implement (see above).\n+\n+        When ``render()`` executes its HTML rendering, each value in the list\n+        is rendered with the corresponding widget -- the first value is\n+        rendered in the first widget, the second value is rendered in the\n+        second widget, etc.\n+\n+        Unlike in the single value widgets, method :meth:`~MultiWidget.render`\n+        need not be implemented in the subclasses.\n+\n+    .. method:: format_output(rendered_widgets)\n+\n+        Given a list of rendered widgets (as strings), returns a Unicode string\n+        representing the HTML for the whole lot.\n+\n+        This hook allows you to format the HTML design of the widgets any way\n+        you'd like.\n+\n+    Here's an example widget which subclasses :class:`MultiWidget` to display\n+    a date with the day, month, and year in different select boxes. This widget\n+    is intended to be used with a :class:`~django.forms.DateField` rather than\n+    a :class:`~django.forms.MultiValueField`, thus we have implemented\n+    :meth:`~Widget.value_from_datadict`::\n+\n+        from datetime import date\n+        from django.forms import widgets\n+\n+        class DateSelectorWidget(widgets.MultiWidget):\n+            def __init__(self, attrs=None):\n+                # create choices for days, months, years\n+                # example below, the rest snipped for brevity.\n+                years = [(year, year) for year in (2011, 2012, 2013)]\n+                _widgets = (\n+                    widgets.Select(attrs=attrs, choices=days),\n+                    widgets.Select(attrs=attrs, choices=months),\n+                    widgets.Select(attrs=attrs, choices=years),\n+                )\n+                super(DateSelectorWidget, self).__init__(_widgets, attrs)\n+\n+            def decompress(self, value):\n+                if value:\n+                    return [value.day, value.month, value.year]\n+                return [None, None, None]\n+\n+            def format_output(self, rendered_widgets):\n+                return u''.join(rendered_widgets)\n+\n+            def value_from_datadict(self, data, files, name):\n+                datelist = [\n+                    widget.value_from_datadict(data, files, name + '_%s' % i)\n+                    for i, widget in enumerate(self.widgets)]\n+                try:\n+                    D = date(day=int(datelist[0]), month=int(datelist[1]),\n+                            year=int(datelist[2]))\n+                except ValueError:\n+                    return ''\n+                else:\n+                    return str(D)\n+\n+    The constructor creates several :class:`Select` widgets in a tuple. The\n+    ``super`` class uses this tuple to setup the widget.\n+\n+    The :meth:`~MultiWidget.format_output` method is fairly vanilla here (in\n+    fact, it's the same as what's been implemented as the default for\n+    ``MultiWidget``), but the idea is that you could add custom HTML between\n+    the widgets should you wish.\n+\n+    The required method :meth:`~MultiWidget.decompress` breaks up a\n+    ``datetime.date`` value into the day, month, and year values corresponding\n+    to each widget. Note how the method handles the case where ``value`` is\n+    ``None``.\n+\n+    The default implementation of :meth:`~Widget.value_from_datadict` returns\n+    a list of values corresponding to each ``Widget``.  This is appropriate\n+    when using a ``MultiWidget`` with a :class:`~django.forms.MultiValueField`,\n+    but since we want to use this widget with a :class:`~django.forms.DateField`\n+    which takes a single value, we have overridden this method to combine the\n+    data of all the subwidgets into a ``datetime.date``. The method extracts\n+    data from the ``POST`` dictionary and constructs and validates the date.\n+    If it is valid, we return the string, otherwise, we return an empty string\n+    which will cause ``form.is_valid`` to return ``False``.\n \n .. _built-in widgets:\n \n@@ -552,54 +666,6 @@ Composite widgets\n         :attr:`~Field.choices` attribute. If it does, it will override anything\n         you set here when the attribute is updated on the :class:`Field`.\n \n-``MultiWidget``\n-~~~~~~~~~~~~~~~\n-\n-.. class:: MultiWidget\n-\n-    Wrapper around multiple other widgets. You'll probably want to use this\n-    class with :class:`MultiValueField`.\n-\n-    Its ``render()`` method is different than other widgets', because it has to\n-    figure out how to split a single value for display in multiple widgets.\n-\n-    Subclasses may implement ``format_output``, which takes the list of\n-    rendered widgets and returns a string of HTML that formats them any way\n-    you'd like.\n-\n-    The ``value`` argument used when rendering can be one of two things:\n-\n-    * A ``list``.\n-    * A single value (e.g., a string) that is the \"compressed\" representation\n-      of a ``list`` of values.\n-\n-    In the second case -- i.e., if the value is *not* a list -- ``render()``\n-    will first decompress the value into a ``list`` before rendering it. It\n-    does so by calling the ``decompress()`` method, which\n-    :class:`MultiWidget`'s subclasses must implement. This method takes a\n-    single \"compressed\" value and returns a ``list``. An example of this is how\n-    :class:`SplitDateTimeWidget` turns a :class:`datetime` value into a list\n-    with date and time split into two seperate values::\n-\n-        class SplitDateTimeWidget(MultiWidget):\n-\n-            # ...\n-\n-            def decompress(self, value):\n-                if value:\n-                    return [value.date(), value.time().replace(microsecond=0)]\n-                return [None, None]\n-\n-    When ``render()`` executes its HTML rendering, each value in the list is\n-    rendered with the corresponding widget -- the first value is rendered in\n-    the first widget, the second value is rendered in the second widget, etc.\n-\n-    :class:`MultiWidget` has one required argument:\n-\n-    .. attribute:: MultiWidget.widgets\n-\n-        An iterable containing the widgets needed.\n-\n ``SplitDateTimeWidget``\n ~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "cd1185585c1c3d1fec85a372a54a7af44d09d708",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -825,7 +825,7 @@ are converted to lowercase.\n \n .. attribute:: GenericIPAddressField.unpack_ipv4\n \n-    Unpacks IPv4 mapped addresses like ``::ffff::192.0.2.1``.\n+    Unpacks IPv4 mapped addresses like ``::ffff:192.0.2.1``.\n     If this option is enabled that address would be unpacked to\n     ``192.0.2.1``. Default is disabled. Can only be used\n     when ``protocol`` is set to ``'both'``.\n@@ -922,6 +922,11 @@ Like all :class:`CharField` subclasses, :class:`URLField` takes the optional\n :attr:`~CharField.max_length`argument. If you don't specify\n :attr:`~CharField.max_length`, a default of 200 is used.\n \n+.. versionadded:: 1.5\n+\n+The current value of the field will be displayed as a clickable link above the\n+input widget.\n+\n \n Relationship fields\n ==================="
        },
        {
            "sha": "6315985ba9db93b25ee761a249dbca061e738130",
            "filename": "docs/ref/models/instances.txt",
            "status": "modified",
            "additions": 51,
            "deletions": 36,
            "changes": 87,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Finstances.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Finstances.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Finstances.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -67,9 +67,9 @@ Validating objects\n \n There are three steps involved in validating a model:\n \n-1. Validate the model fields\n-2. Validate the model as a whole\n-3. Validate the field uniqueness\n+1. Validate the model fields - :meth:`Model.clean_fields()`\n+2. Validate the model as a whole - :meth:`Model.clean()`\n+3. Validate the field uniqueness - :meth:`Model.validate_unique()`\n \n All three steps are performed when you call a model's\n :meth:`~Model.full_clean()` method.\n@@ -97,17 +97,20 @@ not be corrected by the user.\n \n Note that ``full_clean()`` will *not* be called automatically when you call\n your model's :meth:`~Model.save()` method, nor as a result of\n-:class:`~django.forms.ModelForm` validation. You'll need to call it manually\n-when you want to run one-step model validation for your own manually created\n-models.\n+:class:`~django.forms.ModelForm` validation. In the case of\n+:class:`~django.forms.ModelForm` validation, :meth:`Model.clean_fields()`,\n+:meth:`Model.clean()`, and :meth:`Model.validate_unique()` are all called\n+individually.\n \n-Example::\n+You'll need to call ``full_clean`` manually when you want to run one-step model\n+validation for your own manually created models. For example::\n \n     try:\n         article.full_clean()\n     except ValidationError as e:\n         # Do something based on the errors contained in e.message_dict.\n         # Display them to a user, or handle them programatically.\n+        pass\n \n The first step ``full_clean()`` performs is to clean each individual field.\n \n@@ -375,7 +378,7 @@ If ``save()`` is passed a list of field names in keyword argument\n ``update_fields``, only the fields named in that list will be updated.\n This may be desirable if you want to update just one or a few fields on\n an object. There will be a slight performance benefit from preventing\n-all of the model fields from being updated in the database. For example:\n+all of the model fields from being updated in the database. For example::\n \n     product.name = 'Name changed again'\n     product.save(update_fields=['name'])\n@@ -479,9 +482,13 @@ For example::\n         return \"/people/%i/\" % self.id\n \n (Whilst this code is correct and simple, it may not be the most portable way to\n-write this kind of method. The :func:`permalink() decorator <permalink>`,\n-documented below, is usually the best approach and you should read that section\n-before diving into code implementation.)\n+write this kind of method. The :func:`~django.core.urlresolvers.reverse`\n+function is usually the best approach.)\n+\n+For example::\n+\n+    def get_absolute_url(self):\n+        return reverse('people.views.details', args=[str(self.id)])\n \n One place Django uses ``get_absolute_url()`` is in the admin app. If an object\n defines this method, the object-editing page will have a \"View on site\" link\n@@ -526,11 +533,19 @@ in ``get_absolute_url()`` and have all your other code call that one place.\n The ``permalink`` decorator\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n-The way we wrote ``get_absolute_url()`` above is a slightly violation of the\n-DRY principle: the URL for this object is defined both in the URLconf file and\n-in the model.\n+.. warning::\n \n-You can decouple your models from the URLconf using the ``permalink`` decorator:\n+    The ``permalink`` decorator is no longer recommended. You should use\n+    :func:`~django.core.urlresolvers.reverse` in the body of your\n+    ``get_absolute_url`` method instead.\n+\n+In early versions of Django, there wasn't an easy way to use URLs defined in\n+URLconf file inside :meth:`~django.db.models.Model.get_absolute_url`. That\n+meant you would need to define the URL both in URLConf and\n+:meth:`~django.db.models.Model.get_absolute_url`. The ``permalink`` decorator\n+was added to overcome this DRY principle violation. However, since the\n+introduction of :func:`~django.core.urlresolvers.reverse` there is no\n+reason to use ``permalink`` any more.\n \n .. function:: permalink()\n \n@@ -541,14 +556,14 @@ correct URL, with all parameters substituted in the correct positions.\n \n The ``permalink`` decorator is a Python-level equivalent to the :ttag:`url`\n template tag and a high-level wrapper for the\n-:func:`django.core.urlresolvers.reverse()` function.\n+:func:`~django.core.urlresolvers.reverse` function.\n \n An example should make it clear how to use ``permalink()``. Suppose your URLconf\n contains a line such as::\n \n     (r'^people/(\\d+)/$', 'people.views.details'),\n \n-...your model could have a :meth:`~django.db.models.Model.get_absolute_url()`\n+...your model could have a :meth:`~django.db.models.Model.get_absolute_url`\n method that looked like this::\n \n     from django.db import models\n@@ -616,25 +631,25 @@ the field. This method returns the \"human-readable\" value of the field.\n \n For example::\n \n-        from django.db import models\n-\n-        class Person(models.Model):\n-            SHIRT_SIZES = (\n-                (u'S', u'Small'),\n-                (u'M', u'Medium'),\n-                (u'L', u'Large'),\n-            )\n-            name = models.CharField(max_length=60)\n-            shirt_size = models.CharField(max_length=2, choices=SHIRT_SIZES)\n-\n-    ::\n-\n-        >>> p = Person(name=\"Fred Flintstone\", shirt_size=\"L\")\n-        >>> p.save()\n-        >>> p.shirt_size\n-        u'L'\n-        >>> p.get_shirt_size_display()\n-        u'Large'\n+    from django.db import models\n+\n+    class Person(models.Model):\n+        SHIRT_SIZES = (\n+            (u'S', u'Small'),\n+            (u'M', u'Medium'),\n+            (u'L', u'Large'),\n+        )\n+        name = models.CharField(max_length=60)\n+        shirt_size = models.CharField(max_length=2, choices=SHIRT_SIZES)\n+\n+::\n+\n+    >>> p = Person(name=\"Fred Flintstone\", shirt_size=\"L\")\n+    >>> p.save()\n+    >>> p.shirt_size\n+    u'L'\n+    >>> p.get_shirt_size_display()\n+    u'Large'\n \n .. method:: Model.get_next_by_FOO(\\**kwargs)\n .. method:: Model.get_previous_by_FOO(\\**kwargs)"
        },
        {
            "sha": "a577135271220d766cdf47c4ce2ca921a6a7a927",
            "filename": "docs/ref/models/options.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Foptions.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Foptions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Foptions.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -261,6 +261,21 @@ Django quotes column and table names behind the scenes.\n     :class:`~django.db.models.ManyToManyField`, try using a signal or\n     an explicit :attr:`through <ManyToManyField.through>` model.\n \n+``index_together``\n+\n+.. attribute:: Options.index_together\n+\n+    .. versionadded:: 1.5\n+\n+    Sets of field names that, taken together, are indexed::\n+\n+        index_together = [\n+            [\"pub_date\", \"deadline\"],\n+        ]\n+\n+    This list of fields will be indexed together (i.e. the appropriate\n+    ``CREATE INDEX`` statement will be issued.)\n+\n ``verbose_name``\n ----------------\n "
        },
        {
            "sha": "40fa2d2b2f748e54bd52d4c47a95518b949b2474",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 22,
            "deletions": 18,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -676,21 +676,12 @@ Note that, by default, ``select_related()`` does not follow foreign keys that\n have ``null=True``.\n \n Usually, using ``select_related()`` can vastly improve performance because your\n-app can avoid many database calls. However, in situations with deeply nested\n-sets of relationships ``select_related()`` can sometimes end up following \"too\n-many\" relations, and can generate queries so large that they end up being slow.\n+app can avoid many database calls. However, there are times you are only\n+interested in specific related models, or have deeply nested sets of\n+relationships, and in these cases ``select_related()`` can be optimized by\n+explicitly passing the related field names you are interested in. Only\n+the specified relations will be followed.\n \n-In these situations, you can use the ``depth`` argument to ``select_related()``\n-to control how many \"levels\" of relations ``select_related()`` will actually\n-follow::\n-\n-    b = Book.objects.select_related(depth=1).get(id=4)\n-    p = b.author         # Doesn't hit the database.\n-    c = p.hometown       # Requires a database call.\n-\n-Sometimes you only want to access specific models that are related to your root\n-model, not all of the related models. In these cases, you can pass the related\n-field names to ``select_related()`` and it will only follow those relations.\n You can even do this for models that are more than one relation away by\n separating the field names with double underscores, just as for filters. For\n example, if you have this model::\n@@ -730,6 +721,17 @@ You can also refer to the reverse direction of a\n is defined. Instead of specifying the field name, use the :attr:`related_name\n <django.db.models.ForeignKey.related_name>` for the field on the related object.\n \n+.. deprecated:: 1.5\n+    The ``depth`` parameter to ``select_related()`` has been deprecated. You\n+    should replace it with the use of the ``(*fields)`` listing specific\n+    related fields instead as documented above.\n+\n+A depth limit of relationships to follow can also be specified::\n+\n+    b = Book.objects.select_related(depth=1).get(id=4)\n+    p = b.author         # Doesn't hit the database.\n+    c = p.hometown       # Requires a database call.\n+\n A :class:`~django.db.models.OneToOneField` is not traversed in the reverse\n direction if you are performing a depth-based ``select_related()`` call.\n \n@@ -1319,10 +1321,12 @@ The above example can be rewritten using ``get_or_create()`` like so::\n \n Any keyword arguments passed to ``get_or_create()`` — *except* an optional one\n called ``defaults`` — will be used in a :meth:`get()` call. If an object is\n-found, ``get_or_create()`` returns a tuple of that object and ``False``. If an\n-object is *not* found, ``get_or_create()`` will instantiate and save a new\n-object, returning a tuple of the new object and ``True``. The new object will\n-be created roughly according to this algorithm::\n+found, ``get_or_create()`` returns a tuple of that object and ``False``. If\n+multiple objects are found, ``get_or_create`` raises\n+:exc:`~django.core.exceptions.MultipleObjectsReturned`. If an object is *not*\n+found, ``get_or_create()`` will instantiate and save a new object, returning a\n+tuple of the new object and ``True``. The new object will be created roughly\n+according to this algorithm::\n \n     defaults = kwargs.pop('defaults', {})\n     params = dict([(k, v) for k, v in kwargs.items() if '__' not in k])"
        },
        {
            "sha": "daa4ee9a46574bd490980a5009417ac3a433dba4",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 41,
            "deletions": 26,
            "changes": 67,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -431,10 +431,12 @@ MySQL will connect via a Unix socket to the specified socket. For example::\n If you're using MySQL and this value *doesn't* start with a forward slash, then\n this value is assumed to be the host.\n \n-If you're using PostgreSQL, an empty string means to use a Unix domain socket\n-for the connection, rather than a network connection to localhost. If you\n-explicitly need to use a TCP/IP connection on the local machine with\n-PostgreSQL, specify ``localhost`` here.\n+If you're using PostgreSQL, by default (empty :setting:`HOST`), the connection\n+to the database is done through UNIX domain sockets ('local' lines in\n+``pg_hba.conf``). If you want to connect through TCP sockets, set\n+:setting:`HOST` to 'localhost' or '127.0.0.1' ('host' lines in ``pg_hba.conf``).\n+On Windows, you should always define :setting:`HOST`, as UNIX domain sockets\n+are not available.\n \n .. setting:: NAME\n \n@@ -1119,9 +1121,11 @@ Default: ``()``\n \n List of compiled regular expression objects describing URLs that should be\n ignored when reporting HTTP 404 errors via email (see\n-:doc:`/howto/error-reporting`). Use this if your site does not provide a\n-commonly requested file such as ``favicon.ico`` or ``robots.txt``, or if it\n-gets hammered by script kiddies.\n+:doc:`/howto/error-reporting`). Regular expressions are matched against\n+:meth:`request's full paths <django.http.HttpRequest.get_full_path>` (including\n+query string, if any). Use this if your site does not provide a commonly\n+requested file such as ``favicon.ico`` or ``robots.txt``, or if it gets\n+hammered by script kiddies.\n \n This is only used if :setting:`SEND_BROKEN_LINK_EMAILS` is set to ``True`` and\n ``CommonMiddleware`` is installed (see :doc:`/topics/http/middleware`).\n@@ -1242,9 +1246,8 @@ Example::\n         '/var/local/translations/locale'\n     )\n \n-Note that in the paths you add to the value of this setting, if you have the\n-typical ``/path/to/locale/xx/LC_MESSAGES`` hierarchy, you should use the path to\n-the ``locale`` directory (i.e. ``'/path/to/locale'``).\n+Django will look within each of these paths for the ``<locale_code>/LC_MESSAGES``\n+directories containing the actual translation files.\n \n .. setting:: LOGGING\n \n@@ -1373,7 +1376,7 @@ more details.\n MESSAGE_STORAGE\n ---------------\n \n-Default: ``'django.contrib.messages.storage.user_messages.LegacyFallbackStorage'``\n+Default: ``'django.contrib.messages.storage.fallback.FallbackStorage'``\n \n Controls where Django stores message data.  See the\n :doc:`messages documentation </ref/contrib/messages>` for more details.\n@@ -1560,9 +1563,9 @@ for.\n You'll need to set a tuple with two elements -- the name of the header to look\n for and the required value. For example::\n \n-    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTOCOL', 'https')\n+    SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')\n \n-Here, we're telling Django that we trust the ``X-Forwarded-Protocol`` header\n+Here, we're telling Django that we trust the ``X-Forwarded-Proto`` header\n that comes from our proxy, and any time its value is ``'https'``, then the\n request is guaranteed to be secure (i.e., it originally came in via HTTPS).\n Obviously, you should *only* set this setting if you control your proxy or\n@@ -1575,16 +1578,18 @@ available in ``request.META``.)\n \n .. warning::\n \n-    **You will probably open security holes in your site if you set this without knowing what you're doing. And if you fail to set it when you should. Seriously.**\n+    **You will probably open security holes in your site if you set this\n+    without knowing what you're doing. And if you fail to set it when you\n+    should. Seriously.**\n \n     Make sure ALL of the following are true before setting this (assuming the\n     values from the example above):\n \n     * Your Django app is behind a proxy.\n-    * Your proxy strips the 'X-Forwarded-Protocol' header from all incoming\n+    * Your proxy strips the ``X-Forwarded-Proto`` header from all incoming\n       requests. In other words, if end users include that header in their\n       requests, the proxy will discard it.\n-    * Your proxy sets the 'X-Forwarded-Protocol' header and sends it to Django,\n+    * Your proxy sets the ``X-Forwarded-Proto`` header and sends it to Django,\n       but only for requests that originally come in via HTTPS.\n \n     If any of those are not true, you should keep this setting set to ``None``\n@@ -1693,6 +1698,16 @@ This is useful if you have multiple Django instances running under the same\n hostname. They can use different cookie paths, and each instance will only see\n its own session cookie.\n \n+.. setting:: SESSION_CACHE_ALIAS\n+\n+SESSION_CACHE_ALIAS\n+-------------------\n+\n+Default: ``default``\n+\n+If you're using :ref:`cache-based session storage <cached-sessions-backend>`,\n+this selects the cache to use.\n+\n .. setting:: SESSION_COOKIE_SECURE\n \n SESSION_COOKIE_SECURE\n@@ -2054,6 +2069,16 @@ to ensure your processes are running in the correct environment.\n \n .. _pytz: http://pytz.sourceforge.net/\n \n+.. setting:: TRANSACTIONS_MANAGED\n+\n+TRANSACTIONS_MANAGED\n+--------------------\n+\n+Default: ``False``\n+\n+Set this to ``True`` if you want to :ref:`disable Django's transaction\n+management <deactivate-transaction-management>` and implement your own.\n+\n .. setting:: USE_ETAGS\n \n USE_ETAGS\n@@ -2198,16 +2223,6 @@ The default value for the X-Frame-Options header used by\n Deprecated settings\n ===================\n \n-.. setting:: ADMIN_MEDIA_PREFIX\n-\n-ADMIN_MEDIA_PREFIX\n-------------------\n-\n-.. deprecated:: 1.4\n-   This setting has been obsoleted by the ``django.contrib.staticfiles`` app\n-   integration. See the :doc:`Django 1.4 release notes</releases/1.4>` for\n-   more information.\n-\n .. setting:: AUTH_PROFILE_MODULE\n \n AUTH_PROFILE_MODULE"
        },
        {
            "sha": "57ef0cfb274e9433672191423d756c9867d3f425",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 64,
            "deletions": 6,
            "changes": 70,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -53,6 +53,13 @@ comment\n \n Ignores everything between ``{% comment %}`` and ``{% endcomment %}``.\n \n+Sample usage::\n+\n+    <p>Rendered text with {{ pub_date|date:\"c\" }}</p>\n+    {% comment %}\n+        <p>Commented out text with {{ create_date|date:\"c\" }}</p>\n+    {% endcomment %}\n+\n .. templatetag:: csrf_token\n \n csrf_token\n@@ -611,7 +618,7 @@ Output the contents of the block if the two arguments equal each other.\n \n Example::\n \n-    {% ifequal user.id comment.user_id %}\n+    {% ifequal user.pk comment.user_id %}\n         ...\n     {% endifequal %}\n \n@@ -947,6 +954,10 @@ Argument            Outputs\n ``closecomment``    ``#}``\n ==================  =======\n \n+Sample usage::\n+\n+    {% templatetag openblock %} url 'entry_list' {% templatetag closeblock %}\n+\n .. templatetag:: url\n \n url\n@@ -1024,6 +1035,16 @@ This will follow the normal :ref:`namespaced URL resolution strategy\n <topics-http-reversing-url-namespaces>`, including using any hints provided\n by the context as to the current application.\n \n+.. warning::\n+\n+    Don't forget to put quotes around the function path or pattern name!\n+\n+    .. versionchanged:: 1.5\n+        The first parameter used not to be quoted, which was inconsistent with\n+        other template tags. Since Django 1.5, it is evaluated according to\n+        the usual rules: it can be a quoted string or a variable that will be\n+        looked up in the context.\n+\n .. templatetag:: verbatim\n \n verbatim\n@@ -1226,7 +1247,8 @@ G                 Hour, 24-hour format without leading      ``'0'`` to ``'23'``\n h                 Hour, 12-hour format.                     ``'01'`` to ``'12'``\n H                 Hour, 24-hour format.                     ``'00'`` to ``'23'``\n i                 Minutes.                                  ``'00'`` to ``'59'``\n-I                 Not implemented.\n+I                 Daylight Savings Time, whether it's       ``'1'`` or ``'0'``\n+                  in effect or not.\n j                 Day of the month without leading          ``'1'`` to ``'31'``\n                   zeros.\n l                 Day of the week, textual, long.           ``'Friday'``\n@@ -1408,6 +1430,12 @@ applied to the result will only result in one round of escaping being done. So\n it is safe to use this function even in auto-escaping environments. If you want\n multiple escaping passes to be applied, use the :tfilter:`force_escape` filter.\n \n+For example, you can apply ``escape`` to fields when :ttag:`autoescape` is off::\n+\n+    {% autoescape off %}\n+        {{ title|escape }}\n+    {% endautoescape %}\n+\n .. templatefilter:: escapejs\n \n escapejs\n@@ -1438,6 +1466,14 @@ For example::\n \n If ``value`` is 123456789, the output would be ``117.7 MB``.\n \n+.. admonition:: File sizes and SI units\n+\n+    Strictly speaking, ``filesizeformat`` does not conform to the International\n+    System of Units which recommends using KiB, MiB, GiB, etc. when byte sizes\n+    are calculated in powers of 1024 (which is the case here). Instead, Django\n+    uses traditional unit names (KB, MB, GB, etc.) corresponding to names that\n+    are more commonly used.\n+\n .. templatefilter:: first\n \n first\n@@ -1504,6 +1540,17 @@ that many decimal places. For example:\n ``34.26000``  ``{{ value|floatformat:3 }}``  ``34.260``\n ============  =============================  ==========\n \n+Particularly useful is passing 0 (zero) as the argument which will round the\n+float to the nearest integer.\n+\n+============  ================================  ==========\n+``value``     Template                          Output\n+============  ================================  ==========\n+``34.23234``  ``{{ value|floatformat:\"0\" }}``   ``34``\n+``34.00000``  ``{{ value|floatformat:\"0\" }}``   ``34``\n+``39.56000``  ``{{ value|floatformat:\"0\" }}``   ``40``\n+============  ================================  ==========\n+\n If the argument passed to ``floatformat`` is negative, it will round a number\n to that many decimal places -- but only if there's a decimal part to be\n displayed. For example:\n@@ -1530,6 +1577,13 @@ string. This is useful in the rare cases where you need multiple escaping or\n want to apply other filters to the escaped results. Normally, you want to use\n the :tfilter:`escape` filter.\n \n+For example, if you want to catch the ``<p>`` HTML elements created by\n+the :tfilter:`linebreaks` filter::\n+\n+    {% autoescape off %}\n+        {{ body|linebreaks|force_escape }}\n+    {% endautoescape %}\n+\n .. templatefilter:: get_digit\n \n get_digit\n@@ -1899,9 +1953,9 @@ for documentation of Python string formatting\n \n For example::\n \n-    {{ value|stringformat:\"s\" }}\n+    {{ value|stringformat:\"E\" }}\n \n-If ``value`` is ``\"Joel is a slug\"``, the output will be ``\"Joel is a slug\"``.\n+If ``value`` is ``10``, the output will be ``1.000000E+01``.\n \n .. templatefilter:: striptags\n \n@@ -1967,7 +2021,9 @@ Takes an optional argument that is a variable containing the date to use as\n the comparison point (without the argument, the comparison point is *now*).\n For example, if ``blog_date`` is a date instance representing midnight on 1\n June 2006, and ``comment_date`` is a date instance for 08:00 on 1 June 2006,\n-then ``{{ blog_date|timesince:comment_date }}`` would return \"8 hours\".\n+then the following would return \"8 hours\"::\n+\n+    {{ blog_date|timesince:comment_date }}\n \n Comparing offset-naive and offset-aware datetimes will return an empty string.\n \n@@ -1986,7 +2042,9 @@ given date or datetime. For example, if today is 1 June 2006 and\n \n Takes an optional argument that is a variable containing the date to use as\n the comparison point (instead of *now*). If ``from_date`` contains 22 June\n-2006, then ``{{ conference_date|timeuntil:from_date }}`` will return \"1 week\".\n+2006, then the following will return \"1 week\"::\n+\n+    {{ conference_date|timeuntil:from_date }}\n \n Comparing offset-naive and offset-aware datetimes will return an empty string.\n "
        },
        {
            "sha": "784ff333986edec2545d55c1548e006906986bee",
            "filename": "docs/ref/unicode.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Funicode.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Funicode.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Funicode.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -262,11 +262,11 @@ Taking care in ``get_absolute_url()``\n \n URLs can only contain ASCII characters. If you're constructing a URL from\n pieces of data that might be non-ASCII, be careful to encode the results in a\n-way that is suitable for a URL. The ``django.db.models.permalink()`` decorator\n-handles this for you automatically.\n+way that is suitable for a URL. The :func:`~django.core.urlresolvers.reverse`\n+function handles this for you automatically.\n \n-If you're constructing a URL manually (i.e., *not* using the ``permalink()``\n-decorator), you'll need to take care of the encoding yourself. In this case,\n+If you're constructing a URL manually (i.e., *not* using the ``reverse()``\n+function), you'll need to take care of the encoding yourself. In this case,\n use the ``iri_to_uri()`` and ``urlquote()`` functions that were documented\n above_. For example::\n "
        },
        {
            "sha": "528f1720611ec34713640f3466ed736d9c44ab37",
            "filename": "docs/ref/urlresolvers.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 17,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Furlresolvers.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Furlresolvers.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Furlresolvers.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -178,25 +178,17 @@ whether a view would raise a ``Http404`` error before redirecting to it::\n             return HttpResponseRedirect('/')\n         return response\n \n-\n-permalink()\n------------\n-\n-The :func:`~django.db.models.permalink` decorator is useful for writing short\n-methods that return a full URL path. For example, a model's\n-``get_absolute_url()`` method. See :func:`django.db.models.permalink` for more.\n-\n get_script_prefix()\n -------------------\n \n .. function:: get_script_prefix()\n \n-Normally, you should always use :func:`~django.core.urlresolvers.reverse` or\n-:func:`~django.db.models.permalink` to define URLs within your application.\n-However, if your application constructs part of the URL hierarchy itself, you\n-may occasionally need to generate URLs. In that case, you need to be able to\n-find the base URL of the Django project within its Web server\n-(normally, :func:`~django.core.urlresolvers.reverse` takes care of this for\n-you). In that case, you can call ``get_script_prefix()``, which will return the\n-script prefix portion of the URL for your Django project. If your Django\n-project is at the root of its Web server, this is always ``\"/\"``.\n+Normally, you should always use :func:`~django.core.urlresolvers.reverse` to\n+define URLs within your application. However, if your application constructs\n+part of the URL hierarchy itself, you may occasionally need to generate URLs.\n+In that case, you need to be able to find the base URL of the Django project\n+within its Web server (normally, :func:`~django.core.urlresolvers.reverse`\n+takes care of this for you). In that case, you can call\n+``get_script_prefix()``, which will return the script prefix portion of the URL\n+for your Django project. If your Django project is at the root of its web\n+server, this is always ``\"/\"``."
        },
        {
            "sha": "2f12c3a96c8119989552624cf0afe0a8a5ec0c6c",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -305,6 +305,18 @@ The functions defined in this module share the following properties:\n \n     Returns an ASCII string containing the encoded result.\n \n+.. function:: filepath_to_uri(path)\n+\n+    Convert a file system path to a URI portion that is suitable for inclusion\n+    in a URL. The path is assumed to be either UTF-8 or unicode.\n+\n+    This method will encode certain characters that would normally be\n+    recognized as special characters for URIs.  Note that this method does not\n+    encode the ' character, as it is a valid character within URIs. See\n+    ``encodeURIComponent()`` JavaScript function for more details.\n+\n+    Returns an ASCII string containing the encoded result.\n+\n ``django.utils.feedgenerator``\n ==============================\n "
        },
        {
            "sha": "fac64d843329ecc59c531998309cea9dbc65660c",
            "filename": "docs/releases/1.0-beta-2.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.0-beta-2.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.0-beta-2.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.0-beta-2.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -32,8 +32,8 @@ Refactored ``django.contrib.comments``\n     carried out a major rewrite and refactoring of Django's bundled\n     comment system, greatly increasing its flexibility and\n     customizability. :doc:`Full documentation\n-    </ref/contrib/comments/index>` is available, as well as :doc:`an\n-    upgrade guide </ref/contrib/comments/upgrade>` if you were using\n+    </ref/contrib/comments/index>` is available, as well as an\n+    upgrade guide if you were using\n     the previous incarnation of the comments application..\n \n Refactored documentation"
        },
        {
            "sha": "29e40b2ebe08d29a9dddb5feae481782d5b5f91c",
            "filename": "docs/releases/1.0-porting-guide.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.0-porting-guide.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.0-porting-guide.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.0-porting-guide.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -391,8 +391,8 @@ Comments\n --------\n \n If you were using Django 0.96's ``django.contrib.comments`` app, you'll need to\n-upgrade to the new comments app introduced in 1.0. See\n-:doc:`/ref/contrib/comments/upgrade` for details.\n+upgrade to the new comments app introduced in 1.0. See the upgrade guide\n+for details.\n \n Template tags\n -------------"
        },
        {
            "sha": "be61311232239717d1789444bc0d7dc0c95b0840",
            "filename": "docs/releases/1.0.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.0.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.0.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.0.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -194,8 +194,8 @@ Refactored ``django.contrib.comments``\n As part of a Google Summer of Code project, Thejaswi Puthraya carried out a\n major rewrite and refactoring of Django's bundled comment system, greatly\n increasing its flexibility and customizability. :doc:`Full documentation\n-</ref/contrib/comments/index>` is available, as well as :doc:`an upgrade guide\n-</ref/contrib/comments/upgrade>` if you were using the previous incarnation of\n+</ref/contrib/comments/index>` is available, as well as an upgrade guide\n+if you were using the previous incarnation of\n the comments application.\n \n Removal of deprecated features"
        },
        {
            "sha": "8fbeafc68be2e4dc47e1a8124713f4370bf16f2e",
            "filename": "docs/releases/1.5-alpha-1.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.5-alpha-1.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.5-alpha-1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5-alpha-1.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -51,8 +51,8 @@ Other notable new features in Django 1.5 include:\n * `Support for saving a subset of model's fields`_ -\n   :meth:`Model.save() <django.db.models.Model.save()>` now accepts an\n   ``update_fields`` argument, letting you specify which fields are\n-  written back to the databse when you call ``save()``. This can help\n-  in high-concurrancy operations, and can improve performance.\n+  written back to the database when you call ``save()``. This can help\n+  in high-concurrency operations, and can improve performance.\n \n * Better `support for streaming responses <#explicit-streaming-responses>`_ via\n   the new  :class:`~django.http.StreamingHttpResponse` response class.\n@@ -83,7 +83,7 @@ Python compatibility\n ====================\n \n Django 1.5 requires Python 2.6.5 or above, though we **highly recommended**\n-Python 2.7.3 or above. Support for Python 2.5 and below as been dropped.\n+Python 2.7.3 or above. Support for Python 2.5 and below has been dropped.\n \n This change should affect only a small number of Django users, as most\n operating-system vendors today are shipping Python 2.6 or newer as their default\n@@ -106,17 +106,17 @@ need to install a different version of Django on Python 3. This means that\n you can write application targeted for just Python 2, just Python 3, or single\n applications that support both platforms.\n \n-However, we're labling this support \"experimental\" for now: although it's\n-receved extensive testing via our automated test suite, it's recieved very\n+However, we're labeling this support \"experimental\" for now: although it's\n+received extensive testing via our automated test suite, it's received very\n little real-world testing. We've done our best to eliminate bugs, but we can't\n be sure we covered all possible uses of Django. Further, Django's more than a\n web framework; it's an ecosystem of pluggable components. At this point, very\n-few third-party applications have been ported to Python 3, so it's unliukely\n-that a real-world application will have all its dependecies satisfied under\n+few third-party applications have been ported to Python 3, so it's unlikely\n+that a real-world application will have all its dependencies satisfied under\n Python 3.\n \n Thus, we're recommending that Django 1.5 not be used in production under Python\n-3. Instead, use this oportunity to begin :doc:`porting applications to Python 3\n+3. Instead, use this opportunity to begin :doc:`porting applications to Python 3\n </topics/python3>`. If you're an author of a pluggable component, we encourage you\n to start porting now.\n \n@@ -207,7 +207,7 @@ Retrieval of ``ContentType`` instances associated with proxy models\n The methods :meth:`ContentTypeManager.get_for_model() <django.contrib.contenttypes.models.ContentTypeManager.get_for_model()>`\n and :meth:`ContentTypeManager.get_for_models() <django.contrib.contenttypes.models.ContentTypeManager.get_for_models()>`\n have a new keyword argument – respectively ``for_concrete_model`` and ``for_concrete_models``.\n-By passing ``False`` using this argument it is now possible to retreive the\n+By passing ``False`` using this argument it is now possible to retrieve the\n :class:`ContentType <django.contrib.contenttypes.models.ContentType>`\n associated with proxy models.\n \n@@ -495,8 +495,8 @@ In order to be able to run unit tests in any order and to make sure they are\n always isolated from each other, :class:`~django.test.TransactionTestCase` will\n now reset the database *after* each test run instead.\n \n-No more implict DB sequences reset\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+No more implicit DB sequences reset\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n \n :class:`~django.test.TransactionTestCase` tests used to reset primary key\n sequences automatically together with the database flushing actions described\n@@ -554,7 +554,7 @@ Miscellaneous\n   available at :func:`django.utils.html.remove_tags`.\n \n * Uploaded files are no longer created as executable by default. If you need\n-  them to be executeable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n+  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n   needs. The new default value is `0666` (octal) and the current umask value\n   is first masked out.\n "
        },
        {
            "sha": "f3bfc2a8fafff647e3b43fef6702fdb05f45afe1",
            "filename": "docs/releases/1.5-beta-1.txt",
            "status": "added",
            "additions": 702,
            "deletions": 0,
            "changes": 702,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.5-beta-1.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.5-beta-1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5-beta-1.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,702 @@\n+=============================\n+Django 1.5 beta release notes\n+=============================\n+\n+November 27, 2012.\n+\n+Welcome to Django 1.5 beta!\n+\n+This is the second in a series of preview/development releases leading\n+up to the eventual release of Django 1.5, scheduled for Decemeber\n+2012. This release is primarily targeted at developers who are\n+interested in trying out new features and testing the Django codebase\n+to help identify and resolve bugs prior to the final 1.5 release.\n+\n+As such, this release is *not* intended for production use, and any such use\n+is discouraged.\n+\n+These release notes cover the `new features`_, as well\n+as some `backwards incompatible changes`_ you'll want to be aware of\n+when upgrading from Django 1.4 or older versions. We've also dropped some\n+features, which are detailed in :doc:`our deprecation plan\n+</internals/deprecation>`, and we've `begun the deprecation process for some\n+features`_.\n+\n+.. _`new features`: `What's new in Django 1.5`_\n+.. _`backwards incompatible changes`: `Backwards incompatible changes in 1.5`_\n+.. _`begun the deprecation process for some features`: `Features deprecated in 1.5`_\n+\n+Overview\n+========\n+\n+The biggest new feature in Django 1.5 is the `configurable User model`_. Before\n+Django 1.5, applications that wanted to use Django's auth framework\n+(:mod:`django.contrib.auth`) were forced to use Django's definition of a \"user\".\n+In Django 1.5, you can now swap out the ``User`` model for one that you write\n+yourself. This could be a simple extension to the existing ``User`` model -- for\n+example, you could add a Twitter or Facebook ID field -- or you could completely\n+replace the ``User`` with one totally customized for your site.\n+\n+Django 1.5 is also the first release with `Python 3 support`_! We're labeling\n+this support \"experimental\" because we don't yet consider it production-ready,\n+but everything's in place for you to start porting your apps to Python 3.\n+Our next release, Django 1.6, will support Python 3 without reservations.\n+\n+Other notable new features in Django 1.5 include:\n+\n+* `Support for saving a subset of model's fields`_ -\n+  :meth:`Model.save() <django.db.models.Model.save()>` now accepts an\n+  ``update_fields`` argument, letting you specify which fields are\n+  written back to the database when you call ``save()``. This can help\n+  in high-concurrency operations, and can improve performance.\n+\n+* Better `support for streaming responses <#explicit-streaming-responses-beta-1>`_ via\n+  the new  :class:`~django.http.StreamingHttpResponse` response class.\n+\n+* `GeoDjango`_ now supports PostGIS 2.0.\n+\n+* ... and more; `see below <#what-s-new-in-django-1-5>`_.\n+\n+Wherever possible we try to introduce new features in a backwards-compatible\n+manner per :doc:`our API stability policy </misc/api-stability>`.\n+However, as with previous releases, Django 1.5 ships with some minor\n+`backwards incompatible changes`_; people upgrading from previous versions\n+of Django should read that list carefully.\n+\n+One deprecated feature worth noting is the shift to \"new-style\" :ttag:`url` tag.\n+Prior to Django 1.3, syntax like ``{% url myview %}`` was interpreted\n+incorrectly (Django considered ``\"myview\"`` to be a literal name of a view, not\n+a template variable named ``myview``). Django 1.3 and above introduced the\n+``{% load url from future %}`` syntax to bring in the corrected behavior where\n+``myview`` was seen as a variable.\n+\n+The upshot of this is that if you are not using ``{% load url from future %}``\n+in your templates, you'll need to change tags like ``{% url myview %}`` to\n+``{% url \"myview\" %}``. If you *were* using ``{% load url from future %}`` you\n+can simply remove that line under Django 1.5\n+\n+Python compatibility\n+====================\n+\n+Django 1.5 requires Python 2.6.5 or above, though we **highly recommend**\n+Python 2.7.3 or above. Support for Python 2.5 and below has been dropped.\n+\n+This change should affect only a small number of Django users, as most\n+operating-system vendors today are shipping Python 2.6 or newer as their default\n+version. If you're still using Python 2.5, however, you'll need to stick to\n+Django 1.4 until you can upgrade your Python version. Per :doc:`our support\n+policy </internals/release-process>`, Django 1.4 will continue to receive\n+security support until the release of Django 1.6.\n+\n+Django 1.5 does not run on a Jython final release, because Jython's latest\n+release doesn't currently support Python 2.6. However, Jython currently does\n+offer an alpha release featuring 2.7 support, and Django 1.5 supports that alpha\n+release.\n+\n+Python 3 support\n+~~~~~~~~~~~~~~~~\n+\n+Django 1.5 introduces support for Python 3 - specifically, Python\n+3.2 and above. This comes in the form of a **single** codebase; you don't\n+need to install a different version of Django on Python 3. This means that\n+you can write applications targeted for just Python 2, just Python 3, or single\n+applications that support both platforms.\n+\n+However, we're labeling this support \"experimental\" for now: although it's\n+received extensive testing via our automated test suite, it's received very\n+little real-world testing. We've done our best to eliminate bugs, but we can't\n+be sure we covered all possible uses of Django. Further, Django's more than a\n+web framework; it's an ecosystem of pluggable components. At this point, very\n+few third-party applications have been ported to Python 3, so it's unlikely\n+that a real-world application will have all its dependencies satisfied under\n+Python 3.\n+\n+Thus, we're recommending that Django 1.5 not be used in production under Python\n+3. Instead, use this opportunity to begin :doc:`porting applications to Python 3\n+</topics/python3>`. If you're an author of a pluggable component, we encourage you\n+to start porting now.\n+\n+We plan to offer first-class, production-ready support for Python 3 in our next\n+release, Django 1.6.\n+\n+What's new in Django 1.5\n+========================\n+\n+Configurable User model\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+In Django 1.5, you can now use your own model as the store for user-related\n+data. If your project needs a username with more than 30 characters, or if\n+you want to store user's names in a format other than first name/last name,\n+or you want to put custom profile information onto your User object, you can\n+now do so.\n+\n+If you have a third-party reusable application that references the User model,\n+you may need to make some changes to the way you reference User instances. You\n+should also document any specific features of the User model that your\n+application relies upon.\n+\n+See the :ref:`documentation on custom User models <auth-custom-user>` for\n+more details.\n+\n+Support for saving a subset of model's fields\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The method :meth:`Model.save() <django.db.models.Model.save()>` has a new\n+keyword argument ``update_fields``. By using this argument it is possible to\n+save only a select list of model's fields. This can be useful for performance\n+reasons or when trying to avoid overwriting concurrent changes.\n+\n+Deferred instances (those loaded by .only() or .defer()) will automatically\n+save just the loaded fields. If any field is set manually after load, that\n+field will also get updated on save.\n+\n+See the :meth:`Model.save() <django.db.models.Model.save()>` documentation for\n+more details.\n+\n+Caching of related model instances\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+When traversing relations, the ORM will avoid re-fetching objects that were\n+previously loaded. For example, with the tutorial's models::\n+\n+    >>> first_poll = Poll.objects.all()[0]\n+    >>> first_choice = first_poll.choice_set.all()[0]\n+    >>> first_choice.poll is first_poll\n+    True\n+\n+In Django 1.5, the third line no longer triggers a new SQL query to fetch\n+``first_choice.poll``; it was set by the second line.\n+\n+For one-to-one relationships, both sides can be cached. For many-to-one\n+relationships, only the single side of the relationship can be cached. This\n+is particularly helpful in combination with ``prefetch_related``.\n+\n+.. _explicit-streaming-responses-beta-1:\n+\n+Explicit support for streaming responses\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Before Django 1.5, it was possible to create a streaming response by passing\n+an iterator to :class:`~django.http.HttpResponse`. But this was unreliable:\n+any middleware that accessed the :attr:`~django.http.HttpResponse.content`\n+attribute would consume the iterator prematurely.\n+\n+You can now explicitly generate a streaming response with the new\n+:class:`~django.http.StreamingHttpResponse` class. This class exposes a\n+:class:`~django.http.StreamingHttpResponse.streaming_content` attribute which\n+is an iterator.\n+\n+Since :class:`~django.http.StreamingHttpResponse` does not have a ``content``\n+attribute, middleware that needs access to the response content must test for\n+streaming responses and behave accordingly. See :ref:`response-middleware` for\n+more information.\n+\n+``{% verbatim %}`` template tag\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+To make it easier to deal with javascript templates which collide with Django's\n+syntax, you can now use the :ttag:`verbatim` block tag to avoid parsing the\n+tag's content.\n+\n+Retrieval of ``ContentType`` instances associated with proxy models\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The methods :meth:`ContentTypeManager.get_for_model() <django.contrib.contenttypes.models.ContentTypeManager.get_for_model()>`\n+and :meth:`ContentTypeManager.get_for_models() <django.contrib.contenttypes.models.ContentTypeManager.get_for_models()>`\n+have a new keyword argument – respectively ``for_concrete_model`` and ``for_concrete_models``.\n+By passing ``False`` using this argument it is now possible to retrieve the\n+:class:`ContentType <django.contrib.contenttypes.models.ContentType>`\n+associated with proxy models.\n+\n+New ``view`` variable in class-based views context\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+In all :doc:`generic class-based views </topics/class-based-views/index>`\n+(or any class-based view inheriting from ``ContextMixin``), the context dictionary\n+contains a ``view`` variable that points to the ``View`` instance.\n+\n+GeoDjango\n+~~~~~~~~~\n+\n+* :class:`~django.contrib.gis.geos.LineString` and\n+  :class:`~django.contrib.gis.geos.MultiLineString` GEOS objects now support the\n+  :meth:`~django.contrib.gis.geos.GEOSGeometry.interpolate()` and\n+  :meth:`~django.contrib.gis.geos.GEOSGeometry.project()` methods\n+  (so-called linear referencing).\n+\n+* The wkb and hex properties of `GEOSGeometry` objects preserve the Z dimension.\n+\n+* Support for PostGIS 2.0 has been added and support for GDAL < 1.5 has been\n+  dropped.\n+\n+Minor features\n+~~~~~~~~~~~~~~\n+\n+Django 1.5 also includes several smaller improvements worth noting:\n+\n+* The template engine now interprets ``True``, ``False`` and ``None`` as the\n+  corresponding Python objects.\n+\n+* :mod:`django.utils.timezone` provides a helper for converting aware\n+  datetimes between time zones. See :func:`~django.utils.timezone.localtime`.\n+\n+* The generic views support OPTIONS requests.\n+\n+* Management commands do not raise ``SystemExit`` any more when called by code\n+  from :ref:`call_command <call-command>`. Any exception raised by the command\n+  (mostly :ref:`CommandError <ref-command-exceptions>`) is propagated.\n+\n+* The dumpdata management command outputs one row at a time, preventing\n+  out-of-memory errors when dumping large datasets.\n+\n+* In the localflavor for Canada, \"pq\" was added to the acceptable codes for\n+  Quebec. It's an old abbreviation.\n+\n+* The :ref:`receiver <connecting-receiver-functions>` decorator is now able to\n+  connect to more than one signal by supplying a list of signals.\n+\n+* In the admin, you can now filter users by groups which they are members of.\n+\n+* :meth:`QuerySet.bulk_create()\n+  <django.db.models.query.QuerySet.bulk_create>` now has a batch_size\n+  argument. By default the batch_size is unlimited except for SQLite where\n+  single batch is limited so that 999 parameters per query isn't exceeded.\n+\n+* The :setting:`LOGIN_URL` and :setting:`LOGIN_REDIRECT_URL` settings now also\n+  accept view function names and\n+  :ref:`named URL patterns <naming-url-patterns>`. This allows you to reduce\n+  configuration duplication. More information can be found in the\n+  :func:`~django.contrib.auth.decorators.login_required` documentation.\n+\n+* Django now provides a mod_wsgi :doc:`auth handler\n+  </howto/deployment/wsgi/apache-auth>`.\n+\n+* The :meth:`QuerySet.delete() <django.db.models.query.QuerySet.delete>`\n+  and :meth:`Model.delete() <django.db.models.Model.delete()>` can now take\n+  fast-path in some cases. The fast-path allows for less queries and less\n+  objects fetched into memory. See :meth:`QuerySet.delete()\n+  <django.db.models.query.QuerySet.delete>` for details.\n+\n+* An instance of :class:`~django.core.urlresolvers.ResolverMatch` is stored on\n+  the request as ``resolver_match``.\n+\n+* By default, all logging messages reaching the `django` logger when\n+  :setting:`DEBUG` is `True` are sent to the console (unless you redefine the\n+  logger in your :setting:`LOGGING` setting).\n+\n+* When using :class:`~django.template.RequestContext`, it is now possible to\n+  look up permissions by using ``{% if 'someapp.someperm' in perms %}``\n+  in templates.\n+\n+* It's not required any more to have ``404.html`` and ``500.html`` templates in\n+  the root templates directory. Django will output some basic error messages for\n+  both situations when those templates are not found. Of course, it's still\n+  recommended as good practice to provide those templates in order to present\n+  pretty error pages to the user.\n+\n+* :mod:`django.contrib.auth` provides a new signal that is emitted\n+  whenever a user fails to login successfully. See\n+  :data:`~django.contrib.auth.signals.user_login_failed`\n+\n+* The loaddata management command now supports an `ignorenonexistent` option to\n+  ignore data for fields that no longer exist.\n+\n+* :meth:`~django.test.SimpleTestCase.assertXMLEqual` and\n+  :meth:`~django.test.SimpleTestCase.assertXMLNotEqual` new assertions allow\n+  you to test equality for XML content at a semantic level, without caring for\n+  syntax differences (spaces, attribute order, etc.).\n+\n+* RemoteUserMiddleware now forces logout when the REMOTE_USER header\n+  disappears during the same browser session.\n+\n+* The :ref:`cache-based session backend <cached-sessions-backend>` can store\n+  session data in a non-default cache.\n+\n+* Multi-column indexes can now be created on models. Read the\n+  :attr:`~django.db.models.Options.index_together` documentation for more\n+  information.\n+\n+* During Django's logging configuration verbose Deprecation warnings are\n+  enabled and warnings are captured into the logging system. Logged warnings\n+  are routed through the ``console`` logging handler, which by default requires\n+  :setting:`DEBUG` to be True for output to be generated. The result is that\n+  DeprecationWarnings should be printed to the console in development\n+  environments the way they have been in Python versions < 2.7.\n+\n+* The API for :meth:`django.contrib.admin.ModelAdmin.message_user` method has\n+  been modified to accept additional arguments adding capabilities similar to\n+  :func:`django.contrib.messages.add_message`. This is useful for generating\n+  error messages from admin actions.\n+\n+* The admin's list filters can now be customized per-request thanks to the new\n+  :meth:`django.contrib.admin.ModelAdmin.get_list_filter` method.\n+\n+Backwards incompatible changes in 1.5\n+=====================================\n+\n+.. warning::\n+\n+    In addition to the changes outlined in this section, be sure to review the\n+    :doc:`deprecation plan </internals/deprecation>` for any features that\n+    have been removed. If you haven't updated your code within the\n+    deprecation timeline for a given feature, its removal may appear as a\n+    backwards incompatible change.\n+\n+Context in year archive class-based views\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+For consistency with the other date-based generic views,\n+:class:`~django.views.generic.dates.YearArchiveView` now passes ``year`` in\n+the context as a :class:`datetime.date` rather than a string.  If you are\n+using ``{{ year }}`` in your templates, you must replace it with ``{{\n+year|date:\"Y\" }}``.\n+\n+``next_year`` and ``previous_year`` were also added in the context. They are\n+calculated according to ``allow_empty`` and ``allow_future``.\n+\n+Context in year and month archive class-based views\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:class:`~django.views.generic.dates.YearArchiveView` and\n+:class:`~django.views.generic.dates.MonthArchiveView` were documented to\n+provide a ``date_list`` sorted in ascending order in the context, like their\n+function-based predecessors, but it actually was in descending order. In 1.5,\n+the documented order was restored. You may want to add (or remove) the\n+``reversed`` keyword when you're iterating on ``date_list`` in a template::\n+\n+    {% for date in date_list reversed %}\n+\n+:class:`~django.views.generic.dates.ArchiveIndexView` still provides a\n+``date_list`` in descending order.\n+\n+Context in TemplateView\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+For consistency with the design of the other generic views,\n+:class:`~django.views.generic.base.TemplateView` no longer passes a ``params``\n+dictionary into the context, instead passing the variables from the URLconf\n+directly into the context.\n+\n+Non-form data in HTTP requests\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:attr:`request.POST <django.http.HttpRequest.POST>` will no longer include data\n+posted via HTTP requests with non form-specific content-types in the header.\n+In prior versions, data posted with content-types other than\n+``multipart/form-data`` or ``application/x-www-form-urlencoded`` would still\n+end up represented in the :attr:`request.POST <django.http.HttpRequest.POST>`\n+attribute. Developers wishing to access the raw POST data for these cases,\n+should use the :attr:`request.body <django.http.HttpRequest.body>` attribute\n+instead.\n+\n+OPTIONS, PUT and DELETE requests in the test client\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Unlike GET and POST, these HTTP methods aren't implemented by web browsers.\n+Rather, they're used in APIs, which transfer data in various formats such as\n+JSON or XML. Since such requests may contain arbitrary data, Django doesn't\n+attempt to decode their body.\n+\n+However, the test client used to build a query string for OPTIONS and DELETE\n+requests like for GET, and a request body for PUT requests like for POST. This\n+encoding was arbitrary and inconsistent with Django's behavior when it\n+receives the requests, so it was removed in Django 1.5.\n+\n+If you were using the ``data`` parameter in an OPTIONS or a DELETE request,\n+you must convert it to a query string and append it to the ``path`` parameter.\n+\n+If you were using the ``data`` parameter in a PUT request without a\n+``content_type``, you must encode your data before passing it to the test\n+client and set the ``content_type`` argument.\n+\n+.. _simplejson-incompatibilities-beta-1:\n+\n+System version of :mod:`simplejson` no longer used\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:ref:`As explained below <simplejson-deprecation-beta-1>`, Django 1.5 deprecates\n+:mod:`django.utils.simplejson` in favor of Python 2.6's built-in :mod:`json`\n+module. In theory, this change is harmless. Unfortunately, because of\n+incompatibilities between versions of :mod:`simplejson`, it may trigger errors\n+in some circumstances.\n+\n+JSON-related features in Django 1.4 always used :mod:`django.utils.simplejson`.\n+This module was actually:\n+\n+- A system version of :mod:`simplejson`, if one was available (ie. ``import\n+  simplejson`` works), if it was more recent than Django's built-in copy or it\n+  had the C speedups, or\n+- The :mod:`json` module from the standard library, if it was available (ie.\n+  Python 2.6 or greater), or\n+- A built-in copy of version 2.0.7 of :mod:`simplejson`.\n+\n+In Django 1.5, those features use Python's :mod:`json` module, which is based\n+on version 2.0.9 of :mod:`simplejson`.\n+\n+There are no known incompatibilities between Django's copy of version 2.0.7 and\n+Python's copy of version 2.0.9. However, there are some incompatibilities\n+between other versions of :mod:`simplejson`:\n+\n+- While the :mod:`simplejson` API is documented as always returning unicode\n+  strings, the optional C implementation can return a byte string. This was\n+  fixed in Python 2.7.\n+- :class:`simplejson.JSONEncoder` gained a ``namedtuple_as_object`` keyword\n+  argument in version 2.2.\n+\n+More information on these incompatibilities is available in `ticket #18023`_.\n+\n+The net result is that, if you have installed :mod:`simplejson` and your code\n+uses Django's serialization internals directly -- for instance\n+:class:`django.core.serializers.json.DjangoJSONEncoder`, the switch from\n+:mod:`simplejson` to :mod:`json` could break your code. (In general, changes to\n+internals aren't documented; we're making an exception here.)\n+\n+At this point, the maintainers of Django believe that using :mod:`json` from\n+the standard library offers the strongest guarantee of backwards-compatibility.\n+They recommend to use it from now on.\n+\n+.. _ticket #18023: https://code.djangoproject.com/ticket/18023#comment:10\n+\n+String types of hasher method parameters\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If you have written a :ref:`custom password hasher <auth_password_storage>`,\n+your ``encode()``, ``verify()`` or ``safe_summary()`` methods should accept\n+Unicode parameters (``password``, ``salt`` or ``encoded``). If any of the\n+hashing methods need byte strings, you can use the\n+:func:`~django.utils.encoding.force_bytes` utility to encode the strings.\n+\n+Validation of previous_page_number and next_page_number\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+When using :doc:`object pagination </topics/pagination>`,\n+the ``previous_page_number()`` and ``next_page_number()`` methods of the\n+:class:`~django.core.paginator.Page` object did not check if the returned\n+number was inside the existing page range.\n+It does check it now and raises an :exc:`InvalidPage` exception when the number\n+is either too low or too high.\n+\n+Behavior of autocommit database option on PostgreSQL changed\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+PostgreSQL's autocommit option didn't work as advertised previously. It did\n+work for single transaction block, but after the first block was left the\n+autocommit behavior was never restored. This bug is now fixed in 1.5. While\n+this is only a bug fix, it is worth checking your applications behavior if\n+you are using PostgreSQL together with the autocommit option.\n+\n+Session not saved on 500 responses\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django's session middleware will skip saving the session data if the\n+response's status code is 500.\n+\n+Email checks on failed admin login\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Prior to Django 1.5, if you attempted to log into the admin interface and\n+mistakenly used your email address instead of your username, the admin\n+interface would provide a warning advising that your email address was\n+not your username. In Django 1.5, the introduction of\n+:ref:`custom User models <auth-custom-user>` has required the removal of this\n+warning. This doesn't change the login behavior of the admin site; it only\n+affects the warning message that is displayed under one particular mode of\n+login failure.\n+\n+Changes in tests execution\n+~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Some changes have been introduced in the execution of tests that might be\n+backward-incompatible for some testing setups:\n+\n+Database flushing in ``django.test.TransactionTestCase``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Previously, the test database was truncated *before* each test run in a\n+:class:`~django.test.TransactionTestCase`.\n+\n+In order to be able to run unit tests in any order and to make sure they are\n+always isolated from each other, :class:`~django.test.TransactionTestCase` will\n+now reset the database *after* each test run instead.\n+\n+No more implicit DB sequences reset\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+:class:`~django.test.TransactionTestCase` tests used to reset primary key\n+sequences automatically together with the database flushing actions described\n+above.\n+\n+This has been changed so no sequences are implicitly reset. This can cause\n+:class:`~django.test.TransactionTestCase` tests that depend on hard-coded\n+primary key values to break.\n+\n+The new :attr:`~django.test.TransactionTestCase.reset_sequences` attribute can\n+be used to force the old behavior for :class:`~django.test.TransactionTestCase`\n+that might need it.\n+\n+Ordering of tests\n+^^^^^^^^^^^^^^^^^\n+\n+In order to make sure all ``TestCase`` code starts with a clean database,\n+tests are now executed in the following order:\n+\n+* First, all unittests (including :class:`unittest.TestCase`,\n+  :class:`~django.test.SimpleTestCase`, :class:`~django.test.TestCase` and\n+  :class:`~django.test.TransactionTestCase`) are run with no particular ordering\n+  guaranteed nor enforced among them.\n+\n+* Then any other tests (e.g. doctests) that may alter the database without\n+  restoring it to its original state are run.\n+\n+This should not cause any problems unless you have existing doctests which\n+assume a :class:`~django.test.TransactionTestCase` executed earlier left some\n+database state behind or unit tests that rely on some form of state being\n+preserved after the execution of other tests. Such tests are already very\n+fragile, and must now be changed to be able to run independently.\n+\n+`cleaned_data` dictionary kept for invalid forms\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :attr:`~django.forms.Form.cleaned_data` dictionary is now always present\n+after form validation. When the form doesn't validate, it contains only the\n+fields that passed validation. You should test the success of the validation\n+with the :meth:`~django.forms.Form.is_valid()` method and not with the\n+presence or absence of the :attr:`~django.forms.Form.cleaned_data` attribute\n+on the form.\n+\n+Behavior of :djadmin:`syncdb` with multiple databases\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:djadmin:`syncdb` now queries the database routers to determine if content\n+types (when :mod:`~django.contrib.contenttypes` is enabled) and permissions\n+(when :mod:`~django.contrib.auth` is enabled) should be created in the target\n+database. Previously, it created them in the default database, even when\n+another database was specified with the :djadminopt:`--database` option.\n+\n+If you use :djadmin:`syncdb` on multiple databases, you should ensure that\n+your routers allow synchronizing content types and permissions to only one of\n+them. See the docs on the :ref:`behavior of contrib apps with multiple\n+databases <contrib_app_multiple_databases>` for more information.\n+\n+Miscellaneous\n+~~~~~~~~~~~~~\n+\n+* :class:`django.forms.ModelMultipleChoiceField` now returns an empty\n+  ``QuerySet`` as the empty value instead of an empty list.\n+\n+* :func:`~django.utils.http.int_to_base36` properly raises a :exc:`TypeError`\n+  instead of :exc:`ValueError` for non-integer inputs.\n+\n+* The ``slugify`` template filter is now available as a standard python\n+  function at :func:`django.utils.text.slugify`. Similarly, ``remove_tags`` is\n+  available at :func:`django.utils.html.remove_tags`.\n+\n+* Uploaded files are no longer created as executable by default. If you need\n+  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n+  needs. The new default value is `0666` (octal) and the current umask value\n+  is first masked out.\n+\n+* The :ref:`F() expressions <query-expressions>` supported bitwise operators by\n+  ``&`` and ``|``. These operators are now available using ``.bitand()`` and\n+  ``.bitor()`` instead. The removal of ``&`` and ``|`` was done to be consistent with\n+  :ref:`Q() expressions <complex-lookups-with-q>` and ``QuerySet`` combining where\n+  the operators are used as boolean AND and OR operators.\n+\n+* In a ``filter()`` call, when :ref:`F() expressions <query-expressions>`\n+  contained lookups spanning multi-valued relations, they didn't always reuse\n+  the same relations as other lookups along the same chain. This was changed,\n+  and now F() expressions will always use the same relations as other lookups\n+  within the same ``filter()`` call.\n+\n+* The :ttag:`csrf_token` template tag is no longer enclosed in a div. If you need\n+  HTML validation against pre-HTML5 Strict DTDs, you should add a div around it\n+  in your pages.\n+\n+* The template tags library ``adminmedia``, which only contained the\n+  deprecated template tag ``{% admin_media_prefix %}``, was removed.\n+  Attempting to load it with ``{% load adminmedia %}`` will fail. If your\n+  templates still contain that line you must remove it.\n+\n+Features deprecated in 1.5\n+==========================\n+\n+.. _simplejson-deprecation-beta-1:\n+\n+:setting:`AUTH_PROFILE_MODULE`\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+With the introduction of :ref:`custom User models <auth-custom-user>`, there is\n+no longer any need for a built-in mechanism to store user profile data.\n+\n+You can still define user profiles models that have a one-to-one relation with\n+the User model - in fact, for many applications needing to associate data with\n+a User account, this will be an appropriate design pattern to follow. However,\n+the :setting:`AUTH_PROFILE_MODULE` setting, and the\n+:meth:`~django.contrib.auth.models.User.get_profile()` method for accessing\n+the user profile model, should not be used any longer.\n+\n+Streaming behavior of :class:`HttpResponse`\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django 1.5 deprecates the ability to stream a response by passing an iterator\n+to :class:`~django.http.HttpResponse`. If you rely on this behavior, switch to\n+:class:`~django.http.StreamingHttpResponse`. See\n+:ref:`explicit-streaming-responses-beta-1` above.\n+\n+In Django 1.7 and above, the iterator will be consumed immediately by\n+:class:`~django.http.HttpResponse`.\n+\n+``django.utils.simplejson``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Since Django 1.5 drops support for Python 2.5, we can now rely on the\n+:mod:`json` module being available in Python's standard library, so we've\n+removed our own copy of :mod:`simplejson`. You should now import :mod:`json`\n+instead :mod:`django.utils.simplejson`.\n+\n+Unfortunately, this change might have unwanted side-effects, because of\n+incompatibilities between versions of :mod:`simplejson` -- see the\n+:ref:`backwards-incompatible changes <simplejson-incompatibilities-beta-1>` section.\n+If you rely on features added to :mod:`simplejson` after it became Python's\n+:mod:`json`, you should import :mod:`simplejson` explicitly.\n+\n+``django.utils.encoding.StrAndUnicode``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :class:`~django.utils.encoding.StrAndUnicode` mix-in has been deprecated.\n+Define a ``__str__`` method and apply the\n+:func:`~django.utils.encoding.python_2_unicode_compatible` decorator instead.\n+\n+``django.utils.itercompat.product``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :func:`~django.utils.itercompat.product` function has been deprecated. Use\n+the built-in :func:`itertools.product` instead.\n+\n+``django.utils.markup``\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The markup contrib module has been deprecated and will follow an accelerated\n+deprecation schedule. Direct use of python markup libraries or 3rd party tag\n+libraries is preferred to Django maintaining this functionality in the\n+framework.\n+\n+``cleanup`` management command\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :djadmin:`cleanup` management command has been deprecated and replaced by\n+:djadmin:`clearsessions`.\n+\n+``daily_cleanup.py`` script\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The undocumented ``daily_cleanup.py`` script has been deprecated. Use the\n+:djadmin:`clearsessions` management command instead.\n+\n+``depth`` keyword argument in ``select_related``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The ``depth`` keyword argument in\n+:meth:`~django.db.models.query.QuerySet.select_related` has been deprecated.\n+You should use field names instead."
        },
        {
            "sha": "6ac5120617079b52ae83684a2d1ab5fcf32dd0ba",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 96,
            "deletions": 4,
            "changes": 100,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -47,7 +47,7 @@ Other notable new features in Django 1.5 include:\n * ... and more; `see below <#what-s-new-in-django-1-5>`_.\n \n Wherever possible we try to introduce new features in a backwards-compatible\n-manner per :doc:`our API stability policy </misc/api-stability>` policy.\n+manner per :doc:`our API stability policy </misc/api-stability>`.\n However, as with previous releases, Django 1.5 ships with some minor\n `backwards incompatible changes`_; people upgrading from previous versions\n of Django should read that list carefully.\n@@ -68,7 +68,7 @@ Python compatibility\n ====================\n \n Django 1.5 requires Python 2.6.5 or above, though we **highly recommended**\n-Python 2.7.3 or above. Support for Python 2.5 and below as been dropped.\n+Python 2.7.3 or above. Support for Python 2.5 and below has been dropped.\n \n This change should affect only a small number of Django users, as most\n operating-system vendors today are shipping Python 2.6 or newer as their default\n@@ -88,7 +88,7 @@ Python 3 support\n Django 1.5 introduces support for Python 3 - specifically, Python\n 3.2 and above. This comes in the form of a **single** codebase; you don't\n need to install a different version of Django on Python 3. This means that\n-you can write application targeted for just Python 2, just Python 3, or single\n+you can write applications targeted for just Python 2, just Python 3, or single\n applications that support both platforms.\n \n However, we're labeling this support \"experimental\" for now: although it's\n@@ -219,6 +219,15 @@ GeoDjango\n * Support for PostGIS 2.0 has been added and support for GDAL < 1.5 has been\n   dropped.\n \n+New tutorials\n+~~~~~~~~~~~~~\n+\n+Additions to the docs include a revamped :doc:`Tutorial 3</intro/tutorial03>`\n+and a new :doc:`tutorial on testing</intro/tutorial05>`. A new section,\n+\"Advanced Tutorials\", offers :doc:`How to write reusable apps\n+</intro/reusable-apps>` as well as a step-by-step guide for new contributors in\n+:doc:`Writing your first patch for Django </intro/contributing>`.\n+\n Minor features\n ~~~~~~~~~~~~~~\n \n@@ -296,6 +305,31 @@ Django 1.5 also includes several smaller improvements worth noting:\n   you to test equality for XML content at a semantic level, without caring for\n   syntax differences (spaces, attribute order, etc.).\n \n+* RemoteUserMiddleware now forces logout when the REMOTE_USER header\n+  disappears during the same browser session.\n+\n+* The :ref:`cache-based session backend <cached-sessions-backend>` can store\n+  session data in a non-default cache.\n+\n+* Multi-column indexes can now be created on models. Read the\n+  :attr:`~django.db.models.Options.index_together` documentation for more\n+  information.\n+\n+* During Django's logging configuration verbose Deprecation warnings are\n+  enabled and warnings are captured into the logging system. Logged warnings\n+  are routed through the ``console`` logging handler, which by default requires\n+  :setting:`DEBUG` to be True for output to be generated. The result is that\n+  DeprecationWarnings should be printed to the console in development\n+  environments the way they have been in Python versions < 2.7.\n+\n+* The API for :meth:`django.contrib.admin.ModelAdmin.message_user` method has\n+  been modified to accept additional arguments adding capabilities similar to\n+  :func:`django.contrib.messages.add_message`. This is useful for generating\n+  error messages from admin actions.\n+\n+* The admin's list filters can now be customized per-request thanks to the new\n+  :meth:`django.contrib.admin.ModelAdmin.get_list_filter` method.\n+\n Backwards incompatible changes in 1.5\n =====================================\n \n@@ -307,6 +341,21 @@ Backwards incompatible changes in 1.5\n     deprecation timeline for a given feature, its removal may appear as a\n     backwards incompatible change.\n \n+Managers on abstract models\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Abstract models are able to define a custom manager, and that manager\n+:ref:`will be inherited by any concrete models extending the abstract model\n+<custom-managers-and-inheritance>`. However, if you try to use the abstract\n+model to call a method on the manager, an exception will now be raised.\n+Previously, the call would have been permitted, but would have failed as soon\n+as any database operation was attempted (usually with a \"table does not exist\"\n+error from the database).\n+\n+If you have functionality on a manager that you have been invoking using\n+the abstract class, you should migrate that logic to a Python\n+``staticmethod`` or ``classmethod`` on the abstract class.\n+\n Context in year archive class-based views\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -529,6 +578,20 @@ with the :meth:`~django.forms.Form.is_valid()` method and not with the\n presence or absence of the :attr:`~django.forms.Form.cleaned_data` attribute\n on the form.\n \n+Behavior of :djadmin:`syncdb` with multiple databases\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:djadmin:`syncdb` now queries the database routers to determine if content\n+types (when :mod:`~django.contrib.contenttypes` is enabled) and permissions\n+(when :mod:`~django.contrib.auth` is enabled) should be created in the target\n+database. Previously, it created them in the default database, even when\n+another database was specified with the :djadminopt:`--database` option.\n+\n+If you use :djadmin:`syncdb` on multiple databases, you should ensure that\n+your routers allow synchronizing content types and permissions to only one of\n+them. See the docs on the :ref:`behavior of contrib apps with multiple\n+databases <contrib_app_multiple_databases>` for more information.\n+\n Miscellaneous\n ~~~~~~~~~~~~~\n \n@@ -553,10 +616,21 @@ Miscellaneous\n   :ref:`Q() expressions <complex-lookups-with-q>` and ``QuerySet`` combining where\n   the operators are used as boolean AND and OR operators.\n \n+* In a ``filter()`` call, when :ref:`F() expressions <query-expressions>`\n+  contained lookups spanning multi-valued relations, they didn't always reuse\n+  the same relations as other lookups along the same chain. This was changed,\n+  and now F() expressions will always use the same relations as other lookups\n+  within the same ``filter()`` call.\n+\n * The :ttag:`csrf_token` template tag is no longer enclosed in a div. If you need\n   HTML validation against pre-HTML5 Strict DTDs, you should add a div around it\n   in your pages.\n \n+* The template tags library ``adminmedia``, which only contained the\n+  deprecated template tag ``{% admin_media_prefix %}``, was removed.\n+  Attempting to load it with ``{% load adminmedia %}`` will fail. If your\n+  templates still contain that line you must remove it.\n+\n Features deprecated in 1.5\n ==========================\n \n@@ -613,11 +687,29 @@ Define a ``__str__`` method and apply the\n The :func:`~django.utils.itercompat.product` function has been deprecated. Use\n the built-in :func:`itertools.product` instead.\n \n-\n ``django.utils.markup``\n ~~~~~~~~~~~~~~~~~~~~~~~\n \n The markup contrib module has been deprecated and will follow an accelerated\n deprecation schedule. Direct use of python markup libraries or 3rd party tag\n libraries is preferred to Django maintaining this functionality in the\n framework.\n+\n+``cleanup`` management command\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :djadmin:`cleanup` management command has been deprecated and replaced by\n+:djadmin:`clearsessions`.\n+\n+``daily_cleanup.py`` script\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The undocumented ``daily_cleanup.py`` script has been deprecated. Use the\n+:djadmin:`clearsessions` management command instead.\n+\n+``depth`` keyword argument in ``select_related``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The ``depth`` keyword argument in\n+:meth:`~django.db.models.query.QuerySet.select_related` has been deprecated.\n+You should use field names instead."
        },
        {
            "sha": "1f5791339721836d49ea1dee51c34f4841493a9a",
            "filename": "docs/releases/1.6.txt",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,43 @@\n+============================================\n+Django 1.6 release notes - UNDER DEVELOPMENT\n+============================================\n+\n+Welcome to Django 1.6!\n+\n+These release notes cover the `new features`_, as well as some `backwards\n+incompatible changes`_ you'll want to be aware of when upgrading from Django\n+1.5 or older versions. We've also dropped some features, which are detailed in\n+:doc:`our deprecation plan </internals/deprecation>`, and we've `begun the\n+deprecation process for some features`_.\n+\n+.. _`new features`: `What's new in Django 1.6`_\n+.. _`backwards incompatible changes`: `Backwards incompatible changes in 1.6`_\n+.. _`begun the deprecation process for some features`: `Features deprecated in 1.6`_\n+\n+What's new in Django 1.6\n+========================\n+\n+Minor features\n+~~~~~~~~~~~~~~\n+\n+* Authentication backends can raise ``PermissionDenied`` to immediately fail\n+  the authentication chain.\n+\n+* The ``assertQuerysetEqual()`` now checks for undefined order and raises\n+  ``ValueError`` if undefined order is spotted. The order is seen as\n+  undefined if the given ``QuerySet`` isn't ordered and there are more than\n+  one ordered values to compare against.\n+\n+Backwards incompatible changes in 1.6\n+=====================================\n+\n+.. warning::\n+\n+    In addition to the changes outlined in this section, be sure to review the\n+    :doc:`deprecation plan </internals/deprecation>` for any features that\n+    have been removed. If you haven't updated your code within the\n+    deprecation timeline for a given feature, its removal may appear as a\n+    backwards incompatible change.\n+\n+Features deprecated in 1.6\n+=========================="
        },
        {
            "sha": "b0cd87a16866e5beb07544143c694cd62045fa03",
            "filename": "docs/releases/index.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Freleases%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,6 +16,13 @@ Final releases\n \n .. _development_release_notes:\n \n+1.6 release\n+-----------\n+.. toctree::\n+   :maxdepth: 1\n+\n+   1.6\n+\n 1.5 release\n -----------\n .. toctree::\n@@ -92,6 +99,7 @@ notes.\n .. toctree::\n    :maxdepth: 1\n \n+   1.5-beta-1\n    1.5-alpha-1\n    1.4-beta-1\n    1.4-alpha-1"
        },
        {
            "sha": "7211c0f3bee50e8eef6ae29a97e516fd26a806ed",
            "filename": "docs/topics/_images/django_unittest_classes_hierarchy.graffle",
            "status": "added",
            "additions": 883,
            "deletions": 0,
            "changes": 883,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.graffle",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.graffle",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.graffle?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,883 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n+<plist version=\"1.0\">\n+<dict>\n+\t<key>ActiveLayerIndex</key>\n+\t<integer>0</integer>\n+\t<key>ApplicationVersion</key>\n+\t<array>\n+\t\t<string>com.omnigroup.OmniGrafflePro</string>\n+\t\t<string>139.16.0.171715</string>\n+\t</array>\n+\t<key>AutoAdjust</key>\n+\t<true/>\n+\t<key>BackgroundGraphic</key>\n+\t<dict>\n+\t\t<key>Bounds</key>\n+\t\t<string>{{0, 0}, {559.28997802734375, 782.8900146484375}}</string>\n+\t\t<key>Class</key>\n+\t\t<string>SolidGraphic</string>\n+\t\t<key>ID</key>\n+\t\t<integer>2</integer>\n+\t\t<key>Style</key>\n+\t\t<dict>\n+\t\t\t<key>shadow</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Draws</key>\n+\t\t\t\t<string>NO</string>\n+\t\t\t</dict>\n+\t\t\t<key>stroke</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Draws</key>\n+\t\t\t\t<string>NO</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t</dict>\n+\t<key>BaseZoom</key>\n+\t<integer>0</integer>\n+\t<key>CanvasOrigin</key>\n+\t<string>{0, 0}</string>\n+\t<key>ColumnAlign</key>\n+\t<integer>1</integer>\n+\t<key>ColumnSpacing</key>\n+\t<real>36</real>\n+\t<key>CreationDate</key>\n+\t<string>2012-12-16 18:52:14 +0000</string>\n+\t<key>Creator</key>\n+\t<string>Aymeric Augustin</string>\n+\t<key>DisplayScale</key>\n+\t<string>1.000 cm = 1.000 cm</string>\n+\t<key>GraphDocumentVersion</key>\n+\t<integer>8</integer>\n+\t<key>GraphicsList</key>\n+\t<array>\n+\t\t<dict>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>LineGraphic</string>\n+\t\t\t<key>Head</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>8</integer>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>29</integer>\n+\t\t\t<key>OrthogonalBarAutomatic</key>\n+\t\t\t<true/>\n+\t\t\t<key>OrthogonalBarPoint</key>\n+\t\t\t<string>{0, 0}</string>\n+\t\t\t<key>OrthogonalBarPosition</key>\n+\t\t\t<real>-1</real>\n+\t\t\t<key>Points</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{369, 459}</string>\n+\t\t\t\t<string>{216, 400.5}</string>\n+\t\t\t</array>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>HeadArrow</key>\n+\t\t\t\t\t<string>UMLInheritance</string>\n+\t\t\t\t\t<key>HeadScale</key>\n+\t\t\t\t\t<real>0.79999995231628418</real>\n+\t\t\t\t\t<key>Legacy</key>\n+\t\t\t\t\t<true/>\n+\t\t\t\t\t<key>LineType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>TailArrow</key>\n+\t\t\t\t\t<string>0</string>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Tail</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>6</integer>\n+\t\t\t\t<key>Info</key>\n+\t\t\t\t<integer>2</integer>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>LineGraphic</string>\n+\t\t\t<key>Head</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>12</integer>\n+\t\t\t\t<key>Info</key>\n+\t\t\t\t<integer>1</integer>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>27</integer>\n+\t\t\t<key>OrthogonalBarAutomatic</key>\n+\t\t\t<true/>\n+\t\t\t<key>OrthogonalBarPoint</key>\n+\t\t\t<string>{0, 0}</string>\n+\t\t\t<key>OrthogonalBarPosition</key>\n+\t\t\t<real>-1</real>\n+\t\t\t<key>Points</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{135, 270}</string>\n+\t\t\t\t<string>{369, 225}</string>\n+\t\t\t</array>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>HeadArrow</key>\n+\t\t\t\t\t<string>UMLInheritance</string>\n+\t\t\t\t\t<key>HeadScale</key>\n+\t\t\t\t\t<real>0.79999995231628418</real>\n+\t\t\t\t\t<key>Legacy</key>\n+\t\t\t\t\t<true/>\n+\t\t\t\t\t<key>LineType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>TailArrow</key>\n+\t\t\t\t\t<string>0</string>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Tail</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>26</integer>\n+\t\t\t\t<key>Position</key>\n+\t\t\t\t<real>0.5</real>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>LineGraphic</string>\n+\t\t\t<key>Head</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>10</integer>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>26</integer>\n+\t\t\t<key>OrthogonalBarAutomatic</key>\n+\t\t\t<true/>\n+\t\t\t<key>OrthogonalBarPoint</key>\n+\t\t\t<string>{0, 0}</string>\n+\t\t\t<key>OrthogonalBarPosition</key>\n+\t\t\t<real>-1</real>\n+\t\t\t<key>Points</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{135, 315}</string>\n+\t\t\t\t<string>{135, 225}</string>\n+\t\t\t</array>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>HeadArrow</key>\n+\t\t\t\t\t<string>UMLInheritance</string>\n+\t\t\t\t\t<key>HeadScale</key>\n+\t\t\t\t\t<real>0.79999995231628418</real>\n+\t\t\t\t\t<key>Legacy</key>\n+\t\t\t\t\t<true/>\n+\t\t\t\t\t<key>LineType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>TailArrow</key>\n+\t\t\t\t\t<string>0</string>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Tail</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>9</integer>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>LineGraphic</string>\n+\t\t\t<key>Head</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>9</integer>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>25</integer>\n+\t\t\t<key>OrthogonalBarAutomatic</key>\n+\t\t\t<true/>\n+\t\t\t<key>OrthogonalBarPoint</key>\n+\t\t\t<string>{0, 0}</string>\n+\t\t\t<key>OrthogonalBarPosition</key>\n+\t\t\t<real>-1</real>\n+\t\t\t<key>Points</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{135, 387}</string>\n+\t\t\t\t<string>{135, 342}</string>\n+\t\t\t</array>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>HeadArrow</key>\n+\t\t\t\t\t<string>UMLInheritance</string>\n+\t\t\t\t\t<key>HeadScale</key>\n+\t\t\t\t\t<real>0.79999995231628418</real>\n+\t\t\t\t\t<key>Legacy</key>\n+\t\t\t\t\t<true/>\n+\t\t\t\t\t<key>LineType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>TailArrow</key>\n+\t\t\t\t\t<string>0</string>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Tail</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>8</integer>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>LineGraphic</string>\n+\t\t\t<key>Head</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>8</integer>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>23</integer>\n+\t\t\t<key>OrthogonalBarAutomatic</key>\n+\t\t\t<true/>\n+\t\t\t<key>OrthogonalBarPoint</key>\n+\t\t\t<string>{0, 0}</string>\n+\t\t\t<key>OrthogonalBarPosition</key>\n+\t\t\t<real>-1</real>\n+\t\t\t<key>Points</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{135, 459}</string>\n+\t\t\t\t<string>{135, 414}</string>\n+\t\t\t</array>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>HeadArrow</key>\n+\t\t\t\t\t<string>UMLInheritance</string>\n+\t\t\t\t\t<key>HeadScale</key>\n+\t\t\t\t\t<real>0.79999995231628418</real>\n+\t\t\t\t\t<key>Legacy</key>\n+\t\t\t\t\t<true/>\n+\t\t\t\t\t<key>LineType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>TailArrow</key>\n+\t\t\t\t\t<string>0</string>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Tail</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>ID</key>\n+\t\t\t\t<integer>7</integer>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{378, 252}, {81, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>FontInfo</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Font</key>\n+\t\t\t\t<string>Helvetica</string>\n+\t\t\t\t<key>Size</key>\n+\t\t\t\t<real>12</real>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>22</integer>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>NoteShape</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0.501961</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fswiss\\fcharset0 Helvetica;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red0\\green128\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\i\\fs24 \\cf2 Python &lt; 2.7}</string>\n+\t\t\t\t<key>VerticalPad</key>\n+\t\t\t\t<integer>0</integer>\n+\t\t\t</dict>\n+\t\t\t<key>TextRelativeArea</key>\n+\t\t\t<string>{{0, 0}, {1, 1}}</string>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{45, 252}, {81, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>FontInfo</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Font</key>\n+\t\t\t\t<string>Helvetica</string>\n+\t\t\t\t<key>Size</key>\n+\t\t\t\t<real>12</real>\n+\t\t\t</dict>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>20</integer>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>NoteShape</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0.501961</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fswiss\\fcharset0 Helvetica;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red0\\green128\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\i\\fs24 \\cf2 Python \\uc0\\u8805  2.7}</string>\n+\t\t\t\t<key>VerticalPad</key>\n+\t\t\t\t<integer>0</integer>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{288, 198}, {162, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>12</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 TestCase}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{54, 198}, {162, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>10</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 TestCase}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{54, 315}, {162, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>9</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 SimpleTestCase}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{54, 387}, {162, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>8</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 TransactionTestCase}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{54, 459}, {162, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>7</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 TestCase}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{288, 459}, {162, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>6</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 LiveServerTestCase}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{18, 297}, {468, 207}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>13</integer>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict/>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Align</key>\n+\t\t\t\t<integer>2</integer>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qr\n+\n+\\f0\\fs24 \\cf0 django.test}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextPlacement</key>\n+\t\t\t<integer>0</integer>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{18, 153}, {225, 90}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>18</integer>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict/>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Align</key>\n+\t\t\t\t<integer>2</integer>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qr\n+\n+\\f0\\fs24 \\cf0 django.utils.unittest\\\n+= unittest (standard library)}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextPlacement</key>\n+\t\t\t<integer>0</integer>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{261, 153}, {225, 90}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>19</integer>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict/>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Align</key>\n+\t\t\t\t<integer>2</integer>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qr\n+\n+\\f0\\fs24 \\cf0 django.utils.unittest\\\n+= unittest2 (bundled copy)}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextPlacement</key>\n+\t\t\t<integer>0</integer>\n+\t\t</dict>\n+\t</array>\n+\t<key>GridInfo</key>\n+\t<dict>\n+\t\t<key>ShowsGrid</key>\n+\t\t<string>YES</string>\n+\t\t<key>SnapsToGrid</key>\n+\t\t<string>YES</string>\n+\t</dict>\n+\t<key>GuidesLocked</key>\n+\t<string>NO</string>\n+\t<key>GuidesVisible</key>\n+\t<string>YES</string>\n+\t<key>HPages</key>\n+\t<integer>1</integer>\n+\t<key>ImageCounter</key>\n+\t<integer>1</integer>\n+\t<key>KeepToScale</key>\n+\t<false/>\n+\t<key>Layers</key>\n+\t<array>\n+\t\t<dict>\n+\t\t\t<key>Lock</key>\n+\t\t\t<string>NO</string>\n+\t\t\t<key>Name</key>\n+\t\t\t<string>Calque 1</string>\n+\t\t\t<key>Print</key>\n+\t\t\t<string>YES</string>\n+\t\t\t<key>View</key>\n+\t\t\t<string>YES</string>\n+\t\t</dict>\n+\t</array>\n+\t<key>LayoutInfo</key>\n+\t<dict>\n+\t\t<key>Animate</key>\n+\t\t<string>NO</string>\n+\t\t<key>circoMinDist</key>\n+\t\t<real>18</real>\n+\t\t<key>circoSeparation</key>\n+\t\t<real>0.0</real>\n+\t\t<key>layoutEngine</key>\n+\t\t<string>dot</string>\n+\t\t<key>neatoSeparation</key>\n+\t\t<real>0.0</real>\n+\t\t<key>twopiSeparation</key>\n+\t\t<real>0.0</real>\n+\t</dict>\n+\t<key>LinksVisible</key>\n+\t<string>NO</string>\n+\t<key>MagnetsVisible</key>\n+\t<string>NO</string>\n+\t<key>MasterSheets</key>\n+\t<array/>\n+\t<key>ModificationDate</key>\n+\t<string>2012-12-16 19:08:28 +0000</string>\n+\t<key>Modifier</key>\n+\t<string>Aymeric Augustin</string>\n+\t<key>NotesVisible</key>\n+\t<string>NO</string>\n+\t<key>Orientation</key>\n+\t<integer>2</integer>\n+\t<key>OriginVisible</key>\n+\t<string>NO</string>\n+\t<key>PageBreaks</key>\n+\t<string>YES</string>\n+\t<key>PrintInfo</key>\n+\t<dict>\n+\t\t<key>NSBottomMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>41</string>\n+\t\t</array>\n+\t\t<key>NSHorizonalPagination</key>\n+\t\t<array>\n+\t\t\t<string>coded</string>\n+\t\t\t<string>BAtzdHJlYW10eXBlZIHoA4QBQISEhAhOU051bWJlcgCEhAdOU1ZhbHVlAISECE5TT2JqZWN0AIWEASqEhAFxlwCG</string>\n+\t\t</array>\n+\t\t<key>NSLeftMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>18</string>\n+\t\t</array>\n+\t\t<key>NSPaperSize</key>\n+\t\t<array>\n+\t\t\t<string>size</string>\n+\t\t\t<string>{595.28997802734375, 841.8900146484375}</string>\n+\t\t</array>\n+\t\t<key>NSPrintReverseOrientation</key>\n+\t\t<array>\n+\t\t\t<string>int</string>\n+\t\t\t<string>0</string>\n+\t\t</array>\n+\t\t<key>NSRightMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>18</string>\n+\t\t</array>\n+\t\t<key>NSTopMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>18</string>\n+\t\t</array>\n+\t</dict>\n+\t<key>PrintOnePage</key>\n+\t<false/>\n+\t<key>ReadOnly</key>\n+\t<string>NO</string>\n+\t<key>RowAlign</key>\n+\t<integer>1</integer>\n+\t<key>RowSpacing</key>\n+\t<real>36</real>\n+\t<key>SheetTitle</key>\n+\t<string>Canevas 1</string>\n+\t<key>SmartAlignmentGuidesActive</key>\n+\t<string>YES</string>\n+\t<key>SmartDistanceGuidesActive</key>\n+\t<string>YES</string>\n+\t<key>UniqueID</key>\n+\t<integer>1</integer>\n+\t<key>UseEntirePage</key>\n+\t<false/>\n+\t<key>VPages</key>\n+\t<integer>1</integer>\n+\t<key>WindowInfo</key>\n+\t<dict>\n+\t\t<key>CurrentSheet</key>\n+\t\t<integer>0</integer>\n+\t\t<key>ExpandedCanvases</key>\n+\t\t<array/>\n+\t\t<key>Frame</key>\n+\t\t<string>{{9, 4}, {694, 874}}</string>\n+\t\t<key>ListView</key>\n+\t\t<true/>\n+\t\t<key>OutlineWidth</key>\n+\t\t<integer>142</integer>\n+\t\t<key>RightSidebar</key>\n+\t\t<false/>\n+\t\t<key>ShowRuler</key>\n+\t\t<true/>\n+\t\t<key>Sidebar</key>\n+\t\t<true/>\n+\t\t<key>SidebarWidth</key>\n+\t\t<integer>120</integer>\n+\t\t<key>VisibleRegion</key>\n+\t\t<string>{{0, 0}, {559, 735}}</string>\n+\t\t<key>Zoom</key>\n+\t\t<real>1</real>\n+\t\t<key>ZoomValues</key>\n+\t\t<array>\n+\t\t\t<array>\n+\t\t\t\t<string>Canevas 1</string>\n+\t\t\t\t<real>1</real>\n+\t\t\t\t<real>1</real>\n+\t\t\t</array>\n+\t\t</array>\n+\t</dict>\n+</dict>\n+</plist>"
        },
        {
            "sha": "cedaba22ac7f5e26690d43ddf9aa081c2c28eedb",
            "filename": "docs/topics/_images/django_unittest_classes_hierarchy.pdf",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.pdf",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.pdf",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.pdf?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3"
        },
        {
            "sha": "5f28b56ed665be434da49d16010f7cda700eba8b",
            "filename": "docs/topics/_images/django_unittest_classes_hierarchy.png",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.png",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.png?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "0482f044dd8ce0593aa286b1f36a6383468a14eb",
            "filename": "docs/topics/_images/django_unittest_classes_hierarchy.svg",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.svg",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.svg",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2F_images%2Fdjango_unittest_classes_hierarchy.svg?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,3 @@\n+<?xml version=\"1.0\"?>\n+<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"-2 137 508 391\" width=\"508pt\" height=\"391pt\"><metadata xmlns:dc=\"http://purl.org/dc/elements/1.1/\"><dc:date>2012-12-16 19:08Z</dc:date><!-- Produced by OmniGraffle Professional 5.4.2 --></metadata><defs><filter id=\"Shadow\" filterUnits=\"userSpaceOnUse\"><feGaussianBlur in=\"SourceAlpha\" result=\"blur\" stdDeviation=\"3.488\"/><feOffset in=\"blur\" result=\"offset\" dx=\"0\" dy=\"4\"/><feFlood flood-color=\"black\" flood-opacity=\".75\" result=\"flood\"/><feComposite in=\"flood\" in2=\"offset\" operator=\"in\"/></filter><font-face font-family=\"Courier\" font-size=\"12\" units-per-em=\"1000\" underline-position=\"-178.22266\" underline-thickness=\"57.617188\" slope=\"0\" x-height=\"462.40234\" cap-height=\"594.72656\" ascent=\"753.90625\" descent=\"-246.09375\" font-weight=\"500\"><font-face-src><font-face-name name=\"Courier\"/></font-face-src></font-face><linearGradient x1=\"0\" x2=\"1\" id=\"Gradient\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"white\"/><stop offset=\"1\" stop-color=\"#aaa\"/></linearGradient><linearGradient id=\"Obj_Gradient\" xl:href=\"#Gradient\" gradientTransform=\"translate(369 459) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_2\" xl:href=\"#Gradient\" gradientTransform=\"translate(135 459) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_3\" xl:href=\"#Gradient\" gradientTransform=\"translate(135 387) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_4\" xl:href=\"#Gradient\" gradientTransform=\"translate(135 315) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_5\" xl:href=\"#Gradient\" gradientTransform=\"translate(135 198) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_6\" xl:href=\"#Gradient\" gradientTransform=\"translate(369 198) rotate(90) scale(27)\"/><font-face font-family=\"Helvetica\" font-size=\"12\" units-per-em=\"1000\" underline-position=\"-75.683594\" underline-thickness=\"49.316406\" slope=\"-1e3\" x-height=\"522.94922\" cap-height=\"717.28516\" ascent=\"770.01953\" descent=\"-229.98047\" font-style=\"italic\" font-weight=\"500\"><font-face-src><font-face-name name=\"Helvetica-Oblique\"/></font-face-src></font-face><marker orient=\"auto\" overflow=\"visible\" markerUnits=\"strokeWidth\" id=\"UMLInheritance_Marker\" viewBox=\"-1 -7 12 14\" markerWidth=\"12\" markerHeight=\"14\" color=\"black\"><g><path d=\"M 9.5999994 0 L 0 -5.5999997 L 0 5.5999997 Z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/></g></marker></defs><g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"><title>Canevas 1</title><rect fill=\"white\" width=\"559.28998\" height=\"782.89\"/><g><title>Calque 1</title><g><use xl:href=\"#id19_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id18_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id13_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id6_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id7_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id8_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id9_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id10_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id12_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id20_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id22_Graphic\" filter=\"url(#Shadow)\"/></g><g id=\"id19_Graphic\"><rect x=\"261\" y=\"153\" width=\"225\" height=\"90\" fill=\"white\"/><rect x=\"261\" y=\"153\" width=\"225\" height=\"90\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(266 158)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"63.77539\" y=\"11\" textLength=\"151.22461\">django.utils.unittest</tspan><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"27.769531\" y=\"25\" textLength=\"187.23047\">= unittest2 (bundled copy)</tspan></text></g><g id=\"id18_Graphic\"><rect x=\"18\" y=\"153\" width=\"225\" height=\"90\" fill=\"white\"/><rect x=\"18\" y=\"153\" width=\"225\" height=\"90\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(23 158)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"63.77539\" y=\"11\" textLength=\"151.22461\">django.utils.unittest</tspan><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"6.1660156\" y=\"25\" textLength=\"208.83398\">= unittest (standard library)</tspan></text></g><g id=\"id13_Graphic\"><rect x=\"18\" y=\"297\" width=\"468\" height=\"207\" fill=\"white\"/><rect x=\"18\" y=\"297\" width=\"468\" height=\"207\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(23 302)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"378.7871\" y=\"11\" textLength=\"79.21289\">django.test</tspan></text></g><g id=\"id6_Graphic\"><path d=\"M 293 459 L 445 459 C 447.76142 459 450 461.23858 450 464 L 450 481 C 450 483.76142 447.76142 486 445 486 L 293 486 C 290.23858 486 288 483.76142 288 481 C 288 481 288 481 288 481 L 288 464 C 288 461.23858 290.23858 459 293 459 C 293 459 293 459 293 459 Z\" fill=\"url(#Obj_Gradient)\"/><path d=\"M 293 459 L 445 459 C 447.76142 459 450 461.23858 450 464 L 450 481 C 450 483.76142 447.76142 486 445 486 L 293 486 C 290.23858 486 288 483.76142 288 481 C 288 481 288 481 288 481 L 288 464 C 288 461.23858 290.23858 459 293 459 C 293 459 293 459 293 459 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(293 465.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"11.189453\" y=\"11\" textLength=\"129.62109\">LiveServerTestCase</tspan></text></g><g id=\"id7_Graphic\"><path d=\"M 59 459 L 211 459 C 213.76142 459 216 461.23858 216 464 L 216 481 C 216 483.76142 213.76142 486 211 486 L 59 486 C 56.238576 486 54 483.76142 54 481 C 54 481 54 481 54 481 L 54 464 C 54 461.23858 56.238576 459 59 459 C 59 459 59 459 59 459 Z\" fill=\"url(#Obj_Gradient_2)\"/><path d=\"M 59 459 L 211 459 C 213.76142 459 216 461.23858 216 464 L 216 481 C 216 483.76142 213.76142 486 211 486 L 59 486 C 56.238576 486 54 483.76142 54 481 C 54 481 54 481 54 481 L 54 464 C 54 461.23858 56.238576 459 59 459 C 59 459 59 459 59 459 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(59 465.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"47.195312\" y=\"11\" textLength=\"57.609375\">TestCase</tspan></text></g><g id=\"id8_Graphic\"><path d=\"M 59 387 L 211 387 C 213.76142 387 216 389.23858 216 392 L 216 409 C 216 411.76142 213.76142 414 211 414 L 59 414 C 56.238576 414 54 411.76142 54 409 C 54 409 54 409 54 409 L 54 392 C 54 389.23858 56.238576 387 59 387 C 59 387 59 387 59 387 Z\" fill=\"url(#Obj_Gradient_3)\"/><path d=\"M 59 387 L 211 387 C 213.76142 387 216 389.23858 216 392 L 216 409 C 216 411.76142 213.76142 414 211 414 L 59 414 C 56.238576 414 54 411.76142 54 409 C 54 409 54 409 54 409 L 54 392 C 54 389.23858 56.238576 387 59 387 C 59 387 59 387 59 387 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(59 393.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"7.588867\" y=\"11\" textLength=\"136.822266\">TransactionTestCase</tspan></text></g><g id=\"id9_Graphic\"><path d=\"M 59 315 L 211 315 C 213.76142 315 216 317.23858 216 320 L 216 337 C 216 339.76142 213.76142 342 211 342 L 59 342 C 56.238576 342 54 339.76142 54 337 C 54 337 54 337 54 337 L 54 320 C 54 317.23858 56.238576 315 59 315 C 59 315 59 315 59 315 Z\" fill=\"url(#Obj_Gradient_4)\"/><path d=\"M 59 315 L 211 315 C 213.76142 315 216 317.23858 216 320 L 216 337 C 216 339.76142 213.76142 342 211 342 L 59 342 C 56.238576 342 54 339.76142 54 337 C 54 337 54 337 54 337 L 54 320 C 54 317.23858 56.238576 315 59 315 C 59 315 59 315 59 315 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(59 321.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"25.591797\" y=\"11\" textLength=\"100.816406\">SimpleTestCase</tspan></text></g><g id=\"id10_Graphic\"><path d=\"M 59 198 L 211 198 C 213.76142 198 216 200.23858 216 203 L 216 220 C 216 222.76142 213.76142 225 211 225 L 59 225 C 56.238576 225 54 222.76142 54 220 C 54 220 54 220 54 220 L 54 203 C 54 200.23858 56.238576 198 59 198 C 59 198 59 198 59 198 Z\" fill=\"url(#Obj_Gradient_5)\"/><path d=\"M 59 198 L 211 198 C 213.76142 198 216 200.23858 216 203 L 216 220 C 216 222.76142 213.76142 225 211 225 L 59 225 C 56.238576 225 54 222.76142 54 220 C 54 220 54 220 54 220 L 54 203 C 54 200.23858 56.238576 198 59 198 C 59 198 59 198 59 198 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(59 204.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"47.195312\" y=\"11\" textLength=\"57.609375\">TestCase</tspan></text></g><g id=\"id12_Graphic\"><path d=\"M 293 198 L 445 198 C 447.76142 198 450 200.23858 450 203 L 450 220 C 450 222.76142 447.76142 225 445 225 L 293 225 C 290.23858 225 288 222.76142 288 220 C 288 220 288 220 288 220 L 288 203 C 288 200.23858 290.23858 198 293 198 C 293 198 293 198 293 198 Z\" fill=\"url(#Obj_Gradient_6)\"/><path d=\"M 293 198 L 445 198 C 447.76142 198 450 200.23858 450 203 L 450 220 C 450 222.76142 447.76142 225 445 225 L 293 225 C 290.23858 225 288 222.76142 288 220 C 288 220 288 220 288 220 L 288 203 C 288 200.23858 290.23858 198 293 198 C 293 198 293 198 293 198 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(293 204.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"47.195312\" y=\"11\" textLength=\"57.609375\">TestCase</tspan></text></g><g id=\"id20_Graphic\"><path d=\"M 126 259.9893 C 126 257.43159 124.9713 257.11515 117.45693 254.5839 L 117.37755 254.55771 C 109.82349 252 109.74492 252 101.99241 252 C 91.66977 252 45 252 45 252 L 45 279 L 126 279 L 126 259.9893 Z\" fill=\"white\"/><path d=\"M 126 259.9893 C 126 257.43159 124.9713 257.11515 117.45693 254.5839 L 117.37755 254.55771 C 109.82349 252 109.74492 252 101.99241 252 C 91.66977 252 45 252 45 252 L 45 279 L 126 279 L 126 259.9893 Z M 126 259.85754 C 126 257.43159 125.92062 257.43159 109.74492 257.43159 L 109.74492 257.43159 C 109.74492 252.02646 109.74492 252 102.46707 252\" stroke=\"green\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(50 258.5)\" fill=\"green\"><tspan font-family=\"Helvetica\" font-size=\"12\" font-style=\"italic\" font-weight=\"500\" fill=\"green\" x=\"1.8525391\" y=\"11\" textLength=\"67.29492\">Python ≥ 2.7</tspan></text></g><g id=\"id22_Graphic\"><path d=\"M 459 259.9893 C 459 257.43159 457.9713 257.11515 450.45693 254.5839 L 450.37755 254.55771 C 442.8235 252 442.74492 252 434.9924 252 C 424.66977 252 378 252 378 252 L 378 279 L 459 279 L 459 259.9893 Z\" fill=\"white\"/><path d=\"M 459 259.9893 C 459 257.43159 457.9713 257.11515 450.45693 254.5839 L 450.37755 254.55771 C 442.8235 252 442.74492 252 434.9924 252 C 424.66977 252 378 252 378 252 L 378 279 L 459 279 L 459 259.9893 Z M 459 259.85754 C 459 257.43159 458.92062 257.43159 442.74492 257.43159 L 442.74492 257.43159 C 442.74492 252.02646 442.74492 252 435.46707 252\" stroke=\"green\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(383 258.5)\" fill=\"green\"><tspan font-family=\"Helvetica\" font-size=\"12\" font-style=\"italic\" font-weight=\"500\" fill=\"green\" x=\"1.6416016\" y=\"11\" textLength=\"67.716797\">Python &lt; 2.7</tspan></text></g><path d=\"M 135 459 L 135 445.9 L 135 427.1 L 135 425.1\" marker-end=\"url(#UMLInheritance_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><path d=\"M 135 387 L 135 373.9 L 135 355.1 L 135 353.1\" marker-end=\"url(#UMLInheritance_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><path d=\"M 135 315 L 135 301.9 L 135 238.1 L 135 236.1\" marker-end=\"url(#UMLInheritance_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><path d=\"M 135 270 L 148.1 270 L 369 270 L 369 238.1 L 369 236.1\" marker-end=\"url(#UMLInheritance_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><path d=\"M 369 459 L 369 445.9 L 369 400.5 L 229.1 400.5 L 227.1 400.5\" marker-end=\"url(#UMLInheritance_Marker)\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/></g></g></svg>"
        },
        {
            "sha": "3e2b6bbdbf42297233b528e40ac55cccde29a4a0",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 158,
            "deletions": 5,
            "changes": 163,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -408,7 +408,7 @@ installation supports. The first entry in this list (that is,\n ``settings.PASSWORD_HASHERS[0]``) will be used to store passwords, and all the\n other entries are valid hashers that can be used to check existing passwords.\n This means that if you want to use a different algorithm, you'll need to modify\n-:setting:`PASSWORD_HASHERS` to list your prefered algorithm first in the list.\n+:setting:`PASSWORD_HASHERS` to list your preferred algorithm first in the list.\n \n The default for :setting:`PASSWORD_HASHERS` is::\n \n@@ -1889,7 +1889,7 @@ password resets. You must then provide some key implementation details:\n         as the identifying field::\n \n             class MyUser(AbstractBaseUser):\n-                identfier = models.CharField(max_length=40, unique=True, db_index=True)\n+                identifier = models.CharField(max_length=40, unique=True, db_index=True)\n                 ...\n                 USERNAME_FIELD = 'identifier'\n \n@@ -1911,6 +1911,15 @@ password resets. You must then provide some key implementation details:\n             ``REQUIRED_FIELDS`` must contain all required fields on your User\n             model, but should *not* contain the ``USERNAME_FIELD``.\n \n+    .. attribute:: User.is_active\n+\n+        A boolean attribute that indicates whether the user is considered\n+        \"active\".  This attribute is provided as an attribute on\n+        ``AbstractBaseUser`` defaulting to ``True``. How you choose to\n+        implement it will depend on the details of your chosen auth backends.\n+        See the documentation of the :attr:`attribute on the builtin user model\n+        <django.contrib.auth.models.User.is_active>` for details.\n+\n     .. method:: User.get_full_name():\n \n         A longer formal identifier for the user. A common interpretation\n@@ -2000,7 +2009,7 @@ additional methods:\n \n     .. method:: models.CustomUserManager.create_superuser(*username_field*, password, **other_fields)\n \n-        The prototype of `create_user()` should accept the username field,\n+        The prototype of `create_superuser()` should accept the username field,\n         plus all required fields as arguments. For example, if your user model\n         uses `email` as the username field, and has `date_of_birth` as a required\n         fields, then create_superuser should be defined as::\n@@ -2127,6 +2136,76 @@ override any of the definitions that refer to fields on\n :class:`~django.contrib.auth.models.AbstractUser` that aren't on your\n custom User class.\n \n+Custom users and permissions\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+To make it easy to include Django's permission framework into your own User\n+class, Django provides :class:`~django.contrib.auth.model.PermissionsMixin`.\n+This is an abstract model you can include in the class heirarchy for your User\n+model, giving you all the methods and database fields necessary to support\n+Django's permission model.\n+\n+:class:`~django.contrib.auth.model.PermissionsMixin` provides the following\n+methods and attributes:\n+\n+.. class:: models.PermissionsMixin\n+\n+    .. attribute:: models.PermissionsMixin.is_superuser\n+\n+        Boolean. Designates that this user has all permissions without\n+        explicitly assigning them.\n+\n+    .. method:: models.PermissionsMixin.get_group_permissions(obj=None)\n+\n+        Returns a set of permission strings that the user has, through his/her\n+        groups.\n+\n+        If ``obj`` is passed in, only returns the group permissions for\n+        this specific object.\n+\n+    .. method:: models.PermissionsMixin.get_all_permissions(obj=None)\n+\n+        Returns a set of permission strings that the user has, both through\n+        group and user permissions.\n+\n+        If ``obj`` is passed in, only returns the permissions for this\n+        specific object.\n+\n+    .. method:: models.PermissionsMixin.has_perm(perm, obj=None)\n+\n+        Returns ``True`` if the user has the specified permission, where perm is\n+        in the format ``\"<app label>.<permission codename>\"`` (see\n+        `permissions`_). If the user is inactive, this method will\n+        always return ``False``.\n+\n+        If ``obj`` is passed in, this method won't check for a permission for\n+        the model, but for this specific object.\n+\n+    .. method:: models.PermissionsMixin.has_perms(perm_list, obj=None)\n+\n+        Returns ``True`` if the user has each of the specified permissions,\n+        where each perm is in the format\n+        ``\"<app label>.<permission codename>\"``. If the user is inactive,\n+        this method will always return ``False``.\n+\n+        If ``obj`` is passed in, this method won't check for permissions for\n+        the model, but for the specific object.\n+\n+    .. method:: models.PermissionsMixin.has_module_perms(package_name)\n+\n+        Returns ``True`` if the user has any permissions in the given package\n+        (the Django app label). If the user is inactive, this method will\n+        always return ``False``.\n+\n+.. admonition:: ModelBackend\n+\n+    If you don't include the\n+    :class:`~django.contrib.auth.model.PermissionsMixin`, you must ensure you\n+    don't invoke the permissions methods on ``ModelBackend``. ``ModelBackend``\n+    assumes that certain fields are available on your user model. If your User\n+    model doesn't provide  those fields, you will receive database errors when\n+    you check permissions.\n+\n Custom users and Proxy models\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -2139,6 +2218,68 @@ If your project uses proxy models, you must either modify the proxy to extend\n the User model that is currently in use in your project, or merge your proxy's\n behavior into your User subclass.\n \n+Custom users and signals\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Another limitation of custom User models is that you can't use\n+:func:`django.contrib.auth.get_user_model()` as the sender or target of a signal\n+handler. Instead, you must register the handler with the actual User model.\n+\n+Custom users and testing/fixtures\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If you are writing an application that interacts with the User model, you must\n+take some precautions to ensure that your test suite will run regardless of\n+the User model that is being used by a project. Any test that instantiates an\n+instance of User will fail if the User model has been swapped out. This\n+includes any attempt to create an instance of User with a fixture.\n+\n+To ensure that your test suite will pass in any project configuration,\n+``django.contrib.auth.tests.utils`` defines a ``@skipIfCustomUser`` decorator.\n+This decorator will cause a test case to be skipped if any User model other\n+than the default Django user is in use. This decorator can be applied to a\n+single test, or to an entire test class.\n+\n+Depending on your application, tests may also be needed to be added to ensure\n+that the application works with *any* user model, not just the default User\n+model. To assist with this, Django provides two substitute user models that\n+can be used in test suites:\n+\n+* :class:`django.contrib.auth.tests.custom_user.CustomUser`, a custom user\n+  model that uses an ``email`` field as the username, and has a basic\n+  admin-compliant permissions setup\n+\n+* :class:`django.contrib.auth.tests.custom_user.ExtensionUser`, a custom\n+  user model that extends :class:`~django.contrib.auth.models.AbstractUser`,\n+  adding a ``date_of_birth`` field.\n+\n+You can then use the ``@override_settings`` decorator to make that test run\n+with the custom User model. For example, here is a skeleton for a test that\n+would test three possible User models -- the default, plus the two User\n+models provided by ``auth`` app::\n+\n+    from django.contrib.auth.tests.utils import skipIfCustomUser\n+    from django.test import TestCase\n+    from django.test.utils import override_settings\n+\n+\n+    class ApplicationTestCase(TestCase):\n+        @skipIfCustomUser\n+        def test_normal_user(self):\n+            \"Run tests for the normal user model\"\n+            self.assertSomething()\n+\n+        @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+        def test_custom_user(self):\n+            \"Run tests for a custom user model with email-based authentication\"\n+            self.assertSomething()\n+\n+        @override_settings(AUTH_USER_MODEL='auth.ExtensionUser')\n+        def test_extension_user(self):\n+            \"Run tests for a simple extension of the built-in User.\"\n+            self.assertSomething()\n+\n+\n A full example\n --------------\n \n@@ -2272,15 +2413,21 @@ code would be required in the app's ``admin.py`` file::\n \n \n     class UserChangeForm(forms.ModelForm):\n-        \"\"\"A form for updateing users. Includes all the fields on\n+        \"\"\"A form for updating users. Includes all the fields on\n         the user, but replaces the password field with admin's\n-        pasword hash display field.\n+        password hash display field.\n         \"\"\"\n         password = ReadOnlyPasswordHashField()\n \n         class Meta:\n             model = MyUser\n \n+        def clean_password(self):\n+            # Regardless of what the user provides, return the initial value.\n+            # This is done here, rather than on the field, because the\n+            # field does not have access to the initial value\n+            return self.initial[\"password\"]\n+\n \n     class MyUserAdmin(UserAdmin):\n         # The forms to add and change user instances\n@@ -2376,6 +2523,12 @@ processing at the first positive match.\n     you need to force users to re-authenticate using different methods. A simple\n     way to do that is simply to execute ``Session.objects.all().delete()``.\n \n+.. versionadded:: 1.6\n+\n+If a backend raises a :class:`~django.core.exceptions.PermissionDenied`\n+exception, authentication will immediately fail. Django won't check the\n+backends that follow.\n+\n Writing an authentication backend\n ---------------------------------\n "
        },
        {
            "sha": "a15cf583703e2412aedb703e7bbe19e0d89a1a82",
            "filename": "docs/topics/cache.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fcache.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fcache.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fcache.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -785,6 +785,16 @@ nonexistent cache key.::\n     However, if the backend doesn't natively provide an increment/decrement\n     operation, it will be implemented using a two-step retrieve/update.\n \n+\n+You can close the connection to your cache with ``close()`` if implemented by\n+the cache backend.\n+\n+    >>> cache.close()\n+\n+.. note::\n+\n+    For caches that don't implement ``close`` methods it is a no-op.\n+\n .. _cache_key_prefixing:\n \n Cache key prefixing"
        },
        {
            "sha": "7d12184705957b9e780f3ffd22ff188302b91572",
            "filename": "docs/topics/class-based-views/generic-editing.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fclass-based-views%2Fgeneric-editing.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fclass-based-views%2Fgeneric-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Fgeneric-editing.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -90,8 +90,8 @@ class:\n .. code-block:: python\n \n     # models.py\n-    from django import models\n     from django.core.urlresolvers import reverse\n+    from django.db import models\n \n     class Author(models.Model):\n         name = models.CharField(max_length=200)\n@@ -102,7 +102,7 @@ class:\n Then we can use :class:`CreateView` and friends to do the actual\n work. Notice how we're just configuring the generic class-based views\n here; we don't have to write any logic ourselves::\n-   \n+\n     # views.py\n     from django.views.generic.edit import CreateView, UpdateView, DeleteView\n     from django.core.urlresolvers import reverse_lazy\n@@ -134,7 +134,7 @@ Finally, we hook these new views into the URLconf::\n         url(r'author/(?P<pk>\\d+)/$', AuthorUpdate.as_view(), name='author_update'),\n         url(r'author/(?P<pk>\\d+)/delete/$', AuthorDelete.as_view(), name='author_delete'),\n     )\n-        \n+\n .. note::\n \n     These views inherit :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin`\n@@ -160,8 +160,8 @@ you can use a custom :class:`ModelForm` to do this. First, add the\n foreign key relation to the model::\n \n     # models.py\n-    from django import models\n     from django.contrib.auth import User\n+    from django.db import models\n \n     class Author(models.Model):\n         name = models.CharField(max_length=200)\n@@ -177,7 +177,7 @@ Create a custom :class:`ModelForm` in order to exclude the\n     # forms.py\n     from django import forms\n     from myapp.models import Author\n-    \n+\n     class AuthorForm(forms.ModelForm):\n         class Meta:\n             model = Author\n@@ -190,7 +190,7 @@ In the view, use the custom :attr:`form_class` and override\n     from django.views.generic.edit import CreateView\n     from myapp.models import Author\n     from myapp.forms import AuthorForm\n-    \n+\n     class AuthorCreate(CreateView):\n         form_class = AuthorForm\n         model = Author"
        },
        {
            "sha": "54d4b0f25231371f9ea8490501c1757dc07588b9",
            "filename": "docs/topics/class-based-views/index.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Findex.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -24,17 +24,18 @@ Basic examples\n Django provides base view classes which will suit a wide range of applications.\n All views inherit from the :class:`~django.views.generic.base.View` class, which\n handles linking the view in to the URLs, HTTP method dispatching and other\n-simple features. :class:`~django.views.generic.base.RedirectView` is for a simple HTTP\n-redirect, and :class:`~django.views.generic.base.TemplateView` extends the base class\n-to make it also render a template.\n+simple features. :class:`~django.views.generic.base.RedirectView` is for a\n+simple HTTP redirect, and :class:`~django.views.generic.base.TemplateView`\n+extends the base class to make it also render a template.\n \n \n Simple usage in your URLconf\n ============================\n \n The simplest way to use generic views is to create them directly in your\n URLconf. If you're only changing a few simple attributes on a class-based view,\n-you can simply pass them into the ``as_view`` method call itself::\n+you can simply pass them into the\n+:meth:`~django.views.generic.base.View.as_view` method call itself::\n \n     from django.conf.urls import patterns, url, include\n     from django.views.generic import TemplateView\n@@ -43,9 +44,10 @@ you can simply pass them into the ``as_view`` method call itself::\n         (r'^about/', TemplateView.as_view(template_name=\"about.html\")),\n     )\n \n-Any arguments given will override the ``template_name`` on the\n-A similar overriding pattern can be used for the ``url`` attribute on\n-:class:`~django.views.generic.base.RedirectView`.\n+Any arguments passed to :meth:`~django.views.generic.base.View.as_view` will\n+override attributes set on the class. In this example, we set ``template_name``\n+on the ``TemplateView``. A similar overriding pattern can be used for the\n+``url`` attribute on :class:`~django.views.generic.base.RedirectView`.\n \n \n Subclassing generic views\n@@ -67,8 +69,8 @@ and override the template name::\n \n Then we just need to add this new view into our URLconf.\n `~django.views.generic.base.TemplateView` is a class, not a function, so we\n-point the URL to the ``as_view`` class method instead, which provides a\n-function-like entry to class-based views::\n+point the URL to the :meth:`~django.views.generic.base.View.as_view` class\n+method instead, which provides a function-like entry to class-based views::\n \n     # urls.py\n     from django.conf.urls import patterns, url, include"
        },
        {
            "sha": "a14616a17c189401f01d9fb67633fb2e9dee9def",
            "filename": "docs/topics/db/managers.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fmanagers.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fmanagers.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmanagers.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -274,6 +274,21 @@ it into the inheritance hierarchy *after* the defaults::\n         # Default manager is CustomManager, but OtherManager is\n         # also available via the \"extra_manager\" attribute.\n \n+Note that while you can *define* a custom manager on the abstract model, you\n+can't *invoke* any methods using the abstract model. That is::\n+\n+    ClassA.objects.do_something()\n+\n+is legal, but::\n+\n+    AbstractBase.objects.do_something()\n+\n+will raise an exception. This is because managers are intended to encapsulate\n+logic for managing collections of objects. Since you can't have a collection of\n+abstract objects, it doesn't make sense to be managing them. If you have\n+functionality that applies to the abstract model, you should put that functionality\n+in a ``staticmethod`` or ``classmethod`` on the abstract model.\n+\n Implementation concerns\n -----------------------\n "
        },
        {
            "sha": "2f1676ac1ab15d150210d6450a069b1a5a6f13df",
            "filename": "docs/topics/db/models.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fmodels.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fmodels.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmodels.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -673,11 +673,12 @@ For example, this model has a few custom methods::\n         def baby_boomer_status(self):\n             \"Returns the person's baby-boomer status.\"\n             import datetime\n-            if datetime.date(1945, 8, 1) <= self.birth_date <= datetime.date(1964, 12, 31):\n-                return \"Baby boomer\"\n             if self.birth_date < datetime.date(1945, 8, 1):\n                 return \"Pre-boomer\"\n-            return \"Post-boomer\"\n+            elif self.birth_date < datetime.date(1965, 1, 1):\n+                return \"Baby boomer\"\n+            else:\n+                return \"Post-boomer\"\n \n         def is_midwestern(self):\n             \"Returns True if this person is from the Midwest.\""
        },
        {
            "sha": "8a02305376f4ca16c3d37967bfa7519631c5090b",
            "filename": "docs/topics/db/multi-db.txt",
            "status": "modified",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fmulti-db.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fmulti-db.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmulti-db.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -630,3 +630,49 @@ However, if you're using SQLite or MySQL with MyISAM tables, there is\n no enforced referential integrity; as a result, you may be able to\n 'fake' cross database foreign keys. However, this configuration is not\n officially supported by Django.\n+\n+.. _contrib_app_multiple_databases:\n+\n+Behavior of contrib apps\n+------------------------\n+\n+Several contrib apps include models, and some apps depend on others. Since\n+cross-database relationships are impossible, this creates some restrictions on\n+how you can split these models across databases:\n+\n+- each one of ``contenttypes.ContentType``, ``sessions.Session`` and\n+  ``sites.Site`` can be stored in any database, given a suitable router.\n+- ``auth`` models — ``User``, ``Group`` and ``Permission`` — are linked\n+  together and linked to ``ContentType``, so they must be stored in the same\n+  database as ``ContentType``.\n+- ``admin`` and ``comments`` depend on ``auth``, so their models must be in\n+  the same database as ``auth``.\n+- ``flatpages`` and ``redirects`` depend on ``sites``, so their models must be\n+  in the same database as ``sites``.\n+\n+In addition, some objects are automatically created just after\n+:djadmin:`syncdb` creates a table to hold them in a database:\n+\n+- a default ``Site``,\n+- a ``ContentType`` for each model (including those not stored in that\n+  database),\n+- three ``Permission`` for each model (including those not stored in that\n+  database).\n+\n+.. versionchanged:: 1.5\n+    Previously, ``ContentType`` and ``Permission`` instances were created only\n+    in the default database.\n+\n+For common setups with multiple databases, it isn't useful to have these\n+objects in more than one database. Common setups include master / slave and\n+connecting to external databases. Therefore, it's recommended:\n+\n+- either to run :djadmin:`syncdb` only for the default database;\n+- or to write :ref:`database router<topics-db-multi-db-routing>` that allows\n+  synchronizing these three models only to one database.\n+\n+.. warning::\n+\n+    If you're synchronizing content types to more that one database, be aware\n+    that their primary keys may not match across databases. This may result in\n+    data corruption or data loss."
        },
        {
            "sha": "b5cca52e23e4ccaac86ddeaff3573cfc9974ded2",
            "filename": "docs/topics/db/optimization.txt",
            "status": "modified",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Foptimization.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -132,6 +132,41 @@ Write your own :doc:`custom SQL to retrieve data or populate models\n </topics/db/sql>`. Use ``django.db.connection.queries`` to find out what Django\n is writing for you and start from there.\n \n+Retrieve individual objects using a unique, indexed column\n+==========================================================\n+\n+There are two reasons to use a column with\n+:attr:`~django.db.models.Field.unique` or\n+:attr:`~django.db.models.Field.db_index` when using\n+:meth:`~django.db.models.query.QuerySet.get` to retrieve individual objects.\n+First, the query will be quicker because of the underlying database index.\n+Also, the query could run much slower if multiple objects match the lookup;\n+having a unique constraint on the column guarantees this will never happen.\n+\n+So using the :ref:`example Weblog models <queryset-model-example>`::\n+\n+  >>> entry = Entry.objects.get(id=10)\n+\n+will be quicker than:\n+\n+  >>> entry = Entry.object.get(headline=\"News Item Title\")\n+\n+because ``id`` is indexed by the database and is guaranteed to be unique.\n+\n+Doing the following is potentially quite slow:\n+\n+  >>> entry = Entry.objects.get(headline__startswith=\"News\")\n+\n+First of all, `headline` is not indexed, which will make the underlying\n+database fetch slower.\n+\n+Second, the lookup doesn't guarantee that only one object will be returned.\n+If the query matches more than one object, it will retrieve and transfer all of\n+them from the database. This penalty could be substantial if hundreds or\n+thousands of records are returned. The penalty will be compounded if the\n+database lives on a separate server, where network overhead and latency also\n+play a factor.\n+\n Retrieve everything at once if you know you will need it\n ========================================================\n "
        },
        {
            "sha": "90c06ac66a4fb09aebc53e433d8dceb1f768ae58",
            "filename": "docs/topics/db/queries.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 8,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fqueries.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Fqueries.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fqueries.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -417,7 +417,7 @@ translates (roughly) into the following SQL::\n     There's one exception though, in case of a\n     :class:`~django.db.models.ForeignKey` you can specify the field\n     name suffixed with ``_id``. In this case, the value parameter is expected\n-    to contain the raw value of the foreign model's primary key. For example::\n+    to contain the raw value of the foreign model's primary key. For example:\n \n         >>> Entry.objects.filter(blog_id__exact=4)\n \n@@ -575,12 +575,17 @@ To select all blogs that contain an entry with *\"Lennon\"* in the headline\n     Blog.objects.filter(entry__headline__contains='Lennon').filter(\n             entry__pub_date__year=2008)\n \n-In this second example, the first filter restricted the queryset to all those\n-blogs linked to that particular type of entry. The second filter restricted\n-the set of blogs *further* to those that are also linked to the second type of\n-entry. The entries select by the second filter may or may not be the same as\n-the entries in the first filter. We are filtering the ``Blog`` items with each\n-filter statement, not the ``Entry`` items.\n+Suppose there is only one blog that had both entries containing *\"Lennon\"* and\n+entries from 2008, but that none of the entries from 2008 contained *\"Lennon\"*.\n+The first query would not return any blogs, but the second query would return\n+that one blog.\n+\n+In the second example, the first filter restricts the queryset to all those\n+blogs linked to entries with *\"Lennon\"* in the headline. The second filter\n+restricts the set of blogs *further* to those that are also linked to entries\n+that were published in 2008. The entries selected by the second filter may or\n+may not be the same as the entries in the first filter. We are filtering the\n+``Blog`` items with each filter statement, not the ``Entry`` items.\n \n All of this behavior also applies to\n :meth:`~django.db.models.query.QuerySet.exclude`: all the conditions in a\n@@ -920,7 +925,7 @@ Things get more complicated if you use inheritance. Consider a subclass of\n     class ThemeBlog(Blog):\n         theme = models.CharField(max_length=200)\n \n-    django_blog = ThemeBlog(name='Django', tagline='Django is easy', theme = 'python')\n+    django_blog = ThemeBlog(name='Django', tagline='Django is easy', theme='python')\n     django_blog.save() # django_blog.pk == 3\n \n Due to how inheritance works, you have to set both ``pk`` and ``id`` to None::"
        },
        {
            "sha": "65944abb8bf371d80804a72cd20020fd10a7ca86",
            "filename": "docs/topics/db/transactions.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Ftransactions.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fdb%2Ftransactions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Ftransactions.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -161,8 +161,12 @@ managers, too.\n     transactions. It tells Django you'll be managing the transaction on your\n     own.\n \n-    If your view changes data and doesn't ``commit()`` or ``rollback()``,\n-    Django will raise a ``TransactionManagementError`` exception.\n+    Whether you are writing or simply reading from the database, you must\n+    ``commit()`` or ``rollback()`` explicitly or Django will raise a\n+    :exc:`TransactionManagementError` exception. This is required when reading\n+    from the database because ``SELECT`` statements may call functions which\n+    modify tables, and thus it is impossible to know if any data has been\n+    modified.\n \n     Manual transaction management looks like this::\n \n@@ -204,11 +208,13 @@ This applies to all database operations, not just write operations. Even\n if your transaction only reads from the database, the transaction must\n be committed or rolled back before you complete a request.\n \n+.. _deactivate-transaction-management:\n+\n How to globally deactivate transaction management\n =================================================\n \n Control freaks can totally disable all transaction management by setting\n-``DISABLE_TRANSACTION_MANAGEMENT`` to ``True`` in the Django settings file.\n+:setting:`TRANSACTIONS_MANAGED` to ``True`` in the Django settings file.\n \n If you do this, Django won't provide any automatic transaction management\n whatsoever. Middleware will no longer implicitly commit transactions, and"
        },
        {
            "sha": "66e104759ae9ed77a4560a3b9b2ff1ea4f541b48",
            "filename": "docs/topics/files.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Ffiles.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Ffiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ffiles.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -139,6 +139,8 @@ useful -- you can use the global default storage system::\n \n See :doc:`/ref/files/storage` for the file storage API.\n \n+.. _builtin-fs-storage:\n+\n The built-in filesystem storage class\n -------------------------------------\n "
        },
        {
            "sha": "233346db0d56f0f8d642e9f84c920226a6c37116",
            "filename": "docs/topics/forms/modelforms.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmodelforms.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -90,9 +90,6 @@ Model field                      Form field\n \n ``NullBooleanField``             ``CharField``\n \n-``PhoneNumberField``             ``USPhoneNumberField``\n-                                 (from ``django.contrib.localflavor.us``)\n-\n ``PositiveIntegerField``         ``IntegerField``\n \n ``PositiveSmallIntegerField``    ``IntegerField``\n@@ -192,6 +189,8 @@ we'll discuss in a moment.)::\n         name = forms.CharField(max_length=100)\n         authors = forms.ModelMultipleChoiceField(queryset=Author.objects.all())\n \n+.. _modelform-is-valid-and-errors:\n+\n The ``is_valid()`` method and ``errors``\n ----------------------------------------\n \n@@ -213,7 +212,9 @@ method. This method creates and saves a database object from the data\n bound to the form. A subclass of ``ModelForm`` can accept an existing\n model instance as the keyword argument ``instance``; if this is\n supplied, ``save()`` will update that instance. If it's not supplied,\n-``save()`` will create a new instance of the specified model::\n+``save()`` will create a new instance of the specified model:\n+\n+.. code-block:: python\n \n     # Create a form instance from POST data.\n     >>> f = ArticleForm(request.POST)\n@@ -232,8 +233,10 @@ supplied, ``save()`` will update that instance. If it's not supplied,\n     >>> f = ArticleForm(request.POST, instance=a)\n     >>> f.save()\n \n-Note that ``save()`` will raise a ``ValueError`` if the data in the form\n-doesn't validate -- i.e., if form.errors evaluates to True.\n+Note that if the form :ref:`hasn't been validated\n+<modelform-is-valid-and-errors>`, calling ``save()`` will do so by checking\n+``form.errors``. A ``ValueError`` will be raised if the data in the form\n+doesn't validate -- i.e., if ``form.errors`` evaluates to ``True``.\n \n This ``save()`` method accepts an optional ``commit`` keyword argument, which\n accepts either ``True`` or ``False``. If you call ``save()`` with"
        },
        {
            "sha": "4aa85f7611476d8a4818f0f1b56da1a18cf9e389",
            "filename": "docs/topics/http/_images/middleware.graffle",
            "status": "added",
            "additions": 957,
            "deletions": 0,
            "changes": 957,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.graffle",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.graffle",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.graffle?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,957 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n+<plist version=\"1.0\">\n+<dict>\n+\t<key>ActiveLayerIndex</key>\n+\t<integer>0</integer>\n+\t<key>ApplicationVersion</key>\n+\t<array>\n+\t\t<string>com.omnigroup.OmniGrafflePro</string>\n+\t\t<string>139.16.0.171715</string>\n+\t</array>\n+\t<key>AutoAdjust</key>\n+\t<true/>\n+\t<key>BackgroundGraphic</key>\n+\t<dict>\n+\t\t<key>Bounds</key>\n+\t\t<string>{{0, 0}, {559.28997802734375, 782.8900146484375}}</string>\n+\t\t<key>Class</key>\n+\t\t<string>SolidGraphic</string>\n+\t\t<key>ID</key>\n+\t\t<integer>2</integer>\n+\t\t<key>Style</key>\n+\t\t<dict>\n+\t\t\t<key>shadow</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Draws</key>\n+\t\t\t\t<string>NO</string>\n+\t\t\t</dict>\n+\t\t\t<key>stroke</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Draws</key>\n+\t\t\t\t<string>NO</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t</dict>\n+\t<key>BaseZoom</key>\n+\t<integer>0</integer>\n+\t<key>CanvasOrigin</key>\n+\t<string>{0, 0}</string>\n+\t<key>ColumnAlign</key>\n+\t<integer>1</integer>\n+\t<key>ColumnSpacing</key>\n+\t<real>36</real>\n+\t<key>CreationDate</key>\n+\t<string>2012-12-09 18:55:12 +0000</string>\n+\t<key>Creator</key>\n+\t<string>Aymeric Augustin</string>\n+\t<key>DisplayScale</key>\n+\t<string>1.000 cm = 1.000 cm</string>\n+\t<key>GraphDocumentVersion</key>\n+\t<integer>8</integer>\n+\t<key>GraphicsList</key>\n+\t<array>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{144, 405}, {369, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>33</integer>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Bezier</string>\n+\t\t\t<key>ShapeData</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>UnitPoints</key>\n+\t\t\t\t<array>\n+\t\t\t\t\t<string>{-0.5, -0.5}</string>\n+\t\t\t\t\t<string>{-0.5, -0.5}</string>\n+\t\t\t\t\t<string>{0.47959183673469341, -0.5}</string>\n+\t\t\t\t\t<string>{0.47959183673469408, -0.5}</string>\n+\t\t\t\t\t<string>{0.47959183673469341, -0.5}</string>\n+\t\t\t\t\t<string>{0.5, 0}</string>\n+\t\t\t\t\t<string>{0.5, 0}</string>\n+\t\t\t\t\t<string>{0.5, 0}</string>\n+\t\t\t\t\t<string>{0.47959183673469408, 0.5}</string>\n+\t\t\t\t\t<string>{0.47959183673469408, 0.5}</string>\n+\t\t\t\t\t<string>{0.47959183673469408, 0.5}</string>\n+\t\t\t\t\t<string>{-0.5, 0.5}</string>\n+\t\t\t\t\t<string>{-0.5, 0.5}</string>\n+\t\t\t\t\t<string>{-0.5, 0.5}</string>\n+\t\t\t\t\t<string>{-0.47560975609756084, 0}</string>\n+\t\t\t\t\t<string>{-0.47560975609756084, 0}</string>\n+\t\t\t\t\t<string>{-0.47560975609756084, 0}</string>\n+\t\t\t\t\t<string>{-0.5, -0.5}</string>\n+\t\t\t\t</array>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fswiss\\fcharset0 Helvetica;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 view function}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{229.5, 238.5}, {297, 36}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>31</integer>\n+\t\t\t<key>Rotation</key>\n+\t\t\t<real>270</real>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>AdjustableArrow</string>\n+\t\t\t<key>ShapeData</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>width</key>\n+\t\t\t\t<real>27</real>\n+\t\t\t</dict>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.8</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>MiddleFraction</key>\n+\t\t\t\t\t<real>0.70634919404983521</real>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>shadow</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.4</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Draws</key>\n+\t\t\t\t\t<string>NO</string>\n+\t\t\t\t\t<key>Fuzziness</key>\n+\t\t\t\t\t<real>0.0</real>\n+\t\t\t\t\t<key>ShadowVector</key>\n+\t\t\t\t\t<string>{0, 2}</string>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Pattern</key>\n+\t\t\t\t\t<integer>1</integer>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red255\\green0\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf2 process_exception}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextRelativeArea</key>\n+\t\t\t<string>{{0.125, 0.25}, {0.75, 0.5}}</string>\n+\t\t\t<key>isConnectedShape</key>\n+\t\t\t<true/>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{328.5, 229.5}, {315, 36}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>30</integer>\n+\t\t\t<key>Rotation</key>\n+\t\t\t<real>270</real>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>AdjustableArrow</string>\n+\t\t\t<key>ShapeData</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>width</key>\n+\t\t\t\t<real>27</real>\n+\t\t\t</dict>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.8</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>MiddleFraction</key>\n+\t\t\t\t\t<real>0.70634919404983521</real>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>shadow</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.4</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Draws</key>\n+\t\t\t\t\t<string>NO</string>\n+\t\t\t\t\t<key>Fuzziness</key>\n+\t\t\t\t\t<real>0.0</real>\n+\t\t\t\t\t<key>ShadowVector</key>\n+\t\t\t\t\t<string>{0, 2}</string>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0.501961</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red0\\green128\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf2 process_response}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextRelativeArea</key>\n+\t\t\t<string>{{0.125, 0.25}, {0.75, 0.5}}</string>\n+\t\t\t<key>isConnectedShape</key>\n+\t\t\t<true/>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{283.5, 238.5}, {297, 36}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>29</integer>\n+\t\t\t<key>Rotation</key>\n+\t\t\t<real>270</real>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>AdjustableArrow</string>\n+\t\t\t<key>ShapeData</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>width</key>\n+\t\t\t\t<real>27</real>\n+\t\t\t</dict>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.8</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>MiddleFraction</key>\n+\t\t\t\t\t<real>0.70634919404983521</real>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>shadow</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.4</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Draws</key>\n+\t\t\t\t\t<string>NO</string>\n+\t\t\t\t\t<key>Fuzziness</key>\n+\t\t\t\t\t<real>0.0</real>\n+\t\t\t\t\t<key>ShadowVector</key>\n+\t\t\t\t\t<string>{0, 2}</string>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0.501961</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Pattern</key>\n+\t\t\t\t\t<integer>1</integer>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red0\\green128\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf2 process_template_response}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextRelativeArea</key>\n+\t\t\t<string>{{0.125, 0.25}, {0.75, 0.5}}</string>\n+\t\t\t<key>isConnectedShape</key>\n+\t\t\t<true/>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{27, 243}, {288, 36}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>28</integer>\n+\t\t\t<key>Rotation</key>\n+\t\t\t<real>90</real>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>AdjustableArrow</string>\n+\t\t\t<key>ShapeData</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>width</key>\n+\t\t\t\t<real>27</real>\n+\t\t\t</dict>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.8</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>MiddleFraction</key>\n+\t\t\t\t\t<real>0.70634919404983521</real>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>shadow</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.4</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Draws</key>\n+\t\t\t\t\t<string>NO</string>\n+\t\t\t\t\t<key>Fuzziness</key>\n+\t\t\t\t\t<real>0.0</real>\n+\t\t\t\t\t<key>ShadowVector</key>\n+\t\t\t\t\t<string>{0, 2}</string>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0.501961</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red0\\green128\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf2 process_view}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextRelativeArea</key>\n+\t\t\t<string>{{0.125, 0.25}, {0.75, 0.5}}</string>\n+\t\t\t<key>isConnectedShape</key>\n+\t\t\t<true/>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{-40.500000000767386, 220.49999999804004}, {297, 36}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>27</integer>\n+\t\t\t<key>Rotation</key>\n+\t\t\t<real>90</real>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>AdjustableArrow</string>\n+\t\t\t<key>ShapeData</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>width</key>\n+\t\t\t\t<real>27</real>\n+\t\t\t</dict>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.8</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>1</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>MiddleFraction</key>\n+\t\t\t\t\t<real>0.70634919404983521</real>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>shadow</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>a</key>\n+\t\t\t\t\t\t<string>0.4</string>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t\t<key>Draws</key>\n+\t\t\t\t\t<string>NO</string>\n+\t\t\t\t\t<key>Fuzziness</key>\n+\t\t\t\t\t<real>0.0</real>\n+\t\t\t\t\t<key>ShadowVector</key>\n+\t\t\t\t\t<string>{0, 2}</string>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>Color</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>b</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t\t<key>g</key>\n+\t\t\t\t\t\t<string>0.501961</string>\n+\t\t\t\t\t\t<key>r</key>\n+\t\t\t\t\t\t<string>0</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;\\red0\\green128\\blue0;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf2 process_request}</string>\n+\t\t\t</dict>\n+\t\t\t<key>TextRelativeArea</key>\n+\t\t\t<string>{{0.125, 0.25}, {0.75, 0.5}}</string>\n+\t\t\t<key>isConnectedShape</key>\n+\t\t\t<true/>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{360, 63}, {144, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>12</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 HttpResponse}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{72, 63}, {144, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>11</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 HttpRequest}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{72, 324}, {432, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>10</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 MessageMiddleware}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{72, 279}, {432, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>9</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 AuthenticationMiddleware}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{72, 234}, {432, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>8</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 CsrfViewMiddleware}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{72, 189}, {432, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>7</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 SessionMiddleware}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t\t<dict>\n+\t\t\t<key>Bounds</key>\n+\t\t\t<string>{{72, 144}, {432, 27}}</string>\n+\t\t\t<key>Class</key>\n+\t\t\t<string>ShapedGraphic</string>\n+\t\t\t<key>ID</key>\n+\t\t\t<integer>6</integer>\n+\t\t\t<key>Magnets</key>\n+\t\t\t<array>\n+\t\t\t\t<string>{0, 1}</string>\n+\t\t\t\t<string>{0, -1}</string>\n+\t\t\t\t<string>{1, 0}</string>\n+\t\t\t\t<string>{-1, 0}</string>\n+\t\t\t</array>\n+\t\t\t<key>Shape</key>\n+\t\t\t<string>Rectangle</string>\n+\t\t\t<key>Style</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>fill</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>FillType</key>\n+\t\t\t\t\t<integer>2</integer>\n+\t\t\t\t\t<key>GradientAngle</key>\n+\t\t\t\t\t<real>90</real>\n+\t\t\t\t\t<key>GradientColor</key>\n+\t\t\t\t\t<dict>\n+\t\t\t\t\t\t<key>w</key>\n+\t\t\t\t\t\t<string>0.666667</string>\n+\t\t\t\t\t</dict>\n+\t\t\t\t</dict>\n+\t\t\t\t<key>stroke</key>\n+\t\t\t\t<dict>\n+\t\t\t\t\t<key>CornerRadius</key>\n+\t\t\t\t\t<real>5</real>\n+\t\t\t\t</dict>\n+\t\t\t</dict>\n+\t\t\t<key>Text</key>\n+\t\t\t<dict>\n+\t\t\t\t<key>Text</key>\n+\t\t\t\t<string>{\\rtf1\\ansi\\ansicpg1252\\cocoartf1187\\cocoasubrtf340\n+\\cocoascreenfonts1{\\fonttbl\\f0\\fmodern\\fcharset0 Courier;}\n+{\\colortbl;\\red255\\green255\\blue255;}\n+\\pard\\tx560\\tx1120\\tx1680\\tx2240\\tx2800\\tx3360\\tx3920\\tx4480\\tx5040\\tx5600\\tx6160\\tx6720\\pardirnatural\\qc\n+\n+\\f0\\fs24 \\cf0 CommonMiddleware}</string>\n+\t\t\t</dict>\n+\t\t</dict>\n+\t</array>\n+\t<key>GridInfo</key>\n+\t<dict>\n+\t\t<key>ShowsGrid</key>\n+\t\t<string>YES</string>\n+\t\t<key>SnapsToGrid</key>\n+\t\t<string>YES</string>\n+\t</dict>\n+\t<key>GuidesLocked</key>\n+\t<string>NO</string>\n+\t<key>GuidesVisible</key>\n+\t<string>YES</string>\n+\t<key>HPages</key>\n+\t<integer>1</integer>\n+\t<key>ImageCounter</key>\n+\t<integer>1</integer>\n+\t<key>KeepToScale</key>\n+\t<false/>\n+\t<key>Layers</key>\n+\t<array>\n+\t\t<dict>\n+\t\t\t<key>Lock</key>\n+\t\t\t<string>NO</string>\n+\t\t\t<key>Name</key>\n+\t\t\t<string>Calque 1</string>\n+\t\t\t<key>Print</key>\n+\t\t\t<string>YES</string>\n+\t\t\t<key>View</key>\n+\t\t\t<string>YES</string>\n+\t\t</dict>\n+\t</array>\n+\t<key>LayoutInfo</key>\n+\t<dict>\n+\t\t<key>Animate</key>\n+\t\t<string>NO</string>\n+\t\t<key>circoMinDist</key>\n+\t\t<real>18</real>\n+\t\t<key>circoSeparation</key>\n+\t\t<real>0.0</real>\n+\t\t<key>layoutEngine</key>\n+\t\t<string>dot</string>\n+\t\t<key>neatoSeparation</key>\n+\t\t<real>0.0</real>\n+\t\t<key>twopiSeparation</key>\n+\t\t<real>0.0</real>\n+\t</dict>\n+\t<key>LinksVisible</key>\n+\t<string>NO</string>\n+\t<key>MagnetsVisible</key>\n+\t<string>NO</string>\n+\t<key>MasterSheets</key>\n+\t<array/>\n+\t<key>ModificationDate</key>\n+\t<string>2012-12-09 19:48:54 +0000</string>\n+\t<key>Modifier</key>\n+\t<string>Aymeric Augustin</string>\n+\t<key>NotesVisible</key>\n+\t<string>NO</string>\n+\t<key>Orientation</key>\n+\t<integer>2</integer>\n+\t<key>OriginVisible</key>\n+\t<string>NO</string>\n+\t<key>PageBreaks</key>\n+\t<string>YES</string>\n+\t<key>PrintInfo</key>\n+\t<dict>\n+\t\t<key>NSBottomMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>41</string>\n+\t\t</array>\n+\t\t<key>NSHorizonalPagination</key>\n+\t\t<array>\n+\t\t\t<string>coded</string>\n+\t\t\t<string>BAtzdHJlYW10eXBlZIHoA4QBQISEhAhOU051bWJlcgCEhAdOU1ZhbHVlAISECE5TT2JqZWN0AIWEASqEhAFxlwCG</string>\n+\t\t</array>\n+\t\t<key>NSLeftMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>18</string>\n+\t\t</array>\n+\t\t<key>NSPaperSize</key>\n+\t\t<array>\n+\t\t\t<string>size</string>\n+\t\t\t<string>{595.28997802734375, 841.8900146484375}</string>\n+\t\t</array>\n+\t\t<key>NSPrintReverseOrientation</key>\n+\t\t<array>\n+\t\t\t<string>int</string>\n+\t\t\t<string>0</string>\n+\t\t</array>\n+\t\t<key>NSRightMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>18</string>\n+\t\t</array>\n+\t\t<key>NSTopMargin</key>\n+\t\t<array>\n+\t\t\t<string>float</string>\n+\t\t\t<string>18</string>\n+\t\t</array>\n+\t</dict>\n+\t<key>PrintOnePage</key>\n+\t<false/>\n+\t<key>ReadOnly</key>\n+\t<string>NO</string>\n+\t<key>RowAlign</key>\n+\t<integer>1</integer>\n+\t<key>RowSpacing</key>\n+\t<real>36</real>\n+\t<key>SheetTitle</key>\n+\t<string>Canevas 1</string>\n+\t<key>SmartAlignmentGuidesActive</key>\n+\t<string>YES</string>\n+\t<key>SmartDistanceGuidesActive</key>\n+\t<string>YES</string>\n+\t<key>UniqueID</key>\n+\t<integer>1</integer>\n+\t<key>UseEntirePage</key>\n+\t<false/>\n+\t<key>VPages</key>\n+\t<integer>1</integer>\n+\t<key>WindowInfo</key>\n+\t<dict>\n+\t\t<key>CurrentSheet</key>\n+\t\t<integer>0</integer>\n+\t\t<key>ExpandedCanvases</key>\n+\t\t<array/>\n+\t\t<key>Frame</key>\n+\t\t<string>{{248, 4}, {694, 874}}</string>\n+\t\t<key>ListView</key>\n+\t\t<true/>\n+\t\t<key>OutlineWidth</key>\n+\t\t<integer>142</integer>\n+\t\t<key>RightSidebar</key>\n+\t\t<false/>\n+\t\t<key>ShowRuler</key>\n+\t\t<true/>\n+\t\t<key>Sidebar</key>\n+\t\t<true/>\n+\t\t<key>SidebarWidth</key>\n+\t\t<integer>120</integer>\n+\t\t<key>VisibleRegion</key>\n+\t\t<string>{{0, 0}, {559, 735}}</string>\n+\t\t<key>Zoom</key>\n+\t\t<real>1</real>\n+\t\t<key>ZoomValues</key>\n+\t\t<array>\n+\t\t\t<array>\n+\t\t\t\t<string>Canevas 1</string>\n+\t\t\t\t<real>1</real>\n+\t\t\t\t<real>1</real>\n+\t\t\t</array>\n+\t\t</array>\n+\t</dict>\n+</dict>\n+</plist>"
        },
        {
            "sha": "8a9e61ef409da7504f2b6db4547f1fd3c0970413",
            "filename": "docs/topics/http/_images/middleware.pdf",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.pdf",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.pdf",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.pdf?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3"
        },
        {
            "sha": "505c70ac36f85c9481406a721a778eb4fef8df5c",
            "filename": "docs/topics/http/_images/middleware.png",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.png",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.png?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "4da8d22da893f7ff5d0644ca90c06e504831c542",
            "filename": "docs/topics/http/_images/middleware.svg",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.svg",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.svg",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2F_images%2Fmiddleware.svg?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -0,0 +1,3 @@\n+<?xml version=\"1.0\"?>\n+<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n+<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xl=\"http://www.w3.org/1999/xlink\" version=\"1.1\" viewBox=\"52 47 481 409\" width=\"481pt\" height=\"409pt\"><metadata xmlns:dc=\"http://purl.org/dc/elements/1.1/\"><dc:date>2012-12-09 19:48Z</dc:date><!-- Produced by OmniGraffle Professional 5.4.2 --></metadata><defs><filter id=\"Shadow\" filterUnits=\"userSpaceOnUse\"><feGaussianBlur in=\"SourceAlpha\" result=\"blur\" stdDeviation=\"3.488\"/><feOffset in=\"blur\" result=\"offset\" dx=\"0\" dy=\"4\"/><feFlood flood-color=\"black\" flood-opacity=\".75\" result=\"flood\"/><feComposite in=\"flood\" in2=\"offset\" operator=\"in\"/></filter><linearGradient x1=\"0\" x2=\"1\" id=\"Gradient\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"white\"/><stop offset=\"1\" stop-color=\"#aaa\"/></linearGradient><linearGradient id=\"Obj_Gradient\" xl:href=\"#Gradient\" gradientTransform=\"translate(288 144) rotate(90) scale(27)\"/><font-face font-family=\"Courier\" font-size=\"12\" units-per-em=\"1000\" underline-position=\"-178.22266\" underline-thickness=\"57.617188\" slope=\"0\" x-height=\"462.40234\" cap-height=\"594.72656\" ascent=\"753.90625\" descent=\"-246.09375\" font-weight=\"500\"><font-face-src><font-face-name name=\"Courier\"/></font-face-src></font-face><linearGradient id=\"Obj_Gradient_2\" xl:href=\"#Gradient\" gradientTransform=\"translate(288 189) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_3\" xl:href=\"#Gradient\" gradientTransform=\"translate(288 234) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_4\" xl:href=\"#Gradient\" gradientTransform=\"translate(288 279) rotate(90) scale(27)\"/><linearGradient id=\"Obj_Gradient_5\" xl:href=\"#Gradient\" gradientTransform=\"translate(288 324) rotate(90) scale(27)\"/><font-face font-family=\"Helvetica\" font-size=\"12\" units-per-em=\"1000\" underline-position=\"-75.683594\" underline-thickness=\"49.316406\" slope=\"0\" x-height=\"522.94922\" cap-height=\"717.28516\" ascent=\"770.01953\" descent=\"-229.98047\" font-weight=\"500\"><font-face-src><font-face-name name=\"Helvetica\"/></font-face-src></font-face></defs><g stroke=\"none\" stroke-opacity=\"1\" stroke-dasharray=\"none\" fill=\"none\" fill-opacity=\"1\"><title>Canevas 1</title><rect fill=\"white\" width=\"559.28998\" height=\"782.89\"/><g><title>Calque 1</title><g><use xl:href=\"#id6_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id7_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id8_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id9_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id10_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id11_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id12_Graphic\" filter=\"url(#Shadow)\"/><use xl:href=\"#id33_Graphic\" filter=\"url(#Shadow)\"/></g><g id=\"id6_Graphic\"><path d=\"M 77 144 L 499 144 C 501.76142 144 504 146.23858 504 149 L 504 166 C 504 168.76142 501.76142 171 499 171 L 77 171 C 74.238576 171 72 168.76142 72 166 C 72 166 72 166 72 166 L 72 149 C 72 146.23858 74.238576 144 77 144 C 77 144 77 144 77 144 Z\" fill=\"url(#Obj_Gradient)\"/><path d=\"M 77 144 L 499 144 C 501.76142 144 504 146.23858 504 149 L 504 166 C 504 168.76142 501.76142 171 499 171 L 77 171 C 74.238576 171 72 168.76142 72 166 C 72 166 72 166 72 166 L 72 149 C 72 146.23858 74.238576 144 77 144 C 77 144 77 144 77 144 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(77 150.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" fill=\"black\" x=\"153.390625\" y=\"11\" textLength=\"115.21875\">CommonMiddleware</tspan></text></g><g id=\"id7_Graphic\"><path d=\"M 77 189 L 499 189 C 501.76142 189 504 191.23858 504 194 L 504 211 C 504 213.76142 501.76142 216 499 216 L 77 216 C 74.238576 216 72 213.76142 72 211 C 72 211 72 211 72 211 L 72 194 C 72 191.23858 74.238576 189 77 189 C 77 189 77 189 77 189 Z\" fill=\"url(#Obj_Gradient_2)\"/><path d=\"M 77 189 L 499 189 C 501.76142 189 504 191.23858 504 194 L 504 211 C 504 213.76142 501.76142 216 499 216 L 77 216 C 74.238576 216 72 213.76142 72 211 C 72 211 72 211 72 211 L 72 194 C 72 191.23858 74.238576 189 77 189 C 77 189 77 189 77 189 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(77 195.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"149.79004\" y=\"11\" textLength=\"122.41992\">SessionMiddleware</tspan></text></g><g id=\"id8_Graphic\"><path d=\"M 77 234 L 499 234 C 501.76142 234 504 236.23858 504 239 L 504 256 C 504 258.76142 501.76142 261 499 261 L 77 261 C 74.238576 261 72 258.76142 72 256 C 72 256 72 256 72 256 L 72 239 C 72 236.23858 74.238576 234 77 234 C 77 234 77 234 77 234 Z\" fill=\"url(#Obj_Gradient_3)\"/><path d=\"M 77 234 L 499 234 C 501.76142 234 504 236.23858 504 239 L 504 256 C 504 258.76142 501.76142 261 499 261 L 77 261 C 74.238576 261 72 258.76142 72 256 C 72 256 72 256 72 256 L 72 239 C 72 236.23858 74.238576 234 77 234 C 77 234 77 234 77 234 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(77 240.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"146.18945\" y=\"11\" textLength=\"129.62109\">CsrfViewMiddleware</tspan></text></g><g id=\"id9_Graphic\"><path d=\"M 77 279 L 499 279 C 501.76142 279 504 281.23858 504 284 L 504 301 C 504 303.76142 501.76142 306 499 306 L 77 306 C 74.238576 306 72 303.76142 72 301 C 72 301 72 301 72 301 L 72 284 C 72 281.23858 74.238576 279 77 279 C 77 279 77 279 77 279 Z\" fill=\"url(#Obj_Gradient_4)\"/><path d=\"M 77 279 L 499 279 C 501.76142 279 504 281.23858 504 284 L 504 301 C 504 303.76142 501.76142 306 499 306 L 77 306 C 74.238576 306 72 303.76142 72 301 C 72 301 72 301 72 301 L 72 284 C 72 281.23858 74.238576 279 77 279 C 77 279 77 279 77 279 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(77 285.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"124.58594\" y=\"11\" textLength=\"172.82812\">AuthenticationMiddleware</tspan></text></g><g id=\"id10_Graphic\"><path d=\"M 77 324 L 499 324 C 501.76142 324 504 326.23858 504 329 L 504 346 C 504 348.76142 501.76142 351 499 351 L 77 351 C 74.238576 351 72 348.76142 72 346 C 72 346 72 346 72 346 L 72 329 C 72 326.23858 74.238576 324 77 324 C 77 324 77 324 77 324 Z\" fill=\"url(#Obj_Gradient_5)\"/><path d=\"M 77 324 L 499 324 C 501.76142 324 504 326.23858 504 329 L 504 346 C 504 348.76142 501.76142 351 499 351 L 77 351 C 74.238576 351 72 348.76142 72 346 C 72 346 72 346 72 346 L 72 329 C 72 326.23858 74.238576 324 77 324 C 77 324 77 324 77 324 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(77 330.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"149.79004\" y=\"11\" textLength=\"122.41992\">MessageMiddleware</tspan></text></g><g id=\"id11_Graphic\"><rect x=\"72\" y=\"63\" width=\"144\" height=\"27\" fill=\"white\"/><rect x=\"72\" y=\"63\" width=\"144\" height=\"27\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(77 69.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"27.393555\" y=\"11\" textLength=\"79.21289\">HttpRequest</tspan></text></g><g id=\"id12_Graphic\"><rect x=\"360\" y=\"63\" width=\"144\" height=\"27\" fill=\"white\"/><rect x=\"360\" y=\"63\" width=\"144\" height=\"27\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(365 69.5)\" fill=\"black\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" x=\"23.792969\" y=\"11\" textLength=\"86.41406\">HttpResponse</tspan></text></g><path d=\"M 99 90 L 117 90 L 117 360 L 126 360 L 108 387 L 90 360 L 99 360 Z\" fill=\"white\" fill-opacity=\".8\"/><path d=\"M 99 90 L 117 90 L 117 360 L 126 360 L 108 387 L 90 360 L 99 360 Z\" stroke=\"green\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(115 132.125) rotate(90)\" fill=\"green\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" fill=\"green\" x=\"52.36621\" y=\"11\" textLength=\"108.01758\">process_request</tspan></text><path d=\"M 162 117 L 180 117 L 180 378 L 189 378 L 171 405 L 153 378 L 162 378 Z\" fill=\"white\" fill-opacity=\".8\"/><path d=\"M 162 117 L 180 117 L 180 378 L 189 378 L 171 405 L 153 378 L 162 378 Z\" stroke=\"green\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(178 158) rotate(90)\" fill=\"green\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" fill=\"green\" x=\"59.79297\" y=\"11\" textLength=\"86.41406\">process_view</tspan></text><path d=\"M 441 405 L 423 405 L 423 135 L 414 135 L 432 108 L 450 135 L 441 135 Z\" fill=\"white\" fill-opacity=\".8\"/><path d=\"M 441 405 L 423 405 L 423 135 L 414 135 L 432 108 L 450 135 L 441 135 Z\" stroke=\"green\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\" stroke-dasharray=\"4,4\"/><text transform=\"translate(425 362.875) rotate(-90)\" fill=\"green\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" fill=\"green\" x=\"16.360352\" y=\"11\" textLength=\"180.0293\">process_template_response</tspan></text><path d=\"M 495 405 L 477 405 L 477 117 L 468 117 L 486 90 L 504 117 L 495 117 Z\" fill=\"white\" fill-opacity=\".8\"/><path d=\"M 495 405 L 477 405 L 477 117 L 468 117 L 486 90 L 504 117 L 495 117 Z\" stroke=\"green\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(479 360.625) rotate(-90)\" fill=\"green\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" fill=\"green\" x=\"55.515625\" y=\"11\" textLength=\"115.21875\">process_response</tspan></text><path d=\"M 387 405 L 369 405 L 369 135 L 360 135 L 378 108 L 396 135 L 387 135 Z\" fill=\"white\" fill-opacity=\".8\"/><path d=\"M 387 405 L 369 405 L 369 135 L 360 135 L 378 108 L 396 135 L 387 135 Z\" stroke=\"red\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\" stroke-dasharray=\"4,4\"/><text transform=\"translate(371 362.875) rotate(-90)\" fill=\"red\"><tspan font-family=\"Courier\" font-size=\"12\" font-weight=\"500\" fill=\"red\" x=\"45.16504\" y=\"11\" textLength=\"122.41992\">process_exception</tspan></text><g id=\"id33_Graphic\"><path d=\"M 144 405 L 505.4694 405 L 513 418.5 L 505.4694 432 L 144 432 L 153 418.5 Z\" fill=\"white\"/><path d=\"M 144 405 L 505.4694 405 L 513 418.5 L 505.4694 432 L 144 432 L 153 418.5 Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1\"/><text transform=\"translate(149 411.5)\" fill=\"black\"><tspan font-family=\"Helvetica\" font-size=\"12\" font-weight=\"500\" fill=\"black\" x=\"144.81543\" y=\"11\" textLength=\"69.36914\">view function</tspan></text></g></g></g></svg>"
        },
        {
            "sha": "18243c77ce5f6b54ab1907286605886ea7d92ff1",
            "filename": "docs/topics/http/middleware.txt",
            "status": "modified",
            "additions": 119,
            "deletions": 72,
            "changes": 191,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fmiddleware.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fmiddleware.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fmiddleware.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -4,25 +4,28 @@ Middleware\n \n Middleware is a framework of hooks into Django's request/response processing.\n It's a light, low-level \"plugin\" system for globally altering Django's input\n-and/or output.\n+or output.\n \n Each middleware component is responsible for doing some specific function. For\n-example, Django includes a middleware component, ``XViewMiddleware``, that adds\n-an ``\"X-View\"`` HTTP header to every response to a ``HEAD`` request.\n+example, Django includes a middleware component,\n+:class:`~django.middleware.transaction.TransactionMiddleware`, that wraps the\n+processing of each HTTP request in a database transaction.\n \n This document explains how middleware works, how you activate middleware, and\n how to write your own middleware. Django ships with some built-in middleware\n-you can use right out of the box; they're documented in the :doc:`built-in\n+you can use right out of the box. They're documented in the :doc:`built-in\n middleware reference </ref/middleware>`.\n \n Activating middleware\n =====================\n \n-To activate a middleware component, add it to the :setting:`MIDDLEWARE_CLASSES`\n-list in your Django settings. In :setting:`MIDDLEWARE_CLASSES`, each middleware\n-component is represented by a string: the full Python path to the middleware's\n-class name. For example, here's the default :setting:`MIDDLEWARE_CLASSES`\n-created by :djadmin:`django-admin.py startproject <startproject>`::\n+To activate a middleware component, add it to the\n+:setting:`MIDDLEWARE_CLASSES` tuple in your Django settings.\n+\n+In :setting:`MIDDLEWARE_CLASSES`, each middleware component is represented by\n+a string: the full Python path to the middleware's class name. For example,\n+here's the default value created by :djadmin:`django-admin.py startproject\n+<startproject>`::\n \n     MIDDLEWARE_CLASSES = (\n         'django.middleware.common.CommonMiddleware',\n@@ -32,23 +35,44 @@ created by :djadmin:`django-admin.py startproject <startproject>`::\n         'django.contrib.messages.middleware.MessageMiddleware',\n     )\n \n-During the request phases (:meth:`process_request` and :meth:`process_view`\n-middleware), Django applies middleware in the order it's defined in\n-:setting:`MIDDLEWARE_CLASSES`, top-down. During the response phases\n-(:meth:`process_response` and :meth:`process_exception` middleware), the\n-classes are applied in reverse order, from the bottom up. You can think of it\n-like an onion: each middleware class is a \"layer\" that wraps the view:\n-\n-.. image:: _images/middleware.png\n-   :width: 502\n-   :height: 417\n-   :alt: Middleware application order.\n-\n-A Django installation doesn't require any middleware -- e.g.,\n-:setting:`MIDDLEWARE_CLASSES` can be empty, if you'd like -- but it's strongly\n+A Django installation doesn't require any middleware —\n+:setting:`MIDDLEWARE_CLASSES` can be empty, if you'd like — but it's strongly\n suggested that you at least use\n :class:`~django.middleware.common.CommonMiddleware`.\n \n+The order in :setting:`MIDDLEWARE_CLASSES` matters because a middleware can\n+depend on other middleware. For instance,\n+:class:`~django.contrib.auth.middleware.AuthenticationMiddleware` stores the\n+authenticated user in the session; therefore, it must run after\n+:class:`~django.contrib.sessions.middleware.SessionMiddleware`.\n+\n+Hooks and application order\n+===========================\n+\n+During the request phase, before calling the view, Django applies middleware\n+in the order it's defined in :setting:`MIDDLEWARE_CLASSES`, top-down. Two\n+hooks are available:\n+\n+* :meth:`process_request`\n+* :meth:`process_view`\n+\n+During the response phase, after calling the view, middleware are applied in\n+reverse order, from the bottom up. Three hooks are available:\n+\n+* :meth:`process_exception` (only if the view raised an exception)\n+* :meth:`process_template_response` (only for template responses)\n+* :meth:`process_response`\n+\n+.. image:: _images/middleware.*\n+   :alt: middleware application order\n+   :width: 481\n+   :height: 409\n+\n+If you prefer, you can also think of it like an onion: each middleware class\n+is a \"layer\" that wraps the view.\n+\n+The behavior of each hook is described below.\n+\n Writing your own middleware\n ===========================\n \n@@ -62,16 +86,19 @@ Python class that defines one or more of the following methods:\n \n .. method:: process_request(self, request)\n \n-``request`` is an :class:`~django.http.HttpRequest` object. This method is\n-called on each request, before Django decides which view to execute.\n+``request`` is an :class:`~django.http.HttpRequest` object.\n+\n+``process_request()`` is called on each request, before Django decides which\n+view to execute.\n \n-``process_request()`` should return either ``None`` or an\n-:class:`~django.http.HttpResponse` object. If it returns ``None``, Django will\n-continue processing this request, executing any other middleware and, then, the\n-appropriate view. If it returns an :class:`~django.http.HttpResponse` object,\n-Django won't bother calling ANY other request, view or exception middleware, or\n-the appropriate view; it'll return that :class:`~django.http.HttpResponse`.\n-Response middleware is always called on every response.\n+It should return either ``None`` or an :class:`~django.http.HttpResponse`\n+object. If it returns ``None``, Django will continue processing this request,\n+executing any other ``process_request()`` middleware, then, ``process_view()``\n+middleware, and finally, the appropriate view. If it returns an\n+:class:`~django.http.HttpResponse` object, Django won't bother calling any\n+other request, view or exception middleware, or the appropriate view; it'll\n+apply response middleware to that :class:`~django.http.HttpResponse`, and\n+return the result.\n \n .. _view-middleware:\n \n@@ -88,14 +115,15 @@ dictionary of keyword arguments that will be passed to the view. Neither\n ``view_args`` nor ``view_kwargs`` include the first view argument\n (``request``).\n \n-``process_view()`` is called just before Django calls the view. It should\n-return either ``None`` or an :class:`~django.http.HttpResponse` object. If it\n-returns ``None``, Django will continue processing this request, executing any\n-other ``process_view()`` middleware and, then, the appropriate view. If it\n-returns an :class:`~django.http.HttpResponse` object, Django won't bother\n-calling ANY other request, view or exception middleware, or the appropriate\n-view; it'll return that :class:`~django.http.HttpResponse`. Response\n-middleware is always called on every response.\n+``process_view()`` is called just before Django calls the view.\n+\n+It should return either ``None`` or an :class:`~django.http.HttpResponse`\n+object. If it returns ``None``, Django will continue processing this request,\n+executing any other ``process_view()`` middleware and, then, the appropriate\n+view. If it returns an :class:`~django.http.HttpResponse` object, Django won't\n+bother calling any other view or exception middleware, or the appropriate\n+view; it'll apply response middleware to that\n+:class:`~django.http.HttpResponse`, and return the result.\n \n .. note::\n \n@@ -119,27 +147,25 @@ middleware is always called on every response.\n \n .. method:: process_template_response(self, request, response)\n \n-``request`` is an :class:`~django.http.HttpRequest` object. ``response`` is a\n-subclass of :class:`~django.template.response.SimpleTemplateResponse` (e.g.\n-:class:`~django.template.response.TemplateResponse`) or any response object\n-that implements a ``render`` method.\n+``request`` is an :class:`~django.http.HttpRequest` object. ``response`` is\n+the :class:`~django.template.response.TemplateResponse` object (or equivalent)\n+returned by a Django view or by a middleware.\n \n-``process_template_response()`` must return a response object that implements a\n-``render`` method. It could alter the given ``response`` by changing\n-``response.template_name`` and ``response.context_data``, or it could create\n-and return a brand-new\n-:class:`~django.template.response.SimpleTemplateResponse` or equivalent.\n+``process_template_response()`` is called just after the view has finished\n+executing, if the response instance has a ``render()`` method, indicating that\n+it is a :class:`~django.template.response.TemplateResponse` or equivalent.\n \n-``process_template_response()`` will only be called if the response\n-instance has a ``render()`` method, indicating that it is a\n+It must return a response object that implements a ``render`` method. It could\n+alter the given ``response`` by changing ``response.template_name`` and\n+``response.context_data``, or it could create and return a brand-new\n :class:`~django.template.response.TemplateResponse` or equivalent.\n \n You don't need to explicitly render responses -- responses will be\n automatically rendered once all template response middleware has been\n called.\n \n Middleware are run in reverse order during the response phase, which\n-includes process_template_response.\n+includes ``process_template_response()``.\n \n .. _response-middleware:\n \n@@ -148,21 +174,34 @@ includes process_template_response.\n \n .. method:: process_response(self, request, response)\n \n-``request`` is an :class:`~django.http.HttpRequest` object. ``response`` is the\n-:class:`~django.http.HttpResponse` object returned by a Django view.\n+``request`` is an :class:`~django.http.HttpRequest` object. ``response`` is\n+the :class:`~django.http.HttpResponse` or\n+:class:`~django.http.StreamingHttpResponse` object returned by a Django view\n+or by a middleware.\n+\n+``process_response()`` is called on all responses before they're returned to\n+the browser.\n \n-``process_response()`` must return an :class:`~django.http.HttpResponse`\n-object. It could alter the given ``response``, or it could create and return a\n-brand-new :class:`~django.http.HttpResponse`.\n+It must return an :class:`~django.http.HttpResponse` or\n+:class:`~django.http.StreamingHttpResponse` object. It could alter the given\n+``response``, or it could create and return a brand-new\n+:class:`~django.http.HttpResponse` or\n+:class:`~django.http.StreamingHttpResponse`.\n \n Unlike the ``process_request()`` and ``process_view()`` methods, the\n-``process_response()`` method is always called, even if the ``process_request()``\n-and ``process_view()`` methods of the same middleware class were skipped because\n-an earlier middleware method returned an :class:`~django.http.HttpResponse`\n-(this means that your ``process_response()`` method cannot rely on setup done in\n-``process_request()``, for example). In addition, during the response phase the\n-classes are applied in reverse order, from the bottom up. This means classes\n-defined at the end of :setting:`MIDDLEWARE_CLASSES` will be run first.\n+``process_response()`` method is always called, even if the\n+``process_request()`` and ``process_view()`` methods of the same middleware\n+class were skipped (because an earlier middleware method returned an\n+:class:`~django.http.HttpResponse`). In particular, this means that your\n+``process_response()`` method cannot rely on setup done in\n+``process_request()``.\n+\n+Finally, remember that during the response phase, middleware are applied in\n+reverse order, from the bottom up. This means classes defined at the end of\n+:setting:`MIDDLEWARE_CLASSES` will be run first.\n+\n+Dealing with streaming responses\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n .. versionchanged:: 1.5\n     ``response`` may also be an :class:`~django.http.StreamingHttpResponse`\n@@ -177,10 +216,17 @@ must test for streaming responses and adjust their behavior accordingly::\n     if response.streaming:\n         response.streaming_content = wrap_streaming_content(response.streaming_content)\n     else:\n-        response.content = wrap_content(response.content)\n+        response.content = alter_content(response.content)\n+\n+.. note::\n+\n+    ``streaming_content`` should be assumed to be too large to hold in memory.\n+    Response middleware may wrap it in a new generator, but must not consume\n+    it. Wrapping is typically implemented as follows::\n \n-``streaming_content`` should be assumed to be too large to hold in memory.\n-Middleware may wrap it in a new generator, but must not consume it.\n+        def wrap_streaming_content(content)\n+            for chunk in content:\n+                yield alter_content(chunk)\n \n .. _exception-middleware:\n \n@@ -195,8 +241,9 @@ Middleware may wrap it in a new generator, but must not consume it.\n Django calls ``process_exception()`` when a view raises an exception.\n ``process_exception()`` should return either ``None`` or an\n :class:`~django.http.HttpResponse` object. If it returns an\n-:class:`~django.http.HttpResponse` object, the response will be returned to\n-the browser. Otherwise, default exception handling kicks in.\n+:class:`~django.http.HttpResponse` object, the template response and response\n+middleware will be applied, and the resulting response returned to the\n+browser. Otherwise, default exception handling kicks in.\n \n Again, middleware are run in reverse order during the response phase, which\n includes ``process_exception``. If an exception middleware returns a response,\n@@ -221,9 +268,9 @@ Marking middleware as unused\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n It's sometimes useful to determine at run-time whether a piece of middleware\n-should be used. In these cases, your middleware's ``__init__`` method may raise\n-``django.core.exceptions.MiddlewareNotUsed``. Django will then remove that\n-piece of middleware from the middleware process.\n+should be used. In these cases, your middleware's ``__init__`` method may\n+raise :exc:`django.core.exceptions.MiddlewareNotUsed`. Django will then remove\n+that piece of middleware from the middleware process.\n \n Guidelines\n ----------"
        },
        {
            "sha": "baf8aa5cb5b3649643264d8a83d7dc4e5f23bf86",
            "filename": "docs/topics/http/sessions.txt",
            "status": "modified",
            "additions": 43,
            "deletions": 9,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fsessions.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -45,6 +45,8 @@ If you want to use a database-backed session, you need to add\n Once you have configured your installation, run ``manage.py syncdb``\n to install the single database table that stores session data.\n \n+.. _cached-sessions-backend:\n+\n Using cached sessions\n ---------------------\n \n@@ -62,6 +64,13 @@ sure you've configured your cache; see the :doc:`cache documentation\n     sessions directly instead of sending everything through the file or\n     database cache backends.\n \n+If you have multiple caches defined in :setting:`CACHES`, Django will use the\n+default cache. To use another cache, set :setting:`SESSION_CACHE_ALIAS` to the\n+name of that cache.\n+\n+.. versionchanged:: 1.5\n+    The :setting:`SESSION_CACHE_ALIAS` setting was added.\n+\n Once your cache is configured, you've got two choices for how to store data in\n the cache:\n \n@@ -250,17 +259,35 @@ You can edit it multiple times.\n       with no custom expiration (or those set to expire at browser close), this\n       will equal :setting:`SESSION_COOKIE_AGE`.\n \n+      This function accepts two optional keyword arguments:\n+\n+      - ``modification``: last modification of the session, as a\n+        :class:`~datetime.datetime` object. Defaults to the current time.\n+      - ``expiry``: expiry information for the session, as a\n+        :class:`~datetime.datetime` object, an :class:`int` (in seconds), or\n+        ``None``. Defaults to the value stored in the session by\n+        :meth:`set_expiry`, if there is one, or ``None``.\n+\n     .. method:: get_expiry_date\n \n       Returns the date this session will expire. For sessions with no custom\n       expiration (or those set to expire at browser close), this will equal the\n       date :setting:`SESSION_COOKIE_AGE` seconds from now.\n \n+      This function accepts the same keyword argumets as :meth:`get_expiry_age`.\n+\n     .. method:: get_expire_at_browser_close\n \n       Returns either ``True`` or ``False``, depending on whether the user's\n       session cookie will expire when the user's Web browser is closed.\n \n+    .. method:: SessionBase.clear_expired\n+\n+      .. versionadded:: 1.5\n+\n+      Removes expired sessions from the session store. This class method is\n+      called by :djadmin:`clearsessions`.\n+\n Session object guidelines\n -------------------------\n \n@@ -447,22 +474,29 @@ This setting is a global default and can be overwritten at a per-session level\n by explicitly calling the :meth:`~backends.base.SessionBase.set_expiry` method\n of ``request.session`` as described above in `using sessions in views`_.\n \n-Clearing the session table\n+Clearing the session store\n ==========================\n \n-If you're using the database backend, note that session data can accumulate in\n-the ``django_session`` database table and Django does *not* provide automatic\n-purging. Therefore, it's your job to purge expired sessions on a regular basis.\n+As users create new sessions on your website, session data can accumulate in\n+your session store. If you're using the database backend, the\n+``django_session`` database table will grow. If you're using the file backend,\n+your temporary directory will contain an increasing number of files.\n \n-To understand this problem, consider what happens when a user uses a session.\n+To understand this problem, consider what happens with the database backend.\n When a user logs in, Django adds a row to the ``django_session`` database\n table. Django updates this row each time the session data changes. If the user\n logs out manually, Django deletes the row. But if the user does *not* log out,\n-the row never gets deleted.\n+the row never gets deleted. A similar process happens with the file backend.\n+\n+Django does *not* provide automatic purging of expired sessions. Therefore,\n+it's your job to purge expired sessions on a regular basis. Django provides a\n+clean-up management command for this purpose: :djadmin:`clearsessions`. It's\n+recommended to call this command on a regular basis, for example as a daily\n+cron job.\n \n-Django provides a sample clean-up script: ``django-admin.py cleanup``.\n-That script deletes any session in the session table whose ``expire_date`` is\n-in the past -- but your application may have different requirements.\n+Note that the cache backend isn't vulnerable to this problem, because caches\n+automatically delete stale data. Neither is the cookie backend, because the\n+session data is stored by the users' browsers.\n \n Settings\n ========"
        },
        {
            "sha": "b1b4700b730eb8bfc07ca8d9ed88e72095a3431f",
            "filename": "docs/topics/http/shortcuts.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fshortcuts.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fshortcuts.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fshortcuts.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -4,7 +4,7 @@ Django shortcut functions\n \n .. module:: django.shortcuts\n    :synopsis:\n-       Convenience shortcuts that spam multiple levels of Django's MVC stack.\n+       Convenience shortcuts that span multiple levels of Django's MVC stack.\n \n .. index:: shortcuts\n "
        },
        {
            "sha": "00c07da6ea7465888b30ab15ce2766229c842f41",
            "filename": "docs/topics/http/urls.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Furls.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Furls.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Furls.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -552,12 +552,11 @@ layers where URLs are needed:\n \n * In templates: Using the :ttag:`url` template tag.\n \n-* In Python code: Using the :func:`django.core.urlresolvers.reverse()`\n+* In Python code: Using the :func:`django.core.urlresolvers.reverse`\n   function.\n \n * In higher level code related to handling of URLs of Django model instances:\n-  The :meth:`django.db.models.Model.get_absolute_url()` method and the\n-  :func:`django.db.models.permalink` decorator.\n+  The :meth:`~django.db.models.Model.get_absolute_url` method.\n \n Examples\n --------\n@@ -622,10 +621,10 @@ view::\n     )\n \n This is completely valid, but it leads to problems when you try to do reverse\n-URL matching (through the :func:`~django.db.models.permalink` decorator or the\n-:ttag:`url` template tag). Continuing this example, if you wanted to retrieve\n-the URL for the ``archive`` view, Django's reverse URL matcher would get\n-confused, because *two* URL patterns point at that view.\n+URL matching (through the :func:`~django.core.urlresolvers.reverse` function\n+or the :ttag:`url` template tag). Continuing this example, if you wanted to\n+retrieve the URL for the ``archive`` view, Django's reverse URL matcher would\n+get confused, because *two* URL patterns point at that view.\n \n To solve this problem, Django supports **named URL patterns**. That is, you can\n give a name to a URL pattern in order to distinguish it from other patterns\n@@ -724,7 +723,7 @@ the fully qualified name into parts, and then tries the following lookup:\n    render a template.\n \n    The current application can also be specified manually as an argument\n-   to the :func:`django.core.urlresolvers.reverse()` function.\n+   to the :func:`django.core.urlresolvers.reverse` function.\n \n 3. If there is no current application. Django looks for a default\n    application instance. The default application instance is the instance"
        },
        {
            "sha": "caa2882f37968ead47d9477ebac6f00112e847bf",
            "filename": "docs/topics/http/views.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fviews.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -209,6 +209,17 @@ This view loads and renders the template ``403.html`` in your root template\n directory, or if this file does not exist, instead serves the text\n \"403 Forbidden\", as per :rfc:`2616` (the HTTP 1.1 Specification).\n \n+``django.views.defaults.permission_denied`` is triggered by a\n+:exc:`~django.core.exceptions.PermissionDenied` exception. To deny access in a\n+view you can use code like this::\n+\n+    from django.core.exceptions import PermissionDenied\n+\n+    def edit(request, pk):\n+        if not request.user.is_staff:\n+            raise PermissionDenied\n+        # ...\n+\n It is possible to override ``django.views.defaults.permission_denied`` in the\n same way you can for the 404 and 500 views by specifying a ``handler403`` in\n your URLconf::"
        },
        {
            "sha": "b71033f319da38e17abf490851ebc8595d4f37ce",
            "filename": "docs/topics/install.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 16,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Finstall.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -10,7 +10,7 @@ Install Python\n Being a Python Web framework, Django requires Python.\n \n It works with any Python version from 2.6.5 to 2.7. It also features\n-experimental support for versions 3.2 and 3.3.\n+experimental support for versions from 3.2.3 to 3.3.\n \n Get Python at http://www.python.org. If you're running Linux or Mac OS X, you\n probably already have it installed.\n@@ -106,15 +106,15 @@ support channels provided by each 3rd party project.\n In addition to a database backend, you'll need to make sure your Python\n database bindings are installed.\n \n-* If you're using PostgreSQL, you'll need the ``postgresql_psycopg2`` package.\n+* If you're using PostgreSQL, you'll need the `postgresql_psycopg2`_ package.\n   You might want to refer to our :ref:`PostgreSQL notes <postgresql-notes>` for\n   further technical details specific to this database.\n \n   If you're on Windows, check out the unofficial `compiled Windows version`_.\n \n-* If you're using MySQL, you'll need the ``MySQL-python`` package, version 1.2.1p2 or higher. You\n-  will also want to read the database-specific :ref:`notes for the MySQL\n-  backend <mysql-notes>`.\n+* If you're using MySQL, you'll need the ``MySQL-python`` package, version\n+  1.2.1p2 or higher. You will also want to read the database-specific\n+  :ref:`notes for the MySQL backend <mysql-notes>`.\n \n * If you're using Oracle, you'll need a copy of cx_Oracle_, but please\n   read the database-specific :ref:`notes for the Oracle backend <oracle-notes>`\n@@ -124,21 +124,23 @@ database bindings are installed.\n * If you're using an unofficial 3rd party backend, please consult the\n   documentation provided for any additional requirements.\n \n-If you plan to use Django's ``manage.py syncdb`` command to\n-automatically create database tables for your models, you'll need to\n-ensure that Django has permission to create and alter tables in the\n-database you're using; if you plan to manually create the tables, you\n-can simply grant Django ``SELECT``, ``INSERT``, ``UPDATE`` and\n-``DELETE`` permissions. On some databases, Django will need\n-``ALTER TABLE`` privileges during ``syncdb`` but won't issue\n-``ALTER TABLE`` statements on a table once ``syncdb`` has created it.\n+If you plan to use Django's ``manage.py syncdb`` command to automatically\n+create database tables for your models (after first installing Django and\n+creating a project), you'll need to ensure that Django has permission to create\n+and alter tables in the database you're using; if you plan to manually create\n+the tables, you can simply grant Django ``SELECT``, ``INSERT``, ``UPDATE`` and\n+``DELETE`` permissions. On some databases, Django will need ``ALTER TABLE``\n+privileges during ``syncdb`` but won't issue ``ALTER TABLE`` statements on a\n+table once ``syncdb`` has created it. After creating a database user with these\n+permissions, you'll specify the details in your project's settings file,\n+see :setting:`DATABASES` for details.\n \n-If you're using Django's :doc:`testing framework</topics/testing>` to test database queries,\n-Django will need permission to create a test database.\n+If you're using Django's :doc:`testing framework</topics/testing>` to test\n+database queries, Django will need permission to create a test database.\n \n .. _PostgreSQL: http://www.postgresql.org/\n .. _MySQL: http://www.mysql.com/\n-.. _psycopg: http://initd.org/pub/software/psycopg/\n+.. _postgresql_psycopg2: http://initd.org/psycopg/\n .. _compiled Windows version: http://stickpeople.com/projects/python/win-psycopg/\n .. _SQLite: http://www.sqlite.org/\n .. _pysqlite: http://trac.edgewall.org/wiki/PySqlite"
        },
        {
            "sha": "652ad397ff07709db7fb934aac457b47be85415c",
            "filename": "docs/topics/logging.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Flogging.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Flogging.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Flogging.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -440,7 +440,7 @@ Handlers\n Django provides one log handler in addition to those provided by the\n Python logging module.\n \n-.. class:: AdminEmailHandler([include_html=False])\n+.. class:: AdminEmailHandler(include_html=False, email_backend=None)\n \n     This handler sends an email to the site admins for each log\n     message it receives.\n@@ -470,13 +470,30 @@ Python logging module.\n     with names and values of local variables at each level of the stack, plus\n     the values of your Django settings. This information is potentially very\n     sensitive, and you may not want to send it over email. Consider using\n-    something such as `django-sentry`_ to get the best of both worlds -- the\n+    something such as `Sentry`_ to get the best of both worlds -- the\n     rich information of full tracebacks plus the security of *not* sending the\n     information over email. You may also explicitly designate certain\n     sensitive information to be filtered out of error reports -- learn more on\n     :ref:`Filtering error reports<filtering-error-reports>`.\n \n-.. _django-sentry: http://pypi.python.org/pypi/django-sentry\n+    .. versionadded:: 1.6\n+\n+    By setting the ``email_backend`` argument of ``AdminEmailHandler``, the\n+    :ref:`email backend <topic-email-backends>` that is being used by the\n+    handler can be overridden, like this::\n+\n+        'handlers': {\n+            'mail_admins': {\n+                'level': 'ERROR',\n+                'class': 'django.utils.log.AdminEmailHandler',\n+                'email_backend': 'django.core.mail.backends.filebased.EmailBackend',\n+            }\n+        },\n+\n+    By default, an instance of the email backend specified in\n+    :setting:`EMAIL_BACKEND` will be used.\n+\n+.. _Sentry: http://pypi.python.org/pypi/sentry\n \n \n Filters"
        },
        {
            "sha": "e6dc165399b7c728ecddff8b6054f949bb493aef",
            "filename": "docs/topics/python3.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fpython3.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fpython3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fpython3.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -278,15 +278,13 @@ Iterators\n \n ::\n \n-    class MyIterator(object):\n+    class MyIterator(six.Iterator):\n         def __iter__(self):\n             return self             # implement some logic here\n \n         def __next__(self):\n             raise StopIteration     # implement some logic here\n \n-        next = __next__             # Python 2 compatibility\n-\n Boolean evaluation\n ~~~~~~~~~~~~~~~~~~\n \n@@ -297,7 +295,8 @@ Boolean evaluation\n         def __bool__(self):\n             return True             # implement some logic here\n \n-        __nonzero__ = __bool__      # Python 2 compatibility\n+        def __nonzero__(self):      # Python 2 compatibility\n+            return type(self).__bool__(self)\n \n Division\n ~~~~~~~~\n@@ -309,12 +308,14 @@ Division\n         def __truediv__(self, other):\n             return self / other     # implement some logic here\n \n-        __div__ = __truediv__           # Python 2 compatibility\n+        def __div__(self, other):   # Python 2 compatibility\n+            return type(self).__truediv__(self, other)\n \n         def __itruediv__(self, other):\n             return self // other    # implement some logic here\n \n-        __idiv__ = __itruediv__         # Python 2 compatibility\n+        def __idiv__(self, other):  # Python 2 compatibility\n+            return type(self).__itruediv__(self, other)\n \n .. module: django.utils.six\n "
        },
        {
            "sha": "169f9ac7732508121dc63e3a0de857e07961df56",
            "filename": "docs/topics/security.txt",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fsecurity.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fsecurity.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fsecurity.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -185,6 +185,31 @@ recommend you ensure your Web server is configured such that:\n Additionally, as of 1.3.1, Django requires you to explicitly enable support for\n the ``X-Forwarded-Host`` header if your configuration requires it.\n \n+Configuration for Apache\n+------------------------\n+\n+The easiest way to get the described behavior in Apache is as follows. Create\n+a `virtual host`_ using the ServerName_ and ServerAlias_ directives to restrict\n+the domains Apache reacts to. Please keep in mind that while the directives do\n+support ports the match is only performed against the hostname. This means that\n+the ``Host`` header could still contain a port pointing to another webserver on\n+the same machine. The next step is to make sure that your newly created virtual\n+host is not also the default virtual host. Apache uses the first virtual host\n+found in the configuration file as default virtual host.  As such you have to\n+ensure that you have another virtual host which will act as catch-all virtual\n+host. Just add one if you do not have one already, there is nothing special\n+about it aside from ensuring it is the first virtual host in the configuration\n+file. Debian/Ubuntu users usually don't have to take any action, since Apache\n+ships with a default virtual host in ``sites-available`` which is linked into\n+``sites-enabled`` as ``000-default`` and included from ``apache2.conf``. Just\n+make sure not to name your site ``000-abc``, since files are included in\n+alphabetical order.\n+\n+.. _virtual host: http://httpd.apache.org/docs/2.2/vhosts/\n+.. _ServerName: http://httpd.apache.org/docs/2.2/mod/core.html#servername\n+.. _ServerAlias: http://httpd.apache.org/docs/2.2/mod/core.html#serveralias\n+\n+\n .. _additional-security-topics:\n \n Additional security topics"
        },
        {
            "sha": "28f600e2237929184c8b9378bdc591c4fc3c8258",
            "filename": "docs/topics/serialization.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fserialization.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Fserialization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fserialization.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -166,15 +166,6 @@ Notes for specific serialization formats\n json\n ^^^^\n \n-If you're using UTF-8 (or any other non-ASCII encoding) data with the JSON\n-serializer, you must pass ``ensure_ascii=False`` as a parameter to the\n-``serialize()`` call. Otherwise, the output won't be encoded correctly.\n-\n-For example::\n-\n-    json_serializer = serializers.get_serializer(\"json\")()\n-    json_serializer.serialize(queryset, ensure_ascii=False, stream=response)\n-\n Be aware that not all Django output can be passed unmodified to :mod:`json`.\n In particular, :ref:`lazy translation objects <lazy-translations>` need a\n `special encoder`_ written for them. Something like this will work::"
        },
        {
            "sha": "fb2119515b29f01d791e5fa300a75ed7212c9d7e",
            "filename": "docs/topics/templates.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Ftemplates.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Ftemplates.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftemplates.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -16,9 +16,9 @@ or CheetahTemplate_, you should feel right at home with Django's templates.\n .. admonition:: Philosophy\n \n     If you have a background in programming, or if you're used to languages\n-    like PHP which mix programming code directly into HTML, you'll want to\n-    bear in mind that the Django template system is not simply Python embedded\n-    into HTML. This is by design: the template system is meant to express\n+    which mix programming code directly into HTML, you'll want to bear in\n+    mind that the Django template system is not simply Python embedded into\n+    HTML. This is by design: the template system is meant to express\n     presentation, not program logic.\n \n     The Django template system provides tags which function similarly to some"
        },
        {
            "sha": "8c11e32a5570f032019a057118db9bd797ab008a",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 38,
            "deletions": 11,
            "changes": 49,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -379,6 +379,15 @@ control the particular collation used by the test database. See the\n :doc:`settings documentation </ref/settings>` for details of these\n advanced settings.\n \n+.. admonition:: Finding data from your production database when running tests?\n+\n+    If your code attempts to access the database when its modules are compiled,\n+    this will occur *before* the test database is set up, with potentially\n+    unexpected results. For example, if you have a database query in\n+    module-level code and a real database exists, production data could pollute\n+    your tests. *It is a bad idea to have such import-time database queries in\n+    your code* anyway - rewrite your code so that it doesn't do this.\n+\n .. _topics-testing-masterslave:\n \n Testing master/slave configurations\n@@ -1177,10 +1186,13 @@ Normal Python unit test classes extend a base class of\n \n .. _testcase_hierarchy_diagram:\n \n-.. figure:: _images/django_unittest_classes_hierarchy.png\n+.. figure:: _images/django_unittest_classes_hierarchy.*\n    :alt: Hierarchy of Django unit testing classes (TestCase subclasses)\n+   :width: 508\n+   :height: 391\n \n-   Hierarchy of Django unit testing classes\n+Regardless of the version of Python you're using, if you've installed\n+:mod:`unittest2`, :mod:`django.utils.unittest` will point to that library.\n \n TestCase\n ^^^^^^^^\n@@ -1586,15 +1598,24 @@ The decorator can also be applied to test case classes::\n     the original ``LoginTestCase`` is still equally affected by the\n     decorator.\n \n-.. note::\n-\n-    When overriding settings, make sure to handle the cases in which your app's\n-    code uses a cache or similar feature that retains state even if the\n-    setting is changed. Django provides the\n-    :data:`django.test.signals.setting_changed` signal that lets you register\n-    callbacks to clean up and otherwise reset state when settings are changed.\n-    Note that this signal isn't currently used by Django itself, so changing\n-    built-in settings may not yield the results you expect.\n+When overriding settings, make sure to handle the cases in which your app's\n+code uses a cache or similar feature that retains state even if the\n+setting is changed. Django provides the\n+:data:`django.test.signals.setting_changed` signal that lets you register\n+callbacks to clean up and otherwise reset state when settings are changed.\n+\n+Django itself uses this signal to reset various data:\n+\n+================================ ========================\n+Overriden settings               Data reset\n+================================ ========================\n+USE_TZ, TIME_ZONE                Databases timezone\n+TEMPLATE_CONTEXT_PROCESSORS      Context processors cache\n+TEMPLATE_LOADERS                 Template loaders cache\n+SERIALIZATION_MODULES            Serializers cache\n+LOCALE_PATHS, LANGUAGE_CODE      Default translation and loaded translations\n+MEDIA_ROOT, DEFAULT_FILE_STORAGE Default file storage\n+================================ ========================\n \n Emptying the test outbox\n ~~~~~~~~~~~~~~~~~~~~~~~~\n@@ -1752,6 +1773,11 @@ your test suite.\n \tvia an explicit ``order_by()`` call on the queryset prior to\n \tcomparison.\n \n+    .. versionchanged:: 1.6\n+        The method now checks for undefined order and raises ``ValueError``\n+        if undefined order is spotted. The ordering is seen as undefined if\n+        the given ``qs`` isn't ordered and the comparison is against more\n+        than one ordered values.\n \n .. method:: TestCase.assertNumQueries(num, func, *args, **kwargs)\n \n@@ -2075,6 +2101,7 @@ out the `full reference`_ for more details.\n \n         def test_login(self):\n             from selenium.webdriver.support.wait import WebDriverWait\n+            timeout = 2\n             ...\n             self.selenium.find_element_by_xpath('//input[@value=\"Log in\"]').click()\n             # Wait until the response is received"
        },
        {
            "sha": "1c83b980a73e21d3c700ca4f8192d3e5215bef8c",
            "filename": "tests/modeltests/basic/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbasic%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -2,7 +2,7 @@\n \n from datetime import datetime\n \n-from django.core.exceptions import ObjectDoesNotExist\n+from django.core.exceptions import ObjectDoesNotExist, MultipleObjectsReturned\n from django.db.models.fields import Field, FieldDoesNotExist\n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n from django.utils import six\n@@ -128,6 +128,40 @@ def test_lookup(self):\n         b = Article.objects.get(pk=a.id)\n         self.assertEqual(a, b)\n \n+        # Create a very similar object\n+        a = Article(\n+            id=None,\n+            headline='Area man programs in Python',\n+            pub_date=datetime(2005, 7, 28),\n+        )\n+        a.save()\n+\n+        self.assertEqual(Article.objects.count(), 2)\n+\n+        # Django raises an Article.MultipleObjectsReturned exception if the\n+        # lookup matches more than one object\n+        self.assertRaisesRegexp(\n+            MultipleObjectsReturned,\n+            \"get\\(\\) returned more than one Article -- it returned 2!\",\n+            Article.objects.get,\n+            headline__startswith='Area',\n+        )\n+\n+        self.assertRaisesRegexp(\n+            MultipleObjectsReturned,\n+            \"get\\(\\) returned more than one Article -- it returned 2!\",\n+            Article.objects.get,\n+            pub_date__year=2005,\n+        )\n+\n+        self.assertRaisesRegexp(\n+            MultipleObjectsReturned,\n+            \"get\\(\\) returned more than one Article -- it returned 2!\",\n+            Article.objects.get,\n+            pub_date__year=2005,\n+            pub_date__month=7,\n+        )\n+\n     def test_object_creation(self):\n         # Create an Article.\n         a = Article("
        },
        {
            "sha": "a35149644235864a6290bbf68c4d2aae9389f2f7",
            "filename": "tests/modeltests/expressions/tests.py",
            "status": "modified",
            "additions": 42,
            "deletions": 1,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/tests%2Fmodeltests%2Fexpressions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/tests%2Fmodeltests%2Fexpressions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fexpressions%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -158,6 +158,7 @@ def test_filter(self):\n                 \"Max Mustermann\",\n             ],\n             lambda c: six.text_type(c.point_of_contact),\n+            ordered=False\n         )\n \n         c = Company.objects.all()[0]\n@@ -170,7 +171,8 @@ def test_filter(self):\n                 \"Foobar Ltd.\",\n                 \"Test GmbH\",\n             ],\n-            lambda c: c.name\n+            lambda c: c.name,\n+            ordered=False\n         )\n \n         Company.objects.exclude(\n@@ -219,3 +221,42 @@ def test():\n         )\n         acme.num_employees = F(\"num_employees\") + 16\n         self.assertRaises(TypeError, acme.save)\n+\n+    def test_ticket_18375_join_reuse(self):\n+        # Test that reverse multijoin F() references and the lookup target\n+        # the same join. Pre #18375 the F() join was generated first, and the\n+        # lookup couldn't reuse that join.\n+        qs = Employee.objects.filter(\n+            company_ceo_set__num_chairs=F('company_ceo_set__num_employees'))\n+        self.assertEqual(str(qs.query).count('JOIN'), 1)\n+\n+    def test_ticket_18375_kwarg_ordering(self):\n+        # The next query was dict-randomization dependent - if the \"gte=1\"\n+        # was seen first, then the F() will reuse the join generated by the\n+        # gte lookup, if F() was seen first, then it generated a join the\n+        # other lookups could not reuse.\n+        qs = Employee.objects.filter(\n+            company_ceo_set__num_chairs=F('company_ceo_set__num_employees'),\n+            company_ceo_set__num_chairs__gte=1)\n+        self.assertEqual(str(qs.query).count('JOIN'), 1)\n+\n+    def test_ticket_18375_kwarg_ordering_2(self):\n+        # Another similar case for F() than above. Now we have the same join\n+        # in two filter kwargs, one in the lhs lookup, one in F. Here pre\n+        # #18375 the amount of joins generated was random if dict\n+        # randomization was enabled, that is the generated query dependend\n+        # on which clause was seen first.\n+        qs = Employee.objects.filter(\n+            company_ceo_set__num_employees=F('pk'),\n+            pk=F('company_ceo_set__num_employees')\n+        )\n+        self.assertEqual(str(qs.query).count('JOIN'), 1)\n+\n+    def test_ticket_18375_chained_filters(self):\n+        # Test that F() expressions do not reuse joins from previous filter.\n+        qs = Employee.objects.filter(\n+            company_ceo_set__num_employees=F('pk')\n+        ).filter(\n+            company_ceo_set__num_employees=F('company_ceo_set__num_employees')\n+        )\n+        self.assertEqual(str(qs.query).count('JOIN'), 2)"
        },
        {
            "sha": "0ec317dea583feb5124ac5da2b10bdce9911e019",
            "filename": "tests/modeltests/field_subclassing/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py?ref=b62e82365ad56ca930f7abb1d1dbdf9ce5a7c7c3",
            "patch": "@@ -77,7 +77,8 @@ def test_custom_field(self):\n                 \"12\",\n                 \"23\",\n             ],\n-            lambda m: str(m.data)\n+            lambda m: str(m.data),\n+            ordered=False\n         )\n \n     def test_field_subclassing(self):"
        }
    ],
    "stats": {
        "total": 15273,
        "additions": 11668,
        "deletions": 3605
    }
}