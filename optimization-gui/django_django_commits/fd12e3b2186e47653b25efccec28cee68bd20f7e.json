{
    "author": "ramiro",
    "message": "Fixed #15024 -- Ensure that choice of L10N format module used is stable given a stable setup of format modules in ll/ and ll_CC/ dirs. Thanks David Reynolds for the report and suggestions leading to the solution.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15183 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "fd12e3b2186e47653b25efccec28cee68bd20f7e",
    "files": [
        {
            "sha": "1eb7a3d837ae259918f9feb1b9a54f571f4f55f2",
            "filename": "django/utils/formats.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/fd12e3b2186e47653b25efccec28cee68bd20f7e/django%2Futils%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/fd12e3b2186e47653b25efccec28cee68bd20f7e/django%2Futils%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fformats.py?ref=fd12e3b2186e47653b25efccec28cee68bd20f7e",
            "patch": "@@ -24,7 +24,9 @@ def iter_format_modules(lang):\n             format_locations.append(settings.FORMAT_MODULE_PATH + '.%s')\n             format_locations.reverse()\n         locale = to_locale(lang)\n-        locales = set((locale, locale.split('_')[0]))\n+        locales = [locale]\n+        if '_' in locale:\n+            locales.append(locale.split('_')[0])\n         for location in format_locations:\n             for loc in locales:\n                 try:"
        },
        {
            "sha": "98c0ed9aaa476892aa432bbe859b5a9c30d92557",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/fd12e3b2186e47653b25efccec28cee68bd20f7e/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fd12e3b2186e47653b25efccec28cee68bd20f7e/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=fd12e3b2186e47653b25efccec28cee68bd20f7e",
            "patch": "@@ -480,6 +480,19 @@ def test_iter_format_modules(self):\n             settings.FORMAT_MODULE_PATH = old_format_module_path\n             deactivate()\n \n+    def test_iter_format_modules_stability(self):\n+        \"\"\"\n+        Tests the iter_format_modules function always yields format modules in\n+        a stable and correct order in presence of both base ll and ll_CC formats.\n+        \"\"\"\n+        try:\n+            old_l10n, settings.USE_L10N = settings.USE_L10N, True\n+            en_format_mod = import_module('django.conf.locale.en.formats')\n+            en_gb_format_mod = import_module('django.conf.locale.en_GB.formats')\n+            self.assertEqual(list(iter_format_modules('en-gb')), [en_gb_format_mod, en_format_mod])\n+        finally:\n+            settings.USE_L10N = old_l10n\n+\n     def test_localize_templatetag_and_filter(self):\n         \"\"\"\n         Tests the {% localize %} templatetag"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 16,
        "deletions": 1
    }
}