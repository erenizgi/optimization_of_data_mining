{
    "author": "jphalip",
    "message": "Added some Selenium tests for the admin's filter_horizontal and filter_vertical widgets. Ref #13614, #15220.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17579 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f2de5f4caba819fad10a78bfec47ae6f29cc2c29",
    "files": [
        {
            "sha": "eb04b40d1559a3046f49d3edfb7a30d19d22789e",
            "filename": "django/contrib/admin/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/django%2Fcontrib%2Fadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/django%2Fcontrib%2Fadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftests.py?ref=f2de5f4caba819fad10a78bfec47ae6f29cc2c29",
            "patch": "@@ -73,15 +73,25 @@ def get_css_value(self, selector, attribute):\n         return self.selenium.execute_script(\n             'return django.jQuery(\"%s\").css(\"%s\")' % (selector, attribute))\n \n-    def select_option(self, selector, value):\n+    def get_select_option(self, selector, value):\n         \"\"\"\n-        Helper function to select the <OPTION> that has the value `value` and\n-        that is in the <SELECT> widget identified by the CSS selector `selector`.\n+        Returns the <OPTION> with the value `value` inside the <SELECT> widget\n+        identified by the CSS selector `selector`.\n         \"\"\"\n         from selenium.common.exceptions import NoSuchElementException\n         options = self.selenium.find_elements_by_css_selector('%s option' % selector)\n         for option in options:\n             if option.get_attribute('value') == value:\n-                option.click()\n-                return\n-        raise NoSuchElementException('Option \"%s\" not found in \"%s\"' % (value, selector))\n\\ No newline at end of file\n+                return option\n+        raise NoSuchElementException('Option \"%s\" not found in \"%s\"' % (value, selector))\n+\n+    def assertSelectOptions(self, selector, values):\n+        \"\"\"\n+        Asserts that the <SELECT> widget identified by `selector` has the\n+        options with the given `values`.\n+        \"\"\"\n+        options = self.selenium.find_elements_by_css_selector('%s option' % selector)\n+        actual_values = []\n+        for option in options:\n+            actual_values.append(option.get_attribute('value'))\n+        self.assertEqual(values, actual_values)\n\\ No newline at end of file"
        },
        {
            "sha": "760f31acbbbc51ce901b7fa341204c7e7ce66d2b",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=f2de5f4caba819fad10a78bfec47ae6f29cc2c29",
            "patch": "@@ -2911,7 +2911,7 @@ def test_basic(self):\n \n         # Main form ----------------------------------------------------------\n         self.selenium.find_element_by_css_selector('#id_pubdate').send_keys('2012-02-18')\n-        self.select_option('#id_status', 'option two')\n+        self.get_select_option('#id_status', 'option two').click()\n         self.selenium.find_element_by_css_selector('#id_name').send_keys(u' this is the mAin nÀMë and it\\'s awεšome')\n         slug1 = self.selenium.find_element_by_css_selector('#id_slug1').get_attribute('value')\n         slug2 = self.selenium.find_element_by_css_selector('#id_slug2').get_attribute('value')\n@@ -2921,7 +2921,7 @@ def test_basic(self):\n         # Stacked inlines ----------------------------------------------------\n         # Initial inline\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-0-pubdate').send_keys('2011-12-17')\n-        self.select_option('#id_relatedprepopulated_set-0-status', 'option one')\n+        self.get_select_option('#id_relatedprepopulated_set-0-status', 'option one').click()\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-0-name').send_keys(u' here is a sŤāÇkeð   inline !  ')\n         slug1 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-0-slug1').get_attribute('value')\n         slug2 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-0-slug2').get_attribute('value')\n@@ -2931,7 +2931,7 @@ def test_basic(self):\n         # Add an inline\n         self.selenium.find_element_by_css_selector('#relatedprepopulated_set-group .add-row a').click()\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-pubdate').send_keys('1999-01-25')\n-        self.select_option('#id_relatedprepopulated_set-1-status', 'option two')\n+        self.get_select_option('#id_relatedprepopulated_set-1-status', 'option two').click()\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-name').send_keys(u' now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooog text... ')\n         slug1 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-slug1').get_attribute('value')\n         slug2 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-slug2').get_attribute('value')\n@@ -2941,7 +2941,7 @@ def test_basic(self):\n         # Tabular inlines ----------------------------------------------------\n         # Initial inline\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-0-pubdate').send_keys('1234-12-07')\n-        self.select_option('#id_relatedprepopulated_set-2-0-status', 'option two')\n+        self.get_select_option('#id_relatedprepopulated_set-2-0-status', 'option two').click()\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-0-name').send_keys(u'And now, with a tÃbűlaŘ inline !!!')\n         slug1 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-0-slug1').get_attribute('value')\n         slug2 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-0-slug2').get_attribute('value')\n@@ -2951,7 +2951,7 @@ def test_basic(self):\n         # Add an inline\n         self.selenium.find_element_by_css_selector('#relatedprepopulated_set-2-group .add-row a').click()\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-1-pubdate').send_keys('1981-08-22')\n-        self.select_option('#id_relatedprepopulated_set-2-1-status', 'option one')\n+        self.get_select_option('#id_relatedprepopulated_set-2-1-status', 'option one').click()\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-1-name').send_keys(u'a tÃbűlaŘ inline with ignored ;\"&*^\\%$#@-/`~ characters')\n         slug1 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-1-slug1').get_attribute('value')\n         slug2 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-2-1-slug2').get_attribute('value')"
        },
        {
            "sha": "1973d5069f7c9e6a4029fd6fbfd35bf31add9e8f",
            "filename": "tests/regressiontests/admin_widgets/models.py",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py?ref=f2de5f4caba819fad10a78bfec47ae6f29cc2c29",
            "patch": "@@ -99,3 +99,21 @@ class Advisor(models.Model):\n     \"\"\"\n     name = models.CharField(max_length=20)\n     companies = models.ManyToManyField(Company)\n+\n+\n+class Student(models.Model):\n+    name = models.CharField(max_length=255)\n+\n+    def __unicode__(self):\n+        return self.name\n+\n+    class Meta:\n+        ordering = ('name',)\n+\n+class School(models.Model):\n+    name = models.CharField(max_length=255)\n+    students = models.ManyToManyField(Student, related_name='current_schools')\n+    alumni = models.ManyToManyField(Student, related_name='previous_schools')\n+\n+    def __unicode__(self):\n+        return self.name\n\\ No newline at end of file"
        },
        {
            "sha": "b0b32095d276dfd853d3930a8f2b5d3ba592603f",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 130,
            "deletions": 2,
            "changes": 132,
            "blob_url": "https://github.com/django/django/blob/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=f2de5f4caba819fad10a78bfec47ae6f29cc2c29",
            "patch": "@@ -410,7 +410,8 @@ def test_no_can_add_related(self):\n         self.assertFalse(w.can_add_related)\n \n \n-class SeleniumFirefoxTests(AdminSeleniumWebDriverTestCase):\n+\n+class DateTimePickerSeleniumFirefoxTests(AdminSeleniumWebDriverTestCase):\n     webdriver_class = 'selenium.webdriver.firefox.webdriver.WebDriver'\n     fixtures = ['admin-widgets-users.xml']\n     urls = \"regressiontests.admin_widgets.urls\"\n@@ -458,5 +459,132 @@ def test_show_hide_date_time_picker_widgets(self):\n         self.assertEqual(\n             self.get_css_value('#clockbox0', 'display'), 'none')\n \n-class SeleniumChromeTests(SeleniumFirefoxTests):\n+class DateTimePickerSeleniumChromeTests(DateTimePickerSeleniumFirefoxTests):\n+    webdriver_class = 'selenium.webdriver.chrome.webdriver.WebDriver'\n+\n+\n+class HorizontalVerticalFilterSeleniumFirefoxTests(AdminSeleniumWebDriverTestCase):\n+    webdriver_class = 'selenium.webdriver.firefox.webdriver.WebDriver'\n+    fixtures = ['admin-widgets-users.xml']\n+    urls = \"regressiontests.admin_widgets.urls\"\n+\n+    def setUp(self):\n+        self.lisa = models.Student.objects.create(name='Lisa')\n+        self.john = models.Student.objects.create(name='John')\n+        self.bob = models.Student.objects.create(name='Bob')\n+        self.peter = models.Student.objects.create(name='Peter')\n+        self.jenny = models.Student.objects.create(name='Jenny')\n+        self.jason = models.Student.objects.create(name='Jason')\n+        self.cliff = models.Student.objects.create(name='Cliff')\n+        self.arthur = models.Student.objects.create(name='Arthur')\n+        self.school = models.School.objects.create(name='School of Awesome')\n+        super(HorizontalVerticalFilterSeleniumFirefoxTests, self).setUp()\n+\n+    def execute_basic_operations(self, field_name, mode):\n+        from_box = '#id_%s_from' % field_name\n+        to_box = '#id_%s_to' % field_name\n+        choose_link = 'id_%s_add_link' % field_name\n+        choose_all_link = 'id_%s_add_all_link' % field_name\n+        remove_link = 'id_%s_remove_link' % field_name\n+        remove_all_link = 'id_%s_remove_all_link' % field_name\n+\n+        # Initial positions ---------------------------------------------------\n+        self.assertSelectOptions(from_box,\n+                        [str(self.arthur.id), str(self.bob.id),\n+                         str(self.cliff.id), str(self.jason.id),\n+                         str(self.jenny.id), str(self.john.id)])\n+        self.assertSelectOptions(to_box,\n+                        [str(self.lisa.id), str(self.peter.id)])\n+\n+        # Click 'Choose all' --------------------------------------------------\n+        if mode == 'horizontal':\n+            self.selenium.find_element_by_id(choose_all_link).click()\n+        elif mode == 'vertical':\n+            # There 's no 'Choose all' button in vertical mode, so individually\n+            # select all options and click 'Choose'.\n+            for option in self.selenium.find_elements_by_css_selector(from_box + ' option'):\n+                option.click()\n+            self.selenium.find_element_by_id(choose_link).click()\n+        self.assertSelectOptions(from_box, [])\n+        self.assertSelectOptions(to_box,\n+                        [str(self.lisa.id), str(self.peter.id),\n+                         str(self.arthur.id), str(self.bob.id),\n+                         str(self.cliff.id), str(self.jason.id),\n+                         str(self.jenny.id), str(self.john.id)])\n+\n+        # Click 'Remove all' --------------------------------------------------\n+        if mode == 'horizontal':\n+            self.selenium.find_element_by_id(remove_all_link).click()\n+        elif mode == 'vertical':\n+            # There 's no 'Remove all' button in vertical mode, so individually\n+            # select all options and click 'Remove'.\n+            for option in self.selenium.find_elements_by_css_selector(to_box + ' option'):\n+                option.click()\n+            self.selenium.find_element_by_id(remove_link).click()\n+        self.assertSelectOptions(from_box,\n+                        [str(self.lisa.id), str(self.peter.id),\n+                         str(self.arthur.id), str(self.bob.id),\n+                         str(self.cliff.id), str(self.jason.id),\n+                         str(self.jenny.id), str(self.john.id)])\n+        self.assertSelectOptions(to_box, [])\n+\n+        # Choose some options ------------------------------------------------\n+        self.get_select_option(from_box, str(self.lisa.id)).click()\n+        self.get_select_option(from_box, str(self.jason.id)).click()\n+        self.get_select_option(from_box, str(self.bob.id)).click()\n+        self.get_select_option(from_box, str(self.john.id)).click()\n+        self.selenium.find_element_by_id(choose_link).click()\n+\n+        self.assertSelectOptions(from_box,\n+                        [str(self.peter.id), str(self.arthur.id),\n+                         str(self.cliff.id), str(self.jenny.id)])\n+        self.assertSelectOptions(to_box,\n+                        [str(self.lisa.id), str(self.bob.id),\n+                         str(self.jason.id), str(self.john.id)])\n+\n+        # Remove some options -------------------------------------------------\n+        self.get_select_option(to_box, str(self.lisa.id)).click()\n+        self.get_select_option(to_box, str(self.bob.id)).click()\n+        self.selenium.find_element_by_id(remove_link).click()\n+\n+        self.assertSelectOptions(from_box,\n+                        [str(self.peter.id), str(self.arthur.id),\n+                         str(self.cliff.id), str(self.jenny.id),\n+                         str(self.lisa.id), str(self.bob.id)])\n+        self.assertSelectOptions(to_box,\n+                        [str(self.jason.id), str(self.john.id)])\n+\n+        # Choose some more options --------------------------------------------\n+        self.get_select_option(from_box, str(self.arthur.id)).click()\n+        self.get_select_option(from_box, str(self.cliff.id)).click()\n+        self.selenium.find_element_by_id(choose_link).click()\n+\n+        self.assertSelectOptions(from_box,\n+                        [str(self.peter.id), str(self.jenny.id),\n+                         str(self.lisa.id), str(self.bob.id)])\n+        self.assertSelectOptions(to_box,\n+                        [str(self.jason.id), str(self.john.id),\n+                         str(self.arthur.id), str(self.cliff.id)])\n+\n+    def test_basic(self):\n+        self.school.students = [self.lisa, self.peter]\n+        self.school.alumni = [self.lisa, self.peter]\n+        self.school.save()\n+\n+        self.admin_login(username='super', password='secret', login_url='/')\n+        self.selenium.get(\n+            '%s%s' % (self.live_server_url, '/admin_widgets/school/%s/' % self.school.id))\n+\n+        self.execute_basic_operations('students', 'vertical')\n+        self.execute_basic_operations('alumni', 'horizontal')\n+\n+        # Save and check that everything is properly stored in the database ---\n+        self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n+        self.school = models.School.objects.get(id=self.school.id) # Reload from database\n+        self.assertEqual(list(self.school.students.all()),\n+                         [self.arthur, self.cliff, self.jason, self.john])\n+        self.assertEqual(list(self.school.alumni.all()),\n+                         [self.arthur, self.cliff, self.jason, self.john])\n+\n+class HorizontalVerticalFilterSeleniumChromeTests(HorizontalVerticalFilterSeleniumFirefoxTests):\n     webdriver_class = 'selenium.webdriver.chrome.webdriver.WebDriver'\n\\ No newline at end of file"
        },
        {
            "sha": "1cdeeb9f677d51df11f475be4671be867df8032f",
            "filename": "tests/regressiontests/admin_widgets/widgetadmin.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_widgets%2Fwidgetadmin.py",
            "raw_url": "https://github.com/django/django/raw/f2de5f4caba819fad10a78bfec47ae6f29cc2c29/tests%2Fregressiontests%2Fadmin_widgets%2Fwidgetadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Fwidgetadmin.py?ref=f2de5f4caba819fad10a78bfec47ae6f29cc2c29",
            "patch": "@@ -25,6 +25,11 @@ def formfield_for_foreignkey(self, db_field, request, **kwargs):\n class EventAdmin(admin.ModelAdmin):\n     raw_id_fields = ['band']\n \n+\n+class SchoolAdmin(admin.ModelAdmin):\n+    filter_vertical = ('students',)\n+    filter_horizontal = ('alumni',)\n+\n site = WidgetAdmin(name='widget-admin')\n \n site.register(models.User)\n@@ -41,3 +46,5 @@ class EventAdmin(admin.ModelAdmin):\n site.register(models.Bee)\n \n site.register(models.Advisor)\n+\n+site.register(models.School, SchoolAdmin)\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 189,
        "additions": 176,
        "deletions": 13
    }
}