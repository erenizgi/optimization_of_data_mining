{
    "author": "spookylukey",
    "message": "Fixed #14134 - ability to set cookie 'path' and 'secure' attributes of CSRF cookie\n\nThanks to cfattarsi for the report and initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16200 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d",
    "files": [
        {
            "sha": "88aa5a3e702830c0f031ee88941a8587f5b873f1",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d",
            "patch": "@@ -484,9 +484,11 @@\n # rejected by the CSRF middleware.\n CSRF_FAILURE_VIEW = 'django.views.csrf.csrf_failure'\n \n-# Name and domain for CSRF cookie.\n+# Settings for CSRF cookie.\n CSRF_COOKIE_NAME = 'csrftoken'\n CSRF_COOKIE_DOMAIN = None\n+CSRF_COOKIE_PATH = '/'\n+CSRF_COOKIE_SECURE = False\n \n ############\n # MESSAGES #"
        },
        {
            "sha": "e4cab6c08fdfcd06f546d5df042c6dd9d7c03cba",
            "filename": "django/middleware/csrf.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/django%2Fmiddleware%2Fcsrf.py",
            "raw_url": "https://github.com/django/django/raw/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/django%2Fmiddleware%2Fcsrf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcsrf.py?ref=8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d",
            "patch": "@@ -197,8 +197,12 @@ def process_response(self, request, response):\n \n         # Set the CSRF cookie even if it's already set, so we renew the expiry timer.\n         response.set_cookie(settings.CSRF_COOKIE_NAME,\n-                request.META[\"CSRF_COOKIE\"], max_age = 60 * 60 * 24 * 7 * 52,\n-                domain=settings.CSRF_COOKIE_DOMAIN)\n+                            request.META[\"CSRF_COOKIE\"],\n+                            max_age = 60 * 60 * 24 * 7 * 52,\n+                            domain=settings.CSRF_COOKIE_DOMAIN,\n+                            path=settings.CSRF_COOKIE_PATH,\n+                            secure=settings.CSRF_COOKIE_SECURE\n+                            )\n         # Content varies with the CSRF cookie, so set the Vary header.\n         patch_vary_headers(response, ('Cookie',))\n         response.csrf_processing_done = True"
        },
        {
            "sha": "b42dc26fbda512a7430274d0631d21d9ef71e4b9",
            "filename": "docs/ref/contrib/csrf.txt",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "raw_url": "https://github.com/django/django/raw/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcsrf.txt?ref=8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d",
            "patch": "@@ -423,6 +423,31 @@ Default: ``'csrftoken'``\n The name of the cookie to use for the CSRF authentication token. This can be\n whatever you want.\n \n+CSRF_COOKIE_PATH\n+----------------\n+\n+.. versionadded:: 1.4\n+\n+Default: ``'/'``\n+\n+The path set on the CSRF cookie. This should either match the URL path of your\n+Django installation or be a parent of that path.\n+\n+This is useful if you have multiple Django instances running under the same\n+hostname. They can use different cookie paths, and each instance will only see\n+its own CSRF cookie.\n+\n+CSRF_COOKIE_SECURE\n+------------------\n+\n+.. versionadded:: 1.4\n+\n+Default: ``False``\n+\n+Whether to use a secure cookie for the CSRF cookie. If this is set to ``True``,\n+the cookie will be marked as \"secure,\" which means browsers may ensure that the\n+cookie is only sent under an HTTPS connection.\n+\n CSRF_FAILURE_VIEW\n -----------------\n "
        },
        {
            "sha": "f5f1226f2192aeb4a547d3195fc3e1c0b7e590ec",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d",
            "patch": "@@ -340,6 +340,35 @@ Default: ``'csrftoken'``\n The name of the cookie to use for the CSRF authentication token. This can be whatever you\n want.  See :doc:`/ref/contrib/csrf`.\n \n+.. setting:: CSRF_COOKIE_PATH\n+\n+CSRF_COOKIE_PATH\n+----------------\n+\n+.. versionadded:: 1.4\n+\n+Default: ``'/'``\n+\n+The path set on the CSRF cookie. This should either match the URL path of your\n+Django installation or be a parent of that path.\n+\n+This is useful if you have multiple Django instances running under the same\n+hostname. They can use different cookie paths, and each instance will only see\n+its own CSRF cookie.\n+\n+.. setting:: CSRF_COOKIE_SECURE\n+\n+CSRF_COOKIE_SECURE\n+------------------\n+\n+.. versionadded:: 1.4\n+\n+Default: ``False``\n+\n+Whether to use a secure cookie for the CSRF cookie. If this is set to ``True``,\n+the cookie will be marked as \"secure,\" which means browsers may ensure that the\n+cookie is only sent under an HTTPS connection.\n+\n .. setting:: CSRF_FAILURE_VIEW\n \n CSRF_FAILURE_VIEW"
        },
        {
            "sha": "8dc3fbbc1b7552fbd89586aef1a5628dbb7be38a",
            "filename": "tests/regressiontests/csrf_tests/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py?ref=8cbcf1d3a60a0ba1a6f3ddde9317ac07b67c6c5d",
            "patch": "@@ -82,13 +82,21 @@ def test_process_response_get_token_used(self):\n         patched.\n         \"\"\"\n         req = self._get_GET_no_csrf_cookie_request()\n-        # token_view calls get_token() indirectly\n-        CsrfViewMiddleware().process_view(req, token_view, (), {})\n-        resp = token_view(req)\n-        resp2 = CsrfViewMiddleware().process_response(req, resp)\n \n-        csrf_cookie = resp2.cookies.get(settings.CSRF_COOKIE_NAME, False)\n+        # Put tests for CSRF_COOKIE_* settings here\n+        with self.settings(CSRF_COOKIE_NAME='myname',\n+                           CSRF_COOKIE_DOMAIN='.example.com',\n+                           CSRF_COOKIE_PATH='/test/',\n+                           CSRF_COOKIE_SECURE=True):\n+            # token_view calls get_token() indirectly\n+            CsrfViewMiddleware().process_view(req, token_view, (), {})\n+            resp = token_view(req)\n+            resp2 = CsrfViewMiddleware().process_response(req, resp)\n+        csrf_cookie = resp2.cookies.get('myname', False)\n         self.assertNotEqual(csrf_cookie, False)\n+        self.assertEqual(csrf_cookie['domain'], '.example.com')\n+        self.assertEqual(csrf_cookie['secure'], True)\n+        self.assertEqual(csrf_cookie['path'], '/test/')\n         self.assertTrue('Cookie' in resp2.get('Vary',''))\n \n     def test_process_response_get_token_not_used(self):"
        }
    ],
    "stats": {
        "total": 84,
        "additions": 76,
        "deletions": 8
    }
}