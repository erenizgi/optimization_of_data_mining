{
    "author": "jezdez",
    "message": "Fixed #15820 -- Fixed the use of the InlineAdmin's get_formset method by actually passing in the obj. Thanks, Julien Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16497 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f9fe112f2d65ea187ad47b280197664b551f339e",
    "files": [
        {
            "sha": "772734aae47080edc0288c9bc99b24e521a6bbb7",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/f9fe112f2d65ea187ad47b280197664b551f339e/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/f9fe112f2d65ea187ad47b280197664b551f339e/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=f9fe112f2d65ea187ad47b280197664b551f339e",
            "patch": "@@ -1360,7 +1360,7 @@ def get_formset(self, request, obj=None, **kwargs):\n     def get_fieldsets(self, request, obj=None):\n         if self.declared_fieldsets:\n             return self.declared_fieldsets\n-        form = self.get_formset(request).form\n+        form = self.get_formset(request, obj).form\n         fields = form.base_fields.keys() + list(self.get_readonly_fields(request, obj))\n         return [(None, {'fields': fields})]\n "
        },
        {
            "sha": "1bce158dd8d0b8e1d5e6d9a1154f4d19571a72bc",
            "filename": "tests/regressiontests/modeladmin/tests.py",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/f9fe112f2d65ea187ad47b280197664b551f339e/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f9fe112f2d65ea187ad47b280197664b551f339e/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py?ref=f9fe112f2d65ea187ad47b280197664b551f339e",
            "patch": "@@ -237,6 +237,38 @@ class ConcertAdmin(ModelAdmin):\n             '<option value=\"%d\">The Doors</option>\\n'\n             '</select>' % self.band.id)\n \n+    def test_regression_for_ticket_15820(self):\n+        \"\"\"\n+        Ensure that `obj` is passed from `InlineModelAdmin.get_fieldsets()` to\n+        `InlineModelAdmin.get_formset()`.\n+        \"\"\"\n+        class CustomConcertForm(forms.ModelForm):\n+\n+            class Meta:\n+                model = Concert\n+                fields = ['day']\n+\n+        class ConcertInline(TabularInline):\n+            model = Concert\n+            fk_name = 'main_band'\n+\n+            def get_formset(self, request, obj=None, **kwargs):\n+                if obj:\n+                    kwargs['form'] = CustomConcertForm\n+                return super(ConcertInline, self).get_formset(request, obj, **kwargs)\n+\n+        class BandAdmin(ModelAdmin):\n+            inlines = [\n+                ConcertInline\n+            ]\n+\n+        concert = Concert.objects.create(main_band=self.band, opening_band=self.band, day=1)\n+        ma = BandAdmin(Band, self.site)\n+        fieldsets = list(ma.inline_instances[0].get_fieldsets(request))\n+        self.assertEqual(fieldsets[0][1]['fields'], ['main_band', 'opening_band', 'day', 'transport'])\n+        fieldsets = list(ma.inline_instances[0].get_fieldsets(request, ma.inline_instances[0].model))\n+        self.assertEqual(fieldsets[0][1]['fields'], ['day'])\n+\n     # radio_fields behavior ###########################################\n \n     def test_default_foreign_key_widget(self):"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 33,
        "deletions": 1
    }
}