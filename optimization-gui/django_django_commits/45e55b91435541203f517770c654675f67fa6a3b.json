{
    "author": "spookylukey",
    "message": "Fixed #14614 - filtering of sensitive information in 500 error reports.\n\nThis adds a flexible mechanism for filtering what request/traceback\ninformation is shown in 500 error emails and logs. It also applies\nscreening to some views known to be sensitive e.g. views that handle\npasswords.\n\nThanks to oaylanc for the report and many thanks to Julien Phalip for the\npatch and the rest of the work on this.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16339 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "45e55b91435541203f517770c654675f67fa6a3b",
    "files": [
        {
            "sha": "1300e86caaf5c722936b432fdeaba5fec57dee5a",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -537,6 +537,10 @@\n     }\n }\n \n+# Default exception reporter filter class used in case none has been\n+# specifically assigned to the HttpRequest instance.\n+DEFAULT_EXCEPTION_REPORTER_FILTER = 'django.views.debug.SafeExceptionReporterFilter'\n+\n ###########\n # TESTING #\n ###########"
        },
        {
            "sha": "237b15364e4761e666f8ca60d6767e6b65de1c54",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -12,6 +12,7 @@\n from django.utils.decorators import method_decorator\n from django.utils.translation import ugettext, ugettext_lazy as _\n from django.views.decorators.csrf import csrf_protect\n+from django.views.decorators.debug import sensitive_post_parameters\n \n csrf_protect_m = method_decorator(csrf_protect)\n \n@@ -78,6 +79,7 @@ def get_urls(self):\n             (r'^(\\d+)/password/$', self.admin_site.admin_view(self.user_change_password))\n         ) + super(UserAdmin, self).get_urls()\n \n+    @sensitive_post_parameters()\n     @csrf_protect_m\n     @transaction.commit_on_success\n     def add_view(self, request, form_url='', extra_context=None):\n@@ -102,6 +104,7 @@ def add_view(self, request, form_url='', extra_context=None):\n         extra_context.update(defaults)\n         return super(UserAdmin, self).add_view(request, form_url, extra_context)\n \n+    @sensitive_post_parameters()\n     def user_change_password(self, request, id):\n         if not self.has_change_permission(request):\n             raise PermissionDenied"
        },
        {
            "sha": "4995f89caf7b1a58c7995ff098abe97358f13591",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -6,6 +6,7 @@\n from django.template.response import TemplateResponse\n from django.utils.http import base36_to_int\n from django.utils.translation import ugettext as _\n+from django.views.decorators.debug import sensitive_post_parameters\n from django.views.decorators.cache import never_cache\n from django.views.decorators.csrf import csrf_protect\n \n@@ -18,6 +19,7 @@\n from django.contrib.sites.models import get_current_site\n \n \n+@sensitive_post_parameters()\n @csrf_protect\n @never_cache\n def login(request, template_name='registration/login.html',\n@@ -175,6 +177,7 @@ def password_reset_done(request,\n                             current_app=current_app)\n \n # Doesn't need csrf_protect since no-one can guess the URL\n+@sensitive_post_parameters()\n @never_cache\n def password_reset_confirm(request, uidb36=None, token=None,\n                            template_name='registration/password_reset_confirm.html',\n@@ -227,6 +230,7 @@ def password_reset_complete(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+@sensitive_post_parameters()\n @csrf_protect\n @login_required\n def password_change(request,"
        },
        {
            "sha": "7cae42e651e4f8c89caceea4554f6c793e799643",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -206,7 +206,7 @@ def handle_uncaught_exception(self, request, resolver, exc_info):\n             exc_info=exc_info,\n             extra={\n                 'status_code': 500,\n-                'request':request\n+                'request': request\n             }\n         )\n "
        },
        {
            "sha": "969a9d960935acf7d50cef96f935a6e0d899cdbf",
            "filename": "django/utils/log.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Futils%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Futils%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Flog.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -1,6 +1,10 @@\n import logging\n import sys\n+import traceback\n+\n+from django.conf import settings\n from django.core import mail\n+from django.views.debug import ExceptionReporter, get_exception_reporter_filter\n \n # Make sure a NullHandler is available\n # This was added in Python 2.7/3.2\n@@ -35,29 +39,25 @@ def __init__(self, include_html=False):\n     \"\"\"An exception log handler that emails log entries to site admins.\n \n     If the request is passed as the first argument to the log record,\n-    request data will be provided in the\n+    request data will be provided in the email report.\n     \"\"\"\n     def emit(self, record):\n-        import traceback\n-        from django.conf import settings\n-        from django.views.debug import ExceptionReporter\n-\n         try:\n             request = record.request\n             subject = '%s (%s IP): %s' % (\n                 record.levelname,\n                 (request.META.get('REMOTE_ADDR') in settings.INTERNAL_IPS and 'internal' or 'EXTERNAL'),\n                 record.msg\n             )\n-            request_repr = repr(request)\n+            filter = get_exception_reporter_filter(request)\n+            request_repr = filter.get_request_repr(request)\n         except:\n             subject = '%s: %s' % (\n                 record.levelname,\n                 record.msg\n             )\n-\n             request = None\n-            request_repr = \"Request repr() unavailable\"\n+            request_repr = \"Request repr() unavailable.\"\n \n         if record.exc_info:\n             exc_info = record.exc_info"
        },
        {
            "sha": "c607f433c5bd16eacb192407f84dfd1f20950ce5",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 157,
            "deletions": 6,
            "changes": 163,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -3,9 +3,11 @@\n import re\n import sys\n import types\n+from pprint import pformat\n \n from django.conf import settings\n-from django.http import HttpResponse, HttpResponseServerError, HttpResponseNotFound\n+from django.http import (HttpResponse, HttpResponseServerError,\n+    HttpResponseNotFound, HttpRequest)\n from django.template import (Template, Context, TemplateDoesNotExist,\n     TemplateSyntaxError)\n from django.template.defaultfilters import force_escape, pprint\n@@ -15,6 +17,8 @@\n \n HIDDEN_SETTINGS = re.compile('SECRET|PASSWORD|PROFANITIES_LIST|SIGNATURE')\n \n+CLEANSED_SUBSTITUTE = u'********************'\n+\n def linebreak_iter(template_source):\n     yield 0\n     p = template_source.find('\\n')\n@@ -31,7 +35,7 @@ def cleanse_setting(key, value):\n     \"\"\"\n     try:\n         if HIDDEN_SETTINGS.search(key):\n-            cleansed = '********************'\n+            cleansed = CLEANSED_SUBSTITUTE\n         else:\n             if isinstance(value, dict):\n                 cleansed = dict((k, cleanse_setting(k, v)) for k,v in value.items())\n@@ -59,12 +63,158 @@ def technical_500_response(request, exc_type, exc_value, tb):\n     html = reporter.get_traceback_html()\n     return HttpResponseServerError(html, mimetype='text/html')\n \n+# Cache for the default exception reporter filter instance.\n+default_exception_reporter_filter = None\n+\n+def get_exception_reporter_filter(request):\n+    global default_exception_reporter_filter\n+    if default_exception_reporter_filter is None:\n+        # Load the default filter for the first time and cache it.\n+        modpath = settings.DEFAULT_EXCEPTION_REPORTER_FILTER\n+        modname, classname = modpath.rsplit('.', 1)\n+        try:\n+            mod = import_module(modname)\n+        except ImportError, e:\n+            raise ImproperlyConfigured(\n+            'Error importing default exception reporter filter %s: \"%s\"' % (modpath, e))\n+        try:\n+            default_exception_reporter_filter = getattr(mod, classname)()\n+        except AttributeError:\n+            raise exceptions.ImproperlyConfigured('Default exception reporter filter module \"%s\" does not define a \"%s\" class' % (modname, classname))\n+    if request:\n+        return getattr(request, 'exception_reporter_filter', default_exception_reporter_filter)\n+    else:\n+        return default_exception_reporter_filter\n+\n+class ExceptionReporterFilter(object):\n+    \"\"\"\n+    Base for all exception reporter filter classes. All overridable hooks\n+    contain lenient default behaviours.\n+    \"\"\"\n+\n+    def get_request_repr(self, request):\n+        if request is None:\n+            return repr(None)\n+        else:\n+            # Since this is called as part of error handling, we need to be very\n+            # robust against potentially malformed input.\n+            try:\n+                get = pformat(request.GET)\n+            except:\n+                get = '<could not parse>'\n+            if request._post_parse_error:\n+                post = '<could not parse>'\n+            else:\n+                try:\n+                    post = pformat(self.get_post_parameters(request))\n+                except:\n+                    post = '<could not parse>'\n+            try:\n+                cookies = pformat(request.COOKIES)\n+            except:\n+                cookies = '<could not parse>'\n+            try:\n+                meta = pformat(request.META)\n+            except:\n+                meta = '<could not parse>'\n+            return smart_str(u'<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n+                             (request.__class__.__name__,\n+                              request.path,\n+                              unicode(get),\n+                              unicode(post),\n+                              unicode(cookies),\n+                              unicode(meta)))\n+\n+    def get_post_parameters(self, request):\n+        if request is None:\n+            return {}\n+        else:\n+            return request.POST\n+\n+    def get_traceback_frame_variables(self, request, tb_frame):\n+        return tb_frame.f_locals.items()\n+\n+class SafeExceptionReporterFilter(ExceptionReporterFilter):\n+    \"\"\"\n+    Use annotations made by the sensitive_post_parameters and\n+    sensitive_variables decorators to filter out sensitive information.\n+    \"\"\"\n+\n+    def is_active(self, request):\n+        \"\"\"\n+        This filter is to add safety in production environments (i.e. DEBUG\n+        is False). If DEBUG is True then your site is not safe anyway.\n+        This hook is provided as a convenience to easily activate or\n+        deactivate the filter on a per request basis.\n+        \"\"\"\n+        return settings.DEBUG is False\n+\n+    def get_post_parameters(self, request):\n+        \"\"\"\n+        Replaces the values of POST parameters marked as sensitive with\n+        stars (*********).\n+        \"\"\"\n+        if request is None:\n+            return {}\n+        else:\n+            sensitive_post_parameters = getattr(request, 'sensitive_post_parameters', [])\n+            if self.is_active(request) and sensitive_post_parameters:\n+                cleansed = request.POST.copy()\n+                if sensitive_post_parameters == '__ALL__':\n+                    # Cleanse all parameters.\n+                    for k, v in cleansed.items():\n+                        cleansed[k] = CLEANSED_SUBSTITUTE\n+                    return cleansed\n+                else:\n+                    # Cleanse only the specified parameters.\n+                    for param in sensitive_post_parameters:\n+                        if cleansed.has_key(param):\n+                            cleansed[param] = CLEANSED_SUBSTITUTE\n+                    return cleansed\n+            else:\n+                return request.POST\n+\n+    def get_traceback_frame_variables(self, request, tb_frame):\n+        \"\"\"\n+        Replaces the values of variables marked as sensitive with\n+        stars (*********).\n+        \"\"\"\n+        func_name = tb_frame.f_code.co_name\n+        func = tb_frame.f_globals.get(func_name)\n+        sensitive_variables = getattr(func, 'sensitive_variables', [])\n+        cleansed = []\n+        if self.is_active(request) and sensitive_variables:\n+            if sensitive_variables == '__ALL__':\n+                # Cleanse all variables\n+                for name, value in tb_frame.f_locals.items():\n+                    cleansed.append((name, CLEANSED_SUBSTITUTE))\n+                return cleansed\n+            else:\n+                # Cleanse specified variables\n+                for name, value in tb_frame.f_locals.items():\n+                    if name in sensitive_variables:\n+                        value = CLEANSED_SUBSTITUTE\n+                    elif isinstance(value, HttpRequest):\n+                        # Cleanse the request's POST parameters.\n+                        value = self.get_request_repr(value)\n+                    cleansed.append((name, value))\n+                return cleansed\n+        else:\n+            # Potentially cleanse only the request if it's one of the frame variables.\n+            for name, value in tb_frame.f_locals.items():\n+                if isinstance(value, HttpRequest):\n+                    # Cleanse the request's POST parameters.\n+                    value = self.get_request_repr(value)\n+                cleansed.append((name, value))\n+            return cleansed\n+\n class ExceptionReporter(object):\n     \"\"\"\n     A class to organize and coordinate reporting on exceptions.\n     \"\"\"\n     def __init__(self, request, exc_type, exc_value, tb, is_email=False):\n         self.request = request\n+        self.filter = get_exception_reporter_filter(self.request)\n         self.exc_type = exc_type\n         self.exc_value = exc_value\n         self.tb = tb\n@@ -124,6 +274,7 @@ def get_traceback_html(self):\n             'unicode_hint': unicode_hint,\n             'frames': frames,\n             'request': self.request,\n+            'filtered_POST': self.filter.get_post_parameters(self.request),\n             'settings': get_safe_settings(),\n             'sys_executable': sys.executable,\n             'sys_version_info': '%d.%d.%d' % sys.version_info[0:3],\n@@ -222,7 +373,7 @@ def get_traceback_frames(self):\n         frames = []\n         tb = self.tb\n         while tb is not None:\n-            # support for __traceback_hide__ which is used by a few libraries\n+            # Support for __traceback_hide__ which is used by a few libraries\n             # to hide internal frames.\n             if tb.tb_frame.f_locals.get('__traceback_hide__'):\n                 tb = tb.tb_next\n@@ -239,7 +390,7 @@ def get_traceback_frames(self):\n                     'filename': filename,\n                     'function': function,\n                     'lineno': lineno + 1,\n-                    'vars': tb.tb_frame.f_locals.items(),\n+                    'vars': self.filter.get_traceback_frame_variables(self.request, tb.tb_frame),\n                     'id': id(tb),\n                     'pre_context': pre_context,\n                     'context_line': context_line,\n@@ -643,7 +794,7 @@ def empty_urlconf(request):\n   {% endif %}\n \n   <h3 id=\"post-info\">POST</h3>\n-  {% if request.POST %}\n+  {% if filtered_POST %}\n     <table class=\"req\">\n       <thead>\n         <tr>\n@@ -652,7 +803,7 @@ def empty_urlconf(request):\n         </tr>\n       </thead>\n       <tbody>\n-        {% for var in request.POST.items %}\n+        {% for var in filtered_POST.items %}\n           <tr>\n             <td>{{ var.0 }}</td>\n             <td class=\"code\"><pre>{{ var.1|pprint }}</pre></td>"
        },
        {
            "sha": "d04967ef09e0180a57f1b77676aeaa569187b17c",
            "filename": "django/views/decorators/debug.py",
            "status": "added",
            "additions": 71,
            "deletions": 0,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/django%2Fviews%2Fdecorators%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/django%2Fviews%2Fdecorators%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fdebug.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -0,0 +1,71 @@\n+import functools\n+\n+\n+def sensitive_variables(*variables):\n+    \"\"\"\n+    Indicates which variables used in the decorated function are sensitive, so\n+    that those variables can later be treated in a special way, for example\n+    by hiding them when logging unhandled exceptions.\n+\n+    Two forms are accepted:\n+\n+    * with specified variable names:\n+\n+        @sensitive_variables('user', 'password', 'credit_card')\n+        def my_function(user):\n+            password = user.pass_word\n+            credit_card = user.credit_card_number\n+            ...\n+\n+    * without any specified variable names, in which case it is assumed that\n+      all variables are considered sensitive:\n+\n+        @sensitive_variables()\n+        def my_function()\n+            ...\n+    \"\"\"\n+    def decorator(func):\n+        @functools.wraps(func)\n+        def wrapper(*args, **kwargs):\n+            if variables:\n+                wrapper.sensitive_variables = variables\n+            else:\n+                wrapper.sensitive_variables = '__ALL__'\n+            return func(*args, **kwargs)\n+        return wrapper\n+    return decorator\n+\n+\n+def sensitive_post_parameters(*parameters):\n+    \"\"\"\n+    Indicates which POST parameters used in the decorated view are sensitive,\n+    so that those parameters can later be treated in a special way, for example\n+    by hiding them when logging unhandled exceptions.\n+\n+    Two forms are accepted:\n+\n+    * with specified parameters:\n+\n+        @sensitive_post_parameters('password', 'credit_card')\n+        def my_view(request):\n+            pw = request.POST['password']\n+            cc = request.POST['credit_card']\n+            ...\n+\n+    * without any specified parameters, in which case it is assumed that\n+      all parameters are considered sensitive:\n+\n+        @sensitive_post_parameters()\n+        def my_view(request)\n+            ...\n+    \"\"\"\n+    def decorator(view):\n+        @functools.wraps(view)\n+        def wrapper(request, *args, **kwargs):\n+            if parameters:\n+                request.sensitive_post_parameters = parameters\n+            else:\n+                request.sensitive_post_parameters = '__ALL__'\n+            return view(request, *args, **kwargs)\n+        return wrapper\n+    return decorator"
        },
        {
            "sha": "957d9773643342f4cce2e52655dae9601271a00e",
            "filename": "docs/howto/error-reporting.txt",
            "status": "modified",
            "additions": 179,
            "deletions": 12,
            "changes": 191,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/docs%2Fhowto%2Ferror-reporting.txt",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/docs%2Fhowto%2Ferror-reporting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Ferror-reporting.txt?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -1,5 +1,5 @@\n-Error reporting via email\n-=========================\n+Error reporting\n+===============\n \n When you're running a public site you should always turn off the\n :setting:`DEBUG` setting. That will make your server run much faster, and will\n@@ -9,11 +9,14 @@ revealed by the error pages.\n However, running with :setting:`DEBUG` set to ``False`` means you'll never see\n errors generated by your site -- everyone will just see your public error pages.\n You need to keep track of errors that occur in deployed sites, so Django can be\n-configured to email you details of those errors.\n+configured to create reports with details about those errors.\n \n-Server errors\n+Email reports\n -------------\n \n+Server errors\n+~~~~~~~~~~~~~\n+\n When :setting:`DEBUG` is ``False``, Django will email the users listed in the\n :setting:`ADMINS` setting whenever your code raises an unhandled exception and\n results in an internal server error (HTTP status code 500). This gives the\n@@ -48,7 +51,7 @@ setting.\n    </topics/logging>`.\n \n 404 errors\n-----------\n+~~~~~~~~~~\n \n Django can also be configured to email errors about broken links (404 \"page\n not found\" errors). Django sends emails about 404 errors when:\n@@ -94,13 +97,6 @@ periods to escape them.)\n The best way to disable this behavior is to set\n :setting:`SEND_BROKEN_LINK_EMAILS` to ``False``.\n \n-.. seealso::\n-\n-    You can also set up custom error reporting by writing a custom piece of\n-    :ref:`exception middleware <exception-middleware>`. If you do write custom\n-    error handling, it's a good idea to emulate Django's built-in error handling\n-    and only report/log errors if :setting:`DEBUG` is ``False``.\n-\n .. seealso::\n \n    .. versionadded:: 1.3\n@@ -116,3 +112,174 @@ The best way to disable this behavior is to set\n    Previously, two settings were used to control which URLs not to report:\n    :setting:`IGNORABLE_404_STARTS` and :setting:`IGNORABLE_404_ENDS`. They\n    were replaced by :setting:`IGNORABLE_404_URLS`.\n+\n+.. _filtering-error-reports:\n+\n+Filtering error reports\n+-----------------------\n+\n+.. versionadded:: 1.4\n+\n+Filtering sensitive information\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Error reports are really helpful for debugging errors, so it is generally\n+useful to record as much relevant information about those errors as possible.\n+For example, by default Django records the `full traceback`_ for the\n+exception raised, each `traceback frame`_'s local variables, and the\n+:class:`HttpRequest`'s :ref:`attributes<httprequest-attributes>`.\n+\n+However, sometimes certain types of information may be too sensitive and thus\n+may not be appropriate to be kept track of, for example a user's password or\n+credit card number. So Django offers a set of function decorators to help you\n+control which information should be filtered out of error reports in a\n+production environment (that is, where :setting:`DEBUG` is set to ``False``):\n+:func:`sensitive_variables` and :func:`sensitive_post_parameters`.\n+\n+.. _`full traceback`: http://en.wikipedia.org/wiki/Stack_trace\n+.. _`traceback frame`: http://en.wikipedia.org/wiki/Stack_frame\n+\n+.. function:: sensitive_variables(*variables)\n+\n+    If a function (either a view or any regular callback) in your code uses\n+    local variables susceptible to contain sensitive information, you may\n+    prevent the values of those variables from being included in error reports\n+    using the ``sensitive_variables`` decorator:\n+\n+        .. code-block:: python\n+\n+            from django.views.decorators.debug import sensitive_variables\n+\n+            @sensitive_variables('user', 'pw', 'cc')\n+            def process_info(user):\n+                pw = user.pass_word\n+                cc = user.credit_card_number\n+                name = user.name\n+                ...\n+\n+    In the above example, the values for the ``user``, ``pw`` and ``cc``\n+    variables will be hidden and replaced with stars (`**********`) in the\n+    error reports, whereas the value of the ``name`` variable will be\n+    disclosed.\n+\n+    To systematically hide all local variables of a function from error logs,\n+    do not provide any argument to the ``sensitive_variables`` decorator:\n+\n+        .. code-block:: python\n+\n+            @sensitive_variables()\n+            def my_function():\n+                ...\n+\n+.. function:: sensitive_post_parameters(*parameters)\n+\n+    If one of your views receives an :class:`HttpRequest` object with\n+    :attr:`POST parameters<HttpRequest.POST>` susceptible to contain sensitive\n+    information, you may prevent the values of those parameters from being\n+    included in the error reports using the ``sensitive_post_parameters``\n+    decorator:\n+\n+        .. code-block:: python\n+\n+            from django.views.decorators.debug import sensitive_post_parameters\n+\n+            @sensitive_post_parameters('pass_word', 'credit_card_number')\n+            def record_user_profile(request):\n+                UserProfile.create(user=request.user,\n+                                   password=request.POST['pass_word'],\n+                                   credit_card=request.POST['credit_card_number'],\n+                                   name=request.POST['name'])\n+                ...\n+\n+    In the above example, the values for the ``pass_word`` and\n+    ``credit_card_number`` POST parameters will be hidden and replaced with\n+    stars (`**********`) in the request's representation inside the error\n+    reports, whereas the value of the ``name`` parameter will be disclosed.\n+\n+    To systematically hide all POST parameters of a request in error reports,\n+    do not provide any argument to the ``sensitive_post_parameters`` decorator:\n+\n+        .. code-block:: python\n+\n+            @sensitive_post_parameters()\n+            def my_view(request):\n+                ...\n+\n+.. note::\n+\n+    .. versionchanged:: 1.4\n+\n+    Since version 1.4, all POST parameters are systematically filtered out of\n+    error reports for certain :mod:`contrib.views.auth` views (``login``,\n+    ``password_reset_confirm``, ``password_change``, and ``add_view`` and\n+    ``user_change_password`` in the ``auth`` admin) to prevent the leaking of\n+    sensitive information such as user passwords.\n+\n+.. _custom-error-reports:\n+\n+Custom error reports\n+~~~~~~~~~~~~~~~~~~~~\n+\n+All :func:`sensitive_variables` and :func:`sensitive_post_parameters` do is,\n+respectively, annotate the decorated function with the names of sensitive\n+variables and annotate the ``HttpRequest`` object with the names of sensitive\n+POST parameters, so that this sensitive information can later be filtered out\n+of reports when an error occurs. The actual filtering is done by Django's\n+default error reporter filter:\n+:class:`django.views.debug.SafeExceptionReporterFilter`. This filter uses the\n+decorators' annotations to replace the corresponding values with stars\n+(`**********`) when the error reports are produced. If you wish to override or\n+customize this default behavior for your entire site, you need to define your\n+own filter class and tell Django to use it via the\n+:setting:`DEFAULT_EXCEPTION_REPORTER_FILTER` setting:\n+\n+    .. code-block:: python\n+\n+        DEFAULT_EXCEPTION_REPORTER_FILTER = 'path.to.your.CustomExceptionReporterFilter'\n+\n+You may also control in a more granular way which filter to use within any\n+given view by setting the ``HttpRequest``'s ``exception_reporter_filter``\n+attribute:\n+\n+    .. code-block:: python\n+\n+        def my_view(request):\n+            if request.user.is_authenticated():\n+                request.exception_reporter_filter = CustomExceptionReporterFilter()\n+            ...\n+\n+Your custom filter class needs to inherit from\n+:class:`django.views.debug.SafeExceptionReporterFilter` and may override the\n+following methods:\n+\n+.. class:: django.views.debug.SafeExceptionReporterFilter\n+\n+.. method:: SafeExceptionReporterFilter.is_active(self, request)\n+\n+    Returns ``True`` to activate the filtering operated in the other methods.\n+    By default the filter is active if :setting:`DEBUG` is ``False``.\n+\n+.. method:: SafeExceptionReporterFilter.get_request_repr(self, request)\n+\n+    Returns the representation string of the request object, that is, the\n+    value that would be returned by ``repr(request)``, except it uses the\n+    filtered dictionary of POST parameters as determined by\n+    :meth:`SafeExceptionReporterFilter.get_post_parameters`.\n+\n+.. method:: SafeExceptionReporterFilter.get_post_parameters(self, request)\n+\n+    Returns the filtered dictionary of POST parameters. By default it replaces\n+    the values of sensitive parameters with stars (`**********`).\n+\n+.. method:: SafeExceptionReporterFilter.get_traceback_frame_variables(self, request, tb_frame)\n+\n+    Returns the filtered dictionary of local variables for the given traceback\n+    frame. By default it replaces the values of sensitive variables with stars\n+    (`**********`).\n+\n+.. seealso::\n+\n+    You can also set up custom error reporting by writing a custom piece of\n+    :ref:`exception middleware <exception-middleware>`. If you do write custom\n+    error handling, it's a good idea to emulate Django's built-in error handling\n+    and only report/log errors if :setting:`DEBUG` is ``False``."
        },
        {
            "sha": "ff04e25b1dd9a1213fccbc4194807557b1d3d284",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -23,6 +23,8 @@ HttpRequest objects\n \n .. class:: HttpRequest\n \n+.. _httprequest-attributes:\n+\n Attributes\n ----------\n "
        },
        {
            "sha": "e95c165a9a7ad24d00cf14361483b8675f3cbacb",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -772,6 +772,17 @@ Default content type to use for all ``HttpResponse`` objects, if a MIME type\n isn't manually specified. Used with :setting:`DEFAULT_CHARSET` to construct\n the ``Content-Type`` header.\n \n+.. setting:: DEFAULT_EXCEPTION_REPORTER_FILTER\n+\n+DEFAULT_EXCEPTION_REPORTER_FILTER\n+---------------------------------\n+\n+Default: :class:`django.views.debug.SafeExceptionReporterFilter`\n+\n+Default exception reporter filter class to be used if none has been assigned to\n+the :class:`HttpRequest` instance yet.\n+See :ref:`Filtering error reports<filtering-error-reports>`.\n+\n .. setting:: DEFAULT_FILE_STORAGE\n \n DEFAULT_FILE_STORAGE"
        },
        {
            "sha": "ddbcda9e60a95376794dec11e6efc95879b746d6",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -116,6 +116,26 @@ help with AJAX heavy sites, protection for PUT and DELETE, and settings\n the security and usefulness of the CSRF protection. See the :doc:`CSRF docs\n </ref/contrib/csrf>` for more information.\n \n+Error report filtering\n+~~~~~~~~~~~~~~~~~~~~~~\n+\n+Two new function decorators, :func:`sensitive_variables` and\n+:func:`sensitive_post_parameters`, were added to allow designating the\n+traceback frames' local variables and request's POST parameters susceptible\n+to contain sensitive information and that should be filtered out of error\n+reports.\n+\n+All POST parameters are now systematically filtered out of error reports for\n+certain :mod:`contrib.views.auth` views (``login``, ``password_reset_confirm``,\n+``password_change``, and ``add_view`` and ``user_change_password`` in the\n+``auth`` admin) to prevent the leaking of sensitive information such as user\n+passwords.\n+\n+You may override or customize the default filtering by writing a\n+:ref:`custom filter<custom-error-reports>`. Learn more on\n+:ref:`Filtering error reports<filtering-error-reports>`.\n+\n+\n .. _backwards-incompatible-changes-1.4:\n \n Backwards incompatible changes in 1.4"
        },
        {
            "sha": "e2c9f72ea62e02dcf0c97345e1facba8d60f620a",
            "filename": "docs/topics/logging.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/docs%2Ftopics%2Flogging.txt",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/docs%2Ftopics%2Flogging.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Flogging.txt?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -504,6 +504,8 @@ Python logging module.\n     sensitive, and you may not want to send it over email. Consider using\n     something such as `django-sentry`_ to get the best of both worlds -- the\n     rich information of full tracebacks plus the security of *not* sending the\n-    information over email.\n+    information over email. You may also explicitly designate certain\n+    sensitive information to be filtered out of error reports -- learn more on\n+    :ref:`Filtering error reports<filtering-error-reports>`.\n \n .. _django-sentry: http://pypi.python.org/pypi/django-sentry"
        },
        {
            "sha": "1dbaff490f1b1670b2cdda9c062696bc01f36688",
            "filename": "tests/regressiontests/views/tests/debug.py",
            "status": "modified",
            "additions": 190,
            "deletions": 0,
            "changes": 190,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -1,3 +1,4 @@\n+from __future__ import with_statement\n import inspect\n import os\n import sys\n@@ -8,8 +9,12 @@\n from django.core.urlresolvers import reverse\n from django.template import TemplateSyntaxError\n from django.views.debug import ExceptionReporter\n+from django.core.exceptions import ImproperlyConfigured\n+from django.core import mail\n \n from regressiontests.views import BrokenException, except_args\n+from regressiontests.views.views import (sensitive_view, non_sensitive_view,\n+    paranoid_view, custom_exception_reporter_filter_view)\n \n \n class DebugViewTests(TestCase):\n@@ -143,3 +148,188 @@ def test_message_only(self):\n         self.assertNotIn('<h2>Traceback ', html)\n         self.assertIn('<h2>Request information</h2>', html)\n         self.assertIn('<p>Request data not supplied</p>', html)\n+\n+\n+class ExceptionReporterFilterTests(TestCase):\n+    \"\"\"\n+    Ensure that sensitive information can be filtered out of error reports.\n+    Refs #14614.\n+    \"\"\"\n+    rf = RequestFactory()\n+    breakfast_data = {'sausage-key': 'sausage-value',\n+                      'baked-beans-key': 'baked-beans-value',\n+                      'hash-brown-key': 'hash-brown-value',\n+                      'bacon-key': 'bacon-value',}\n+\n+    def verify_unsafe_response(self, view):\n+        \"\"\"\n+        Asserts that potentially sensitive info are displayed in the response.\n+        \"\"\"\n+        request = self.rf.post('/some_url/', self.breakfast_data)\n+        response = view(request)\n+        # All variables are shown.\n+        self.assertContains(response, 'cooked_eggs', status_code=500)\n+        self.assertContains(response, 'scrambled', status_code=500)\n+        self.assertContains(response, 'sauce', status_code=500)\n+        self.assertContains(response, 'worcestershire', status_code=500)\n+        for k, v in self.breakfast_data.items():\n+            # All POST parameters are shown.\n+            self.assertContains(response, k, status_code=500)\n+            self.assertContains(response, v, status_code=500)\n+\n+    def verify_safe_response(self, view):\n+        \"\"\"\n+        Asserts that certain sensitive info are not displayed in the response.\n+        \"\"\"\n+        request = self.rf.post('/some_url/', self.breakfast_data)\n+        response = view(request)\n+        # Non-sensitive variable's name and value are shown.\n+        self.assertContains(response, 'cooked_eggs', status_code=500)\n+        self.assertContains(response, 'scrambled', status_code=500)\n+        # Sensitive variable's name is shown but not its value.\n+        self.assertContains(response, 'sauce', status_code=500)\n+        self.assertNotContains(response, 'worcestershire', status_code=500)\n+        for k, v in self.breakfast_data.items():\n+            # All POST parameters' names are shown.\n+            self.assertContains(response, k, status_code=500)\n+        # Non-sensitive POST parameters' values are shown.\n+        self.assertContains(response, 'baked-beans-value', status_code=500)\n+        self.assertContains(response, 'hash-brown-value', status_code=500)\n+        # Sensitive POST parameters' values are not shown.\n+        self.assertNotContains(response, 'sausage-value', status_code=500)\n+        self.assertNotContains(response, 'bacon-value', status_code=500)\n+\n+    def verify_paranoid_response(self, view):\n+        \"\"\"\n+        Asserts that no variables or POST parameters are displayed in the response.\n+        \"\"\"\n+        request = self.rf.post('/some_url/', self.breakfast_data)\n+        response = view(request)\n+        # Show variable names but not their values.\n+        self.assertContains(response, 'cooked_eggs', status_code=500)\n+        self.assertNotContains(response, 'scrambled', status_code=500)\n+        self.assertContains(response, 'sauce', status_code=500)\n+        self.assertNotContains(response, 'worcestershire', status_code=500)\n+        for k, v in self.breakfast_data.items():\n+            # All POST parameters' names are shown.\n+            self.assertContains(response, k, status_code=500)\n+            # No POST parameters' values are shown.\n+            self.assertNotContains(response, v, status_code=500)\n+\n+    def verify_unsafe_email(self, view):\n+        \"\"\"\n+        Asserts that potentially sensitive info are displayed in the email report.\n+        \"\"\"\n+        with self.settings(ADMINS=(('Admin', 'admin@fattie-breakie.com'),)):\n+            mail.outbox = [] # Empty outbox\n+            request = self.rf.post('/some_url/', self.breakfast_data)\n+            response = view(request)\n+            self.assertEquals(len(mail.outbox), 1)\n+            email = mail.outbox[0]\n+            # Frames vars are never shown in plain text email reports.\n+            self.assertNotIn('cooked_eggs', email.body)\n+            self.assertNotIn('scrambled', email.body)\n+            self.assertNotIn('sauce', email.body)\n+            self.assertNotIn('worcestershire', email.body)\n+            for k, v in self.breakfast_data.items():\n+                # All POST parameters are shown.\n+                self.assertIn(k, email.body)\n+                self.assertIn(v, email.body)\n+\n+    def verify_safe_email(self, view):\n+        \"\"\"\n+        Asserts that certain sensitive info are not displayed in the email report.\n+        \"\"\"\n+        with self.settings(ADMINS=(('Admin', 'admin@fattie-breakie.com'),)):\n+            mail.outbox = [] # Empty outbox\n+            request = self.rf.post('/some_url/', self.breakfast_data)\n+            response = view(request)\n+            self.assertEquals(len(mail.outbox), 1)\n+            email = mail.outbox[0]\n+            # Frames vars are never shown in plain text email reports.\n+            self.assertNotIn('cooked_eggs', email.body)\n+            self.assertNotIn('scrambled', email.body)\n+            self.assertNotIn('sauce', email.body)\n+            self.assertNotIn('worcestershire', email.body)\n+            for k, v in self.breakfast_data.items():\n+                # All POST parameters' names are shown.\n+                self.assertIn(k, email.body)\n+            # Non-sensitive POST parameters' values are shown.\n+            self.assertIn('baked-beans-value', email.body)\n+            self.assertIn('hash-brown-value', email.body)\n+            # Sensitive POST parameters' values are not shown.\n+            self.assertNotIn('sausage-value', email.body)\n+            self.assertNotIn('bacon-value', email.body)\n+\n+    def verify_paranoid_email(self, view):\n+        \"\"\"\n+        Asserts that no variables or POST parameters are displayed in the email report.\n+        \"\"\"\n+        with self.settings(ADMINS=(('Admin', 'admin@fattie-breakie.com'),)):\n+            mail.outbox = [] # Empty outbox\n+            request = self.rf.post('/some_url/', self.breakfast_data)\n+            response = view(request)\n+            self.assertEquals(len(mail.outbox), 1)\n+            email = mail.outbox[0]\n+            # Frames vars are never shown in plain text email reports.\n+            self.assertNotIn('cooked_eggs', email.body)\n+            self.assertNotIn('scrambled', email.body)\n+            self.assertNotIn('sauce', email.body)\n+            self.assertNotIn('worcestershire', email.body)\n+            for k, v in self.breakfast_data.items():\n+                # All POST parameters' names are shown.\n+                self.assertIn(k, email.body)\n+                # No POST parameters' values are shown.\n+                self.assertNotIn(v, email.body)\n+\n+    def test_non_sensitive_request(self):\n+        \"\"\"\n+        Ensure that everything (request info and frame variables) can bee seen\n+        in the default error reports for non-sensitive requests.\n+        \"\"\"\n+        with self.settings(DEBUG=True):\n+            self.verify_unsafe_response(non_sensitive_view)\n+            self.verify_unsafe_email(non_sensitive_view)\n+\n+        with self.settings(DEBUG=False):\n+            self.verify_unsafe_response(non_sensitive_view)\n+            self.verify_unsafe_email(non_sensitive_view)\n+\n+    def test_sensitive_request(self):\n+        \"\"\"\n+        Ensure that sensitive POST parameters and frame variables cannot be\n+        seen in the default error reports for sensitive requests.\n+        \"\"\"\n+        with self.settings(DEBUG=True):\n+            self.verify_unsafe_response(sensitive_view)\n+            self.verify_unsafe_email(sensitive_view)\n+\n+        with self.settings(DEBUG=False):\n+            self.verify_safe_response(sensitive_view)\n+            self.verify_safe_email(sensitive_view)\n+\n+    def test_paranoid_request(self):\n+        \"\"\"\n+        Ensure that no POST parameters and frame variables can be seen in the\n+        default error reports for \"paranoid\" requests.\n+        \"\"\"\n+        with self.settings(DEBUG=True):\n+            self.verify_unsafe_response(paranoid_view)\n+            self.verify_unsafe_email(paranoid_view)\n+\n+        with self.settings(DEBUG=False):\n+            self.verify_paranoid_response(paranoid_view)\n+            self.verify_paranoid_email(paranoid_view)\n+\n+    def test_custom_exception_reporter_filter(self):\n+        \"\"\"\n+        Ensure that it's possible to assign an exception reporter filter to\n+        the request to bypass the one set in DEFAULT_EXCEPTION_REPORTER_FILTER.\n+        \"\"\"\n+        with self.settings(DEBUG=True):\n+            self.verify_unsafe_response(custom_exception_reporter_filter_view)\n+            self.verify_unsafe_email(custom_exception_reporter_filter_view)\n+\n+        with self.settings(DEBUG=False):\n+            self.verify_unsafe_response(custom_exception_reporter_filter_view)\n+            self.verify_unsafe_email(custom_exception_reporter_filter_view)"
        },
        {
            "sha": "732ff280ca91703f201176fe54b9d4280ccc9ca6",
            "filename": "tests/regressiontests/views/views.py",
            "status": "modified",
            "additions": 85,
            "deletions": 1,
            "changes": 86,
            "blob_url": "https://github.com/django/django/blob/45e55b91435541203f517770c654675f67fa6a3b/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/45e55b91435541203f517770c654675f67fa6a3b/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fviews.py?ref=45e55b91435541203f517770c654675f67fa6a3b",
            "patch": "@@ -5,7 +5,10 @@\n from django.core.urlresolvers import get_resolver\n from django.shortcuts import render_to_response, render\n from django.template import Context, RequestContext, TemplateDoesNotExist\n-from django.views.debug import technical_500_response\n+from django.views.debug import technical_500_response, SafeExceptionReporterFilter\n+from django.views.decorators.debug import (sensitive_post_parameters,\n+                                           sensitive_variables)\n+from django.utils.log import getLogger\n \n from regressiontests.views import BrokenException, except_args\n \n@@ -128,3 +131,84 @@ def raises_template_does_not_exist(request):\n         return render_to_response('i_dont_exist.html')\n     except TemplateDoesNotExist:\n         return technical_500_response(request, *sys.exc_info())\n+\n+def send_log(request, exc_info):\n+    logger = getLogger('django.request')\n+    logger.error('Internal Server Error: %s' % request.path,\n+        exc_info=exc_info,\n+        extra={\n+            'status_code': 500,\n+            'request': request\n+        }\n+    )\n+\n+def non_sensitive_view(request):\n+    # Do not just use plain strings for the variables' values in the code\n+    # so that the tests don't return false positives when the function's source\n+    # is displayed in the exception report.\n+    cooked_eggs = ''.join(['s', 'c', 'r', 'a', 'm', 'b', 'l', 'e', 'd'])\n+    sauce = ''.join(['w', 'o', 'r', 'c', 'e', 's', 't', 'e', 'r', 's', 'h', 'i', 'r', 'e'])\n+    try:\n+        raise Exception\n+    except Exception:\n+        exc_info = sys.exc_info()\n+        send_log(request, exc_info)\n+        return technical_500_response(request, *exc_info)\n+\n+@sensitive_variables('sauce')\n+@sensitive_post_parameters('bacon-key', 'sausage-key')\n+def sensitive_view(request):\n+    # Do not just use plain strings for the variables' values in the code\n+    # so that the tests don't return false positives when the function's source\n+    # is displayed in the exception report.\n+    cooked_eggs = ''.join(['s', 'c', 'r', 'a', 'm', 'b', 'l', 'e', 'd'])\n+    sauce = ''.join(['w', 'o', 'r', 'c', 'e', 's', 't', 'e', 'r', 's', 'h', 'i', 'r', 'e'])\n+    try:\n+        raise Exception\n+    except Exception:\n+        exc_info = sys.exc_info()\n+        send_log(request, exc_info)\n+        return technical_500_response(request, *exc_info)\n+\n+@sensitive_variables()\n+@sensitive_post_parameters()\n+def paranoid_view(request):\n+    # Do not just use plain strings for the variables' values in the code\n+    # so that the tests don't return false positives when the function's source\n+    # is displayed in the exception report.\n+    cooked_eggs = ''.join(['s', 'c', 'r', 'a', 'm', 'b', 'l', 'e', 'd'])\n+    sauce = ''.join(['w', 'o', 'r', 'c', 'e', 's', 't', 'e', 'r', 's', 'h', 'i', 'r', 'e'])\n+    try:\n+        raise Exception\n+    except Exception:\n+        exc_info = sys.exc_info()\n+        send_log(request, exc_info)\n+        return technical_500_response(request, *exc_info)\n+\n+class UnsafeExceptionReporterFilter(SafeExceptionReporterFilter):\n+    \"\"\"\n+    Ignores all the filtering done by its parent class.\n+    \"\"\"\n+\n+    def get_post_parameters(self, request):\n+        return request.POST\n+\n+    def get_traceback_frame_variables(self, request, tb_frame):\n+        return tb_frame.f_locals.items()\n+\n+\n+@sensitive_variables()\n+@sensitive_post_parameters()\n+def custom_exception_reporter_filter_view(request):\n+    # Do not just use plain strings for the variables' values in the code\n+    # so that the tests don't return false positives when the function's source\n+    # is displayed in the exception report.\n+    cooked_eggs = ''.join(['s', 'c', 'r', 'a', 'm', 'b', 'l', 'e', 'd'])\n+    sauce = ''.join(['w', 'o', 'r', 'c', 'e', 's', 't', 'e', 'r', 's', 'h', 'i', 'r', 'e'])\n+    request.exception_reporter_filter = UnsafeExceptionReporterFilter()\n+    try:\n+        raise Exception\n+    except Exception:\n+        exc_info = sys.exc_info()\n+        send_log(request, exc_info)\n+        return technical_500_response(request, *exc_info)"
        }
    ],
    "stats": {
        "total": 767,
        "additions": 738,
        "deletions": 29
    }
}