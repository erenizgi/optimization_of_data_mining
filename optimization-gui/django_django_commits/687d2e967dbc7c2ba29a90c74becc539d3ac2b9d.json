{
    "author": "regebro",
    "message": "Fixed #19827 -- Kept stacktrace in defaulttags exception reraising\n\nThanks Kronuz for the report and the initial patch.",
    "sha": "687d2e967dbc7c2ba29a90c74becc539d3ac2b9d",
    "files": [
        {
            "sha": "accf5d56b9f62e42bd1944048951d7b62399971a",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/687d2e967dbc7c2ba29a90c74becc539d3ac2b9d/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/687d2e967dbc7c2ba29a90c74becc539d3ac2b9d/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=687d2e967dbc7c2ba29a90c74becc539d3ac2b9d",
            "patch": "@@ -416,7 +416,8 @@ def render(self, context):\n         url = ''\n         try:\n             url = reverse(view_name, args=args, kwargs=kwargs, current_app=context.current_app)\n-        except NoReverseMatch as e:\n+        except NoReverseMatch:\n+            exc_info = sys.exc_info()\n             if settings.SETTINGS_MODULE:\n                 project_name = settings.SETTINGS_MODULE.split('.')[0]\n                 try:\n@@ -428,10 +429,10 @@ def render(self, context):\n                         # Re-raise the original exception, not the one with\n                         # the path relative to the project. This makes a\n                         # better error message.\n-                        raise e\n+                        six.reraise(*exc_info)\n             else:\n                 if self.asvar is None:\n-                    raise e\n+                    raise\n \n         if self.asvar:\n             context[self.asvar] = url"
        },
        {
            "sha": "21b7827108f4b94593d78b71fdd7025b80d10b5e",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/687d2e967dbc7c2ba29a90c74becc539d3ac2b9d/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/687d2e967dbc7c2ba29a90c74becc539d3ac2b9d/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=687d2e967dbc7c2ba29a90c74becc539d3ac2b9d",
            "patch": "@@ -372,6 +372,22 @@ def test_url_reverse_no_settings_module(self):\n         with self.assertRaises(urlresolvers.NoReverseMatch):\n             t.render(c)\n \n+    @override_settings(TEMPLATE_STRING_IF_INVALID='%s is invalid', SETTINGS_MODULE='also_something')\n+    def test_url_reverse_view_name(self):\n+        # Regression test for #19827\n+        t = Template('{% url will_not_match %}')\n+        c = Context()\n+        try:\n+            t.render(c)\n+        except urlresolvers.NoReverseMatch:\n+            tb = sys.exc_info()[2]\n+            depth = 0\n+            while tb.tb_next is not None:\n+                tb = tb.tb_next\n+                depth += 1\n+            self.assertTrue(depth > 5,\n+                \"The traceback context was lost when reraising the traceback. See #19827\")\n+\n     def test_url_explicit_exception_for_old_syntax_at_run_time(self):\n         # Regression test for #19280\n         t = Template('{% url path.to.view %}')      # not quoted = old syntax"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 20,
        "deletions": 3
    }
}