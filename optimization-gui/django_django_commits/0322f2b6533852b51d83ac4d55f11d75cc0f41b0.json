{
    "author": "jezdez",
    "message": "Fixed #15263 -- Added support for format localization to the now template tag. Thanks to danielr and dmclain.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16172 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0322f2b6533852b51d83ac4d55f11d75cc0f41b0",
    "files": [
        {
            "sha": "1eceaf41202fa968b2c05bac75b2a9bdf7fa637d",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=0322f2b6533852b51d83ac4d55f11d75cc0f41b0",
            "patch": "@@ -2,12 +2,14 @@\n \n import sys\n import re\n+from datetime import datetime\n from itertools import groupby, cycle as itertools_cycle\n \n from django.template.base import Node, NodeList, Template, Context, Variable\n from django.template.base import TemplateSyntaxError, VariableDoesNotExist, BLOCK_TAG_START, BLOCK_TAG_END, VARIABLE_TAG_START, VARIABLE_TAG_END, SINGLE_BRACE_START, SINGLE_BRACE_END, COMMENT_TAG_START, COMMENT_TAG_END\n from django.template.base import get_library, Library, InvalidTemplateLibrary\n from django.template.smartif import IfParser, Literal\n+from django.template.defaultfilters import date\n from django.conf import settings\n from django.utils.encoding import smart_str, smart_unicode\n from django.utils.safestring import mark_safe\n@@ -380,10 +382,7 @@ def __init__(self, format_string):\n         self.format_string = format_string\n \n     def render(self, context):\n-        from datetime import datetime\n-        from django.utils.dateformat import DateFormat\n-        df = DateFormat(datetime.now())\n-        return df.format(self.format_string)\n+        return date(datetime.now(), self.format_string)\n \n class SpacelessNode(Node):\n     def __init__(self, nodelist):"
        },
        {
            "sha": "29bed25db9d98251eeee8d0cf8f8c2aaf887ef3f",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=0322f2b6533852b51d83ac4d55f11d75cc0f41b0",
            "patch": "@@ -727,6 +727,18 @@ escaped, because it's not a format character::\n \n This would display as \"It is the 4th of September\".\n \n+.. versionchanged:: 1.4\n+\n+.. note::\n+\n+    The format passed can also be one of the predefined ones\n+    :setting:`DATE_FORMAT`, :setting:`DATETIME_FORMAT`,\n+    :setting:`SHORT_DATE_FORMAT` or :setting:`SHORT_DATETIME_FORMAT`.\n+    The predefined formats may vary depending on the current locale and\n+    if :ref:`format-localization` is enabled, e.g.::\n+\n+        It is {% now \"SHORT_DATETIME_FORMAT\" %}\n+\n .. templatetag:: regroup\n \n regroup"
        },
        {
            "sha": "e3add3e3d82c50259c8eb9dc7a4ab076e0a9cc38",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=0322f2b6533852b51d83ac4d55f11d75cc0f41b0",
            "patch": "@@ -305,6 +305,7 @@ def test_l10n_enabled(self):\n             self.assertEqual(u'10:15:48', Template('{{ t|time:\"TIME_FORMAT\" }}').render(self.ctxt))\n             self.assertEqual(u'31/12/2009', Template('{{ d|date:\"SHORT_DATE_FORMAT\" }}').render(self.ctxt))\n             self.assertEqual(u'31/12/2009 20:50', Template('{{ dt|date:\"SHORT_DATETIME_FORMAT\" }}').render(self.ctxt))\n+            self.assertEqual(date_format(datetime.datetime.now(), \"DATE_FORMAT\"), Template('{% now \"DATE_FORMAT\" %}').render(self.ctxt))\n \n             form4 = I18nForm({\n                 'decimal_field': u'66666,666',"
        },
        {
            "sha": "abfdb8d73541ec241d3aa944cd331e1a04527793",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0322f2b6533852b51d83ac4d55f11d75cc0f41b0/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=0322f2b6533852b51d83ac4d55f11d75cc0f41b0",
            "patch": "@@ -21,6 +21,7 @@\n from django.test.utils import get_warnings_state, restore_warnings_state,\\\n     setup_test_template_loader, restore_template_loaders\n from django.utils import unittest\n+from django.utils.formats import date_format\n from django.utils.translation import activate, deactivate, ugettext as _\n from django.utils.safestring import mark_safe\n from django.utils.tzinfo import LocalTimezone\n@@ -1422,6 +1423,8 @@ def get_template_tests(self):\n             'now02': ('{% now \"j \"n\" Y\"%}', {}, template.TemplateSyntaxError),\n         #    'now03': ('{% now \"j \\\"n\\\" Y\"%}', {}, str(datetime.now().day) + '\"' + str(datetime.now().month) + '\"' + str(datetime.now().year)),\n         #    'now04': ('{% now \"j \\nn\\n Y\"%}', {}, str(datetime.now().day) + '\\n' + str(datetime.now().month) + '\\n' + str(datetime.now().year))\n+            # Check parsing of locale strings\n+            'now05': ('{% now \"DATE_FORMAT\" %}', {},  date_format(datetime.now())),\n \n             ### URL TAG ########################################################\n             # Successes"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 19,
        "deletions": 4
    }
}