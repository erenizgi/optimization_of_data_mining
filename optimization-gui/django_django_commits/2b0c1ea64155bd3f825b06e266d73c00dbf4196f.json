{
    "author": "jezdez",
    "message": "Fixed #17527 -- Improved exception message when adding the wrong type of object to a ManyToManyField. Thanks, guettli and cClaude Paroz.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17437 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2b0c1ea64155bd3f825b06e266d73c00dbf4196f",
    "files": [
        {
            "sha": "53f9b9f8c25952ca8ddfcf6b030443c2539e6a02",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/2b0c1ea64155bd3f825b06e266d73c00dbf4196f/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/2b0c1ea64155bd3f825b06e266d73c00dbf4196f/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=2b0c1ea64155bd3f825b06e266d73c00dbf4196f",
            "patch": "@@ -474,7 +474,7 @@ def get_prefetch_query_set(self, instances):\n             def add(self, *objs):\n                 for obj in objs:\n                     if not isinstance(obj, self.model):\n-                        raise TypeError(\"'%s' instance expected\" % self.model._meta.object_name)\n+                        raise TypeError(\"'%s' instance expected, got %r\" % (self.model._meta.object_name, obj))\n                     setattr(obj, rel_field.name, self.instance)\n                     obj.save()\n             add.alters_data = True\n@@ -636,7 +636,7 @@ def _add_items(self, source_field_name, target_field_name, *objs):\n                                                (obj, self.instance._state.db, obj._state.db))\n                         new_ids.add(obj.pk)\n                     elif isinstance(obj, Model):\n-                        raise TypeError(\"'%s' instance expected\" % self.model._meta.object_name)\n+                        raise TypeError(\"'%s' instance expected, got %r\" % (self.model._meta.object_name, obj))\n                     else:\n                         new_ids.add(obj)\n                 db = router.db_for_write(self.through, instance=self.instance)"
        },
        {
            "sha": "9fa524f99353d73ab7388c58164538a8974c0373",
            "filename": "tests/modeltests/many_to_many/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/2b0c1ea64155bd3f825b06e266d73c00dbf4196f/tests%2Fmodeltests%2Fmany_to_many%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2b0c1ea64155bd3f825b06e266d73c00dbf4196f/tests%2Fmodeltests%2Fmany_to_many%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_many%2Ftests.py?ref=2b0c1ea64155bd3f825b06e266d73c00dbf4196f",
            "patch": "@@ -1,4 +1,4 @@\n-from __future__ import absolute_import\n+from __future__ import absolute_import, with_statement\n \n from django.test import TestCase\n \n@@ -52,7 +52,8 @@ def test_add(self):\n             ])\n \n         # Adding an object of the wrong type raises TypeError\n-        self.assertRaises(TypeError, a6.publications.add, a5)\n+        with self.assertRaisesRegexp(TypeError, \"'Publication' instance expected, got <Article.*\"):\n+            a6.publications.add(a5)\n         # Add a Publication directly via publications.add by using keyword arguments.\n         p4 = a6.publications.create(title='Highlights for Adults')\n         self.assertQuerysetEqual(a6.publications.all(),"
        },
        {
            "sha": "bc9fe64be4d97505f873b8aa15eef1fe6aae7352",
            "filename": "tests/modeltests/many_to_one/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/2b0c1ea64155bd3f825b06e266d73c00dbf4196f/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2b0c1ea64155bd3f825b06e266d73c00dbf4196f/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py?ref=2b0c1ea64155bd3f825b06e266d73c00dbf4196f",
            "patch": "@@ -1,4 +1,4 @@\n-from __future__ import absolute_import\n+from __future__ import absolute_import, with_statement\n \n from copy import deepcopy\n from datetime import datetime\n@@ -68,7 +68,8 @@ def test_add(self):\n         self.assertQuerysetEqual(self.r2.article_set.all(), [\"<Article: Paul's story>\"])\n \n         # Adding an object of the wrong type raises TypeError.\n-        self.assertRaises(TypeError, self.r.article_set.add, self.r2)\n+        with self.assertRaisesRegexp(TypeError, \"'Article' instance expected, got <Reporter.*\"):\n+            self.r.article_set.add(self.r2)\n         self.assertQuerysetEqual(self.r.article_set.all(),\n             [\n                 \"<Article: John's second story>\","
        }
    ],
    "stats": {
        "total": 14,
        "additions": 8,
        "deletions": 6
    }
}