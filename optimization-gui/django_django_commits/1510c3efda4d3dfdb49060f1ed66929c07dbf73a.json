{
    "author": "aaugustin",
    "message": "Upgraded django.contrib.comments to be compatible with time zone support.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17123 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "1510c3efda4d3dfdb49060f1ed66929c07dbf73a",
    "files": [
        {
            "sha": "05c4afebe151505b4d581ed0ed352e2fc68d1f29",
            "filename": "django/contrib/comments/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/1510c3efda4d3dfdb49060f1ed66929c07dbf73a/django%2Fcontrib%2Fcomments%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/1510c3efda4d3dfdb49060f1ed66929c07dbf73a/django%2Fcontrib%2Fcomments%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fforms.py?ref=1510c3efda4d3dfdb49060f1ed66929c07dbf73a",
            "patch": "@@ -1,4 +1,3 @@\n-import datetime\n import time\n from django import forms\n from django.forms.util import ErrorDict\n@@ -8,6 +7,7 @@\n from django.utils.crypto import salted_hmac, constant_time_compare\n from django.utils.encoding import force_unicode\n from django.utils.text import get_text_list\n+from django.utils import timezone\n from django.utils.translation import ungettext, ugettext_lazy as _\n \n COMMENT_MAX_LENGTH = getattr(settings,'COMMENT_MAX_LENGTH', 3000)\n@@ -138,7 +138,7 @@ def get_comment_create_data(self):\n             user_email   = self.cleaned_data[\"email\"],\n             user_url     = self.cleaned_data[\"url\"],\n             comment      = self.cleaned_data[\"comment\"],\n-            submit_date  = datetime.datetime.now(),\n+            submit_date  = timezone.now(),\n             site_id      = settings.SITE_ID,\n             is_public    = True,\n             is_removed   = False,"
        },
        {
            "sha": "e0ef8b3d28e1c94491bc3f4dedd63233d50c1ae3",
            "filename": "django/contrib/comments/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/1510c3efda4d3dfdb49060f1ed66929c07dbf73a/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/1510c3efda4d3dfdb49060f1ed66929c07dbf73a/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmodels.py?ref=1510c3efda4d3dfdb49060f1ed66929c07dbf73a",
            "patch": "@@ -1,4 +1,3 @@\n-import datetime\n from django.contrib.auth.models import User\n from django.contrib.comments.managers import CommentManager\n from django.contrib.contenttypes import generic\n@@ -7,6 +6,7 @@\n from django.db import models\n from django.core import urlresolvers\n from django.utils.translation import ugettext_lazy as _\n+from django.utils import timezone\n from django.conf import settings\n \n COMMENT_MAX_LENGTH = getattr(settings,'COMMENT_MAX_LENGTH',3000)\n@@ -81,7 +81,7 @@ def __unicode__(self):\n \n     def save(self, *args, **kwargs):\n         if self.submit_date is None:\n-            self.submit_date = datetime.datetime.now()\n+            self.submit_date = timezone.now()\n         super(Comment, self).save(*args, **kwargs)\n \n     def _get_userinfo(self):\n@@ -187,5 +187,5 @@ def __unicode__(self):\n \n     def save(self, *args, **kwargs):\n         if self.flag_date is None:\n-            self.flag_date = datetime.datetime.now()\n+            self.flag_date = timezone.now()\n         super(CommentFlag, self).save(*args, **kwargs)"
        },
        {
            "sha": "9b206a5badf9692100fa76505c8a58b83a9f3c0b",
            "filename": "django/contrib/comments/moderation.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/1510c3efda4d3dfdb49060f1ed66929c07dbf73a/django%2Fcontrib%2Fcomments%2Fmoderation.py",
            "raw_url": "https://github.com/django/django/raw/1510c3efda4d3dfdb49060f1ed66929c07dbf73a/django%2Fcontrib%2Fcomments%2Fmoderation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmoderation.py?ref=1510c3efda4d3dfdb49060f1ed66929c07dbf73a",
            "patch": "@@ -63,6 +63,7 @@ class EntryModerator(CommentModerator):\n from django.template import Context, loader\n from django.contrib import comments\n from django.contrib.sites.models import Site\n+from django.utils import timezone\n \n class AlreadyModerated(Exception):\n     \"\"\"\n@@ -207,7 +208,7 @@ def allow(self, comment, content_object, request):\n                 return False\n         if self.auto_close_field and self.close_after is not None:\n             close_after_date = getattr(content_object, self.auto_close_field)\n-            if close_after_date is not None and self._get_delta(datetime.datetime.now(), close_after_date).days >= self.close_after:\n+            if close_after_date is not None and self._get_delta(timezone.now(), close_after_date).days >= self.close_after:\n                 return False\n         return True\n \n@@ -223,7 +224,7 @@ def moderate(self, comment, content_object, request):\n         \"\"\"\n         if self.auto_moderate_field and self.moderate_after is not None:\n             moderate_after_date = getattr(content_object, self.auto_moderate_field)\n-            if moderate_after_date is not None and self._get_delta(datetime.datetime.now(), moderate_after_date).days >= self.moderate_after:\n+            if moderate_after_date is not None and self._get_delta(timezone.now(), moderate_after_date).days >= self.moderate_after:\n                 return True\n         return False\n "
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}