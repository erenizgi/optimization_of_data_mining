{
    "author": "freakboy3742",
    "message": "Fixed #3011 -- Added swappable auth.User models.\n\nThanks to the many people that contributed to the development and review of\nthis patch, including (but not limited to) Jacob Kaplan-Moss, Anssi\nKääriäinen, Ramiro Morales, Preston Holmes, Josh Ourisman, Thomas Sutton,\nand Roger Barnes, as well as the many, many people who have contributed to\nthe design discussion around this ticket over many years.\n\nSquashed commit of the following:\n\ncommit d84749a0f034a0a6906d20df047086b1219040d0\nMerge: 531e771 7c11b1a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Wed Sep 26 18:37:04 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit 531e7715da545f930c49919a19e954d41c59b446\nMerge: 29d1abb 1f84b04\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Wed Sep 26 07:09:23 2012 +0800\n\n    Merged recent trunk changes.\n\ncommit 29d1abbe351fd5da855fe5ce09e24227d90ddc91\nMerge: 8a527dd 54c81a1\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Sep 24 07:49:46 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit 8a527dda13c9bec955b1f7e8db5822d1d9b32a01\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Sep 24 07:48:05 2012 +0800\n\n    Ensure sequences are reset correctly in the presence of swapped models.\n\ncommit e2b6e22f298eb986d74d28b8d9906f37f5ff8eb8\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 23 17:53:05 2012 +0800\n\n    Modifications to the handling and docs for auth forms.\n\ncommit 98aba856b534620aea9091f824b442b47d2fdb3c\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 23 15:28:57 2012 +0800\n\n    Improved error handling and docs for get_user_model()\n\ncommit 0229209c844f06dfeb33b0b8eeec000c127695b6\nMerge: 6494bf9 8599f64\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 23 14:50:11 2012 +0800\n\n    Merged recent Django trunk changes.\n\ncommit 6494bf91f2ddaaabec3ec017f2e3131937c35517\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Sep 17 21:38:44 2012 +0800\n\n    Improved validation of swappable model settings.\n\ncommit 5a04cde342cc860384eb844cfda5af55204564ad\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Sep 17 07:15:14 2012 +0800\n\n    Removed some unused imports.\n\ncommit ffd535e4136dc54f084b6ac467e81444696e1c8a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 20:31:28 2012 +0800\n\n    Corrected attribute access on for get_by_natural_key\n\ncommit 913e1ac84c3d9c7c58a9b3bdbbb15ebccd8a8c0a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 20:12:34 2012 +0800\n\n    Added test for proxy model safeguards on swappable models.\n\ncommit 280bf19e94d0d534d0e51bae485c1842558f4ff4\nMerge: dbb3900 935a863\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 18:16:49 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit dbb3900775a99df8b6cb1d7063cf364eab55621a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 18:09:27 2012 +0800\n\n    Fixes for Python 3 compatibility.\n\ncommit dfd72131d8664615e245aa0f95b82604ba6b3821\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 15:54:30 2012 +0800\n\n    Added protection against proxying swapped models.\n\ncommit abcb027190e53613e7f1734e77ee185b2587de31\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 15:11:10 2012 +0800\n\n    Cleanup and documentation of AbstractUser base class.\n\ncommit a9491a87763e307f0eb0dc246f54ac865a6ffb34\nMerge: fd8bb4e 08bcb4a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 14:46:49 2012 +0800\n\n    Merge commit '08bcb4aec1ed154cefc631b8510ee13e9af0c19d' into t3011\n\ncommit fd8bb4e3e498a92d7a8b340f0684d5f088aa4c92\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 14:20:14 2012 +0800\n\n    Documentation improvements coming from community review.\n\ncommit b550a6d06d016ab6a0198c4cb2dffe9cceabe8a5\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 13:52:47 2012 +0800\n\n    Refactored skipIfCustomUser into the contrib.auth tests.\n\ncommit 52a02f11107c3f0d711742b8ca65b75175b79d6a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 13:46:10 2012 +0800\n\n    Refactored common 'get' pattern into manager method.\n\ncommit b441a6bbc7d6065175715cb09316b9f13268171b\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 16 13:41:33 2012 +0800\n\n    Added note about backwards incompatible change to admin login messages.\n\ncommit 08bcb4aec1ed154cefc631b8510ee13e9af0c19d\nAuthor: Anssi Kääriäinen <akaariai@gmail.com>\nDate:   Sat Sep 15 18:30:33 2012 +0300\n\n    Splitted User to AbstractUser and User\n\ncommit d9f5e5addbad5e1a01f67e7358e4f5091c3cad81\nAuthor: Anssi Kääriäinen <akaariai@gmail.com>\nDate:   Sat Sep 15 18:30:02 2012 +0300\n\n    Reworked REQUIRED_FIELDS + create_user() interaction\n\ncommit 579f152e4a6e06671e1ac1e59e2b43cf4d764bf4\nMerge: 9184972 93e6733\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 15 20:18:37 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit 918497218c58227f5032873ff97261627b2ceab2\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 15 20:18:19 2012 +0800\n\n    Deprecate AUTH_PROFILE_MODULE and get_profile().\n\ncommit 334cdfc1bb6a6794791497cdefda843bca2ea57a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 15 20:00:12 2012 +0800\n\n    Added release notes for new swappable User feature.\n\ncommit 5d7bb22e8d913b51aba1c3360e7af8b01b6c0ab6\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 15 19:59:49 2012 +0800\n\n    Ensure swapped models can't be queried.\n\ncommit 57ac6e3d32605a67581e875b37ec5b2284711a32\nMerge: f2ec915 abfba3b\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 15 14:31:54 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit f2ec915b20f81c8afeaa3df25f80689712f720f8\nMerge: 1952656 5e99a3d\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 9 08:29:51 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit 19526563b54fa300785c49cfb625c0c6158ced67\nMerge: 2c5e833 c4aa26a\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 9 08:22:26 2012 +0800\n\n    Merge recent changes from master.\n\ncommit 2c5e833a30bef4305d55eacc0703533152f5c427\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 9 07:53:46 2012 +0800\n\n    Corrected admin_views tests following removal of the email fallback on admin logins.\n\ncommit 20d1892491839d6ef21f37db4ca136935c2076bf\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sun Sep 9 01:00:37 2012 +0800\n\n    Added conditional skips for all tests dependent on the default User model\n\ncommit 40ea8b888284775481fc1eaadeff267dbd7e3dfa\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 8 23:47:02 2012 +0800\n\n    Added documentation for REQUIRED_FIELDS in custom auth.\n\ncommit e6aaf659708cf6491f5485d3edfa616cb9214cc0\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Sat Sep 8 23:20:02 2012 +0800\n\n    Added first draft of custom User docs.\n\n    Thanks to Greg Turner for the initial text.\n\ncommit 75118bd242eec87649da2859e8c50a199a8a1dca\nAuthor: Thomas Sutton <me@thomas-sutton.id.au>\nDate:   Mon Aug 20 11:17:26 2012 +0800\n\n    Admin app should not allow username discovery\n\n    The admin app login form should not allow users to discover the username\n    associated with an email address.\n\ncommit d088b3af58dad7449fc58493193a327725c57c22\nAuthor: Thomas Sutton <me@thomas-sutton.id.au>\nDate:   Mon Aug 20 10:32:13 2012 +0800\n\n    Admin app login form should use swapped user model\n\ncommit 7e82e83d67ee0871a72e1a3a723afdd214fcefc3\nMerge: e29c010 39aa890\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Fri Sep 7 23:45:03 2012 +0800\n\n    Merged master changes.\n\ncommit e29c010beb96ca07697c4e3e0c0d5d3ffdc4c0a3\nMerge: 8e3fd70 30bdf22\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Aug 20 13:12:57 2012 +0800\n\n    Merge remote-tracking branch 'django/master' into t3011\n\ncommit 8e3fd703d02c31a4c3ac9f51f5011d03c0bd47f6\nMerge: 507bb50 26e0ba0\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Aug 20 13:09:09 2012 +0800\n\n    Merged recent changes from trunk.\n\ncommit 507bb50a9291bfcdcfa1198f9fea21d4e3b1e762\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Jun 4 20:41:37 2012 +0800\n\n    Modified auth app so that login with alternate auth app is possible.\n\ncommit dabe3628362ab7a4a6c9686dd874803baa997eaa\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Jun 4 20:10:51 2012 +0800\n\n    Modified auth management commands to handle custom user definitions.\n\ncommit 7cc0baf89d490c92ef3f1dc909b8090191a1294b\nAuthor: Russell Keith-Magee <russell@keith-magee.com>\nDate:   Mon Jun 4 14:17:28 2012 +0800\n\n    Added model Meta option for swappable models, and made auth.User a swappable model",
    "sha": "70a0de37d132e5f1514fb939875f69649f103124",
    "files": [
        {
            "sha": "4d5dc49ee0d3d180b5523966313ccd3f0d392a2e",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -488,6 +488,8 @@\n # AUTHENTICATION #\n ##################\n \n+AUTH_USER_MODEL = 'auth.User'\n+\n AUTHENTICATION_BACKENDS = ('django.contrib.auth.backends.ModelBackend',)\n \n LOGIN_URL = '/accounts/login/'"
        },
        {
            "sha": "f1e7076ece03362a6071f34c984b84d35e5800c2",
            "filename": "django/contrib/admin/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 13,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fforms.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -4,12 +4,12 @@\n \n from django.contrib.auth import authenticate\n from django.contrib.auth.forms import AuthenticationForm\n-from django.contrib.auth.models import User\n-from django.utils.translation import ugettext_lazy, ugettext as _\n+from django.utils.translation import ugettext_lazy\n \n ERROR_MESSAGE = ugettext_lazy(\"Please enter the correct username and password \"\n         \"for a staff account. Note that both fields are case-sensitive.\")\n \n+\n class AdminAuthenticationForm(AuthenticationForm):\n     \"\"\"\n     A custom authentication form used in the admin app.\n@@ -26,17 +26,6 @@ def clean(self):\n         if username and password:\n             self.user_cache = authenticate(username=username, password=password)\n             if self.user_cache is None:\n-                if '@' in username:\n-                    # Mistakenly entered e-mail address instead of username? Look it up.\n-                    try:\n-                        user = User.objects.get(email=username)\n-                    except (User.DoesNotExist, User.MultipleObjectsReturned):\n-                        # Nothing to do here, moving along.\n-                        pass\n-                    else:\n-                        if user.check_password(password):\n-                            message = _(\"Your e-mail address is not your username.\"\n-                                        \" Try '%s' instead.\") % user.username\n                 raise forms.ValidationError(message)\n             elif not self.user_cache.is_active or not self.user_cache.is_staff:\n                 raise forms.ValidationError(message)"
        },
        {
            "sha": "e1d3b40d01f142af49b33630860c194da448ca60",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,8 +1,8 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.conf import settings\n from django.contrib.contenttypes.models import ContentType\n-from django.contrib.auth.models import User\n from django.contrib.admin.util import quote\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_text\n@@ -12,15 +12,17 @@\n CHANGE = 2\n DELETION = 3\n \n+\n class LogEntryManager(models.Manager):\n     def log_action(self, user_id, content_type_id, object_id, object_repr, action_flag, change_message=''):\n         e = self.model(None, None, user_id, content_type_id, smart_text(object_id), object_repr[:200], action_flag, change_message)\n         e.save()\n \n+\n @python_2_unicode_compatible\n class LogEntry(models.Model):\n     action_time = models.DateTimeField(_('action time'), auto_now=True)\n-    user = models.ForeignKey(User)\n+    user = models.ForeignKey(settings.AUTH_USER_MODEL)\n     content_type = models.ForeignKey(ContentType, blank=True, null=True)\n     object_id = models.TextField(_('object id'), blank=True, null=True)\n     object_repr = models.CharField(_('object repr'), max_length=200)"
        },
        {
            "sha": "e375bc608fafd268084b3cfed47573e5858b099a",
            "filename": "django/contrib/admin/sites.py",
            "status": "modified",
            "additions": 20,
            "deletions": 14,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fsites.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fsites.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fsites.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -9,7 +9,6 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.core.urlresolvers import reverse, NoReverseMatch\n from django.template.response import TemplateResponse\n-from django.utils.safestring import mark_safe\n from django.utils import six\n from django.utils.text import capfirst\n from django.utils.translation import ugettext as _\n@@ -18,12 +17,15 @@\n \n LOGIN_FORM_KEY = 'this_is_the_login_form'\n \n+\n class AlreadyRegistered(Exception):\n     pass\n \n+\n class NotRegistered(Exception):\n     pass\n \n+\n class AdminSite(object):\n     \"\"\"\n     An AdminSite object encapsulates an instance of the Django admin application, ready\n@@ -41,7 +43,7 @@ class AdminSite(object):\n     password_change_done_template = None\n \n     def __init__(self, name='admin', app_name='admin'):\n-        self._registry = {} # model_class class -> admin_class instance\n+        self._registry = {}  # model_class class -> admin_class instance\n         self.name = name\n         self.app_name = app_name\n         self._actions = {'delete_selected': actions.delete_selected}\n@@ -80,20 +82,23 @@ def register(self, model_or_iterable, admin_class=None, **options):\n             if model in self._registry:\n                 raise AlreadyRegistered('The model %s is already registered' % model.__name__)\n \n-            # If we got **options then dynamically construct a subclass of\n-            # admin_class with those **options.\n-            if options:\n-                # For reasons I don't quite understand, without a __module__\n-                # the created class appears to \"live\" in the wrong place,\n-                # which causes issues later on.\n-                options['__module__'] = __name__\n-                admin_class = type(\"%sAdmin\" % model.__name__, (admin_class,), options)\n+            # Ignore the registration if the model has been\n+            # swapped out.\n+            if not model._meta.swapped:\n+                # If we got **options then dynamically construct a subclass of\n+                # admin_class with those **options.\n+                if options:\n+                    # For reasons I don't quite understand, without a __module__\n+                    # the created class appears to \"live\" in the wrong place,\n+                    # which causes issues later on.\n+                    options['__module__'] = __name__\n+                    admin_class = type(\"%sAdmin\" % model.__name__, (admin_class,), options)\n \n-            # Validate (which might be a no-op)\n-            validate(admin_class, model)\n+                # Validate (which might be a no-op)\n+                validate(admin_class, model)\n \n-            # Instantiate the admin class to save in the registry\n-            self._registry[model] = admin_class(model, self)\n+                # Instantiate the admin class to save in the registry\n+                self._registry[model] = admin_class(model, self)\n \n     def unregister(self, model_or_iterable):\n         \"\"\"\n@@ -319,6 +324,7 @@ def login(self, request, extra_context=None):\n             REDIRECT_FIELD_NAME: request.get_full_path(),\n         }\n         context.update(extra_context or {})\n+\n         defaults = {\n             'extra_context': context,\n             'current_app': self.name,"
        },
        {
            "sha": "3d2a07eba2adbab50fa9029a03a67c2cbf08b5b9",
            "filename": "django/contrib/admin/templates/admin/base.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fbase.html",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fbase.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fbase.html?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -26,7 +26,7 @@\n         {% if user.is_active and user.is_staff %}\n         <div id=\"user-tools\">\n             {% trans 'Welcome,' %}\n-            <strong>{% filter force_escape %}{% firstof user.first_name user.username %}{% endfilter %}</strong>.\n+            <strong>{% filter force_escape %}{% firstof user.get_short_name user.username %}{% endfilter %}</strong>.\n             {% block userlinks %}\n                 {% url 'django-admindocs-docroot' as docsroot %}\n                 {% if docsroot %}"
        },
        {
            "sha": "46903638919df42087dcd86f3e298132f26a8b8c",
            "filename": "django/contrib/admin/templates/admin/login.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Flogin.html",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Flogin.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Flogin.html?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -30,7 +30,7 @@\n <form action=\"{{ app_path }}\" method=\"post\" id=\"login-form\">{% csrf_token %}\n   <div class=\"form-row\">\n     {% if not form.this_is_the_login_form.errors %}{{ form.username.errors }}{% endif %}\n-    <label for=\"id_username\" class=\"required\">{% trans 'Username:' %}</label> {{ form.username }}\n+    <label for=\"id_username\" class=\"required\">{{ form.username.label }}:</label> {{ form.username }}\n   </div>\n   <div class=\"form-row\">\n     {% if not form.this_is_the_login_form.errors %}{{ form.password.errors }}{% endif %}"
        },
        {
            "sha": "e19265fc83c872f791f2b1daf4dbeb30c35f8106",
            "filename": "django/contrib/admin/views/decorators.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fviews%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fadmin%2Fviews%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fdecorators.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -4,6 +4,7 @@\n from django.contrib.auth.views import login\n from django.contrib.auth import REDIRECT_FIELD_NAME\n \n+\n def staff_member_required(view_func):\n     \"\"\"\n     Decorator for views that checks that the user is logged in and is a staff"
        },
        {
            "sha": "1050d1d1bbfaa0518c03d3c2444fc020b4dc9956",
            "filename": "django/contrib/auth/__init__.py",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2F__init__.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -6,9 +6,10 @@\n BACKEND_SESSION_KEY = '_auth_user_backend'\n REDIRECT_FIELD_NAME = 'next'\n \n+\n def load_backend(path):\n     i = path.rfind('.')\n-    module, attr = path[:i], path[i+1:]\n+    module, attr = path[:i], path[i + 1:]\n     try:\n         mod = import_module(module)\n     except ImportError as e:\n@@ -21,6 +22,7 @@ def load_backend(path):\n         raise ImproperlyConfigured('Module \"%s\" does not define a \"%s\" authentication backend' % (module, attr))\n     return cls()\n \n+\n def get_backends():\n     from django.conf import settings\n     backends = []\n@@ -30,6 +32,7 @@ def get_backends():\n         raise ImproperlyConfigured('No authentication backends have been defined. Does AUTHENTICATION_BACKENDS contain anything?')\n     return backends\n \n+\n def authenticate(**credentials):\n     \"\"\"\n     If the given credentials are valid, return a User object.\n@@ -46,6 +49,7 @@ def authenticate(**credentials):\n         user.backend = \"%s.%s\" % (backend.__module__, backend.__class__.__name__)\n         return user\n \n+\n def login(request, user):\n     \"\"\"\n     Persist a user id and a backend in the request. This way a user doesn't\n@@ -69,6 +73,7 @@ def login(request, user):\n         request.user = user\n     user_logged_in.send(sender=user.__class__, request=request, user=user)\n \n+\n def logout(request):\n     \"\"\"\n     Removes the authenticated user's ID from the request and flushes their\n@@ -86,6 +91,22 @@ def logout(request):\n         from django.contrib.auth.models import AnonymousUser\n         request.user = AnonymousUser()\n \n+\n+def get_user_model():\n+    \"Return the User model that is active in this project\"\n+    from django.conf import settings\n+    from django.db.models import get_model\n+\n+    try:\n+        app_label, model_name = settings.AUTH_USER_MODEL.split('.')\n+    except ValueError:\n+        raise ImproperlyConfigured(\"AUTH_USER_MODEL must be of the form 'app_label.model_name'\")\n+    user_model = get_model(app_label, model_name)\n+    if user_model is None:\n+        raise ImproperlyConfigured(\"AUTH_USER_MODEL refers to model '%s' that has not been installed\" % settings.AUTH_USER_MODEL)\n+    return user_model\n+\n+\n def get_user(request):\n     from django.contrib.auth.models import AnonymousUser\n     try:"
        },
        {
            "sha": "d103f32eb51be38e61573d4c736fdaa539e6b914",
            "filename": "django/contrib/auth/backends.py",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fbackends.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fbackends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fbackends.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,6 +1,6 @@\n from __future__ import unicode_literals\n-\n-from django.contrib.auth.models import User, Permission\n+from django.contrib.auth import get_user_model\n+from django.contrib.auth.models import Permission\n \n \n class ModelBackend(object):\n@@ -12,10 +12,11 @@ class ModelBackend(object):\n     # configurable.\n     def authenticate(self, username=None, password=None):\n         try:\n-            user = User.objects.get(username=username)\n+            UserModel = get_user_model()\n+            user = UserModel.objects.get_by_natural_key(username)\n             if user.check_password(password):\n                 return user\n-        except User.DoesNotExist:\n+        except UserModel.DoesNotExist:\n             return None\n \n     def get_group_permissions(self, user_obj, obj=None):\n@@ -60,8 +61,9 @@ def has_module_perms(self, user_obj, app_label):\n \n     def get_user(self, user_id):\n         try:\n-            return User.objects.get(pk=user_id)\n-        except User.DoesNotExist:\n+            UserModel = get_user_model()\n+            return UserModel.objects.get(pk=user_id)\n+        except UserModel.DoesNotExist:\n             return None\n \n \n@@ -94,17 +96,21 @@ def authenticate(self, remote_user):\n         user = None\n         username = self.clean_username(remote_user)\n \n+        UserModel = get_user_model()\n+\n         # Note that this could be accomplished in one try-except clause, but\n         # instead we use get_or_create when creating unknown users since it has\n         # built-in safeguards for multiple threads.\n         if self.create_unknown_user:\n-            user, created = User.objects.get_or_create(username=username)\n+            user, created = UserModel.objects.get_or_create(**{\n+                getattr(UserModel, 'USERNAME_FIELD', 'username'): username\n+            })\n             if created:\n                 user = self.configure_user(user)\n         else:\n             try:\n-                user = User.objects.get(username=username)\n-            except User.DoesNotExist:\n+                user = UserModel.objects.get_by_natural_key(username)\n+            except UserModel.DoesNotExist:\n                 pass\n         return user\n "
        },
        {
            "sha": "770bea6541dd5e54f78f7f251a33196d08111061",
            "filename": "django/contrib/auth/fixtures/custom_user.json",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ffixtures%2Fcustom_user.json",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ffixtures%2Fcustom_user.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ffixtures%2Fcustom_user.json?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -0,0 +1,14 @@\n+[\n+    {\n+        \"pk\": \"1\",\n+        \"model\": \"auth.customuser\",\n+        \"fields\": {\n+            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\",\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"email\": \"staffmember@example.com\",\n+            \"is_active\": true,\n+            \"is_admin\": false,\n+            \"date_of_birth\": \"1976-11-08\"\n+       }\n+    }\n+]\n\\ No newline at end of file"
        },
        {
            "sha": "a430f042e9fd9b4a013704a586588ea39ea02986",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -7,9 +7,10 @@\n from django.utils.html import format_html, format_html_join\n from django.utils.http import int_to_base36\n from django.utils.safestring import mark_safe\n+from django.utils.text import capfirst\n from django.utils.translation import ugettext, ugettext_lazy as _\n \n-from django.contrib.auth import authenticate\n+from django.contrib.auth import authenticate, get_user_model\n from django.contrib.auth.models import User\n from django.contrib.auth.hashers import UNUSABLE_PASSWORD, identify_hasher\n from django.contrib.auth.tokens import default_token_generator\n@@ -135,7 +136,7 @@ class AuthenticationForm(forms.Form):\n     Base class for authenticating users. Extend this to get a form that accepts\n     username/password logins.\n     \"\"\"\n-    username = forms.CharField(label=_(\"Username\"), max_length=30)\n+    username = forms.CharField(max_length=30)\n     password = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n \n     error_messages = {\n@@ -157,6 +158,11 @@ def __init__(self, request=None, *args, **kwargs):\n         self.user_cache = None\n         super(AuthenticationForm, self).__init__(*args, **kwargs)\n \n+        # Set the label for the \"username\" field.\n+        UserModel = get_user_model()\n+        username_field = UserModel._meta.get_field(getattr(UserModel, 'USERNAME_FIELD', 'username'))\n+        self.fields['username'].label = capfirst(username_field.verbose_name)\n+\n     def clean(self):\n         username = self.cleaned_data.get('username')\n         password = self.cleaned_data.get('password')\n@@ -198,9 +204,10 @@ def clean_email(self):\n         \"\"\"\n         Validates that an active user exists with the given email address.\n         \"\"\"\n+        UserModel = get_user_model()\n         email = self.cleaned_data[\"email\"]\n-        self.users_cache = User.objects.filter(email__iexact=email,\n-                                               is_active=True)\n+        self.users_cache = UserModel.objects.filter(email__iexact=email,\n+                                                    is_active=True)\n         if not len(self.users_cache):\n             raise forms.ValidationError(self.error_messages['unknown'])\n         if any((user.password == UNUSABLE_PASSWORD)"
        },
        {
            "sha": "2ada789caedd70a7d861fd80fb1828cc8a69170d",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 21,
            "deletions": 11,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -6,9 +6,10 @@\n import getpass\n import locale\n import unicodedata\n-from django.contrib.auth import models as auth_app\n+\n+from django.contrib.auth import models as auth_app, get_user_model\n+from django.core import exceptions\n from django.db.models import get_models, signals\n-from django.contrib.auth.models import User\n from django.utils import six\n from django.utils.six.moves import input\n \n@@ -64,7 +65,9 @@ def create_permissions(app, created_models, verbosity, **kwargs):\n def create_superuser(app, created_models, verbosity, db, **kwargs):\n     from django.core.management import call_command\n \n-    if auth_app.User in created_models and kwargs.get('interactive', True):\n+    UserModel = get_user_model()\n+\n+    if UserModel in created_models and kwargs.get('interactive', True):\n         msg = (\"\\nYou just installed Django's auth system, which means you \"\n             \"don't have any superusers defined.\\nWould you like to create one \"\n             \"now? (yes/no): \")\n@@ -113,28 +116,35 @@ def get_default_username(check_db=True):\n     :returns: The username, or an empty string if no username can be\n         determined.\n     \"\"\"\n-    from django.contrib.auth.management.commands.createsuperuser import (\n-        RE_VALID_USERNAME)\n+    # If the User model has been swapped out, we can't make any assumptions\n+    # about the default user name.\n+    if auth_app.User._meta.swapped:\n+        return ''\n+\n     default_username = get_system_username()\n     try:\n         default_username = unicodedata.normalize('NFKD', default_username)\\\n             .encode('ascii', 'ignore').decode('ascii').replace(' ', '').lower()\n     except UnicodeDecodeError:\n         return ''\n-    if not RE_VALID_USERNAME.match(default_username):\n+\n+    # Run the username validator\n+    try:\n+        auth_app.User._meta.get_field('username').run_validators(default_username)\n+    except exceptions.ValidationError:\n         return ''\n+\n     # Don't return the default username if it is already taken.\n     if check_db and default_username:\n         try:\n-            User.objects.get(username=default_username)\n-        except User.DoesNotExist:\n+            auth_app.User.objects.get(username=default_username)\n+        except auth_app.User.DoesNotExist:\n             pass\n         else:\n             return ''\n     return default_username\n \n-\n signals.post_syncdb.connect(create_permissions,\n-    dispatch_uid = \"django.contrib.auth.management.create_permissions\")\n+    dispatch_uid=\"django.contrib.auth.management.create_permissions\")\n signals.post_syncdb.connect(create_superuser,\n-    sender=auth_app, dispatch_uid = \"django.contrib.auth.management.create_superuser\")\n+    sender=auth_app, dispatch_uid=\"django.contrib.auth.management.create_superuser\")"
        },
        {
            "sha": "1a2387442cdea8564f0e26374a71923327edba74",
            "filename": "django/contrib/auth/management/commands/changepassword.py",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fchangepassword.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fchangepassword.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fchangepassword.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,8 +1,8 @@\n import getpass\n from optparse import make_option\n \n+from django.contrib.auth import get_user_model\n from django.core.management.base import BaseCommand, CommandError\n-from django.contrib.auth.models import User\n from django.db import DEFAULT_DB_ALIAS\n \n \n@@ -30,12 +30,16 @@ def handle(self, *args, **options):\n         else:\n             username = getpass.getuser()\n \n+        UserModel = get_user_model()\n+\n         try:\n-            u = User.objects.using(options.get('database')).get(username=username)\n-        except User.DoesNotExist:\n+            u = UserModel.objects.using(options.get('database')).get(**{\n+                    getattr(UserModel, 'USERNAME_FIELD', 'username'): username\n+                })\n+        except UserModel.DoesNotExist:\n             raise CommandError(\"user '%s' does not exist\" % username)\n \n-        self.stdout.write(\"Changing password for user '%s'\\n\" % u.username)\n+        self.stdout.write(\"Changing password for user '%s'\\n\" % u)\n \n         MAX_TRIES = 3\n         count = 0\n@@ -48,9 +52,9 @@ def handle(self, *args, **options):\n                 count = count + 1\n \n         if count == MAX_TRIES:\n-            raise CommandError(\"Aborting password change for user '%s' after %s attempts\" % (username, count))\n+            raise CommandError(\"Aborting password change for user '%s' after %s attempts\" % (u, count))\n \n         u.set_password(p1)\n         u.save()\n \n-        return \"Password changed successfully for user '%s'\" % u.username\n+        return \"Password changed successfully for user '%s'\" % u"
        },
        {
            "sha": "c5f6469548a020e8103e4e08e7d678de1386200d",
            "filename": "django/contrib/auth/management/commands/createsuperuser.py",
            "status": "modified",
            "additions": 63,
            "deletions": 59,
            "changes": 122,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -3,109 +3,114 @@\n \"\"\"\n \n import getpass\n-import re\n import sys\n from optparse import make_option\n \n-from django.contrib.auth.models import User\n+from django.contrib.auth import get_user_model\n from django.contrib.auth.management import get_default_username\n from django.core import exceptions\n from django.core.management.base import BaseCommand, CommandError\n from django.db import DEFAULT_DB_ALIAS\n from django.utils.six.moves import input\n-from django.utils.translation import ugettext as _\n-\n-RE_VALID_USERNAME = re.compile('[\\w.@+-]+$')\n-\n-EMAIL_RE = re.compile(\n-    r\"(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*\"  # dot-atom\n-    r'|^\"([\\001-\\010\\013\\014\\016-\\037!#-\\[\\]-\\177]|\\\\[\\001-\\011\\013\\014\\016-\\177])*\"' # quoted-string\n-    r')@(?:[A-Z0-9-]+\\.)+[A-Z]{2,6}$', re.IGNORECASE)  # domain\n-\n-\n-def is_valid_email(value):\n-    if not EMAIL_RE.search(value):\n-        raise exceptions.ValidationError(_('Enter a valid e-mail address.'))\n+from django.utils.text import capfirst\n \n \n class Command(BaseCommand):\n     option_list = BaseCommand.option_list + (\n         make_option('--username', dest='username', default=None,\n             help='Specifies the username for the superuser.'),\n-        make_option('--email', dest='email', default=None,\n-            help='Specifies the email address for the superuser.'),\n         make_option('--noinput', action='store_false', dest='interactive', default=True,\n             help=('Tells Django to NOT prompt the user for input of any kind. '\n-                  'You must use --username and --email with --noinput, and '\n-                  'superusers created with --noinput will not be able to log '\n-                  'in until they\\'re given a valid password.')),\n+                  'You must use --username with --noinput, along with an option for '\n+                  'any other required field. Superusers created with --noinput will '\n+                  ' not be able to log in until they\\'re given a valid password.')),\n         make_option('--database', action='store', dest='database',\n             default=DEFAULT_DB_ALIAS, help='Specifies the database to use. Default is \"default\".'),\n+    ) + tuple(\n+        make_option('--%s' % field, dest=field, default=None,\n+            help='Specifies the %s for the superuser.' % field)\n+        for field in get_user_model().REQUIRED_FIELDS\n     )\n+\n     help = 'Used to create a superuser.'\n \n     def handle(self, *args, **options):\n         username = options.get('username', None)\n-        email = options.get('email', None)\n         interactive = options.get('interactive')\n         verbosity = int(options.get('verbosity', 1))\n         database = options.get('database')\n \n-        # Do quick and dirty validation if --noinput\n-        if not interactive:\n-            if not username or not email:\n-                raise CommandError(\"You must use --username and --email with --noinput.\")\n-            if not RE_VALID_USERNAME.match(username):\n-                raise CommandError(\"Invalid username. Use only letters, digits, and underscores\")\n-            try:\n-                is_valid_email(email)\n-            except exceptions.ValidationError:\n-                raise CommandError(\"Invalid email address.\")\n+        UserModel = get_user_model()\n+\n+        username_field = UserModel._meta.get_field(getattr(UserModel, 'USERNAME_FIELD', 'username'))\n+        other_fields = UserModel.REQUIRED_FIELDS\n \n         # If not provided, create the user with an unusable password\n         password = None\n+        other_data = {}\n \n-        # Prompt for username/email/password. Enclose this whole thing in a\n-        # try/except to trap for a keyboard interrupt and exit gracefully.\n-        if interactive:\n+        # Do quick and dirty validation if --noinput\n+        if not interactive:\n+            try:\n+                if not username:\n+                    raise CommandError(\"You must use --username with --noinput.\")\n+                username = username_field.clean(username, None)\n+\n+                for field_name in other_fields:\n+                    if options.get(field_name):\n+                        field = UserModel._meta.get_field(field_name)\n+                        other_data[field_name] = field.clean(options[field_name], None)\n+                    else:\n+                        raise CommandError(\"You must use --%s with --noinput.\" % field_name)\n+            except exceptions.ValidationError as e:\n+                raise CommandError('; '.join(e.messages))\n+\n+        else:\n+            # Prompt for username/password, and any other required fields.\n+            # Enclose this whole thing in a try/except to trap for a\n+            # keyboard interrupt and exit gracefully.\n             default_username = get_default_username()\n             try:\n \n                 # Get a username\n-                while 1:\n+                while username is None:\n+                    username_field = UserModel._meta.get_field(getattr(UserModel, 'USERNAME_FIELD', 'username'))\n                     if not username:\n-                        input_msg = 'Username'\n+                        input_msg = capfirst(username_field.verbose_name)\n                         if default_username:\n                             input_msg += ' (leave blank to use %r)' % default_username\n-                        username = input(input_msg + ': ')\n-                    if default_username and username == '':\n+                        raw_value = input(input_msg + ': ')\n+                    if default_username and raw_value == '':\n                         username = default_username\n-                    if not RE_VALID_USERNAME.match(username):\n-                        self.stderr.write(\"Error: That username is invalid. Use only letters, digits and underscores.\")\n+                    try:\n+                        username = username_field.clean(raw_value, None)\n+                    except exceptions.ValidationError as e:\n+                        self.stderr.write(\"Error: %s\" % '; '.join(e.messages))\n                         username = None\n                         continue\n                     try:\n-                        User.objects.using(database).get(username=username)\n-                    except User.DoesNotExist:\n-                        break\n+                        UserModel.objects.using(database).get(**{\n+                                getattr(UserModel, 'USERNAME_FIELD', 'username'): username\n+                            })\n+                    except UserModel.DoesNotExist:\n+                        pass\n                     else:\n                         self.stderr.write(\"Error: That username is already taken.\")\n                         username = None\n \n-                # Get an email\n-                while 1:\n-                    if not email:\n-                        email = input('E-mail address: ')\n-                    try:\n-                        is_valid_email(email)\n-                    except exceptions.ValidationError:\n-                        self.stderr.write(\"Error: That e-mail address is invalid.\")\n-                        email = None\n-                    else:\n-                        break\n+                for field_name in other_fields:\n+                    field = UserModel._meta.get_field(field_name)\n+                    other_data[field_name] = options.get(field_name)\n+                    while other_data[field_name] is None:\n+                        raw_value = input(capfirst(field.verbose_name + ': '))\n+                        try:\n+                            other_data[field_name] = field.clean(raw_value, None)\n+                        except exceptions.ValidationError as e:\n+                            self.stderr.write(\"Error: %s\" % '; '.join(e.messages))\n+                            other_data[field_name] = None\n \n                 # Get a password\n-                while 1:\n+                while password is None:\n                     if not password:\n                         password = getpass.getpass()\n                         password2 = getpass.getpass('Password (again): ')\n@@ -117,12 +122,11 @@ def handle(self, *args, **options):\n                         self.stderr.write(\"Error: Blank passwords aren't allowed.\")\n                         password = None\n                         continue\n-                    break\n+\n             except KeyboardInterrupt:\n                 self.stderr.write(\"\\nOperation cancelled.\")\n                 sys.exit(1)\n \n-        User.objects.db_manager(database).create_superuser(username, email, password)\n+        UserModel.objects.db_manager(database).create_superuser(username=username, password=password, **other_data)\n         if verbosity >= 1:\n-          self.stdout.write(\"Superuser created successfully.\")\n-\n+            self.stdout.write(\"Superuser created successfully.\")"
        },
        {
            "sha": "abcc7ceafc24ad836c1c1bfffad4a37936166497",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 107,
            "deletions": 66,
            "changes": 173,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,7 +1,10 @@\n from __future__ import unicode_literals\n+import re\n+import warnings\n \n from django.core.exceptions import ImproperlyConfigured\n from django.core.mail import send_mail\n+from django.core import validators\n from django.db import models\n from django.db.models.manager import EmptyManager\n from django.utils.crypto import get_random_string\n@@ -96,6 +99,7 @@ class GroupManager(models.Manager):\n     def get_by_natural_key(self, name):\n         return self.get(name=name)\n \n+\n @python_2_unicode_compatible\n class Group(models.Model):\n     \"\"\"\n@@ -131,7 +135,7 @@ def natural_key(self):\n         return (self.name,)\n \n \n-class UserManager(models.Manager):\n+class BaseUserManager(models.Manager):\n \n     @classmethod\n     def normalize_email(cls, email):\n@@ -148,7 +152,25 @@ def normalize_email(cls, email):\n             email = '@'.join([email_name, domain_part.lower()])\n         return email\n \n-    def create_user(self, username, email=None, password=None):\n+    def make_random_password(self, length=10,\n+                             allowed_chars='abcdefghjkmnpqrstuvwxyz'\n+                                           'ABCDEFGHJKLMNPQRSTUVWXYZ'\n+                                           '23456789'):\n+        \"\"\"\n+        Generates a random password with the given length and given\n+        allowed_chars. Note that the default value of allowed_chars does not\n+        have \"I\" or \"O\" or letters and digits that look similar -- just to\n+        avoid confusion.\n+        \"\"\"\n+        return get_random_string(length, allowed_chars)\n+\n+    def get_by_natural_key(self, username):\n+        return self.get(**{getattr(self.model, 'USERNAME_FIELD', 'username'): username})\n+\n+\n+class UserManager(BaseUserManager):\n+\n+    def create_user(self, username, email=None, password=None, **extra_fields):\n         \"\"\"\n         Creates and saves a User with the given username, email and password.\n         \"\"\"\n@@ -158,35 +180,20 @@ def create_user(self, username, email=None, password=None):\n         email = UserManager.normalize_email(email)\n         user = self.model(username=username, email=email,\n                           is_staff=False, is_active=True, is_superuser=False,\n-                          last_login=now, date_joined=now)\n+                          last_login=now, date_joined=now, **extra_fields)\n \n         user.set_password(password)\n         user.save(using=self._db)\n         return user\n \n-    def create_superuser(self, username, email, password):\n-        u = self.create_user(username, email, password)\n+    def create_superuser(self, username, email, password, **extra_fields):\n+        u = self.create_user(username, email, password, **extra_fields)\n         u.is_staff = True\n         u.is_active = True\n         u.is_superuser = True\n         u.save(using=self._db)\n         return u\n \n-    def make_random_password(self, length=10,\n-                             allowed_chars='abcdefghjkmnpqrstuvwxyz'\n-                                           'ABCDEFGHJKLMNPQRSTUVWXYZ'\n-                                           '23456789'):\n-        \"\"\"\n-        Generates a random password with the given length and given\n-        allowed_chars. Note that the default value of allowed_chars does not\n-        have \"I\" or \"O\" or letters and digits that look similar -- just to\n-        avoid confusion.\n-        \"\"\"\n-        return get_random_string(length, allowed_chars)\n-\n-    def get_by_natural_key(self, username):\n-        return self.get(username=username)\n-\n \n # A few helper functions for common logic between User and AnonymousUser.\n def _user_get_all_permissions(user, obj):\n@@ -201,8 +208,6 @@ def _user_get_all_permissions(user, obj):\n \n \n def _user_has_perm(user, perm, obj):\n-    anon = user.is_anonymous()\n-    active = user.is_active\n     for backend in auth.get_backends():\n         if hasattr(backend, \"has_perm\"):\n             if obj is not None:\n@@ -215,30 +220,80 @@ def _user_has_perm(user, perm, obj):\n \n \n def _user_has_module_perms(user, app_label):\n-    anon = user.is_anonymous()\n-    active = user.is_active\n     for backend in auth.get_backends():\n         if hasattr(backend, \"has_module_perms\"):\n             if backend.has_module_perms(user, app_label):\n                 return True\n     return False\n \n \n+class AbstractBaseUser(models.Model):\n+    password = models.CharField(_('password'), max_length=128)\n+    last_login = models.DateTimeField(_('last login'), default=timezone.now)\n+\n+    REQUIRED_FIELDS = []\n+\n+    class Meta:\n+        abstract = True\n+\n+    def is_anonymous(self):\n+        \"\"\"\n+        Always returns False. This is a way of comparing User objects to\n+        anonymous users.\n+        \"\"\"\n+        return False\n+\n+    def is_authenticated(self):\n+        \"\"\"\n+        Always return True. This is a way to tell if the user has been\n+        authenticated in templates.\n+        \"\"\"\n+        return True\n+\n+    def set_password(self, raw_password):\n+        self.password = make_password(raw_password)\n+\n+    def check_password(self, raw_password):\n+        \"\"\"\n+        Returns a boolean of whether the raw_password was correct. Handles\n+        hashing formats behind the scenes.\n+        \"\"\"\n+        def setter(raw_password):\n+            self.set_password(raw_password)\n+            self.save(update_fields=[\"password\"])\n+        return check_password(raw_password, self.password, setter)\n+\n+    def set_unusable_password(self):\n+        # Sets a value that will never be a valid hash\n+        self.password = make_password(None)\n+\n+    def has_usable_password(self):\n+        return is_password_usable(self.password)\n+\n+    def get_full_name(self):\n+        raise NotImplementedError()\n+\n+    def get_short_name(self):\n+        raise NotImplementedError()\n+\n+\n @python_2_unicode_compatible\n-class User(models.Model):\n+class AbstractUser(AbstractBaseUser):\n     \"\"\"\n-    Users within the Django authentication system are represented by this\n-    model.\n+    An abstract base class implementing a fully featured User model with\n+    admin-compliant permissions.\n \n-    Username and password are required. Other fields are optional.\n+    Username, password and email are required. Other fields are optional.\n     \"\"\"\n     username = models.CharField(_('username'), max_length=30, unique=True,\n         help_text=_('Required. 30 characters or fewer. Letters, numbers and '\n-                    '@/./+/-/_ characters'))\n+                    '@/./+/-/_ characters'),\n+        validators=[\n+            validators.RegexValidator(re.compile('^[\\w.@+-]+$'), _('Enter a valid username.'), 'invalid')\n+        ])\n     first_name = models.CharField(_('first name'), max_length=30, blank=True)\n     last_name = models.CharField(_('last name'), max_length=30, blank=True)\n-    email = models.EmailField(_('e-mail address'), blank=True)\n-    password = models.CharField(_('password'), max_length=128)\n+    email = models.EmailField(_('email address'), blank=True)\n     is_staff = models.BooleanField(_('staff status'), default=False,\n         help_text=_('Designates whether the user can log into this admin '\n                     'site.'))\n@@ -248,7 +303,6 @@ class User(models.Model):\n     is_superuser = models.BooleanField(_('superuser status'), default=False,\n         help_text=_('Designates that this user has all permissions without '\n                     'explicitly assigning them.'))\n-    last_login = models.DateTimeField(_('last login'), default=timezone.now)\n     date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n     groups = models.ManyToManyField(Group, verbose_name=_('groups'),\n         blank=True, help_text=_('The groups this user belongs to. A user will '\n@@ -257,11 +311,15 @@ class User(models.Model):\n     user_permissions = models.ManyToManyField(Permission,\n         verbose_name=_('user permissions'), blank=True,\n         help_text='Specific permissions for this user.')\n+\n     objects = UserManager()\n \n+    REQUIRED_FIELDS = ['email']\n+\n     class Meta:\n         verbose_name = _('user')\n         verbose_name_plural = _('users')\n+        abstract = True\n \n     def __str__(self):\n         return self.username\n@@ -272,46 +330,16 @@ def natural_key(self):\n     def get_absolute_url(self):\n         return \"/users/%s/\" % urlquote(self.username)\n \n-    def is_anonymous(self):\n-        \"\"\"\n-        Always returns False. This is a way of comparing User objects to\n-        anonymous users.\n-        \"\"\"\n-        return False\n-\n-    def is_authenticated(self):\n-        \"\"\"\n-        Always return True. This is a way to tell if the user has been\n-        authenticated in templates.\n-        \"\"\"\n-        return True\n-\n     def get_full_name(self):\n         \"\"\"\n         Returns the first_name plus the last_name, with a space in between.\n         \"\"\"\n         full_name = '%s %s' % (self.first_name, self.last_name)\n         return full_name.strip()\n \n-    def set_password(self, raw_password):\n-        self.password = make_password(raw_password)\n-\n-    def check_password(self, raw_password):\n-        \"\"\"\n-        Returns a boolean of whether the raw_password was correct. Handles\n-        hashing formats behind the scenes.\n-        \"\"\"\n-        def setter(raw_password):\n-            self.set_password(raw_password)\n-            self.save(update_fields=[\"password\"])\n-        return check_password(raw_password, self.password, setter)\n-\n-    def set_unusable_password(self):\n-        # Sets a value that will never be a valid hash\n-        self.password = make_password(None)\n-\n-    def has_usable_password(self):\n-        return is_password_usable(self.password)\n+    def get_short_name(self):\n+        \"Returns the short name for the user.\"\n+        return self.first_name\n \n     def get_group_permissions(self, obj=None):\n         \"\"\"\n@@ -381,6 +409,8 @@ def get_profile(self):\n         Returns site-specific profile for this user. Raises\n         SiteProfileNotAvailable if this site does not allow profiles.\n         \"\"\"\n+        warnings.warn(\"The use of AUTH_PROFILE_MODULE to define user profiles has been deprecated.\",\n+            PendingDeprecationWarning)\n         if not hasattr(self, '_profile_cache'):\n             from django.conf import settings\n             if not getattr(settings, 'AUTH_PROFILE_MODULE', False):\n@@ -407,6 +437,17 @@ def get_profile(self):\n         return self._profile_cache\n \n \n+class User(AbstractUser):\n+    \"\"\"\n+    Users within the Django authentication system are represented by this\n+    model.\n+\n+    Username, password and email are required. Other fields are optional.\n+    \"\"\"\n+    class Meta:\n+        swappable = 'AUTH_USER_MODEL'\n+\n+\n @python_2_unicode_compatible\n class AnonymousUser(object):\n     id = None\n@@ -431,7 +472,7 @@ def __ne__(self, other):\n         return not self.__eq__(other)\n \n     def __hash__(self):\n-        return 1 # instances always return the same hash value\n+        return 1  # instances always return the same hash value\n \n     def save(self):\n         raise NotImplementedError"
        },
        {
            "sha": "094a59523888c11e5927472a3191f15f711032ae",
            "filename": "django/contrib/auth/tests/__init__.py",
            "status": "modified",
            "additions": 13,
            "deletions": 24,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,26 +1,15 @@\n-from django.contrib.auth.tests.auth_backends import (BackendTest,\n-    RowlevelBackendTest, AnonymousUserBackendTest, NoBackendsTest,\n-    InActiveUserBackendTest)\n-from django.contrib.auth.tests.basic import BasicTestCase\n-from django.contrib.auth.tests.context_processors import AuthContextProcessorTests\n-from django.contrib.auth.tests.decorators import LoginRequiredTestCase\n-from django.contrib.auth.tests.forms import (UserCreationFormTest,\n-    AuthenticationFormTest, SetPasswordFormTest, PasswordChangeFormTest,\n-    UserChangeFormTest, PasswordResetFormTest)\n-from django.contrib.auth.tests.remote_user import (RemoteUserTest,\n-    RemoteUserNoCreateTest, RemoteUserCustomTest)\n-from django.contrib.auth.tests.management import (\n-    GetDefaultUsernameTestCase,\n-    ChangepasswordManagementCommandTestCase,\n-)\n-from django.contrib.auth.tests.models import (ProfileTestCase, NaturalKeysTestCase,\n-    LoadDataWithoutNaturalKeysTestCase, LoadDataWithNaturalKeysTestCase,\n-    UserManagerTestCase)\n-from django.contrib.auth.tests.hashers import TestUtilsHashPass\n-from django.contrib.auth.tests.signals import SignalTestCase\n-from django.contrib.auth.tests.tokens import TokenGeneratorTest\n-from django.contrib.auth.tests.views import (AuthViewNamedURLTests,\n-    PasswordResetTest, ChangePasswordTest, LoginTest, LogoutTest,\n-    LoginURLSettings)\n+from django.contrib.auth.tests.custom_user import *\n+from django.contrib.auth.tests.auth_backends import *\n+from django.contrib.auth.tests.basic import *\n+from django.contrib.auth.tests.context_processors import *\n+from django.contrib.auth.tests.decorators import *\n+from django.contrib.auth.tests.forms import *\n+from django.contrib.auth.tests.remote_user import *\n+from django.contrib.auth.tests.management import *\n+from django.contrib.auth.tests.models import *\n+from django.contrib.auth.tests.hashers import *\n+from django.contrib.auth.tests.signals import *\n+from django.contrib.auth.tests.tokens import *\n+from django.contrib.auth.tests.views import *\n \n # The password for the fixture data users is 'password'"
        },
        {
            "sha": "a6be98541210b6c91b2aa909ea42cbd482191a3a",
            "filename": "django/contrib/auth/tests/auth_backends.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -2,12 +2,14 @@\n \n from django.conf import settings\n from django.contrib.auth.models import User, Group, Permission, AnonymousUser\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.contrib.contenttypes.models import ContentType\n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase\n from django.test.utils import override_settings\n \n \n+@skipIfCustomUser\n class BackendTest(TestCase):\n \n     backend = 'django.contrib.auth.backends.ModelBackend'\n@@ -151,6 +153,7 @@ def get_group_permissions(self, user, obj=None):\n             return ['none']\n \n \n+@skipIfCustomUser\n class RowlevelBackendTest(TestCase):\n     \"\"\"\n     Tests for auth backend that supports object level permissions\n@@ -223,6 +226,7 @@ def test_get_all_permissions(self):\n         self.assertEqual(self.user1.get_all_permissions(TestObj()), set(['anon']))\n \n \n+@skipIfCustomUser\n @override_settings(AUTHENTICATION_BACKENDS=[])\n class NoBackendsTest(TestCase):\n     \"\"\"\n@@ -235,6 +239,7 @@ def test_raises_exception(self):\n         self.assertRaises(ImproperlyConfigured, self.user.has_perm, ('perm', TestObj(),))\n \n \n+@skipIfCustomUser\n class InActiveUserBackendTest(TestCase):\n     \"\"\"\n     Tests for a inactive user"
        },
        {
            "sha": "ed1d0674fcf722a39cc73e6c95d7c8cd998a661a",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 38,
            "deletions": 7,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,13 +1,18 @@\n import locale\n-import traceback\n \n+from django.contrib.auth import get_user_model\n from django.contrib.auth.management.commands import createsuperuser\n from django.contrib.auth.models import User, AnonymousUser\n+from django.contrib.auth.tests.custom_user import CustomUser\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.core.exceptions import ImproperlyConfigured\n from django.core.management import call_command\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils.six import StringIO\n \n \n+@skipIfCustomUser\n class BasicTestCase(TestCase):\n     def test_user(self):\n         \"Check that users can be created and can set their password\"\n@@ -33,7 +38,7 @@ def test_user(self):\n         self.assertFalse(u.is_superuser)\n \n         # Check API-based user creation with no password\n-        u2 = User.objects.create_user('testuser2', 'test2@example.com')\n+        User.objects.create_user('testuser2', 'test2@example.com')\n         self.assertFalse(u.has_usable_password())\n \n     def test_user_no_email(self):\n@@ -98,7 +103,6 @@ def test_createsuperuser_management_command(self):\n         self.assertEqual(u.email, 'joe2@somewhere.org')\n         self.assertFalse(u.has_usable_password())\n \n-\n         new_io = StringIO()\n         call_command(\"createsuperuser\",\n             interactive=False,\n@@ -124,15 +128,21 @@ def test_createsuperuser_nolocale(self):\n \n             # Temporarily replace getpass to allow interactive code to be used\n             # non-interactively\n-            class mock_getpass: pass\n+            class mock_getpass:\n+                pass\n             mock_getpass.getpass = staticmethod(lambda p=None: \"nopasswd\")\n             createsuperuser.getpass = mock_getpass\n \n             # Call the command in this new environment\n             new_io = StringIO()\n-            call_command(\"createsuperuser\", interactive=True, username=\"nolocale@somewhere.org\", email=\"nolocale@somewhere.org\", stdout=new_io)\n-\n-        except TypeError as e:\n+            call_command(\"createsuperuser\",\n+                interactive=True,\n+                username=\"nolocale@somewhere.org\",\n+                email=\"nolocale@somewhere.org\",\n+                stdout=new_io\n+            )\n+\n+        except TypeError:\n             self.fail(\"createsuperuser fails if the OS provides no information about the current locale\")\n \n         finally:\n@@ -143,3 +153,24 @@ class mock_getpass: pass\n         # If we were successful, a user should have been created\n         u = User.objects.get(username=\"nolocale@somewhere.org\")\n         self.assertEqual(u.email, 'nolocale@somewhere.org')\n+\n+    def test_get_user_model(self):\n+        \"The current user model can be retrieved\"\n+        self.assertEqual(get_user_model(), User)\n+\n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_swappable_user(self):\n+        \"The current user model can be swapped out for another\"\n+        self.assertEqual(get_user_model(), CustomUser)\n+\n+    @override_settings(AUTH_USER_MODEL='badsetting')\n+    def test_swappable_user_bad_setting(self):\n+        \"The alternate user setting must point to something in the format app.model\"\n+        with self.assertRaises(ImproperlyConfigured):\n+            get_user_model()\n+\n+    @override_settings(AUTH_USER_MODEL='thismodel.doesntexist')\n+    def test_swappable_user_nonexistent_model(self):\n+        \"The current user model must point to an installed model\"\n+        with self.assertRaises(ImproperlyConfigured):\n+            get_user_model()"
        },
        {
            "sha": "4e914133d0fa201720bbe4a35015414bb62e3190",
            "filename": "django/contrib/auth/tests/context_processors.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -2,12 +2,13 @@\n \n from django.conf import global_settings\n from django.contrib.auth import authenticate\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.db.models import Q\n-from django.template import context\n from django.test import TestCase\n from django.test.utils import override_settings\n \n \n+@skipIfCustomUser\n @override_settings(\n     TEMPLATE_DIRS=(\n             os.path.join(os.path.dirname(__file__), 'templates'),"
        },
        {
            "sha": "3e7fa097b57851d53bca8f13c7384f47c7a1ecc4",
            "filename": "django/contrib/auth/tests/custom_user.py",
            "status": "added",
            "additions": 75,
            "deletions": 0,
            "changes": 75,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -0,0 +1,75 @@\n+# The custom User uses email as the unique identifier, and requires\n+# that every user provide a date of birth. This lets us test\n+# changes in username datatype, and non-text required fields.\n+\n+from django.db import models\n+from django.contrib.auth.models import BaseUserManager, AbstractBaseUser\n+\n+\n+class CustomUserManager(BaseUserManager):\n+    def create_user(self, email, date_of_birth, password=None):\n+        \"\"\"\n+        Creates and saves a User with the given email and password.\n+        \"\"\"\n+        if not email:\n+            raise ValueError('Users must have an email address')\n+\n+        user = self.model(\n+            email=CustomUserManager.normalize_email(email),\n+            date_of_birth=date_of_birth,\n+        )\n+\n+        user.set_password(password)\n+        user.save(using=self._db)\n+        return user\n+\n+    def create_superuser(self, username, password, date_of_birth):\n+        u = self.create_user(username, password=password, date_of_birth=date_of_birth)\n+        u.is_admin = True\n+        u.save(using=self._db)\n+        return u\n+\n+\n+class CustomUser(AbstractBaseUser):\n+    email = models.EmailField(verbose_name='email address', max_length=255, unique=True)\n+    is_active = models.BooleanField(default=True)\n+    is_admin = models.BooleanField(default=False)\n+    date_of_birth = models.DateField()\n+\n+    objects = CustomUserManager()\n+\n+    USERNAME_FIELD = 'email'\n+    REQUIRED_FIELDS = ['date_of_birth']\n+\n+    class Meta:\n+        app_label = 'auth'\n+\n+    def get_full_name(self):\n+        return self.email\n+\n+    def get_short_name(self):\n+        return self.email\n+\n+    def __unicode__(self):\n+        return self.email\n+\n+    # Maybe required?\n+    def get_group_permissions(self, obj=None):\n+        return set()\n+\n+    def get_all_permissions(self, obj=None):\n+        return set()\n+\n+    def has_perm(self, perm, obj=None):\n+        return True\n+\n+    def has_perms(self, perm_list, obj=None):\n+        return True\n+\n+    def has_module_perms(self, app_label):\n+        return True\n+\n+    # Admin required fields\n+    @property\n+    def is_staff(self):\n+        return self.is_admin"
        },
        {
            "sha": "be99e7abb6cd6277a65c15e1d22556ffb62670ac",
            "filename": "django/contrib/auth/tests/decorators.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fdecorators.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,7 +1,9 @@\n-from django.conf import settings\n from django.contrib.auth.decorators import login_required\n from django.contrib.auth.tests.views import AuthViewsTestCase\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n \n+\n+@skipIfCustomUser\n class LoginRequiredTestCase(AuthViewsTestCase):\n     \"\"\"\n     Tests the login_required decorators"
        },
        {
            "sha": "7c6410da0f712038706589b825702e8a68f0a096",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -4,16 +4,17 @@\n from django.contrib.auth.models import User\n from django.contrib.auth.forms import (UserCreationForm, AuthenticationForm,\n     PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm)\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.core import mail\n from django.forms.fields import Field, EmailField\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils.encoding import force_text\n-from django.utils import six\n from django.utils import translation\n from django.utils.translation import ugettext as _\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class UserCreationFormTest(TestCase):\n \n@@ -81,6 +82,7 @@ def test_success(self):\n         self.assertEqual(repr(u), '<User: jsmith@example.com>')\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AuthenticationFormTest(TestCase):\n \n@@ -133,6 +135,7 @@ def test_success(self):\n         self.assertEqual(form.non_field_errors(), [])\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class SetPasswordFormTest(TestCase):\n \n@@ -160,6 +163,7 @@ def test_success(self):\n         self.assertTrue(form.is_valid())\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class PasswordChangeFormTest(TestCase):\n \n@@ -208,6 +212,7 @@ def test_field_order(self):\n                          ['old_password', 'new_password1', 'new_password2'])\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class UserChangeFormTest(TestCase):\n \n@@ -261,6 +266,7 @@ def test_bug_17944_unknown_password_algorithm(self):\n             form.as_table())\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class PasswordResetFormTest(TestCase):\n "
        },
        {
            "sha": "60c05a02551fc6c89056000ffb6d76493b1dda10",
            "filename": "django/contrib/auth/tests/management.py",
            "status": "modified",
            "additions": 99,
            "deletions": 1,
            "changes": 100,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,13 +1,20 @@\n from __future__ import unicode_literals\n+from datetime import date\n \n from django.contrib.auth import models, management\n from django.contrib.auth.management.commands import changepassword\n+from django.contrib.auth.models import User\n+from django.contrib.auth.tests import CustomUser\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.core.management import call_command\n from django.core.management.base import CommandError\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils import six\n from django.utils.six import StringIO\n \n \n+@skipIfCustomUser\n class GetDefaultUsernameTestCase(TestCase):\n \n     def setUp(self):\n@@ -36,6 +43,7 @@ def test_i18n(self):\n         self.assertEqual(management.get_default_username(), 'julia')\n \n \n+@skipIfCustomUser\n class ChangepasswordManagementCommandTestCase(TestCase):\n \n     def setUp(self):\n@@ -48,7 +56,7 @@ def tearDown(self):\n         self.stderr.close()\n \n     def test_that_changepassword_command_changes_joes_password(self):\n-        \" Executing the changepassword management command should change joe's password \"\n+        \"Executing the changepassword management command should change joe's password\"\n         self.assertTrue(self.user.check_password('qwerty'))\n         command = changepassword.Command()\n         command._get_pass = lambda *args: 'not qwerty'\n@@ -69,3 +77,93 @@ def test_that_max_tries_exits_1(self):\n \n         with self.assertRaises(CommandError):\n             command.execute(\"joe\", stdout=self.stdout, stderr=self.stderr)\n+\n+\n+@skipIfCustomUser\n+class CreatesuperuserManagementCommandTestCase(TestCase):\n+\n+    def test_createsuperuser(self):\n+        \"Check the operation of the createsuperuser management command\"\n+        # We can use the management command to create a superuser\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe\",\n+            email=\"joe@somewhere.org\",\n+            stdout=new_io\n+        )\n+        command_output = new_io.getvalue().strip()\n+        self.assertEqual(command_output, 'Superuser created successfully.')\n+        u = User.objects.get(username=\"joe\")\n+        self.assertEqual(u.email, 'joe@somewhere.org')\n+\n+        # created password should be unusable\n+        self.assertFalse(u.has_usable_password())\n+\n+    def test_verbosity_zero(self):\n+        # We can supress output on the management command\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe2\",\n+            email=\"joe2@somewhere.org\",\n+            verbosity=0,\n+            stdout=new_io\n+        )\n+        command_output = new_io.getvalue().strip()\n+        self.assertEqual(command_output, '')\n+        u = User.objects.get(username=\"joe2\")\n+        self.assertEqual(u.email, 'joe2@somewhere.org')\n+        self.assertFalse(u.has_usable_password())\n+\n+    def test_email_in_username(self):\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe+admin@somewhere.org\",\n+            email=\"joe@somewhere.org\",\n+            stdout=new_io\n+        )\n+        u = User.objects.get(username=\"joe+admin@somewhere.org\")\n+        self.assertEqual(u.email, 'joe@somewhere.org')\n+        self.assertFalse(u.has_usable_password())\n+\n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_swappable_user(self):\n+        \"A superuser can be created when a custom User model is in use\"\n+        # We can use the management command to create a superuser\n+        # We skip validation because the temporary substitution of the\n+        # swappable User model messes with validation.\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe@somewhere.org\",\n+            date_of_birth=\"1976-04-01\",\n+            stdout=new_io,\n+            skip_validation=True\n+        )\n+        command_output = new_io.getvalue().strip()\n+        self.assertEqual(command_output, 'Superuser created successfully.')\n+        u = CustomUser.objects.get(email=\"joe@somewhere.org\")\n+        self.assertEqual(u.date_of_birth, date(1976, 4, 1))\n+\n+        # created password should be unusable\n+        self.assertFalse(u.has_usable_password())\n+\n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_swappable_user_missing_required_field(self):\n+        \"A superuser can be created when a custom User model is in use\"\n+        # We can use the management command to create a superuser\n+        # We skip validation because the temporary substitution of the\n+        # swappable User model messes with validation.\n+        new_io = StringIO()\n+        with self.assertRaises(CommandError):\n+            call_command(\"createsuperuser\",\n+                interactive=False,\n+                username=\"joe@somewhere.org\",\n+                stdout=new_io,\n+                stderr=new_io,\n+                skip_validation=True\n+            )\n+\n+        self.assertEqual(CustomUser.objects.count(), 0)"
        },
        {
            "sha": "252a0887c884f989cfd24a644305c5882edea511",
            "filename": "django/contrib/auth/tests/models.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,11 +1,13 @@\n from django.conf import settings\n from django.contrib.auth.models import (Group, User, SiteProfileNotAvailable,\n     UserManager)\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils import six\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, AUTH_PROFILE_MODULE='')\n class ProfileTestCase(TestCase):\n \n@@ -31,6 +33,7 @@ def test_site_profile_not_available(self):\n             user.get_profile()\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False)\n class NaturalKeysTestCase(TestCase):\n     fixtures = ['authtestdata.json']\n@@ -45,6 +48,7 @@ def test_group_natural_key(self):\n         self.assertEqual(Group.objects.get_by_natural_key('users'), users_group)\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False)\n class LoadDataWithoutNaturalKeysTestCase(TestCase):\n     fixtures = ['regular.json']\n@@ -55,6 +59,7 @@ def test_user_is_created_and_added_to_group(self):\n         self.assertEqual(group, user.groups.get())\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False)\n class LoadDataWithNaturalKeysTestCase(TestCase):\n     fixtures = ['natural.json']\n@@ -65,6 +70,7 @@ def test_user_is_created_and_added_to_group(self):\n         self.assertEqual(group, user.groups.get())\n \n \n+@skipIfCustomUser\n class UserManagerTestCase(TestCase):\n \n     def test_create_user(self):"
        },
        {
            "sha": "9b0f6f8be3b12489bc4dee5cfac65eb5d1947465",
            "filename": "django/contrib/auth/tests/remote_user.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -3,10 +3,12 @@\n from django.conf import settings\n from django.contrib.auth.backends import RemoteUserBackend\n from django.contrib.auth.models import User\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.utils import timezone\n \n \n+@skipIfCustomUser\n class RemoteUserTest(TestCase):\n \n     urls = 'django.contrib.auth.tests.urls'\n@@ -106,6 +108,7 @@ class RemoteUserNoCreateBackend(RemoteUserBackend):\n     create_unknown_user = False\n \n \n+@skipIfCustomUser\n class RemoteUserNoCreateTest(RemoteUserTest):\n     \"\"\"\n     Contains the same tests as RemoteUserTest, but using a custom auth backend\n@@ -142,6 +145,7 @@ def configure_user(self, user):\n         return user\n \n \n+@skipIfCustomUser\n class RemoteUserCustomTest(RemoteUserTest):\n     \"\"\"\n     Tests a custom RemoteUserBackend subclass that overrides the clean_username"
        },
        {
            "sha": "c597aa9ed00edff933ff4e1a1a233a757789aa07",
            "filename": "django/contrib/auth/tests/signals.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,10 +1,12 @@\n from django.contrib.auth import signals\n from django.contrib.auth.models import User\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.test.client import RequestFactory\n from django.test.utils import override_settings\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class SignalTestCase(TestCase):\n     urls = 'django.contrib.auth.tests.urls'"
        },
        {
            "sha": "e8aeb463263008ff8b2f954f107d4e30984cb8ce",
            "filename": "django/contrib/auth/tests/tokens.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -4,10 +4,12 @@\n from django.conf import settings\n from django.contrib.auth.models import User\n from django.contrib.auth.tokens import PasswordResetTokenGenerator\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.utils import unittest\n \n \n+@skipIfCustomUser\n class TokenGeneratorTest(TestCase):\n \n     def test_make_token(self):"
        },
        {
            "sha": "6bb3d9994f06886b0bc838a58e392dea3a8b5644",
            "filename": "django/contrib/auth/tests/utils.py",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Futils.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -0,0 +1,9 @@\n+from django.conf import settings\n+from django.utils.unittest import skipIf\n+\n+\n+def skipIfCustomUser(test_func):\n+    \"\"\"\n+    Skip a test if a custom user model is in use.\n+    \"\"\"\n+    return skipIf(settings.AUTH_USER_MODEL != 'auth.User', 'Custom user model in use')(test_func)"
        },
        {
            "sha": "5727dc289f777082e57032fd971250c32ef811f9",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -16,6 +16,7 @@\n from django.contrib.auth import SESSION_KEY, REDIRECT_FIELD_NAME\n from django.contrib.auth.forms import (AuthenticationForm, PasswordChangeForm,\n                 SetPasswordForm, PasswordResetForm)\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n \n \n @override_settings(\n@@ -50,6 +51,7 @@ def assertContainsEscaped(self, response, text, **kwargs):\n         return self.assertContains(response, escape(force_text(text)), **kwargs)\n \n \n+@skipIfCustomUser\n class AuthViewNamedURLTests(AuthViewsTestCase):\n     urls = 'django.contrib.auth.urls'\n \n@@ -75,6 +77,7 @@ def test_named_urls(self):\n                 self.fail(\"Reversal of url named '%s' failed with NoReverseMatch\" % name)\n \n \n+@skipIfCustomUser\n class PasswordResetTest(AuthViewsTestCase):\n \n     def test_email_not_found(self):\n@@ -172,6 +175,30 @@ def test_confirm_different_passwords(self):\n         self.assertContainsEscaped(response, SetPasswordForm.error_messages['password_mismatch'])\n \n \n+@override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+class CustomUserPasswordResetTest(AuthViewsTestCase):\n+    fixtures = ['custom_user.json']\n+\n+    def _test_confirm_start(self):\n+        # Start by creating the email\n+        response = self.client.post('/password_reset/', {'email': 'staffmember@example.com'})\n+        self.assertEqual(response.status_code, 302)\n+        self.assertEqual(len(mail.outbox), 1)\n+        return self._read_signup_email(mail.outbox[0])\n+\n+    def _read_signup_email(self, email):\n+        urlmatch = re.search(r\"https?://[^/]*(/.*reset/\\S*)\", email.body)\n+        self.assertTrue(urlmatch is not None, \"No URL found in sent email\")\n+        return urlmatch.group(), urlmatch.groups()[0]\n+\n+    def test_confirm_valid_custom_user(self):\n+        url, path = self._test_confirm_start()\n+        response = self.client.get(path)\n+        # redirect to a 'complete' page:\n+        self.assertContains(response, \"Please enter your new password\")\n+\n+\n+@skipIfCustomUser\n class ChangePasswordTest(AuthViewsTestCase):\n \n     def fail_login(self, password='password'):\n@@ -231,6 +258,7 @@ def test_password_change_done_fails(self):\n             self.assertTrue(response['Location'].endswith('/login/?next=/password_change/done/'))\n \n \n+@skipIfCustomUser\n class LoginTest(AuthViewsTestCase):\n \n     def test_current_site_in_context_after_login(self):\n@@ -289,6 +317,7 @@ def test_security_check(self, password='password'):\n                             \"%s should be allowed\" % good_url)\n \n \n+@skipIfCustomUser\n class LoginURLSettings(AuthViewsTestCase):\n \n     def setUp(self):\n@@ -347,6 +376,7 @@ def test_remote_login_url_with_next_querystring(self):\n                                                     querystring.urlencode('/')))\n \n \n+@skipIfCustomUser\n class LogoutTest(AuthViewsTestCase):\n \n     def confirm_logged_out(self):"
        },
        {
            "sha": "930c70012b60d518c5648984cc74780165784591",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -4,6 +4,7 @@\n from django.utils.crypto import constant_time_compare, salted_hmac\n from django.utils import six\n \n+\n class PasswordResetTokenGenerator(object):\n     \"\"\"\n     Strategy object used to generate and check tokens for the password"
        },
        {
            "sha": "747b5c0991d591246110b70d17b3b2d620fe0e9a",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 14,
            "deletions": 5,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -15,10 +15,9 @@\n from django.views.decorators.csrf import csrf_protect\n \n # Avoid shadowing the login() and logout() views below.\n-from django.contrib.auth import REDIRECT_FIELD_NAME, login as auth_login, logout as auth_logout\n+from django.contrib.auth import REDIRECT_FIELD_NAME, login as auth_login, logout as auth_logout, get_user_model\n from django.contrib.auth.decorators import login_required\n from django.contrib.auth.forms import AuthenticationForm, PasswordResetForm, SetPasswordForm, PasswordChangeForm\n-from django.contrib.auth.models import User\n from django.contrib.auth.tokens import default_token_generator\n from django.contrib.sites.models import get_current_site\n \n@@ -74,6 +73,7 @@ def login(request, template_name='registration/login.html',\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n def logout(request, next_page=None,\n            template_name='registration/logged_out.html',\n            redirect_field_name=REDIRECT_FIELD_NAME,\n@@ -104,6 +104,7 @@ def logout(request, next_page=None,\n         # Redirect to this page until the session has been cleared.\n         return HttpResponseRedirect(next_page or request.path)\n \n+\n def logout_then_login(request, login_url=None, current_app=None, extra_context=None):\n     \"\"\"\n     Logs out the user if he is logged in. Then redirects to the log-in page.\n@@ -113,6 +114,7 @@ def logout_then_login(request, login_url=None, current_app=None, extra_context=N\n     login_url = resolve_url(login_url)\n     return logout(request, login_url, current_app=current_app, extra_context=extra_context)\n \n+\n def redirect_to_login(next, login_url=None,\n                       redirect_field_name=REDIRECT_FIELD_NAME):\n     \"\"\"\n@@ -128,6 +130,7 @@ def redirect_to_login(next, login_url=None,\n \n     return HttpResponseRedirect(urlunparse(login_url_parts))\n \n+\n # 4 views for password reset:\n # - password_reset sends the mail\n # - password_reset_done shows a success message for the above\n@@ -173,6 +176,7 @@ def password_reset(request, is_admin_site=False,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n def password_reset_done(request,\n                         template_name='registration/password_reset_done.html',\n                         current_app=None, extra_context=None):\n@@ -182,6 +186,7 @@ def password_reset_done(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n # Doesn't need csrf_protect since no-one can guess the URL\n @sensitive_post_parameters()\n @never_cache\n@@ -195,13 +200,14 @@ def password_reset_confirm(request, uidb36=None, token=None,\n     View that checks the hash in a password reset link and presents a\n     form for entering a new password.\n     \"\"\"\n-    assert uidb36 is not None and token is not None # checked by URLconf\n+    UserModel = get_user_model()\n+    assert uidb36 is not None and token is not None  # checked by URLconf\n     if post_reset_redirect is None:\n         post_reset_redirect = reverse('django.contrib.auth.views.password_reset_complete')\n     try:\n         uid_int = base36_to_int(uidb36)\n-        user = User.objects.get(id=uid_int)\n-    except (ValueError, OverflowError, User.DoesNotExist):\n+        user = UserModel.objects.get(id=uid_int)\n+    except (ValueError, OverflowError, UserModel.DoesNotExist):\n         user = None\n \n     if user is not None and token_generator.check_token(user, token):\n@@ -225,6 +231,7 @@ def password_reset_confirm(request, uidb36=None, token=None,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n def password_reset_complete(request,\n                             template_name='registration/password_reset_complete.html',\n                             current_app=None, extra_context=None):\n@@ -236,6 +243,7 @@ def password_reset_complete(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n @sensitive_post_parameters()\n @csrf_protect\n @login_required\n@@ -261,6 +269,7 @@ def password_change(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n @login_required\n def password_change_done(request,\n                          template_name='registration/password_change_done.html',"
        },
        {
            "sha": "a39c2622dd708bce6da11a1afe94211ec2b47452",
            "filename": "django/contrib/comments/models.py",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmodels.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,16 +1,16 @@\n-from django.contrib.auth.models import User\n+from django.conf import settings\n from django.contrib.comments.managers import CommentManager\n from django.contrib.contenttypes import generic\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.sites.models import Site\n-from django.db import models\n from django.core import urlresolvers\n+from django.db import models\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n-from django.conf import settings\n from django.utils.encoding import python_2_unicode_compatible\n \n-COMMENT_MAX_LENGTH = getattr(settings,'COMMENT_MAX_LENGTH',3000)\n+COMMENT_MAX_LENGTH = getattr(settings, 'COMMENT_MAX_LENGTH', 3000)\n+\n \n class BaseCommentAbstractModel(models.Model):\n     \"\"\"\n@@ -40,6 +40,7 @@ def get_content_object_url(self):\n             args=(self.content_type_id, self.object_pk)\n         )\n \n+\n @python_2_unicode_compatible\n class Comment(BaseCommentAbstractModel):\n     \"\"\"\n@@ -49,7 +50,7 @@ class Comment(BaseCommentAbstractModel):\n     # Who posted this comment? If ``user`` is set then it was an authenticated\n     # user; otherwise at least user_name should have been set and the comment\n     # was posted by a non-authenticated user.\n-    user        = models.ForeignKey(User, verbose_name=_('user'),\n+    user        = models.ForeignKey(settings.AUTH_USER_MODEL, verbose_name=_('user'),\n                     blank=True, null=True, related_name=\"%(class)s_comments\")\n     user_name   = models.CharField(_(\"user's name\"), max_length=50, blank=True)\n     user_email  = models.EmailField(_(\"user's email address\"), blank=True)\n@@ -117,6 +118,7 @@ def _get_userinfo(self):\n \n     def _get_name(self):\n         return self.userinfo[\"name\"]\n+\n     def _set_name(self, val):\n         if self.user_id:\n             raise AttributeError(_(\"This comment was posted by an authenticated \"\\\n@@ -126,6 +128,7 @@ def _set_name(self, val):\n \n     def _get_email(self):\n         return self.userinfo[\"email\"]\n+\n     def _set_email(self, val):\n         if self.user_id:\n             raise AttributeError(_(\"This comment was posted by an authenticated \"\\\n@@ -135,6 +138,7 @@ def _set_email(self, val):\n \n     def _get_url(self):\n         return self.userinfo[\"url\"]\n+\n     def _set_url(self, val):\n         self.user_url = val\n     url = property(_get_url, _set_url, doc=\"The URL given by the user who posted this comment\")\n@@ -155,6 +159,7 @@ def get_as_text(self):\n         }\n         return _('Posted by %(user)s at %(date)s\\n\\n%(comment)s\\n\\nhttp://%(domain)s%(url)s') % d\n \n+\n @python_2_unicode_compatible\n class CommentFlag(models.Model):\n     \"\"\"\n@@ -169,7 +174,7 @@ class CommentFlag(models.Model):\n     design users are only allowed to flag a comment with a given flag once;\n     if you want rating look elsewhere.\n     \"\"\"\n-    user      = models.ForeignKey(User, verbose_name=_('user'), related_name=\"comment_flags\")\n+    user      = models.ForeignKey(settings.AUTH_USER_MODEL, verbose_name=_('user'), related_name=\"comment_flags\")\n     comment   = models.ForeignKey(Comment, verbose_name=_('comment'), related_name=\"flags\")\n     flag      = models.CharField(_('flag'), max_length=30, db_index=True)\n     flag_date = models.DateTimeField(_('date'), default=None)"
        },
        {
            "sha": "233af40f88a2236eba154af2b8292bb8193a4c92",
            "filename": "django/core/exceptions.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fexceptions.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fexceptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fexceptions.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -3,42 +3,54 @@\n \"\"\"\n from functools import reduce\n \n+\n class DjangoRuntimeWarning(RuntimeWarning):\n     pass\n \n+\n class ObjectDoesNotExist(Exception):\n     \"The requested object does not exist\"\n     silent_variable_failure = True\n \n+\n class MultipleObjectsReturned(Exception):\n     \"The query returned multiple objects when only one was expected.\"\n     pass\n \n+\n class SuspiciousOperation(Exception):\n     \"The user did something suspicious\"\n     pass\n \n+\n class PermissionDenied(Exception):\n     \"The user did not have permission to do that\"\n     pass\n \n+\n class ViewDoesNotExist(Exception):\n     \"The requested view does not exist\"\n     pass\n \n+\n class MiddlewareNotUsed(Exception):\n     \"This middleware is not used in this server configuration\"\n     pass\n \n+\n class ImproperlyConfigured(Exception):\n     \"Django is somehow improperly configured\"\n     pass\n \n+\n class FieldError(Exception):\n     \"\"\"Some kind of problem with a model field.\"\"\"\n     pass\n \n+\n NON_FIELD_ERRORS = '__all__'\n+\n+\n class ValidationError(Exception):\n     \"\"\"An error while validating data.\"\"\"\n     def __init__(self, message, code=None, params=None):\n@@ -85,4 +97,3 @@ def update_error_dict(self, error_dict):\n         else:\n             error_dict[NON_FIELD_ERRORS] = self.messages\n         return error_dict\n-"
        },
        {
            "sha": "0e2c05ba82c5c7f61eb329e6b4454f124aa409c5",
            "filename": "django/core/management/commands/sqlall.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fcommands%2Fsqlall.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fcommands%2Fsqlall.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fsqlall.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -6,6 +6,7 @@\n from django.core.management.sql import sql_all\n from django.db import connections, DEFAULT_DB_ALIAS\n \n+\n class Command(AppCommand):\n     help = \"Prints the CREATE TABLE, custom SQL and CREATE INDEX SQL statements for the given model module name(s).\"\n "
        },
        {
            "sha": "4ce2910fb56bf8164a1cf7c867fbda258abbb0ff",
            "filename": "django/core/management/commands/syncdb.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -68,6 +68,7 @@ def handle_noargs(self, **options):\n                 if router.allow_syncdb(db, m)])\n             for app in models.get_apps()\n         ]\n+\n         def model_installed(model):\n             opts = model._meta\n             converter = connection.introspection.table_name_converter\n@@ -101,7 +102,6 @@ def model_installed(model):\n                     cursor.execute(statement)\n                 tables.append(connection.introspection.table_name_converter(model._meta.db_table))\n \n-\n         transaction.commit_unless_managed(using=db)\n \n         # Send the post_syncdb signal, so individual apps can do whatever they need"
        },
        {
            "sha": "0dec3ea8b927722acc7f877370e89fa328750854",
            "filename": "django/core/management/commands/validate.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fcommands%2Fvalidate.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fcommands%2Fvalidate.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fvalidate.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,5 +1,6 @@\n from django.core.management.base import NoArgsCommand\n \n+\n class Command(NoArgsCommand):\n     help = \"Validates all installed models.\"\n "
        },
        {
            "sha": "ac16a5b358c3831700be2e7ae8c4cd83271fae65",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -9,6 +9,7 @@\n from django.db import models\n from django.db.models import get_models\n \n+\n def sql_create(app, style, connection):\n     \"Returns a list of the CREATE TABLE SQL statements for the given app.\"\n \n@@ -55,6 +56,7 @@ def sql_create(app, style, connection):\n \n     return final_output\n \n+\n def sql_delete(app, style, connection):\n     \"Returns a list of the DROP TABLE SQL statements for the given app.\"\n \n@@ -83,7 +85,7 @@ def sql_delete(app, style, connection):\n             opts = model._meta\n             for f in opts.local_fields:\n                 if f.rel and f.rel.to not in to_delete:\n-                    references_to_delete.setdefault(f.rel.to, []).append( (model, f) )\n+                    references_to_delete.setdefault(f.rel.to, []).append((model, f))\n \n             to_delete.add(model)\n \n@@ -97,7 +99,8 @@ def sql_delete(app, style, connection):\n         cursor.close()\n         connection.close()\n \n-    return output[::-1] # Reverse it, to deal with table dependencies.\n+    return output[::-1]  # Reverse it, to deal with table dependencies.\n+\n \n def sql_flush(style, connection, only_django=False, reset_sequences=True):\n     \"\"\"\n@@ -114,6 +117,7 @@ def sql_flush(style, connection, only_django=False, reset_sequences=True):\n     statements = connection.ops.sql_flush(style, tables, seqs)\n     return statements\n \n+\n def sql_custom(app, style, connection):\n     \"Returns a list of the custom table modifying SQL statements for the given app.\"\n     output = []\n@@ -125,17 +129,20 @@ def sql_custom(app, style, connection):\n \n     return output\n \n+\n def sql_indexes(app, style, connection):\n     \"Returns a list of the CREATE INDEX SQL statements for all models in the given app.\"\n     output = []\n     for model in models.get_models(app):\n         output.extend(connection.creation.sql_indexes_for_model(model, style))\n     return output\n \n+\n def sql_all(app, style, connection):\n     \"Returns a list of CREATE TABLE SQL, initial-data inserts, and CREATE INDEX SQL for the given module.\"\n     return sql_create(app, style, connection) + sql_custom(app, style, connection) + sql_indexes(app, style, connection)\n \n+\n def _split_statements(content):\n     comment_re = re.compile(r\"^((?:'[^']*'|[^'])*?)--.*$\")\n     statements = []\n@@ -150,6 +157,7 @@ def _split_statements(content):\n             statement = \"\"\n     return statements\n \n+\n def custom_sql_for_model(model, style, connection):\n     opts = model._meta\n     app_dir = os.path.normpath(os.path.join(os.path.dirname(models.get_app(model._meta.app_label).__file__), 'sql'))"
        },
        {
            "sha": "fa3edb4430905af40bd4d5c41ee20aabbe1d0b1c",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 24,
            "deletions": 3,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -5,6 +5,7 @@\n from django.utils.itercompat import is_iterable\n from django.utils import six\n \n+\n class ModelErrorCollection:\n     def __init__(self, outfile=sys.stdout):\n         self.errors = []\n@@ -15,6 +16,7 @@ def add(self, context, error):\n         self.errors.append((context, error))\n         self.outfile.write(self.style.ERROR(force_str(\"%s: %s\\n\" % (context, error))))\n \n+\n def get_validation_errors(outfile, app=None):\n     \"\"\"\n     Validates all models that are part of the specified app. If no app name is provided,\n@@ -56,7 +58,7 @@ def get_validation_errors(outfile, app=None):\n                     e.add(opts, '\"%s\": CharFields require a \"max_length\" attribute that is a positive integer.' % f.name)\n             if isinstance(f, models.DecimalField):\n                 decimalp_ok, mdigits_ok = False, False\n-                decimalp_msg ='\"%s\": DecimalFields require a \"decimal_places\" attribute that is a non-negative integer.'\n+                decimalp_msg = '\"%s\": DecimalFields require a \"decimal_places\" attribute that is a non-negative integer.'\n                 try:\n                     decimal_places = int(f.decimal_places)\n                     if decimal_places < 0:\n@@ -123,6 +125,10 @@ def get_validation_errors(outfile, app=None):\n                 if isinstance(f.rel.to, six.string_types):\n                     continue\n \n+                # Make sure the model we're related hasn't been swapped out\n+                if f.rel.to._meta.swapped:\n+                    e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n+\n                 # Make sure the related field specified by a ForeignKey is unique\n                 if not f.rel.to._meta.get_field(f.rel.field_name).unique:\n                     e.add(opts, \"Field '%s' under model '%s' must have a unique=True constraint.\" % (f.rel.field_name, f.rel.to.__name__))\n@@ -165,6 +171,10 @@ def get_validation_errors(outfile, app=None):\n                 if isinstance(f.rel.to, six.string_types):\n                     continue\n \n+            # Make sure the model we're related hasn't been swapped out\n+            if f.rel.to._meta.swapped:\n+                e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n+\n             # Check that the field is not set to unique.  ManyToManyFields do not support unique.\n             if f.unique:\n                 e.add(opts, \"ManyToManyFields cannot be unique.  Remove the unique argument on '%s'.\" % f.name)\n@@ -176,7 +186,7 @@ def get_validation_errors(outfile, app=None):\n                 seen_from, seen_to, seen_self = False, False, 0\n                 for inter_field in f.rel.through._meta.fields:\n                     rel_to = getattr(inter_field.rel, 'to', None)\n-                    if from_model == to_model: # relation to self\n+                    if from_model == to_model:  # relation to self\n                         if rel_to == from_model:\n                             seen_self += 1\n                         if seen_self > 2:\n@@ -275,10 +285,21 @@ def get_validation_errors(outfile, app=None):\n                     if r.get_accessor_name() == rel_query_name:\n                         e.add(opts, \"Reverse query name for m2m field '%s' clashes with related field '%s.%s'. Add a related_name argument to the definition for '%s'.\" % (f.name, rel_opts.object_name, r.get_accessor_name(), f.name))\n \n+        # Check swappable attribute.\n+        if opts.swapped:\n+            try:\n+                app_label, model_name = opts.swapped.split('.')\n+            except ValueError:\n+                e.add(opts, \"%s is not of the form 'app_label.app_name'.\" % opts.swappable)\n+                continue\n+            if not models.get_model(app_label, model_name):\n+                e.add(opts, \"Model has been swapped out for '%s' which has not been installed or is abstract.\" % opts.swapped)\n+\n         # Check ordering attribute.\n         if opts.ordering:\n             for field_name in opts.ordering:\n-                if field_name == '?': continue\n+                if field_name == '?':\n+                    continue\n                 if field_name.startswith('-'):\n                     field_name = field_name[1:]\n                 if opts.order_with_respect_to and field_name == '_order':"
        },
        {
            "sha": "cf12f8c9fc69a9708864fbd0be4ca35d56386179",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 21,
            "deletions": 12,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -15,6 +15,7 @@\n # These values, if given to validate(), will trigger the self.required check.\n EMPTY_VALUES = (None, '', [], (), {})\n \n+\n class RegexValidator(object):\n     regex = ''\n     message = _('Enter a valid value.')\n@@ -39,14 +40,15 @@ def __call__(self, value):\n         if not self.regex.search(force_text(value)):\n             raise ValidationError(self.message, code=self.code)\n \n+\n class URLValidator(RegexValidator):\n     regex = re.compile(\n-        r'^(?:http|ftp)s?://' # http:// or https://\n-        r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:[A-Z]{2,6}\\.?|[A-Z0-9-]{2,}\\.?)|' #domain...\n-        r'localhost|' #localhost...\n-        r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|' # ...or ipv4\n-        r'\\[?[A-F0-9]*:[A-F0-9:]+\\]?)' # ...or ipv6\n-        r'(?::\\d+)?' # optional port\n+        r'^(?:http|ftp)s?://'  # http:// or https://\n+        r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:[A-Z]{2,6}\\.?|[A-Z0-9-]{2,}\\.?)|'  # domain...\n+        r'localhost|'  # localhost...\n+        r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|'  # ...or ipv4\n+        r'\\[?[A-F0-9]*:[A-F0-9:]+\\]?)'  # ...or ipv6\n+        r'(?::\\d+)?'  # optional port\n         r'(?:/?|[/?]\\S+)$', re.IGNORECASE)\n \n     def __call__(self, value):\n@@ -58,8 +60,8 @@ def __call__(self, value):\n                 value = force_text(value)\n                 scheme, netloc, path, query, fragment = urlsplit(value)\n                 try:\n-                    netloc = netloc.encode('idna').decode('ascii') # IDN -> ACE\n-                except UnicodeError: # invalid domain part\n+                    netloc = netloc.encode('idna').decode('ascii')  # IDN -> ACE\n+                except UnicodeError:  # invalid domain part\n                     raise e\n                 url = urlunsplit((scheme, netloc, path, query, fragment))\n                 super(URLValidator, self).__call__(url)\n@@ -75,6 +77,7 @@ def validate_integer(value):\n     except (ValueError, TypeError):\n         raise ValidationError('')\n \n+\n class EmailValidator(RegexValidator):\n \n     def __call__(self, value):\n@@ -106,10 +109,12 @@ def __call__(self, value):\n ipv4_re = re.compile(r'^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$')\n validate_ipv4_address = RegexValidator(ipv4_re, _('Enter a valid IPv4 address.'), 'invalid')\n \n+\n def validate_ipv6_address(value):\n     if not is_valid_ipv6_address(value):\n         raise ValidationError(_('Enter a valid IPv6 address.'), code='invalid')\n \n+\n def validate_ipv46_address(value):\n     try:\n         validate_ipv4_address(value)\n@@ -125,6 +130,7 @@ def validate_ipv46_address(value):\n     'ipv6': ([validate_ipv6_address], _('Enter a valid IPv6 address.')),\n }\n \n+\n def ip_address_validators(protocol, unpack_ipv4):\n     \"\"\"\n     Depending on the given parameters returns the appropriate validators for\n@@ -147,7 +153,7 @@ def ip_address_validators(protocol, unpack_ipv4):\n \n class BaseValidator(object):\n     compare = lambda self, a, b: a is not b\n-    clean   = lambda self, x: x\n+    clean = lambda self, x: x\n     message = _('Ensure this value is %(limit_value)s (it is %(show_value)s).')\n     code = 'limit_value'\n \n@@ -164,25 +170,28 @@ def __call__(self, value):\n                 params=params,\n             )\n \n+\n class MaxValueValidator(BaseValidator):\n     compare = lambda self, a, b: a > b\n     message = _('Ensure this value is less than or equal to %(limit_value)s.')\n     code = 'max_value'\n \n+\n class MinValueValidator(BaseValidator):\n     compare = lambda self, a, b: a < b\n     message = _('Ensure this value is greater than or equal to %(limit_value)s.')\n     code = 'min_value'\n \n+\n class MinLengthValidator(BaseValidator):\n     compare = lambda self, a, b: a < b\n-    clean   = lambda self, x: len(x)\n+    clean = lambda self, x: len(x)\n     message = _('Ensure this value has at least %(limit_value)d characters (it has %(show_value)d).')\n     code = 'min_length'\n \n+\n class MaxLengthValidator(BaseValidator):\n     compare = lambda self, a, b: a > b\n-    clean   = lambda self, x: len(x)\n+    clean = lambda self, x: len(x)\n     message = _('Ensure this value has at most %(limit_value)d characters (it has %(show_value)d).')\n     code = 'max_length'\n-"
        },
        {
            "sha": "02d2a16a46976912df39985e0721a2b52d2c5bf5",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -319,6 +319,7 @@ def cursor(self):\n     def make_debug_cursor(self, cursor):\n         return util.CursorDebugWrapper(cursor, self)\n \n+\n class BaseDatabaseFeatures(object):\n     allows_group_by_pk = False\n     # True if django.db.backend.utils.typecast_timestamp is used on values\n@@ -776,7 +777,7 @@ def sequence_reset_sql(self, style, model_list):\n         The `style` argument is a Style object as returned by either\n         color_style() or no_style() in django.core.management.color.\n         \"\"\"\n-        return [] # No sequence reset required by default.\n+        return []  # No sequence reset required by default.\n \n     def start_transaction_sql(self):\n         \"\"\"\n@@ -915,6 +916,7 @@ def combine_expression(self, connector, sub_expressions):\n         conn = ' %s ' % connector\n         return conn.join(sub_expressions)\n \n+\n class BaseDatabaseIntrospection(object):\n     \"\"\"\n     This class encapsulates all backend-specific introspection utilities\n@@ -1010,12 +1012,14 @@ def sequence_list(self):\n             for model in models.get_models(app):\n                 if not model._meta.managed:\n                     continue\n+                if model._meta.swapped:\n+                    continue\n                 if not router.allow_syncdb(self.connection.alias, model):\n                     continue\n                 for f in model._meta.local_fields:\n                     if isinstance(f, models.AutoField):\n                         sequence_list.append({'table': model._meta.db_table, 'column': f.column})\n-                        break # Only one AutoField is allowed per model, so don't bother continuing.\n+                        break  # Only one AutoField is allowed per model, so don't bother continuing.\n \n                 for f in model._meta.local_many_to_many:\n                     # If this is an m2m using an intermediate table,\n@@ -1052,6 +1056,7 @@ def get_indexes(self, cursor, table_name):\n         \"\"\"\n         raise NotImplementedError\n \n+\n class BaseDatabaseClient(object):\n     \"\"\"\n     This class encapsulates all backend-specific methods for opening a\n@@ -1068,6 +1073,7 @@ def __init__(self, connection):\n     def runshell(self):\n         raise NotImplementedError()\n \n+\n class BaseDatabaseValidation(object):\n     \"\"\"\n     This class encapsualtes all backend-specific model validation."
        },
        {
            "sha": "3262a8922fe5a2724022524ec1b5e2c4b04fb26f",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -40,7 +40,7 @@ def sql_create_model(self, model, style, known_models=set()):\n             (list_of_sql, pending_references_dict)\n         \"\"\"\n         opts = model._meta\n-        if not opts.managed or opts.proxy:\n+        if not opts.managed or opts.proxy or opts.swapped:\n             return [], {}\n         final_output = []\n         table_output = []\n@@ -92,9 +92,9 @@ def sql_create_model(self, model, style, known_models=set()):\n \n         full_statement = [style.SQL_KEYWORD('CREATE TABLE') + ' ' +\n                           style.SQL_TABLE(qn(opts.db_table)) + ' (']\n-        for i, line in enumerate(table_output): # Combine and add commas.\n+        for i, line in enumerate(table_output):  # Combine and add commas.\n             full_statement.append(\n-                '    %s%s' % (line, i < len(table_output)-1 and ',' or ''))\n+                '    %s%s' % (line, i < len(table_output) - 1 and ',' or ''))\n         full_statement.append(')')\n         if opts.db_tablespace:\n             tablespace_sql = self.connection.ops.tablespace_sql(\n@@ -143,11 +143,11 @@ def sql_for_pending_references(self, model, style, pending_references):\n         \"\"\"\n         from django.db.backends.util import truncate_name\n \n-        if not model._meta.managed or model._meta.proxy:\n+        opts = model._meta\n+        if not opts.managed or opts.proxy or opts.swapped:\n             return []\n         qn = self.connection.ops.quote_name\n         final_output = []\n-        opts = model._meta\n         if model in pending_references:\n             for rel_class, f in pending_references[model]:\n                 rel_opts = rel_class._meta\n@@ -172,7 +172,7 @@ def sql_indexes_for_model(self, model, style):\n         \"\"\"\n         Returns the CREATE INDEX SQL statements for a single model.\n         \"\"\"\n-        if not model._meta.managed or model._meta.proxy:\n+        if not model._meta.managed or model._meta.proxy or model._meta.swapped:\n             return []\n         output = []\n         for f in model._meta.local_fields:\n@@ -211,7 +211,7 @@ def sql_destroy_model(self, model, references_to_delete, style):\n         Return the DROP TABLE and restraint dropping statements for a single\n         model.\n         \"\"\"\n-        if not model._meta.managed or model._meta.proxy:\n+        if not model._meta.managed or model._meta.proxy or model._meta.swapped:\n             return []\n         # Drop the table now\n         qn = self.connection.ops.quote_name\n@@ -228,7 +228,7 @@ def sql_destroy_model(self, model, references_to_delete, style):\n \n     def sql_remove_table_constraints(self, model, references_to_delete, style):\n         from django.db.backends.util import truncate_name\n-        if not model._meta.managed or model._meta.proxy:\n+        if not model._meta.managed or model._meta.proxy or model._meta.swapped:\n             return []\n         output = []\n         qn = self.connection.ops.quote_name"
        },
        {
            "sha": "a1f9e2f26ef590c97c3c491092f8efd8b556b3e4",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -5,7 +5,7 @@\n from functools import update_wrapper\n from django.utils.six.moves import zip\n \n-import django.db.models.manager     # Imported to register signal handler.\n+import django.db.models.manager  # Imported to register signal handler.\n from django.conf import settings\n from django.core.exceptions import (ObjectDoesNotExist,\n     MultipleObjectsReturned, FieldError, ValidationError, NON_FIELD_ERRORS)\n@@ -108,6 +108,11 @@ def __new__(cls, name, bases, attrs):\n \n         is_proxy = new_class._meta.proxy\n \n+        # If the model is a proxy, ensure that the base class\n+        # hasn't been swapped out.\n+        if is_proxy and base_meta and base_meta.swapped:\n+            raise TypeError(\"%s cannot proxy the swapped model '%s'.\" % (name, base_meta.swapped))\n+\n         if getattr(new_class, '_default_manager', None):\n             if not is_proxy:\n                 # Multi-table inheritance doesn't inherit default manager from\n@@ -262,6 +267,7 @@ def _prepare(cls):\n         if opts.order_with_respect_to:\n             cls.get_next_in_order = curry(cls._get_next_or_previous_in_order, is_next=True)\n             cls.get_previous_in_order = curry(cls._get_next_or_previous_in_order, is_next=False)\n+\n             # defer creating accessors on the foreign class until we are\n             # certain it has been created\n             def make_foreign_order_accessors(field, model, cls):\n@@ -292,6 +298,7 @@ def make_foreign_order_accessors(field, model, cls):\n \n         signals.class_prepared.send(sender=cls)\n \n+\n class ModelState(object):\n     \"\"\"\n     A class for storing instance state\n@@ -303,6 +310,7 @@ def __init__(self, db=None):\n         # This impacts validation only; it has no effect on the actual save.\n         self.adding = True\n \n+\n class Model(six.with_metaclass(ModelBase, object)):\n     _deferred = False\n \n@@ -632,7 +640,6 @@ def save_base(self, raw=False, cls=None, origin=None, force_insert=False,\n             signals.post_save.send(sender=origin, instance=self, created=(not record_exists),\n                                    update_fields=update_fields, raw=raw, using=using)\n \n-\n     save_base.alters_data = True\n \n     def delete(self, using=None):\n@@ -656,7 +663,7 @@ def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):\n         order = not is_next and '-' or ''\n         param = force_text(getattr(self, field.attname))\n         q = Q(**{'%s__%s' % (field.name, op): param})\n-        q = q|Q(**{field.name: param, 'pk__%s' % op: self.pk})\n+        q = q | Q(**{field.name: param, 'pk__%s' % op: self.pk})\n         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by('%s%s' % (order, field.name), '%spk' % order)\n         try:\n             return qs[0]\n@@ -849,15 +856,15 @@ def unique_error_message(self, model_class, unique_check):\n             field = opts.get_field(field_name)\n             field_label = capfirst(field.verbose_name)\n             # Insert the error into the error dict, very sneaky\n-            return field.error_messages['unique'] %  {\n+            return field.error_messages['unique'] % {\n                 'model_name': six.text_type(model_name),\n                 'field_label': six.text_type(field_label)\n             }\n         # unique_together\n         else:\n             field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]\n             field_labels = get_text_list(field_labels, _('and'))\n-            return _(\"%(model_name)s with this %(field_label)s already exists.\") %  {\n+            return _(\"%(model_name)s with this %(field_label)s already exists.\") % {\n                 'model_name': six.text_type(model_name),\n                 'field_label': six.text_type(field_labels)\n             }\n@@ -921,7 +928,6 @@ def clean_fields(self, exclude=None):\n             raise ValidationError(errors)\n \n \n-\n ############################################\n # HELPER FUNCTIONS (CURRIED MODEL METHODS) #\n ############################################\n@@ -963,6 +969,7 @@ def get_absolute_url(opts, func, self, *args, **kwargs):\n class Empty(object):\n     pass\n \n+\n def model_unpickle(model, attrs):\n     \"\"\"\n     Used to unpickle Model subclasses with deferred fields.\n@@ -971,6 +978,7 @@ def model_unpickle(model, attrs):\n     return cls.__new__(cls)\n model_unpickle.__safe_for_unpickle__ = True\n \n+\n def unpickle_inner_exception(klass, exception_name):\n     # Get the exception class from the class it is attached to:\n     exception = getattr(klass, exception_name)"
        },
        {
            "sha": "c065162aa0e0f5e3049d8e6732880443051d86e4",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 27,
            "deletions": 8,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -21,6 +21,7 @@\n \n pending_lookups = {}\n \n+\n def add_lazy_relation(cls, field, relation, operation):\n     \"\"\"\n     Adds a lookup on ``cls`` when a related field is defined using a string,\n@@ -77,6 +78,7 @@ class MyModel(Model):\n         value = (cls, field, operation)\n         pending_lookups.setdefault(key, []).append(value)\n \n+\n def do_pending_lookups(sender, **kwargs):\n     \"\"\"\n     Handle any pending relations to the sending model. Sent from class_prepared.\n@@ -87,6 +89,7 @@ def do_pending_lookups(sender, **kwargs):\n \n signals.class_prepared.connect(do_pending_lookups)\n \n+\n #HACK\n class RelatedField(object):\n     def contribute_to_class(self, cls, name):\n@@ -220,6 +223,7 @@ def related_query_name(self):\n         # \"related_name\" option.\n         return self.rel.related_name or self.opts.object_name.lower()\n \n+\n class SingleRelatedObjectDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -306,6 +310,7 @@ def __set__(self, instance, value):\n         setattr(instance, self.cache_name, value)\n         setattr(value, self.related.field.get_cache_name(), instance)\n \n+\n class ReverseSingleRelatedObjectDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -430,6 +435,7 @@ def __set__(self, instance, value):\n         if value is not None and not self.field.rel.multiple:\n             setattr(value, self.field.related.get_cache_name(), instance)\n \n+\n class ForeignRelatedObjectsDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -660,7 +666,7 @@ def _add_items(self, source_field_name, target_field_name, *objs):\n                 for obj in objs:\n                     if isinstance(obj, self.model):\n                         if not router.allow_relation(obj, self.instance):\n-                           raise ValueError('Cannot add \"%r\": instance is on database \"%s\", value is on database \"%s\"' %\n+                            raise ValueError('Cannot add \"%r\": instance is on database \"%s\", value is on database \"%s\"' %\n                                                (obj, self.instance._state.db, obj._state.db))\n                         new_ids.add(obj.pk)\n                     elif isinstance(obj, Model):\n@@ -752,6 +758,7 @@ def _clear_items(self, source_field_name):\n \n     return ManyRelatedManager\n \n+\n class ManyRelatedObjectsDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -860,12 +867,13 @@ def __set__(self, instance, value):\n         manager.clear()\n         manager.add(*value)\n \n+\n class ManyToOneRel(object):\n     def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         parent_link=False, on_delete=None):\n         try:\n             to._meta\n-        except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n+        except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"'to' must be either a model, a model name or the string %r\" % RECURSIVE_RELATIONSHIP_CONSTANT\n         self.to, self.field_name = to, field_name\n         self.related_name = related_name\n@@ -891,6 +899,7 @@ def get_related_field(self):\n                     self.field_name)\n         return data[0]\n \n+\n class OneToOneRel(ManyToOneRel):\n     def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         parent_link=False, on_delete=None):\n@@ -900,6 +909,7 @@ def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         )\n         self.multiple = False\n \n+\n class ManyToManyRel(object):\n     def __init__(self, to, related_name=None, limit_choices_to=None,\n             symmetrical=True, through=None):\n@@ -924,16 +934,18 @@ def get_related_field(self):\n         \"\"\"\n         return self.to._meta.pk\n \n+\n class ForeignKey(RelatedField, Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n         'invalid': _('Model %(model)s with pk %(pk)r does not exist.')\n     }\n     description = _(\"Foreign Key (type determined by related field)\")\n+\n     def __init__(self, to, to_field=None, rel_class=ManyToOneRel, **kwargs):\n         try:\n             to_name = to._meta.object_name.lower()\n-        except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n+        except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ForeignKey must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n         else:\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n@@ -1050,6 +1062,7 @@ def db_type(self, connection):\n             return IntegerField().db_type(connection=connection)\n         return rel_field.db_type(connection=connection)\n \n+\n class OneToOneField(ForeignKey):\n     \"\"\"\n     A OneToOneField is essentially the same as a ForeignKey, with the exception\n@@ -1058,6 +1071,7 @@ class OneToOneField(ForeignKey):\n     rather than returning a list.\n     \"\"\"\n     description = _(\"One-to-one relationship\")\n+\n     def __init__(self, to, to_field=None, **kwargs):\n         kwargs['unique'] = True\n         super(OneToOneField, self).__init__(to, to_field, OneToOneRel, **kwargs)\n@@ -1077,12 +1091,14 @@ def save_form_data(self, instance, data):\n         else:\n             setattr(instance, self.attname, data)\n \n+\n def create_many_to_many_intermediary_model(field, klass):\n     from django.db import models\n     managed = True\n     if isinstance(field.rel.to, six.string_types) and field.rel.to != RECURSIVE_RELATIONSHIP_CONSTANT:\n         to_model = field.rel.to\n         to = to_model.split('.')[-1]\n+\n         def set_managed(field, model, cls):\n             field.rel.through._meta.managed = model._meta.managed or cls._meta.managed\n         add_lazy_relation(klass, field, to_model, set_managed)\n@@ -1119,12 +1135,14 @@ def set_managed(field, model, cls):\n         to: models.ForeignKey(to_model, related_name='%s+' % name, db_tablespace=field.db_tablespace)\n     })\n \n+\n class ManyToManyField(RelatedField, Field):\n     description = _(\"Many-to-many relationship\")\n+\n     def __init__(self, to, **kwargs):\n         try:\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n-        except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n+        except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ManyToManyField must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n             # Python 2.6 and earlier require dictionary keys to be of str type,\n             # not unicode and class names must be ASCII (in Python 2.x), so we\n@@ -1135,7 +1153,7 @@ def __init__(self, to, **kwargs):\n         kwargs['rel'] = ManyToManyRel(to,\n             related_name=kwargs.pop('related_name', None),\n             limit_choices_to=kwargs.pop('limit_choices_to', None),\n-            symmetrical=kwargs.pop('symmetrical', to==RECURSIVE_RELATIONSHIP_CONSTANT),\n+            symmetrical=kwargs.pop('symmetrical', to == RECURSIVE_RELATIONSHIP_CONSTANT),\n             through=kwargs.pop('through', None))\n \n         self.db_table = kwargs.pop('db_table', None)\n@@ -1166,7 +1184,7 @@ def _get_m2m_attr(self, related, attr):\n         if hasattr(self, cache_attr):\n             return getattr(self, cache_attr)\n         for f in self.rel.through._meta.fields:\n-            if hasattr(f,'rel') and f.rel and f.rel.to == related.model:\n+            if hasattr(f, 'rel') and f.rel and f.rel.to == related.model:\n                 setattr(self, cache_attr, getattr(f, attr))\n                 return getattr(self, cache_attr)\n \n@@ -1177,7 +1195,7 @@ def _get_m2m_reverse_attr(self, related, attr):\n             return getattr(self, cache_attr)\n         found = False\n         for f in self.rel.through._meta.fields:\n-            if hasattr(f,'rel') and f.rel and f.rel.to == related.parent_model:\n+            if hasattr(f, 'rel') and f.rel and f.rel.to == related.parent_model:\n                 if related.model == related.parent_model:\n                     # If this is an m2m-intermediate to self,\n                     # the first foreign key you find will be\n@@ -1222,7 +1240,8 @@ def contribute_to_class(self, cls, name):\n         # The intermediate m2m model is not auto created if:\n         #  1) There is a manually specified intermediate, or\n         #  2) The class owning the m2m field is abstract.\n-        if not self.rel.through and not cls._meta.abstract:\n+        #  3) The class owning the m2m field has been swapped out.\n+        if not self.rel.through and not cls._meta.abstract and not cls._meta.swapped:\n             self.rel.through = create_many_to_many_intermediary_model(self, cls)\n \n         # Add the descriptor for the m2m relation"
        },
        {
            "sha": "8a0e796f4bebe350a27b4027c02a56f0f4c00ac8",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -14,6 +14,7 @@\n __all__ = ('get_apps', 'get_app', 'get_models', 'get_model', 'register_models',\n         'load_app', 'app_cache_ready')\n \n+\n class AppCache(object):\n     \"\"\"\n     A cache that stores installed applications and their models. Used to"
        },
        {
            "sha": "522a8a23066c9c66d4fb791493b201e996606c95",
            "filename": "django/db/models/manager.py",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Fmanager.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Fmanager.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fmanager.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -13,7 +13,7 @@ def ensure_default_manager(sender, **kwargs):\n     _default_manager if it's not a subclass of Manager).\n     \"\"\"\n     cls = sender\n-    if cls._meta.abstract:\n+    if cls._meta.abstract or cls._meta.swapped:\n         return\n     if not getattr(cls, '_default_manager', None):\n         # Create the default manager, if needed.\n@@ -42,6 +42,7 @@ def ensure_default_manager(sender, **kwargs):\n \n signals.class_prepared.connect(ensure_default_manager)\n \n+\n class Manager(object):\n     # Tracks each time a Manager instance is created. Used to retain order.\n     creation_counter = 0\n@@ -56,7 +57,9 @@ def __init__(self):\n     def contribute_to_class(self, model, name):\n         # TODO: Use weakref because of possible memory leak / circular reference.\n         self.model = model\n-        setattr(model, name, ManagerDescriptor(self))\n+        # Only contribute the manager if the model is concrete\n+        if not model._meta.abstract and not model._meta.swapped:\n+            setattr(model, name, ManagerDescriptor(self))\n         if not getattr(model, '_default_manager', None) or self.creation_counter < model._default_manager.creation_counter:\n             model._default_manager = self\n         if model._meta.abstract or (self._inherited and not self.model._meta.proxy):\n@@ -208,6 +211,7 @@ def _update(self, values, **kwargs):\n     def raw(self, raw_query, params=None, *args, **kwargs):\n         return RawQuerySet(raw_query=raw_query, model=self.model, params=params, using=self._db, *args, **kwargs)\n \n+\n class ManagerDescriptor(object):\n     # This class ensures managers aren't accessible via model instances.\n     # For example, Poll.objects works, but poll_obj.objects raises AttributeError.\n@@ -219,6 +223,7 @@ def __get__(self, instance, type=None):\n             raise AttributeError(\"Manager isn't accessible via %s instances\" % type.__name__)\n         return self.manager\n \n+\n class EmptyManager(Manager):\n     def get_query_set(self):\n         return self.get_empty_query_set()"
        },
        {
            "sha": "d2de96ea5c4ae87798fc5f26bdc751956fe97ca1",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 18,
            "deletions": 3,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -21,7 +21,8 @@\n DEFAULT_NAMES = ('verbose_name', 'verbose_name_plural', 'db_table', 'ordering',\n                  'unique_together', 'permissions', 'get_latest_by',\n                  'order_with_respect_to', 'app_label', 'db_tablespace',\n-                 'abstract', 'managed', 'proxy', 'auto_created')\n+                 'abstract', 'managed', 'proxy', 'swappable', 'auto_created')\n+\n \n @python_2_unicode_compatible\n class Options(object):\n@@ -32,8 +33,8 @@ def __init__(self, meta, app_label=None):\n         self.verbose_name_plural = None\n         self.db_table = ''\n         self.ordering = []\n-        self.unique_together =  []\n-        self.permissions =  []\n+        self.unique_together = []\n+        self.permissions = []\n         self.object_name, self.app_label = None, app_label\n         self.get_latest_by = None\n         self.order_with_respect_to = None\n@@ -55,6 +56,7 @@ def __init__(self, meta, app_label=None):\n         # in the end of the proxy_for_model chain. In particular, for\n         # concrete models, the concrete_model is always the class itself.\n         self.concrete_model = None\n+        self.swappable = None\n         self.parents = SortedDict()\n         self.duplicate_targets = {}\n         self.auto_created = False\n@@ -218,6 +220,19 @@ def verbose_name_raw(self):\n         return raw\n     verbose_name_raw = property(verbose_name_raw)\n \n+    def _swapped(self):\n+        \"\"\"\n+        Has this model been swapped out for another? If so, return the model\n+        name of the replacement; otherwise, return None.\n+        \"\"\"\n+        if self.swappable:\n+            model_label = '%s.%s' % (self.app_label, self.object_name)\n+            swapped_for = getattr(settings, self.swappable, None)\n+            if swapped_for not in (None, model_label):\n+                return swapped_for\n+        return None\n+    swapped = property(_swapped)\n+\n     def _fields(self):\n         \"\"\"\n         The getter for self.fields. This returns the list of field objects"
        },
        {
            "sha": "7a4987508e6833030d13b1505a2f25767e7fcd9e",
            "filename": "django/test/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Ftest%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Ftest%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F__init__.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -5,5 +5,6 @@\n from django.test.client import Client, RequestFactory\n from django.test.testcases import (TestCase, TransactionTestCase,\n     SimpleTestCase, LiveServerTestCase, skipIfDBFeature,\n-    skipUnlessDBFeature)\n+    skipUnlessDBFeature\n+)\n from django.test.utils import Approximate"
        },
        {
            "sha": "2b1ef912b68104530f2728ff15f688b0fc4bc2f8",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -44,6 +44,7 @@\n from django.utils.encoding import force_text\n from django.utils import six\n from django.utils.unittest.util import safe_repr\n+from django.utils.unittest import skipIf\n from django.views.static import serve\n \n __all__ = ('DocTestRunner', 'OutputChecker', 'TestCase', 'TransactionTestCase',\n@@ -53,6 +54,7 @@\n normalize_decimals = lambda s: re.sub(r\"Decimal\\('(\\d+(\\.\\d*)?)'\\)\",\n                                 lambda m: \"Decimal(\\\"%s\\\")\" % m.groups()[0], s)\n \n+\n def to_list(value):\n     \"\"\"\n     Puts value into a list if it's not already one."
        },
        {
            "sha": "4fbe6f824e90b31beab75486c1f54fb4fda36ca1",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -28,7 +28,7 @@ def __repr__(self):\n     def __eq__(self, other):\n         if self.val == other:\n             return True\n-        return round(abs(self.val-other), self.places) == 0\n+        return round(abs(self.val - other), self.places) == 0\n \n \n class ContextList(list):\n@@ -46,7 +46,7 @@ def __getitem__(self, key):\n \n     def __contains__(self, key):\n         try:\n-            value = self[key]\n+            self[key]\n         except KeyError:\n             return False\n         return True\n@@ -188,9 +188,11 @@ def __call__(self, test_func):\n         if isinstance(test_func, type) and issubclass(test_func, TransactionTestCase):\n             original_pre_setup = test_func._pre_setup\n             original_post_teardown = test_func._post_teardown\n+\n             def _pre_setup(innerself):\n                 self.enable()\n                 original_pre_setup(innerself)\n+\n             def _post_teardown(innerself):\n                 original_post_teardown(innerself)\n                 self.disable()\n@@ -220,5 +222,6 @@ def disable(self):\n             setting_changed.send(sender=settings._wrapped.__class__,\n                                  setting=key, value=new_value)\n \n+\n def str_prefix(s):\n     return s % {'_': '' if six.PY3 else 'u'}"
        },
        {
            "sha": "4e341c6953a6143af669bd03b30b76eabc64b8fa",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -286,6 +286,9 @@ these changes.\n * The ``mimetype`` argument to :class:`~django.http.HttpResponse` ``__init__``\n   will be removed (``content_type`` should be used instead).\n \n+* The ``AUTH_PROFILE_MODULE`` setting, and the ``get_profile()`` method on\n+  the User model, will be removed.\n+\n 2.0\n ---\n "
        },
        {
            "sha": "a909c12665bac2e7b18be6fea14f7f6aadec44ad",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 6,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -110,15 +110,14 @@ A tuple of authentication backend classes (as strings) to use when attempting to\n authenticate a user. See the :doc:`authentication backends documentation\n </ref/authbackends>` for details.\n \n-.. setting:: AUTH_PROFILE_MODULE\n+.. setting:: AUTH_USER_MODEL\n \n-AUTH_PROFILE_MODULE\n--------------------\n+AUTH_USER_MODEL\n+---------------\n \n-Default: Not defined\n+Default: 'auth.User'\n \n-The site-specific user profile model used by this site. See\n-:ref:`auth-profiles`.\n+The model to use to represent a User. See :ref:`auth-custom-user`.\n \n .. setting:: CACHES\n \n@@ -2209,6 +2208,22 @@ ADMIN_MEDIA_PREFIX\n    integration. See the :doc:`Django 1.4 release notes</releases/1.4>` for\n    more information.\n \n+.. setting:: AUTH_PROFILE_MODULE\n+\n+AUTH_PROFILE_MODULE\n+-------------------\n+\n+.. deprecated:: 1.5\n+    With the introduction of :ref:`custom User models <auth-custom-user>`,\n+    the use of :setting:`AUTH_PROFILE_MODULE` to define a single profile\n+    model is no longer supported. See the\n+    :doc:`Django 1.5 release notes</releases/1.5>` for more information.\n+\n+Default: Not defined\n+\n+The site-specific user profile model used by this site. See\n+:ref:`auth-profiles`.\n+\n .. setting:: IGNORABLE_404_ENDS\n \n IGNORABLE_404_ENDS"
        },
        {
            "sha": "df8d89c185c103e4747029406fce70a49ffb8547",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -34,6 +34,23 @@ release featuring 2.7 support.\n What's new in Django 1.5\n ========================\n \n+Configurable User model\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+In Django 1.5, you can now use your own model as the store for user-related\n+data. If your project needs a username with more than 30 characters, or if\n+you want to store usernames in a format other than first name/last name, or\n+you want to put custom profile information onto your User object, you can\n+now do so.\n+\n+If you have a third-party reusable application that references the User model,\n+you may need to make some changes to the way you reference User instances. You\n+should also document any specific features of the User model that your\n+application relies upon.\n+\n+See the :ref:`documentation on custom User models <auth-custom-user>` for\n+more details.\n+\n Support for saving a subset of model's fields\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -277,6 +294,18 @@ Session not saved on 500 responses\n Django's session middleware will skip saving the session data if the\n response's status code is 500.\n \n+Email checks on failed admin login\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Prior to Django 1.5, if you attempted to log into the admin interface and\n+mistakenly used your email address instead of your username, the admin\n+interface would provide a warning advising that your email address was\n+not your username. In Django 1.5, the introduction of\n+:ref:`custom User models <auth-custom-user>` has required the removal of this\n+warning. This doesn't change the login behavior of the admin site; it only\n+affects the warning message that is displayed under one particular mode of\n+login failure.\n+\n Changes in tests execution\n ~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -394,3 +423,16 @@ The markup contrib module has been deprecated and will follow an accelerated\n deprecation schedule. Direct use of python markup libraries or 3rd party tag\n libraries is preferred to Django maintaining this functionality in the\n framework.\n+\n+:setting:`AUTH_PROFILE_MODULE`\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+With the introduction of :ref:`custom User models <auth-custom-user>`, there is\n+no longer any need for a built-in mechanism to store user profile data.\n+\n+You can still define user profiles models that have a one-to-one relation with\n+the User model - in fact, for many applications needing to associate data with\n+a User account, this will be an appropriate design pattern to follow. However,\n+the :setting:`AUTH_PROFILE_MODULE` setting, and the\n+:meth:`~django.contrib.auth.models.User.get_profile()` method for accessing\n+the user profile model, should not be used any longer."
        },
        {
            "sha": "a767b5a93f5f1d6a193e00dc8eb33f27adfbc93e",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 359,
            "deletions": 0,
            "changes": 359,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -250,6 +250,12 @@ Methods\n \n     .. method:: models.User.get_profile()\n \n+        .. deprecated:: 1.5\n+            With the introduction of :ref:`custom User models <auth-custom-user>`,\n+            the use of :setting:`AUTH_PROFILE_MODULE` to define a single profile\n+            model is no longer supported. See the\n+            :doc:`Django 1.5 release notes</releases/1.5>` for more information.\n+\n         Returns a site-specific profile for this user. Raises\n         :exc:`django.contrib.auth.models.SiteProfileNotAvailable` if the\n         current site doesn't allow profiles, or\n@@ -582,6 +588,12 @@ correct path and environment for you.\n Storing additional information about users\n ------------------------------------------\n \n+.. deprecated:: 1.5\n+    With the introduction of :ref:`custom User models <auth-custom-user>`,\n+    the use of :setting:`AUTH_PROFILE_MODULE` to define a single profile\n+    model is no longer supported. See the\n+    :doc:`Django 1.5 release notes</releases/1.5>` for more information.\n+\n If you'd like to store additional information related to your users, Django\n provides a method to specify a site-specific related model -- termed a \"user\n profile\" -- for this purpose.\n@@ -1345,6 +1357,9 @@ Helper functions\n       URL to redirect to after log out. Overrides ``next`` if the given\n       ``GET`` parameter is passed.\n \n+\n+.. _built-in-auth-forms:\n+\n Built-in forms\n --------------\n \n@@ -1735,6 +1750,350 @@ Fields\n         group.permissions.remove(permission, permission, ...)\n         group.permissions.clear()\n \n+.. _auth-custom-user:\n+\n+Customizing the User model\n+==========================\n+\n+.. versionadded:: 1.5\n+\n+Some kinds of projects may have authentication requirements for which Django's\n+built-in :class:`~django.contrib.auth.models.User` model is not always\n+appropriate. For instance, on some sites it makes more sense to use an email\n+address as your identification token instead of a username.\n+\n+Django allows you to override the default User model by providing a value for\n+the :setting:`AUTH_USER_MODEL` setting that references a custom model::\n+\n+     AUTH_USER_MODEL = 'myapp.MyUser'\n+\n+This dotted pair describes the name of the Django app, and the name of the Django\n+model that you wish to use as your User model.\n+\n+.. admonition:: Warning\n+\n+   Changing :setting:`AUTH_USER_MODEL` has a big effect on your database\n+   structure. It changes the tables that are available, and it will affect the\n+   construction of foreign keys and many-to-many relationships. If you intend\n+   to set :setting:`AUTH_USER_MODEL`, you should set it before running\n+   ``manage.py syncdb`` for the first time.\n+\n+   If you have an existing project and you want to migrate to using a custom\n+   User model, you may need to look into using a migration tool like South_\n+   to ease the transition.\n+\n+.. _South: http://south.aeracode.org\n+\n+Referencing the User model\n+--------------------------\n+\n+If you reference :class:`~django.contrib.auth.models.User` directly (for\n+example, by referring to it in a foreign key), your code will not work in\n+projects where the :setting:`AUTH_USER_MODEL` setting has been changed to a\n+different User model.\n+\n+Instead of referring to :class:`~django.contrib.auth.models.User` directly,\n+you should reference the user model using\n+:func:`django.contrib.auth.get_user_model()`. This method will return the\n+currently  active User model -- the custom User model if one is specified, or\n+:class:`~django.contrib.auth.User` otherwise.\n+\n+In relations to the User model, you should specify the custom model using\n+the :setting:`AUTH_USER_MODEL` setting. For example::\n+\n+    from django.conf import settings\n+    from django.db import models\n+\n+    class Article(models.Model)\n+        author = models.ForeignKey(settings.AUTH_USER_MODEL)\n+\n+Specifying a custom User model\n+------------------------------\n+\n+.. admonition:: Model design considerations\n+\n+    Think carefully before handling information not directly related to\n+    authentication in your custom User Model.\n+\n+    It may be better to store app-specific user information in a model\n+    that has a relation with the User model. That allows each app to specify\n+    its own user data requirements without risking conflicts with other\n+    apps. On the other hand, queries to retrieve this related information\n+    will involve a database join, which may have an effect on performance.\n+\n+Django expects your custom User model to meet some minimum requirements.\n+\n+1. Your model must have a single unique field that can be used for\n+   identification purposes. This can be a username, an email address,\n+   or any other unique attribute.\n+\n+2. Your model must provide a way to address the user in a \"short\" and\n+   \"long\" form. The most common interpretation of this would be to use\n+   the user's given name as the \"short\" identifier, and the user's full\n+   name as the \"long\" identifier. However, there are no constraints on\n+   what these two methods return - if you want, they can return exactly\n+   the same value.\n+\n+The easiest way to construct a compliant custom User model is to inherit from\n+:class:`~django.contrib.auth.models.AbstractBaseUser`.\n+:class:`~django.contrib.auth.models.AbstractBaseUser` provides the core\n+implementation of a `User` model, including hashed passwords and tokenized\n+password resets. You must then provide some key implementation details:\n+\n+.. attribute:: User.USERNAME_FIELD\n+\n+    A string describing the name of the field on the User model that is\n+    used as the unique identifier. This will usually be a username of\n+    some kind, but it can also be an email address, or any other unique\n+    identifier. In the following example, the field `identifier` is used\n+    as the identifying field::\n+\n+        class MyUser(AbstractBaseUser):\n+            identfier = models.CharField(max_length=40, unique=True, db_index=True)\n+            ...\n+            USERNAME_FIELD = 'identifier'\n+\n+.. attribute:: User.REQUIRED_FIELDS\n+\n+    A list of the field names that *must* be provided when creating\n+    a user. For example, here is the partial definition for a User model\n+    that defines two required fields - a date of birth and height::\n+\n+        class MyUser(AbstractBaseUser):\n+            ...\n+            date_of_birth = models.DateField()\n+            height = models.FloatField()\n+            ...\n+            REQUIRED_FIELDS = ['date_of_birth', 'height']\n+\n+.. method:: User.get_full_name():\n+\n+    A longer formal identifier for the user. A common interpretation\n+    would be the full name name of the user, but it can be any string that\n+    identifies the user.\n+\n+.. method:: User.get_short_name():\n+\n+    A short, informal identifier for the user. A common interpretation\n+    would be the first name of the user, but it can be any string that\n+    identifies the user in an informal way. It may also return the same\n+    value as :meth:`django.contrib.auth.User.get_full_name()`.\n+\n+You should also define a custom manager for your User model. If your User\n+model defines `username` and `email` fields the same as Django's default User,\n+you can just install Django's\n+:class:`~django.contrib.auth.models.UserManager`; however, if your User model\n+defines different fields, you will need to define a custom manager that\n+extends :class:`~django.contrib.auth.models.BaseUserManager` providing two\n+additional methods:\n+\n+.. method:: UserManager.create_user(username, password=None, **other_fields)\n+\n+    The prototype of `create_user()` should accept all required fields\n+    as arguments. For example, if your user model defines `username`,\n+    and `date_of_birth` as required fields, then create_user should be\n+    defined as::\n+\n+        def create_user(self, username, date_of_birth, password=None):\n+            # create user here\n+\n+.. method:: UserManager.create_superuser(username, password, **other_fields)\n+\n+    The prototype of `create_superuser()` should accept all required fields\n+    as arguments. For example, if your user model defines `username`,\n+    and `date_of_birth` as required fields, then create_user should be\n+    defined as::\n+\n+        def create_superuser(self, username, date_of_birth, password):\n+            # create superuser here\n+\n+    Unlike `create_user()`, `create_superuser()` *must* require the caller\n+    to provider a password.\n+\n+Extending Django's default User\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If you're entirely happy with Django's :class:`~django.contrib.auth.models.User`\n+model and you just want to add some additional profile information, you can\n+simply subclass :class:`~django.contrib.auth.models.AbstractUser` and add your\n+custom profile fields.\n+\n+Custom users and the built-in auth forms\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+As you may expect, built-in Django's :ref:`forms <_built-in-auth-forms>`\n+and :ref:`views <other-built-in-views>` make certain assumptions about\n+the user model that they are working with.\n+\n+If your user model doesn't follow the same assumptions, it may be necessary to define\n+a replacement form, and pass that form in as part of the configuration of the\n+auth views.\n+\n+* :class:`~django.contrib.auth.forms.UserCreationForm`\n+\n+  Depends on the :class:`~django.contrib.auth.models.User` model.\n+  Must be re-written for any custom user model.\n+\n+* :class:`~django.contrib.auth.forms.UserChangeForm`\n+\n+  Depends on the :class:`~django.contrib.auth.models.User` model.\n+  Must be re-written for any custom user model.\n+\n+* :class:`~django.contrib.auth.forms.AuthenticationForm`\n+\n+  Works with any subclass of :class:`~django.contrib.auth.models.AbstractBaseUser`,\n+  and will adapt to use the field defined in `USERNAME_FIELD`.\n+\n+* :class:`~django.contrib.auth.forms.PasswordResetForm`\n+\n+  Assumes that the user model has an integer primary key, has a field named\n+  `email` that can be used to identify the user, and a boolean field\n+  named `is_active` to prevent password resets for inactive users.\n+\n+* :class:`~django.contrib.auth.forms.SetPasswordForm`\n+\n+  Works with any subclass of :class:`~django.contrib.auth.models.AbstractBaseUser`\n+\n+* :class:`~django.contrib.auth.forms.PasswordChangeForm`\n+\n+  Works with any subclass of :class:`~django.contrib.auth.models.AbstractBaseUser`\n+\n+* :class:`~django.contrib.auth.forms.AdminPasswordChangeForm`\n+\n+  Works with any subclass of :class:`~django.contrib.auth.models.AbstractBaseUser`\n+\n+\n+Custom users and django.contrib.admin\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If you want your custom User model to also work with Admin, your User model must\n+define some additional attributes and methods. These methods allow the admin to\n+control access of the User to admin content:\n+\n+.. attribute:: User.is_staff\n+\n+    Returns True if the user is allowed to have access to the admin site.\n+\n+.. attribute:: User.is_active\n+\n+    Returns True if the user account is currently active.\n+\n+.. method:: User.has_perm(perm, obj=None):\n+\n+    Returns True if the user has the named permission. If `obj` is\n+    provided, the permission needs to be checked against a specific object\n+    instance.\n+\n+.. method:: User.has_module_perms(app_label):\n+\n+    Returns True if the user has permission to access models in\n+    the given app.\n+\n+\n+Custom users and Proxy models\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+One limitation of custom User models is that installing a custom User model\n+will break any proxy model extending :class:`~django.contrib.auth.models.User`.\n+Proxy models must be based on a concrete base class; by defining a custom User\n+model, you remove the ability of Django to reliably identify the base class.\n+\n+If your project uses proxy models, you must either modify the proxy to extend\n+the User model that is currently in use in your project, or merge your proxy's\n+behavior into your User subclass.\n+\n+A full example\n+--------------\n+\n+Here is an example of a full models.py for an admin-compliant custom\n+user app. This user model uses an email address as the username, and has a\n+required date of birth; it provides no permission checking, beyond a simple\n+`admin` flag on the user account. This model would be compatible with all\n+the built-in auth forms and views, except for the User creation forms.\n+\n+This code would all live in a ``models.py`` file for a custom\n+authentication app::\n+\n+    from django.db import models\n+    from django.contrib.auth.models import (\n+        BaseUserManager, AbstractBaseUser\n+    )\n+\n+\n+    class MyUserManager(BaseUserManager):\n+        def create_user(self, email, date_of_birth, password=None):\n+            \"\"\"\n+            Creates and saves a User with the given email, date of\n+            birth and password.\n+            \"\"\"\n+            if not email:\n+                raise ValueError('Users must have an email address')\n+\n+            user = self.model(\n+                email=MyUserManager.normalize_email(email),\n+                date_of_birth=date_of_birth,\n+            )\n+\n+            user.set_password(password)\n+            user.save(using=self._db)\n+            return user\n+\n+        def create_superuser(self, username, date_of_birth, password):\n+            \"\"\"\n+            Creates and saves a superuser with the given email, date of\n+            birth and password.\n+            \"\"\"\n+            u = self.create_user(username,\n+                            password=password,\n+                            date_of_birth=date_of_birth\n+                        )\n+            u.is_admin = True\n+            u.save(using=self._db)\n+            return u\n+\n+\n+    class MyUser(AbstractBaseUser):\n+        email = models.EmailField(\n+                            verbose_name='email address',\n+                            max_length=255\n+                        )\n+        date_of_birth = models.DateField()\n+        is_active = models.BooleanField(default=True)\n+        is_admin = models.BooleanField(default=False)\n+\n+        objects = MyUserManager()\n+\n+        USERNAME_FIELD = 'email'\n+        REQUIRED_FIELDS = ['date_of_birth']\n+\n+        def get_full_name(self):\n+            # The user is identified by their email address\n+            return self.email\n+\n+        def get_short_name(self):\n+            # The user is identified by their email address\n+            return self.email\n+\n+        def __unicode__(self):\n+            return self.email\n+\n+        def has_perm(self, perm, obj=None):\n+            \"Does the user have a specific permission?\"\n+            # Simplest possible answer: Yes, always\n+            return True\n+\n+        def has_module_perms(self, app_label):\n+            \"Does the user have permissions to view the app `app_label`?\"\n+            # Simplest possible answer: Yes, always\n+            return True\n+\n+        @property\n+        def is_staff(self):\n+            \"Is the user a member of staff?\"\n+            # Simplest possible answer: All admins are staff\n+            return self.is_admin\n+\n+\n .. _authentication-backends:\n \n Other authentication sources"
        },
        {
            "sha": "3f95d314e379a1ea1e0a3194d15b3263086e7863",
            "filename": "tests/modeltests/invalid_models/invalid_models/models.py",
            "status": "modified",
            "additions": 106,
            "deletions": 4,
            "changes": 110,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -21,24 +21,27 @@ class FieldErrors(models.Model):\n     decimalfield5 = models.DecimalField(max_digits=10, decimal_places=10)\n     filefield = models.FileField()\n     choices = models.CharField(max_length=10, choices='bad')\n-    choices2 = models.CharField(max_length=10, choices=[(1,2,3),(1,2,3)])\n+    choices2 = models.CharField(max_length=10, choices=[(1, 2, 3), (1, 2, 3)])\n     index = models.CharField(max_length=10, db_index='bad')\n     field_ = models.CharField(max_length=10)\n     nullbool = models.BooleanField(null=True)\n \n+\n class Target(models.Model):\n     tgt_safe = models.CharField(max_length=10)\n     clash1 = models.CharField(max_length=10)\n     clash2 = models.CharField(max_length=10)\n \n     clash1_set = models.CharField(max_length=10)\n \n+\n class Clash1(models.Model):\n     src_safe = models.CharField(max_length=10)\n \n     foreign = models.ForeignKey(Target)\n     m2m = models.ManyToManyField(Target)\n \n+\n class Clash2(models.Model):\n     src_safe = models.CharField(max_length=10)\n \n@@ -48,6 +51,7 @@ class Clash2(models.Model):\n     m2m_1 = models.ManyToManyField(Target, related_name='id')\n     m2m_2 = models.ManyToManyField(Target, related_name='src_safe')\n \n+\n class Target2(models.Model):\n     clash3 = models.CharField(max_length=10)\n     foreign_tgt = models.ForeignKey(Target)\n@@ -56,6 +60,7 @@ class Target2(models.Model):\n     m2m_tgt = models.ManyToManyField(Target)\n     clashm2m_set = models.ManyToManyField(Target)\n \n+\n class Clash3(models.Model):\n     src_safe = models.CharField(max_length=10)\n \n@@ -65,12 +70,15 @@ class Clash3(models.Model):\n     m2m_1 = models.ManyToManyField(Target2, related_name='foreign_tgt')\n     m2m_2 = models.ManyToManyField(Target2, related_name='m2m_tgt')\n \n+\n class ClashForeign(models.Model):\n     foreign = models.ForeignKey(Target2)\n \n+\n class ClashM2M(models.Model):\n     m2m = models.ManyToManyField(Target2)\n \n+\n class SelfClashForeign(models.Model):\n     src_safe = models.CharField(max_length=10)\n     selfclashforeign = models.CharField(max_length=10)\n@@ -79,6 +87,7 @@ class SelfClashForeign(models.Model):\n     foreign_1 = models.ForeignKey(\"SelfClashForeign\", related_name='id')\n     foreign_2 = models.ForeignKey(\"SelfClashForeign\", related_name='src_safe')\n \n+\n class ValidM2M(models.Model):\n     src_safe = models.CharField(max_length=10)\n     validm2m = models.CharField(max_length=10)\n@@ -94,6 +103,7 @@ class ValidM2M(models.Model):\n     m2m_3 = models.ManyToManyField('self')\n     m2m_4 = models.ManyToManyField('self')\n \n+\n class SelfClashM2M(models.Model):\n     src_safe = models.CharField(max_length=10)\n     selfclashm2m = models.CharField(max_length=10)\n@@ -108,120 +118,148 @@ class SelfClashM2M(models.Model):\n     m2m_3 = models.ManyToManyField('self', symmetrical=False)\n     m2m_4 = models.ManyToManyField('self', symmetrical=False)\n \n+\n class Model(models.Model):\n     \"But it's valid to call a model Model.\"\n-    year = models.PositiveIntegerField() #1960\n-    make = models.CharField(max_length=10) #Aston Martin\n-    name = models.CharField(max_length=10) #DB 4 GT\n+    year = models.PositiveIntegerField()  # 1960\n+    make = models.CharField(max_length=10)  # Aston Martin\n+    name = models.CharField(max_length=10)  # DB 4 GT\n+\n \n class Car(models.Model):\n     colour = models.CharField(max_length=5)\n     model = models.ForeignKey(Model)\n \n+\n class MissingRelations(models.Model):\n     rel1 = models.ForeignKey(\"Rel1\")\n     rel2 = models.ManyToManyField(\"Rel2\")\n \n+\n class MissingManualM2MModel(models.Model):\n     name = models.CharField(max_length=5)\n     missing_m2m = models.ManyToManyField(Model, through=\"MissingM2MModel\")\n \n+\n class Person(models.Model):\n     name = models.CharField(max_length=5)\n \n+\n class Group(models.Model):\n     name = models.CharField(max_length=5)\n     primary = models.ManyToManyField(Person, through=\"Membership\", related_name=\"primary\")\n     secondary = models.ManyToManyField(Person, through=\"Membership\", related_name=\"secondary\")\n     tertiary = models.ManyToManyField(Person, through=\"RelationshipDoubleFK\", related_name=\"tertiary\")\n \n+\n class GroupTwo(models.Model):\n     name = models.CharField(max_length=5)\n     primary = models.ManyToManyField(Person, through=\"Membership\")\n     secondary = models.ManyToManyField(Group, through=\"MembershipMissingFK\")\n \n+\n class Membership(models.Model):\n     person = models.ForeignKey(Person)\n     group = models.ForeignKey(Group)\n     not_default_or_null = models.CharField(max_length=5)\n \n+\n class MembershipMissingFK(models.Model):\n     person = models.ForeignKey(Person)\n \n+\n class PersonSelfRefM2M(models.Model):\n     name = models.CharField(max_length=5)\n     friends = models.ManyToManyField('self', through=\"Relationship\")\n     too_many_friends = models.ManyToManyField('self', through=\"RelationshipTripleFK\")\n \n+\n class PersonSelfRefM2MExplicit(models.Model):\n     name = models.CharField(max_length=5)\n     friends = models.ManyToManyField('self', through=\"ExplicitRelationship\", symmetrical=True)\n \n+\n class Relationship(models.Model):\n     first = models.ForeignKey(PersonSelfRefM2M, related_name=\"rel_from_set\")\n     second = models.ForeignKey(PersonSelfRefM2M, related_name=\"rel_to_set\")\n     date_added = models.DateTimeField()\n \n+\n class ExplicitRelationship(models.Model):\n     first = models.ForeignKey(PersonSelfRefM2MExplicit, related_name=\"rel_from_set\")\n     second = models.ForeignKey(PersonSelfRefM2MExplicit, related_name=\"rel_to_set\")\n     date_added = models.DateTimeField()\n \n+\n class RelationshipTripleFK(models.Model):\n     first = models.ForeignKey(PersonSelfRefM2M, related_name=\"rel_from_set_2\")\n     second = models.ForeignKey(PersonSelfRefM2M, related_name=\"rel_to_set_2\")\n     third = models.ForeignKey(PersonSelfRefM2M, related_name=\"too_many_by_far\")\n     date_added = models.DateTimeField()\n \n+\n class RelationshipDoubleFK(models.Model):\n     first = models.ForeignKey(Person, related_name=\"first_related_name\")\n     second = models.ForeignKey(Person, related_name=\"second_related_name\")\n     third = models.ForeignKey(Group, related_name=\"rel_to_set\")\n     date_added = models.DateTimeField()\n \n+\n class AbstractModel(models.Model):\n     name = models.CharField(max_length=10)\n+\n     class Meta:\n         abstract = True\n \n+\n class AbstractRelationModel(models.Model):\n     fk1 = models.ForeignKey('AbstractModel')\n     fk2 = models.ManyToManyField('AbstractModel')\n \n+\n class UniqueM2M(models.Model):\n     \"\"\" Model to test for unique ManyToManyFields, which are invalid. \"\"\"\n     unique_people = models.ManyToManyField(Person, unique=True)\n \n+\n class NonUniqueFKTarget1(models.Model):\n     \"\"\" Model to test for non-unique FK target in yet-to-be-defined model: expect an error \"\"\"\n     tgt = models.ForeignKey('FKTarget', to_field='bad')\n \n+\n class UniqueFKTarget1(models.Model):\n     \"\"\" Model to test for unique FK target in yet-to-be-defined model: expect no error \"\"\"\n     tgt = models.ForeignKey('FKTarget', to_field='good')\n \n+\n class FKTarget(models.Model):\n     bad = models.IntegerField()\n     good = models.IntegerField(unique=True)\n \n+\n class NonUniqueFKTarget2(models.Model):\n     \"\"\" Model to test for non-unique FK target in previously seen model: expect an error \"\"\"\n     tgt = models.ForeignKey(FKTarget, to_field='bad')\n \n+\n class UniqueFKTarget2(models.Model):\n     \"\"\" Model to test for unique FK target in previously seen model: expect no error \"\"\"\n     tgt = models.ForeignKey(FKTarget, to_field='good')\n \n+\n class NonExistingOrderingWithSingleUnderscore(models.Model):\n     class Meta:\n         ordering = (\"does_not_exist\",)\n \n+\n class InvalidSetNull(models.Model):\n     fk = models.ForeignKey('self', on_delete=models.SET_NULL)\n \n+\n class InvalidSetDefault(models.Model):\n     fk = models.ForeignKey('self', on_delete=models.SET_DEFAULT)\n \n+\n class UnicodeForeignKeys(models.Model):\n     \"\"\"Foreign keys which can translate to ascii should be OK, but fail if\n     they're not.\"\"\"\n@@ -232,9 +270,11 @@ class UnicodeForeignKeys(models.Model):\n     # when adding the errors in core/management/validation.py\n     #bad = models.ForeignKey('★')\n \n+\n class PrimaryKeyNull(models.Model):\n     my_pk_field = models.IntegerField(primary_key=True, null=True)\n \n+\n class OrderByPKModel(models.Model):\n     \"\"\"\n     Model to test that ordering by pk passes validation.\n@@ -245,6 +285,62 @@ class OrderByPKModel(models.Model):\n     class Meta:\n         ordering = ('pk',)\n \n+\n+class SwappableModel(models.Model):\n+    \"\"\"A model that can be, but isn't swapped out.\n+\n+    References to this model *shoudln't* raise any validation error.\n+    \"\"\"\n+    name = models.CharField(max_length=100)\n+\n+    class Meta:\n+        swappable = 'TEST_SWAPPABLE_MODEL'\n+\n+\n+class SwappedModel(models.Model):\n+    \"\"\"A model that is swapped out.\n+\n+    References to this model *should* raise a validation error.\n+    Requires TEST_SWAPPED_MODEL to be defined in the test environment;\n+    this is guaranteed by the test runner using @override_settings.\n+    \"\"\"\n+    name = models.CharField(max_length=100)\n+\n+    class Meta:\n+        swappable = 'TEST_SWAPPED_MODEL'\n+\n+\n+class BadSwappableValue(models.Model):\n+    \"\"\"A model that can be swapped out; during testing, the swappable\n+    value is not of the format app.model\n+    \"\"\"\n+    name = models.CharField(max_length=100)\n+\n+    class Meta:\n+        swappable = 'TEST_SWAPPED_MODEL_BAD_VALUE'\n+\n+\n+class BadSwappableModel(models.Model):\n+    \"\"\"A model that can be swapped out; during testing, the swappable\n+    value references an unknown model.\n+    \"\"\"\n+    name = models.CharField(max_length=100)\n+\n+    class Meta:\n+        swappable = 'TEST_SWAPPED_MODEL_BAD_MODEL'\n+\n+\n+class HardReferenceModel(models.Model):\n+    fk_1 = models.ForeignKey(SwappableModel, related_name='fk_hardref1')\n+    fk_2 = models.ForeignKey('invalid_models.SwappableModel', related_name='fk_hardref2')\n+    fk_3 = models.ForeignKey(SwappedModel, related_name='fk_hardref3')\n+    fk_4 = models.ForeignKey('invalid_models.SwappedModel', related_name='fk_hardref4')\n+    m2m_1 = models.ManyToManyField(SwappableModel, related_name='m2m_hardref1')\n+    m2m_2 = models.ManyToManyField('invalid_models.SwappableModel', related_name='m2m_hardref2')\n+    m2m_3 = models.ManyToManyField(SwappedModel, related_name='m2m_hardref3')\n+    m2m_4 = models.ManyToManyField('invalid_models.SwappedModel', related_name='m2m_hardref4')\n+\n+\n model_errors = \"\"\"invalid_models.fielderrors: \"charfield\": CharFields require a \"max_length\" attribute that is a positive integer.\n invalid_models.fielderrors: \"charfield2\": CharFields require a \"max_length\" attribute that is a positive integer.\n invalid_models.fielderrors: \"charfield3\": CharFields require a \"max_length\" attribute that is a positive integer.\n@@ -353,6 +449,12 @@ class Meta:\n invalid_models.nonexistingorderingwithsingleunderscore: \"ordering\" refers to \"does_not_exist\", a field that doesn't exist.\n invalid_models.invalidsetnull: 'fk' specifies on_delete=SET_NULL, but cannot be null.\n invalid_models.invalidsetdefault: 'fk' specifies on_delete=SET_DEFAULT, but has no default value.\n+invalid_models.hardreferencemodel: 'fk_3' defines a relation with the model 'invalid_models.SwappedModel', which has been swapped out. Update the relation to point at settings.TEST_SWAPPED_MODEL.\n+invalid_models.hardreferencemodel: 'fk_4' defines a relation with the model 'invalid_models.SwappedModel', which has been swapped out. Update the relation to point at settings.TEST_SWAPPED_MODEL.\n+invalid_models.hardreferencemodel: 'm2m_3' defines a relation with the model 'invalid_models.SwappedModel', which has been swapped out. Update the relation to point at settings.TEST_SWAPPED_MODEL.\n+invalid_models.hardreferencemodel: 'm2m_4' defines a relation with the model 'invalid_models.SwappedModel', which has been swapped out. Update the relation to point at settings.TEST_SWAPPED_MODEL.\n+invalid_models.badswappablevalue: TEST_SWAPPED_MODEL_BAD_VALUE is not of the form 'app_label.app_name'.\n+invalid_models.badswappablemodel: Model has been swapped out for 'not_an_app.Target' which has not been installed or is abstract.\n \"\"\"\n \n if not connection.features.interprets_empty_strings_as_nulls:"
        },
        {
            "sha": "6050a2088016a940593b4defe2f9c529162510cb",
            "filename": "tests/modeltests/invalid_models/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fmodeltests%2Finvalid_models%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fmodeltests%2Finvalid_models%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Finvalid_models%2Ftests.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -4,6 +4,7 @@\n from django.core.management.validation import get_validation_errors\n from django.db.models.loading import cache, load_app\n \n+from django.test.utils import override_settings\n from django.utils import unittest\n from django.utils.six import StringIO\n \n@@ -31,14 +32,22 @@ def tearDown(self):\n         cache._get_models_cache = {}\n         sys.stdout = self.old_stdout\n \n+    # Technically, this isn't an override -- TEST_SWAPPED_MODEL must be\n+    # set to *something* in order for the test to work. However, it's\n+    # easier to set this up as an override than to require every developer\n+    # to specify a value in their test settings.\n+    @override_settings(\n+        TEST_SWAPPED_MODEL='invalid_models.Target',\n+        TEST_SWAPPED_MODEL_BAD_VALUE='not-a-model',\n+        TEST_SWAPPED_MODEL_BAD_MODEL='not_an_app.Target',\n+    )\n     def test_invalid_models(self):\n-\n         try:\n             module = load_app(\"modeltests.invalid_models.invalid_models\")\n         except Exception:\n             self.fail('Unable to load invalid model module')\n \n-        count = get_validation_errors(self.stdout, module)\n+        get_validation_errors(self.stdout, module)\n         self.stdout.seek(0)\n         error_log = self.stdout.read()\n         actual = error_log.split('\\n')"
        },
        {
            "sha": "d1c95467ee831f1c9db0c5d1267e3e58a839e371",
            "filename": "tests/modeltests/proxy_models/tests.py",
            "status": "modified",
            "additions": 36,
            "deletions": 2,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fmodeltests%2Fproxy_models%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fmodeltests%2Fproxy_models%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fproxy_models%2Ftests.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -1,10 +1,13 @@\n from __future__ import absolute_import, unicode_literals\n+import copy\n \n+from django.conf import settings\n from django.contrib.contenttypes.models import ContentType\n from django.core import management\n from django.core.exceptions import FieldError\n from django.db import models, DEFAULT_DB_ALIAS\n from django.db.models import signals\n+from django.db.models.loading import cache\n from django.test import TestCase\n \n \n@@ -13,6 +16,7 @@\n     Country, State, StateProxy, TrackerUser, BaseUser, Bug, ProxyTrackerUser,\n     Improvement, ProxyProxyBug, ProxyBug, ProxyImprovement)\n \n+\n class ProxyModelTests(TestCase):\n     def test_same_manager_queries(self):\n         \"\"\"\n@@ -91,7 +95,7 @@ def test_proxy_included_in_ancestors(self):\n         )\n         self.assertRaises(Person.MultipleObjectsReturned,\n             MyPersonProxy.objects.get,\n-            id__lt=max_id+1\n+            id__lt=max_id + 1\n         )\n         self.assertRaises(Person.DoesNotExist,\n             StatusPerson.objects.get,\n@@ -104,7 +108,7 @@ def test_proxy_included_in_ancestors(self):\n \n         self.assertRaises(Person.MultipleObjectsReturned,\n             StatusPerson.objects.get,\n-            id__lt=max_id+1\n+            id__lt=max_id + 1\n         )\n \n     def test_abc(self):\n@@ -138,10 +142,40 @@ def test_new_fields(self):\n         def build_new_fields():\n             class NoNewFields(Person):\n                 newfield = models.BooleanField()\n+\n                 class Meta:\n                     proxy = True\n         self.assertRaises(FieldError, build_new_fields)\n \n+    def test_swappable(self):\n+        try:\n+            # This test adds dummy applications to the app cache. These\n+            # need to be removed in order to prevent bad interactions\n+            # with the flush operation in other tests.\n+            old_app_models = copy.deepcopy(cache.app_models)\n+            old_app_store = copy.deepcopy(cache.app_store)\n+\n+            settings.TEST_SWAPPABLE_MODEL = 'proxy_models.AlternateModel'\n+\n+            class SwappableModel(models.Model):\n+\n+                class Meta:\n+                    swappable = 'TEST_SWAPPABLE_MODEL'\n+\n+            class AlternateModel(models.Model):\n+                pass\n+\n+            # You can't proxy a swapped model\n+            with self.assertRaises(TypeError):\n+                class ProxyModel(SwappableModel):\n+\n+                    class Meta:\n+                        proxy = True\n+        finally:\n+            del settings.TEST_SWAPPABLE_MODEL\n+            cache.app_models = old_app_models\n+            cache.app_store = old_app_store\n+\n     def test_myperson_manager(self):\n         Person.objects.create(name=\"fred\")\n         Person.objects.create(name=\"wilma\")"
        },
        {
            "sha": "284ea942261e13767b4739d817cadfa7aaad2b6d",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 57,
            "deletions": 45,
            "changes": 102,
            "blob_url": "https://github.com/django/django/blob/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/70a0de37d132e5f1514fb939875f69649f103124/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=70a0de37d132e5f1514fb939875f69649f103124",
            "patch": "@@ -52,6 +52,7 @@\n ERROR_MESSAGE = \"Please enter the correct username and password \\\n for a staff account. Note that both fields are case-sensitive.\"\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminViewBasicTest(TestCase):\n     fixtures = ['admin-views-users.xml', 'admin-views-colors.xml',\n@@ -141,7 +142,7 @@ def testBasicAddPost(self):\n             \"article_set-MAX_NUM_FORMS\": \"0\",\n         }\n         response = self.client.post('/test_admin/%s/admin_views/section/add/' % self.urlbit, post_data)\n-        self.assertEqual(response.status_code, 302) # redirect somewhere\n+        self.assertEqual(response.status_code, 302)  # redirect somewhere\n \n     def testPopupAddPost(self):\n         \"\"\"\n@@ -205,7 +206,7 @@ def testBasicEditPost(self):\n         A smoke test to ensure POST on edit_view works.\n         \"\"\"\n         response = self.client.post('/test_admin/%s/admin_views/section/1/' % self.urlbit, self.inline_post_data)\n-        self.assertEqual(response.status_code, 302) # redirect somewhere\n+        self.assertEqual(response.status_code, 302)  # redirect somewhere\n \n     def testEditSaveAs(self):\n         \"\"\"\n@@ -221,7 +222,7 @@ def testEditSaveAs(self):\n             \"article_set-5-section\": \"1\",\n         })\n         response = self.client.post('/test_admin/%s/admin_views/section/1/' % self.urlbit, post_data)\n-        self.assertEqual(response.status_code, 302) # redirect somewhere\n+        self.assertEqual(response.status_code, 302)  # redirect somewhere\n \n     def testChangeListSortingCallable(self):\n         \"\"\"\n@@ -308,7 +309,7 @@ def testChangeListSortingModelMeta(self):\n         self.assertContentBefore(response, link2, link1)\n \n         # Test we can override with query string\n-        response = self.client.get('/test_admin/admin/admin_views/language/', {'o':'-1'})\n+        response = self.client.get('/test_admin/admin/admin_views/language/', {'o': '-1'})\n         self.assertContentBefore(response, link1, link2)\n \n     def testChangeListSortingOverrideModelAdmin(self):\n@@ -358,13 +359,13 @@ def testSortIndicatorsAdminOrder(self):\n         kinds of 'ordering' fields: field names, method on the model\n         admin and model itself, and other callables. See #17252.\n         \"\"\"\n-        models = [(AdminOrderedField,       'adminorderedfield'      ),\n+        models = [(AdminOrderedField, 'adminorderedfield'),\n                   (AdminOrderedModelMethod, 'adminorderedmodelmethod'),\n                   (AdminOrderedAdminMethod, 'adminorderedadminmethod'),\n-                  (AdminOrderedCallable,    'adminorderedcallable'   )]\n+                  (AdminOrderedCallable, 'adminorderedcallable')]\n         for model, url in models:\n-            a1 = model.objects.create(stuff='The Last Item',   order=3)\n-            a2 = model.objects.create(stuff='The First Item',  order=1)\n+            a1 = model.objects.create(stuff='The Last Item', order=3)\n+            a2 = model.objects.create(stuff='The First Item', order=1)\n             a3 = model.objects.create(stuff='The Middle Item', order=2)\n             response = self.client.get('/test_admin/admin/admin_views/%s/' % url, {})\n             self.assertEqual(response.status_code, 200)\n@@ -671,7 +672,6 @@ def testMultiWidgetFirsFieldFocus(self):\n             '<script type=\"text/javascript\">document.getElementById(\"id_start_date_0\").focus();</script>'\n         )\n \n-\n     def test_js_minified_only_if_debug_is_false(self):\n         \"\"\"\n         Ensure that the minified versions of the JS files are only used when\n@@ -709,7 +709,7 @@ def test_js_minified_only_if_debug_is_false(self):\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class SaveAsTests(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n-    fixtures = ['admin-views-users.xml','admin-views-person.xml']\n+    fixtures = ['admin-views-users.xml', 'admin-views-person.xml']\n \n     def setUp(self):\n         self.client.login(username='super', password='secret')\n@@ -719,7 +719,7 @@ def tearDown(self):\n \n     def test_save_as_duplication(self):\n         \"\"\"Ensure save as actually creates a new person\"\"\"\n-        post_data = {'_saveasnew':'', 'name':'John M', 'gender':1, 'age': 42}\n+        post_data = {'_saveasnew': '', 'name': 'John M', 'gender': 1, 'age': 42}\n         response = self.client.post('/test_admin/admin/admin_views/person/1/', post_data)\n         self.assertEqual(len(Person.objects.filter(name='John M')), 1)\n         self.assertEqual(len(Person.objects.filter(id=1)), 1)\n@@ -732,10 +732,11 @@ def test_save_as_display(self):\n         \"\"\"\n         response = self.client.get('/test_admin/admin/admin_views/person/1/')\n         self.assertTrue(response.context['save_as'])\n-        post_data = {'_saveasnew':'', 'name':'John M', 'gender':3, 'alive':'checked'}\n+        post_data = {'_saveasnew': '', 'name': 'John M', 'gender': 3, 'alive': 'checked'}\n         response = self.client.post('/test_admin/admin/admin_views/person/1/', post_data)\n         self.assertEqual(response.context['form_url'], '/test_admin/admin/admin_views/person/add/')\n \n+\n class CustomModelAdminTest(AdminViewBasicTest):\n     urls = \"regressiontests.admin_views.urls\"\n     urlbit = \"admin2\"\n@@ -791,11 +792,13 @@ def testCustomAdminSiteView(self):\n         response = self.client.get('/test_admin/%s/my_view/' % self.urlbit)\n         self.assertEqual(response.content, b\"Django is a magical pony!\")\n \n+\n def get_perm(Model, perm):\n     \"\"\"Return the permission object, for the Model\"\"\"\n     ct = ContentType.objects.get_for_model(Model)\n     return Permission.objects.get(content_type=ct, codename=perm)\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminViewPermissionsTest(TestCase):\n     \"\"\"Tests for Admin Views Permissions.\"\"\"\n@@ -898,7 +901,7 @@ def testLogin(self):\n         response = self.client.get('/test_admin/admin/')\n         self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.super_email_login)\n-        self.assertContains(login, \"Your e-mail address is not your username\")\n+        self.assertContains(login, ERROR_MESSAGE)\n         # only correct passwords get a username hint\n         login = self.client.post('/test_admin/admin/', self.super_email_bad_login)\n         self.assertContains(login, ERROR_MESSAGE)\n@@ -959,7 +962,7 @@ def testLoginSuccessfullyRedirectsToOriginalUrl(self):\n     def testAddView(self):\n         \"\"\"Test add view restricts access and actually adds items.\"\"\"\n \n-        add_dict = {'title' : 'Døm ikke',\n+        add_dict = {'title': 'Døm ikke',\n                     'content': '<p>great article</p>',\n                     'date_0': '2008-03-18', 'date_1': '10:54:39',\n                     'section': 1}\n@@ -1014,7 +1017,7 @@ def testAddView(self):\n     def testChangeView(self):\n         \"\"\"Change view should restrict access and allow users to edit items.\"\"\"\n \n-        change_dict = {'title' : 'Ikke fordømt',\n+        change_dict = {'title': 'Ikke fordømt',\n                        'content': '<p>edited article</p>',\n                        'date_0': '2008-03-18', 'date_1': '10:54:39',\n                        'section': 1}\n@@ -1346,6 +1349,7 @@ def test_generic_relations(self):\n         response = self.client.get('/test_admin/admin/admin_views/plot/%s/delete/' % quote(3))\n         self.assertContains(response, should_contain)\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminViewStringPrimaryKeyTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n@@ -1400,7 +1404,7 @@ def test_recentactions_without_content_type(self):\n         response = self.client.get('/test_admin/admin/')\n         should_contain = \"\"\"<a href=\"admin_views/modelwithstringprimarykey/%s/\">%s</a>\"\"\" % (escape(quote(self.pk)), escape(self.pk))\n         self.assertContains(response, should_contain)\n-        should_contain = \"Model with string primary key\" # capitalized in Recent Actions\n+        should_contain = \"Model with string primary key\"  # capitalized in Recent Actions\n         self.assertContains(response, should_contain)\n         logentry = LogEntry.objects.get(content_type__name__iexact=should_contain)\n         # http://code.djangoproject.com/ticket/10275\n@@ -1522,7 +1526,7 @@ def tearDown(self):\n \n     def test_secure_view_shows_login_if_not_logged_in(self):\n         \"Ensure that we see the login form\"\n-        response = self.client.get('/test_admin/admin/secure-view/' )\n+        response = self.client.get('/test_admin/admin/secure-view/')\n         self.assertTemplateUsed(response, 'admin/login.html')\n \n     def test_secure_view_login_successfully_redirects_to_original_url(self):\n@@ -1556,7 +1560,7 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         response = self.client.get('/test_admin/admin/secure-view/')\n         self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.super_email_login)\n-        self.assertContains(login, \"Your e-mail address is not your username\")\n+        self.assertContains(login, ERROR_MESSAGE)\n         # only correct passwords get a username hint\n         login = self.client.post('/test_admin/admin/secure-view/', self.super_email_bad_login)\n         self.assertContains(login, ERROR_MESSAGE)\n@@ -1626,6 +1630,7 @@ def test_shortcut_view_only_available_to_staff(self):\n         self.assertEqual(response.status_code, 302)\n         self.assertEqual(response['Location'], 'http://example.com/users/super/')\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminViewUnicodeTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n@@ -1668,7 +1673,7 @@ def testUnicodeEdit(self):\n         }\n \n         response = self.client.post('/test_admin/admin/admin_views/book/1/', post_data)\n-        self.assertEqual(response.status_code, 302) # redirect somewhere\n+        self.assertEqual(response.status_code, 302)  # redirect somewhere\n \n     def testUnicodeDelete(self):\n         \"\"\"\n@@ -2035,7 +2040,7 @@ def test_pk_hidden_fields(self):\n         story1 = Story.objects.create(title='The adventures of Guido', content='Once upon a time in Djangoland...')\n         story2 = Story.objects.create(title='Crouching Tiger, Hidden Python', content='The Python was sneaking into...')\n         response = self.client.get('/test_admin/admin/admin_views/story/')\n-        self.assertContains(response, 'id=\"id_form-0-id\"', 1) # Only one hidden field, in a separate place than the table.\n+        self.assertContains(response, 'id=\"id_form-0-id\"', 1)  # Only one hidden field, in a separate place than the table.\n         self.assertContains(response, 'id=\"id_form-1-id\"', 1)\n         self.assertContains(response, '<div class=\"hiddenfields\">\\n<input type=\"hidden\" name=\"form-0-id\" value=\"%d\" id=\"id_form-0-id\" /><input type=\"hidden\" name=\"form-1-id\" value=\"%d\" id=\"id_form-1-id\" />\\n</div>' % (story2.id, story1.id), html=True)\n         self.assertContains(response, '<td>%d</td>' % story1.id, 1)\n@@ -2051,7 +2056,7 @@ def test_pk_hidden_fields_with_list_display_links(self):\n         link1 = reverse('admin:admin_views_otherstory_change', args=(story1.pk,))\n         link2 = reverse('admin:admin_views_otherstory_change', args=(story2.pk,))\n         response = self.client.get('/test_admin/admin/admin_views/otherstory/')\n-        self.assertContains(response, 'id=\"id_form-0-id\"', 1) # Only one hidden field, in a separate place than the table.\n+        self.assertContains(response, 'id=\"id_form-0-id\"', 1)  # Only one hidden field, in a separate place than the table.\n         self.assertContains(response, 'id=\"id_form-1-id\"', 1)\n         self.assertContains(response, '<div class=\"hiddenfields\">\\n<input type=\"hidden\" name=\"form-0-id\" value=\"%d\" id=\"id_form-0-id\" /><input type=\"hidden\" name=\"form-1-id\" value=\"%d\" id=\"id_form-1-id\" />\\n</div>' % (story2.id, story1.id), html=True)\n         self.assertContains(response, '<th><a href=\"%s\">%d</a></th>' % (link1, story1.id), 1)\n@@ -2109,7 +2114,7 @@ def test_beginning_matches(self):\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminInheritedInlinesTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n-    fixtures = ['admin-views-users.xml',]\n+    fixtures = ['admin-views-users.xml']\n \n     def setUp(self):\n         self.client.login(username='super', password='secret')\n@@ -2146,7 +2151,7 @@ def testInline(self):\n         }\n \n         response = self.client.post('/test_admin/admin/admin_views/persona/add/', post_data)\n-        self.assertEqual(response.status_code, 302) # redirect somewhere\n+        self.assertEqual(response.status_code, 302)  # redirect somewhere\n         self.assertEqual(Persona.objects.count(), 1)\n         self.assertEqual(FooAccount.objects.count(), 1)\n         self.assertEqual(BarAccount.objects.count(), 1)\n@@ -2193,6 +2198,7 @@ def testInline(self):\n         self.assertEqual(BarAccount.objects.all()[0].username, \"%s-1\" % bar_user)\n         self.assertEqual(Persona.objects.all()[0].accounts.count(), 2)\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminActionsTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n@@ -2208,7 +2214,7 @@ def test_model_admin_custom_action(self):\n         \"Tests a custom action defined in a ModelAdmin method\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [1],\n-            'action' : 'mail_admin',\n+            'action': 'mail_admin',\n             'index': 0,\n         }\n         response = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n@@ -2219,12 +2225,12 @@ def test_model_admin_default_delete_action(self):\n         \"Tests the default delete action defined as a ModelAdmin method\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [1, 2],\n-            'action' : 'delete_selected',\n+            'action': 'delete_selected',\n             'index': 0,\n         }\n         delete_confirmation_data = {\n             ACTION_CHECKBOX_NAME: [1, 2],\n-            'action' : 'delete_selected',\n+            'action': 'delete_selected',\n             'post': 'yes',\n         }\n         confirmation = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n@@ -2248,12 +2254,12 @@ def test_non_localized_pk(self):\n         subscriber.save()\n         action_data = {\n             ACTION_CHECKBOX_NAME: [9999, 2],\n-            'action' : 'delete_selected',\n+            'action': 'delete_selected',\n             'index': 0,\n         }\n         response = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n         self.assertTemplateUsed(response, 'admin/delete_selected_confirmation.html')\n-        self.assertContains(response, 'value=\"9999\"') # Instead of 9,999\n+        self.assertContains(response, 'value=\"9999\"')  # Instead of 9,999\n         self.assertContains(response, 'value=\"2\"')\n         settings.USE_THOUSAND_SEPARATOR = self.old_USE_THOUSAND_SEPARATOR\n         settings.USE_L10N = self.old_USE_L10N\n@@ -2270,7 +2276,7 @@ def test_model_admin_default_delete_action_protected(self):\n \n         action_data = {\n             ACTION_CHECKBOX_NAME: [q1.pk, q2.pk],\n-            'action' : 'delete_selected',\n+            'action': 'delete_selected',\n             'index': 0,\n         }\n \n@@ -2284,7 +2290,7 @@ def test_custom_function_mail_action(self):\n         \"Tests a custom action defined in a function\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [1],\n-            'action' : 'external_mail',\n+            'action': 'external_mail',\n             'index': 0,\n         }\n         response = self.client.post('/test_admin/admin/admin_views/externalsubscriber/', action_data)\n@@ -2295,7 +2301,7 @@ def test_custom_function_action_with_redirect(self):\n         \"Tests a custom action defined in a function\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [1],\n-            'action' : 'redirect_to',\n+            'action': 'redirect_to',\n             'index': 0,\n         }\n         response = self.client.post('/test_admin/admin/admin_views/externalsubscriber/', action_data)\n@@ -2309,7 +2315,7 @@ def test_default_redirect(self):\n         \"\"\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [1],\n-            'action' : 'external_mail',\n+            'action': 'external_mail',\n             'index': 0,\n         }\n         url = '/test_admin/admin/admin_views/externalsubscriber/?o=1'\n@@ -2374,7 +2380,7 @@ def test_user_message_on_none_selected(self):\n         \"\"\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [],\n-            'action' : 'delete_selected',\n+            'action': 'delete_selected',\n             'index': 0,\n         }\n         response = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n@@ -2388,7 +2394,7 @@ def test_user_message_on_no_action(self):\n         \"\"\"\n         action_data = {\n             ACTION_CHECKBOX_NAME: [1, 2],\n-            'action' : '',\n+            'action': '',\n             'index': 0,\n         }\n         response = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n@@ -2432,7 +2438,7 @@ def test_custom_changelist(self):\n         # Insert some data\n         post_data = {\"name\": \"First Gadget\"}\n         response = self.client.post('/test_admin/%s/admin_views/gadget/add/' % self.urlbit, post_data)\n-        self.assertEqual(response.status_code, 302) # redirect somewhere\n+        self.assertEqual(response.status_code, 302)  # redirect somewhere\n         # Hit the page once to get messages out of the queue message list\n         response = self.client.get('/test_admin/%s/admin_views/gadget/' % self.urlbit)\n         # Ensure that that data is still not visible on the page\n@@ -2460,6 +2466,7 @@ def test(self):\n         response = self.client.get('/test_admin/admin/admin_views/parent/add/')\n         self.assertEqual(response.status_code, 200)\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminCustomQuerysetTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n@@ -2516,6 +2523,7 @@ def test_add_model_modeladmin_only_qs(self):\n         # Message should contain non-ugly model name. Instance representation is set by model's __unicode__()\n         self.assertContains(response, '<li class=\"info\">The cover letter &quot;John Doe II&quot; was changed successfully.</li>', html=True)\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminInlineFileUploadTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n@@ -2656,7 +2664,7 @@ def setUp(self):\n \n         result = self.client.login(username='super', password='secret')\n         self.assertEqual(result, True)\n-        self.collector = Collector(pk=1,name='John Fowles')\n+        self.collector = Collector(pk=1, name='John Fowles')\n         self.collector.save()\n \n     def tearDown(self):\n@@ -2982,14 +2990,14 @@ def test_prepopulated_off(self):\n         self.assertNotContains(response, \"field['dependency_ids'].push('#id_title');\")\n         self.assertNotContains(response, \"id: '#id_prepopulatedsubpost_set-0-subslug',\")\n \n-    @override_settings(USE_THOUSAND_SEPARATOR = True, USE_L10N = True)\n+    @override_settings(USE_THOUSAND_SEPARATOR=True, USE_L10N=True)\n     def test_prepopulated_maxlength_localized(self):\n         \"\"\"\n         Regression test for #15938: if USE_THOUSAND_SEPARATOR is set, make sure\n         that maxLength (in the JavaScript) is rendered without separators.\n         \"\"\"\n         response = self.client.get('/test_admin/admin/admin_views/prepopulatedpostlargeslug/add/')\n-        self.assertContains(response, \"maxLength: 1000\") # instead of 1,000\n+        self.assertContains(response, \"maxLength: 1000\")  # instead of 1,000\n \n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n@@ -3035,8 +3043,8 @@ def test_basic(self):\n         self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-name').send_keys(' now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooog text... ')\n         slug1 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-slug1').get_attribute('value')\n         slug2 = self.selenium.find_element_by_css_selector('#id_relatedprepopulated_set-1-slug2').get_attribute('value')\n-        self.assertEqual(slug1, 'now-you-have-another-stacked-inline-very-loooooooo') # 50 characters maximum for slug1 field\n-        self.assertEqual(slug2, 'option-two-now-you-have-another-stacked-inline-very-looooooo') # 60 characters maximum for slug2 field\n+        self.assertEqual(slug1, 'now-you-have-another-stacked-inline-very-loooooooo')  # 50 characters maximum for slug1 field\n+        self.assertEqual(slug2, 'option-two-now-you-have-another-stacked-inline-very-looooooo')  # 60 characters maximum for slug2 field\n \n         # Tabular inlines ----------------------------------------------------\n         # Initial inline\n@@ -3087,7 +3095,7 @@ def test_basic(self):\n             slug2='option-one-here-stacked-inline',\n         )\n         RelatedPrepopulated.objects.get(\n-            name=' now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooo', # 75 characters in name field\n+            name=' now you haVe anöther   sŤāÇkeð  inline with a very ... loooooooooooooooooo',  # 75 characters in name field\n             pubdate='1999-01-25',\n             status='option two',\n             slug1='now-you-have-another-stacked-inline-very-loooooooo',\n@@ -3112,6 +3120,7 @@ def test_basic(self):\n class SeleniumPrePopulatedChromeTests(SeleniumPrePopulatedFirefoxTests):\n     webdriver_class = 'selenium.webdriver.chrome.webdriver.WebDriver'\n \n+\n class SeleniumPrePopulatedIETests(SeleniumPrePopulatedFirefoxTests):\n     webdriver_class = 'selenium.webdriver.ie.webdriver.WebDriver'\n \n@@ -3172,7 +3181,7 @@ def test_readonly_post(self):\n         p = Post.objects.get()\n         self.assertEqual(p.posted, datetime.date.today())\n \n-        data[\"posted\"] = \"10-8-1990\" # some date that's not today\n+        data[\"posted\"] = \"10-8-1990\"  # some date that's not today\n         response = self.client.post('/test_admin/admin/admin_views/post/add/', data)\n         self.assertEqual(response.status_code, 302)\n         self.assertEqual(Post.objects.count(), 2)\n@@ -3214,7 +3223,7 @@ def test_limit_choices_to(self):\n         response = self.client.get('/test_admin/admin/admin_views/sketch/add/')\n         # Find the link\n         m = re.search(br'<a href=\"([^\"]*)\"[^>]* id=\"lookup_id_inquisition\"', response.content)\n-        self.assertTrue(m) # Got a match\n+        self.assertTrue(m)  # Got a match\n         popup_url = m.groups()[0].decode().replace(\"&amp;\", \"&\")\n \n         # Handle relative links\n@@ -3224,6 +3233,7 @@ def test_limit_choices_to(self):\n         self.assertContains(response2, \"Spain\")\n         self.assertNotContains(response2, \"England\")\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class UserAdminTest(TestCase):\n     \"\"\"\n@@ -3378,7 +3388,7 @@ def test_css_classes(self):\n         self.assertContains(response, 'class=\"form-row field-awesomeness_level\"')\n         self.assertContains(response, 'class=\"form-row field-coolness\"')\n         self.assertContains(response, 'class=\"form-row field-value\"')\n-        self.assertContains(response, 'class=\"form-row\"') # The lambda function\n+        self.assertContains(response, 'class=\"form-row\"')  # The lambda function\n \n         # The tabular inline\n         self.assertContains(response, '<td class=\"field-url\">')\n@@ -3390,6 +3400,7 @@ def test_css_classes(self):\n except ImportError:\n     docutils = None\n \n+\n @unittest.skipUnless(docutils, \"no docutils installed.\")\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminDocsTest(TestCase):\n@@ -3448,7 +3459,7 @@ def tearDown(self):\n \n     @override_settings(\n         TEMPLATE_CONTEXT_PROCESSORS=filter(\n-            lambda t:t!='django.core.context_processors.i18n',\n+            lambda t: t != 'django.core.context_processors.i18n',\n             global_settings.TEMPLATE_CONTEXT_PROCESSORS),\n         USE_I18N=False,\n     )\n@@ -3585,6 +3596,7 @@ def test_multiple_years(self):\n             self.assert_non_localized_year(response, 2003)\n             self.assert_non_localized_year(response, 2005)\n \n+\n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminCustomSaveRelatedTests(TestCase):\n     \"\"\""
        }
    ],
    "stats": {
        "total": 1755,
        "additions": 1412,
        "deletions": 343
    }
}