{
    "author": "claudep",
    "message": "Fixed #19923 -- Display tracebacks for non-CommandError exceptions\n\nBy default, show tracebacks for management command errors when the\nexception is not a CommandError.\nThanks Jacob Radford for the report.",
    "sha": "6a91b638423de954b7d96c38e2372100800139fb",
    "files": [
        {
            "sha": "e6a968bbada1dda59f9c465fb318116bbb3fe809",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a91b638423de954b7d96c38e2372100800139fb/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a91b638423de954b7d96c38e2372100800139fb/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=6a91b638423de954b7d96c38e2372100800139fb",
            "patch": "@@ -241,7 +241,7 @@ def run_from_argv(self, argv):\n         except Exception as e:\n             # self.stderr is not guaranteed to be set here\n             stderr = getattr(self, 'stderr', OutputWrapper(sys.stderr, self.style.ERROR))\n-            if options.traceback:\n+            if options.traceback or not isinstance(e, CommandError):\n                 stderr.write(traceback.format_exc())\n             else:\n                 stderr.write('%s: %s' % (e.__class__.__name__, e))"
        },
        {
            "sha": "d31e30a14d3fade4fc3eef27e6744b45b5ca5b4d",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/6a91b638423de954b7d96c38e2372100800139fb/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/6a91b638423de954b7d96c38e2372100800139fb/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=6a91b638423de954b7d96c38e2372100800139fb",
            "patch": "@@ -1342,8 +1342,13 @@ Example usage::\n     django-admin.py syncdb --traceback\n \n By default, ``django-admin.py`` will show a simple error message whenever an\n-error occurs. If you specify ``--traceback``, ``django-admin.py``  will\n-output a full stack trace whenever an exception is raised.\n+:class:`~django.core.management.CommandError` occurs, but a full stack trace\n+for any other exception. If you specify ``--traceback``, ``django-admin.py``\n+will also output a full stack trace when a ``CommandError`` is raised.\n+\n+.. versionchanged:: 1.6\n+    Previously, Django didn't show a full stack trace by default for exceptions\n+    other than ``CommandError``.\n \n .. django-admin-option:: --verbosity\n "
        },
        {
            "sha": "90f77206cdfe9b9ffee0796cac4cb7e457bc6b88",
            "filename": "tests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 4,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/6a91b638423de954b7d96c38e2372100800139fb/tests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a91b638423de954b7d96c38e2372100800139fb/tests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fadmin_scripts%2Ftests.py?ref=6a91b638423de954b7d96c38e2372100800139fb",
            "patch": "@@ -16,7 +16,7 @@\n \n from django import conf, bin, get_version\n from django.conf import settings\n-from django.core.management import BaseCommand\n+from django.core.management import BaseCommand, CommandError\n from django.db import connection\n from django.test.simple import DjangoTestSuiteRunner\n from django.utils import unittest\n@@ -1297,22 +1297,34 @@ def test_base_run_from_argv(self):\n         Also test proper traceback display.\n         \"\"\"\n         command = BaseCommand()\n-        command.execute = lambda args: args  # This will trigger TypeError\n+        def raise_command_error(*args, **kwargs):\n+            raise CommandError(\"Custom error\")\n \n         old_stderr = sys.stderr\n         sys.stderr = err = StringIO()\n         try:\n+            command.execute = lambda args: args  # This will trigger TypeError\n             with self.assertRaises(SystemExit):\n                 command.run_from_argv(['', ''])\n             err_message = err.getvalue()\n-            self.assertNotIn(\"Traceback\", err_message)\n+            # Exceptions other than CommandError automatically output the traceback\n+            self.assertIn(\"Traceback\", err_message)\n             self.assertIn(\"TypeError\", err_message)\n \n+            command.execute = raise_command_error\n+            err.truncate(0)\n+            with self.assertRaises(SystemExit):\n+                command.run_from_argv(['', ''])\n+            err_message = err.getvalue()\n+            self.assertNotIn(\"Traceback\", err_message)\n+            self.assertIn(\"CommandError\", err_message)\n+\n+            err.truncate(0)\n             with self.assertRaises(SystemExit):\n                 command.run_from_argv(['', '', '--traceback'])\n             err_message = err.getvalue()\n             self.assertIn(\"Traceback (most recent call last)\", err_message)\n-            self.assertIn(\"TypeError\", err_message)\n+            self.assertIn(\"CommandError\", err_message)\n         finally:\n             sys.stderr = old_stderr\n "
        }
    ],
    "stats": {
        "total": 31,
        "additions": 24,
        "deletions": 7
    }
}