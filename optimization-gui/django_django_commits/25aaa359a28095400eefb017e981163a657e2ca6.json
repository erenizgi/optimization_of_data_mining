{
    "author": "spookylukey",
    "message": "Removed Django 1.2 compatibility fallback for password reset hash\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15950 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "25aaa359a28095400eefb017e981163a657e2ca6",
    "files": [
        {
            "sha": "9211e062f1fd405a27c487252b2d38af7ba3d596",
            "filename": "django/contrib/auth/tests/tokens.py",
            "status": "modified",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/25aaa359a28095400eefb017e981163a657e2ca6/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/25aaa359a28095400eefb017e981163a657e2ca6/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py?ref=25aaa359a28095400eefb017e981163a657e2ca6",
            "patch": "@@ -51,28 +51,6 @@ def _today(self):\n         p2 = Mocked(date.today() + timedelta(settings.PASSWORD_RESET_TIMEOUT_DAYS + 1))\n         self.assertFalse(p2.check_token(user, tk1))\n \n-    def test_django12_hash(self):\n-        \"\"\"\n-        Ensure we can use the hashes generated by Django 1.2\n-        \"\"\"\n-        # Hard code in the Django 1.2 algorithm (not the result, as it is time\n-        # dependent)\n-        def _make_token(user):\n-            import hashlib\n-            from django.utils.http import int_to_base36\n-\n-            timestamp = (date.today() - date(2001,1,1)).days\n-            ts_b36 = int_to_base36(timestamp)\n-            hash = hashlib.sha1(settings.SECRET_KEY + unicode(user.id) +\n-                               user.password + user.last_login.strftime('%Y-%m-%d %H:%M:%S') +\n-                               unicode(timestamp)).hexdigest()[::2]\n-            return \"%s-%s\" % (ts_b36, hash)\n-\n-        user = User.objects.create_user('tokentestuser', 'test2@example.com', 'testpw')\n-        p0 = PasswordResetTokenGenerator()\n-        tk1 = _make_token(user)\n-        self.assertTrue(p0.check_token(user, tk1))\n-\n     def test_date_length(self):\n         \"\"\"\n         Make sure we don't allow overly long dates, causing a potential DoS."
        },
        {
            "sha": "db614135c0c7b723f74265a1ab22566a270b24b6",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 1,
            "deletions": 14,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/25aaa359a28095400eefb017e981163a657e2ca6/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/25aaa359a28095400eefb017e981163a657e2ca6/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=25aaa359a28095400eefb017e981163a657e2ca6",
            "patch": "@@ -1,5 +1,4 @@\n from datetime import date\n-import hashlib\n from django.conf import settings\n from django.utils.http import int_to_base36, base36_to_int\n from django.utils.crypto import constant_time_compare, salted_hmac\n@@ -33,11 +32,7 @@ def check_token(self, user, token):\n \n         # Check that the timestamp/uid has not been tampered with\n         if not constant_time_compare(self._make_token_with_timestamp(user, ts), token):\n-            # Fallback to Django 1.2 method for compatibility.\n-            # PendingDeprecationWarning <- here to remind us to remove this in\n-            # Django 1.5\n-            if not constant_time_compare(self._make_token_with_timestamp_old(user, ts), token):\n-                return False\n+            return False\n \n         # Check the timestamp is within limit\n         if (self._num_days(self._today()) - ts) > settings.PASSWORD_RESET_TIMEOUT_DAYS:\n@@ -63,14 +58,6 @@ def _make_token_with_timestamp(self, user, timestamp):\n         hash = salted_hmac(key_salt, value).hexdigest()[::2]\n         return \"%s-%s\" % (ts_b36, hash)\n \n-    def _make_token_with_timestamp_old(self, user, timestamp):\n-        # The Django 1.2 method\n-        ts_b36 = int_to_base36(timestamp)\n-        hash = hashlib.sha1(settings.SECRET_KEY + unicode(user.id) +\n-                           user.password + user.last_login.strftime('%Y-%m-%d %H:%M:%S') +\n-                           unicode(timestamp)).hexdigest()[::2]\n-        return \"%s-%s\" % (ts_b36, hash)\n-\n     def _num_days(self, dt):\n         return (dt - date(2001,1,1)).days\n "
        }
    ],
    "stats": {
        "total": 37,
        "additions": 1,
        "deletions": 36
    }
}