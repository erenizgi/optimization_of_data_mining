{
    "author": "jezdez",
    "message": "Fixed #8527 -- Made CAPostalCodeField more forgiving of the input format. Thanks to Claude Paroz.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16175 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "02b837d38a37239dcd7366e7735e12aff51ab790",
    "files": [
        {
            "sha": "ac393de397e2ec416ed0ca5a9fdd326704b3ff6b",
            "filename": "django/contrib/localflavor/ca/forms.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/02b837d38a37239dcd7366e7735e12aff51ab790/django%2Fcontrib%2Flocalflavor%2Fca%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/02b837d38a37239dcd7366e7735e12aff51ab790/django%2Fcontrib%2Flocalflavor%2Fca%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fca%2Fforms.py?ref=02b837d38a37239dcd7366e7735e12aff51ab790",
            "patch": "@@ -4,15 +4,15 @@\n \n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n-from django.forms.fields import Field, RegexField, Select\n+from django.forms.fields import Field, CharField, Select\n from django.utils.encoding import smart_unicode\n from django.utils.translation import ugettext_lazy as _\n import re\n \n phone_digits_re = re.compile(r'^(?:1-?)?(\\d{3})[-\\.]?(\\d{3})[-\\.]?(\\d{4})$')\n sin_re = re.compile(r\"^(\\d{3})-(\\d{3})-(\\d{3})$\")\n \n-class CAPostalCodeField(RegexField):\n+class CAPostalCodeField(CharField):\n     \"\"\"\n     Canadian postal code field.\n \n@@ -25,9 +25,17 @@ class CAPostalCodeField(RegexField):\n         'invalid': _(u'Enter a postal code in the format XXX XXX.'),\n     }\n \n-    def __init__(self, max_length=None, min_length=None, *args, **kwargs):\n-        super(CAPostalCodeField, self).__init__(r'^[ABCEGHJKLMNPRSTVXY]\\d[ABCEGHJKLMNPRSTVWXYZ] \\d[ABCEGHJKLMNPRSTVWXYZ]\\d$',\n-            max_length, min_length, *args, **kwargs)\n+    postcode_regex = re.compile(r'^([ABCEGHJKLMNPRSTVXY]\\d[ABCEGHJKLMNPRSTVWXYZ]) *(\\d[ABCEGHJKLMNPRSTVWXYZ]\\d)$')\n+\n+    def clean(self, value):\n+        value = super(CAPostalCodeField, self).clean(value)\n+        if value in EMPTY_VALUES:\n+            return u''\n+        postcode = value.upper().strip()\n+        m = self.postcode_regex.match(postcode)\n+        if not m:\n+            raise ValidationError(self.default_error_messages['invalid'])\n+        return \"%s %s\" % (m.group(1), m.group(2))\n \n class CAPhoneNumberField(Field):\n     \"\"\"Canadian phone number field.\"\"\""
        },
        {
            "sha": "8a17ed26e706cb40b147639bdac4ea6e9fae55ac",
            "filename": "tests/regressiontests/forms/localflavor/ca.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/02b837d38a37239dcd7366e7735e12aff51ab790/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fca.py",
            "raw_url": "https://github.com/django/django/raw/02b837d38a37239dcd7366e7735e12aff51ab790/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fca.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fca.py?ref=02b837d38a37239dcd7366e7735e12aff51ab790",
            "patch": "@@ -45,13 +45,17 @@ def test_CAPostalCodeField(self):\n             'T2S 2W7': 'T2S 2W7',\n             'T2S 2Z7': 'T2S 2Z7',\n             'T2Z 2H7': 'T2Z 2H7',\n-\n+            'T2S2H7' : 'T2S 2H7',\n+            't2s 2h7': 'T2S 2H7',\n+            't2s2h7' : 'T2S 2H7',\n+            't2s            2H7': 'T2S 2H7',\n+            '  t2s    2H7  ': 'T2S 2H7',\n         }\n         invalid = {\n-            'T2S2H7' : error_format,\n             'T2S 2H' : error_format,\n             '2T6 H8I': error_format,\n             'T2S2H' : error_format,\n+            't2s h8i': error_format,\n             90210 : error_format,\n             'W2S 2H3': error_format,\n             'Z2S 2H3': error_format,"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 19,
        "deletions": 7
    }
}