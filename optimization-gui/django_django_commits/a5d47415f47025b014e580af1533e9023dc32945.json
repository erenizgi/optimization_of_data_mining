{
    "author": "claudep",
    "message": "Enabled SimpleTestCase to be decorated by override_settings\n\nRefs #18417. Also fixed some test case classes which subclassed\nthe wrong parent.",
    "sha": "a5d47415f47025b014e580af1533e9023dc32945",
    "files": [
        {
            "sha": "f673a10d0811419bcf497fbe56bb8c3e3c923627",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 35,
            "deletions": 29,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/a5d47415f47025b014e580af1533e9023dc32945/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/a5d47415f47025b014e580af1533e9023dc32945/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=a5d47415f47025b014e580af1533e9023dc32945",
            "patch": "@@ -241,6 +241,40 @@ def message(self):\n \n \n class SimpleTestCase(ut2.TestCase):\n+    def __call__(self, result=None):\n+        \"\"\"\n+        Wrapper around default __call__ method to perform common Django test\n+        set up. This means that user-defined Test Cases aren't required to\n+        include a call to super().setUp().\n+        \"\"\"\n+        testMethod = getattr(self, self._testMethodName)\n+        skipped = (getattr(self.__class__, \"__unittest_skip__\", False) or\n+            getattr(testMethod, \"__unittest_skip__\", False))\n+\n+        if not skipped:\n+            try:\n+                self._pre_setup()\n+            except (KeyboardInterrupt, SystemExit):\n+                raise\n+            except Exception:\n+                result.addError(self, sys.exc_info())\n+                return\n+        super(SimpleTestCase, self).__call__(result)\n+        if not skipped:\n+            try:\n+                self._post_teardown()\n+            except (KeyboardInterrupt, SystemExit):\n+                raise\n+            except Exception:\n+                result.addError(self, sys.exc_info())\n+                return\n+\n+    def _pre_setup(self):\n+        pass\n+\n+    def _post_teardown(self):\n+        pass\n+\n     def save_warnings_state(self):\n         \"\"\"\n         Saves the state of the warnings module\n@@ -412,6 +446,7 @@ def _pre_setup(self):\n               ROOT_URLCONF with it.\n             * Clearing the mail test outbox.\n         \"\"\"\n+        self.client = self.client_class()\n         self._fixture_setup()\n         self._urlconf_setup()\n         mail.outbox = []\n@@ -459,35 +494,6 @@ def _urlconf_setup(self):\n             settings.ROOT_URLCONF = self.urls\n             clear_url_caches()\n \n-    def __call__(self, result=None):\n-        \"\"\"\n-        Wrapper around default __call__ method to perform common Django test\n-        set up. This means that user-defined Test Cases aren't required to\n-        include a call to super().setUp().\n-        \"\"\"\n-        testMethod = getattr(self, self._testMethodName)\n-        skipped = (getattr(self.__class__, \"__unittest_skip__\", False) or\n-            getattr(testMethod, \"__unittest_skip__\", False))\n-\n-        if not skipped:\n-            self.client = self.client_class()\n-            try:\n-                self._pre_setup()\n-            except (KeyboardInterrupt, SystemExit):\n-                raise\n-            except Exception:\n-                result.addError(self, sys.exc_info())\n-                return\n-        super(TransactionTestCase, self).__call__(result)\n-        if not skipped:\n-            try:\n-                self._post_teardown()\n-            except (KeyboardInterrupt, SystemExit):\n-                raise\n-            except Exception:\n-                result.addError(self, sys.exc_info())\n-                return\n-\n     def _post_teardown(self):\n         \"\"\" Performs any post-test things. This includes:\n "
        },
        {
            "sha": "8114ae0e6a07ef84952d46e434b4b449f1ffacfb",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/a5d47415f47025b014e580af1533e9023dc32945/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/a5d47415f47025b014e580af1533e9023dc32945/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=a5d47415f47025b014e580af1533e9023dc32945",
            "patch": "@@ -187,11 +187,11 @@ def __exit__(self, exc_type, exc_value, traceback):\n         self.disable()\n \n     def __call__(self, test_func):\n-        from django.test import TransactionTestCase\n+        from django.test import SimpleTestCase\n         if isinstance(test_func, type):\n-            if not issubclass(test_func, TransactionTestCase):\n+            if not issubclass(test_func, SimpleTestCase):\n                 raise Exception(\n-                    \"Only subclasses of Django TransactionTestCase can be decorated \"\n+                    \"Only subclasses of Django SimpleTestCase can be decorated \"\n                     \"with override_settings\")\n             original_pre_setup = test_func._pre_setup\n             original_post_teardown = test_func._post_teardown"
        },
        {
            "sha": "d34125fa29093fbc753e35d5c969870c5727c8ce",
            "filename": "tests/regressiontests/forms/tests/input_formats.py",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/a5d47415f47025b014e580af1533e9023dc32945/tests%2Fregressiontests%2Fforms%2Ftests%2Finput_formats.py",
            "raw_url": "https://github.com/django/django/raw/a5d47415f47025b014e580af1533e9023dc32945/tests%2Fregressiontests%2Fforms%2Ftests%2Finput_formats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Finput_formats.py?ref=a5d47415f47025b014e580af1533e9023dc32945",
            "patch": "@@ -3,11 +3,11 @@\n from django import forms\n from django.test.utils import override_settings\n from django.utils.translation import activate, deactivate\n-from django.utils.unittest import TestCase\n+from django.test import SimpleTestCase\n \n \n @override_settings(TIME_INPUT_FORMATS=[\"%I:%M:%S %p\", \"%I:%M %p\"], USE_L10N=True)\n-class LocalizedTimeTests(TestCase):\n+class LocalizedTimeTests(SimpleTestCase):\n     def setUp(self):\n         activate('de')\n \n@@ -106,7 +106,7 @@ def test_localized_timeField_with_inputformat(self):\n \n \n @override_settings(TIME_INPUT_FORMATS=[\"%I:%M:%S %p\", \"%I:%M %p\"])\n-class CustomTimeInputFormatsTests(TestCase):\n+class CustomTimeInputFormatsTests(SimpleTestCase):\n     def test_timeField(self):\n         \"TimeFields can parse dates in the default format\"\n         f = forms.TimeField()\n@@ -198,7 +198,7 @@ def test_localized_timeField_with_inputformat(self):\n         self.assertEqual(text, \"01:30:00 PM\")\n \n \n-class SimpleTimeFormatTests(TestCase):\n+class SimpleTimeFormatTests(SimpleTestCase):\n     def test_timeField(self):\n         \"TimeFields can parse dates in the default format\"\n         f = forms.TimeField()\n@@ -289,7 +289,7 @@ def test_localized_timeField_with_inputformat(self):\n \n \n @override_settings(DATE_INPUT_FORMATS=[\"%d/%m/%Y\", \"%d-%m-%Y\"], USE_L10N=True)\n-class LocalizedDateTests(TestCase):\n+class LocalizedDateTests(SimpleTestCase):\n     def setUp(self):\n         activate('de')\n \n@@ -390,7 +390,7 @@ def test_localized_dateField_with_inputformat(self):\n \n \n @override_settings(DATE_INPUT_FORMATS=[\"%d.%m.%Y\", \"%d-%m-%Y\"])\n-class CustomDateInputFormatsTests(TestCase):\n+class CustomDateInputFormatsTests(SimpleTestCase):\n     def test_dateField(self):\n         \"DateFields can parse dates in the default format\"\n         f = forms.DateField()\n@@ -481,7 +481,7 @@ def test_localized_dateField_with_inputformat(self):\n         text = f.widget._format_value(result)\n         self.assertEqual(text, \"21.12.2010\")\n \n-class SimpleDateFormatTests(TestCase):\n+class SimpleDateFormatTests(SimpleTestCase):\n     def test_dateField(self):\n         \"DateFields can parse dates in the default format\"\n         f = forms.DateField()\n@@ -572,7 +572,7 @@ def test_localized_dateField_with_inputformat(self):\n \n \n @override_settings(DATETIME_INPUT_FORMATS=[\"%I:%M:%S %p %d/%m/%Y\", \"%I:%M %p %d-%m-%Y\"], USE_L10N=True)\n-class LocalizedDateTimeTests(TestCase):\n+class LocalizedDateTimeTests(SimpleTestCase):\n     def setUp(self):\n         activate('de')\n \n@@ -673,7 +673,7 @@ def test_localized_dateTimeField_with_inputformat(self):\n \n \n @override_settings(DATETIME_INPUT_FORMATS=[\"%I:%M:%S %p %d/%m/%Y\", \"%I:%M %p %d-%m-%Y\"])\n-class CustomDateTimeInputFormatsTests(TestCase):\n+class CustomDateTimeInputFormatsTests(SimpleTestCase):\n     def test_dateTimeField(self):\n         \"DateTimeFields can parse dates in the default format\"\n         f = forms.DateTimeField()\n@@ -764,7 +764,7 @@ def test_localized_dateTimeField_with_inputformat(self):\n         text = f.widget._format_value(result)\n         self.assertEqual(text, \"01:30:00 PM 21/12/2010\")\n \n-class SimpleDateTimeFormatTests(TestCase):\n+class SimpleDateTimeFormatTests(SimpleTestCase):\n     def test_dateTimeField(self):\n         \"DateTimeFields can parse dates in the default format\"\n         f = forms.DateTimeField()"
        },
        {
            "sha": "68f620b5c9909e1a5df57a26e69e8b3797e33c80",
            "filename": "tests/regressiontests/settings_tests/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/a5d47415f47025b014e580af1533e9023dc32945/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a5d47415f47025b014e580af1533e9023dc32945/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py?ref=a5d47415f47025b014e580af1533e9023dc32945",
            "patch": "@@ -4,7 +4,7 @@\n from django.conf import settings, global_settings\n from django.core.exceptions import ImproperlyConfigured\n from django.http import HttpRequest\n-from django.test import TransactionTestCase, TestCase, signals\n+from django.test import SimpleTestCase, TransactionTestCase, TestCase, signals\n from django.test.utils import override_settings\n from django.utils import unittest, six\n \n@@ -118,19 +118,19 @@ def test_context_manager(self):\n         self.assertRaises(AttributeError, getattr, settings, 'TEST')\n \n     def test_class_decorator(self):\n-        # TransactionTestCase can be decorated by override_settings, but not ut.TestCase\n-        class TransactionTestCaseSubclass(TransactionTestCase):\n+        # SimpleTestCase can be decorated by override_settings, but not ut.TestCase\n+        class SimpleTestCaseSubclass(SimpleTestCase):\n             pass\n \n         class UnittestTestCaseSubclass(unittest.TestCase):\n             pass\n \n-        decorated = override_settings(TEST='override')(TransactionTestCaseSubclass)\n+        decorated = override_settings(TEST='override')(SimpleTestCaseSubclass)\n         self.assertIsInstance(decorated, type)\n-        self.assertTrue(issubclass(decorated, TransactionTestCase))\n+        self.assertTrue(issubclass(decorated, SimpleTestCase))\n \n         with six.assertRaisesRegex(self, Exception,\n-                \"Only subclasses of Django TransactionTestCase*\"):\n+                \"Only subclasses of Django SimpleTestCase*\"):\n             decorated = override_settings(TEST='override')(UnittestTestCaseSubclass)\n \n     def test_signal_callback_context_manager(self):"
        }
    ],
    "stats": {
        "total": 102,
        "additions": 54,
        "deletions": 48
    }
}