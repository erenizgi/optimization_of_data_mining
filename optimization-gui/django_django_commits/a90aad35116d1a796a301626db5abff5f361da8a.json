{
    "author": "jphalip",
    "message": "Fixed #17521 -- Made the minified JS files be used in the admin only when `DEBUG` is `False`. Thanks to Travis Swicegood for the suggestion and patch, and to viciu for the tests.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17454 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a90aad35116d1a796a301626db5abff5f361da8a",
    "files": [
        {
            "sha": "ee4ff976a3da07c97e120641f5aaf750b3f2cd6e",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/a90aad35116d1a796a301626db5abff5f361da8a/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/a90aad35116d1a796a301626db5abff5f361da8a/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=a90aad35116d1a796a301626db5abff5f361da8a",
            "patch": "@@ -1,5 +1,6 @@\n from functools import update_wrapper, partial\n from django import forms\n+from django.conf import settings\n from django.forms.formsets import all_valid\n from django.forms.models import (modelform_factory, modelformset_factory,\n     inlineformset_factory, BaseInlineFormSet)\n@@ -394,16 +395,17 @@ def urls(self):\n \n     @property\n     def media(self):\n+        extra = \"\" if settings.DEBUG else \".min\"\n         js = [\n             'core.js',\n             'admin/RelatedObjectLookups.js',\n-            'jquery.min.js',\n+            'jquery%s.js' % extra,\n             'jquery.init.js'\n         ]\n         if self.actions is not None:\n-            js.append('actions.min.js')\n+            js.append('actions%s.js' % extra)\n         if self.prepopulated_fields:\n-            js.extend(['urlify.js', 'prepopulate.min.js'])\n+            js.extend(['urlify.js', 'prepopulate%s.js' % extra])\n         if self.opts.get_ordered_objects():\n             js.extend(['getElementsBySelector.js', 'dom-drag.js' , 'admin/ordering.js'])\n         return forms.Media(js=[static('admin/js/%s' % url) for url in js])\n@@ -1371,9 +1373,10 @@ def __init__(self, parent_model, admin_site):\n \n     @property\n     def media(self):\n-        js = ['jquery.min.js', 'jquery.init.js', 'inlines.min.js']\n+        extra = \"\" if settings.DEBUG else \".min\"\n+        js = ['jquery%s.js' % extra, 'jquery.init.js', \"inlines%s.js\" % extra]\n         if self.prepopulated_fields:\n-            js.extend(['urlify.js', 'prepopulate.min.js'])\n+            js.extend(['urlify.js', 'prepopulate%s.js' % extra])\n         if self.filter_vertical or self.filter_horizontal:\n             js.extend(['SelectBox.js', 'SelectFilter2.js'])\n         return forms.Media(js=[static('admin/js/%s' % url) for url in js])"
        },
        {
            "sha": "b5da138c62a2e1db92a95d9dc4630960f0176a82",
            "filename": "tests/regressiontests/modeladmin/tests.py",
            "status": "modified",
            "additions": 60,
            "deletions": 2,
            "changes": 62,
            "blob_url": "https://github.com/django/django/blob/a90aad35116d1a796a301626db5abff5f361da8a/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a90aad35116d1a796a301626db5abff5f361da8a/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py?ref=a90aad35116d1a796a301626db5abff5f361da8a",
            "patch": "@@ -1,11 +1,11 @@\n-from __future__ import absolute_import\n+from __future__ import absolute_import, with_statement\n \n from datetime import date\n \n from django import forms\n from django.conf import settings\n from django.contrib.admin.options import (ModelAdmin, TabularInline,\n-    HORIZONTAL, VERTICAL)\n+     InlineModelAdmin, HORIZONTAL, VERTICAL)\n from django.contrib.admin.sites import AdminSite\n from django.contrib.admin.validation import validate\n from django.contrib.admin.widgets import AdminDateWidget, AdminRadioSelect\n@@ -15,6 +15,7 @@\n from django.forms.models import BaseModelFormSet\n from django.forms.widgets import Select\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils import unittest\n \n from .models import Band, Concert, ValidationTestModel, ValidationTestInlineModel\n@@ -493,6 +494,63 @@ class BandAdmin(ModelAdmin):\n             list(ma.get_formsets(request))[0]().forms[0].fields.keys(),\n             ['extra', 'transport', 'id', 'DELETE', 'main_band'])\n \n+    def test_media_minified_only_if_debug_is_false(self):\n+        \"\"\"\n+        Ensure that, with ModelAdmin, the minified versions of the JS files are\n+        only used when DEBUG is False.\n+        Refs #17521.\n+        \"\"\"\n+        ma = ModelAdmin(Band, self.site)\n+        ma.prepopulated_fields = ['something']\n+        ma.actions = ['some action']\n+\n+        with override_settings(DEBUG=False):\n+            media_js = str(ma.media['js'])\n+            self.assertFalse('jquery.js' in media_js)\n+            self.assertTrue('jquery.min.js' in media_js)\n+            self.assertFalse('prepopulate.js' in media_js)\n+            self.assertTrue('prepopulate.min.js' in media_js)\n+            self.assertFalse('actions.js' in media_js)\n+            self.assertTrue('actions.min.js' in media_js)\n+        with override_settings(DEBUG=True):\n+            media_js = str(ma.media['js'])\n+            self.assertTrue('jquery.js' in media_js)\n+            self.assertFalse('jquery.min.js' in media_js)\n+            self.assertTrue('prepopulate.js' in media_js)\n+            self.assertFalse('prepopulate.min.js' in media_js)\n+            self.assertTrue('actions.js' in media_js)\n+            self.assertFalse('actions.min.js' in media_js)\n+\n+    def test_inlines_media_minified_only_if_debug_is_false(self):\n+        \"\"\"\n+        Ensure that, with InlineModelAdmin, the minified versions of the JS\n+        files are only used when DEBUG is False.\n+        Refs #17521.\n+        \"\"\"\n+        class InlineBandAdmin(InlineModelAdmin):\n+            model = Band\n+\n+        ma = InlineBandAdmin(Band, self.site)\n+        ma.prepopulated_fields = ['something']\n+        ma.actions = ['some action']\n+\n+        with override_settings(DEBUG=False):\n+            media_js = str(ma.media['js'])\n+            self.assertFalse('jquery.js' in media_js)\n+            self.assertTrue('jquery.min.js' in media_js)\n+            self.assertFalse('prepopulate.js' in media_js)\n+            self.assertTrue('prepopulate.min.js' in media_js)\n+            self.assertFalse('inlines.js' in media_js)\n+            self.assertTrue('inlines.min.js' in media_js)\n+        with override_settings(DEBUG=True):\n+            media_js = str(ma.media['js'])\n+            self.assertTrue('jquery.js' in media_js)\n+            self.assertFalse('jquery.min.js' in media_js)\n+            self.assertTrue('prepopulate.js' in media_js)\n+            self.assertFalse('prepopulate.min.js' in media_js)\n+            self.assertTrue('inlines.js' in media_js)\n+            self.assertFalse('inlines.min.js' in media_js)\n+\n \n class ValidationTests(unittest.TestCase):\n     def test_validation_only_runs_in_debug(self):"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 68,
        "deletions": 7
    }
}