{
    "author": "aaugustin",
    "message": "Fixed a CacheKeyWarning under Windows.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17277 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e8a6fee6e66f9745e2580b329c93e369801a8318",
    "files": [
        {
            "sha": "0ea84072fa898ff47c57f7c6ef3a1cfada16e9a1",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e8a6fee6e66f9745e2580b329c93e369801a8318/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/e8a6fee6e66f9745e2580b329c93e369801a8318/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=e8a6fee6e66f9745e2580b329c93e369801a8318",
            "patch": "@@ -165,7 +165,9 @@ def _i18n_cache_key_suffix(request, cache_key):\n         # which in turn can also fall back to settings.LANGUAGE_CODE\n         cache_key += '.%s' % getattr(request, 'LANGUAGE_CODE', get_language())\n     if settings.USE_TZ:\n-        cache_key += '.%s' % get_current_timezone_name()\n+        # Windows uses non-standard timezone names that may include spaces,\n+        # which triggers CacheKeyWarning.\n+        cache_key += '.%s' % get_current_timezone_name().replace(' ', '_')\n     return cache_key\n \n def _generate_cache_key(request, method, headerlist, key_prefix):"
        },
        {
            "sha": "8faaa6fdc4e7d60f2e30f2b85b38975ef76e4072",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e8a6fee6e66f9745e2580b329c93e369801a8318/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e8a6fee6e66f9745e2580b329c93e369801a8318/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=e8a6fee6e66f9745e2580b329c93e369801a8318",
            "patch": "@@ -1270,7 +1270,7 @@ def test_cache_key_i18n_formatting(self):\n     @override_settings(USE_I18N=False, USE_L10N=False, USE_TZ=True)\n     def test_cache_key_i18n_timezone(self):\n         request = self._get_request()\n-        tz = timezone.get_current_timezone_name()\n+        tz = timezone.get_current_timezone_name().replace(' ', '_')\n         response = HttpResponse()\n         key = learn_cache_key(request, response)\n         self.assertIn(tz, key, \"Cache keys should include the time zone name when time zones are active\")\n@@ -1281,7 +1281,7 @@ def test_cache_key_i18n_timezone(self):\n     def test_cache_key_no_i18n (self):\n         request = self._get_request()\n         lang = translation.get_language()\n-        tz = timezone.get_current_timezone_name()\n+        tz = timezone.get_current_timezone_name().replace(' ', '_')\n         response = HttpResponse()\n         key = learn_cache_key(request, response)\n         self.assertNotIn(lang, key, \"Cache keys shouldn't include the language name when i18n isn't active\")"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 5,
        "deletions": 3
    }
}