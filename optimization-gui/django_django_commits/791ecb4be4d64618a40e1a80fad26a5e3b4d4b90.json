{
    "author": "freakboy3742",
    "message": "Fixed #13126 -- Ensured that individual form errors are displayed when errors occur on a list-editable changelist. Thanks to slafs for the report, and to Julien Phalip for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15580 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "791ecb4be4d64618a40e1a80fad26a5e3b4d4b90",
    "files": [
        {
            "sha": "29cf2658044b14f48e3ac8050ed5da5bacf7a862",
            "filename": "django/contrib/admin/templates/admin/change_list_results.html",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html",
            "raw_url": "https://github.com/django/django/raw/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html?ref=791ecb4be4d64618a40e1a80fad26a5e3b4d4b90",
            "patch": "@@ -16,7 +16,10 @@\n </thead>\n <tbody>\n {% for result in results %}\n-<tr class=\"{% cycle 'row1' 'row2' %}\">{% for item in result %}{{ item }}{% endfor %}</tr>\n+{% if result.form.non_field_errors %}\n+    <tr><td colspan=\"{{ result.row|length }}\">{{ result.form.non_field_errors }}</td></tr>\n+{% endif %}\n+<tr class=\"{% cycle 'row1' 'row2' %}\">{% for item in result.row %}{{ item }}{% endfor %}</tr>\n {% endfor %}\n </tbody>\n </table>"
        },
        {
            "sha": "199b1d97a3af30cbb856f4c10949141c9a819f4f",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=791ecb4be4d64618a40e1a80fad26a5e3b4d4b90",
            "patch": "@@ -198,10 +198,10 @@ def items_for_result(cl, result, form):\n def results(cl):\n     if cl.formset:\n         for res, form in zip(cl.result_list, cl.formset.forms):\n-            yield list(items_for_result(cl, res, form))\n+            yield {'row': list(items_for_result(cl, res, form)), 'form': form}\n     else:\n         for res in cl.result_list:\n-            yield list(items_for_result(cl, res, None))\n+            yield {'row': list(items_for_result(cl, res, None)), 'form': None}\n \n def result_hidden_fields(cl):\n     if cl.formset:"
        },
        {
            "sha": "b601267e570db83c732983082db0d7d214f2f85f",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 27,
            "deletions": 1,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=791ecb4be4d64618a40e1a80fad26a5e3b4d4b90",
            "patch": "@@ -669,7 +669,32 @@ def __unicode__(self):\n class Reservation(models.Model):\n     start_date = models.DateTimeField()\n     price = models.IntegerField()\n-    \n+\n+\n+DRIVER_CHOICES = (\n+    (u'bill', 'Bill G'),\n+    (u'steve', 'Steve J'),\n+)\n+\n+RESTAURANT_CHOICES = (\n+    (u'indian', u'A Taste of India'),\n+    (u'thai', u'Thai Pography'),\n+    (u'pizza', u'Pizza Mama'),\n+)\n+\n+class FoodDelivery(models.Model):\n+    reference = models.CharField(max_length=100)\n+    driver = models.CharField(max_length=100, choices=DRIVER_CHOICES, blank=True)\n+    restaurant = models.CharField(max_length=100, choices=RESTAURANT_CHOICES, blank=True)\n+\n+    class Meta:\n+        unique_together = ((\"driver\", \"restaurant\"),)\n+\n+class FoodDeliveryAdmin(admin.ModelAdmin):\n+    list_display=('reference', 'driver', 'restaurant')\n+    list_editable = ('driver', 'restaurant')\n+\n+\n admin.site.register(Article, ArticleAdmin)\n admin.site.register(CustomArticle, CustomArticleAdmin)\n admin.site.register(Section, save_as=True, inlines=[ArticleInline])\n@@ -706,6 +731,7 @@ class Reservation(models.Model):\n admin.site.register(CyclicTwo)\n admin.site.register(WorkHour, WorkHourAdmin)\n admin.site.register(Reservation)\n+admin.site.register(FoodDelivery, FoodDeliveryAdmin)\n \n # We intentionally register Promo and ChapterXtra1 but not Chapter nor ChapterXtra2.\n # That way we cover all four cases:"
        },
        {
            "sha": "2685a05caa9831065d7a66111fa58311483d70ed",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 62,
            "deletions": 1,
            "changes": 63,
            "blob_url": "https://github.com/django/django/blob/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/791ecb4be4d64618a40e1a80fad26a5e3b4d4b90/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=791ecb4be4d64618a40e1a80fad26a5e3b4d4b90",
            "patch": "@@ -35,7 +35,7 @@\n     Person, Persona, Picture, Podcast, Section, Subscriber, Vodcast,\n     Language, Collector, Widget, Grommet, DooHickey, FancyDoodad, Whatsit,\n     Category, Post, Plot, FunkyTag, Chapter, Book, Promo, WorkHour, Employee,\n-    Question, Answer, Inquisition, Actor)\n+    Question, Answer, Inquisition, Actor, FoodDelivery)\n \n \n class AdminViewBasicTest(TestCase):\n@@ -1420,6 +1420,67 @@ def test_post_submission(self):\n \n         self.assertEqual(Person.objects.get(name=\"John Mauchly\").alive, False)\n \n+    def test_non_field_errors(self):\n+        ''' Ensure that non field errors are displayed for each of the\n+            forms in the changelist's formset. Refs #13126.\n+        '''\n+        FoodDelivery.objects.create(reference='123', driver='bill', restaurant='thai')\n+        FoodDelivery.objects.create(reference='456', driver='bill', restaurant='india')\n+        FoodDelivery.objects.create(reference='789', driver='bill', restaurant='pizza')\n+\n+        data = {\n+            \"form-TOTAL_FORMS\": \"3\",\n+            \"form-INITIAL_FORMS\": \"3\",\n+            \"form-MAX_NUM_FORMS\": \"0\",\n+\n+            \"form-0-id\": \"1\",\n+            \"form-0-reference\": \"123\",\n+            \"form-0-driver\": \"bill\",\n+            \"form-0-restaurant\": \"thai\",\n+\n+            # Same data as above: Forbidden because of unique_together!\n+            \"form-1-id\": \"2\",\n+            \"form-1-reference\": \"456\",\n+            \"form-1-driver\": \"bill\",\n+            \"form-1-restaurant\": \"thai\",\n+\n+            \"form-2-id\": \"3\",\n+            \"form-2-reference\": \"789\",\n+            \"form-2-driver\": \"bill\",\n+            \"form-2-restaurant\": \"pizza\",\n+\n+            \"_save\": \"Save\",\n+        }\n+        response = self.client.post('/test_admin/admin/admin_views/fooddelivery/', data)\n+        self.assertContains(response, '<tr><td colspan=\"4\"><ul class=\"errorlist\"><li>Food delivery with this Driver and Restaurant already exists.</li></ul></td></tr>', 1)\n+\n+        data = {\n+            \"form-TOTAL_FORMS\": \"3\",\n+            \"form-INITIAL_FORMS\": \"3\",\n+            \"form-MAX_NUM_FORMS\": \"0\",\n+\n+            \"form-0-id\": \"1\",\n+            \"form-0-reference\": \"123\",\n+            \"form-0-driver\": \"bill\",\n+            \"form-0-restaurant\": \"thai\",\n+\n+            # Same data as above: Forbidden because of unique_together!\n+            \"form-1-id\": \"2\",\n+            \"form-1-reference\": \"456\",\n+            \"form-1-driver\": \"bill\",\n+            \"form-1-restaurant\": \"thai\",\n+\n+            # Same data also.\n+            \"form-2-id\": \"3\",\n+            \"form-2-reference\": \"789\",\n+            \"form-2-driver\": \"bill\",\n+            \"form-2-restaurant\": \"thai\",\n+\n+            \"_save\": \"Save\",\n+        }\n+        response = self.client.post('/test_admin/admin/admin_views/fooddelivery/', data)\n+        self.assertContains(response, '<tr><td colspan=\"4\"><ul class=\"errorlist\"><li>Food delivery with this Driver and Restaurant already exists.</li></ul></td></tr>', 2)\n+\n     def test_non_form_errors(self):\n         # test if non-form errors are handled; ticket #12716\n         data = {"
        }
    ],
    "stats": {
        "total": 100,
        "additions": 95,
        "deletions": 5
    }
}