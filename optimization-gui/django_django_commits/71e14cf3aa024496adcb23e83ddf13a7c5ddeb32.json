{
    "author": "akaariai",
    "message": "Fixed #18347 -- Removed autofield raw SQL inserts from tests",
    "sha": "71e14cf3aa024496adcb23e83ddf13a7c5ddeb32",
    "files": [
        {
            "sha": "66e047799eb7a0c5c5628ae0515ae16a375b4538",
            "filename": "tests/regressiontests/transactions_regress/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 15,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/71e14cf3aa024496adcb23e83ddf13a7c5ddeb32/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/71e14cf3aa024496adcb23e83ddf13a7c5ddeb32/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py?ref=71e14cf3aa024496adcb23e83ddf13a7c5ddeb32",
            "patch": "@@ -24,17 +24,15 @@ def test_raw_committed_on_success(self):\n         def raw_sql():\n             \"Write a record using raw sql under a commit_on_success decorator\"\n             cursor = connection.cursor()\n-            cursor.execute(\"INSERT into transactions_regress_mod (id,fld) values (17,18)\")\n+            cursor.execute(\"INSERT into transactions_regress_mod (fld) values (18)\")\n \n         raw_sql()\n         # Rollback so that if the decorator didn't commit, the record is unwritten\n         transaction.rollback()\n-        try:\n-            # Check that the record is in the DB\n-            obj = Mod.objects.get(pk=17)\n-            self.assertEqual(obj.fld, 18)\n-        except Mod.DoesNotExist:\n-            self.fail(\"transaction with raw sql not committed\")\n+        self.assertEqual(Mod.objects.count(), 1)\n+        # Check that the record is in the DB\n+        obj = Mod.objects.all()[0]\n+        self.assertEqual(obj.fld, 18)\n \n     def test_commit_manually_enforced(self):\n         \"\"\"\n@@ -115,19 +113,16 @@ def reuse_cursor_ref():\n             be committed.\n             \"\"\"\n             cursor = connection.cursor()\n-            cursor.execute(\"INSERT into transactions_regress_mod (id,fld) values (1,2)\")\n+            cursor.execute(\"INSERT into transactions_regress_mod (fld) values (2)\")\n             transaction.rollback()\n-            cursor.execute(\"INSERT into transactions_regress_mod (id,fld) values (1,2)\")\n+            cursor.execute(\"INSERT into transactions_regress_mod (fld) values (2)\")\n \n         reuse_cursor_ref()\n         # Rollback so that if the decorator didn't commit, the record is unwritten\n         transaction.rollback()\n-        try:\n-            # Check that the record is in the DB\n-            obj = Mod.objects.get(pk=1)\n-            self.assertEqual(obj.fld, 2)\n-        except Mod.DoesNotExist:\n-            self.fail(\"After ending a transaction, cursor use no longer sets dirty\")\n+        self.assertEqual(Mod.objects.count(), 1)\n+        obj = Mod.objects.all()[0]\n+        self.assertEqual(obj.fld, 2)\n \n     def test_failing_query_transaction_closed(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 25,
        "additions": 10,
        "deletions": 15
    }
}