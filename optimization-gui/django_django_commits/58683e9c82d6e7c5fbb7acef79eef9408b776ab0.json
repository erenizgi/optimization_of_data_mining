{
    "author": "mjtamlyn",
    "message": "Fixed #16744 -- Class based view should have the view object in the context\n\nUpdated the most recent patch from @claudep to apply again and updated\nthe documentation location.",
    "sha": "58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
    "files": [
        {
            "sha": "ca039ae9dbc91bc79a9ec0ecfc1f42bf986c9b53",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -18,6 +18,8 @@ class ContextMixin(object):\n     \"\"\"\n \n     def get_context_data(self, **kwargs):\n+        if 'view' not in kwargs:\n+            kwargs['view'] = self\n         return kwargs\n \n "
        },
        {
            "sha": "61fc945cd3c4f5e2826c120dbaaaa28f85f656a2",
            "filename": "docs/ref/class-based-views/mixins-simple.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/docs%2Fref%2Fclass-based-views%2Fmixins-simple.txt",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/docs%2Fref%2Fclass-based-views%2Fmixins-simple.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-simple.txt?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -17,8 +17,20 @@ ContextMixin\n \n     .. method:: get_context_data(**kwargs)\n \n-        Returns a dictionary representing the template context. The\n-        keyword arguments provided will make up the returned context.\n+        Returns a dictionary representing the template context. The keyword\n+        arguments provided will make up the returned context.\n+\n+        The template context of all class-based generic views include a\n+        ``view`` variable that points to the ``View`` instance.\n+\n+        .. admonition:: Use ``alters_data`` where appropriate\n+\n+            Note that having the view instance in the template context may\n+            expose potentially hazardous methods to template authors.  To\n+            prevent methods like this from being called in the template, set\n+            ``alters_data=True`` on those methods.  For more information, read\n+            the documentation on :ref:`rendering a template context\n+            <alters-data-description>`.\n \n TemplateResponseMixin\n ---------------------"
        },
        {
            "sha": "c52194e6b726007db3d6b4b39d73355ca17b571e",
            "filename": "docs/ref/templates/api.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/docs%2Fref%2Ftemplates%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/docs%2Fref%2Ftemplates%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fapi.txt?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -198,6 +198,8 @@ straight lookups. Here are some things to keep in mind:\n * A variable can only be called if it has no required arguments. Otherwise,\n   the system will return an empty string.\n \n+.. _alters-data-description:\n+\n * Obviously, there can be side effects when calling some variables, and\n   it'd be either foolish or a security hole to allow the template system\n   to access them."
        },
        {
            "sha": "5f27b7ccbb6c95f3b598a5eeff3f785d733f13fc",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -84,6 +84,12 @@ By passing ``False`` using this argument it is now possible to retreive the\n :class:`ContentType <django.contrib.contenttypes.models.ContentType>`\n associated with proxy models.\n \n+New ``view`` variable in class-based views context\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+In all :doc:`generic class-based views </topics/class-based-views/index>`\n+(or any class-based view inheriting from ``ContextMixin``), the context dictionary\n+contains a ``view`` variable that points to the ``View`` instance.\n+\n Minor features\n ~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "b9f64888fc81283793defe08796792c2feec6ce4",
            "filename": "tests/regressiontests/generic_views/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -276,6 +276,7 @@ def test_template_params(self):\n         response = self.client.get('/template/simple/bar/')\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['params'], {'foo': 'bar'})\n+        self.assertTrue(isinstance(response.context['view'], View))\n \n     def test_extra_template_params(self):\n         \"\"\"\n@@ -285,6 +286,7 @@ def test_extra_template_params(self):\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['params'], {'foo': 'bar'})\n         self.assertEqual(response.context['key'], 'value')\n+        self.assertTrue(isinstance(response.context['view'], View))\n \n     def test_cached_views(self):\n         \"\"\""
        },
        {
            "sha": "c8f1999a2ad55b99c989d17456916bdbbbebfcf7",
            "filename": "tests/regressiontests/generic_views/detail.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Fdetail.py",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Fdetail.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdetail.py?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -2,6 +2,7 @@\n \n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase\n+from django.views.generic.base import View\n \n from .models import Artist, Author, Page\n \n@@ -14,6 +15,7 @@ def test_simple_object(self):\n         res = self.client.get('/detail/obj/')\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(res.context['object'], {'foo': 'bar'})\n+        self.assertTrue(isinstance(res.context['view'], View))\n         self.assertTemplateUsed(res, 'generic_views/detail.html')\n \n     def test_detail_by_pk(self):"
        },
        {
            "sha": "16f4da8efe0cbcd6f23ab3d11f85f0a98c22324d",
            "filename": "tests/regressiontests/generic_views/edit.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Fedit.py",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Fedit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fedit.py?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -5,6 +5,7 @@\n from django import forms\n from django.test import TestCase\n from django.utils.unittest import expectedFailure\n+from django.views.generic.base import View\n from django.views.generic.edit import FormMixin\n \n from . import views\n@@ -31,6 +32,7 @@ def test_create(self):\n         res = self.client.get('/edit/authors/create/')\n         self.assertEqual(res.status_code, 200)\n         self.assertTrue(isinstance(res.context['form'], forms.ModelForm))\n+        self.assertTrue(isinstance(res.context['view'], View))\n         self.assertFalse('object' in res.context)\n         self.assertFalse('author' in res.context)\n         self.assertTemplateUsed(res, 'generic_views/author_form.html')\n@@ -101,6 +103,7 @@ def test_create_restricted(self):\n         self.assertEqual(res.status_code, 302)\n         self.assertRedirects(res, 'http://testserver/accounts/login/?next=/edit/authors/create/restricted/')\n \n+\n class UpdateViewTests(TestCase):\n     urls = 'regressiontests.generic_views.urls'\n \n@@ -226,6 +229,7 @@ def test_update_get_object(self):\n         res = self.client.get('/edit/author/update/')\n         self.assertEqual(res.status_code, 200)\n         self.assertTrue(isinstance(res.context['form'], forms.ModelForm))\n+        self.assertTrue(isinstance(res.context['view'], View))\n         self.assertEqual(res.context['object'], Author.objects.get(pk=a.pk))\n         self.assertEqual(res.context['author'], Author.objects.get(pk=a.pk))\n         self.assertTemplateUsed(res, 'generic_views/author_form.html')\n@@ -237,6 +241,7 @@ def test_update_get_object(self):\n         self.assertRedirects(res, 'http://testserver/list/authors/')\n         self.assertQuerysetEqual(Author.objects.all(), ['<Author: Randall Munroe (xkcd)>'])\n \n+\n class DeleteViewTests(TestCase):\n     urls = 'regressiontests.generic_views.urls'\n "
        },
        {
            "sha": "14dc1d725d904b18e1a9e819d0f164c083f935ea",
            "filename": "tests/regressiontests/generic_views/list.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/58683e9c82d6e7c5fbb7acef79eef9408b776ab0/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Flist.py?ref=58683e9c82d6e7c5fbb7acef79eef9408b776ab0",
            "patch": "@@ -2,6 +2,7 @@\n \n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase\n+from django.views.generic.base import View\n \n from .models import Author, Artist\n \n@@ -21,6 +22,7 @@ def test_queryset(self):\n         self.assertEqual(res.status_code, 200)\n         self.assertTemplateUsed(res, 'generic_views/author_list.html')\n         self.assertEqual(list(res.context['object_list']), list(Author.objects.all()))\n+        self.assertTrue(isinstance(res.context['view'], View))\n         self.assertIs(res.context['author_list'], res.context['object_list'])\n         self.assertIsNone(res.context['paginator'])\n         self.assertIsNone(res.context['page_obj'])"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 35,
        "deletions": 2
    }
}