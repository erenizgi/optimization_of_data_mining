{
    "author": "aaugustin",
    "message": "Fixed #17895 -- Made override_settings send the setting_changed signal both when a setting is overridden and when it's restored.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17708 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4b14546215ad4ef15f04e748e3b5f0da7b613b45",
    "files": [
        {
            "sha": "ed5ab590a78fbf46ddfea4feba893b20b8bf56ee",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4b14546215ad4ef15f04e748e3b5f0da7b613b45/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/4b14546215ad4ef15f04e748e3b5f0da7b613b45/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=4b14546215ad4ef15f04e748e3b5f0da7b613b45",
            "patch": "@@ -167,15 +167,6 @@ def restore_template_loaders():\n     delattr(loader, RESTORE_LOADERS_ATTR)\n \n \n-class OverrideSettingsHolder(UserSettingsHolder):\n-    \"\"\"\n-    A custom setting holder that sends a signal upon change.\n-    \"\"\"\n-    def __setattr__(self, name, value):\n-        UserSettingsHolder.__setattr__(self, name, value)\n-        setting_changed.send(sender=self.__class__, setting=name, value=value)\n-\n-\n class override_settings(object):\n     \"\"\"\n     Acts as either a decorator, or a context manager. If it's a decorator it\n@@ -215,10 +206,18 @@ def inner(*args, **kwargs):\n         return inner\n \n     def enable(self):\n-        override = OverrideSettingsHolder(settings._wrapped)\n+        override = UserSettingsHolder(settings._wrapped)\n         for key, new_value in self.options.items():\n             setattr(override, key, new_value)\n         settings._wrapped = override\n+        for key, new_value in self.options.items():\n+            setting_changed.send(sender=settings._wrapped.__class__,\n+                                 setting=key, value=new_value)\n \n     def disable(self):\n         settings._wrapped = self.wrapped\n+        for key in self.options:\n+            new_value = getattr(settings, key, None)\n+            setting_changed.send(sender=settings._wrapped.__class__,\n+                                 setting=key, value=new_value)\n+"
        },
        {
            "sha": "3917b52b96800c38f41678e221a7ac6f38921abb",
            "filename": "docs/ref/signals.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4b14546215ad4ef15f04e748e3b5f0da7b613b45/docs%2Fref%2Fsignals.txt",
            "raw_url": "https://github.com/django/django/raw/4b14546215ad4ef15f04e748e3b5f0da7b613b45/docs%2Fref%2Fsignals.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsignals.txt?ref=4b14546215ad4ef15f04e748e3b5f0da7b613b45",
            "patch": "@@ -477,20 +477,24 @@ setting_changed\n .. data:: django.test.signals.setting_changed\n    :module:\n \n-Sent when some :ref:`settings are overridden <overriding-settings>` with the\n+This signal is sent when the value of a setting is changed through the\n :meth:`django.test.TestCase.setting` context manager or the\n :func:`django.test.utils.override_settings` decorator/context manager.\n \n+It's actually sent twice: when the new value is applied (\"setup\") and when the\n+original value is restored (\"teardown\").\n+\n Arguments sent with this signal:\n \n ``sender``\n     The settings handler.\n \n ``setting``\n-    Same as sender\n+    The name of the setting.\n \n ``value``\n-    The new setting value.\n+    The value of the setting after the change. For settings that initially\n+    don't exist, in the \"teardown\" phase, ``value`` is ``None``.\n \n template_rendered\n -----------------"
        },
        {
            "sha": "a2e6c490b4ee4519a3326546a93bcf7146430c31",
            "filename": "tests/regressiontests/settings_tests/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4b14546215ad4ef15f04e748e3b5f0da7b613b45/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4b14546215ad4ef15f04e748e3b5f0da7b613b45/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py?ref=4b14546215ad4ef15f04e748e3b5f0da7b613b45",
            "patch": "@@ -132,6 +132,7 @@ def test_signal_callback_context_manager(self):\n         self.assertRaises(AttributeError, getattr, settings, 'TEST')\n         with self.settings(TEST='override'):\n             self.assertEqual(testvalue, 'override')\n+        self.assertEqual(testvalue, None)\n \n     @override_settings(TEST='override')\n     def test_signal_callback_decorator(self):"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 17,
        "deletions": 13
    }
}