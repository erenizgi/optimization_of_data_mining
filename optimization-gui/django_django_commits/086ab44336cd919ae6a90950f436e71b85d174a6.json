{
    "author": "jezdez",
    "message": "Fixed #15637 -- Added a require_safe decorator for views to accept GET or HEAD. Thanks, aaugustin and Julien.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16115 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "086ab44336cd919ae6a90950f436e71b85d174a6",
    "files": [
        {
            "sha": "054dc57c3514c1f8d79ae4eec4d52b96e21129f9",
            "filename": "django/views/decorators/http.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/086ab44336cd919ae6a90950f436e71b85d174a6/django%2Fviews%2Fdecorators%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/086ab44336cd919ae6a90950f436e71b85d174a6/django%2Fviews%2Fdecorators%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fhttp.py?ref=086ab44336cd919ae6a90950f436e71b85d174a6",
            "patch": "@@ -48,6 +48,9 @@ def inner(request, *args, **kwargs):\n require_POST = require_http_methods([\"POST\"])\n require_POST.__doc__ = \"Decorator to require that a view only accept the POST method.\"\n \n+require_safe = require_http_methods([\"GET\", \"HEAD\"])\n+require_safe.__doc__ = \"Decorator to require that a view only accept safe methods: GET and HEAD.\"\n+\n def condition(etag_func=None, last_modified_func=None):\n     \"\"\"\n     Decorator to support conditional retrieval (or change) for a view"
        },
        {
            "sha": "1a5c7776b5e1403cf5cc918b31eceaf3168bf9a7",
            "filename": "docs/topics/http/decorators.txt",
            "status": "modified",
            "additions": 38,
            "deletions": 22,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/086ab44336cd919ae6a90950f436e71b85d174a6/docs%2Ftopics%2Fhttp%2Fdecorators.txt",
            "raw_url": "https://github.com/django/django/raw/086ab44336cd919ae6a90950f436e71b85d174a6/docs%2Ftopics%2Fhttp%2Fdecorators.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fdecorators.txt?ref=086ab44336cd919ae6a90950f436e71b85d174a6",
            "patch": "@@ -10,31 +10,47 @@ various HTTP features.\n Allowed HTTP methods\n ====================\n \n-The following decorators in :mod:`django.views.decorators.http` can be used to\n-restrict access to views based on the request method.\n+The decorators in :mod:`django.views.decorators.http` can be used to restrict\n+access to views based on the request method.\n \n .. function:: require_http_methods(request_method_list)\n \n-This decorator is used to ensure that a view only accepts particular request\n-methods. Usage::\n+    Decorator to require that a view only accept particular request\n+    methods. Usage::\n \n-    from django.views.decorators.http import require_http_methods\n+        from django.views.decorators.http import require_http_methods\n \n-    @require_http_methods([\"GET\", \"POST\"])\n-    def my_view(request):\n-        # I can assume now that only GET or POST requests make it this far\n-        # ...\n-        pass\n+        @require_http_methods([\"GET\", \"POST\"])\n+        def my_view(request):\n+            # I can assume now that only GET or POST requests make it this far\n+            # ...\n+            pass\n \n-Note that request methods should be in uppercase.\n+    Note that request methods should be in uppercase.\n \n .. function:: require_GET()\n \n-Decorator to require that a view only accept the GET method.\n+    Decorator to require that a view only accept the GET method.\n \n .. function:: require_POST()\n \n-Decorator to require that a view only accept the POST method.\n+    Decorator to require that a view only accept the POST method.\n+\n+.. function:: require_safe()\n+\n+    .. versionadded:: 1.4\n+\n+    Decorator to require that a view only accept the GET and HEAD methods.\n+    These methods are commonly considered \"safe\" because they should not have\n+    the significance of taking an action other than retrieving the requested\n+    resource.\n+\n+    .. note::\n+        Django will automatically strip the content of responses to HEAD\n+        requests while leaving the headers unchanged, so you may handle HEAD\n+        requests exactly like GET requests in your views. Since some software,\n+        such as link checkers, rely on HEAD requests, you might prefer\n+        using ``require_safe`` instead of ``require_GET``.\n \n Conditional view processing\n ===========================\n@@ -48,9 +64,9 @@ control caching behavior on particular views.\n \n .. function:: last_modified(last_modified_func)\n \n-These decorators can be used to generate ``ETag`` and ``Last-Modified``\n-headers; see\n-:doc:`conditional view processing </topics/conditional-view-processing>`.\n+    These decorators can be used to generate ``ETag`` and ``Last-Modified``\n+    headers; see\n+    :doc:`conditional view processing </topics/conditional-view-processing>`.\n \n .. module:: django.views.decorators.gzip\n \n@@ -62,9 +78,9 @@ compression on a per-view basis.\n \n .. function:: gzip_page()\n \n-This decorator compresses content if the browser allows gzip compression.\n-It sets the ``Vary`` header accordingly, so that caches will base their\n-storage on the ``Accept-Encoding`` header.\n+    This decorator compresses content if the browser allows gzip compression.\n+    It sets the ``Vary`` header accordingly, so that caches will base their\n+    storage on the ``Accept-Encoding`` header.\n \n .. module:: django.views.decorators.vary\n \n@@ -78,7 +94,7 @@ caching based on specific request headers.\n \n .. function:: vary_on_headers(*headers)\n \n-The ``Vary`` header defines which request headers a cache mechanism should take\n-into account when building its cache key.\n+    The ``Vary`` header defines which request headers a cache mechanism should take\n+    into account when building its cache key.\n \n-See :ref:`using vary headers <using-vary-headers>`.\n+    See :ref:`using vary headers <using-vary-headers>`."
        },
        {
            "sha": "52a1ecd90940ac79ada9f4d968d01eb73a3294f6",
            "filename": "tests/regressiontests/decorators/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/086ab44336cd919ae6a90950f436e71b85d174a6/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/086ab44336cd919ae6a90950f436e71b85d174a6/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdecorators%2Ftests.py?ref=086ab44336cd919ae6a90950f436e71b85d174a6",
            "patch": "@@ -2,11 +2,11 @@\n \n from django.contrib.auth.decorators import login_required, permission_required, user_passes_test\n from django.contrib.admin.views.decorators import staff_member_required\n-from django.http import HttpResponse, HttpRequest\n+from django.http import HttpResponse, HttpRequest, HttpResponseNotAllowed\n from django.utils.decorators import method_decorator\n from django.utils.functional import allow_lazy, lazy, memoize\n from django.utils.unittest import TestCase\n-from django.views.decorators.http import require_http_methods, require_GET, require_POST\n+from django.views.decorators.http import require_http_methods, require_GET, require_POST, require_safe\n from django.views.decorators.vary import vary_on_headers, vary_on_cookie\n from django.views.decorators.cache import cache_page, never_cache, cache_control\n \n@@ -20,6 +20,7 @@ def fully_decorated(request):\n fully_decorated = require_http_methods([\"GET\"])(fully_decorated)\n fully_decorated = require_GET(fully_decorated)\n fully_decorated = require_POST(fully_decorated)\n+fully_decorated = require_safe(fully_decorated)\n \n # django.views.decorators.vary\n fully_decorated = vary_on_headers('Accept-language')(fully_decorated)\n@@ -111,6 +112,27 @@ def my_view(request):\n         my_view_cached4 = cache_page()(my_view)\n         self.assertEqual(my_view_cached4(HttpRequest()), \"response\")\n \n+    def test_require_safe_accepts_only_safe_methods(self):\n+        \"\"\"\n+        Test for the require_safe decorator.\n+        A view returns either a response or an exception.\n+        Refs #15637.\n+        \"\"\"\n+        def my_view(request):\n+            return HttpResponse(\"OK\")\n+        my_safe_view = require_safe(my_view)\n+        request = HttpRequest()\n+        request.method = 'GET'\n+        self.assertTrue(isinstance(my_safe_view(request), HttpResponse))\n+        request.method = 'HEAD'\n+        self.assertTrue(isinstance(my_safe_view(request), HttpResponse))\n+        request.method = 'POST'\n+        self.assertTrue(isinstance(my_safe_view(request), HttpResponseNotAllowed))\n+        request.method = 'PUT'\n+        self.assertTrue(isinstance(my_safe_view(request), HttpResponseNotAllowed))\n+        request.method = 'DELETE'\n+        self.assertTrue(isinstance(my_safe_view(request), HttpResponseNotAllowed))\n+\n \n # For testing method_decorator, a decorator that assumes a single argument.\n # We will get type arguments if there is a mismatch in the number of arguments."
        }
    ],
    "stats": {
        "total": 89,
        "additions": 65,
        "deletions": 24
    }
}