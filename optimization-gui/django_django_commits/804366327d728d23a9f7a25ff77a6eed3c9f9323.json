{
    "author": "matiasb",
    "message": "Fixed #19915 - Made blocktrans tag honor TEMPLATE_STRING_IF_INVALID.\n\nThanks Natalia Bidart for the report and Matías Bordese for the fix.",
    "sha": "804366327d728d23a9f7a25ff77a6eed3c9f9323",
    "files": [
        {
            "sha": "d64efff9d3f8dae62c02bdf14048d14f4c324305",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/804366327d728d23a9f7a25ff77a6eed3c9f9323/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/804366327d728d23a9f7a25ff77a6eed3c9f9323/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=804366327d728d23a9f7a25ff77a6eed3c9f9323",
            "patch": "@@ -1,6 +1,7 @@\n from __future__ import unicode_literals\n import re\n \n+from django.conf import settings\n from django.template import (Node, Variable, TemplateSyntaxError,\n     TokenParser, Library, TOKEN_TEXT, TOKEN_VAR)\n from django.template.base import render_value_in_context\n@@ -17,7 +18,6 @@ def __init__(self, variable):\n         self.variable = variable\n \n     def render(self, context):\n-        from django.conf import settings\n         context[self.variable] = [(k, translation.ugettext(v)) for k, v in settings.LANGUAGES]\n         return ''\n \n@@ -143,7 +143,10 @@ def render(self, context, nested=False):\n                 result = translation.pgettext(message_context, singular)\n             else:\n                 result = translation.ugettext(singular)\n-        data = dict([(v, render_value_in_context(context.get(v, ''), context)) for v in vars])\n+        default_value = settings.TEMPLATE_STRING_IF_INVALID\n+        render_value = lambda v: render_value_in_context(\n+            context.get(v, default_value), context)\n+        data = dict([(v, render_value(v)) for v in vars])\n         context.pop()\n         try:\n             result = result % data"
        },
        {
            "sha": "ccde5eae976a26605d3cca21fc6078d3b78beb51",
            "filename": "tests/template_tests/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/804366327d728d23a9f7a25ff77a6eed3c9f9323/tests%2Ftemplate_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/804366327d728d23a9f7a25ff77a6eed3c9f9323/tests%2Ftemplate_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Ftemplate_tests%2Ftests.py?ref=804366327d728d23a9f7a25ff77a6eed3c9f9323",
            "patch": "@@ -1392,7 +1392,10 @@ def get_template_tests(self):\n             'i18n33': ('{% load i18n %}{{ langcode|language_name }} {{ langcode|language_name_local }} {{ langcode|language_bidi }}', {'langcode': 'nl'}, 'Dutch Nederlands False'),\n \n             # blocktrans handling of variables which are not in the context.\n-            'i18n34': ('{% load i18n %}{% blocktrans %}{{ missing }}{% endblocktrans %}', {}, ''),\n+            # this should work as if blocktrans was not there (bug #19915)\n+            'i18n34': ('{% load i18n %}{% blocktrans %}{{ missing }}{% endblocktrans %}', {}, ('', 'INVALID')),\n+            'i18n34_2': (\"{% load i18n %}{% blocktrans with a='α' %}{{ missing }}{% endblocktrans %}\", {}, ('', 'INVALID')),\n+            'i18n34_3': ('{% load i18n %}{% blocktrans with a=anton %}{{ missing }}{% endblocktrans %}', {'anton': 'α'}, ('', 'INVALID')),\n \n             # trans tag with as var\n             'i18n35': ('{% load i18n %}{% trans \"Page not found\" as page_not_found %}{{ page_not_found }}', {'LANGUAGE_CODE': 'de'}, \"Seite nicht gefunden\"),"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 9,
        "deletions": 3
    }
}