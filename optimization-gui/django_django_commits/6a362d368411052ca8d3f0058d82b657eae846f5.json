{
    "author": "alex",
    "message": "Fixed #14750 -- ILPostalCodeField didn't handle all EMPTY_VALUES correctly.  Also converted the Israeli localflavor testcases to use the new, less verbose format.  Thanks to Idan Gazit.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14943 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6a362d368411052ca8d3f0058d82b657eae846f5",
    "files": [
        {
            "sha": "a14358737ebb2d1f639f1f56536cdcf47cef08e5",
            "filename": "django/contrib/localflavor/il/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a362d368411052ca8d3f0058d82b657eae846f5/django%2Fcontrib%2Flocalflavor%2Fil%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/6a362d368411052ca8d3f0058d82b657eae846f5/django%2Fcontrib%2Flocalflavor%2Fil%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fil%2Fforms.py?ref=6a362d368411052ca8d3f0058d82b657eae846f5",
            "patch": "@@ -4,6 +4,7 @@\n import re\n \n from django.core.exceptions import ValidationError\n+from django.core.validators import EMPTY_VALUES\n from django.forms.fields import RegexField, Field, EMPTY_VALUES\n from django.utils.checksums import luhn\n from django.utils.translation import ugettext_lazy as _\n@@ -34,7 +35,7 @@ def __init__(self, *args, **kwargs):\n         super(ILPostalCodeField, self).__init__(r'^\\d{5}$', *args, **kwargs)\n \n     def clean(self, value):\n-        if value is not None:\n+        if value not in EMPTY_VALUES:\n             value = value.replace(\" \", \"\")\n         return super(ILPostalCodeField, self).clean(value)\n "
        },
        {
            "sha": "c7323e943ce921861df91893b802b01cab2f3b5b",
            "filename": "tests/regressiontests/forms/localflavor/il.py",
            "status": "modified",
            "additions": 34,
            "deletions": 52,
            "changes": 86,
            "blob_url": "https://github.com/django/django/blob/6a362d368411052ca8d3f0058d82b657eae846f5/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fil.py",
            "raw_url": "https://github.com/django/django/raw/6a362d368411052ca8d3f0058d82b657eae846f5/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fil.py?ref=6a362d368411052ca8d3f0058d82b657eae846f5",
            "patch": "@@ -1,57 +1,39 @@\n from django.contrib.localflavor.il.forms import (ILPostalCodeField,\n     ILIDNumberField)\n-from django.core.exceptions import ValidationError\n-from django.utils.unittest import TestCase\n \n+from utils import LocalFlavorTestCase\n \n-class ILLocalFlavorTests(TestCase):\n-    def test_postal_code_field(self):\n-        f = ILPostalCodeField()\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a postal code in the format XXXXX\",\n-            f.clean, \"84545x\"\n-        )\n-        self.assertEqual(f.clean(\"69973\"), \"69973\")\n-        self.assertEqual(f.clean(\"699 73\"), \"69973\")\n-        self.assertEqual(f.clean(\"12345\"), \"12345\")\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a postal code in the format XXXXX\",\n-            f.clean, \"123456\"\n-        )\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a postal code in the format XXXXX\",\n-            f.clean, \"1234\"\n-        )\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a postal code in the format XXXXX\",\n-            f.clean, \"123 4\"\n-        )\n-        self.assertRaises(ValidationError, f.clean, None)\n \n-    def test_id_number_field(self):\n-        f = ILIDNumberField()\n-        self.assertEqual(f.clean(\"3933742-3\"), \"39337423\")\n-        self.assertEqual(f.clean(\"39337423\"), \"39337423\")\n-        self.assertEqual(f.clean(\"039337423\"), \"039337423\")\n-        self.assertEqual(f.clean(\"03933742-3\"), \"039337423\")\n-        self.assertEqual(f.clean(\"0091\"), \"0091\")\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a valid ID number.\",\n-            f.clean, \"123456789\"\n-        )\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a valid ID number.\",\n-            f.clean, \"12345678-9\"\n-        )\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a valid ID number.\",\n-            f.clean, \"012346578\"\n-        )\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a valid ID number.\",\n-            f.clean, \"012346578-\"\n-        )\n-        self.assertRaisesRegexp(ValidationError,\n-            \"Enter a valid ID number.\",\n-            f.clean, \"0001\"\n-        )\n+class ILLocalFlavorTests(LocalFlavorTestCase):\n+    def test_ILPostalCodeField(self):\n+        error_format = [u'Enter a postal code in the format XXXXX']\n+        valid = {\n+            '69973': '69973',\n+            '699 73': '69973',\n+            '12345': '12345',\n+        }\n+        invalid = {\n+            '84545x': error_format,\n+            '123456': error_format,\n+            '1234': error_format,\n+            '123 4': error_format,\n+        }\n+        self.assertFieldOutput(ILPostalCodeField, valid, invalid)\n+\n+    def test_ILIDNumberField(self):\n+        error_invalid = [u'Enter a valid ID number.']\n+        valid = {\n+            '3933742-3': '39337423',\n+            '39337423': '39337423',\n+            '039337423': '039337423',\n+            '03933742-3': '039337423',\n+            '0091': '0091',\n+        }\n+        invalid = {\n+            '123456789': error_invalid,\n+            '12345678-9': error_invalid,\n+            '012346578': error_invalid,\n+            '012346578-': error_invalid,\n+            '0001': error_invalid,\n+        }\n+        self.assertFieldOutput(ILIDNumberField, valid, invalid)"
        }
    ],
    "stats": {
        "total": 89,
        "additions": 36,
        "deletions": 53
    }
}