{
    "author": "freakboy3742",
    "message": "Fixed #14773 -- Modified MultipleObjectMixin to allow for custom paginators. Thanks to piquadrat for the report and initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14828 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "ee48da24050a4f447f6ba153430c59b93a1522b3",
    "files": [
        {
            "sha": "d90842fedc703795d06a63ee2afad800e4f53caa",
            "filename": "django/views/generic/list.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/ee48da24050a4f447f6ba153430c59b93a1522b3/django%2Fviews%2Fgeneric%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/ee48da24050a4f447f6ba153430c59b93a1522b3/django%2Fviews%2Fgeneric%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Flist.py?ref=ee48da24050a4f447f6ba153430c59b93a1522b3",
            "patch": "@@ -10,6 +10,7 @@ class MultipleObjectMixin(object):\n     model = None\n     paginate_by = None\n     context_object_name = None\n+    paginator_class = Paginator\n \n     def get_queryset(self):\n         \"\"\"\n@@ -32,7 +33,7 @@ def paginate_queryset(self, queryset, page_size):\n         Paginate the queryset, if needed.\n         \"\"\"\n         if queryset.count() > page_size:\n-            paginator = Paginator(queryset, page_size, allow_empty_first_page=self.get_allow_empty())\n+            paginator = self.get_paginator(queryset, page_size, allow_empty_first_page=self.get_allow_empty())\n             page = self.kwargs.get('page', None) or self.request.GET.get('page', 1)\n             try:\n                 page_number = int(page)\n@@ -55,6 +56,12 @@ def get_paginate_by(self, queryset):\n         \"\"\"\n         return self.paginate_by\n \n+    def get_paginator(self, queryset, per_page, orphans=0, allow_empty_first_page=True):\n+        \"\"\"\n+        Return an instance of the paginator for this view.\n+        \"\"\"\n+        return self.paginator_class(queryset, per_page, orphans=orphans, allow_empty_first_page=allow_empty_first_page)\n+\n     def get_allow_empty(self):\n         \"\"\"\n         Returns ``True`` if the view should display empty lists, and ``False``"
        },
        {
            "sha": "1b9a9f99ea01c7765a02d8b5304e4afac7efa9c4",
            "filename": "docs/ref/class-based-views.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/ee48da24050a4f447f6ba153430c59b93a1522b3/docs%2Fref%2Fclass-based-views.txt",
            "raw_url": "https://github.com/django/django/raw/ee48da24050a4f447f6ba153430c59b93a1522b3/docs%2Fref%2Fclass-based-views.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views.txt?ref=ee48da24050a4f447f6ba153430c59b93a1522b3",
            "patch": "@@ -305,6 +305,14 @@ MultipleObjectMixin\n         expect either a ``page`` query string parameter (via ``GET``) or a\n         ``page`` variable specified in the URLconf.\n \n+    .. attribute:: paginator_class\n+\n+       The paginator class to be used for pagination. By default,\n+       :class:`django.core.paginator.Paginator` is used. If the custom paginator\n+       class doesn't have the same constructor interface as\n+       :class:`django.core.paginator.Paginator`, you will also need to\n+       provide an implementation for :meth:`MultipleObjectMixin.get_paginator`.\n+\n     .. attribute:: context_object_name\n \n         Designates the name of the variable to use in the context.\n@@ -329,6 +337,11 @@ MultipleObjectMixin\n         pagination. By default this simply returns the value of\n         :attr:`MultipleObjectMixin.paginate_by`.\n \n+    .. method:: get_paginator(queryset, queryset, per_page, orphans=0, allow_empty_first_page=True)\n+\n+        Returns an instance of the paginator to use for this view. By default,\n+        instantiates an instance of :attr:`paginator_class`.\n+\n     .. method:: get_allow_empty()\n \n         Return a boolean specifying whether to display the page if no objects"
        },
        {
            "sha": "bde741ef26a409d60d54ce7de3b4a8f990fd07da",
            "filename": "tests/regressiontests/generic_views/list.py",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/ee48da24050a4f447f6ba153430c59b93a1522b3/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/ee48da24050a4f447f6ba153430c59b93a1522b3/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Flist.py?ref=ee48da24050a4f447f6ba153430c59b93a1522b3",
            "patch": "@@ -2,7 +2,7 @@\n from django.test import TestCase\n \n from regressiontests.generic_views.models import Author\n-\n+from regressiontests.generic_views.views import CustomPaginator\n \n class ListViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n@@ -86,6 +86,21 @@ def test_paginated_invalid_page(self):\n         res = self.client.get('/list/authors/paginated/?page=frog')\n         self.assertEqual(res.status_code, 404)\n \n+    def test_paginated_custom_paginator_class(self):\n+        self._make_authors(7)\n+        res = self.client.get('/list/authors/paginated/custom_class/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertIsInstance(res.context['paginator'], CustomPaginator)\n+        # Custom pagination allows for 2 orphans on a page size of 5\n+        self.assertEqual(len(res.context['object_list']), 7)\n+\n+    def test_paginated_custom_paginator_constructor(self):\n+        self._make_authors(7)\n+        res = self.client.get('/list/authors/paginated/custom_constructor/')\n+        self.assertEqual(res.status_code, 200)\n+        # Custom pagination allows for 2 orphans on a page size of 5\n+        self.assertEqual(len(res.context['object_list']), 7)\n+\n     def test_allow_empty_false(self):\n         res = self.client.get('/list/authors/notempty/')\n         self.assertEqual(res.status_code, 200)"
        },
        {
            "sha": "db09d6369207557d68c7f5037429801e2c08be09",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/ee48da24050a4f447f6ba153430c59b93a1522b3/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/ee48da24050a4f447f6ba153430c59b93a1522b3/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=ee48da24050a4f447f6ba153430c59b93a1522b3",
            "patch": "@@ -117,6 +117,10 @@\n         views.AuthorList.as_view(context_object_name='object_list')),\n     (r'^list/authors/invalid/$',\n         views.AuthorList.as_view(queryset=None)),\n+    (r'^list/authors/paginated/custom_class/$',\n+        views.AuthorList.as_view(paginate_by=5, paginator_class=views.CustomPaginator)),\n+    (r'^list/authors/paginated/custom_constructor/$',\n+        views.AuthorListCustomPaginator.as_view()),\n \n     # YearArchiveView\n     # Mixing keyword and possitional captures below is intentional; the views"
        },
        {
            "sha": "e3a3c4069414aacaef8dfeecfc738aa3f36d7121",
            "filename": "tests/regressiontests/generic_views/views.py",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/ee48da24050a4f447f6ba153430c59b93a1522b3/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/ee48da24050a4f447f6ba153430c59b93a1522b3/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py?ref=ee48da24050a4f447f6ba153430c59b93a1522b3",
            "patch": "@@ -1,4 +1,5 @@\n from django.contrib.auth.decorators import login_required\n+from django.core.paginator import Paginator\n from django.core.urlresolvers import reverse\n from django.utils.decorators import method_decorator\n from django.views import generic\n@@ -50,6 +51,23 @@ class AuthorList(generic.ListView):\n     queryset = Author.objects.all()\n \n \n+class CustomPaginator(Paginator):\n+    def __init__(self, queryset, page_size, orphans=0, allow_empty_first_page=True):\n+        super(CustomPaginator, self).__init__(\n+            queryset,\n+            page_size,\n+            orphans=2,\n+            allow_empty_first_page=allow_empty_first_page)\n+\n+class AuthorListCustomPaginator(AuthorList):\n+    paginate_by = 5;\n+\n+    def get_paginator(self, queryset, page_size, orphans=0, allow_empty_first_page=True):\n+        return super(AuthorListCustomPaginator, self).get_paginator(\n+            queryset,\n+            page_size,\n+            orphans=2,\n+            allow_empty_first_page=allow_empty_first_page)\n \n class ArtistCreate(generic.CreateView):\n     model = Artist"
        }
    ],
    "stats": {
        "total": 61,
        "additions": 59,
        "deletions": 2
    }
}