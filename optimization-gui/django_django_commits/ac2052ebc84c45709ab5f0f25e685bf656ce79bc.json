{
    "author": "ulope",
    "message": "Fixed #17549 -- Added a clickable link for URLFields in admin change list.",
    "sha": "ac2052ebc84c45709ab5f0f25e685bf656ce79bc",
    "files": [
        {
            "sha": "3b19353e6fcc6cc2ab7dba22761449531377c38d",
            "filename": "django/contrib/admin/static/admin/css/widgets.css",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css",
            "raw_url": "https://github.com/django/django/raw/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css?ref=ac2052ebc84c45709ab5f0f25e685bf656ce79bc",
            "patch": "@@ -225,6 +225,21 @@ table p.datetime {\n     padding-left: 0;\n }\n \n+/* URL */\n+\n+p.url {\n+    line-height: 20px;\n+    margin: 0;\n+    padding: 0;\n+    color: #666;\n+    font-size: 11px;\n+    font-weight: bold;\n+}\n+\n+.url a {\n+    font-weight: normal;\n+}\n+\n /* FILE UPLOADS */\n \n p.file-upload {"
        },
        {
            "sha": "1e6277fb87f398e97d5300e51881572d6f751983",
            "filename": "django/contrib/admin/widgets.py",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fwidgets.py?ref=ac2052ebc84c45709ab5f0f25e685bf656ce79bc",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.urlresolvers import reverse\n from django.forms.widgets import RadioFieldRenderer\n from django.forms.util import flatatt\n-from django.utils.html import escape, format_html, format_html_join\n+from django.utils.html import escape, format_html, format_html_join, smart_urlquote\n from django.utils.text import Truncator\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n@@ -306,6 +306,19 @@ def __init__(self, attrs=None):\n             final_attrs.update(attrs)\n         super(AdminURLFieldWidget, self).__init__(attrs=final_attrs)\n \n+    def render(self, name, value, attrs=None):\n+        html = super(AdminURLFieldWidget, self).render(name, value, attrs)\n+        if value:\n+            value = force_text(self._format_value(value))\n+            final_attrs = {'href': mark_safe(smart_urlquote(value))}\n+            html = format_html(\n+                '<p class=\"url\">{0} <a {1}>{2}</a><br />{3} {4}</p>',\n+                _('Currently:'), flatatt(final_attrs), value,\n+                _('Change:'), html\n+            )\n+        return html\n+\n+\n class AdminIntegerFieldWidget(forms.TextInput):\n     class_name = 'vIntegerField'\n "
        },
        {
            "sha": "d8ea6bb31ddc9181190526d6a71777159de70a3c",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=ac2052ebc84c45709ab5f0f25e685bf656ce79bc",
            "patch": "@@ -922,6 +922,11 @@ Like all :class:`CharField` subclasses, :class:`URLField` takes the optional\n :attr:`~CharField.max_length`argument. If you don't specify\n :attr:`~CharField.max_length`, a default of 200 is used.\n \n+.. versionadded:: 1.5\n+\n+The current value of the field will be displayed as a clickable link above the\n+input widget.\n+\n \n Relationship fields\n ==================="
        },
        {
            "sha": "0b016d885b1754892b5c46bc521c4f47b13322a1",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ac2052ebc84c45709ab5f0f25e685bf656ce79bc/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=ac2052ebc84c45709ab5f0f25e685bf656ce79bc",
            "patch": "@@ -266,6 +266,37 @@ def test_localization(self):\n                 )\n \n \n+class AdminURLWidgetTest(DjangoTestCase):\n+    def test_render(self):\n+        w = widgets.AdminURLFieldWidget()\n+        self.assertHTMLEqual(\n+            conditional_escape(w.render('test', '')),\n+            '<input class=\"vURLField\" name=\"test\" type=\"text\" />'\n+        )\n+        self.assertHTMLEqual(\n+            conditional_escape(w.render('test', 'http://example.com')),\n+            '<p class=\"url\">Currently:<a href=\"http://example.com\">http://example.com</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example.com\" /></p>'\n+        )\n+\n+    def test_render_idn(self):\n+        w = widgets.AdminURLFieldWidget()\n+        self.assertHTMLEqual(\n+            conditional_escape(w.render('test', 'http://example-äüö.com')),\n+            '<p class=\"url\">Currently:<a href=\"http://xn--example--7za4pnc.com\">http://example-äüö.com</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example-äüö.com\" /></p>'\n+        )\n+\n+    def test_render_quoting(self):\n+        w = widgets.AdminURLFieldWidget()\n+        self.assertHTMLEqual(\n+            conditional_escape(w.render('test', 'http://example.com/<sometag>some text</sometag>')),\n+            '<p class=\"url\">Currently:<a href=\"http://example.com/%3Csometag%3Esome%20text%3C/sometag%3E\">http://example.com/&lt;sometag&gt;some text&lt;/sometag&gt;</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example.com/<sometag>some text</sometag>\" /></p>'\n+        )\n+        self.assertHTMLEqual(\n+            conditional_escape(w.render('test', 'http://example-äüö.com/<sometag>some text</sometag>')),\n+            '<p class=\"url\">Currently:<a href=\"http://xn--example--7za4pnc.com/%3Csometag%3Esome%20text%3C/sometag%3E\">http://example-äüö.com/&lt;sometag&gt;some text&lt;/sometag&gt;</a><br />Change:<input class=\"vURLField\" name=\"test\" type=\"text\" value=\"http://example-äüö.com/<sometag>some text</sometag>\" /></p>'\n+        )\n+\n+\n class AdminFileWidgetTest(DjangoTestCase):\n     def test_render(self):\n         band = models.Band.objects.create(name='Linkin Park')"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 65,
        "deletions": 1
    }
}