{
    "author": "aaugustin",
    "message": "[py3] Fixed another regression from 2892cb0ec4.",
    "sha": "5f2d9cdbb1b1a8c91dcdd55e672801536711b5ef",
    "files": [
        {
            "sha": "64abd6fa6e15ff8810689a870205f12402a1da0d",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/5f2d9cdbb1b1a8c91dcdd55e672801536711b5ef/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/5f2d9cdbb1b1a8c91dcdd55e672801536711b5ef/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=5f2d9cdbb1b1a8c91dcdd55e672801536711b5ef",
            "patch": "@@ -673,11 +673,11 @@ def _get_content(self):\n         if self.has_header('Content-Encoding'):\n             def make_bytes(value):\n                 if isinstance(value, int):\n-                    return six.text_type(value).encode()\n-                elif isinstance(value, six.text_type):\n-                    return value.encode('ascii')\n-                else:\n-                    return bytes(value)\n+                    value = six.text_type(value)\n+                if isinstance(value, six.text_type):\n+                    value = value.encode('ascii')\n+                # force conversion to bytes in case chunk is a subclass\n+                return bytes(value)\n             return b''.join(make_bytes(e) for e in self._container)\n         return b''.join(smart_bytes(e, self._charset) for e in self._container)\n \n@@ -698,9 +698,10 @@ def __iter__(self):\n     def __next__(self):\n         chunk = next(self._iterator)\n         if isinstance(chunk, int):\n-            return six.text_type(chunk).encode()\n+            chunk = six.text_type(chunk)\n         if isinstance(chunk, six.text_type):\n-            return chunk.encode(self._charset)\n+            chunk = chunk.encode(self._charset)\n+        # force conversion to bytes in case chunk is a subclass\n         return bytes(chunk)\n \n     next = __next__             # Python 2 compatibility"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}