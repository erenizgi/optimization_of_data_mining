{
    "author": "unknown",
    "message": "Added a db_constraint option to ForeignKeys.\n\nThis controls whether or not a database level cosntraint is created. This is useful in a few specialized circumstances, but in general should not be used!",
    "sha": "b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
    "files": [
        {
            "sha": "89ff1170dca1a9269613e768309ef149a5a55dea",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
            "patch": "@@ -77,7 +77,7 @@ def sql_create_model(self, model, style, known_models=set()):\n                     tablespace, inline=True)\n                 if tablespace_sql:\n                     field_output.append(tablespace_sql)\n-            if f.rel:\n+            if f.rel and f.db_constraint:\n                 ref_output, pending = self.sql_for_inline_foreign_key_references(\n                     model, f, known_models, style)\n                 if pending:"
        },
        {
            "sha": "804dda5817dc444916adf5efc26931daae8d5713",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
            "patch": "@@ -981,9 +981,10 @@ class ForeignKey(RelatedField, Field):\n     }\n     description = _(\"Foreign Key (type determined by related field)\")\n \n-    def __init__(self, to, to_field=None, rel_class=ManyToOneRel, **kwargs):\n+    def __init__(self, to, to_field=None, rel_class=ManyToOneRel,\n+                 db_constraint=True, **kwargs):\n         try:\n-            to_name = to._meta.model_name\n+            to._meta.model_name\n         except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ForeignKey must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n         else:\n@@ -997,13 +998,14 @@ def __init__(self, to, to_field=None, rel_class=ManyToOneRel, **kwargs):\n         if 'db_index' not in kwargs:\n             kwargs['db_index'] = True\n \n+        self.db_constraint = db_constraint\n         kwargs['rel'] = rel_class(to, to_field,\n             related_name=kwargs.pop('related_name', None),\n             limit_choices_to=kwargs.pop('limit_choices_to', None),\n             parent_link=kwargs.pop('parent_link', False),\n             on_delete=kwargs.pop('on_delete', CASCADE),\n         )\n-        Field.__init__(self, **kwargs)\n+        super(ForeignKey, self).__init__(**kwargs)\n \n     def get_path_info(self):\n         \"\"\""
        },
        {
            "sha": "a4ae66d49215eff713b9e810b0e3079a50d8961b",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
            "patch": "@@ -1051,6 +1051,19 @@ define the details of how the relation works.\n     The field on the related object that the relation is to. By default, Django\n     uses the primary key of the related object.\n \n+.. attribute:: ForeignKey.db_constraint\n+\n+    Controls whether or not a constraint should be created in the database for\n+    this foreign key. The default is ``True``, and that's almost certainly what\n+    you want; setting this to ``False`` can be very bad for data integrity.\n+    That said, here are some scenarios where you might want to do this:\n+\n+    * You have legacy data that is not valid.\n+    * You're sharding your database.\n+\n+    If you use this, accessing a related object that doesn't exist will raise\n+    its ``DoesNotExist`` exception.\n+\n .. attribute:: ForeignKey.on_delete\n \n     When an object referenced by a :class:`ForeignKey` is deleted, Django by"
        },
        {
            "sha": "8f1a4f375e9288fa37082318f5a5fc350fd595da",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
            "patch": "@@ -85,6 +85,9 @@ Minor features\n   :class:`~django.http.HttpResponsePermanentRedirect` now provide an ``url``\n   attribute (equivalent to the URL the response will redirect to).\n \n+* Added the :attr:`django.db.models.ForeignKey.db_constraint`\n+  option.\n+\n Backwards incompatible changes in 1.6\n =====================================\n "
        },
        {
            "sha": "5876cbe52dbce3a2bed7e2d22c20f8ce8d71eeb5",
            "filename": "tests/regressiontests/backends/models.py",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/tests%2Fregressiontests%2Fbackends%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/tests%2Fregressiontests%2Fbackends%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Fmodels.py?ref=b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
            "patch": "@@ -39,7 +39,7 @@ class Meta:\n             verbose_name = 'model_with_long_table_name'\n         primary_key_is_quite_long_zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz = models.AutoField(primary_key=True)\n         charfield_is_quite_long_zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz = models.CharField(max_length=100)\n-        m2m_also_quite_long_zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz = models.ManyToManyField(Person,blank=True)\n+        m2m_also_quite_long_zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz = models.ManyToManyField(Person, blank=True)\n \n \n class Tag(models.Model):\n@@ -86,3 +86,16 @@ class Item(models.Model):\n \n     def __str__(self):\n         return self.name\n+\n+\n+@python_2_unicode_compatible\n+class Object(models.Model):\n+    pass\n+\n+\n+@python_2_unicode_compatible\n+class ObjectReference(models.Model):\n+    obj = models.ForeignKey(Object, db_constraint=False)\n+\n+    def __str__(self):\n+        return str(self.obj_id)"
        },
        {
            "sha": "0e1700b36e36b0ce5e7570602e3654f96607dbc6",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 21,
            "deletions": 3,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b55cde054ee7dd22f93c3522a8ddb1d04193bcac/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=b55cde054ee7dd22f93c3522a8ddb1d04193bcac",
            "patch": "@@ -7,13 +7,12 @@\n \n from django.conf import settings\n from django.core.management.color import no_style\n-from django.core.exceptions import ImproperlyConfigured\n from django.db import (backend, connection, connections, DEFAULT_DB_ALIAS,\n     IntegrityError, transaction)\n from django.db.backends.signals import connection_created\n from django.db.backends.postgresql_psycopg2 import version as pg_version\n-from django.db.models import fields, Sum, Avg, Variance, StdDev\n-from django.db.utils import ConnectionHandler, DatabaseError, load_backend\n+from django.db.models import Sum, Avg, Variance, StdDev\n+from django.db.utils import ConnectionHandler, DatabaseError\n from django.test import (TestCase, skipUnlessDBFeature, skipIfDBFeature,\n     TransactionTestCase)\n from django.test.utils import override_settings, str_prefix\n@@ -724,3 +723,22 @@ class MySQLPKZeroTests(TestCase):\n     def test_zero_as_autoval(self):\n         with self.assertRaises(ValueError):\n             models.Square.objects.create(id=0, root=0, square=1)\n+\n+\n+class DBConstraintTestCase(TransactionTestCase):\n+    def test_can_reference_existant(self):\n+        obj = models.Object.objects.create()\n+        ref = models.ObjectReference.objects.create(obj=obj)\n+        self.assertEqual(ref.obj, obj)\n+\n+        ref = models.ObjectReference.objects.get(obj=obj)\n+        self.assertEqual(ref.obj, obj)\n+\n+    def test_can_reference_non_existant(self):\n+        self.assertFalse(models.Object.objects.filter(id=12345).exists())\n+        ref = models.ObjectReference.objects.create(obj_id=12345)\n+        ref_new = models.ObjectReference.objects.get(obj_id=12345)\n+        self.assertEqual(ref, ref_new)\n+\n+        with self.assertRaises(models.Object.DoesNotExist):\n+            ref.obj"
        }
    ],
    "stats": {
        "total": 65,
        "additions": 57,
        "deletions": 8
    }
}