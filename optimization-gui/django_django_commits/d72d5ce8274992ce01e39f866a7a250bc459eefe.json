{
    "author": "ramiro",
    "message": "Fixed #16409 (again, this time for GeoDjango).\n\nThanks Aymeric Augustin for the regression test and Petr Gorodechnyj for\nthe patch.\n\nRefs r16522.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17506 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d72d5ce8274992ce01e39f866a7a250bc459eefe",
    "files": [
        {
            "sha": "a7c3fbc406e45a9e3160434c69db9172335dee99",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d72d5ce8274992ce01e39f866a7a250bc459eefe/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/d72d5ce8274992ce01e39f866a7a250bc459eefe/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=d72d5ce8274992ce01e39f866a7a250bc459eefe",
            "patch": "@@ -37,7 +37,7 @@ def get_columns(self, with_aliases=False):\n                 if isinstance(col, (list, tuple)):\n                     alias, column = col\n                     table = self.query.alias_map[alias][TABLE_NAME]\n-                    if table in only_load and col not in only_load[table]:\n+                    if table in only_load and column not in only_load[table]:\n                         continue\n                     r = self.get_field_select(field, alias, column)\n                     if with_aliases:"
        },
        {
            "sha": "1e684402867daa0d7babb38d34ed4e3817400734",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/d72d5ce8274992ce01e39f866a7a250bc459eefe/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/d72d5ce8274992ce01e39f866a7a250bc459eefe/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=d72d5ce8274992ce01e39f866a7a250bc459eefe",
            "patch": "@@ -4,6 +4,7 @@\n \n from django.contrib.gis.tests.utils import no_mysql, no_spatialite\n from django.contrib.gis.shortcuts import render_to_kmz\n+from django.db.models import Count\n from django.test import TestCase\n \n from .models import City, PennsylvaniaCity, State\n@@ -58,3 +59,8 @@ def test05_empty_count(self):\n \n          # .count() should not throw TypeError in __eq__\n          self.assertEqual(cities_within_state.count(), 1)\n+\n+    def test06_defer_or_only_with_annotate(self):\n+        \"Regression for #16409 - make sure defer() and only() work with annotate()\"\n+        self.assertIsInstance(list(City.objects.annotate(Count('point')).defer('name')), list)\n+        self.assertIsInstance(list(City.objects.annotate(Count('point')).only('name')), list)"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 7,
        "deletions": 1
    }
}