{
    "author": "freakboy3742",
    "message": "Fixed #14240 -- Enabled localization for the filesize filter. Thanks to David Danier for the report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15290 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b",
    "files": [
        {
            "sha": "1a3a82b26f803fdce4cdc4fec0e0ed10e3940eee",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b",
            "patch": "@@ -131,7 +131,7 @@ answer newbie questions, and generally made Django that much better:\n     dackze+django@gmail.com\n     Jim Dalton <jim.dalton@gmail.com>\n     Mihai Damian <yang_damian@yahoo.com>\n-    David Danier <goliath.mailinglist@gmx.de>\n+    David Danier <david.danier@team23.de>\n     Dirk Datzert <dummy@habmalnefrage.de>\n     Jonathan Daugherty (cygnus) <http://www.cprogrammer.org/>\n     dave@thebarproject.com"
        },
        {
            "sha": "8fabef642f0f807f61524272c61a5ee7204a6493",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b",
            "patch": "@@ -799,19 +799,21 @@ def filesizeformat(bytes):\n     try:\n         bytes = float(bytes)\n     except (TypeError,ValueError,UnicodeDecodeError):\n-        return u\"0 bytes\"\n+        return ungettext(\"%(size)d byte\", \"%(size)d bytes\", 0) % {'size': 0}\n+\n+    filesize_number_format = lambda value: formats.number_format(round(value, 1), 1)\n \n     if bytes < 1024:\n         return ungettext(\"%(size)d byte\", \"%(size)d bytes\", bytes) % {'size': bytes}\n     if bytes < 1024 * 1024:\n-        return ugettext(\"%.1f KB\") % (bytes / 1024)\n+        return ugettext(\"%s KB\") % filesize_number_format(bytes / 1024)\n     if bytes < 1024 * 1024 * 1024:\n-        return ugettext(\"%.1f MB\") % (bytes / (1024 * 1024))\n+        return ugettext(\"%s MB\") % filesize_number_format(bytes / (1024 * 1024))\n     if bytes < 1024 * 1024 * 1024 * 1024:\n-        return ugettext(\"%.1f GB\") % (bytes / (1024 * 1024 * 1024))\n+        return ugettext(\"%s GB\") % filesize_number_format(bytes / (1024 * 1024 * 1024))\n     if bytes < 1024 * 1024 * 1024 * 1024 * 1024:\n-        return ugettext(\"%.1f TB\") % (bytes / (1024 * 1024 * 1024 * 1024))\n-    return ugettext(\"%.1f PB\") % (bytes / (1024 * 1024 * 1024 * 1024 * 1024))\n+        return ugettext(\"%s TB\") % filesize_number_format(bytes / (1024 * 1024 * 1024 * 1024))\n+    return ugettext(\"%s PB\") % filesize_number_format(bytes / (1024 * 1024 * 1024 * 1024 * 1024))\n filesizeformat.is_safe = True\n \n def pluralize(value, arg=u's'):"
        },
        {
            "sha": "95140b7dafc8fc790334ba00c546c301676f9eaa",
            "filename": "tests/regressiontests/defaultfilters/tests.py",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b/tests%2Fregressiontests%2Fdefaultfilters%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b/tests%2Fregressiontests%2Fdefaultfilters%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdefaultfilters%2Ftests.py?ref=3a6491cf56ccd8b5cdbc081034b9ab4a9dbc596b",
            "patch": "@@ -443,6 +443,33 @@ def test_filesizeformat(self):\n         self.assertEqual(filesizeformat(u\"\\N{GREEK SMALL LETTER ALPHA}\"),\n                           u'0 bytes')\n \n+    def test_localized_filesizeformat(self):\n+        from django.utils.translation import activate, deactivate\n+        old_localize = settings.USE_L10N\n+        try:\n+            activate('de')\n+            settings.USE_L10N = True\n+            self.assertEqual(filesizeformat(1023), u'1023 Bytes')\n+            self.assertEqual(filesizeformat(1024), u'1,0 KB')\n+            self.assertEqual(filesizeformat(10*1024), u'10,0 KB')\n+            self.assertEqual(filesizeformat(1024*1024-1), u'1024,0 KB')\n+            self.assertEqual(filesizeformat(1024*1024), u'1,0 MB')\n+            self.assertEqual(filesizeformat(1024*1024*50), u'50,0 MB')\n+            self.assertEqual(filesizeformat(1024*1024*1024-1), u'1024,0 MB')\n+            self.assertEqual(filesizeformat(1024*1024*1024), u'1,0 GB')\n+            self.assertEqual(filesizeformat(1024*1024*1024*1024), u'1,0 TB')\n+            self.assertEqual(filesizeformat(1024*1024*1024*1024*1024),\n+                              u'1,0 PB')\n+            self.assertEqual(filesizeformat(1024*1024*1024*1024*1024*2000),\n+                              u'2000,0 PB')\n+            self.assertEqual(filesizeformat(complex(1,-1)), u'0 Bytes')\n+            self.assertEqual(filesizeformat(\"\"), u'0 Bytes')\n+            self.assertEqual(filesizeformat(u\"\\N{GREEK SMALL LETTER ALPHA}\"),\n+                              u'0 Bytes')\n+        finally:\n+            deactivate()\n+            settings.USE_L10N = old_localize\n+\n     def test_pluralize(self):\n         self.assertEqual(pluralize(1), u'')\n         self.assertEqual(pluralize(0), u's')"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 36,
        "deletions": 7
    }
}