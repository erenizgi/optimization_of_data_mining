{
    "author": "alex",
    "message": "Fixed #13159 -- properly quote aggregates in order_by.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15318 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "80287f1e8a554290faa6a0c31113a9f4eecf7b79",
    "files": [
        {
            "sha": "d425c8b32b5c0b49007fda045001b809b5e1f64f",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/80287f1e8a554290faa6a0c31113a9f4eecf7b79/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/80287f1e8a554290faa6a0c31113a9f4eecf7b79/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=80287f1e8a554290faa6a0c31113a9f4eecf7b79",
            "patch": "@@ -330,7 +330,7 @@ def get_ordering(self):\n                 continue\n             col, order = get_order_dir(field, asc)\n             if col in self.query.aggregate_select:\n-                result.append('%s %s' % (col, order))\n+                result.append('%s %s' % (qn(col), order))\n                 continue\n             if '.' in field:\n                 # This came in through an extra(order_by=...) addition. Pass it"
        },
        {
            "sha": "67220b7c77a1b540382c2e9c5c5ac468a3f625d3",
            "filename": "tests/regressiontests/aggregation_regress/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/80287f1e8a554290faa6a0c31113a9f4eecf7b79/tests%2Fregressiontests%2Faggregation_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/80287f1e8a554290faa6a0c31113a9f4eecf7b79/tests%2Fregressiontests%2Faggregation_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Faggregation_regress%2Ftests.py?ref=80287f1e8a554290faa6a0c31113a9f4eecf7b79",
            "patch": "@@ -747,6 +747,19 @@ def test_annotation_disjunction(self):\n             attrgetter(\"name\")\n         )\n \n+    def test_quoting_aggregate_order_by(self):\n+        qs = Book.objects.filter(\n+            name=\"Python Web Development with Django\"\n+        ).annotate(\n+            authorCount=Count(\"authors\")\n+        ).order_by(\"authorCount\")\n+        self.assertQuerysetEqual(\n+            qs, [\n+                (\"Python Web Development with Django\", 3),\n+            ],\n+            lambda b: (b.name, b.authorCount)\n+        )\n+\n     @skipUnlessDBFeature('supports_stddev')\n     def test_stddev(self):\n         self.assertEqual("
        }
    ],
    "stats": {
        "total": 15,
        "additions": 14,
        "deletions": 1
    }
}