{
    "author": "andrewgodwin",
    "message": "Fixed #16222: Test failures due to more precise cookie timings. Refs [16356].\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16376 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e096d56406b93220f03c495282fd6d0d297f3851",
    "files": [
        {
            "sha": "6ad9bceae6bebc758441430272983bee0e0e8227",
            "filename": "django/contrib/formtools/wizard/tests/cookiestoragetests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/e096d56406b93220f03c495282fd6d0d297f3851/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fcookiestoragetests.py",
            "raw_url": "https://github.com/django/django/raw/e096d56406b93220f03c495282fd6d0d297f3851/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fcookiestoragetests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fcookiestoragetests.py?ref=e096d56406b93220f03c495282fd6d0d297f3851",
            "patch": "@@ -25,6 +25,7 @@ def test_manipulated_cookie(self):\n         self.assertRaises(SuspiciousOperation, storage.load_data)\n \n     def test_reset_cookie(self):\n+        from django.core.signing import SignatureExpired\n         request = get_request()\n         storage = self.get_storage()('wizard1', request, None)\n \n@@ -35,7 +36,15 @@ def test_reset_cookie(self):\n \n         cookie_signer = signing.get_cookie_signer(storage.prefix)\n         signed_cookie_data = cookie_signer.sign(storage.encoder.encode(storage.data))\n-        self.assertEqual(response.cookies[storage.prefix].value, signed_cookie_data)\n+\n+        # signing with different timestamps generates different signatures\n+        self.assertNotEqual(response.cookies[storage.prefix].value, signed_cookie_data)\n+        self.assertEqual(cookie_signer.unsign(response.cookies[storage.prefix].value),\n+                         cookie_signer.unsign(signed_cookie_data))\n+        self.assertRaises(SignatureExpired,\n+                          lambda: cookie_signer.unsign(value=response.cookies[storage.prefix].value, max_age=0))\n+        self.assertEqual(cookie_signer.unsign(value=response.cookies[storage.prefix].value, max_age=10),\n+                         cookie_signer.unsign(signed_cookie_data))\n \n         storage.init_data()\n         storage.update_response(response)"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 10,
        "deletions": 1
    }
}