{
    "author": "jphalip",
    "message": "Fixed #17090 -- Made the API specification for `ModelAdmin.get_list_display()` more consistent with that of `ModelAdmin.list_display` by separating out the admin action check boxes business. This is backwards-incompatible for those who have been using the still-unreleased `get_list_display()` method. Thanks to Ramiro Morales for the review.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17035 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "600c576ac56fc5c0567450c8cb5696f225de7c8d",
    "files": [
        {
            "sha": "ab62d96f2605cc36b5ff31ded7b7ff80695e0a35",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 14,
            "deletions": 17,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/600c576ac56fc5c0567450c8cb5696f225de7c8d/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/600c576ac56fc5c0567450c8cb5696f225de7c8d/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=600c576ac56fc5c0567450c8cb5696f225de7c8d",
            "patch": "@@ -342,13 +342,6 @@ def __init__(self, model, admin_site):\n         self.model = model\n         self.opts = model._meta\n         self.admin_site = admin_site\n-        if 'action_checkbox' not in self.list_display and self.actions is not None:\n-            self.list_display = ['action_checkbox'] +  list(self.list_display)\n-        if not self.list_display_links:\n-            for name in self.list_display:\n-                if name != 'action_checkbox':\n-                    self.list_display_links = [name]\n-                    break\n         super(ModelAdmin, self).__init__()\n \n     def get_inline_instances(self, request):\n@@ -1104,19 +1097,23 @@ def changelist_view(self, request, extra_context=None):\n         # Check actions to see if any are available on this changelist\n         actions = self.get_actions(request)\n \n-        # Remove action checkboxes if there aren't any actions available.\n-        list_display = list(self.get_list_display(request))\n-        if not actions:\n-            try:\n-                list_display.remove('action_checkbox')\n-            except ValueError:\n-                pass\n+        list_display = self.get_list_display(request)\n+\n+        list_display_links = self.list_display_links\n+        if not self.list_display_links and list_display:\n+            list_display_links = list(list_display)[:1]\n+\n+        if actions:\n+            # Add the action checkboxes if there are any actions available.\n+            list_display = ['action_checkbox'] +  list(list_display)\n \n         ChangeList = self.get_changelist(request)\n         try:\n-            cl = ChangeList(request, self.model, list_display, self.list_display_links,\n-                self.list_filter, self.date_hierarchy, self.search_fields,\n-                self.list_select_related, self.list_per_page, self.list_max_show_all, self.list_editable, self)\n+            cl = ChangeList(request, self.model, list_display,\n+                list_display_links, self.list_filter, self.date_hierarchy,\n+                self.search_fields, self.list_select_related,\n+                self.list_per_page, self.list_max_show_all, self.list_editable,\n+                self)\n         except IncorrectLookupParameters:\n             # Wacky lookup parameters were given, so redirect to the main\n             # changelist page, without parameters, and pass an 'invalid=1'"
        },
        {
            "sha": "a081c980dfd9606cb4719d417b9503d4614f0757",
            "filename": "tests/regressiontests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/600c576ac56fc5c0567450c8cb5696f225de7c8d/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/600c576ac56fc5c0567450c8cb5696f225de7c8d/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py?ref=600c576ac56fc5c0567450c8cb5696f225de7c8d",
            "patch": "@@ -48,7 +48,7 @@ def test_result_list_empty_changelist_value(self):\n         template = Template('{% load admin_list %}{% spaceless %}{% result_list cl %}{% endspaceless %}')\n         context = Context({'cl': cl})\n         table_output = template.render(context)\n-        row_html = '<tbody><tr class=\"row1\"><td class=\"action-checkbox\"><input type=\"checkbox\" class=\"action-select\" value=\"%d\" name=\"_selected_action\" /></td><th><a href=\"%d/\">name</a></th><td class=\"nowrap\">(None)</td></tr></tbody>' % (new_child.id, new_child.id)\n+        row_html = '<tbody><tr class=\"row1\"><th><a href=\"%d/\">name</a></th><td class=\"nowrap\">(None)</td></tr></tbody>' % new_child.id\n         self.assertFalse(table_output.find(row_html) == -1,\n             'Failed to find expected row element: %s' % table_output)\n \n@@ -68,7 +68,7 @@ def test_result_list_html(self):\n         template = Template('{% load admin_list %}{% spaceless %}{% result_list cl %}{% endspaceless %}')\n         context = Context({'cl': cl})\n         table_output = template.render(context)\n-        row_html = '<tbody><tr class=\"row1\"><td class=\"action-checkbox\"><input type=\"checkbox\" class=\"action-select\" value=\"%d\" name=\"_selected_action\" /></td><th><a href=\"%d/\">name</a></th><td class=\"nowrap\">Parent object</td></tr></tbody>' % (new_child.id, new_child.id)\n+        row_html = '<tbody><tr class=\"row1\"><th><a href=\"%d/\">name</a></th><td class=\"nowrap\">Parent object</td></tr></tbody>' % new_child.id\n         self.assertFalse(table_output.find(row_html) == -1,\n             'Failed to find expected row element: %s' % table_output)\n "
        },
        {
            "sha": "1b2d291691e7691d52e143f467a6b340f8f21bcf",
            "filename": "tests/regressiontests/admin_registration/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/600c576ac56fc5c0567450c8cb5696f225de7c8d/tests%2Fregressiontests%2Fadmin_registration%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/600c576ac56fc5c0567450c8cb5696f225de7c8d/tests%2Fregressiontests%2Fadmin_registration%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_registration%2Ftests.py?ref=600c576ac56fc5c0567450c8cb5696f225de7c8d",
            "patch": "@@ -42,7 +42,7 @@ def test_star_star_overrides(self):\n                            search_fields=[\"name\"], list_display=['__str__'])\n         self.assertEqual(self.site._registry[Person].search_fields, ['name'])\n         self.assertEqual(self.site._registry[Person].list_display,\n-                         ['action_checkbox', '__str__'])\n+                         ['__str__'])\n         self.assertTrue(self.site._registry[Person].save_on_top)\n \n     def test_iterable_registration(self):"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 17,
        "deletions": 20
    }
}