{
    "author": "claudep",
    "message": "Fixed #5611 -- Restricted accepted content types in parsing POST data\n\nThanks paulegan for the report and Preston Holmes for the review.",
    "sha": "dfd4a7175119ddb422d8426dcc15902265d5a428",
    "files": [
        {
            "sha": "b67c182c37fa93058a80b70174903b640b2056dc",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/dfd4a7175119ddb422d8426dcc15902265d5a428/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/dfd4a7175119ddb422d8426dcc15902265d5a428/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=dfd4a7175119ddb422d8426dcc15902265d5a428",
            "patch": "@@ -315,15 +315,15 @@ def _mark_post_parse_error(self):\n         self._post_parse_error = True\n \n     def _load_post_and_files(self):\n-        # Populates self._post and self._files\n+        \"\"\"Populate self._post and self._files if the content-type is a form type\"\"\"\n         if self.method != 'POST':\n             self._post, self._files = QueryDict('', encoding=self._encoding), MultiValueDict()\n             return\n         if self._read_started and not hasattr(self, '_body'):\n             self._mark_post_parse_error()\n             return\n \n-        if self.META.get('CONTENT_TYPE', '').startswith('multipart'):\n+        if self.META.get('CONTENT_TYPE', '').startswith('multipart/form-data'):\n             if hasattr(self, '_body'):\n                 # Use already read data\n                 data = BytesIO(self._body)\n@@ -341,8 +341,10 @@ def _load_post_and_files(self):\n                 # empty POST\n                 self._mark_post_parse_error()\n                 raise\n-        else:\n+        elif self.META.get('CONTENT_TYPE', '').startswith('application/x-www-form-urlencoded'):\n             self._post, self._files = QueryDict(self.body, encoding=self._encoding), MultiValueDict()\n+        else:\n+            self._post, self._files = QueryDict('', encoding=self._encoding), MultiValueDict()\n \n     ## File-like and iterator interface.\n     ##"
        },
        {
            "sha": "d7266f0affaa2f7b43d34681623fcde5e2b0aad8",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/dfd4a7175119ddb422d8426dcc15902265d5a428/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/dfd4a7175119ddb422d8426dcc15902265d5a428/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=dfd4a7175119ddb422d8426dcc15902265d5a428",
            "patch": "@@ -92,8 +92,14 @@ All attributes should be considered read-only, unless stated otherwise below.\n \n .. attribute:: HttpRequest.POST\n \n-    A dictionary-like object containing all given HTTP POST parameters. See the\n-    :class:`QueryDict` documentation below.\n+    A dictionary-like object containing all given HTTP POST parameters,\n+    providing that the request contains form data. See the\n+    :class:`QueryDict` documentation below. If you need to access raw or\n+    non-form data posted in the request, access this through the\n+    :attr:`HttpRequest.body` attribute instead.\n+\n+    .. versionchanged:: 1.5\n+        Before Django 1.5, HttpRequest.POST contained non-form data.\n \n     It's possible that a request can come in via POST with an empty ``POST``\n     dictionary -- if, say, a form is requested via the POST HTTP method but"
        },
        {
            "sha": "d30bd5ff7eb237d2d88641e9bf647e5640cf8054",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/dfd4a7175119ddb422d8426dcc15902265d5a428/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/dfd4a7175119ddb422d8426dcc15902265d5a428/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=dfd4a7175119ddb422d8426dcc15902265d5a428",
            "patch": "@@ -245,6 +245,18 @@ For consistency with the design of the other generic views,\n dictionary into the context, instead passing the variables from the URLconf\n directly into the context.\n \n+Non-form data in HTTP requests\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:attr:`request.POST <django.http.HttpRequest.POST>` will no longer include data\n+posted via HTTP requests with non form-specific content-types in the header.\n+In prior versions, data posted with content-types other than\n+``multipart/form-data`` or ``application/x-www-form-urlencoded`` would still\n+end up represented in the :attr:`request.POST <django.http.HttpRequest.POST>`\n+attribute. Developers wishing to access the raw POST data for these cases,\n+should use the :attr:`request.body <django.http.HttpRequest.body>` attribute\n+instead.\n+\n OPTIONS, PUT and DELETE requests in the test client\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "378b4cf6d98db9f100bfdaaf3dac514483b91e84",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/dfd4a7175119ddb422d8426dcc15902265d5a428/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/dfd4a7175119ddb422d8426dcc15902265d5a428/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=dfd4a7175119ddb422d8426dcc15902265d5a428",
            "patch": "@@ -330,6 +330,7 @@ def test_limited_stream(self):\n     def test_stream(self):\n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': BytesIO(payload)})\n         self.assertEqual(request.read(), b'name=value')\n@@ -341,6 +342,7 @@ def test_read_after_value(self):\n         \"\"\"\n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': BytesIO(payload)})\n         self.assertEqual(request.POST, {'name': ['value']})\n@@ -354,6 +356,7 @@ def test_value_after_read(self):\n         \"\"\"\n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': BytesIO(payload)})\n         self.assertEqual(request.read(2), b'na')\n@@ -402,9 +405,28 @@ def test_POST_multipart_with_content_length_zero(self):\n                                'wsgi.input': BytesIO(payload)})\n         self.assertEqual(request.POST, {})\n \n+    def test_POST_binary_only(self):\n+        payload = b'\\r\\n\\x01\\x00\\x00\\x00ab\\x00\\x00\\xcd\\xcc,@'\n+        environ = {'REQUEST_METHOD': 'POST',\n+                   'CONTENT_TYPE': 'application/octet-stream',\n+                   'CONTENT_LENGTH': len(payload),\n+                   'wsgi.input': BytesIO(payload)}\n+        request = WSGIRequest(environ)\n+        self.assertEqual(request.POST, {})\n+        self.assertEqual(request.FILES, {})\n+        self.assertEqual(request.body, payload)\n+\n+        # Same test without specifying content-type\n+        environ.update({'CONTENT_TYPE': '', 'wsgi.input': BytesIO(payload)})\n+        request = WSGIRequest(environ)\n+        self.assertEqual(request.POST, {})\n+        self.assertEqual(request.FILES, {})\n+        self.assertEqual(request.body, payload)\n+\n     def test_read_by_lines(self):\n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': BytesIO(payload)})\n         self.assertEqual(list(request), [b'name=value'])\n@@ -415,6 +437,7 @@ def test_POST_after_body_read(self):\n         \"\"\"\n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': BytesIO(payload)})\n         raw_data = request.body\n@@ -427,6 +450,7 @@ def test_POST_after_body_read_and_stream_read(self):\n         \"\"\"\n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': BytesIO(payload)})\n         raw_data = request.body\n@@ -479,6 +503,7 @@ def read(self, len=0):\n \n         payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': ExplodingBytesIO(payload)})\n "
        }
    ],
    "stats": {
        "total": 55,
        "additions": 50,
        "deletions": 5
    }
}