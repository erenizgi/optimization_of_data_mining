{
    "author": "jphalip",
    "message": "Fixed #15938 -- Prevented the `max_length` number in the admin `prepopulated_fields` javascript to be localized when `USE_THOUSAND_SEPARATOR` is turned on. Thanks to Lev Maximov, Mathieu Agopian and feel.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17033 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2e2689c7c0436f21d25e40f90f9d386311c776f9",
    "files": [
        {
            "sha": "7300bea3d9a1353e21f4d5502b6354a33fc4e4be",
            "filename": "django/contrib/admin/templates/admin/prepopulated_fields_js.html",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/2e2689c7c0436f21d25e40f90f9d386311c776f9/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fprepopulated_fields_js.html",
            "raw_url": "https://github.com/django/django/raw/2e2689c7c0436f21d25e40f90f9d386311c776f9/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fprepopulated_fields_js.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fprepopulated_fields_js.html?ref=2e2689c7c0436f21d25e40f90f9d386311c776f9",
            "patch": "@@ -1,3 +1,4 @@\n+{% load l10n %}\n <script type=\"text/javascript\">\n (function($) {\n     var field = null;\n@@ -7,7 +8,7 @@\n         id: '#{{ field.field.auto_id }}',\n         dependency_ids: [],\n         dependency_list: [],\n-        maxLength: {{ field.field.field.max_length|default_if_none:\"50\" }}\n+        maxLength: {{ field.field.field.max_length|default_if_none:\"50\"|unlocalize }}\n     };\n \n     {% for dependency in field.dependencies %}"
        },
        {
            "sha": "8c45ba3626179f6b98cd0d9342e70034e7ff586a",
            "filename": "tests/regressiontests/admin_views/admin.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/2e2689c7c0436f21d25e40f90f9d386311c776f9/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/2e2689c7c0436f21d25e40f90f9d386311c776f9/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py?ref=2e2689c7c0436f21d25e40f90f9d386311c776f9",
            "patch": "@@ -22,7 +22,7 @@\n     Gadget, Villain, SuperVillain, Plot, PlotDetails, CyclicOne, CyclicTwo,\n     WorkHour, Reservation, FoodDelivery, RowLevelChangePermissionModel, Paper,\n     CoverLetter, Story, OtherStory, Book, Promo, ChapterXtra1, Pizza, Topping,\n-    Album, Question, Answer, ComplexSortedPerson)\n+    Album, Question, Answer, ComplexSortedPerson, PrePopulatedPostLargeSlug)\n \n \n def callable_year(dt_value):\n@@ -469,6 +469,11 @@ class WorkHourAdmin(admin.ModelAdmin):\n     list_filter = ('employee',)\n \n \n+class PrePopulatedPostLargeSlugAdmin(admin.ModelAdmin): \n+    prepopulated_fields = { \n+        'slug' : ('title',) \n+    } \n+ \n site = admin.AdminSite(name=\"admin\")\n site.register(Article, ArticleAdmin)\n site.register(CustomArticle, CustomArticleAdmin)\n@@ -538,3 +543,4 @@ class WorkHourAdmin(admin.ModelAdmin):\n from django.contrib.auth.admin import UserAdmin, GroupAdmin\n site.register(User, UserAdmin)\n site.register(Group, GroupAdmin)\n+site.register(PrePopulatedPostLargeSlug, PrePopulatedPostLargeSlugAdmin) "
        },
        {
            "sha": "fce02189f5bb9fe0b3046d5a3772e8485b284b35",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/2e2689c7c0436f21d25e40f90f9d386311c776f9/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/2e2689c7c0436f21d25e40f90f9d386311c776f9/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=2e2689c7c0436f21d25e40f90f9d386311c776f9",
            "patch": "@@ -538,3 +538,13 @@ class ComplexSortedPerson(models.Model):\n     age = models.PositiveIntegerField()\n     is_employee = models.NullBooleanField()\n \n+class PrePopulatedPostLargeSlug(models.Model): \n+    \"\"\" \n+    Regression test for #15938: a large max_length for the slugfield must not \n+    be localized in prepopulated_fields_js.html or it might end up breaking \n+    the javascript (ie, using THOUSAND_SEPARATOR ends up with maxLength=1,000) \n+    \"\"\" \n+    title = models.CharField(max_length=100) \n+    published = models.BooleanField() \n+    slug = models.SlugField(max_length=1000)\n+    \n\\ No newline at end of file"
        },
        {
            "sha": "f4ec63f8ae9d88938d48347f9c6c9a3fad2e7136",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/2e2689c7c0436f21d25e40f90f9d386311c776f9/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2e2689c7c0436f21d25e40f90f9d386311c776f9/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=2e2689c7c0436f21d25e40f90f9d386311c776f9",
            "patch": "@@ -28,6 +28,7 @@\n from django.utils.encoding import iri_to_uri\n from django.utils.html import escape\n from django.utils.http import urlencode\n+from django.test.utils import override_settings\n \n # local test models\n from .models import (Article, BarAccount, CustomArticle, EmptyModel, FooAccount,\n@@ -2756,6 +2757,15 @@ def test_prepopulated_off(self):\n         self.assertNotContains(response, \"id: '#id_slug'\")\n         self.assertNotContains(response, \"field['dependency_ids'].push('#id_title');\")\n         self.assertNotContains(response, \"id: '#id_prepopulatedsubpost_set-0-subslug',\")\n+    \n+    @override_settings(USE_THOUSAND_SEPARATOR = True, USE_L10N = True)\n+    def test_prepopulated_maxlength_localized(self):\n+        \"\"\"\n+        Regression test for #15938: if USE_THOUSAND_SEPARATOR is set, make sure\n+        that maxLength (in the javascript) is rendered without separators.\n+        \"\"\"\n+        response = self.client.get('/test_admin/admin/admin_views/prepopulatedpostlargeslug/add/')\n+        self.assertContains(response, \"maxLength: 1000\") # instead of 1,000\n \n class ReadonlyTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\""
        }
    ],
    "stats": {
        "total": 31,
        "additions": 29,
        "deletions": 2
    }
}