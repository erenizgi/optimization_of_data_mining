{
    "author": "aaugustin",
    "message": "Implemented Oracle version as a cached property.",
    "sha": "9a3988ca5ad5808fad0d5bd8e25fe560d0d48ec0",
    "files": [
        {
            "sha": "3fdf67402a989952e4e1bdb803ee844603eeb892",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/9a3988ca5ad5808fad0d5bd8e25fe560d0d48ec0/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/9a3988ca5ad5808fad0d5bd8e25fe560d0d48ec0/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=9a3988ca5ad5808fad0d5bd8e25fe560d0d48ec0",
            "patch": "@@ -52,6 +52,7 @@ def _setup_environment(environ):\n from django.db.backends.oracle.creation import DatabaseCreation\n from django.db.backends.oracle.introspection import DatabaseIntrospection\n from django.utils.encoding import force_bytes, force_text\n+from django.utils.functional import cached_property\n from django.utils import six\n from django.utils import timezone\n \n@@ -502,7 +503,6 @@ class DatabaseWrapper(BaseDatabaseWrapper):\n     def __init__(self, *args, **kwargs):\n         super(DatabaseWrapper, self).__init__(*args, **kwargs)\n \n-        self.oracle_version = None\n         self.features = DatabaseFeatures(self)\n         use_returning_into = self.settings_dict[\"OPTIONS\"].get('use_returning_into', True)\n         self.features.can_return_id_from_insert = use_returning_into\n@@ -579,18 +579,15 @@ def init_connection_state(self):\n                 self.operators = self._standard_operators\n             cursor.close()\n \n-        try:\n-            self.oracle_version = int(self.connection.version.split('.')[0])\n-            # There's no way for the DatabaseOperations class to know the\n-            # currently active Oracle version, so we do some setups here.\n-            # TODO: Multi-db support will need a better solution (a way to\n-            # communicate the current version).\n-            if self.oracle_version <= 9:\n-                self.ops.regex_lookup = self.ops.regex_lookup_9\n-            else:\n-                self.ops.regex_lookup = self.ops.regex_lookup_10\n-        except ValueError:\n-            pass\n+        # There's no way for the DatabaseOperations class to know the\n+        # currently active Oracle version, so we do some setups here.\n+        # TODO: Multi-db support will need a better solution (a way to\n+        # communicate the current version).\n+        if self.oracle_version is not None and self.oracle_version <= 9:\n+            self.ops.regex_lookup = self.ops.regex_lookup_9\n+        else:\n+            self.ops.regex_lookup = self.ops.regex_lookup_10\n+\n         try:\n             self.connection.stmtcachesize = 20\n         except:\n@@ -624,6 +621,13 @@ def _commit(self):\n                     six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n                 six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n+    @cached_property\n+    def oracle_version(self):\n+        try:\n+            return int(self.connection.version.split('.')[0])\n+        except ValueError:\n+            return None\n+\n \n class OracleParam(object):\n     \"\"\""
        }
    ],
    "stats": {
        "total": 30,
        "additions": 17,
        "deletions": 13
    }
}