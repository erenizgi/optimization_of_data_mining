{
    "author": "jezdez",
    "message": "Fixed #7758 and #17189 -- Allowed to override the `form_url` context var in the admin change view and the user admin's password change view. Thanks, michal and krzysztof.szczesny.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17466 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b46d90c63ad866d5d7d6b09d8986339e0842550d",
    "files": [
        {
            "sha": "21eced0fb085f5b586f63bcea9bf481bb63063e7",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b46d90c63ad866d5d7d6b09d8986339e0842550d/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b46d90c63ad866d5d7d6b09d8986339e0842550d/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=b46d90c63ad866d5d7d6b09d8986339e0842550d",
            "patch": "@@ -1011,7 +1011,7 @@ def add_view(self, request, form_url='', extra_context=None):\n \n     @csrf_protect_m\n     @transaction.commit_on_success\n-    def change_view(self, request, object_id, extra_context=None):\n+    def change_view(self, request, object_id, form_url='', extra_context=None):\n         \"The 'change' admin view for this model.\"\n         model = self.model\n         opts = model._meta\n@@ -1099,7 +1099,7 @@ def change_view(self, request, object_id, extra_context=None):\n             'app_label': opts.app_label,\n         }\n         context.update(extra_context or {})\n-        return self.render_change_form(request, context, change=True, obj=obj)\n+        return self.render_change_form(request, context, change=True, obj=obj, form_url=form_url)\n \n     @csrf_protect_m\n     def changelist_view(self, request, extra_context=None):"
        },
        {
            "sha": "dbcf52d778d1ddab445c5fe9c20b0a984af3645a",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b46d90c63ad866d5d7d6b09d8986339e0842550d/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/b46d90c63ad866d5d7d6b09d8986339e0842550d/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=b46d90c63ad866d5d7d6b09d8986339e0842550d",
            "patch": "@@ -11,6 +11,7 @@\n from django.template.response import TemplateResponse\n from django.utils.html import escape\n from django.utils.decorators import method_decorator\n+from django.utils.safestring import mark_safe\n from django.utils.translation import ugettext, ugettext_lazy as _\n from django.views.decorators.csrf import csrf_protect\n from django.views.decorators.debug import sensitive_post_parameters\n@@ -113,7 +114,7 @@ def add_view(self, request, form_url='', extra_context=None):\n                                                extra_context)\n \n     @sensitive_post_parameters()\n-    def user_change_password(self, request, id):\n+    def user_change_password(self, request, id, form_url=''):\n         if not self.has_change_permission(request):\n             raise PermissionDenied\n         user = get_object_or_404(self.model, pk=id)\n@@ -133,6 +134,7 @@ def user_change_password(self, request, id):\n         context = {\n             'title': _('Change password: %s') % escape(user.username),\n             'adminForm': adminForm,\n+            'form_url': mark_safe(form_url),\n             'form': form,\n             'is_popup': '_popup' in request.REQUEST,\n             'add': True,"
        },
        {
            "sha": "574c6f6138a9becef138217edf5db21f6c6c786d",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/b46d90c63ad866d5d7d6b09d8986339e0842550d/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b46d90c63ad866d5d7d6b09d8986339e0842550d/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=b46d90c63ad866d5d7d6b09d8986339e0842550d",
            "patch": "@@ -574,6 +574,25 @@ def test_allowed_filtering_15103(self):\n             self.fail(\"Filters should be allowed if they are defined on a ForeignKey pointing to this model\")\n \n \n+class AdminViewFormUrlTest(TestCase):\n+    urls = \"regressiontests.admin_views.urls\"\n+    fixtures = [\"admin-views-users.xml\"]\n+    urlbit = \"admin3\"\n+\n+    def setUp(self):\n+        self.client.login(username='super', password='secret')\n+\n+    def tearDown(self):\n+        self.client.logout()\n+\n+    def testChangeFormUrlHasCorrectValue(self):\n+        \"\"\"\n+        Tests whether change_view has form_url in request.context\n+        \"\"\"\n+        response = self.client.get('/test_admin/%s/admin_views/section/1/' % self.urlbit)\n+        self.assertTrue('form_url' in response.context, msg='form_url not present in response.context')\n+        self.assertEqual(response.context['form_url'], 'pony')\n+\n class AdminJavaScriptTest(AdminViewBasicTest):\n     urls = \"regressiontests.admin_views.urls\"\n \n@@ -3054,6 +3073,12 @@ def test_user_permission_performance(self):\n             response = self.client.get('/test_admin/admin/auth/user/%s/' % u.pk)\n             self.assertEqual(response.status_code, 200)\n \n+    def test_form_url_present_in_context(self):\n+        u = User.objects.all()[0]\n+        response = self.client.get('/test_admin/admin3/auth/user/%s/password/' % u.pk)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['form_url'], 'pony')\n+\n \n class GroupAdminTest(TestCase):\n     \"\"\""
        },
        {
            "sha": "da6e2cbcf9ff336893b6d829ca9603a20ff915de",
            "filename": "tests/regressiontests/admin_views/urls.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b46d90c63ad866d5d7d6b09d8986339e0842550d/tests%2Fregressiontests%2Fadmin_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/b46d90c63ad866d5d7d6b09d8986339e0842550d/tests%2Fregressiontests%2Fadmin_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Furls.py?ref=b46d90c63ad866d5d7d6b09d8986339e0842550d",
            "patch": "@@ -10,4 +10,5 @@\n     (r'^test_admin/admin/secure-view/$', views.secure_view),\n     (r'^test_admin/admin/', include(admin.site.urls)),\n     (r'^test_admin/admin2/', include(customadmin.site.urls)),\n+    (r'^test_admin/admin3/', include(admin.site.urls), dict(form_url='pony')),\n )"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 31,
        "deletions": 3
    }
}