{
    "author": "jezdez",
    "message": "Fixed #13862 -- Added an ordering option to InlineModelAdmin and cleaned up documentation for it a bit. Thanks, Simon Meers, rasca and cogat.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14882 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b3520da9ac113ed435cb6aa135b0559780d9c530",
    "files": [
        {
            "sha": "7a42e9444cc38c6899b8b1156b2d8f1ed4b05891",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 13,
            "deletions": 16,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/b3520da9ac113ed435cb6aa135b0559780d9c530/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b3520da9ac113ed435cb6aa135b0559780d9c530/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=b3520da9ac113ed435cb6aa135b0559780d9c530",
            "patch": "@@ -67,6 +67,7 @@ class BaseModelAdmin(object):\n     prepopulated_fields = {}\n     formfield_overrides = {}\n     readonly_fields = ()\n+    ordering = None\n \n     def __init__(self):\n         overrides = FORMFIELD_FOR_DBFIELD_DEFAULTS.copy()\n@@ -189,6 +190,18 @@ def _declared_fieldsets(self):\n     def get_readonly_fields(self, request, obj=None):\n         return self.readonly_fields\n \n+    def queryset(self, request):\n+        \"\"\"\n+        Returns a QuerySet of all model instances that can be edited by the\n+        admin site. This is used by changelist_view.\n+        \"\"\"\n+        qs = self.model._default_manager.get_query_set()\n+        # TODO: this should be handled by some parameter to the ChangeList.\n+        ordering = self.ordering or () # otherwise we might try to *None, which is bad ;)\n+        if ordering:\n+            qs = qs.order_by(*ordering)\n+        return qs\n+\n class ModelAdmin(BaseModelAdmin):\n     \"Encapsulates all admin options and functionality for a given model.\"\n \n@@ -202,7 +215,6 @@ class ModelAdmin(BaseModelAdmin):\n     date_hierarchy = None\n     save_as = False\n     save_on_top = False\n-    ordering = None\n     inlines = []\n \n     # Custom templates (designed to be over-ridden in subclasses)\n@@ -325,18 +337,6 @@ def get_model_perms(self, request):\n             'delete': self.has_delete_permission(request),\n         }\n \n-    def queryset(self, request):\n-        \"\"\"\n-        Returns a QuerySet of all model instances that can be edited by the\n-        admin site. This is used by changelist_view.\n-        \"\"\"\n-        qs = self.model._default_manager.get_query_set()\n-        # TODO: this should be handled by some parameter to the ChangeList.\n-        ordering = self.ordering or () # otherwise we might try to *None, which is bad ;)\n-        if ordering:\n-            qs = qs.order_by(*ordering)\n-        return qs\n-\n     def get_fieldsets(self, request, obj=None):\n         \"Hook for specifying fieldsets for the add form.\"\n         if self.declared_fieldsets:\n@@ -1257,9 +1257,6 @@ def get_fieldsets(self, request, obj=None):\n         fields = form.base_fields.keys() + list(self.get_readonly_fields(request, obj))\n         return [(None, {'fields': fields})]\n \n-    def queryset(self, request):\n-        return self.model._default_manager.all()\n-\n class StackedInline(InlineModelAdmin):\n     template = 'admin/edit_inline/stacked.html'\n "
        },
        {
            "sha": "9928118fd985cb7e592cab9a4eb52036c80a85ec",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 33,
            "deletions": 6,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/b3520da9ac113ed435cb6aa135b0559780d9c530/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b3520da9ac113ed435cb6aa135b0559780d9c530/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=b3520da9ac113ed435cb6aa135b0559780d9c530",
            "patch": "@@ -180,7 +180,7 @@ subclass::\n             .. versionadded:: 1.2\n \n             ``fields`` can contain values defined in\n-            :attr:`ModelAdmin.readonly_fields` to be displayed as read-only.\n+            :attr:`~ModelAdmin.readonly_fields` to be displayed as read-only.\n \n         * ``classes``\n             A list containing extra CSS classes to apply to the fieldset.\n@@ -504,8 +504,8 @@ subclass::\n \n .. attribute:: ModelAdmin.ordering\n \n-    Set ``ordering`` to specify how objects on the admin change list page\n-    should be ordered. This should be a list or tuple in the same format as a\n+    Set ``ordering`` to specify how lists of objects should be ordered in the\n+    Django admin views. This should be a list or tuple in the same format as a\n     model's ``ordering`` parameter.\n \n     If this isn't provided, the Django admin will use the model's default\n@@ -1089,8 +1089,36 @@ information.\n ``InlineModelAdmin`` options\n -----------------------------\n \n-The ``InlineModelAdmin`` class is a subclass of ``ModelAdmin`` so it inherits\n-all the same functionality as well as some of its own:\n+``InlineModelAdmin`` shares many of the same features as ``ModelAdmin``, and\n+adds some of its own (the shared features are actually defined in the\n+``BaseModelAdmin`` superclass). The shared features are:\n+\n+- :attr:`~InlineModelAdmin.form`\n+- :attr:`~ModelAdmin.fieldsets`\n+- :attr:`~ModelAdmin.fields`\n+- :attr:`~ModelAdmin.exclude`\n+- :attr:`~ModelAdmin.filter_horizontal`\n+- :attr:`~ModelAdmin.filter_vertical`\n+- :attr:`~ModelAdmin.prepopulated_fields`\n+- :attr:`~ModelAdmin.radio_fields`\n+- :attr:`~InlineModelAdmin.raw_id_fields`\n+\n+.. versionadded:: 1.1\n+\n+- :meth:`~ModelAdmin.formfield_for_foreignkey`\n+- :meth:`~ModelAdmin.formfield_for_manytomany`\n+\n+.. versionadded:: 1.2\n+\n+- :attr:`~ModelAdmin.readonly_fields`\n+- :attr:`~ModelAdmin.formfield_overrides`\n+\n+.. versionadded:: 1.3\n+\n+- :attr:`~ModelAdmin.ordering`\n+- :meth:`~ModelAdmin.queryset`\n+\n+The ``InlineModelAdmin`` class adds:\n \n .. attribute:: InlineModelAdmin.model\n \n@@ -1118,7 +1146,6 @@ all the same functionality as well as some of its own:\n \n .. attribute:: InlineModelAdmin.extra\n \n-\n     This controls the number of extra forms the formset will display in\n     addition to the initial forms. See the\n     :doc:`formsets documentation </topics/forms/formsets>` for more"
        },
        {
            "sha": "fb766777a9da4204602ab3a069e4ce2e9fb0c0e9",
            "filename": "tests/regressiontests/admin_ordering/models.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b3520da9ac113ed435cb6aa135b0559780d9c530/tests%2Fregressiontests%2Fadmin_ordering%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b3520da9ac113ed435cb6aa135b0559780d9c530/tests%2Fregressiontests%2Fadmin_ordering%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_ordering%2Fmodels.py?ref=b3520da9ac113ed435cb6aa135b0559780d9c530",
            "patch": "@@ -1,5 +1,6 @@\n # coding: utf-8\n from django.db import models\n+from django.contrib import admin\n \n class Band(models.Model):\n     name = models.CharField(max_length=100)\n@@ -8,3 +9,18 @@ class Band(models.Model):\n \n     class Meta:\n         ordering = ('name',)\n+\n+class Song(models.Model):\n+    band = models.ForeignKey(Band)\n+    name = models.CharField(max_length=100)\n+    duration = models.IntegerField()\n+\n+    class Meta:\n+        ordering = ('name',)\n+\n+class SongInlineDefaultOrdering(admin.StackedInline):\n+    model = Song\n+\n+class SongInlineNewOrdering(admin.StackedInline):\n+    model = Song\n+    ordering = ('duration', )"
        },
        {
            "sha": "8f5a6bd05ab8f22df3c118a987291f1004fde4f5",
            "filename": "tests/regressiontests/admin_ordering/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/b3520da9ac113ed435cb6aa135b0559780d9c530/tests%2Fregressiontests%2Fadmin_ordering%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b3520da9ac113ed435cb6aa135b0559780d9c530/tests%2Fregressiontests%2Fadmin_ordering%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_ordering%2Ftests.py?ref=b3520da9ac113ed435cb6aa135b0559780d9c530",
            "patch": "@@ -1,7 +1,7 @@\n from django.test import TestCase\n from django.contrib.admin.options import ModelAdmin\n \n-from models import Band\n+from models import Band, Song, SongInlineDefaultOrdering, SongInlineNewOrdering\n \n class TestAdminOrdering(TestCase):\n     \"\"\"\n@@ -37,3 +37,37 @@ class BandAdmin(ModelAdmin):\n         ma = BandAdmin(Band, None)\n         names = [b.name for b in ma.queryset(None)]\n         self.assertEqual([u'Radiohead', u'Van Halen', u'Aerosmith'], names)\n+\n+class TestInlineModelAdminOrdering(TestCase):\n+    \"\"\"\n+    Let's make sure that InlineModelAdmin.queryset uses the ordering we define\n+    in InlineModelAdmin.\n+    \"\"\"\n+\n+    def setUp(self):\n+        b = Band(name='Aerosmith', bio='', rank=3)\n+        b.save()\n+        self.b = b\n+        s1 = Song(band=b, name='Pink', duration=235)\n+        s1.save()\n+        s2 = Song(band=b, name='Dude (Looks Like a Lady)', duration=264)\n+        s2.save()\n+        s3 = Song(band=b, name='Jaded', duration=214)\n+        s3.save()\n+\n+    def test_default_ordering(self):\n+        \"\"\"\n+        The default ordering should be by name, as specified in the inner Meta\n+        class.\n+        \"\"\"\n+        inline = SongInlineDefaultOrdering(self.b, None)\n+        names = [s.name for s in inline.queryset(None)]\n+        self.assertEqual([u'Dude (Looks Like a Lady)', u'Jaded', u'Pink'], names)\n+\n+    def test_specified_ordering(self):\n+        \"\"\"\n+        Let's check with ordering set to something different than the default.\n+        \"\"\"\n+        inline = SongInlineNewOrdering(self.b, None)\n+        names = [s.name for s in inline.queryset(None)]\n+        self.assertEqual([u'Jaded', u'Pink', u'Dude (Looks Like a Lady)'], names)\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 120,
        "additions": 97,
        "deletions": 23
    }
}