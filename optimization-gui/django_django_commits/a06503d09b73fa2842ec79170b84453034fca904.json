{
    "author": "claudep",
    "message": "[py3] Fixed content encoding in test client\n\nThanks Andrews Medina for the initial patch.",
    "sha": "a06503d09b73fa2842ec79170b84453034fca904",
    "files": [
        {
            "sha": "5fa957885c53d6b1ff88935518645c702525c1eb",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a06503d09b73fa2842ec79170b84453034fca904/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/a06503d09b73fa2842ec79170b84453034fca904/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=a06503d09b73fa2842ec79170b84453034fca904",
            "patch": "@@ -373,6 +373,7 @@ answer newbie questions, and generally made Django that much better:\n     michael.mcewan@gmail.com\n     Paul McLanahan <paul@mclanahan.net>\n     Tobias McNulty <http://www.caktusgroup.com/blog>\n+    Andrews Medina <andrewsmedina@gmail.com>\n     Zain Memon\n     Christian Metts\n     michal@plovarna.cz"
        },
        {
            "sha": "2b61c51ce173acbe1c41fc24040c268eacb713b6",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 22,
            "deletions": 20,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/a06503d09b73fa2842ec79170b84453034fca904/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/a06503d09b73fa2842ec79170b84453034fca904/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=a06503d09b73fa2842ec79170b84453034fca904",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n import sys\n import os\n import re\n@@ -108,7 +110,7 @@ def encode_multipart(boundary, data):\n     as an application/octet-stream; otherwise, str(value) will be sent.\n     \"\"\"\n     lines = []\n-    to_str = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n+    to_bytes = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n \n     # Not by any means perfect, but good enough for our purposes.\n     is_file = lambda thing: hasattr(thing, \"read\") and callable(thing.read)\n@@ -124,37 +126,37 @@ def encode_multipart(boundary, data):\n                 if is_file(item):\n                     lines.extend(encode_file(boundary, key, item))\n                 else:\n-                    lines.extend([\n-                        '--' + boundary,\n-                        'Content-Disposition: form-data; name=\"%s\"' % to_str(key),\n+                    lines.extend([to_bytes(val) for val in [\n+                        '--%s' % boundary,\n+                        'Content-Disposition: form-data; name=\"%s\"' % key,\n                         '',\n-                        to_str(item)\n-                    ])\n+                        item\n+                    ]])\n         else:\n-            lines.extend([\n-                '--' + boundary,\n-                'Content-Disposition: form-data; name=\"%s\"' % to_str(key),\n+            lines.extend([to_bytes(val) for val in [\n+                '--%s' % boundary,\n+                'Content-Disposition: form-data; name=\"%s\"' % key,\n                 '',\n-                to_str(value)\n-            ])\n+                value\n+            ]])\n \n     lines.extend([\n-        '--' + boundary + '--',\n-        '',\n+        to_bytes('--%s--' % boundary),\n+        b'',\n     ])\n-    return '\\r\\n'.join(lines)\n+    return b'\\r\\n'.join(lines)\n \n def encode_file(boundary, key, file):\n-    to_str = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n+    to_bytes = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n     content_type = mimetypes.guess_type(file.name)[0]\n     if content_type is None:\n         content_type = 'application/octet-stream'\n     return [\n-        '--' + to_str(boundary),\n-        'Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"' \\\n-            % (to_str(key), to_str(os.path.basename(file.name))),\n-        'Content-Type: %s' % content_type,\n-        '',\n+        to_bytes('--%s' % boundary),\n+        to_bytes('Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"' \\\n+            % (key, os.path.basename(file.name))),\n+        to_bytes('Content-Type: %s' % content_type),\n+        b'',\n         file.read()\n     ]\n "
        }
    ],
    "stats": {
        "total": 43,
        "additions": 23,
        "deletions": 20
    }
}