{
    "author": "claudep",
    "message": "Prevented TestNoInitialDataLoading to pollute other tests (Refs #15926)\n\nTests were still failing with MySQL. It seems a rollback is solving\nthe issue.",
    "sha": "2c57809a560cb67c79b9e8a77cc713e8a2424c8e",
    "files": [
        {
            "sha": "a415fdf6a7af48c7933a2fc00f3196e38aeb7206",
            "filename": "tests/modeltests/fixtures_model_package/tests.py",
            "status": "modified",
            "additions": 22,
            "deletions": 16,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/2c57809a560cb67c79b9e8a77cc713e8a2424c8e/tests%2Fmodeltests%2Ffixtures_model_package%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2c57809a560cb67c79b9e8a77cc713e8a2424c8e/tests%2Fmodeltests%2Ffixtures_model_package%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures_model_package%2Ftests.py?ref=2c57809a560cb67c79b9e8a77cc713e8a2424c8e",
            "patch": "@@ -1,5 +1,6 @@\n from django.core import management\n-from django.test import TestCase\n+from django.db import transaction\n+from django.test import TestCase, TransactionTestCase\n \n from .models import Article, Book\n \n@@ -20,16 +21,18 @@ def testClassFixtures(self):\n         )\n \n \n-class TestNoInitialDataLoading(TestCase):\n+class TestNoInitialDataLoading(TransactionTestCase):\n     def test_syncdb(self):\n-        Book.objects.all().delete()\n+        with transaction.commit_manually():\n+            Book.objects.all().delete()\n \n-        management.call_command(\n-            'syncdb',\n-            verbosity=0,\n-            load_initial_data=False\n-        )\n-        self.assertQuerysetEqual(Book.objects.all(), [])\n+            management.call_command(\n+                'syncdb',\n+                verbosity=0,\n+                load_initial_data=False\n+            )\n+            self.assertQuerysetEqual(Book.objects.all(), [])\n+            transaction.rollback()\n \n     def test_flush(self):\n         # Test presence of fixture (flush called by TransactionTestCase)\n@@ -40,13 +43,16 @@ def test_flush(self):\n             lambda a: a.name\n         )\n \n-        management.call_command(\n-            'flush',\n-            verbosity=0,\n-            interactive=False,\n-            load_initial_data=False\n-        )\n-        self.assertQuerysetEqual(Book.objects.all(), [])\n+        with transaction.commit_manually():\n+            management.call_command(\n+                'flush',\n+                verbosity=0,\n+                interactive=False,\n+                commit=False,\n+                load_initial_data=False\n+            )\n+            self.assertQuerysetEqual(Book.objects.all(), [])\n+            transaction.rollback()\n \n \n class FixtureTestCase(TestCase):"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 22,
        "deletions": 16
    }
}