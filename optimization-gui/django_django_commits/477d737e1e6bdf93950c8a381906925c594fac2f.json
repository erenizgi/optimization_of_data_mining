{
    "author": "aaugustin",
    "message": "Merge pull request #850 from bmispelon/ticket-19916\n\nFix 19916. Smarter tokenizing of contrib.comment's templatetags arguments",
    "sha": "477d737e1e6bdf93950c8a381906925c594fac2f",
    "files": [
        {
            "sha": "b5266d9bb3940ab135d08e8bbfaffd3280f1ce77",
            "filename": "django/contrib/comments/templatetags/comments.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/477d737e1e6bdf93950c8a381906925c594fac2f/django%2Fcontrib%2Fcomments%2Ftemplatetags%2Fcomments.py",
            "raw_url": "https://github.com/django/django/raw/477d737e1e6bdf93950c8a381906925c594fac2f/django%2Fcontrib%2Fcomments%2Ftemplatetags%2Fcomments.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Ftemplatetags%2Fcomments.py?ref=477d737e1e6bdf93950c8a381906925c594fac2f",
            "patch": "@@ -17,7 +17,7 @@ class BaseCommentNode(template.Node):\n     @classmethod\n     def handle_token(cls, parser, token):\n         \"\"\"Class method to parse get_comment_list/count/form and return a Node.\"\"\"\n-        tokens = token.contents.split()\n+        tokens = token.split_contents()\n         if tokens[1] != 'for':\n             raise template.TemplateSyntaxError(\"Second argument in %r tag must be 'for'\" % tokens[0])\n \n@@ -146,7 +146,7 @@ class RenderCommentFormNode(CommentFormNode):\n     @classmethod\n     def handle_token(cls, parser, token):\n         \"\"\"Class method to parse render_comment_form and return a Node.\"\"\"\n-        tokens = token.contents.split()\n+        tokens = token.split_contents()\n         if tokens[1] != 'for':\n             raise template.TemplateSyntaxError(\"Second argument in %r tag must be 'for'\" % tokens[0])\n \n@@ -182,7 +182,7 @@ class RenderCommentListNode(CommentListNode):\n     @classmethod\n     def handle_token(cls, parser, token):\n         \"\"\"Class method to parse render_comment_list and return a Node.\"\"\"\n-        tokens = token.contents.split()\n+        tokens = token.split_contents()\n         if tokens[1] != 'for':\n             raise template.TemplateSyntaxError(\"Second argument in %r tag must be 'for'\" % tokens[0])\n "
        },
        {
            "sha": "185f6de2976710a448c71fe775bbeaae20c3e993",
            "filename": "tests/comment_tests/tests/templatetag_tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/477d737e1e6bdf93950c8a381906925c594fac2f/tests%2Fcomment_tests%2Ftests%2Ftemplatetag_tests.py",
            "raw_url": "https://github.com/django/django/raw/477d737e1e6bdf93950c8a381906925c594fac2f/tests%2Fcomment_tests%2Ftests%2Ftemplatetag_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fcomment_tests%2Ftests%2Ftemplatetag_tests.py?ref=477d737e1e6bdf93950c8a381906925c594fac2f",
            "patch": "@@ -3,11 +3,19 @@\n from django.contrib.comments.forms import CommentForm\n from django.contrib.comments.models import Comment\n from django.contrib.contenttypes.models import ContentType\n-from django.template import Template, Context\n+from django.template import Template, Context, Library, libraries\n \n from ..models import Article, Author\n from . import CommentTestCase\n \n+register = Library()\n+\n+@register.filter\n+def noop(variable, param=None):\n+    return variable\n+\n+libraries['comment_testtags'] = register\n+\n \n class CommentTemplateTagTests(CommentTestCase):\n \n@@ -32,6 +40,9 @@ def testGetCommentFormFromLiteral(self):\n     def testGetCommentFormFromObject(self):\n         self.testGetCommentForm(\"{% get_comment_form for a as form %}\")\n \n+    def testWhitespaceInGetCommentFormTag(self):\n+        self.testGetCommentForm(\"{% load comment_testtags %}{% get_comment_form for a|noop:'x y' as form %}\")\n+\n     def testRenderCommentForm(self, tag=None):\n         t = \"{% load comments %}\" + (tag or \"{% render_comment_form for comment_tests.article a.id %}\")\n         ctx, out = self.render(t, a=Article.objects.get(pk=1))\n@@ -44,6 +55,9 @@ def testRenderCommentFormFromLiteral(self):\n     def testRenderCommentFormFromObject(self):\n         self.testRenderCommentForm(\"{% render_comment_form for a %}\")\n \n+    def testWhitespaceInRenderCommentFormTag(self):\n+        self.testRenderCommentForm(\"{% load comment_testtags %}{% render_comment_form for a|noop:'x y' %}\")\n+\n     def testRenderCommentFormFromObjectWithQueryCount(self):\n         with self.assertNumQueries(1):\n             self.testRenderCommentFormFromObject()\n@@ -65,6 +79,10 @@ def testGetCommentCountFromObject(self):\n         self.createSomeComments()\n         self.verifyGetCommentCount(\"{% get_comment_count for a as cc %}\")\n \n+    def testWhitespaceInGetCommentCountTag(self):\n+        self.createSomeComments()\n+        self.verifyGetCommentCount(\"{% load comment_testtags %}{% get_comment_count for a|noop:'x y' as cc %}\")\n+\n     def verifyGetCommentList(self, tag=None):\n         c1, c2, c3, c4 = Comment.objects.all()[:4]\n         t = \"{% load comments %}\" +  (tag or \"{% get_comment_list for comment_tests.author a.id as cl %}\")\n@@ -84,6 +102,10 @@ def testGetCommentListFromObject(self):\n         self.createSomeComments()\n         self.verifyGetCommentList(\"{% get_comment_list for a as cl %}\")\n \n+    def testWhitespaceInGetCommentListTag(self):\n+        self.createSomeComments()\n+        self.verifyGetCommentList(\"{% load comment_testtags %}{% get_comment_list for a|noop:'x y' as cl %}\")\n+\n     def testGetCommentPermalink(self):\n         c1, c2, c3, c4 = self.createSomeComments()\n         t = \"{% load comments %}{% get_comment_list for comment_tests.author author.id as cl %}\"\n@@ -102,6 +124,15 @@ def testGetCommentPermalinkFormatted(self):\n         ctx, out = self.render(t, author=author)\n         self.assertEqual(out, \"/cr/%s/%s/#c%s-by-Joe Somebody\" % (ct.id, author.id, c2.id))\n \n+    def testWhitespaceInGetCommentPermalinkTag(self):\n+        c1, c2, c3, c4 = self.createSomeComments()\n+        t = \"{% load comments comment_testtags %}{% get_comment_list for comment_tests.author author.id as cl %}\"\n+        t += \"{% get_comment_permalink cl.0|noop:'x y' %}\"\n+        ct = ContentType.objects.get_for_model(Author)\n+        author = Author.objects.get(pk=1)\n+        ctx, out = self.render(t, author=author)\n+        self.assertEqual(out, \"/cr/%s/%s/#c%s\" % (ct.id, author.id, c2.id))\n+\n     def testRenderCommentList(self, tag=None):\n         t = \"{% load comments %}\" + (tag or \"{% render_comment_list for comment_tests.article a.id %}\")\n         ctx, out = self.render(t, a=Article.objects.get(pk=1))\n@@ -114,6 +145,9 @@ def testRenderCommentListFromLiteral(self):\n     def testRenderCommentListFromObject(self):\n         self.testRenderCommentList(\"{% render_comment_list for a %}\")\n \n+    def testWhitespaceInRenderCommentListTag(self):\n+        self.testRenderCommentList(\"{% load comment_testtags %}{% render_comment_list for a|noop:'x y' %}\")\n+\n     def testNumberQueries(self):\n         \"\"\"\n         Ensure that the template tags use cached content types to reduce the"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 38,
        "deletions": 4
    }
}