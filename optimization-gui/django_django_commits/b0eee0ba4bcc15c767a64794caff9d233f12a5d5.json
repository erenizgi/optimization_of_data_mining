{
    "author": "spookylukey",
    "message": "Removed various unnecessary instances of mark_safe applied to URLs\n\nAlso fixed some test breakages introduced in last commit",
    "sha": "b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
    "files": [
        {
            "sha": "58bbbabfdf447bbaaf58cfbe3829dd74524fb5b7",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -6,7 +6,6 @@\n from django.contrib.admin.util import quote\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_unicode\n-from django.utils.safestring import mark_safe\n \n ADDITION = 1\n CHANGE = 2\n@@ -66,5 +65,5 @@ def get_admin_url(self):\n         This is relative to the Django admin index page.\n         \"\"\"\n         if self.content_type and self.object_id:\n-            return mark_safe(\"%s/%s/%s/\" % (self.content_type.app_label, self.content_type.model, quote(self.object_id)))\n+            return \"%s/%s/%s/\" % (self.content_type.app_label, self.content_type.model, quote(self.object_id))\n         return None"
        },
        {
            "sha": "4d23f8f3842854c3b49684e9c81948e42282d318",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -745,7 +745,7 @@ def render_change_form(self, request, context, add=False, change=False, form_url\n             'has_file_field': True, # FIXME - this should check if form or formsets have a FileField,\n             'has_absolute_url': hasattr(self.model, 'get_absolute_url'),\n             'ordered_objects': ordered_objects,\n-            'form_url': mark_safe(form_url),\n+            'form_url': form_url,\n             'opts': opts,\n             'content_type_id': ContentType.objects.get_for_model(self.model).id,\n             'save_as': self.save_as,"
        },
        {
            "sha": "819beea32667a21c988a53d34acb00c637c0ae2b",
            "filename": "django/contrib/admindocs/templates/admin_doc/bookmarklets.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmindocs%2Ftemplates%2Fadmin_doc%2Fbookmarklets.html",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmindocs%2Ftemplates%2Fadmin_doc%2Fbookmarklets.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Ftemplates%2Fadmin_doc%2Fbookmarklets.html?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -22,7 +22,7 @@\n {% endblocktrans %}\n \n <div id=\"content-main\">\n-    <h3><a href=\"javascript:(function(){if(typeof ActiveXObject!='undefined'){x=new ActiveXObject('Microsoft.XMLHTTP')}else if(typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest()}else{return;}x.open('HEAD',location.href,false);x.send(null);try{view=x.getResponseHeader('x-view');}catch(e){alert('No view found for this page');return;}if(view=='undefined'){alert('No view found for this page');}document.location='{{ admin_url }}doc/views/'+view+'/';})()\">{% trans \"Documentation for this page\" %}</a></h3>\n+    <h3><a href=\"javascript:(function(){if(typeof ActiveXObject!='undefined'){x=new ActiveXObject('Microsoft.XMLHTTP')}else if(typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest()}else{return;}x.open('HEAD',location.href,false);x.send(null);try{view=x.getResponseHeader('x-view');}catch(e){alert('No view found for this page');return;}if(view=='undefined'){alert('No view found for this page');}document.location='{{ admin_url|escapejs }}doc/views/'+view+'/';})()\">{% trans \"Documentation for this page\" %}</a></h3>\n     <p>{% trans \"Jumps you from any page to the documentation for the view that generates that page.\" %}</p>\n \n     <h3><a href=\"javascript:(function(){if(typeof ActiveXObject!='undefined'){x=new ActiveXObject('Microsoft.XMLHTTP')}else if(typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest()}else{return;}x.open('GET',location.href,false);x.send(null);try{type=x.getResponseHeader('x-object-type');id=x.getResponseHeader('x-object-id');}catch(e){type='(none)';id='(none)';}d=document;b=d.body;e=d.createElement('div');e.id='xxxhhh';s=e.style;s.position='absolute';s.left='10px';s.top='10px';s.font='10px monospace';s.border='1px black solid';s.padding='4px';s.backgroundColor='#eee';e.appendChild(d.createTextNode('Type: '+type));e.appendChild(d.createElement('br'));e.appendChild(d.createTextNode('ID: '+id));e.appendChild(d.createElement('br'));l=d.createElement('a');l.href='#';l.onclick=function(){b.removeChild(e);};l.appendChild(d.createTextNode('[close]'));l.style.textDecoration='none';e.appendChild(l);b.appendChild(e);})();\">{% trans \"Show object ID\" %}</a></h3>"
        },
        {
            "sha": "5649398cc8f32d233a1361dc0b2e576453f12ac5",
            "filename": "django/contrib/admindocs/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Fviews.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -37,7 +37,7 @@ def bookmarklets(request):\n     admin_root = urlresolvers.reverse('admin:index')\n     return render_to_response('admin_doc/bookmarklets.html', {\n         'root_path': admin_root,\n-        'admin_url': mark_safe(\"%s://%s%s\" % (request.is_secure() and 'https' or 'http', request.get_host(), admin_root)),\n+        'admin_url': \"%s://%s%s\" % (request.is_secure() and 'https' or 'http', request.get_host(), admin_root),\n     }, context_instance=RequestContext(request))\n \n @staff_member_required"
        },
        {
            "sha": "ad61904041faa275986df49aa87c3679f01964ae",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -134,7 +134,7 @@ def user_change_password(self, request, id, form_url=''):\n         context = {\n             'title': _('Change password: %s') % escape(user.username),\n             'adminForm': adminForm,\n-            'form_url': mark_safe(form_url),\n+            'form_url': form_url,\n             'form': form,\n             'is_popup': '_popup' in request.REQUEST,\n             'add': True,"
        },
        {
            "sha": "687aa87f0304e65c8a74fb6e29120446b5a6a162",
            "filename": "django/contrib/databrowse/datastructures.py",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -8,7 +8,6 @@\n from django.utils import formats\n from django.utils.text import capfirst\n from django.utils.encoding import smart_unicode, smart_str, iri_to_uri\n-from django.utils.safestring import mark_safe\n from django.db.models.query import QuerySet\n \n EMPTY_VALUE = '(None)'\n@@ -30,7 +29,7 @@ def model_databrowse(self):\n         return self.site.registry[self.model]\n \n     def url(self):\n-        return mark_safe('%s%s/%s/' % (self.site.root_url, self.model._meta.app_label, self.model._meta.module_name))\n+        return '%s%s/%s/' % (self.site.root_url, self.model._meta.app_label, self.model._meta.module_name)\n \n     def objects(self, **kwargs):\n         return self.get_query_set().filter(**kwargs)\n@@ -70,9 +69,9 @@ def choices(self):\n \n     def url(self):\n         if self.field.choices:\n-            return mark_safe('%s%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name))\n+            return '%s%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name)\n         elif self.field.rel:\n-            return mark_safe('%s%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name))\n+            return '%s%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name)\n \n class EasyChoice(object):\n     def __init__(self, easy_model, field, value, label):\n@@ -83,7 +82,7 @@ def __repr__(self):\n         return smart_str('<EasyChoice for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def url(self):\n-        return mark_safe('%s%s/%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.field.name, iri_to_uri(self.value)))\n+        return '%s%s/%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.field.name, iri_to_uri(self.value))\n \n class EasyInstance(object):\n     def __init__(self, easy_model, instance):\n@@ -105,7 +104,7 @@ def pk(self):\n         return self.instance._get_pk_val()\n \n     def url(self):\n-        return mark_safe('%s%s/%s/objects/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, iri_to_uri(self.pk())))\n+        return '%s%s/%s/objects/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, iri_to_uri(self.pk()))\n \n     def fields(self):\n         \"\"\"\n@@ -187,14 +186,14 @@ def urls(self):\n                 for value in self.values():\n                     if value is None:\n                         continue\n-                    url = mark_safe('%s%s/%s/objects/%s/' % (self.model.site.root_url, m.model._meta.app_label, m.model._meta.module_name, iri_to_uri(value._get_pk_val())))\n+                    url = '%s%s/%s/objects/%s/' % (self.model.site.root_url, m.model._meta.app_label, m.model._meta.module_name, iri_to_uri(value._get_pk_val()))\n                     lst.append((smart_unicode(value), url))\n             else:\n                 lst = [(value, None) for value in self.values()]\n         elif self.field.choices:\n             lst = []\n             for value in self.values():\n-                url = mark_safe('%s%s/%s/fields/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name, iri_to_uri(self.raw_value)))\n+                url = '%s%s/%s/fields/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name, iri_to_uri(self.raw_value))\n                 lst.append((value, url))\n         elif isinstance(self.field, models.URLField):\n             val = self.values()[0]"
        },
        {
            "sha": "7bdd1e0032319806b6c7e8699633bb3daf220ab1",
            "filename": "django/contrib/databrowse/plugins/calendars.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -8,7 +8,6 @@\n from django.utils.html import format_html, format_html_join\n from django.utils.text import capfirst\n from django.utils.encoding import force_unicode\n-from django.utils.safestring import mark_safe\n from django.views.generic import dates\n from django.utils import datetime_safe\n \n@@ -72,12 +71,12 @@ def model_index_html(self, request, model, site):\n     def urls(self, plugin_name, easy_instance_field):\n         if isinstance(easy_instance_field.field, models.DateField):\n             d = easy_instance_field.raw_value\n-            return [mark_safe('%s%s/%s/%s/%s/%s/' % (\n+            return ['%s%s/%s/%s/%s/%s/' % (\n                 easy_instance_field.model.url(),\n                 plugin_name, easy_instance_field.field.name,\n                 str(d.year),\n                 datetime_safe.new_date(d).strftime('%b').lower(),\n-                d.day))]\n+                d.day)]\n \n     def model_view(self, request, model_databrowse, url):\n         self.model, self.site = model_databrowse.model, model_databrowse.site"
        },
        {
            "sha": "4b1f0e66147a83195bbf2e6eef092c32850524e9",
            "filename": "django/contrib/databrowse/plugins/fieldchoices.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -8,7 +8,6 @@\n from django.utils.html import format_html, format_html_join\n from django.utils.text import capfirst\n from django.utils.encoding import smart_str, force_unicode\n-from django.utils.safestring import mark_safe\n import urllib\n \n class FieldChoicePlugin(DatabrowsePlugin):\n@@ -40,10 +39,10 @@ def model_index_html(self, request, model, site):\n     def urls(self, plugin_name, easy_instance_field):\n         if easy_instance_field.field in self.field_dict(easy_instance_field.model.model).values():\n             field_value = smart_str(easy_instance_field.raw_value)\n-            return [mark_safe('%s%s/%s/%s/' % (\n+            return ['%s%s/%s/%s/' % (\n                 easy_instance_field.model.url(),\n                 plugin_name, easy_instance_field.field.name,\n-                urllib.quote(field_value, safe='')))]\n+                urllib.quote(field_value, safe=''))]\n \n     def model_view(self, request, model_databrowse, url):\n         self.model, self.site = model_databrowse.model, model_databrowse.site"
        },
        {
            "sha": "72c50eab0ffb4047cf8c75b50d6abc6c95c041da",
            "filename": "django/contrib/gis/maps/google/gmap.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fgmap.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fgmap.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fgmap.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -11,7 +11,7 @@ class GoogleMapException(Exception):\n \n # The default Google Maps URL (for the API javascript)\n # TODO: Internationalize for Japan, UK, etc.\n-GOOGLE_MAPS_URL='http://maps.google.com/maps?file=api&amp;v=%s&amp;key='\n+GOOGLE_MAPS_URL='http://maps.google.com/maps?file=api&v=%s&key='\n \n \n class GoogleMap(object):\n@@ -49,7 +49,7 @@ def __init__(self, key=None, api_url=None, version=None,\n \n         # Can specify the API URL in the `api_url` keyword.\n         if not api_url:\n-            self.api_url = mark_safe(getattr(settings, 'GOOGLE_MAPS_URL', GOOGLE_MAPS_URL) % self.version)\n+            self.api_url = getattr(settings, 'GOOGLE_MAPS_URL', GOOGLE_MAPS_URL) % self.version\n         else:\n             self.api_url = api_url\n "
        },
        {
            "sha": "49ec3c19451058c113733611c090ef4c26aa9def",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b0eee0ba4bcc15c767a64794caff9d233f12a5d5/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=b0eee0ba4bcc15c767a64794caff9d233f12a5d5",
            "patch": "@@ -1369,19 +1369,19 @@ def test_get_change_view(self):\n     def test_changelist_to_changeform_link(self):\n         \"The link from the changelist referring to the changeform of the object should be quoted\"\n         response = self.client.get('/test_admin/admin/admin_views/modelwithstringprimarykey/')\n-        should_contain = \"\"\"<th><a href=\"%s/\">%s</a></th></tr>\"\"\" % (quote(self.pk), escape(self.pk))\n+        should_contain = \"\"\"<th><a href=\"%s/\">%s</a></th></tr>\"\"\" % (escape(quote(self.pk)), escape(self.pk))\n         self.assertContains(response, should_contain)\n \n     def test_recentactions_link(self):\n         \"The link from the recent actions list referring to the changeform of the object should be quoted\"\n         response = self.client.get('/test_admin/admin/')\n-        should_contain = \"\"\"<a href=\"admin_views/modelwithstringprimarykey/%s/\">%s</a>\"\"\" % (quote(self.pk), escape(self.pk))\n+        should_contain = \"\"\"<a href=\"admin_views/modelwithstringprimarykey/%s/\">%s</a>\"\"\" % (escape(quote(self.pk)), escape(self.pk))\n         self.assertContains(response, should_contain)\n \n     def test_recentactions_without_content_type(self):\n         \"If a LogEntry is missing content_type it will not display it in span tag under the hyperlink.\"\n         response = self.client.get('/test_admin/admin/')\n-        should_contain = \"\"\"<a href=\"admin_views/modelwithstringprimarykey/%s/\">%s</a>\"\"\" % (quote(self.pk), escape(self.pk))\n+        should_contain = \"\"\"<a href=\"admin_views/modelwithstringprimarykey/%s/\">%s</a>\"\"\" % (escape(quote(self.pk)), escape(self.pk))\n         self.assertContains(response, should_contain)\n         should_contain = \"Model with string primary key\" # capitalized in Recent Actions\n         self.assertContains(response, should_contain)\n@@ -1402,7 +1402,7 @@ def test_deleteconfirmation_link(self):\n         \"The link from the delete confirmation page referring back to the changeform of the object should be quoted\"\n         response = self.client.get('/test_admin/admin/admin_views/modelwithstringprimarykey/%s/delete/' % quote(self.pk))\n         # this URL now comes through reverse(), thus iri_to_uri encoding\n-        should_contain = \"\"\"/%s/\">%s</a>\"\"\" % (iri_to_uri(quote(self.pk)), escape(self.pk))\n+        should_contain = \"\"\"/%s/\">%s</a>\"\"\" % (escape(iri_to_uri(quote(self.pk))), escape(self.pk))\n         self.assertContains(response, should_contain)\n \n     def test_url_conflicts_with_add(self):"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 22,
        "deletions": 26
    }
}