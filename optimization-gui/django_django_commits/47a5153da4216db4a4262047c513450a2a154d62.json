{
    "author": "jezdez",
    "message": "Fixed #12735, #14892 and #11542 -- Fixed support for the latest IPython (development) version in the shell management command and added a hook to implement additional shell runners (by subclassing django.core.management.commands.shell.Command, extending the ``shells`` attribute and implement a method with the same name).\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14895 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "47a5153da4216db4a4262047c513450a2a154d62",
    "files": [
        {
            "sha": "f08de4e89280461501166f2f59005b9a1b91deb0",
            "filename": "django/core/management/commands/shell.py",
            "status": "modified",
            "additions": 27,
            "deletions": 6,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/47a5153da4216db4a4262047c513450a2a154d62/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "raw_url": "https://github.com/django/django/raw/47a5153da4216db4a4262047c513450a2a154d62/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py?ref=47a5153da4216db4a4262047c513450a2a154d62",
            "patch": "@@ -8,9 +8,34 @@ class Command(NoArgsCommand):\n             help='Tells Django to use plain Python, not IPython.'),\n     )\n     help = \"Runs a Python interactive interpreter. Tries to use IPython, if it's available.\"\n-\n+    shells = ['ipython']\n     requires_model_validation = False\n \n+    def ipython(self):\n+        try:\n+            from IPython.frontend.terminal.embed import TerminalInteractiveShell\n+            shell = TerminalInteractiveShell()\n+            shell.mainloop()\n+        except ImportError:\n+            # IPython < 0.11\n+            # Explicitly pass an empty list as arguments, because otherwise\n+            # IPython would use sys.argv from this script.\n+            try:\n+                from IPython.Shell import IPShell\n+                shell = IPShell(argv=[])\n+                shell.mainloop()\n+            except ImportError:\n+                # IPython not found at all, raise ImportError\n+                raise\n+\n+    def run_shell(self):\n+        for shell in self.shells:\n+            try:\n+                return getattr(self, shell)()\n+            except ImportError:\n+                pass\n+        raise ImportError\n+\n     def handle_noargs(self, **options):\n         # XXX: (Temporary) workaround for ticket #1796: force early loading of all\n         # models from installed apps.\n@@ -23,11 +48,7 @@ def handle_noargs(self, **options):\n             if use_plain:\n                 # Don't bother loading IPython, because the user wants plain Python.\n                 raise ImportError\n-            import IPython\n-            # Explicitly pass an empty list as arguments, because otherwise IPython\n-            # would use sys.argv from this script.\n-            shell = IPython.Shell.IPShell(argv=[])\n-            shell.mainloop()\n+            self.run_shell()\n         except ImportError:\n             import code\n             # Set up a dictionary to serve as the environment for the shell, so"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 27,
        "deletions": 6
    }
}