{
    "author": "ramiro",
    "message": "Deprecated undocumented warnings manipulation testing tools.",
    "sha": "7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6",
    "files": [
        {
            "sha": "3aa0afa35eb6d46831fd88a748c6da2276a9c101",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6",
            "patch": "@@ -1,20 +1,21 @@\n from __future__ import unicode_literals\n \n+from copy import copy\n import difflib\n+import errno\n+from functools import wraps\n import json\n import os\n import re\n import sys\n-from copy import copy\n-from functools import wraps\n try:\n     from urllib.parse import urlsplit, urlunsplit\n except ImportError:     # Python 2\n     from urlparse import urlsplit, urlunsplit\n import select\n import socket\n import threading\n-import errno\n+import warnings\n \n from django.conf import settings\n from django.contrib.staticfiles.handlers import StaticFilesHandler\n@@ -36,8 +37,7 @@\n from django.test.client import Client\n from django.test.html import HTMLParseError, parse_html\n from django.test.signals import template_rendered\n-from django.test.utils import (get_warnings_state, restore_warnings_state,\n-    override_settings, compare_xml, strip_quotes)\n+from django.test.utils import (override_settings, compare_xml, strip_quotes)\n from django.test.utils import ContextList\n from django.utils import unittest as ut2\n from django.utils.encoding import force_text\n@@ -241,6 +241,11 @@ def message(self):\n \n \n class SimpleTestCase(ut2.TestCase):\n+\n+    _warn_txt = (\"save_warnings_state/restore_warnings_state \"\n+        \"django.test.*TestCase methods are deprecated. Use Python's \"\n+        \"warnings.catch_warnings context manager instead.\")\n+\n     def __call__(self, result=None):\n         \"\"\"\n         Wrapper around default __call__ method to perform common Django test\n@@ -279,14 +284,16 @@ def save_warnings_state(self):\n         \"\"\"\n         Saves the state of the warnings module\n         \"\"\"\n-        self._warnings_state = get_warnings_state()\n+        warnings.warn(self._warn_txt, DeprecationWarning, stacklevel=2)\n+        self._warnings_state = warnings.filters[:]\n \n     def restore_warnings_state(self):\n         \"\"\"\n         Restores the state of the warnings module to the state\n         saved by save_warnings_state()\n         \"\"\"\n-        restore_warnings_state(self._warnings_state)\n+        warnings.warn(self._warn_txt, DeprecationWarning, stacklevel=2)\n+        warnings.filters = self._warnings_state[:]\n \n     def settings(self, **kwargs):\n         \"\"\""
        },
        {
            "sha": "9413ea8dc48d9b9638f397588494be5fccb3c439",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6",
            "patch": "@@ -98,13 +98,19 @@ def teardown_test_environment():\n     del mail.outbox\n \n \n+warn_txt = (\"get_warnings_state/restore_warnings_state functions from \"\n+    \"django.test.utils are deprecated. Use Python's warnings.catch_warnings() \"\n+    \"context manager instead.\")\n+\n+\n def get_warnings_state():\n     \"\"\"\n     Returns an object containing the state of the warnings module\n     \"\"\"\n     # There is no public interface for doing this, but this implementation of\n     # get_warnings_state and restore_warnings_state appears to work on Python\n     # 2.4 to 2.7.\n+    warnings.warn(warn_txt, DeprecationWarning, stacklevel=2)\n     return warnings.filters[:]\n \n \n@@ -113,6 +119,7 @@ def restore_warnings_state(state):\n     Restores the state of the warnings module when passed an object that was\n     returned by get_warnings_state()\n     \"\"\"\n+    warnings.warn(warn_txt, DeprecationWarning, stacklevel=2)\n     warnings.filters = state[:]\n \n "
        },
        {
            "sha": "df3d84fdae14f4044145d50ebacc168391c8e33b",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6",
            "patch": "@@ -267,7 +267,6 @@ these changes.\n   in 1.4. The backward compatibility will be removed --\n   ``HttpRequest.raw_post_data`` will no longer work.\n \n-\n * The value for the ``post_url_continue`` parameter in\n   ``ModelAdmin.response_add()`` will have to be either ``None`` (to redirect\n   to the newly created object's edit page) or a pre-formatted url. String\n@@ -314,6 +313,13 @@ these changes.\n * The ``depth`` keyword argument will be removed from\n   :meth:`~django.db.models.query.QuerySet.select_related`.\n \n+* The undocumented ``get_warnings_state()``/``restore_warnings_state()``\n+  functions from :mod:`django.test.utils` and the ``save_warnings_state()``/\n+  ``restore_warnings_state()``\n+  :ref:`django.test.*TestCase <django-testcase-subclasses>` methods are\n+  deprecated. Use the :class:`warnings.catch_warnings` context manager\n+  available starting with Python 2.6 instead.\n+\n 1.8\n ---\n "
        },
        {
            "sha": "5739061dd112e82e89afd17d3abb8dd1790449ce",
            "filename": "docs/topics/testing/overview.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/docs%2Ftopics%2Ftesting%2Foverview.txt",
            "raw_url": "https://github.com/django/django/raw/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/docs%2Ftopics%2Ftesting%2Foverview.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting%2Foverview.txt?ref=7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6",
            "patch": "@@ -835,6 +835,8 @@ The following is a simple unit test using the test client::\n \n     :class:`django.test.client.RequestFactory`\n \n+.. _django-testcase-subclasses:\n+\n Provided test case classes\n --------------------------\n "
        },
        {
            "sha": "2a74b95ffa07ff413464fbb2e34f055163ab5bd1",
            "filename": "tests/regressiontests/test_utils/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 14,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_utils%2Ftests.py?ref=7947c9e3a6bd8c1dfe7fc209fb2256a528149bb6",
            "patch": "@@ -220,24 +220,27 @@ def test_save_restore_warnings_state(self):\n         # of save_warnings_state/restore_warnings_state (e.g. just\n         # warnings.resetwarnings()) , but it is difficult to test more.\n         import warnings\n-        self.save_warnings_state()\n+        with warnings.catch_warnings():\n+            warnings.simplefilter(\"ignore\", DeprecationWarning)\n \n-        class MyWarning(Warning):\n-            pass\n+            self.save_warnings_state()\n+\n+            class MyWarning(Warning):\n+                pass\n \n-        # Add a filter that causes an exception to be thrown, so we can catch it\n-        warnings.simplefilter(\"error\", MyWarning)\n-        self.assertRaises(Warning, lambda: warnings.warn(\"warn\", MyWarning))\n+            # Add a filter that causes an exception to be thrown, so we can catch it\n+            warnings.simplefilter(\"error\", MyWarning)\n+            self.assertRaises(Warning, lambda: warnings.warn(\"warn\", MyWarning))\n \n-        # Now restore.\n-        self.restore_warnings_state()\n-        # After restoring, we shouldn't get an exception. But we don't want a\n-        # warning printed either, so we have to silence the warning.\n-        warnings.simplefilter(\"ignore\", MyWarning)\n-        warnings.warn(\"warn\", MyWarning)\n+            # Now restore.\n+            self.restore_warnings_state()\n+            # After restoring, we shouldn't get an exception. But we don't want a\n+            # warning printed either, so we have to silence the warning.\n+            warnings.simplefilter(\"ignore\", MyWarning)\n+            warnings.warn(\"warn\", MyWarning)\n \n-        # Remove the filter we just added.\n-        self.restore_warnings_state()\n+            # Remove the filter we just added.\n+            self.restore_warnings_state()\n \n \n class HTMLEqualTests(TestCase):"
        }
    ],
    "stats": {
        "total": 69,
        "additions": 47,
        "deletions": 22
    }
}