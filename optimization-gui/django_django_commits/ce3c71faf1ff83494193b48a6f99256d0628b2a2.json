{
    "author": "akaariai",
    "message": "Minor improvement to proxy model handling\n\nRefs #19385",
    "sha": "ce3c71faf1ff83494193b48a6f99256d0628b2a2",
    "files": [
        {
            "sha": "79b5d9945258549da8cb1092772c7f44f58ff6df",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/ce3c71faf1ff83494193b48a6f99256d0628b2a2/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/ce3c71faf1ff83494193b48a6f99256d0628b2a2/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=ce3c71faf1ff83494193b48a6f99256d0628b2a2",
            "patch": "@@ -255,8 +255,6 @@ def get_default_columns(self, with_aliases=False, col_aliases=None,\n         result = []\n         if opts is None:\n             opts = self.query.model._meta\n-        # Skip all proxy to the root proxied model\n-        opts = opts.concrete_model._meta\n         qn = self.quote_name_unless_alias\n         qn2 = self.connection.ops.quote_name\n         aliases = set()"
        },
        {
            "sha": "87104f0d138924d35a0b64321eb4b105324b6dc8",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/ce3c71faf1ff83494193b48a6f99256d0628b2a2/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/ce3c71faf1ff83494193b48a6f99256d0628b2a2/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=ce3c71faf1ff83494193b48a6f99256d0628b2a2",
            "patch": "@@ -997,8 +997,7 @@ def setup_inherited_models(self):\n         whereas column determination is a later part, and side-effect, of\n         as_sql()).\n         \"\"\"\n-        # Skip all proxy models\n-        opts = self.model._meta.concrete_model._meta\n+        opts = self.model._meta\n         root_alias = self.tables[0]\n         seen = {None: root_alias}\n \n@@ -1013,7 +1012,8 @@ def join_parent_model(self, opts, model, alias, seen):\n         a parent of 'opts' or if it is None this method is a no-op.\n \n         The 'alias' is the root alias for starting the join, 'seen' is a dict\n-        of model -> alias of existing joins.\n+        of model -> alias of existing joins. It must also contain a mapping\n+        of None -> some alias. This will be returned in the no-op case.\n         \"\"\"\n         if model in seen:\n             return seen[model]\n@@ -1036,7 +1036,7 @@ def join_parent_model(self, opts, model, alias, seen):\n             connection = (alias, int_opts.db_table, link_field.column, int_opts.pk.column)\n             alias = seen[int_model] = self.join(connection, nullable=False,\n                                                 join_field=link_field)\n-        return alias\n+        return alias or seen[None]\n \n     def remove_inherited_models(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 10,
        "additions": 4,
        "deletions": 6
    }
}