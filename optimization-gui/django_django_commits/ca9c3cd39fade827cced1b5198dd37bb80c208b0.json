{
    "author": "andrewgodwin",
    "message": "Add check constraint support - needed a few Field changes",
    "sha": "ca9c3cd39fade827cced1b5198dd37bb80c208b0",
    "files": [
        {
            "sha": "021d9bd450be241af908f93ba0ad7a5c675dbceb",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -435,6 +435,9 @@ class BaseDatabaseFeatures(object):\n     # Does it support foreign keys?\n     supports_foreign_keys = True\n \n+    # Does it support CHECK constraints?\n+    supports_check_constraints = True\n+\n     def __init__(self, connection):\n         self.connection = connection\n "
        },
        {
            "sha": "52d5edf57dffbc0cfa5811ca07ca356e33c2bae2",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -18,6 +18,7 @@ class BaseDatabaseCreation(object):\n     destruction of test databases.\n     \"\"\"\n     data_types = {}\n+    data_type_check_constraints = {}\n \n     def __init__(self, connection):\n         self.connection = connection"
        },
        {
            "sha": "4694dcd46f0f8b6dab545f14da2243e44ed961d9",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -170,6 +170,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     requires_explicit_null_ordering_when_grouping = True\n     allows_primary_key_0 = False\n     uses_savepoints = True\n+    supports_check_constraints = False\n \n     def __init__(self, connection):\n         super(DatabaseFeatures, self).__init__(connection)"
        },
        {
            "sha": "f131d14abe7e43f72d2e0d819d41a1a9a1d9c10f",
            "filename": "django/db/backends/postgresql_psycopg2/creation.py",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -26,14 +26,19 @@ class DatabaseCreation(BaseDatabaseCreation):\n         'GenericIPAddressField': 'inet',\n         'NullBooleanField':  'boolean',\n         'OneToOneField':     'integer',\n-        'PositiveIntegerField': 'integer CHECK (\"%(column)s\" >= 0)',\n-        'PositiveSmallIntegerField': 'smallint CHECK (\"%(column)s\" >= 0)',\n+        'PositiveIntegerField': 'integer',\n+        'PositiveSmallIntegerField': 'smallint',\n         'SlugField':         'varchar(%(max_length)s)',\n         'SmallIntegerField': 'smallint',\n         'TextField':         'text',\n         'TimeField':         'time',\n     }\n \n+    data_type_check_constraints = {\n+        'PositiveIntegerField': '\"%(column)s\" >= 0',\n+        'PositiveSmallIntegerField': '\"%(column)s\" >= 0',\n+    }\n+\n     def sql_table_creation_suffix(self):\n         assert self.connection.settings_dict['TEST_COLLATION'] is None, \"PostgreSQL does not support collation setting at database creation time.\"\n         if self.connection.settings_dict['TEST_CHARSET']:"
        },
        {
            "sha": "5a29932859997a9660d3791f81c7d074480d1271",
            "filename": "django/db/backends/postgresql_psycopg2/introspection.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -137,7 +137,7 @@ def get_constraints(self, cursor, table_name):\n                 kc.table_schema = %s AND\n                 kc.table_name = %s\n         \"\"\", [\"public\", table_name])\n-        for constraint, column, kind in cursor.fetchall():\n+        for constraint, column in cursor.fetchall():\n             # If we're the first column, make the record\n             if constraint not in constraints:\n                 constraints[constraint] = {"
        },
        {
            "sha": "974a18cc3421d79fbb53af23efc8683f2d0acccc",
            "filename": "django/db/backends/schema.py",
            "status": "modified",
            "additions": 45,
            "deletions": 16,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fschema.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fschema.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fschema.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -19,9 +19,6 @@ class BaseDatabaseSchemaEditor(object):\n     then the relevant actions, and then commit(). This is necessary to allow\n     things like circular foreign key references - FKs will only be created once\n     commit() is called.\n-\n-    TODO:\n-        - Check constraints (PosIntField)\n     \"\"\"\n \n     # Overrideable SQL templates\n@@ -41,7 +38,7 @@ class BaseDatabaseSchemaEditor(object):\n     sql_delete_column = \"ALTER TABLE %(table)s DROP COLUMN %(column)s CASCADE\"\n     sql_rename_column = \"ALTER TABLE %(table)s RENAME COLUMN %(old_column)s TO %(new_column)s\"\n \n-    sql_create_check = \"ADD CONSTRAINT %(name)s CHECK (%(check)s)\"\n+    sql_create_check = \"ALTER TABLE %(table)s ADD CONSTRAINT %(name)s CHECK (%(check)s)\"\n     sql_delete_check = \"ALTER TABLE %(table)s DROP CONSTRAINT %(name)s\"\n \n     sql_create_unique = \"ALTER TABLE %(table)s ADD CONSTRAINT %(name)s UNIQUE (%(columns)s)\"\n@@ -105,7 +102,8 @@ def column_sql(self, model, field, include_default=False):\n         The field must already have had set_attributes_from_name called.\n         \"\"\"\n         # Get the column's type and use that as the basis of the SQL\n-        sql = field.db_type(connection=self.connection)\n+        db_params = field.db_parameters(connection=self.connection)\n+        sql = db_params['type']\n         params = []\n         # Check for fields that aren't actually columns (e.g. M2M)\n         if sql is None:\n@@ -169,6 +167,11 @@ def create_model(self, model, force=False):\n             definition, extra_params = self.column_sql(model, field)\n             if definition is None:\n                 continue\n+            # Check constraints can go on the column SQL here\n+            db_params = field.db_parameters(connection=self.connection)\n+            if db_params['check']:\n+                definition += \" CHECK (%s)\" % db_params['check']\n+            # Add the SQL to our big list\n             column_sqls.append(\"%s %s\" % (\n                 self.quote_name(field.column),\n                 definition,\n@@ -295,6 +298,10 @@ def create_field(self, model, field, keep_default=False):\n         # It might not actually have a column behind it\n         if definition is None:\n             return\n+        # Check constraints can go on the column SQL here\n+        db_params = field.db_parameters(connection=self.connection)\n+        if db_params['check']:\n+            definition += \" CHECK (%s)\" % db_params['check']\n         # Build the SQL and run it\n         sql = self.sql_create_column % {\n             \"table\": self.quote_name(model._meta.db_table),\n@@ -358,8 +365,10 @@ def alter_field(self, model, old_field, new_field, strict=False):\n         If strict is true, raises errors if the old column does not match old_field precisely.\n         \"\"\"\n         # Ensure this field is even column-based\n-        old_type = old_field.db_type(connection=self.connection)\n-        new_type = self._type_for_alter(new_field)\n+        old_db_params = old_field.db_parameters(connection=self.connection)\n+        old_type = old_db_params['type']\n+        new_db_params = new_field.db_parameters(connection=self.connection)\n+        new_type = new_db_params['type']\n         if old_type is None and new_type is None and (old_field.rel.through and new_field.rel.through and old_field.rel.through._meta.auto_created and new_field.rel.through._meta.auto_created):\n             return self._alter_many_to_many(model, old_field, new_field, strict)\n         elif old_type is None or new_type is None:\n@@ -417,6 +426,22 @@ def alter_field(self, model, old_field, new_field, strict=False):\n                         \"name\": fk_name,\n                     }\n                 )\n+        # Change check constraints?\n+        if old_db_params['check'] != new_db_params['check'] and old_db_params['check']:\n+            constraint_names = self._constraint_names(model, [old_field.column], check=True)\n+            if strict and len(constraint_names) != 1:\n+                raise ValueError(\"Found wrong number (%s) of check constraints for %s.%s\" % (\n+                    len(constraint_names),\n+                    model._meta.db_table,\n+                    old_field.column,\n+                ))\n+            for constraint_name in constraint_names:\n+                self.execute(\n+                    self.sql_delete_check % {\n+                        \"table\": self.quote_name(model._meta.db_table),\n+                        \"name\": constraint_name,\n+                    }\n+                )\n         # Have they renamed the column?\n         if old_field.column != new_field.column:\n             self.execute(self.sql_rename_column % {\n@@ -543,6 +568,16 @@ def alter_field(self, model, old_field, new_field, strict=False):\n                     \"to_column\": self.quote_name(new_field.rel.get_related_field().column),\n                 }\n             )\n+        # Does it have check constraints we need to add?\n+        if old_db_params['check'] != new_db_params['check'] and new_db_params['check']:\n+            self.execute(\n+                self.sql_create_check % {\n+                    \"table\": self.quote_name(model._meta.db_table),\n+                    \"name\": self._create_index_name(model, [new_field.column], suffix=\"_check\"),\n+                    \"column\": self.quote_name(new_field.column),\n+                    \"check\": new_db_params['check'],\n+                }\n+            )\n \n     def _alter_many_to_many(self, model, old_field, new_field, strict):\n         \"Alters M2Ms to repoint their to= endpoints.\"\n@@ -555,14 +590,6 @@ def _alter_many_to_many(self, model, old_field, new_field, strict):\n             new_field.rel.through._meta.get_field_by_name(new_field.m2m_reverse_field_name())[0],\n         )\n \n-    def _type_for_alter(self, field):\n-        \"\"\"\n-        Returns a field's type suitable for ALTER COLUMN.\n-        By default it just returns field.db_type().\n-        To be overriden by backend specific subclasses\n-        \"\"\"\n-        return field.db_type(connection=self.connection)\n-\n     def _create_index_name(self, model, column_names, suffix=\"\"):\n         \"Generates a unique name for an index/unique constraint.\"\n         # If there is just one column in the index, use a default algorithm from Django\n@@ -581,7 +608,7 @@ def _create_index_name(self, model, column_names, suffix=\"\"):\n             index_name = '%s%s' % (table_name[:(self.connection.features.max_index_name_length - len(part))], part)\n         return index_name\n \n-    def _constraint_names(self, model, column_names=None, unique=None, primary_key=None, index=None, foreign_key=None):\n+    def _constraint_names(self, model, column_names=None, unique=None, primary_key=None, index=None, foreign_key=None, check=None):\n         \"Returns all constraint names matching the columns and conditions\"\n         column_names = set(column_names) if column_names else None\n         constraints = self.connection.introspection.get_constraints(self.connection.cursor(), model._meta.db_table)\n@@ -594,6 +621,8 @@ def _constraint_names(self, model, column_names=None, unique=None, primary_key=N\n                     continue\n                 if index is not None and infodict['index'] != index:\n                     continue\n+                if check is not None and infodict['check'] != check:\n+                    continue\n                 if foreign_key is not None and not infodict['foreign_key']:\n                     continue\n                 result.append(name)"
        },
        {
            "sha": "8e30c7f22d7e484a5040156532fc39785ad7cdb7",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -97,6 +97,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     has_bulk_insert = True\n     can_combine_inserts_with_and_without_auto_increment_pk = False\n     supports_foreign_keys = False\n+    supports_check_constraints = False\n \n     @cached_property\n     def supports_stddev(self):"
        },
        {
            "sha": "6149a4e772cbdd4b91111e4bd3a3afa30aaeaf44",
            "filename": "django/db/backends/sqlite3/schema.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fsqlite3%2Fschema.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fbackends%2Fsqlite3%2Fschema.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fschema.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -99,8 +99,10 @@ def delete_field(self, model, field):\n \n     def alter_field(self, model, old_field, new_field, strict=False):\n         # Ensure this field is even column-based\n-        old_type = old_field.db_type(connection=self.connection)\n-        new_type = self._type_for_alter(new_field)\n+        old_db_params = old_field.db_parameters(connection=self.connection)\n+        old_type = old_db_params['type']\n+        new_db_params = new_field.db_parameters(connection=self.connection)\n+        new_type = new_db_params['type']\n         if old_type is None and new_type is None and (old_field.rel.through and new_field.rel.through and old_field.rel.through._meta.auto_created and new_field.rel.through._meta.auto_created):\n             return self._alter_many_to_many(model, old_field, new_field, strict)\n         elif old_type is None or new_type is None:"
        },
        {
            "sha": "a0b09c9fec1739891da6d6261cdc5d35bb36cc60",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 23,
            "deletions": 3,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -232,12 +232,32 @@ def db_type(self, connection):\n         # mapped to one of the built-in Django field types. In this case, you\n         # can implement db_type() instead of get_internal_type() to specify\n         # exactly which wacky database column type you want to use.\n+        params = self.db_parameters(connection)\n+        if params['type']:\n+            if params['check']:\n+                return \"%s CHECK (%s)\" % (params['type'], params['check'])\n+            else:\n+                return params['type']\n+        return None\n+\n+    def db_parameters(self, connection):\n+        \"\"\"\n+        Replacement for db_type, providing a range of different return\n+        values (type, checks)\n+        \"\"\"\n         data = DictWrapper(self.__dict__, connection.ops.quote_name, \"qn_\")\n         try:\n-            return (connection.creation.data_types[self.get_internal_type()]\n-                    % data)\n+            type_string = connection.creation.data_types[self.get_internal_type()] % data\n         except KeyError:\n-            return None\n+            type_string = None\n+        try:\n+            check_string = connection.creation.data_type_check_constraints[self.get_internal_type()] % data\n+        except KeyError:\n+            check_string = None\n+        return {\n+            \"type\": type_string,\n+            \"check\": check_string,\n+        }\n \n     @property\n     def unique(self):"
        },
        {
            "sha": "37bf4e8072da89203d63b118ce839d1c23d82f18",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -1050,6 +1050,9 @@ def db_type(self, connection):\n             return IntegerField().db_type(connection=connection)\n         return rel_field.db_type(connection=connection)\n \n+    def db_parameters(self, connection):\n+        return {\"type\": self.db_type(connection), \"check\": []}\n+\n class OneToOneField(ForeignKey):\n     \"\"\"\n     A OneToOneField is essentially the same as a ForeignKey, with the exception\n@@ -1292,3 +1295,6 @@ def db_type(self, connection):\n         # A ManyToManyField is not represented by a single column,\n         # so return None.\n         return None\n+\n+    def db_parameters(self, connection):\n+        return {\"type\": None, \"check\": None}"
        },
        {
            "sha": "f3d6d09e2e4c7d307bfc90ccf647dff1bcd7cb6b",
            "filename": "tests/modeltests/schema/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/tests%2Fmodeltests%2Fschema%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/tests%2Fmodeltests%2Fschema%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fschema%2Fmodels.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -7,6 +7,7 @@\n \n class Author(models.Model):\n     name = models.CharField(max_length=255)\n+    height = models.PositiveIntegerField(null=True, blank=True)\n \n     class Meta:\n         managed = False"
        },
        {
            "sha": "7d8602eff7ec505971e388cbd319b6208a32d2a4",
            "filename": "tests/modeltests/schema/tests.py",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/ca9c3cd39fade827cced1b5198dd37bb80c208b0/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ca9c3cd39fade827cced1b5198dd37bb80c208b0/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fschema%2Ftests.py?ref=ca9c3cd39fade827cced1b5198dd37bb80c208b0",
            "patch": "@@ -347,6 +347,56 @@ def test_m2m_repoint(self):\n             else:\n                 self.fail(\"No FK constraint for tag_id found\")\n \n+    @skipUnless(connection.features.supports_check_constraints, \"No check constraints\")\n+    def test_check_constraints(self):\n+        \"\"\"\n+        Tests creating/deleting CHECK constraints\n+        \"\"\"\n+        # Create the tables\n+        editor = connection.schema_editor()\n+        editor.start()\n+        editor.create_model(Author)\n+        editor.commit()\n+        # Ensure the constraint exists\n+        constraints = connection.introspection.get_constraints(connection.cursor(), Author._meta.db_table)\n+        for name, details in constraints.items():\n+            if details['columns'] == set([\"height\"]) and details['check']:\n+                break\n+        else:\n+            self.fail(\"No check constraint for height found\")\n+        # Alter the column to remove it\n+        new_field = IntegerField(null=True, blank=True)\n+        new_field.set_attributes_from_name(\"height\")\n+        editor = connection.schema_editor()\n+        editor.start()\n+        editor.alter_field(\n+            Author,\n+            Author._meta.get_field_by_name(\"height\")[0],\n+            new_field,\n+            strict = True,\n+        )\n+        editor.commit()\n+        constraints = connection.introspection.get_constraints(connection.cursor(), Author._meta.db_table)\n+        for name, details in constraints.items():\n+            if details['columns'] == set([\"height\"]) and details['check']:\n+                self.fail(\"Check constraint for height found\")\n+        # Alter the column to re-add it\n+        editor = connection.schema_editor()\n+        editor.start()\n+        editor.alter_field(\n+            Author,\n+            new_field,\n+            Author._meta.get_field_by_name(\"height\")[0],\n+            strict = True,\n+        )\n+        editor.commit()\n+        constraints = connection.introspection.get_constraints(connection.cursor(), Author._meta.db_table)\n+        for name, details in constraints.items():\n+            if details['columns'] == set([\"height\"]) and details['check']:\n+                break\n+        else:\n+            self.fail(\"No check constraint for height found\")\n+\n     def test_unique(self):\n         \"\"\"\n         Tests removing and adding unique constraints to a single column."
        }
    ],
    "stats": {
        "total": 167,
        "additions": 143,
        "deletions": 24
    }
}