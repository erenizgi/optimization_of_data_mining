{
    "author": "aaugustin",
    "message": "Fixed #17937 -- Avoided an error in the timeuntil filter when it receives a date object. Thanks Dmitry Guyvoronsky for the report.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17774 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "1e28567e0d2be1f09a301131b1a29b939e797d6c",
    "files": [
        {
            "sha": "276108b55a060d1e19dbb9e8e05f936a03da5623",
            "filename": "django/utils/timesince.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/1e28567e0d2be1f09a301131b1a29b939e797d6c/django%2Futils%2Ftimesince.py",
            "raw_url": "https://github.com/django/django/raw/1e28567e0d2be1f09a301131b1a29b939e797d6c/django%2Futils%2Ftimesince.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimesince.py?ref=1e28567e0d2be1f09a301131b1a29b939e797d6c",
            "patch": "@@ -3,7 +3,7 @@\n from django.utils.timezone import is_aware, utc\n from django.utils.translation import ungettext, ugettext\n \n-def timesince(d, now=None):\n+def timesince(d, now=None, reversed=False):\n     \"\"\"\n     Takes two datetime objects and returns the time between d and now\n     as a nicely formatted string, e.g. \"10 minutes\".  If d occurs after now,\n@@ -33,7 +33,7 @@ def timesince(d, now=None):\n     if not now:\n         now = datetime.datetime.now(utc if is_aware(d) else None)\n \n-    delta = now - d\n+    delta = (d - now) if reversed else (now - d)\n     # ignore microseconds\n     since = delta.days * 24 * 60 * 60 + delta.seconds\n     if since <= 0:\n@@ -57,6 +57,4 @@ def timeuntil(d, now=None):\n     Like timesince, but returns a string measuring the time until\n     the given time.\n     \"\"\"\n-    if not now:\n-        now = datetime.datetime.now(utc if is_aware(d) else None)\n-    return timesince(now, d)\n+    return timesince(d, now, reversed=True)"
        },
        {
            "sha": "a4d479ad3e7f5f019c7263512972c35bafb32340",
            "filename": "tests/regressiontests/utils/timesince.py",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/1e28567e0d2be1f09a301131b1a29b939e797d6c/tests%2Fregressiontests%2Futils%2Ftimesince.py",
            "raw_url": "https://github.com/django/django/raw/1e28567e0d2be1f09a301131b1a29b939e797d6c/tests%2Fregressiontests%2Futils%2Ftimesince.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftimesince.py?ref=1e28567e0d2be1f09a301131b1a29b939e797d6c",
            "patch": "@@ -99,12 +99,18 @@ def test_different_timezones(self):\n         self.assertEqual(timesince(now_tz), u'0 minutes')\n         self.assertEqual(timeuntil(now_tz, now_tz_i), u'0 minutes')\n \n+    def test_date_objects(self):\n+        \"\"\" Both timesince and timeuntil should work on date objects (#17937). \"\"\"\n+        today = datetime.date.today()\n+        self.assertEqual(timesince(today + self.oneday), u'0 minutes')\n+        self.assertEqual(timeuntil(today - self.oneday), u'0 minutes')\n+\n     def test_both_date_objects(self):\n         \"\"\" Timesince should work with both date objects (#9672) \"\"\"\n         today = datetime.date.today()\n-        self.assertEqual(timeuntil(today+self.oneday, today), u'1 day')\n-        self.assertEqual(timeuntil(today-self.oneday, today), u'0 minutes')\n-        self.assertEqual(timeuntil(today+self.oneweek, today), u'1 week')\n+        self.assertEqual(timeuntil(today + self.oneday, today), u'1 day')\n+        self.assertEqual(timeuntil(today - self.oneday, today), u'0 minutes')\n+        self.assertEqual(timeuntil(today + self.oneweek, today), u'1 week')\n \n     def test_naive_datetime_with_tzinfo_attribute(self):\n         class naive(datetime.tzinfo):"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 12,
        "deletions": 8
    }
}