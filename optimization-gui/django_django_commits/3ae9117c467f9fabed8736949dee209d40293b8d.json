{
    "author": "SmileyChris",
    "message": "Fixes #7817 and #9456.\n\n- The include tag now has a 'with' option to include to provide extra context\n  vairables to the included template.\n\n- The include tag now has an 'only' option to exclude the current context\n  when rendering the included template.\n\n- The with tag now accepts multiple variable assignments.\n\n- The with, include and blocktrans tags now use a new keyword argument format\n  for variable assignments (e.g. `{% with foo=1 bar=2 %}`).\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14922 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3ae9117c467f9fabed8736949dee209d40293b8d",
    "files": [
        {
            "sha": "0662b5f2e77625c1bfb5872bca7009befe1b44e9",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 85,
            "deletions": 17,
            "changes": 102,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -16,6 +16,55 @@\n # Regex for token keyword arguments\n kwarg_re = re.compile(r\"(?:(\\w+)=)?(.+)\")\n \n+def token_kwargs(bits, parser, support_legacy=False):\n+    \"\"\"\n+    A utility method for parsing token keyword arguments.\n+\n+    :param bits: A list containing remainder of the token (split by spaces)\n+        that is to be checked for arguments. Valid arguments will be removed\n+        from this list.\n+\n+    :param support_legacy: If set to true ``True``, the legacy format\n+        ``1 as foo`` will be accepted. Otherwise, only the standard ``foo=1``\n+        format is allowed.\n+\n+    :returns: A dictionary of the arguments retrieved from the ``bits`` token\n+        list.\n+\n+    There is no requirement for all remaining token ``bits`` to be keyword\n+    arguments, so the dictionary will be returned as soon as an invalid\n+    argument format is reached.\n+    \"\"\"\n+    if not bits:\n+        return {}\n+    match = kwarg_re.match(bits[0])\n+    kwarg_format = match and match.group(1)\n+    if not kwarg_format:\n+        if not support_legacy:\n+            return {}\n+        if len(bits) < 3 or bits[1] != 'as':\n+            return {}\n+\n+    kwargs = {}\n+    while bits:\n+        if kwarg_format: \n+            match = kwarg_re.match(bits[0])\n+            if not match or not match.group(1):\n+                return kwargs\n+            key, value = match.groups()\n+            del bits[:1]\n+        else:\n+            if len(bits) < 3 or bits[1] != 'as':\n+                return kwargs\n+            key, value = bits[2], bits[0]\n+            del bits[:3]\n+        kwargs[key] = parser.compile_filter(value)\n+        if bits and not kwarg_format:\n+            if bits[0] != 'and':\n+                return kwargs\n+            del bits[:1]\n+    return kwargs\n+\n class AutoEscapeControlNode(Node):\n     \"\"\"Implements the actions of the autoescape tag.\"\"\"\n     def __init__(self, setting, nodelist):\n@@ -298,7 +347,7 @@ def __init__(self, filepath, parsed, legacy_filepath=True):\n     def render(self, context):\n         filepath = self.filepath\n         if not self.legacy_filepath:\n-           filepath = filepath.resolve(context)\n+            filepath = filepath.resolve(context)\n \n         if not include_is_allowed(filepath):\n             if settings.DEBUG:\n@@ -433,18 +482,25 @@ def render(self, context):\n         return str(int(round(ratio)))\n \n class WithNode(Node):\n-    def __init__(self, var, name, nodelist):\n-        self.var = var\n-        self.name = name\n+    def __init__(self, var, name, nodelist, extra_context=None,\n+                 isolated_context=False):\n         self.nodelist = nodelist\n+        # var and name are legacy attributes, being left in case they are used\n+        # by third-party subclasses of this Node.\n+        self.extra_context = extra_context or {}\n+        if name:\n+            self.extra_context[name] = var\n+        self.isolated_context = isolated_context\n \n     def __repr__(self):\n         return \"<WithNode>\"\n \n     def render(self, context):\n-        val = self.var.resolve(context)\n-        context.push()\n-        context[self.name] = val\n+        values = dict([(key, val.resolve(context)) for key, val in\n+                       self.extra_context.iteritems()])\n+        if self.isolated_context:\n+            return self.nodelist.render(Context(values))\n+        context.update(values)\n         output = self.nodelist.render(context)\n         context.pop()\n         return output\n@@ -1276,22 +1332,34 @@ def widthratio(parser, token):\n #@register.tag\n def do_with(parser, token):\n     \"\"\"\n-    Adds a value to the context (inside of this block) for caching and easy\n-    access.\n+    Adds one or more values to the context (inside of this block) for caching\n+    and easy access.\n \n     For example::\n \n-        {% with person.some_sql_method as total %}\n+        {% with total=person.some_sql_method %}\n             {{ total }} object{{ total|pluralize }}\n         {% endwith %}\n+\n+    Multiple values can be added to the context::\n+\n+        {% with foo=1 bar=2 %}\n+            ...\n+        {% endwith %}\n+\n+    The legacy format of ``{% with person.some_sql_method as total %}`` is\n+    still accepted.\n     \"\"\"\n-    bits = list(token.split_contents())\n-    if len(bits) != 4 or bits[2] != \"as\":\n-        raise TemplateSyntaxError(\"%r expected format is 'value as name'\" %\n-                                  bits[0])\n-    var = parser.compile_filter(bits[1])\n-    name = bits[3]\n+    bits = token.split_contents()\n+    remaining_bits = bits[1:]\n+    extra_context = token_kwargs(remaining_bits, parser, support_legacy=True)\n+    if not extra_context:\n+        raise TemplateSyntaxError(\"%r expected at least one variable \"\n+                                  \"assignment\" % bits[0])\n+    if remaining_bits:\n+        raise TemplateSyntaxError(\"%r received an invalid token: %r\" %\n+                                  (bits[0], remaining_bits[0]))\n     nodelist = parser.parse(('endwith',))\n     parser.delete_first_token()\n-    return WithNode(var, name, nodelist)\n+    return WithNode(None, None, nodelist, extra_context=extra_context)\n do_with = register.tag('with', do_with)"
        },
        {
            "sha": "55b3ede02abe0c1c376b07ce8a5915c0386ee6d3",
            "filename": "django/template/loader_tags.py",
            "status": "modified",
            "additions": 65,
            "deletions": 16,
            "changes": 81,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/django%2Ftemplate%2Floader_tags.py",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/django%2Ftemplate%2Floader_tags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floader_tags.py?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -1,5 +1,7 @@\n from django.template.base import TemplateSyntaxError, TemplateDoesNotExist, Variable\n from django.template.base import Library, Node, TextNode\n+from django.template.context import Context\n+from django.template.defaulttags import token_kwargs\n from django.template.loader import get_template\n from django.conf import settings\n from django.utils.safestring import mark_safe\n@@ -124,8 +126,25 @@ def render(self, context):\n         # the same.\n         return compiled_parent._render(context)\n \n-class ConstantIncludeNode(Node):\n-    def __init__(self, template_path):\n+class BaseIncludeNode(Node):\n+    def __init__(self, *args, **kwargs):\n+        self.extra_context = kwargs.pop('extra_context', {})\n+        self.isolated_context = kwargs.pop('isolated_context', False)\n+        super(BaseIncludeNode, self).__init__(*args, **kwargs)\n+\n+    def render_template(self, template, context):\n+        values = dict([(name, var.resolve(context)) for name, var\n+                       in self.extra_context.iteritems()])\n+        if self.isolated_context:\n+            return template.render(Context(values))\n+        context.update(values)\n+        output = template.render(context)\n+        context.pop()\n+        return output\n+\n+class ConstantIncludeNode(BaseIncludeNode):\n+    def __init__(self, template_path, *args, **kwargs):\n+        super(ConstantIncludeNode, self).__init__(*args, **kwargs)\n         try:\n             t = get_template(template_path)\n             self.template = t\n@@ -135,21 +154,21 @@ def __init__(self, template_path):\n             self.template = None\n \n     def render(self, context):\n-        if self.template:\n-            return self.template.render(context)\n-        else:\n+        if not self.template:\n             return ''\n+        return self.render_template(self.template, context)\n \n-class IncludeNode(Node):\n-    def __init__(self, template_name):\n-        self.template_name = Variable(template_name)\n+class IncludeNode(BaseIncludeNode):\n+    def __init__(self, template_name, *args, **kwargs):\n+        super(IncludeNode, self).__init__(*args, **kwargs)\n+        self.template_name = template_name\n \n     def render(self, context):\n         try:\n             template_name = self.template_name.resolve(context)\n-            t = get_template(template_name)\n-            return t.render(context)\n-        except TemplateSyntaxError, e:\n+            template = get_template(template_name)\n+            return self.render_template(template, context)\n+        except TemplateSyntaxError:\n             if settings.TEMPLATE_DEBUG:\n                 raise\n             return ''\n@@ -201,19 +220,49 @@ def do_extends(parser, token):\n \n def do_include(parser, token):\n     \"\"\"\n-    Loads a template and renders it with the current context.\n+    Loads a template and renders it with the current context. You can pass\n+    additional context using keyword arguments.\n \n     Example::\n \n         {% include \"foo/some_include\" %}\n+        {% include \"foo/some_include\" with bar=\"BAZZ!\" baz=\"BING!\" %}\n+\n+    Use the ``only`` argument to exclude the current context when rendering\n+    the included template::\n+\n+        {% include \"foo/some_include\" only %}\n+        {% include \"foo/some_include\" with bar=\"1\" only %}\n     \"\"\"\n     bits = token.split_contents()\n-    if len(bits) != 2:\n-        raise TemplateSyntaxError(\"%r tag takes one argument: the name of the template to be included\" % bits[0])\n+    if len(bits) < 2:\n+        raise TemplateSyntaxError(\"%r tag takes at least one argument: the name of the template to be included.\" % bits[0])\n+    options = {}\n+    remaining_bits = bits[2:]\n+    while remaining_bits:\n+        option = remaining_bits.pop(0)\n+        if option in options:\n+            raise TemplateSyntaxError('The %r option was specified more '\n+                                      'than once.' % option)\n+        if option == 'with':\n+            value = token_kwargs(remaining_bits, parser, support_legacy=False)\n+            if not value:\n+                raise TemplateSyntaxError('\"with\" in %r tag needs at least '\n+                                          'one keyword argument.' % bits[0])\n+        elif option == 'only':\n+            value = True\n+        else:\n+            raise TemplateSyntaxError('Unknown argument for %r tag: %r.' %\n+                                      (bits[0], option))\n+        options[option] = value\n+    isolated_context = options.get('only', False)\n+    namemap = options.get('with', {})\n     path = bits[1]\n     if path[0] in ('\"', \"'\") and path[-1] == path[0]:\n-        return ConstantIncludeNode(path[1:-1])\n-    return IncludeNode(bits[1])\n+        return ConstantIncludeNode(path[1:-1], extra_context=namemap,\n+                                   isolated_context=isolated_context)\n+    return IncludeNode(parser.compile_filter(bits[1]), extra_context=namemap,\n+                       isolated_context=isolated_context)\n \n register.tag('block', do_block)\n register.tag('extends', do_extends)"
        },
        {
            "sha": "0cb7e6a1e0f149218319afd1f013cfe15ec3e83e",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 38,
            "deletions": 26,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -6,6 +6,7 @@\n from django.template.base import _render_value_in_context\n from django.utils import translation\n from django.utils.encoding import force_unicode\n+from django.template.defaulttags import token_kwargs\n \n register = Library()\n \n@@ -97,7 +98,7 @@ def render_token_list(self, tokens):\n     def render(self, context):\n         tmp_context = {}\n         for var, val in self.extra_context.items():\n-            tmp_context[var] = val.render(context)\n+            tmp_context[var] = val.resolve(context)\n         # Update() works like a push(), so corresponding context.pop() is at\n         # the end of function\n         context.update(tmp_context)\n@@ -284,43 +285,54 @@ def do_block_translate(parser, token):\n \n     Usage::\n \n-        {% blocktrans with foo|filter as bar and baz|filter as boo %}\n+        {% blocktrans with bar=foo|filter boo=baz|filter %}\n         This is {{ bar }} and {{ boo }}.\n         {% endblocktrans %}\n \n     Additionally, this supports pluralization::\n \n-        {% blocktrans count var|length as count %}\n+        {% blocktrans count count=var|length %}\n         There is {{ count }} object.\n         {% plural %}\n         There are {{ count }} objects.\n         {% endblocktrans %}\n \n     This is much like ngettext, only in template syntax.\n-    \"\"\"\n-    class BlockTranslateParser(TokenParser):\n-        def top(self):\n-            countervar = None\n-            counter = None\n-            extra_context = {}\n-            while self.more():\n-                tag = self.tag()\n-                if tag == 'with' or tag == 'and':\n-                    value = self.value()\n-                    if self.tag() != 'as':\n-                        raise TemplateSyntaxError(\"variable bindings in 'blocktrans' must be 'with value as variable'\")\n-                    extra_context[self.tag()] = VariableNode(\n-                            parser.compile_filter(value))\n-                elif tag == 'count':\n-                    counter = parser.compile_filter(self.value())\n-                    if self.tag() != 'as':\n-                        raise TemplateSyntaxError(\"counter specification in 'blocktrans' must be 'count value as variable'\")\n-                    countervar = self.tag()\n-                else:\n-                    raise TemplateSyntaxError(\"unknown subtag %s for 'blocktrans' found\" % tag)\n-            return (countervar, counter, extra_context)\n \n-    countervar, counter, extra_context = BlockTranslateParser(token.contents).top()\n+    The \"var as value\" legacy format is still supported::\n+\n+        {% blocktrans with foo|filter as bar and baz|filter as boo %}\n+        {% blocktrans count var|length as count %}\n+    \"\"\"\n+    bits = token.split_contents()\n+\n+    options = {}\n+    remaining_bits = bits[1:]\n+    while remaining_bits:\n+        option = remaining_bits.pop(0)\n+        if option in options:\n+            raise TemplateSyntaxError('The %r option was specified more '\n+                                      'than once.' % option)\n+        if option == 'with':\n+            value = token_kwargs(remaining_bits, parser, support_legacy=True)\n+            if not value:\n+                raise TemplateSyntaxError('\"with\" in %r tag needs at least '\n+                                          'one keyword argument.' % bits[0])\n+        elif option == 'count':\n+            value = token_kwargs(remaining_bits, parser, support_legacy=True)\n+            if len(value) != 1:\n+                raise TemplateSyntaxError('\"count\" in %r tag expected exactly '\n+                                          'one keyword argument.' % bits[0])\n+        else:\n+            raise TemplateSyntaxError('Unknown argument for %r tag: %r.' %\n+                                      (bits[0], option))\n+        options[option] = value\n+\n+    if 'count' in options:\n+        countervar, counter = options['count'].items()[0]\n+    else:\n+        countervar, counter = None, None\n+    extra_context = options.get('with', {}) \n \n     singular = []\n     plural = []"
        },
        {
            "sha": "0dc0372d59eddb5b27adf657a03737771359dc61",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 27,
            "deletions": 3,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -639,9 +639,19 @@ including it. This example produces the output ``\"Hello, John\"``:\n \n     * The ``name_snippet.html`` template::\n \n-        Hello, {{ person }}\n+        {{ greeting }}, {{ person|default:\"friend\" }}!\n \n-See also: ``{% ssi %}``.\n+.. versionchanged:: 1.3\n+   Additional context and exclusive context.\n+\n+You can pass additional context to the template using keyword arguments::\n+\n+    {% include \"name_snippet.html\" with person=\"Jane\" greeting=\"Hello\" \"%}\n+\n+If you want to only render the context with the variables provided (or even\n+no variables at all), use the ``only`` option::\n+\n+    {% include \"name_snippet.html\" with greeting=\"Hi\" only %}\n \n .. note::\n     The :ttag:`include` tag should be considered as an implementation of\n@@ -650,6 +660,8 @@ See also: ``{% ssi %}``.\n     This means that there is no shared state between included templates --\n     each include is a completely independent rendering process.\n \n+See also: ``{% ssi %}``.\n+\n .. templatetag:: load\n \n load\n@@ -1044,18 +1056,30 @@ with\n \n .. versionadded:: 1.0\n \n+.. versionchanged:: 1.3\n+   New keyword argument format and multiple variable assignments.\n+\n Caches a complex variable under a simpler name. This is useful when accessing\n an \"expensive\" method (e.g., one that hits the database) multiple times.\n \n For example::\n \n-    {% with business.employees.count as total %}\n+    {% with total=business.employees.count %}\n         {{ total }} employee{{ total|pluralize }}\n     {% endwith %}\n \n The populated variable (in the example above, ``total``) is only available\n between the ``{% with %}`` and ``{% endwith %}`` tags.\n \n+You can assign more than one context variable::\n+\n+    {% with alpha=1 beta=2 %}\n+        ...\n+    {% endwith %}\n+\n+.. note:: The previous more verbose format is still supported:\n+   ``{% with business.employees.count as total %}``\n+\n .. _ref-templates-builtins-filters:\n \n Built-in filter reference"
        },
        {
            "sha": "ec5b6fa1603a4d5920e1cc86969d9c5fe88e74c5",
            "filename": "docs/topics/db/optimization.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Foptimization.txt?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -206,7 +206,7 @@ many-to-many relation to User, the following template code is optimal:\n .. code-block:: html+django\n \n    {% if display_inbox %}\n-     {% with user.emails.all as emails %}\n+     {% with emails=user.emails.all %}\n        {% if emails %}\n          <p>You have {{ emails|length }} email(s)</p>\n          {% for email in emails %}"
        },
        {
            "sha": "fc19ff63efdc074b4e9eeeed068aaac5c10b4d00",
            "filename": "docs/topics/forms/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Ftopics%2Fforms%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Ftopics%2Fforms%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Findex.txt?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -371,12 +371,11 @@ using the :ttag:`include` tag to reuse it in other templates::\n     {% endfor %}\n \n If the form object passed to a template has a different name within the\n-context, you can alias it using the :ttag:`with` tag::\n+context, you can alias it using the ``with`` argument of the :ttag:`include`\n+tag::\n \n     <form action=\"/comments/add/\" method=\"post\">\n-        {% with comment_form as form %}\n-            {% include \"form_snippet.html\" %}\n-        {% endwith %}\n+        {% include \"form_snippet.html\" with form=comment_form %}\n         <p><input type=\"submit\" value=\"Submit comment\" /></p>\n     </form>\n "
        },
        {
            "sha": "cf009e424447014218fcc2bea6a4c8eb7ac59fe4",
            "filename": "docs/topics/i18n/internationalization.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Finternationalization.txt?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -438,6 +438,9 @@ It's not possible to mix a template variable inside a string within ``{% trans\n ``blocktrans`` template tag\n ---------------------------\n \n+.. versionchanged:: 1.3\n+   New keyword argument format.\n+\n Contrarily to the ``trans`` tag, the ``blocktrans`` tag allows you to mark\n complex sentences consisting of literals and variable content for translation\n by making use of placeholders::\n@@ -448,18 +451,18 @@ To translate a template expression -- say, accessing object attributes or\n using template filters -- you need to bind the expression to a local variable\n for use within the translation block. Examples::\n \n-    {% blocktrans with article.price as amount %}\n+    {% blocktrans with amount=article.price %}\n     That will cost $ {{ amount }}.\n     {% endblocktrans %}\n \n-    {% blocktrans with value|filter as myvar %}\n+    {% blocktrans with myvar=value|filter %}\n     This will have {{ myvar }} inside.\n     {% endblocktrans %}\n \n If you need to bind more than one expression inside a ``blocktrans`` tag,\n separate the pieces with ``and``::\n \n-    {% blocktrans with book|title as book_t and author|title as author_t %}\n+    {% blocktrans with book_t=book|title author_t=author|title %}\n     This is {{ book_t }} by {{ author_t }}\n     {% endblocktrans %}\n \n@@ -474,15 +477,15 @@ This tag also provides for pluralization. To use it:\n \n An example::\n \n-    {% blocktrans count list|length as counter %}\n+    {% blocktrans count counter=list|length %}\n     There is only one {{ name }} object.\n     {% plural %}\n     There are {{ counter }} {{ name }} objects.\n     {% endblocktrans %}\n \n A more complex example::\n \n-    {% blocktrans with article.price as amount count i.length as years %}\n+    {% blocktrans with amount=article.price count years=i.length %}\n     That will cost $ {{ amount }} per year.\n     {% plural %}\n     That will cost $ {{ amount }} per {{ years }} years.\n@@ -494,6 +497,9 @@ construct is internally converted to an ``ungettext`` call. This means the\n same :ref:`notes regarding ungettext variables <pluralization-var-notes>`\n apply.\n \n+.. note:: The previous more verbose format is still supported:\n+   ``{% blocktrans with book|title as book_t and author|title as author_t %}``\n+\n .. _template-translation-vars:\n \n Other tags"
        },
        {
            "sha": "d363f50e6a1e53fd2fe2b5b5fdc8cc474878c0b2",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 44,
            "deletions": 11,
            "changes": 55,
            "blob_url": "https://github.com/django/django/blob/3ae9117c467f9fabed8736949dee209d40293b8d/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3ae9117c467f9fabed8736949dee209d40293b8d/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=3ae9117c467f9fabed8736949dee209d40293b8d",
            "patch": "@@ -930,14 +930,31 @@ def get_template_tests(self):\n             'ifnotequal03': (\"{% ifnotequal a b %}yes{% else %}no{% endifnotequal %}\", {\"a\": 1, \"b\": 2}, \"yes\"),\n             'ifnotequal04': (\"{% ifnotequal a b %}yes{% else %}no{% endifnotequal %}\", {\"a\": 1, \"b\": 1}, \"no\"),\n \n-            ### INCLUDE TAG ###########################################################\n+            ## INCLUDE TAG ###########################################################\n             'include01': ('{% include \"basic-syntax01\" %}', {}, \"something cool\"),\n             'include02': ('{% include \"basic-syntax02\" %}', {'headline': 'Included'}, \"Included\"),\n             'include03': ('{% include template_name %}', {'template_name': 'basic-syntax02', 'headline': 'Included'}, \"Included\"),\n             'include04': ('a{% include \"nonexistent\" %}b', {}, \"ab\"),\n             'include 05': ('template with a space', {}, 'template with a space'),\n             'include06': ('{% include \"include 05\"%}', {}, 'template with a space'),\n \n+            # extra inline context\n+            'include07': ('{% include \"basic-syntax02\" with headline=\"Inline\" %}', {'headline': 'Included'}, 'Inline'),\n+            'include08': ('{% include headline with headline=\"Dynamic\" %}', {'headline': 'basic-syntax02'}, 'Dynamic'),\n+            'include09': ('{{ first }}--{% include \"basic-syntax03\" with first=second|lower|upper second=first|upper %}--{{ second }}', {'first': 'Ul', 'second': 'lU'}, 'Ul--LU --- UL--lU'),\n+\n+            # isolated context\n+            'include10': ('{% include \"basic-syntax03\" only %}', {'first': '1'}, (' --- ', 'INVALID --- INVALID')),\n+            'include11': ('{% include \"basic-syntax03\" only with second=2 %}', {'first': '1'}, (' --- 2', 'INVALID --- 2')),\n+            'include12': ('{% include \"basic-syntax03\" with first=1 only %}', {'second': '2'}, ('1 --- ', '1 --- INVALID')),\n+\n+            'include-error01': ('{% include \"basic-syntax01\" with %}', {}, template.TemplateSyntaxError),\n+            'include-error02': ('{% include \"basic-syntax01\" with \"no key\" %}', {}, template.TemplateSyntaxError),\n+            'include-error03': ('{% include \"basic-syntax01\" with dotted.arg=\"error\" %}', {}, template.TemplateSyntaxError),\n+            'include-error04': ('{% include \"basic-syntax01\" something_random %}', {}, template.TemplateSyntaxError),\n+            'include-error05': ('{% include \"basic-syntax01\" foo=\"duplicate\" foo=\"key\" %}', {}, template.TemplateSyntaxError),\n+            'include-error06': ('{% include \"basic-syntax01\" only only %}', {}, template.TemplateSyntaxError),\n+\n             ### NAMED ENDBLOCKS #######################################################\n \n             # Basic test\n@@ -1098,7 +1115,8 @@ def get_template_tests(self):\n             'i18n03': ('{% load i18n %}{% blocktrans %}{{ anton }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u\"Å\"),\n \n             # simple translation of a variable and filter\n-            'i18n04': ('{% load i18n %}{% blocktrans with anton|lower as berta %}{{ berta }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u'å'),\n+            'i18n04': ('{% load i18n %}{% blocktrans with berta=anton|lower %}{{ berta }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u'å'),\n+            'legacyi18n04': ('{% load i18n %}{% blocktrans with anton|lower as berta %}{{ berta }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u'å'),\n \n             # simple translation of a string with interpolation\n             'i18n05': ('{% load i18n %}{% blocktrans %}xxx{{ anton }}xxx{% endblocktrans %}', {'anton': 'yyy'}, \"xxxyyyxxx\"),\n@@ -1107,10 +1125,12 @@ def get_template_tests(self):\n             'i18n06': ('{% load i18n %}{% trans \"Page not found\" %}', {'LANGUAGE_CODE': 'de'}, \"Seite nicht gefunden\"),\n \n             # translation of singular form\n-            'i18n07': ('{% load i18n %}{% blocktrans count number as counter %}singular{% plural %}{{ counter }} plural{% endblocktrans %}', {'number': 1}, \"singular\"),\n+            'i18n07': ('{% load i18n %}{% blocktrans count counter=number %}singular{% plural %}{{ counter }} plural{% endblocktrans %}', {'number': 1}, \"singular\"),\n+            'legacyi18n07': ('{% load i18n %}{% blocktrans count number as counter %}singular{% plural %}{{ counter }} plural{% endblocktrans %}', {'number': 1}, \"singular\"),\n \n             # translation of plural form\n             'i18n08': ('{% load i18n %}{% blocktrans count number as counter %}singular{% plural %}{{ counter }} plural{% endblocktrans %}', {'number': 2}, \"2 plural\"),\n+            'legacyi18n08': ('{% load i18n %}{% blocktrans count counter=number %}singular{% plural %}{{ counter }} plural{% endblocktrans %}', {'number': 2}, \"2 plural\"),\n \n             # simple non-translation (only marking) of a string to german\n             'i18n09': ('{% load i18n %}{% trans \"Page not found\" noop %}', {'LANGUAGE_CODE': 'de'}, \"Page not found\"),\n@@ -1132,23 +1152,31 @@ def get_template_tests(self):\n \n             # Escaping inside blocktrans and trans works as if it was directly in the\n             # template.\n-            'i18n17': ('{% load i18n %}{% blocktrans with anton|escape as berta %}{{ berta }}{% endblocktrans %}', {'anton': 'α & β'}, u'α &amp; β'),\n-            'i18n18': ('{% load i18n %}{% blocktrans with anton|force_escape as berta %}{{ berta }}{% endblocktrans %}', {'anton': 'α & β'}, u'α &amp; β'),\n+            'i18n17': ('{% load i18n %}{% blocktrans with berta=anton|escape %}{{ berta }}{% endblocktrans %}', {'anton': 'α & β'}, u'α &amp; β'),\n+            'i18n18': ('{% load i18n %}{% blocktrans with berta=anton|force_escape %}{{ berta }}{% endblocktrans %}', {'anton': 'α & β'}, u'α &amp; β'),\n             'i18n19': ('{% load i18n %}{% blocktrans %}{{ andrew }}{% endblocktrans %}', {'andrew': 'a & b'}, u'a &amp; b'),\n             'i18n20': ('{% load i18n %}{% trans andrew %}', {'andrew': 'a & b'}, u'a &amp; b'),\n             'i18n21': ('{% load i18n %}{% blocktrans %}{{ andrew }}{% endblocktrans %}', {'andrew': mark_safe('a & b')}, u'a & b'),\n             'i18n22': ('{% load i18n %}{% trans andrew %}', {'andrew': mark_safe('a & b')}, u'a & b'),\n+            'legacyi18n17': ('{% load i18n %}{% blocktrans with anton|escape as berta %}{{ berta }}{% endblocktrans %}', {'anton': 'α & β'}, u'α &amp; β'),\n+            'legacyi18n18': ('{% load i18n %}{% blocktrans with anton|force_escape as berta %}{{ berta }}{% endblocktrans %}', {'anton': 'α & β'}, u'α &amp; β'),\n \n             # Use filters with the {% trans %} tag, #5972\n             'i18n23': ('{% load i18n %}{% trans \"Page not found\"|capfirst|slice:\"6:\" %}', {'LANGUAGE_CODE': 'de'}, u'nicht gefunden'),\n             'i18n24': (\"{% load i18n %}{% trans 'Page not found'|upper %}\", {'LANGUAGE_CODE': 'de'}, u'SEITE NICHT GEFUNDEN'),\n             'i18n25': ('{% load i18n %}{% trans somevar|upper %}', {'somevar': 'Page not found', 'LANGUAGE_CODE': 'de'}, u'SEITE NICHT GEFUNDEN'),\n \n             # translation of plural form with extra field in singular form (#13568)\n-            'i18n26': ('{% load i18n %}{% blocktrans with myextra_field as extra_field count number as counter %}singular {{ extra_field }}{% plural %}plural{% endblocktrans %}', {'number': 1, 'myextra_field': 'test'}, \"singular test\"),\n+            'i18n26': ('{% load i18n %}{% blocktrans with extra_field=myextra_field count counter=number %}singular {{ extra_field }}{% plural %}plural{% endblocktrans %}', {'number': 1, 'myextra_field': 'test'}, \"singular test\"),\n+            'legacyi18n26': ('{% load i18n %}{% blocktrans with myextra_field as extra_field count number as counter %}singular {{ extra_field }}{% plural %}plural{% endblocktrans %}', {'number': 1, 'myextra_field': 'test'}, \"singular test\"),\n \n             # translation of singular form in russian (#14126)\n-            'i18n27': ('{% load i18n %}{% blocktrans count number as counter %}1 result{% plural %}{{ counter }} results{% endblocktrans %}', {'number': 1, 'LANGUAGE_CODE': 'ru'}, u'1 \\u0440\\u0435\\u0437\\u0443\\u043b\\u044c\\u0442\\u0430\\u0442'),\n+            'i18n27': ('{% load i18n %}{% blocktrans count counter=number %}1 result{% plural %}{{ counter }} results{% endblocktrans %}', {'number': 1, 'LANGUAGE_CODE': 'ru'}, u'1 \\u0440\\u0435\\u0437\\u0443\\u043b\\u044c\\u0442\\u0430\\u0442'),\n+            'legacyi18n27': ('{% load i18n %}{% blocktrans count number as counter %}1 result{% plural %}{{ counter }} results{% endblocktrans %}', {'number': 1, 'LANGUAGE_CODE': 'ru'}, u'1 \\u0440\\u0435\\u0437\\u0443\\u043b\\u044c\\u0442\\u0430\\u0442'),\n+\n+            # simple translation of multiple variables\n+            'i18n28': ('{% load i18n %}{% blocktrans with a=anton b=berta %}{{ a }} + {{ b }}{% endblocktrans %}', {'anton': 'α', 'berta': 'β'}, u'α + β'),\n+            'legacyi18n28': ('{% load i18n %}{% blocktrans with anton as a and berta as b %}{{ a }} + {{ b }}{% endblocktrans %}', {'anton': 'α', 'berta': 'β'}, u'α + β'),\n \n             # retrieving language information\n             'i18n28': ('{% load i18n %}{% get_language_info for \"de\" as l %}{{ l.code }}: {{ l.name }}/{{ l.name_local }} bidi={{ l.bidi }}', {}, 'de: German/Deutsch bidi=False'),\n@@ -1273,11 +1301,16 @@ def get_template_tests(self):\n             'widthratio11': ('{% widthratio a b c %}', {'a':50,'b':100, 'c': 100}, '50'),\n \n             ### WITH TAG ########################################################\n-            'with01': ('{% with dict.key as key %}{{ key }}{% endwith %}', {'dict': {'key':50}}, '50'),\n-            'with02': ('{{ key }}{% with dict.key as key %}{{ key }}-{{ dict.key }}-{{ key }}{% endwith %}{{ key }}', {'dict': {'key':50}}, ('50-50-50', 'INVALID50-50-50INVALID')),\n+            'with01': ('{% with key=dict.key %}{{ key }}{% endwith %}', {'dict': {'key': 50}}, '50'),\n+            'legacywith01': ('{% with dict.key as key %}{{ key }}{% endwith %}', {'dict': {'key': 50}}, '50'),\n+\n+            'with02': ('{{ key }}{% with key=dict.key %}{{ key }}-{{ dict.key }}-{{ key }}{% endwith %}{{ key }}', {'dict': {'key': 50}}, ('50-50-50', 'INVALID50-50-50INVALID')),\n+            'legacywith02': ('{{ key }}{% with dict.key as key %}{{ key }}-{{ dict.key }}-{{ key }}{% endwith %}{{ key }}', {'dict': {'key': 50}}, ('50-50-50', 'INVALID50-50-50INVALID')),\n+\n+            'with03': ('{% with a=alpha b=beta %}{{ a }}{{ b }}{% endwith %}', {'alpha': 'A', 'beta': 'B'}, 'AB'),\n \n-            'with-error01': ('{% with dict.key xx key %}{{ key }}{% endwith %}', {'dict': {'key':50}}, template.TemplateSyntaxError),\n-            'with-error02': ('{% with dict.key as %}{{ key }}{% endwith %}', {'dict': {'key':50}}, template.TemplateSyntaxError),\n+            'with-error01': ('{% with dict.key xx key %}{{ key }}{% endwith %}', {'dict': {'key': 50}}, template.TemplateSyntaxError),\n+            'with-error02': ('{% with dict.key as %}{{ key }}{% endwith %}', {'dict': {'key': 50}}, template.TemplateSyntaxError),\n \n             ### NOW TAG ########################################################\n             # Simple case"
        }
    ],
    "stats": {
        "total": 357,
        "additions": 274,
        "deletions": 83
    }
}