{
    "author": "SmileyChris",
    "message": "Fixes #11596 -- Make paginator.Page iterable\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16018 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4fa96467164d738c6f8a9c59423382257f95b747",
    "files": [
        {
            "sha": "9f3981370460972df443728d05390088792d1738",
            "filename": "django/core/paginator.py",
            "status": "modified",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/4fa96467164d738c6f8a9c59423382257f95b747/django%2Fcore%2Fpaginator.py",
            "raw_url": "https://github.com/django/django/raw/4fa96467164d738c6f8a9c59423382257f95b747/django%2Fcore%2Fpaginator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fpaginator.py?ref=4fa96467164d738c6f8a9c59423382257f95b747",
            "patch": "@@ -1,4 +1,5 @@\n from math import ceil\n+import collections\n \n class InvalidPage(Exception):\n     pass\n@@ -84,6 +85,44 @@ def __init__(self, object_list, number, paginator):\n     def __repr__(self):\n         return '<Page %s of %s>' % (self.number, self.paginator.num_pages)\n \n+    def __len__(self):\n+        return len(self.object_list)\n+\n+    def __getitem__(self, index):\n+        # The object_list is converted to a list so that if it was a QuerySet\n+        # it won't be a database hit per __getitem__.\n+        return list(self.object_list)[index]\n+\n+    # The following four methods are only necessary for Python <2.6\n+    # compatibility (this class could just extend 2.6's collections.Sequence).\n+\n+    def __iter__(self):\n+        i = 0\n+        try:\n+            while True:\n+                v = self[i]\n+                yield v\n+                i += 1\n+        except IndexError:\n+            return\n+\n+    def __contains__(self, value):\n+        for v in self:\n+            if v == value:\n+                return True\n+        return False\n+\n+    def index(self, value):\n+        for i, v in enumerate(self):\n+            if v == value:\n+                return i\n+        raise ValueError\n+\n+    def count(self, value):\n+        return sum([1 for v in self if v == value])\n+\n+    # End of compatibility methods.\n+\n     def has_next(self):\n         return self.number < self.paginator.num_pages\n "
        },
        {
            "sha": "2ae3d5415eb8e5f31b55ade13f486e67d346b905",
            "filename": "docs/topics/pagination.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 10,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/4fa96467164d738c6f8a9c59423382257f95b747/docs%2Ftopics%2Fpagination.txt",
            "raw_url": "https://github.com/django/django/raw/4fa96467164d738c6f8a9c59423382257f95b747/docs%2Ftopics%2Fpagination.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fpagination.txt?ref=4fa96467164d738c6f8a9c59423382257f95b747",
            "patch": "@@ -81,30 +81,28 @@ show how you can display the results. This example assumes you have a\n \n The view function looks like this::\n \n-    from django.core.paginator import Paginator, InvalidPage, EmptyPage\n+    from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger\n \n     def listing(request):\n         contact_list = Contacts.objects.all()\n         paginator = Paginator(contact_list, 25) # Show 25 contacts per page\n \n-        # Make sure page request is an int. If not, deliver first page.\n-        try:\n-            page = int(request.GET.get('page', '1'))\n-        except ValueError:\n-            page = 1\n-\n-        # If page request (9999) is out of range, deliver last page of results.\n+        page = request.GET.get('page')\n         try:\n             contacts = paginator.page(page)\n-        except (EmptyPage, InvalidPage):\n+        except PageNotAnInteger:\n+            # If page is not an integer, deliver first page.\n+            contacts = paginator.page(1)\n+        except EmptyPage:\n+            # If page is out of range (e.g. 9999), deliver last page of results.\n             contacts = paginator.page(paginator.num_pages)\n \n         return render_to_response('list.html', {\"contacts\": contacts})\n \n In the template :file:`list.html`, you'll want to include navigation between\n pages along with any interesting information from the objects themselves::\n \n-    {% for contact in contacts.object_list %}\n+    {% for contact in contacts %}\n         {# Each \"contact\" is a Contact model object. #}\n         {{ contact.full_name|upper }}<br />\n         ...\n@@ -126,6 +124,11 @@ pages along with any interesting information from the objects themselves::\n         </span>\n     </div>\n \n+.. versionchanged:: 1.4\n+    Previously, you would need to use\n+    ``{% for contact in contacts.object_list %}``, since the ``Page``\n+    object was not iterable.\n+\n \n ``Paginator`` objects\n =====================\n@@ -194,6 +197,7 @@ Attributes\n \n     A 1-based range of page numbers, e.g., ``[1, 2, 3, 4]``.\n \n+\n ``InvalidPage`` exceptions\n ==========================\n \n@@ -221,6 +225,9 @@ them both with a simple ``except InvalidPage``.\n You usually won't construct :class:`Pages <Page>` by hand -- you'll get them\n using :meth:`Paginator.page`.\n \n+.. versionadded:: 1.4\n+    A page acts like a sequence of :attr:`Page.object_list` when using\n+    ``len()`` or iterating it directly.\n \n Methods\n -------"
        },
        {
            "sha": "f3bd0d1974c66ea841578ee0e8d3af6a3faf4174",
            "filename": "tests/regressiontests/pagination_regress/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4fa96467164d738c6f8a9c59423382257f95b747/tests%2Fregressiontests%2Fpagination_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4fa96467164d738c6f8a9c59423382257f95b747/tests%2Fregressiontests%2Fpagination_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination_regress%2Ftests.py?ref=4fa96467164d738c6f8a9c59423382257f95b747",
            "patch": "@@ -154,3 +154,15 @@ def test_page_indexes(self):\n         self.assertRaises(EmptyPage, self.check_indexes, ([], 4, 0, False), 1, None)\n         self.assertRaises(EmptyPage, self.check_indexes, ([], 4, 1, False), 1, None)\n         self.assertRaises(EmptyPage, self.check_indexes, ([], 4, 2, False), 1, None)\n+\n+    def test_page_sequence(self):\n+        \"\"\"\n+        Tests that a paginator page acts like a standard sequence.\n+        \"\"\"\n+        eleven = 'abcdefghijk'\n+        page2 = Paginator(eleven, per_page=5, orphans=1).page(2)\n+        self.assertEqual(len(page2), 6)\n+        self.assertTrue('k' in page2)\n+        self.assertFalse('a' in page2)\n+        self.assertEqual(''.join(page2), 'fghijk')\n+        self.assertEqual(''.join(reversed(page2)), 'kjihgf')"
        }
    ],
    "stats": {
        "total": 78,
        "additions": 68,
        "deletions": 10
    }
}