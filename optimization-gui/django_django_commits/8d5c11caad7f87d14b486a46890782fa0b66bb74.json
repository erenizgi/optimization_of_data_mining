{
    "author": "mjtamlyn",
    "message": "Fixed #3542 -- Add support for changing granularity on ArchiveView.\n\nResolving the concept from a very old ticket in a more class-based-view\nmanner.",
    "sha": "8d5c11caad7f87d14b486a46890782fa0b66bb74",
    "files": [
        {
            "sha": "d44246f0b7e4d771c9eda1d32d7360142c59e365",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/8d5c11caad7f87d14b486a46890782fa0b66bb74/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/8d5c11caad7f87d14b486a46890782fa0b66bb74/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=8d5c11caad7f87d14b486a46890782fa0b66bb74",
            "patch": "@@ -327,6 +327,7 @@ class BaseDateListView(MultipleObjectMixin, DateMixin, View):\n     Abstract base class for date-based views displaying a list of objects.\n     \"\"\"\n     allow_empty = False\n+    date_list_period = 'year'\n \n     def get(self, request, *args, **kwargs):\n         self.date_list, self.object_list, extra_context = self.get_dated_items()\n@@ -370,13 +371,18 @@ def get_dated_queryset(self, ordering=None, **lookup):\n \n         return qs\n \n-    def get_date_list(self, queryset, date_type):\n+    def get_date_list_period(self):\n+        return self.date_list_period\n+\n+    def get_date_list(self, queryset, date_type=None):\n         \"\"\"\n         Get a date list by calling `queryset.dates()`, checking along the way\n         for empty lists that aren't allowed.\n         \"\"\"\n         date_field = self.get_date_field()\n         allow_empty = self.get_allow_empty()\n+        if date_type is None:\n+            date_type = self.get_date_list_period()\n \n         date_list = queryset.dates(date_field, date_type)[::-1]\n         if date_list is not None and not date_list and not allow_empty:\n@@ -400,7 +406,7 @@ def get_dated_items(self):\n         Return (date_list, items, extra_context) for this request.\n         \"\"\"\n         qs = self.get_dated_queryset(ordering='-%s' % self.get_date_field())\n-        date_list = self.get_date_list(qs, 'year')\n+        date_list = self.get_date_list(qs)\n \n         if not date_list:\n             qs = qs.none()\n@@ -419,6 +425,7 @@ class BaseYearArchiveView(YearMixin, BaseDateListView):\n     \"\"\"\n     List of objects published in a given year.\n     \"\"\"\n+    date_list_period = 'month'\n     make_object_list = False\n \n     def get_dated_items(self):\n@@ -438,7 +445,7 @@ def get_dated_items(self):\n         }\n \n         qs = self.get_dated_queryset(ordering='-%s' % date_field, **lookup_kwargs)\n-        date_list = self.get_date_list(qs, 'month')\n+        date_list = self.get_date_list(qs)\n \n         if not self.get_make_object_list():\n             # We need this to be a queryset since parent classes introspect it\n@@ -470,6 +477,8 @@ class BaseMonthArchiveView(YearMixin, MonthMixin, BaseDateListView):\n     \"\"\"\n     List of objects published in a given year.\n     \"\"\"\n+    date_list_period = 'day'\n+\n     def get_dated_items(self):\n         \"\"\"\n         Return (date_list, items, extra_context) for this request.\n@@ -489,7 +498,7 @@ def get_dated_items(self):\n         }\n \n         qs = self.get_dated_queryset(**lookup_kwargs)\n-        date_list = self.get_date_list(qs, 'day')\n+        date_list = self.get_date_list(qs)\n \n         return (date_list, qs, {\n             'month': date,"
        },
        {
            "sha": "12776cbb9452046e76af5bcdbe1d6cf47c15478a",
            "filename": "docs/ref/class-based-views/generic-date-based.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/8d5c11caad7f87d14b486a46890782fa0b66bb74/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/8d5c11caad7f87d14b486a46890782fa0b66bb74/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt?ref=8d5c11caad7f87d14b486a46890782fa0b66bb74",
            "patch": "@@ -29,6 +29,9 @@ ArchiveIndexView\n \n     * Uses a default ``context_object_name`` of ``latest``.\n     * Uses a default ``template_name_suffix`` of ``_archive``.\n+    * Defaults to providing ``date_list`` by year, but this can be altered to\n+      month or day using the attribute ``date_list_period``. This also applies\n+      to all subclass views.\n \n YearArchiveView\n ---------------"
        },
        {
            "sha": "c2fa71b376a135c466f12a17749a7280c6a05277",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/8d5c11caad7f87d14b486a46890782fa0b66bb74/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/8d5c11caad7f87d14b486a46890782fa0b66bb74/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=8d5c11caad7f87d14b486a46890782fa0b66bb74",
            "patch": "@@ -60,7 +60,6 @@ def test_allow_empty_archive_view(self):\n         res = self.client.get('/dates/books/allow_empty/')\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(list(res.context['date_list']), [])\n-        self.assertEqual(list(res.context['date_list']), [])\n         self.assertTemplateUsed(res, 'generic_views/book_archive.html')\n \n     def test_archive_view_template(self):\n@@ -80,6 +79,11 @@ def test_archive_view_template_suffix(self):\n     def test_archive_view_invalid(self):\n         self.assertRaises(ImproperlyConfigured, self.client.get, '/dates/books/invalid/')\n \n+    def test_archive_view_by_month(self):\n+        res = self.client.get('/dates/books/by_month/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'month')[::-1])\n+\n     def test_paginated_archive_view(self):\n         self._make_books(20, base_date=datetime.date.today())\n         res = self.client.get('/dates/books/paginated/')"
        },
        {
            "sha": "c72bfecb65629b9ef36d366ed25ad2d3d8dada80",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/8d5c11caad7f87d14b486a46890782fa0b66bb74/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/8d5c11caad7f87d14b486a46890782fa0b66bb74/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=8d5c11caad7f87d14b486a46890782fa0b66bb74",
            "patch": "@@ -113,6 +113,8 @@\n         views.BookArchive.as_view(paginate_by=10)),\n     (r'^dates/books/reverse/$',\n         views.BookArchive.as_view(queryset=models.Book.objects.order_by('pubdate'))),\n+    (r'^dates/books/by_month/$',\n+        views.BookArchive.as_view(date_list_period='month')),\n     (r'^dates/booksignings/$',\n         views.BookSigningArchive.as_view()),\n "
        }
    ],
    "stats": {
        "total": 28,
        "additions": 23,
        "deletions": 5
    }
}