{
    "author": "apollo13",
    "message": "Fixed #18856 -- Ensured that redirects can't be poisoned by malicious users.",
    "sha": "a2f2a399566dd68ce7e312fff5a5ba857066797d",
    "files": [
        {
            "sha": "8514345d0061b291b4529d55a6dc16ceadb7c022",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 23,
            "deletions": 29,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -7,7 +7,7 @@\n from django.core.urlresolvers import reverse\n from django.http import HttpResponseRedirect, QueryDict\n from django.template.response import TemplateResponse\n-from django.utils.http import base36_to_int\n+from django.utils.http import base36_to_int, is_safe_url\n from django.utils.translation import ugettext as _\n from django.shortcuts import resolve_url\n from django.views.decorators.debug import sensitive_post_parameters\n@@ -37,18 +37,12 @@ def login(request, template_name='registration/login.html',\n     if request.method == \"POST\":\n         form = authentication_form(data=request.POST)\n         if form.is_valid():\n-            # Use default setting if redirect_to is empty\n-            if not redirect_to:\n-                redirect_to = settings.LOGIN_REDIRECT_URL\n-            redirect_to = resolve_url(redirect_to)\n-\n-            netloc = urlparse(redirect_to)[1]\n-            # Heavier security check -- don't allow redirection to a different\n-            # host.\n-            if netloc and netloc != request.get_host():\n+\n+            # Ensure the user-originating redirection url is safe.\n+            if not is_safe_url(url=redirect_to, host=request.get_host()):\n                 redirect_to = resolve_url(settings.LOGIN_REDIRECT_URL)\n \n-            # Okay, security checks complete. Log the user in.\n+            # Okay, security check complete. Log the user in.\n             auth_login(request, form.get_user())\n \n             if request.session.test_cookie_worked():\n@@ -82,27 +76,27 @@ def logout(request, next_page=None,\n     Logs out the user and displays 'You are logged out' message.\n     \"\"\"\n     auth_logout(request)\n-    redirect_to = request.REQUEST.get(redirect_field_name, '')\n-    if redirect_to:\n-        netloc = urlparse(redirect_to)[1]\n+\n+    if redirect_field_name in request.REQUEST:\n+        next_page = request.REQUEST[redirect_field_name]\n         # Security check -- don't allow redirection to a different host.\n-        if not (netloc and netloc != request.get_host()):\n-            return HttpResponseRedirect(redirect_to)\n+        if not is_safe_url(url=next_page, host=request.get_host()):\n+            next_page = request.path\n \n-    if next_page is None:\n-        current_site = get_current_site(request)\n-        context = {\n-            'site': current_site,\n-            'site_name': current_site.name,\n-            'title': _('Logged out')\n-        }\n-        if extra_context is not None:\n-            context.update(extra_context)\n-        return TemplateResponse(request, template_name, context,\n-                                current_app=current_app)\n-    else:\n+    if next_page:\n         # Redirect to this page until the session has been cleared.\n-        return HttpResponseRedirect(next_page or request.path)\n+        return HttpResponseRedirect(next_page)\n+\n+    current_site = get_current_site(request)\n+    context = {\n+        'site': current_site,\n+        'site_name': current_site.name,\n+        'title': _('Logged out')\n+    }\n+    if extra_context is not None:\n+        context.update(extra_context)\n+    return TemplateResponse(request, template_name, context,\n+        current_app=current_app)\n \n \n def logout_then_login(request, login_url=None, current_app=None, extra_context=None):"
        },
        {
            "sha": "7c02b21b6a5c7ded5a8447cb8648107312af7f02",
            "filename": "django/contrib/comments/views/comments.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -44,9 +44,6 @@ def post_comment(request, next=None, using=None):\n         if not data.get('email', ''):\n             data[\"email\"] = request.user.email\n \n-    # Check to see if the POST data overrides the view's next argument.\n-    next = data.get(\"next\", next)\n-\n     # Look up the object we're trying to comment about\n     ctype = data.get(\"content_type\")\n     object_pk = data.get(\"object_pk\")\n@@ -100,7 +97,7 @@ def post_comment(request, next=None, using=None):\n             template_list, {\n                 \"comment\": form.data.get(\"comment\", \"\"),\n                 \"form\": form,\n-                \"next\": next,\n+                \"next\": data.get(\"next\", next),\n             },\n             RequestContext(request, {})\n         )\n@@ -131,7 +128,8 @@ def post_comment(request, next=None, using=None):\n         request=request\n     )\n \n-    return next_redirect(data, next, comment_done, c=comment._get_pk_val())\n+    return next_redirect(request, fallback=next or 'comments-comment-done',\n+        c=comment._get_pk_val())\n \n comment_done = confirmation_view(\n     template=\"comments/posted.html\","
        },
        {
            "sha": "31bb98fa633aa781af3ec40269069d2928bd770c",
            "filename": "django/contrib/comments/views/moderation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -10,7 +10,6 @@\n from django.views.decorators.csrf import csrf_protect\n \n \n-\n @csrf_protect\n @login_required\n def flag(request, comment_id, next=None):\n@@ -27,7 +26,8 @@ def flag(request, comment_id, next=None):\n     # Flag on POST\n     if request.method == 'POST':\n         perform_flag(request, comment)\n-        return next_redirect(request.POST.copy(), next, flag_done, c=comment.pk)\n+        return next_redirect(request, fallback=next or 'comments-flag-done',\n+            c=comment.pk)\n \n     # Render a form on GET\n     else:\n@@ -54,7 +54,8 @@ def delete(request, comment_id, next=None):\n     if request.method == 'POST':\n         # Flag the comment as deleted instead of actually deleting it.\n         perform_delete(request, comment)\n-        return next_redirect(request.POST.copy(), next, delete_done, c=comment.pk)\n+        return next_redirect(request, fallback=next or 'comments-delete-done',\n+            c=comment.pk)\n \n     # Render a form on GET\n     else:\n@@ -81,7 +82,8 @@ def approve(request, comment_id, next=None):\n     if request.method == 'POST':\n         # Flag the comment as approved.\n         perform_approve(request, comment)\n-        return next_redirect(request.POST.copy(), next, approve_done, c=comment.pk)\n+        return next_redirect(request, fallback=next or 'comments-approve-done',\n+            c=comment.pk)\n \n     # Render a form on GET\n     else:"
        },
        {
            "sha": "79f637623203493750693f5bfd2df79c031c7be7",
            "filename": "django/contrib/comments/views/utils.py",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -9,25 +9,26 @@\n     from urllib import urlencode\n \n from django.http import HttpResponseRedirect\n-from django.core import urlresolvers\n-from django.shortcuts import render_to_response\n+from django.shortcuts import render_to_response, resolve_url\n from django.template import RequestContext\n from django.core.exceptions import ObjectDoesNotExist\n from django.contrib import comments\n+from django.utils.http import is_safe_url\n \n-def next_redirect(data, default, default_view, **get_kwargs):\n+def next_redirect(request, fallback, **get_kwargs):\n     \"\"\"\n     Handle the \"where should I go next?\" part of comment views.\n \n-    The next value could be a kwarg to the function (``default``), or a\n-    ``?next=...`` GET arg, or the URL of a given view (``default_view``). See\n+    The next value could be a\n+    ``?next=...`` GET arg or the URL of a given view (``fallback``). See\n     the view modules for examples.\n \n     Returns an ``HttpResponseRedirect``.\n     \"\"\"\n-    next = data.get(\"next\", default)\n-    if next is None:\n-        next = urlresolvers.reverse(default_view)\n+    next = request.POST.get('next')\n+    if not is_safe_url(url=next, host=request.get_host()):\n+        next = resolve_url(fallback)\n+\n     if get_kwargs:\n         if '#' in next:\n             tmp = next.rsplit('#', 1)"
        },
        {
            "sha": "0ab5198804274adbc42b0c9e4a24fb746e5299f9",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -227,3 +227,15 @@ def same_origin(url1, url2):\n     \"\"\"\n     p1, p2 = urllib_parse.urlparse(url1), urllib_parse.urlparse(url2)\n     return (p1.scheme, p1.hostname, p1.port) == (p2.scheme, p2.hostname, p2.port)\n+\n+def is_safe_url(url, host=None):\n+    \"\"\"\n+    Return ``True`` if the url is a safe redirection (i.e. it doesn't point to\n+    a different host).\n+\n+    Always returns ``False`` on an empty url.\n+    \"\"\"\n+    if not url:\n+        return False\n+    netloc = urllib_parse.urlparse(url)[1]\n+    return not netloc or netloc == host"
        },
        {
            "sha": "c87e3a82db1f5715cb8f5e2c9e6b98a59dc238bc",
            "filename": "django/views/i18n.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fviews%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/django%2Fviews%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fi18n.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -9,6 +9,7 @@\n from django.utils.encoding import smart_text\n from django.utils.formats import get_format_modules, get_format\n from django.utils._os import upath\n+from django.utils.http import is_safe_url\n from django.utils import six\n \n def set_language(request):\n@@ -22,11 +23,11 @@ def set_language(request):\n     redirect to the page in the request (the 'next' parameter) without changing\n     any state.\n     \"\"\"\n-    next = request.REQUEST.get('next', None)\n-    if not next:\n-        next = request.META.get('HTTP_REFERER', None)\n-    if not next:\n-        next = '/'\n+    next = request.REQUEST.get('next')\n+    if not is_safe_url(url=next, host=request.get_host()):\n+        next = request.META.get('HTTP_REFERER')\n+        if not is_safe_url(url=next, host=request.get_host()):\n+            next = '/'\n     response = http.HttpResponseRedirect(next)\n     if request.method == 'POST':\n         lang_code = request.POST.get('language', None)"
        },
        {
            "sha": "5c1954026d068017a77281cebfba1c30d14d3ecb",
            "filename": "tests/regressiontests/comment_tests/tests/comment_view_tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fcomment_view_tests.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fcomment_view_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fcomment_view_tests.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -222,6 +222,13 @@ def testCommentNext(self):\n         match = re.search(r\"^http://testserver/somewhere/else/\\?c=\\d+$\", location)\n         self.assertTrue(match != None, \"Unexpected redirect location: %s\" % location)\n \n+        data[\"next\"] = \"http://badserver/somewhere/else/\"\n+        data[\"comment\"] = \"This is another comment with an unsafe next url\"\n+        response = self.client.post(\"/post/\", data)\n+        location = response[\"Location\"]\n+        match = post_redirect_re.match(location)\n+        self.assertTrue(match != None, \"Unsafe redirection to: %s\" % location)\n+\n     def testCommentDoneView(self):\n         a = Article.objects.get(pk=1)\n         data = self.getValidData(a)"
        },
        {
            "sha": "c7574193ee6a92c7be5920fbdcd160dbcc7817f6",
            "filename": "tests/regressiontests/comment_tests/tests/moderation_view_tests.py",
            "status": "modified",
            "additions": 85,
            "deletions": 5,
            "changes": 90,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fmoderation_view_tests.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fmoderation_view_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fmoderation_view_tests.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -4,7 +4,6 @@\n from django.contrib.comments import signals\n from django.contrib.comments.models import Comment, CommentFlag\n from django.contrib.contenttypes.models import ContentType\n-from django.conf import settings\n \n from . import CommentTestCase\n \n@@ -30,6 +29,30 @@ def testFlagPost(self):\n         self.assertEqual(c.flags.filter(flag=CommentFlag.SUGGEST_REMOVAL).count(), 1)\n         return c\n \n+    def testFlagPostNext(self):\n+        \"\"\"\n+        POST the flag view, explicitly providing a next url.\n+        \"\"\"\n+        comments = self.createSomeComments()\n+        pk = comments[0].pk\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        response = self.client.post(\"/flag/%d/\" % pk, {'next': \"/go/here/\"})\n+        self.assertEqual(response[\"Location\"],\n+            \"http://testserver/go/here/?c=1\")\n+\n+    def testFlagPostUnsafeNext(self):\n+        \"\"\"\n+        POSTing to the flag view with an unsafe next url will ignore the\n+        provided url when redirecting.\n+        \"\"\"\n+        comments = self.createSomeComments()\n+        pk = comments[0].pk\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        response = self.client.post(\"/flag/%d/\" % pk,\n+            {'next': \"http://elsewhere/bad\"})\n+        self.assertEqual(response[\"Location\"],\n+            \"http://testserver/flagged/?c=%d\" % pk)\n+\n     def testFlagPostTwice(self):\n         \"\"\"Users don't get to flag comments more than once.\"\"\"\n         c = self.testFlagPost()\n@@ -49,7 +72,7 @@ def testFlagAnon(self):\n     def testFlaggedView(self):\n         comments = self.createSomeComments()\n         pk = comments[0].pk\n-        response = self.client.get(\"/flagged/\", data={\"c\":pk})\n+        response = self.client.get(\"/flagged/\", data={\"c\": pk})\n         self.assertTemplateUsed(response, \"comments/flagged.html\")\n \n     def testFlagSignals(self):\n@@ -101,6 +124,33 @@ def testDeletePost(self):\n         self.assertTrue(c.is_removed)\n         self.assertEqual(c.flags.filter(flag=CommentFlag.MODERATOR_DELETION, user__username=\"normaluser\").count(), 1)\n \n+    def testDeletePostNext(self):\n+        \"\"\"\n+        POSTing the delete view will redirect to an explicitly provided a next\n+        url.\n+        \"\"\"\n+        comments = self.createSomeComments()\n+        pk = comments[0].pk\n+        makeModerator(\"normaluser\")\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        response = self.client.post(\"/delete/%d/\" % pk, {'next': \"/go/here/\"})\n+        self.assertEqual(response[\"Location\"],\n+            \"http://testserver/go/here/?c=1\")\n+\n+    def testDeletePostUnsafeNext(self):\n+        \"\"\"\n+        POSTing to the delete view with an unsafe next url will ignore the\n+        provided url when redirecting.\n+        \"\"\"\n+        comments = self.createSomeComments()\n+        pk = comments[0].pk\n+        makeModerator(\"normaluser\")\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        response = self.client.post(\"/delete/%d/\" % pk,\n+            {'next': \"http://elsewhere/bad\"})\n+        self.assertEqual(response[\"Location\"],\n+            \"http://testserver/deleted/?c=%d\" % pk)\n+\n     def testDeleteSignals(self):\n         def receive(sender, **kwargs):\n             received_signals.append(kwargs.get('signal'))\n@@ -116,13 +166,13 @@ def receive(sender, **kwargs):\n     def testDeletedView(self):\n         comments = self.createSomeComments()\n         pk = comments[0].pk\n-        response = self.client.get(\"/deleted/\", data={\"c\":pk})\n+        response = self.client.get(\"/deleted/\", data={\"c\": pk})\n         self.assertTemplateUsed(response, \"comments/deleted.html\")\n \n class ApproveViewTests(CommentTestCase):\n \n     def testApprovePermissions(self):\n-        \"\"\"The delete view should only be accessible to 'moderators'\"\"\"\n+        \"\"\"The approve view should only be accessible to 'moderators'\"\"\"\n         comments = self.createSomeComments()\n         pk = comments[0].pk\n         self.client.login(username=\"normaluser\", password=\"normaluser\")\n@@ -134,7 +184,7 @@ def testApprovePermissions(self):\n         self.assertEqual(response.status_code, 200)\n \n     def testApprovePost(self):\n-        \"\"\"POSTing the delete view should mark the comment as removed\"\"\"\n+        \"\"\"POSTing the approve view should mark the comment as removed\"\"\"\n         c1, c2, c3, c4 = self.createSomeComments()\n         c1.is_public = False; c1.save()\n \n@@ -146,6 +196,36 @@ def testApprovePost(self):\n         self.assertTrue(c.is_public)\n         self.assertEqual(c.flags.filter(flag=CommentFlag.MODERATOR_APPROVAL, user__username=\"normaluser\").count(), 1)\n \n+    def testApprovePostNext(self):\n+        \"\"\"\n+        POSTing the approve view will redirect to an explicitly provided a next\n+        url.\n+        \"\"\"\n+        c1, c2, c3, c4 = self.createSomeComments()\n+        c1.is_public = False; c1.save()\n+\n+        makeModerator(\"normaluser\")\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        response = self.client.post(\"/approve/%d/\" % c1.pk,\n+            {'next': \"/go/here/\"})\n+        self.assertEqual(response[\"Location\"],\n+            \"http://testserver/go/here/?c=1\")\n+\n+    def testApprovePostUnsafeNext(self):\n+        \"\"\"\n+        POSTing to the approve view with an unsafe next url will ignore the\n+        provided url when redirecting.\n+        \"\"\"\n+        c1, c2, c3, c4 = self.createSomeComments()\n+        c1.is_public = False; c1.save()\n+\n+        makeModerator(\"normaluser\")\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        response = self.client.post(\"/approve/%d/\" % c1.pk,\n+            {'next': \"http://elsewhere/bad\"})\n+        self.assertEqual(response[\"Location\"],\n+            \"http://testserver/approved/?c=%d\" % c1.pk)\n+\n     def testApproveSignals(self):\n         def receive(sender, **kwargs):\n             received_signals.append(kwargs.get('signal'))"
        },
        {
            "sha": "b1dc8808a1bc418eb45e1d2d7674da651950edfc",
            "filename": "tests/regressiontests/views/tests/i18n.py",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/a2f2a399566dd68ce7e312fff5a5ba857066797d/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/a2f2a399566dd68ce7e312fff5a5ba857066797d/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py?ref=a2f2a399566dd68ce7e312fff5a5ba857066797d",
            "patch": "@@ -25,13 +25,28 @@ class I18NTests(TestCase):\n     \"\"\" Tests django views in django/views/i18n.py \"\"\"\n \n     def test_setlang(self):\n-        \"\"\"The set_language view can be used to change the session language\"\"\"\n+        \"\"\"\n+        The set_language view can be used to change the session language.\n+\n+        The user is redirected to the 'next' argument if provided.\n+        \"\"\"\n         for lang_code, lang_name in settings.LANGUAGES:\n             post_data = dict(language=lang_code, next='/views/')\n             response = self.client.post('/views/i18n/setlang/', data=post_data)\n             self.assertRedirects(response, 'http://testserver/views/')\n             self.assertEqual(self.client.session['django_language'], lang_code)\n \n+    def test_setlang_unsafe_next(self):\n+        \"\"\"\n+        The set_language view only redirects to the 'next' argument if it is\n+        \"safe\".\n+        \"\"\"\n+        lang_code, lang_name = settings.LANGUAGES[0]\n+        post_data = dict(language=lang_code, next='//unsafe/redirection/')\n+        response = self.client.post('/views/i18n/setlang/', data=post_data)\n+        self.assertEqual(response['Location'], 'http://testserver/')\n+        self.assertEqual(self.client.session['django_language'], lang_code)\n+\n     def test_setlang_reversal(self):\n         self.assertEqual(reverse('set_language'), '/views/i18n/setlang/')\n "
        }
    ],
    "stats": {
        "total": 224,
        "additions": 167,
        "deletions": 57
    }
}