{
    "author": "jezdez",
    "message": "Fixed #11970 -- Wrapped the exception happening during deserialization in DeserializationError exceptions. Thanks, Claude Paroz.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17469 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd",
    "files": [
        {
            "sha": "ce7cdb31794a17742920ecca948156f5c43f19d4",
            "filename": "django/core/serializers/json.py",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd/django%2Fcore%2Fserializers%2Fjson.py",
            "raw_url": "https://github.com/django/django/raw/49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd/django%2Fcore%2Fserializers%2Fjson.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fjson.py?ref=49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd",
            "patch": "@@ -6,6 +6,7 @@\n import decimal\n from StringIO import StringIO\n \n+from django.core.serializers.base import DeserializationError\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n from django.utils import simplejson\n@@ -27,6 +28,7 @@ def getvalue(self):\n         if callable(getattr(self.stream, 'getvalue', None)):\n             return self.stream.getvalue()\n \n+\n def Deserializer(stream_or_string, **options):\n     \"\"\"\n     Deserialize a stream or string of JSON data.\n@@ -35,8 +37,13 @@ def Deserializer(stream_or_string, **options):\n         stream = StringIO(stream_or_string)\n     else:\n         stream = stream_or_string\n-    for obj in PythonDeserializer(simplejson.load(stream), **options):\n-        yield obj\n+    try:\n+        for obj in PythonDeserializer(simplejson.load(stream), **options):\n+            yield obj\n+    except Exception, e:\n+        # Map to deserializer error\n+        raise DeserializationError(e)\n+\n \n class DjangoJSONEncoder(simplejson.JSONEncoder):\n     \"\"\""
        },
        {
            "sha": "1f4f967ebba37d638e91b5b3839d70d944b88133",
            "filename": "django/core/serializers/pyyaml.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "raw_url": "https://github.com/django/django/raw/49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpyyaml.py?ref=49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd",
            "patch": "@@ -9,6 +9,7 @@\n import yaml\n \n from django.db import models\n+from django.core.serializers.base import DeserializationError\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n \n@@ -51,6 +52,9 @@ def Deserializer(stream_or_string, **options):\n         stream = StringIO(stream_or_string)\n     else:\n         stream = stream_or_string\n-    for obj in PythonDeserializer(yaml.safe_load(stream), **options):\n-        yield obj\n-\n+    try:\n+        for obj in PythonDeserializer(yaml.safe_load(stream), **options):\n+            yield obj\n+    except Exception, e:\n+        # Map to deserializer error\n+        raise DeserializationError(e)"
        },
        {
            "sha": "efad176eaaed030025cc6bc7f6a07cffcb690148",
            "filename": "tests/regressiontests/serializers_regress/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py?ref=49288f838809d797fa7b8b2e6a2cb2f65d6cf8bd",
            "patch": "@@ -19,6 +19,7 @@\n \n from django.core import serializers\n from django.core.serializers import SerializerDoesNotExist\n+from django.core.serializers.base import DeserializationError\n from django.db import connection, models\n from django.test import TestCase\n from django.utils.functional import curry\n@@ -390,6 +391,17 @@ def test_get_unkown_deserializer(self):\n         with self.assertRaises(SerializerDoesNotExist):\n             serializers.get_deserializer(\"nonsense\")\n \n+    def test_json_deserializer_exception(self):\n+        with self.assertRaises(DeserializationError):\n+            for obj in serializers.deserialize(\"json\", \"\"\"[{\"pk\":1}\"\"\"):\n+                pass\n+\n+    def test_yaml_deserializer_exception(self):\n+        with self.assertRaises(DeserializationError):\n+            for obj in serializers.deserialize(\"yaml\", \"{\"):\n+                pass\n+\n+\n def serializerTest(format, self):\n \n     # Create all the objects defined in the test data"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 28,
        "deletions": 5
    }
}