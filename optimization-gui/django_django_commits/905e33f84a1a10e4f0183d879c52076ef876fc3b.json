{
    "author": "aaugustin",
    "message": "Fixed #16885 -- Confirmed features of mirror databases when setting up test databases.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17382 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "905e33f84a1a10e4f0183d879c52076ef876fc3b",
    "files": [
        {
            "sha": "1534011c173955d78e40d15071984aab38db6b99",
            "filename": "django/test/simple.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/905e33f84a1a10e4f0183d879c52076ef876fc3b/django%2Ftest%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/905e33f84a1a10e4f0183d879c52076ef876fc3b/django%2Ftest%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsimple.py?ref=905e33f84a1a10e4f0183d879c52076ef876fc3b",
            "patch": "@@ -304,6 +304,7 @@ def setup_databases(self, **kwargs):\n         for alias, mirror_alias in mirrored_aliases.items():\n             mirrors.append((alias, connections[alias].settings_dict['NAME']))\n             connections[alias].settings_dict['NAME'] = connections[mirror_alias].settings_dict['NAME']\n+            connections[alias].features = connections[mirror_alias].features\n \n         return old_names, mirrors\n "
        },
        {
            "sha": "bd3e40c13ba0229282f37d985294637179a3181e",
            "filename": "tests/regressiontests/test_runner/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 1,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/905e33f84a1a10e4f0183d879c52076ef876fc3b/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/905e33f84a1a10e4f0183d879c52076ef876fc3b/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_runner%2Ftests.py?ref=905e33f84a1a10e4f0183d879c52076ef876fc3b",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.core.management import call_command\n from django.test import simple\n-from django.test.simple import get_tests\n+from django.test.simple import DjangoTestSuiteRunner, get_tests\n from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils import unittest\n from django.utils.importlib import import_module\n@@ -214,6 +214,29 @@ def test_all_options_given(self):\n         self.assertOutput(out, 'bar:foo:31337')\n \n \n+class Ticket16885RegressionTests(unittest.TestCase):\n+    def test_ticket_16885(self):\n+        \"\"\"Features are also confirmed on mirrored databases.\"\"\"\n+        from django import db\n+        old_db_connections = db.connections\n+        try:\n+            db.connections = db.ConnectionHandler({\n+                'default': {\n+                    'ENGINE': 'django.db.backends.sqlite3',\n+                },\n+                'slave': {\n+                    'ENGINE': 'django.db.backends.sqlite3',\n+                    'TEST_MIRROR': 'default',\n+                },\n+            })\n+            slave = db.connections['slave']\n+            self.assertEqual(slave.features.supports_transactions, None)\n+            DjangoTestSuiteRunner(verbosity=0).setup_databases()\n+            self.assertNotEqual(slave.features.supports_transactions, None)\n+        finally:\n+            db.connections = old_db_connections\n+\n+\n class Ticket17477RegressionTests(AdminScriptTestCase):\n     def setUp(self):\n         self.write_settings('settings.py')"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 25,
        "deletions": 1
    }
}