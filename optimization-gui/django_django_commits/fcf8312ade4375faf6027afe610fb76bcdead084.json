{
    "author": "alex",
    "message": "Made clear() on a reverse foreign key significantly more efficient.  Thanks to Andrew Godwin for the review.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16335 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "fcf8312ade4375faf6027afe610fb76bcdead084",
    "files": [
        {
            "sha": "cedf3088c4ae002e54de6c702e74ff33549f7ed3",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/fcf8312ade4375faf6027afe610fb76bcdead084/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/fcf8312ade4375faf6027afe610fb76bcdead084/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=fcf8312ade4375faf6027afe610fb76bcdead084",
            "patch": "@@ -459,9 +459,7 @@ def remove(self, *objs):\n                 remove.alters_data = True\n \n                 def clear(self):\n-                    for obj in self.all():\n-                        setattr(obj, rel_field.name, None)\n-                        obj.save()\n+                    self.update(**{rel_field.name: None})\n                 clear.alters_data = True\n \n         manager = RelatedManager()"
        },
        {
            "sha": "8a2af2157b49b79b9f25d120b4ad70ac9db4988f",
            "filename": "tests/modeltests/many_to_one/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/fcf8312ade4375faf6027afe610fb76bcdead084/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fcf8312ade4375faf6027afe610fb76bcdead084/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py?ref=fcf8312ade4375faf6027afe610fb76bcdead084",
            "patch": "@@ -1,10 +1,13 @@\n+from copy import deepcopy\n from datetime import datetime\n+\n from django.test import TestCase\n from django.core.exceptions import FieldError\n+\n from models import Article, Reporter\n \n-class ManyToOneTests(TestCase):\n \n+class ManyToOneTests(TestCase):\n     def setUp(self):\n         # Create a few Reporters.\n         self.r = Reporter(first_name='John', last_name='Smith', email='john@example.com')\n@@ -368,5 +371,4 @@ def test_regression_12876(self):\n         # Regression for #12876 -- Model methods that include queries that\n         # recursive don't cause recursion depth problems under deepcopy.\n         self.r.cached_query = Article.objects.filter(reporter=self.r)\n-        from copy import deepcopy\n         self.assertEqual(repr(deepcopy(self.r)), \"<Reporter: John Smith>\")"
        },
        {
            "sha": "0850cca2b1cde157ed4b989b1cec0148fd6ab1fb",
            "filename": "tests/modeltests/many_to_one_null/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/fcf8312ade4375faf6027afe610fb76bcdead084/tests%2Fmodeltests%2Fmany_to_one_null%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fcf8312ade4375faf6027afe610fb76bcdead084/tests%2Fmodeltests%2Fmany_to_one_null%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one_null%2Ftests.py?ref=fcf8312ade4375faf6027afe610fb76bcdead084",
            "patch": "@@ -1,8 +1,10 @@\n+from __future__ import with_statement\n+\n from django.test import TestCase\n from models import Reporter, Article\n \n-class ManyToOneNullTests(TestCase):\n \n+class ManyToOneNullTests(TestCase):\n     def setUp(self):\n         # Create a Reporter.\n         self.r = Reporter(name='John Smith')\n@@ -82,3 +84,11 @@ def test_assign_clear_related_set(self):\n         self.assertQuerysetEqual(self.r.article_set.all(), [])\n         self.assertQuerysetEqual(Article.objects.filter(reporter__isnull=True),\n                                  ['<Article: First>', '<Article: Fourth>'])\n+\n+    def test_remove_efficiency(self):\n+        r = Reporter.objects.create()\n+        for _ in xrange(3):\n+            r.article_set.create()\n+        with self.assertNumQueries(1):\n+            r.article_set.clear()\n+        self.assertEqual(r.article_set.count(), 0)\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 16,
        "deletions": 6
    }
}