{
    "author": "aaugustin",
    "message": "Fixed #16397 -- Respected the --traceback flag in BaseCommand. This should make import loops easier to debug. Refs #11667, #17369.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17197 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "694bc0f22bdb30a472de6fec05a44adf5c0f1f2c",
    "files": [
        {
            "sha": "23ff7d6194e636e3e0cf14682ee15a945684e657",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/694bc0f22bdb30a472de6fec05a44adf5c0f1f2c/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/694bc0f22bdb30a472de6fec05a44adf5c0f1f2c/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=694bc0f22bdb30a472de6fec05a44adf5c0f1f2c",
            "patch": "@@ -7,6 +7,7 @@\n import os\n import sys\n from optparse import make_option, OptionParser\n+import traceback\n \n import django\n from django.core.exceptions import ImproperlyConfigured\n@@ -197,8 +198,9 @@ def execute(self, *args, **options):\n         ``self.requires_model_validation``). If the command raises a\n         ``CommandError``, intercept it and print it sensibly to\n         stderr.\n-\n         \"\"\"\n+        show_traceback = options.get('traceback', False)\n+\n         # Switch to English, because django-admin.py creates database content\n         # like permissions, and those shouldn't contain any translations.\n         # But only do this if we can assume we have a working settings file,\n@@ -212,8 +214,12 @@ def execute(self, *args, **options):\n             except ImportError, e:\n                 # If settings should be available, but aren't,\n                 # raise the error and quit.\n-                sys.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n+                if show_traceback:\n+                    traceback.print_exc()\n+                else:\n+                    sys.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n                 sys.exit(1)\n+\n         try:\n             self.stdout = options.get('stdout', sys.stdout)\n             self.stderr = options.get('stderr', sys.stderr)\n@@ -232,7 +238,10 @@ def execute(self, *args, **options):\n                 if self.output_transaction:\n                     self.stdout.write('\\n' + self.style.SQL_KEYWORD(\"COMMIT;\") + '\\n')\n         except CommandError, e:\n-            self.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n+            if show_traceback:\n+                traceback.print_exc()\n+            else:\n+                self.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n             sys.exit(1)\n         if saved_lang is not None:\n             translation.activate(saved_lang)"
        },
        {
            "sha": "d96421f73c2976ff2f46ca98e77aaf7fffb06623",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/694bc0f22bdb30a472de6fec05a44adf5c0f1f2c/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/694bc0f22bdb30a472de6fec05a44adf5c0f1f2c/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=694bc0f22bdb30a472de6fec05a44adf5c0f1f2c",
            "patch": "@@ -7,6 +7,7 @@\n import gzip\n import zipfile\n from optparse import make_option\n+import traceback\n \n from django.conf import settings\n from django.core import serializers\n@@ -211,7 +212,6 @@ def read(self):\n                             except (SystemExit, KeyboardInterrupt):\n                                 raise\n                             except Exception:\n-                                import traceback\n                                 fixture.close()\n                                 if commit:\n                                     transaction.rollback(using=using)"
        },
        {
            "sha": "852fa154104005410fa523e10c6fdf4720fe11a8",
            "filename": "django/core/management/commands/syncdb.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/694bc0f22bdb30a472de6fec05a44adf5c0f1f2c/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "raw_url": "https://github.com/django/django/raw/694bc0f22bdb30a472de6fec05a44adf5c0f1f2c/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py?ref=694bc0f22bdb30a472de6fec05a44adf5c0f1f2c",
            "patch": "@@ -1,5 +1,6 @@\n from optparse import make_option\n import sys\n+import traceback\n \n from django.conf import settings\n from django.core.management.base import NoArgsCommand\n@@ -129,7 +130,6 @@ def model_installed(model):\n                             sys.stderr.write(\"Failed to install custom SQL for %s.%s model: %s\\n\" % \\\n                                                 (app_name, model._meta.object_name, e))\n                             if show_traceback:\n-                                import traceback\n                                 traceback.print_exc()\n                             transaction.rollback_unless_managed(using=db)\n                         else:"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 14,
        "deletions": 5
    }
}