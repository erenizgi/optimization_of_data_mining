{
    "author": "ramiro",
    "message": "Made sure startproject can handle template URLs with trailing slashes.\n\nThanks Issac Kelly that reported this via IRC.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17320 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f250ef3573d44ebb2c17c401851768a235742062",
    "files": [
        {
            "sha": "3668e782623a49051d39de64dda91f1d7722986f",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/f250ef3573d44ebb2c17c401851768a235742062/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/f250ef3573d44ebb2c17c401851768a235742062/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=f250ef3573d44ebb2c17c401851768a235742062",
            "patch": "@@ -196,13 +196,22 @@ def download(self, url):\n         \"\"\"\n         Downloads the given URL and returns the file name.\n         \"\"\"\n+        def cleanup_url(url):\n+            tmp = url.rstrip('/')\n+            filename = tmp.split('/')[-1]\n+            if url.endswith('/'):\n+                display_url  = tmp + '/'\n+            else:\n+                display_url = url\n+            return filename, display_url\n+\n         prefix = 'django_%s_template_' % self.app_or_project\n         tempdir = tempfile.mkdtemp(prefix=prefix, suffix='_download')\n         self.paths_to_remove.append(tempdir)\n-        filename = url.split('/')[-1]\n+        filename, display_url = cleanup_url(url)\n \n         if self.verbosity >= 2:\n-            self.stdout.write(\"Downloading %s\\n\" % url)\n+            self.stdout.write(\"Downloading %s\\n\" % display_url)\n         try:\n             the_path, info = urllib.urlretrieve(url,\n                                                 path.join(tempdir, filename))"
        },
        {
            "sha": "f896817eabb149b87ae46f6fe5ca4700272893c2",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/f250ef3573d44ebb2c17c401851768a235742062/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f250ef3573d44ebb2c17c401851768a235742062/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=f250ef3573d44ebb2c17c401851768a235742062",
            "patch": "@@ -11,7 +11,6 @@\n import socket\n import subprocess\n import sys\n-import urllib\n \n from django import conf, bin, get_version\n from django.conf import settings\n@@ -1387,11 +1386,12 @@ def test_simple_project(self):\n         self.assertOutput(err, \"File exists\")\n \n     def test_invalid_project_name(self):\n+        \"Make sure the startproject management command validates a project name\"\n+\n         def cleanup(p):\n             if os.path.exists(p):\n                 shutil.rmtree(p)\n \n-        \"Make sure the startproject management command validates a project name\"\n         args = ['startproject', '7testproject']\n         testproject_dir = os.path.join(test_dir, '7testproject')\n \n@@ -1454,7 +1454,6 @@ def test_custom_project_template_from_tarball_by_path(self):\n \n     def test_custom_project_template_from_tarball_by_url(self):\n         \"Make sure the startproject management command is able to use a different project template from a tarball via a url\"\n-        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template.tgz')\n         template_url = '%s/admin_scripts/custom_templates/project_template.tgz' % self.live_server_url\n \n         args = ['startproject', '--template', template_url, 'urltestproject']\n@@ -1465,3 +1464,16 @@ def test_custom_project_template_from_tarball_by_url(self):\n         self.assertNoOutput(err)\n         self.assertTrue(os.path.isdir(testproject_dir))\n         self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'run.py')))\n+\n+    def test_project_template_tarball_url(self):\n+        \"Startproject management command handles project template tar/zip balls from non-canonical urls\"\n+        template_url = '%s/admin_scripts/custom_templates/project_template.tgz/' % self.live_server_url\n+\n+        args = ['startproject', '--template', template_url, 'urltestproject']\n+        testproject_dir = os.path.join(test_dir, 'urltestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'run.py')))"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 26,
        "deletions": 5
    }
}