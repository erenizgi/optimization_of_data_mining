{
    "author": "aaugustin",
    "message": "Refactored database exceptions wrapping.\n\nSquashed commit of the following:\n\ncommit 2181d833ed1a2e422494738dcef311164c4e097e\nAuthor: Aymeric Augustin <aymeric.augustin@m4x.org>\nDate:   Wed Feb 27 14:28:39 2013 +0100\n\n    Fixed #15901 -- Wrapped all PEP-249 exceptions.\n\ncommit 5476a5d93c19aa2f928c497d39ce6e33f52694e2\nAuthor: Aymeric Augustin <aymeric.augustin@m4x.org>\nDate:   Tue Feb 26 17:26:52 2013 +0100\n\n    Added PEP 3134 exception chaining.\n\n    Thanks Jacob Kaplan-Moss for the suggestion.\n\ncommit 9365fad0a650328002fb424457d675a273c95802\nAuthor: Aymeric Augustin <aymeric.augustin@m4x.org>\nDate:   Tue Feb 26 17:13:49 2013 +0100\n\n    Improved API for wrapping database errors.\n\n    Thanks Alex Gaynor for the proposal.\n\ncommit 1b463b765f2826f73a8d9266795cd5da4f8d5e9e\nAuthor: Aymeric Augustin <aymeric.augustin@m4x.org>\nDate:   Tue Feb 26 15:00:39 2013 +0100\n\n    Removed redundant exception wrapping.\n\n    This is now taken care of by the cursor wrapper.\n\ncommit 524bc7345a724bf526bdd2dd1bcf5ede67d6bb5c\nAuthor: Aymeric Augustin <aymeric.augustin@m4x.org>\nDate:   Tue Feb 26 14:55:10 2013 +0100\n\n    Wrapped database exceptions in the base backend.\n\n    This covers the most common PEP-249 APIs:\n    - Connection APIs: close(), commit(), rollback(), cursor()\n    - Cursor APIs: callproc(), close(), execute(), executemany(),\n      fetchone(), fetchmany(), fetchall(), nextset().\n\n    Fixed #19920.\n\ncommit a66746bb5f0839f35543222787fce3b6a0d0a3ea\nAuthor: Aymeric Augustin <aymeric.augustin@m4x.org>\nDate:   Tue Feb 26 14:53:34 2013 +0100\n\n    Added a wrap_database_exception context manager and decorator.\n\n    It re-throws backend-specific exceptions using Django's common wrappers.",
    "sha": "59a352087591a26023412cbcb830cd1d34fc9b99",
    "files": [
        {
            "sha": "e76c6c32681bd66f727d706a6aa4cdfd7340851b",
            "filename": "django/db/__init__.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2F__init__.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -1,8 +1,11 @@\n from django.conf import settings\n from django.core import signals\n from django.core.exceptions import ImproperlyConfigured\n-from django.db.utils import (ConnectionHandler, ConnectionRouter,\n-    load_backend, DEFAULT_DB_ALIAS, DatabaseError, IntegrityError)\n+from django.db.utils import (DEFAULT_DB_ALIAS,\n+    DataError, OperationalError, IntegrityError, InternalError,\n+    ProgrammingError, NotSupportedError, DatabaseError,\n+    InterfaceError, Error,\n+    load_backend, ConnectionHandler, ConnectionRouter)\n \n __all__ = ('backend', 'connection', 'connections', 'router', 'DatabaseError',\n     'IntegrityError', 'DEFAULT_DB_ALIAS')"
        },
        {
            "sha": "49e07cfa9e06388c2ed4fd8f2d2eb7bcfd296ed6",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 23,
            "deletions": 10,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -14,6 +14,7 @@\n from django.db.backends.signals import connection_created\n from django.db.backends import util\n from django.db.transaction import TransactionManagementError\n+from django.db.utils import DatabaseErrorWrapper\n from django.utils.functional import cached_property\n from django.utils.importlib import import_module\n from django.utils import six\n@@ -57,6 +58,9 @@ def __ne__(self, other):\n     def __hash__(self):\n         return hash(self.alias)\n \n+    def wrap_database_errors(self):\n+        return DatabaseErrorWrapper(self.Database)\n+\n     def get_connection_params(self):\n         raise NotImplementedError\n \n@@ -70,20 +74,28 @@ def create_cursor(self):\n         raise NotImplementedError\n \n     def _cursor(self):\n-        if self.connection is None:\n-            conn_params = self.get_connection_params()\n-            self.connection = self.get_new_connection(conn_params)\n-            self.init_connection_state()\n-            connection_created.send(sender=self.__class__, connection=self)\n-        return self.create_cursor()\n+        with self.wrap_database_errors():\n+            if self.connection is None:\n+                conn_params = self.get_connection_params()\n+                self.connection = self.get_new_connection(conn_params)\n+                self.init_connection_state()\n+                connection_created.send(sender=self.__class__, connection=self)\n+            return self.create_cursor()\n \n     def _commit(self):\n         if self.connection is not None:\n-            return self.connection.commit()\n+            with self.wrap_database_errors():\n+                return self.connection.commit()\n \n     def _rollback(self):\n         if self.connection is not None:\n-            return self.connection.rollback()\n+            with self.wrap_database_errors():\n+                return self.connection.rollback()\n+\n+    def _close(self):\n+        if self.connection is not None:\n+            with self.wrap_database_errors():\n+                return self.connection.close()\n \n     def _enter_transaction_management(self, managed):\n         \"\"\"\n@@ -333,8 +345,9 @@ def check_constraints(self, table_names=None):\n \n     def close(self):\n         self.validate_thread_sharing()\n-        if self.connection is not None:\n-            self.connection.close()\n+        try:\n+            self._close()\n+        finally:\n             self.connection = None\n         self.set_clean()\n "
        },
        {
            "sha": "4bfd3c4481f23c6bde38774ea6d448e952b8ebb5",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 10,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -116,30 +116,22 @@ def __init__(self, cursor):\n     def execute(self, query, args=None):\n         try:\n             return self.cursor.execute(query, args)\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.OperationalError as e:\n             # Map some error codes to IntegrityError, since they seem to be\n             # misclassified and Django would prefer the more logical place.\n             if e[0] in self.codes_for_integrityerror:\n                 six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n-        except Database.DatabaseError as e:\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+            raise\n \n     def executemany(self, query, args):\n         try:\n             return self.cursor.executemany(query, args)\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.OperationalError as e:\n             # Map some error codes to IntegrityError, since they seem to be\n             # misclassified and Django would prefer the more logical place.\n             if e[0] in self.codes_for_integrityerror:\n                 six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n-        except Database.DatabaseError as e:\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+            raise\n \n     def __getattr__(self, attr):\n         if attr in self.__dict__:\n@@ -391,6 +383,8 @@ class DatabaseWrapper(BaseDatabaseWrapper):\n         'iendswith': 'LIKE %s',\n     }\n \n+    Database = Database\n+\n     def __init__(self, *args, **kwargs):\n         super(DatabaseWrapper, self).__init__(*args, **kwargs)\n "
        },
        {
            "sha": "d35e814d1f6f6336d6e35df9b98758d7b7ab96aa",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -501,6 +501,8 @@ class DatabaseWrapper(BaseDatabaseWrapper):\n         'iendswith': \"LIKEC UPPER(%s) ESCAPE '\\\\'\",\n     })\n \n+    Database = Database\n+\n     def __init__(self, *args, **kwargs):\n         super(DatabaseWrapper, self).__init__(*args, **kwargs)\n \n@@ -604,10 +606,6 @@ def _commit(self):\n         if self.connection is not None:\n             try:\n                 return self.connection.commit()\n-            except Database.IntegrityError as e:\n-                # In case cx_Oracle implements (now or in a future version)\n-                # raising this specific exception\n-                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n             except Database.DatabaseError as e:\n                 # cx_Oracle 5.0.4 raises a cx_Oracle.DatabaseError exception\n                 # with the following attributes and values:\n@@ -620,7 +618,7 @@ def _commit(self):\n                 if hasattr(x, 'code') and hasattr(x, 'message') \\\n                    and x.code == 2091 and 'ORA-02291' in x.message:\n                     six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-                six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+                raise\n \n     @cached_property\n     def oracle_version(self):\n@@ -760,13 +758,11 @@ def execute(self, query, params=None):\n         self._guess_input_sizes([params])\n         try:\n             return self.cursor.execute(query, self._param_generator(params))\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n             # cx_Oracle <= 4.4.0 wrongly raises a DatabaseError for ORA-01400.\n             if hasattr(e.args[0], 'code') and e.args[0].code == 1400 and not isinstance(e, IntegrityError):\n                 six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+            raise\n \n     def executemany(self, query, params=None):\n         # cx_Oracle doesn't support iterators, convert them to lists\n@@ -789,13 +785,11 @@ def executemany(self, query, params=None):\n         try:\n             return self.cursor.executemany(query,\n                                 [self._param_generator(p) for p in formatted])\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n             # cx_Oracle <= 4.4.0 wrongly raises a DatabaseError for ORA-01400.\n             if hasattr(e.args[0], 'code') and e.args[0].code == 1400 and not isinstance(e, IntegrityError):\n                 six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+            raise\n \n     def fetchone(self):\n         row = self.cursor.fetchone()"
        },
        {
            "sha": "fb040724949bb1447b5d0cbfb21591818bd73b28",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 42,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -40,40 +40,6 @@ def utc_tzinfo_factory(offset):\n         raise AssertionError(\"database connection isn't set to UTC\")\n     return utc\n \n-class CursorWrapper(object):\n-    \"\"\"\n-    A thin wrapper around psycopg2's normal cursor class so that we can catch\n-    particular exception instances and reraise them with the right types.\n-    \"\"\"\n-\n-    def __init__(self, cursor):\n-        self.cursor = cursor\n-\n-    def execute(self, query, args=None):\n-        try:\n-            return self.cursor.execute(query, args)\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-        except Database.DatabaseError as e:\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n-\n-    def executemany(self, query, args):\n-        try:\n-            return self.cursor.executemany(query, args)\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-        except Database.DatabaseError as e:\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n-\n-    def __getattr__(self, attr):\n-        if attr in self.__dict__:\n-            return self.__dict__[attr]\n-        else:\n-            return getattr(self.cursor, attr)\n-\n-    def __iter__(self):\n-        return iter(self.cursor)\n-\n class DatabaseFeatures(BaseDatabaseFeatures):\n     needs_datetime_string_cast = False\n     can_return_id_from_insert = True\n@@ -106,6 +72,8 @@ class DatabaseWrapper(BaseDatabaseWrapper):\n         'iendswith': 'LIKE UPPER(%s)',\n     }\n \n+    Database = Database\n+\n     def __init__(self, *args, **kwargs):\n         super(DatabaseWrapper, self).__init__(*args, **kwargs)\n \n@@ -207,7 +175,7 @@ def init_connection_state(self):\n     def create_cursor(self):\n         cursor = self.connection.cursor()\n         cursor.tzinfo_factory = utc_tzinfo_factory if settings.USE_TZ else None\n-        return CursorWrapper(cursor)\n+        return cursor\n \n     def _enter_transaction_management(self, managed):\n         \"\"\"\n@@ -245,10 +213,3 @@ def set_dirty(self):\n         if ((self.transaction_state and self.transaction_state[-1]) or\n                 not self.features.uses_autocommit):\n             super(DatabaseWrapper, self).set_dirty()\n-\n-    def _commit(self):\n-        if self.connection is not None:\n-            try:\n-                return self.connection.commit()\n-            except Database.IntegrityError as e:\n-                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])"
        },
        {
            "sha": "6bf1ffc4697040d925f1933a50d0b55063fe2fc7",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 14,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -10,7 +10,6 @@\n import decimal\n import warnings\n import re\n-import sys\n \n from django.db import utils\n from django.db.backends import *\n@@ -291,6 +290,8 @@ class DatabaseWrapper(BaseDatabaseWrapper):\n         'iendswith': \"LIKE %s ESCAPE '\\\\'\",\n     }\n \n+    Database = Database\n+\n     def __init__(self, *args, **kwargs):\n         super(DatabaseWrapper, self).__init__(*args, **kwargs)\n \n@@ -398,24 +399,14 @@ class SQLiteCursorWrapper(Database.Cursor):\n     \"\"\"\n     def execute(self, query, params=()):\n         query = self.convert_query(query)\n-        try:\n-            return Database.Cursor.execute(self, query, params)\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-        except Database.DatabaseError as e:\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+        return Database.Cursor.execute(self, query, params)\n \n     def executemany(self, query, param_list):\n         query = self.convert_query(query)\n-        try:\n-            return Database.Cursor.executemany(self, query, param_list)\n-        except Database.IntegrityError as e:\n-            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n-        except Database.DatabaseError as e:\n-            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n+        return Database.Cursor.executemany(self, query, param_list)\n \n     def convert_query(self, query):\n-        return FORMAT_QMARK_REGEX.sub('?', query).replace('%%','%')\n+        return FORMAT_QMARK_REGEX.sub('?', query).replace('%%', '%')\n \n def _sqlite_date_extract(lookup_type, dt):\n     if dt is None:"
        },
        {
            "sha": "5eb6626fc781dcabf3c0222232c42a9bca14de69",
            "filename": "django/db/backends/util.py",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Fbackends%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Futil.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -22,7 +22,12 @@ def __init__(self, cursor, db):\n     def __getattr__(self, attr):\n         if attr in ('execute', 'executemany', 'callproc'):\n             self.db.set_dirty()\n-        return getattr(self.cursor, attr)\n+        cursor_attr = getattr(self.cursor, attr)\n+        if attr in ('callproc', 'close', 'execute', 'executemany',\n+                    'fetchone', 'fetchmany', 'fetchall', 'nextset'):\n+            return self.db.wrap_database_errors()(cursor_attr)\n+        else:\n+            return cursor_attr\n \n     def __iter__(self):\n         return iter(self.cursor)\n@@ -34,7 +39,8 @@ def execute(self, sql, params=()):\n         self.db.set_dirty()\n         start = time()\n         try:\n-            return self.cursor.execute(sql, params)\n+            with self.db.wrap_database_errors():\n+                return self.cursor.execute(sql, params)\n         finally:\n             stop = time()\n             duration = stop - start\n@@ -51,7 +57,8 @@ def executemany(self, sql, param_list):\n         self.db.set_dirty()\n         start = time()\n         try:\n-            return self.cursor.executemany(sql, param_list)\n+            with self.db.wrap_database_errors():\n+                return self.cursor.executemany(sql, param_list)\n         finally:\n             stop = time()\n             duration = stop - start"
        },
        {
            "sha": "c841e06f3e180d4a0853783710ee65fa76cf0f96",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 76,
            "deletions": 4,
            "changes": 80,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -1,3 +1,4 @@\n+from functools import wraps\n import os\n import pkgutil\n from threading import local\n@@ -12,16 +13,87 @@\n \n DEFAULT_DB_ALIAS = 'default'\n \n-# Define some exceptions that mirror the PEP249 interface.\n-# We will rethrow any backend-specific errors using these\n-# common wrappers\n-class DatabaseError(Exception):\n+\n+class Error(StandardError):\n+    pass\n+\n+\n+class InterfaceError(Error):\n+    pass\n+\n+\n+class DatabaseError(Error):\n     pass\n \n+\n+class DataError(DatabaseError):\n+    pass\n+\n+\n+class OperationalError(DatabaseError):\n+    pass\n+\n+\n class IntegrityError(DatabaseError):\n     pass\n \n \n+class InternalError(DatabaseError):\n+    pass\n+\n+\n+class ProgrammingError(DatabaseError):\n+    pass\n+\n+\n+class NotSupportedError(DatabaseError):\n+    pass\n+\n+\n+class DatabaseErrorWrapper(object):\n+    \"\"\"\n+    Context manager and decorator that re-throws backend-specific database\n+    exceptions using Django's common wrappers.\n+    \"\"\"\n+\n+    def __init__(self, database):\n+        \"\"\"\n+        database is a module defining PEP-249 exceptions.\n+        \"\"\"\n+        self.database = database\n+\n+    def __enter__(self):\n+        pass\n+\n+    def __exit__(self, exc_type, exc_value, traceback):\n+        if exc_type is None:\n+            return\n+        for dj_exc_type in (\n+                DataError,\n+                OperationalError,\n+                IntegrityError,\n+                InternalError,\n+                ProgrammingError,\n+                NotSupportedError,\n+                DatabaseError,\n+                InterfaceError,\n+                Error,\n+            ):\n+            db_exc_type = getattr(self.database, dj_exc_type.__name__)\n+            if issubclass(exc_type, db_exc_type):\n+                dj_exc_value = dj_exc_type(*tuple(exc_value.args))\n+                if six.PY3:\n+                    dj_exc_value.__cause__ = exc_value\n+                six.reraise(dj_exc_type, dj_exc_value, traceback)\n+\n+    def __call__(self, func):\n+        @wraps(func)\n+        def inner(*args, **kwargs):\n+            with self:\n+                return func(*args, **kwargs)\n+        return inner\n+\n+\n def load_backend(backend_name):\n     # Look for a fully qualified database backend name\n     try:"
        },
        {
            "sha": "93bb9ed251525357d726dc915188ed0b1b7c4764",
            "filename": "docs/ref/exceptions.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/docs%2Fref%2Fexceptions.txt",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/docs%2Fref%2Fexceptions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fexceptions.txt?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -119,18 +119,28 @@ NoReverseMatch\n Database Exceptions\n ===================\n \n-Django wraps the standard database exceptions :exc:`DatabaseError` and\n-:exc:`IntegrityError` so that your Django code has a guaranteed common\n-implementation of these classes. These database exceptions are\n-provided in :mod:`django.db`.\n+Django wraps the standard database exceptions so that your Django code has a\n+guaranteed common implementation of these classes. These database exceptions\n+are provided in :mod:`django.db`.\n \n+.. exception:: Error\n+.. exception:: InterfaceError\n .. exception:: DatabaseError\n+.. exception:: DataError\n+.. exception:: OperationalError\n .. exception:: IntegrityError\n+.. exception:: InternalError\n+.. exception:: ProgrammingError\n+.. exception:: NotSupportedError\n \n The Django wrappers for database exceptions behave exactly the same as\n the underlying database exceptions. See :pep:`249`, the Python Database API\n Specification v2.0, for further information.\n \n+.. versionchanged:: 1.6\n+    Previous version of Django only wrapped ``DatabaseError`` and\n+    ``IntegrityError``.\n+\n .. exception:: models.ProtectedError\n \n Raised to prevent deletion of referenced objects when using"
        },
        {
            "sha": "c6a4fb2d5dac66c0567cb813c76ba9f26bac6709",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/59a352087591a26023412cbcb830cd1d34fc9b99/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/59a352087591a26023412cbcb830cd1d34fc9b99/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=59a352087591a26023412cbcb830cd1d34fc9b99",
            "patch": "@@ -60,6 +60,8 @@ Minor features\n * In addition to :lookup:`year`, :lookup:`month` and :lookup:`day`, the ORM\n   now supports :lookup:`hour`, :lookup:`minute` and :lookup:`second` lookups.\n \n+* Django now wraps all PEP-249 exceptions.\n+\n * The default widgets for :class:`~django.forms.EmailField`,\n   :class:`~django.forms.URLField`, :class:`~django.forms.IntegerField`,\n   :class:`~django.forms.FloatField` and :class:`~django.forms.DecimalField` use"
        }
    ],
    "stats": {
        "total": 247,
        "additions": 147,
        "deletions": 100
    }
}