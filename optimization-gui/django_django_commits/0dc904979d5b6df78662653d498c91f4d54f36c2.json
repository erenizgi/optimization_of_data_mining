{
    "author": "claudep",
    "message": "Fixed #18407 -- Made model field's to_python methods fully accept unicode.\n\nWhen generating error message in to_python, any unicode string\ncontaining non-ascii characters triggered a UnicodeEncodeError for\nmost field types.",
    "sha": "0dc904979d5b6df78662653d498c91f4d54f36c2",
    "files": [
        {
            "sha": "8a317e79c868ab767689193e0a9ffbf8dba4e0c0",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 13,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/0dc904979d5b6df78662653d498c91f4d54f36c2/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/0dc904979d5b6df78662653d498c91f4d54f36c2/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=0dc904979d5b6df78662653d498c91f4d54f36c2",
            "patch": "@@ -17,7 +17,7 @@\n from django.utils.text import capfirst\n from django.utils import timezone\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode, force_unicode, smart_str\n+from django.utils.encoding import smart_unicode, force_unicode\n from django.utils.ipv6 import clean_ipv6_address\n \n class NOT_PROVIDED:\n@@ -530,7 +530,7 @@ def to_python(self, value):\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def validate(self, value, model_instance):\n@@ -582,7 +582,7 @@ def to_python(self, value):\n             return True\n         if value in ('f', 'False', '0'):\n             return False\n-        msg = self.error_messages['invalid'] % str(value)\n+        msg = self.error_messages['invalid'] % value\n         raise exceptions.ValidationError(msg)\n \n     def get_prep_lookup(self, lookup_type, value):\n@@ -686,8 +686,6 @@ def to_python(self, value):\n         if isinstance(value, datetime.date):\n             return value\n \n-        value = smart_str(value)\n-\n         try:\n             parsed = parse_date(value)\n             if parsed is not None:\n@@ -779,8 +777,6 @@ def to_python(self, value):\n                 value = timezone.make_aware(value, default_timezone)\n             return value\n \n-        value = smart_str(value)\n-\n         try:\n             parsed = parse_datetime(value)\n             if parsed is not None:\n@@ -862,7 +858,7 @@ def to_python(self, value):\n         try:\n             return decimal.Decimal(value)\n         except decimal.InvalidOperation:\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def _format(self, value):\n@@ -967,7 +963,7 @@ def to_python(self, value):\n         try:\n             return float(value)\n         except (TypeError, ValueError):\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def formfield(self, **kwargs):\n@@ -1002,7 +998,7 @@ def to_python(self, value):\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def formfield(self, **kwargs):\n@@ -1107,7 +1103,7 @@ def to_python(self, value):\n             return True\n         if value in ('f', 'False', '0'):\n             return False\n-        msg = self.error_messages['invalid'] % str(value)\n+        msg = self.error_messages['invalid'] % value\n         raise exceptions.ValidationError(msg)\n \n     def get_prep_lookup(self, lookup_type, value):\n@@ -1228,8 +1224,6 @@ def to_python(self, value):\n             # database backend (e.g. Oracle), so we'll be accommodating.\n             return value.time()\n \n-        value = smart_str(value)\n-\n         try:\n             parsed = parse_time(value)\n             if parsed is not None:"
        },
        {
            "sha": "4aea3d52de690474ed652264db81a35761c5cf7c",
            "filename": "tests/modeltests/validation/test_error_messages.py",
            "status": "modified",
            "additions": 19,
            "deletions": 18,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/0dc904979d5b6df78662653d498c91f4d54f36c2/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "raw_url": "https://github.com/django/django/raw/0dc904979d5b6df78662653d498c91f4d54f36c2/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py?ref=0dc904979d5b6df78662653d498c91f4d54f36c2",
            "patch": "@@ -1,3 +1,4 @@\n+# -*- encoding: utf-8 -*-\n from django.core.exceptions import ValidationError\n from django.db import models\n from django.utils.unittest import TestCase\n@@ -12,42 +13,42 @@ def _test_validation_messages(self, field, value, expected):\n \n     def test_autofield_field_raises_error_message(self):\n         f = models.AutoField(primary_key=True)\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value must be an integer.\"])\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value must be an integer.\"])\n         # primary_key must be True. Refs #12467.\n         with self.assertRaisesRegexp(AssertionError,\n                 \"AutoFields must have primary_key=True.\"):\n             models.AutoField(primary_key=False)\n \n     def test_integer_field_raises_error_message(self):\n         f = models.IntegerField()\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value must be an integer.\"])\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value must be an integer.\"])\n \n     def test_boolean_field_raises_error_message(self):\n         f = models.BooleanField()\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value must be either True or False.\"])\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value must be either True or False.\"])\n \n     def test_float_field_raises_error_message(self):\n         f = models.FloatField()\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value must be a float.\"])\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value must be a float.\"])\n \n     def test_decimal_field_raises_error_message(self):\n         f = models.DecimalField()\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value must be a decimal number.\"])\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value must be a decimal number.\"])\n \n     def test_null_boolean_field_raises_error_message(self):\n         f = models.NullBooleanField()\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value must be either None, True or False.\"])\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value must be either None, True or False.\"])\n \n     def test_date_field_raises_error_message(self):\n         f = models.DateField()\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value has an invalid date format. \"\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value has an invalid date format. \"\n              u\"It must be in YYYY-MM-DD format.\"])\n \n         self._test_validation_messages(f, 'aaaa-10-10',\n@@ -65,8 +66,8 @@ def test_date_field_raises_error_message(self):\n     def test_datetime_field_raises_error_message(self):\n         f = models.DateTimeField()\n         # Wrong format\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value has an invalid format. It must be \"\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value has an invalid format. It must be \"\n              u\"in YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ] format.\"])\n \n         # Correct format but invalid date\n@@ -83,8 +84,8 @@ def test_datetime_field_raises_error_message(self):\n     def test_time_field_raises_error_message(self):\n         f = models.TimeField()\n         # Wrong format\n-        self._test_validation_messages(f, 'foo',\n-            [u\"'foo' value has an invalid format. It must be in \"\n+        self._test_validation_messages(f, u'fõo',\n+            [u\"'fõo' value has an invalid format. It must be in \"\n              u\"HH:MM[:ss[.uuuuuu]] format.\"])\n \n         # Correct format but invalid time"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 26,
        "deletions": 31
    }
}