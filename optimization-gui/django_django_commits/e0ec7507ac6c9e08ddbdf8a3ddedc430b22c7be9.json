{
    "author": "aaugustin",
    "message": "[py3] Fixed jsi18n test.\n\nAlso refactored said test to avoid leaking state (ie. active\ntranslation) when an error occurs.",
    "sha": "e0ec7507ac6c9e08ddbdf8a3ddedc430b22c7be9",
    "files": [
        {
            "sha": "601df6d51218bd454a9d84a4b2b173995af416cd",
            "filename": "tests/regressiontests/views/tests/i18n.py",
            "status": "modified",
            "additions": 16,
            "deletions": 14,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/e0ec7507ac6c9e08ddbdf8a3ddedc430b22c7be9/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/e0ec7507ac6c9e08ddbdf8a3ddedc430b22c7be9/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py?ref=e0ec7507ac6c9e08ddbdf8a3ddedc430b22c7be9",
            "patch": "@@ -7,7 +7,8 @@\n from django.conf import settings\n from django.core.urlresolvers import reverse\n from django.test import TestCase\n-from django.utils.translation import override, activate, get_language\n+from django.utils import six\n+from django.utils.translation import override, get_language\n from django.utils.text import javascript_quote\n \n from ..urls import locale_dir\n@@ -29,20 +30,21 @@ def test_setlang_reversal(self):\n \n     def test_jsi18n(self):\n         \"\"\"The javascript_catalog can be deployed with language settings\"\"\"\n-        saved_lang = get_language()\n         for lang_code in ['es', 'fr', 'ru']:\n-            activate(lang_code)\n-            catalog = gettext.translation('djangojs', locale_dir, [lang_code])\n-            trans_txt = catalog.ugettext('this is to be translated')\n-            response = self.client.get('/views/jsi18n/')\n-            # in response content must to be a line like that:\n-            # catalog['this is to be translated'] = 'same_that_trans_txt'\n-            # javascript_quote is used to be able to check unicode strings\n-            self.assertContains(response, javascript_quote(trans_txt), 1)\n-            if lang_code == 'fr':\n-                # Message with context (msgctxt)\n-                self.assertContains(response, \"['month name\\x04May'] = 'mai';\", 1)\n-        activate(saved_lang)\n+            with override(lang_code):\n+                catalog = gettext.translation('djangojs', locale_dir, [lang_code])\n+                if six.PY3:\n+                    trans_txt = catalog.gettext('this is to be translated')\n+                else:\n+                    trans_txt = catalog.ugettext('this is to be translated')\n+                response = self.client.get('/views/jsi18n/')\n+                # in response content must to be a line like that:\n+                # catalog['this is to be translated'] = 'same_that_trans_txt'\n+                # javascript_quote is used to be able to check unicode strings\n+                self.assertContains(response, javascript_quote(trans_txt), 1)\n+                if lang_code == 'fr':\n+                    # Message with context (msgctxt)\n+                    self.assertContains(response, \"['month name\\x04May'] = 'mai';\", 1)\n \n \n class JsI18NTests(TestCase):"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 16,
        "deletions": 14
    }
}