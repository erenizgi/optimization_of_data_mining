{
    "author": "ramiro",
    "message": "Added tests demonstrating that filtering lookup expression that involve model with inheritance schemes aren't incorrectly blacklisted by the r15031 security fix. Refs. #15032.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15178 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "1c56af676d02aa0cdb70bb3749971f1cac4afdb3",
    "files": [
        {
            "sha": "0a27964ea34824dcbfa9c80ded97d6563685de4b",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/1c56af676d02aa0cdb70bb3749971f1cac4afdb3/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/1c56af676d02aa0cdb70bb3749971f1cac4afdb3/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=1c56af676d02aa0cdb70bb3749971f1cac4afdb3",
            "patch": "@@ -615,6 +615,17 @@ class Album(models.Model):\n class AlbumAdmin(admin.ModelAdmin):\n     list_filter = ['title']\n \n+class Employee(Person):\n+    code = models.CharField(max_length=20)\n+\n+class WorkHour(models.Model):\n+    datum = models.DateField()\n+    employee = models.ForeignKey(Employee)\n+\n+class WorkHourAdmin(admin.ModelAdmin):\n+    list_display = ('datum', 'employee')\n+    list_filter = ('employee',)\n+\n admin.site.register(Article, ArticleAdmin)\n admin.site.register(CustomArticle, CustomArticleAdmin)\n admin.site.register(Section, save_as=True, inlines=[ArticleInline])\n@@ -646,6 +657,7 @@ class AlbumAdmin(admin.ModelAdmin):\n admin.site.register(PlotDetails)\n admin.site.register(CyclicOne)\n admin.site.register(CyclicTwo)\n+admin.site.register(WorkHour, WorkHourAdmin)\n \n # We intentionally register Promo and ChapterXtra1 but not Chapter nor ChapterXtra2.\n # That way we cover all four cases:"
        },
        {
            "sha": "9b881291de9677a6eb1099b501e36bafd1903523",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/1c56af676d02aa0cdb70bb3749971f1cac4afdb3/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/1c56af676d02aa0cdb70bb3749971f1cac4afdb3/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=1c56af676d02aa0cdb70bb3749971f1cac4afdb3",
            "patch": "@@ -33,7 +33,7 @@\n     FooAccount, Gallery, ModelWithStringPrimaryKey, \\\n     Person, Persona, Picture, Podcast, Section, Subscriber, Vodcast, \\\n     Language, Collector, Widget, Grommet, DooHickey, FancyDoodad, Whatsit, \\\n-    Category, Post, Plot, FunkyTag, Chapter, Book, Promo\n+    Category, Post, Plot, FunkyTag, Chapter, Book, Promo, WorkHour, Employee\n \n \n class AdminViewBasicTest(TestCase):\n@@ -382,6 +382,16 @@ def test_disallowed_filtering(self):\n         except SuspiciousOperation:\n             self.fail(\"Filters should be allowed if they involve a local field without the need to whitelist them in list_filter or date_hierarchy.\")\n \n+        e1 = Employee.objects.create(name='Anonymous', gender=1, age=22, alive=True, code='123')\n+        e2 = Employee.objects.create(name='Visitor', gender=2, age=19, alive=True, code='124')\n+        WorkHour.objects.create(datum=datetime.datetime.now(), employee=e1)\n+        WorkHour.objects.create(datum=datetime.datetime.now(), employee=e2)\n+        response = self.client.get(\"/test_admin/admin/admin_views/workhour/\")\n+        self.assertEqual(response.status_code, 200)\n+        self.assertContains(response, 'employee__person_ptr__exact')\n+        response = self.client.get(\"/test_admin/admin/admin_views/workhour/?employee__person_ptr__exact=%d\" % e1.pk)\n+        self.assertEqual(response.status_code, 200)\n+\n class SaveAsTests(TestCase):\n     fixtures = ['admin-views-users.xml','admin-views-person.xml']\n "
        }
    ],
    "stats": {
        "total": 24,
        "additions": 23,
        "deletions": 1
    }
}