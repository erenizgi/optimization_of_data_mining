{
    "author": "ramiro",
    "message": "Fixed #11118 -- Made management command BaseCommand restore locale after execution.\n\nThanks rvdrijst for the report and initial patch and Claude Paroz for enhancing it.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17077 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e92b3b723f9bf953d0465e92e444045cdc837042",
    "files": [
        {
            "sha": "d2dd2665278690784aa1021e436971264f9e5aa4",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e92b3b723f9bf953d0465e92e444045cdc837042/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/e92b3b723f9bf953d0465e92e444045cdc837042/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=e92b3b723f9bf953d0465e92e444045cdc837042",
            "patch": "@@ -203,9 +203,11 @@ def execute(self, *args, **options):\n         # like permissions, and those shouldn't contain any translations.\n         # But only do this if we can assume we have a working settings file,\n         # because django.utils.translation requires settings.\n+        saved_lang = None\n         if self.can_import_settings:\n             try:\n                 from django.utils import translation\n+                saved_lang = translation.get_language()\n                 translation.activate('en-us')\n             except ImportError, e:\n                 # If settings should be available, but aren't,\n@@ -232,6 +234,8 @@ def execute(self, *args, **options):\n         except CommandError, e:\n             self.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n             sys.exit(1)\n+        if saved_lang is not None:\n+            translation.activate(saved_lang)\n \n     def validate(self, app=None, display_num_errors=False):\n         \"\"\""
        },
        {
            "sha": "896dd667ff7785ca162b807ee2a0d11b87e61e74",
            "filename": "tests/modeltests/user_commands/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/e92b3b723f9bf953d0465e92e444045cdc837042/tests%2Fmodeltests%2Fuser_commands%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e92b3b723f9bf953d0465e92e444045cdc837042/tests%2Fmodeltests%2Fuser_commands%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fuser_commands%2Ftests.py?ref=e92b3b723f9bf953d0465e92e444045cdc837042",
            "patch": "@@ -3,6 +3,7 @@\n from django.core import management\n from django.core.management.base import CommandError\n from django.test import TestCase\n+from django.utils import translation\n \n \n class CommandTests(TestCase):\n@@ -18,5 +19,11 @@ def test_command_style(self):\n         self.assertEqual(out.getvalue(),\n             \"I don't feel like dancing Jive.\")\n \n+    def test_language_preserved(self):\n+        out = StringIO()\n+        with translation.override('fr'):\n+            management.call_command('dance', stdout=out)\n+            self.assertEqual(translation.get_language(), 'fr')\n+\n     def test_explode(self):\n-        self.assertRaises(CommandError, management.call_command, ('explode',))\n\\ No newline at end of file\n+        self.assertRaises(CommandError, management.call_command, ('explode',))"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 12,
        "deletions": 1
    }
}