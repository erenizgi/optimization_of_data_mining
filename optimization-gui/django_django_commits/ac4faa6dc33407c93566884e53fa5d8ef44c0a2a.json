{
    "author": "claudep",
    "message": "Fixed #19693 -- Made truncatewords_html handle self-closing tags\n\nThanks sneawo for the report and Jonathan Loy for the patch.",
    "sha": "ac4faa6dc33407c93566884e53fa5d8ef44c0a2a",
    "files": [
        {
            "sha": "02c3f10678ab0378fe5f5d46bc0389ca12359ca3",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/ac4faa6dc33407c93566884e53fa5d8ef44c0a2a/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/ac4faa6dc33407c93566884e53fa5d8ef44c0a2a/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=ac4faa6dc33407c93566884e53fa5d8ef44c0a2a",
            "patch": "@@ -24,7 +24,7 @@\n \n # Set up regular expressions\n re_words = re.compile(r'&.*?;|<.*?>|(\\w[\\w-]*)', re.U|re.S)\n-re_tag = re.compile(r'<(/)?([^ ]+?)(?: (/)| .*?)?>', re.S)\n+re_tag = re.compile(r'<(/)?([^ ]+?)(?:(\\s*/)| .*?)?>', re.S)\n \n \n def wrap(text, width):"
        },
        {
            "sha": "c9dde6b1b36518b0a0c0785ead603295573672c8",
            "filename": "tests/regressiontests/utils/text.py",
            "status": "modified",
            "additions": 19,
            "deletions": 8,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/ac4faa6dc33407c93566884e53fa5d8ef44c0a2a/tests%2Fregressiontests%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/ac4faa6dc33407c93566884e53fa5d8ef44c0a2a/tests%2Fregressiontests%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftext.py?ref=ac4faa6dc33407c93566884e53fa5d8ef44c0a2a",
            "patch": "@@ -55,22 +55,33 @@ def test_truncate_words(self):\n             truncator.words(4, '[snip]'))\n \n     def test_truncate_html_words(self):\n-        truncator = text.Truncator('<p><strong><em>The quick brown fox jumped '\n-            'over the lazy dog.</em></strong></p>')\n-        self.assertEqual('<p><strong><em>The quick brown fox jumped over the '\n-            'lazy dog.</em></strong></p>', truncator.words(10, html=True))\n-        self.assertEqual('<p><strong><em>The quick brown fox...</em>'\n+        truncator = text.Truncator('<p id=\"par\"><strong><em>The quick brown fox'\n+            ' jumped over the lazy dog.</em></strong></p>')\n+        self.assertEqual('<p id=\"par\"><strong><em>The quick brown fox jumped over'\n+            ' the lazy dog.</em></strong></p>', truncator.words(10, html=True))\n+        self.assertEqual('<p id=\"par\"><strong><em>The quick brown fox...</em>'\n             '</strong></p>', truncator.words(4, html=True))\n-        self.assertEqual('<p><strong><em>The quick brown fox....</em>'\n+        self.assertEqual('<p id=\"par\"><strong><em>The quick brown fox....</em>'\n             '</strong></p>', truncator.words(4, '....', html=True))\n-        self.assertEqual('<p><strong><em>The quick brown fox</em></strong>'\n-            '</p>', truncator.words(4, '', html=True))\n+        self.assertEqual('<p id=\"par\"><strong><em>The quick brown fox</em>'\n+            '</strong></p>', truncator.words(4, '', html=True))\n+\n         # Test with new line inside tag\n         truncator = text.Truncator('<p>The quick <a href=\"xyz.html\"\\n'\n             'id=\"mylink\">brown fox</a> jumped over the lazy dog.</p>')\n         self.assertEqual('<p>The quick <a href=\"xyz.html\"\\n'\n             'id=\"mylink\">brown...</a></p>', truncator.words(3, '...', html=True))\n \n+        # Test self-closing tags\n+        truncator = text.Truncator('<br/>The <hr />quick brown fox jumped over'\n+            ' the lazy dog.')\n+        self.assertEqual('<br/>The <hr />quick brown...',\n+            truncator.words(3, '...', html=True ))\n+        truncator = text.Truncator('<br>The <hr/>quick <em>brown fox</em> '\n+            'jumped over the lazy dog.')\n+        self.assertEqual('<br>The <hr/>quick <em>brown...</em>',\n+            truncator.words(3, '...', html=True ))\n+\n     def test_wrap(self):\n         digits = '1234 67 9'\n         self.assertEqual(text.wrap(digits, 100), '1234 67 9')"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 20,
        "deletions": 9
    }
}