{
    "author": "claudep",
    "message": "Fixed #5725 -- Fixed varchar column size introspection for MySQL\n\nThanks ferdonline for the initial patch and Karen Tracey for the\nrelated post on django-users.",
    "sha": "879b245baa727090e242c482a8f12ee52f169642",
    "files": [
        {
            "sha": "3b5a6fecd3e7ee235ede20e9b2d6cba588e435a1",
            "filename": "django/db/backends/mysql/introspection.py",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/879b245baa727090e242c482a8f12ee52f169642/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/879b245baa727090e242c482a8f12ee52f169642/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py?ref=879b245baa727090e242c482a8f12ee52f169642",
            "patch": "@@ -36,9 +36,20 @@ def get_table_list(self, cursor):\n         return [row[0] for row in cursor.fetchall()]\n \n     def get_table_description(self, cursor, table_name):\n-        \"Returns a description of the table, with the DB-API cursor.description interface.\"\n+        \"\"\"\n+        Returns a description of the table, with the DB-API cursor.description interface.\"\n+        \"\"\"\n+        # varchar length returned by cursor.description is an internal length,\n+        # not visible length (#5725), use information_schema database to fix this\n+        cursor.execute(\"\"\"\n+            SELECT column_name, character_maximum_length FROM information_schema.columns\n+            WHERE table_name = %s AND table_schema = DATABASE()\n+                AND character_maximum_length IS NOT NULL\"\"\", [table_name])\n+        length_map = dict(cursor.fetchall())\n+\n         cursor.execute(\"SELECT * FROM %s LIMIT 1\" % self.connection.ops.quote_name(table_name))\n-        return cursor.description\n+        return [line[:3] + (length_map.get(line[0], line[3]),) + line[4:]\n+            for line in cursor.description]\n \n     def _name_to_index(self, cursor, table_name):\n         \"\"\""
        },
        {
            "sha": "a54e0c670b443d53422e71bf05ea95e724ee10a6",
            "filename": "tests/regressiontests/introspection/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/879b245baa727090e242c482a8f12ee52f169642/tests%2Fregressiontests%2Fintrospection%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/879b245baa727090e242c482a8f12ee52f169642/tests%2Fregressiontests%2Fintrospection%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fintrospection%2Ftests.py?ref=879b245baa727090e242c482a8f12ee52f169642",
            "patch": "@@ -89,6 +89,11 @@ def test_get_table_description_types(self):\n             [datatype(r[1], r) for r in desc],\n             ['IntegerField', 'CharField', 'CharField', 'CharField', 'BigIntegerField']\n         )\n+        # Check also length of CharFields\n+        self.assertEqual(\n+            [r[3] for r in desc if datatype(r[1], r) == 'CharField'],\n+            [30, 30, 75]\n+        )\n \n     # Oracle forces null=True under the hood in some cases (see\n     # https://docs.djangoproject.com/en/dev/ref/databases/#null-and-empty-strings)"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
    }
}