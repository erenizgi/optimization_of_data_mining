{
    "author": "claudep",
    "message": "Fixed #19366 -- Prevented GEOSIndexError when comparing geometries\n\nThanks Craig de Stigter for the report and collaboration on the\npatch.",
    "sha": "cc3c4a9d55e765cfe664e3dbd58201de99232096",
    "files": [
        {
            "sha": "0418282bfe961fb6e3664fe63284e641ff5e6041",
            "filename": "django/contrib/gis/geos/mutable_list.py",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/cc3c4a9d55e765cfe664e3dbd58201de99232096/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "raw_url": "https://github.com/django/django/raw/cc3c4a9d55e765cfe664e3dbd58201de99232096/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py?ref=cc3c4a9d55e765cfe664e3dbd58201de99232096",
            "patch": "@@ -149,27 +149,30 @@ def __imul__(self, n):\n         return self\n \n     def __eq__(self, other):\n-        for i in range(len(self)):\n+        olen = len(other)\n+        for i in range(olen):\n             try:\n                 c = self[i] == other[i]\n-            except IndexError:\n-                # must be other is shorter\n+            except self._IndexError:\n+                # self must be shorter\n                 return False\n             if not c:\n                 return False\n-        return True\n+        return len(self) == olen\n \n     def __lt__(self, other):\n-        slen = len(self)\n-        for i in range(slen):\n+        olen = len(other)\n+        for i in range(olen):\n             try:\n                 c = self[i] < other[i]\n-            except IndexError:\n-                # must be other is shorter\n-                return False\n+            except self._IndexError:\n+                # self must be shorter\n+                return True\n             if c:\n                 return c\n-        return slen < len(other)\n+            elif other[i] < self[i]:\n+                return False\n+        return len(self) < olen\n \n     ### Public list interface Methods ###\n     ## Non-mutating ##"
        },
        {
            "sha": "ec320f94ec9a48865d6d08dde0e0b5e99fa94efd",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/cc3c4a9d55e765cfe664e3dbd58201de99232096/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/cc3c4a9d55e765cfe664e3dbd58201de99232096/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=cc3c4a9d55e765cfe664e3dbd58201de99232096",
            "patch": "@@ -451,6 +451,21 @@ def test_polygons(self):\n             self.assertEqual(poly.wkt, Polygon(*tuple(r for r in poly)).wkt)\n             self.assertEqual(poly.wkt, Polygon(*tuple(LinearRing(r.tuple) for r in poly)).wkt)\n \n+    def test_polygon_comparison(self):\n+        p1 = Polygon(((0, 0), (0, 1), (1, 1), (1, 0), (0, 0)))\n+        p2 = Polygon(((0, 0), (0, 1), (1, 0), (0, 0)))\n+        self.assertTrue(p1 > p2)\n+        self.assertFalse(p1 < p2)\n+        self.assertFalse(p2 > p1)\n+        self.assertTrue(p2 < p1)\n+\n+        p3 = Polygon(((0, 0), (0, 1), (1, 1), (2, 0), (0, 0)))\n+        p4 = Polygon(((0, 0), (0, 1), (2, 2), (1, 0), (0, 0)))\n+        self.assertFalse(p4 < p3)\n+        self.assertTrue(p3 < p4)\n+        self.assertTrue(p4 > p3)\n+        self.assertFalse(p3 > p4)\n+\n     def test_multipolygons(self):\n         \"Testing MultiPolygon objects.\"\n         prev = fromstr('POINT (0 0)')"
        },
        {
            "sha": "988d8417a2ba3292e9e9191a478f3df109cfba72",
            "filename": "django/contrib/gis/geos/tests/test_mutable_list.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/cc3c4a9d55e765cfe664e3dbd58201de99232096/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py",
            "raw_url": "https://github.com/django/django/raw/cc3c4a9d55e765cfe664e3dbd58201de99232096/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py?ref=cc3c4a9d55e765cfe664e3dbd58201de99232096",
            "patch": "@@ -363,6 +363,7 @@ def test_12_arithmetic(self):\n \n         pl, ul = self.lists_of_len()\n         self.assertEqual(pl, ul, 'cmp for equal')\n+        self.assertFalse(ul == pl + [2], 'cmp for not equal')\n         self.assertTrue(pl >= ul, 'cmp for gte self')\n         self.assertTrue(pl <= ul, 'cmp for lte self')\n         self.assertTrue(ul >= pl, 'cmp for self gte')\n@@ -377,6 +378,14 @@ def test_12_arithmetic(self):\n         self.assertTrue(ul < pl + [2], 'cmp')\n         self.assertTrue(ul <= pl + [2], 'cmp')\n \n+        # Also works with a custom IndexError\n+        ul_longer = ul + [2]\n+        ul_longer._IndexError = TypeError\n+        ul._IndexError = TypeError\n+        self.assertFalse(ul_longer == pl)\n+        self.assertFalse(ul == ul_longer)\n+        self.assertTrue(ul_longer > ul)\n+\n         pl[1] = 20\n         self.assertTrue(pl > ul, 'cmp for gt self')\n         self.assertTrue(ul < pl, 'cmp for self lt')"
        },
        {
            "sha": "7d7c32781cba07848d990d81ed90add7a54f2984",
            "filename": "docs/ref/contrib/gis/geos.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/cc3c4a9d55e765cfe664e3dbd58201de99232096/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "raw_url": "https://github.com/django/django/raw/cc3c4a9d55e765cfe664e3dbd58201de99232096/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt?ref=cc3c4a9d55e765cfe664e3dbd58201de99232096",
            "patch": "@@ -656,6 +656,17 @@ is returned instead.\n \n    Returns the number of interior rings in this geometry.\n \n+.. admonition:: Comparing Polygons\n+\n+    Note that it is possible to compare ``Polygon`` objects directly with ``<``\n+    or ``>``, but as the comparison is made through Polygon's\n+    :class:`LineString`, it does not mean much (but is consistent and quick).\n+    You can always force the comparison with the :attr:`~GEOSGeometry.area`\n+    property::\n+\n+        >>> if poly_1.area > poly_2.area:\n+        >>>     pass\n+\n Geometry Collections\n ====================\n "
        }
    ],
    "stats": {
        "total": 58,
        "additions": 48,
        "deletions": 10
    }
}