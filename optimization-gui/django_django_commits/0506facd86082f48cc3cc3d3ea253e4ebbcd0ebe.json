{
    "author": "PaulMcMillan",
    "message": "Fixed #16378. Locmem now uses pickle.HIGHEST_PROTOCOL for better compatibility with other hash backends. Thanks aaugustin for the initial patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17136 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe",
    "files": [
        {
            "sha": "62ea5c420bac27894e3166997b947f8762b80d3b",
            "filename": "django/core/cache/backends/db.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fdb.py?ref=0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe",
            "patch": "@@ -102,7 +102,8 @@ def _base_set(self, mode, key, value, timeout=None):\n         exp = exp.replace(microsecond=0)\n         if num > self._max_entries:\n             self._cull(db, cursor, now)\n-        encoded = base64.encodestring(pickle.dumps(value, 2)).strip()\n+        pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)\n+        encoded = base64.encodestring(pickled).strip()\n         cursor.execute(\"SELECT cache_key, expires FROM %s \"\n                        \"WHERE cache_key = %%s\" % table, [key])\n         try:"
        },
        {
            "sha": "7421b9b158a17e1662901a20b414546816b8c722",
            "filename": "django/core/cache/backends/locmem.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe/django%2Fcore%2Fcache%2Fbackends%2Flocmem.py",
            "raw_url": "https://github.com/django/django/raw/0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe/django%2Fcore%2Fcache%2Fbackends%2Flocmem.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Flocmem.py?ref=0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe",
            "patch": "@@ -31,7 +31,8 @@ def add(self, key, value, timeout=None, version=None):\n             exp = self._expire_info.get(key)\n             if exp is None or exp <= time.time():\n                 try:\n-                    self._set(key, pickle.dumps(value), timeout)\n+                    pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)\n+                    self._set(key, pickled, timeout)\n                     return True\n                 except pickle.PickleError:\n                     pass\n@@ -49,7 +50,8 @@ def get(self, key, default=None, version=None):\n                 return default\n             elif exp > time.time():\n                 try:\n-                    return pickle.loads(self._cache[key])\n+                    pickled = self._cache[key]\n+                    return pickle.loads(pickled)\n                 except pickle.PickleError:\n                     return default\n         finally:\n@@ -78,7 +80,8 @@ def set(self, key, value, timeout=None, version=None):\n         self.validate_key(key)\n         self._lock.writer_enters()\n         try:\n-            self._set(key, pickle.dumps(value), timeout)\n+            pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)\n+            self._set(key, pickled, timeout)\n         except pickle.PickleError:\n             pass\n         finally:"
        },
        {
            "sha": "9275ac6ffeb6573b826fb8f87729bcd629ba1d84",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=0506facd86082f48cc3cc3d3ea253e4ebbcd0ebe",
            "patch": "@@ -501,6 +501,10 @@ Django 1.4 also includes several smaller improvements worth noting:\n * Changed the default value for ``httponly`` on session cookies to\n   ``True`` to help reduce the impact of potential XSS attacks.\n \n+* Changed the ``locmem`` cache backend to use\n+  ``pickle.HIGHEST_PROTOCOL`` for better compatibility with the other\n+  cache backends.\n+\n .. _backwards-incompatible-changes-1.4:\n \n Backwards incompatible changes in 1.4"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 12,
        "deletions": 4
    }
}