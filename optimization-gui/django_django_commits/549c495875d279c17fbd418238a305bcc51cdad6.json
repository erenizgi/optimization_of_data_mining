{
    "author": "aaugustin",
    "message": "Used symbolic constants for psycopg2 isolation levels.\n\nDjango used the value 1 = ISOLATION_LEVEL_READ_UNCOMMITTED in some places, but\nPostgreSQL doesn't provide \"read uncommited\", it uses \"read committed\" instead:\nhttp://www.postgresql.org/docs/9.1/static/transaction-iso.html. For clarity,\nthis commit uses ISOLATION_LEVEL_READ_COMMITTED = 2 where 1 was previously used.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17112 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "549c495875d279c17fbd418238a305bcc51cdad6",
    "files": [
        {
            "sha": "dbd49c55e148e6f07cf0dbf88737d7a0c2f8c25d",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/549c495875d279c17fbd418238a305bcc51cdad6/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/549c495875d279c17fbd418238a305bcc51cdad6/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=549c495875d279c17fbd418238a305bcc51cdad6",
            "patch": "@@ -108,7 +108,11 @@ def __init__(self, *args, **kwargs):\n         self.features = DatabaseFeatures(self)\n         autocommit = self.settings_dict[\"OPTIONS\"].get('autocommit', False)\n         self.features.uses_autocommit = autocommit\n-        self._set_isolation_level(int(not autocommit))\n+        if autocommit:\n+            level = psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT\n+        else:\n+            level = psycopg2.extensions.ISOLATION_LEVEL_READ_COMMITTED\n+        self._set_isolation_level(level)\n         self.ops = DatabaseOperations(self)\n         self.client = DatabaseClient(self)\n         self.creation = DatabaseCreation(self)\n@@ -189,23 +193,23 @@ def _enter_transaction_management(self, managed):\n         the same transaction is visible across all the queries.\n         \"\"\"\n         if self.features.uses_autocommit and managed and not self.isolation_level:\n-            self._set_isolation_level(1)\n+            self._set_isolation_level(psycopg2.extensions.ISOLATION_LEVEL_READ_COMMITTED)\n \n     def _leave_transaction_management(self, managed):\n         \"\"\"\n         If the normal operating mode is \"autocommit\", switch back to that when\n         leaving transaction management.\n         \"\"\"\n         if self.features.uses_autocommit and not managed and self.isolation_level:\n-            self._set_isolation_level(0)\n+            self._set_isolation_level(psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT)\n \n     def _set_isolation_level(self, level):\n         \"\"\"\n         Do all the related feature configurations for changing isolation\n         levels. This doesn't touch the uses_autocommit feature, since that\n         controls the movement *between* isolation levels.\n         \"\"\"\n-        assert level in (0, 1)\n+        assert level in range(5)\n         try:\n             if self.connection is not None:\n                 self.connection.set_isolation_level(level)"
        },
        {
            "sha": "ca389b904601e1e3fd69c4cb9673fef11c12d1ae",
            "filename": "django/db/backends/postgresql_psycopg2/creation.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/549c495875d279c17fbd418238a305bcc51cdad6/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/549c495875d279c17fbd418238a305bcc51cdad6/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py?ref=549c495875d279c17fbd418238a305bcc51cdad6",
            "patch": "@@ -1,3 +1,5 @@\n+import psycopg2.extensions\n+\n from django.db.backends.creation import BaseDatabaseCreation\n from django.db.backends.util import truncate_name\n \n@@ -81,4 +83,5 @@ def set_autocommit(self):\n     def _prepare_for_test_db_ddl(self):\n         \"\"\"Rollback and close the active transaction.\"\"\"\n         self.connection.connection.rollback()\n-        self.connection.connection.set_isolation_level(0)\n+        self.connection.connection.set_isolation_level(\n+                psycopg2.extensions.ISOLATION_LEVEL_AUTOCOMMIT)"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 12,
        "deletions": 5
    }
}