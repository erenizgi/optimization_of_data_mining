{
    "author": "aaugustin",
    "message": "Fixed #16218 -- date_list order in generic CBVs.\n\nThanks nnrcschmdt for the report and bpeschier for the initial\nversion of the patch.",
    "sha": "baa33cd8faa16737524b1ac355802a10dd63571c",
    "files": [
        {
            "sha": "e1b0eb99fe5190e8432d6023f286d966fe955d2b",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/baa33cd8faa16737524b1ac355802a10dd63571c/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/baa33cd8faa16737524b1ac355802a10dd63571c/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=baa33cd8faa16737524b1ac355802a10dd63571c",
            "patch": "@@ -377,7 +377,7 @@ def get_date_list_period(self):\n         \"\"\"\n         return self.date_list_period\n \n-    def get_date_list(self, queryset, date_type=None):\n+    def get_date_list(self, queryset, date_type=None, ordering='ASC'):\n         \"\"\"\n         Get a date list by calling `queryset.dates()`, checking along the way\n         for empty lists that aren't allowed.\n@@ -387,7 +387,7 @@ def get_date_list(self, queryset, date_type=None):\n         if date_type is None:\n             date_type = self.get_date_list_period()\n \n-        date_list = queryset.dates(date_field, date_type)[::-1]\n+        date_list = queryset.dates(date_field, date_type, ordering)\n         if date_list is not None and not date_list and not allow_empty:\n             name = force_text(queryset.model._meta.verbose_name_plural)\n             raise Http404(_(\"No %(verbose_name_plural)s available\") %\n@@ -409,7 +409,7 @@ def get_dated_items(self):\n         Return (date_list, items, extra_context) for this request.\n         \"\"\"\n         qs = self.get_dated_queryset(ordering='-%s' % self.get_date_field())\n-        date_list = self.get_date_list(qs)\n+        date_list = self.get_date_list(qs, ordering='DESC')\n \n         if not date_list:\n             qs = qs.none()"
        },
        {
            "sha": "561e525e704927889eb61afd56c507d5dba0c6e0",
            "filename": "docs/ref/class-based-views/mixins-date-based.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/baa33cd8faa16737524b1ac355802a10dd63571c/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/baa33cd8faa16737524b1ac355802a10dd63571c/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt?ref=baa33cd8faa16737524b1ac355802a10dd63571c",
            "patch": "@@ -318,12 +318,16 @@ BaseDateListView\n         Returns the aggregation period for ``date_list``. Returns\n         :attr:`~BaseDateListView.date_list_period` by default.\n \n-    .. method:: get_date_list(queryset, date_type=None)\n+    .. method:: get_date_list(queryset, date_type=None, ordering='ASC')\n \n         Returns the list of dates of type ``date_type`` for which ``queryset``\n         contains entries. For example, ``get_date_list(qs, 'year')`` will\n         return the list of years for which ``qs`` has entries. If\n         ``date_type`` isn't provided, the result of\n-        :meth:`BaseDateListView.get_date_list_period` is used. See\n-        :meth:`~django.db.models.query.QuerySet.dates()` for the ways that the\n-        ``date_type`` argument can be used.\n+        :meth:`~BaseDateListView.get_date_list_period` is used. ``date_type``\n+        and ``ordering`` are simply passed to\n+        :meth:`QuerySet.dates()<django.db.models.query.QuerySet.dates>`.\n+\n+        .. versionchanged:: 1.5\n+            The ``ordering`` parameter was added, and the default order was\n+            changed to ascending."
        },
        {
            "sha": "528a44c5a1a3eaef0af88cf126af18e4bd781a1c",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/baa33cd8faa16737524b1ac355802a10dd63571c/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/baa33cd8faa16737524b1ac355802a10dd63571c/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=baa33cd8faa16737524b1ac355802a10dd63571c",
            "patch": "@@ -152,6 +152,21 @@ year|date:\"Y\" }}``.\n ``next_year`` and ``previous_year`` were also added in the context. They are\n calculated according to ``allow_empty`` and ``allow_future``.\n \n+Context in year and month archive class-based views\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:class:`~django.views.generic.dates.YearArchiveView` and\n+:class:`~django.views.generic.dates.MonthArchiveView` were documented to\n+provide a ``date_list`` sorted in ascending order in the context, like their\n+function-based predecessors, but it actually was in descending order. In 1.5,\n+the documented order was restored. You may want to add (or remove) the\n+``reversed`` keyword when you're iterating on ``date_list`` in a template::\n+\n+    {% for date in date_list reversed %}\n+\n+:class:`~django.views.generic.dates.ArchiveIndexView` still provides a\n+``date_list`` in descending order.\n+\n Context in TemplateView\n ~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "0c565daf9f3d6c7cfead198c6319715be46d3935",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 35,
            "deletions": 15,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/baa33cd8faa16737524b1ac355802a10dd63571c/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/baa33cd8faa16737524b1ac355802a10dd63571c/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=baa33cd8faa16737524b1ac355802a10dd63571c",
            "patch": "@@ -23,29 +23,30 @@\n         \"time zone, but your operating system isn't able to do that.\")\n \n \n+def _make_books(n, base_date):\n+    for i in range(n):\n+        b = Book.objects.create(\n+            name='Book %d' % i,\n+            slug='book-%d' % i,\n+            pages=100+i,\n+            pubdate=base_date - datetime.timedelta(days=i))\n+\n class ArchiveIndexViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'\n \n-    def _make_books(self, n, base_date):\n-        for i in range(n):\n-            b = Book.objects.create(\n-                name='Book %d' % i,\n-                slug='book-%d' % i,\n-                pages=100+i,\n-                pubdate=base_date - datetime.timedelta(days=1))\n \n     def test_archive_view(self):\n         res = self.client.get('/dates/books/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'year')[::-1])\n+        self.assertEqual(list(res.context['date_list']), list(Book.objects.dates('pubdate', 'year', 'DESC')))\n         self.assertEqual(list(res.context['latest']), list(Book.objects.all()))\n         self.assertTemplateUsed(res, 'generic_views/book_archive.html')\n \n     def test_archive_view_context_object_name(self):\n         res = self.client.get('/dates/books/context_object_name/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'year')[::-1])\n+        self.assertEqual(list(res.context['date_list']), list(Book.objects.dates('pubdate', 'year', 'DESC')))\n         self.assertEqual(list(res.context['thingies']), list(Book.objects.all()))\n         self.assertFalse('latest' in res.context)\n         self.assertTemplateUsed(res, 'generic_views/book_archive.html')\n@@ -65,14 +66,14 @@ def test_allow_empty_archive_view(self):\n     def test_archive_view_template(self):\n         res = self.client.get('/dates/books/template_name/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'year')[::-1])\n+        self.assertEqual(list(res.context['date_list']), list(Book.objects.dates('pubdate', 'year', 'DESC')))\n         self.assertEqual(list(res.context['latest']), list(Book.objects.all()))\n         self.assertTemplateUsed(res, 'generic_views/list.html')\n \n     def test_archive_view_template_suffix(self):\n         res = self.client.get('/dates/books/template_name_suffix/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'year')[::-1])\n+        self.assertEqual(list(res.context['date_list']), list(Book.objects.dates('pubdate', 'year', 'DESC')))\n         self.assertEqual(list(res.context['latest']), list(Book.objects.all()))\n         self.assertTemplateUsed(res, 'generic_views/book_detail.html')\n \n@@ -82,13 +83,13 @@ def test_archive_view_invalid(self):\n     def test_archive_view_by_month(self):\n         res = self.client.get('/dates/books/by_month/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'month')[::-1])\n+        self.assertEqual(list(res.context['date_list']), list(Book.objects.dates('pubdate', 'month', 'DESC')))\n \n     def test_paginated_archive_view(self):\n-        self._make_books(20, base_date=datetime.date.today())\n+        _make_books(20, base_date=datetime.date.today())\n         res = self.client.get('/dates/books/paginated/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertEqual(res.context['date_list'], Book.objects.dates('pubdate', 'year')[::-1])\n+        self.assertEqual(list(res.context['date_list']), list(Book.objects.dates('pubdate', 'year', 'DESC')))\n         self.assertEqual(list(res.context['latest']), list(Book.objects.all()[0:10]))\n         self.assertTemplateUsed(res, 'generic_views/book_archive.html')\n \n@@ -99,7 +100,7 @@ def test_paginated_archive_view(self):\n \n     def test_paginated_archive_view_does_not_load_entire_table(self):\n         # Regression test for #18087\n-        self._make_books(20, base_date=datetime.date.today())\n+        _make_books(20, base_date=datetime.date.today())\n         # 1 query for years list + 1 query for books\n         with self.assertNumQueries(2):\n             self.client.get('/dates/books/')\n@@ -124,6 +125,13 @@ def test_aware_datetime_archive_view(self):\n         res = self.client.get('/dates/booksignings/')\n         self.assertEqual(res.status_code, 200)\n \n+    def test_date_list_order(self):\n+        \"\"\"date_list should be sorted descending in index\"\"\"\n+        _make_books(5, base_date=datetime.date(2011, 12, 25))\n+        res = self.client.get('/dates/books/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(list(res.context['date_list']), list(reversed(sorted(res.context['date_list']))))\n+\n \n class YearArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n@@ -202,6 +210,12 @@ def test_aware_datetime_year_view(self):\n         res = self.client.get('/dates/booksignings/2008/')\n         self.assertEqual(res.status_code, 200)\n \n+    def test_date_list_order(self):\n+        \"\"\"date_list should be sorted ascending in year view\"\"\"\n+        _make_books(10, base_date=datetime.date(2011, 12, 25))\n+        res = self.client.get('/dates/books/2011/')\n+        self.assertEqual(list(res.context['date_list']), list(sorted(res.context['date_list'])))\n+\n \n class MonthArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n@@ -322,6 +336,12 @@ def test_aware_datetime_month_view(self):\n         res = self.client.get('/dates/booksignings/2008/apr/')\n         self.assertEqual(res.status_code, 200)\n \n+    def test_date_list_order(self):\n+        \"\"\"date_list should be sorted ascending in month view\"\"\"\n+        _make_books(10, base_date=datetime.date(2011, 12, 25))\n+        res = self.client.get('/dates/books/2011/dec/')\n+        self.assertEqual(list(res.context['date_list']), list(sorted(res.context['date_list'])))\n+\n \n class WeekArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']"
        }
    ],
    "stats": {
        "total": 83,
        "additions": 61,
        "deletions": 22
    }
}