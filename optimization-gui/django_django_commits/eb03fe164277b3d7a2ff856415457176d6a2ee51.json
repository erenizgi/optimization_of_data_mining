{
    "author": "claudep",
    "message": "Added introspection tests for most of Django model fields",
    "sha": "eb03fe164277b3d7a2ff856415457176d6a2ee51",
    "files": [
        {
            "sha": "08870af56bb62a8e33d2fee193abbb97695e59e1",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eb03fe164277b3d7a2ff856415457176d6a2ee51/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/eb03fe164277b3d7a2ff856415457176d6a2ee51/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=eb03fe164277b3d7a2ff856415457176d6a2ee51",
            "patch": "@@ -205,7 +205,7 @@ def get_field_type(self, connection, table_name, row):\n \n         # Add max_length for all CharFields.\n         if field_type == 'CharField' and row[3]:\n-            field_params['max_length'] = row[3]\n+            field_params['max_length'] = int(row[3])\n \n         if field_type == 'DecimalField':\n             field_params['max_digits'] = row[4]"
        },
        {
            "sha": "ae14c78eb7f224c7223bd8234c5c8cacf2ba6726",
            "filename": "tests/regressiontests/inspectdb/models.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/eb03fe164277b3d7a2ff856415457176d6a2ee51/tests%2Fregressiontests%2Finspectdb%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eb03fe164277b3d7a2ff856415457176d6a2ee51/tests%2Fregressiontests%2Finspectdb%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Fmodels.py?ref=eb03fe164277b3d7a2ff856415457176d6a2ee51",
            "patch": "@@ -29,3 +29,28 @@ class SpecialColumnName(models.Model):\n     field_field_2 = models.IntegerField(db_column='__field')\n     # Other chars\n     prc_x = models.IntegerField(db_column='prc(%) x')\n+\n+class ColumnTypes(models.Model):\n+    id = models.AutoField(primary_key=True)\n+    field1 = models.BigIntegerField()\n+    field2 = models.BooleanField()\n+    field3 = models.CharField(max_length=10)\n+    field4 = models.CommaSeparatedIntegerField(max_length=99)\n+    field5 = models.DateField()\n+    field6 = models.DateTimeField()\n+    field7 = models.DecimalField(max_digits=6, decimal_places=1)\n+    field8 = models.EmailField()\n+    field9 = models.FileField(upload_to=\"unused\")\n+    field10 = models.FilePathField()\n+    field11 = models.FloatField()\n+    field12 = models.IntegerField()\n+    field13 = models.IPAddressField()\n+    field14 = models.GenericIPAddressField(protocol=\"ipv4\")\n+    field15 = models.NullBooleanField()\n+    field16 = models.PositiveIntegerField()\n+    field17 = models.PositiveSmallIntegerField()\n+    field18 = models.SlugField()\n+    field19 = models.SmallIntegerField()\n+    field20 = models.TextField()\n+    field21 = models.TimeField()\n+    field22 = models.URLField()"
        },
        {
            "sha": "5fa1eb1095cdc280451caf791bac43c59d1dff95",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/eb03fe164277b3d7a2ff856415457176d6a2ee51/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eb03fe164277b3d7a2ff856415457176d6a2ee51/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=eb03fe164277b3d7a2ff856415457176d6a2ee51",
            "patch": "@@ -1,5 +1,7 @@\n from __future__ import unicode_literals\n \n+import re\n+\n from django.core.management import call_command\n from django.db import connection\n from django.test import TestCase, skipUnlessDBFeature\n@@ -21,6 +23,78 @@ def test_stealth_table_name_filter_option(self):\n         # inspected\n         self.assertNotIn(\"class DjangoContentType(models.Model):\", out.getvalue(), msg=error_message)\n \n+    def test_field_types(self):\n+        \"\"\"Test introspection of various Django field types\"\"\"\n+        out = StringIO()\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_columntypes'),\n+                     stdout=out)\n+        output = out.getvalue()\n+        def assertFieldType(name, definition):\n+            out_def = re.search(r'^\\s*%s = (models.*)$' % name, output, re.MULTILINE).groups()[0]\n+            self.assertEqual(definition, out_def)\n+\n+        assertFieldType('id', \"models.IntegerField(primary_key=True)\")\n+        assertFieldType('field1', \"models.BigIntegerField()\")\n+        if connection.vendor == 'mysql':\n+            # No native boolean type on MySQL\n+            assertFieldType('field2', \"models.IntegerField()\")\n+        else:\n+            assertFieldType('field2', \"models.BooleanField()\")\n+        assertFieldType('field3', \"models.CharField(max_length=10)\")\n+        # CommaSeparatedIntegerField\n+        assertFieldType('field4', \"models.CharField(max_length=99)\")\n+        assertFieldType('field5', \"models.DateField()\")\n+        assertFieldType('field6', \"models.DateTimeField()\")\n+        if connection.vendor == 'sqlite':\n+            # Ticket #5014\n+            assertFieldType('field7', \"models.DecimalField(max_digits=None, decimal_places=None)\")\n+        elif connection.vendor == 'mysql':\n+            pass # Ticket #5014\n+        else:\n+            assertFieldType('field7', \"models.DecimalField(max_digits=6, decimal_places=1)\")\n+        # EmailField\n+        assertFieldType('field8', \"models.CharField(max_length=75)\")\n+        # FileField\n+        assertFieldType('field9', \"models.CharField(max_length=100)\")\n+        # FilePathField\n+        assertFieldType('field10', \"models.CharField(max_length=100)\")\n+        assertFieldType('field11', \"models.FloatField()\")\n+        assertFieldType('field12', \"models.IntegerField()\")\n+        if connection.vendor == 'postgresql':\n+            # Only PostgreSQL has a specific type\n+            assertFieldType('field13', \"models.GenericIPAddressField()\")\n+            assertFieldType('field14', \"models.GenericIPAddressField()\")\n+        else:\n+            assertFieldType('field13', \"models.CharField(max_length=15)\")\n+            assertFieldType('field14', \"models.CharField(max_length=39)\")\n+        # Ticket #19341\n+        #assertFieldType('field15', \"models.NullBooleanField()\")\n+        if connection.vendor == 'sqlite':\n+            assertFieldType('field16', \"models.PositiveIntegerField()\")\n+            assertFieldType('field17', \"models.PositiveSmallIntegerField()\")\n+        else:\n+            # 'unsigned' property undetected on other backends\n+            assertFieldType('field16', \"models.IntegerField()\")\n+            if connection.vendor == 'postgresql':\n+                assertFieldType('field17', \"models.SmallIntegerField()\")\n+            else:\n+                assertFieldType('field17', \"models.IntegerField()\")\n+        # SlugField\n+        assertFieldType('field18', \"models.CharField(max_length=50)\")\n+        if connection.vendor in ('sqlite', 'postgresql'):\n+            assertFieldType('field19', \"models.SmallIntegerField()\")\n+        else:\n+            assertFieldType('field19', \"models.IntegerField()\")\n+        assertFieldType('field20', \"models.TextField()\")\n+        if connection.vendor == 'mysql':\n+            # Ticket #19709\n+            assertFieldType('field21', \"models.TextField() # This field type is a guess.\")\n+        else:\n+            assertFieldType('field21', \"models.TimeField()\")\n+        # URLField\n+        assertFieldType('field22', \"models.CharField(max_length=200)\")\n+\n     @skipUnlessDBFeature('can_introspect_foreign_keys')\n     def test_attribute_name_not_python_keyword(self):\n         out = StringIO()"
        }
    ],
    "stats": {
        "total": 101,
        "additions": 100,
        "deletions": 1
    }
}