{
    "author": "ramiro",
    "message": "Fixed #14812 -- Made parsing of the If-Modified-Since HTTP header more robust in presence of malformed values when serving static content. Thanks shaohua for the report, and alexey.smolsky@gmail.com for a similar report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14753 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0714b0f39033a51e447bc1b3b03ffee6f9228105",
    "files": [
        {
            "sha": "694591c996624cb28870c25d45e41d35afd446c3",
            "filename": "django/contrib/staticfiles/views.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/0714b0f39033a51e447bc1b3b03ffee6f9228105/django%2Fcontrib%2Fstaticfiles%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/0714b0f39033a51e447bc1b3b03ffee6f9228105/django%2Fcontrib%2Fstaticfiles%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fviews.py?ref=0714b0f39033a51e447bc1b3b03ffee6f9228105",
            "patch": "@@ -150,7 +150,10 @@ def was_modified_since(header=None, mtime=0, size=0):\n             raise ValueError\n         matches = re.match(r\"^([^;]+)(; length=([0-9]+))?$\", header,\n                            re.IGNORECASE)\n-        header_mtime = mktime_tz(parsedate_tz(matches.group(1)))\n+        header_date = parsedate_tz(matches.group(1))\n+        if header_date is None:\n+            raise ValueError\n+        header_mtime = mktime_tz(header_date)\n         header_len = matches.group(3)\n         if header_len and int(header_len) != size:\n             raise ValueError"
        },
        {
            "sha": "cd2968796705de2332f478ff0c85d897d83287d1",
            "filename": "tests/regressiontests/views/tests/static.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/0714b0f39033a51e447bc1b3b03ffee6f9228105/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/0714b0f39033a51e447bc1b3b03ffee6f9228105/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py?ref=0714b0f39033a51e447bc1b3b03ffee6f9228105",
            "patch": "@@ -69,3 +69,17 @@ def test_invalid_if_modified_since(self):\n         self.assertEquals(len(response.content),\n                           int(response['Content-Length']))\n \n+    def test_invalid_if_modified_since2(self):\n+        \"\"\"Handle even more bogus If-Modified-Since values gracefully\n+\n+        Assume that a file is modified since an invalid timestamp as per RFC\n+        2616, section 14.25.\n+        \"\"\"\n+        file_name = 'file.txt'\n+        invalid_date = ': 1291108438, Wed, 20 Oct 2010 14:05:00 GMT'\n+        response = self.client.get('/views/site_media/%s' % file_name,\n+                                   HTTP_IF_MODIFIED_SINCE=invalid_date)\n+        file = open(path.join(media_dir, file_name))\n+        self.assertEquals(file.read(), response.content)\n+        self.assertEquals(len(response.content),\n+                          int(response['Content-Length']))"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 18,
        "deletions": 1
    }
}