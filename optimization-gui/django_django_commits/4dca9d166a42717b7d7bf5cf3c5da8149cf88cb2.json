{
    "author": "jphalip",
    "message": "Added more thorough Selenium tests for the admin horizontal/vertical filter widgets.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17648 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2",
    "files": [
        {
            "sha": "9ad817d4a7d42f6ef653215855d5da1e8a8e9896",
            "filename": "django/contrib/admin/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2/django%2Fcontrib%2Fadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2/django%2Fcontrib%2Fadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftests.py?ref=4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2",
            "patch": "@@ -94,4 +94,12 @@ def assertSelectOptions(self, selector, values):\n         actual_values = []\n         for option in options:\n             actual_values.append(option.get_attribute('value'))\n-        self.assertEqual(values, actual_values)\n\\ No newline at end of file\n+        self.assertEqual(values, actual_values)\n+\n+    def has_css_class(self, selector, klass):\n+        \"\"\"\n+        Returns True if the element identified by `selector` has the CSS class\n+        `klass`.\n+        \"\"\"\n+        return (self.selenium.find_element_by_css_selector(selector)\n+                .get_attribute('class').find(klass) != -1)\n\\ No newline at end of file"
        },
        {
            "sha": "866e5a7db5146a06898753d022ec0e0ad28c5f99",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 81,
            "deletions": 3,
            "changes": 84,
            "blob_url": "https://github.com/django/django/blob/4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=4dca9d166a42717b7d7bf5cf3c5da8149cf88cb2",
            "patch": "@@ -480,7 +480,19 @@ def setUp(self):\n         self.school = models.School.objects.create(name='School of Awesome')\n         super(HorizontalVerticalFilterSeleniumFirefoxTests, self).setUp()\n \n-    def execute_basic_operations(self, field_name, mode):\n+    def assertActiveButtons(self, mode, field_name, choose, remove,\n+                             choose_all=None, remove_all=None):\n+        choose_link = '#id_%s_add_link' % field_name\n+        choose_all_link = '#id_%s_add_all_link' % field_name\n+        remove_link = '#id_%s_remove_link' % field_name\n+        remove_all_link = '#id_%s_remove_all_link' % field_name\n+        self.assertEqual(self.has_css_class(choose_link, 'active'), choose)\n+        self.assertEqual(self.has_css_class(remove_link, 'active'), remove)\n+        if mode == 'horizontal':\n+            self.assertEqual(self.has_css_class(choose_all_link, 'active'), choose_all)\n+            self.assertEqual(self.has_css_class(remove_all_link, 'active'), remove_all)\n+\n+    def execute_basic_operations(self, mode, field_name):\n         from_box = '#id_%s_from' % field_name\n         to_box = '#id_%s_to' % field_name\n         choose_link = 'id_%s_add_link' % field_name\n@@ -495,6 +507,7 @@ def execute_basic_operations(self, field_name, mode):\n                          str(self.jenny.id), str(self.john.id)])\n         self.assertSelectOptions(to_box,\n                         [str(self.lisa.id), str(self.peter.id)])\n+        self.assertActiveButtons(mode, field_name, False, False, True, True)\n \n         # Click 'Choose all' --------------------------------------------------\n         if mode == 'horizontal':\n@@ -511,6 +524,7 @@ def execute_basic_operations(self, field_name, mode):\n                          str(self.arthur.id), str(self.bob.id),\n                          str(self.cliff.id), str(self.jason.id),\n                          str(self.jenny.id), str(self.john.id)])\n+        self.assertActiveButtons(mode, field_name, False, False, False, True)\n \n         # Click 'Remove all' --------------------------------------------------\n         if mode == 'horizontal':\n@@ -527,13 +541,16 @@ def execute_basic_operations(self, field_name, mode):\n                          str(self.cliff.id), str(self.jason.id),\n                          str(self.jenny.id), str(self.john.id)])\n         self.assertSelectOptions(to_box, [])\n+        self.assertActiveButtons(mode, field_name, False, False, True, False)\n \n         # Choose some options ------------------------------------------------\n         self.get_select_option(from_box, str(self.lisa.id)).click()\n         self.get_select_option(from_box, str(self.jason.id)).click()\n         self.get_select_option(from_box, str(self.bob.id)).click()\n         self.get_select_option(from_box, str(self.john.id)).click()\n+        self.assertActiveButtons(mode, field_name, True, False, True, False)\n         self.selenium.find_element_by_id(choose_link).click()\n+        self.assertActiveButtons(mode, field_name, False, False, True, True)\n \n         self.assertSelectOptions(from_box,\n                         [str(self.peter.id), str(self.arthur.id),\n@@ -545,7 +562,9 @@ def execute_basic_operations(self, field_name, mode):\n         # Remove some options -------------------------------------------------\n         self.get_select_option(to_box, str(self.lisa.id)).click()\n         self.get_select_option(to_box, str(self.bob.id)).click()\n+        self.assertActiveButtons(mode, field_name, False, True, True, True)\n         self.selenium.find_element_by_id(remove_link).click()\n+        self.assertActiveButtons(mode, field_name, False, False, True, True)\n \n         self.assertSelectOptions(from_box,\n                         [str(self.peter.id), str(self.arthur.id),\n@@ -575,8 +594,8 @@ def test_basic(self):\n         self.selenium.get(\n             '%s%s' % (self.live_server_url, '/admin_widgets/school/%s/' % self.school.id))\n \n-        self.execute_basic_operations('students', 'vertical')\n-        self.execute_basic_operations('alumni', 'horizontal')\n+        self.execute_basic_operations('vertical', 'students')\n+        self.execute_basic_operations('horizontal', 'alumni')\n \n         # Save and check that everything is properly stored in the database ---\n         self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n@@ -586,5 +605,64 @@ def test_basic(self):\n         self.assertEqual(list(self.school.alumni.all()),\n                          [self.arthur, self.cliff, self.jason, self.john])\n \n+    def test_filter(self):\n+        \"\"\"\n+        Ensure that typing in the search box filters out options displayed in\n+        the 'from' box.\n+        \"\"\"\n+        from selenium.webdriver.common.keys import Keys\n+\n+        self.school.students = [self.lisa, self.peter]\n+        self.school.alumni = [self.lisa, self.peter]\n+        self.school.save()\n+\n+        self.admin_login(username='super', password='secret', login_url='/')\n+        self.selenium.get(\n+            '%s%s' % (self.live_server_url, '/admin_widgets/school/%s/' % self.school.id))\n+\n+\n+        for field_name in ['students', 'alumni']:\n+            from_box = '#id_%s_from' % field_name\n+            to_box = '#id_%s_to' % field_name\n+            choose_link = 'id_%s_add_link' % field_name\n+            input = self.selenium.find_element_by_css_selector('#id_%s_input' % field_name)\n+\n+            # Initial values\n+            self.assertSelectOptions(from_box,\n+                        [str(self.arthur.id), str(self.bob.id),\n+                         str(self.cliff.id), str(self.jason.id),\n+                         str(self.jenny.id), str(self.john.id)])\n+\n+            # Typing in some characters filters out non-matching options\n+            input.send_keys('a')\n+            self.assertSelectOptions(from_box, [str(self.arthur.id), str(self.jason.id)])\n+            input.send_keys('R')\n+            self.assertSelectOptions(from_box, [str(self.arthur.id)])\n+\n+            # Clearing the text box makes the other options reappear\n+            input.send_keys([Keys.BACK_SPACE])\n+            self.assertSelectOptions(from_box, [str(self.arthur.id), str(self.jason.id)])\n+            input.send_keys([Keys.BACK_SPACE])\n+            self.assertSelectOptions(from_box,\n+                        [str(self.arthur.id), str(self.bob.id),\n+                         str(self.cliff.id), str(self.jason.id),\n+                         str(self.jenny.id), str(self.john.id)])\n+\n+            # Check that chosing a filtered option sends it properly to the\n+            # 'to' box.\n+            input.send_keys('a')\n+            self.assertSelectOptions(from_box, [str(self.arthur.id), str(self.jason.id)])\n+            self.get_select_option(from_box, str(self.jason.id)).click()\n+            self.selenium.find_element_by_id(choose_link).click()\n+            self.assertSelectOptions(from_box, [str(self.arthur.id)])\n+            input.send_keys([Keys.BACK_SPACE]) # Clear text box\n+            self.assertSelectOptions(from_box,\n+                        [str(self.arthur.id), str(self.bob.id),\n+                         str(self.cliff.id), str(self.jenny.id),\n+                         str(self.john.id)])\n+            self.assertSelectOptions(to_box,\n+                        [str(self.lisa.id), str(self.peter.id),\n+                         str(self.jason.id)])\n+\n class HorizontalVerticalFilterSeleniumChromeTests(HorizontalVerticalFilterSeleniumFirefoxTests):\n     webdriver_class = 'selenium.webdriver.chrome.webdriver.WebDriver'\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 94,
        "additions": 90,
        "deletions": 4
    }
}