{
    "author": "claudep",
    "message": "Fixed #19125 -- The startproject command should validate the name earlier\n\nThanks ≈Åukasz Rekucki for the report and the patch.",
    "sha": "9893fa12b735f3f47b35d4063d86dddf3145cb25",
    "files": [
        {
            "sha": "692ad09a43044c69de3bc9952cff644ea9564774",
            "filename": "django/core/management/commands/startapp.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/9893fa12b735f3f47b35d4063d86dddf3145cb25/django%2Fcore%2Fmanagement%2Fcommands%2Fstartapp.py",
            "raw_url": "https://github.com/django/django/raw/9893fa12b735f3f47b35d4063d86dddf3145cb25/django%2Fcore%2Fmanagement%2Fcommands%2Fstartapp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fstartapp.py?ref=9893fa12b735f3f47b35d4063d86dddf3145cb25",
            "patch": "@@ -9,8 +9,7 @@ class Command(TemplateCommand):\n             \"directory.\")\n \n     def handle(self, app_name=None, target=None, **options):\n-        if app_name is None:\n-            raise CommandError(\"you must provide an app name\")\n+        self.validate_name(app_name, \"app\")\n \n         # Check that the app_name cannot be imported.\n         try:"
        },
        {
            "sha": "b143e6c380efd57dd48c8e8d0e29e93756a071a2",
            "filename": "django/core/management/commands/startproject.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/9893fa12b735f3f47b35d4063d86dddf3145cb25/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py",
            "raw_url": "https://github.com/django/django/raw/9893fa12b735f3f47b35d4063d86dddf3145cb25/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py?ref=9893fa12b735f3f47b35d4063d86dddf3145cb25",
            "patch": "@@ -10,8 +10,7 @@ class Command(TemplateCommand):\n             \"given directory.\")\n \n     def handle(self, project_name=None, target=None, *args, **options):\n-        if project_name is None:\n-            raise CommandError(\"you must provide a project name\")\n+        self.validate_name(project_name, \"project\")\n \n         # Check that the project_name cannot be imported.\n         try:"
        },
        {
            "sha": "927dbc13acb6860725d46e382b0ce9cbd0b548a5",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 15,
            "deletions": 10,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/9893fa12b735f3f47b35d4063d86dddf3145cb25/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/9893fa12b735f3f47b35d4063d86dddf3145cb25/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=9893fa12b735f3f47b35d4063d86dddf3145cb25",
            "patch": "@@ -67,16 +67,7 @@ def handle(self, app_or_project, name, target=None, **options):\n         self.paths_to_remove = []\n         self.verbosity = int(options.get('verbosity'))\n \n-        # If it's not a valid directory name.\n-        if not re.search(r'^[_a-zA-Z]\\w*$', name):\n-            # Provide a smart error message, depending on the error.\n-            if not re.search(r'^[_a-zA-Z]', name):\n-                message = ('make sure the name begins '\n-                           'with a letter or underscore')\n-            else:\n-                message = 'use only numbers, letters and underscores'\n-            raise CommandError(\"%r is not a valid %s name. Please %s.\" %\n-                               (name, app_or_project, message))\n+        self.validate_name(name, app_or_project)\n \n         # if some directory is given, make sure it's nicely expanded\n         if target is None:\n@@ -211,6 +202,20 @@ def handle_template(self, template, subdir):\n         raise CommandError(\"couldn't handle %s template %s.\" %\n                            (self.app_or_project, template))\n \n+    def validate_name(self, name, app_or_project):\n+        if name is None:\n+            raise CommandError(\"you must provide %s %s name\" % (\n+                \"an\" if app_or_project == \"app\" else \"a\", app_or_project))\n+        # If it's not a valid directory name.\n+        if not re.search(r'^[_a-zA-Z]\\w*$', name):\n+            # Provide a smart error message, depending on the error.\n+            if not re.search(r'^[_a-zA-Z]', name):\n+                message = 'make sure the name begins with a letter or underscore'\n+            else:\n+                message = 'use only numbers, letters and underscores'\n+            raise CommandError(\"%r is not a valid %s name. Please %s.\" %\n+                               (name, app_or_project, message))\n+\n     def download(self, url):\n         \"\"\"\n         Downloads the given URL and returns the file name."
        },
        {
            "sha": "df2326e1631a24d110db3a2b18303fa1ad5e6fb1",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/9893fa12b735f3f47b35d4063d86dddf3145cb25/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/9893fa12b735f3f47b35d4063d86dddf3145cb25/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=9893fa12b735f3f47b35d4063d86dddf3145cb25",
            "patch": "@@ -1430,13 +1430,15 @@ def test_simple_project(self):\n \n     def test_invalid_project_name(self):\n         \"Make sure the startproject management command validates a project name\"\n-        args = ['startproject', '7testproject']\n-        testproject_dir = os.path.join(test_dir, '7testproject')\n-        self.addCleanup(shutil.rmtree, testproject_dir, True)\n-\n-        out, err = self.run_django_admin(args)\n-        self.assertOutput(err, \"Error: '7testproject' is not a valid project name. Please make sure the name begins with a letter or underscore.\")\n-        self.assertFalse(os.path.exists(testproject_dir))\n+        for bad_name in ('7testproject', '../testproject'):\n+            args = ['startproject', bad_name]\n+            testproject_dir = os.path.join(test_dir, bad_name)\n+            self.addCleanup(shutil.rmtree, testproject_dir, True)\n+\n+            out, err = self.run_django_admin(args)\n+            self.assertOutput(err, \"Error: '%s' is not a valid project name. \"\n+                \"Please make sure the name begins with a letter or underscore.\" % bad_name)\n+            self.assertFalse(os.path.exists(testproject_dir))\n \n     def test_simple_project_different_directory(self):\n         \"Make sure the startproject management command creates a project in a specific directory\""
        }
    ],
    "stats": {
        "total": 47,
        "additions": 26,
        "deletions": 21
    }
}