{
    "author": "jezdez",
    "message": "Fixed #16958 -- Correctly use the queryset method in the auth app's UserAdmin class. Thanks, mpaolini.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17474 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe",
    "files": [
        {
            "sha": "f14b3d219b7d69a3a3f45c01e73c10d6d787d722",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe",
            "patch": "@@ -117,7 +117,7 @@ def add_view(self, request, form_url='', extra_context=None):\n     def user_change_password(self, request, id, form_url=''):\n         if not self.has_change_permission(request):\n             raise PermissionDenied\n-        user = get_object_or_404(self.model, pk=id)\n+        user = get_object_or_404(self.queryset(request), pk=id)\n         if request.method == 'POST':\n             form = self.change_password_form(user, request.POST)\n             if form.is_valid():"
        },
        {
            "sha": "d205e0e2909790700991a3fddfa19eb3243c30c2",
            "filename": "tests/regressiontests/admin_views/customadmin.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe/tests%2Fregressiontests%2Fadmin_views%2Fcustomadmin.py",
            "raw_url": "https://github.com/django/django/raw/bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe/tests%2Fregressiontests%2Fadmin_views%2Fcustomadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fcustomadmin.py?ref=bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe",
            "patch": "@@ -6,6 +6,8 @@\n from django.conf.urls import patterns\n from django.contrib import admin\n from django.http import HttpResponse\n+from django.contrib.auth.models import User\n+from django.contrib.auth.admin import UserAdmin\n \n from . import models, forms, admin as base_admin\n \n@@ -30,10 +32,19 @@ def get_urls(self):\n     def my_view(self, request):\n         return HttpResponse(\"Django is a magical pony!\")\n \n+\n+class UserLimitedAdmin(UserAdmin):\n+    # used for testing password change on a user not in queryset\n+    def queryset(self, request):\n+        qs = super(UserLimitedAdmin, self).queryset(request)\n+        return qs.filter(is_superuser=False)\n+\n+\n site = Admin2(name=\"admin2\")\n \n site.register(models.Article, base_admin.ArticleAdmin)\n site.register(models.Section, inlines=[base_admin.ArticleInline])\n site.register(models.Thing, base_admin.ThingAdmin)\n site.register(models.Fabric, base_admin.FabricAdmin)\n site.register(models.ChapterXtra1, base_admin.ChapterXtra1Admin)\n+site.register(User, UserLimitedAdmin)"
        },
        {
            "sha": "fc46f7e8ae89ea6324cabdbdae49773c16ac97da",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=bc8875e37c2eb5e2fa3b86bcf620a6a97f955cfe",
            "patch": "@@ -2946,6 +2946,11 @@ def test_readonly_manytomany(self):\n         response = self.client.get('/test_admin/admin/admin_views/pizza/add/')\n         self.assertEqual(response.status_code, 200)\n \n+    def test_user_password_change_limited_queryset(self):\n+        su = User.objects.filter(is_superuser=True)[0]\n+        response = self.client.get('/test_admin/admin2/auth/user/%s/password/' % su.pk)\n+        self.assertEquals(response.status_code, 404)\n+\n \n class RawIdFieldsTest(TestCase):\n     urls = \"regressiontests.admin_views.urls\""
        }
    ],
    "stats": {
        "total": 18,
        "additions": 17,
        "deletions": 1
    }
}