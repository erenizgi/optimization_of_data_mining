{
    "author": "ramiro",
    "message": "Modified makemessages so it creates .pot files once per invocation.\n\nIt creates a `locale/django.pot` file once instead of one\n`locale/<locale_code>/django.pot` file for every locale involved.\n\nThanks Michal Čihař for the report and patch.",
    "sha": "248aee16066b2a336f16c844580cf043d853874b",
    "files": [
        {
            "sha": "2b2755d8d1383343e7988332452250a31919eec2",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/248aee16066b2a336f16c844580cf043d853874b/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/248aee16066b2a336f16c844580cf043d853874b/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=248aee16066b2a336f16c844580cf043d853874b",
            "patch": "@@ -234,8 +234,6 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n         \"#. #-#-#-#-#  %s.pot (PACKAGE VERSION)  #-#-#-#-#\\n\" % domain, \"\")\n     with open(pofile, 'w') as fp:\n         fp.write(msgs)\n-    if not keep_pot:\n-        os.unlink(potfile)\n     if no_obsolete:\n         msgs, errors, status = _popen(\n             'msgattrib %s %s -o \"%s\" --no-obsolete \"%s\"' %\n@@ -314,6 +312,16 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n     wrap = '--no-wrap' if no_wrap else ''\n     location = '--no-location' if no_location else ''\n \n+    potfile = os.path.join(localedir, '%s.pot' % str(domain))\n+\n+    if os.path.exists(potfile):\n+        os.unlink(potfile)\n+\n+    for dirpath, file in find_files(\".\", ignore_patterns, verbosity,\n+            stdout, symlinks=symlinks):\n+        process_file(file, dirpath, potfile, domain, verbosity, extensions,\n+                wrap, location, keep_pot, stdout)\n+\n     for locale in locales:\n         if verbosity > 0:\n             stdout.write(\"processing language %s\\n\" % locale)\n@@ -322,20 +330,14 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n             os.makedirs(basedir)\n \n         pofile = os.path.join(basedir, '%s.po' % str(domain))\n-        potfile = os.path.join(basedir, '%s.pot' % str(domain))\n-\n-        if os.path.exists(potfile):\n-            os.unlink(potfile)\n-\n-        for dirpath, file in find_files(\".\", ignore_patterns, verbosity,\n-                stdout, symlinks=symlinks):\n-            process_file(file, dirpath, potfile, domain, verbosity, extensions,\n-                    wrap, location, keep_pot, stdout)\n \n         if os.path.exists(potfile):\n             write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n                     not invoked_for_django, wrap, location, no_obsolete, keep_pot)\n \n+    if not keep_pot:\n+        os.unlink(potfile)\n+\n \n class Command(NoArgsCommand):\n     option_list = NoArgsCommand.option_list + ("
        },
        {
            "sha": "6a8ebc76703a1639745cb7b0b9ce2d13f244b44f",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/248aee16066b2a336f16c844580cf043d853874b/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/248aee16066b2a336f16c844580cf043d853874b/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=248aee16066b2a336f16c844580cf043d853874b",
            "patch": "@@ -297,8 +297,9 @@ def test_no_location_disabled(self):\n \n class KeepPotFileExtractorTests(ExtractorTests):\n \n+    POT_FILE='locale/django.pot'\n+\n     def setUp(self):\n-        self.POT_FILE = self.PO_FILE + 't'\n         super(KeepPotFileExtractorTests, self).setUp()\n \n     def tearDown(self):"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 15,
        "deletions": 12
    }
}