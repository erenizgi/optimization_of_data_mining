{
    "author": "jphalip",
    "message": "Fixed #2879 -- Added support for the integration with Selenium and other in-browser testing frameworks. Also added the first Selenium tests for `contrib.admin`. Many thanks to everyone for their contributions and feedback: Mikeal Rogers, Dirk Datzert, mir, Simon G., Almad, Russell Keith-Magee, Denis Golomazov, devin, robertrv, andrewbadr, Idan Gazit, voidspace, Tom Christie, hjwp2, Adam Nelson, Jannis Leidel, Anssi Kääriäinen, Preston Holmes, Bruno Renié and Jacob Kaplan-Moss.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17241 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2f02a05ffb45be68b4164b4785ff1826833150a3",
    "files": [
        {
            "sha": "2a3f0c3cd1abd58a85f208732b705353c39118c8",
            "filename": "django/contrib/admin/tests.py",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Fcontrib%2Fadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Fcontrib%2Fadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftests.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1,52 @@\n+import sys\n+\n+from django.test import LiveServerTestCase\n+from django.utils.importlib import import_module\n+from django.utils.unittest import SkipTest\n+from django.utils.translation import ugettext as _\n+\n+class AdminSeleniumWebDriverTestCase(LiveServerTestCase):\n+    webdriver_class = 'selenium.webdriver.firefox.webdriver.WebDriver'\n+\n+    @classmethod\n+    def setUpClass(cls):\n+        if sys.version_info < (2, 6):\n+            raise SkipTest('Selenium Webdriver does not support Python < 2.6.')\n+        try:\n+            # Import and start the WebDriver class.\n+            module, attr = cls.webdriver_class.rsplit('.', 1)\n+            mod = import_module(module)\n+            WebDriver = getattr(mod, attr)\n+            cls.selenium = WebDriver()\n+        except Exception:\n+            raise SkipTest('Selenium webdriver \"%s\" not installed or not '\n+                           'operational.' % cls.webdriver_class)\n+        super(AdminSeleniumWebDriverTestCase, cls).setUpClass()\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        super(AdminSeleniumWebDriverTestCase, cls).tearDownClass()\n+        if hasattr(cls, 'selenium'):\n+            cls.selenium.quit()\n+\n+    def admin_login(self, username, password, login_url='/admin/'):\n+        \"\"\"\n+        Helper function to log into the admin.\n+        \"\"\"\n+        self.selenium.get('%s%s' % (self.live_server_url, login_url))\n+        username_input = self.selenium.find_element_by_name('username')\n+        username_input.send_keys(username)\n+        password_input = self.selenium.find_element_by_name('password')\n+        password_input.send_keys(password)\n+        login_text = _('Log in')\n+        self.selenium.find_element_by_xpath(\n+            '//input[@value=\"%s\"]' % login_text).click()\n+\n+    def get_css_value(self, selector, attribute):\n+        \"\"\"\n+        Helper function that returns the value for the CSS attribute of an\n+        DOM element specified by the given selector. Uses the jQuery that ships\n+        with Django.\n+        \"\"\"\n+        return self.selenium.execute_script(\n+            'return django.jQuery(\"%s\").css(\"%s\")' % (selector, attribute))\n\\ No newline at end of file"
        },
        {
            "sha": "ad49184e8a67dba0b512b34db23c4448a0d95a51",
            "filename": "django/core/management/commands/test.py",
            "status": "modified",
            "additions": 27,
            "deletions": 10,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Fcore%2Fmanagement%2Fcommands%2Ftest.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Fcore%2Fmanagement%2Fcommands%2Ftest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Ftest.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -1,20 +1,32 @@\n+import sys\n+import os\n+from optparse import make_option, OptionParser\n+\n from django.conf import settings\n from django.core.management.base import BaseCommand\n-from optparse import make_option, OptionParser\n-import sys\n from django.test.utils import get_runner\n \n class Command(BaseCommand):\n     option_list = BaseCommand.option_list + (\n-        make_option('--noinput', action='store_false', dest='interactive', default=True,\n+        make_option('--noinput',\n+            action='store_false', dest='interactive', default=True,\n             help='Tells Django to NOT prompt the user for input of any kind.'),\n-        make_option('--failfast', action='store_true', dest='failfast', default=False,\n-            help='Tells Django to stop running the test suite after first failed test.'),\n-        make_option('--testrunner', action='store', dest='testrunner',\n-            help='Tells Django to use specified test runner class instead of the one '+\n-                 'specified by the TEST_RUNNER setting.')\n+        make_option('--failfast',\n+            action='store_true', dest='failfast', default=False,\n+            help='Tells Django to stop running the test suite after first '\n+                 'failed test.'),\n+        make_option('--testrunner',\n+            action='store', dest='testrunner',\n+            help='Tells Django to use specified test runner class instead of '\n+                 'the one specified by the TEST_RUNNER setting.'),\n+        make_option('--liveserver',\n+            action='store', dest='liveserver', default=None,\n+            help='Overrides the default address where the live server (used '\n+                 'with LiveServerTestCase) is expected to run from. The '\n+                 'default value is localhost:8081.'),\n     )\n-    help = 'Runs the test suite for the specified applications, or the entire site if no apps are specified.'\n+    help = ('Runs the test suite for the specified applications, or the '\n+            'entire site if no apps are specified.')\n     args = '[appname ...]'\n \n     requires_model_validation = False\n@@ -35,7 +47,8 @@ def run_from_argv(self, argv):\n \n     def create_parser(self, prog_name, subcommand):\n         test_runner_class = get_runner(settings, self.test_runner)\n-        options = self.option_list + getattr(test_runner_class, 'option_list', ())\n+        options = self.option_list + getattr(\n+            test_runner_class, 'option_list', ())\n         return OptionParser(prog=prog_name,\n                             usage=self.usage(subcommand),\n                             version=self.get_version(),\n@@ -48,6 +61,10 @@ def handle(self, *test_labels, **options):\n         TestRunner = get_runner(settings, options.get('testrunner'))\n         options['verbosity'] = int(options.get('verbosity'))\n \n+        if options.get('liveserver') is not None:\n+            os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = options['liveserver']\n+            del options['liveserver']\n+\n         test_runner = TestRunner(**options)\n         failures = test_runner.run_tests(test_labels)\n "
        },
        {
            "sha": "21a4841a6bce52a59a2593fdcb6a69c6d81fa602",
            "filename": "django/test/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Ftest%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Ftest%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F__init__.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -4,5 +4,6 @@\n \n from django.test.client import Client, RequestFactory\n from django.test.testcases import (TestCase, TransactionTestCase,\n-        SimpleTestCase, skipIfDBFeature, skipUnlessDBFeature)\n+    SimpleTestCase, LiveServerTestCase, skipIfDBFeature,\n+    skipUnlessDBFeature)\n from django.test.utils import Approximate"
        },
        {
            "sha": "d77eb39bde8ed0e289f39275a3818d3e0470a6f3",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 243,
            "deletions": 2,
            "changes": 245,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -1,16 +1,23 @@\n from __future__ import with_statement\n \n+import os\n import re\n import sys\n from functools import wraps\n from urlparse import urlsplit, urlunsplit\n from xml.dom.minidom import parseString, Node\n+import select\n+import socket\n+import threading\n \n from django.conf import settings\n+from django.contrib.staticfiles.handlers import StaticFilesHandler\n from django.core import mail\n-from django.core.exceptions import ValidationError\n+from django.core.exceptions import ValidationError, ImproperlyConfigured\n+from django.core.handlers.wsgi import WSGIHandler\n from django.core.management import call_command\n from django.core.signals import request_started\n+from django.core.servers.basehttp import (WSGIRequestHandler, WSGIServer)\n from django.core.urlresolvers import clear_url_caches\n from django.core.validators import EMPTY_VALUES\n from django.db import (transaction, connection, connections, DEFAULT_DB_ALIAS,\n@@ -23,6 +30,7 @@\n     override_settings)\n from django.utils import simplejson, unittest as ut2\n from django.utils.encoding import smart_str\n+from django.views.static import serve\n \n __all__ = ('DocTestRunner', 'OutputChecker', 'TestCase', 'TransactionTestCase',\n            'SimpleTestCase', 'skipIfDBFeature', 'skipUnlessDBFeature')\n@@ -68,7 +76,8 @@ def restore_transaction_methods():\n class OutputChecker(doctest.OutputChecker):\n     def check_output(self, want, got, optionflags):\n         \"\"\"\n-        The entry method for doctest output checking. Defers to a sequence of child checkers\n+        The entry method for doctest output checking. Defers to a sequence of\n+        child checkers\n         \"\"\"\n         checks = (self.check_output_default,\n                   self.check_output_numeric,\n@@ -219,6 +228,7 @@ def report_unexpected_exception(self, out, test, example, exc_info):\n         for conn in connections:\n             transaction.rollback_unless_managed(using=conn)\n \n+\n class _AssertNumQueriesContext(object):\n     def __init__(self, test_case, num, connection):\n         self.test_case = test_case\n@@ -247,6 +257,7 @@ def __exit__(self, exc_type, exc_value, traceback):\n             )\n         )\n \n+\n class SimpleTestCase(ut2.TestCase):\n \n     def save_warnings_state(self):\n@@ -335,6 +346,7 @@ def assertFieldOutput(self, fieldclass, valid, invalid, field_args=None,\n             self.assertTrue(isinstance(fieldclass(*field_args, **field_kwargs),\n                                        fieldclass))\n \n+\n class TransactionTestCase(SimpleTestCase):\n     # The class we'll use for the test client self.client.\n     # Can be overridden in derived classes.\n@@ -643,13 +655,15 @@ def assertNumQueries(self, num, func=None, *args, **kwargs):\n         with context:\n             func(*args, **kwargs)\n \n+\n def connections_support_transactions():\n     \"\"\"\n     Returns True if all connections support transactions.\n     \"\"\"\n     return all(conn.features.supports_transactions\n                for conn in connections.all())\n \n+\n class TestCase(TransactionTestCase):\n     \"\"\"\n     Does basically the same as TransactionTestCase, but surrounds every test\n@@ -703,6 +717,7 @@ def _fixture_teardown(self):\n             transaction.rollback(using=db)\n             transaction.leave_transaction_management(using=db)\n \n+\n def _deferredSkip(condition, reason):\n     def decorator(test_func):\n         if not (isinstance(test_func, type) and\n@@ -719,16 +734,242 @@ def skip_wrapper(*args, **kwargs):\n         return test_item\n     return decorator\n \n+\n def skipIfDBFeature(feature):\n     \"\"\"\n     Skip a test if a database has the named feature\n     \"\"\"\n     return _deferredSkip(lambda: getattr(connection.features, feature),\n                          \"Database has feature %s\" % feature)\n \n+\n def skipUnlessDBFeature(feature):\n     \"\"\"\n     Skip a test unless a database has the named feature\n     \"\"\"\n     return _deferredSkip(lambda: not getattr(connection.features, feature),\n                          \"Database doesn't support feature %s\" % feature)\n+\n+\n+class QuietWSGIRequestHandler(WSGIRequestHandler):\n+    \"\"\"\n+    Just a regular WSGIRequestHandler except it doesn't log to the standard\n+    output any of the requests received, so as to not clutter the output for\n+    the tests' results.\n+    \"\"\"\n+\n+    def log_message(*args):\n+        pass\n+\n+\n+class _ImprovedEvent(threading._Event):\n+    \"\"\"\n+    Does the same as `threading.Event` except it overrides the wait() method\n+    with some code borrowed from Python 2.7 to return the set state of the\n+    event (see: http://hg.python.org/cpython/rev/b5aa8aa78c0f/). This allows\n+    to know whether the wait() method exited normally or because of the\n+    timeout. This class can be removed when Django supports only Python >= 2.7.\n+    \"\"\"\n+\n+    def wait(self, timeout=None):\n+        self._Event__cond.acquire()\n+        try:\n+            if not self._Event__flag:\n+                self._Event__cond.wait(timeout)\n+            return self._Event__flag\n+        finally:\n+            self._Event__cond.release()\n+\n+\n+class StoppableWSGIServer(WSGIServer):\n+    \"\"\"\n+    The code in this class is borrowed from the `SocketServer.BaseServer` class\n+    in Python 2.6. The important functionality here is that the server is non-\n+    blocking and that it can be shut down at any moment. This is made possible\n+    by the server regularly polling the socket and checking if it has been\n+    asked to stop.\n+    Note for the future: Once Django stops supporting Python 2.6, this class\n+    can be removed as `WSGIServer` will have this ability to shutdown on\n+    demand and will not require the use of the _ImprovedEvent class whose code\n+    is borrowed from Python 2.7.\n+    \"\"\"\n+\n+    def __init__(self, *args, **kwargs):\n+        super(StoppableWSGIServer, self).__init__(*args, **kwargs)\n+        self.__is_shut_down = _ImprovedEvent()\n+        self.__serving = False\n+\n+    def serve_forever(self, poll_interval=0.5):\n+        \"\"\"\n+        Handle one request at a time until shutdown.\n+\n+        Polls for shutdown every poll_interval seconds.\n+        \"\"\"\n+        self.__serving = True\n+        self.__is_shut_down.clear()\n+        while self.__serving:\n+            r, w, e = select.select([self], [], [], poll_interval)\n+            if r:\n+                self._handle_request_noblock()\n+        self.__is_shut_down.set()\n+\n+    def shutdown(self):\n+        \"\"\"\n+        Stops the serve_forever loop.\n+\n+        Blocks until the loop has finished. This must be called while\n+        serve_forever() is running in another thread, or it will\n+        deadlock.\n+        \"\"\"\n+        self.__serving = False\n+        if not self.__is_shut_down.wait(2):\n+            raise RuntimeError(\n+                \"Failed to shutdown the live test server in 2 seconds. The \"\n+                \"server might be stuck or generating a slow response.\")\n+\n+    def handle_request(self):\n+        \"\"\"Handle one request, possibly blocking.\n+        \"\"\"\n+        fd_sets = select.select([self], [], [], None)\n+        if not fd_sets[0]:\n+            return\n+        self._handle_request_noblock()\n+\n+    def _handle_request_noblock(self):\n+        \"\"\"\n+        Handle one request, without blocking.\n+\n+        I assume that select.select has returned that the socket is\n+        readable before this function was called, so there should be\n+        no risk of blocking in get_request().\n+        \"\"\"\n+        try:\n+            request, client_address = self.get_request()\n+        except socket.error:\n+            return\n+        if self.verify_request(request, client_address):\n+            try:\n+                self.process_request(request, client_address)\n+            except Exception:\n+                self.handle_error(request, client_address)\n+                self.close_request(request)\n+\n+\n+class _MediaFilesHandler(StaticFilesHandler):\n+    \"\"\"\n+    Handler for serving the media files. This is a private class that is\n+    meant to be used solely as a convenience by LiveServerThread.\n+    \"\"\"\n+\n+    def get_base_dir(self):\n+        return settings.MEDIA_ROOT\n+\n+    def get_base_url(self):\n+        return settings.MEDIA_URL\n+\n+    def serve(self, request):\n+        return serve(request, self.file_path(request.path),\n+            document_root=self.get_base_dir())\n+\n+\n+class LiveServerThread(threading.Thread):\n+    \"\"\"\n+    Thread for running a live http server while the tests are running.\n+    \"\"\"\n+\n+    def __init__(self, address, port, connections_override=None):\n+        self.address = address\n+        self.port = port\n+        self.is_ready = threading.Event()\n+        self.error = None\n+        self.connections_override = connections_override\n+        super(LiveServerThread, self).__init__()\n+\n+    def run(self):\n+        \"\"\"\n+        Sets up the live server and databases, and then loops over handling\n+        http requests.\n+        \"\"\"\n+        if self.connections_override:\n+            from django.db import connections\n+            # Override this thread's database connections with the ones\n+            # provided by the main thread.\n+            for alias, conn in self.connections_override.items():\n+                connections[alias] = conn\n+        try:\n+            # Create the handler for serving static and media files\n+            handler = StaticFilesHandler(_MediaFilesHandler(WSGIHandler()))\n+            # Instantiate and start the WSGI server\n+            self.httpd = StoppableWSGIServer(\n+                (self.address, self.port), QuietWSGIRequestHandler)\n+            self.httpd.set_app(handler)\n+            self.is_ready.set()\n+            self.httpd.serve_forever()\n+        except Exception, e:\n+            self.error = e\n+            self.is_ready.set()\n+\n+    def join(self, timeout=None):\n+        if hasattr(self, 'httpd'):\n+            # Stop the WSGI server\n+            self.httpd.shutdown()\n+            self.httpd.server_close()\n+        super(LiveServerThread, self).join(timeout)\n+\n+\n+class LiveServerTestCase(TransactionTestCase):\n+    \"\"\"\n+    Does basically the same as TransactionTestCase but also launches a live\n+    http server in a separate thread so that the tests may use another testing\n+    framework, such as Selenium for example, instead of the built-in dummy\n+    client.\n+    Note that it inherits from TransactionTestCase instead of TestCase because\n+    the threads do not share the same transactions (unless if using in-memory\n+    sqlite) and each thread needs to commit all their transactions so that the\n+    other thread can see the changes.\n+    \"\"\"\n+\n+    @property\n+    def live_server_url(self):\n+        return 'http://%s' % self.__test_server_address\n+\n+    @classmethod\n+    def setUpClass(cls):\n+        connections_override = {}\n+        for conn in connections.all():\n+            # If using in-memory sqlite databases, pass the connections to\n+            # the server thread.\n+            if (conn.settings_dict['ENGINE'] == 'django.db.backends.sqlite3'\n+                and conn.settings_dict['NAME'] == ':memory:'):\n+                # Explicitly enable thread-shareability for this connection\n+                conn.allow_thread_sharing = True\n+                connections_override[conn.alias] = conn\n+\n+        # Launch the live server's thread\n+        cls.__test_server_address = os.environ.get(\n+            'DJANGO_LIVE_TEST_SERVER_ADDRESS', 'localhost:8081')\n+        try:\n+            host, port = cls.__test_server_address.split(':')\n+        except Exception:\n+            raise ImproperlyConfigured('Invalid address (\"%s\") for live '\n+                'server.' % cls.__test_server_address)\n+        cls.server_thread = LiveServerThread(\n+            host, int(port), connections_override)\n+        cls.server_thread.daemon = True\n+        cls.server_thread.start()\n+\n+        # Wait for the live server to be ready\n+        cls.server_thread.is_ready.wait()\n+        if cls.server_thread.error:\n+            raise cls.server_thread.error\n+\n+        super(LiveServerTestCase, cls).setUpClass()\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        # There may not be a 'server_thread' attribute if setUpClass() for some\n+        # reasons has raised an exception.\n+        if hasattr(cls, 'server_thread'):\n+            # Terminate the live server's thread\n+            cls.server_thread.join()\n+        super(LiveServerTestCase, cls).tearDownClass()"
        },
        {
            "sha": "275ee154f61068815cd0cde6142b3ccf7aad7b8d",
            "filename": "docs/internals/contributing/writing-code/unit-tests.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -122,6 +122,19 @@ Going beyond that, you can specify an individual test method like this:\n \n     ./runtests.py --settings=path.to.settings i18n.TranslationTests.test_lazy_objects\n \n+Running the Selenium tests\n+~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Some admin tests require Selenium 2, Firefox and Python >= 2.6 to work via a\n+real Web browser. To allow those tests to run and not be skipped, you must\n+install the selenium_ package (version > 2.13) into your Python path.\n+\n+Then, run the tests normally, for example:\n+\n+.. code-block:: bash\n+\n+    ./runtests.py --settings=test_sqlite admin_inlines\n+\n Running all the tests\n ~~~~~~~~~~~~~~~~~~~~~\n \n@@ -135,6 +148,7 @@ dependencies:\n *  setuptools_\n *  memcached_, plus a :ref:`supported Python binding <memcached>`\n *  gettext_ (:ref:`gettext_on_windows`)\n+*  selenium_ (if also using Python >= 2.6)\n \n If you want to test the memcached cache backend, you'll also need to define\n a :setting:`CACHES` setting that points at your memcached instance.\n@@ -149,6 +163,7 @@ associated tests will be skipped.\n .. _setuptools: http://pypi.python.org/pypi/setuptools/\n .. _memcached: http://www.danga.com/memcached/\n .. _gettext: http://www.gnu.org/software/gettext/manual/gettext.html\n+.. _selenium: http://pypi.python.org/pypi/selenium\n \n .. _contrib-apps:\n "
        },
        {
            "sha": "fac18f3b483fedd42d51125b9919fc44b125441d",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -976,15 +976,22 @@ information.\n .. versionadded:: 1.2\n .. django-admin-option:: --failfast\n \n-Use the :djadminopt:`--failfast` option to stop running tests and report the failure\n-immediately after a test fails.\n+The ``--failfast`` option can be used to stop running tests and report the\n+failure immediately after a test fails.\n \n .. versionadded:: 1.4\n .. django-admin-option:: --testrunner\n \n-The :djadminopt:`--testrunner` option can be used to control the test runner\n-class that is used to execute tests. If this value is provided, it overrides\n-the value provided by the :setting:`TEST_RUNNER` setting.\n+The ``--testrunner`` option can be used to control the test runner class that\n+is used to execute tests. If this value is provided, it overrides the value\n+provided by the :setting:`TEST_RUNNER` setting.\n+\n+.. versionadded:: 1.4\n+.. django-admin-option:: --liveserver\n+\n+The ``--liveserver`` option can be used to override the default address where\n+the live server (used with :class:`~django.test.LiveServerTestCase`) is\n+expected to run from. The default value is ``localhost:8081``.\n \n testserver <fixture fixture ...>\n --------------------------------"
        },
        {
            "sha": "51abdf1b033ba89ffc23dd103d576043f793ed90",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -40,6 +40,19 @@ before the release of Django 1.4.\n What's new in Django 1.4\n ========================\n \n+Support for in-browser testing frameworks\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django 1.4 now supports the integration with in-browser testing frameworks such\n+as Selenium_ or Windmill_ thanks to the :class:`django.test.LiveServerTestCase`\n+base class, allowing you to test the interactions between your site's front and\n+back ends more comprehensively. See the\n+:class:`documentation<django.test.LiveServerTestCase>` for more details and\n+concrete examples.\n+\n+.. _Windmill: http://www.getwindmill.com/\n+.. _Selenium: http://seleniumhq.org/\n+\n ``SELECT FOR UPDATE`` support\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "727ef2cb8ee176220935eb2eea73a7bfa54b7800",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 96,
            "deletions": 8,
            "changes": 104,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -581,21 +581,20 @@ Some of the things you can do with the test client are:\n * Test that a given request is rendered by a given Django template, with\n   a template context that contains certain values.\n \n-Note that the test client is not intended to be a replacement for Twill_,\n+Note that the test client is not intended to be a replacement for Windmill_,\n Selenium_, or other \"in-browser\" frameworks. Django's test client has\n a different focus. In short:\n \n * Use Django's test client to establish that the correct view is being\n   called and that the view is collecting the correct context data.\n \n-* Use in-browser frameworks such as Twill and Selenium to test *rendered*\n-  HTML and the *behavior* of Web pages, namely JavaScript functionality.\n+* Use in-browser frameworks such as Windmill_ and Selenium_ to test *rendered*\n+  HTML and the *behavior* of Web pages, namely JavaScript functionality. Django\n+  also provides special support for those frameworks; see the section on\n+  :class:`~django.test.LiveServerTestCase` for more details.\n \n A comprehensive test suite should use a combination of both test types.\n \n-.. _Twill: http://twill.idyll.org/\n-.. _Selenium: http://seleniumhq.org/\n-\n Overview and a quick example\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -1753,6 +1752,97 @@ under MySQL with MyISAM tables)::\n         def test_transaction_behavior(self):\n             # ... conditional test code\n \n+Live test server\n+----------------\n+\n+.. versionadded:: 1.4\n+\n+.. currentmodule:: django.test\n+\n+.. class:: LiveServerTestCase()\n+\n+``LiveServerTestCase`` does basically the same as\n+:class:`~django.test.TransactionTestCase` with one extra feature: it launches a\n+live Django server in the background on setup, and shuts it down on teardown.\n+This allows the use of automated test clients other than the\n+:ref:`Django dummy client <test-client>` such as, for example, the Selenium_ or\n+Windmill_ clients, to execute a series of functional tests inside a browser and\n+simulate a real user's actions.\n+\n+By default the live server's address is `'localhost:8081'` and the full URL\n+can be accessed during the tests with ``self.live_server_url``. If you'd like\n+to change the default address (in the case, for example, where the 8081 port is\n+already taken) you may pass a different one to the :djadmin:`test` command via\n+the :djadminopt:`--liveserver` option, for example:\n+\n+.. code-block:: bash\n+\n+    ./manage.py test --liveserver=localhost:8082\n+\n+Another way of changing the default server address is by setting the\n+`DJANGO_LIVE_TEST_SERVER_ADDRESS` environment variable.\n+\n+To demonstrate how to use ``LiveServerTestCase``, let's write a simple Selenium\n+test. First of all, you need to install the `selenium package`_ into your\n+Python path:\n+\n+.. code-block:: bash\n+\n+   pip install selenium\n+\n+Then, add a ``LiveServerTestCase``-based test to your app's tests module\n+(for example: ``myapp/tests.py``). The code for this test may look as follows:\n+\n+.. code-block:: python\n+\n+    from django.test import LiveServerTestCase\n+    from selenium.webdriver.firefox.webdriver import WebDriver\n+\n+    class MySeleniumTests(LiveServerTestCase):\n+        fixtures = ['user-data.json']\n+\n+        @classmethod\n+        def setUpClass(cls):\n+            cls.selenium = WebDriver()\n+            super(MySeleniumTests, cls).setUpClass()\n+\n+        @classmethod\n+        def tearDownClass(cls):\n+            super(MySeleniumTests, cls).tearDownClass()\n+            cls.selenium.quit()\n+\n+        def test_login(self):\n+            self.selenium.get('%s%s' % (self.live_server_url, '/login/'))\n+            username_input = self.selenium.find_element_by_name(\"username\")\n+            username_input.send_keys('myuser')\n+            password_input = self.selenium.find_element_by_name(\"password\")\n+            password_input.send_keys('secret')\n+            self.selenium.find_element_by_xpath('//input[@value=\"Log in\"]').click()\n+\n+Finally, you may run the test as follows:\n+\n+.. code-block:: bash\n+\n+    ./manage.py test myapp.MySeleniumTests.test_login\n+\n+This example will automatically open Firefox then go to the login page, enter\n+the credentials and press the \"Log in\" button. Selenium offers other drivers in\n+case you do not have Firefox installed or wish to use another browser. The\n+example above is just a tiny fraction of what the Selenium client can do; check\n+out the `full reference`_ for more details.\n+\n+.. _Windmill: http://www.getwindmill.com/\n+.. _Selenium: http://seleniumhq.org/\n+.. _selenium package: http://pypi.python.org/pypi/selenium\n+.. _full reference: http://readthedocs.org/docs/selenium-python/en/latest/api.html\n+.. _Firefox: http://www.mozilla.com/firefox/\n+\n+.. note::\n+\n+    ``LiveServerTestCase`` makes use of the :doc:`staticfiles contrib app\n+    </howto/static-files>` so you'll need to have your project configured\n+    accordingly (in particular by setting :setting:`STATIC_URL`).\n+\n \n Using different testing frameworks\n ==================================\n@@ -1833,11 +1923,9 @@ set up, execute and tear down the test suite.\n     those options will be added to the list of command-line options that\n     the :djadmin:`test` command can use.\n \n-\n Attributes\n ~~~~~~~~~~\n \n-\n .. attribute:: DjangoTestSuiteRunner.option_list\n \n     .. versionadded:: 1.4"
        },
        {
            "sha": "508f30223f977353812900a9a2682ea5b38b696a",
            "filename": "tests/regressiontests/admin_inlines/admin.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_inlines%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_inlines%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Fadmin.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -109,6 +109,10 @@ class SottoCapoInline(admin.TabularInline):\n     model = SottoCapo\n \n \n+class ProfileInline(admin.TabularInline):\n+    model = Profile\n+    extra = 1\n+\n site.register(TitleCollection, inlines=[TitleInline])\n # Test bug #12561 and #12778\n # only ModelAdmin media\n@@ -124,3 +128,4 @@ class SottoCapoInline(admin.TabularInline):\n site.register(Holder4, Holder4Admin)\n site.register(Author, AuthorAdmin)\n site.register(CapoFamiglia, inlines=[ConsigliereInline, SottoCapoInline])\n+site.register(ProfileCollection, inlines=[ProfileInline])\n\\ No newline at end of file"
        },
        {
            "sha": "f2add00288c9611d5d4e5703c625a621049506c0",
            "filename": "tests/regressiontests/admin_inlines/models.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -136,3 +136,13 @@ class Consigliere(models.Model):\n class SottoCapo(models.Model):\n     name = models.CharField(max_length=100)\n     capo_famiglia = models.ForeignKey(CapoFamiglia, related_name='+')\n+\n+# Other models\n+\n+class ProfileCollection(models.Model):\n+    pass\n+\n+class Profile(models.Model):\n+    collection = models.ForeignKey(ProfileCollection, blank=True, null=True)\n+    first_name = models.CharField(max_length=100)\n+    last_name = models.CharField(max_length=100)\n\\ No newline at end of file"
        },
        {
            "sha": "7b417d899520dbb42b1e369254511ff33b1dd2f0",
            "filename": "tests/regressiontests/admin_inlines/tests.py",
            "status": "modified",
            "additions": 105,
            "deletions": 1,
            "changes": 106,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import absolute_import\n \n+from django.contrib.admin.tests import AdminSeleniumWebDriverTestCase\n from django.contrib.admin.helpers import InlineAdminForm\n from django.contrib.auth.models import User, Permission\n from django.contrib.contenttypes.models import ContentType\n@@ -8,7 +9,8 @@\n # local test models\n from .admin import InnerInline\n from .models import (Holder, Inner, Holder2, Inner2, Holder3, Inner3, Person,\n-    OutfitItem, Fashionista, Teacher, Parent, Child, Author, Book)\n+    OutfitItem, Fashionista, Teacher, Parent, Child, Author, Book, Profile,\n+    ProfileCollection)\n \n \n class TestInline(TestCase):\n@@ -380,3 +382,105 @@ def test_inline_change_fk_all_perms(self):\n         self.assertContains(response, 'value=\"4\" id=\"id_inner2_set-TOTAL_FORMS\"')\n         self.assertContains(response, '<input type=\"hidden\" name=\"inner2_set-0-id\" value=\"%i\"' % self.inner2_id)\n         self.assertContains(response, 'id=\"id_inner2_set-0-DELETE\"')\n+\n+class SeleniumFirefoxTests(AdminSeleniumWebDriverTestCase):\n+    webdriver_class = 'selenium.webdriver.firefox.webdriver.WebDriver'\n+    fixtures = ['admin-views-users.xml']\n+    urls = \"regressiontests.admin_inlines.urls\"\n+\n+    def test_add_inlines(self):\n+        \"\"\"\n+        Ensure that the \"Add another XXX\" link correctly adds items to the\n+        inline form.\n+        \"\"\"\n+        self.admin_login(username='super', password='secret')\n+        self.selenium.get('%s%s' % (self.live_server_url,\n+            '/admin/admin_inlines/profilecollection/add/'))\n+\n+        # Check that there's only one inline to start with and that it has the\n+        # correct ID.\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            '#profile_set-group table tr.dynamic-profile_set')), 1)\n+        self.failUnlessEqual(self.selenium.find_element_by_css_selector(\n+            '.dynamic-profile_set:nth-of-type(1)').get_attribute('id'),\n+            'profile_set-0')\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-0 input[name=profile_set-0-first_name]')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-0 input[name=profile_set-0-last_name]')), 1)\n+\n+        # Add an inline\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+\n+        # Check that the inline has been added, that it has the right id, and\n+        # that it contains the right fields.\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            '#profile_set-group table tr.dynamic-profile_set')), 2)\n+        self.failUnlessEqual(self.selenium.find_element_by_css_selector(\n+            '.dynamic-profile_set:nth-of-type(2)').get_attribute('id'), 'profile_set-1')\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-1 input[name=profile_set-1-first_name]')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-1 input[name=profile_set-1-last_name]')), 1)\n+\n+        # Let's add another one to be sure\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            '#profile_set-group table tr.dynamic-profile_set')), 3)\n+        self.failUnlessEqual(self.selenium.find_element_by_css_selector(\n+            '.dynamic-profile_set:nth-of-type(3)').get_attribute('id'), 'profile_set-2')\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-2 input[name=profile_set-2-first_name]')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-2 input[name=profile_set-2-last_name]')), 1)\n+\n+        # Enter some data and click 'Save'\n+        self.selenium.find_element_by_name('profile_set-0-first_name').send_keys('0 first name 1')\n+        self.selenium.find_element_by_name('profile_set-0-last_name').send_keys('0 last name 2')\n+        self.selenium.find_element_by_name('profile_set-1-first_name').send_keys('1 first name 1')\n+        self.selenium.find_element_by_name('profile_set-1-last_name').send_keys('1 last name 2')\n+        self.selenium.find_element_by_name('profile_set-2-first_name').send_keys('2 first name 1')\n+        self.selenium.find_element_by_name('profile_set-2-last_name').send_keys('2 last name 2')\n+        self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n+\n+        # Check that the objects have been created in the database\n+        self.assertEqual(ProfileCollection.objects.all().count(), 1)\n+        self.assertEqual(Profile.objects.all().count(), 3)\n+\n+    def test_delete_inlines(self):\n+        self.admin_login(username='super', password='secret')\n+        self.selenium.get('%s%s' % (self.live_server_url,\n+            '/admin/admin_inlines/profilecollection/add/'))\n+\n+        # Add a few inlines\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            '#profile_set-group table tr.dynamic-profile_set')), 5)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-0')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-1')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-2')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-3')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-4')), 1)\n+\n+        # Click on a few delete buttons\n+        self.selenium.find_element_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-1 td.delete a').click()\n+        self.selenium.find_element_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-2 td.delete a').click()\n+        # Verify that they're gone and that the IDs have been re-sequenced\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            '#profile_set-group table tr.dynamic-profile_set')), 3)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-0')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-1')), 1)\n+        self.failUnlessEqual(len(self.selenium.find_elements_by_css_selector(\n+            'form#profilecollection_form tr.dynamic-profile_set#profile_set-2')), 1)"
        },
        {
            "sha": "72d47adce177c4d86dc84b5ec944ec74001ec417",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -13,6 +13,7 @@\n \n from django import conf, bin, get_version\n from django.conf import settings\n+from django.test.simple import DjangoTestSuiteRunner\n from django.utils import unittest\n \n \n@@ -1058,6 +1059,50 @@ def test_app_with_import(self):\n         self.assertOutput(out, '0 errors found')\n \n \n+class CustomTestRunner(DjangoTestSuiteRunner):\n+\n+    def __init__(self, *args, **kwargs):\n+        assert 'liveserver' not in kwargs\n+        super(CustomTestRunner, self).__init__(*args, **kwargs)\n+\n+    def run_tests(self, test_labels, extra_tests=None, **kwargs):\n+        pass\n+\n+class ManageTestCommand(AdminScriptTestCase):\n+    def setUp(self):\n+        from django.core.management.commands.test import Command as TestCommand\n+        self.cmd = TestCommand()\n+\n+    def test_liveserver(self):\n+        \"\"\"\n+        Ensure that the --liveserver option sets the environment variable\n+        correctly.\n+        Refs #2879.\n+        \"\"\"\n+\n+        # Backup original state\n+        address_predefined = 'DJANGO_LIVE_TEST_SERVER_ADDRESS' in os.environ\n+        old_address = os.environ.get('DJANGO_LIVE_TEST_SERVER_ADDRESS')\n+\n+        self.cmd.handle(verbosity=0, testrunner='regressiontests.admin_scripts.tests.CustomTestRunner')\n+\n+        # Original state hasn't changed\n+        self.assertEqual('DJANGO_LIVE_TEST_SERVER_ADDRESS' in os.environ, address_predefined)\n+        self.assertEqual(os.environ.get('DJANGO_LIVE_TEST_SERVER_ADDRESS'), old_address)\n+\n+        self.cmd.handle(verbosity=0, testrunner='regressiontests.admin_scripts.tests.CustomTestRunner',\n+                        liveserver='blah')\n+\n+        # Variable was correctly set\n+        self.assertEqual(os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'], 'blah')\n+\n+        # Restore original state\n+        if address_predefined:\n+            os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = old_address\n+        else:\n+            del os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS']\n+\n+\n class ManageRunserver(AdminScriptTestCase):\n     def setUp(self):\n         from django.core.management.commands.runserver import BaseRunserverCommand"
        },
        {
            "sha": "e28df325776d4d4fa8450d58e684615fa06beb36",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -7,6 +7,7 @@\n from django.conf import settings\n from django.contrib import admin\n from django.contrib.admin import widgets\n+from django.contrib.admin.tests import AdminSeleniumWebDriverTestCase\n from django.core.files.storage import default_storage\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.db.models import DateField\n@@ -407,3 +408,52 @@ def test_no_can_add_related(self):\n         # Used to fail with a name error.\n         w = widgets.RelatedFieldWidgetWrapper(w, rel, widget_admin_site)\n         self.assertFalse(w.can_add_related)\n+\n+\n+class SeleniumFirefoxTests(AdminSeleniumWebDriverTestCase):\n+    webdriver_class = 'selenium.webdriver.firefox.webdriver.WebDriver'\n+    fixtures = ['admin-widgets-users.xml']\n+    urls = \"regressiontests.admin_widgets.urls\"\n+\n+    def test_show_hide_date_time_picker_widgets(self):\n+        \"\"\"\n+        Ensure that pressing the ESC key closes the date and time picker\n+        widgets.\n+        Refs #17064.\n+        \"\"\"\n+        from selenium.webdriver.common.keys import Keys\n+\n+        self.admin_login(username='super', password='secret', login_url='/')\n+        # Open a page that has a date and time picker widgets\n+        self.selenium.get('%s%s' % (self.live_server_url,\n+            '/admin_widgets/member/add/'))\n+\n+        # First, with the date picker widget ---------------------------------\n+        # Check that the date picker is hidden\n+        self.assertEqual(\n+            self.get_css_value('#calendarbox0', 'display'), 'none')\n+        # Click the calendar icon\n+        self.selenium.find_element_by_id('calendarlink0').click()\n+        # Check that the date picker is visible\n+        self.assertEqual(\n+            self.get_css_value('#calendarbox0', 'display'), 'block')\n+        # Press the ESC key\n+        self.selenium.find_element_by_tag_name('html').send_keys([Keys.ESCAPE])\n+        # Check that the date picker is hidden again\n+        self.assertEqual(\n+            self.get_css_value('#calendarbox0', 'display'), 'none')\n+\n+        # Then, with the time picker widget ----------------------------------\n+        # Check that the time picker is hidden\n+        self.assertEqual(\n+            self.get_css_value('#clockbox0', 'display'), 'none')\n+        # Click the time icon\n+        self.selenium.find_element_by_id('clocklink0').click()\n+        # Check that the time picker is visible\n+        self.assertEqual(\n+            self.get_css_value('#clockbox0', 'display'), 'block')\n+        # Press the ESC key\n+        self.selenium.find_element_by_tag_name('html').send_keys([Keys.ESCAPE])\n+        # Check that the time picker is hidden again\n+        self.assertEqual(\n+            self.get_css_value('#clockbox0', 'display'), 'none')"
        },
        {
            "sha": "d81b2253d21e0e8d43dc02b578f96c8f3489d2f1",
            "filename": "tests/regressiontests/servers/fixtures/testdata.json",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Ffixtures%2Ftestdata.json",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Ffixtures%2Ftestdata.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Ffixtures%2Ftestdata.json?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1,16 @@\n+[\n+  {\n+    \"pk\": 1,\n+    \"model\": \"servers.person\",\n+    \"fields\": {\n+      \"name\": \"jane\"\n+    }\n+  },\n+  {\n+    \"pk\": 2,\n+    \"model\": \"servers.person\",\n+    \"fields\": {\n+      \"name\": \"robert\"\n+    }\n+  }\n+]\n\\ No newline at end of file"
        },
        {
            "sha": "dd2dda94e301dd9725aac38519bcbb4039518d63",
            "filename": "tests/regressiontests/servers/media/example_media_file.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fmedia%2Fexample_media_file.txt",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fmedia%2Fexample_media_file.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Fmedia%2Fexample_media_file.txt?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1 @@\n+example media file"
        },
        {
            "sha": "6e1414ae194553354eced086d277016d0f64fdd7",
            "filename": "tests/regressiontests/servers/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Fmodels.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1,5 @@\n+from django.db import models\n+\n+\n+class Person(models.Model):\n+    name = models.CharField(max_length=256)"
        },
        {
            "sha": "b5d8342212b3a00c441d5bb889102061d214295c",
            "filename": "tests/regressiontests/servers/static/example_static_file.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fstatic%2Fexample_static_file.txt",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fstatic%2Fexample_static_file.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Fstatic%2Fexample_static_file.txt?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1 @@\n+example static file"
        },
        {
            "sha": "ff49c74b9d711875d9720f6da770ac375990db16",
            "filename": "tests/regressiontests/servers/tests.py",
            "status": "modified",
            "additions": 149,
            "deletions": 2,
            "changes": 151,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Ftests.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -3,13 +3,17 @@\n \"\"\"\n import os\n from urlparse import urljoin\n+import urllib2\n \n import django\n from django.conf import settings\n-from django.test import TestCase\n+from django.core.exceptions import ImproperlyConfigured\n+from django.test import TestCase, LiveServerTestCase\n from django.core.handlers.wsgi import WSGIHandler\n-from django.core.servers.basehttp import AdminMediaHandler\n+from django.core.servers.basehttp import AdminMediaHandler, WSGIServerException\n+from django.test.utils import override_settings\n \n+from .models import Person\n \n class AdminMediaHandlerTests(TestCase):\n \n@@ -68,3 +72,146 @@ def test_media_urls(self):\n                 continue\n             self.fail('URL: %s should have caused a ValueError exception.'\n                       % url)\n+\n+\n+TEST_ROOT = os.path.dirname(__file__)\n+TEST_SETTINGS = {\n+    'MEDIA_URL': '/media/',\n+    'MEDIA_ROOT': os.path.join(TEST_ROOT, 'media'),\n+    'STATIC_URL': '/static/',\n+    'STATIC_ROOT': os.path.join(TEST_ROOT, 'static'),\n+}\n+\n+\n+class LiveServerBase(LiveServerTestCase):\n+    urls = 'regressiontests.servers.urls'\n+    fixtures = ['testdata.json']\n+\n+    @classmethod\n+    def setUpClass(cls):\n+        # Override settings\n+        cls.settings_override = override_settings(**TEST_SETTINGS)\n+        cls.settings_override.enable()\n+        super(LiveServerBase, cls).setUpClass()\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        # Restore original settings\n+        cls.settings_override.disable()\n+        super(LiveServerBase, cls).tearDownClass()\n+\n+    def urlopen(self, url):\n+        server_address = os.environ.get(\n+            'DJANGO_LIVE_TEST_SERVER_ADDRESS', 'localhost:8081')\n+        base = 'http://%s' % server_address\n+        return urllib2.urlopen(base + url)\n+\n+\n+class LiveServerAddress(LiveServerBase):\n+    \"\"\"\n+    Ensure that the address set in the environment variable is valid.\n+    Refs #2879.\n+    \"\"\"\n+\n+    @classmethod\n+    def setUpClass(cls):\n+        # Backup original environment variable\n+        address_predefined = 'DJANGO_LIVE_TEST_SERVER_ADDRESS' in os.environ\n+        old_address = os.environ.get('DJANGO_LIVE_TEST_SERVER_ADDRESS')\n+\n+        # Just the host is not accepted\n+        os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = 'localhost'\n+        try:\n+            super(LiveServerAddress, cls).setUpClass()\n+            raise Exception(\"The line above should have raised an exception\")\n+        except ImproperlyConfigured:\n+            pass\n+\n+        # The host must be valid\n+        os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = 'blahblahblah:8081'\n+        try:\n+            super(LiveServerAddress, cls).setUpClass()\n+            raise Exception(\"The line above should have raised an exception\")\n+        except WSGIServerException:\n+            pass\n+\n+        # If contrib.staticfiles isn't configured properly, the exception\n+        # should bubble up to the main thread.\n+        old_STATIC_URL = TEST_SETTINGS['STATIC_URL']\n+        TEST_SETTINGS['STATIC_URL'] = None\n+        os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = 'localhost:8081'\n+        try:\n+            super(LiveServerAddress, cls).setUpClass()\n+            raise Exception(\"The line above should have raised an exception\")\n+        except ImproperlyConfigured:\n+            pass\n+        TEST_SETTINGS['STATIC_URL'] = old_STATIC_URL\n+\n+        # Restore original environment variable\n+        if address_predefined:\n+            os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = old_address\n+        else:\n+            del os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS']\n+\n+    def test_test_test(self):\n+        # Intentionally empty method so that the test is picked up by the\n+        # test runner and the overriden setUpClass() method is executed.\n+        pass\n+\n+class LiveServerViews(LiveServerBase):\n+    def test_404(self):\n+        \"\"\"\n+        Ensure that the LiveServerTestCase serves 404s.\n+        Refs #2879.\n+        \"\"\"\n+        try:\n+            self.urlopen('/')\n+        except urllib2.HTTPError, err:\n+            self.assertEquals(err.code, 404, 'Expected 404 response')\n+        else:\n+            self.fail('Expected 404 response')\n+\n+    def test_view(self):\n+        \"\"\"\n+        Ensure that the LiveServerTestCase serves views.\n+        Refs #2879.\n+        \"\"\"\n+        f = self.urlopen('/example_view/')\n+        self.assertEquals(f.read(), 'example view')\n+\n+    def test_static_files(self):\n+        \"\"\"\n+        Ensure that the LiveServerTestCase serves static files.\n+        Refs #2879.\n+        \"\"\"\n+        f = self.urlopen('/static/example_static_file.txt')\n+        self.assertEquals(f.read(), 'example static file\\n')\n+\n+    def test_media_files(self):\n+        \"\"\"\n+        Ensure that the LiveServerTestCase serves media files.\n+        Refs #2879.\n+        \"\"\"\n+        f = self.urlopen('/media/example_media_file.txt')\n+        self.assertEquals(f.read(), 'example media file\\n')\n+\n+\n+class LiveServerDatabase(LiveServerBase):\n+\n+    def test_fixtures_loaded(self):\n+        \"\"\"\n+        Ensure that fixtures are properly loaded and visible to the\n+        live server thread.\n+        Refs #2879.\n+        \"\"\"\n+        f = self.urlopen('/model_view/')\n+        self.assertEquals(f.read().splitlines(), ['jane', 'robert'])\n+\n+    def test_database_writes(self):\n+        \"\"\"\n+        Ensure that data written to the database by a view can be read.\n+        Refs #2879.\n+        \"\"\"\n+        self.urlopen('/create_model_instance/')\n+        names = [person.name for person in Person.objects.all()]\n+        self.assertEquals(names, ['jane', 'robert', 'emily'])"
        },
        {
            "sha": "c8ca1ac7a4241ea285768888fd4734a7b3f22caf",
            "filename": "tests/regressiontests/servers/urls.py",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Furls.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1,12 @@\n+from __future__ import absolute_import\n+\n+from django.conf.urls import patterns, url\n+\n+from . import views\n+\n+\n+urlpatterns = patterns('',\n+    url(r'^example_view/$', views.example_view),\n+    url(r'^model_view/$', views.model_view),\n+    url(r'^create_model_instance/$', views.create_model_instance),\n+)\n\\ No newline at end of file"
        },
        {
            "sha": "94a4f2d9ef695da1c930374c97dc74e9ca6c0117",
            "filename": "tests/regressiontests/servers/views.py",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fregressiontests%2Fservers%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Fviews.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -0,0 +1,17 @@\n+from django.http import HttpResponse\n+from .models import Person\n+\n+\n+def example_view(request):\n+    return HttpResponse('example view')\n+\n+\n+def model_view(request):\n+    people = Person.objects.all()\n+    return HttpResponse('\\n'.join([person.name for person in people]))\n+\n+\n+def create_model_instance(request):\n+    person = Person(name='emily')\n+    person.save()\n+    return HttpResponse('')\n\\ No newline at end of file"
        },
        {
            "sha": "73c35a50c1ce8adae04796a4dd1e6970e4215e80",
            "filename": "tests/runtests.py",
            "status": "modified",
            "additions": 45,
            "deletions": 17,
            "changes": 62,
            "blob_url": "https://github.com/django/django/blob/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fruntests.py",
            "raw_url": "https://github.com/django/django/raw/2f02a05ffb45be68b4164b4785ff1826833150a3/tests%2Fruntests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fruntests.py?ref=2f02a05ffb45be68b4164b4785ff1826833150a3",
            "patch": "@@ -49,7 +49,10 @@ def geodjango(settings):\n \n def get_test_modules():\n     modules = []\n-    for loc, dirpath in (MODEL_TESTS_DIR_NAME, MODEL_TEST_DIR), (REGRESSION_TESTS_DIR_NAME, REGRESSION_TEST_DIR), (CONTRIB_DIR_NAME, CONTRIB_DIR):\n+    for loc, dirpath in (\n+        (MODEL_TESTS_DIR_NAME, MODEL_TEST_DIR),\n+        (REGRESSION_TESTS_DIR_NAME, REGRESSION_TEST_DIR),\n+        (CONTRIB_DIR_NAME, CONTRIB_DIR)):\n         for f in os.listdir(dirpath):\n             if (f.startswith('__init__') or\n                 f.startswith('.') or\n@@ -150,7 +153,8 @@ def django_tests(verbosity, interactive, failfast, test_labels):\n         settings.TEST_RUNNER = 'django.test.simple.DjangoTestSuiteRunner'\n     TestRunner = get_runner(settings)\n \n-    test_runner = TestRunner(verbosity=verbosity, interactive=interactive, failfast=failfast)\n+    test_runner = TestRunner(verbosity=verbosity, interactive=interactive,\n+        failfast=failfast)\n     failures = test_runner.run_tests(test_labels, extra_tests=extra_tests)\n \n     teardown(state)\n@@ -175,7 +179,8 @@ def bisect_tests(bisection_label, options, test_labels):\n         except ValueError:\n             pass\n \n-    subprocess_args = [sys.executable, __file__, '--settings=%s' % options.settings]\n+    subprocess_args = [\n+        sys.executable, __file__, '--settings=%s' % options.settings]\n     if options.failfast:\n         subprocess_args.append('--failfast')\n     if options.verbosity:\n@@ -235,7 +240,8 @@ def paired_tests(paired_test, options, test_labels):\n         except ValueError:\n             pass\n \n-    subprocess_args = [sys.executable, __file__, '--settings=%s' % options.settings]\n+    subprocess_args = [\n+        sys.executable, __file__, '--settings=%s' % options.settings]\n     if options.failfast:\n         subprocess_args.append('--failfast')\n     if options.verbosity:\n@@ -244,7 +250,8 @@ def paired_tests(paired_test, options, test_labels):\n         subprocess_args.append('--noinput')\n \n     for i, label in enumerate(test_labels):\n-        print '***** %d of %d: Check test pairing with %s' % (i+1, len(test_labels), label)\n+        print '***** %d of %d: Check test pairing with %s' % (\n+            i+1, len(test_labels), label)\n         failures = subprocess.call(subprocess_args + [label, paired_test])\n         if failures:\n             print '***** Found problem pair with',label\n@@ -257,19 +264,36 @@ def paired_tests(paired_test, options, test_labels):\n     from optparse import OptionParser\n     usage = \"%prog [options] [module module module ...]\"\n     parser = OptionParser(usage=usage)\n-    parser.add_option('-v','--verbosity', action='store', dest='verbosity', default='1',\n+    parser.add_option(\n+        '-v','--verbosity', action='store', dest='verbosity', default='1',\n         type='choice', choices=['0', '1', '2', '3'],\n-        help='Verbosity level; 0=minimal output, 1=normal output, 2=all output')\n-    parser.add_option('--noinput', action='store_false', dest='interactive', default=True,\n+        help='Verbosity level; 0=minimal output, 1=normal output, 2=all '\n+             'output')\n+    parser.add_option(\n+        '--noinput', action='store_false', dest='interactive', default=True,\n         help='Tells Django to NOT prompt the user for input of any kind.')\n-    parser.add_option('--failfast', action='store_true', dest='failfast', default=False,\n-        help='Tells Django to stop running the test suite after first failed test.')\n-    parser.add_option('--settings',\n-        help='Python path to settings module, e.g. \"myproject.settings\". If this isn\\'t provided, the DJANGO_SETTINGS_MODULE environment variable will be used.')\n-    parser.add_option('--bisect', action='store', dest='bisect', default=None,\n-        help=\"Bisect the test suite to discover a test that causes a test failure when combined with the named test.\")\n-    parser.add_option('--pair', action='store', dest='pair', default=None,\n-        help=\"Run the test suite in pairs with the named test to find problem pairs.\")\n+    parser.add_option(\n+        '--failfast', action='store_true', dest='failfast', default=False,\n+        help='Tells Django to stop running the test suite after first failed '\n+             'test.')\n+    parser.add_option(\n+        '--settings',\n+        help='Python path to settings module, e.g. \"myproject.settings\". If '\n+             'this isn\\'t provided, the DJANGO_SETTINGS_MODULE environment '\n+             'variable will be used.')\n+    parser.add_option(\n+        '--bisect', action='store', dest='bisect', default=None,\n+        help='Bisect the test suite to discover a test that causes a test '\n+             'failure when combined with the named test.')\n+    parser.add_option(\n+        '--pair', action='store', dest='pair', default=None,\n+        help='Run the test suite in pairs with the named test to find problem '\n+             'pairs.')\n+    parser.add_option(\n+        '--liveserver', action='store', dest='liveserver', default=None,\n+        help='Overrides the default address where the live server (used with '\n+             'LiveServerTestCase) is expected to run from. The default value '\n+             'is localhost:8081.'),\n     options, args = parser.parse_args()\n     if options.settings:\n         os.environ['DJANGO_SETTINGS_MODULE'] = options.settings\n@@ -279,11 +303,15 @@ def paired_tests(paired_test, options, test_labels):\n     else:\n         options.settings = os.environ['DJANGO_SETTINGS_MODULE']\n \n+    if options.liveserver is not None:\n+        os.environ['DJANGO_LIVE_TEST_SERVER_ADDRESS'] = options.liveserver\n+\n     if options.bisect:\n         bisect_tests(options.bisect, options, args)\n     elif options.pair:\n         paired_tests(options.pair, options, args)\n     else:\n-        failures = django_tests(int(options.verbosity), options.interactive, options.failfast, args)\n+        failures = django_tests(int(options.verbosity), options.interactive,\n+                                options.failfast, args)\n         if failures:\n             sys.exit(bool(failures))"
        }
    ],
    "stats": {
        "total": 967,
        "additions": 921,
        "deletions": 46
    }
}