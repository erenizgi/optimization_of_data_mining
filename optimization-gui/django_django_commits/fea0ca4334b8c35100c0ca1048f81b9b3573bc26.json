{
    "author": "timgraham",
    "message": "Fixed #12871 - Documented creation of a comment form for authenticated users; thanks shacker for patch.",
    "sha": "fea0ca4334b8c35100c0ca1048f81b9b3573bc26",
    "files": [
        {
            "sha": "1c6ff7c7ed72ec6d636acef7ebdc5b369fd720b8",
            "filename": "docs/ref/contrib/comments/index.txt",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/fea0ca4334b8c35100c0ca1048f81b9b3573bc26/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/fea0ca4334b8c35100c0ca1048f81b9b3573bc26/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt?ref=fea0ca4334b8c35100c0ca1048f81b9b3573bc26",
            "patch": "@@ -254,6 +254,56 @@ you can include a hidden form input called ``next`` in your comment form. For ex\n \n     <input type=\"hidden\" name=\"next\" value=\"{% url 'my_comment_was_posted' %}\" />\n \n+Providing a comment form for authenticated users\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If a user is already authenticated, it makes little sense to display the name,\n+email, and URL fields, since these can already be retrieved from their login\n+data and profile. In addition, some sites will only accept comments from\n+authenticated users.\n+\n+To provide a comment form for authenticated users, you can manually provide the\n+additional fields expected by the Django comments framework. For example,\n+assuming comments are attached to the model \"object\"::\n+\n+    {% if user.is_authenticated %}\n+        {% get_comment_form for object as form %}\n+        <form action=\"{% comment_form_target %}\" method=\"POST\">\n+        {% csrf_token %}\n+        {{ form.comment }}\n+        {{ form.honeypot }}\n+        {{ form.content_type }}\n+        {{ form.object_pk }}\n+        {{ form.timestamp }}\n+        {{ form.security_hash }}\n+        <input type=\"hidden\" name=\"next\" value=\"{% url 'object_detail_view' object.id %}\" />\n+        <input type=\"submit\" value=\"Add comment\" id=\"id_submit\" />\n+        </form>\n+    {% else %}\n+        <p>Please <a href=\"{% url 'auth_login' %}\">log in</a> to leave a comment.</p>\n+    {% endif %}\n+\n+The honeypot, content_type, object_pk, timestamp, and security_hash fields are\n+fields that would have been created automatically if you had simply used\n+``{{ form }}`` in your template, and are referred to in `Notes on the comment\n+form`_ below.\n+\n+Note that we do not need to specify the user to be associated with comments\n+submitted by authenticated users. This is possible because the :doc:`Built-in\n+Comment Models</ref/contrib/comments/models>` that come with Django associate\n+comments with authenticated users by default.\n+\n+In this example, the honeypot field will still be visible to the user; you'll\n+need to hide that field in your CSS::\n+\n+    #id_honeypot {\n+        display: none;\n+    }\n+\n+If you want to accept either anonymous or authenticated comments, replace the\n+contents of the \"else\" clause above with a standard comment form and the right\n+thing will happen whether a user is logged in or not.\n+\n .. _notes-on-the-comment-form:\n \n Notes on the comment form"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 50,
        "deletions": 0
    }
}