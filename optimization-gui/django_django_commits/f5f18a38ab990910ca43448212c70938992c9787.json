{
    "author": "alex",
    "message": "Fixed #14749 -- added support for using Django's file object as context managers.  Thanks to Florian Apolloner for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14671 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f5f18a38ab990910ca43448212c70938992c9787",
    "files": [
        {
            "sha": "6204d71040494f7e9817d980b068676d0ef2486b",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/f5f18a38ab990910ca43448212c70938992c9787/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/f5f18a38ab990910ca43448212c70938992c9787/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=f5f18a38ab990910ca43448212c70938992c9787",
            "patch": "@@ -101,6 +101,12 @@ def __iter__(self):\n         if buffer_ is not None:\n             yield buffer_\n \n+    def __enter__(self):\n+        return self\n+\n+    def __exit__(self, exc_type, exc_value, tb):\n+        self.close()\n+\n     def open(self, mode=None):\n         if not self.closed:\n             self.seek(0)"
        },
        {
            "sha": "26808f7d9a6c4561e6e4a01de2103e77c20435ef",
            "filename": "tests/modeltests/files/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Ftests.py?ref=f5f18a38ab990910ca43448212c70938992c9787",
            "patch": "@@ -1,11 +1,14 @@\n import shutil\n+import sys\n \n from django.core.cache import cache\n from django.core.files.base import ContentFile\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.test import TestCase\n \n from models import Storage, temp_storage, temp_storage_location\n+if sys.version_info >= (2, 5):\n+    from tests_25 import FileObjTests\n \n \n class FileTests(TestCase):\n@@ -97,4 +100,3 @@ def test_files(self):\n         obj2.normal.delete()\n         obj3.default.delete()\n         obj4.random.delete()\n-"
        },
        {
            "sha": "48eb6e26f7bd9b071f1791d9df26916504838040",
            "filename": "tests/modeltests/files/tests_25.py",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fmodeltests%2Ffiles%2Ftests_25.py",
            "raw_url": "https://github.com/django/django/raw/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fmodeltests%2Ffiles%2Ftests_25.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Ftests_25.py?ref=f5f18a38ab990910ca43448212c70938992c9787",
            "patch": "@@ -0,0 +1,17 @@\n+from __future__ import with_statement\n+\n+import tempfile\n+\n+from django.core.files import File\n+from django.utils.unittest import TestCase\n+\n+\n+class FileObjTests(TestCase):\n+    def test_context_manager(self):\n+        orig_file = tempfile.TemporaryFile()\n+        base_file = File(orig_file)\n+        with base_file as f:\n+            self.assertIs(base_file, f)\n+            self.assertFalse(f.closed)\n+        self.assertTrue(f.closed)\n+        self.assertTrue(orig_file.closed)"
        },
        {
            "sha": "e73b61fc219db1297686701a895340014e711145",
            "filename": "tests/regressiontests/file_storage/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_storage%2Ftests.py?ref=f5f18a38ab990910ca43448212c70938992c9787",
            "patch": "@@ -4,8 +4,17 @@\n import sys\n import tempfile\n import time\n-from cStringIO import StringIO\n from datetime import datetime, timedelta\n+try:\n+    from cStringIO import StringIO\n+except ImportError:\n+    from StringIO import StringIO\n+\n+try:\n+    import threading\n+except ImportError:\n+    import dummy_threading as threading\n+\n from django.conf import settings\n from django.core.exceptions import SuspiciousOperation\n from django.core.files.base import ContentFile, File\n@@ -15,11 +24,6 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.utils import unittest\n \n-try:\n-    import threading\n-except ImportError:\n-    import dummy_threading as threading\n-\n # Try to import PIL in either of the two ways it can end up installed.\n # Checking for the existence of Image is enough for CPython, but\n # for PyPy, you need to check for the underlying modules\n@@ -31,6 +35,7 @@\n     except ImportError:\n         Image = None\n \n+\n class GetStorageClassTests(unittest.TestCase):\n     def assertRaisesErrorWithMessage(self, error, message, callable,\n         *args, **kwargs):\n@@ -430,6 +435,7 @@ def test_multiple_calls(self):\n         Multiple calls of get_image_dimensions() should return the same size.\n         \"\"\"\n         from django.core.files.images import ImageFile\n+\n         img_path = os.path.join(os.path.dirname(__file__), \"test.png\")\n         image = ImageFile(open(img_path, 'rb'))\n         image_pil = Image.open(img_path)"
        },
        {
            "sha": "2a9c826451e2712c6a590a46be8d21c21b96eba1",
            "filename": "tests/regressiontests/test_utils/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_utils%2Ftests.py?ref=f5f18a38ab990910ca43448212c70938992c9787",
            "patch": "@@ -4,7 +4,7 @@\n \n \n if sys.version_info >= (2, 5):\n-    from python_25 import AssertNumQueriesTests\n+    from tests_25 import AssertNumQueriesTests\n \n \n class SkippingTestCase(TestCase):"
        },
        {
            "sha": "4adea6c080f11fdcc37eb3bfd693e6db01d4f702",
            "filename": "tests/regressiontests/test_utils/tests_25.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fregressiontests%2Ftest_utils%2Ftests_25.py",
            "raw_url": "https://github.com/django/django/raw/f5f18a38ab990910ca43448212c70938992c9787/tests%2Fregressiontests%2Ftest_utils%2Ftests_25.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_utils%2Ftests_25.py?ref=f5f18a38ab990910ca43448212c70938992c9787",
            "previous_filename": "tests/regressiontests/test_utils/python_25.py"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 39,
        "deletions": 8
    }
}