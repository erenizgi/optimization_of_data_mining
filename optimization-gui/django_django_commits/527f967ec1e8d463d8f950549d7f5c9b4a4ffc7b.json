{
    "author": "aaugustin",
    "message": "[py3] Fixed formtools tests.\n\nPython 3 adds a new pickle protocol. The tests were updated in a way\nthat makes it easy to add another pickle protocol, should Python gain\none.\n\nThanks Thomas Pelletier for providing an initial version of this patch.",
    "sha": "527f967ec1e8d463d8f950549d7f5c9b4a4ffc7b",
    "files": [
        {
            "sha": "15941332edd61c733507c0e342027c69bc7809b9",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 29,
            "deletions": 7,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/527f967ec1e8d463d8f950549d7f5c9b4a4ffc7b/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/527f967ec1e8d463d8f950549d7f5c9b4a4ffc7b/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=527f967ec1e8d463d8f950549d7f5c9b4a4ffc7b",
            "patch": "@@ -3,6 +3,7 @@\n \n import datetime\n import os\n+import pickle\n import re\n import warnings\n \n@@ -273,7 +274,10 @@ def test_good_hash(self):\n         \"\"\"\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         response = self.client.post('/wizard1/', data)\n         self.assertEqual(2, response.context['step0'])\n@@ -298,15 +302,24 @@ def process_step(self, request, form, step):\n         wizard = WizardWithProcessStep([WizardPageOneForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n \n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n-                \"hash_1\": \"1e6f6315da42e62f33a30640ec7e007ad3fbf1a1\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n+                \"hash_1\": {\n+                    2: \"1e6f6315da42e62f33a30640ec7e007ad3fbf1a1\",\n+                    3: \"c33142ef9d01b1beae238adf22c3c6c57328f51a\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"2\"}\n         self.assertRaises(http.Http404, wizard, DummyRequest(POST=data))\n \n@@ -328,7 +341,10 @@ def process_step(self, request, form, step):\n                                         WizardPageThreeForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n@@ -352,7 +368,10 @@ def done(self, request, form_list):\n \n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n@@ -378,7 +397,10 @@ def process_step(self, request, form, step):\n                                         WizardPageThreeForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 29,
        "deletions": 7
    }
}