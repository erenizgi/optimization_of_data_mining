{
    "author": "SmileyChris",
    "message": "Add FormMixin.get_form_kwargs method to abstract some common logic in a tidier\nway. Tidy up (and amend) documentation about FormMixin and ModelFormMixin.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14865 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2e909489d7601c59595e81e2b491dfc689abd778",
    "files": [
        {
            "sha": "931a2d3fe2fca364b778d622908c436d8f89f022",
            "filename": "django/views/generic/edit.py",
            "status": "modified",
            "additions": 17,
            "deletions": 23,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/2e909489d7601c59595e81e2b491dfc689abd778/django%2Fviews%2Fgeneric%2Fedit.py",
            "raw_url": "https://github.com/django/django/raw/2e909489d7601c59595e81e2b491dfc689abd778/django%2Fviews%2Fgeneric%2Fedit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fedit.py?ref=2e909489d7601c59595e81e2b491dfc689abd778",
            "patch": "@@ -31,16 +31,19 @@ def get_form(self, form_class):\n         \"\"\"\n         Returns an instance of the form to be used in this view.\n         \"\"\"\n+        return form_class(**self.get_form_kwargs())\n+\n+    def get_form_kwargs(self):\n+        \"\"\"\n+        Returns the keyword arguments for instanciating the form.\n+        \"\"\"\n+        kwargs = {'initial': self.get_initial()}\n         if self.request.method in ('POST', 'PUT'):\n-            return form_class(\n-                data=self.request.POST,\n-                files=self.request.FILES,\n-                initial=self.get_initial()\n-            )\n-        else:\n-            return form_class(\n-                initial=self.get_initial()\n-            )\n+            kwargs.update({\n+                'data': self.request.POST,\n+                'files': self.request.FILES,\n+            })\n+        return kwargs\n \n     def get_context_data(self, **kwargs):\n         return kwargs\n@@ -75,22 +78,13 @@ def get_form_class(self):\n             model = self.get_queryset().model\n             return model_forms.modelform_factory(model)\n \n-    def get_form(self, form_class):\n+    def get_form_kwargs(self):\n         \"\"\"\n-        Returns a form instantiated with the model instance from get_object().\n+        Returns the keyword arguments for instanciating the form.\n         \"\"\"\n-        if self.request.method in ('POST', 'PUT'):\n-            return form_class(\n-                data=self.request.POST,\n-                files=self.request.FILES,\n-                initial=self.get_initial(),\n-                instance=self.object,\n-            )\n-        else:\n-            return form_class(\n-                initial=self.get_initial(),\n-                instance=self.object,\n-            )\n+        kwargs = super(ModelFormMixin, self).get_form_kwargs()\n+        kwargs.update({'instance': self.object})\n+        return kwargs\n \n     def get_success_url(self):\n         if self.success_url:"
        },
        {
            "sha": "4784cd2350b66e254a2122750cd5a33295d01695",
            "filename": "docs/ref/class-based-views.txt",
            "status": "modified",
            "additions": 22,
            "deletions": 17,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/2e909489d7601c59595e81e2b491dfc689abd778/docs%2Fref%2Fclass-based-views.txt",
            "raw_url": "https://github.com/django/django/raw/2e909489d7601c59595e81e2b491dfc689abd778/docs%2Fref%2Fclass-based-views.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views.txt?ref=2e909489d7601c59595e81e2b491dfc689abd778",
            "patch": "@@ -413,27 +413,34 @@ FormMixin\n     .. method:: get_initial()\n \n         Retrieve initial data for the form. By default, returns\n-        :attr:`FormMixin.initial`.\n+        :attr:`.initial`.\n \n     .. method:: get_form_class()\n \n-        Retrieve the form class to instantiate. By default,\n-        :attr:`FormMixin.form_class`.\n+        Retrieve the form class to instantiate. By default\n+        :attr:`.form_class`.\n \n     .. method:: get_form(form_class)\n \n-        Instantiate an instance of ``form_class``. If the request is a ``POST``\n-        or ``PUT``, the request data (``request.POST`` and ``request.FILES``)\n-        will be provided to the form at time of construction.\n+        Instantiate an instance of ``form_class`` using\n+        :meth:`.get_form_kwargs`.\n+\n+    .. method:: get_form_kwargs()\n+\n+        Build the keyword arguments requried to instanciate an the form.\n+        \n+        The ``initial`` argument is set to :meth:`.get_initial`. If the\n+        request is a ``POST`` or ``PUT``, the request data (``request.POST``\n+        and ``request.FILES``) will also be provided.\n \n     .. method:: get_success_url()\n \n         Determine the URL to redirect to when the form is successfully\n-        validated. Returns :attr:`FormMixin.success_url` by default.\n+        validated. Returns :attr:`.success_url` by default.\n \n     .. method:: form_valid()\n \n-        Redirects to :attr:`ModelFormMixin.success_url`.\n+        Redirects to :meth:`.get_success_url`.\n \n     .. method:: form_invalid()\n \n@@ -449,9 +456,9 @@ FormMixin\n \n     .. note::\n \n-        Views mixing :class:`~django.views.generic.edit.FormMixin` must\n-        provide an implementation of :meth:`~FormMixin.form_valid` and\n-        :meth:`~FormMixin.form_invalid`.\n+        Views mixing :class:`FormMixin` must\n+        provide an implementation of :meth:`.form_valid` and\n+        :meth:`.form_invalid`.\n \n ModelFormMixin\n ~~~~~~~~~~~~~~\n@@ -490,12 +497,10 @@ ModelFormMixin\n         :attr:`~SingleObjectMixin.model`, depending on which attribute is\n         provided.\n \n-    .. method:: get_form(form_class)\n+    .. method:: get_form_kwargs()\n \n-        Instantiate an instance of ``form_class``. If the request is a ``POST``\n-        or ``PUT``, the request data (``request.POST`` and ``request.FILES``)\n-        will be provided to the form at time of construction. The current\n-        instance (``self.object``) will also be provided.\n+        Add the current instance (``self.object``) to the standard\n+        :meth:`FormMixin.get_form_kwargs`.\n \n     .. method:: get_success_url()\n \n@@ -506,7 +511,7 @@ ModelFormMixin\n     .. method:: form_valid()\n \n         Saves the form instance, sets the current object for the view, and\n-        redirects to :attr:`ModelFormMixin.success_url`.\n+        redirects to :meth:`.get_success_url`.\n \n     .. method:: form_invalid()\n "
        }
    ],
    "stats": {
        "total": 79,
        "additions": 39,
        "deletions": 40
    }
}