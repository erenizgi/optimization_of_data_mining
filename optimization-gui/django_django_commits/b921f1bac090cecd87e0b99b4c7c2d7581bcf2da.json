{
    "author": "jezdez",
    "message": "Fixed #12475 -- Fixed an edge case with hidden fields in ModelAdmin changelists when used in conjunction with list_display_links or list_editable. Thanks, Simon Meers, Julien Phalip, Karen and master.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15722 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b921f1bac090cecd87e0b99b4c7c2d7581bcf2da",
    "files": [
        {
            "sha": "891268faba3c46d1c02799d98abd4a1211a5a46e",
            "filename": "django/contrib/admin/templates/admin/change_list_results.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html",
            "raw_url": "https://github.com/django/django/raw/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html?ref=b921f1bac090cecd87e0b99b4c7c2d7581bcf2da",
            "patch": "@@ -1,5 +1,5 @@\n {% if result_hidden_fields %}\n-<div class=\"hiddenfields\"> {# DIV for HTML validation #}\n+<div class=\"hiddenfields\">{# DIV for HTML validation #}\n {% for item in result_hidden_fields %}{{ item }}{% endfor %}\n </div>\n {% endif %}"
        },
        {
            "sha": "fdf082be703b5bd27513855516fae56375c41ff6",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=b921f1bac090cecd87e0b99b4c7c2d7581bcf2da",
            "patch": "@@ -188,7 +188,9 @@ def items_for_result(cl, result, form):\n             # By default the fields come from ModelAdmin.list_editable, but if we pull\n             # the fields out of the form instead of list_editable custom admins\n             # can provide fields on a per request basis\n-            if form and field_name in form.fields:\n+            if (form and field_name in form.fields and not (\n+                    field_name == cl.model._meta.pk.name and\n+                        form[cl.model._meta.pk.name].is_hidden)):\n                 bf = form[field_name]\n                 result_repr = mark_safe(force_unicode(bf.errors) + force_unicode(bf))\n             else:"
        },
        {
            "sha": "4c4e2907d72a2aab5e8526d9dae82aabc6a418ce",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=b921f1bac090cecd87e0b99b4c7c2d7581bcf2da",
            "patch": "@@ -735,6 +735,28 @@ def queryset(self, request):\n         #return super(CoverLetterAdmin, self).queryset(request).only('author')\n         return super(CoverLetterAdmin, self).queryset(request).defer('date')\n \n+class Story(models.Model):\n+    title = models.CharField(max_length=100)\n+    content = models.TextField()\n+\n+class StoryForm(forms.ModelForm):\n+    class Meta:\n+        widgets = {'title': forms.HiddenInput}\n+\n+class StoryAdmin(admin.ModelAdmin):\n+    list_display = ('id', 'title', 'content')\n+    list_display_links = ('title',) # 'id' not in list_display_links\n+    list_editable = ('content', )\n+    form = StoryForm\n+\n+class OtherStory(models.Model):\n+    title = models.CharField(max_length=100)\n+    content = models.TextField()\n+\n+class OtherStoryAdmin(admin.ModelAdmin):\n+    list_display = ('id', 'title', 'content')\n+    list_display_links = ('title', 'id') # 'id' in list_display_links\n+    list_editable = ('content', )\n \n admin.site.register(Article, ArticleAdmin)\n admin.site.register(CustomArticle, CustomArticleAdmin)\n@@ -776,6 +798,8 @@ def queryset(self, request):\n admin.site.register(RowLevelChangePermissionModel, RowLevelChangePermissionModelAdmin)\n admin.site.register(Paper, PaperAdmin)\n admin.site.register(CoverLetter, CoverLetterAdmin)\n+admin.site.register(Story, StoryAdmin)\n+admin.site.register(OtherStory, OtherStoryAdmin)\n \n # We intentionally register Promo and ChapterXtra1 but not Chapter nor ChapterXtra2.\n # That way we cover all four cases:"
        },
        {
            "sha": "eca8adedc9b4157482c7cd51d04d655faf50f050",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 31,
            "deletions": 1,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b921f1bac090cecd87e0b99b4c7c2d7581bcf2da/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=b921f1bac090cecd87e0b99b4c7c2d7581bcf2da",
            "patch": "@@ -36,7 +36,7 @@\n     Language, Collector, Widget, Grommet, DooHickey, FancyDoodad, Whatsit,\n     Category, Post, Plot, FunkyTag, Chapter, Book, Promo, WorkHour, Employee,\n     Question, Answer, Inquisition, Actor, FoodDelivery,\n-    RowLevelChangePermissionModel, Paper, CoverLetter)\n+    RowLevelChangePermissionModel, Paper, CoverLetter, Story, OtherStory)\n \n \n class AdminViewBasicTest(TestCase):\n@@ -1678,6 +1678,36 @@ def test_list_editable_popup(self):\n         response = self.client.get('/test_admin/admin/admin_views/person/?%s' % IS_POPUP_VAR)\n         self.assertEqual(response.context['cl'].list_editable, ())\n \n+    def test_pk_hidden_fields(self):\n+        \"\"\" Ensure that hidden pk fields aren't displayed in the table body and\n+            that their corresponding human-readable value is displayed instead.\n+            Note that the hidden pk fields are in fact be displayed but\n+            separately (not in the table), and only once.\n+            Refs #12475.\n+        \"\"\"\n+        Story.objects.create(title='The adventures of Guido', content='Once upon a time in Djangoland...')\n+        Story.objects.create(title='Crouching Tiger, Hidden Python', content='The Python was sneaking into...')\n+        response = self.client.get('/test_admin/admin/admin_views/story/')\n+        self.assertContains(response, 'id=\"id_form-0-id\"', 1) # Only one hidden field, in a separate place than the table.\n+        self.assertContains(response, 'id=\"id_form-1-id\"', 1)\n+        self.assertContains(response, '<div class=\"hiddenfields\">\\n<input type=\"hidden\" name=\"form-0-id\" value=\"2\" id=\"id_form-0-id\" /><input type=\"hidden\" name=\"form-1-id\" value=\"1\" id=\"id_form-1-id\" />\\n</div>')\n+        self.assertContains(response, '<td>1</td>', 1)\n+        self.assertContains(response, '<td>2</td>', 1)\n+\n+    def test_pk_hidden_fields_with_list_display_links(self):\n+        \"\"\" Similarly as test_pk_hidden_fields, but when the hidden pk fields are\n+            referenced in list_display_links.\n+            Refs #12475.\n+        \"\"\"\n+        OtherStory.objects.create(title='The adventures of Guido', content='Once upon a time in Djangoland...')\n+        OtherStory.objects.create(title='Crouching Tiger, Hidden Python', content='The Python was sneaking into...')\n+        response = self.client.get('/test_admin/admin/admin_views/otherstory/')\n+        self.assertContains(response, 'id=\"id_form-0-id\"', 1) # Only one hidden field, in a separate place than the table.\n+        self.assertContains(response, 'id=\"id_form-1-id\"', 1)\n+        self.assertContains(response, '<div class=\"hiddenfields\">\\n<input type=\"hidden\" name=\"form-0-id\" value=\"2\" id=\"id_form-0-id\" /><input type=\"hidden\" name=\"form-1-id\" value=\"1\" id=\"id_form-1-id\" />\\n</div>')\n+        self.assertContains(response, '<th><a href=\"1/\">1</a></th>', 1)\n+        self.assertContains(response, '<th><a href=\"2/\">2</a></th>', 1)\n+\n \n class AdminSearchTest(TestCase):\n     fixtures = ['admin-views-users', 'multiple-child-classes',"
        }
    ],
    "stats": {
        "total": 62,
        "additions": 59,
        "deletions": 3
    }
}