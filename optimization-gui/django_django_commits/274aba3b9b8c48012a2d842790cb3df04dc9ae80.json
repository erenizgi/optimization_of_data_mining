{
    "author": "alex",
    "message": "Fixed #11108 -- added ModelAdmin.delete_model, a hook with which to perform custom pre-post delete behavior.  Thanks to Florian Apolloner for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14673 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "274aba3b9b8c48012a2d842790cb3df04dc9ae80",
    "files": [
        {
            "sha": "712f07eec7da2cadc34f22d25d5ce0f4034a16b7",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/274aba3b9b8c48012a2d842790cb3df04dc9ae80/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/274aba3b9b8c48012a2d842790cb3df04dc9ae80/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=274aba3b9b8c48012a2d842790cb3df04dc9ae80",
            "patch": "@@ -601,6 +601,12 @@ def save_model(self, request, obj, form, change):\n         \"\"\"\n         obj.save()\n \n+    def delete_model(self, requet, obj):\n+        \"\"\"\n+        Given a model instance delete it from the database.\n+        \"\"\"\n+        obj.delete()\n+\n     def save_formset(self, request, form, formset, change):\n         \"\"\"\n         Given an inline formset save it to the database.\n@@ -1122,7 +1128,7 @@ def delete_view(self, request, object_id, extra_context=None):\n                 raise PermissionDenied\n             obj_display = force_unicode(obj)\n             self.log_deletion(request, obj, obj_display)\n-            obj.delete()\n+            self.delete_model(request, obj)\n \n             self.message_user(request, _('The %(name)s \"%(obj)s\" was deleted successfully.') % {'name': force_unicode(opts.verbose_name), 'obj': force_unicode(obj_display)})\n "
        },
        {
            "sha": "cc918be922714351fe8cf3fe4b328e45dc485374",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/274aba3b9b8c48012a2d842790cb3df04dc9ae80/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/274aba3b9b8c48012a2d842790cb3df04dc9ae80/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=274aba3b9b8c48012a2d842790cb3df04dc9ae80",
            "patch": "@@ -757,6 +757,12 @@ templates used by the :class:`ModelAdmin` views:\n ``ModelAdmin`` methods\n ----------------------\n \n+.. warning::\n+\n+    :meth:`ModelAdmin.save_model` and :meth:`ModelAdmin.delete_model` must\n+    save/delete the object, they are not for veto purposes, rather they allow\n+    you to perform extra operations.\n+\n .. method:: ModelAdmin.save_model(self, request, obj, form, change)\n \n The ``save_model`` method is given the ``HttpRequest``, a model instance,\n@@ -770,6 +776,13 @@ For example to attach ``request.user`` to the object prior to saving::\n             obj.user = request.user\n             obj.save()\n \n+.. method:: ModelAdmin.delete_model(self, request, obj)\n+\n+.. versionadded:: 1.3\n+\n+The ``delete_model`` method is given the ``HttpRequest`` and a model instance.\n+Use this method to do pre- or post-delete operations.\n+\n .. method:: ModelAdmin.save_formset(self, request, form, formset, change)\n \n The ``save_formset`` method is given the ``HttpRequest``, the parent"
        },
        {
            "sha": "0e9290c37fd938d0c62a8a4ab9cd338fc8987b95",
            "filename": "docs/topics/db/multi-db.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/274aba3b9b8c48012a2d842790cb3df04dc9ae80/docs%2Ftopics%2Fdb%2Fmulti-db.txt",
            "raw_url": "https://github.com/django/django/raw/274aba3b9b8c48012a2d842790cb3df04dc9ae80/docs%2Ftopics%2Fdb%2Fmulti-db.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmulti-db.txt?ref=274aba3b9b8c48012a2d842790cb3df04dc9ae80",
            "patch": "@@ -458,7 +458,7 @@ database other than that that specified by your router chain, you'll\n need to write custom :class:`~django.contrib.admin.ModelAdmin` classes\n that will direct the admin to use a specific database for content.\n \n-``ModelAdmin`` objects have four methods that require customization for\n+``ModelAdmin`` objects have five methods that require customization for\n multiple-database support::\n \n     class MultiDBModelAdmin(admin.ModelAdmin):\n@@ -469,6 +469,10 @@ multiple-database support::\n             # Tell Django to save objects to the 'other' database.\n             obj.save(using=self.using)\n \n+        def delete_model(self, requqest, obj):\n+            # Tell Django to delete objects from the 'other' database\n+            obj.delete(using=self.using)\n+\n         def queryset(self, request):\n             # Tell Django to look for objects on the 'other' database.\n             return super(MultiDBModelAdmin, self).queryset(request).using(self.using)"
        },
        {
            "sha": "ee0f5d51a1d5eb0a4f99c8a9aa68a8d1d4953bb3",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/274aba3b9b8c48012a2d842790cb3df04dc9ae80/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/274aba3b9b8c48012a2d842790cb3df04dc9ae80/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=274aba3b9b8c48012a2d842790cb3df04dc9ae80",
            "patch": "@@ -107,6 +107,25 @@ def modeladmin_year(self, obj):\n     modeladmin_year.admin_order_field = 'date'\n     modeladmin_year.short_description = None\n \n+    def delete_model(self, request, obj):\n+        EmailMessage(\n+            'Greetings from a deleted object',\n+            'I hereby inform you that some user deleted me',\n+            'from@example.com',\n+            ['to@example.com']\n+        ).send()\n+        return super(ArticleAdmin, self).delete_model(request, obj)\n+\n+    def save_model(self, request, obj, form, change=True):\n+        EmailMessage(\n+            'Greetings from a created object',\n+            'I hereby inform you that some user created me',\n+            'from@example.com',\n+            ['to@example.com']\n+        ).send()\n+        return super(ArticleAdmin, self).save_model(request, obj, form, change)\n+\n+\n class CustomArticle(models.Model):\n     content = models.TextField()\n     date = models.DateTimeField()"
        },
        {
            "sha": "a3fe34f0bf9b104ece9989648249ed71f6210a09",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/274aba3b9b8c48012a2d842790cb3df04dc9ae80/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/274aba3b9b8c48012a2d842790cb3df04dc9ae80/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=274aba3b9b8c48012a2d842790cb3df04dc9ae80",
            "patch": "@@ -3,6 +3,7 @@\n import re\n import datetime\n from django.conf import settings\n+from django.core import mail\n from django.core.files import temp as tempfile\n from django.contrib.auth import admin # Register auth models with the admin.\n from django.contrib.auth.models import User, Permission, UNUSABLE_PASSWORD\n@@ -540,6 +541,8 @@ def testAddView(self):\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertRedirects(post, '/test_admin/admin/')\n         self.failUnlessEqual(Article.objects.all().count(), 4)\n+        self.assertEquals(len(mail.outbox), 1)\n+        self.assertEquals(mail.outbox[0].subject, 'Greetings from a created object')\n         self.client.get('/test_admin/admin/logout/')\n \n         # Super can add too, but is redirected to the change list view\n@@ -695,6 +698,8 @@ def testDeleteView(self):\n         post = self.client.post('/test_admin/admin/admin_views/article/1/delete/', delete_dict)\n         self.assertRedirects(post, '/test_admin/admin/')\n         self.failUnlessEqual(Article.objects.all().count(), 2)\n+        self.assertEquals(len(mail.outbox), 1)\n+        self.assertEquals(mail.outbox[0].subject, 'Greetings from a deleted object')\n         article_ct = ContentType.objects.get_for_model(Article)\n         logged = LogEntry.objects.get(content_type=article_ct, action_flag=DELETION)\n         self.failUnlessEqual(logged.object_id, u'1')\n@@ -1440,8 +1445,6 @@ def testInline(self):\n         self.failUnlessEqual(BarAccount.objects.all()[0].username, \"%s-1\" % bar_user)\n         self.failUnlessEqual(Persona.objects.all()[0].accounts.count(), 2)\n \n-from django.core import mail\n-\n class AdminActionsTest(TestCase):\n     fixtures = ['admin-views-users.xml', 'admin-views-actions.xml']\n "
        }
    ],
    "stats": {
        "total": 53,
        "additions": 49,
        "deletions": 4
    }
}