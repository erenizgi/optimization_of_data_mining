{
    "author": "freakboy3742",
    "message": "Fixed #15569 -- Corrected the numbering updates to inlines when rows are added and deleted. Thanks to sbaechler for the report, to Arthur de Jong and mk for the work on the patch, and to Karen Tracey for the last minute testing help.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15862 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1",
    "files": [
        {
            "sha": "bddd6f75ba3d8352465b21cfdcf2d5c757cbdb52",
            "filename": "django/contrib/admin/media/js/inlines.js",
            "status": "modified",
            "additions": 6,
            "deletions": 28,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1/django%2Fcontrib%2Fadmin%2Fmedia%2Fjs%2Finlines.js",
            "raw_url": "https://github.com/django/django/raw/c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1/django%2Fcontrib%2Fadmin%2Fmedia%2Fjs%2Finlines.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmedia%2Fjs%2Finlines.js?ref=c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1",
            "patch": "@@ -18,7 +18,7 @@\n \t$.fn.formset = function(opts) {\n \t\tvar options = $.extend({}, $.fn.formset.defaults, opts);\n \t\tvar updateElementIndex = function(el, prefix, ndx) {\n-\t\t\tvar id_regex = new RegExp(\"(\" + prefix + \"-\\\\d+)\");\n+\t\t\tvar id_regex = new RegExp(\"(\" + prefix + \"-(\\\\d+|__prefix__))\");\n \t\t\tvar replacement = prefix + \"-\" + ndx;\n \t\t\tif ($(el).attr(\"for\")) {\n \t\t\t\t$(el).attr(\"for\", $(el).attr(\"for\").replace(id_regex, replacement));\n@@ -59,31 +59,6 @@\n \t\t\t\trow.removeClass(options.emptyCssClass)\n \t\t\t\t    .addClass(options.formCssClass)\n \t\t\t\t    .attr(\"id\", options.prefix + \"-\" + nextIndex);\n-\t\t\t\tnextIndex += 1;\n-\t\t\t\trow.find(\"*\")\n-\t\t\t\t    .filter(function() {\n-\t\t\t\t        var el = $(this);\n-\t\t\t\t        return el.attr(\"id\") && el.attr(\"id\").search(/__prefix__/) >= 0;\n-\t\t\t\t    }).each(function() {\n-\t\t\t\t        var el = $(this);\n-\t\t\t\t        el.attr(\"id\", el.attr(\"id\").replace(/__prefix__/g, nextIndex));\n-\t\t\t\t    })\n-\t\t\t\t    .end()\n-\t\t\t\t    .filter(function() {\n-\t\t\t\t        var el = $(this);\n-\t\t\t\t        return el.attr(\"name\") && el.attr(\"name\").search(/__prefix__/) >= 0;\n-\t\t\t\t    }).each(function() {\n-\t\t\t\t        var el = $(this);\n-\t\t\t\t        el.attr(\"name\", el.attr(\"name\").replace(/__prefix__/g, nextIndex));\n-\t\t\t\t    })\n-\t\t\t\t    .end()\n-\t\t\t\t    .filter(function() {\n-\t\t\t\t        var el = $(this);\n-\t\t\t\t        return el.attr(\"for\") && el.attr(\"for\").search(/__prefix__/) >= 0;\n-\t\t\t\t    }).each(function() {\n-\t\t\t\t        var el = $(this);\n-\t\t\t\t        el.attr(\"for\", el.attr(\"for\").replace(/__prefix__/g, nextIndex));\n-\t\t\t\t    });\n \t\t\t\tif (row.is(\"tr\")) {\n \t\t\t\t\t// If the forms are laid out in table rows, insert\n \t\t\t\t\t// the remove button into the last table cell:\n@@ -97,13 +72,14 @@\n \t\t\t\t\t// last child element of the form's container:\n \t\t\t\t\trow.children(\":first\").append('<span><a class=\"' + options.deleteCssClass + '\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></span>\");\n \t\t\t\t}\n-\t\t\t\trow.find(\"input,select,textarea,label,a\").each(function() {\n+\t\t\t\trow.find(\"*\").each(function() {\n \t\t\t\t\tupdateElementIndex(this, options.prefix, totalForms.val());\n \t\t\t\t});\n \t\t\t\t// Insert the new form when it has been fully edited\n \t\t\t\trow.insertBefore($(template));\n \t\t\t\t// Update number of total forms\n \t\t\t\t$(totalForms).val(parseInt(totalForms.val()) + 1);\n+\t\t\t\tnextIndex += 1;\n \t\t\t\t// Hide add button in case we've hit the max, except we want to add infinitely\n \t\t\t\tif ((maxForms.val() != '') && (maxForms.val()-totalForms.val()) <= 0) {\n \t\t\t\t\taddButton.parent().hide();\n@@ -113,6 +89,7 @@\n \t\t\t\t\t// Remove the parent form containing this button:\n \t\t\t\t\tvar row = $(this).parents(\".\" + options.formCssClass);\n \t\t\t\t\trow.remove();\n+\t\t\t\t\tnextIndex -= 1;\n \t\t\t\t\t// If a post-delete callback was provided, call it with the deleted form:\n \t\t\t\t\tif (options.removed) {\n \t\t\t\t\t\toptions.removed(row);\n@@ -128,7 +105,8 @@\n \t\t\t\t\t// so they remain in sequence:\n \t\t\t\t\tfor (var i=0, formCount=forms.length; i<formCount; i++)\n \t\t\t\t\t{\n-\t\t\t\t\t\t$(forms.get(i)).find(\"input,select,textarea,label,a\").each(function() {\n+\t\t\t\t\t\tupdateElementIndex($(forms).get(i), options.prefix, i);\n+\t\t\t\t\t\t$(forms.get(i)).find(\"*\").each(function() {\n \t\t\t\t\t\t\tupdateElementIndex(this, options.prefix, i);\n \t\t\t\t\t\t});\n \t\t\t\t\t}"
        },
        {
            "sha": "e8152ea35704b3c505cd865f618c9320985ea974",
            "filename": "django/contrib/admin/media/js/inlines.min.js",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1/django%2Fcontrib%2Fadmin%2Fmedia%2Fjs%2Finlines.min.js",
            "raw_url": "https://github.com/django/django/raw/c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1/django%2Fcontrib%2Fadmin%2Fmedia%2Fjs%2Finlines.min.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmedia%2Fjs%2Finlines.min.js?ref=c2ae6b2af7dcedaf4f6639da184912b6e4b3c1f1",
            "patch": "@@ -1,6 +1,5 @@\n-(function(a){a.fn.formset=function(g){var b=a.extend({},a.fn.formset.defaults,g),l=function(d,f,e){var c=RegExp(\"(\"+f+\"-\\\\d+)\");f=f+\"-\"+e;a(d).attr(\"for\")&&a(d).attr(\"for\",a(d).attr(\"for\").replace(c,f));if(d.id)d.id=d.id.replace(c,f);if(d.name)d.name=d.name.replace(c,f)};g=a(\"#id_\"+b.prefix+\"-TOTAL_FORMS\").attr(\"autocomplete\",\"off\");var i=parseInt(g.val()),h=a(\"#id_\"+b.prefix+\"-MAX_NUM_FORMS\").attr(\"autocomplete\",\"off\");g=h.val()==\"\"||h.val()-g.val()>0;a(this).each(function(){a(this).not(\".\"+b.emptyCssClass).addClass(b.formCssClass)});\n-if(a(this).length&&g){var j;if(a(this).attr(\"tagName\")==\"TR\"){g=this.eq(0).children().length;a(this).parent().append('<tr class=\"'+b.addCssClass+'\"><td colspan=\"'+g+'\"><a href=\"javascript:void(0)\">'+b.addText+\"</a></tr>\");j=a(this).parent().find(\"tr:last a\")}else{a(this).filter(\":last\").after('<div class=\"'+b.addCssClass+'\"><a href=\"javascript:void(0)\">'+b.addText+\"</a></div>\");j=a(this).filter(\":last\").next().find(\"a\")}j.click(function(){var d=a(\"#id_\"+b.prefix+\"-TOTAL_FORMS\"),f=a(\"#\"+b.prefix+\"-empty\"),\n-e=f.clone(true);e.removeClass(b.emptyCssClass).addClass(b.formCssClass).attr(\"id\",b.prefix+\"-\"+i);i+=1;e.find(\"*\").filter(function(){var c=a(this);return c.attr(\"id\")&&c.attr(\"id\").search(/__prefix__/)>=0}).each(function(){var c=a(this);c.attr(\"id\",c.attr(\"id\").replace(/__prefix__/g,i))}).end().filter(function(){var c=a(this);return c.attr(\"name\")&&c.attr(\"name\").search(/__prefix__/)>=0}).each(function(){var c=a(this);c.attr(\"name\",c.attr(\"name\").replace(/__prefix__/g,i))}).end().filter(function(){var c=\n-a(this);return c.attr(\"for\")&&c.attr(\"for\").search(/__prefix__/)>=0}).each(function(){var c=a(this);c.attr(\"for\",c.attr(\"for\").replace(/__prefix__/g,i))});if(e.is(\"tr\"))e.children(\":last\").append('<div><a class=\"'+b.deleteCssClass+'\" href=\"javascript:void(0)\">'+b.deleteText+\"</a></div>\");else e.is(\"ul\")||e.is(\"ol\")?e.append('<li><a class=\"'+b.deleteCssClass+'\" href=\"javascript:void(0)\">'+b.deleteText+\"</a></li>\"):e.children(\":first\").append('<span><a class=\"'+b.deleteCssClass+'\" href=\"javascript:void(0)\">'+\n-b.deleteText+\"</a></span>\");e.find(\"input,select,textarea,label,a\").each(function(){l(this,b.prefix,d.val())});e.insertBefore(a(f));a(d).val(parseInt(d.val())+1);h.val()!=\"\"&&h.val()-d.val()<=0&&j.parent().hide();e.find(\"a.\"+b.deleteCssClass).click(function(){var c=a(this).parents(\".\"+b.formCssClass);c.remove();b.removed&&b.removed(c);c=a(\".\"+b.formCssClass);a(\"#id_\"+b.prefix+\"-TOTAL_FORMS\").val(c.length);if(h.val()==\"\"||h.val()-c.length>0)j.parent().show();for(var k=0,m=c.length;k<m;k++)a(c.get(k)).find(\"input,select,textarea,label,a\").each(function(){l(this,\n-b.prefix,k)});return false});b.added&&b.added(e);return false})}return this};a.fn.formset.defaults={prefix:\"form\",addText:\"add another\",deleteText:\"remove\",addCssClass:\"add-row\",deleteCssClass:\"delete-row\",emptyCssClass:\"empty-row\",formCssClass:\"dynamic-form\",added:null,removed:null}})(django.jQuery);\n+(function(b){b.fn.formset=function(g){var a=b.extend({},b.fn.formset.defaults,g),k=function(c,f,d){var e=new RegExp(\"(\"+f+\"-(\\\\d+|__prefix__))\");f=f+\"-\"+d;b(c).attr(\"for\")&&b(c).attr(\"for\",b(c).attr(\"for\").replace(e,f));if(c.id)c.id=c.id.replace(e,f);if(c.name)c.name=c.name.replace(e,f)};g=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").attr(\"autocomplete\",\"off\");var l=parseInt(g.val()),h=b(\"#id_\"+a.prefix+\"-MAX_NUM_FORMS\").attr(\"autocomplete\",\"off\");g=h.val()==\"\"||h.val()-g.val()>0;b(this).each(function(){b(this).not(\".\"+\n+a.emptyCssClass).addClass(a.formCssClass)});if(b(this).length&&g){var j;if(b(this).attr(\"tagName\")==\"TR\"){g=this.eq(0).children().length;b(this).parent().append('<tr class=\"'+a.addCssClass+'\"><td colspan=\"'+g+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></tr>\");j=b(this).parent().find(\"tr:last a\")}else{b(this).filter(\":last\").after('<div class=\"'+a.addCssClass+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></div>\");j=b(this).filter(\":last\").next().find(\"a\")}j.click(function(){var c=b(\"#id_\"+\n+a.prefix+\"-TOTAL_FORMS\"),f=b(\"#\"+a.prefix+\"-empty\"),d=f.clone(true);d.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr(\"id\",a.prefix+\"-\"+l);if(d.is(\"tr\"))d.children(\":last\").append('<div><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></div>\");else d.is(\"ul\")||d.is(\"ol\")?d.append('<li><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></li>\"):d.children(\":first\").append('<span><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+\n+a.deleteText+\"</a></span>\");d.find(\"*\").each(function(){k(this,a.prefix,c.val())});d.insertBefore(b(f));b(c).val(parseInt(c.val())+1);l+=1;h.val()!=\"\"&&h.val()-c.val()<=0&&j.parent().hide();d.find(\"a.\"+a.deleteCssClass).click(function(){var e=b(this).parents(\".\"+a.formCssClass);e.remove();l-=1;a.removed&&a.removed(e);e=b(\".\"+a.formCssClass);b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").val(e.length);if(h.val()==\"\"||h.val()-e.length>0)j.parent().show();for(var i=0,m=e.length;i<m;i++){k(b(e).get(i),a.prefix,i);\n+b(e.get(i)).find(\"*\").each(function(){k(this,a.prefix,i)})}return false});a.added&&a.added(d);return false})}return this};b.fn.formset.defaults={prefix:\"form\",addText:\"add another\",deleteText:\"remove\",addCssClass:\"add-row\",deleteCssClass:\"delete-row\",emptyCssClass:\"empty-row\",formCssClass:\"dynamic-form\",added:null,removed:null}})(django.jQuery);"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 11,
        "deletions": 34
    }
}