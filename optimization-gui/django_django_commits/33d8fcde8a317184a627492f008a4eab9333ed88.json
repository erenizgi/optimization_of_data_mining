{
    "author": "jezdez",
    "message": "Fixed #14693, #14709 -- Backwards incompatible change to rectify the confusion around the STATICFILES_URL and STATICFILES_ROOT settings.\n\n  * Two new global settings that will be used by -- **but are not limited to** -- the staticfiles app: STATIC_ROOT and STATIC_URL.\n\n  * Moving the 'django.contrib.staticfiles.templatetags.staticfiles' template tag to the core ('django.templatetags.static') and renaming it to 'get_static_prefix'.\n\n  * Moving the context processor 'django.contrib.staticfiles.context_processors.staticfiles' to the core ('django.core.context_processors.static') and renaming it to 'static'.\n\n  * Paths in media definitions will use STATIC_URL as the prefix if the value is not None, and falls back to the previously used MEDIA_URL.\n\nThanks again to the community for constructive criticism and Carl and Russ for sanity-inducing discussions on IRC.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14592 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "33d8fcde8a317184a627492f008a4eab9333ed88",
    "files": [
        {
            "sha": "191a463ac8f51118f1d8f1134ac7faa640532d07",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -195,9 +195,9 @@\n     'django.core.context_processors.debug',\n     'django.core.context_processors.i18n',\n     'django.core.context_processors.media',\n+    'django.core.context_processors.static',\n #    'django.core.context_processors.request',\n     'django.contrib.messages.context_processors.messages',\n-    'django.contrib.staticfiles.context_processors.staticfiles',\n )\n \n # Output to use in template system for invalid (e.g. misspelled) variables.\n@@ -256,13 +256,21 @@\n DEFAULT_FILE_STORAGE = 'django.core.files.storage.FileSystemStorage'\n \n # Absolute filesystem path to the directory that will hold user-uploaded files.\n-# Example: \"/home/media/media.lawrence.com/\"\n+# Example: \"/home/media/media.lawrence.com/media/\"\n MEDIA_ROOT = ''\n \n # URL that handles the media served from MEDIA_ROOT.\n-# Example: \"http://media.lawrence.com\"\n+# Example: \"http://media.lawrence.com/media/\"\n MEDIA_URL = ''\n \n+# Absolute path to the directory that holds static files.\n+# Example: \"/home/media/media.lawrence.com/static/\"\n+STATIC_ROOT = ''\n+\n+# URL that handles the static files served from STATIC_ROOT.\n+# Example: \"http://media.lawrence.com/static/\"\n+STATIC_URL = None\n+\n # List of upload handler classes to be applied in order.\n FILE_UPLOAD_HANDLERS = (\n     'django.core.files.uploadhandler.MemoryFileUploadHandler',\n@@ -552,14 +560,6 @@\n # STATICFILES #\n ###############\n \n-# Absolute path to the directory that holds media.\n-# Example: \"/home/media/media.lawrence.com/static/\"\n-STATICFILES_ROOT = ''\n-\n-# URL that handles the static files served from STATICFILES_ROOT.\n-# Example: \"http://media.lawrence.com/static/\"\n-STATICFILES_URL = '/static/'\n-\n # A list of locations of additional static files\n STATICFILES_DIRS = ()\n "
        },
        {
            "sha": "e0265579b8787600158d735f1434219f0d889413",
            "filename": "django/conf/project_template/settings.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fconf%2Fproject_template%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fconf%2Fproject_template%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fsettings.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -49,16 +49,16 @@\n \n # URL that handles the media served from MEDIA_ROOT. Make sure to use a\n # trailing slash if there is a path component (optional in other cases).\n-# Examples: \"http://media.lawrence.com\", \"http://example.com/media/\"\n+# Examples: \"http://media.lawrence.com/media/\", \"http://example.com/media/\"\n MEDIA_URL = ''\n \n-# Absolute path to the directory that holds media.\n+# Absolute path to the directory that holds static files.\n # Example: \"/home/media/media.lawrence.com/static/\"\n-STATICFILES_ROOT = ''\n+STATIC_ROOT = ''\n \n-# URL that handles the static files served from STATICFILES_ROOT.\n-# Example: \"http://static.lawrence.com/\", \"http://example.com/static/\"\n-STATICFILES_URL = '/static/'\n+# URL that handles the static files served from STATIC_ROOT.\n+# Example: \"http://media.lawrence.com/static/\"\n+STATIC_URL = '/static/'\n \n # URL prefix for admin media -- CSS, JavaScript and images.\n # Make sure to use a trailing slash."
        },
        {
            "sha": "3b1c39b3a7f7542d65fbe97fcde81ce436883995",
            "filename": "django/contrib/admin/templatetags/adminmedia.py",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadminmedia.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadminmedia.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadminmedia.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -1,15 +1,11 @@\n from django.template import Library\n-from django.utils.encoding import iri_to_uri\n+from django.templatetags.static import PrefixNode\n \n register = Library()\n \n+@register.simple_tag\n def admin_media_prefix():\n     \"\"\"\n     Returns the string contained in the setting ADMIN_MEDIA_PREFIX.\n     \"\"\"\n-    try:\n-        from django.conf import settings\n-    except ImportError:\n-        return ''\n-    return iri_to_uri(settings.ADMIN_MEDIA_PREFIX)\n-admin_media_prefix = register.simple_tag(admin_media_prefix)\n+    return PrefixNode.handle_simple(\"ADMIN_MEDIA_PREFIX\")"
        },
        {
            "sha": "3ed00719e12860502cc16c49776b1dcc603071b9",
            "filename": "django/contrib/staticfiles/context_processors.py",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/9b45f6cd5444423693715cc2a04d91a0de75060b/django%2Fcontrib%2Fstaticfiles%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/9b45f6cd5444423693715cc2a04d91a0de75060b/django%2Fcontrib%2Fstaticfiles%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fcontext_processors.py?ref=9b45f6cd5444423693715cc2a04d91a0de75060b",
            "patch": "@@ -1,6 +0,0 @@\n-from django.conf import settings\n-\n-def staticfiles(request):\n-    return {\n-        'STATICFILES_URL': settings.STATICFILES_URL,\n-    }"
        },
        {
            "sha": "2b7276133fa23015b3006194fc958ffe95efdd3a",
            "filename": "django/contrib/staticfiles/handlers.py",
            "status": "modified",
            "additions": 17,
            "deletions": 19,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fhandlers.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fhandlers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fhandlers.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -10,46 +10,44 @@\n class StaticFilesHandler(WSGIHandler):\n     \"\"\"\n     WSGI middleware that intercepts calls to the static files directory, as\n-    defined by the STATICFILES_URL setting, and serves those files.\n+    defined by the STATIC_URL setting, and serves those files.\n     \"\"\"\n-    def __init__(self, application, media_dir=None):\n+    def __init__(self, application, base_dir=None):\n         self.application = application\n-        if media_dir:\n-            self.media_dir = media_dir\n+        if base_dir:\n+            self.base_dir = base_dir\n         else:\n-            self.media_dir = self.get_media_dir()\n-        self.media_url = urlparse(self.get_media_url())\n-        if settings.DEBUG:\n-            utils.check_settings()\n+            self.base_dir = self.get_base_dir()\n+        self.base_url = urlparse(self.get_base_url())\n         super(StaticFilesHandler, self).__init__()\n \n-    def get_media_dir(self):\n-        return settings.STATICFILES_ROOT\n+    def get_base_dir(self):\n+        return settings.STATIC_ROOT\n \n-    def get_media_url(self):\n-        return settings.STATICFILES_URL\n+    def get_base_url(self):\n+        if settings.DEBUG:\n+            utils.check_settings()\n+        return settings.STATIC_URL\n \n     def _should_handle(self, path):\n         \"\"\"\n         Checks if the path should be handled. Ignores the path if:\n \n-        * the host is provided as part of the media_url\n+        * the host is provided as part of the base_url\n         * the request's path isn't under the media path (or equal)\n-        * settings.DEBUG isn't True\n         \"\"\"\n-        return (self.media_url[2] != path and\n-            path.startswith(self.media_url[2]) and not self.media_url[1])\n+        return (self.base_url[2] != path and\n+            path.startswith(self.base_url[2]) and not self.base_url[1])\n \n     def file_path(self, url):\n         \"\"\"\n         Returns the relative path to the media file on disk for the given URL.\n \n-        The passed URL is assumed to begin with ``media_url``.  If the\n+        The passed URL is assumed to begin with ``base_url``.  If the\n         resultant file path is outside the media directory, then a ValueError\n         is raised.\n         \"\"\"\n-        # Remove ``media_url``.\n-        relative_url = url[len(self.media_url[2]):]\n+        relative_url = url[len(self.base_url[2]):]\n         return urllib.url2pathname(relative_url)\n \n     def serve(self, request):"
        },
        {
            "sha": "8882ae20db11449f1d8c0bd4ccd8c5a6af4062e7",
            "filename": "django/contrib/staticfiles/management/commands/collectstatic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -12,7 +12,7 @@\n class Command(NoArgsCommand):\n     \"\"\"\n     Command that allows to copy or symlink media files from different\n-    locations to the settings.STATICFILES_ROOT.\n+    locations to the settings.STATIC_ROOT.\n     \"\"\"\n     option_list = NoArgsCommand.option_list + (\n         make_option('--noinput', action='store_false', dest='interactive',\n@@ -85,7 +85,7 @@ def handle_noargs(self, **options):\n             self.stdout.write(\"\\n%s static file%s %s to '%s'%s.\\n\"\n                               % (actual_count, actual_count != 1 and 's' or '',\n                                  symlink and 'symlinked' or 'copied',\n-                                 settings.STATICFILES_ROOT,\n+                                 settings.STATIC_ROOT,\n                                  unmodified_count and ' (%s unmodified)'\n                                  % unmodified_count or ''))\n "
        },
        {
            "sha": "f4c22598c3706aa9afacee66564fd83d3f65a6b1",
            "filename": "django/contrib/staticfiles/management/commands/runserver.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Frunserver.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Frunserver.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Frunserver.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -8,7 +8,7 @@\n class Command(BaseRunserverCommand):\n     option_list = BaseRunserverCommand.option_list + (\n         make_option('--nostatic', action=\"store_false\", dest='use_static_handler', default=True,\n-            help='Tells Django to NOT automatically serve static files at STATICFILES_URL.'),\n+            help='Tells Django to NOT automatically serve static files at STATIC_URL.'),\n         make_option('--insecure', action=\"store_true\", dest='insecure_serving', default=False,\n             help='Allows serving static files even if DEBUG is False.'),\n     )"
        },
        {
            "sha": "eb0eabf861d4ba3949936776f642f14a926ff0b6",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -12,21 +12,22 @@ class StaticFilesStorage(FileSystemStorage):\n     Standard file system storage for site media files.\n     \n     The defaults for ``location`` and ``base_url`` are\n-    ``STATICFILES_ROOT`` and ``STATICFILES_URL``.\n+    ``STATIC_ROOT`` and ``STATIC_URL``.\n     \"\"\"\n     def __init__(self, location=None, base_url=None, *args, **kwargs):\n         if location is None:\n-            location = settings.STATICFILES_ROOT\n+            location = settings.STATIC_ROOT\n         if base_url is None:\n-            base_url = settings.STATICFILES_URL\n+            base_url = settings.STATIC_URL\n         if not location:\n             raise ImproperlyConfigured(\"You're using the staticfiles app \"\n-                \"without having set the STATICFILES_ROOT setting. Set it to \"\n+                \"without having set the STATIC_ROOT setting. Set it to \"\n                 \"the absolute path of the directory that holds static media.\")\n-        if not base_url:\n+        # check for None since we might use a root URL (``/``)\n+        if base_url is None:\n             raise ImproperlyConfigured(\"You're using the staticfiles app \"\n-                \"without having set the STATICFILES_URL setting. Set it to \"\n-                \"URL that handles the files served from STATICFILES_ROOT.\")\n+                \"without having set the STATIC_URL setting. Set it to \"\n+                \"URL that handles the files served from STATIC_ROOT.\")\n         if settings.DEBUG:\n             utils.check_settings()\n         super(StaticFilesStorage, self).__init__(location, base_url, *args, **kwargs)"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/staticfiles/templatetags/__init__.py",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/9b45f6cd5444423693715cc2a04d91a0de75060b/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/9b45f6cd5444423693715cc2a04d91a0de75060b/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2F__init__.py?ref=9b45f6cd5444423693715cc2a04d91a0de75060b"
        },
        {
            "sha": "6153f5a385fc05ad4c8cfa53c332418225ddf13c",
            "filename": "django/contrib/staticfiles/templatetags/staticfiles.py",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/9b45f6cd5444423693715cc2a04d91a0de75060b/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py",
            "raw_url": "https://github.com/django/django/raw/9b45f6cd5444423693715cc2a04d91a0de75060b/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py?ref=9b45f6cd5444423693715cc2a04d91a0de75060b",
            "patch": "@@ -1,43 +0,0 @@\n-from django import template\n-from django.utils.encoding import iri_to_uri\n-\n-register = template.Library()\n-\n-class StaticFilesPrefixNode(template.Node):\n-\n-    def __init__(self, varname=None):\n-        self.varname = varname\n-\n-    def render(self, context):\n-        try:\n-            from django.conf import settings\n-        except ImportError:\n-            prefix = ''\n-        else:\n-            prefix = iri_to_uri(settings.STATICFILES_URL)\n-        if self.varname is None:\n-            return prefix\n-        context[self.varname] = prefix\n-        return ''\n-\n-@register.tag\n-def get_staticfiles_prefix(parser, token):\n-    \"\"\"\n-    Populates a template variable with the prefix (settings.STATICFILES_URL).\n-\n-    Usage::\n-\n-        {% get_staticfiles_prefix [as varname] %}\n-\n-    Examples::\n-\n-        {% get_staticfiles_prefix %}\n-        {% get_staticfiles_prefix as staticfiles_prefix %}\n-\n-    \"\"\"\n-    tokens = token.contents.split()\n-    if len(tokens) > 1 and tokens[1] != 'as':\n-        raise template.TemplateSyntaxError(\n-            \"First argument in '%s' must be 'as'\" % tokens[0])\n-    return StaticFilesPrefixNode(varname=(len(tokens) > 1 and tokens[2] or None))\n-"
        },
        {
            "sha": "aa4ab459d1696fa05239512986c85a12916c659f",
            "filename": "django/contrib/staticfiles/urls.py",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Furls.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -18,15 +18,10 @@ def staticfiles_urlpatterns(prefix=None):\n     if not settings.DEBUG:\n         return []\n     if prefix is None:\n-        prefix = settings.STATICFILES_URL\n-    if not prefix:\n+        prefix = settings.STATIC_URL\n+    if not prefix or '://' in prefix:\n         raise ImproperlyConfigured(\n-            \"The prefix for the 'staticfiles_urlpatterns' helper is empty. \"\n-            \"Make sure the STATICFILES_URL setting is set correctly.\")\n-    if '://' in prefix:\n-        raise ImproperlyConfigured(\n-            \"The STATICFILES_URL setting is a full URL, not a path and \"\n-            \"can't be used with the 'staticfiles_urlpatterns' helper.\")\n+            \"The prefix for the 'staticfiles_urlpatterns' helper is invalid.\")\n     if prefix.startswith(\"/\"):\n         prefix = prefix[1:]\n     return patterns('',"
        },
        {
            "sha": "428bb69b1e1fcb7d5b554d225388c8699d45dbba",
            "filename": "django/contrib/staticfiles/utils.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcontrib%2Fstaticfiles%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Futils.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -33,13 +33,13 @@ def is_ignored(path):\n \n def check_settings():\n     \"\"\"\n-    Checks if the MEDIA_(ROOT|URL) and STATICFILES_(ROOT|URL)\n+    Checks if the MEDIA_(ROOT|URL) and STATIC_(ROOT|URL)\n     settings have the same value.\n     \"\"\"\n-    if settings.MEDIA_URL == settings.STATICFILES_URL:\n-        raise ImproperlyConfigured(\"The MEDIA_URL and STATICFILES_URL \"\n-                                   \"settings must have individual values\")\n-    if ((settings.MEDIA_ROOT and settings.STATICFILES_ROOT) and\n-            (settings.MEDIA_ROOT == settings.STATICFILES_ROOT)):\n-        raise ImproperlyConfigured(\"The MEDIA_ROOT and STATICFILES_ROOT \"\n-                                   \"settings must have individual values\")\n+    if settings.MEDIA_URL == settings.STATIC_URL:\n+        raise ImproperlyConfigured(\"The MEDIA_URL and STATIC_URL \"\n+                                   \"settings must have different values\")\n+    if ((settings.MEDIA_ROOT and settings.STATIC_ROOT) and\n+            (settings.MEDIA_ROOT == settings.STATIC_ROOT)):\n+        raise ImproperlyConfigured(\"The MEDIA_ROOT and STATIC_ROOT \"\n+                                   \"settings must have different values\")"
        },
        {
            "sha": "fa05d425f6ca3a464be95f300a56179548e3cef9",
            "filename": "django/core/context_processors.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcore%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcore%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcontext_processors.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -66,6 +66,13 @@ def i18n(request):\n \n     return context_extras\n \n+def static(request):\n+    \"\"\"\n+    Adds static-related context variables to the context.\n+\n+    \"\"\"\n+    return {'STATIC_URL': settings.STATIC_URL}\n+\n def media(request):\n     \"\"\"\n     Adds media-related context variables to the context."
        },
        {
            "sha": "9c3e90043b01ef088667093767fbce9569497629",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 14,
            "deletions": 14,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -17,8 +17,8 @@\n from django.core.management.color import color_style\n from django.utils.http import http_date\n from django.utils._os import safe_join\n-from django.contrib.staticfiles.handlers import StaticFilesHandler\n-from django.views import static\n+\n+from django.contrib.staticfiles import handlers, views as static\n \n __version__ = \"0.1\"\n __all__ = ['WSGIServer','WSGIRequestHandler']\n@@ -635,34 +635,34 @@ def log_message(self, format, *args):\n         sys.stderr.write(msg)\n \n \n-class AdminMediaHandler(StaticFilesHandler):\n+class AdminMediaHandler(handlers.StaticFilesHandler):\n     \"\"\"\n     WSGI middleware that intercepts calls to the admin media directory, as\n     defined by the ADMIN_MEDIA_PREFIX setting, and serves those images.\n     Use this ONLY LOCALLY, for development! This hasn't been tested for\n     security and is not super efficient.\n-    \"\"\"\n \n-    def get_media_dir(self):\n+    This is pending for deprecation since 1.3.\n+    \"\"\"\n+    def get_base_dir(self):\n         import django\n         return os.path.join(django.__path__[0], 'contrib', 'admin', 'media')\n \n-    def get_media_url(self):\n+    def get_base_url(self):\n         from django.conf import settings\n         return settings.ADMIN_MEDIA_PREFIX\n \n     def file_path(self, url):\n         \"\"\"\n         Returns the path to the media file on disk for the given URL.\n \n-        The passed URL is assumed to begin with ``media_url``.  If the\n-        resultant file path is outside the media directory, then a ValueError\n+        The passed URL is assumed to begin with ``self.base_url``.  If the\n+        resulting file path is outside the media directory, then a ValueError\n         is raised.\n         \"\"\"\n-        # Remove ``media_url``.\n-        relative_url = url[len(self.media_url[2]):]\n+        relative_url = url[len(self.base_url[2]):]\n         relative_path = urllib.url2pathname(relative_url)\n-        return safe_join(self.media_dir, relative_path)\n+        return safe_join(self.base_dir, relative_path)\n \n     def serve(self, request):\n         document_root, path = os.path.split(self.file_path(request.path))\n@@ -673,10 +673,10 @@ def _should_handle(self, path):\n         \"\"\"\n         Checks if the path should be handled. Ignores the path if:\n \n-        * the host is provided as part of the media_url\n-        * the request's path isn't under the media path\n+        * the host is provided as part of the base_url\n+        * the request's path isn't under the base path\n         \"\"\"\n-        return path.startswith(self.media_url[2]) and not self.media_url[1]\n+        return path.startswith(self.base_url[2]) and not self.base_url[1]\n \n \n def run(addr, port, wsgi_handler):"
        },
        {
            "sha": "8eb5fef3e719326c632aab8ca1bbc23868ba1af1",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -1,20 +1,20 @@\n \"\"\"\n HTML Widget classes\n \"\"\"\n+import datetime\n+from itertools import chain\n+import time\n+from urlparse import urljoin\n+from util import flatatt\n \n import django.utils.copycompat as copy\n-from itertools import chain\n from django.conf import settings\n from django.utils.datastructures import MultiValueDict, MergeDict\n from django.utils.html import escape, conditional_escape\n from django.utils.translation import ugettext, ugettext_lazy\n from django.utils.encoding import StrAndUnicode, force_unicode\n from django.utils.safestring import mark_safe\n from django.utils import datetime_safe, formats\n-import time\n-import datetime\n-from util import flatatt\n-from urlparse import urljoin\n \n __all__ = (\n     'Media', 'MediaDefiningClass', 'Widget', 'TextInput', 'PasswordInput',\n@@ -63,10 +63,16 @@ def render_css(self):\n                     for path in self._css[medium]]\n                 for medium in media])\n \n-    def absolute_path(self, path):\n+    def absolute_path(self, path, prefix=None):\n         if path.startswith(u'http://') or path.startswith(u'https://') or path.startswith(u'/'):\n             return path\n-        return urljoin(settings.MEDIA_URL,path)\n+        if prefix is None:\n+            if settings.STATIC_URL is None:\n+                 # backwards compatibility\n+                prefix = settings.MEDIA_URL\n+            else:\n+                prefix = settings.STATIC_URL\n+        return urljoin(prefix, path)\n \n     def __getitem__(self, name):\n         \"Returns a Media object that only contains media of the given type\""
        },
        {
            "sha": "97d657189bece405031bbaf26d705558d5c28920",
            "filename": "django/templatetags/static.py",
            "status": "added",
            "additions": 84,
            "deletions": 0,
            "changes": 84,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Ftemplatetags%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Ftemplatetags%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fstatic.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -0,0 +1,84 @@\n+from django import template\n+from django.utils.encoding import iri_to_uri\n+\n+register = template.Library()\n+\n+class PrefixNode(template.Node):\n+\n+    def __repr__(self):\n+        return \"<PrefixNode for %r>\" % self.name\n+\n+    def __init__(self, varname=None, name=None):\n+        if name is None:\n+            raise template.TemplateSyntaxError(\n+                \"Prefix nodes must be given a name to return.\")\n+        self.varname = varname\n+        self.name = name\n+\n+    @classmethod\n+    def handle_token(cls, parser, token, name):\n+        \"\"\"\n+        Class method to parse prefix node and return a Node.\n+        \"\"\"\n+        tokens = token.contents.split()\n+        if len(tokens) > 1 and tokens[1] != 'as':\n+            raise template.TemplateSyntaxError(\n+                \"First argument in '%s' must be 'as'\" % tokens[0])\n+        if len(tokens) > 1:\n+            varname = tokens[2]\n+        else:\n+            varname = None\n+        return cls(varname, name)\n+\n+    @classmethod\n+    def handle_simple(cls, name):\n+        try:\n+            from django.conf import settings\n+        except ImportError:\n+            prefix = ''\n+        else:\n+            prefix = iri_to_uri(getattr(settings, name, ''))\n+        return prefix\n+\n+    def render(self, context):\n+        prefix = self.handle_simple(self.name)\n+        if self.varname is None:\n+            return prefix\n+        context[self.varname] = prefix\n+        return ''\n+\n+@register.tag\n+def get_static_prefix(parser, token):\n+    \"\"\"\n+    Populates a template variable with the static prefix,\n+    ``settings.STATIC_URL``.\n+\n+    Usage::\n+\n+        {% get_static_prefix [as varname] %}\n+\n+    Examples::\n+\n+        {% get_static_prefix %}\n+        {% get_static_prefix as static_prefix %}\n+\n+    \"\"\"\n+    return PrefixNode.handle_token(parser, token, \"STATIC_URL\")\n+\n+@register.tag\n+def get_media_prefix(parser, token):\n+    \"\"\"\n+    Populates a template variable with the static prefix,\n+    ``settings.MEDIA_URL``.\n+\n+    Usage::\n+\n+        {% get_media_prefix [as varname] %}\n+\n+    Examples::\n+\n+        {% get_media_prefix %}\n+        {% get_media_prefix as media_prefix %}\n+\n+    \"\"\"\n+    return PrefixNode.handle_token(parser, token, \"MEDIA_URL\")"
        },
        {
            "sha": "2ce886f7acef4d60af3f9bc82c962bf6389e0074",
            "filename": "django/views/static.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fviews%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/django%2Fviews%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fstatic.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -17,8 +17,8 @@\n from django.template import Template, Context, TemplateDoesNotExist\n from django.utils.http import http_date\n \n-from django.contrib.staticfiles.views import \\\n-    directory_index, was_modified_since, serve as staticfiles_serve\n+from django.contrib.staticfiles.views import (directory_index,\n+    was_modified_since, serve as staticfiles_serve)\n \n \n def serve(request, path, document_root=None, show_indexes=False, insecure=False):"
        },
        {
            "sha": "e27cb9990140db82bb9df643dd7fed36987c6f77",
            "filename": "docs/howto/static-files.txt",
            "status": "modified",
            "additions": 30,
            "deletions": 30,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fhowto%2Fstatic-files.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fhowto%2Fstatic-files.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fstatic-files.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -50,12 +50,12 @@ Here's the basic usage in a nutshell:\n        First, you'll need to make sure that ``django.contrib.staticfiles`` is in\n        your :setting:`INSTALLED_APPS`.\n \n-       Next, you'll need to edit :setting:`STATICFILES_ROOT` to point to where\n+       Next, you'll need to edit :setting:`STATIC_ROOT` to point to where\n        you'd like your static media stored. For example::\n \n-            STATICFILES_ROOT = \"/home/jacob/projects/mysite.com/static_media\"\n+            STATIC_ROOT = \"/home/jacob/projects/mysite.com/static_media\"\n \n-       You may also want to set the :setting:`STATICFILES_URL` setting at this\n+       You may also want to set the :setting:`STATIC_URL` setting at this\n        time, though the default value (of ``/static/``) is perfect for local\n        development.\n \n@@ -69,7 +69,7 @@ Here's the basic usage in a nutshell:\n             ./manage.py collectstatic\n \n        This'll churn through your static file storage and move them into the\n-       directory given by :setting:`STATICFILES_ROOT`. (This is not necessary\n+       directory given by :setting:`STATIC_ROOT`. (This is not necessary\n        in local development if you are using :djadmin:`runserver` or adding\n        ``staticfiles_urlpatterns`` to your URLconf; see below).\n \n@@ -78,7 +78,7 @@ Here's the basic usage in a nutshell:\n        If you're using the built-in development server (the\n        :djadmin:`runserver` management command) and have the :setting:`DEBUG`\n        setting set to ``True``, your staticfiles will automatically be served\n-       from :setting:`STATICFILES_URL` in development.\n+       from :setting:`STATIC_URL` in development.\n \n        If you are using some other server for local development, you can\n        quickly serve static media locally by adding::\n@@ -98,7 +98,7 @@ Here's the basic usage in a nutshell:\n \n           .. code-block:: html+django\n \n-               <img src=\"{{ STATICFILES_URL }}images/hi.jpg />\n+               <img src=\"{{ STATIC_URL }}images/hi.jpg />\n \n        See :ref:`staticfiles-in-templates` for more details, including an\n        alternate method (using a template tag).\n@@ -115,7 +115,7 @@ the framework see :doc:`the staticfiles reference </ref/contrib/staticfiles>`.\n    app is to make it easier to keep static files separate from user-uploaded\n    files. For this reason, you will probably want to make your\n    :setting:`MEDIA_ROOT` and :setting:`MEDIA_URL` different from your\n-   :setting:`STATICFILES_ROOT` and :setting:`STATICFILES_URL`. You will need to\n+   :setting:`STATIC_ROOT` and :setting:`STATIC_URL`. You will need to\n    arrange for serving of files in :setting:`MEDIA_ROOT` yourself;\n    ``staticfiles`` does not deal with user-uploaded media at all.\n \n@@ -136,7 +136,7 @@ development, and it makes it *very* hard to change where you've deployed your\n media. If, for example, you wanted to switch to using a content delivery network\n (CDN), then you'd need to change more or less every single template.\n \n-A far better way is to use the value of the :setting:`STATICFILES_URL` setting\n+A far better way is to use the value of the :setting:`STATIC_URL` setting\n directly in your templates. This means that a switch of media servers only\n requires changing that single value. Much better!\n \n@@ -147,26 +147,26 @@ With a context processor\n ------------------------\n \n The included context processor is the easy way. Simply make sure\n-``'django.contrib.staticfiles.context_processors.staticfiles'`` is in your\n+``'django.core.context_processors.static'`` is in your\n :setting:`TEMPLATE_CONTEXT_PROCESSORS`. It's there by default, and if you're\n editing that setting by hand it should look something like::\n \n     TEMPLATE_CONTEXT_PROCESSORS = (\n         'django.core.context_processors.debug',\n         'django.core.context_processors.i18n',\n         'django.core.context_processors.media',\n+        'django.core.context_processors.static',\n         'django.contrib.auth.context_processors.auth',\n         'django.contrib.messages.context_processors.messages',\n-        'django.contrib.staticfiles.context_processors.staticfiles',\n     )\n \n-Once that's done, you can refer to :setting:`STATICFILES_URL` in your templates:\n+Once that's done, you can refer to :setting:`STATIC_URL` in your templates:\n \n .. code-block:: html+django\n \n-     <img src=\"{{ STATICFILES_URL }}images/hi.jpg />\n+     <img src=\"{{ STATIC_URL }}images/hi.jpg />\n \n-If ``{{ STATICFILES_URL }}`` isn't working in your template, you're probably not\n+If ``{{ STATIC_URL }}`` isn't working in your template, you're probably not\n using :class:`~django.template.RequestContext` when rendering the template.\n \n As a brief refresher, context processors add variables into the contexts of\n@@ -180,23 +180,23 @@ To see how that works, and to read more details, check out\n With a template tag\n -------------------\n \n-The second option is the :ttag:`get_staticfiles_prefix` template tag. You can\n+The second option is the :ttag:`get_static_prefix` template tag. You can\n use this if you're not using :class:`~django.template.RequestContext`, or if you\n-need more control over exactly where and how :setting:`STATICFILES_URL` is\n+need more control over exactly where and how :setting:`STATIC_URL` is\n injected into the template. Here's an example:\n \n .. code-block:: html+django\n \n-    {% load staticfiles %}\n-    <img src=\"{% get_staticfiles_prefix %}images/hi.jpg\" />\n+    {% load static %}\n+    <img src=\"{% get_static_prefix %}images/hi.jpg\" />\n \n There's also a second form you can use to avoid extra processing if you need the\n value multiple times:\n \n .. code-block:: html+django\n \n-    {% load staticfiles %}\n-    {% get_staticfiles_prefix as STATIC_PREFIX %}\n+    {% load static %}\n+    {% get_static_prefix as STATIC_PREFIX %}\n \n     <img src=\"{{ STATIC_PREFIX }}images/hi.jpg\" />\n     <img src=\"{{ STATIC_PREFIX }}images/hi2.jpg\" />\n@@ -213,7 +213,7 @@ Thus, the ``staticfiles`` app ships with a quick and dirty helper view that you\n can use to serve files locally in development.\n \n This view is automatically enabled and will serve your static files at\n-:setting:`STATICFILES_URL` when you use the built-in :djadmin:`runserver`.\n+:setting:`STATIC_URL` when you use the built-in :djadmin:`runserver`.\n \n To enable this view if you are using some other server for local development,\n you'll add a couple of lines to your URLconf. The first line goes at the top of\n@@ -225,11 +225,11 @@ the file, and the last line at the bottom::\n \n     urlpatterns += staticfiles_urlpatterns()\n \n-This will inspect your :setting:`STATICFILES_URL` and\n-:setting:`STATICFILES_ROOT` settings and wire up the view to serve static media\n+This will inspect your :setting:`STATIC_URL` and\n+:setting:`STATIC_ROOT` settings and wire up the view to serve static media\n accordingly. Don't forget to set the :setting:`STATICFILES_DIRS` setting\n appropriately to let ``django.contrib.staticfiles`` know where to look for\n-files.\n+(additional) files.\n \n .. warning::\n \n@@ -239,6 +239,9 @@ files.\n     **insecure**. This is only intended for local development, and should\n     **never be used in production**.\n \n+    Additionally, your :setting:`STATIC_URL` setting can't be either empty\n+    or a full URL such as ``http://static.example.com/``.\n+\n For a few more details, including an alternate method of enabling this view,\n see :ref:`staticfiles-development-view`.\n \n@@ -249,7 +252,7 @@ Serving static files in production\n \n The basic outline of putting static files into production is simple: run the\n :djadmin:`collectstatic` command when static media changes, then arrange for the\n-collected media directory (:setting:`STATICFILES_ROOT`) to be moved to the media\n+collected media directory (:setting:`STATIC_ROOT`) to be moved to the media\n server and served.\n \n Of course, as with all deployment tasks, the devil's in the details. Every\n@@ -264,8 +267,8 @@ app, the basic outline gets modified to look something like:\n \n     * Push your code up to the deployment server.\n     * On the server, run :djadmin:`collectstatic` to move all the media into\n-      :setting:`STATICFILES_ROOT`.\n-    * Point your web server at :setting:`STATICFILES_ROOT`. For example, here's\n+      :setting:`STATIC_ROOT`.\n+    * Point your web server at :setting:`STATIC_ROOT`. For example, here's\n       :ref:`how to do this under Apache and mod_wsgi <serving-media-files>`.\n \n You'll probably want to automate this process, especially if you've got multiple\n@@ -322,7 +325,7 @@ Since your media server won't be running Django, you'll need to modify the\n deployment strategy to look something like:\n \n     * When your media changes, run :djadmin:`collectstatic` locally.\n-    * Push your local :setting:`STATICFILES_ROOT` up to the media server\n+    * Push your local :setting:`STATIC_ROOT` up to the media server\n       into the directory that's being served. ``rsync`` is a good\n       choice for this step since it only needs to transfer the\n       bits of static media that have changed.\n@@ -403,9 +406,6 @@ you'll need to make a few changes:\n     * The management commands ``build_static`` and ``resolve_static`` are now\n       called :djadmin:`collectstatic` and :djadmin:`findstatic`.\n \n-    * The settings ``STATIC_URL`` and ``STATIC_ROOT`` were renamed to\n-      :setting:`STATICFILES_URL` and :setting:`STATICFILES_ROOT`.\n-\n     * The settings ``STATICFILES_PREPEND_LABEL_APPS``,\n       ``STATICFILES_MEDIA_DIRNAMES`` and ``STATICFILES_EXCLUDED_APPS`` were\n       removed."
        },
        {
            "sha": "f9b530a77e60a075a4964b14a5a2ae9b322c3a71",
            "filename": "docs/man/django-admin.1",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fman%2Fdjango-admin.1",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fman%2Fdjango-admin.1",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fman%2Fdjango-admin.1?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -165,7 +165,7 @@ Do not prompt the user for input.\n Disable the development server's auto\\-reloader.\n .TP\n .I \\-\\-nostatic\n-Disable automatic serving of static files from STATICFILES_URL.\n+Disable automatic serving of static files from STATIC_URL.\n .TP\n .I \\-\\-insecure\n Enables serving of static files even if DEBUG is False."
        },
        {
            "sha": "2cd2282f4e9b5ea0e646b462e44c8c4b598b817d",
            "filename": "docs/ref/contrib/staticfiles.txt",
            "status": "modified",
            "additions": 61,
            "deletions": 61,
            "changes": 122,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fstaticfiles.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -23,48 +23,11 @@ Settings\n \n .. highlight:: python\n \n-The following settings control the behavior of the staticfiles app. Only\n-:setting:`STATICFILES_ROOT` is required, but you'll probably also need to\n-configure :setting:`STATICFILES_URL` as well.\n-\n-.. setting:: STATICFILES_ROOT\n-\n-STATICFILES_ROOT\n-----------------\n-\n-Default: ``''`` (Empty string)\n-\n-The absolute path to the directory that the :djadmin:`collectstatic` management\n-command will collect static files into, for serving from\n-:setting:`STATICFILES_URL`::\n-\n-   STATICFILES_ROOT = \"/home/example.com/static/\"\n-\n-This is a **required setting** unless you've overridden\n-:setting:`STATICFILES_STORAGE` and are using a custom storage backend.\n-\n-This is not a place to store your static files permanently under version\n-control; you should do that in directories that will be found by your\n-:setting:`STATICFILES_FINDERS` (by default, per-app ``static/`` subdirectories,\n-and any directories you include in :setting:`STATICFILES_DIRS`). Files from\n-those locations will be collected into :setting:`STATICFILES_ROOT`.\n-\n-.. setting:: STATICFILES_URL\n-\n-STATICFILES_URL\n----------------\n-\n-Default: ``'/static/'``\n-\n-The URL that handles the files served from :setting:`STATICFILES_ROOT`, e.g.::\n-\n-    STATICFILES_URL = '/site_media/static/'\n-\n-... or perhaps::\n-\n-    STATICFILES_URL = 'http://static.example.com/'\n+.. note::\n \n-This should **always** have a trailing slash.\n+    The following settings control the behavior of the staticfiles app.\n+    Configuring the global settings :setting:`STATIC_ROOT` and\n+    :setting:`STATIC_URL` is **required**.\n \n .. setting:: STATICFILES_DIRS\n \n@@ -98,7 +61,7 @@ tuples, e.g.::\n \n With this configuration, the :djadmin:`collectstatic` management command would\n for example collect the stats files in a ``'downloads'`` directory. So\n-assuming you have :setting:`STATICFILES_URL` set ``'/static/'``, this would\n+assuming you have :setting:`STATIC_URL` set ``'/static/'``, this would\n allow you to refer to the file ``'/opt/webfiles/stats/polls_20101022.tar.gz'``\n with ``'/static/downloads/polls_20101022.tar.gz'`` in your templates.\n \n@@ -153,14 +116,14 @@ Management Commands\n \n .. highlight:: console\n \n-``django.contrib.staticfiles`` exposes two management commands.\n+``django.contrib.staticfiles`` exposes three management commands.\n \n collectstatic\n -------------\n \n .. django-admin:: collectstatic\n \n-Collects the static files into :setting:`STATICFILES_ROOT`.\n+Collects the static files into :setting:`STATIC_ROOT`.\n \n Duplicate file names are by default resolved in a similar way to how template\n resolution works: the file that is first found in one of the specified\n@@ -218,44 +181,76 @@ for each relative path, use the ``--first`` option::\n This is a debugging aid; it'll show you exactly which static file will be\n collected for a given path.\n \n+runserver\n+---------\n+\n+Overrides the core :djadmin:`runserver` command if the ``staticfiles`` app\n+is :setting:`installed<INSTALLED_APPS>` and adds automatic serving of static\n+files and the following new options.\n+\n+.. django-admin-option:: --nostatic\n+\n+Use the ``--nostatic`` option to disable serving of static files with the\n+:doc:`staticfiles </ref/contrib/staticfiles>` app entirely. This option is\n+only available if the :doc:`staticfiles </ref/contrib/staticfiles>` app is\n+in your project's :setting:`INSTALLED_APPS` setting.\n+\n+Example usage::\n+\n+    django-admin.py runserver --nostatic\n+\n+.. django-admin-option:: --insecure\n+\n+Use the ``--insecure`` option to force serving of static files with the\n+:doc:`staticfiles </ref/contrib/staticfiles>` app even if the :setting:`DEBUG`\n+setting is ``False``. By using this you acknowledge the fact that it's\n+**grossly inefficient** and probably **insecure**. This is only intended for\n+local development, should **never be used in production** and is only\n+available if the :doc:`staticfiles </ref/contrib/staticfiles>` app is\n+in your project's :setting:`INSTALLED_APPS` setting.\n+\n+Example usage::\n+\n+    django-admin.py runserver --insecure\n+\n .. currentmodule:: None\n \n Other Helpers\n =============\n \n-The ``staticfiles`` context processor\n--------------------------------------\n+The ``static`` context processor\n+--------------------------------\n \n-.. function:: django.contrib.staticfiles.context_processors.staticfiles\n+.. function:: django.core.context_processors.static\n \n-This context processor adds the :setting:`STATICFILES_URL` into each template\n-context as the variable ``{{ STATICFILES_URL }}``. To use it, make sure that\n-``'django.contrib.staticfiles.context_processors.staticfiles'`` appears\n-somewhere in your :setting:`TEMPLATE_CONTEXT_PROCESSORS` setting.\n+This context processor adds the :setting:`STATIC_URL` into each template\n+context as the variable ``{{ STATIC_URL }}``. To use it, make sure that\n+``'django.core.context_processors.static'`` appears somewhere in your\n+:setting:`TEMPLATE_CONTEXT_PROCESSORS` setting.\n \n Remember, only templates rendered with :class:`~django.template.RequestContext`\n will have acces to the data provided by this (and any) context processor.\n \n-.. templatetag:: get_staticfiles_prefix\n+.. templatetag:: get_static_prefix\n \n-The ``get_staticfiles_prefix`` templatetag\n-==========================================\n+The ``get_static_prefix`` templatetag\n+=====================================\n \n .. highlight:: html+django\n \n If you're not using :class:`~django.template.RequestContext`, or if you need\n-more control over exactly where and how :setting:`STATICFILES_URL` is injected\n-into the template, you can use the :ttag:`get_staticfiles_prefix` template tag\n+more control over exactly where and how :setting:`STATIC_URL` is injected\n+into the template, you can use the :ttag:`get_static_prefix` template tag\n instead::\n \n-    {% load staticfiles %}\n-    <img src=\"{% get_staticfiles_prefix %}images/hi.jpg\" />\n+    {% load static %}\n+    <img src=\"{% get_static_prefix %}images/hi.jpg\" />\n \n There's also a second form you can use to avoid extra processing if you need\n the value multiple times::\n \n-    {% load staticfiles %}\n-    {% get_staticfiles_prefix as STATIC_PREFIX %}\n+    {% load static %}\n+    {% get_static_prefix as STATIC_PREFIX %}\n \n     <img src=\"{{ STATIC_PREFIX }}images/hi.jpg\" />\n     <img src=\"{{ STATIC_PREFIX }}images/hi2.jpg\" />\n@@ -292,7 +287,7 @@ primary URL configuration::\n        )\n \n Note, the begin of the pattern (``r'^static/'``) should be your\n-:setting:`STATICFILES_URL` setting.\n+:setting:`STATIC_URL` setting.\n \n Since this is a bit finicky, there's also a helper function that'll do this for you:\n \n@@ -307,3 +302,8 @@ already defined pattern list. Use it like this::\n \n    urlpatterns += staticfiles_urlpatterns()\n \n+.. warning::\n+\n+    This helper function will only work if :setting:`DEBUG` is ``True``\n+    and your :setting:`STATIC_URL` setting is neither empty nor a full\n+    URL such as ``http://static.example.com/``."
        },
        {
            "sha": "ea49e2372d2e596d8cf9f06b67fc7643c8855cd4",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -681,35 +681,6 @@ Example usage::\n \n     django-admin.py runserver --noreload\n \n-.. django-admin-option:: --nostatic\n-\n-Use the ``--nostatic`` option to disable serving of static files with the\n-:doc:`staticfiles </ref/contrib/staticfiles>` app entirely. This option is\n-only available if the :doc:`staticfiles </ref/contrib/staticfiles>` app is\n-in your project's :setting:`INSTALLED_APPS` setting.\n-\n-Example usage::\n-\n-    django-admin.py runserver --nostatic\n-\n-.. django-admin-option:: --insecure\n-\n-Use the ``--insecure`` option to force serving of static files with the\n-:doc:`staticfiles </ref/contrib/staticfiles>` app even if the :setting:`DEBUG`\n-setting is ``False``. By using this you acknowledge the fact that it's\n-**grossly inefficient** and probably **insecure**. This is only intended for\n-local development, should **never be used in production** and is only\n-available if the :doc:`staticfiles </ref/contrib/staticfiles>` app is\n-in your project's :setting:`INSTALLED_APPS` setting.\n-\n-See the :doc:`reference documentation of the app </ref/contrib/staticfiles>`\n-for more details and learn how to :doc:`manage and deploy static files\n-</howto/static-files>` correctly.\n-\n-Example usage::\n-\n-    django-admin.py runserver --insecure\n-\n Examples of using different ports and addresses\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "7f4157c363d528c0323ce8bdc064336f14de8bd6",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 54,
            "deletions": 6,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -53,10 +53,10 @@ Default: ``'/static/admin/'``\n \n The URL prefix for admin media -- CSS, JavaScript and images used by the Django\n administrative interface. Make sure to use a trailing slash, and to have this be\n-different from the :setting:``MEDIA_URL`` setting (since the same URL cannot be\n+different from the :setting:`MEDIA_URL` setting (since the same URL cannot be\n mapped onto two different sets of files). For integration with :doc:`staticfiles\n </ref/contrib/staticfiles>`, this should be the same as\n-:setting:`STATICFILES_URL` followed by ``'admin/'``.\n+:setting:`STATIC_URL` followed by ``'admin/'``.\n \n .. setting:: ADMINS\n \n@@ -1122,12 +1122,12 @@ Default: ``''`` (Empty string)\n URL that handles the media served from :setting:`MEDIA_ROOT`, used\n for :doc:`managing stored files </topics/files>`.\n \n-Example: ``\"http://media.lawrence.com\"``\n+Example: ``\"http://media.lawrence.com/\"``\n \n Note that this should have a trailing slash if it has a path component.\n \n- * Good: ``\"http://www.example.com/static/\"``\n- * Bad: ``\"http://www.example.com/static\"``\n+ * Good: ``\"http://www.example.com/media/\"``\n+ * Bad: ``\"http://www.example.com/media\"``\n \n MESSAGE_LEVEL\n -------------\n@@ -1486,6 +1486,49 @@ See :doc:`/ref/contrib/sites`.\n \n .. _site framework docs: ../sites/\n \n+.. setting:: STATIC_ROOT\n+\n+STATIC_ROOT\n+-----------\n+\n+Default: ``''`` (Empty string)\n+\n+The absolute path to the directory that contains static content.\n+\n+Example: ``\"/home/example.com/static/\"``\n+\n+When using the :djadmin:`collectstatic` management command of the optional,\n+:doc:`staticfiles</ref/contrib/staticfiles>` app this will be used to collect\n+static files into and served from :setting:`STATIC_URL`.\n+\n+In that case this is a **required setting**, unless you've overridden\n+:setting:`STATICFILES_STORAGE` and are using a custom storage backend.\n+\n+This is not a place to store your static files permanently under version\n+control; you should do that in directories that will be found by your\n+:setting:`STATICFILES_FINDERS` (by default, per-app ``static/`` subdirectories,\n+and any directories you include in :setting:`STATICFILES_DIRS`). Files from\n+those locations will be collected into :setting:`STATIC_ROOT`.\n+\n+See :doc:`/ref/contrib/staticfiles` and :setting:`STATIC_URL`.\n+\n+.. setting:: STATIC_URL\n+\n+STATIC_URL\n+----------\n+\n+Default: ``None``\n+\n+URL that handles the files served from :setting:`STATIC_ROOT`.\n+\n+Example: ``\"/site_media/static/\"`` or ``\"http://static.example.com/\"``\n+\n+If not ``None``, this will be used as the base path for\n+:ref:`media definitions<form-media-paths>` and the\n+:doc:`staticfiles app</ref/contrib/staticfiles>`.\n+\n+See :setting:`STATIC_ROOT`.\n+\n .. setting:: TEMPLATE_CONTEXT_PROCESSORS\n \n TEMPLATE_CONTEXT_PROCESSORS\n@@ -1496,7 +1539,8 @@ Default::\n     (\"django.contrib.auth.context_processors.auth\",\n     \"django.core.context_processors.debug\",\n     \"django.core.context_processors.i18n\",\n-    \"django.contrib.staticfiles.context_processors.staticfiles\",\n+    \"django.core.context_processors.media\",\n+    \"django.core.context_processors.static\",\n     \"django.contrib.messages.context_processors.messages\")\n \n A tuple of callables that are used to populate the context in ``RequestContext``.\n@@ -1513,6 +1557,10 @@ of items to be merged into the context.\n     ``django.core.context_processors.auth`` to\n     ``django.contrib.auth.context_processors.auth``.\n \n+.. versionadded:: 1.3\n+    The ``django.core.context_processors.static`` context processor\n+    was added in this release.\n+\n .. setting:: TEMPLATE_DEBUG\n \n TEMPLATE_DEBUG"
        },
        {
            "sha": "e02debe39be97cc22940c9ba15c870876529b4bf",
            "filename": "docs/ref/templates/api.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Ftemplates%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Fref%2Ftemplates%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fapi.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -312,8 +312,8 @@ and return a dictionary of items to be merged into the context. By default,\n     \"django.core.context_processors.debug\",\n     \"django.core.context_processors.i18n\",\n     \"django.core.context_processors.media\",\n-    \"django.contrib.messages.context_processors.messages\",\n-    \"django.contrib.staticfiles.context_processors.staticfiles\")\n+    \"django.core.context_processors.static\",\n+    \"django.contrib.messages.context_processors.messages\")\n \n .. versionadded:: 1.2\n    In addition to these, ``RequestContext`` always uses\n@@ -435,6 +435,15 @@ If :setting:`TEMPLATE_CONTEXT_PROCESSORS` contains this processor, every\n ``RequestContext`` will contain a variable ``MEDIA_URL``, providing the\n value of the :setting:`MEDIA_URL` setting.\n \n+django.core.context_processors.static\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+.. versionadded:: 1.3\n+\n+If :setting:`TEMPLATE_CONTEXT_PROCESSORS` contains this processor, every\n+``RequestContext`` will contain a variable ``STATIC_URL``, providing the\n+value of the :setting:`STATIC_URL` setting.\n+\n django.core.context_processors.csrf\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "d6610d1c0e5b287bf7b8f328d6672845f0085e0e",
            "filename": "docs/releases/1.3-alpha-1.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2F1.3-alpha-1.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2F1.3-alpha-1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3-alpha-1.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -21,7 +21,7 @@ changes`_ and an easy upgrade path from Django 1.2.\n \n .. _new features: `What's new in Django 1.3 alpha 1`_\n \n-.. _backwards incompatible changes: backwards-incompatible-changes-1.3_\n+.. _backwards incompatible changes: backwards-incompatible-changes-1.3-alpha-1_\n \n What's new in Django 1.3 alpha 1\n ================================\n@@ -161,7 +161,7 @@ requests. These include:\n       easier to test the database activity associated with a view.\n \n \n-.. _backwards-incompatible-changes-1.3:\n+.. _backwards-incompatible-changes-1.3-alpha-1:\n \n Backwards-incompatible changes in 1.3 alpha 1\n =============================================\n@@ -270,8 +270,6 @@ local flavors:\n       official designation \"Aceh (ACE)\".\n \n \n-.. _deprecated-features-1.3:\n-\n Features deprecated in 1.3\n ==========================\n "
        },
        {
            "sha": "c8671a618c3a62bf64e4abefd49e479dc087be65",
            "filename": "docs/releases/1.3-alpha-2.txt",
            "status": "modified",
            "additions": 41,
            "deletions": 4,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2F1.3-alpha-2.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2F1.3-alpha-2.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3-alpha-2.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -13,10 +13,6 @@ prior to the final 1.3 release.\n As such, this release is *not* intended for production use, and any such use\n is discouraged.\n \n-.. _new features: `What's new in Django 1.3 alpha 2`_\n-\n-.. _backwards incompatible changes: backwards-incompatible-changes-1.3-alpha-2_\n-\n What's new in Django 1.3 alpha 2\n ================================\n \n@@ -43,6 +39,47 @@ See the :doc:`reference documentation of the app </ref/contrib/staticfiles>`\n for more details or learn how to :doc:`manage static files\n </howto/static-files>`.\n \n+Backwards-incompatible changes in 1.3 alpha 2\n+=============================================\n+\n+Introduction of STATIC_URL and STATIC_ROOT settings\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The newly introduced :doc:`/ref/contrib/staticfiles` app extends Django's\n+abilities to handle static app and project files, required the additon of\n+settings to refer to those files in templates and code, especially in\n+contrast to the :setting:`MEDIA_URL` and :setting:`MEDIA_ROOT` settings that\n+refer to user-uploaded files.\n+\n+Prior to 1.3 alpha 2 these settings were called ``STATICFILES_URL`` and\n+``STATICFILES_ROOT`` to follow the naming scheme for app centric settings.\n+Based on feedback from the community it became apparent that those settings\n+created confusion, especially given the fact handling static files is also\n+desired outside the use of the optional ``staticfiles`` app.\n+\n+As a result, we take the followig steps to rectify the issue:\n+\n+  * Two new global settings that will be used by -- **but are not limited\n+    to** -- the :doc:`staticfiles</ref/contrib/staticfiles>` app:\n+\n+    * :setting:`STATIC_ROOT` (formally ``STATICFILES_ROOT``)\n+\n+    * :setting:`STATIC_URL` (formally ``STATICFILES_URL``)\n+\n+  * Moving the\n+    ``django.contrib.staticfiles.templatetags.staticfiles.get_staticfiles_prefix``\n+    template tag to the core (``django.templatetags.static``) and renaming\n+    it to :ttag:`get_static_prefix`.\n+\n+  * Moving the context processor\n+    ``django.contrib.staticfiles.context_processors.staticfiles`` to the\n+    core (``django.core.context_processors.static``) and renaming it to\n+    :func:`~django.core.context_processors.static`.\n+\n+  * :ref:`form-media-paths` will use :setting:`STATIC_URL` as the prefix\n+    **if the value is not None**, and falls back to the previously used\n+    :setting:`MEDIA_URL`.\n+\n The Django 1.3 roadmap\n ======================\n "
        },
        {
            "sha": "20c98f29c4c4ef82f8096187d9e26b37d776a45e",
            "filename": "docs/releases/1.3.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2F1.3.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2F1.3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -59,7 +59,7 @@ In previous versions of Django, it was common to place static assets in\n app is to make it easier to keep static files separate from user-uploaded\n files. For this reason, you will probably want to make your\n :setting:`MEDIA_ROOT` and :setting:`MEDIA_URL` different from your\n-:setting:`STATICFILES_ROOT` and :setting:`STATICFILES_URL`. You will need to\n+:setting:`STATIC_ROOT` and :setting:`STATIC_URL`. You will need to\n arrange for serving of files in :setting:`MEDIA_ROOT` yourself;\n ``staticfiles`` does not deal with user-uploaded media at all.\n "
        },
        {
            "sha": "e2ec6eb06290084f0e4172f349c1240e0e7a03d6",
            "filename": "docs/releases/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Freleases%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2Findex.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -64,6 +64,7 @@ notes.\n .. toctree::\n    :maxdepth: 1\n \n+   1.3-alpha-2\n    1.3-alpha-1\n    1.2-rc-1\n    1.2-beta-1"
        },
        {
            "sha": "b0f3c86107532f6ee585826976f803e30c1832ca",
            "filename": "docs/topics/forms/media.txt",
            "status": "modified",
            "additions": 32,
            "deletions": 9,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Ftopics%2Fforms%2Fmedia.txt",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/docs%2Ftopics%2Fforms%2Fmedia.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmedia.txt?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -190,28 +190,51 @@ also be defined in a dynamic fashion::\n See the section on `Media objects`_ for more details on how to construct\n return values for dynamic media properties.\n \n+.. _form-media-paths:\n+\n Paths in media definitions\n --------------------------\n \n+.. versionchanged:: 1.3\n+\n Paths used to specify media can be either relative or absolute. If a path\n starts with '/', 'http://' or 'https://', it will be interpreted as an absolute\n path, and left as-is. All other paths will be prepended with the value of\n-``settings.MEDIA_URL``. For example, if the MEDIA_URL for your site was\n-``http://media.example.com/``::\n+the appropriate prefix.\n+\n+As part of the introduction of the\n+:doc:`staticfiles app </ref/contrib/staticfiles>` two new settings were added\n+to refer to \"static content\" (images, CSS, Javascript, etc.) that are needed\n+to render a complete web page: :setting:`STATIC_URL` and :setting:`STATIC_ROOT`.\n+\n+To find the appropriate prefix to use, Django will check if the\n+:setting:`STATIC_URL` setting is not ``None`` and automatically fall back\n+to using :setting:`MEDIA_URL`. For example, if the :setting:`MEDIA_URL` for\n+your site was ``'http://uploads.example.com/'`` and :setting:`STATIC_URL`\n+was ``None``::\n+\n+    >>> class CalendarWidget(forms.TextInput):\n+            class Media:\n+                css = {\n+                    'all': ('/css/pretty.css',),\n+                }\n+                js = ('animations.js', 'http://othersite.com/actions.js')\n \n-    class CalendarWidget(forms.TextInput):\n-        class Media:\n-            css = {\n-                'all': ('/css/pretty.css',),\n-            }\n-            js = ('animations.js', 'http://othersite.com/actions.js')\n+    >>> w = CalendarWidget()\n+    >>> print w.media\n+    <link href=\"/css/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://uploads.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://othersite.com/actions.js\"></script>\n+\n+But if :setting:`STATIC_URL` is ``'http://static.example.com/'``::\n \n     >>> w = CalendarWidget()\n     >>> print w.media\n     <link href=\"/css/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n     <script type=\"text/javascript\" src=\"http://othersite.com/actions.js\"></script>\n \n+\n Media objects\n -------------\n "
        },
        {
            "sha": "fd30029741df8bb7e406325cbd5a514abdc61235",
            "filename": "tests/regressiontests/forms/tests/media.py",
            "status": "modified",
            "additions": 460,
            "deletions": 0,
            "changes": 460,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/tests%2Fregressiontests%2Fforms%2Ftests%2Fmedia.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/tests%2Fregressiontests%2Fforms%2Ftests%2Fmedia.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fmedia.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -458,3 +458,463 @@ class Media:\n <link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n <link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n <link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\"\"\")\n+\n+\n+class StaticFormsMediaTestCase(TestCase):\n+    # Tests for the media handling on widgets and forms\n+    def setUp(self):\n+        super(StaticFormsMediaTestCase, self).setUp()\n+        self.original_media_url = settings.MEDIA_URL\n+        self.original_static_url = settings.STATIC_URL\n+        settings.MEDIA_URL = 'http://media.example.com/static/'\n+        settings.STATIC_URL = 'http://media.example.com/static/'\n+\n+    def tearDown(self):\n+        settings.MEDIA_URL = self.original_media_url\n+        settings.STATIC_URL = self.original_static_url\n+        super(StaticFormsMediaTestCase, self).tearDown()\n+\n+    def test_construction(self):\n+        # Check construction of media objects\n+        m = Media(css={'all': ('path/to/css1','/path/to/css2')}, js=('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3'))\n+        self.assertEqual(str(m), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\"\"\")\n+\n+        class Foo:\n+            css = {\n+               'all': ('path/to/css1','/path/to/css2')\n+            }\n+            js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        m3 = Media(Foo)\n+        self.assertEqual(str(m3), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\"\"\")\n+\n+        # A widget can exist without a media definition\n+        class MyWidget(TextInput):\n+            pass\n+\n+        w = MyWidget()\n+        self.assertEqual(str(w.media), '')\n+\n+    def test_media_dsl(self):\n+        ###############################################################\n+        # DSL Class-based media definitions\n+        ###############################################################\n+\n+        # A widget can define media if it needs to.\n+        # Any absolute path will be preserved; relative paths are combined\n+        # with the value of settings.MEDIA_URL\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        w1 = MyWidget1()\n+        self.assertEqual(str(w1.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\"\"\")\n+\n+        # Media objects can be interrogated by media type\n+        self.assertEqual(str(w1.media['css']), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\"\"\")\n+\n+        self.assertEqual(str(w1.media['js']), \"\"\"<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\"\"\")\n+\n+    def test_combine_media(self):\n+        # Media objects can be combined. Any given media resource will appear only\n+        # once. Duplicated media definitions are ignored.\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget2(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css2','/path/to/css3')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        class MyWidget3(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        w1 = MyWidget1()\n+        w2 = MyWidget2()\n+        w3 = MyWidget3()\n+        self.assertEqual(str(w1.media + w2.media + w3.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+        # Check that media addition hasn't affected the original objects\n+        self.assertEqual(str(w1.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\"\"\")\n+\n+        # Regression check for #12879: specifying the same CSS or JS file\n+        # multiple times in a single Media instance should result in that file\n+        # only being included once.\n+        class MyWidget4(TextInput):\n+            class Media:\n+                css = {'all': ('/path/to/css1', '/path/to/css1')}\n+                js = ('/path/to/js1', '/path/to/js1')\n+\n+        w4 = MyWidget4()\n+        self.assertEqual(str(w4.media), \"\"\"<link href=\"/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\"\"\")\n+\n+    def test_media_property(self):\n+        ###############################################################\n+        # Property-based media definitions\n+        ###############################################################\n+\n+        # Widget media can be defined as a property\n+        class MyWidget4(TextInput):\n+            def _media(self):\n+                return Media(css={'all': ('/some/path',)}, js = ('/some/js',))\n+            media = property(_media)\n+\n+        w4 = MyWidget4()\n+        self.assertEqual(str(w4.media), \"\"\"<link href=\"/some/path\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/some/js\"></script>\"\"\")\n+\n+        # Media properties can reference the media of their parents\n+        class MyWidget5(MyWidget4):\n+            def _media(self):\n+                return super(MyWidget5, self).media + Media(css={'all': ('/other/path',)}, js = ('/other/js',))\n+            media = property(_media)\n+\n+        w5 = MyWidget5()\n+        self.assertEqual(str(w5.media), \"\"\"<link href=\"/some/path\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/other/path\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/some/js\"></script>\n+<script type=\"text/javascript\" src=\"/other/js\"></script>\"\"\")\n+\n+    def test_media_property_parent_references(self):\n+        # Media properties can reference the media of their parents,\n+        # even if the parent media was defined using a class\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget6(MyWidget1):\n+            def _media(self):\n+                return super(MyWidget6, self).media + Media(css={'all': ('/other/path',)}, js = ('/other/js',))\n+            media = property(_media)\n+\n+        w6 = MyWidget6()\n+        self.assertEqual(str(w6.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/other/path\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/other/js\"></script>\"\"\")\n+\n+    def test_media_inheritance(self):\n+        ###############################################################\n+        # Inheritance of media\n+        ###############################################################\n+\n+        # If a widget extends another but provides no media definition, it inherits the parent widget's media\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget7(MyWidget1):\n+            pass\n+\n+        w7 = MyWidget7()\n+        self.assertEqual(str(w7.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\"\"\")\n+\n+        # If a widget extends another but defines media, it extends the parent widget's media by default\n+        class MyWidget8(MyWidget1):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        w8 = MyWidget8()\n+        self.assertEqual(str(w8.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+    def test_media_inheritance_from_property(self):\n+        # If a widget extends another but defines media, it extends the parents widget's media,\n+        # even if the parent defined media using a property.\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget4(TextInput):\n+            def _media(self):\n+                return Media(css={'all': ('/some/path',)}, js = ('/some/js',))\n+            media = property(_media)\n+\n+        class MyWidget9(MyWidget4):\n+            class Media:\n+                css = {\n+                    'all': ('/other/path',)\n+                }\n+                js = ('/other/js',)\n+\n+        w9 = MyWidget9()\n+        self.assertEqual(str(w9.media), \"\"\"<link href=\"/some/path\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/other/path\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/some/js\"></script>\n+<script type=\"text/javascript\" src=\"/other/js\"></script>\"\"\")\n+\n+        # A widget can disable media inheritance by specifying 'extend=False'\n+        class MyWidget10(MyWidget1):\n+            class Media:\n+                extend = False\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        w10 = MyWidget10()\n+        self.assertEqual(str(w10.media), \"\"\"<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+    def test_media_inheritance_extends(self):\n+        # A widget can explicitly enable full media inheritance by specifying 'extend=True'\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget11(MyWidget1):\n+            class Media:\n+                extend = True\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        w11 = MyWidget11()\n+        self.assertEqual(str(w11.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+    def test_media_inheritance_single_type(self):\n+        # A widget can enable inheritance of one media type by specifying extend as a tuple\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget12(MyWidget1):\n+            class Media:\n+                extend = ('css',)\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        w12 = MyWidget12()\n+        self.assertEqual(str(w12.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+    def test_multi_media(self):\n+        ###############################################################\n+        # Multi-media handling for CSS\n+        ###############################################################\n+\n+        # A widget can define CSS media for multiple output media types\n+        class MultimediaWidget(TextInput):\n+            class Media:\n+                css = {\n+                   'screen, print': ('/file1','/file2'),\n+                   'screen': ('/file3',),\n+                   'print': ('/file4',)\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        multimedia = MultimediaWidget()\n+        self.assertEqual(str(multimedia.media), \"\"\"<link href=\"/file4\" type=\"text/css\" media=\"print\" rel=\"stylesheet\" />\n+<link href=\"/file3\" type=\"text/css\" media=\"screen\" rel=\"stylesheet\" />\n+<link href=\"/file1\" type=\"text/css\" media=\"screen, print\" rel=\"stylesheet\" />\n+<link href=\"/file2\" type=\"text/css\" media=\"screen, print\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+    def test_multi_widget(self):\n+        ###############################################################\n+        # Multiwidget media handling\n+        ###############################################################\n+\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget2(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css2','/path/to/css3')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        class MyWidget3(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        # MultiWidgets have a default media definition that gets all the\n+        # media from the component widgets\n+        class MyMultiWidget(MultiWidget):\n+            def __init__(self, attrs=None):\n+                widgets = [MyWidget1, MyWidget2, MyWidget3]\n+                super(MyMultiWidget, self).__init__(widgets, attrs)\n+\n+        mymulti = MyMultiWidget()\n+        self.assertEqual(str(mymulti.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+    def test_form_media(self):\n+        ###############################################################\n+        # Media processing for forms\n+        ###############################################################\n+\n+        class MyWidget1(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('path/to/css1','/path/to/css2')\n+                }\n+                js = ('/path/to/js1','http://media.other.com/path/to/js2','https://secure.other.com/path/to/js3')\n+\n+        class MyWidget2(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css2','/path/to/css3')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        class MyWidget3(TextInput):\n+            class Media:\n+                css = {\n+                   'all': ('/path/to/css3','path/to/css1')\n+                }\n+                js = ('/path/to/js1','/path/to/js4')\n+\n+        # You can ask a form for the media required by its widgets.\n+        class MyForm(Form):\n+            field1 = CharField(max_length=20, widget=MyWidget1())\n+            field2 = CharField(max_length=20, widget=MyWidget2())\n+        f1 = MyForm()\n+        self.assertEqual(str(f1.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+        # Form media can be combined to produce a single media definition.\n+        class AnotherForm(Form):\n+            field3 = CharField(max_length=20, widget=MyWidget3())\n+        f2 = AnotherForm()\n+        self.assertEqual(str(f1.media + f2.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\"\"\")\n+\n+        # Forms can also define media, following the same rules as widgets.\n+        class FormWithMedia(Form):\n+            field1 = CharField(max_length=20, widget=MyWidget1())\n+            field2 = CharField(max_length=20, widget=MyWidget2())\n+            class Media:\n+                js = ('/some/form/javascript',)\n+                css = {\n+                    'all': ('/some/form/css',)\n+                }\n+        f3 = FormWithMedia()\n+        self.assertEqual(str(f3.media), \"\"\"<link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\n+<script type=\"text/javascript\" src=\"/some/form/javascript\"></script>\"\"\")\n+\n+        # Media works in templates\n+        from django.template import Template, Context\n+        self.assertEqual(Template(\"{{ form.media.js }}{{ form.media.css }}\").render(Context({'form': f3})), \"\"\"<script type=\"text/javascript\" src=\"/path/to/js1\"></script>\n+<script type=\"text/javascript\" src=\"http://media.other.com/path/to/js2\"></script>\n+<script type=\"text/javascript\" src=\"https://secure.other.com/path/to/js3\"></script>\n+<script type=\"text/javascript\" src=\"/path/to/js4\"></script>\n+<script type=\"text/javascript\" src=\"/some/form/javascript\"></script><link href=\"http://media.example.com/static/path/to/css1\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css2\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/path/to/css3\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\"\"\")\n+"
        },
        {
            "sha": "6cd581fff25d48c7734bf3e7afeb42bb44d5680a",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 35,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -23,8 +23,8 @@ class StaticFilesTestCase(TestCase):\n     Test case with a couple utility assertions.\n     \"\"\"\n     def setUp(self):\n-        self.old_staticfiles_url = settings.STATICFILES_URL\n-        self.old_staticfiles_root = settings.STATICFILES_ROOT\n+        self.old_static_url = settings.STATIC_URL\n+        self.old_static_root = settings.STATIC_ROOT\n         self.old_staticfiles_dirs = settings.STATICFILES_DIRS\n         self.old_staticfiles_finders = settings.STATICFILES_FINDERS\n         self.old_media_root = settings.MEDIA_ROOT\n@@ -40,8 +40,8 @@ def setUp(self):\n         settings.DEBUG = True\n         settings.MEDIA_ROOT =  os.path.join(site_media, 'media')\n         settings.MEDIA_URL = '/media/'\n-        settings.STATICFILES_ROOT = os.path.join(site_media, 'static')\n-        settings.STATICFILES_URL = '/static/'\n+        settings.STATIC_ROOT = os.path.join(site_media, 'static')\n+        settings.STATIC_URL = '/static/'\n         settings.ADMIN_MEDIA_PREFIX = '/static/admin/'\n         settings.STATICFILES_DIRS = (\n             os.path.join(TEST_ROOT, 'project', 'documents'),\n@@ -52,6 +52,7 @@ def setUp(self):\n             'django.contrib.staticfiles.finders.DefaultStorageFinder',\n         )\n         settings.INSTALLED_APPS = [\n+            \"django.contrib.staticfiles\",\n             \"regressiontests.staticfiles_tests\",\n         ]\n \n@@ -65,8 +66,8 @@ def tearDown(self):\n         settings.MEDIA_ROOT = self.old_media_root\n         settings.MEDIA_URL = self.old_media_url\n         settings.ADMIN_MEDIA_PREFIX = self.old_admin_media_prefix\n-        settings.STATICFILES_ROOT = self.old_staticfiles_root\n-        settings.STATICFILES_URL = self.old_staticfiles_url\n+        settings.STATIC_ROOT = self.old_static_root\n+        settings.STATIC_URL = self.old_static_url\n         settings.STATICFILES_DIRS = self.old_staticfiles_dirs\n         settings.STATICFILES_FINDERS = self.old_staticfiles_finders\n         settings.INSTALLED_APPS = self.old_installed_apps\n@@ -91,13 +92,13 @@ class BuildStaticTestCase(StaticFilesTestCase):\n     def setUp(self):\n         super(BuildStaticTestCase, self).setUp()\n         self.old_staticfiles_storage = settings.STATICFILES_STORAGE\n-        self.old_root = settings.STATICFILES_ROOT\n-        settings.STATICFILES_ROOT = tempfile.mkdtemp()\n+        self.old_root = settings.STATIC_ROOT\n+        settings.STATIC_ROOT = tempfile.mkdtemp()\n         self.run_collectstatic()\n \n     def tearDown(self):\n-        shutil.rmtree(settings.STATICFILES_ROOT)\n-        settings.STATICFILES_ROOT = self.old_root\n+        shutil.rmtree(settings.STATIC_ROOT)\n+        settings.STATIC_ROOT = self.old_root\n         super(BuildStaticTestCase, self).tearDown()\n \n     def run_collectstatic(self, **kwargs):\n@@ -106,7 +107,7 @@ def run_collectstatic(self, **kwargs):\n \n     def _get_file(self, filepath):\n         assert filepath, 'filepath is empty.'\n-        filepath = os.path.join(settings.STATICFILES_ROOT, filepath)\n+        filepath = os.path.join(settings.STATIC_ROOT, filepath)\n         f = open(filepath)\n         try:\n             return f.read()\n@@ -231,7 +232,7 @@ def test_no_files_created(self):\n         \"\"\"\n         With --dry-run, no files created in destination dir.\n         \"\"\"\n-        self.assertEquals(os.listdir(settings.STATICFILES_ROOT), [])\n+        self.assertEquals(os.listdir(settings.STATIC_ROOT), [])\n \n \n if sys.platform != 'win32':\n@@ -251,7 +252,7 @@ def test_links_created(self):\n             With ``--link``, symbolic links are created.\n \n             \"\"\"\n-            self.failUnless(os.path.islink(os.path.join(settings.STATICFILES_ROOT, 'test.txt')))\n+            self.failUnless(os.path.islink(os.path.join(settings.STATIC_ROOT, 'test.txt')))\n \n \n class TestServeStatic(StaticFilesTestCase):\n@@ -262,7 +263,7 @@ class TestServeStatic(StaticFilesTestCase):\n \n     def _response(self, filepath):\n         return self.client.get(\n-            posixpath.join(settings.STATICFILES_URL, filepath))\n+            posixpath.join(settings.STATIC_URL, filepath))\n \n     def assertFileContains(self, filepath, text):\n         self.assertContains(self._response(filepath), text)\n@@ -372,24 +373,3 @@ def test_get_finder(self):\n             finders.get_finder, \"django.contrib.staticfiles.finders.FooBarFinder\")\n         self.assertRaises(ImproperlyConfigured,\n             finders.get_finder, \"foo.bar.FooBarFinder\")\n-\n-\n-class TemplateTagTest(TestCase):\n-    def test_get_staticfiles_prefix(self):\n-        \"\"\"\n-        Test the get_staticfiles_prefix helper return the STATICFILES_URL setting.\n-        \"\"\"\n-        self.assertEquals(Template(\n-            \"{% load staticfiles %}\"\n-            \"{% get_staticfiles_prefix %}\"\n-        ).render(Context()), settings.STATICFILES_URL)\n-\n-    def test_get_staticfiles_prefix_with_as(self):\n-        \"\"\"\n-        Test the get_staticfiles_prefix helper return the STATICFILES_URL setting.\n-        \"\"\"\n-        self.assertEquals(Template(\n-            \"{% load staticfiles %}\"\n-            \"{% get_staticfiles_prefix as staticfiles_prefix %}\"\n-            \"{{ staticfiles_prefix }}\"\n-        ).render(Context()), settings.STATICFILES_URL)"
        },
        {
            "sha": "ea93beb69ed309039a23914fd930e23d2cbc4428",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 6,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/33d8fcde8a317184a627492f008a4eab9333ed88/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/33d8fcde8a317184a627492f008a4eab9333ed88/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=33d8fcde8a317184a627492f008a4eab9333ed88",
            "patch": "@@ -114,6 +114,16 @@ def __str__(self):\n         return u''.encode('utf-8')\n \n class Templates(unittest.TestCase):\n+    def setUp(self):\n+        self.old_static_url = settings.STATIC_URL\n+        self.old_media_url = settings.MEDIA_URL\n+        settings.STATIC_URL = u\"/static/\"\n+        settings.MEDIA_URL = u\"/media/\"\n+\n+    def tearDown(self):\n+        settings.STATIC_URL = self.old_static_url\n+        settings.MEDIA_URL = self.old_media_url\n+\n     def test_loaders_security(self):\n         ad_loader = app_directories.Loader()\n         fs_loader = filesystem.Loader()\n@@ -1328,24 +1338,28 @@ def get_template_tests(self):\n             'autoescape-filtertag01': (\"{{ first }}{% filter safe %}{{ first }} x<y{% endfilter %}\", {\"first\": \"<a>\"}, template.TemplateSyntaxError),\n \n             # ifqeual compares unescaped vales.\n-            'autoescape-ifequal01': ('{% ifequal var \"this & that\" %}yes{% endifequal %}', { \"var\": \"this & that\" }, \"yes\" ),\n+            'autoescape-ifequal01': ('{% ifequal var \"this & that\" %}yes{% endifequal %}', { \"var\": \"this & that\" }, \"yes\"),\n \n             # Arguments to filters are 'safe' and manipulate their input unescaped.\n             'autoescape-filters01': ('{{ var|cut:\"&\" }}', { \"var\": \"this & that\" }, \"this  that\" ),\n-            'autoescape-filters02': ('{{ var|join:\" & \\\" }}', { \"var\": (\"Tom\", \"Dick\", \"Harry\") }, \"Tom & Dick & Harry\" ),\n+            'autoescape-filters02': ('{{ var|join:\" & \\\" }}', { \"var\": (\"Tom\", \"Dick\", \"Harry\") }, \"Tom & Dick & Harry\"),\n \n             # Literal strings are safe.\n-            'autoescape-literals01': ('{{ \"this & that\" }}',{}, \"this & that\" ),\n+            'autoescape-literals01': ('{{ \"this & that\" }}',{}, \"this & that\"),\n \n             # Iterating over strings outputs safe characters.\n-            'autoescape-stringiterations01': ('{% for l in var %}{{ l }},{% endfor %}', {'var': 'K&R'}, \"K,&amp;,R,\" ),\n+            'autoescape-stringiterations01': ('{% for l in var %}{{ l }},{% endfor %}', {'var': 'K&R'}, \"K,&amp;,R,\"),\n \n             # Escape requirement survives lookup.\n-            'autoescape-lookup01': ('{{ var.key }}', { \"var\": {\"key\": \"this & that\" }}, \"this &amp; that\" ),\n+            'autoescape-lookup01': ('{{ var.key }}', { \"var\": {\"key\": \"this & that\" }}, \"this &amp; that\"),\n \n+            # Static template tags\n+            'static-prefixtag01': ('{% load static %}{% get_static_prefix %}', {}, settings.STATIC_URL),\n+            'static-prefixtag02': ('{% load static %}{% get_static_prefix as static_prefix %}{{ static_prefix }}', {}, settings.STATIC_URL),\n+            'static-prefixtag03': ('{% load static %}{% get_media_prefix %}', {}, settings.MEDIA_URL),\n+            'static-prefixtag04': ('{% load static %}{% get_media_prefix as media_prefix %}{{ media_prefix }}', {}, settings.MEDIA_URL),\n         }\n \n-\n class TemplateTagLoading(unittest.TestCase):\n \n     def setUp(self):"
        }
    ],
    "stats": {
        "total": 1237,
        "additions": 908,
        "deletions": 329
    }
}