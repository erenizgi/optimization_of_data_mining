{
    "author": "apollo13",
    "message": "Fixed #18091 -- Non-ASCII templates break `django-admin.py startproject --template=TEMPLATE`.\n\nThanks to Claude Huchet and Tomáš Ehrlich for the patch.",
    "sha": "3afb5916b215c79e36408b729c9516bc435f5cb7",
    "files": [
        {
            "sha": "aa65593e9cf58220329ea487f9bb9b281ca13a4c",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/3afb5916b215c79e36408b729c9516bc435f5cb7/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/3afb5916b215c79e36408b729c9516bc435f5cb7/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=3afb5916b215c79e36408b729c9516bc435f5cb7",
            "patch": "@@ -8,6 +8,8 @@\n import stat\n import sys\n import tempfile\n+import codecs\n+\n try:\n     from urllib.request import urlretrieve\n except ImportError:     # Python 2\n@@ -154,12 +156,12 @@ def handle(self, app_or_project, name, target=None, **options):\n \n                 # Only render the Python files, as we don't want to\n                 # accidentally render Django templates files\n-                with open(old_path, 'r') as template_file:\n+                with codecs.open(old_path, 'r', 'utf-8') as template_file:\n                     content = template_file.read()\n                 if filename.endswith(extensions) or filename in extra_files:\n                     template = Template(content)\n                     content = template.render(context)\n-                with open(new_path, 'w') as new_file:\n+                with codecs.open(new_path, 'w', 'utf-8') as new_file:\n                     new_file.write(content)\n \n                 if self.verbosity >= 2:"
        },
        {
            "sha": "873eaded88aad5f82fd542c3804cac7a22a3446c",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/ticket-18091-non-ascii-template.txt",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3afb5916b215c79e36408b729c9516bc435f5cb7/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fticket-18091-non-ascii-template.txt",
            "raw_url": "https://github.com/django/django/raw/3afb5916b215c79e36408b729c9516bc435f5cb7/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fticket-18091-non-ascii-template.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fticket-18091-non-ascii-template.txt?ref=3afb5916b215c79e36408b729c9516bc435f5cb7",
            "patch": "@@ -0,0 +1,2 @@\n+Some non-ASCII text for testing ticket #18091:\n+üäö €"
        },
        {
            "sha": "3af291b806715590a44fdcdfc8873367e6d74200",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/3afb5916b215c79e36408b729c9516bc435f5cb7/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3afb5916b215c79e36408b729c9516bc435f5cb7/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=3afb5916b215c79e36408b729c9516bc435f5cb7",
            "patch": "@@ -1573,3 +1573,16 @@ def test_custom_project_destination_missing(self):\n         self.assertOutput(err, \"Destination directory '%s' does not exist, please create it first.\" % testproject_dir)\n         self.assertFalse(os.path.exists(testproject_dir))\n \n+\n+    def test_custom_project_template_with_non_ascii_templates(self):\n+        \"Ticket 18091: Make sure the startproject management command is able to render templates with non-ASCII content\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template')\n+        args = ['startproject', '--template', template_path, '--extension=txt', 'customtestproject']\n+        testproject_dir = os.path.join(test_dir, 'customtestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.assertEqual(open(os.path.join(testproject_dir, 'ticket-18091-non-ascii-template.txt')).read(),\n+                         'Some non-ASCII text for testing ticket #18091:\\n\\xc3\\xbc\\xc3\\xa4\\xc3\\xb6 \\xe2\\x82\\xac\\n')"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 19,
        "deletions": 2
    }
}