{
    "author": "jezdez",
    "message": "Fixed #15496 -- Corrected handling of base64 file upload encoding. Thanks, gene and Claude Paroz.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16176 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "eb24b546340d500502278bd124dbd527963ca4c4",
    "files": [
        {
            "sha": "ae143f79ede0fc853087277943f0763848f08317",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eb24b546340d500502278bd124dbd527963ca4c4/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/eb24b546340d500502278bd124dbd527963ca4c4/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=eb24b546340d500502278bd124dbd527963ca4c4",
            "patch": "@@ -145,6 +145,8 @@ def parse(self):\n                     continue\n \n                 transfer_encoding = meta_data.get('content-transfer-encoding')\n+                if transfer_encoding is not None:\n+                    transfer_encoding = transfer_encoding[0].strip()\n                 field_name = force_unicode(field_name, encoding, errors='replace')\n \n                 if item_type == FIELD:"
        },
        {
            "sha": "3c126b7d0f0772277b30053a27431447ea5e65ef",
            "filename": "tests/regressiontests/file_uploads/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/eb24b546340d500502278bd124dbd527963ca4c4/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eb24b546340d500502278bd124dbd527963ca4c4/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py?ref=eb24b546340d500502278bd124dbd527963ca4c4",
            "patch": "@@ -1,5 +1,6 @@\n #! -*- coding: utf-8 -*-\n \n+import base64\n import errno\n import hashlib\n import os\n@@ -56,6 +57,30 @@ def test_large_upload(self):\n \n         self.assertEqual(response.status_code, 200)\n \n+    def test_base64_upload(self):\n+        test_string = \"This data will be transmitted base64-encoded.\"\n+        payload = \"\\r\\n\".join([\n+            '--' + client.BOUNDARY,\n+            'Content-Disposition: form-data; name=\"file\"; filename=\"test.txt\"',\n+            'Content-Type: application/octet-stream',\n+            'Content-Transfer-Encoding: base64',\n+            '',\n+            base64.b64encode(test_string),\n+            '--' + client.BOUNDARY + '--',\n+            '',\n+        ])\n+        r = {\n+            'CONTENT_LENGTH': len(payload),\n+            'CONTENT_TYPE':   client.MULTIPART_CONTENT,\n+            'PATH_INFO':      \"/file_uploads/echo_content/\",\n+            'REQUEST_METHOD': 'POST',\n+            'wsgi.input':     client.FakePayload(payload),\n+        }\n+        response = self.client.request(**r)\n+        received = simplejson.loads(response.content)\n+\n+        self.assertEqual(received['file'], test_string)\n+\n     def test_unicode_file_name(self):\n         tdir = tempfile.gettempdir()\n "
        },
        {
            "sha": "9f814c4d4c1eaef7f131e7feedfb017507ac562f",
            "filename": "tests/regressiontests/file_uploads/urls.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eb24b546340d500502278bd124dbd527963ca4c4/tests%2Fregressiontests%2Ffile_uploads%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/eb24b546340d500502278bd124dbd527963ca4c4/tests%2Fregressiontests%2Ffile_uploads%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Furls.py?ref=eb24b546340d500502278bd124dbd527963ca4c4",
            "patch": "@@ -6,6 +6,7 @@\n     (r'^verify/$',          views.file_upload_view_verify),\n     (r'^unicode_name/$',    views.file_upload_unicode_name),\n     (r'^echo/$',            views.file_upload_echo),\n+    (r'^echo_content/$',    views.file_upload_echo_content),\n     (r'^quota/$',           views.file_upload_quota),\n     (r'^quota/broken/$',    views.file_upload_quota_broken),\n     (r'^getlist_count/$',   views.file_upload_getlist_count),"
        },
        {
            "sha": "dba7522bae92099153b126023c69fb8b351a2d5c",
            "filename": "tests/regressiontests/file_uploads/views.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/eb24b546340d500502278bd124dbd527963ca4c4/tests%2Fregressiontests%2Ffile_uploads%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/eb24b546340d500502278bd124dbd527963ca4c4/tests%2Fregressiontests%2Ffile_uploads%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Fviews.py?ref=eb24b546340d500502278bd124dbd527963ca4c4",
            "patch": "@@ -85,6 +85,13 @@ def file_upload_echo(request):\n     r = dict([(k, f.name) for k, f in request.FILES.items()])\n     return HttpResponse(simplejson.dumps(r))\n \n+def file_upload_echo_content(request):\n+    \"\"\"\n+    Simple view to echo back the content of uploaded files for tests.\n+    \"\"\"\n+    r = dict([(k, f.read()) for k, f in request.FILES.items()])\n+    return HttpResponse(simplejson.dumps(r))\n+\n def file_upload_quota(request):\n     \"\"\"\n     Dynamically add in an upload handler."
        }
    ],
    "stats": {
        "total": 35,
        "additions": 35,
        "deletions": 0
    }
}