{
    "author": "akaariai",
    "message": "Fixed a regression introduced in where.as_sql() refactor\n\nAt least Oracle needs parentheses in negated where conditions, even if\nthere is only single condition negated. Fixed this by reverting to old\nlogic in that part of as_sql() and adding a comment about this.\n\nI did not investigate why the parentheses are needed. The original\noffending commit was bd283aa844b04651b7c8b4e85f48c6dced1678f0.",
    "sha": "e74787391e8fdf87d9a92138028911746809bd7c",
    "files": [
        {
            "sha": "827046553d9b22c69a31aeca3daf4ff094bb76ed",
            "filename": "django/db/models/sql/where.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/e74787391e8fdf87d9a92138028911746809bd7c/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "raw_url": "https://github.com/django/django/raw/e74787391e8fdf87d9a92138028911746809bd7c/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py?ref=e74787391e8fdf87d9a92138028911746809bd7c",
            "patch": "@@ -135,10 +135,13 @@ def as_sql(self, qn, connection):\n         conn = ' %s ' % self.connector\n         sql_string = conn.join(result)\n         if sql_string:\n-            if len(result) > 1:\n-                sql_string = '(%s)' % sql_string\n             if self.negated:\n-                sql_string = 'NOT %s' % sql_string\n+                # Note that some backends (Oracle at least) need the\n+                # parentheses even around single experssion in the\n+                # negated case.\n+                sql_string = 'NOT (%s)' % sql_string\n+            elif len(result) > 1:\n+                sql_string = '(%s)' % sql_string\n         return sql_string, result_params\n \n     def make_atom(self, child, qn, connection):"
        },
        {
            "sha": "9bb3a2943025c143c1270d6f757f829188d291e5",
            "filename": "tests/regressiontests/queries/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e74787391e8fdf87d9a92138028911746809bd7c/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e74787391e8fdf87d9a92138028911746809bd7c/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fqueries%2Ftests.py?ref=e74787391e8fdf87d9a92138028911746809bd7c",
            "patch": "@@ -2091,7 +2091,7 @@ def test_empty_full_handling_disjunction(self):\n         w = WhereNode(children=[NothingNode(), self.DummyNode()], connector='OR')\n         self.assertEquals(w.as_sql(qn, connection), ('dummy', []))\n         w.negate()\n-        self.assertEquals(w.as_sql(qn, connection), ('NOT dummy', []))\n+        self.assertEquals(w.as_sql(qn, connection), ('NOT (dummy)', []))\n \n     def test_empty_nodes(self):\n         qn = connection.ops.quote_name"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 7,
        "deletions": 4
    }
}