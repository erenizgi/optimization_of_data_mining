{
    "author": "aaugustin",
    "message": "Removed legacy ways of calling cache_page.",
    "sha": "2ecf56ea3f86cde1caaf4b21a807440d3870dcf0",
    "files": [
        {
            "sha": "001e21c0a5d6e7eb4b254a84d5561e0cfa0d4f16",
            "filename": "django/views/decorators/cache.py",
            "status": "modified",
            "additions": 6,
            "deletions": 43,
            "changes": 49,
            "blob_url": "https://github.com/django/django/blob/2ecf56ea3f86cde1caaf4b21a807440d3870dcf0/django%2Fviews%2Fdecorators%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/2ecf56ea3f86cde1caaf4b21a807440d3870dcf0/django%2Fviews%2Fdecorators%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fcache.py?ref=2ecf56ea3f86cde1caaf4b21a807440d3870dcf0",
            "patch": "@@ -18,54 +18,17 @@ def cache_page(*args, **kwargs):\n     Additionally, all headers from the response's Vary header will be taken\n     into account on caching -- just like the middleware does.\n     \"\"\"\n-    # We need backwards compatibility with code which spells it this way:\n-    #   def my_view(): pass\n-    #   my_view = cache_page(my_view, 123)\n-    # and this way:\n-    #   my_view = cache_page(123)(my_view)\n-    # and this:\n-    #   my_view = cache_page(my_view, 123, key_prefix=\"foo\")\n-    # and this:\n-    #   my_view = cache_page(123, key_prefix=\"foo\")(my_view)\n-    # and possibly this way (?):\n-    #   my_view = cache_page(123, my_view)\n-    # and also this way:\n-    #   my_view = cache_page(my_view)\n-    # and also this way:\n-    #   my_view = cache_page()(my_view)\n-\n     # We also add some asserts to give better error messages in case people are\n     # using other ways to call cache_page that no longer work.\n+    if len(args) != 1 or callable(args[0]):\n+        raise TypeError(\"cache_page has a single mandatory positional argument: timeout\")\n+    cache_timeout = args[0]\n     cache_alias = kwargs.pop('cache', None)\n     key_prefix = kwargs.pop('key_prefix', None)\n-    assert not kwargs, \"The only keyword arguments are cache and key_prefix\"\n-    def warn():\n-        import warnings\n-        warnings.warn('The cache_page decorator must be called like: '\n-                      'cache_page(timeout, [cache=cache name], [key_prefix=key prefix]). '\n-                      'All other ways are deprecated.',\n-                      DeprecationWarning,\n-                      stacklevel=2)\n+    if kwargs:\n+        raise TypeError(\"cache_page has two optional keyword arguments: cache and key_prefix\")\n \n-    if len(args) > 1:\n-        assert len(args) == 2, \"cache_page accepts at most 2 arguments\"\n-        warn()\n-        if callable(args[0]):\n-            return decorator_from_middleware_with_args(CacheMiddleware)(cache_timeout=args[1], cache_alias=cache_alias, key_prefix=key_prefix)(args[0])\n-        elif callable(args[1]):\n-            return decorator_from_middleware_with_args(CacheMiddleware)(cache_timeout=args[0], cache_alias=cache_alias, key_prefix=key_prefix)(args[1])\n-        else:\n-            assert False, \"cache_page must be passed a view function if called with two arguments\"\n-    elif len(args) == 1:\n-        if callable(args[0]):\n-            warn()\n-            return decorator_from_middleware_with_args(CacheMiddleware)(cache_alias=cache_alias, key_prefix=key_prefix)(args[0])\n-        else:\n-            # The One True Way\n-            return decorator_from_middleware_with_args(CacheMiddleware)(cache_timeout=args[0], cache_alias=cache_alias, key_prefix=key_prefix)\n-    else:\n-        warn()\n-        return decorator_from_middleware_with_args(CacheMiddleware)(cache_alias=cache_alias, key_prefix=key_prefix)\n+    return decorator_from_middleware_with_args(CacheMiddleware)(cache_timeout=cache_timeout, cache_alias=cache_alias, key_prefix=key_prefix)\n \n \n def cache_control(**kwargs):"
        },
        {
            "sha": "42d093963ef25ff1684db296f33523fd3ec1c68d",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 31,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/2ecf56ea3f86cde1caaf4b21a807440d3870dcf0/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2ecf56ea3f86cde1caaf4b21a807440d3870dcf0/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=2ecf56ea3f86cde1caaf4b21a807440d3870dcf0",
            "patch": "@@ -1478,19 +1478,12 @@ def hello_world_view(request, value):\n )\n class CacheMiddlewareTest(TestCase):\n \n-    # The following tests will need to be modified in Django 1.6 to not use\n-    # deprecated ways of using the cache_page decorator that will be removed in\n-    # such version\n     def setUp(self):\n         self.factory = RequestFactory()\n         self.default_cache = get_cache('default')\n         self.other_cache = get_cache('other')\n-        self.save_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning,\n-            module='django.views.decorators.cache')\n \n     def tearDown(self):\n-        self.restore_warnings_state()\n         self.default_cache.clear()\n         self.other_cache.clear()\n \n@@ -1603,21 +1596,20 @@ class MockAccessedSession(object):\n         request.user = MockAuthenticatedUser()\n         request.session = MockAccessedSession()\n \n-        response = cache_page(hello_world_view)(request, '1')\n+        response = cache_page(60)(hello_world_view)(request, '1')\n \n         self.assertFalse(\"Cache-Control\" in response)\n \n     def test_view_decorator(self):\n         # decorate the same view with different cache decorators\n-        default_view = cache_page(hello_world_view)\n-        default_with_prefix_view = cache_page(key_prefix='prefix1')(hello_world_view)\n+        default_view = cache_page(3)(hello_world_view)\n+        default_with_prefix_view = cache_page(3, key_prefix='prefix1')(hello_world_view)\n \n-        explicit_default_view = cache_page(cache='default')(hello_world_view)\n-        explicit_default_with_prefix_view = cache_page(cache='default', key_prefix='prefix1')(hello_world_view)\n+        explicit_default_view = cache_page(3, cache='default')(hello_world_view)\n+        explicit_default_with_prefix_view = cache_page(3, cache='default', key_prefix='prefix1')(hello_world_view)\n \n-        other_view = cache_page(cache='other')(hello_world_view)\n-        other_with_prefix_view = cache_page(cache='other', key_prefix='prefix2')(hello_world_view)\n-        other_with_timeout_view = cache_page(3, cache='other', key_prefix='prefix3')(hello_world_view)\n+        other_view = cache_page(1, cache='other')(hello_world_view)\n+        other_with_prefix_view = cache_page(1, cache='other', key_prefix='prefix2')(hello_world_view)\n \n         request = self.factory.get('/view/')\n \n@@ -1657,10 +1649,6 @@ def test_view_decorator(self):\n         response = other_with_prefix_view(request, '9')\n         self.assertEqual(response.content, b'Hello World 9')\n \n-        # Request from the alternate cache with a new prefix and a custom timeout\n-        response = other_with_timeout_view(request, '10')\n-        self.assertEqual(response.content, b'Hello World 10')\n-\n         # But if we wait a couple of seconds...\n         time.sleep(2)\n \n@@ -1689,18 +1677,6 @@ def test_view_decorator(self):\n         response = other_with_prefix_view(request, '16')\n         self.assertEqual(response.content, b'Hello World 16')\n \n-        # ... but a view with a custom timeout will still hit\n-        response = other_with_timeout_view(request, '17')\n-        self.assertEqual(response.content, b'Hello World 10')\n-\n-        # And if we wait a few more seconds\n-        time.sleep(2)\n-\n-        # the custom timeout cache will miss\n-        response = other_with_timeout_view(request, '18')\n-        self.assertEqual(response.content, b'Hello World 18')\n-\n-\n @override_settings(\n         CACHE_MIDDLEWARE_KEY_PREFIX='settingsprefix',\n         CACHE_MIDDLEWARE_SECONDS=1,"
        },
        {
            "sha": "8a3f340e9f1959a1fc52c470692ffaaae2ef8913",
            "filename": "tests/regressiontests/decorators/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/2ecf56ea3f86cde1caaf4b21a807440d3870dcf0/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2ecf56ea3f86cde1caaf4b21a807440d3870dcf0/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdecorators%2Ftests.py?ref=2ecf56ea3f86cde1caaf4b21a807440d3870dcf0",
            "patch": "@@ -1,4 +1,3 @@\n-import warnings\n from functools import wraps\n \n from django.contrib.admin.views.decorators import staff_member_required\n@@ -116,22 +115,6 @@ def my_view(request):\n         my_view_cached2 = cache_page(123, key_prefix=\"test\")(my_view)\n         self.assertEqual(my_view_cached2(HttpRequest()), \"response\")\n \n-    def test_cache_page_old_style(self):\n-        \"\"\"\n-        Test that we can call cache_page the old way\n-        \"\"\"\n-        def my_view(request):\n-            return \"response\"\n-        with warnings.catch_warnings(record=True):\n-            my_view_cached = cache_page(my_view, 123)\n-            self.assertEqual(my_view_cached(HttpRequest()), \"response\")\n-            my_view_cached2 = cache_page(my_view, 123, key_prefix=\"test\")\n-            self.assertEqual(my_view_cached2(HttpRequest()), \"response\")\n-            my_view_cached3 = cache_page(my_view)\n-            self.assertEqual(my_view_cached3(HttpRequest()), \"response\")\n-            my_view_cached4 = cache_page()(my_view)\n-            self.assertEqual(my_view_cached4(HttpRequest()), \"response\")\n-\n     def test_require_safe_accepts_only_safe_methods(self):\n         \"\"\"\n         Test for the require_safe decorator."
        }
    ],
    "stats": {
        "total": 104,
        "additions": 13,
        "deletions": 91
    }
}