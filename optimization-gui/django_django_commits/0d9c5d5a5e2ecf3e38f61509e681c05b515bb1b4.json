{
    "author": "freakboy3742",
    "message": "Fixed #15245 -- Added note about the CSRF AJAX exception to the 1.2.5 release notes. Thanks to Matt Austin for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15478 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0d9c5d5a5e2ecf3e38f61509e681c05b515bb1b4",
    "files": [
        {
            "sha": "7482e09a8fbcc562930e5cddc169262f904f3e18",
            "filename": "docs/releases/1.2.5.txt",
            "status": "modified",
            "additions": 60,
            "deletions": 1,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/0d9c5d5a5e2ecf3e38f61509e681c05b515bb1b4/docs%2Freleases%2F1.2.5.txt",
            "raw_url": "https://github.com/django/django/raw/0d9c5d5a5e2ecf3e38f61509e681c05b515bb1b4/docs%2Freleases%2F1.2.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.2.5.txt?ref=0d9c5d5a5e2ecf3e38f61509e681c05b515bb1b4",
            "patch": "@@ -7,7 +7,7 @@ Welcome to Django 1.2.5!\n This is the fifth \"bugfix\" release in the Django 1.2 series,\n improving the stability and performance of the Django 1.2 codebase.\n \n-With two exceptions, Django 1.2.5 maintains backwards compatibility\n+With three exceptions, Django 1.2.5 maintains backwards compatibility\n with Django 1.2.4, but contain a number of fixes and other\n improvements. Django 1.2.5 is a recommended upgrade for any\n development or deployment currently using or targeting Django 1.2.\n@@ -18,6 +18,65 @@ deprecated features in the 1.2 branch, see the :doc:`/releases/1.2`.\n Backwards incompatible changes\n ==============================\n \n+CSRF exception for AJAX requests\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django includes a CSRF-protection mechanism, which makes use of a\n+token inserted into outgoing forms. Middleware then checks for the\n+token's presence on form submission, and validates it.\n+\n+Prior to Django 1.2.5, our CSRF protection made an exception for AJAX\n+requests, on the following basis:\n+\n+    * Many AJAX toolkits add an X-Requested-With header when using\n+      XMLHttpRequest.\n+\n+    * Browsers have strict same-origin policies regarding\n+      XMLHttpRequest.\n+\n+    * In the context of a browser, the only way that a custom header\n+      of this nature can be added is with XMLHttpRequest.\n+\n+Therefore, for ease of use, we did not apply CSRF checks to requests\n+that appeared to be AJAX on the basis of the X-Requested-With header.\n+The Ruby on Rails web framework had a similar exemption.\n+\n+Recently, engineers at Google made members of the Ruby on Rails\n+development team aware of a combination of browser plugins and\n+redirects which can allow an attacker to provide custom HTTP headers\n+on a request to any website. This can allow a forged request to appear\n+to be an AJAX request, thereby defeating CSRF protection which trusts\n+the same-origin nature of AJAX requests.\n+\n+Michael Koziarski of the Rails team brought this to our attention, and\n+we were able to produce a proof-of-concept demonstrating the same\n+vulnerability in Django's CSRF handling.\n+\n+To remedy this, Django will now apply full CSRF validation to all\n+requests, regardless of apparent AJAX origin. This is technically\n+backwards-incompatible, but the security risks have been judged to\n+outweigh the compatibility concerns in this case.\n+\n+Additionally, Django will now accept the CSRF token in the custom HTTP\n+header X-CSRFTOKEN, as well as in the form submission itself, for ease\n+of use with popular JavaScript toolkits which allow insertion of\n+custom headers into all AJAX requests.\n+\n+The following example using the jQuery JavaScript toolkit demonstrates\n+this; the call to jQuery's ajaxSetup will cause all AJAX requests to\n+send back the CSRF token in the custom X-CSRFTOKEN header::\n+\n+    $.ajaxSetup({\n+            beforeSend: function(xhr, settings) {\n+                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n+                    // Only send the token to relative URLs i.e. locally.\n+                    xhr.setRequestHeader(\"X-CSRFToken\",\n+                                         $(\"#csrfmiddlewaretoken\").val());\n+                }\n+            }\n+        });\n+\n+\n FileField no longer deletes files\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        }
    ],
    "stats": {
        "total": 61,
        "additions": 60,
        "deletions": 1
    }
}