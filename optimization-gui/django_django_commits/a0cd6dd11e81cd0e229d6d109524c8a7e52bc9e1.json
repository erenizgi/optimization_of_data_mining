{
    "author": "claudep",
    "message": "Fixed #19349 -- Fixed re-rendering of ReadOnlyPasswordHashWidget\n\nThanks tim.bowden at mapforge.com.au for the report, Andreas Hug\nfor the patch and Anton Baklanov for the review.",
    "sha": "a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1",
    "files": [
        {
            "sha": "b44bc8b40bf826d49720d88ff9c79fb4d557c5fb",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1",
            "patch": "@@ -27,7 +27,7 @@ def render(self, name, value, attrs):\n         encoded = value\n         final_attrs = self.build_attrs(attrs)\n \n-        if encoded == '' or encoded == UNUSABLE_PASSWORD:\n+        if not encoded or encoded == UNUSABLE_PASSWORD:\n             summary = mark_safe(\"<strong>%s</strong>\" % ugettext(\"No password set.\"))\n         else:\n             try:\n@@ -52,6 +52,11 @@ def __init__(self, *args, **kwargs):\n         kwargs.setdefault(\"required\", False)\n         super(ReadOnlyPasswordHashField, self).__init__(*args, **kwargs)\n \n+    def bound_data(self, data, initial):\n+        # Always return initial because the widget doesn't\n+        # render an input field.\n+        return initial\n+\n \n class UserCreationForm(forms.ModelForm):\n     \"\"\""
        },
        {
            "sha": "286652ebcc0c32fe5156523e630d39196422efad",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 20,
            "deletions": 1,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=a0cd6dd11e81cd0e229d6d109524c8a7e52bc9e1",
            "patch": "@@ -3,7 +3,8 @@\n import os\n from django.contrib.auth.models import User\n from django.contrib.auth.forms import (UserCreationForm, AuthenticationForm,\n-    PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm)\n+    PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm,\n+    ReadOnlyPasswordHashWidget)\n from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.core import mail\n from django.forms.fields import Field, EmailField\n@@ -282,6 +283,14 @@ def test_bug_19133(self):\n         self.assertTrue(form.is_valid())\n         self.assertEqual(form.cleaned_data['password'], 'sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161')\n \n+    def test_bug_19349_bound_password_field(self):\n+        user = User.objects.get(username='testclient')\n+        form = UserChangeForm(data={}, instance=user)\n+        # When rendering the bound password field,\n+        # ReadOnlyPasswordHashWidget needs the initial\n+        # value to render correctly\n+        self.assertEqual(form.initial['password'], form['password'].value())\n+\n \n @skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n@@ -362,3 +371,13 @@ def test_unusable_password(self):\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"email\"].errors,\n                          [_(\"The user account associated with this email address cannot reset the password.\")])\n+\n+\n+class ReadOnlyPasswordHashWidgetTest(TestCase):\n+\n+    def test_bug_19349_render_with_none_value(self):\n+        # Rendering the widget with value set to None\n+        # mustn't raise an exception.\n+        widget = ReadOnlyPasswordHashWidget()\n+        html = widget.render(name='password', value=None, attrs={})\n+        self.assertIn(_(\"No password set.\"), html)"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 26,
        "deletions": 2
    }
}