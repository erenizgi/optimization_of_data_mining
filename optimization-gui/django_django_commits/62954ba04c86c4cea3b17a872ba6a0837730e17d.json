{
    "author": "aaugustin",
    "message": "[py3] Fixed #17040 -- ported django.utils.crypto.constant_time_compare.\n\nThis is a private API; adding a type check is acceptable.",
    "sha": "62954ba04c86c4cea3b17a872ba6a0837730e17d",
    "files": [
        {
            "sha": "e8fd2b1e2d5b9dd0b10fbea0ac7d04a9dde65c25",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/62954ba04c86c4cea3b17a872ba6a0837730e17d/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/62954ba04c86c4cea3b17a872ba6a0837730e17d/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=62954ba04c86c4cea3b17a872ba6a0837730e17d",
            "patch": "@@ -24,6 +24,7 @@\n \n from django.conf import settings\n from django.utils.encoding import smart_bytes\n+from django.utils import six\n from django.utils.six.moves import xrange\n \n \n@@ -81,15 +82,21 @@ def get_random_string(length=12,\n \n def constant_time_compare(val1, val2):\n     \"\"\"\n-    Returns True if the two strings are equal, False otherwise.\n+    Returns True if the two bytestrings are equal, False otherwise.\n \n     The time taken is independent of the number of characters that match.\n     \"\"\"\n+    if not (isinstance(val1, bytes) and isinstance(val2, bytes)):\n+        raise TypeError(\"constant_time_compare only supports bytes\")\n     if len(val1) != len(val2):\n         return False\n     result = 0\n-    for x, y in zip(val1, val2):\n-        result |= ord(x) ^ ord(y)\n+    if six.PY3:\n+        for x, y in zip(val1, val2):\n+            result |= x ^ y\n+    else:\n+        for x, y in zip(val1, val2):\n+            result |= ord(x) ^ ord(y)\n     return result == 0\n \n "
        },
        {
            "sha": "447b2e5b80c343299be755eb3158674c9d41f6cd",
            "filename": "tests/regressiontests/utils/crypto.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/62954ba04c86c4cea3b17a872ba6a0837730e17d/tests%2Fregressiontests%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/62954ba04c86c4cea3b17a872ba6a0837730e17d/tests%2Fregressiontests%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fcrypto.py?ref=62954ba04c86c4cea3b17a872ba6a0837730e17d",
            "patch": "@@ -6,7 +6,17 @@\n import hashlib\n \n from django.utils import unittest\n-from django.utils.crypto import pbkdf2\n+from django.utils.crypto import constant_time_compare, pbkdf2\n+\n+\n+class TestUtilsCryptoMisc(unittest.TestCase):\n+\n+    def test_constant_time_compare(self):\n+        # It's hard to test for constant time, just test the result.\n+        self.assertTrue(constant_time_compare(b'spam', b'spam'))\n+        self.assertFalse(constant_time_compare(b'spam', b'eggs'))\n+        with self.assertRaises(TypeError):\n+            constant_time_compare('spam', 'spam')\n \n \n class TestUtilsCryptoPBKDF2(unittest.TestCase):"
        },
        {
            "sha": "08f5f760ccc2c2dfc576fcf147f3cc963fa1914b",
            "filename": "tests/regressiontests/utils/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/62954ba04c86c4cea3b17a872ba6a0837730e17d/tests%2Fregressiontests%2Futils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/62954ba04c86c4cea3b17a872ba6a0837730e17d/tests%2Fregressiontests%2Futils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftests.py?ref=62954ba04c86c4cea3b17a872ba6a0837730e17d",
            "patch": "@@ -6,7 +6,7 @@\n from .archive import TestBzip2Tar, TestGzipTar, TestTar, TestZip\n from .baseconv import TestBaseConv\n from .checksums import TestUtilsChecksums\n-from .crypto import TestUtilsCryptoPBKDF2\n+from .crypto import TestUtilsCryptoMisc, TestUtilsCryptoPBKDF2\n from .datastructures import (DictWrapperTests, ImmutableListTests,\n     MergeDictTests, MultiValueDictTests, SortedDictTests)\n from .dateformat import DateFormatTests"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 22,
        "deletions": 5
    }
}