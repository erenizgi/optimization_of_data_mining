{
    "author": "ramiro",
    "message": "Simplified compilemessages tests a bit.",
    "sha": "f0bd55392244130821c4e9210b23135ddb0cf790",
    "files": [
        {
            "sha": "d92720e97ae2899243ad80b7280959b7abd1772f",
            "filename": "tests/i18n/commands/compilation.py",
            "status": "modified",
            "additions": 11,
            "deletions": 22,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/f0bd55392244130821c4e9210b23135ddb0cf790/tests%2Fi18n%2Fcommands%2Fcompilation.py",
            "raw_url": "https://github.com/django/django/raw/f0bd55392244130821c4e9210b23135ddb0cf790/tests%2Fi18n%2Fcommands%2Fcompilation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fi18n%2Fcommands%2Fcompilation.py?ref=f0bd55392244130821c4e9210b23135ddb0cf790",
            "patch": "@@ -14,9 +14,12 @@ class MessageCompilationTests(SimpleTestCase):\n \n     def setUp(self):\n         self._cwd = os.getcwd()\n+        self.addCleanup(os.chdir, self._cwd)\n+        os.chdir(test_dir)\n \n-    def tearDown(self):\n-        os.chdir(self._cwd)\n+    def rmfile(self, filepath):\n+        if os.path.exists(filepath):\n+            os.remove(filepath)\n \n \n class PoFileTests(MessageCompilationTests):\n@@ -25,7 +28,6 @@ class PoFileTests(MessageCompilationTests):\n     MO_FILE = 'locale/%s/LC_MESSAGES/django.mo' % LOCALE\n \n     def test_bom_rejection(self):\n-        os.chdir(test_dir)\n         with self.assertRaises(CommandError) as cm:\n             call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n         self.assertIn(\"file has a BOM (Byte Order Mark)\", cm.exception.args[0])\n@@ -43,7 +45,6 @@ def setUp(self):\n         self.addCleanup(os.unlink, os.path.join(test_dir, self.MO_FILE))\n \n     def test_percent_symbol_in_po_file(self):\n-        os.chdir(test_dir)\n         call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n         self.assertTrue(os.path.exists(self.MO_FILE))\n \n@@ -58,7 +59,6 @@ class PercentRenderingTests(MessageCompilationTests):\n     @override_settings(LOCALE_PATHS=(os.path.join(test_dir, 'locale'),))\n     def test_percent_symbol_escaping(self):\n         from django.template import Template, Context\n-        os.chdir(test_dir)\n         call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n         with translation.override(self.LOCALE):\n             t = Template('{% load i18n %}{% trans \"Looks like a str fmt spec %% o but shouldn\\'t be interpreted as such\" %}')\n@@ -77,24 +77,18 @@ class MultipleLocaleCompilationTests(MessageCompilationTests):\n \n     def setUp(self):\n         super(MultipleLocaleCompilationTests, self).setUp()\n-        self.localedir = os.path.join(test_dir, 'locale')\n-        self.MO_FILE_HR = os.path.join(self.localedir, 'hr/LC_MESSAGES/django.mo')\n-        self.MO_FILE_FR = os.path.join(self.localedir, 'fr/LC_MESSAGES/django.mo')\n-        self.addCleanup(self._rmfile, os.path.join(self.localedir, self.MO_FILE_HR))\n-        self.addCleanup(self._rmfile, os.path.join(self.localedir, self.MO_FILE_FR))\n-\n-    def _rmfile(self, filepath):\n-        if os.path.exists(filepath):\n-            os.remove(filepath)\n+        localedir = os.path.join(test_dir, 'locale')\n+        self.MO_FILE_HR = os.path.join(localedir, 'hr/LC_MESSAGES/django.mo')\n+        self.MO_FILE_FR = os.path.join(localedir, 'fr/LC_MESSAGES/django.mo')\n+        self.addCleanup(self.rmfile, os.path.join(localedir, self.MO_FILE_HR))\n+        self.addCleanup(self.rmfile, os.path.join(localedir, self.MO_FILE_FR))\n \n     def test_one_locale(self):\n-        os.chdir(test_dir)\n         call_command('compilemessages', locale='hr', stderr=StringIO())\n \n         self.assertTrue(os.path.exists(self.MO_FILE_HR))\n \n     def test_multiple_locales(self):\n-        os.chdir(test_dir)\n         call_command('compilemessages', locale=['hr', 'fr'], stderr=StringIO())\n \n         self.assertTrue(os.path.exists(self.MO_FILE_HR))\n@@ -108,13 +102,8 @@ class CompilationErrorHandling(MessageCompilationTests):\n \n     def setUp(self):\n         super(CompilationErrorHandling, self).setUp()\n-        self.addCleanup(self._rmfile, os.path.join(test_dir, self.MO_FILE))\n-\n-    def _rmfile(self, filepath):\n-        if os.path.exists(filepath):\n-            os.remove(filepath)\n+        self.addCleanup(self.rmfile, os.path.join(test_dir, self.MO_FILE))\n \n     def test_error_reported_by_msgfmt(self):\n-        os.chdir(test_dir)\n         with self.assertRaises(CommandError):\n             call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 11,
        "deletions": 22
    }
}