{
    "author": "claudep",
    "message": "Fixed #18196 -- Improved loaddata error messages.",
    "sha": "4353a6163c00d4193307dae533e3e6ae9b44d18f",
    "files": [
        {
            "sha": "30cf740cdf90a78fb2cac9e88527a415dea4d08c",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4353a6163c00d4193307dae533e3e6ae9b44d18f/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/4353a6163c00d4193307dae533e3e6ae9b44d18f/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=4353a6163c00d4193307dae533e3e6ae9b44d18f",
            "patch": "@@ -196,6 +196,10 @@ def read(self):\n                                     loaded_object_count += loaded_objects_in_fixture\n                                     fixture_object_count += objects_in_fixture\n                                     label_found = True\n+                                except Exception as e:\n+                                    if not isinstance(e, CommandError):\n+                                        e.args = (\"Problem installing fixture '%s': %s\" % (full_path, e),)\n+                                    raise\n                                 finally:\n                                     fixture.close()\n \n@@ -209,16 +213,18 @@ def read(self):\n             # Since we disabled constraint checks, we must manually check for\n             # any invalid keys that might have been added\n             table_names = [model._meta.db_table for model in models]\n-            connection.check_constraints(table_names=table_names)\n+            try:\n+                connection.check_constraints(table_names=table_names)\n+            except Exception as e:\n+                e.args = (\"Problem installing fixtures: %s\" % e,)\n+                raise\n \n         except (SystemExit, KeyboardInterrupt):\n             raise\n         except Exception as e:\n             if commit:\n                 transaction.rollback(using=using)\n                 transaction.leave_transaction_management(using=using)\n-            if not isinstance(e, CommandError):\n-                e.args = (\"Problem installing fixture '%s': %s\" % (full_path, e),)\n             raise\n \n         # If we found even one object in a fixture, we need to reset the"
        },
        {
            "sha": "5b0a9a19ca2cfcb00e9a5084e64d11b309080e0f",
            "filename": "django/test/signals.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4353a6163c00d4193307dae533e3e6ae9b44d18f/django%2Ftest%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/4353a6163c00d4193307dae533e3e6ae9b44d18f/django%2Ftest%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsignals.py?ref=4353a6163c00d4193307dae533e3e6ae9b44d18f",
            "patch": "@@ -4,7 +4,6 @@\n from django.conf import settings\n from django.db import connections\n from django.dispatch import receiver, Signal\n-from django.template import context\n from django.utils import timezone\n \n template_rendered = Signal(providing_args=[\"template\", \"context\"])\n@@ -48,9 +47,17 @@ def update_connections_time_zone(**kwargs):\n @receiver(setting_changed)\n def clear_context_processors_cache(**kwargs):\n     if kwargs['setting'] == 'TEMPLATE_CONTEXT_PROCESSORS':\n+        from django.template import context\n         context._standard_context_processors = None\n \n \n+@receiver(setting_changed)\n+def clear_serializers_cache(**kwargs):\n+    if kwargs['setting'] == 'SERIALIZATION_MODULES':\n+        from django.core import serializers\n+        serializers._serializers = {}\n+\n+\n @receiver(setting_changed)\n def language_changed(**kwargs):\n     if kwargs['setting'] in ('LOCALE_PATHS', 'LANGUAGE_CODE'):"
        },
        {
            "sha": "b3d0f42465382d6b777013cfd596bea411b66305",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/4353a6163c00d4193307dae533e3e6ae9b44d18f/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4353a6163c00d4193307dae533e3e6ae9b44d18f/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=4353a6163c00d4193307dae533e3e6ae9b44d18f",
            "patch": "@@ -126,6 +126,20 @@ def test_unknown_format(self):\n                 commit=False,\n             )\n \n+    @override_settings(SERIALIZATION_MODULES={'unkn': 'unexistent.path'})\n+    def test_unimportable_serializer(self):\n+        \"\"\"\n+        Test that failing serializer import raises the proper error\n+        \"\"\"\n+        with self.assertRaisesRegexp(ImportError,\n+                \"No module named unexistent.path\"):\n+            management.call_command(\n+                'loaddata',\n+                'bad_fixture1.unkn',\n+                verbosity=0,\n+                commit=False,\n+            )\n+\n     def test_invalid_data(self):\n         \"\"\"\n         Test for ticket #4371 -- Loading a fixture file with invalid data"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 31,
        "deletions": 4
    }
}