{
    "author": "andrewgodwin",
    "message": "Add second shortener to create_index_name for very long columns",
    "sha": "0bcfc068b011c41aeed135649276106147d90d70",
    "files": [
        {
            "sha": "a9e069aa7b4d281d07737649777477578f1b0bd7",
            "filename": "django/db/backends/schema.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0bcfc068b011c41aeed135649276106147d90d70/django%2Fdb%2Fbackends%2Fschema.py",
            "raw_url": "https://github.com/django/django/raw/0bcfc068b011c41aeed135649276106147d90d70/django%2Fdb%2Fbackends%2Fschema.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fschema.py?ref=0bcfc068b011c41aeed135649276106147d90d70",
            "patch": "@@ -1,3 +1,4 @@\n+import hashlib\n from django.db.backends.creation import BaseDatabaseCreation\n from django.db.backends.util import truncate_name\n from django.utils.log import getLogger\n@@ -615,6 +616,9 @@ def _create_index_name(self, model, column_names, suffix=\"\"):\n         if len(index_name) > self.connection.features.max_index_name_length:\n             part = ('_%s%s%s' % (column_names[0], index_unique_name, suffix))\n             index_name = '%s%s' % (table_name[:(self.connection.features.max_index_name_length - len(part))], part)\n+        # If it's STILL too long, just hash it down\n+        if len(index_name) > self.connection.features.max_index_name_length:\n+            index_name = hashlib.md5(index_name).hexdigest()[:self.connection.features.max_index_name_length]\n         return index_name\n \n     def _constraint_names(self, model, column_names=None, unique=None, primary_key=None, index=None, foreign_key=None, check=None):"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}