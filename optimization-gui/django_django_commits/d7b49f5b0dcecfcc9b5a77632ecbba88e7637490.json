{
    "author": "akaariai",
    "message": "Fixed #19469 -- Removed opts.get_ordered_objects() and related code\n\nThe code was dead-code since 2006.",
    "sha": "d7b49f5b0dcecfcc9b5a77632ecbba88e7637490",
    "files": [
        {
            "sha": "1827d401591ab00de0e222ca676b44a64b4a3b7c",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=d7b49f5b0dcecfcc9b5a77632ecbba88e7637490",
            "patch": "@@ -408,8 +408,6 @@ def media(self):\n             js.append('actions%s.js' % extra)\n         if self.prepopulated_fields:\n             js.extend(['urlify.js', 'prepopulate%s.js' % extra])\n-        if self.opts.get_ordered_objects():\n-            js.extend(['getElementsBySelector.js', 'dom-drag.js' , 'admin/ordering.js'])\n         return forms.Media(js=[static('admin/js/%s' % url) for url in js])\n \n     def get_model_perms(self, request):\n@@ -764,7 +762,6 @@ def save_related(self, request, form, formsets, change):\n     def render_change_form(self, request, context, add=False, change=False, form_url='', obj=None):\n         opts = self.model._meta\n         app_label = opts.app_label\n-        ordered_objects = opts.get_ordered_objects()\n         context.update({\n             'add': add,\n             'change': change,\n@@ -773,7 +770,6 @@ def render_change_form(self, request, context, add=False, change=False, form_url\n             'has_delete_permission': self.has_delete_permission(request, obj),\n             'has_file_field': True, # FIXME - this should check if form or formsets have a FileField,\n             'has_absolute_url': hasattr(self.model, 'get_absolute_url'),\n-            'ordered_objects': ordered_objects,\n             'form_url': form_url,\n             'opts': opts,\n             'content_type_id': ContentType.objects.get_for_model(self.model).id,"
        },
        {
            "sha": "595be4d62bf0eafddb54b94464c50a7b77064514",
            "filename": "django/contrib/admin/static/admin/js/admin/ordering.js",
            "status": "removed",
            "additions": 0,
            "deletions": 137,
            "changes": 137,
            "blob_url": "https://github.com/django/django/blob/9facca28b619ad94680cf07774ee7a377034ca42/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Fadmin%2Fordering.js",
            "raw_url": "https://github.com/django/django/raw/9facca28b619ad94680cf07774ee7a377034ca42/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Fadmin%2Fordering.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Fadmin%2Fordering.js?ref=9facca28b619ad94680cf07774ee7a377034ca42",
            "patch": "@@ -1,137 +0,0 @@\n-addEvent(window, 'load', reorder_init);\n-\n-var lis;\n-var top = 0;\n-var left = 0;\n-var height = 30;\n-\n-function reorder_init() {\n-    lis = document.getElementsBySelector('ul#orderthese li');\n-    var input = document.getElementsBySelector('input[name=order_]')[0];\n-    setOrder(input.value.split(','));\n-    input.disabled = true;\n-    draw();\n-    // Now initialize the dragging behavior\n-    var limit = (lis.length - 1) * height;\n-    for (var i = 0; i < lis.length; i++) {\n-        var li = lis[i];\n-        var img = document.getElementById('handle'+li.id);\n-        li.style.zIndex = 1;\n-        Drag.init(img, li, left + 10, left + 10, top + 10, top + 10 + limit);\n-        li.onDragStart = startDrag;\n-        li.onDragEnd = endDrag;\n-        img.style.cursor = 'move';\n-    }\n-}\n-\n-function submitOrderForm() {\n-    var inputOrder = document.getElementsBySelector('input[name=order_]')[0];\n-    inputOrder.value = getOrder();\n-    inputOrder.disabled=false;\n-}\n-\n-function startDrag() {\n-    this.style.zIndex = '10';\n-    this.className = 'dragging';\n-}\n-\n-function endDrag(x, y) {\n-    this.style.zIndex = '1';\n-    this.className = '';\n-    // Work out how far along it has been dropped, using x co-ordinate\n-    var oldIndex = this.index;\n-    var newIndex = Math.round((y - 10 - top) / height);\n-    // 'Snap' to the correct position\n-    this.style.top = (10 + top + newIndex * height) + 'px';\n-    this.index = newIndex;\n-    moveItem(oldIndex, newIndex);\n-}\n-\n-function moveItem(oldIndex, newIndex) {\n-    // Swaps two items, adjusts the index and left co-ord for all others\n-    if (oldIndex == newIndex) {\n-        return; // Nothing to swap;\n-    }\n-    var direction, lo, hi;\n-    if (newIndex > oldIndex) {\n-        lo = oldIndex;\n-        hi = newIndex;\n-        direction = -1;\n-    } else {\n-        direction = 1;\n-        hi = oldIndex;\n-        lo = newIndex;\n-    }\n-    var lis2 = new Array(); // We will build the new order in this array\n-    for (var i = 0; i < lis.length; i++) {\n-        if (i < lo || i > hi) {\n-            // Position of items not between the indexes is unaffected\n-            lis2[i] = lis[i];\n-            continue;\n-        } else if (i == newIndex) {\n-            lis2[i] = lis[oldIndex];\n-            continue;\n-        } else {\n-            // Item is between the two indexes - move it along 1\n-            lis2[i] = lis[i - direction];\n-        }\n-    }\n-    // Re-index everything\n-    reIndex(lis2);\n-    lis = lis2;\n-    draw();\n-//    document.getElementById('hiddenOrder').value = getOrder();\n-    document.getElementsBySelector('input[name=order_]')[0].value = getOrder();\n-}\n-\n-function reIndex(lis) {\n-    for (var i = 0; i < lis.length; i++) {\n-        lis[i].index = i;\n-    }\n-}\n-\n-function draw() {\n-    for (var i = 0; i < lis.length; i++) {\n-        var li = lis[i];\n-        li.index = i;\n-        li.style.position = 'absolute';\n-        li.style.left = (10 + left) + 'px';\n-        li.style.top = (10 + top + (i * height)) + 'px';\n-    }\n-}\n-\n-function getOrder() {\n-    var order = new Array(lis.length);\n-    for (var i = 0; i < lis.length; i++) {\n-        order[i] = lis[i].id.substring(1, 100);\n-    }\n-    return order.join(',');\n-}\n-\n-function setOrder(id_list) {\n-    /* Set the current order to match the lsit of IDs */\n-    var temp_lis = new Array();\n-    for (var i = 0; i < id_list.length; i++) {\n-        var id = 'p' + id_list[i];\n-        temp_lis[temp_lis.length] = document.getElementById(id);\n-    }\n-    reIndex(temp_lis);\n-    lis = temp_lis;\n-    draw();\n-}\n-\n-function addEvent(elm, evType, fn, useCapture)\n-// addEvent and removeEvent\n-// cross-browser event handling for IE5+,  NS6 and Mozilla\n-// By Scott Andrew\n-{\n-  if (elm.addEventListener){\n-    elm.addEventListener(evType, fn, useCapture);\n-    return true;\n-  } else if (elm.attachEvent){\n-    var r = elm.attachEvent(\"on\"+evType, fn);\n-    return r;\n-  } else {\n-    elm['on'+evType] = fn;\n-  }\n-}"
        },
        {
            "sha": "15b57a1908013bf30c616f743d5632ade4c3959a",
            "filename": "django/contrib/admin/static/admin/js/getElementsBySelector.js",
            "status": "removed",
            "additions": 0,
            "deletions": 167,
            "changes": 167,
            "blob_url": "https://github.com/django/django/blob/9facca28b619ad94680cf07774ee7a377034ca42/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2FgetElementsBySelector.js",
            "raw_url": "https://github.com/django/django/raw/9facca28b619ad94680cf07774ee7a377034ca42/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2FgetElementsBySelector.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2FgetElementsBySelector.js?ref=9facca28b619ad94680cf07774ee7a377034ca42",
            "patch": "@@ -1,167 +0,0 @@\n-/* document.getElementsBySelector(selector)\n-   - returns an array of element objects from the current document\n-     matching the CSS selector. Selectors can contain element names, \n-     class names and ids and can be nested. For example:\n-     \n-       elements = document.getElementsBySelect('div#main p a.external')\n-     \n-     Will return an array of all 'a' elements with 'external' in their \n-     class attribute that are contained inside 'p' elements that are \n-     contained inside the 'div' element which has id=\"main\"\n-\n-   New in version 0.4: Support for CSS2 and CSS3 attribute selectors:\n-   See http://www.w3.org/TR/css3-selectors/#attribute-selectors\n-\n-   Version 0.4 - Simon Willison, March 25th 2003\n-   -- Works in Phoenix 0.5, Mozilla 1.3, Opera 7, Internet Explorer 6, Internet Explorer 5 on Windows\n-   -- Opera 7 fails \n-*/\n-\n-function getAllChildren(e) {\n-  // Returns all children of element. Workaround required for IE5/Windows. Ugh.\n-  return e.all ? e.all : e.getElementsByTagName('*');\n-}\n-\n-document.getElementsBySelector = function(selector) {\n-  // Attempt to fail gracefully in lesser browsers\n-  if (!document.getElementsByTagName) {\n-    return new Array();\n-  }\n-  // Split selector in to tokens\n-  var tokens = selector.split(' ');\n-  var currentContext = new Array(document);\n-  for (var i = 0; i < tokens.length; i++) {\n-    token = tokens[i].replace(/^\\s+/,'').replace(/\\s+$/,'');;\n-    if (token.indexOf('#') > -1) {\n-      // Token is an ID selector\n-      var bits = token.split('#');\n-      var tagName = bits[0];\n-      var id = bits[1];\n-      var element = document.getElementById(id);\n-      if (!element || (tagName && element.nodeName.toLowerCase() != tagName)) {\n-        // ID not found or tag with that ID not found, return false.\n-        return new Array();\n-      }\n-      // Set currentContext to contain just this element\n-      currentContext = new Array(element);\n-      continue; // Skip to next token\n-    }\n-    if (token.indexOf('.') > -1) {\n-      // Token contains a class selector\n-      var bits = token.split('.');\n-      var tagName = bits[0];\n-      var className = bits[1];\n-      if (!tagName) {\n-        tagName = '*';\n-      }\n-      // Get elements matching tag, filter them for class selector\n-      var found = new Array;\n-      var foundCount = 0;\n-      for (var h = 0; h < currentContext.length; h++) {\n-        var elements;\n-        if (tagName == '*') {\n-            elements = getAllChildren(currentContext[h]);\n-        } else {\n-            try {\n-                elements = currentContext[h].getElementsByTagName(tagName);\n-            }\n-            catch(e) {\n-                elements = [];\n-            }\n-        }\n-        for (var j = 0; j < elements.length; j++) {\n-          found[foundCount++] = elements[j];\n-        }\n-      }\n-      currentContext = new Array;\n-      var currentContextIndex = 0;\n-      for (var k = 0; k < found.length; k++) {\n-        if (found[k].className && found[k].className.match(new RegExp('\\\\b'+className+'\\\\b'))) {\n-          currentContext[currentContextIndex++] = found[k];\n-        }\n-      }\n-      continue; // Skip to next token\n-    }\n-    // Code to deal with attribute selectors\n-    if (token.match(/^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?\"?([^\\]\"]*)\"?\\]$/)) {\n-      var tagName = RegExp.$1;\n-      var attrName = RegExp.$2;\n-      var attrOperator = RegExp.$3;\n-      var attrValue = RegExp.$4;\n-      if (!tagName) {\n-        tagName = '*';\n-      }\n-      // Grab all of the tagName elements within current context\n-      var found = new Array;\n-      var foundCount = 0;\n-      for (var h = 0; h < currentContext.length; h++) {\n-        var elements;\n-        if (tagName == '*') {\n-            elements = getAllChildren(currentContext[h]);\n-        } else {\n-            elements = currentContext[h].getElementsByTagName(tagName);\n-        }\n-        for (var j = 0; j < elements.length; j++) {\n-          found[foundCount++] = elements[j];\n-        }\n-      }\n-      currentContext = new Array;\n-      var currentContextIndex = 0;\n-      var checkFunction; // This function will be used to filter the elements\n-      switch (attrOperator) {\n-        case '=': // Equality\n-          checkFunction = function(e) { return (e.getAttribute(attrName) == attrValue); };\n-          break;\n-        case '~': // Match one of space seperated words \n-          checkFunction = function(e) { return (e.getAttribute(attrName).match(new RegExp('\\\\b'+attrValue+'\\\\b'))); };\n-          break;\n-        case '|': // Match start with value followed by optional hyphen\n-          checkFunction = function(e) { return (e.getAttribute(attrName).match(new RegExp('^'+attrValue+'-?'))); };\n-          break;\n-        case '^': // Match starts with value\n-          checkFunction = function(e) { return (e.getAttribute(attrName).indexOf(attrValue) == 0); };\n-          break;\n-        case '$': // Match ends with value - fails with \"Warning\" in Opera 7\n-          checkFunction = function(e) { return (e.getAttribute(attrName).lastIndexOf(attrValue) == e.getAttribute(attrName).length - attrValue.length); };\n-          break;\n-        case '*': // Match ends with value\n-          checkFunction = function(e) { return (e.getAttribute(attrName).indexOf(attrValue) > -1); };\n-          break;\n-        default :\n-          // Just test for existence of attribute\n-          checkFunction = function(e) { return e.getAttribute(attrName); };\n-      }\n-      currentContext = new Array;\n-      var currentContextIndex = 0;\n-      for (var k = 0; k < found.length; k++) {\n-        if (checkFunction(found[k])) {\n-          currentContext[currentContextIndex++] = found[k];\n-        }\n-      }\n-      // alert('Attribute Selector: '+tagName+' '+attrName+' '+attrOperator+' '+attrValue);\n-      continue; // Skip to next token\n-    }\n-    // If we get here, token is JUST an element (not a class or ID selector)\n-    tagName = token;\n-    var found = new Array;\n-    var foundCount = 0;\n-    for (var h = 0; h < currentContext.length; h++) {\n-      var elements = currentContext[h].getElementsByTagName(tagName);\n-      for (var j = 0; j < elements.length; j++) {\n-        found[foundCount++] = elements[j];\n-      }\n-    }\n-    currentContext = found;\n-  }\n-  return currentContext;\n-}\n-\n-/* That revolting regular expression explained \n-/^(\\w+)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?\"?([^\\]\"]*)\"?\\]$/\n-  \\---/  \\---/\\-------------/    \\-------/\n-    |      |         |               |\n-    |      |         |           The value\n-    |      |    ~,|,^,$,* or =\n-    |   Attribute \n-   Tag\n-*/"
        },
        {
            "sha": "48846960b334acd4d3afdd9faf5c3e4a4b011668",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=d7b49f5b0dcecfcc9b5a77632ecbba88e7637490",
            "patch": "@@ -9,7 +9,7 @@\n \n {% block extrastyle %}{{ block.super }}<link rel=\"stylesheet\" type=\"text/css\" href=\"{% static \"admin/css/forms.css\" %}\" />{% endblock %}\n \n-{% block coltype %}{% if ordered_objects %}colMS{% else %}colM{% endif %}{% endblock %}\n+{% block coltype %}colM{% endblock %}\n \n {% block bodyclass %}{{ opts.app_label }}-{{ opts.object_name.lower }} change-form{% endblock %}\n "
        },
        {
            "sha": "38a97a1c6abb628533b24e6eeeefde22b2cc2315",
            "filename": "django/contrib/admin/templates/admin/submit_line.html",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html",
            "raw_url": "https://github.com/django/django/raw/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html?ref=d7b49f5b0dcecfcc9b5a77632ecbba88e7637490",
            "patch": "@@ -1,8 +1,8 @@\n {% load i18n admin_urls %}\n <div class=\"submit-row\">\n-{% if show_save %}<input type=\"submit\" value=\"{% trans 'Save' %}\" class=\"default\" name=\"_save\" {{ onclick_attrib }}/>{% endif %}\n+{% if show_save %}<input type=\"submit\" value=\"{% trans 'Save' %}\" class=\"default\" name=\"_save\" />{% endif %}\n {% if show_delete_link %}<p class=\"deletelink-box\"><a href=\"{% url opts|admin_urlname:'delete' original.pk|admin_urlquote %}\" class=\"deletelink\">{% trans \"Delete\" %}</a></p>{% endif %}\n-{% if show_save_as_new %}<input type=\"submit\" value=\"{% trans 'Save as new' %}\" name=\"_saveasnew\" {{ onclick_attrib }}/>{%endif%}\n-{% if show_save_and_add_another %}<input type=\"submit\" value=\"{% trans 'Save and add another' %}\" name=\"_addanother\" {{ onclick_attrib }}/>{% endif %}\n-{% if show_save_and_continue %}<input type=\"submit\" value=\"{% trans 'Save and continue editing' %}\" name=\"_continue\" {{ onclick_attrib }}/>{% endif %}\n+{% if show_save_as_new %}<input type=\"submit\" value=\"{% trans 'Save as new' %}\" name=\"_saveasnew\" />{%endif%}\n+{% if show_save_and_add_another %}<input type=\"submit\" value=\"{% trans 'Save and add another' %}\" name=\"_addanother\" />{% endif %}\n+{% if show_save_and_continue %}<input type=\"submit\" value=\"{% trans 'Save and continue editing' %}\" name=\"_continue\" />{% endif %}\n </div>"
        },
        {
            "sha": "cecc6ed6c4ebb299e0697ba46aa6fd64e346f6ba",
            "filename": "django/contrib/admin/templatetags/admin_modify.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "raw_url": "https://github.com/django/django/raw/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py?ref=d7b49f5b0dcecfcc9b5a77632ecbba88e7637490",
            "patch": "@@ -30,8 +30,6 @@ def submit_row(context):\n     save_as = context['save_as']\n     ctx = {\n         'opts': opts,\n-        'onclick_attrib': (opts.get_ordered_objects() and change\n-                            and 'onclick=\"submitOrderForm();\"' or ''),\n         'show_delete_link': (not is_popup and context['has_delete_permission']\n                               and change and context.get('show_delete', True)),\n         'show_save_as_new': not is_popup and change and save_as,"
        },
        {
            "sha": "f74d9ffff8b4e5eccf6a8251359618799ad4acaf",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/d7b49f5b0dcecfcc9b5a77632ecbba88e7637490/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=d7b49f5b0dcecfcc9b5a77632ecbba88e7637490",
            "patch": "@@ -507,16 +507,3 @@ def get_ancestor_link(self, ancestor):\n                 # of the chain to the ancestor is that parent\n                 # links\n                 return self.parents[parent] or parent_link\n-\n-    def get_ordered_objects(self):\n-        \"Returns a list of Options objects that are ordered with respect to this object.\"\n-        if not hasattr(self, '_ordered_objects'):\n-            objects = []\n-            # TODO\n-            #for klass in get_models(get_app(self.app_label)):\n-            #    opts = klass._meta\n-            #    if opts.order_with_respect_to and opts.order_with_respect_to.rel \\\n-            #        and self == opts.order_with_respect_to.rel.to._meta:\n-            #        objects.append(opts)\n-            self._ordered_objects = objects\n-        return self._ordered_objects"
        }
    ],
    "stats": {
        "total": 333,
        "additions": 5,
        "deletions": 328
    }
}