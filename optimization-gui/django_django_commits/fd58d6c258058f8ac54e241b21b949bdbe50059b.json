{
    "author": "claudep",
    "message": "Merge walk and find_files in makemessages command",
    "sha": "fd58d6c258058f8ac54e241b21b949bdbe50059b",
    "files": [
        {
            "sha": "81c4fdf8cc9e2911f4e3e25713090b64e2b4418f",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 16,
            "deletions": 37,
            "changes": 53,
            "blob_url": "https://github.com/django/django/blob/fd58d6c258058f8ac54e241b21b949bdbe50059b/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/fd58d6c258058f8ac54e241b21b949bdbe50059b/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=fd58d6c258058f8ac54e241b21b949bdbe50059b",
            "patch": "@@ -47,31 +47,27 @@ def _popen(cmd):\n     output, errors = p.communicate()\n     return output, errors, p.returncode\n \n-def walk(root, topdown=True, onerror=None, followlinks=False,\n-         ignore_patterns=None, verbosity=0, stdout=sys.stdout):\n+def find_files(root, ignore_patterns, verbosity, stdout=sys.stdout, symlinks=False):\n     \"\"\"\n-    A version of os.walk that can follow symlinks for Python < 2.6\n+    Helper function to get all files in the given root.\n     \"\"\"\n-    if ignore_patterns is None:\n-        ignore_patterns = []\n     dir_suffix = '%s*' % os.sep\n     norm_patterns = [p[:-len(dir_suffix)] if p.endswith(dir_suffix) else p for p in ignore_patterns]\n-    for dirpath, dirnames, filenames in os.walk(root, topdown, onerror):\n-        remove_dirs = []\n-        for dirname in dirnames:\n+    all_files = []\n+    for dirpath, dirnames, filenames in os.walk(root, topdown=True, followlinks=symlinks):\n+        for dirname in dirnames[:]:\n             if is_ignored(os.path.normpath(os.path.join(dirpath, dirname)), norm_patterns):\n-                remove_dirs.append(dirname)\n-        for dirname in remove_dirs:\n-            dirnames.remove(dirname)\n-            if verbosity > 1:\n-                stdout.write('ignoring directory %s\\n' % dirname)\n-        yield (dirpath, dirnames, filenames)\n-        if followlinks:\n-            for d in dirnames:\n-                p = os.path.join(dirpath, d)\n-                if os.path.islink(p):\n-                    for link_dirpath, link_dirnames, link_filenames in walk(p):\n-                        yield (link_dirpath, link_dirnames, link_filenames)\n+                dirnames.remove(dirname)\n+                if verbosity > 1:\n+                    stdout.write('ignoring directory %s\\n' % dirname)\n+        for filename in filenames:\n+            if is_ignored(os.path.normpath(os.path.join(dirpath, filename)), ignore_patterns):\n+                if verbosity > 1:\n+                    stdout.write('ignoring file %s in %s\\n' % (filename, dirpath))\n+            else:\n+                all_files.extend([(dirpath, filename)])\n+    all_files.sort()\n+    return all_files\n \n def is_ignored(path, ignore_patterns):\n     \"\"\"\n@@ -82,23 +78,6 @@ def is_ignored(path, ignore_patterns):\n             return True\n     return False\n \n-def find_files(root, ignore_patterns, verbosity, stdout=sys.stdout, symlinks=False):\n-    \"\"\"\n-    Helper function to get all files in the given root.\n-    \"\"\"\n-    all_files = []\n-    for (dirpath, dirnames, filenames) in walk(root, followlinks=symlinks,\n-            ignore_patterns=ignore_patterns, verbosity=verbosity, stdout=stdout):\n-        for filename in filenames:\n-            norm_filepath = os.path.normpath(os.path.join(dirpath, filename))\n-            if is_ignored(norm_filepath, ignore_patterns):\n-                if verbosity > 1:\n-                    stdout.write('ignoring file %s in %s\\n' % (filename, dirpath))\n-            else:\n-                all_files.extend([(dirpath, filename)])\n-    all_files.sort()\n-    return all_files\n-\n def copy_plural_forms(msgs, locale, domain, verbosity, stdout=sys.stdout):\n     \"\"\"\n     Copies plural forms header contents from a Django catalog of locale to"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 16,
        "deletions": 37
    }
}