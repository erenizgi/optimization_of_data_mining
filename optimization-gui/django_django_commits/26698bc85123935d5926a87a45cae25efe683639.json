{
    "author": "jphalip",
    "message": "Fixed #14806 -- Added support for contextual translations to the `trans` and `blocktrans` template tags. Thanks to jtiai for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17015 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "26698bc85123935d5926a87a45cae25efe683639",
    "files": [
        {
            "sha": "0fafb2d1824c27d08059212a3015139286b67c95",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -12,7 +12,7 @@\n from django.utils.text import (smart_split, unescape_string_literal,\n     get_text_list)\n from django.utils.encoding import smart_unicode, force_unicode, smart_str\n-from django.utils.translation import ugettext_lazy\n+from django.utils.translation import ugettext_lazy, pgettext_lazy\n from django.utils.safestring import (SafeData, EscapeData, mark_safe,\n     mark_for_escaping)\n from django.utils.formats import localize\n@@ -675,6 +675,7 @@ def __init__(self, var):\n         self.literal = None\n         self.lookups = None\n         self.translate = False\n+        self.message_context = None\n \n         try:\n             # First try to treat this variable as a number.\n@@ -722,7 +723,10 @@ def resolve(self, context):\n             # We're dealing with a literal, so it's already been \"resolved\"\n             value = self.literal\n         if self.translate:\n-            return ugettext_lazy(value)\n+            if self.message_context:\n+                return pgettext_lazy(self.message_context, value)\n+            else:\n+                return ugettext_lazy(value)\n         return value\n \n     def __repr__(self):"
        },
        {
            "sha": "dc3d93e90f23ccf12aff0bb8347500a8b17a8a39",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 65,
            "deletions": 12,
            "changes": 77,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -70,15 +70,21 @@ def render(self, context):\n \n \n class TranslateNode(Node):\n-    def __init__(self, filter_expression, noop, asvar=None):\n+    def __init__(self, filter_expression, noop, asvar=None,\n+                 message_context=None):\n         self.noop = noop\n         self.asvar = asvar\n+        self.message_context = message_context\n         self.filter_expression = filter_expression\n         if isinstance(self.filter_expression.var, basestring):\n-            self.filter_expression.var = Variable(u\"'%s'\" % self.filter_expression.var)\n+            self.filter_expression.var = Variable(u\"'%s'\" %\n+                                                  self.filter_expression.var)\n \n     def render(self, context):\n         self.filter_expression.var.translate = not self.noop\n+        if self.message_context:\n+            self.filter_expression.var.message_context = (\n+                self.message_context.resolve(context))\n         output = self.filter_expression.resolve(context)\n         value = _render_value_in_context(output, context)\n         if self.asvar:\n@@ -90,12 +96,13 @@ def render(self, context):\n \n class BlockTranslateNode(Node):\n     def __init__(self, extra_context, singular, plural=None, countervar=None,\n-            counter=None):\n+            counter=None, message_context=None):\n         self.extra_context = extra_context\n         self.singular = singular\n         self.plural = plural\n         self.countervar = countervar\n         self.counter = counter\n+        self.message_context = message_context\n \n     def render_token_list(self, tokens):\n         result = []\n@@ -109,6 +116,10 @@ def render_token_list(self, tokens):\n         return ''.join(result), vars\n \n     def render(self, context):\n+        if self.message_context:\n+            message_context = self.message_context.resolve(context)\n+        else:\n+            message_context = None\n         tmp_context = {}\n         for var, val in self.extra_context.items():\n             tmp_context[var] = val.resolve(context)\n@@ -123,10 +134,17 @@ def render(self, context):\n             context[self.countervar] = count\n             plural, plural_vars = self.render_token_list(self.plural)\n             plural = re.sub(u'%(?!\\()', u'%%', plural)\n-            result = translation.ungettext(singular, plural, count)\n+            if message_context:\n+                result = translation.npgettext(message_context, singular,\n+                                               plural, count)\n+            else:\n+                result = translation.ungettext(singular, plural, count)\n             vars.extend(plural_vars)\n         else:\n-            result = translation.ugettext(singular)\n+            if message_context:\n+                result = translation.pgettext(message_context, singular)\n+            else:\n+                result = translation.ugettext(singular)\n         data = dict([(v, _render_value_in_context(context.get(v, ''), context)) for v in vars])\n         context.pop()\n         try:\n@@ -290,6 +308,17 @@ def do_translate(parser, token):\n     This will just try to translate the contents of\n     the variable ``variable``. Make sure that the string\n     in there is something that is in the .po file.\n+\n+    It is possible to store the translated string into a variable::\n+\n+        {% trans \"this is a test\" as var %}\n+        {{ var }}\n+\n+    Contextual translations are also supported::\n+\n+        {% trans \"this is a test\" context \"greeting\" %}\n+\n+    This is equivalent to calling pgettext instead of (u)gettext.\n     \"\"\"\n     class TranslateParser(TokenParser):\n         def top(self):\n@@ -301,7 +330,6 @@ def top(self):\n             # backwards compatibility with existing uses of ``trans``\n             # where single quote use is supported.\n             if value[0] == \"'\":\n-                pos = None\n                 m = re.match(\"^'([^']+)'(\\|.*$)\", value)\n                 if m:\n                     value = '\"%s\"%s' % (m.group(1).replace('\"','\\\\\"'), m.group(2))\n@@ -310,19 +338,24 @@ def top(self):\n \n             noop = False\n             asvar = None\n+            message_context = None\n \n             while self.more():\n                 tag = self.tag()\n                 if tag == 'noop':\n                     noop = True\n+                elif tag == 'context':\n+                    message_context = parser.compile_filter(self.value())\n                 elif tag == 'as':\n                     asvar = self.tag()\n                 else:\n                     raise TemplateSyntaxError(\n-                        \"only options for 'trans' are 'noop' and 'as VAR.\")\n-            return (value, noop, asvar)\n-    value, noop, asvar = TranslateParser(token.contents).top()\n-    return TranslateNode(parser.compile_filter(value), noop, asvar)\n+                        \"Only options for 'trans' are 'noop', \" \\\n+                        \"'context \\\"xxx\\\"', and 'as VAR'.\")\n+            return value, noop, asvar, message_context\n+    value, noop, asvar, message_context = TranslateParser(token.contents).top()\n+    return TranslateNode(parser.compile_filter(value), noop, asvar,\n+                         message_context)\n \n @register.tag(\"blocktrans\")\n def do_block_translate(parser, token):\n@@ -349,6 +382,15 @@ def do_block_translate(parser, token):\n \n         {% blocktrans with foo|filter as bar and baz|filter as boo %}\n         {% blocktrans count var|length as count %}\n+\n+    Contextual translations are supported::\n+\n+        {% blocktrans with bar=foo|filter context \"greeting\" %}\n+            This is {{ bar }}.\n+        {% endblocktrans %}\n+\n+    This is equivalent to calling pgettext/npgettext instead of\n+    (u)gettext/(u)ngettext.\n     \"\"\"\n     bits = token.split_contents()\n \n@@ -369,6 +411,13 @@ def do_block_translate(parser, token):\n             if len(value) != 1:\n                 raise TemplateSyntaxError('\"count\" in %r tag expected exactly '\n                                           'one keyword argument.' % bits[0])\n+        elif option == \"context\":\n+            try:\n+                value = remaining_bits.pop(0)\n+                value = parser.compile_filter(value)\n+            except Exception:\n+                raise TemplateSyntaxError('\"context\" in %r tag expected '\n+                                          'exactly one argument.' % bits[0])\n         else:\n             raise TemplateSyntaxError('Unknown argument for %r tag: %r.' %\n                                       (bits[0], option))\n@@ -378,7 +427,11 @@ def do_block_translate(parser, token):\n         countervar, counter = options['count'].items()[0]\n     else:\n         countervar, counter = None, None\n-    extra_context = options.get('with', {}) \n+    if 'context' in options:\n+        message_context = options['context']\n+    else:\n+        message_context = None\n+    extra_context = options.get('with', {})\n \n     singular = []\n     plural = []\n@@ -401,7 +454,7 @@ def do_block_translate(parser, token):\n         raise TemplateSyntaxError(\"'blocktrans' doesn't allow other block tags (seen %r) inside it\" % token.contents)\n \n     return BlockTranslateNode(extra_context, singular, plural, countervar,\n-            counter)\n+            counter, message_context)\n \n @register.tag\n def language(parser, token):"
        },
        {
            "sha": "f43cfd9705a8f8e6cc5ba9a17ea181f75a659ffb",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 38,
            "deletions": 7,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -433,12 +433,14 @@ def blankout(src, char):\n     \"\"\"\n     return dot_re.sub(char, src)\n \n-inline_re = re.compile(r\"\"\"^\\s*trans\\s+((?:\".*?\")|(?:'.*?'))\\s*\"\"\")\n-block_re = re.compile(r\"\"\"^\\s*blocktrans(?:\\s+|$)\"\"\")\n+context_re = re.compile(r\"\"\"^\\s+.*context\\s+((?:\"[^\"]*?\")|(?:'[^']*?'))\\s*\"\"\")\n+inline_re = re.compile(r\"\"\"^\\s*trans\\s+((?:\"[^\"]*?\")|(?:'[^']*?'))(\\s+.*context\\s+(?:\"[^\"]*?\")|(?:'[^']*?'))?\\s*\"\"\")\n+block_re = re.compile(r\"\"\"^\\s*blocktrans(\\s+.*context\\s+(?:\"[^\"]*?\")|(?:'[^']*?'))?(?:\\s+|$)\"\"\")\n endblock_re = re.compile(r\"\"\"^\\s*endblocktrans$\"\"\")\n plural_re = re.compile(r\"\"\"^\\s*plural$\"\"\")\n constant_re = re.compile(r\"\"\"_\\(((?:\".*?\")|(?:'.*?'))\\)\"\"\")\n \n+\n def templatize(src, origin=None):\n     \"\"\"\n     Turns a Django template into something that is understood by xgettext. It\n@@ -448,6 +450,7 @@ def templatize(src, origin=None):\n     from django.template import (Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK,\n             TOKEN_COMMENT, TRANSLATOR_COMMENT_MARK)\n     out = StringIO()\n+    message_context = None\n     intrans = False\n     inplural = False\n     singular = []\n@@ -477,15 +480,22 @@ def templatize(src, origin=None):\n                 pluralmatch = plural_re.match(t.contents)\n                 if endbmatch:\n                     if inplural:\n-                        out.write(' ngettext(%r,%r,count) ' % (''.join(singular), ''.join(plural)))\n+                        if message_context:\n+                            out.write(' npgettext(%r, %r, %r,count) ' % (message_context, ''.join(singular), ''.join(plural)))\n+                        else:\n+                            out.write(' ngettext(%r, %r, count) ' % (''.join(singular), ''.join(plural)))\n                         for part in singular:\n                             out.write(blankout(part, 'S'))\n                         for part in plural:\n                             out.write(blankout(part, 'P'))\n                     else:\n-                        out.write(' gettext(%r) ' % ''.join(singular))\n+                        if message_context:\n+                            out.write(' pgettext(%r, %r) ' % (message_context, ''.join(singular)))\n+                        else:\n+                            out.write(' gettext(%r) ' % ''.join(singular))\n                         for part in singular:\n                             out.write(blankout(part, 'S'))\n+                    message_context = None\n                     intrans = False\n                     inplural = False\n                     singular = []\n@@ -515,12 +525,33 @@ def templatize(src, origin=None):\n                 cmatches = constant_re.findall(t.contents)\n                 if imatch:\n                     g = imatch.group(1)\n-                    if g[0] == '\"': g = g.strip('\"')\n-                    elif g[0] == \"'\": g = g.strip(\"'\")\n-                    out.write(' gettext(%r) ' % g)\n+                    if g[0] == '\"':\n+                        g = g.strip('\"')\n+                    elif g[0] == \"'\":\n+                        g = g.strip(\"'\")\n+                    if imatch.group(2):\n+                        # A context is provided\n+                        context_match = context_re.match(imatch.group(2))\n+                        message_context = context_match.group(1)\n+                        if message_context[0] == '\"':\n+                            message_context = message_context.strip('\"')\n+                        elif message_context[0] == \"'\":\n+                            message_context = message_context.strip(\"'\")\n+                        out.write(' pgettext(%r, %r) ' % (message_context, g))\n+                        message_context = None\n+                    else:\n+                        out.write(' gettext(%r) ' % g)\n                 elif bmatch:\n                     for fmatch in constant_re.findall(t.contents):\n                         out.write(' _(%s) ' % fmatch)\n+                    if bmatch.group(1):\n+                        # A context is provided\n+                        context_match = context_re.match(bmatch.group(1))\n+                        message_context = context_match.group(1)\n+                        if message_context[0] == '\"':\n+                            message_context = message_context.strip('\"')\n+                        elif message_context[0] == \"'\":\n+                            message_context = message_context.strip(\"'\")\n                     intrans = True\n                     inplural = False\n                     singular = []"
        },
        {
            "sha": "00acc65922f74b7c457137fd072c801d90a8d980",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -191,6 +191,14 @@ Additionally, it's now possible to define translatable URL patterns using\n :ref:`url-internationalization` for more information about the language prefix\n and how to internationalize URL patterns.\n \n+Contextual translation support for ``{% trans %}`` and ``{% blocktrans %}``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django 1.3 introduced :ref:`contextual translation<contextual-markers>` support\n+in Python files via the ``pgettext`` function. This is now also supported by\n+the :ttag:`trans` and :ttag:`blocktrans` template tags using the new\n+``context`` keyword.\n+\n Customizable ``SingleObjectMixin`` URLConf kwargs\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "c8611acff8e20e2cf48f37a8a5ab07779ab1c081",
            "filename": "docs/topics/i18n/internationalization.txt",
            "status": "modified",
            "additions": 24,
            "deletions": 1,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Finternationalization.txt?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -266,6 +266,11 @@ will appear in the .po file as:\n     msgid \"May\"\n     msgstr \"\"\n \n+.. versionadded:: 1.4\n+\n+Contextual markers are also supported by the :ttag:`trans` and\n+:ttag:`blocktrans` template tags.\n+\n .. _lazy-translations:\n \n Lazy translation\n@@ -453,7 +458,7 @@ It's not possible to mix a template variable inside a string within ``{% trans\n %}``. If your translations require strings with variables (placeholders), use\n ``{% blocktrans %}`` instead.\n \n-.. versionchanged:: 1.4\n+.. versionadded:: 1.4\n \n If you'd like to retrieve a translated string without displaying it, you can\n use the following syntax::\n@@ -479,6 +484,15 @@ or should be used as arguments for other template tags or filters::\n     {% endfor %}\n     </p>\n \n+.. versionadded:: 1.4\n+\n+``{% trans %}`` also supports :ref:`contextual markers<contextual-markers>`\n+using the ``context`` keyword:\n+\n+.. code-block:: html+django\n+\n+    {% trans \"May\" context \"month name\" %}\n+\n .. templatetag:: blocktrans\n \n ``blocktrans`` template tag\n@@ -560,6 +574,15 @@ be retrieved (and stored) beforehand::\n     This is a URL: {{ the_url }}\n     {% endblocktrans %}\n \n+.. versionadded:: 1.4\n+\n+``{% blocktrans %}`` also supports :ref:`contextual\n+markers<contextual-markers>` using the ``context`` keyword:\n+\n+.. code-block:: html+django\n+\n+    {% blocktrans with name=user.username context \"greeting\" %}Hi {{ name }}{% endblocktrans %}\n+\n .. _template-translation-vars:\n \n Other tags"
        },
        {
            "sha": "c49577221e54cd33aec7cbf5bfce99bb75ba0bd2",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -94,6 +94,35 @@ def test_extraction_error(self):\n             os.remove('./templates/template_with_error.html')\n             os.remove('./templates/template_with_error.html.py') # Waiting for #8536 to be fixed\n \n+    def test_template_message_context_extractor(self):\n+        \"\"\"\n+        Ensure that message contexts are correctly extracted for the\n+        {% trans %} and {% blocktrans %} template tags.\n+        Refs #14806.\n+        \"\"\"\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0)\n+        self.assertTrue(os.path.exists(self.PO_FILE))\n+        po_contents = open(self.PO_FILE, 'r').read()\n+        # {% trans %}\n+        self.assertTrue('msgctxt \"Special trans context #1\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #7a\" in po_contents)\n+        self.assertTrue('msgctxt \"Special trans context #2\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #7b\" in po_contents)\n+        self.assertTrue('msgctxt \"Special trans context #3\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #7c\" in po_contents)\n+\n+        # {% blocktrans %}\n+        self.assertTrue('msgctxt \"Special blocktrans context #1\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #8a\" in po_contents)\n+        self.assertTrue('msgctxt \"Special blocktrans context #2\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #8b-singular\" in po_contents)\n+        self.assertTrue(\"Translatable literal #8b-plural\" in po_contents)\n+        self.assertTrue('msgctxt \"Special blocktrans context #3\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #8c-singular\" in po_contents)\n+        self.assertTrue(\"Translatable literal #8c-plural\" in po_contents)\n+        self.assertTrue('msgctxt \"Special blocktrans context #4\"' in po_contents)\n+        self.assertTrue(\"Translatable literal #8d\" in po_contents)\n \n class JavascriptExtractorTests(ExtractorTests):\n "
        },
        {
            "sha": "24fc7086210aa83295281538548ece16b0dfe6e4",
            "filename": "tests/regressiontests/i18n/commands/templates/test.html",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -57,3 +57,12 @@\n {% comment %}  Translators: Two-line translator comment #5 -- with non ASCII characters: áéíóúö\n continued here.{% endcomment %}\n {% trans \"Translatable literal #6b\" %}\n+\n+{% trans \"Translatable literal #7a\" context \"Special trans context #1\" %}\n+{% trans \"Translatable literal #7b\" as var context \"Special trans context #2\" %}\n+{% trans \"Translatable literal #7c\" context \"Special trans context #3\" as var %}\n+\n+{% blocktrans context \"Special blocktrans context #1\" %}Translatable literal #8a{% endblocktrans %}\n+{% blocktrans count 2 context \"Special blocktrans context #2\" %}Translatable literal #8b-singular{% plural %}Translatable literal #8b-plural{% endblocktrans %}\n+{% blocktrans context \"Special blocktrans context #3\" count 2 %}Translatable literal #8c-singular{% plural %}Translatable literal #8c-plural{% endblocktrans %}\n+{% blocktrans with a=1 context \"Special blocktrans context #4\" %}Translatable literal #8d {{ a }}{% endblocktrans %}\n\\ No newline at end of file"
        },
        {
            "sha": "f825e3918b7fd74b7af37e55e704b260101367b7",
            "filename": "tests/regressiontests/i18n/other/locale/de/LC_MESSAGES/django.mo",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo?ref=26698bc85123935d5926a87a45cae25efe683639"
        },
        {
            "sha": "a471d3814b185141d98488c7862df5ef6eeb2bbe",
            "filename": "tests/regressiontests/i18n/other/locale/de/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -52,3 +52,27 @@ msgid \"%(percent)s%% represents %(num)s object\"\n msgid_plural \"%(percent)s%% represents %(num)s objects\"\n msgstr[0] \"%(percent)s%% stellt %(num)s Objekt dar\"\n msgstr[1] \"%(percent)s%% stellt %(num)s Objekte dar\"\n+\n+#: models.py:17\n+msgctxt \"super search\"\n+msgid \"%(number)s super result\"\n+msgid_plural \"%(number)s super results\"\n+msgstr[0] \"%(number)s Super-Ergebnis\"\n+msgstr[1] \"%(number)s Super-Ergebnisse\"\n+\n+#: models.py:19\n+msgctxt \"other super search\"\n+msgid \"%(number)s super result\"\n+msgid_plural \"%(number)s super results\"\n+msgstr[0] \"%(number)s anderen Super-Ergebnis\"\n+msgstr[1] \"%(number)s andere Super-Ergebnisse\"\n+\n+#: models.py:21\n+msgctxt \"comment count\"\n+msgid \"There are %(num_comments)s comments\"\n+msgstr \"Es gibt %(num_comments)s Kommentare\"\n+\n+#: models.py:23\n+msgctxt \"other comment count\"\n+msgid \"There are %(num_comments)s comments\"\n+msgstr \"Andere: Es gibt %(num_comments)s Kommentare\"\n\\ No newline at end of file"
        },
        {
            "sha": "bfed0ec882d6d47f778857f745c37abec493c9ef",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 121,
            "deletions": 0,
            "changes": 121,
            "blob_url": "https://github.com/django/django/blob/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/26698bc85123935d5926a87a45cae25efe683639/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=26698bc85123935d5926a87a45cae25efe683639",
            "patch": "@@ -9,6 +9,7 @@\n \n from django.conf import settings\n from django.template import Template, Context\n+from django.template.base import TemplateSyntaxError\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n from django.utils import translation\n@@ -96,6 +97,126 @@ def test_pgettext(self):\n                 self.assertEqual(pgettext(\"verb\", \"May\"), u\"Kann\")\n                 self.assertEqual(npgettext(\"search\", \"%d result\", \"%d results\", 4) % 4, u\"4 Resultate\")\n \n+    def test_template_tags_pgettext(self):\n+        \"\"\"\n+        Ensure that message contexts are taken into account the {% trans %} and\n+        {% blocktrans %} template tags.\n+        Refs #14806.\n+        \"\"\"\n+        # Reset translation catalog to include other/locale/de\n+        extended_locale_paths = settings.LOCALE_PATHS + (\n+            os.path.join(here, 'other', 'locale'),\n+        )\n+        with self.settings(LOCALE_PATHS=extended_locale_paths):\n+            from django.utils.translation import trans_real\n+            trans_real._active = local()\n+            trans_real._translations = {}\n+            with translation.override('de'):\n+\n+                # {% trans %} -----------------------------------\n+\n+                # Inexisting context...\n+                t = Template('{% load i18n %}{% trans \"May\" context \"unexisting\" %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'May')\n+\n+                # Existing context...\n+                # Using a literal\n+                t = Template('{% load i18n %}{% trans \"May\" context \"month name\" %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Mai')\n+                t = Template('{% load i18n %}{% trans \"May\" context \"verb\" %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Kann')\n+\n+                # Using a variable\n+                t = Template('{% load i18n %}{% trans \"May\" context message_context %}')\n+                rendered = t.render(Context({'message_context': 'month name'}))\n+                self.assertEqual(rendered, 'Mai')\n+                t = Template('{% load i18n %}{% trans \"May\" context message_context %}')\n+                rendered = t.render(Context({'message_context': 'verb'}))\n+                self.assertEqual(rendered, 'Kann')\n+\n+                # Using a filter\n+                t = Template('{% load i18n %}{% trans \"May\" context message_context|lower %}')\n+                rendered = t.render(Context({'message_context': 'MONTH NAME'}))\n+                self.assertEqual(rendered, 'Mai')\n+                t = Template('{% load i18n %}{% trans \"May\" context message_context|lower %}')\n+                rendered = t.render(Context({'message_context': 'VERB'}))\n+                self.assertEqual(rendered, 'Kann')\n+\n+                # Using 'as'\n+                t = Template('{% load i18n %}{% trans \"May\" context \"month name\" as var %}Value: {{ var }}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Value: Mai')\n+                t = Template('{% load i18n %}{% trans \"May\" as var context \"verb\" %}Value: {{ var }}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Value: Kann')\n+\n+                # Mis-uses\n+                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% trans \"May\" context as var %}{{ var }}')\n+                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% trans \"May\" as var context %}{{ var }}')\n+\n+                # {% blocktrans %} ------------------------------\n+\n+                # Inexisting context...\n+                t = Template('{% load i18n %}{% blocktrans context \"unexisting\" %}May{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'May')\n+\n+                # Existing context...\n+                # Using a literal\n+                t = Template('{% load i18n %}{% blocktrans context \"month name\" %}May{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Mai')\n+                t = Template('{% load i18n %}{% blocktrans context \"verb\" %}May{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Kann')\n+\n+                # Using a variable\n+                t = Template('{% load i18n %}{% blocktrans context message_context %}May{% endblocktrans %}')\n+                rendered = t.render(Context({'message_context': 'month name'}))\n+                self.assertEqual(rendered, 'Mai')\n+                t = Template('{% load i18n %}{% blocktrans context message_context %}May{% endblocktrans %}')\n+                rendered = t.render(Context({'message_context': 'verb'}))\n+                self.assertEqual(rendered, 'Kann')\n+\n+                # Using a filter\n+                t = Template('{% load i18n %}{% blocktrans context message_context|lower %}May{% endblocktrans %}')\n+                rendered = t.render(Context({'message_context': 'MONTH NAME'}))\n+                self.assertEqual(rendered, 'Mai')\n+                t = Template('{% load i18n %}{% blocktrans context message_context|lower %}May{% endblocktrans %}')\n+                rendered = t.render(Context({'message_context': 'VERB'}))\n+                self.assertEqual(rendered, 'Kann')\n+\n+                # Using 'count'\n+                t = Template('{% load i18n %}{% blocktrans count number=1 context \"super search\" %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, '1 Super-Ergebnis')\n+                t = Template('{% load i18n %}{% blocktrans count number=2 context \"super search\" %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, '2 Super-Ergebnisse')\n+                t = Template('{% load i18n %}{% blocktrans context \"other super search\" count number=1 %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, '1 anderen Super-Ergebnis')\n+                t = Template('{% load i18n %}{% blocktrans context \"other super search\" count number=2 %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, '2 andere Super-Ergebnisse')\n+\n+                # Using 'with'\n+                t = Template('{% load i18n %}{% blocktrans with num_comments=5 context \"comment count\" %}There are {{ num_comments }} comments{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Es gibt 5 Kommentare')\n+                t = Template('{% load i18n %}{% blocktrans with num_comments=5 context \"other comment count\" %}There are {{ num_comments }} comments{% endblocktrans %}')\n+                rendered = t.render(Context())\n+                self.assertEqual(rendered, 'Andere: Es gibt 5 Kommentare')\n+\n+                # Mis-uses\n+                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans context with month=\"May\" %}{{ month }}{% endblocktrans %}')\n+                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans context %}{% endblocktrans %}')\n+                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans count number=2 context %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+\n+\n     def test_string_concat(self):\n         \"\"\"\n         unicode(string_concat(...)) should not raise a TypeError - #4796"
        }
    ],
    "stats": {
        "total": 346,
        "additions": 324,
        "deletions": 22
    }
}