{
    "author": "claudep",
    "message": "[py3] Fixed serializers tests",
    "sha": "f2fe7a3e36bebb529f33f5b702b7643a3db85c72",
    "files": [
        {
            "sha": "276f9a473863923ca4952c887726a74eebe34c0e",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/f2fe7a3e36bebb529f33f5b702b7643a3db85c72/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/f2fe7a3e36bebb529f33f5b702b7643a3db85c72/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=f2fe7a3e36bebb529f33f5b702b7643a3db85c72",
            "patch": "@@ -2,8 +2,6 @@\n Module for abstract serializer/unserializer base classes.\n \"\"\"\n \n-from io import BytesIO\n-\n from django.db import models\n from django.utils.encoding import smart_text\n from django.utils import six\n@@ -35,7 +33,7 @@ def serialize(self, queryset, **options):\n         \"\"\"\n         self.options = options\n \n-        self.stream = options.pop(\"stream\", BytesIO())\n+        self.stream = options.pop(\"stream\", six.StringIO())\n         self.selected_fields = options.pop(\"fields\", None)\n         self.use_natural_keys = options.pop(\"use_natural_keys\", False)\n \n@@ -125,7 +123,7 @@ def __init__(self, stream_or_string, **options):\n         \"\"\"\n         self.options = options\n         if isinstance(stream_or_string, six.string_types):\n-            self.stream = BytesIO(stream_or_string)\n+            self.stream = six.StringIO(stream_or_string)\n         else:\n             self.stream = stream_or_string\n         # hack to make sure that the models have all been loaded before"
        },
        {
            "sha": "e39f17b68a23b136194152a1253ede0573c5c701",
            "filename": "tests/modeltests/serializers/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/f2fe7a3e36bebb529f33f5b702b7643a3db85c72/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f2fe7a3e36bebb529f33f5b702b7643a3db85c72/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fserializers%2Ftests.py?ref=f2fe7a3e36bebb529f33f5b702b7643a3db85c72",
            "patch": "@@ -114,8 +114,8 @@ def test_altering_serialized_output(self):\n         Tests the ability to create new objects by\n         modifying serialized content.\n         \"\"\"\n-        old_headline = b\"Poker has no place on ESPN\"\n-        new_headline = b\"Poker has no place on television\"\n+        old_headline = \"Poker has no place on ESPN\"\n+        new_headline = \"Poker has no place on television\"\n         serial_str = serializers.serialize(self.serializer_name,\n                                            Article.objects.all())\n         serial_str = serial_str.replace(old_headline, new_headline)\n@@ -285,7 +285,7 @@ def test_forward_refs(self):\n \n class XmlSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"xml\"\n-    pkless_str = b\"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+    pkless_str = \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object model=\"serializers.category\">\n         <field type=\"CharField\" name=\"name\">Reference</field>\n@@ -331,7 +331,7 @@ def _get_field_values(serial_str, field_name):\n \n class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n     serializer_name = \"xml\"\n-    fwd_ref_str = b\"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+    fwd_ref_str = \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object pk=\"1\" model=\"serializers.article\">\n         <field to=\"serializers.author\" name=\"author\" rel=\"ManyToOneRel\">1</field>\n@@ -351,7 +351,7 @@ class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, Transacti\n \n class JsonSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"json\"\n-    pkless_str = b\"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n+    pkless_str = \"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n \n     @staticmethod\n     def _validate_output(serial_str):\n@@ -381,7 +381,7 @@ def _get_field_values(serial_str, field_name):\n \n class JsonSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n     serializer_name = \"json\"\n-    fwd_ref_str = b\"\"\"[\n+    fwd_ref_str = \"\"\"[\n     {\n         \"pk\": 1,\n         \"model\": \"serializers.article\",\n@@ -414,7 +414,7 @@ class JsonSerializerTransactionTestCase(SerializersTransactionTestBase, Transact\n else:\n     class YamlSerializerTestCase(SerializersTestBase, TestCase):\n         serializer_name = \"yaml\"\n-        fwd_ref_str = b\"\"\"- fields:\n+        fwd_ref_str = \"\"\"- fields:\n     headline: Forward references pose no problem\n     pub_date: 2006-06-16 15:00:00\n     categories: [1]\n@@ -430,7 +430,7 @@ class YamlSerializerTestCase(SerializersTestBase, TestCase):\n   pk: 1\n   model: serializers.author\"\"\"\n \n-        pkless_str = b\"\"\"- fields:\n+        pkless_str = \"\"\"- fields:\n     name: Reference\n   pk: null\n   model: serializers.category\"\"\"\n@@ -470,7 +470,7 @@ def _get_field_values(serial_str, field_name):\n \n     class YamlSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n         serializer_name = \"yaml\"\n-        fwd_ref_str = b\"\"\"- fields:\n+        fwd_ref_str = \"\"\"- fields:\n     headline: Forward references pose no problem\n     pub_date: 2006-06-16 15:00:00\n     categories: [1]"
        },
        {
            "sha": "f4b3adaa5e99d5f40de2c7f3647df8853d98979f",
            "filename": "tests/regressiontests/serializers_regress/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/f2fe7a3e36bebb529f33f5b702b7643a3db85c72/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f2fe7a3e36bebb529f33f5b702b7643a3db85c72/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py?ref=f2fe7a3e36bebb529f33f5b702b7643a3db85c72",
            "patch": "@@ -10,7 +10,6 @@\n \n import datetime\n import decimal\n-from io import BytesIO\n \n try:\n     import yaml\n@@ -23,6 +22,7 @@\n from django.db import connection, models\n from django.http import HttpResponse\n from django.test import TestCase\n+from django.utils import six\n from django.utils.functional import curry\n from django.utils.unittest import skipUnless\n \n@@ -502,17 +502,17 @@ def streamTest(format, self):\n     obj.save_base(raw=True)\n \n     # Serialize the test database to a stream\n-    for stream in (BytesIO(), HttpResponse()):\n+    for stream in (six.StringIO(), HttpResponse()):\n         serializers.serialize(format, [obj], indent=2, stream=stream)\n \n         # Serialize normally for a comparison\n         string_data = serializers.serialize(format, [obj], indent=2)\n \n         # Check that the two are the same\n-        if isinstance(stream, BytesIO):\n+        if isinstance(stream, six.StringIO):\n             self.assertEqual(string_data, stream.getvalue())\n         else:\n-            self.assertEqual(string_data, stream.content)\n+            self.assertEqual(string_data, stream.content.decode('utf-8'))\n         stream.close()\n \n for format in serializers.get_serializer_formats():"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 15,
        "deletions": 17
    }
}