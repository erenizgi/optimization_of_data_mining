{
    "author": "aaugustin",
    "message": "Fixed #17491 -- Honored the version number format expected by distutils. Fixed #11236 too.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17351 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f46003559cc59d27df7a4926001fd10b84f4ab22",
    "files": [
        {
            "sha": "6467c033bbc2be46c348d7982c9cb89a24664e3b",
            "filename": "django/__init__.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/f46003559cc59d27df7a4926001fd10b84f4ab22/django%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/f46003559cc59d27df7a4926001fd10b84f4ab22/django%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2F__init__.py?ref=f46003559cc59d27df7a4926001fd10b84f4ab22",
            "patch": "@@ -14,3 +14,17 @@ def get_version():\n     if svn_rev != u'SVN-unknown':\n         version = \"%s %s\" % (version, svn_rev)\n     return version\n+\n+def get_distutils_version():\n+    # Distutils expects a version number formatted as major.minor[.patch][sub]\n+    parts = 5\n+    if VERSION[3] == 'final':\n+        parts = 3\n+        if VERSION[2] == 0:\n+            parts = 2\n+    version = VERSION[:parts]\n+    version = [str(x)[0] for x in version]      # ['1', '4', '0', 'a', '1']\n+    if parts > 2:\n+        version[2:] = [''.join(version[2:])]    # ['1', '4', '0a1']\n+    version = '.'.join(version)                 # '1.4.0a1'\n+    return version"
        },
        {
            "sha": "af18af78ff80d55c74652fc903bf3010ea04bf44",
            "filename": "setup.py",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/f46003559cc59d27df7a4926001fd10b84f4ab22/setup.py",
            "raw_url": "https://github.com/django/django/raw/f46003559cc59d27df7a4926001fd10b84f4ab22/setup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/setup.py?ref=f46003559cc59d27df7a4926001fd10b84f4ab22",
            "patch": "@@ -17,10 +17,10 @@ def finalize_options(self):\n         self.set_undefined_options('install', ('install_lib', 'install_dir'))\n         install_data.finalize_options(self)\n \n-if sys.platform == \"darwin\": \n-    cmdclasses = {'install_data': osx_install_data} \n-else: \n-    cmdclasses = {'install_data': install_data} \n+if sys.platform == \"darwin\":\n+    cmdclasses = {'install_data': osx_install_data}\n+else:\n+    cmdclasses = {'install_data': install_data}\n \n def fullsplit(path, result=None):\n     \"\"\"\n@@ -66,13 +66,11 @@ def fullsplit(path, result=None):\n         file_info[0] = '\\\\PURELIB\\\\%s' % file_info[0]\n \n # Dynamically calculate the version based on django.VERSION.\n-version = __import__('django').get_version()\n-if u'SVN' in version:\n-    version = ' '.join(version.split(' ')[:-1])\n+version = __import__('django').get_distutils_version()\n \n setup(\n     name = \"Django\",\n-    version = version.replace(' ', '-'),\n+    version = version,\n     url = 'http://www.djangoproject.com/',\n     author = 'Django Software Foundation',\n     author_email = 'foundation@djangoproject.com',"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 20,
        "deletions": 8
    }
}