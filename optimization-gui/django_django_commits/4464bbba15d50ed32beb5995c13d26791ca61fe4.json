{
    "author": "aaugustin",
    "message": "Fixed #14502 -- Added a verbatim template tag.\n\nThanks SmileyChris for the patch.",
    "sha": "4464bbba15d50ed32beb5995c13d26791ca61fe4",
    "files": [
        {
            "sha": "9b2404cdb3b9a671683870efa3312c73a7080729",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/4464bbba15d50ed32beb5995c13d26791ca61fe4/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4464bbba15d50ed32beb5995c13d26791ca61fe4/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=4464bbba15d50ed32beb5995c13d26791ca61fe4",
            "patch": "@@ -184,6 +184,7 @@ def __init__(self, template_string, origin):\n         self.template_string = template_string\n         self.origin = origin\n         self.lineno = 1\n+        self.verbatim = False\n \n     def tokenize(self):\n         \"\"\"\n@@ -203,15 +204,26 @@ def create_token(self, token_string, in_tag):\n         If in_tag is True, we are processing something that matched a tag,\n         otherwise it should be treated as a literal string.\n         \"\"\"\n-        if in_tag:\n+        if in_tag and token_string.startswith(BLOCK_TAG_START):\n             # The [2:-2] ranges below strip off *_TAG_START and *_TAG_END.\n             # We could do len(BLOCK_TAG_START) to be more \"correct\", but we've\n             # hard-coded the 2s here for performance. And it's not like\n             # the TAG_START values are going to change anytime, anyway.\n+            block_content = token_string[2:-2].strip()\n+            if self.verbatim and block_content == self.verbatim:\n+                self.verbatim = False\n+        if in_tag and not self.verbatim:\n             if token_string.startswith(VARIABLE_TAG_START):\n                 token = Token(TOKEN_VAR, token_string[2:-2].strip())\n             elif token_string.startswith(BLOCK_TAG_START):\n-                token = Token(TOKEN_BLOCK, token_string[2:-2].strip())\n+                if block_content.startswith('verbatim'):\n+                    bits = block_content.split(' ', 1)\n+                    if bits[0] == 'verbatim':\n+                        if len(bits) > 1:\n+                            self.verbatim = bits[1]\n+                        else:\n+                            self.verbatim = 'endverbatim'\n+                token = Token(TOKEN_BLOCK, block_content)\n             elif token_string.startswith(COMMENT_TAG_START):\n                 content = ''\n                 if token_string.find(TRANSLATOR_COMMENT_MARK):"
        },
        {
            "sha": "3073b41049ecfbf2b7fc5d041ab69275921baff9",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 34,
            "deletions": 1,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/4464bbba15d50ed32beb5995c13d26791ca61fe4/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/4464bbba15d50ed32beb5995c13d26791ca61fe4/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=4464bbba15d50ed32beb5995c13d26791ca61fe4",
            "patch": "@@ -6,7 +6,7 @@\n from itertools import groupby, cycle as itertools_cycle\n \n from django.conf import settings\n-from django.template.base import (Node, NodeList, Template, Library,\n+from django.template.base import (Node, NodeList, Template, Context, Library,\n     TemplateSyntaxError, VariableDoesNotExist, InvalidTemplateLibrary,\n     BLOCK_TAG_START, BLOCK_TAG_END, VARIABLE_TAG_START, VARIABLE_TAG_END,\n     SINGLE_BRACE_START, SINGLE_BRACE_END, COMMENT_TAG_START, COMMENT_TAG_END,\n@@ -425,6 +425,13 @@ def render(self, context):\n         else:\n             return url\n \n+class VerbatimNode(Node):\n+    def __init__(self, content):\n+        self.content = content\n+\n+    def render(self, context):\n+        return self.content\n+\n class WidthRatioNode(Node):\n     def __init__(self, val_expr, max_expr, max_width):\n         self.val_expr = val_expr\n@@ -1272,6 +1279,32 @@ def url(parser, token):\n \n     return URLNode(viewname, args, kwargs, asvar)\n \n+@register.tag\n+def verbatim(parser, token):\n+    \"\"\"\n+    Stops the template engine from rendering the contents of this block tag.\n+\n+    Usage::\n+\n+        {% verbatim %}\n+            {% don't process this %}\n+        {% endverbatim %}\n+\n+    You can also specify an alternate closing tag::\n+\n+        {% verbatim -- %}\n+            ...\n+        {% -- %}\n+    \"\"\"\n+    bits = token.contents.split(' ', 1)\n+    if len(bits) > 1:\n+        closing_tag = bits[1]\n+    else:\n+        closing_tag = 'endverbatim'\n+    nodelist = parser.parse((closing_tag,))\n+    parser.delete_first_token()\n+    return VerbatimNode(nodelist.render(Context()))\n+\n @register.tag\n def widthratio(parser, token):\n     \"\"\""
        },
        {
            "sha": "af9004bbf1345241cf59ad9ee7110c7e0465a98b",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/4464bbba15d50ed32beb5995c13d26791ca61fe4/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/4464bbba15d50ed32beb5995c13d26791ca61fe4/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=4464bbba15d50ed32beb5995c13d26791ca61fe4",
            "patch": "@@ -1040,6 +1040,29 @@ This will follow the normal :ref:`namespaced URL resolution strategy\n <topics-http-reversing-url-namespaces>`, including using any hints provided\n by the context as to the current application.\n \n+.. templatetag:: verbatim\n+\n+verbatim\n+^^^^^^^^\n+\n+.. versionadded:: 1.5\n+\n+Stops the template engine from rendering the contents of this block tag.\n+\n+A common use is to allow a Javascript template layer that collides with\n+Django's syntax. For example::\n+\n+    {% verbatim %}\n+        {{if dying}}Still alive.{{/if}}\n+    {% endverbatim %}\n+\n+You can also specify an alternate closing tag::\n+\n+    {% verbatim finished %}\n+        The verbatim tag looks like this:\n+        {% verbatim %}{% endverbatim %}\n+    {% finished %}\n+\n .. templatetag:: widthratio\n \n widthratio"
        },
        {
            "sha": "33f50032814b5bf6d471aef8e29c96d43afc6056",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4464bbba15d50ed32beb5995c13d26791ca61fe4/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/4464bbba15d50ed32beb5995c13d26791ca61fe4/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=4464bbba15d50ed32beb5995c13d26791ca61fe4",
            "patch": "@@ -62,6 +62,13 @@ For one-to-one relationships, both sides can be cached. For many-to-one\n relationships, only the single side of the relationship can be cached. This\n is particularly helpful in combination with ``prefetch_related``.\n \n+``{% verbatim %}`` template tag\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+To make it easier to deal with javascript templates which collide with Django's\n+syntax, you can now use the :ttag:`verbatim` block tag to avoid parsing the\n+tag's content.\n+\n Minor features\n ~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "957ad2b9ba12adde7e1c24d9f6d1337c32fbaff4",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4464bbba15d50ed32beb5995c13d26791ca61fe4/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4464bbba15d50ed32beb5995c13d26791ca61fe4/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=4464bbba15d50ed32beb5995c13d26791ca61fe4",
            "patch": "@@ -1616,6 +1616,14 @@ def get_template_tests(self):\n             'static-prefixtag04': ('{% load static %}{% get_media_prefix as media_prefix %}{{ media_prefix }}', {}, settings.MEDIA_URL),\n             'static-statictag01': ('{% load static %}{% static \"admin/base.css\" %}', {}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n             'static-statictag02': ('{% load static %}{% static base_css %}', {'base_css': 'admin/base.css'}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n+\n+            # Verbatim template tag outputs contents without rendering.\n+            'verbatim-tag01': ('{% verbatim %}{{bare   }}{% endverbatim %}', {}, '{{bare   }}'),\n+            'verbatim-tag02': ('{% verbatim %}{% endif %}{% endverbatim %}', {}, '{% endif %}'),\n+            'verbatim-tag03': (\"{% verbatim %}It's the {% verbatim %} tag{% endverbatim %}\", {}, \"It's the {% verbatim %} tag\"),\n+            'verbatim-tag04': ('{% verbatim %}{% verbatim %}{% endverbatim %}{% endverbatim %}', {}, template.TemplateSyntaxError),\n+            'verbatim-tag05': ('{% verbatim %}{% endverbatim %}{% verbatim %}{% endverbatim %}', {}, ''),\n+            'verbatim-tag06': (\"{% verbatim -- %}Don't {% endverbatim %} just yet{% -- %}\", {}, \"Don't {% endverbatim %} just yet\"),\n         }\n         return tests\n "
        }
    ],
    "stats": {
        "total": 89,
        "additions": 86,
        "deletions": 3
    }
}