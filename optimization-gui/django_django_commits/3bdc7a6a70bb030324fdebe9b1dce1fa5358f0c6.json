{
    "author": "aaugustin",
    "message": "Deprecated transaction.is_managed().\n\nIt's synchronized with the autocommit flag.",
    "sha": "3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
    "files": [
        {
            "sha": "499bc3211301430fcf35b483993d96c3792e8c96",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 12,
            "deletions": 18,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -256,11 +256,12 @@ def enter_transaction_management(self, managed=True, forced=False):\n         \"\"\"\n         self.transaction_state.append(managed)\n \n-        if managed and self.autocommit:\n-            self.set_autocommit(False)\n-\n         if not managed and self.is_dirty() and not forced:\n             self.commit()\n+            self.set_clean()\n+\n+        if managed == self.autocommit:\n+            self.set_autocommit(not managed)\n \n     def leave_transaction_management(self):\n         \"\"\"\n@@ -274,19 +275,20 @@ def leave_transaction_management(self):\n             raise TransactionManagementError(\n                 \"This code isn't under transaction management\")\n \n-        # That's the next state -- we already left the previous state behind.\n-        managed = self.is_managed()\n+        if self.transaction_state:\n+            managed = self.transaction_state[-1]\n+        else:\n+            managed = settings.TRANSACTIONS_MANAGED\n \n         if self._dirty:\n             self.rollback()\n-            if not managed and not self.autocommit:\n-                self.set_autocommit(True)\n+            if managed == self.autocommit:\n+                self.set_autocommit(not managed)\n             raise TransactionManagementError(\n                 \"Transaction managed block ended with pending COMMIT/ROLLBACK\")\n \n-        if not managed and not self.autocommit:\n-            self.set_autocommit(True)\n-\n+        if managed == self.autocommit:\n+            self.set_autocommit(not managed)\n \n     def set_autocommit(self, autocommit=True):\n         \"\"\"\n@@ -331,14 +333,6 @@ def set_clean(self):\n         self._dirty = False\n         self.clean_savepoints()\n \n-    def is_managed(self):\n-        \"\"\"\n-        Checks whether the transaction manager is in manual or in auto state.\n-        \"\"\"\n-        if self.transaction_state:\n-            return self.transaction_state[-1]\n-        return settings.TRANSACTIONS_MANAGED\n-\n     ##### Foreign key constraints checks handling #####\n \n     @contextmanager"
        },
        {
            "sha": "27184c9350c8a38e1525935bd7f12b463ab348ba",
            "filename": "django/db/models/deletion.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Fmodels%2Fdeletion.py",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Fmodels%2Fdeletion.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fdeletion.py?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -53,7 +53,7 @@ def DO_NOTHING(collector, field, sub_objs, using):\n def force_managed(func):\n     @wraps(func)\n     def decorated(self, *args, **kwargs):\n-        if not transaction.is_managed(using=self.using):\n+        if transaction.get_autocommit(using=self.using):\n             transaction.enter_transaction_management(using=self.using, forced=True)\n             forced_managed = True\n         else:"
        },
        {
            "sha": "834fe363b43abb0d42d0c8bd9615c4ccb264c9b6",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -442,7 +442,7 @@ def bulk_create(self, objs, batch_size=None):\n         self._for_write = True\n         connection = connections[self.db]\n         fields = self.model._meta.local_fields\n-        if not transaction.is_managed(using=self.db):\n+        if transaction.get_autocommit(using=self.db):\n             transaction.enter_transaction_management(using=self.db, forced=True)\n             forced_managed = True\n         else:\n@@ -579,7 +579,7 @@ def update(self, **kwargs):\n         self._for_write = True\n         query = self.query.clone(sql.UpdateQuery)\n         query.add_update_values(kwargs)\n-        if not transaction.is_managed(using=self.db):\n+        if transaction.get_autocommit(using=self.db):\n             transaction.enter_transaction_management(using=self.db, forced=True)\n             forced_managed = True\n         else:"
        },
        {
            "sha": "49b67f4122281039c144990dfc20bbb4952b7957",
            "filename": "django/db/transaction.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Ftransaction.py",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fdb%2Ftransaction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Ftransaction.py?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -113,10 +113,8 @@ def clean_savepoints(using=None):\n     get_connection(using).clean_savepoints()\n \n def is_managed(using=None):\n-    \"\"\"\n-    Checks whether the transaction manager is in manual or in auto state.\n-    \"\"\"\n-    return get_connection(using).is_managed()\n+    warnings.warn(\"'is_managed' is deprecated.\",\n+        PendingDeprecationWarning, stacklevel=2)\n \n def managed(flag=True, using=None):\n     warnings.warn(\"'managed' no longer serves a purpose.\",\n@@ -281,13 +279,13 @@ def commit_on_success_unless_managed(using=None):\n     \"\"\"\n     Transitory API to preserve backwards-compatibility while refactoring.\n     \"\"\"\n-    if is_managed(using):\n+    if get_autocommit(using):\n+        return commit_on_success(using)\n+    else:\n         def entering(using):\n             pass\n \n         def exiting(exc_value, using):\n             set_dirty(using=using)\n \n         return _transaction_func(entering, exiting, using)\n-    else:\n-        return commit_on_success(using)"
        },
        {
            "sha": "35f765d99fa7670dd7b337d29b273544b8f847ac",
            "filename": "django/middleware/transaction.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fmiddleware%2Ftransaction.py",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/django%2Fmiddleware%2Ftransaction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Ftransaction.py?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -23,7 +23,7 @@ def process_exception(self, request, exception):\n \n     def process_response(self, request, response):\n         \"\"\"Commits and leaves transaction management.\"\"\"\n-        if transaction.is_managed():\n+        if not transaction.get_autocommit():\n             if transaction.is_dirty():\n                 # Note: it is possible that the commit fails. If the reason is\n                 # closed connection or some similar reason, then there is"
        },
        {
            "sha": "1c8618713a81cac932629c7de9a15864e1f55f63",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -351,6 +351,7 @@ these changes.\n * The following private APIs will be removed:\n   - ``django.db.close_connection()``\n   - ``django.db.backends.creation.BaseDatabaseCreation.set_autocommit()``\n+  - ``django.db.transaction.is_managed()``\n   - ``django.db.transaction.managed()``\n   - ``django.db.transaction.commit_unless_managed()``\n   - ``django.db.transaction.rollback_unless_managed()``"
        },
        {
            "sha": "e704fce342ddce22053763aebf3d0d82fbcae05b",
            "filename": "tests/middleware/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/tests%2Fmiddleware%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6/tests%2Fmiddleware%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmiddleware%2Ftests.py?ref=3bdc7a6a70bb030324fdebe9b1dce1fa5358f0c6",
            "patch": "@@ -689,7 +689,7 @@ def tearDown(self):\n \n     def test_request(self):\n         TransactionMiddleware().process_request(self.request)\n-        self.assertTrue(transaction.is_managed())\n+        self.assertFalse(transaction.get_autocommit())\n \n     def test_managed_response(self):\n         transaction.enter_transaction_management()"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 23,
        "deletions": 30
    }
}