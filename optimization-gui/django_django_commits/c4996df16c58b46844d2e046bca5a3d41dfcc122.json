{
    "author": "aaugustin",
    "message": "Fixed #17449 -- Added OPTIONS to generic views.\n\nThanks estebistec for the report and patch.",
    "sha": "c4996df16c58b46844d2e046bca5a3d41dfcc122",
    "files": [
        {
            "sha": "7d3649cbfff815f2171da6c7444ee6fe564d354c",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/c4996df16c58b46844d2e046bca5a3d41dfcc122/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/c4996df16c58b46844d2e046bca5a3d41dfcc122/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=c4996df16c58b46844d2e046bca5a3d41dfcc122",
            "patch": "@@ -79,14 +79,22 @@ def dispatch(self, request, *args, **kwargs):\n         return handler(request, *args, **kwargs)\n \n     def http_method_not_allowed(self, request, *args, **kwargs):\n-        allowed_methods = [m for m in self.http_method_names if hasattr(self, m)]\n         logger.warning('Method Not Allowed (%s): %s', request.method, request.path,\n             extra={\n                 'status_code': 405,\n                 'request': self.request\n             }\n         )\n-        return http.HttpResponseNotAllowed(allowed_methods)\n+        return http.HttpResponseNotAllowed(self._allowed_methods())\n+\n+    def options(self, request, *args, **kwargs):\n+        response = http.HttpResponse()\n+        response['Allow'] = ', '.join(self._allowed_methods())\n+        response['Content-Length'] = 0\n+        return response\n+\n+    def _allowed_methods(self):\n+        return [m.upper() for m in self.http_method_names if hasattr(self, m)]\n \n \n class TemplateResponseMixin(object):"
        },
        {
            "sha": "fc3dc05fd75bd32a224bf14452b8e578846198bd",
            "filename": "tests/regressiontests/generic_views/base.py",
            "status": "modified",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/c4996df16c58b46844d2e046bca5a3d41dfcc122/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/c4996df16c58b46844d2e046bca5a3d41dfcc122/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py?ref=c4996df16c58b46844d2e046bca5a3d41dfcc122",
            "patch": "@@ -173,6 +173,58 @@ def test_dispatch_decoration(self):\n         \"\"\"\n         self.assertTrue(DecoratedDispatchView.as_view().is_decorated)\n \n+    def test_head_no_get(self):\n+        \"\"\"\n+        Test that a view class with no get responds to a HEAD request with HTTP\n+        405.\n+        \"\"\"\n+        request = self.rf.head('/')\n+        view = PostOnlyView.as_view()\n+        self.assertEqual(405, view(request).status_code)\n+\n+    def test_options(self):\n+        \"\"\"\n+        Test that views respond to HTTP OPTIONS requests with an Allow header\n+        appropriate for the methods implemented by the view class.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = SimpleView.as_view()\n+        response = view(request)\n+        self.assertEqual(200, response.status_code)\n+        self.assertTrue(response['Allow'])\n+\n+    def test_options_for_get_view(self):\n+        \"\"\"\n+        Test that a view implementing GET allows GET and HEAD.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = SimpleView.as_view()\n+        response = view(request)\n+        self._assert_allows(response, 'GET', 'HEAD')\n+\n+    def test_options_for_get_and_post_view(self):\n+        \"\"\"\n+        Test that a view implementing GET and POST allows GET, HEAD, and POST.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = SimplePostView.as_view()\n+        response = view(request)\n+        self._assert_allows(response, 'GET', 'HEAD', 'POST')\n+\n+    def test_options_for_post_view(self):\n+        \"\"\"\n+        Test that a view implementing POST allows POST.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = PostOnlyView.as_view()\n+        response = view(request)\n+        self._assert_allows(response, 'POST')\n+\n+    def _assert_allows(self, response, *expected_methods):\n+        \"Assert allowed HTTP methods reported in the Allow response header\"\n+        response_allows = set(response['Allow'].split(', '))\n+        self.assertEqual(set(expected_methods + ('OPTIONS',)), response_allows)\n+\n \n class TemplateViewTest(TestCase):\n     urls = 'regressiontests.generic_views.urls'"
        }
    ],
    "stats": {
        "total": 64,
        "additions": 62,
        "deletions": 2
    }
}