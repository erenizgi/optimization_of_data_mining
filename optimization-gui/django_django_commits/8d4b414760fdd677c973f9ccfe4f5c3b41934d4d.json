{
    "author": "spookylukey",
    "message": "Fixed #15757 - removed remaining instances of get_and_delete_messages\n\nThanks to void for the report, and julien for the bulk of the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16022 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
    "files": [
        {
            "sha": "ad72cd80fc4684b02145e5de052353b7347a96db",
            "filename": "django/contrib/auth/context_processors.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fcontext_processors.py?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -1,5 +1,4 @@\n from django.utils.functional import lazy, memoize, SimpleLazyObject\n-from django.contrib import messages\n \n # PermWrapper and PermLookupDict proxy the permissions system into objects that\n # the template system can understand.\n@@ -55,6 +54,5 @@ def get_user():\n \n     return {\n         'user': SimpleLazyObject(get_user),\n-        'messages': messages.get_messages(request),\n         'perms':  lazy(lambda: PermWrapper(get_user()), PermWrapper)(),\n     }"
        },
        {
            "sha": "bbeffc17b7cc5708f076ddfec5af2da1c51d5033",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -445,9 +445,6 @@ def has_perms(self, perm_list, obj=None):\n     def has_module_perms(self, module):\n         return _user_has_module_perms(self, module)\n \n-    def get_and_delete_messages(self):\n-        return []\n-\n     def is_anonymous(self):\n         return True\n "
        },
        {
            "sha": "9880d7f7db76eeb83d5e22b5e31ad7ee59886ba5",
            "filename": "django/contrib/messages/api.py",
            "status": "modified",
            "additions": 6,
            "deletions": 15,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fmessages%2Fapi.py",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fmessages%2Fapi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Fapi.py?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -15,33 +15,24 @@ class MessageFailure(Exception):\n \n def add_message(request, level, message, extra_tags='', fail_silently=False):\n     \"\"\"\n-    Attempts to add a message to the request using the 'messages' app, falling\n-    back to the user's message_set if MessageMiddleware hasn't been enabled.\n+    Attempts to add a message to the request using the 'messages' app.\n     \"\"\"\n     if hasattr(request, '_messages'):\n         return request._messages.add(level, message, extra_tags)\n     if not fail_silently:\n-        raise MessageFailure('Without the django.contrib.messages '\n-                                'middleware, messages can only be added to '\n-                                'authenticated users.')\n+        raise MessageFailure('You cannot add messages without installing '\n+                    'django.contrib.messages.middleware.MessageMiddleware')\n \n \n def get_messages(request):\n     \"\"\"\n     Returns the message storage on the request if it exists, otherwise returns\n-    user.message_set.all() as the old auth context processor did.\n+    an empty list.\n     \"\"\"\n     if hasattr(request, '_messages'):\n         return request._messages\n-\n-    def get_user():\n-        if hasattr(request, 'user'):\n-            return request.user\n-        else:\n-            from django.contrib.auth.models import AnonymousUser\n-            return AnonymousUser()\n-\n-    return lazy(memoize(get_user().get_and_delete_messages, {}, 0), list)()\n+    else:\n+        return []\n \n \n def get_level(request):"
        },
        {
            "sha": "c6886a8cd05094d50cd1890c6d6d986179f93368",
            "filename": "django/contrib/messages/tests/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -10,7 +10,6 @@\n from django.contrib.messages.storage import default_storage, base\n from django.contrib.messages.storage.base import Message\n from django.core.urlresolvers import reverse\n-from django.contrib.auth.models import User\n \n \n def skipUnlessAuthIsInstalled(func):\n@@ -222,10 +221,10 @@ def test_multiple_posts(self):\n         for msg in data['messages']:\n             self.assertContains(response, msg)\n \n-    def test_middleware_disabled_anon_user(self):\n+    def test_middleware_disabled(self):\n         \"\"\"\n-        Tests that, when the middleware is disabled and a user is not logged\n-        in, an exception is raised when one attempts to store a message.\n+        Tests that, when the middleware is disabled, an exception is raised\n+        when one attempts to store a message.\n         \"\"\"\n         settings.MESSAGE_LEVEL = constants.DEBUG\n         settings.INSTALLED_APPS = list(settings.INSTALLED_APPS)\n@@ -251,10 +250,10 @@ def test_middleware_disabled_anon_user(self):\n             self.assertRaises(MessageFailure, self.client.post, add_url,\n                               data, follow=True)\n \n-    def test_middleware_disabled_anon_user_fail_silently(self):\n+    def test_middleware_disabled_fail_silently(self):\n         \"\"\"\n-        Tests that, when the middleware is disabled and a user is not logged\n-        in, an exception is not raised if 'fail_silently' = True\n+        Tests that, when the middleware is disabled, an exception is not\n+        raised if 'fail_silently' = True\n         \"\"\"\n         settings.MESSAGE_LEVEL = constants.DEBUG\n         settings.INSTALLED_APPS = list(settings.INSTALLED_APPS)"
        },
        {
            "sha": "a38823f409e4aab5940901b6989aa1dfc55c0a7a",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -52,7 +52,10 @@ their deprecation, as per the :ref:`Django deprecation policy\n           ``user.get_and_delete_messages()``), which have\n           been deprecated since the 1.2 release, will be removed.  The\n           :doc:`messages framework </ref/contrib/messages>` should be used\n-          instead.\n+          instead. The related ``messages`` variable returned by the\n+          auth context processor will also be removed. Note that this\n+          means that the admin application depends on the messages\n+          context processor.\n \n         * Authentication backends need to support the ``obj`` parameter for\n           permission checking. The ``supports_object_permissions`` variable"
        },
        {
            "sha": "415e1fe172b7fe3709ec370ca930fb646043da6a",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 8,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -14,26 +14,32 @@ Django's admin interface.\n Overview\n ========\n \n-There are six steps in activating the Django admin site:\n+There are seven steps in activating the Django admin site:\n \n     1. Add ``'django.contrib.admin'`` to your :setting:`INSTALLED_APPS`\n        setting.\n \n-    2. Admin has two dependencies - :mod:`django.contrib.auth` and\n-       :mod:`django.contrib.contenttypes`. If these applications are not\n-       in your :setting:`INSTALLED_APPS` list, add them.\n+    2. Admin has three dependencies - :mod:`django.contrib.auth`,\n+       :mod:`django.contrib.contenttypes` and :mod:`django.contrib.messages`.\n+       If these applications are not in your :setting:`INSTALLED_APPS` list,\n+       add them.\n \n-    3. Determine which of your application's models should be editable in the\n+    3. Add ``django.contrib.messages.context_processors.messages`` to\n+       :setting:`TEMPLATE_CONTEXT_PROCESSORS` and\n+       :class:`~django.contrib.messages.middleware.MessageMiddleware` to\n+       :setting:`MIDDLEWARE_CLASSES`.\n+\n+    4. Determine which of your application's models should be editable in the\n        admin interface.\n \n-    4. For each of those models, optionally create a ``ModelAdmin`` class that\n+    5. For each of those models, optionally create a ``ModelAdmin`` class that\n        encapsulates the customized admin functionality and options for that\n        particular model.\n \n-    5. Instantiate an ``AdminSite`` and tell it about each of your models and\n+    6. Instantiate an ``AdminSite`` and tell it about each of your models and\n        ``ModelAdmin`` classes.\n \n-    6. Hook the ``AdminSite`` instance into your URLconf.\n+    7. Hook the ``AdminSite`` instance into your URLconf.\n \n Other topics\n ------------"
        },
        {
            "sha": "a6cc162f8dab7217cc8b8129e35ee244959e2017",
            "filename": "docs/ref/templates/api.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Fref%2Ftemplates%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Fref%2Ftemplates%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fapi.txt?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -419,9 +419,6 @@ If :setting:`TEMPLATE_CONTEXT_PROCESSORS` contains this processor, every\n       logged-in user (or an ``AnonymousUser`` instance, if the client isn't\n       logged in).\n \n-    * ``messages`` -- A list of messages (as strings) that have been set\n-      via the :doc:`messages framework </ref/contrib/messages>`.\n-\n     * ``perms`` -- An instance of\n       ``django.contrib.auth.context_processors.PermWrapper``, representing the\n       permissions that the currently logged-in user has.\n@@ -430,11 +427,6 @@ If :setting:`TEMPLATE_CONTEXT_PROCESSORS` contains this processor, every\n     This context processor was moved in this release from\n     ``django.core.context_processors.auth`` to its current location.\n \n-.. versionchanged:: 1.2\n-   Prior to version 1.2, the ``messages`` variable was a lazy accessor for\n-   ``user.get_and_delete_messages()``. It has been changed to include any\n-   messages added via the :doc:`messages framework </ref/contrib/messages>`.\n-\n .. versionchanged:: 1.3\n     Prior to version 1.3, ``PermWrapper`` was located in\n     ``django.contrib.auth.context_processors``."
        },
        {
            "sha": "c01079c82a30489f49590040ad97f726eca9dca2",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 73,
            "changes": 73,
            "blob_url": "https://github.com/django/django/blob/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/8d4b414760fdd677c973f9ccfe4f5c3b41934d4d/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=8d4b414760fdd677c973f9ccfe4f5c3b41934d4d",
            "patch": "@@ -19,10 +19,6 @@ The auth system consists of:\n       a certain task.\n     * Groups: A generic way of applying labels and permissions to more than one\n       user.\n-    * Messages: A simple way to queue messages for given users.\n-\n-.. deprecated:: 1.2\n-   The Messages component of the auth system will be removed in Django 1.4.\n \n Installation\n ============\n@@ -256,11 +252,6 @@ Methods\n         (the Django app label). If the user is inactive, this method will\n         always return ``False``.\n \n-    .. method:: models.User.get_and_delete_messages()\n-\n-        Returns a list of :class:`~django.contrib.auth.models.Message` objects\n-        in the user's queue and deletes the messages from the queue.\n-\n     .. method:: models.User.email_user(subject, message, from_email=None)\n \n         Sends an email to the user. If\n@@ -1387,70 +1378,6 @@ group ``'Special users'``, and you could write code that could, say, give them\n access to a members-only portion of your site, or send them members-only email\n messages.\n \n-Messages\n-========\n-\n-.. deprecated:: 1.2\n-   This functionality will be removed in Django 1.4.  You should use the\n-   :doc:`messages framework </ref/contrib/messages>` for all new projects and\n-   begin to update your existing code immediately.\n-\n-The message system is a lightweight way to queue messages for given users.\n-\n-A message is associated with a :class:`~django.contrib.auth.models.User`.\n-There's no concept of expiration or timestamps.\n-\n-Messages are used by the Django admin after successful actions. For example,\n-``\"The poll Foo was created successfully.\"`` is a message.\n-\n-The API is simple:\n-\n-.. method:: models.User.message_set.create(message)\n-\n-    To create a new message, use\n-    ``user_obj.message_set.create(message='message_text')``.\n-\n-    To retrieve/delete messages, use\n-    :meth:`user_obj.get_and_delete_messages() <django.contrib.auth.models.User.get_and_delete_messages>`,\n-    which returns a list of ``Message`` objects in the user's queue (if any)\n-    and deletes the messages from the queue.\n-\n-In this example view, the system saves a message for the user after creating\n-a playlist::\n-\n-    def create_playlist(request, songs):\n-        # Create the playlist with the given songs.\n-        # ...\n-        request.user.message_set.create(message=\"Your playlist was added successfully.\")\n-        return render_to_response(\"playlists/create.html\",\n-            context_instance=RequestContext(request))\n-\n-When you use :class:`~django.template.context.RequestContext`, the currently\n-logged-in user and his/her messages are made available in the\n-:doc:`template context </ref/templates/api>` as the template variable\n-``{{ messages }}``. Here's an example of template code that displays messages:\n-\n-.. code-block:: html+django\n-\n-    {% if messages %}\n-    <ul>\n-        {% for message in messages %}\n-        <li>{{ message }}</li>\n-        {% endfor %}\n-    </ul>\n-    {% endif %}\n-\n-.. versionchanged:: 1.2\n-   The ``messages`` template variable uses a backwards compatible method in the\n-   :doc:`messages framework </ref/contrib/messages>` to retrieve messages from\n-   both the user ``Message`` model and from the new framework.  Unlike in\n-   previous revisions, the messages will not be erased unless they are actually\n-   displayed.\n-\n-Finally, note that this messages framework only works with users in the user\n-database. To send messages to anonymous users, use the\n-:doc:`messages framework </ref/contrib/messages>`.\n-\n .. _authentication-backends:\n \n Other authentication sources"
        }
    ],
    "stats": {
        "total": 147,
        "additions": 30,
        "deletions": 117
    }
}