{
    "author": "jezdez",
    "message": "Fixed #17717 -- Fixed serialization of proxy models. Thanks, Anssi Kääriäinen.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17640 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918",
    "files": [
        {
            "sha": "e4bba1d2409cd3d048bb923615e87a4cc3f26fa5",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918",
            "patch": "@@ -41,15 +41,18 @@ def serialize(self, queryset, **options):\n         self.start_serialization()\n         for obj in queryset:\n             self.start_object(obj)\n-            for field in obj._meta.local_fields:\n+            # Use the concrete parent class' _meta instead of the object's _meta\n+            # This is to avoid local_fields problems for proxy models. Refs #17717.\n+            concrete_class = obj._meta.proxy_for_model or obj.__class__\n+            for field in concrete_class._meta.local_fields:\n                 if field.serialize:\n                     if field.rel is None:\n                         if self.selected_fields is None or field.attname in self.selected_fields:\n                             self.handle_field(obj, field)\n                     else:\n                         if self.selected_fields is None or field.attname[:-3] in self.selected_fields:\n                             self.handle_fk_field(obj, field)\n-            for field in obj._meta.many_to_many:\n+            for field in concrete_class._meta.many_to_many:\n                 if field.serialize:\n                     if self.selected_fields is None or field.attname in self.selected_fields:\n                         self.handle_m2m_field(obj, field)"
        },
        {
            "sha": "9381349a61028b66196d9b8af169c0a5519605b7",
            "filename": "tests/regressiontests/serializers_regress/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918/tests%2Fregressiontests%2Fserializers_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918/tests%2Fregressiontests%2Fserializers_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Fmodels.py?ref=dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918",
            "patch": "@@ -259,6 +259,10 @@ class ExplicitInheritBaseModel(BaseModel):\n     parent = models.OneToOneField(BaseModel)\n     child_data = models.IntegerField()\n \n+class ProxyBaseModel(BaseModel):\n+    class Meta:\n+        proxy = True\n+\n class LengthModel(models.Model):\n     data = models.IntegerField()\n "
        },
        {
            "sha": "d8c5faba14545c1b4262be0239fabe37ed0a69c8",
            "filename": "tests/regressiontests/serializers_regress/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py?ref=dc49e6143a1e3cfafa4b7b41e4ab3c86d3e68918",
            "patch": "@@ -40,9 +40,9 @@\n     DecimalPKData, FloatPKData, IntegerPKData, IPAddressPKData,\n     GenericIPAddressPKData, PhonePKData, PositiveIntegerPKData,\n     PositiveSmallIntegerPKData, SlugPKData, SmallPKData, USStatePKData,\n-    AutoNowDateTimeData, ModifyingSaveData, InheritAbstractModel,\n-    ExplicitInheritBaseModel, InheritBaseModel, BigIntegerData, LengthModel,\n-    Tag, ComplexModel)\n+    AutoNowDateTimeData, ModifyingSaveData, InheritAbstractModel, BaseModel,\n+    ExplicitInheritBaseModel, InheritBaseModel, ProxyBaseModel, BigIntegerData,\n+    LengthModel, Tag, ComplexModel)\n \n # A set of functions that can be used to recreate\n # test data objects of various kinds.\n@@ -408,6 +408,14 @@ def test_yaml_deserializer_exception(self):\n             for obj in serializers.deserialize(\"yaml\", \"{\"):\n                 pass\n \n+    def test_serialize_proxy_model(self):\n+        BaseModel.objects.create(parent_data=1)\n+        base_objects  = BaseModel.objects.all()\n+        proxy_objects = ProxyBaseModel.objects.all()\n+        base_data  = serializers.serialize(\"json\", base_objects)\n+        proxy_data = serializers.serialize(\"json\", proxy_objects)\n+        self.assertEqual(base_data, proxy_data.replace('proxy', ''))\n+\n \n def serializerTest(format, self):\n "
        }
    ],
    "stats": {
        "total": 25,
        "additions": 20,
        "deletions": 5
    }
}