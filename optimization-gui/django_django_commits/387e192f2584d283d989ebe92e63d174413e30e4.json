{
    "author": "jezdez",
    "message": "Fixed #16721 -- Made sure that blocktrans correctly handles percents (%), even in the plural block. Thanks for the initial patch, Claude Paroz.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16730 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "387e192f2584d283d989ebe92e63d174413e30e4",
    "files": [
        {
            "sha": "669cdc911a2823c49731bd16bb3e57408237adc4",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/387e192f2584d283d989ebe92e63d174413e30e4/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/387e192f2584d283d989ebe92e63d174413e30e4/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=387e192f2584d283d989ebe92e63d174413e30e4",
            "patch": "@@ -116,16 +116,17 @@ def render(self, context):\n         # the end of function\n         context.update(tmp_context)\n         singular, vars = self.render_token_list(self.singular)\n+        # Escape all isolated '%'\n+        singular = re.sub(u'%(?!\\()', u'%%', singular)\n         if self.plural and self.countervar and self.counter:\n             count = self.counter.resolve(context)\n             context[self.countervar] = count\n             plural, plural_vars = self.render_token_list(self.plural)\n+            plural = re.sub(u'%(?!\\()', u'%%', plural)\n             result = translation.ungettext(singular, plural, count)\n             vars.extend(plural_vars)\n         else:\n             result = translation.ugettext(singular)\n-        # Escape all isolated '%' before substituting in the context.\n-        result = re.sub(u'%(?!\\()', u'%%', result)\n         data = dict([(v, _render_value_in_context(context.get(v, ''), context)) for v in vars])\n         context.pop()\n         try:"
        },
        {
            "sha": "a1a93c83296f0fb97d500466a8df30338fdb137e",
            "filename": "tests/regressiontests/i18n/other/locale/de/LC_MESSAGES/django.mo",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/387e192f2584d283d989ebe92e63d174413e30e4/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/387e192f2584d283d989ebe92e63d174413e30e4/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo?ref=387e192f2584d283d989ebe92e63d174413e30e4"
        },
        {
            "sha": "7226ad1943371b5c8c75a8e3a9d2ff12598258fe",
            "filename": "tests/regressiontests/i18n/other/locale/de/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/387e192f2584d283d989ebe92e63d174413e30e4/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/387e192f2584d283d989ebe92e63d174413e30e4/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po?ref=387e192f2584d283d989ebe92e63d174413e30e4",
            "patch": "@@ -40,3 +40,15 @@ msgid \"%d result\"\n msgid_plural \"%d results\"\n msgstr[0] \"%d Resultat\"\n msgstr[1] \"%d Resultate\"\n+\n+#: models.py:13\n+#, python-format\n+msgid \"The result was %(percent)s%%\"\n+msgstr \"Das Ergebnis war %(percent)s%%\"\n+\n+#: models.py:13\n+#, python-format\n+msgid \"%(percent)s%% represents %(num)s object\"\n+msgid_plural \"%(percent)s%% represents %(num)s objects\"\n+msgstr[0] \"%(percent)s%% stellt %(num)s Objekt dar\"\n+msgstr[1] \"%(percent)s%% stellt %(num)s Objekte dar\""
        },
        {
            "sha": "e6799ae28e195127005237653358f64b93ed9b37",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/387e192f2584d283d989ebe92e63d174413e30e4/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/387e192f2584d283d989ebe92e63d174413e30e4/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=387e192f2584d283d989ebe92e63d174413e30e4",
            "patch": "@@ -618,6 +618,19 @@ def test_parse_language_cookie(self):\n         r.META = {'HTTP_ACCEPT_LANGUAGE': 'de'}\n         self.assertEqual(g(r), 'zh-cn')\n \n+    def test_percent_in_translatable_block(self):\n+        extended_locale_paths = settings.LOCALE_PATHS + (\n+            os.path.join(here, 'other', 'locale'),\n+        )\n+        with self.settings(LOCALE_PATHS=extended_locale_paths):\n+            t_sing = Template(\"{% load i18n %}{% blocktrans %}The result was {{ percent }}%{% endblocktrans %}\")\n+            t_plur = Template(\"{% load i18n %}{% blocktrans count num as number %}{{ percent }}% represents {{ num }} object{% plural %}{{ percent }}% represents {{ num }} objects{% endblocktrans %}\")\n+            with translation.override('de'):\n+                self.assertEqual(t_sing.render(Context({'percent': 42})), u'Das Ergebnis war 42%')\n+                self.assertEqual(t_plur.render(Context({'percent': 42, 'num': 1})), u'42% stellt 1 Objekt dar')\n+                self.assertEqual(t_plur.render(Context({'percent': 42, 'num': 4})), u'42% stellt 4 Objekte dar')\n+\n+\n class ResolutionOrderI18NTests(TestCase):\n \n     def setUp(self):"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 28,
        "deletions": 2
    }
}