{
    "author": "jezdez",
    "message": "Fixed #15127 -- Properly copy the choices of choice fields. Thanks, dready and Julian Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16416 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "22529d41b26137ac87c5e08a6c19e6e91552756e",
    "files": [
        {
            "sha": "113a5aab22df8b2eaaded1b325e6c417107e1816",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/22529d41b26137ac87c5e08a6c19e6e91552756e/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/22529d41b26137ac87c5e08a6c19e6e91552756e/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=22529d41b26137ac87c5e08a6c19e6e91552756e",
            "patch": "@@ -657,6 +657,11 @@ def __init__(self, choices=(), required=True, widget=None, label=None,\n                                         initial=initial, help_text=help_text, *args, **kwargs)\n         self.choices = choices\n \n+    def __deepcopy__(self, memo):\n+        result = super(ChoiceField, self).__deepcopy__(memo)\n+        result._choices = copy.deepcopy(self._choices, memo)\n+        return result\n+\n     def _get_choices(self):\n         return self._choices\n "
        },
        {
            "sha": "04463cfb2c3339424c9fcb541c09dc74c6e14b60",
            "filename": "tests/regressiontests/forms/tests/forms.py",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/22529d41b26137ac87c5e08a6c19e6e91552756e/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/22529d41b26137ac87c5e08a6c19e6e91552756e/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py?ref=22529d41b26137ac87c5e08a6c19e6e91552756e",
            "patch": "@@ -771,6 +771,26 @@ def __init__(self, name_max_length=None, *args, **kwargs):\n         f = Person(name_max_length=None)\n         self.assertEqual(f['first_name'].field.max_length, f['last_name'].field.max_length, (30, 30))\n \n+        # Similarly, choices do not persist from one Form instance to the next.\n+        # Refs #15127.\n+        class Person(Form):\n+            first_name = CharField(required=False)\n+            last_name = CharField(required=False)\n+            gender = ChoiceField(choices=(('f', 'Female'), ('m', 'Male')))\n+\n+            def __init__(self, allow_unspec_gender=False, *args, **kwargs):\n+                super(Person, self).__init__(*args, **kwargs)\n+\n+                if allow_unspec_gender:\n+                    self.fields['gender'].choices += (('u', 'Unspecified'),)\n+\n+        f = Person()\n+        self.assertEqual(f['gender'].field.choices, [('f', 'Female'), ('m', 'Male')])\n+        f = Person(allow_unspec_gender=True)\n+        self.assertEqual(f['gender'].field.choices, [('f', 'Female'), ('m', 'Male'), ('u', 'Unspecified')])\n+        f = Person()\n+        self.assertEqual(f['gender'].field.choices, [('f', 'Female'), ('m', 'Male')])\n+\n     def test_hidden_widget(self):\n         # HiddenInput widgets are displayed differently in the as_table(), as_ul())\n         # and as_p() output of a Form -- their verbose names are not displayed, and a\n@@ -1154,7 +1174,7 @@ class UserRegistration(Form):\n     def test_boundfield_values(self):\n         # It's possible to get to the value which would be used for rendering\n         # the widget for a field by using the BoundField's value method.\n- \n+\n         class UserRegistration(Form):\n             username = CharField(max_length=10, initial='djangonaut')\n             password = CharField(widget=PasswordInput)"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 26,
        "deletions": 1
    }
}