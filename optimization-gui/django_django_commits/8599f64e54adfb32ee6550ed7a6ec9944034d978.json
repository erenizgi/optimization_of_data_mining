{
    "author": "claudep",
    "message": "Fixed #18861 -- Triggered message validation with locmem email backend\n\nThanks Bruno Reni√© for the report and the initial patch.",
    "sha": "8599f64e54adfb32ee6550ed7a6ec9944034d978",
    "files": [
        {
            "sha": "6826d09ee5f9aebd18514ef215aa7e887274cf45",
            "filename": "django/core/mail/backends/locmem.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/8599f64e54adfb32ee6550ed7a6ec9944034d978/django%2Fcore%2Fmail%2Fbackends%2Flocmem.py",
            "raw_url": "https://github.com/django/django/raw/8599f64e54adfb32ee6550ed7a6ec9944034d978/django%2Fcore%2Fmail%2Fbackends%2Flocmem.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Flocmem.py?ref=8599f64e54adfb32ee6550ed7a6ec9944034d978",
            "patch": "@@ -20,5 +20,7 @@ def __init__(self, *args, **kwargs):\n \n     def send_messages(self, messages):\n         \"\"\"Redirect messages to the dummy outbox\"\"\"\n+        for message in messages:  # .message() triggers header validation\n+            message.message()\n         mail.outbox.extend(messages)\n         return len(messages)"
        },
        {
            "sha": "33898cc1d543f6f04d34829c6f3c8aedec7c6a00",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/8599f64e54adfb32ee6550ed7a6ec9944034d978/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8599f64e54adfb32ee6550ed7a6ec9944034d978/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=8599f64e54adfb32ee6550ed7a6ec9944034d978",
            "patch": "@@ -498,6 +498,11 @@ def test_locmem_shared_messages(self):\n         connection2.send_messages([email])\n         self.assertEqual(len(mail.outbox), 2)\n \n+    def test_validate_multiline_headers(self):\n+        # Ticket #18861 - Validate emails when using the locmem backend\n+        with self.assertRaises(BadHeaderError):\n+            send_mail('Subject\\nMultiline', 'Content', 'from@example.com', ['to@example.com'])\n+\n \n class FileBackendTests(BaseEmailBackendTests, TestCase):\n     email_backend = 'django.core.mail.backends.filebased.EmailBackend'"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}