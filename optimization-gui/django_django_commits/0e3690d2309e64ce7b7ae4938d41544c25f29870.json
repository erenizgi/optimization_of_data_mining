{
    "author": "timgraham",
    "message": "Fixed #18974 - Warned against using models.permalink\n\nThanks dstufft for the draft patch.",
    "sha": "0e3690d2309e64ce7b7ae4938d41544c25f29870",
    "files": [
        {
            "sha": "9f2e007268c219142aa4f7e6160265fac827972f",
            "filename": "docs/ref/models/instances.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 9,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Fref%2Fmodels%2Finstances.txt",
            "raw_url": "https://github.com/django/django/raw/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Fref%2Fmodels%2Finstances.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Finstances.txt?ref=0e3690d2309e64ce7b7ae4938d41544c25f29870",
            "patch": "@@ -482,9 +482,13 @@ For example::\n         return \"/people/%i/\" % self.id\n \n (Whilst this code is correct and simple, it may not be the most portable way to\n-write this kind of method. The :func:`permalink() decorator <permalink>`,\n-documented below, is usually the best approach and you should read that section\n-before diving into code implementation.)\n+write this kind of method. The :func:`~django.core.urlresolvers.reverse`\n+function is usually the best approach.)\n+\n+For example::\n+\n+    def get_absolute_url(self):\n+        return reverse('people.views.details', args=[str(self.id)])\n \n One place Django uses ``get_absolute_url()`` is in the admin app. If an object\n defines this method, the object-editing page will have a \"View on site\" link\n@@ -529,11 +533,19 @@ in ``get_absolute_url()`` and have all your other code call that one place.\n The ``permalink`` decorator\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n-The way we wrote ``get_absolute_url()`` above is a slightly violation of the\n-DRY principle: the URL for this object is defined both in the URLconf file and\n-in the model.\n+.. warning::\n+\n+    The ``permalink`` decorator is no longer recommended. You should use\n+    :func:`~django.core.urlresolvers.reverse` in the body of your\n+    ``get_absolute_url`` method instead.\n \n-You can decouple your models from the URLconf using the ``permalink`` decorator:\n+In early versions of Django, there wasn't an easy way to use URLs defined in\n+URLconf file inside :meth:`~django.db.models.Model.get_absolute_url`. That\n+meant you would need to define the URL both in URLConf and\n+:meth:`~django.db.models.Model.get_absolute_url`. The ``permalink`` decorator\n+was added to overcome this DRY principle violation. However, since the\n+introduction of :func:`~django.core.urlresolvers.reverse` there is no\n+reason to use ``permalink`` any more.\n \n .. function:: permalink()\n \n@@ -544,14 +556,14 @@ correct URL, with all parameters substituted in the correct positions.\n \n The ``permalink`` decorator is a Python-level equivalent to the :ttag:`url`\n template tag and a high-level wrapper for the\n-:func:`django.core.urlresolvers.reverse()` function.\n+:func:`~django.core.urlresolvers.reverse` function.\n \n An example should make it clear how to use ``permalink()``. Suppose your URLconf\n contains a line such as::\n \n     (r'^people/(\\d+)/$', 'people.views.details'),\n \n-...your model could have a :meth:`~django.db.models.Model.get_absolute_url()`\n+...your model could have a :meth:`~django.db.models.Model.get_absolute_url`\n method that looked like this::\n \n     from django.db import models"
        },
        {
            "sha": "784ff333986edec2545d55c1548e006906986bee",
            "filename": "docs/ref/unicode.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Fref%2Funicode.txt",
            "raw_url": "https://github.com/django/django/raw/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Fref%2Funicode.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Funicode.txt?ref=0e3690d2309e64ce7b7ae4938d41544c25f29870",
            "patch": "@@ -262,11 +262,11 @@ Taking care in ``get_absolute_url()``\n \n URLs can only contain ASCII characters. If you're constructing a URL from\n pieces of data that might be non-ASCII, be careful to encode the results in a\n-way that is suitable for a URL. The ``django.db.models.permalink()`` decorator\n-handles this for you automatically.\n+way that is suitable for a URL. The :func:`~django.core.urlresolvers.reverse`\n+function handles this for you automatically.\n \n-If you're constructing a URL manually (i.e., *not* using the ``permalink()``\n-decorator), you'll need to take care of the encoding yourself. In this case,\n+If you're constructing a URL manually (i.e., *not* using the ``reverse()``\n+function), you'll need to take care of the encoding yourself. In this case,\n use the ``iri_to_uri()`` and ``urlquote()`` functions that were documented\n above_. For example::\n "
        },
        {
            "sha": "528f1720611ec34713640f3466ed736d9c44ab37",
            "filename": "docs/ref/urlresolvers.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 17,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Fref%2Furlresolvers.txt",
            "raw_url": "https://github.com/django/django/raw/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Fref%2Furlresolvers.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Furlresolvers.txt?ref=0e3690d2309e64ce7b7ae4938d41544c25f29870",
            "patch": "@@ -178,25 +178,17 @@ whether a view would raise a ``Http404`` error before redirecting to it::\n             return HttpResponseRedirect('/')\n         return response\n \n-\n-permalink()\n------------\n-\n-The :func:`~django.db.models.permalink` decorator is useful for writing short\n-methods that return a full URL path. For example, a model's\n-``get_absolute_url()`` method. See :func:`django.db.models.permalink` for more.\n-\n get_script_prefix()\n -------------------\n \n .. function:: get_script_prefix()\n \n-Normally, you should always use :func:`~django.core.urlresolvers.reverse` or\n-:func:`~django.db.models.permalink` to define URLs within your application.\n-However, if your application constructs part of the URL hierarchy itself, you\n-may occasionally need to generate URLs. In that case, you need to be able to\n-find the base URL of the Django project within its Web server\n-(normally, :func:`~django.core.urlresolvers.reverse` takes care of this for\n-you). In that case, you can call ``get_script_prefix()``, which will return the\n-script prefix portion of the URL for your Django project. If your Django\n-project is at the root of its Web server, this is always ``\"/\"``.\n+Normally, you should always use :func:`~django.core.urlresolvers.reverse` to\n+define URLs within your application. However, if your application constructs\n+part of the URL hierarchy itself, you may occasionally need to generate URLs.\n+In that case, you need to be able to find the base URL of the Django project\n+within its Web server (normally, :func:`~django.core.urlresolvers.reverse`\n+takes care of this for you). In that case, you can call\n+``get_script_prefix()``, which will return the script prefix portion of the URL\n+for your Django project. If your Django project is at the root of its web\n+server, this is always ``\"/\"``."
        },
        {
            "sha": "00c07da6ea7465888b30ab15ce2766229c842f41",
            "filename": "docs/topics/http/urls.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Ftopics%2Fhttp%2Furls.txt",
            "raw_url": "https://github.com/django/django/raw/0e3690d2309e64ce7b7ae4938d41544c25f29870/docs%2Ftopics%2Fhttp%2Furls.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Furls.txt?ref=0e3690d2309e64ce7b7ae4938d41544c25f29870",
            "patch": "@@ -552,12 +552,11 @@ layers where URLs are needed:\n \n * In templates: Using the :ttag:`url` template tag.\n \n-* In Python code: Using the :func:`django.core.urlresolvers.reverse()`\n+* In Python code: Using the :func:`django.core.urlresolvers.reverse`\n   function.\n \n * In higher level code related to handling of URLs of Django model instances:\n-  The :meth:`django.db.models.Model.get_absolute_url()` method and the\n-  :func:`django.db.models.permalink` decorator.\n+  The :meth:`~django.db.models.Model.get_absolute_url` method.\n \n Examples\n --------\n@@ -622,10 +621,10 @@ view::\n     )\n \n This is completely valid, but it leads to problems when you try to do reverse\n-URL matching (through the :func:`~django.db.models.permalink` decorator or the\n-:ttag:`url` template tag). Continuing this example, if you wanted to retrieve\n-the URL for the ``archive`` view, Django's reverse URL matcher would get\n-confused, because *two* URL patterns point at that view.\n+URL matching (through the :func:`~django.core.urlresolvers.reverse` function\n+or the :ttag:`url` template tag). Continuing this example, if you wanted to\n+retrieve the URL for the ``archive`` view, Django's reverse URL matcher would\n+get confused, because *two* URL patterns point at that view.\n \n To solve this problem, Django supports **named URL patterns**. That is, you can\n give a name to a URL pattern in order to distinguish it from other patterns\n@@ -724,7 +723,7 @@ the fully qualified name into parts, and then tries the following lookup:\n    render a template.\n \n    The current application can also be specified manually as an argument\n-   to the :func:`django.core.urlresolvers.reverse()` function.\n+   to the :func:`django.core.urlresolvers.reverse` function.\n \n 3. If there is no current application. Django looks for a default\n    application instance. The default application instance is the instance"
        },
        {
            "sha": "30c73d67ca67d28726412edff0f75ff879000014",
            "filename": "tests/regressiontests/generic_views/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0e3690d2309e64ce7b7ae4938d41544c25f29870/tests%2Fregressiontests%2Fgeneric_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/0e3690d2309e64ce7b7ae4938d41544c25f29870/tests%2Fregressiontests%2Fgeneric_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fmodels.py?ref=0e3690d2309e64ce7b7ae4938d41544c25f29870",
            "patch": "@@ -1,3 +1,4 @@\n+from django.core.urlresolvers import reverse\n from django.db import models\n from django.utils.encoding import python_2_unicode_compatible\n \n@@ -14,9 +15,8 @@ class Meta:\n     def __str__(self):\n         return self.name\n \n-    @models.permalink\n     def get_absolute_url(self):\n-        return ('artist_detail', (), {'pk': self.id})\n+        return reverse('artist_detail', kwargs={'pk': self.id})\n \n @python_2_unicode_compatible\n class Author(models.Model):"
        }
    ],
    "stats": {
        "total": 83,
        "additions": 43,
        "deletions": 40
    }
}