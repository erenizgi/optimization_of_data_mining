{
    "author": "aaugustin",
    "message": "Fixed #17786 (again) -- Ensured destruction of test databases works under Oracle, even with multiple databases, after r17411.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17601 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "97061bdf30216adfe50a1a367ddeefe06af5fefc",
    "files": [
        {
            "sha": "0cd055866a3fea6ee03c03511a4125dfe5c6c9ad",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/97061bdf30216adfe50a1a367ddeefe06af5fefc/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/97061bdf30216adfe50a1a367ddeefe06af5fefc/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=97061bdf30216adfe50a1a367ddeefe06af5fefc",
            "patch": "@@ -353,7 +353,7 @@ def _create_test_db(self, verbosity, autoclobber):\n     def destroy_test_db(self, old_database_name, verbosity=1):\n         \"\"\"\n         Destroy a test database, prompting the user for confirmation if the\n-        database already exists. Returns the name of the test database created.\n+        database already exists.\n         \"\"\"\n         self.connection.close()\n         test_database_name = self.connection.settings_dict['NAME']\n@@ -367,7 +367,7 @@ def destroy_test_db(self, old_database_name, verbosity=1):\n         # Temporarily use a new connection and a copy of the settings dict.\n         # This prevents the production database from being exposed to potential\n         # child threads while (or after) the test database is destroyed.\n-        # Refs #10868.\n+        # Refs #10868 and #17786.\n         settings_dict = self.connection.settings_dict.copy()\n         settings_dict['NAME'] = old_database_name\n         backend = load_backend(settings_dict['ENGINE'])"
        },
        {
            "sha": "9e6133fc64240d52f6048e90a5ee0beec755f462",
            "filename": "django/db/backends/oracle/creation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/97061bdf30216adfe50a1a367ddeefe06af5fefc/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/97061bdf30216adfe50a1a367ddeefe06af5fefc/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py?ref=97061bdf30216adfe50a1a367ddeefe06af5fefc",
            "patch": "@@ -40,11 +40,6 @@ class DatabaseCreation(BaseDatabaseCreation):\n         'URLField':                     'VARCHAR2(%(max_length)s)',\n     }\n \n-    # This dictionary stores the original values of user and passwd, which are\n-    # changed during the tests. It's stored at the class level because the\n-    # test database is created and destroyed by different connections (#17786).\n-    remember = {}\n-\n     def __init__(self, connection):\n         super(DatabaseCreation, self).__init__(connection)\n \n@@ -63,9 +58,6 @@ def _create_test_db(self, verbosity=1, autoclobber=False):\n             'tblspace_temp': TEST_TBLSPACE_TMP,\n         }\n \n-        self.remember['user'] = self.connection.settings_dict['USER']\n-        self.remember['passwd'] = self.connection.settings_dict['PASSWORD']\n-\n         cursor = self.connection.cursor()\n         if self._test_database_create():\n             try:\n@@ -111,8 +103,10 @@ def _create_test_db(self, verbosity=1, autoclobber=False):\n                     print \"Tests cancelled.\"\n                     sys.exit(1)\n \n-        self.connection.settings_dict['TEST_USER'] = self.connection.settings_dict[\"USER\"] = TEST_USER\n-        self.connection.settings_dict[\"PASSWORD\"] = TEST_PASSWD\n+        self.connection.settings_dict['SAVED_USER'] = self.connection.settings_dict['USER']\n+        self.connection.settings_dict['SAVED_PASSWORD'] = self.connection.settings_dict['PASSWORD']\n+        self.connection.settings_dict['TEST_USER'] = self.connection.settings_dict['USER'] = TEST_USER\n+        self.connection.settings_dict['PASSWORD'] = TEST_PASSWD\n \n         return self.connection.settings_dict['NAME']\n \n@@ -127,8 +121,8 @@ def _destroy_test_db(self, test_database_name, verbosity=1):\n         TEST_TBLSPACE = self._test_database_tblspace()\n         TEST_TBLSPACE_TMP = self._test_database_tblspace_tmp()\n \n-        self.connection.settings_dict[\"USER\"] = self.remember['user']\n-        self.connection.settings_dict[\"PASSWORD\"] = self.remember['passwd']\n+        self.connection.settings_dict['USER'] = self.connection.settings_dict['SAVED_USER']\n+        self.connection.settings_dict['PASSWORD'] = self.connection.settings_dict['SAVED_PASSWORD']\n \n         parameters = {\n             'dbname': TEST_NAME,"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 8,
        "deletions": 14
    }
}