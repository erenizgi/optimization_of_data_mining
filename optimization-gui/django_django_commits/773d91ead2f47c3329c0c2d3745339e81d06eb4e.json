{
    "author": "jezdez",
    "message": "Fixed #17128 -- Fixed a Python 2.5 incompatibility. Thanks, Simon Meers.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17102 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "773d91ead2f47c3329c0c2d3745339e81d06eb4e",
    "files": [
        {
            "sha": "4eed0160e296d76ffd40409a67a69df96d8cafe5",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/773d91ead2f47c3329c0c2d3745339e81d06eb4e/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/773d91ead2f47c3329c0c2d3745339e81d06eb4e/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=773d91ead2f47c3329c0c2d3745339e81d06eb4e",
            "patch": "@@ -221,25 +221,25 @@ def get_ordering_field_columns(self):\n             # for ordering specified on ModelAdmin or model Meta, we don't know\n             # the right column numbers absolutely, because there might be more\n             # than one column associated with that ordering, so we guess.\n-            for f in ordering:\n-                if f.startswith('-'):\n-                    f = f[1:]\n+            for field in ordering:\n+                if field.startswith('-'):\n+                    field = field[1:]\n                     order_type = 'desc'\n                 else:\n                     order_type = 'asc'\n-                i = None\n+                index = None\n                 try:\n                     # Search for simply field name first\n-                    i = self.list_display.index(f)\n+                    index = list(self.list_display).index(field)\n                 except ValueError:\n-                    # No match, but their might be a match if we take into account\n-                    # 'admin_order_field'\n-                    for j, attr in enumerate(self.list_display):\n-                        if getattr(attr, 'admin_order_field', '') == f:\n-                            i = j\n+                    # No match, but there might be a match if we take into\n+                    # account 'admin_order_field'\n+                    for _index, attr in enumerate(self.list_display):\n+                        if getattr(attr, 'admin_order_field', '') == field:\n+                            index = _index\n                             break\n-                if i is not None:\n-                    ordering_fields[i] = order_type\n+                if index is not None:\n+                    ordering_fields[index] = order_type\n         else:\n             for p in self.params[ORDER_VAR].split('.'):\n                 none, pfx, idx = p.rpartition('-')"
        },
        {
            "sha": "80bb732eb009ef1f6feefe9d001d9e7afc872de7",
            "filename": "tests/regressiontests/admin_changelist/admin.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/773d91ead2f47c3329c0c2d3745339e81d06eb4e/tests%2Fregressiontests%2Fadmin_changelist%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/773d91ead2f47c3329c0c2d3745339e81d06eb4e/tests%2Fregressiontests%2Fadmin_changelist%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Fadmin.py?ref=773d91ead2f47c3329c0c2d3745339e81d06eb4e",
            "patch": "@@ -4,7 +4,7 @@\n from django.core.paginator import Paginator\n \n from .models import (Child, Parent, Genre, Band, Musician, Group, Quartet,\n-    Membership, ChordsMusician, ChordsBand, Invitation)\n+    Membership, ChordsMusician, ChordsBand, Invitation, Swallow)\n \n \n site = admin.AdminSite(name=\"admin\")\n@@ -75,3 +75,9 @@ def get_list_display_links(self, request, list_display):\n         return ['age']\n \n site.register(Child, DynamicListDisplayChildAdmin)\n+\n+class SwallowAdmin(admin.ModelAdmin):\n+    actions = None # prevent ['action_checkbox'] + list(list_display)\n+    list_display = ('origin', 'load', 'speed')\n+\n+site.register(Swallow, SwallowAdmin)"
        },
        {
            "sha": "97080fb54815272b58a9cc4264acbd910039e13d",
            "filename": "tests/regressiontests/admin_changelist/models.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/773d91ead2f47c3329c0c2d3745339e81d06eb4e/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/773d91ead2f47c3329c0c2d3745339e81d06eb4e/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py?ref=773d91ead2f47c3329c0c2d3745339e81d06eb4e",
            "patch": "@@ -49,3 +49,11 @@ class Invitation(models.Model):\n     player = models.ForeignKey(ChordsMusician)\n     band = models.ForeignKey(ChordsBand)\n     instrument = models.CharField(max_length=15)\n+\n+class Swallow(models.Model):\n+    origin = models.CharField(max_length=255)\n+    load = models.FloatField()\n+    speed = models.FloatField()\n+\n+    class Meta:\n+        ordering = ('speed', 'load')"
        },
        {
            "sha": "b422519bfb510ea4e25813a6fd0cbecc4b056ea2",
            "filename": "tests/regressiontests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 36,
            "deletions": 27,
            "changes": 63,
            "blob_url": "https://github.com/django/django/blob/773d91ead2f47c3329c0c2d3745339e81d06eb4e/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/773d91ead2f47c3329c0c2d3745339e81d06eb4e/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py?ref=773d91ead2f47c3329c0c2d3745339e81d06eb4e",
            "patch": "@@ -11,9 +11,10 @@\n from .admin import (ChildAdmin, QuartetAdmin, BandAdmin, ChordsBandAdmin,\n     GroupAdmin, ParentAdmin, DynamicListDisplayChildAdmin,\n     DynamicListDisplayLinksChildAdmin, CustomPaginationAdmin,\n-    FilteredChildAdmin, CustomPaginator, site as custom_site)\n+    FilteredChildAdmin, CustomPaginator, site as custom_site,\n+    SwallowAdmin)\n from .models import (Child, Parent, Genre, Band, Musician, Group, Quartet,\n-    Membership, ChordsMusician, ChordsBand, Invitation)\n+    Membership, ChordsMusician, ChordsBand, Invitation, Swallow)\n \n \n class ChangeListTests(TestCase):\n@@ -22,6 +23,14 @@ class ChangeListTests(TestCase):\n     def setUp(self):\n         self.factory = RequestFactory()\n \n+    def _create_superuser(self, username):\n+        return User.objects.create(username=username, is_superuser=True)\n+\n+    def _mocked_authenticated_request(self, url, user):\n+        request = self.factory.get(url)\n+        request.user = user\n+        return request\n+\n     def test_select_related_preserved(self):\n         \"\"\"\n         Regression test for #10348: ChangeList.get_query_set() shouldn't\n@@ -323,21 +332,12 @@ def test_dynamic_list_display(self):\n         for i in range(10):\n             Child.objects.create(name='child %s' % i, parent=parent)\n \n-        user_noparents = User.objects.create(\n-            username='noparents',\n-            is_superuser=True)\n-        user_parents = User.objects.create(\n-            username='parents',\n-            is_superuser=True)\n-\n-        def _mocked_authenticated_request(user):\n-            request = self.factory.get('/child/')\n-            request.user = user\n-            return request\n+        user_noparents = self._create_superuser('noparents')\n+        user_parents = self._create_superuser('parents')\n \n         # Test with user 'noparents'\n         m = custom_site._registry[Child]\n-        request = _mocked_authenticated_request(user_noparents)\n+        request = self._mocked_authenticated_request('/child/', user_noparents)\n         response = m.changelist_view(request)\n         self.assertNotContains(response, 'Parent object')\n \n@@ -348,7 +348,7 @@ def _mocked_authenticated_request(user):\n \n         # Test with user 'parents'\n         m = DynamicListDisplayChildAdmin(Child, admin.site)\n-        request = _mocked_authenticated_request(user_parents)\n+        request = self._mocked_authenticated_request('/child/', user_parents)\n         response = m.changelist_view(request)\n         self.assertContains(response, 'Parent object')\n \n@@ -362,7 +362,7 @@ def _mocked_authenticated_request(user):\n         # Test default implementation\n         custom_site.register(Child, ChildAdmin)\n         m = custom_site._registry[Child]\n-        request = _mocked_authenticated_request(user_noparents)\n+        request = self._mocked_authenticated_request('/child/', user_noparents)\n         response = m.changelist_view(request)\n         self.assertContains(response, 'Parent object')\n \n@@ -402,22 +402,31 @@ def test_dynamic_list_display_links(self):\n         for i in range(1, 10):\n             Child.objects.create(id=i, name='child %s' % i, parent=parent, age=i)\n \n-        superuser = User.objects.create(\n-            username='superuser',\n-            is_superuser=True)\n-\n-        def _mocked_authenticated_request(user):\n-            request = self.factory.get('/child/')\n-            request.user = user\n-            return request\n-\n         m = DynamicListDisplayLinksChildAdmin(Child, admin.site)\n-        request = _mocked_authenticated_request(superuser)\n+        superuser = self._create_superuser('superuser')\n+        request = self._mocked_authenticated_request('/child/', superuser)\n         response = m.changelist_view(request)\n         for i in range(1, 10):\n             self.assertContains(response, '<a href=\"%s/\">%s</a>' % (i, i))\n \n         list_display = m.get_list_display(request)\n         list_display_links = m.get_list_display_links(request, list_display)\n         self.assertEqual(list_display, ('parent', 'name', 'age'))\n-        self.assertEqual(list_display_links, ['age'])\n\\ No newline at end of file\n+        self.assertEqual(list_display_links, ['age'])\n+\n+    def test_tuple_list_display(self):\n+        \"\"\"\n+        Regression test for #17128\n+        (ChangeList failing under Python 2.5 after r16319)\n+        \"\"\"\n+        swallow = Swallow.objects.create(\n+            origin='Africa', load='12.34', speed='22.2')\n+        model_admin = SwallowAdmin(Swallow, admin.site)\n+        superuser = self._create_superuser('superuser')\n+        request = self._mocked_authenticated_request('/swallow/', superuser)\n+        response = model_admin.changelist_view(request)\n+        # just want to ensure it doesn't blow up during rendering\n+        self.assertContains(response, unicode(swallow.origin))\n+        self.assertContains(response, unicode(swallow.load))\n+        self.assertContains(response, unicode(swallow.speed))\n+"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 63,
        "deletions": 40
    }
}