{
    "author": "andrewgodwin",
    "message": "Merge branch 'master' into schema-alteration",
    "sha": "b546e7eb633022ee1962570387f22fb2bcea46ed",
    "files": [
        {
            "sha": "5fa957885c53d6b1ff88935518645c702525c1eb",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -373,6 +373,7 @@ answer newbie questions, and generally made Django that much better:\n     michael.mcewan@gmail.com\n     Paul McLanahan <paul@mclanahan.net>\n     Tobias McNulty <http://www.caktusgroup.com/blog>\n+    Andrews Medina <andrewsmedina@gmail.com>\n     Zain Memon\n     Christian Metts\n     michal@plovarna.cz\n@@ -467,6 +468,7 @@ answer newbie questions, and generally made Django that much better:\n     Vinay Sajip <vinay_sajip@yahoo.co.uk>\n     Bartolome Sanchez Salado <i42sasab@uco.es>\n     Kadesarin Sanjek\n+    Tim Saylor <tim.saylor@gmail.com>\n     Massimo Scamarcia <massimo.scamarcia@gmail.com>\n     Paulo Scardine <paulo@scardine.com.br>\n     David Schein"
        },
        {
            "sha": "185e57646a4d221b30b74d405f6261fbbc557eb7",
            "filename": "MANIFEST.in",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/MANIFEST.in",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/MANIFEST.in",
            "contents_url": "https://api.github.com/repos/django/django/contents/MANIFEST.in?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,4 +1,4 @@\n-include README\n+include README.rst\n include AUTHORS\n include INSTALL\n include LICENSE"
        },
        {
            "sha": "35566abb943cef11911065fd1922e81b706c538e",
            "filename": "django/bin/django-2to3.py",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fbin%2Fdjango-2to3.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fbin%2Fdjango-2to3.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fbin%2Fdjango-2to3.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,10 @@\n+#!/usr/bin/env python\n+\n+# This works exactly like 2to3, except that it uses Django's fixers rather\n+# than 2to3's built-in fixers.\n+\n+import sys\n+from lib2to3.main import main\n+\n+sys.exit(main(\"django.utils.2to3_fixes\"))\n+"
        },
        {
            "sha": "f4d17ca9f3a0bdfba80ad1ce281da6a6f1fcc71c",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -152,17 +152,25 @@ def __init__(self, default_settings):\n         Requests for configuration variables not in this class are satisfied\n         from the module specified in default_settings (if possible).\n         \"\"\"\n+        self.__dict__['_deleted'] = set()\n         self.default_settings = default_settings\n \n     def __getattr__(self, name):\n+        if name in self._deleted:\n+            raise AttributeError\n         return getattr(self.default_settings, name)\n \n+    def __setattr__(self, name, value):\n+        self._deleted.discard(name)\n+        return super(UserSettingsHolder, self).__setattr__(name, value)\n+\n+    def __delattr__(self, name):\n+        self._deleted.add(name)\n+        return super(UserSettingsHolder, self).__delattr__(name)\n+\n     def __dir__(self):\n         return list(self.__dict__) + dir(self.default_settings)\n \n-    # For Python < 2.6:\n-    __members__ = property(lambda self: self.__dir__())\n-\n settings = LazySettings()\n \n "
        },
        {
            "sha": "6bdaa349880597464e805d2b6c1bfc23f6ede457",
            "filename": "django/conf/project_template/project_name/settings.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -13,10 +13,11 @@\n     'default': {\n         'ENGINE': 'django.db.backends.', # Add 'postgresql_psycopg2', 'mysql', 'sqlite3' or 'oracle'.\n         'NAME': '',                      # Or path to database file if using sqlite3.\n-        'USER': '',                      # Not used with sqlite3.\n-        'PASSWORD': '',                  # Not used with sqlite3.\n-        'HOST': '',                      # Set to empty string for localhost. Not used with sqlite3.\n-        'PORT': '',                      # Set to empty string for default. Not used with sqlite3.\n+        # The following settings are not used with sqlite3:\n+        'USER': '',\n+        'PASSWORD': '',\n+        'HOST': '',                      # Empty for localhost through domain sockets or '127.0.0.1' for localhost through TCP.\n+        'PORT': '',                      # Set to empty string for default.\n     }\n }\n "
        },
        {
            "sha": "2b12edd4e2dd19a13b41c4be4643b729b1959008",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,6 +6,7 @@\n from django.contrib.admin.util import quote\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_text\n+from django.utils.encoding import python_2_unicode_compatible\n \n ADDITION = 1\n CHANGE = 2\n@@ -16,6 +17,7 @@ def log_action(self, user_id, content_type_id, object_id, object_repr, action_fl\n         e = self.model(None, None, user_id, content_type_id, smart_text(object_id), object_repr[:200], action_flag, change_message)\n         e.save()\n \n+@python_2_unicode_compatible\n class LogEntry(models.Model):\n     action_time = models.DateTimeField(_('action time'), auto_now=True)\n     user = models.ForeignKey(User)\n@@ -36,7 +38,7 @@ class Meta:\n     def __repr__(self):\n         return smart_text(self.action_time)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         if self.action_flag == ADDITION:\n             return _('Added \"%(object)s\".') % {'object': self.object_repr}\n         elif self.action_flag == CHANGE:"
        },
        {
            "sha": "e27875cdadf650844599aaa687b50a5cd5a207c1",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -29,7 +29,7 @@\n {% if change %}{% if not is_popup %}\n   <ul class=\"object-tools\">\n     {% block object-tools-items %}\n-    <li><a href=\"history/\" class=\"historylink\">{% trans \"History\" %}</a></li>\n+    <li><a href=\"{% url opts|admin_urlname:'history' original.pk %}\" class=\"historylink\">{% trans \"History\" %}</a></li>\n     {% if has_absolute_url %}<li><a href=\"{% url 'admin:view_on_site' content_type_id original.pk %}\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n     {% endblock %}\n   </ul>"
        },
        {
            "sha": "463e0792f0f2d3436a00c3f960139b633a93fbb9",
            "filename": "django/contrib/admin/templatetags/log.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -17,7 +17,7 @@ def render(self, context):\n             user_id = self.user\n             if not user_id.isdigit():\n                 user_id = context[self.user].id\n-            context[self.varname] = LogEntry.objects.filter(user__id__exact=user_id).select_related('content_type', 'user')[:self.limit]\n+            context[self.varname] = LogEntry.objects.filter(user__id__exact=user_id).select_related('content_type', 'user')[:int(self.limit)]\n         return ''\n \n @register.tag"
        },
        {
            "sha": "889f692ac36694d6435218adaeb1882075ae6698",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,7 +12,7 @@\n from django.utils.html import format_html\n from django.utils.text import capfirst\n from django.utils import timezone\n-from django.utils.encoding import force_text, smart_text, smart_bytes\n+from django.utils.encoding import force_str, force_text, smart_text\n from django.utils import six\n from django.utils.translation import ungettext\n from django.core.urlresolvers import reverse\n@@ -277,7 +277,7 @@ def label_for_field(name, model, model_admin=None, return_attr=False):\n             label = force_text(model._meta.verbose_name)\n             attr = six.text_type\n         elif name == \"__str__\":\n-            label = smart_bytes(model._meta.verbose_name)\n+            label = force_str(model._meta.verbose_name)\n             attr = bytes\n         else:\n             if callable(name):"
        },
        {
            "sha": "74ef095b4bcba8e511fe07fb7977ca124fcbdbf5",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,7 +6,7 @@\n from django.db import models\n from django.db.models.fields import FieldDoesNotExist\n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import force_text, smart_bytes\n+from django.utils.encoding import force_str, force_text\n from django.utils.translation import ugettext, ugettext_lazy\n from django.utils.http import urlencode\n \n@@ -94,7 +94,7 @@ def get_filters(self, request):\n                 # 'key' will be used as a keyword argument later, so Python\n                 # requires it to be a string.\n                 del lookup_params[key]\n-                lookup_params[smart_bytes(key)] = value\n+                lookup_params[force_str(key)] = value\n \n             if not self.model_admin.lookup_allowed(key, value):\n                 raise SuspiciousOperation(\"Filtering by %s not allowed\" % key)\n@@ -148,7 +148,7 @@ def get_query_string(self, new_params=None, remove=None):\n         if remove is None: remove = []\n         p = self.params.copy()\n         for r in remove:\n-            for k in p.keys():\n+            for k in list(p):\n                 if k.startswith(r):\n                     del p[k]\n         for k, v in new_params.items():"
        },
        {
            "sha": "9be0093dfccc0cfec7a108ee393819192cd1bc0c",
            "filename": "django/contrib/admindocs/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmindocs%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fadmindocs%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Futils.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,7 +6,7 @@\n \n from django.utils.safestring import mark_safe\n from django.core.urlresolvers import reverse\n-from django.utils.encoding import smart_bytes\n+from django.utils.encoding import force_bytes\n try:\n     import docutils.core\n     import docutils.nodes\n@@ -66,7 +66,7 @@ def parse_rst(text, default_reference_context, thing_being_parsed=None):\n         \"link_base\" : reverse('django-admindocs-docroot').rstrip('/')\n     }\n     if thing_being_parsed:\n-        thing_being_parsed = smart_bytes(\"<%s>\" % thing_being_parsed)\n+        thing_being_parsed = force_bytes(\"<%s>\" % thing_being_parsed)\n     parts = docutils.core.publish_parts(text, source_path=thing_being_parsed,\n                 destination_path=None, writer_name='html',\n                 settings_overrides=overrides)"
        },
        {
            "sha": "beeb284998cdbb2aaa78024c30c8d3e8955d34b2",
            "filename": "django/contrib/auth/decorators.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fdecorators.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,6 +7,7 @@\n from django.contrib.auth import REDIRECT_FIELD_NAME\n from django.core.exceptions import PermissionDenied\n from django.utils.decorators import available_attrs\n+from django.utils.encoding import force_str\n \n \n def user_passes_test(test_func, login_url=None, redirect_field_name=REDIRECT_FIELD_NAME):\n@@ -22,9 +23,11 @@ def _wrapped_view(request, *args, **kwargs):\n             if test_func(request.user):\n                 return view_func(request, *args, **kwargs)\n             path = request.build_absolute_uri()\n+            # urlparse chokes on lazy objects in Python 3\n+            login_url_as_str = force_str(login_url or settings.LOGIN_URL)\n             # If the login url is the same scheme and net location then just\n             # use the path as the \"next\" url.\n-            login_scheme, login_netloc = urlparse(login_url or settings.LOGIN_URL)[:2]\n+            login_scheme, login_netloc = urlparse(login_url_as_str)[:2]\n             current_scheme, current_netloc = urlparse(path)[:2]\n             if ((not login_scheme or login_scheme == current_scheme) and\n                 (not login_netloc or login_netloc == current_netloc)):"
        },
        {
            "sha": "75b3ca4ece51394aa2b93f9a20d55ee07e328438",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -63,16 +63,16 @@ class UserCreationForm(forms.ModelForm):\n     }\n     username = forms.RegexField(label=_(\"Username\"), max_length=30,\n         regex=r'^[\\w.@+-]+$',\n-        help_text = _(\"Required. 30 characters or fewer. Letters, digits and \"\n+        help_text=_(\"Required. 30 characters or fewer. Letters, digits and \"\n                       \"@/./+/-/_ only.\"),\n-        error_messages = {\n+        error_messages={\n             'invalid': _(\"This value may contain only letters, numbers and \"\n                          \"@/./+/-/_ characters.\")})\n     password1 = forms.CharField(label=_(\"Password\"),\n         widget=forms.PasswordInput)\n     password2 = forms.CharField(label=_(\"Password confirmation\"),\n         widget=forms.PasswordInput,\n-        help_text = _(\"Enter the same password as above, for verification.\"))\n+        help_text=_(\"Enter the same password as above, for verification.\"))\n \n     class Meta:\n         model = User\n@@ -107,9 +107,9 @@ def save(self, commit=True):\n class UserChangeForm(forms.ModelForm):\n     username = forms.RegexField(\n         label=_(\"Username\"), max_length=30, regex=r\"^[\\w.@+-]+$\",\n-        help_text = _(\"Required. 30 characters or fewer. Letters, digits and \"\n+        help_text=_(\"Required. 30 characters or fewer. Letters, digits and \"\n                       \"@/./+/-/_ only.\"),\n-        error_messages = {\n+        error_messages={\n             'invalid': _(\"This value may contain only letters, numbers and \"\n                          \"@/./+/-/_ characters.\")})\n     password = ReadOnlyPasswordHashField(label=_(\"Password\"),"
        },
        {
            "sha": "bd0c6778c9274763f0c8ecfd23bb3822d3545c10",
            "filename": "django/contrib/auth/hashers.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fhashers.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fhashers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fhashers.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,7 +8,7 @@\n from django.test.signals import setting_changed\n from django.utils import importlib\n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import smart_bytes\n+from django.utils.encoding import force_bytes\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.crypto import (\n     pbkdf2, constant_time_compare, get_random_string)\n@@ -219,7 +219,7 @@ def encode(self, password, salt, iterations=None):\n         if not iterations:\n             iterations = self.iterations\n         hash = pbkdf2(password, salt, iterations, digest=self.digest)\n-        hash = base64.b64encode(hash).strip()\n+        hash = base64.b64encode(hash).decode('ascii').strip()\n         return \"%s$%d$%s$%s\" % (self.algorithm, iterations, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -299,7 +299,7 @@ class SHA1PasswordHasher(BasePasswordHasher):\n     def encode(self, password, salt):\n         assert password\n         assert salt and '$' not in salt\n-        hash = hashlib.sha1(smart_bytes(salt + password)).hexdigest()\n+        hash = hashlib.sha1(force_bytes(salt + password)).hexdigest()\n         return \"%s$%s$%s\" % (self.algorithm, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -327,7 +327,7 @@ class MD5PasswordHasher(BasePasswordHasher):\n     def encode(self, password, salt):\n         assert password\n         assert salt and '$' not in salt\n-        hash = hashlib.md5(smart_bytes(salt + password)).hexdigest()\n+        hash = hashlib.md5(force_bytes(salt + password)).hexdigest()\n         return \"%s$%s$%s\" % (self.algorithm, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -361,7 +361,7 @@ def salt(self):\n         return ''\n \n     def encode(self, password, salt):\n-        return hashlib.md5(smart_bytes(password)).hexdigest()\n+        return hashlib.md5(force_bytes(password)).hexdigest()\n \n     def verify(self, password, encoded):\n         encoded_2 = self.encode(password, '')"
        },
        {
            "sha": "23a053d985c6e9e9bfdda4c8fac66e5f49f5e443",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,6 +9,7 @@\n from django.contrib.auth import models as auth_app\n from django.db.models import get_models, signals\n from django.contrib.auth.models import User\n+from django.utils import six\n from django.utils.six.moves import input\n \n \n@@ -85,13 +86,22 @@ def get_system_username():\n         username could not be determined.\n     \"\"\"\n     try:\n-        return getpass.getuser().decode(locale.getdefaultlocale()[1])\n-    except (ImportError, KeyError, UnicodeDecodeError):\n+        result = getpass.getuser()\n+    except (ImportError, KeyError):\n         # KeyError will be raised by os.getpwuid() (called by getuser())\n         # if there is no corresponding entry in the /etc/passwd file\n         # (a very restricted chroot environment, for example).\n-        # UnicodeDecodeError - preventive treatment for non-latin Windows.\n         return ''\n+    if not six.PY3:\n+        default_locale = locale.getdefaultlocale()[1]\n+        if not default_locale:\n+            return ''\n+        try:\n+            result = result.decode(default_locale)\n+        except UnicodeDecodeError:\n+            # UnicodeDecodeError - preventive treatment for non-latin Windows.\n+            return ''\n+    return result\n \n \n def get_default_username(check_db=True):\n@@ -108,7 +118,7 @@ def get_default_username(check_db=True):\n     default_username = get_system_username()\n     try:\n         default_username = unicodedata.normalize('NFKD', default_username)\\\n-            .encode('ascii', 'ignore').replace(' ', '').lower()\n+            .encode('ascii', 'ignore').decode('ascii').replace(' ', '').lower()\n     except UnicodeDecodeError:\n         return ''\n     if not RE_VALID_USERNAME.match(default_username):"
        },
        {
            "sha": "1c21917a8c56ea98340e9f8cc84cfa20feabf5d0",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -16,6 +16,7 @@\n     check_password, make_password, is_password_usable, UNUSABLE_PASSWORD)\n from django.contrib.auth.signals import user_logged_in\n from django.contrib.contenttypes.models import ContentType\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n def update_last_login(sender, user, **kwargs):\n@@ -41,6 +42,7 @@ def get_by_natural_key(self, codename, app_label, model):\n         )\n \n \n+@python_2_unicode_compatible\n class Permission(models.Model):\n     \"\"\"\n     The permissions system provides a way to assign permissions to specific\n@@ -76,7 +78,7 @@ class Meta:\n         ordering = ('content_type__app_label', 'content_type__model',\n                     'codename')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s | %s | %s\" % (\n             six.text_type(self.content_type.app_label),\n             six.text_type(self.content_type),\n@@ -94,6 +96,7 @@ class GroupManager(models.Manager):\n     def get_by_natural_key(self, name):\n         return self.get(name=name)\n \n+@python_2_unicode_compatible\n class Group(models.Model):\n     \"\"\"\n     Groups are a generic way of categorizing users to apply permissions, or\n@@ -121,7 +124,7 @@ class Meta:\n         verbose_name = _('group')\n         verbose_name_plural = _('groups')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n     def natural_key(self):\n@@ -221,6 +224,7 @@ def _user_has_module_perms(user, app_label):\n     return False\n \n \n+@python_2_unicode_compatible\n class User(models.Model):\n     \"\"\"\n     Users within the Django authentication system are represented by this\n@@ -259,7 +263,7 @@ class Meta:\n         verbose_name = _('user')\n         verbose_name_plural = _('users')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.username\n \n     def natural_key(self):\n@@ -403,6 +407,7 @@ def get_profile(self):\n         return self._profile_cache\n \n \n+@python_2_unicode_compatible\n class AnonymousUser(object):\n     id = None\n     pk = None\n@@ -416,11 +421,8 @@ class AnonymousUser(object):\n     def __init__(self):\n         pass\n \n-    def __unicode__(self):\n-        return 'AnonymousUser'\n-\n     def __str__(self):\n-        return six.text_type(self).encode('utf-8')\n+        return 'AnonymousUser'\n \n     def __eq__(self, other):\n         return isinstance(other, self.__class__)"
        },
        {
            "sha": "710754b8f1ed5e40a8ab24990f4f7bae5d803ea2",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 38,
            "deletions": 6,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,13 +1,11 @@\n+import locale\n+import traceback\n+\n+from django.contrib.auth.management.commands import createsuperuser\n from django.contrib.auth.models import User, AnonymousUser\n from django.core.management import call_command\n from django.test import TestCase\n from django.utils.six import StringIO\n-from django.utils.unittest import skipUnless\n-\n-try:\n-    import crypt as crypt_module\n-except ImportError:\n-    crypt_module = None\n \n \n class BasicTestCase(TestCase):\n@@ -111,3 +109,37 @@ def test_createsuperuser_management_command(self):\n         u = User.objects.get(username=\"joe+admin@somewhere.org\")\n         self.assertEqual(u.email, 'joe@somewhere.org')\n         self.assertFalse(u.has_usable_password())\n+\n+    def test_createsuperuser_nolocale(self):\n+        \"\"\"\n+        Check that createsuperuser does not break when no locale is set. See\n+        ticket #16017.\n+        \"\"\"\n+\n+        old_getdefaultlocale = locale.getdefaultlocale\n+        old_getpass = createsuperuser.getpass\n+        try:\n+            # Temporarily remove locale information\n+            locale.getdefaultlocale = lambda: (None, None)\n+\n+            # Temporarily replace getpass to allow interactive code to be used\n+            # non-interactively\n+            class mock_getpass: pass\n+            mock_getpass.getpass = staticmethod(lambda p=None: \"nopasswd\")\n+            createsuperuser.getpass = mock_getpass\n+\n+            # Call the command in this new environment\n+            new_io = StringIO()\n+            call_command(\"createsuperuser\", interactive=True, username=\"nolocale@somewhere.org\", email=\"nolocale@somewhere.org\", stdout=new_io)\n+\n+        except TypeError as e:\n+            self.fail(\"createsuperuser fails if the OS provides no information about the current locale\")\n+\n+        finally:\n+            # Re-apply locale and getpass information\n+            createsuperuser.getpass = old_getpass\n+            locale.getdefaultlocale = old_getdefaultlocale\n+\n+        # If we were successful, a user should have been created\n+        u = User.objects.get(username=\"nolocale@somewhere.org\")\n+        self.assertEqual(u.email, 'nolocale@somewhere.org')"
        },
        {
            "sha": "ac83086dc3ea00d05b448d4ced2bb70cc2235bc1",
            "filename": "django/contrib/auth/tests/management.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,16 +4,20 @@\n from django.contrib.auth.management.commands import changepassword\n from django.core.management.base import CommandError\n from django.test import TestCase\n+from django.utils import six\n from django.utils.six import StringIO\n \n \n class GetDefaultUsernameTestCase(TestCase):\n \n     def setUp(self):\n-        self._getpass_getuser = management.get_system_username\n+        self.old_get_system_username = management.get_system_username\n \n     def tearDown(self):\n-        management.get_system_username = self._getpass_getuser\n+        management.get_system_username = self.old_get_system_username\n+\n+    def test_actual_implementation(self):\n+        self.assertIsInstance(management.get_system_username(), six.text_type)\n \n     def test_simple(self):\n         management.get_system_username = lambda: 'joe'"
        },
        {
            "sha": "44117a4f846199cf187bd53026c6881fc18a093c",
            "filename": "django/contrib/auth/tests/tokens.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,9 +1,11 @@\n+import sys\n from datetime import date, timedelta\n \n from django.conf import settings\n from django.contrib.auth.models import User\n from django.contrib.auth.tokens import PasswordResetTokenGenerator\n from django.test import TestCase\n+from django.utils import unittest\n \n \n class TokenGeneratorTest(TestCase):\n@@ -51,6 +53,7 @@ def _today(self):\n         p2 = Mocked(date.today() + timedelta(settings.PASSWORD_RESET_TIMEOUT_DAYS + 1))\n         self.assertFalse(p2.check_token(user, tk1))\n \n+    @unittest.skipIf(sys.version_info[:2] >= (3, 0), \"Unnecessary test with Python 3\")\n     def test_date_length(self):\n         \"\"\"\n         Make sure we don't allow overly long dates, causing a potential DoS."
        },
        {
            "sha": "f93541b4bf9266883ecc5d07056cab7671ef5e34",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,6 +7,7 @@\n from django.core.urlresolvers import reverse\n from django.http import HttpResponseRedirect, QueryDict\n from django.template.response import TemplateResponse\n+from django.utils.encoding import force_str\n from django.utils.http import base36_to_int\n from django.utils.translation import ugettext as _\n from django.views.decorators.debug import sensitive_post_parameters\n@@ -116,10 +117,10 @@ def redirect_to_login(next, login_url=None,\n     \"\"\"\n     Redirects the user to the login page, passing the given 'next' page\n     \"\"\"\n-    if not login_url:\n-        login_url = settings.LOGIN_URL\n+    # urlparse chokes on lazy objects in Python 3\n+    login_url_as_str = force_str(login_url or settings.LOGIN_URL)\n \n-    login_url_parts = list(urlparse(login_url))\n+    login_url_parts = list(urlparse(login_url_as_str))\n     if redirect_field_name:\n         querystring = QueryDict(login_url_parts[4], mutable=True)\n         querystring[redirect_field_name] = next\n@@ -200,7 +201,7 @@ def password_reset_confirm(request, uidb36=None, token=None,\n     try:\n         uid_int = base36_to_int(uidb36)\n         user = User.objects.get(id=uid_int)\n-    except (ValueError, User.DoesNotExist):\n+    except (ValueError, OverflowError, User.DoesNotExist):\n         user = None\n \n     if user is not None and token_generator.check_token(user, token):"
        },
        {
            "sha": "b043b4187a4c5f46f15651d9ac8538c1f8069587",
            "filename": "django/contrib/comments/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,6 +8,7 @@\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n from django.conf import settings\n+from django.utils.encoding import python_2_unicode_compatible\n \n COMMENT_MAX_LENGTH = getattr(settings,'COMMENT_MAX_LENGTH',3000)\n \n@@ -39,6 +40,7 @@ def get_content_object_url(self):\n             args=(self.content_type_id, self.object_pk)\n         )\n \n+@python_2_unicode_compatible\n class Comment(BaseCommentAbstractModel):\n     \"\"\"\n     A user comment about some object.\n@@ -76,7 +78,7 @@ class Meta:\n         verbose_name = _('comment')\n         verbose_name_plural = _('comments')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s: %s...\" % (self.name, self.comment[:50])\n \n     def save(self, *args, **kwargs):\n@@ -153,6 +155,7 @@ def get_as_text(self):\n         }\n         return _('Posted by %(user)s at %(date)s\\n\\n%(comment)s\\n\\nhttp://%(domain)s%(url)s') % d\n \n+@python_2_unicode_compatible\n class CommentFlag(models.Model):\n     \"\"\"\n     Records a flag on a comment. This is intentionally flexible; right now, a\n@@ -182,7 +185,7 @@ class Meta:\n         verbose_name = _('comment flag')\n         verbose_name_plural = _('comment flags')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s flag of comment ID %s by %s\" % \\\n             (self.flag, self.comment_id, self.user.username)\n "
        },
        {
            "sha": "b658655bbbc6c638b40ede8b92b152d1db234ff2",
            "filename": "django/contrib/contenttypes/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,6 +1,7 @@\n from django.db import models\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_text, force_text\n+from django.utils.encoding import python_2_unicode_compatible\n \n class ContentTypeManager(models.Manager):\n \n@@ -122,6 +123,7 @@ def _add_to_cache(self, using, ct):\n         self.__class__._cache.setdefault(using, {})[key] = ct\n         self.__class__._cache.setdefault(using, {})[ct.id] = ct\n \n+@python_2_unicode_compatible\n class ContentType(models.Model):\n     name = models.CharField(max_length=100)\n     app_label = models.CharField(max_length=100)\n@@ -135,7 +137,7 @@ class Meta:\n         ordering = ('name',)\n         unique_together = (('app_label', 'model'),)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         # self.name is deprecated in favor of using model's verbose_name, which\n         # can be translated. Formal deprecation is delayed until we have DB\n         # migration to be able to remove the field from the database along with"
        },
        {
            "sha": "2f92a345817707d4cf47a34bd8b3edf2ff4867da",
            "filename": "django/contrib/contenttypes/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,6 +8,7 @@\n from django.test import TestCase\n from django.utils.http import urlquote\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class ConcreteModel(models.Model):\n@@ -17,13 +18,14 @@ class ProxyModel(ConcreteModel):\n     class Meta:\n         proxy = True\n \n+@python_2_unicode_compatible\n class FooWithoutUrl(models.Model):\n     \"\"\"\n     Fake model not defining ``get_absolute_url`` for\n     :meth:`ContentTypesTests.test_shortcut_view_without_get_absolute_url`\"\"\"\n     name = models.CharField(max_length=30, unique=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n "
        },
        {
            "sha": "5f5f46f0d1b0157803ca8677b72d957b3641db5a",
            "filename": "django/contrib/databrowse/datastructures.py",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,8 +7,9 @@\n from django.db import models\n from django.utils import formats\n from django.utils.text import capfirst\n-from django.utils.encoding import smart_text, smart_bytes, iri_to_uri\n+from django.utils.encoding import smart_text, force_str, iri_to_uri\n from django.db.models.query import QuerySet\n+from django.utils.encoding import python_2_unicode_compatible\n \n EMPTY_VALUE = '(None)'\n DISPLAY_SIZE = 100\n@@ -22,7 +23,7 @@ def __init__(self, site, model):\n         self.verbose_name_plural = model._meta.verbose_name_plural\n \n     def __repr__(self):\n-        return '<EasyModel for %s>' % smart_bytes(self.model._meta.object_name)\n+        return force_str('<EasyModel for %s>' % self.model._meta.object_name)\n \n     def model_databrowse(self):\n         \"Returns the ModelDatabrowse class for this model.\"\n@@ -61,7 +62,7 @@ def __init__(self, easy_model, field):\n         self.model, self.field = easy_model, field\n \n     def __repr__(self):\n-        return smart_bytes('<EasyField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n+        return force_str('<EasyField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def choices(self):\n         for value, label in self.field.choices:\n@@ -79,27 +80,25 @@ def __init__(self, easy_model, field, value, label):\n         self.value, self.label = value, label\n \n     def __repr__(self):\n-        return smart_bytes('<EasyChoice for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n+        return force_str('<EasyChoice for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def url(self):\n         return '%s%s/%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.field.name, iri_to_uri(self.value))\n \n+@python_2_unicode_compatible\n class EasyInstance(object):\n     def __init__(self, easy_model, instance):\n         self.model, self.instance = easy_model, instance\n \n     def __repr__(self):\n-        return smart_bytes('<EasyInstance for %s (%s)>' % (self.model.model._meta.object_name, self.instance._get_pk_val()))\n+        return force_str('<EasyInstance for %s (%s)>' % (self.model.model._meta.object_name, self.instance._get_pk_val()))\n \n-    def __unicode__(self):\n+    def __str__(self):\n         val = smart_text(self.instance)\n         if len(val) > DISPLAY_SIZE:\n             return val[:DISPLAY_SIZE] + '...'\n         return val\n \n-    def __str__(self):\n-        return self.__unicode__().encode('utf-8')\n-\n     def pk(self):\n         return self.instance._get_pk_val()\n \n@@ -136,7 +135,7 @@ def __init__(self, easy_model, instance, field):\n         self.raw_value = getattr(instance.instance, field.name)\n \n     def __repr__(self):\n-        return smart_bytes('<EasyInstanceField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n+        return force_str('<EasyInstanceField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def values(self):\n         \"\"\""
        },
        {
            "sha": "d649b4af6794e513bb10aa5b9334f3d0e1b1488f",
            "filename": "django/contrib/databrowse/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fdatabrowse%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fdatabrowse%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,26 +1,30 @@\n from django.contrib import databrowse\n from django.db import models\n from django.test import TestCase\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class SomeModel(models.Model):\n     some_field = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.some_field\n \n \n+@python_2_unicode_compatible\n class SomeOtherModel(models.Model):\n     some_other_field = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.some_other_field\n \n \n+@python_2_unicode_compatible\n class YetAnotherModel(models.Model):\n     yet_another_field = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.yet_another_field\n \n "
        },
        {
            "sha": "3a5b4d61354a44313b4da3fc6b8cf97a95d60e31",
            "filename": "django/contrib/flatpages/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fflatpages%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fflatpages%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,8 +3,10 @@\n from django.db import models\n from django.contrib.sites.models import Site\n from django.utils.translation import ugettext_lazy as _\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class FlatPage(models.Model):\n     url = models.CharField(_('URL'), max_length=100, db_index=True)\n     title = models.CharField(_('title'), max_length=200)\n@@ -21,7 +23,7 @@ class Meta:\n         verbose_name_plural = _('flat pages')\n         ordering = ('url',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s -- %s\" % (self.url, self.title)\n \n     def get_absolute_url(self):"
        },
        {
            "sha": "15941332edd61c733507c0e342027c69bc7809b9",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 43,
            "deletions": 18,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,6 +1,9 @@\n+# -*- coding: utf-8 -*-\n from __future__ import unicode_literals\n \n+import datetime\n import os\n+import pickle\n import re\n import warnings\n \n@@ -16,6 +19,7 @@\n from django.contrib.formtools.tests.forms import *\n \n success_string = \"Done was called!\"\n+success_string_encoded = success_string.encode()\n \n class TestFormPreview(preview.FormPreview):\n     def get_context(self, request, form):\n@@ -78,7 +82,7 @@ def test_form_preview(self):\n         \"\"\"\n         # Pass strings for form submittal and add stage variable to\n         # show we previously saw first stage of the form.\n-        self.test_data.update({'stage': 1})\n+        self.test_data.update({'stage': 1, 'date1': datetime.date(2006, 10, 25)})\n         response = self.client.post('/preview/', self.test_data)\n         # Check to confirm stage is set to 2 in output form.\n         stage = self.input % 2\n@@ -96,13 +100,13 @@ def test_form_submit(self):\n         \"\"\"\n         # Pass strings for form submittal and add stage variable to\n         # show we previously saw first stage of the form.\n-        self.test_data.update({'stage':2})\n+        self.test_data.update({'stage': 2, 'date1': datetime.date(2006, 10, 25)})\n         response = self.client.post('/preview/', self.test_data)\n-        self.assertNotEqual(response.content, success_string)\n+        self.assertNotEqual(response.content, success_string_encoded)\n         hash = self.preview.security_hash(None, TestForm(self.test_data))\n         self.test_data.update({'hash': hash})\n         response = self.client.post('/preview/', self.test_data)\n-        self.assertEqual(response.content, success_string)\n+        self.assertEqual(response.content, success_string_encoded)\n \n     def test_bool_submit(self):\n         \"\"\"\n@@ -122,7 +126,7 @@ def test_bool_submit(self):\n         self.test_data.update({'hash': hash, 'bool1': 'False'})\n         with warnings.catch_warnings(record=True):\n             response = self.client.post('/preview/', self.test_data)\n-            self.assertEqual(response.content, success_string)\n+            self.assertEqual(response.content, success_string_encoded)\n \n     def test_form_submit_good_hash(self):\n         \"\"\"\n@@ -133,11 +137,11 @@ def test_form_submit_good_hash(self):\n         # show we previously saw first stage of the form.\n         self.test_data.update({'stage':2})\n         response = self.client.post('/preview/', self.test_data)\n-        self.assertNotEqual(response.content, success_string)\n+        self.assertNotEqual(response.content, success_string_encoded)\n         hash = utils.form_hmac(TestForm(self.test_data))\n         self.test_data.update({'hash': hash})\n         response = self.client.post('/preview/', self.test_data)\n-        self.assertEqual(response.content, success_string)\n+        self.assertEqual(response.content, success_string_encoded)\n \n \n     def test_form_submit_bad_hash(self):\n@@ -150,11 +154,11 @@ def test_form_submit_bad_hash(self):\n         self.test_data.update({'stage':2})\n         response = self.client.post('/preview/', self.test_data)\n         self.assertEqual(response.status_code, 200)\n-        self.assertNotEqual(response.content, success_string)\n+        self.assertNotEqual(response.content, success_string_encoded)\n         hash = utils.form_hmac(TestForm(self.test_data)) + \"bad\"\n         self.test_data.update({'hash': hash})\n         response = self.client.post('/previewpreview/', self.test_data)\n-        self.assertNotEqual(response.content, success_string)\n+        self.assertNotEqual(response.content, success_string_encoded)\n \n \n class FormHmacTests(unittest.TestCase):\n@@ -165,8 +169,8 @@ def test_textfield_hash(self):\n         leading/trailing whitespace so as to be friendly to broken browsers that\n         submit it (usually in textareas).\n         \"\"\"\n-        f1 = HashTestForm({'name': 'joe', 'bio': 'Nothing notable.'})\n-        f2 = HashTestForm({'name': '  joe', 'bio': 'Nothing notable.  '})\n+        f1 = HashTestForm({'name': 'joe', 'bio': 'Speaking espaol.'})\n+        f2 = HashTestForm({'name': '  joe', 'bio': 'Speaking espaol.  '})\n         hash1 = utils.form_hmac(f1)\n         hash2 = utils.form_hmac(f2)\n         self.assertEqual(hash1, hash2)\n@@ -270,7 +274,10 @@ def test_good_hash(self):\n         \"\"\"\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         response = self.client.post('/wizard1/', data)\n         self.assertEqual(2, response.context['step0'])\n@@ -295,15 +302,24 @@ def process_step(self, request, form, step):\n         wizard = WizardWithProcessStep([WizardPageOneForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n \n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n-                \"hash_1\": \"1e6f6315da42e62f33a30640ec7e007ad3fbf1a1\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n+                \"hash_1\": {\n+                    2: \"1e6f6315da42e62f33a30640ec7e007ad3fbf1a1\",\n+                    3: \"c33142ef9d01b1beae238adf22c3c6c57328f51a\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"2\"}\n         self.assertRaises(http.Http404, wizard, DummyRequest(POST=data))\n \n@@ -325,7 +341,10 @@ def process_step(self, request, form, step):\n                                         WizardPageThreeForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n@@ -349,7 +368,10 @@ def done(self, request, form_list):\n \n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n@@ -375,7 +397,10 @@ def process_step(self, request, form, step):\n                                         WizardPageThreeForm])\n         data = {\"0-field\": \"test\",\n                 \"1-field\": \"test2\",\n-                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_0\": {\n+                    2: \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                    3: \"9355d5dff22d49dbad58e46189982cec649f9f5b\",\n+                }[pickle.HIGHEST_PROTOCOL],\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])"
        },
        {
            "sha": "1ed2ab48bb98959ec8ebb4883971d85508987d89",
            "filename": "django/contrib/formtools/tests/forms.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fforms.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -21,6 +21,7 @@ class TestForm(forms.Form):\n     field1 = forms.CharField()\n     field1_ = forms.CharField()\n     bool1 = forms.BooleanField(required=False)\n+    date1 = forms.DateField(required=False)\n \n class HashTestForm(forms.Form):\n     name = forms.CharField()"
        },
        {
            "sha": "7529d89a2c418e77fdf96972e0f684c4b5400eba",
            "filename": "django/contrib/formtools/tests/wizard/namedwizardtests/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fnamedwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fnamedwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fnamedwizardtests%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -122,6 +122,7 @@ def test_form_finish(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'].close()\n         post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(\n             reverse(self.wizard_urlname,\n@@ -149,7 +150,9 @@ def test_form_finish(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['form_list']\n-        self.assertEqual(all_data[1]['file1'].read(), open(__file__, 'rb').read())\n+        with open(__file__, 'rb') as f:\n+            self.assertEqual(all_data[1]['file1'].read(), f.read())\n+        all_data[1]['file1'].close()\n         del all_data[1]['file1']\n         self.assertEqual(all_data, [\n             {'name': 'Pony', 'thirsty': True, 'user': self.testuser},\n@@ -182,9 +185,10 @@ def test_cleaned_data(self):\n         response = self.client.get(step2_url)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n-        self.assertEqual(\n-            response.context['wizard']['form'].files['form2-file1'].read(),\n-            open(__file__, 'rb').read())\n+        with open(__file__, 'rb') as f:\n+            self.assertEqual(\n+                response.context['wizard']['form'].files['form2-file1'].read(),\n+                f.read())\n \n         response = self.client.post(\n             reverse(self.wizard_urlname,\n@@ -201,7 +205,9 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['all_cleaned_data']\n-        self.assertEqual(all_data['file1'].read(), open(__file__, 'rb').read())\n+        with open(__file__, 'rb') as f:\n+            self.assertEqual(all_data['file1'].read(), f.read())\n+        all_data['file1'].close()\n         del all_data['file1']\n         self.assertEqual(\n             all_data,\n@@ -225,6 +231,7 @@ def test_manipulated_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'].close()\n         post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(\n             reverse(self.wizard_urlname,"
        },
        {
            "sha": "586bd59341e6bbe2843f7a280bb8660e4a1dc639",
            "filename": "django/contrib/formtools/tests/wizard/wizardtests/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -95,7 +95,9 @@ def test_form_finish(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['form_list']\n-        self.assertEqual(all_data[1]['file1'].read(), open(__file__, 'rb').read())\n+        with open(__file__, 'rb') as f:\n+            self.assertEqual(all_data[1]['file1'].read(), f.read())\n+        all_data[1]['file1'].close()\n         del all_data[1]['file1']\n         self.assertEqual(all_data, [\n             {'name': 'Pony', 'thirsty': True, 'user': self.testuser},\n@@ -112,8 +114,9 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__, 'rb')\n-        response = self.client.post(self.wizard_url, post_data)\n+        with open(__file__, 'rb') as post_file:\n+            post_data['form2-file1'] = post_file\n+            response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n \n         response = self.client.post(self.wizard_url, self.wizard_step_data[2])\n@@ -123,7 +126,9 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['all_cleaned_data']\n-        self.assertEqual(all_data['file1'].read(), open(__file__, 'rb').read())\n+        with open(__file__, 'rb') as f:\n+            self.assertEqual(all_data['file1'].read(), f.read())\n+        all_data['file1'].close()\n         del all_data['file1']\n         self.assertEqual(all_data, {\n             'name': 'Pony', 'thirsty': True, 'user': self.testuser,\n@@ -140,6 +145,7 @@ def test_manipulated_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'].close()\n         post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n@@ -167,6 +173,7 @@ def test_form_refresh(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'].close()\n         post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)"
        },
        {
            "sha": "76277c6b49e9b638dcbfa2f14f01f4bf15f1d6fa",
            "filename": "django/contrib/formtools/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Futils.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n # Do not try cPickle here (see #18340)\n import pickle\n "
        },
        {
            "sha": "aafc83348479c39c697660fa2c68f18bdb4c0be5",
            "filename": "django/contrib/formtools/wizard/storage/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,6 +1,5 @@\n from django.core.files.uploadedfile import UploadedFile\n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import smart_bytes\n from django.utils.functional import lazy_property\n from django.utils import six\n \n@@ -74,8 +73,7 @@ def get_step_files(self, step):\n \n         files = {}\n         for field, field_dict in six.iteritems(wizard_files):\n-            field_dict = dict((smart_bytes(k), v)\n-                              for k, v in six.iteritems(field_dict))\n+            field_dict = field_dict.copy()\n             tmp_name = field_dict.pop('tmp_name')\n             files[field] = UploadedFile(\n                 file=self.file_storage.open(tmp_name), **field_dict)"
        },
        {
            "sha": "f7af420a8d4a2376ef8ee9aaef98b5231bf13f39",
            "filename": "django/contrib/gis/db/backends/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,6 +5,7 @@\n import re\n from django.contrib.gis import gdal\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n class BaseSpatialOperations(object):\n     \"\"\"\n@@ -131,6 +132,7 @@ def geometry_columns(self):\n     def spatial_ref_sys(self):\n         raise NotImplementedError\n \n+@python_2_unicode_compatible\n class SpatialRefSysMixin(object):\n     \"\"\"\n     The SpatialRefSysMixin is a class used by the database-dependent\n@@ -325,7 +327,7 @@ def get_spheroid(cls, wkt, string=True):\n                 radius, flattening = sphere_params\n             return 'SPHEROID[\"%s\",%s,%s]' % (sphere_name, radius, flattening)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         \"\"\"\n         Returns the string representation.  If GDAL is installed,\n         it will be 'pretty' OGC WKT."
        },
        {
            "sha": "b7deb3a9461a132ff9e7cacc925e01a2fa9058a9",
            "filename": "django/contrib/gis/db/backends/oracle/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,7 +9,9 @@\n \"\"\"\n from django.contrib.gis.db import models\n from django.contrib.gis.db.backends.base import SpatialRefSysMixin\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class GeometryColumns(models.Model):\n     \"Maps to the Oracle USER_SDO_GEOM_METADATA table.\"\n     table_name = models.CharField(max_length=32)\n@@ -36,7 +38,7 @@ def geom_col_name(cls):\n         \"\"\"\n         return 'column_name'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s - %s (SRID: %s)' % (self.table_name, self.column_name, self.srid)\n \n class SpatialRefSys(models.Model, SpatialRefSysMixin):"
        },
        {
            "sha": "e8052594c65adfdac4c4e99f213e83cc80c6936b",
            "filename": "django/contrib/gis/db/backends/postgis/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,7 +3,9 @@\n \"\"\"\n from django.db import models\n from django.contrib.gis.db.backends.base import SpatialRefSysMixin\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class GeometryColumns(models.Model):\n     \"\"\"\n     The 'geometry_columns' table from the PostGIS. See the PostGIS\n@@ -37,7 +39,7 @@ def geom_col_name(cls):\n         \"\"\"\n         return 'f_geometry_column'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s.%s - %dD %s field (SRID: %d)\" % \\\n                (self.f_table_name, self.f_geometry_column,\n                 self.coord_dimension, self.type, self.srid)"
        },
        {
            "sha": "27332b9b57f95eadf36fcd382f2b8916f4b9a74a",
            "filename": "django/contrib/gis/db/backends/spatialite/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -30,6 +30,7 @@ def create_test_db(self, verbosity=1, autoclobber=False):\n \n         self.connection.close()\n         self.connection.settings_dict[\"NAME\"] = test_database_name\n+        self.connection.ops.confirm_spatial_components_versions()\n \n         # Need to load the SpatiaLite initialization SQL before running `syncdb`.\n         self.load_spatialite_sql()"
        },
        {
            "sha": "b281f0bc62b427e995c6b673562ca1b3379ab9d8",
            "filename": "django/contrib/gis/db/backends/spatialite/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,7 +3,9 @@\n \"\"\"\n from django.db import models\n from django.contrib.gis.db.backends.base import SpatialRefSysMixin\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class GeometryColumns(models.Model):\n     \"\"\"\n     The 'geometry_columns' table from SpatiaLite.\n@@ -35,7 +37,7 @@ def geom_col_name(cls):\n         \"\"\"\n         return 'f_geometry_column'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s.%s - %dD %s field (SRID: %d)\" % \\\n                (self.f_table_name, self.f_geometry_column,\n                 self.coord_dimension, self.type, self.srid)"
        },
        {
            "sha": "80f05ef0762006547e1c5fa8ad05554d94274251",
            "filename": "django/contrib/gis/db/backends/spatialite/operations.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -113,6 +113,12 @@ class SpatiaLiteOperations(DatabaseOperations, BaseSpatialOperations):\n     def __init__(self, connection):\n         super(DatabaseOperations, self).__init__(connection)\n \n+        # Creating the GIS terms dictionary.\n+        gis_terms = ['isnull']\n+        gis_terms += self.geometry_functions.keys()\n+        self.gis_terms = dict([(term, None) for term in gis_terms])\n+\n+    def confirm_spatial_components_versions(self):\n         # Determine the version of the SpatiaLite library.\n         try:\n             vtup = self.spatialite_version_tuple()\n@@ -129,11 +135,6 @@ def __init__(self, connection):\n                                        'SQL loaded on this database?' %\n                                        (self.connection.settings_dict['NAME'], msg))\n \n-        # Creating the GIS terms dictionary.\n-        gis_terms = ['isnull']\n-        gis_terms += list(self.geometry_functions)\n-        self.gis_terms = dict([(term, None) for term in gis_terms])\n-\n         if version >= (2, 4, 0):\n             # Spatialite 2.4.0-RC4 added AsGML and AsKML, however both\n             # RC2 (shipped in popular Debian/Ubuntu packages) and RC4"
        },
        {
            "sha": "d87e151aea5dc5d018048eee5ee0f851301e48fa",
            "filename": "django/contrib/gis/db/models/query.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,16 +1,15 @@\n from django.db import connections\n from django.db.models.query import QuerySet, ValuesQuerySet, ValuesListQuerySet\n-from django.utils import six\n \n from django.contrib.gis.db.models import aggregates\n from django.contrib.gis.db.models.fields import get_srid_info, PointField, LineStringField\n from django.contrib.gis.db.models.sql import AreaField, DistanceField, GeomField, GeoQuery\n from django.contrib.gis.geometry.backend import Geometry\n from django.contrib.gis.measure import Area, Distance\n-from django.utils import six\n \n from django.utils import six\n \n+\n class GeoQuerySet(QuerySet):\n     \"The Geographic QuerySet.\"\n "
        },
        {
            "sha": "262d294a4319ddda5a059a35af587291cebdfb00",
            "filename": "django/contrib/gis/gdal/tests/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -19,7 +19,8 @@\n def suite():\n     \"Builds a test suite for the GDAL tests.\"\n     s = TestSuite()\n-    map(s.addTest, test_suites)\n+    for test_suite in test_suites:\n+        s.addTest(test_suite)\n     return s\n \n def run(verbosity=1):"
        },
        {
            "sha": "b82d967da6b481a82514c3e916d8bfa38d507cfd",
            "filename": "django/contrib/gis/maps/google/overlays.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,8 +2,10 @@\n from django.utils.functional import total_ordering\n from django.utils.safestring import mark_safe\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class GEvent(object):\n     \"\"\"\n     A Python wrapper for the Google GEvent object.\n@@ -48,10 +50,11 @@ def __init__(self, event, action):\n         self.event = event\n         self.action = action\n \n-    def __unicode__(self):\n+    def __str__(self):\n         \"Returns the parameter part of a GEvent.\"\n         return mark_safe('\"%s\", %s' %(self.event, self.action))\n \n+@python_2_unicode_compatible\n class GOverlayBase(object):\n     def __init__(self):\n         self.events = []\n@@ -64,7 +67,7 @@ def add_event(self, event):\n         \"Attaches a GEvent to the overlay object.\"\n         self.events.append(event)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         \"The string representation is the JavaScript API call.\"\n         return mark_safe('%s(%s)' % (self.__class__.__name__, self.js_params))\n "
        },
        {
            "sha": "36e48f7d209b11b3ca06f68656b61ef3f90d7e7c",
            "filename": "django/contrib/gis/sitemaps/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fsitemaps%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Fsitemaps%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fsitemaps%2Fviews.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,7 +8,6 @@\n from django.contrib.gis.db.models.fields import GeometryField\n from django.db import connections, DEFAULT_DB_ALIAS\n from django.db.models import get_model\n-from django.utils.encoding import smart_bytes\n from django.utils import six\n from django.utils.translation import ugettext as _\n \n@@ -61,7 +60,7 @@ def sitemap(request, sitemaps, section=None):\n             raise Http404(_(\"Page %s empty\") % page)\n         except PageNotAnInteger:\n             raise Http404(_(\"No page '%s'\") % page)\n-    xml = smart_bytes(loader.render_to_string('gis/sitemaps/geo_sitemap.xml', {'urlset': urls}))\n+    xml = loader.render_to_string('gis/sitemaps/geo_sitemap.xml', {'urlset': urls})\n     return HttpResponse(xml, content_type='application/xml')\n \n def kml(request, label, model, field_name=None, compress=False, using=DEFAULT_DB_ALIAS):"
        },
        {
            "sha": "bf08829eae872faabb717ebe5aa16bcad9124bd0",
            "filename": "django/contrib/gis/tests/distapp/models.py",
            "status": "modified",
            "additions": 15,
            "deletions": 7,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fdistapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fdistapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdistapp%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,50 +1,58 @@\n from django.contrib.gis.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class SouthTexasCity(models.Model):\n     \"City model on projected coordinate system for South Texas.\"\n     name = models.CharField(max_length=30)\n     point = models.PointField(srid=32140)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class SouthTexasCityFt(models.Model):\n     \"Same City model as above, but U.S. survey feet are the units.\"\n     name = models.CharField(max_length=30)\n     point = models.PointField(srid=2278)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class AustraliaCity(models.Model):\n     \"City model for Australia, using WGS84.\"\n     name = models.CharField(max_length=30)\n     point = models.PointField()\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class CensusZipcode(models.Model):\n     \"Model for a few South Texas ZIP codes (in original Census NAD83).\"\n     name = models.CharField(max_length=5)\n     poly = models.PolygonField(srid=4269)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class SouthTexasZipcode(models.Model):\n     \"Model for a few South Texas ZIP codes.\"\n     name = models.CharField(max_length=5)\n     poly = models.PolygonField(srid=32140, null=True)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class Interstate(models.Model):\n     \"Geodetic model for U.S. Interstates.\"\n     name = models.CharField(max_length=10)\n     path = models.LineStringField()\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class SouthTexasInterstate(models.Model):\n     \"Projected model for South Texas Interstates.\"\n     name = models.CharField(max_length=10)\n     path = models.LineStringField(srid=32140)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name"
        },
        {
            "sha": "81e5f55f7805e84f6c669b7734424e4d1dc6acde",
            "filename": "django/contrib/gis/tests/geo3d/models.py",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,59 +1,67 @@\n from django.contrib.gis.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class City3D(models.Model):\n     name = models.CharField(max_length=30)\n     point = models.PointField(dim=3)\n     objects = models.GeoManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Interstate2D(models.Model):\n     name = models.CharField(max_length=30)\n     line = models.LineStringField(srid=4269)\n     objects = models.GeoManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Interstate3D(models.Model):\n     name = models.CharField(max_length=30)\n     line = models.LineStringField(dim=3, srid=4269)\n     objects = models.GeoManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class InterstateProj2D(models.Model):\n     name = models.CharField(max_length=30)\n     line = models.LineStringField(srid=32140)\n     objects = models.GeoManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class InterstateProj3D(models.Model):\n     name = models.CharField(max_length=30)\n     line = models.LineStringField(dim=3, srid=32140)\n     objects = models.GeoManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Polygon2D(models.Model):\n     name = models.CharField(max_length=30)\n     poly = models.PolygonField(srid=32140)\n     objects = models.GeoManager()\n-    \n-    def __unicode__(self):\n+\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Polygon3D(models.Model):\n     name = models.CharField(max_length=30)\n     poly = models.PolygonField(dim=3, srid=32140)\n     objects = models.GeoManager()\n-    \n-    def __unicode__(self):\n+\n+    def __str__(self):\n         return self.name\n \n class Point2D(models.Model):"
        },
        {
            "sha": "af0898823d02c3e320b7a71cb6617e6dcf1fa58a",
            "filename": "django/contrib/gis/tests/geoadmin/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,10 +1,12 @@\n from django.contrib.gis.db import models\n from django.contrib.gis import admin\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class City(models.Model):\n     name = models.CharField(max_length=30)\n     point = models.PointField()\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n admin.site.register(City, admin.OSMGeoAdmin)"
        },
        {
            "sha": "abde509c8bb202ba1833a659db7d3e5f079242a2",
            "filename": "django/contrib/gis/tests/geoapp/models.py",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,49 +1,55 @@\n from django.contrib.gis.db import models\n from django.contrib.gis.tests.utils import mysql, spatialite\n+from django.utils.encoding import python_2_unicode_compatible\n \n # MySQL spatial indices can't handle NULL geometries.\n null_flag = not mysql\n \n+@python_2_unicode_compatible\n class Country(models.Model):\n     name = models.CharField(max_length=30)\n     mpoly = models.MultiPolygonField() # SRID, by default, is 4326\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class City(models.Model):\n     name = models.CharField(max_length=30)\n     point = models.PointField()\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n # This is an inherited model from City\n class PennsylvaniaCity(City):\n     county = models.CharField(max_length=30)\n     founded = models.DateTimeField(null=True)\n     objects = models.GeoManager() # TODO: This should be implicitly inherited.\n \n+@python_2_unicode_compatible\n class State(models.Model):\n     name = models.CharField(max_length=30)\n     poly = models.PolygonField(null=null_flag) # Allowing NULL geometries here.\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class Track(models.Model):\n     name = models.CharField(max_length=30)\n     line = models.LineStringField()\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n class Truth(models.Model):\n     val = models.BooleanField()\n     objects = models.GeoManager()\n \n if not spatialite:\n+    @python_2_unicode_compatible\n     class Feature(models.Model):\n         name = models.CharField(max_length=20)\n         geom = models.GeometryField()\n         objects = models.GeoManager()\n-        def __unicode__(self): return self.name\n+        def __str__(self): return self.name\n \n     class MinusOneSRID(models.Model):\n         geom = models.PointField(srid=-1) # Minus one SRID."
        },
        {
            "sha": "fbe30e884101dae3a0f76b18a18a7e0a4f27ebbb",
            "filename": "django/contrib/gis/tests/geoapp/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -186,6 +186,15 @@ def test_inherited_geofields(self):\n         self.assertEqual(1, qs.count())\n         for pc in qs: self.assertEqual(32128, pc.point.srid)\n \n+    def test_raw_sql_query(self):\n+        \"Testing raw SQL query.\"\n+        cities1 = City.objects.all()\n+        # Only PostGIS would support a 'select *' query because of its recognized\n+        # HEXEWKB format for geometry fields\n+        cities2 = City.objects.raw('select id, name, asText(point) from geoapp_city')\n+        self.assertEqual(len(cities1), len(list(cities2)))\n+        self.assertTrue(isinstance(cities2[0].point, Point))\n+\n \n class GeoLookupTest(TestCase):\n "
        },
        {
            "sha": "7e802f932198543260ee392e556a86a2e0d1279a",
            "filename": "django/contrib/gis/tests/geogapp/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,20 +1,24 @@\n from django.contrib.gis.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class City(models.Model):\n     name = models.CharField(max_length=30)\n     point = models.PointField(geography=True)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n+@python_2_unicode_compatible\n class Zipcode(models.Model):\n     code = models.CharField(max_length=10)\n     poly = models.PolygonField(geography=True)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.code\n+    def __str__(self): return self.code\n \n+@python_2_unicode_compatible\n class County(models.Model):\n     name = models.CharField(max_length=25)\n     state = models.CharField(max_length=20)\n     mpoly = models.MultiPolygonField(geography=True)\n     objects = models.GeoManager()\n-    def __unicode__(self): return ' County, '.join([self.name, self.state])\n+    def __str__(self): return ' County, '.join([self.name, self.state])"
        },
        {
            "sha": "659fef7a938ba0ada0a3523e72e5f67c2ce2a9e0",
            "filename": "django/contrib/gis/tests/relatedapp/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Frelatedapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Ftests%2Frelatedapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Frelatedapp%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,37 +1,41 @@\n from django.contrib.gis.db import models\n from django.contrib.localflavor.us.models import USStateField\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class Location(models.Model):\n     point = models.PointField()\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.point.wkt\n+    def __str__(self): return self.point.wkt\n \n+@python_2_unicode_compatible\n class City(models.Model):\n     name = models.CharField(max_length=50)\n     state = USStateField()\n     location = models.ForeignKey(Location)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n class AugmentedLocation(Location):\n     extra_text = models.TextField(blank=True)\n     objects = models.GeoManager()\n-    \n+\n class DirectoryEntry(models.Model):\n     listing_text = models.CharField(max_length=50)\n     location = models.ForeignKey(AugmentedLocation)\n     objects = models.GeoManager()\n \n+@python_2_unicode_compatible\n class Parcel(models.Model):\n     name = models.CharField(max_length=30)\n     city = models.ForeignKey(City)\n     center1 = models.PointField()\n     # Throwing a curveball w/`db_column` here.\n-    center2 = models.PointField(srid=2276, db_column='mycenter') \n+    center2 = models.PointField(srid=2276, db_column='mycenter')\n     border1 = models.PolygonField()\n     border2 = models.PolygonField(srid=2276)\n     objects = models.GeoManager()\n-    def __unicode__(self): return self.name\n+    def __str__(self): return self.name\n \n # These use the GeoManager but do not have any geographic fields.\n class Author(models.Model):"
        },
        {
            "sha": "4266ee4b4c77e2e08f8d4d61011fb4117140b30e",
            "filename": "django/contrib/gis/utils/ogrinspect.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -223,4 +223,4 @@ def get_kwargs_str(field_name):\n \n     if name_field:\n         yield ''\n-        yield '    def __unicode__(self): return self.%s' % name_field\n+        yield '    def __str__(self): return self.%s' % name_field"
        },
        {
            "sha": "18b7475ca7fc35f6bf98b6573c48d6aadc2c34ea",
            "filename": "django/contrib/markup/templatetags/markup.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -13,7 +13,7 @@\n \n from django import template\n from django.conf import settings\n-from django.utils.encoding import smart_bytes, force_text\n+from django.utils.encoding import force_bytes, force_text\n from django.utils.safestring import mark_safe\n \n register = template.Library()\n@@ -27,7 +27,7 @@ def textile(value):\n             raise template.TemplateSyntaxError(\"Error in 'textile' filter: The Python textile library isn't installed.\")\n         return force_text(value)\n     else:\n-        return mark_safe(force_text(textile.textile(smart_bytes(value), encoding='utf-8', output='utf-8')))\n+        return mark_safe(force_text(textile.textile(force_bytes(value), encoding='utf-8', output='utf-8')))\n \n @register.filter(is_safe=True)\n def markdown(value, arg=''):\n@@ -80,5 +80,5 @@ def restructuredtext(value):\n         return force_text(value)\n     else:\n         docutils_settings = getattr(settings, \"RESTRUCTUREDTEXT_FILTER_SETTINGS\", {})\n-        parts = publish_parts(source=smart_bytes(value), writer_name=\"html4css1\", settings_overrides=docutils_settings)\n+        parts = publish_parts(source=force_bytes(value), writer_name=\"html4css1\", settings_overrides=docutils_settings)\n         return mark_safe(force_text(parts[\"fragment\"]))"
        },
        {
            "sha": "7fe8a077ed714baedc1b04ed718d5e5e07c2bb65",
            "filename": "django/contrib/messages/storage/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fmessages%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fmessages%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Fstorage%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,14 +1,15 @@\n from __future__ import unicode_literals\n \n from django.conf import settings\n-from django.utils.encoding import force_text, StrAndUnicode\n+from django.utils.encoding import force_text, python_2_unicode_compatible\n from django.contrib.messages import constants, utils\n \n \n LEVEL_TAGS = utils.get_level_tags()\n \n \n-class Message(StrAndUnicode):\n+@python_2_unicode_compatible\n+class Message(object):\n     \"\"\"\n     Represents an actual message that can be stored in any of the supported\n     storage classes (typically session- or cookie-based) and rendered in a view\n@@ -35,7 +36,7 @@ def __eq__(self, other):\n         return isinstance(other, Message) and self.level == other.level and \\\n                                               self.message == other.message\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return force_text(self.message)\n \n     def _get_tags(self):"
        },
        {
            "sha": "a0376b55782947d306220a52324c5f7e2fe6275b",
            "filename": "django/contrib/redirects/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fredirects%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fredirects%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fredirects%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,7 +1,9 @@\n from django.db import models\n from django.contrib.sites.models import Site\n from django.utils.translation import ugettext_lazy as _\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class Redirect(models.Model):\n     site = models.ForeignKey(Site)\n     old_path = models.CharField(_('redirect from'), max_length=200, db_index=True,\n@@ -15,6 +17,6 @@ class Meta:\n         db_table = 'django_redirect'\n         unique_together=(('site', 'old_path'),)\n         ordering = ('old_path',)\n-    \n-    def __unicode__(self):\n+\n+    def __str__(self):\n         return \"%s ---> %s\" % (self.old_path, self.new_path)"
        },
        {
            "sha": "c8393f23c616e1dabd6225e06207a4710a16f824",
            "filename": "django/contrib/sessions/backends/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n import base64\n import time\n from datetime import datetime, timedelta\n@@ -12,6 +14,7 @@\n from django.utils.crypto import get_random_string\n from django.utils.crypto import salted_hmac\n from django.utils import timezone\n+from django.utils.encoding import force_bytes\n \n class CreateError(Exception):\n     \"\"\"\n@@ -78,15 +81,15 @@ def encode(self, session_dict):\n         \"Returns the given session dictionary pickled and encoded as a string.\"\n         pickled = pickle.dumps(session_dict, pickle.HIGHEST_PROTOCOL)\n         hash = self._hash(pickled)\n-        return base64.encodestring(hash + \":\" + pickled)\n+        return base64.b64encode(hash.encode() + b\":\" + pickled).decode('ascii')\n \n     def decode(self, session_data):\n-        encoded_data = base64.decodestring(session_data)\n+        encoded_data = base64.b64decode(force_bytes(session_data))\n         try:\n             # could produce ValueError if there is no ':'\n-            hash, pickled = encoded_data.split(':', 1)\n+            hash, pickled = encoded_data.split(b':', 1)\n             expected_hash = self._hash(pickled)\n-            if not constant_time_compare(hash, expected_hash):\n+            if not constant_time_compare(hash.decode(), expected_hash):\n                 raise SuspiciousOperation(\"Session data corrupted\")\n             else:\n                 return pickle.loads(pickled)"
        },
        {
            "sha": "babdb72c27b7add267b790c069dbb324d8f0c001",
            "filename": "django/contrib/sessions/backends/db.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,7 +1,6 @@\n from django.contrib.sessions.backends.base import SessionBase, CreateError\n from django.core.exceptions import SuspiciousOperation\n from django.db import IntegrityError, transaction, router\n-from django.utils.encoding import force_text\n from django.utils import timezone\n \n \n@@ -18,7 +17,7 @@ def load(self):\n                 session_key = self.session_key,\n                 expire_date__gt=timezone.now()\n             )\n-            return self.decode(force_text(s.session_data))\n+            return self.decode(s.session_data)\n         except (Session.DoesNotExist, SuspiciousOperation):\n             self.create()\n             return {}"
        },
        {
            "sha": "20ac2c2087ee5114b510055508b45005149fb639",
            "filename": "django/contrib/sessions/backends/file.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -115,7 +115,7 @@ def save(self, must_create=False):\n             renamed = False\n             try:\n                 try:\n-                    os.write(output_file_fd, self.encode(session_data))\n+                    os.write(output_file_fd, self.encode(session_data).encode())\n                 finally:\n                     os.close(output_file_fd)\n                 os.rename(output_file_name, session_file_name)"
        },
        {
            "sha": "e0b0a827a6143b4789dbdf4e8f0bade74f45b6af",
            "filename": "django/contrib/sitemaps/tests/generic.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n from django.contrib.auth.models import User\n from django.test.utils import override_settings\n \n@@ -12,8 +14,9 @@ def test_generic_sitemap(self):\n         expected = ''\n         for username in User.objects.values_list(\"username\", flat=True):\n             expected += \"<url><loc>%s/users/%s/</loc></url>\" % (self.base_url, username)\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n %s\n </urlset>\n-\"\"\" % expected)\n+\"\"\" % expected\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))"
        },
        {
            "sha": "8da971876f36639c864566a580c4397bd330eaf9",
            "filename": "django/contrib/sitemaps/tests/http.py",
            "status": "modified",
            "additions": 22,
            "deletions": 14,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -21,55 +21,61 @@ class HTTPSitemapTests(SitemapTestsBase):\n     def test_simple_sitemap_index(self):\n         \"A simple sitemap index can be rendered\"\n         response = self.client.get('/simple/index.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <sitemap><loc>%s/simple/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n-\"\"\" % self.base_url)\n+\"\"\" % self.base_url\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     @override_settings(\n         TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n     )\n     def test_simple_sitemap_custom_index(self):\n         \"A simple sitemap index can be rendered with a custom template\"\n         response = self.client.get('/simple/custom-index.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <!-- This is a customised template -->\n <sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <sitemap><loc>%s/simple/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n-\"\"\" % self.base_url)\n+\"\"\" % self.base_url\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+\n \n     def test_simple_sitemap_section(self):\n         \"A simple sitemap section can be rendered\"\n         response = self.client.get('/simple/sitemap-simple.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n-\"\"\" % (self.base_url, date.today()))\n+\"\"\" % (self.base_url, date.today())\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     def test_simple_sitemap(self):\n         \"A simple sitemap can be rendered\"\n         response = self.client.get('/simple/sitemap.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n-\"\"\" % (self.base_url, date.today()))\n+\"\"\" % (self.base_url, date.today())\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     @override_settings(\n         TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n     )\n     def test_simple_custom_sitemap(self):\n         \"A simple sitemap can be rendered with a custom template\"\n         response = self.client.get('/simple/custom-sitemap.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <!-- This is a customised template -->\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n-\"\"\" % (self.base_url, date.today()))\n+\"\"\" % (self.base_url, date.today())\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     @skipUnless(settings.USE_I18N, \"Internationalization is not enabled\")\n     @override_settings(USE_L10N=True)\n@@ -90,11 +96,12 @@ def test_requestsite_sitemap(self):\n         # installed doesn't raise an exception\n         Site._meta.installed = False\n         response = self.client.get('/simple/sitemap.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>http://testserver/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n-\"\"\" % date.today())\n+\"\"\" % date.today()\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     @skipUnless(\"django.contrib.sites\" in settings.INSTALLED_APPS,\n                 \"django.contrib.sites app not installed.\")\n@@ -131,8 +138,9 @@ def test_cached_sitemap_index(self):\n         Check that a cached sitemap index can be rendered (#2713).\n         \"\"\"\n         response = self.client.get('/cached/index.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <sitemap><loc>%s/cached/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n-\"\"\" % self.base_url)\n+\"\"\" % self.base_url\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))"
        },
        {
            "sha": "26241eb30b3ba67c181f97f5fe18f987793b5bb6",
            "filename": "django/contrib/sitemaps/tests/https.py",
            "status": "modified",
            "additions": 14,
            "deletions": 8,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttps.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttps.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttps.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n from datetime import date\n \n from django.test.utils import override_settings\n@@ -11,20 +13,22 @@ class HTTPSSitemapTests(SitemapTestsBase):\n     def test_secure_sitemap_index(self):\n         \"A secure sitemap index can be rendered\"\n         response = self.client.get('/secure/index.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <sitemap><loc>%s/secure/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n-\"\"\" % self.base_url)\n+\"\"\" % self.base_url\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     def test_secure_sitemap_section(self):\n         \"A secure sitemap section can be rendered\"\n         response = self.client.get('/secure/sitemap-simple.xml')\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n-\"\"\" % (self.base_url, date.today()))\n+\"\"\" % (self.base_url, date.today())\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n \n @override_settings(SECURE_PROXY_SSL_HEADER=False)\n@@ -34,17 +38,19 @@ class HTTPSDetectionSitemapTests(SitemapTestsBase):\n     def test_sitemap_index_with_https_request(self):\n         \"A sitemap index requested in HTTPS is rendered with HTTPS links\"\n         response = self.client.get('/simple/index.xml', **self.extra)\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <sitemap><loc>%s/simple/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n-\"\"\" % self.base_url.replace('http://', 'https://'))\n+\"\"\" % self.base_url.replace('http://', 'https://')\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))\n \n     def test_sitemap_section_with_https_request(self):\n         \"A sitemap section requested in HTTPS is rendered with HTTPS links\"\n         response = self.client.get('/simple/sitemap-simple.xml', **self.extra)\n-        self.assertEqual(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+        expected_content = \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n-\"\"\" % (self.base_url.replace('http://', 'https://'), date.today()))\n+\"\"\" % (self.base_url.replace('http://', 'https://'), date.today())\n+        self.assertEqual(response.content, expected_content.encode('utf-8'))"
        },
        {
            "sha": "85907406584deb35bc04b1901354fba4bf59e1b5",
            "filename": "django/contrib/sites/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsites%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsites%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsites%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,5 +1,6 @@\n from django.db import models\n from django.utils.translation import ugettext_lazy as _\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n SITE_CACHE = {}\n@@ -32,6 +33,7 @@ def clear_cache(self):\n         SITE_CACHE = {}\n \n \n+@python_2_unicode_compatible\n class Site(models.Model):\n \n     domain = models.CharField(_('domain name'), max_length=100)\n@@ -44,7 +46,7 @@ class Meta:\n         verbose_name_plural = _('sites')\n         ordering = ('domain',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.domain\n \n     def save(self, *args, **kwargs):\n@@ -62,6 +64,7 @@ def delete(self):\n             pass\n \n \n+@python_2_unicode_compatible\n class RequestSite(object):\n     \"\"\"\n     A class that shares the primary interface of Site (i.e., it has\n@@ -73,7 +76,7 @@ class RequestSite(object):\n     def __init__(self, request):\n         self.domain = self.name = request.get_host()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.domain\n \n     def save(self, force_insert=False, force_update=False):"
        },
        {
            "sha": "0e16e9d649b08aa8919fc2f16d67e1b5800ea4fa",
            "filename": "django/contrib/staticfiles/management/commands/collectstatic.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -192,7 +192,7 @@ def log(self, msg, level=2):\n \n     def clear_dir(self, path):\n         \"\"\"\n-        Deletes the given relative path using the destinatin storage backend.\n+        Deletes the given relative path using the destination storage backend.\n         \"\"\"\n         dirs, files = self.storage.listdir(path)\n         for f in files:"
        },
        {
            "sha": "9691b7849d41f038021dfe8c996f9ffdf08c8921",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -16,7 +16,7 @@\n from django.core.files.base import ContentFile\n from django.core.files.storage import FileSystemStorage, get_storage_class\n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import force_text, smart_bytes\n+from django.utils.encoding import force_bytes, force_text\n from django.utils.functional import LazyObject\n from django.utils.importlib import import_module\n \n@@ -51,8 +51,8 @@ class CachedFilesMixin(object):\n     default_template = \"\"\"url(\"%s\")\"\"\"\n     patterns = (\n         (\"*.css\", (\n-            br\"\"\"(url\\(['\"]{0,1}\\s*(.*?)[\"']{0,1}\\))\"\"\",\n-            (br\"\"\"(@import\\s*[\"']\\s*(.*?)[\"'])\"\"\", \"\"\"@import url(\"%s\")\"\"\"),\n+            r\"\"\"(url\\(['\"]{0,1}\\s*(.*?)[\"']{0,1}\\))\"\"\",\n+            (r\"\"\"(@import\\s*[\"']\\s*(.*?)[\"'])\"\"\", \"\"\"@import url(\"%s\")\"\"\"),\n         )),\n     )\n \n@@ -87,6 +87,7 @@ def file_hash(self, name, content=None):\n     def hashed_name(self, name, content=None):\n         parsed_name = urlsplit(unquote(name))\n         clean_name = parsed_name.path.strip()\n+        opened = False\n         if content is None:\n             if not self.exists(clean_name):\n                 raise ValueError(\"The file '%s' could not be found with %r.\" %\n@@ -96,9 +97,14 @@ def hashed_name(self, name, content=None):\n             except IOError:\n                 # Handle directory paths and fragments\n                 return name\n+            opened = True\n+        try:\n+            file_hash = self.file_hash(clean_name, content)\n+        finally:\n+            if opened:\n+                content.close()\n         path, filename = os.path.split(clean_name)\n         root, ext = os.path.splitext(filename)\n-        file_hash = self.file_hash(clean_name, content)\n         if file_hash is not None:\n             file_hash = \".%s\" % file_hash\n         hashed_name = os.path.join(path, \"%s%s%s\" %\n@@ -112,7 +118,7 @@ def hashed_name(self, name, content=None):\n         return urlunsplit(unparsed_name)\n \n     def cache_key(self, name):\n-        return 'staticfiles:%s' % hashlib.md5(smart_bytes(name)).hexdigest()\n+        return 'staticfiles:%s' % hashlib.md5(force_bytes(name)).hexdigest()\n \n     def url(self, name, force=False):\n         \"\"\"\n@@ -248,7 +254,7 @@ def post_process(self, paths, dry_run=False, **options):\n                     if hashed_file_exists:\n                         self.delete(hashed_name)\n                     # then save the processed result\n-                    content_file = ContentFile(smart_bytes(content))\n+                    content_file = ContentFile(force_bytes(content))\n                     saved_name = self._save(hashed_name, content_file)\n                     hashed_name = force_text(saved_name.replace('\\\\', '/'))\n                     processed = True\n@@ -261,7 +267,7 @@ def post_process(self, paths, dry_run=False, **options):\n                         hashed_name = force_text(saved_name.replace('\\\\', '/'))\n \n                 # and then set the cache accordingly\n-                hashed_paths[self.cache_key(name)] = hashed_name\n+                hashed_paths[self.cache_key(name.replace('\\\\', '/'))] = hashed_name\n                 yield name, hashed_name, processed\n \n         # Finally set the cache"
        },
        {
            "sha": "4815ce5567ab4a2d6b1738b9a654249e0892bdb1",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -106,7 +106,7 @@ def get_feed(self, obj, request):\n             subtitle = self.__get_dynamic_attr('subtitle', obj),\n             link = link,\n             description = self.__get_dynamic_attr('description', obj),\n-            language = settings.LANGUAGE_CODE.decode(),\n+            language = settings.LANGUAGE_CODE,\n             feed_url = add_domain(\n                 current_site.domain,\n                 self.__get_dynamic_attr('feed_url', obj) or request.path,"
        },
        {
            "sha": "06e8952bfb5fa6120c90e865fdfe91b3fdd1f90d",
            "filename": "django/core/cache/backends/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,9 +1,9 @@\n \"Base Cache class.\"\n+from __future__ import unicode_literals\n \n import warnings\n \n from django.core.exceptions import ImproperlyConfigured, DjangoRuntimeWarning\n-from django.utils.encoding import smart_bytes\n from django.utils.importlib import import_module\n \n class InvalidCacheBackendError(ImproperlyConfigured):\n@@ -23,7 +23,7 @@ def default_key_func(key, key_prefix, version):\n     the `key_prefix'. KEY_FUNCTION can be used to specify an alternate\n     function with custom key making behavior.\n     \"\"\"\n-    return ':'.join([key_prefix, str(version), smart_bytes(key)])\n+    return ':'.join([key_prefix, str(version), key])\n \n def get_key_func(key_func):\n     \"\"\"\n@@ -62,7 +62,7 @@ def __init__(self, params):\n         except (ValueError, TypeError):\n             self._cull_frequency = 3\n \n-        self.key_prefix = smart_bytes(params.get('KEY_PREFIX', ''))\n+        self.key_prefix = params.get('KEY_PREFIX', '')\n         self.version = params.get('VERSION', 1)\n         self.key_func = get_key_func(params.get('KEY_FUNCTION', None))\n "
        },
        {
            "sha": "348b03f7337a139268f28aff1c3dcfe1af222536",
            "filename": "django/core/cache/backends/db.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fdb.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,6 +12,7 @@\n from django.core.cache.backends.base import BaseCache\n from django.db import connections, router, transaction, DatabaseError\n from django.utils import timezone\n+from django.utils.encoding import force_bytes\n \n \n class Options(object):\n@@ -72,7 +73,7 @@ def get(self, key, default=None, version=None):\n             transaction.commit_unless_managed(using=db)\n             return default\n         value = connections[db].ops.process_clob(row[1])\n-        return pickle.loads(base64.decodestring(value))\n+        return pickle.loads(base64.b64decode(force_bytes(value)))\n \n     def set(self, key, value, timeout=None, version=None):\n         key = self.make_key(key, version=version)\n@@ -103,7 +104,7 @@ def _base_set(self, mode, key, value, timeout=None):\n         if num > self._max_entries:\n             self._cull(db, cursor, now)\n         pickled = pickle.dumps(value, pickle.HIGHEST_PROTOCOL)\n-        encoded = base64.encodestring(pickled).strip()\n+        encoded = base64.b64encode(pickled).strip()\n         cursor.execute(\"SELECT cache_key, expires FROM %s \"\n                        \"WHERE cache_key = %%s\" % table, [key])\n         try:\n@@ -166,7 +167,7 @@ def _cull(self, db, cursor, now):\n             cursor.execute(\"SELECT COUNT(*) FROM %s\" % table)\n             num = cursor.fetchone()[0]\n             if num > self._max_entries:\n-                cull_num = num / self._cull_frequency\n+                cull_num = num // self._cull_frequency\n                 cursor.execute(\n                     connections[db].ops.cache_key_culling_sql() % table,\n                     [cull_num])"
        },
        {
            "sha": "96194d458fda9ca33a0418f4d36ee03eb611a663",
            "filename": "django/core/cache/backends/filebased.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,6 +10,7 @@\n     import pickle\n \n from django.core.cache.backends.base import BaseCache\n+from django.utils.encoding import force_bytes\n \n class FileBasedCache(BaseCache):\n     def __init__(self, dir, params):\n@@ -136,7 +137,7 @@ def _key_to_file(self, key):\n         Thus, a cache key of \"foo\" gets turnned into a file named\n         ``{cache-dir}ac/bd/18db4cc2f85cedef654fccc4a4d8``.\n         \"\"\"\n-        path = hashlib.md5(key).hexdigest()\n+        path = hashlib.md5(force_bytes(key)).hexdigest()\n         path = os.path.join(path[:2], path[2:4], path[4:])\n         return os.path.join(self._dir, path)\n "
        },
        {
            "sha": "426a0a15c0ba0b17bfce8578041b5b6088c66853",
            "filename": "django/core/cache/backends/memcached.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,6 +6,7 @@\n from django.core.cache.backends.base import BaseCache, InvalidCacheBackendError\n \n from django.utils import six\n+from django.utils.encoding import force_str\n \n class BaseMemcachedCache(BaseCache):\n     def __init__(self, server, params, library, value_not_found_exception):\n@@ -50,6 +51,10 @@ def _get_memcache_timeout(self, timeout):\n             timeout += int(time.time())\n         return int(timeout)\n \n+    def make_key(self, key, version=None):\n+        # Python 2 memcache requires the key to be a byte string.\n+        return force_str(super(BaseMemcachedCache, self).make_key(key, version))\n+\n     def add(self, key, value, timeout=0, version=None):\n         key = self.make_key(key, version=version)\n         return self._cache.add(key, value, self._get_memcache_timeout(timeout))"
        },
        {
            "sha": "ca1ac68f555c3527ee778695faec04f009583814",
            "filename": "django/core/context_processors.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcontext_processors.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,12 +6,15 @@\n These are referenced from the setting TEMPLATE_CONTEXT_PROCESSORS and used by\n RequestContext.\n \"\"\"\n+from __future__ import unicode_literals\n \n from django.conf import settings\n from django.middleware.csrf import get_token\n-from django.utils.encoding import smart_bytes\n+from django.utils import six\n+from django.utils.encoding import smart_text\n from django.utils.functional import lazy\n \n+\n def csrf(request):\n     \"\"\"\n     Context processor that provides a CSRF token, or the string 'NOTPROVIDED' if\n@@ -23,10 +26,10 @@ def _get_val():\n             # In order to be able to provide debugging info in the\n             # case of misconfiguration, we use a sentinel value\n             # instead of returning an empty dict.\n-            return b'NOTPROVIDED'\n+            return 'NOTPROVIDED'\n         else:\n-            return smart_bytes(token)\n-    _get_val = lazy(_get_val, str)\n+            return smart_text(token)\n+    _get_val = lazy(_get_val, six.text_type)\n \n     return {'csrf_token': _get_val() }\n "
        },
        {
            "sha": "b81e180292e2fa4193fe31277c5a416c5571a5c6",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,11 +1,14 @@\n from __future__ import unicode_literals\n \n import os\n-from io import BytesIO\n+from io import BytesIO, StringIO, UnsupportedOperation\n \n-from django.utils.encoding import smart_bytes, smart_text\n+from django.utils.encoding import smart_text\n from django.core.files.utils import FileProxyMixin\n+from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class File(FileProxyMixin):\n     DEFAULT_CHUNK_SIZE = 64 * 2**10\n \n@@ -18,9 +21,6 @@ def __init__(self, file, name=None):\n             self.mode = file.mode\n \n     def __str__(self):\n-        return smart_bytes(self.name or '')\n-\n-    def __unicode__(self):\n         return smart_text(self.name or '')\n \n     def __repr__(self):\n@@ -65,8 +65,10 @@ def chunks(self, chunk_size=None):\n         if not chunk_size:\n             chunk_size = self.DEFAULT_CHUNK_SIZE\n \n-        if hasattr(self, 'seek'):\n+        try:\n             self.seek(0)\n+        except (AttributeError, UnsupportedOperation):\n+            pass\n \n         while True:\n             data = self.read(chunk_size)\n@@ -124,13 +126,15 @@ def open(self, mode=None):\n     def close(self):\n         self.file.close()\n \n+@python_2_unicode_compatible\n class ContentFile(File):\n     \"\"\"\n     A File-like object that takes just raw content, rather than an actual file.\n     \"\"\"\n     def __init__(self, content, name=None):\n         content = content or b''\n-        super(ContentFile, self).__init__(BytesIO(content), name=name)\n+        stream_class = StringIO if isinstance(content, six.text_type) else BytesIO\n+        super(ContentFile, self).__init__(stream_class(content), name=name)\n         self.size = len(content)\n \n     def __str__(self):"
        },
        {
            "sha": "3af02634fe2cea4cc1a9dd032b26645fc4e2c868",
            "filename": "django/core/files/move.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fmove.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fmove.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fmove.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -66,7 +66,7 @@ def file_move_safe(old_file_name, new_file_name, chunk_size = 1024*64, allow_ove\n         try:\n             locks.lock(fd, locks.LOCK_EX)\n             current_chunk = None\n-            while current_chunk != '':\n+            while current_chunk != b'':\n                 current_chunk = old_file.read(chunk_size)\n                 os.write(fd, current_chunk)\n         finally:"
        },
        {
            "sha": "0b300cd31e462157b2da4aa63328a519fff8e6a4",
            "filename": "django/core/files/storage.py",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fstorage.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -195,11 +195,18 @@ def _save(self, name, content):\n                     fd = os.open(full_path, os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, 'O_BINARY', 0))\n                     try:\n                         locks.lock(fd, locks.LOCK_EX)\n+                        _file = None\n                         for chunk in content.chunks():\n-                            os.write(fd, chunk)\n+                            if _file is None:\n+                                mode = 'wb' if isinstance(chunk, bytes) else 'wt'\n+                                _file = os.fdopen(fd, mode)\n+                            _file.write(chunk)\n                     finally:\n                         locks.unlock(fd)\n-                        os.close(fd)\n+                        if _file is not None:\n+                            _file.close()\n+                        else:\n+                            os.close(fd)\n             except OSError as e:\n                 if e.errno == errno.EEXIST:\n                     # Ooops, the file exists. We need a new file name."
        },
        {
            "sha": "39b99ff78fd11b5041285c7425a9074f24abecf4",
            "filename": "django/core/files/uploadedfile.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fuploadedfile.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fuploadedfile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fuploadedfile.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,7 +8,7 @@\n from django.conf import settings\n from django.core.files.base import File\n from django.core.files import temp as tempfile\n-from django.utils.encoding import smart_bytes\n+from django.utils.encoding import force_str\n \n __all__ = ('UploadedFile', 'TemporaryUploadedFile', 'InMemoryUploadedFile',\n            'SimpleUploadedFile')\n@@ -30,7 +30,7 @@ def __init__(self, file=None, name=None, content_type=None, size=None, charset=N\n         self.charset = charset\n \n     def __repr__(self):\n-        return smart_bytes(\"<%s: %s (%s)>\" % (\n+        return force_str(\"<%s: %s (%s)>\" % (\n             self.__class__.__name__, self.name, self.content_type))\n \n     def _get_name(self):"
        },
        {
            "sha": "c422945d6f0b8237c127408822de8fc3fbd5132a",
            "filename": "django/core/files/uploadhandler.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fuploadhandler.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Ffiles%2Fuploadhandler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fuploadhandler.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,6 +10,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.core.files.uploadedfile import TemporaryUploadedFile, InMemoryUploadedFile\n from django.utils import importlib\n+from django.utils.encoding import python_2_unicode_compatible\n \n __all__ = ['UploadFileException','StopUpload', 'SkipFile', 'FileUploadHandler',\n            'TemporaryFileUploadHandler', 'MemoryFileUploadHandler',\n@@ -21,6 +22,7 @@ class UploadFileException(Exception):\n     \"\"\"\n     pass\n \n+@python_2_unicode_compatible\n class StopUpload(UploadFileException):\n     \"\"\"\n     This exception is raised when an upload must abort.\n@@ -33,7 +35,7 @@ def __init__(self, connection_reset=False):\n         \"\"\"\n         self.connection_reset = connection_reset\n \n-    def __unicode__(self):\n+    def __str__(self):\n         if self.connection_reset:\n             return 'StopUpload: Halt current upload.'\n         else:"
        },
        {
            "sha": "791382bac059159b681880ea67d32ed63d2008b6",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 11,
            "deletions": 14,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,6 +1,7 @@\n from __future__ import unicode_literals\n \n import sys\n+import types\n \n from django import http\n from django.core import signals\n@@ -125,10 +126,10 @@ def get_response(self, request):\n \n                 # Complain if the view returned None (a common error).\n                 if response is None:\n-                    try:\n-                        view_name = callback.func_name # If it's a function\n-                    except AttributeError:\n-                        view_name = callback.__class__.__name__ + '.__call__' # If it's a class\n+                    if isinstance(callback, types.FunctionType):    # FBV\n+                        view_name = callback.__name__\n+                    else:                                           # CBV\n+                        view_name = callback.__class__.__name__ + '.__call__'\n                     raise ValueError(\"The view %s.%s didn't return an HttpResponse object.\" % (callback.__module__, view_name))\n \n                 # If the response supports deferred rendering, apply template\n@@ -152,10 +153,8 @@ def get_response(self, request):\n                         callback, param_dict = resolver.resolve404()\n                         response = callback(request, **param_dict)\n                     except:\n-                        try:\n-                            response = self.handle_uncaught_exception(request, resolver, sys.exc_info())\n-                        finally:\n-                            signals.got_request_exception.send(sender=self.__class__, request=request)\n+                        signals.got_request_exception.send(sender=self.__class__, request=request)\n+                        response = self.handle_uncaught_exception(request, resolver, sys.exc_info())\n             except exceptions.PermissionDenied:\n                 logger.warning(\n                     'Forbidden (Permission denied): %s', request.path,\n@@ -167,12 +166,10 @@ def get_response(self, request):\n                     callback, param_dict = resolver.resolve403()\n                     response = callback(request, **param_dict)\n                 except:\n-                    try:\n-                        response = self.handle_uncaught_exception(request,\n-                            resolver, sys.exc_info())\n-                    finally:\n-                        signals.got_request_exception.send(\n+                    signals.got_request_exception.send(\n                             sender=self.__class__, request=request)\n+                    response = self.handle_uncaught_exception(request,\n+                            resolver, sys.exc_info())\n             except SystemExit:\n                 # Allow sys.exit() to actually exit. See tickets #1023 and #4701\n                 raise\n@@ -225,7 +222,7 @@ def handle_uncaught_exception(self, request, resolver, exc_info):\n \n         # If Http500 handler is not installed, re-raise last exception\n         if resolver.urlconf_module is None:\n-            six.reraise(exc_info[1], None, exc_info[2])\n+            six.reraise(*exc_info)\n         # Return an HttpResponse that displays a friendly error message.\n         callback, param_dict = resolver.resolve500()\n         return callback(request, **param_dict)"
        },
        {
            "sha": "e445d07a613315676593df29a0ecb4b174bb8d76",
            "filename": "django/core/handlers/wsgi.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fwsgi.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,7 +9,7 @@\n from django.core.handlers import base\n from django.core.urlresolvers import set_script_prefix\n from django.utils import datastructures\n-from django.utils.encoding import force_text, smart_bytes, iri_to_uri\n+from django.utils.encoding import force_str, force_text, iri_to_uri\n from django.utils.log import getLogger\n \n logger = getLogger('django.request')\n@@ -246,5 +246,5 @@ def __call__(self, environ, start_response):\n         response_headers = [(str(k), str(v)) for k, v in response.items()]\n         for c in response.cookies.values():\n             response_headers.append((str('Set-Cookie'), str(c.output(header=''))))\n-        start_response(smart_bytes(status), response_headers)\n+        start_response(force_str(status), response_headers)\n         return response"
        },
        {
            "sha": "db9023a0bb281f3d0d0cf033a325ed6f2a19abb4",
            "filename": "django/core/mail/message.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmail%2Fmessage.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmail%2Fmessage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fmessage.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -99,7 +99,12 @@ def sanitize_address(addr, encoding):\n     if isinstance(addr, six.string_types):\n         addr = parseaddr(force_text(addr))\n     nm, addr = addr\n-    nm = Header(nm, encoding).encode()\n+    # This try-except clause is needed on Python 3 < 3.2.4\n+    # http://bugs.python.org/issue14291\n+    try:\n+        nm = Header(nm, encoding).encode()\n+    except UnicodeEncodeError:\n+        nm = Header(nm, 'utf-8').encode()\n     try:\n         addr.encode('ascii')\n     except UnicodeEncodeError:  # IDN"
        },
        {
            "sha": "98f75e0310ca1f85a62c875b5e9bf5680c2bf7a1",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -51,14 +51,19 @@ def find_management_module(app_name):\n     # module, we need look for the case where the project name is part\n     # of the app_name but the project directory itself isn't on the path.\n     try:\n-        f, path, descr = imp.find_module(part,path)\n+        f, path, descr = imp.find_module(part, path)\n     except ImportError as e:\n         if os.path.basename(os.getcwd()) != part:\n             raise e\n+    else:\n+        if f:\n+            f.close()\n \n     while parts:\n         part = parts.pop()\n         f, path, descr = imp.find_module(part, path and [path] or None)\n+        if f:\n+            f.close()\n     return path\n \n def load_command_class(app_name, name):"
        },
        {
            "sha": "895753ea12767c111949953ebee45572fbfd2d92",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,7 +12,7 @@\n import django\n from django.core.exceptions import ImproperlyConfigured\n from django.core.management.color import color_style\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import force_str\n from django.utils.six import StringIO\n \n \n@@ -65,7 +65,7 @@ def write(self, msg, style_func=None, ending=None):\n             msg += ending\n         style_func = [f for f in (style_func, self.style_func, lambda x:x)\n                       if f is not None][0]\n-        self._out.write(smart_str(style_func(msg)))\n+        self._out.write(force_str(style_func(msg)))\n \n \n class BaseCommand(object):"
        },
        {
            "sha": "936d5e89abf5582905ea4ab15ecb654d878ff8cc",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 77,
            "deletions": 39,
            "changes": 116,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,4 +1,7 @@\n+from __future__ import unicode_literals\n+\n import keyword\n+import re\n from optparse import make_option\n \n from django.core.management.base import NoArgsCommand, CommandError\n@@ -31,6 +34,7 @@ def handle_inspection(self, options):\n         table_name_filter = options.get('table_name_filter')\n \n         table2model = lambda table_name: table_name.title().replace('_', '').replace(' ', '').replace('-', '')\n+        strip_prefix = lambda s: s.startswith(\"u'\") and s[1:] or s\n \n         cursor = connection.cursor()\n         yield \"# This is an auto-generated Django model module.\"\n@@ -41,6 +45,7 @@ def handle_inspection(self, options):\n         yield \"#\"\n         yield \"# Also note: You'll have to insert the output of 'django-admin.py sqlcustom [appname]'\"\n         yield \"# into your database.\"\n+        yield \"from __future__ import unicode_literals\"\n         yield ''\n         yield 'from %s import models' % self.db_module\n         yield ''\n@@ -59,16 +64,19 @@ def handle_inspection(self, options):\n                 indexes = connection.introspection.get_indexes(cursor, table_name)\n             except NotImplementedError:\n                 indexes = {}\n+            used_column_names = [] # Holds column names used in the table so far\n             for i, row in enumerate(connection.introspection.get_table_description(cursor, table_name)):\n-                column_name = row[0]\n-                att_name = column_name.lower()\n                 comment_notes = [] # Holds Field notes, to be displayed in a Python comment.\n                 extra_params = {}  # Holds Field parameters such as 'db_column'.\n+                column_name = row[0]\n+                is_relation = i in relations\n+\n+                att_name, params, notes = self.normalize_col_name(\n+                    column_name, used_column_names, is_relation)\n+                extra_params.update(params)\n+                comment_notes.extend(notes)\n \n-                # If the column name can't be used verbatim as a Python\n-                # attribute, set the \"db_column\" for this Field.\n-                if ' ' in att_name or '-' in att_name or keyword.iskeyword(att_name) or column_name != att_name:\n-                    extra_params['db_column'] = column_name\n+                used_column_names.append(att_name)\n \n                 # Add primary_key and unique, if necessary.\n                 if column_name in indexes:\n@@ -77,30 +85,12 @@ def handle_inspection(self, options):\n                     elif indexes[column_name]['unique']:\n                         extra_params['unique'] = True\n \n-                # Modify the field name to make it Python-compatible.\n-                if ' ' in att_name:\n-                    att_name = att_name.replace(' ', '_')\n-                    comment_notes.append('Field renamed to remove spaces.')\n-\n-                if '-' in att_name:\n-                    att_name = att_name.replace('-', '_')\n-                    comment_notes.append('Field renamed to remove dashes.')\n-\n-                if column_name != att_name:\n-                    comment_notes.append('Field name made lowercase.')\n-\n-                if i in relations:\n+                if is_relation:\n                     rel_to = relations[i][1] == table_name and \"'self'\" or table2model(relations[i][1])\n-\n                     if rel_to in known_models:\n                         field_type = 'ForeignKey(%s' % rel_to\n                     else:\n                         field_type = \"ForeignKey('%s'\" % rel_to\n-\n-                    if att_name.endswith('_id'):\n-                        att_name = att_name[:-3]\n-                    else:\n-                        extra_params['db_column'] = column_name\n                 else:\n                     # Calling `get_field_type` to get the field type string and any\n                     # additional paramters and notes.\n@@ -110,16 +100,6 @@ def handle_inspection(self, options):\n \n                     field_type += '('\n \n-                if keyword.iskeyword(att_name):\n-                    att_name += '_field'\n-                    comment_notes.append('Field renamed because it was a Python reserved word.')\n-\n-                if att_name[0].isdigit():\n-                    att_name = 'number_%s' % att_name\n-                    extra_params['db_column'] = six.text_type(column_name)\n-                    comment_notes.append(\"Field renamed because it wasn't a \"\n-                        \"valid Python identifier.\")\n-\n                 # Don't output 'id = meta.AutoField(primary_key=True)', because\n                 # that's assumed if it doesn't exist.\n                 if att_name == 'id' and field_type == 'AutoField(' and extra_params == {'primary_key': True}:\n@@ -136,14 +116,72 @@ def handle_inspection(self, options):\n                 if extra_params:\n                     if not field_desc.endswith('('):\n                         field_desc += ', '\n-                    field_desc += ', '.join(['%s=%r' % (k, v) for k, v in extra_params.items()])\n+                    field_desc += ', '.join([\n+                        '%s=%s' % (k, strip_prefix(repr(v)))\n+                        for k, v in extra_params.items()])\n                 field_desc += ')'\n                 if comment_notes:\n                     field_desc += ' # ' + ' '.join(comment_notes)\n                 yield '    %s' % field_desc\n             for meta_line in self.get_meta(table_name):\n                 yield meta_line\n \n+    def normalize_col_name(self, col_name, used_column_names, is_relation):\n+        \"\"\"\n+        Modify the column name to make it Python-compatible as a field name\n+        \"\"\"\n+        field_params = {}\n+        field_notes = []\n+\n+        new_name = col_name.lower()\n+        if new_name != col_name:\n+            field_notes.append('Field name made lowercase.')\n+\n+        if is_relation:\n+            if new_name.endswith('_id'):\n+                new_name = new_name[:-3]\n+            else:\n+                field_params['db_column'] = col_name\n+\n+        new_name, num_repl = re.subn(r'\\W', '_', new_name)\n+        if num_repl > 0:\n+            field_notes.append('Field renamed to remove unsuitable characters.')\n+\n+        if new_name.find('__') >= 0:\n+            while new_name.find('__') >= 0:\n+                new_name = new_name.replace('__', '_')\n+            if col_name.lower().find('__') >= 0:\n+                # Only add the comment if the double underscore was in the original name\n+                field_notes.append(\"Field renamed because it contained more than one '_' in a row.\")\n+\n+        if new_name.startswith('_'):\n+            new_name = 'field%s' % new_name\n+            field_notes.append(\"Field renamed because it started with '_'.\")\n+\n+        if new_name.endswith('_'):\n+            new_name = '%sfield' % new_name\n+            field_notes.append(\"Field renamed because it ended with '_'.\")\n+\n+        if keyword.iskeyword(new_name):\n+            new_name += '_field'\n+            field_notes.append('Field renamed because it was a Python reserved word.')\n+\n+        if new_name[0].isdigit():\n+            new_name = 'number_%s' % new_name\n+            field_notes.append(\"Field renamed because it wasn't a valid Python identifier.\")\n+\n+        if new_name in used_column_names:\n+            num = 0\n+            while '%s_%d' % (new_name, num) in used_column_names:\n+                num += 1\n+            new_name = '%s_%d' % (new_name, num)\n+            field_notes.append('Field renamed because of name conflict.')\n+\n+        if col_name != new_name and field_notes:\n+            field_params['db_column'] = col_name\n+\n+        return new_name, field_params, field_notes\n+\n     def get_field_type(self, connection, table_name, row):\n         \"\"\"\n         Given the database connection, the table name, and the cursor row\n@@ -181,6 +219,6 @@ def get_meta(self, table_name):\n         to construct the inner Meta class for the model corresponding\n         to the given database table name.\n         \"\"\"\n-        return ['    class Meta:',\n-                '        db_table = %r' % table_name,\n-                '']\n+        return [\"    class Meta:\",\n+                \"        db_table = '%s'\" % table_name,\n+                \"\"]"
        },
        {
            "sha": "30cf740cdf90a78fb2cac9e88527a415dea4d08c",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -196,6 +196,10 @@ def read(self):\n                                     loaded_object_count += loaded_objects_in_fixture\n                                     fixture_object_count += objects_in_fixture\n                                     label_found = True\n+                                except Exception as e:\n+                                    if not isinstance(e, CommandError):\n+                                        e.args = (\"Problem installing fixture '%s': %s\" % (full_path, e),)\n+                                    raise\n                                 finally:\n                                     fixture.close()\n \n@@ -209,16 +213,18 @@ def read(self):\n             # Since we disabled constraint checks, we must manually check for\n             # any invalid keys that might have been added\n             table_names = [model._meta.db_table for model in models]\n-            connection.check_constraints(table_names=table_names)\n+            try:\n+                connection.check_constraints(table_names=table_names)\n+            except Exception as e:\n+                e.args = (\"Problem installing fixtures: %s\" % e,)\n+                raise\n \n         except (SystemExit, KeyboardInterrupt):\n             raise\n         except Exception as e:\n             if commit:\n                 transaction.rollback(using=using)\n                 transaction.leave_transaction_management(using=using)\n-            if not isinstance(e, CommandError):\n-                e.args = (\"Problem installing fixture '%s': %s\" % (full_path, e),)\n             raise\n \n         # If we found even one object in a fixture, we need to reset the"
        },
        {
            "sha": "81c4fdf8cc9e2911f4e3e25713090b64e2b4418f",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 19,
            "deletions": 41,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -47,32 +47,27 @@ def _popen(cmd):\n     output, errors = p.communicate()\n     return output, errors, p.returncode\n \n-def walk(root, topdown=True, onerror=None, followlinks=False,\n-         ignore_patterns=None, verbosity=0, stdout=sys.stdout):\n+def find_files(root, ignore_patterns, verbosity, stdout=sys.stdout, symlinks=False):\n     \"\"\"\n-    A version of os.walk that can follow symlinks for Python < 2.6\n+    Helper function to get all files in the given root.\n     \"\"\"\n-    if ignore_patterns is None:\n-        ignore_patterns = []\n     dir_suffix = '%s*' % os.sep\n-    norm_patterns = map(lambda p: p.endswith(dir_suffix)\n-                        and p[:-len(dir_suffix)] or p, ignore_patterns)\n-    for dirpath, dirnames, filenames in os.walk(root, topdown, onerror):\n-        remove_dirs = []\n-        for dirname in dirnames:\n+    norm_patterns = [p[:-len(dir_suffix)] if p.endswith(dir_suffix) else p for p in ignore_patterns]\n+    all_files = []\n+    for dirpath, dirnames, filenames in os.walk(root, topdown=True, followlinks=symlinks):\n+        for dirname in dirnames[:]:\n             if is_ignored(os.path.normpath(os.path.join(dirpath, dirname)), norm_patterns):\n-                remove_dirs.append(dirname)\n-        for dirname in remove_dirs:\n-            dirnames.remove(dirname)\n-            if verbosity > 1:\n-                stdout.write('ignoring directory %s\\n' % dirname)\n-        yield (dirpath, dirnames, filenames)\n-        if followlinks:\n-            for d in dirnames:\n-                p = os.path.join(dirpath, d)\n-                if os.path.islink(p):\n-                    for link_dirpath, link_dirnames, link_filenames in walk(p):\n-                        yield (link_dirpath, link_dirnames, link_filenames)\n+                dirnames.remove(dirname)\n+                if verbosity > 1:\n+                    stdout.write('ignoring directory %s\\n' % dirname)\n+        for filename in filenames:\n+            if is_ignored(os.path.normpath(os.path.join(dirpath, filename)), ignore_patterns):\n+                if verbosity > 1:\n+                    stdout.write('ignoring file %s in %s\\n' % (filename, dirpath))\n+            else:\n+                all_files.extend([(dirpath, filename)])\n+    all_files.sort()\n+    return all_files\n \n def is_ignored(path, ignore_patterns):\n     \"\"\"\n@@ -83,23 +78,6 @@ def is_ignored(path, ignore_patterns):\n             return True\n     return False\n \n-def find_files(root, ignore_patterns, verbosity, stdout=sys.stdout, symlinks=False):\n-    \"\"\"\n-    Helper function to get all files in the given root.\n-    \"\"\"\n-    all_files = []\n-    for (dirpath, dirnames, filenames) in walk(root, followlinks=symlinks,\n-            ignore_patterns=ignore_patterns, verbosity=verbosity, stdout=stdout):\n-        for filename in filenames:\n-            norm_filepath = os.path.normpath(os.path.join(dirpath, filename))\n-            if is_ignored(norm_filepath, ignore_patterns):\n-                if verbosity > 1:\n-                    stdout.write('ignoring file %s in %s\\n' % (filename, dirpath))\n-            else:\n-                all_files.extend([(dirpath, filename)])\n-    all_files.sort()\n-    return all_files\n-\n def copy_plural_forms(msgs, locale, domain, verbosity, stdout=sys.stdout):\n     \"\"\"\n     Copies plural forms header contents from a Django catalog of locale to\n@@ -144,7 +122,7 @@ def write_pot_file(potfile, msgs, file, work_file, is_templatized):\n         msgs = '\\n'.join(dropwhile(len, msgs.split('\\n')))\n     else:\n         msgs = msgs.replace('charset=CHARSET', 'charset=UTF-8')\n-    with open(potfile, 'ab') as fp:\n+    with open(potfile, 'a') as fp:\n         fp.write(msgs)\n \n def process_file(file, dirpath, potfile, domain, verbosity,\n@@ -252,7 +230,7 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n         msgs = copy_plural_forms(msgs, locale, domain, verbosity, stdout)\n     msgs = msgs.replace(\n         \"#. #-#-#-#-#  %s.pot (PACKAGE VERSION)  #-#-#-#-#\\n\" % domain, \"\")\n-    with open(pofile, 'wb') as fp:\n+    with open(pofile, 'w') as fp:\n         fp.write(msgs)\n     os.unlink(potfile)\n     if no_obsolete:"
        },
        {
            "sha": "52a8cab7e40567f7640dc9789c00e4c0095e9d85",
            "filename": "django/core/management/commands/shell.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -80,14 +80,14 @@ def handle_noargs(self, **options):\n                 readline.parse_and_bind(\"tab:complete\")\n \n             # We want to honor both $PYTHONSTARTUP and .pythonrc.py, so follow system\n-            # conventions and get $PYTHONSTARTUP first then import user.\n+            # conventions and get $PYTHONSTARTUP first then .pythonrc.py.\n             if not use_plain:\n-                pythonrc = os.environ.get(\"PYTHONSTARTUP\")\n-                if pythonrc and os.path.isfile(pythonrc):\n-                    try:\n-                        execfile(pythonrc)\n-                    except NameError:\n-                        pass\n-                # This will import .pythonrc.py as a side-effect\n-                import user\n+                for pythonrc in (os.environ.get(\"PYTHONSTARTUP\"),\n+                                 os.path.expanduser('~/.pythonrc.py')):\n+                    if pythonrc and os.path.isfile(pythonrc):\n+                        try:\n+                            with open(pythonrc) as handle:\n+                                exec(compile(handle.read(), pythonrc, 'exec'))\n+                        except NameError:\n+                            pass\n             code.interact(local=imported_objects)"
        },
        {
            "sha": "cceec07be8af1fbd0bab2038223cd6d7fb210e64",
            "filename": "django/core/management/commands/syncdb.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -75,7 +75,7 @@ def model_installed(model):\n                 (opts.auto_created and converter(opts.auto_created._meta.db_table) in tables))\n \n         manifest = SortedDict(\n-            (app_name, filter(model_installed, model_list))\n+            (app_name, list(filter(model_installed, model_list)))\n             for app_name, model_list in all_models\n         )\n "
        },
        {
            "sha": "b02a548314c4535c74c602231d555950f8b2e08f",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import unicode_literals\n \n+import codecs\n import os\n import re\n \n@@ -168,10 +169,10 @@ def custom_sql_for_model(model, style, connection):\n                  os.path.join(app_dir, \"%s.sql\" % opts.object_name.lower())]\n     for sql_file in sql_files:\n         if os.path.exists(sql_file):\n-            with open(sql_file, 'U') as fp:\n+            with codecs.open(sql_file, 'U', encoding=settings.FILE_CHARSET) as fp:\n                 # Some backends can't execute more than one SQL statement at a time,\n                 # so split into separate statements.\n-                output.extend(_split_statements(fp.read().decode(settings.FILE_CHARSET)))\n+                output.extend(_split_statements(fp.read()))\n     return output\n \n "
        },
        {
            "sha": "aa65593e9cf58220329ea487f9bb9b281ca13a4c",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,6 +8,8 @@\n import stat\n import sys\n import tempfile\n+import codecs\n+\n try:\n     from urllib.request import urlretrieve\n except ImportError:     # Python 2\n@@ -154,12 +156,12 @@ def handle(self, app_or_project, name, target=None, **options):\n \n                 # Only render the Python files, as we don't want to\n                 # accidentally render Django templates files\n-                with open(old_path, 'r') as template_file:\n+                with codecs.open(old_path, 'r', 'utf-8') as template_file:\n                     content = template_file.read()\n                 if filename.endswith(extensions) or filename in extra_files:\n                     template = Template(content)\n                     content = template.render(context)\n-                with open(new_path, 'w') as new_file:\n+                with codecs.open(new_path, 'w', 'utf-8') as new_file:\n                     new_file.write(content)\n \n                 if self.verbosity >= 2:"
        },
        {
            "sha": "6cd66f3a6a7fc75b97daab6683639e5600ffc902",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,7 +1,7 @@\n import sys\n \n from django.core.management.color import color_style\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import force_str\n from django.utils.itercompat import is_iterable\n from django.utils import six\n \n@@ -13,7 +13,7 @@ def __init__(self, outfile=sys.stdout):\n \n     def add(self, context, error):\n         self.errors.append((context, error))\n-        self.outfile.write(self.style.ERROR(smart_str(\"%s: %s\\n\" % (context, error))))\n+        self.outfile.write(self.style.ERROR(force_str(\"%s: %s\\n\" % (context, error))))\n \n def get_validation_errors(outfile, app=None):\n     \"\"\""
        },
        {
            "sha": "276f9a473863923ca4952c887726a74eebe34c0e",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,8 +2,6 @@\n Module for abstract serializer/unserializer base classes.\n \"\"\"\n \n-from io import BytesIO\n-\n from django.db import models\n from django.utils.encoding import smart_text\n from django.utils import six\n@@ -35,7 +33,7 @@ def serialize(self, queryset, **options):\n         \"\"\"\n         self.options = options\n \n-        self.stream = options.pop(\"stream\", BytesIO())\n+        self.stream = options.pop(\"stream\", six.StringIO())\n         self.selected_fields = options.pop(\"fields\", None)\n         self.use_natural_keys = options.pop(\"use_natural_keys\", False)\n \n@@ -125,7 +123,7 @@ def __init__(self, stream_or_string, **options):\n         \"\"\"\n         self.options = options\n         if isinstance(stream_or_string, six.string_types):\n-            self.stream = BytesIO(stream_or_string)\n+            self.stream = six.StringIO(stream_or_string)\n         else:\n             self.stream = stream_or_string\n         # hack to make sure that the models have all been loaded before"
        },
        {
            "sha": "ed65f2922c34cf74baaafb69ffb4da2241928867",
            "filename": "django/core/serializers/json.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fserializers%2Fjson.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fserializers%2Fjson.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fjson.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,7 +12,6 @@\n from django.core.serializers.base import DeserializationError\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n-from django.utils.encoding import smart_bytes\n from django.utils import six\n from django.utils.timezone import is_aware\n \n@@ -61,13 +60,12 @@ def Deserializer(stream_or_string, **options):\n     \"\"\"\n     Deserialize a stream or string of JSON data.\n     \"\"\"\n+    if not isinstance(stream_or_string, (bytes, six.string_types)):\n+        stream_or_string = stream_or_string.read()\n     if isinstance(stream_or_string, bytes):\n         stream_or_string = stream_or_string.decode('utf-8')\n     try:\n-        if isinstance(stream_or_string, six.string_types):\n-            objects = json.loads(stream_or_string)\n-        else:\n-            objects = json.load(stream_or_string)\n+        objects = json.loads(stream_or_string)\n         for obj in PythonDeserializer(objects, **options):\n             yield obj\n     except GeneratorExit:"
        },
        {
            "sha": "4c11626badb7f490cb9d8a737ac2468b0d20c205",
            "filename": "django/core/serializers/pyyaml.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpyyaml.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,7 +12,6 @@\n from django.core.serializers.base import DeserializationError\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n-from django.utils.encoding import smart_bytes\n from django.utils import six\n \n "
        },
        {
            "sha": "19b287af87a3ecd642a3c88df2cd24585ad78838",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,6 +7,8 @@\n been reviewed for security issues. DON'T USE IT FOR PRODUCTION USE!\n \"\"\"\n \n+from __future__ import unicode_literals\n+\n import os\n import socket\n import sys\n@@ -71,12 +73,12 @@ class WSGIServerException(Exception):\n \n \n class ServerHandler(simple_server.ServerHandler, object):\n-    error_status = \"500 INTERNAL SERVER ERROR\"\n+    error_status = str(\"500 INTERNAL SERVER ERROR\")\n \n     def write(self, data):\n-        \"\"\"'write()' callable as specified by PEP 333\"\"\"\n+        \"\"\"'write()' callable as specified by PEP 3333\"\"\"\n \n-        assert isinstance(data, str), \"write() argument must be string\"\n+        assert isinstance(data, bytes), \"write() argument must be bytestring\"\n \n         if not self.status:\n             raise AssertionError(\"write() before start_response()\")\n@@ -200,7 +202,7 @@ def log_message(self, format, *args):\n def run(addr, port, wsgi_handler, ipv6=False, threading=False):\n     server_address = (addr, port)\n     if threading:\n-        httpd_cls = type('WSGIServer', (socketserver.ThreadingMixIn, WSGIServer), {})\n+        httpd_cls = type(str('WSGIServer'), (socketserver.ThreadingMixIn, WSGIServer), {})\n     else:\n         httpd_cls = WSGIServer\n     httpd = httpd_cls(server_address, WSGIRequestHandler, ipv6=ipv6)"
        },
        {
            "sha": "147e54780c7d91897b480823c559a1267cea0636",
            "filename": "django/core/signing.py",
            "status": "modified",
            "additions": 28,
            "deletions": 19,
            "changes": 47,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fsigning.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fsigning.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fsigning.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -32,6 +32,9 @@\n There are 65 url-safe characters: the 64 used by url-safe base64 and the ':'.\n These functions make use of all of them.\n \"\"\"\n+\n+from __future__ import unicode_literals\n+\n import base64\n import json\n import time\n@@ -41,7 +44,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.utils import baseconv\n from django.utils.crypto import constant_time_compare, salted_hmac\n-from django.utils.encoding import force_text, smart_bytes\n+from django.utils.encoding import force_bytes, force_str, force_text\n from django.utils.importlib import import_module\n \n \n@@ -60,11 +63,11 @@ class SignatureExpired(BadSignature):\n \n \n def b64_encode(s):\n-    return base64.urlsafe_b64encode(s).strip('=')\n+    return base64.urlsafe_b64encode(s).strip(b'=')\n \n \n def b64_decode(s):\n-    pad = '=' * (-len(s) % 4)\n+    pad = b'=' * (-len(s) % 4)\n     return base64.urlsafe_b64decode(s + pad)\n \n \n@@ -114,7 +117,7 @@ def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer,\n     value or re-using a salt value across different parts of your\n     application without good cause is a security risk.\n     \"\"\"\n-    data = serializer().dumps(obj)\n+    data = force_bytes(serializer().dumps(obj))\n \n     # Flag for if it's been compressed or not\n     is_compressed = False\n@@ -127,43 +130,48 @@ def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer,\n             is_compressed = True\n     base64d = b64_encode(data)\n     if is_compressed:\n-        base64d = '.' + base64d\n+        base64d = b'.' + base64d\n     return TimestampSigner(key, salt=salt).sign(base64d)\n \n \n def loads(s, key=None, salt='django.core.signing', serializer=JSONSerializer, max_age=None):\n     \"\"\"\n     Reverse of dumps(), raises BadSignature if signature fails\n     \"\"\"\n-    base64d = smart_bytes(\n-        TimestampSigner(key, salt=salt).unsign(s, max_age=max_age))\n+    # TimestampSigner.unsign always returns unicode but base64 and zlib\n+    # compression operate on bytes.\n+    base64d = force_bytes(TimestampSigner(key, salt=salt).unsign(s, max_age=max_age))\n     decompress = False\n-    if base64d[0] == '.':\n+    if base64d[0] == b'.':\n         # It's compressed; uncompress it first\n         base64d = base64d[1:]\n         decompress = True\n     data = b64_decode(base64d)\n     if decompress:\n         data = zlib.decompress(data)\n-    return serializer().loads(data)\n+    return serializer().loads(force_str(data))\n \n \n class Signer(object):\n+\n     def __init__(self, key=None, sep=':', salt=None):\n-        self.sep = sep\n-        self.key = key or settings.SECRET_KEY\n-        self.salt = salt or ('%s.%s' %\n-            (self.__class__.__module__, self.__class__.__name__))\n+        # Use of native strings in all versions of Python\n+        self.sep = str(sep)\n+        self.key = str(key or settings.SECRET_KEY)\n+        self.salt = str(salt or\n+            '%s.%s' % (self.__class__.__module__, self.__class__.__name__))\n \n     def signature(self, value):\n-        return base64_hmac(self.salt + 'signer', value, self.key)\n+        signature = base64_hmac(self.salt + 'signer', value, self.key)\n+        # Convert the signature from bytes to str only on Python 3\n+        return force_str(signature)\n \n     def sign(self, value):\n-        value = smart_bytes(value)\n-        return '%s%s%s' % (value, self.sep, self.signature(value))\n+        value = force_str(value)\n+        return str('%s%s%s') % (value, self.sep, self.signature(value))\n \n     def unsign(self, signed_value):\n-        signed_value = smart_bytes(signed_value)\n+        signed_value = force_str(signed_value)\n         if not self.sep in signed_value:\n             raise BadSignature('No \"%s\" found in value' % self.sep)\n         value, sig = signed_value.rsplit(self.sep, 1)\n@@ -178,8 +186,9 @@ def timestamp(self):\n         return baseconv.base62.encode(int(time.time()))\n \n     def sign(self, value):\n-        value = smart_bytes('%s%s%s' % (value, self.sep, self.timestamp()))\n-        return '%s%s%s' % (value, self.sep, self.signature(value))\n+        value = force_str(value)\n+        value = str('%s%s%s') % (value, self.sep, self.timestamp())\n+        return super(TimestampSigner, self).sign(value)\n \n     def unsign(self, value, max_age=None):\n         result =  super(TimestampSigner, self).unsign(value)"
        },
        {
            "sha": "af3df83d0a88d36659cc6c2b8f85c4893abe5873",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 26,
            "deletions": 14,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,7 +14,7 @@\n from django.http import Http404\n from django.core.exceptions import ImproperlyConfigured, ViewDoesNotExist\n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import iri_to_uri, force_text, smart_bytes\n+from django.utils.encoding import force_str, force_text, iri_to_uri\n from django.utils.functional import memoize, lazy\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n@@ -89,18 +89,11 @@ def get_callable(lookup_view, can_fail=False):\n     \"\"\"\n     if not callable(lookup_view):\n         mod_name, func_name = get_mod_func(lookup_view)\n+        if func_name == '':\n+            return lookup_view\n+\n         try:\n-            if func_name != '':\n-                lookup_view = getattr(import_module(mod_name), func_name)\n-                if not callable(lookup_view):\n-                    raise ViewDoesNotExist(\n-                        \"Could not import %s.%s. View is not callable.\" %\n-                        (mod_name, func_name))\n-        except AttributeError:\n-            if not can_fail:\n-                raise ViewDoesNotExist(\n-                    \"Could not import %s. View does not exist in module %s.\" %\n-                    (lookup_view, mod_name))\n+            mod = import_module(mod_name)\n         except ImportError:\n             parentmod, submod = get_mod_func(mod_name)\n             if (not can_fail and submod != '' and\n@@ -110,6 +103,18 @@ def get_callable(lookup_view, can_fail=False):\n                     (lookup_view, mod_name))\n             if not can_fail:\n                 raise\n+        else:\n+            try:\n+                lookup_view = getattr(mod, func_name)\n+                if not callable(lookup_view):\n+                    raise ViewDoesNotExist(\n+                        \"Could not import %s.%s. View is not callable.\" %\n+                        (mod_name, func_name))\n+            except AttributeError:\n+                if not can_fail:\n+                    raise ViewDoesNotExist(\n+                        \"Could not import %s. View does not exist in module %s.\" %\n+                        (lookup_view, mod_name))\n     return lookup_view\n get_callable = memoize(get_callable, _callable_cache, 1)\n \n@@ -190,7 +195,7 @@ def __init__(self, regex, callback, default_args=None, name=None):\n         self.name = name\n \n     def __repr__(self):\n-        return smart_bytes('<%s %s %s>' % (self.__class__.__name__, self.name, self.regex.pattern))\n+        return force_str('<%s %s %s>' % (self.__class__.__name__, self.name, self.regex.pattern))\n \n     def add_prefix(self, prefix):\n         \"\"\"\n@@ -240,7 +245,14 @@ def __init__(self, regex, urlconf_name, default_kwargs=None, app_name=None, name\n         self._app_dict = {}\n \n     def __repr__(self):\n-        return smart_bytes('<%s %s (%s:%s) %s>' % (self.__class__.__name__, self.urlconf_name, self.app_name, self.namespace, self.regex.pattern))\n+        if isinstance(self.urlconf_name, list) and len(self.urlconf_name):\n+            # Don't bother to output the whole list, it can be huge\n+            urlconf_repr = '<%s list>' % self.urlconf_name[0].__class__.__name__\n+        else:\n+            urlconf_repr = repr(self.urlconf_name)\n+        return force_str('<%s %s (%s:%s) %s>' % (\n+            self.__class__.__name__, urlconf_repr, self.app_name,\n+            self.namespace, self.regex.pattern))\n \n     def _populate(self):\n         lookups = MultiValueDict()"
        },
        {
            "sha": "317e3880bfe0522fbb1cba8c26a4827921481e38",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,7 +8,7 @@\n \n from django.core.exceptions import ValidationError\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_text\n+from django.utils.encoding import force_text\n from django.utils.ipv6 import is_valid_ipv6_address\n from django.utils import six\n \n@@ -36,15 +36,16 @@ def __call__(self, value):\n         \"\"\"\n         Validates that the input matches the regular expression.\n         \"\"\"\n-        if not self.regex.search(smart_text(value)):\n+        if not self.regex.search(force_text(value)):\n             raise ValidationError(self.message, code=self.code)\n \n class URLValidator(RegexValidator):\n     regex = re.compile(\n         r'^(?:http|ftp)s?://' # http:// or https://\n         r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:[A-Z]{2,6}\\.?|[A-Z0-9-]{2,}\\.?)|' #domain...\n         r'localhost|' #localhost...\n-        r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})' # ...or ip\n+        r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|' # ...or ipv4\n+        r'\\[?[A-F0-9]*:[A-F0-9:]+\\]?)' # ...or ipv6\n         r'(?::\\d+)?' # optional port\n         r'(?:/?|[/?]\\S+)$', re.IGNORECASE)\n \n@@ -54,10 +55,10 @@ def __call__(self, value):\n         except ValidationError as e:\n             # Trivial case failed. Try for possible IDN domain\n             if value:\n-                value = smart_text(value)\n+                value = force_text(value)\n                 scheme, netloc, path, query, fragment = urlsplit(value)\n                 try:\n-                    netloc = netloc.encode('idna') # IDN -> ACE\n+                    netloc = netloc.encode('idna').decode('ascii') # IDN -> ACE\n                 except UnicodeError: # invalid domain part\n                     raise e\n                 url = urlunsplit((scheme, netloc, path, query, fragment))\n@@ -84,7 +85,7 @@ def __call__(self, value):\n             if value and '@' in value:\n                 parts = value.split('@')\n                 try:\n-                    parts[-1] = parts[-1].encode('idna')\n+                    parts[-1] = parts[-1].encode('idna').decode('ascii')\n                 except UnicodeError:\n                     raise e\n                 super(EmailValidator, self).__call__('@'.join(parts))\n@@ -99,7 +100,7 @@ def __call__(self, value):\n     r'|\\[(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}\\]$', re.IGNORECASE)  # literal form, ipv4 address (SMTP 4.1.3)\n validate_email = EmailValidator(email_re, _('Enter a valid e-mail address.'), 'invalid')\n \n-slug_re = re.compile(r'^[-\\w]+$')\n+slug_re = re.compile(r'^[-a-zA-Z0-9_]+$')\n validate_slug = RegexValidator(slug_re, _(\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"), 'invalid')\n \n ipv4_re = re.compile(r'^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$')"
        },
        {
            "sha": "efea9f802e7a126d2a02cde7b1929770365e9059",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 16,
            "deletions": 12,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,7 +1,7 @@\n from django.db.utils import DatabaseError\n \n try:\n-    import thread\n+    from django.utils.six.moves import _thread as thread\n except ImportError:\n     from django.utils.six.moves import _dummy_thread as thread\n from contextlib import contextmanager\n@@ -47,6 +47,8 @@ def __eq__(self, other):\n     def __ne__(self, other):\n         return not self == other\n \n+    __hash__ = object.__hash__\n+\n     def _commit(self):\n         if self.connection is not None:\n             return self.connection.commit()\n@@ -621,7 +623,7 @@ def last_executed_query(self, cursor, sql, params):\n         exists for database backends to provide a better implementation\n         according to their own quoting schemes.\n         \"\"\"\n-        from django.utils.encoding import smart_text, force_text\n+        from django.utils.encoding import force_text\n \n         # Convert params to contain Unicode values.\n         to_unicode = lambda s: force_text(s, strings_only=True, errors='replace')\n@@ -630,7 +632,7 @@ def last_executed_query(self, cursor, sql, params):\n         else:\n             u_params = dict([(to_unicode(k), to_unicode(v)) for k, v in params.items()])\n \n-        return smart_text(sql) % u_params\n+        return force_text(sql) % u_params\n \n     def last_insert_id(self, cursor, table_name, pk_name):\n         \"\"\"\n@@ -814,8 +816,8 @@ def tablespace_sql(self, tablespace, inline=False):\n \n     def prep_for_like_query(self, x):\n         \"\"\"Prepares a value for use in a LIKE query.\"\"\"\n-        from django.utils.encoding import smart_text\n-        return smart_text(x).replace(\"\\\\\", \"\\\\\\\\\").replace(\"%\", \"\\%\").replace(\"_\", \"\\_\")\n+        from django.utils.encoding import force_text\n+        return force_text(x).replace(\"\\\\\", \"\\\\\\\\\").replace(\"%\", \"\\%\").replace(\"_\", \"\\_\")\n \n     # Same as prep_for_like_query(), but called for \"iexact\" matches, which\n     # need not necessarily be implemented using \"LIKE\" in the backend.\n@@ -892,19 +894,21 @@ def year_lookup_bounds_for_date_field(self, value):\n         return self.year_lookup_bounds(value)\n \n     def convert_values(self, value, field):\n-        \"\"\"Coerce the value returned by the database backend into a consistent type that\n-        is compatible with the field type.\n+        \"\"\"\n+        Coerce the value returned by the database backend into a consistent type\n+        that is compatible with the field type.\n         \"\"\"\n         internal_type = field.get_internal_type()\n         if internal_type == 'DecimalField':\n             return value\n-        elif internal_type and internal_type.endswith('IntegerField') or internal_type == 'AutoField':\n+        elif internal_type == 'FloatField':\n+            return float(value)\n+        elif (internal_type and (internal_type.endswith('IntegerField')\n+                                 or internal_type == 'AutoField')):\n             return int(value)\n         elif internal_type in ('DateField', 'DateTimeField', 'TimeField'):\n             return value\n-        # No field, or the field isn't known to be a decimal or integer\n-        # Default to a float\n-        return float(value)\n+        return value\n \n     def check_aggregate_support(self, aggregate_func):\n         \"\"\"Check that the backend supports the provided aggregate\n@@ -1003,7 +1007,7 @@ def installed_models(self, tables):\n             for model in models.get_models(app):\n                 if router.allow_syncdb(self.connection.alias, model):\n                     all_models.append(model)\n-        tables = map(self.table_name_converter, tables)\n+        tables = list(map(self.table_name_converter, tables))\n         return set([\n             m for m in all_models\n             if self.table_name_converter(m._meta.db_table) in tables"
        },
        {
            "sha": "10649b64b9f66a7d73a289e243b1d6c07562acd2",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -39,7 +39,7 @@\n from django.db.backends.mysql.validation import DatabaseValidation\n from django.db.backends.mysql.schema import DatabaseSchemaEditor\n from django.utils.functional import cached_property\n-from django.utils.safestring import SafeString, SafeUnicode\n+from django.utils.safestring import SafeBytes, SafeText\n from django.utils import six\n from django.utils import timezone\n \n@@ -76,7 +76,7 @@ def adapt_datetime_with_timezone_support(value, conv):\n # MySQLdb-1.2.1 returns TIME columns as timedelta -- they are more like\n # timedelta in terms of actual behavior as they are signed and include days --\n # and Django expects time, so we still need to override that. We also need to\n-# add special handling for SafeUnicode and SafeString as MySQLdb's type\n+# add special handling for SafeText and SafeBytes as MySQLdb's type\n # checking is too tight to catch those (see Django ticket #6052).\n # Finally, MySQLdb always returns naive datetime objects. However, when\n # timezone support is active, Django expects timezone-aware datetime objects.\n@@ -403,8 +403,8 @@ def _cursor(self):\n             kwargs['client_flag'] = CLIENT.FOUND_ROWS\n             kwargs.update(settings_dict['OPTIONS'])\n             self.connection = Database.connect(**kwargs)\n-            self.connection.encoders[SafeUnicode] = self.connection.encoders[six.text_type]\n-            self.connection.encoders[SafeString] = self.connection.encoders[bytes]\n+            self.connection.encoders[SafeText] = self.connection.encoders[six.text_type]\n+            self.connection.encoders[SafeBytes] = self.connection.encoders[bytes]\n             connection_created.send(sender=self.__class__, connection=self)\n         cursor = self.connection.cursor()\n         if new_connection:"
        },
        {
            "sha": "d8e9b3a202ab977045e48863101ddabbb804297d",
            "filename": "django/db/backends/mysql/compiler.py",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,10 +1,16 @@\n+try:\n+    from itertools import zip_longest\n+except ImportError:\n+    from itertools import izip_longest as zip_longest\n+\n from django.db.models.sql import compiler\n \n+\n class SQLCompiler(compiler.SQLCompiler):\n     def resolve_columns(self, row, fields=()):\n         values = []\n-        index_extra_select = len(self.query.extra_select.keys())\n-        for value, field in map(None, row[index_extra_select:], fields):\n+        index_extra_select = len(self.query.extra_select)\n+        for value, field in zip_longest(row[index_extra_select:], fields):\n             if (field and field.get_internal_type() in (\"BooleanField\", \"NullBooleanField\") and\n                 value in (0, 1)):\n                 value = bool(value)"
        },
        {
            "sha": "1fc55115a27c7587a1228787bc42d4e56df664bf",
            "filename": "django/db/backends/mysql/introspection.py",
            "status": "modified",
            "additions": 17,
            "deletions": 5,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,8 +1,9 @@\n+import re\n+from .base import FIELD_TYPE\n+\n from django.db.backends import BaseDatabaseIntrospection\n from django.utils import six\n-from MySQLdb import ProgrammingError, OperationalError\n-from MySQLdb.constants import FIELD_TYPE\n-import re\n+\n \n foreign_key_re = re.compile(r\"\\sCONSTRAINT `[^`]*` FOREIGN KEY \\(`([^`]*)`\\) REFERENCES `([^`]*)` \\(`([^`]*)`\\)\")\n \n@@ -35,9 +36,20 @@ def get_table_list(self, cursor):\n         return [row[0] for row in cursor.fetchall()]\n \n     def get_table_description(self, cursor, table_name):\n-        \"Returns a description of the table, with the DB-API cursor.description interface.\"\n+        \"\"\"\n+        Returns a description of the table, with the DB-API cursor.description interface.\"\n+        \"\"\"\n+        # varchar length returned by cursor.description is an internal length,\n+        # not visible length (#5725), use information_schema database to fix this\n+        cursor.execute(\"\"\"\n+            SELECT column_name, character_maximum_length FROM information_schema.columns\n+            WHERE table_name = %s AND table_schema = DATABASE()\n+                AND character_maximum_length IS NOT NULL\"\"\", [table_name])\n+        length_map = dict(cursor.fetchall())\n+\n         cursor.execute(\"SELECT * FROM %s LIMIT 1\" % self.connection.ops.quote_name(table_name))\n-        return cursor.description\n+        return [line[:3] + (length_map.get(line[0], line[3]),) + line[4:]\n+            for line in cursor.description]\n \n     def _name_to_index(self, cursor, table_name):\n         \"\"\""
        },
        {
            "sha": "6bf2e815a73cea735dbf8c8125ebfe824b18728e",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 15,
            "deletions": 8,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,8 +10,6 @@\n import sys\n import warnings\n \n-from django.utils import six\n-\n def _setup_environment(environ):\n     import platform\n     # Cygwin requires some special voodoo to set the environment variables\n@@ -53,7 +51,7 @@ def _setup_environment(environ):\n from django.db.backends.oracle.client import DatabaseClient\n from django.db.backends.oracle.creation import DatabaseCreation\n from django.db.backends.oracle.introspection import DatabaseIntrospection\n-from django.utils.encoding import smart_bytes, force_text\n+from django.utils.encoding import force_bytes, force_text\n from django.utils import six\n from django.utils import timezone\n \n@@ -66,7 +64,7 @@ def _setup_environment(environ):\n if int(Database.version.split('.', 1)[0]) >= 5 and not hasattr(Database, 'UNICODE'):\n     convert_unicode = force_text\n else:\n-    convert_unicode = smart_bytes\n+    convert_unicode = force_bytes\n \n \n class DatabaseFeatures(BaseDatabaseFeatures):\n@@ -221,7 +219,10 @@ def field_cast_sql(self, db_type):\n     def last_executed_query(self, cursor, sql, params):\n         # http://cx-oracle.sourceforge.net/html/cursor.html#Cursor.statement\n         # The DB API definition does not define this attribute.\n-        return cursor.statement.decode(\"utf-8\")\n+        if six.PY3:\n+            return cursor.statement\n+        else:\n+            return cursor.statement.decode(\"utf-8\")\n \n     def last_insert_id(self, cursor, table_name, pk_name):\n         sq_name = self._get_sequence_name(table_name)\n@@ -594,10 +595,16 @@ def __init__(self, param, cursor, strings_only=False):\n                 param = timezone.make_aware(param, default_timezone)\n             param = param.astimezone(timezone.utc).replace(tzinfo=None)\n \n+        # Oracle doesn't recognize True and False correctly in Python 3.\n+        # The conversion done below works both in 2 and 3.\n+        if param is True:\n+            param = \"1\"\n+        elif param is False:\n+            param = \"0\"\n         if hasattr(param, 'bind_parameter'):\n-            self.smart_bytes = param.bind_parameter(cursor)\n+            self.force_bytes = param.bind_parameter(cursor)\n         else:\n-            self.smart_bytes = convert_unicode(param, cursor.charset,\n+            self.force_bytes = convert_unicode(param, cursor.charset,\n                                              strings_only)\n         if hasattr(param, 'input_size'):\n             # If parameter has `input_size` attribute, use that.\n@@ -676,7 +683,7 @@ def _guess_input_sizes(self, params_list):\n         self.setinputsizes(*sizes)\n \n     def _param_generator(self, params):\n-        return [p.smart_bytes for p in params]\n+        return [p.force_bytes for p in params]\n \n     def execute(self, query, params=None):\n         if params is None:"
        },
        {
            "sha": "24030cdffc3de76f9156bf27fb233029d523cef1",
            "filename": "django/db/backends/oracle/compiler.py",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Foracle%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Foracle%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fcompiler.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,4 +1,9 @@\n from django.db.models.sql import compiler\n+# The izip_longest was renamed to zip_longest in py3\n+try:\n+    from itertools import zip_longest\n+except ImportError:\n+    from itertools import izip_longest as zip_longest\n \n \n class SQLCompiler(compiler.SQLCompiler):\n@@ -10,10 +15,10 @@ def resolve_columns(self, row, fields=()):\n             rn_offset = 1\n         else:\n             rn_offset = 0\n-        index_start = rn_offset + len(self.query.extra_select.keys())\n+        index_start = rn_offset + len(self.query.extra_select)\n         values = [self.query.convert_values(v, None, connection=self.connection)\n                   for v in row[rn_offset:index_start]]\n-        for value, field in map(None, row[index_start:], fields):\n+        for value, field in zip_longest(row[index_start:], fields):\n             values.append(self.query.convert_values(value, field, connection=self.connection))\n         return tuple(values)\n "
        },
        {
            "sha": "4cad6e06a70622ebb55bd44f0c67e43606ef0b49",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -15,7 +15,7 @@\n from django.db.backends.postgresql_psycopg2.introspection import DatabaseIntrospection\n from django.db.backends.postgresql_psycopg2.schema import DatabaseSchemaEditor\n from django.utils.log import getLogger\n-from django.utils.safestring import SafeUnicode, SafeString\n+from django.utils.safestring import SafeText, SafeBytes\n from django.utils import six\n from django.utils.timezone import utc\n \n@@ -30,8 +30,8 @@\n IntegrityError = Database.IntegrityError\n \n psycopg2.extensions.register_type(psycopg2.extensions.UNICODE)\n-psycopg2.extensions.register_adapter(SafeString, psycopg2.extensions.QuotedString)\n-psycopg2.extensions.register_adapter(SafeUnicode, psycopg2.extensions.QuotedString)\n+psycopg2.extensions.register_adapter(SafeBytes, psycopg2.extensions.QuotedString)\n+psycopg2.extensions.register_adapter(SafeText, psycopg2.extensions.QuotedString)\n \n logger = getLogger('django.db.backends')\n "
        },
        {
            "sha": "916073c09f1a6906d46fac7e55c8f1ddec1bb0b1",
            "filename": "django/db/backends/postgresql_psycopg2/introspection.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -45,8 +45,8 @@ def get_table_description(self, cursor, table_name):\n             WHERE table_name = %s\"\"\", [table_name])\n         null_map = dict(cursor.fetchall())\n         cursor.execute(\"SELECT * FROM %s LIMIT 1\" % self.connection.ops.quote_name(table_name))\n-        return [tuple([item for item in line[:6]] + [null_map[line[0]]=='YES'])\n-            for line in cursor.description]\n+        return [line[:6] + (null_map[line[0]]=='YES',)\n+                for line in cursor.description]\n \n     def get_relations(self, cursor, table_name):\n         \"\"\""
        },
        {
            "sha": "d0a6fda78e1eb4cba049130abb1a4050313ef7b1",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -21,7 +21,7 @@\n from django.db.backends.sqlite3.schema import DatabaseSchemaEditor\n from django.utils.dateparse import parse_date, parse_datetime, parse_time\n from django.utils.functional import cached_property\n-from django.utils.safestring import SafeString\n+from django.utils.safestring import SafeBytes\n from django.utils import six\n from django.utils import timezone\n \n@@ -57,13 +57,21 @@ def adapt_datetime_with_timezone_support(value):\n         value = value.astimezone(timezone.utc).replace(tzinfo=None)\n     return value.isoformat(str(\" \"))\n \n-Database.register_converter(str(\"bool\"), lambda s: str(s) == '1')\n-Database.register_converter(str(\"time\"), parse_time)\n-Database.register_converter(str(\"date\"), parse_date)\n-Database.register_converter(str(\"datetime\"), parse_datetime_with_timezone_support)\n-Database.register_converter(str(\"timestamp\"), parse_datetime_with_timezone_support)\n-Database.register_converter(str(\"TIMESTAMP\"), parse_datetime_with_timezone_support)\n-Database.register_converter(str(\"decimal\"), util.typecast_decimal)\n+def decoder(conv_func):\n+    \"\"\" The Python sqlite3 interface returns always byte strings.\n+        This function converts the received value to a regular string before\n+        passing it to the receiver function.\n+    \"\"\"\n+    return lambda s: conv_func(s.decode('utf-8'))\n+\n+Database.register_converter(str(\"bool\"), decoder(lambda s: s == '1'))\n+Database.register_converter(str(\"time\"), decoder(parse_time))\n+Database.register_converter(str(\"date\"), decoder(parse_date))\n+Database.register_converter(str(\"datetime\"), decoder(parse_datetime_with_timezone_support))\n+Database.register_converter(str(\"timestamp\"), decoder(parse_datetime_with_timezone_support))\n+Database.register_converter(str(\"TIMESTAMP\"), decoder(parse_datetime_with_timezone_support))\n+Database.register_converter(str(\"decimal\"), decoder(util.typecast_decimal))\n+\n Database.register_adapter(datetime.datetime, adapt_datetime_with_timezone_support)\n Database.register_adapter(decimal.Decimal, util.rev_typecast_decimal)\n if Database.version_info >= (2, 4, 1):\n@@ -73,7 +81,7 @@ def adapt_datetime_with_timezone_support(value):\n     # slow-down, this adapter is only registered for sqlite3 versions\n     # needing it (Python 2.6 and up).\n     Database.register_adapter(str, lambda s: s.decode('utf-8'))\n-    Database.register_adapter(SafeString, lambda s: s.decode('utf-8'))\n+    Database.register_adapter(SafeBytes, lambda s: s.decode('utf-8'))\n \n class DatabaseFeatures(BaseDatabaseFeatures):\n     # SQLite cannot handle us only partially reading from a cursor's result set"
        },
        {
            "sha": "1df4c18c1c541a55c9861aa80dcb602129e58e0e",
            "filename": "django/db/backends/sqlite3/introspection.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fsqlite3%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Fsqlite3%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fintrospection.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,6 +1,14 @@\n import re\n from django.db.backends import BaseDatabaseIntrospection\n \n+field_size_re = re.compile(r'^\\s*(?:var)?char\\s*\\(\\s*(\\d+)\\s*\\)\\s*$')\n+\n+def get_field_size(name):\n+    \"\"\" Extract the size number from a \"varchar(11)\" type name \"\"\"\n+    m = field_size_re.search(name)\n+    return int(m.group(1)) if m else None\n+\n+\n # This light wrapper \"fakes\" a dictionary interface, because some SQLite data\n # types include variables in them -- e.g. \"varchar(30)\" -- and can't be matched\n # as a simple dictionary lookup.\n@@ -32,10 +40,9 @@ def __getitem__(self, key):\n         try:\n             return self.base_data_types_reverse[key]\n         except KeyError:\n-            import re\n-            m = re.search(r'^\\s*(?:var)?char\\s*\\(\\s*(\\d+)\\s*\\)\\s*$', key)\n-            if m:\n-                return ('CharField', {'max_length': int(m.group(1))})\n+            size = get_field_size(key)\n+            if size is not None:\n+                return ('CharField', {'max_length': size})\n             raise KeyError\n \n class DatabaseIntrospection(BaseDatabaseIntrospection):\n@@ -53,7 +60,7 @@ def get_table_list(self, cursor):\n \n     def get_table_description(self, cursor, table_name):\n         \"Returns a description of the table, with the DB-API cursor.description interface.\"\n-        return [(info['name'], info['type'], None, None, None, None,\n+        return [(info['name'], info['type'], None, info['size'], None, None,\n                  info['null_ok']) for info in self._table_info(cursor, table_name)]\n \n     def get_relations(self, cursor, table_name):\n@@ -171,6 +178,7 @@ def _table_info(self, cursor, name):\n         # cid, name, type, notnull, dflt_value, pk\n         return [{'name': field[1],\n                  'type': field[2],\n+                 'size': get_field_size(field[2]),\n                  'null_ok': not field[3],\n                  'pk': field[5]     # undocumented\n                  } for field in cursor.fetchall()]"
        },
        {
            "sha": "75d4d07a66507304615f95340a7242f3f045de49",
            "filename": "django/db/backends/util.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fbackends%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Futil.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,6 +6,7 @@\n from time import time\n \n from django.conf import settings\n+from django.utils.encoding import force_bytes\n from django.utils.log import getLogger\n from django.utils.timezone import utc\n \n@@ -137,7 +138,7 @@ def truncate_name(name, length=None, hash_len=4):\n     if length is None or len(name) <= length:\n         return name\n \n-    hsh = hashlib.md5(name).hexdigest()[:hash_len]\n+    hsh = hashlib.md5(force_bytes(name)).hexdigest()[:hash_len]\n     return '%s%s' % (name[:length-hash_len], hsh)\n \n def format_number(value, max_digits, decimal_places):"
        },
        {
            "sha": "62024c8ee4271bba5830806a7530d25e0f672732",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 24,
            "deletions": 6,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -23,7 +23,7 @@\n from django.db.models.loading import register_models, get_model\n from django.utils.translation import ugettext_lazy as _\n from django.utils.functional import curry\n-from django.utils.encoding import smart_bytes, force_text\n+from django.utils.encoding import force_str, force_text\n from django.utils import six\n from django.utils.text import get_text_list, capfirst\n \n@@ -404,10 +404,10 @@ def __repr__(self):\n             u = six.text_type(self)\n         except (UnicodeEncodeError, UnicodeDecodeError):\n             u = '[Bad Unicode data]'\n-        return smart_bytes('<%s: %s>' % (self.__class__.__name__, u))\n+        return force_str('<%s: %s>' % (self.__class__.__name__, u))\n \n     def __str__(self):\n-        if hasattr(self, '__unicode__'):\n+        if not six.PY3 and hasattr(self, '__unicode__'):\n             return force_text(self).encode('utf-8')\n         return '%s object' % self.__class__.__name__\n \n@@ -475,6 +475,7 @@ def save(self, force_insert=False, force_update=False, using=None,\n         that the \"save\" must be an SQL insert or update (or equivalent for\n         non-SQL backends), respectively. Normally, they should not be set.\n         \"\"\"\n+        using = using or router.db_for_write(self.__class__, instance=self)\n         if force_insert and (force_update or update_fields):\n             raise ValueError(\"Cannot force both insert and updating in model saving.\")\n \n@@ -502,6 +503,23 @@ def save(self, force_insert=False, force_update=False, using=None,\n                                  \"model or are m2m fields: %s\"\n                                  % ', '.join(non_model_fields))\n \n+        # If saving to the same database, and this model is deferred, then\n+        # automatically do a \"update_fields\" save on the loaded fields.\n+        elif not force_insert and self._deferred and using == self._state.db:\n+            field_names = set()\n+            for field in self._meta.fields:\n+                if not field.primary_key and not hasattr(field, 'through'):\n+                    field_names.add(field.attname)\n+            deferred_fields = [\n+                f.attname for f in self._meta.fields\n+                if f.attname not in self.__dict__\n+                   and isinstance(self.__class__.__dict__[f.attname],\n+                                  DeferredAttribute)]\n+\n+            loaded_fields = field_names.difference(deferred_fields)\n+            if loaded_fields:\n+                update_fields = frozenset(loaded_fields)\n+\n         self.save_base(using=using, force_insert=force_insert,\n                        force_update=force_update, update_fields=update_fields)\n     save.alters_data = True\n@@ -636,7 +654,7 @@ def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):\n             raise ValueError(\"get_next/get_previous cannot be used on unsaved objects.\")\n         op = is_next and 'gt' or 'lt'\n         order = not is_next and '-' or ''\n-        param = smart_bytes(getattr(self, field.attname))\n+        param = force_text(getattr(self, field.attname))\n         q = Q(**{'%s__%s' % (field.name, op): param})\n         q = q|Q(**{field.name: param, 'pk__%s' % op: self.pk})\n         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by('%s%s' % (order, field.name), '%spk' % order)\n@@ -761,7 +779,7 @@ def _perform_unique_checks(self, unique_checks):\n                 lookup_kwargs[str(field_name)] = lookup_value\n \n             # some fields were skipped, no reason to do the check\n-            if len(unique_check) != len(lookup_kwargs.keys()):\n+            if len(unique_check) != len(lookup_kwargs):\n                 continue\n \n             qs = model_class._default_manager.filter(**lookup_kwargs)\n@@ -837,7 +855,7 @@ def unique_error_message(self, model_class, unique_check):\n             }\n         # unique_together\n         else:\n-            field_labels = map(lambda f: capfirst(opts.get_field(f).verbose_name), unique_check)\n+            field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]\n             field_labels = get_text_list(field_labels, _('and'))\n             return _(\"%(model_name)s with this %(field_label)s already exists.\") %  {\n                 'model_name': six.text_type(model_name),"
        },
        {
            "sha": "639ef6ee10587e4b7098a88b8236dd7dd248f3f9",
            "filename": "django/db/models/expressions.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fexpressions.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fexpressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fexpressions.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -58,8 +58,9 @@ def __sub__(self, other):\n     def __mul__(self, other):\n         return self._combine(other, self.MUL, False)\n \n-    def __div__(self, other):\n+    def __truediv__(self, other):\n         return self._combine(other, self.DIV, False)\n+    __div__ = __truediv__ # Python 2 compatibility\n \n     def __mod__(self, other):\n         return self._combine(other, self.MOD, False)\n@@ -79,8 +80,9 @@ def __rsub__(self, other):\n     def __rmul__(self, other):\n         return self._combine(other, self.MUL, True)\n \n-    def __rdiv__(self, other):\n+    def __rtruediv__(self, other):\n         return self._combine(other, self.DIV, True)\n+    __rdiv__ = __rtruediv__ # Python 2 compatibility\n \n     def __rmod__(self, other):\n         return self._combine(other, self.MOD, True)"
        },
        {
            "sha": "58ae3413f3f1eb412d1f0694298b2391c122b81d",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1047,13 +1047,14 @@ class GenericIPAddressField(Field):\n     description = _(\"IP address\")\n     default_error_messages = {}\n \n-    def __init__(self, protocol='both', unpack_ipv4=False, *args, **kwargs):\n+    def __init__(self, verbose_name=None, name=None, protocol='both',\n+                 unpack_ipv4=False, *args, **kwargs):\n         self.unpack_ipv4 = unpack_ipv4\n         self.default_validators, invalid_error_message = \\\n             validators.ip_address_validators(protocol, unpack_ipv4)\n         self.default_error_messages['invalid'] = invalid_error_message\n         kwargs['max_length'] = 39\n-        Field.__init__(self, *args, **kwargs)\n+        Field.__init__(self, verbose_name, name, *args, **kwargs)\n \n     def get_internal_type(self):\n         return \"GenericIPAddressField\""
        },
        {
            "sha": "f16632ef25003e10a1287ade4a9f49f239a4d0c5",
            "filename": "django/db/models/fields/files.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,7 +8,7 @@\n from django.core.files.storage import default_storage\n from django.core.files.images import ImageFile\n from django.db.models import signals\n-from django.utils.encoding import force_text, smart_bytes\n+from django.utils.encoding import force_str, force_text\n from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n \n@@ -280,7 +280,7 @@ def contribute_to_class(self, cls, name):\n         setattr(cls, self.name, self.descriptor_class(self))\n \n     def get_directory_name(self):\n-        return os.path.normpath(force_text(datetime.datetime.now().strftime(smart_bytes(self.upload_to))))\n+        return os.path.normpath(force_text(datetime.datetime.now().strftime(force_str(self.upload_to))))\n \n     def get_filename(self, filename):\n         return os.path.normpath(self.storage.get_valid_name(os.path.basename(filename)))"
        },
        {
            "sha": "e6153aefe049126e3d66f72307a4973350a65888",
            "filename": "django/db/models/fields/subclassing.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Ffields%2Fsubclassing.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Ffields%2Fsubclassing.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Fsubclassing.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,8 +2,9 @@\n Convenience routines for creating non-trivial Field subclasses, as well as\n backwards compatibility utilities.\n \n-Add SubfieldBase as the __metaclass__ for your Field subclass, implement\n-to_python() and the other necessary methods and everything will work seamlessly.\n+Add SubfieldBase as the metaclass for your Field subclass, implement\n+to_python() and the other necessary methods and everything will work\n+seamlessly.\n \"\"\"\n \n class SubfieldBase(type):"
        },
        {
            "sha": "6814ce27ff01a0b57645e1287f71e10a458a3d6d",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n import re\n from bisect import bisect\n \n@@ -8,9 +10,10 @@\n from django.db.models.fields.proxy import OrderWrt\n from django.db.models.loading import get_models, app_cache_ready\n from django.utils.translation import activate, deactivate_all, get_language, string_concat\n-from django.utils.encoding import force_text, smart_bytes\n+from django.utils.encoding import force_text, smart_text\n from django.utils.datastructures import SortedDict\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n # Calculate the verbose_name by converting from InitialCaps to \"lowercase with spaces\".\n get_verbose_name = lambda class_name: re.sub('(((?<=[a-z])[A-Z])|([A-Z](?![A-Z]|$)))', ' \\\\1', class_name).lower().strip()\n@@ -20,6 +23,7 @@\n                  'order_with_respect_to', 'app_label', 'db_tablespace',\n                  'abstract', 'managed', 'proxy', 'auto_created')\n \n+@python_2_unicode_compatible\n class Options(object):\n     def __init__(self, meta, app_label=None):\n         self.local_fields, self.local_many_to_many = [], []\n@@ -199,7 +203,7 @@ def __repr__(self):\n         return '<Options for %s>' % self.object_name\n \n     def __str__(self):\n-        return \"%s.%s\" % (smart_bytes(self.app_label), smart_bytes(self.module_name))\n+        return \"%s.%s\" % (smart_text(self.app_label), smart_text(self.module_name))\n \n     def verbose_name_raw(self):\n         \"\"\"\n@@ -383,7 +387,7 @@ def get_all_related_objects_with_model(self, local_only=False,\n             predicates.append(lambda k, v: not k.field.rel.is_hidden())\n         cache = (self._related_objects_proxy_cache if include_proxy_eq\n                  else self._related_objects_cache)\n-        return filter(lambda t: all([p(*t) for p in predicates]), cache.items())\n+        return [t for t in cache.items() if all(p(*t) for p in predicates)]\n \n     def _fill_related_objects_cache(self):\n         cache = SortedDict()"
        },
        {
            "sha": "05c049b31f51c791129b4440b35a18a84922d0f9",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -472,7 +472,7 @@ def get_or_create(self, **kwargs):\n                     return self.get(**lookup), False\n                 except self.model.DoesNotExist:\n                     # Re-raise the IntegrityError with its original traceback.\n-                    six.reraise(exc_info[1], None, exc_info[2])\n+                    six.reraise(*exc_info)\n \n     def latest(self, field_name=None):\n         \"\"\"\n@@ -498,9 +498,7 @@ def in_bulk(self, id_list):\n                 \"Cannot use 'limit' or 'offset' with in_bulk\"\n         if not id_list:\n             return {}\n-        qs = self._clone()\n-        qs.query.add_filter(('pk__in', id_list))\n-        qs.query.clear_ordering(force_empty=True)\n+        qs = self.filter(pk__in=id_list).order_by()\n         return dict([(obj._get_pk_val(), obj) for obj in qs])\n \n     def delete(self):\n@@ -1107,7 +1105,7 @@ def iterator(self):\n             # If a field list has been specified, use it. Otherwise, use the\n             # full list of fields, including extras and aggregates.\n             if self._fields:\n-                fields = list(self._fields) + filter(lambda f: f not in self._fields, aggregate_names)\n+                fields = list(self._fields) + [f for f in aggregate_names if f not in self._fields]\n             else:\n                 fields = names\n "
        },
        {
            "sha": "cf7cad29bd42e9af4a4c15694d2d91d611b522db",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -470,9 +470,7 @@ def _setup_joins(self, pieces, opts, alias):\n         # Must use left outer joins for nullable fields and their relations.\n         # Ordering or distinct must not affect the returned set, and INNER\n         # JOINS for nullable fields could do this.\n-        if joins_to_promote:\n-            self.query.promote_alias_chain(joins_to_promote,\n-                self.query.alias_map[joins_to_promote[0]].join_type == self.query.LOUTER)\n+        self.query.promote_joins(joins_to_promote)\n         return field, col, alias, joins, opts\n \n     def _final_join_removal(self, col, alias):\n@@ -645,8 +643,6 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                     alias_chain.append(alias)\n                     for (dupe_opts, dupe_col) in dupe_set:\n                         self.query.update_dupe_avoidance(dupe_opts, dupe_col, alias)\n-                if self.query.alias_map[root_alias].join_type == self.query.LOUTER:\n-                    self.query.promote_alias_chain(alias_chain, True)\n             else:\n                 alias = root_alias\n \n@@ -663,8 +659,6 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n             columns, aliases = self.get_default_columns(start_alias=alias,\n                     opts=f.rel.to._meta, as_pairs=True)\n             self.query.related_select_cols.extend(columns)\n-            if self.query.alias_map[alias].join_type == self.query.LOUTER:\n-                self.query.promote_alias_chain(aliases, True)\n             self.query.related_select_fields.extend(f.rel.to._meta.fields)\n             if restricted:\n                 next = requested.get(f.name, {})\n@@ -738,7 +732,9 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                 self.query.related_select_fields.extend(model._meta.fields)\n \n                 next = requested.get(f.related_query_name(), {})\n-                new_nullable = f.null or None\n+                # Use True here because we are looking at the _reverse_ side of\n+                # the relation, which is always nullable.\n+                new_nullable = True\n \n                 self.fill_related_selections(model._meta, table, cur_depth+1,\n                     used, next, restricted, new_nullable)\n@@ -786,7 +782,7 @@ def results_iter(self):\n                     row = self.resolve_columns(row, fields)\n \n                 if has_aggregate_select:\n-                    aggregate_start = len(self.query.extra_select.keys()) + len(self.query.select)\n+                    aggregate_start = len(self.query.extra_select) + len(self.query.select)\n                     aggregate_end = aggregate_start + len(self.query.aggregate_select)\n                     row = tuple(row[:aggregate_start]) + tuple([\n                         self.query.resolve_aggregate(value, aggregate, self.connection)"
        },
        {
            "sha": "b9cf2c96fd68d4ee1a9b2d8ccd5b773401f6df55",
            "filename": "django/db/models/sql/constants.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fsql%2Fconstants.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fsql%2Fconstants.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fconstants.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,7 +1,7 @@\n from collections import namedtuple\n import re\n \n-# Valid query types (a dictionary is used for speedy lookups).\n+# Valid query types (a set is used for speedy lookups).\n QUERY_TERMS = set([\n     'exact', 'iexact', 'contains', 'icontains', 'gt', 'gte', 'lt', 'lte', 'in',\n     'startswith', 'istartswith', 'endswith', 'iendswith', 'range', 'year',"
        },
        {
            "sha": "1915efa7b9bb6ed0c23f8cc95e9e373185642fb5",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 55,
            "deletions": 51,
            "changes": 106,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -505,7 +505,7 @@ def combine(self, rhs, connector):\n                 # Again, some of the tables won't have aliases due to\n                 # the trimming of unnecessary tables.\n                 if self.alias_refcount.get(alias) or rhs.alias_refcount.get(alias):\n-                    self.promote_alias(alias, True)\n+                    self.promote_joins([alias], True)\n \n         # Now relabel a copy of the rhs where-clause and add it to the current\n         # one.\n@@ -682,32 +682,38 @@ def unref_alias(self, alias, amount=1):\n         \"\"\" Decreases the reference count for this alias. \"\"\"\n         self.alias_refcount[alias] -= amount\n \n-    def promote_alias(self, alias, unconditional=False):\n-        \"\"\"\n-        Promotes the join type of an alias to an outer join if it's possible\n-        for the join to contain NULL values on the left. If 'unconditional' is\n-        False, the join is only promoted if it is nullable, otherwise it is\n-        always promoted.\n-\n-        Returns True if the join was promoted by this call.\n-        \"\"\"\n-        if ((unconditional or self.alias_map[alias].nullable) and\n-                self.alias_map[alias].join_type != self.LOUTER):\n-            data = self.alias_map[alias]\n-            data = data._replace(join_type=self.LOUTER)\n-            self.alias_map[alias] = data\n-            return True\n-        return False\n-\n-    def promote_alias_chain(self, chain, must_promote=False):\n-        \"\"\"\n-        Walks along a chain of aliases, promoting the first nullable join and\n-        any joins following that. If 'must_promote' is True, all the aliases in\n-        the chain are promoted.\n-        \"\"\"\n-        for alias in chain:\n-            if self.promote_alias(alias, must_promote):\n-                must_promote = True\n+    def promote_joins(self, aliases, unconditional=False):\n+        \"\"\"\n+        Promotes recursively the join type of given aliases and its children to\n+        an outer join. If 'unconditional' is False, the join is only promoted if\n+        it is nullable or the parent join is an outer join.\n+\n+        Note about join promotion: When promoting any alias, we make sure all\n+        joins which start from that alias are promoted, too. When adding a join\n+        in join(), we make sure any join added to already existing LOUTER join\n+        is generated as LOUTER. This ensures we don't ever have broken join\n+        chains which contain first a LOUTER join, then an INNER JOIN, that is\n+        this kind of join should never be generated: a LOUTER b INNER c. The\n+        reason for avoiding this type of join chain is that the INNER after\n+        the LOUTER will effectively remove any effect the LOUTER had.\n+        \"\"\"\n+        aliases = list(aliases)\n+        while aliases:\n+            alias = aliases.pop(0)\n+            parent_alias = self.alias_map[alias].lhs_alias\n+            parent_louter = (parent_alias\n+                and self.alias_map[parent_alias].join_type == self.LOUTER)\n+            already_louter = self.alias_map[alias].join_type == self.LOUTER\n+            if ((unconditional or self.alias_map[alias].nullable\n+                 or parent_louter) and not already_louter):\n+                data = self.alias_map[alias]._replace(join_type=self.LOUTER)\n+                self.alias_map[alias] = data\n+                # Join type of 'alias' changed, so re-examine all aliases that\n+                # refer to this one.\n+                aliases.extend(\n+                    join for join in self.alias_map.keys()\n+                    if (self.alias_map[join].lhs_alias == alias\n+                        and join not in aliases))\n \n     def reset_refcounts(self, to_counts):\n         \"\"\"\n@@ -726,19 +732,10 @@ def promote_unused_aliases(self, initial_refcounts, used_aliases):\n         then and which ones haven't been used and promotes all of those\n         aliases, plus any children of theirs in the alias tree, to outer joins.\n         \"\"\"\n-        # FIXME: There's some (a lot of!) overlap with the similar OR promotion\n-        # in add_filter(). It's not quite identical, but is very similar. So\n-        # pulling out the common bits is something for later.\n-        considered = {}\n         for alias in self.tables:\n-            if alias not in used_aliases:\n-                continue\n-            if (alias not in initial_refcounts or\n+            if alias in used_aliases and (alias not in initial_refcounts or\n                     self.alias_refcount[alias] == initial_refcounts[alias]):\n-                parent = self.alias_map[alias].lhs_alias\n-                must_promote = considered.get(parent, False)\n-                promoted = self.promote_alias(alias, must_promote)\n-                considered[alias] = must_promote or promoted\n+                self.promote_joins([alias])\n \n     def change_aliases(self, change_map):\n         \"\"\"\n@@ -875,6 +872,9 @@ def join(self, connection, always_create=False, exclusions=(),\n         LOUTER join type. This is used when joining certain types of querysets\n         and Q-objects together.\n \n+        A join is always created as LOUTER if the lhs alias is LOUTER to make\n+        sure we do not generate chains like a LOUTER b INNER c.\n+\n         If 'nullable' is True, the join can potentially involve NULL values and\n         is a candidate for promotion (to \"left outer\") when combining querysets.\n         \"\"\"\n@@ -900,8 +900,8 @@ def join(self, connection, always_create=False, exclusions=(),\n                     if self.alias_map[alias].lhs_alias != lhs:\n                         continue\n                     self.ref_alias(alias)\n-                    if promote:\n-                        self.promote_alias(alias)\n+                    if promote or (lhs and self.alias_map[lhs].join_type == self.LOUTER):\n+                        self.promote_joins([alias])\n                     return alias\n \n         # No reuse is possible, so we need a new alias.\n@@ -910,7 +910,12 @@ def join(self, connection, always_create=False, exclusions=(),\n             # Not all tables need to be joined to anything. No join type\n             # means the later columns are ignored.\n             join_type = None\n-        elif promote or outer_if_first:\n+        elif (promote or outer_if_first\n+              or self.alias_map[lhs].join_type == self.LOUTER):\n+            # We need to use LOUTER join if asked by promote or outer_if_first,\n+            # or if the LHS table is left-joined in the query. Adding inner join\n+            # to an existing outer join effectively cancels the effect of the\n+            # outer join.\n             join_type = self.LOUTER\n         else:\n             join_type = self.INNER\n@@ -1004,8 +1009,7 @@ def add_aggregate(self, aggregate, model, alias, is_summary):\n             # If the aggregate references a model or field that requires a join,\n             # those joins must be LEFT OUTER - empty join rows must be returned\n             # in order for zeros to be returned for those aggregates.\n-            for column_alias in join_list:\n-                self.promote_alias(column_alias, unconditional=True)\n+            self.promote_joins(join_list, True)\n \n             col = (join_list[-1], col)\n         else:\n@@ -1124,7 +1128,7 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n             # If the comparison is against NULL, we may need to use some left\n             # outer joins when creating the join chain. This is only done when\n             # needed, as it's less efficient at the database level.\n-            self.promote_alias_chain(join_list)\n+            self.promote_joins(join_list)\n             join_promote = True\n \n         # Process the join list to see if we can remove any inner joins from\n@@ -1155,16 +1159,16 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n                     # This means that we are dealing with two different query\n                     # subtrees, so we don't need to do any join promotion.\n                     continue\n-                join_promote = join_promote or self.promote_alias(join, unconditional)\n+                join_promote = join_promote or self.promote_joins([join], unconditional)\n                 if table != join:\n-                    table_promote = self.promote_alias(table)\n+                    table_promote = self.promote_joins([table])\n                 # We only get here if we have found a table that exists\n                 # in the join list, but isn't on the original tables list.\n                 # This means we've reached the point where we only have\n                 # new tables, so we can break out of this promotion loop.\n                 break\n-            self.promote_alias_chain(join_it, join_promote)\n-            self.promote_alias_chain(table_it, table_promote or join_promote)\n+            self.promote_joins(join_it, join_promote)\n+            self.promote_joins(table_it, table_promote or join_promote)\n \n         if having_clause or force_having:\n             if (alias, col) not in self.group_by:\n@@ -1176,7 +1180,7 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n                 connector)\n \n         if negate:\n-            self.promote_alias_chain(join_list)\n+            self.promote_joins(join_list)\n             if lookup_type != 'isnull':\n                 if len(join_list) > 1:\n                     for alias in join_list:\n@@ -1550,7 +1554,7 @@ def split_exclude(self, filter_expr, prefix, can_reuse):\n         N-to-many relation field.\n         \"\"\"\n         query = Query(self.model)\n-        query.add_filter(filter_expr, can_reuse=can_reuse)\n+        query.add_filter(filter_expr)\n         query.bump_prefix()\n         query.clear_ordering(True)\n         query.set_start(prefix)\n@@ -1650,7 +1654,7 @@ def add_fields(self, field_names, allow_m2m=True):\n                         final_alias = join.lhs_alias\n                         col = join.lhs_join_col\n                         joins = joins[:-1]\n-                self.promote_alias_chain(joins[1:])\n+                self.promote_joins(joins[1:])\n                 self.select.append((final_alias, col))\n                 self.select_fields.append(field)\n         except MultiJoin:"
        },
        {
            "sha": "84d1b2183c3d114d0643d183a2bb1479a8be0302",
            "filename": "django/dispatch/saferef.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdispatch%2Fsaferef.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fdispatch%2Fsaferef.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fsaferef.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -149,9 +149,11 @@ def __str__(self):\n             self.selfName,\n             self.funcName,\n         )\n-    \n+\n     __repr__ = __str__\n-    \n+\n+    __hash__ = object.__hash__\n+\n     def __bool__( self ):\n         \"\"\"Whether we are still a valid reference\"\"\"\n         return self() is not None"
        },
        {
            "sha": "3299c2becc464603d92c7c97e10200694d845e07",
            "filename": "django/forms/forms.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fforms.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,7 +12,7 @@\n from django.forms.widgets import Media, media_property, TextInput, Textarea\n from django.utils.datastructures import SortedDict\n from django.utils.html import conditional_escape, format_html\n-from django.utils.encoding import StrAndUnicode, smart_text, force_text\n+from django.utils.encoding import smart_text, force_text, python_2_unicode_compatible\n from django.utils.safestring import mark_safe\n from django.utils import six\n \n@@ -68,7 +68,8 @@ def __new__(cls, name, bases, attrs):\n             new_class.media = media_property(new_class)\n         return new_class\n \n-class BaseForm(StrAndUnicode):\n+@python_2_unicode_compatible\n+class BaseForm(object):\n     # This is the main implementation of all the Form logic. Note that this\n     # class is different than Form. See the comments by the Form class for more\n     # information. Any improvements to the form API should be made to *this*\n@@ -95,7 +96,7 @@ def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n         # self.base_fields.\n         self.fields = copy.deepcopy(self.base_fields)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.as_table()\n \n     def __iter__(self):\n@@ -387,7 +388,8 @@ class Form(six.with_metaclass(DeclarativeFieldsMetaclass, BaseForm)):\n     # to define a form using declarative syntax.\n     # BaseForm itself has no way of designating self.fields.\n \n-class BoundField(StrAndUnicode):\n+@python_2_unicode_compatible\n+class BoundField(object):\n     \"A Field plus data\"\n     def __init__(self, form, field, name):\n         self.form = form\n@@ -402,7 +404,7 @@ def __init__(self, form, field, name):\n             self.label = self.field.label\n         self.help_text = field.help_text or ''\n \n-    def __unicode__(self):\n+    def __str__(self):\n         \"\"\"Renders this field as an HTML widget.\"\"\"\n         if self.field.show_hidden_initial:\n             return self.as_widget() + self.as_hidden(only_initial=True)"
        },
        {
            "sha": "bdcef92dec77ccb62dc85989f30c2100e4087bff",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 14,
            "deletions": 15,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,7 +5,7 @@\n from django.forms.fields import IntegerField, BooleanField\n from django.forms.util import ErrorList\n from django.forms.widgets import Media, HiddenInput\n-from django.utils.encoding import StrAndUnicode\n+from django.utils.encoding import python_2_unicode_compatible\n from django.utils.safestring import mark_safe\n from django.utils import six\n from django.utils.six.moves import xrange\n@@ -33,7 +33,8 @@ def __init__(self, *args, **kwargs):\n         self.base_fields[MAX_NUM_FORM_COUNT] = IntegerField(required=False, widget=HiddenInput)\n         super(ManagementForm, self).__init__(*args, **kwargs)\n \n-class BaseFormSet(StrAndUnicode):\n+@python_2_unicode_compatible\n+class BaseFormSet(object):\n     \"\"\"\n     A collection of instances of the same Form class.\n     \"\"\"\n@@ -51,7 +52,7 @@ def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n         # construct the forms in the formset\n         self._construct_forms()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.as_table()\n \n     def __iter__(self):\n@@ -94,10 +95,11 @@ def total_form_count(self):\n             total_forms = initial_forms + self.extra\n             # Allow all existing related objects/inlines to be displayed,\n             # but don't allow extra beyond max_num.\n-            if initial_forms > self.max_num >= 0:\n-                total_forms = initial_forms\n-            elif total_forms > self.max_num >= 0:\n-                total_forms = self.max_num\n+            if self.max_num is not None:\n+                if initial_forms > self.max_num >= 0:\n+                    total_forms = initial_forms\n+                elif total_forms > self.max_num >= 0:\n+                    total_forms = self.max_num\n         return total_forms\n \n     def initial_form_count(self):\n@@ -107,7 +109,7 @@ def initial_form_count(self):\n         else:\n             # Use the length of the inital data if it's there, 0 otherwise.\n             initial_forms = self.initial and len(self.initial) or 0\n-            if initial_forms > self.max_num >= 0:\n+            if self.max_num is not None and (initial_forms > self.max_num >= 0):\n                 initial_forms = self.max_num\n         return initial_forms\n \n@@ -252,13 +254,10 @@ def _get_errors(self):\n     errors = property(_get_errors)\n \n     def _should_delete_form(self, form):\n-        # The way we lookup the value of the deletion field here takes\n-        # more code than we'd like, but the form's cleaned_data will\n-        # not exist if the form is invalid.\n-        field = form.fields[DELETION_FIELD_NAME]\n-        raw_value = form._raw_value(DELETION_FIELD_NAME)\n-        should_delete = field.clean(raw_value)\n-        return should_delete\n+        \"\"\"\n+        Returns whether or not the form was marked for deletion.\n+        \"\"\"\n+        return form.cleaned_data.get(DELETION_FIELD_NAME, False)\n \n     def is_valid(self):\n         \"\"\""
        },
        {
            "sha": "1aa49eaaec300f390b08ff89ac936f9c17f487d7",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -18,7 +18,6 @@\n from django.utils import six\n from django.utils.text import get_text_list, capfirst\n from django.utils.translation import ugettext_lazy as _, ugettext\n-from django.utils import six\n \n \n __all__ = (\n@@ -401,13 +400,8 @@ def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n         'formfield_callback': formfield_callback\n     }\n \n-    form_metaclass = ModelFormMetaclass\n-\n-    # TODO: this doesn't work under Python 3.\n-    if issubclass(form, BaseModelForm) and hasattr(form, '__metaclass__'):\n-        form_metaclass = form.__metaclass__\n-\n-    return form_metaclass(class_name, (form,), form_class_attrs)\n+    # Instatiate type(form) in order to use the same metaclass as form.\n+    return type(form)(class_name, (form,), form_class_attrs)\n \n \n # ModelFormSets ##############################################################\n@@ -597,6 +591,10 @@ def save_existing_objects(self, commit=True):\n             return []\n \n         saved_instances = []\n+        try:\n+            forms_to_delete = self.deleted_forms\n+        except AttributeError:\n+            forms_to_delete = []\n         for form in self.initial_forms:\n             pk_name = self._pk_field.name\n             raw_pk_value = form._raw_value(pk_name)\n@@ -607,7 +605,7 @@ def save_existing_objects(self, commit=True):\n             pk_value = getattr(pk_value, 'pk', pk_value)\n \n             obj = self._existing_object(pk_value)\n-            if self.can_delete and self._should_delete_form(form):\n+            if form in forms_to_delete:\n                 self.deleted_objects.append(obj)\n                 obj.delete()\n                 continue"
        },
        {
            "sha": "9b1bcebe337e54ec8edcfe84959b7b25ca43f921",
            "filename": "django/forms/util.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Futil.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,7 +2,7 @@\n \n from django.conf import settings\n from django.utils.html import format_html, format_html_join\n-from django.utils.encoding import StrAndUnicode, force_text\n+from django.utils.encoding import force_text, python_2_unicode_compatible\n from django.utils.safestring import mark_safe\n from django.utils import timezone\n from django.utils.translation import ugettext_lazy as _\n@@ -22,13 +22,14 @@ def flatatt(attrs):\n     \"\"\"\n     return format_html_join('', ' {0}=\"{1}\"', attrs.items())\n \n-class ErrorDict(dict, StrAndUnicode):\n+@python_2_unicode_compatible\n+class ErrorDict(dict):\n     \"\"\"\n     A collection of errors that knows how to display itself in various formats.\n \n     The dictionary keys are the field names, and the values are the errors.\n     \"\"\"\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.as_ul()\n \n     def as_ul(self):\n@@ -42,11 +43,12 @@ def as_ul(self):\n     def as_text(self):\n         return '\\n'.join(['* %s\\n%s' % (k, '\\n'.join(['  * %s' % force_text(i) for i in v])) for k, v in self.items()])\n \n-class ErrorList(list, StrAndUnicode):\n+@python_2_unicode_compatible\n+class ErrorList(list):\n     \"\"\"\n     A collection of errors that knows how to display itself in various formats.\n     \"\"\"\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.as_ul()\n \n     def as_ul(self):"
        },
        {
            "sha": "fdb9f506884a28d942aab7b502ec9b0b6e1e5b9f",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -17,11 +17,9 @@\n from django.utils.datastructures import MultiValueDict, MergeDict\n from django.utils.html import conditional_escape, format_html, format_html_join\n from django.utils.translation import ugettext, ugettext_lazy\n-from django.utils.encoding import StrAndUnicode, force_text\n+from django.utils.encoding import force_text, python_2_unicode_compatible\n from django.utils.safestring import mark_safe\n-from django.utils import six\n-from django.utils import datetime_safe, formats\n-from django.utils import six\n+from django.utils import datetime_safe, formats, six\n \n __all__ = (\n     'Media', 'MediaDefiningClass', 'Widget', 'TextInput', 'PasswordInput',\n@@ -34,7 +32,8 @@\n \n MEDIA_TYPES = ('css','js')\n \n-class Media(StrAndUnicode):\n+@python_2_unicode_compatible\n+class Media(object):\n     def __init__(self, media=None, **kwargs):\n         if media:\n             media_attrs = media.__dict__\n@@ -51,7 +50,7 @@ def __init__(self, media=None, **kwargs):\n         # if media_attrs != {}:\n         #     raise TypeError(\"'class Media' has invalid attribute(s): %s\" % ','.join(media_attrs.keys()))\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.render()\n \n     def render(self):\n@@ -142,7 +141,8 @@ def __new__(cls, name, bases, attrs):\n             new_class.media = media_property(new_class)\n         return new_class\n \n-class SubWidget(StrAndUnicode):\n+@python_2_unicode_compatible\n+class SubWidget(object):\n     \"\"\"\n     Some widgets are made of multiple HTML elements -- namely, RadioSelect.\n     This is a class that represents the \"inner\" HTML element of a widget.\n@@ -152,7 +152,7 @@ def __init__(self, parent_widget, name, value, attrs, choices):\n         self.name, self.value = name, value\n         self.attrs, self.choices = attrs, choices\n \n-    def __unicode__(self):\n+    def __str__(self):\n         args = [self.name, self.value, self.attrs]\n         if self.choices:\n             args.append(self.choices)\n@@ -647,6 +647,7 @@ def _has_changed(self, initial, data):\n         data_set = set([force_text(value) for value in data])\n         return data_set != initial_set\n \n+@python_2_unicode_compatible\n class RadioInput(SubWidget):\n     \"\"\"\n     An object used by RadioFieldRenderer that represents a single\n@@ -660,7 +661,7 @@ def __init__(self, name, value, attrs, choice, index):\n         self.choice_label = force_text(choice[1])\n         self.index = index\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.render()\n \n     def render(self, name=None, value=None, attrs=None, choices=()):\n@@ -685,7 +686,8 @@ def tag(self):\n             final_attrs['checked'] = 'checked'\n         return format_html('<input{0} />', flatatt(final_attrs))\n \n-class RadioFieldRenderer(StrAndUnicode):\n+@python_2_unicode_compatible\n+class RadioFieldRenderer(object):\n     \"\"\"\n     An object used by RadioSelect to enable customization of radio widgets.\n     \"\"\"\n@@ -702,7 +704,7 @@ def __getitem__(self, idx):\n         choice = self.choices[idx] # Let the IndexError propogate\n         return RadioInput(self.name, self.value, self.attrs.copy(), choice, idx)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.render()\n \n     def render(self):"
        },
        {
            "sha": "2198f38cbbbe272e1717326bbd8e091a7d22c574",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 119,
            "deletions": 80,
            "changes": 199,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -61,14 +61,14 @@ def value_encode(self, val):\n         if not _cookie_allows_colon_in_names:\n             def load(self, rawdata):\n                 self.bad_cookies = set()\n-                super(SimpleCookie, self).load(smart_bytes(rawdata))\n+                super(SimpleCookie, self).load(force_str(rawdata))\n                 for key in self.bad_cookies:\n                     del self[key]\n \n             # override private __set() method:\n             # (needed for using our Morsel, and for laxness with CookieError\n             def _BaseCookie__set(self, key, real_value, coded_value):\n-                key = smart_bytes(key)\n+                key = force_str(key)\n                 try:\n                     M = self.get(key, Morsel())\n                     M.set(key, real_value, coded_value)\n@@ -85,7 +85,7 @@ def _BaseCookie__set(self, key, real_value, coded_value):\n from django.http.multipartparser import MultiPartParser\n from django.http.utils import *\n from django.utils.datastructures import MultiValueDict, ImmutableList\n-from django.utils.encoding import smart_bytes, iri_to_uri, force_text\n+from django.utils.encoding import force_bytes, force_str, force_text, iri_to_uri\n from django.utils.http import cookie_date\n from django.utils import six\n from django.utils import timezone\n@@ -113,7 +113,7 @@ def build_request_repr(request, path_override=None, GET_override=None,\n         get = (pformat(GET_override)\n                if GET_override is not None\n                else pformat(request.GET))\n-    except:\n+    except Exception:\n         get = '<could not parse>'\n     if request._post_parse_error:\n         post = '<could not parse>'\n@@ -122,22 +122,22 @@ def build_request_repr(request, path_override=None, GET_override=None,\n             post = (pformat(POST_override)\n                     if POST_override is not None\n                     else pformat(request.POST))\n-        except:\n+        except Exception:\n             post = '<could not parse>'\n     try:\n         cookies = (pformat(COOKIES_override)\n                    if COOKIES_override is not None\n                    else pformat(request.COOKIES))\n-    except:\n+    except Exception:\n         cookies = '<could not parse>'\n     try:\n         meta = (pformat(META_override)\n                 if META_override is not None\n                 else pformat(request.META))\n-    except:\n+    except Exception:\n         meta = '<could not parse>'\n     path = path_override if path_override is not None else request.path\n-    return smart_bytes('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n+    return force_str('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n                      (request.__class__.__name__,\n                       path,\n                       six.text_type(get),\n@@ -177,14 +177,14 @@ def get_host(self):\n             # Reconstruct the host using the algorithm from PEP 333.\n             host = self.META['SERVER_NAME']\n             server_port = str(self.META['SERVER_PORT'])\n-            if server_port != (self.is_secure() and '443' or '80'):\n+            if server_port != ('443' if self.is_secure() else '80'):\n                 host = '%s:%s' % (host, server_port)\n         return host\n \n     def get_full_path(self):\n         # RFC 3986 requires query string arguments to be in the ASCII range.\n         # Rather than crash if this doesn't happen, we encode defensively.\n-        return '%s%s' % (self.path, self.META.get('QUERY_STRING', '') and ('?' + iri_to_uri(self.META.get('QUERY_STRING', ''))) or '')\n+        return '%s%s' % (self.path, ('?' + iri_to_uri(self.META.get('QUERY_STRING', ''))) if self.META.get('QUERY_STRING', '') else '')\n \n     def get_signed_cookie(self, key, default=RAISE_ERROR, salt='', max_age=None):\n         \"\"\"\n@@ -193,7 +193,7 @@ def get_signed_cookie(self, key, default=RAISE_ERROR, salt='', max_age=None):\n         default argument in which case that value will be returned instead.\n         \"\"\"\n         try:\n-            cookie_value = self.COOKIES[key].encode('utf-8')\n+            cookie_value = self.COOKIES[key]\n         except KeyError:\n             if default is not RAISE_ERROR:\n                 return default\n@@ -218,7 +218,7 @@ def build_absolute_uri(self, location=None):\n         if not location:\n             location = self.get_full_path()\n         if not absolute_http_url_re.match(location):\n-            current_uri = '%s://%s%s' % (self.is_secure() and 'https' or 'http',\n+            current_uri = '%s://%s%s' % ('https' if self.is_secure() else 'http',\n                                          self.get_host(), self.path)\n             location = urljoin(current_uri, location)\n         return iri_to_uri(location)\n@@ -243,7 +243,12 @@ def is_secure(self):\n     def is_ajax(self):\n         return self.META.get('HTTP_X_REQUESTED_WITH') == 'XMLHttpRequest'\n \n-    def _set_encoding(self, val):\n+    @property\n+    def encoding(self):\n+        return self._encoding\n+\n+    @encoding.setter\n+    def encoding(self, val):\n         \"\"\"\n         Sets the encoding used for GET/POST accesses. If the GET or POST\n         dictionary has already been created, it is removed and recreated on the\n@@ -255,33 +260,28 @@ def _set_encoding(self, val):\n         if hasattr(self, '_post'):\n             del self._post\n \n-    def _get_encoding(self):\n-        return self._encoding\n-\n-    encoding = property(_get_encoding, _set_encoding)\n-\n     def _initialize_handlers(self):\n         self._upload_handlers = [uploadhandler.load_handler(handler, self)\n                                  for handler in settings.FILE_UPLOAD_HANDLERS]\n \n-    def _set_upload_handlers(self, upload_handlers):\n-        if hasattr(self, '_files'):\n-            raise AttributeError(\"You cannot set the upload handlers after the upload has been processed.\")\n-        self._upload_handlers = upload_handlers\n-\n-    def _get_upload_handlers(self):\n+    @property\n+    def upload_handlers(self):\n         if not self._upload_handlers:\n             # If there are no upload handlers defined, initialize them from settings.\n             self._initialize_handlers()\n         return self._upload_handlers\n \n-    upload_handlers = property(_get_upload_handlers, _set_upload_handlers)\n+    @upload_handlers.setter\n+    def upload_handlers(self, upload_handlers):\n+        if hasattr(self, '_files'):\n+            raise AttributeError(\"You cannot set the upload handlers after the upload has been processed.\")\n+        self._upload_handlers = upload_handlers\n \n     def parse_file_upload(self, META, post_data):\n         \"\"\"Returns a tuple of (POST QueryDict, FILES MultiValueDict).\"\"\"\n         self.upload_handlers = ImmutableList(\n             self.upload_handlers,\n-            warning = \"You cannot alter upload handlers after the upload has been processed.\"\n+            warning=\"You cannot alter upload handlers after the upload has been processed.\"\n         )\n         parser = MultiPartParser(META, post_data, self.upload_handlers, self.encoding)\n         return parser.parse()\n@@ -294,7 +294,7 @@ def body(self):\n             try:\n                 self._body = self.read()\n             except IOError as e:\n-                six.reraise(UnreadablePostError, e, sys.exc_traceback)\n+                six.reraise(UnreadablePostError, UnreadablePostError(*e.args), sys.exc_info()[2])\n             self._stream = BytesIO(self._body)\n         return self._body\n \n@@ -360,6 +360,7 @@ def xreadlines(self):\n             if not buf:\n                 break\n             yield buf\n+\n     __iter__ = xreadlines\n \n     def readlines(self):\n@@ -384,29 +385,36 @@ def __init__(self, query_string, mutable=False, encoding=None):\n         if not encoding:\n             encoding = settings.DEFAULT_CHARSET\n         self.encoding = encoding\n-        for key, value in parse_qsl((query_string or ''), True): # keep_blank_values=True\n-            self.appendlist(force_text(key, encoding, errors='replace'),\n-                            force_text(value, encoding, errors='replace'))\n+        if six.PY3:\n+            for key, value in parse_qsl(query_string or '',\n+                                        keep_blank_values=True,\n+                                        encoding=encoding):\n+                self.appendlist(key, value)\n+        else:\n+            for key, value in parse_qsl(query_string or '',\n+                                        keep_blank_values=True):\n+                self.appendlist(force_text(key, encoding, errors='replace'),\n+                                force_text(value, encoding, errors='replace'))\n         self._mutable = mutable\n \n-    def _get_encoding(self):\n+    @property\n+    def encoding(self):\n         if self._encoding is None:\n             self._encoding = settings.DEFAULT_CHARSET\n         return self._encoding\n \n-    def _set_encoding(self, value):\n+    @encoding.setter\n+    def encoding(self, value):\n         self._encoding = value\n \n-    encoding = property(_get_encoding, _set_encoding)\n-\n     def _assert_mutable(self):\n         if not self._mutable:\n             raise AttributeError(\"This QueryDict instance is immutable\")\n \n     def __setitem__(self, key, value):\n         self._assert_mutable()\n-        key = str_to_unicode(key, self.encoding)\n-        value = str_to_unicode(value, self.encoding)\n+        key = bytes_to_text(key, self.encoding)\n+        value = bytes_to_text(value, self.encoding)\n         super(QueryDict, self).__setitem__(key, value)\n \n     def __delitem__(self, key):\n@@ -415,21 +423,21 @@ def __delitem__(self, key):\n \n     def __copy__(self):\n         result = self.__class__('', mutable=True, encoding=self.encoding)\n-        for key, value in self.iterlists():\n+        for key, value in six.iterlists(self):\n             result.setlist(key, value)\n         return result\n \n     def __deepcopy__(self, memo):\n         result = self.__class__('', mutable=True, encoding=self.encoding)\n         memo[id(self)] = result\n-        for key, value in self.iterlists():\n+        for key, value in six.iterlists(self):\n             result.setlist(copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n         return result\n \n     def setlist(self, key, list_):\n         self._assert_mutable()\n-        key = str_to_unicode(key, self.encoding)\n-        list_ = [str_to_unicode(elt, self.encoding) for elt in list_]\n+        key = bytes_to_text(key, self.encoding)\n+        list_ = [bytes_to_text(elt, self.encoding) for elt in list_]\n         super(QueryDict, self).setlist(key, list_)\n \n     def setlistdefault(self, key, default_list=None):\n@@ -438,8 +446,8 @@ def setlistdefault(self, key, default_list=None):\n \n     def appendlist(self, key, value):\n         self._assert_mutable()\n-        key = str_to_unicode(key, self.encoding)\n-        value = str_to_unicode(value, self.encoding)\n+        key = bytes_to_text(key, self.encoding)\n+        value = bytes_to_text(value, self.encoding)\n         super(QueryDict, self).appendlist(key, value)\n \n     def pop(self, key, *args):\n@@ -456,8 +464,8 @@ def clear(self):\n \n     def setdefault(self, key, default=None):\n         self._assert_mutable()\n-        key = str_to_unicode(key, self.encoding)\n-        default = str_to_unicode(default, self.encoding)\n+        key = bytes_to_text(key, self.encoding)\n+        default = bytes_to_text(default, self.encoding)\n         return super(QueryDict, self).setdefault(key, default)\n \n     def copy(self):\n@@ -481,13 +489,13 @@ def urlencode(self, safe=None):\n         \"\"\"\n         output = []\n         if safe:\n-            safe = smart_bytes(safe, self.encoding)\n+            safe = force_bytes(safe, self.encoding)\n             encode = lambda k, v: '%s=%s' % ((quote(k, safe), quote(v, safe)))\n         else:\n             encode = lambda k, v: urlencode({k: v})\n         for k, list_ in self.lists():\n-            k = smart_bytes(k, self.encoding)\n-            output.extend([encode(k, smart_bytes(v, self.encoding))\n+            k = force_bytes(k, self.encoding)\n+            output.extend([encode(k, force_bytes(v, self.encoding))\n                            for v in list_])\n         return '&'.join(output)\n \n@@ -531,37 +539,48 @@ def __init__(self, content='', content_type=None, status=None,\n         if not content_type:\n             content_type = \"%s; charset=%s\" % (settings.DEFAULT_CONTENT_TYPE,\n                     self._charset)\n+        # content is a bytestring. See the content property methods.\n         self.content = content\n         self.cookies = SimpleCookie()\n         if status:\n             self.status_code = status\n \n         self['Content-Type'] = content_type\n \n-    def __str__(self):\n-        \"\"\"Full HTTP message, including headers.\"\"\"\n-        return '\\n'.join(['%s: %s' % (key, value)\n-            for key, value in self._headers.values()]) \\\n-            + '\\n\\n' + self.content\n+    def serialize(self):\n+        \"\"\"Full HTTP message, including headers, as a bytestring.\"\"\"\n+        headers = [\n+            ('%s: %s' % (key, value)).encode('us-ascii')\n+            for key, value in self._headers.values()\n+        ]\n+        return b'\\r\\n'.join(headers) + b'\\r\\n\\r\\n' + self.content\n+\n+    if six.PY3:\n+        __bytes__ = serialize\n+    else:\n+        __str__ = serialize\n \n     def _convert_to_ascii(self, *values):\n         \"\"\"Converts all values to ascii strings.\"\"\"\n         for value in values:\n-            if isinstance(value, six.text_type):\n-                try:\n-                    if not six.PY3:\n-                        value = value.encode('us-ascii')\n-                    else:\n-                        # In Python 3, use a string in headers,\n-                        # but ensure in only contains ASCII characters.\n-                        value.encode('us-ascii')\n-                except UnicodeError as e:\n-                    e.reason += ', HTTP response headers must be in US-ASCII format'\n-                    raise\n-            else:\n+            if not isinstance(value, six.string_types):\n                 value = str(value)\n+            try:\n+                if six.PY3:\n+                    # Ensure string only contains ASCII\n+                    value.encode('us-ascii')\n+                else:\n+                    if isinstance(value, str):\n+                        # Ensure string only contains ASCII\n+                        value.decode('us-ascii')\n+                    else:\n+                        # Convert unicode to an ASCII string\n+                        value = value.encode('us-ascii')\n+            except UnicodeError as e:\n+                e.reason += ', HTTP response headers must be in US-ASCII format'\n+                raise\n             if '\\n' in value or '\\r' in value:\n-                raise BadHeaderError(\"Header values can't contain newlines (got %r)\" % (value))\n+                raise BadHeaderError(\"Header values can't contain newlines (got %r)\" % value)\n             yield value\n \n     def __setitem__(self, header, value):\n@@ -650,30 +669,40 @@ def delete_cookie(self, key, path='/', domain=None):\n         self.set_cookie(key, max_age=0, path=path, domain=domain,\n                         expires='Thu, 01-Jan-1970 00:00:00 GMT')\n \n-    def _get_content(self):\n+    @property\n+    def content(self):\n         if self.has_header('Content-Encoding'):\n-            return b''.join([str(e) for e in self._container])\n-        return b''.join([smart_bytes(e, self._charset) for e in self._container])\n-\n-    def _set_content(self, value):\n-        if hasattr(value, '__iter__') and not isinstance(value, (bytes, six.text_type)):\n+            def make_bytes(value):\n+                if isinstance(value, int):\n+                    value = six.text_type(value)\n+                if isinstance(value, six.text_type):\n+                    value = value.encode('ascii')\n+                # force conversion to bytes in case chunk is a subclass\n+                return bytes(value)\n+            return b''.join(make_bytes(e) for e in self._container)\n+        return b''.join(force_bytes(e, self._charset) for e in self._container)\n+\n+    @content.setter\n+    def content(self, value):\n+        if hasattr(value, '__iter__') and not isinstance(value, (bytes, six.string_types)):\n             self._container = value\n             self._base_content_is_iter = True\n         else:\n             self._container = [value]\n             self._base_content_is_iter = False\n \n-    content = property(_get_content, _set_content)\n-\n     def __iter__(self):\n         self._iterator = iter(self._container)\n         return self\n \n     def __next__(self):\n         chunk = next(self._iterator)\n+        if isinstance(chunk, int):\n+            chunk = six.text_type(chunk)\n         if isinstance(chunk, six.text_type):\n             chunk = chunk.encode(self._charset)\n-        return str(chunk)\n+        # force conversion to bytes in case chunk is a subclass\n+        return bytes(chunk)\n \n     next = __next__             # Python 2 compatibility\n \n@@ -699,11 +728,11 @@ def tell(self):\n class HttpResponseRedirectBase(HttpResponse):\n     allowed_schemes = ['http', 'https', 'ftp']\n \n-    def __init__(self, redirect_to):\n+    def __init__(self, redirect_to, *args, **kwargs):\n         parsed = urlparse(redirect_to)\n         if parsed.scheme and parsed.scheme not in self.allowed_schemes:\n             raise SuspiciousOperation(\"Unsafe redirect to URL with protocol '%s'\" % parsed.scheme)\n-        super(HttpResponseRedirectBase, self).__init__()\n+        super(HttpResponseRedirectBase, self).__init__(*args, **kwargs)\n         self['Location'] = iri_to_uri(redirect_to)\n \n class HttpResponseRedirect(HttpResponseRedirectBase):\n@@ -715,6 +744,16 @@ class HttpResponsePermanentRedirect(HttpResponseRedirectBase):\n class HttpResponseNotModified(HttpResponse):\n     status_code = 304\n \n+    def __init__(self, *args, **kwargs):\n+        super(HttpResponseNotModified, self).__init__(*args, **kwargs)\n+        del self['content-type']\n+\n+    @HttpResponse.content.setter\n+    def content(self, value):\n+        if value:\n+            raise AttributeError(\"You cannot set content to a 304 (Not Modified) response\")\n+        self._container = []\n+\n class HttpResponseBadRequest(HttpResponse):\n     status_code = 400\n \n@@ -727,8 +766,8 @@ class HttpResponseForbidden(HttpResponse):\n class HttpResponseNotAllowed(HttpResponse):\n     status_code = 405\n \n-    def __init__(self, permitted_methods):\n-        super(HttpResponseNotAllowed, self).__init__()\n+    def __init__(self, permitted_methods, *args, **kwargs):\n+        super(HttpResponseNotAllowed, self).__init__(*args, **kwargs)\n         self['Allow'] = ', '.join(permitted_methods)\n \n class HttpResponseGone(HttpResponse):\n@@ -743,8 +782,8 @@ def get_host(request):\n \n # It's neither necessary nor appropriate to use\n # django.utils.encoding.smart_text for parsing URLs and form inputs. Thus,\n-# this slightly more restricted function.\n-def str_to_unicode(s, encoding):\n+# this slightly more restricted function, used by QueryDict.\n+def bytes_to_text(s, encoding):\n     \"\"\"\n     Converts basestring objects to unicode, using the given encoding. Illegally\n     encoded input characters are replaced with Unicode \"unknown\" codepoint"
        },
        {
            "sha": "e76a4f4208cc0e602661caa6eafe16dbc1c74890",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,7 +6,9 @@\n \"\"\"\n from __future__ import unicode_literals\n \n+import base64\n import cgi\n+\n from django.conf import settings\n from django.core.exceptions import SuspiciousOperation\n from django.utils.datastructures import MultiValueDict\n@@ -199,7 +201,7 @@ def parse(self):\n                             if transfer_encoding == 'base64':\n                                 # We only special-case base64 transfer encoding\n                                 try:\n-                                    chunk = str(chunk).decode('base64')\n+                                    chunk = base64.b64decode(chunk)\n                                 except Exception as e:\n                                     # Since this is only a chunk, any error is an unfixable error.\n                                     raise MultiPartParserError(\"Could not decode base64 data: %r\" % e)\n@@ -507,9 +509,11 @@ def _find_boundary(self, data, eof = False):\n             end = index\n             next = index + len(self._boundary)\n             # backup over CRLF\n-            if data[max(0,end-1)] == b'\\n':\n+            last = max(0, end-1)\n+            if data[last:last+1] == b'\\n':\n                 end -= 1\n-            if data[max(0,end-1)] == b'\\r':\n+            last = max(0, end-1)\n+            if data[last:last+1] == b'\\r':\n                 end -= 1\n             return end, next\n \n@@ -613,7 +617,7 @@ def parse_header(line):\n         if i >= 0:\n             name = p[:i].strip().lower().decode('ascii')\n             value = p[i+1:].strip()\n-            if len(value) >= 2 and value[0] == value[-1] == b'\"':\n+            if len(value) >= 2 and value[:1] == value[-1:] == b'\"':\n                 value = value[1:-1]\n                 value = value.replace(b'\\\\\\\\', b'\\\\').replace(b'\\\\\"', b'\"')\n             pdict[name] = value"
        },
        {
            "sha": "305b20e1c4411d019d742d39d584b77c81cc1c21",
            "filename": "django/middleware/csrf.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fmiddleware%2Fcsrf.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fmiddleware%2Fcsrf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcsrf.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,6 +4,7 @@\n This module provides a middleware that implements protection\n against request forgeries from other sites.\n \"\"\"\n+from __future__ import unicode_literals\n \n import hashlib\n import re\n@@ -12,6 +13,7 @@\n from django.conf import settings\n from django.core.urlresolvers import get_callable\n from django.utils.cache import patch_vary_headers\n+from django.utils.encoding import force_text\n from django.utils.http import same_origin\n from django.utils.log import getLogger\n from django.utils.crypto import constant_time_compare, get_random_string\n@@ -51,11 +53,10 @@ def get_token(request):\n \n \n def _sanitize_token(token):\n-    # Allow only alphanum, and ensure we return a 'str' for the sake\n-    # of the post processing middleware.\n+    # Allow only alphanum\n     if len(token) > CSRF_KEY_LENGTH:\n         return _get_new_csrf_key()\n-    token = re.sub('[^a-zA-Z0-9]+', '', str(token.decode('ascii', 'ignore')))\n+    token = re.sub('[^a-zA-Z0-9]+', '', force_text(token))\n     if token == \"\":\n         # In case the cookie has been truncated to nothing at some point.\n         return _get_new_csrf_key()"
        },
        {
            "sha": "0a2b2c943797f4c4a2e9d7acacdc7a1a29e3593a",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,7 +11,7 @@\n from django.utils.itercompat import is_iterable\n from django.utils.text import (smart_split, unescape_string_literal,\n     get_text_list)\n-from django.utils.encoding import smart_text, force_text, smart_bytes\n+from django.utils.encoding import force_str, force_text\n from django.utils.translation import ugettext_lazy, pgettext_lazy\n from django.utils.safestring import (SafeData, EscapeData, mark_safe,\n     mark_for_escaping)\n@@ -20,6 +20,7 @@\n from django.utils.module_loading import module_has_submodule\n from django.utils import six\n from django.utils.timezone import template_localtime\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n TOKEN_TEXT = 0\n@@ -79,16 +80,14 @@ class TemplateDoesNotExist(Exception):\n class TemplateEncodingError(Exception):\n     pass\n \n+@python_2_unicode_compatible\n class VariableDoesNotExist(Exception):\n \n     def __init__(self, msg, params=()):\n         self.msg = msg\n         self.params = params\n \n     def __str__(self):\n-        return six.text_type(self).encode('utf-8')\n-\n-    def __unicode__(self):\n         return self.msg % tuple([force_text(p, errors='replace')\n                                  for p in self.params])\n \n@@ -117,7 +116,7 @@ class Template(object):\n     def __init__(self, template_string, origin=None,\n                  name='<Unknown Template>'):\n         try:\n-            template_string = smart_text(template_string)\n+            template_string = force_text(template_string)\n         except UnicodeDecodeError:\n             raise TemplateEncodingError(\"Templates can only be constructed \"\n                                         \"from unicode or UTF-8 strings.\")\n@@ -849,7 +848,7 @@ def __init__(self, s):\n         self.s = s\n \n     def __repr__(self):\n-        return \"<Text Node: '%s'>\" % smart_bytes(self.s[:25], 'ascii',\n+        return force_str(\"<Text Node: '%s'>\" % self.s[:25], 'ascii',\n                 errors='replace')\n \n     def render(self, context):"
        },
        {
            "sha": "1bfb6270239e9f78f6535d2d3e0a30d331bea298",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -231,12 +231,12 @@ def make_list(value):\n @stringfilter\n def slugify(value):\n     \"\"\"\n-    Normalizes string, converts to lowercase, removes non-alpha characters,\n-    and converts spaces to hyphens.\n+    Converts to lowercase, removes non-word characters (alphanumerics and\n+    underscores) and converts spaces to hyphens. Also strips leading and\n+    trailing whitespace.\n     \"\"\"\n-    value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore')\n-    value = six.text_type(re.sub('[^\\w\\s-]', '', value).strip().lower())\n-    return mark_safe(re.sub('[-\\s]+', '-', value))\n+    from django.utils.text import slugify\n+    return slugify(value)\n \n @register.filter(is_safe=True)\n def stringformat(value, arg):\n@@ -468,13 +468,8 @@ def safeseq(value):\n @stringfilter\n def removetags(value, tags):\n     \"\"\"Removes a space separated list of [X]HTML tags from the output.\"\"\"\n-    tags = [re.escape(tag) for tag in tags.split()]\n-    tags_re = '(%s)' % '|'.join(tags)\n-    starttag_re = re.compile(r'<%s(/?>|(\\s+[^>]*>))' % tags_re, re.U)\n-    endtag_re = re.compile('</%s>' % tags_re)\n-    value = starttag_re.sub('', value)\n-    value = endtag_re.sub('', value)\n-    return value\n+    from django.utils.html import remove_tags\n+    return remove_tags(value, tags)\n \n @register.filter(is_safe=True)\n @stringfilter"
        },
        {
            "sha": "cb2ecd26d8fedb5cd489a2b02af47a8f6e3064d6",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -448,15 +448,15 @@ def render(self, context):\n             max_width = int(self.max_width.resolve(context))\n         except VariableDoesNotExist:\n             return ''\n-        except ValueError:\n+        except (ValueError, TypeError):\n             raise TemplateSyntaxError(\"widthratio final argument must be an number\")\n         try:\n             value = float(value)\n             max_value = float(max_value)\n             ratio = (value / max_value) * max_width\n         except ZeroDivisionError:\n             return '0'\n-        except ValueError:\n+        except (ValueError, TypeError):\n             return ''\n         return str(int(round(ratio)))\n "
        },
        {
            "sha": "7e35b34ec4e4a424db442ce4059583c94573876e",
            "filename": "django/template/loaders/eggs.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Floaders%2Feggs.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Floaders%2Feggs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floaders%2Feggs.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,13 +1,15 @@\n # Wrapper for loading templates from eggs via pkg_resources.resource_string.\n+from __future__ import unicode_literals\n \n try:\n     from pkg_resources import resource_string\n except ImportError:\n     resource_string = None\n \n+from django.conf import settings\n from django.template.base import TemplateDoesNotExist\n from django.template.loader import BaseLoader\n-from django.conf import settings\n+from django.utils import six\n \n class Loader(BaseLoader):\n     is_usable = resource_string is not None\n@@ -22,9 +24,12 @@ def load_template_source(self, template_name, template_dirs=None):\n             pkg_name = 'templates/' + template_name\n             for app in settings.INSTALLED_APPS:\n                 try:\n-                    return (resource_string(app, pkg_name).decode(settings.FILE_CHARSET), 'egg:%s:%s' % (app, pkg_name))\n-                except:\n-                    pass\n+                    resource = resource_string(app, pkg_name)\n+                except Exception:\n+                    continue\n+                if not six.PY3:\n+                    resource = resource.decode(settings.FILE_CHARSET)\n+                return (resource, 'egg:%s:%s' % (app, pkg_name))\n         raise TemplateDoesNotExist(template_name)\n \n _loader = Loader()"
        },
        {
            "sha": "2cb44d127d25b9a59a9058bd0d5f70c47f769c2e",
            "filename": "django/template/response.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplate%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fresponse.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -102,7 +102,7 @@ def render(self):\n         \"\"\"\n         retval = self\n         if not self._is_rendered:\n-            self._set_content(self.rendered_content)\n+            self.content = self.rendered_content\n             for post_callback in self._post_render_callbacks:\n                 newretval = post_callback(retval)\n                 if newretval is not None:\n@@ -119,20 +119,20 @@ def __iter__(self):\n                                           'rendered before it can be iterated over.')\n         return super(SimpleTemplateResponse, self).__iter__()\n \n-    def _get_content(self):\n+    @property\n+    def content(self):\n         if not self._is_rendered:\n             raise ContentNotRenderedError('The response content must be '\n                                           'rendered before it can be accessed.')\n-        return super(SimpleTemplateResponse, self)._get_content()\n+        return super(SimpleTemplateResponse, self).content\n \n-    def _set_content(self, value):\n+    @content.setter\n+    def content(self, value):\n         \"\"\"Sets the content for the response\n         \"\"\"\n-        super(SimpleTemplateResponse, self)._set_content(value)\n+        HttpResponse.content.fset(self, value)\n         self._is_rendered = True\n \n-    content = property(_get_content, _set_content)\n-\n \n class TemplateResponse(SimpleTemplateResponse):\n     rendering_attrs = SimpleTemplateResponse.rendering_attrs + \\"
        },
        {
            "sha": "36db4807c790c3ef4892de61e7612fd19ea6e852",
            "filename": "django/templatetags/cache.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplatetags%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftemplatetags%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fcache.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,6 +4,7 @@\n from django.template import Library, Node, TemplateSyntaxError, Variable, VariableDoesNotExist\n from django.template import resolve_variable\n from django.core.cache import cache\n+from django.utils.encoding import force_bytes\n from django.utils.http import urlquote\n \n register = Library()\n@@ -24,8 +25,9 @@ def render(self, context):\n             expire_time = int(expire_time)\n         except (ValueError, TypeError):\n             raise TemplateSyntaxError('\"cache\" tag got a non-integer timeout value: %r' % expire_time)\n-        # Build a unicode key for this fragment and all vary-on's.\n-        args = hashlib.md5(':'.join([urlquote(resolve_variable(var, context)) for var in self.vary_on]))\n+        # Build a key for this fragment and all vary-on's.\n+        key = ':'.join([urlquote(resolve_variable(var, context)) for var in self.vary_on])\n+        args = hashlib.md5(force_bytes(key))\n         cache_key = 'template.cache.%s.%s' % (self.fragment_name, args.hexdigest())\n         value = cache.get(cache_key)\n         if value is None:"
        },
        {
            "sha": "8fd765ec9aa9e0c2bca68292744e400e70b8d9c4",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 26,
            "deletions": 24,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n import sys\n import os\n import re\n@@ -19,7 +21,7 @@\n from django.template import TemplateDoesNotExist\n from django.test import signals\n from django.utils.functional import curry\n-from django.utils.encoding import smart_bytes\n+from django.utils.encoding import force_bytes\n from django.utils.http import urlencode\n from django.utils.importlib import import_module\n from django.utils.itercompat import is_iterable\n@@ -108,7 +110,7 @@ def encode_multipart(boundary, data):\n     as an application/octet-stream; otherwise, str(value) will be sent.\n     \"\"\"\n     lines = []\n-    to_str = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n+    to_bytes = lambda s: force_bytes(s, settings.DEFAULT_CHARSET)\n \n     # Not by any means perfect, but good enough for our purposes.\n     is_file = lambda thing: hasattr(thing, \"read\") and callable(thing.read)\n@@ -124,37 +126,37 @@ def encode_multipart(boundary, data):\n                 if is_file(item):\n                     lines.extend(encode_file(boundary, key, item))\n                 else:\n-                    lines.extend([\n-                        '--' + boundary,\n-                        'Content-Disposition: form-data; name=\"%s\"' % to_str(key),\n+                    lines.extend([to_bytes(val) for val in [\n+                        '--%s' % boundary,\n+                        'Content-Disposition: form-data; name=\"%s\"' % key,\n                         '',\n-                        to_str(item)\n-                    ])\n+                        item\n+                    ]])\n         else:\n-            lines.extend([\n-                '--' + boundary,\n-                'Content-Disposition: form-data; name=\"%s\"' % to_str(key),\n+            lines.extend([to_bytes(val) for val in [\n+                '--%s' % boundary,\n+                'Content-Disposition: form-data; name=\"%s\"' % key,\n                 '',\n-                to_str(value)\n-            ])\n+                value\n+            ]])\n \n     lines.extend([\n-        '--' + boundary + '--',\n-        '',\n+        to_bytes('--%s--' % boundary),\n+        b'',\n     ])\n-    return '\\r\\n'.join(lines)\n+    return b'\\r\\n'.join(lines)\n \n def encode_file(boundary, key, file):\n-    to_str = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n+    to_bytes = lambda s: force_bytes(s, settings.DEFAULT_CHARSET)\n     content_type = mimetypes.guess_type(file.name)[0]\n     if content_type is None:\n         content_type = 'application/octet-stream'\n     return [\n-        '--' + to_str(boundary),\n-        'Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"' \\\n-            % (to_str(key), to_str(os.path.basename(file.name))),\n-        'Content-Type: %s' % content_type,\n-        '',\n+        to_bytes('--%s' % boundary),\n+        to_bytes('Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"' \\\n+            % (key, os.path.basename(file.name))),\n+        to_bytes('Content-Type: %s' % content_type),\n+        b'',\n         file.read()\n     ]\n \n@@ -220,7 +222,7 @@ def _encode_data(self, data, content_type, ):\n                 charset = match.group(1)\n             else:\n                 charset = settings.DEFAULT_CHARSET\n-            return smart_bytes(data, encoding=charset)\n+            return force_bytes(data, encoding=charset)\n \n     def _get_path(self, parsed):\n         # If there are parameters, add them\n@@ -291,7 +293,7 @@ def delete(self, path, data='', content_type='application/octet-stream',\n     def generic(self, method, path,\n                 data='', content_type='application/octet-stream', **extra):\n         parsed = urlparse(path)\n-        data = smart_bytes(data, settings.DEFAULT_CHARSET)\n+        data = force_bytes(data, settings.DEFAULT_CHARSET)\n         r = {\n             'PATH_INFO':      self._get_path(parsed),\n             'QUERY_STRING':   parsed[4],\n@@ -385,7 +387,7 @@ def request(self, **request):\n             if self.exc_info:\n                 exc_info = self.exc_info\n                 self.exc_info = None\n-                six.reraise(exc_info[1], None, exc_info[2])\n+                six.reraise(*exc_info)\n \n             # Save the client and request that stimulated the response.\n             response.client = self"
        },
        {
            "sha": "274810cab466ed9295aae054849d6487a429dfc4",
            "filename": "django/test/html.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fhtml.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,6 +8,7 @@\n from django.utils.encoding import force_text\n from django.utils.html_parser import HTMLParser, HTMLParseError\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n WHITESPACE = re.compile('\\s+')\n@@ -17,6 +18,7 @@ def normalize_whitespace(string):\n     return WHITESPACE.sub(' ', string)\n \n \n+@python_2_unicode_compatible\n class Element(object):\n     def __init__(self, name, attributes):\n         self.name = name\n@@ -117,7 +119,7 @@ def count(self, element):\n     def __getitem__(self, key):\n         return self.children[key]\n \n-    def __unicode__(self):\n+    def __str__(self):\n         output = '<%s' % self.name\n         for key, value in self.attributes:\n             if value:\n@@ -136,11 +138,12 @@ def __repr__(self):\n         return six.text_type(self)\n \n \n+@python_2_unicode_compatible\n class RootElement(Element):\n     def __init__(self):\n         super(RootElement, self).__init__(None, ())\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return ''.join(six.text_type(c) for c in self.children)\n \n "
        },
        {
            "sha": "5b0a9a19ca2cfcb00e9a5084e64d11b309080e0f",
            "filename": "django/test/signals.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsignals.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,7 +4,6 @@\n from django.conf import settings\n from django.db import connections\n from django.dispatch import receiver, Signal\n-from django.template import context\n from django.utils import timezone\n \n template_rendered = Signal(providing_args=[\"template\", \"context\"])\n@@ -48,9 +47,17 @@ def update_connections_time_zone(**kwargs):\n @receiver(setting_changed)\n def clear_context_processors_cache(**kwargs):\n     if kwargs['setting'] == 'TEMPLATE_CONTEXT_PROCESSORS':\n+        from django.template import context\n         context._standard_context_processors = None\n \n \n+@receiver(setting_changed)\n+def clear_serializers_cache(**kwargs):\n+    if kwargs['setting'] == 'SERIALIZATION_MODULES':\n+        from django.core import serializers\n+        serializers._serializers = {}\n+\n+\n @receiver(setting_changed)\n def language_changed(**kwargs):\n     if kwargs['setting'] in ('LOCALE_PATHS', 'LANGUAGE_CODE'):"
        },
        {
            "sha": "f12c431d3a511ac7119cbe52f9df9809a849ec90",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 27,
            "deletions": 26,
            "changes": 53,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -41,7 +41,7 @@\n     override_settings)\n from django.test.utils import ContextList\n from django.utils import unittest as ut2\n-from django.utils.encoding import smart_bytes, force_text\n+from django.utils.encoding import force_text\n from django.utils import six\n from django.utils.unittest.util import safe_repr\n from django.views.static import serve\n@@ -647,14 +647,13 @@ def assertContains(self, response, text, count=None, status_code=200,\n         self.assertEqual(response.status_code, status_code,\n             msg_prefix + \"Couldn't retrieve content: Response code was %d\"\n             \" (expected %d)\" % (response.status_code, status_code))\n-        enc_text = smart_bytes(text, response._charset)\n-        content = response.content\n+        content = response.content.decode(response._charset)\n         if html:\n             content = assert_and_parse_html(self, content, None,\n                 \"Response's content is not valid HTML:\")\n-            enc_text = assert_and_parse_html(self, enc_text, None,\n+            text = assert_and_parse_html(self, text, None,\n                 \"Second argument is not valid HTML:\")\n-        real_count = content.count(enc_text)\n+        real_count = content.count(text)\n         if count is not None:\n             self.assertEqual(real_count, count,\n                 msg_prefix + \"Found %d instances of '%s' in response\"\n@@ -683,14 +682,13 @@ def assertNotContains(self, response, text, status_code=200,\n         self.assertEqual(response.status_code, status_code,\n             msg_prefix + \"Couldn't retrieve content: Response code was %d\"\n             \" (expected %d)\" % (response.status_code, status_code))\n-        enc_text = smart_bytes(text, response._charset)\n-        content = response.content\n+        content = response.content.decode(response._charset)\n         if html:\n             content = assert_and_parse_html(self, content, None,\n                 'Response\\'s content is not valid HTML:')\n-            enc_text = assert_and_parse_html(self, enc_text, None,\n+            text = assert_and_parse_html(self, text, None,\n                 'Second argument is not valid HTML:')\n-        self.assertEqual(content.count(enc_text), 0,\n+        self.assertEqual(content.count(text), 0,\n             msg_prefix + \"Response should not contain '%s'\" % text)\n \n     def assertFormError(self, response, form, field, errors, msg_prefix=''):\n@@ -919,23 +917,26 @@ def log_message(*args):\n         pass\n \n \n-class _ImprovedEvent(threading._Event):\n-    \"\"\"\n-    Does the same as `threading.Event` except it overrides the wait() method\n-    with some code borrowed from Python 2.7 to return the set state of the\n-    event (see: http://hg.python.org/cpython/rev/b5aa8aa78c0f/). This allows\n-    to know whether the wait() method exited normally or because of the\n-    timeout. This class can be removed when Django supports only Python >= 2.7.\n-    \"\"\"\n+if sys.version_info >= (2, 7, 0):\n+    _ImprovedEvent = threading._Event\n+else:\n+    class _ImprovedEvent(threading._Event):\n+        \"\"\"\n+        Does the same as `threading.Event` except it overrides the wait() method\n+        with some code borrowed from Python 2.7 to return the set state of the\n+        event (see: http://hg.python.org/cpython/rev/b5aa8aa78c0f/). This allows\n+        to know whether the wait() method exited normally or because of the\n+        timeout. This class can be removed when Django supports only Python >= 2.7.\n+        \"\"\"\n \n-    def wait(self, timeout=None):\n-        self._Event__cond.acquire()\n-        try:\n-            if not self._Event__flag:\n-                self._Event__cond.wait(timeout)\n-            return self._Event__flag\n-        finally:\n-            self._Event__cond.release()\n+        def wait(self, timeout=None):\n+            self._Event__cond.acquire()\n+            try:\n+                if not self._Event__flag:\n+                    self._Event__cond.wait(timeout)\n+                return self._Event__flag\n+            finally:\n+                self._Event__cond.release()\n \n \n class StoppableWSGIServer(WSGIServer):\n@@ -1136,7 +1137,7 @@ def setUpClass(cls):\n             host, port_ranges = specified_address.split(':')\n             for port_range in port_ranges.split(','):\n                 # A port range can be of either form: '8000' or '8000-8010'.\n-                extremes = map(int, port_range.split('-'))\n+                extremes = list(map(int, port_range.split('-')))\n                 assert len(extremes) in [1, 2]\n                 if len(extremes) == 1:\n                     # Port range of the form '8000'"
        },
        {
            "sha": "e2c439fd807c0ccb3cff8a51c8134b79c0113acc",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -221,4 +221,4 @@ def disable(self):\n                                  setting=key, value=new_value)\n \n def str_prefix(s):\n-    return s % {'_': 'u'}\n+    return s % {'_': '' if six.PY3 else 'u'}"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/utils/2to3_fixes/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2F2to3_fixes%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2F2to3_fixes%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2F2to3_fixes%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed"
        },
        {
            "sha": "613734ca867d9ec9f5c1d5a903d7dc9c73e83884",
            "filename": "django/utils/2to3_fixes/fix_unicode.py",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2F2to3_fixes%2Ffix_unicode.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2F2to3_fixes%2Ffix_unicode.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2F2to3_fixes%2Ffix_unicode.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,36 @@\n+\"\"\"Fixer for __unicode__ methods.\n+\n+Uses the django.utils.encoding.python_2_unicode_compatible decorator.\n+\"\"\"\n+\n+from __future__ import unicode_literals\n+\n+from lib2to3 import fixer_base\n+from lib2to3.fixer_util import find_indentation, Name, syms, touch_import\n+from lib2to3.pgen2 import token\n+from lib2to3.pytree import Leaf, Node\n+\n+\n+class FixUnicode(fixer_base.BaseFix):\n+\n+    BM_compatible = True\n+    PATTERN = \"\"\"\n+    classdef< 'class' any+ ':'\n+              suite< any*\n+                     funcdef< 'def' unifunc='__unicode__'\n+                              parameters< '(' NAME ')' > any+ >\n+                     any* > >\n+    \"\"\"\n+\n+    def transform(self, node, results):\n+        unifunc = results[\"unifunc\"]\n+        strfunc = Name(\"__str__\", prefix=unifunc.prefix)\n+        unifunc.replace(strfunc)\n+\n+        klass = node.clone()\n+        klass.prefix = '\\n' + find_indentation(node)\n+        decorator = Node(syms.decorator, [Leaf(token.AT, \"@\"), Name('python_2_unicode_compatible')])\n+        decorated = Node(syms.decorated, [decorator, klass], prefix=node.prefix)\n+        node.replace(decorated)\n+\n+        touch_import('django.utils.encoding', 'python_2_unicode_compatible', decorated)"
        },
        {
            "sha": "0faf1fa7811974f2cb332ad09894f28da026f608",
            "filename": "django/utils/archive.py",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Farchive.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Farchive.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Farchive.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -46,7 +46,8 @@ def extract(path, to_path=''):\n     Unpack the tar or zip file at the specified path to the directory\n     specified by to_path.\n     \"\"\"\n-    Archive(path).extract(to_path)\n+    with Archive(path) as archive:\n+        archive.extract(to_path)\n \n \n class Archive(object):\n@@ -77,12 +78,21 @@ def _archive_cls(file):\n                 \"Path not a recognized archive format: %s\" % filename)\n         return cls\n \n+    def __enter__(self):\n+        return self\n+\n+    def __exit__(self, exc_type, exc_value, traceback):\n+        self.close()\n+\n     def extract(self, to_path=''):\n         self._archive.extract(to_path)\n \n     def list(self):\n         self._archive.list()\n \n+    def close(self):\n+        self._archive.close()\n+\n \n class BaseArchive(object):\n     \"\"\"\n@@ -161,6 +171,9 @@ def extract(self, to_path):\n                     if extracted:\n                         extracted.close()\n \n+    def close(self):\n+        self._archive.close()\n+\n \n class ZipArchive(BaseArchive):\n \n@@ -189,6 +202,9 @@ def extract(self, to_path):\n                 with open(filename, 'wb') as outfile:\n                     outfile.write(data)\n \n+    def close(self):\n+        self._archive.close()\n+\n extension_map = {\n     '.tar': TarArchive,\n     '.tar.bz2': TarArchive,"
        },
        {
            "sha": "2daafedd856651846a499d1cfcbebe410b68fb48",
            "filename": "django/utils/autoreload.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fautoreload.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fautoreload.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fautoreload.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -31,7 +31,7 @@\n import os, sys, time, signal\n \n try:\n-    import thread\n+    from django.utils.six.moves import _thread as thread\n except ImportError:\n     from django.utils.six.moves import _dummy_thread as thread\n \n@@ -54,7 +54,8 @@\n \n def code_changed():\n     global _mtimes, _win\n-    for filename in filter(lambda v: v, map(lambda m: getattr(m, \"__file__\", None), sys.modules.values())):\n+    filenames = [getattr(m, \"__file__\", None) for m in sys.modules.values()]\n+    for filename in filter(None, filenames):\n         if filename.endswith(\".pyc\") or filename.endswith(\".pyo\"):\n             filename = filename[:-1]\n         if filename.endswith(\"$py.class\"):"
        },
        {
            "sha": "91c47969888fb00d42bfb24de9b5779c2c82ddac",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -16,14 +16,15 @@\n An example: i18n middleware would need to distinguish caches by the\n \"Accept-language\" header.\n \"\"\"\n+from __future__ import unicode_literals\n \n import hashlib\n import re\n import time\n \n from django.conf import settings\n from django.core.cache import get_cache\n-from django.utils.encoding import iri_to_uri, force_text\n+from django.utils.encoding import iri_to_uri, force_bytes, force_text\n from django.utils.http import http_date\n from django.utils.timezone import get_current_timezone_name\n from django.utils.translation import get_language\n@@ -65,7 +66,7 @@ def dictvalue(t):\n     # max-age, use the minimum of the two ages. In practice this happens when\n     # a decorator and a piece of middleware both operate on a given view.\n     if 'max-age' in cc and 'max_age' in kwargs:\n-        kwargs['max_age'] = min(cc['max-age'], kwargs['max_age'])\n+        kwargs['max_age'] = min(int(cc['max-age']), kwargs['max_age'])\n \n     # Allow overriding private caching and vice versa\n     if 'private' in cc and 'public' in kwargs:\n@@ -170,7 +171,7 @@ def _i18n_cache_key_suffix(request, cache_key):\n         # User-defined tzinfo classes may return absolutely anything.\n         # Hence this paranoid conversion to create a valid cache key.\n         tz_name = force_text(get_current_timezone_name(), errors='ignore')\n-        cache_key += '.%s' % tz_name.encode('ascii', 'ignore').replace(' ', '_')\n+        cache_key += '.%s' % tz_name.encode('ascii', 'ignore').decode('ascii').replace(' ', '_')\n     return cache_key\n \n def _generate_cache_key(request, method, headerlist, key_prefix):\n@@ -180,14 +181,14 @@ def _generate_cache_key(request, method, headerlist, key_prefix):\n         value = request.META.get(header, None)\n         if value is not None:\n             ctx.update(value)\n-    path = hashlib.md5(iri_to_uri(request.get_full_path()))\n+    path = hashlib.md5(force_bytes(iri_to_uri(request.get_full_path())))\n     cache_key = 'views.decorators.cache.cache_page.%s.%s.%s.%s' % (\n         key_prefix, method, path.hexdigest(), ctx.hexdigest())\n     return _i18n_cache_key_suffix(request, cache_key)\n \n def _generate_cache_header_key(key_prefix, request):\n     \"\"\"Returns a cache key for the header cache.\"\"\"\n-    path = hashlib.md5(iri_to_uri(request.get_full_path()))\n+    path = hashlib.md5(force_bytes(iri_to_uri(request.get_full_path())))\n     cache_key = 'views.decorators.cache.cache_header.%s.%s' % (\n         key_prefix, path.hexdigest())\n     return _i18n_cache_key_suffix(request, cache_key)"
        },
        {
            "sha": "57bc60dc4f823ddd12b93d539891f9c305649a83",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -23,7 +23,8 @@\n     using_sysrandom = False\n \n from django.conf import settings\n-from django.utils.encoding import smart_bytes\n+from django.utils.encoding import force_bytes\n+from django.utils import six\n from django.utils.six.moves import xrange\n \n \n@@ -50,7 +51,7 @@ def salted_hmac(key_salt, value, secret=None):\n     # line is redundant and could be replaced by key = key_salt + secret, since\n     # the hmac module does the same thing for keys longer than the block size.\n     # However, we need to ensure that we *always* do this.\n-    return hmac.new(key, msg=smart_bytes(value), digestmod=hashlib.sha1)\n+    return hmac.new(key, msg=force_bytes(value), digestmod=hashlib.sha1)\n \n \n def get_random_string(length=12,\n@@ -88,8 +89,12 @@ def constant_time_compare(val1, val2):\n     if len(val1) != len(val2):\n         return False\n     result = 0\n-    for x, y in zip(val1, val2):\n-        result |= ord(x) ^ ord(y)\n+    if six.PY3 and isinstance(val1, bytes) and isinstance(val2, bytes):\n+        for x, y in zip(val1, val2):\n+            result |= x ^ y\n+    else:\n+        for x, y in zip(val1, val2):\n+            result |= ord(x) ^ ord(y)\n     return result == 0\n \n \n@@ -142,8 +147,8 @@ def pbkdf2(password, salt, iterations, dklen=0, digest=None):\n     assert iterations > 0\n     if not digest:\n         digest = hashlib.sha256\n-    password = smart_bytes(password)\n-    salt = smart_bytes(salt)\n+    password = force_bytes(password)\n+    salt = force_bytes(salt)\n     hlen = digest().digest_size\n     if not dklen:\n         dklen = hlen"
        },
        {
            "sha": "b4bd559a66ed21cc04be66349c8995b95e86b20a",
            "filename": "django/utils/dateparse.py",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fdateparse.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fdateparse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdateparse.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -15,16 +15,16 @@\n     r'(?P<year>\\d{4})-(?P<month>\\d{1,2})-(?P<day>\\d{1,2})$'\n )\n \n-datetime_re = re.compile(\n-    r'(?P<year>\\d{4})-(?P<month>\\d{1,2})-(?P<day>\\d{1,2})'\n-    r'[T ](?P<hour>\\d{1,2}):(?P<minute>\\d{1,2})'\n+time_re = re.compile(\n+    r'(?P<hour>\\d{1,2}):(?P<minute>\\d{1,2})'\n     r'(?::(?P<second>\\d{1,2})(?:\\.(?P<microsecond>\\d{1,6})\\d{0,6})?)?'\n-    r'(?P<tzinfo>Z|[+-]\\d{1,2}:\\d{1,2})?$'\n )\n \n-time_re = re.compile(\n-    r'(?P<hour>\\d{1,2}):(?P<minute>\\d{1,2})'\n+datetime_re = re.compile(\n+    r'(?P<year>\\d{4})-(?P<month>\\d{1,2})-(?P<day>\\d{1,2})'\n+    r'[T ](?P<hour>\\d{1,2}):(?P<minute>\\d{1,2})'\n     r'(?::(?P<second>\\d{1,2})(?:\\.(?P<microsecond>\\d{1,6})\\d{0,6})?)?'\n+    r'(?P<tzinfo>Z|[+-]\\d{2}:?\\d{2})?$'\n )\n \n def parse_date(value):\n@@ -43,8 +43,6 @@ def parse_time(value):\n \n     This function doesn't support time zone offsets.\n \n-    Sub-microsecond precision is accepted, but ignored.\n-\n     Raises ValueError if the input is well formatted but not a valid time.\n     Returns None if the input isn't well formatted, in particular if it\n     contains an offset.\n@@ -63,8 +61,6 @@ def parse_datetime(value):\n     This function supports time zone offsets. When the input contains one,\n     the output uses an instance of FixedOffset as tzinfo.\n \n-    Sub-microsecond precision is accepted, but ignored.\n-\n     Raises ValueError if the input is well formatted but not a valid datetime.\n     Returns None if the input isn't well formatted.\n     \"\"\"\n@@ -77,7 +73,7 @@ def parse_datetime(value):\n         if tzinfo == 'Z':\n             tzinfo = utc\n         elif tzinfo is not None:\n-            offset = 60 * int(tzinfo[1:3]) + int(tzinfo[4:6])\n+            offset = 60 * int(tzinfo[1:3]) + int(tzinfo[-2:])\n             if tzinfo[0] == '-':\n                 offset = -offset\n             tzinfo = FixedOffset(offset)"
        },
        {
            "sha": "3b284f3ed0c903fce6f13164f5f3cfe618a52866",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 44,
            "deletions": 5,
            "changes": 49,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,6 +8,7 @@\n     from urllib.parse import quote\n except ImportError:     # Python 2\n     from urllib import quote\n+import warnings\n \n from django.utils.functional import Promise\n from django.utils import six\n@@ -32,13 +33,32 @@ class StrAndUnicode(object):\n     Useful as a mix-in. If you support Python 2 and 3 with a single code base,\n     you can inherit this mix-in and just define __unicode__.\n     \"\"\"\n+    def __init__(self, *args, **kwargs):\n+        warnings.warn(\"StrAndUnicode is deprecated. Define a __str__ method \"\n+                      \"and apply the @python_2_unicode_compatible decorator \"\n+                      \"instead.\", PendingDeprecationWarning, stacklevel=2)\n+        super(StrAndUnicode, self).__init__(*args, **kwargs)\n+\n     if six.PY3:\n         def __str__(self):\n             return self.__unicode__()\n     else:\n         def __str__(self):\n             return self.__unicode__().encode('utf-8')\n \n+def python_2_unicode_compatible(klass):\n+    \"\"\"\n+    A decorator that defines __unicode__ and __str__ methods under Python 2.\n+    Under Python 3 it does nothing.\n+\n+    To support Python 2 and 3 with a single code base, define a __str__ method\n+    returning text and apply this decorator to the class.\n+    \"\"\"\n+    if not six.PY3:\n+        klass.__unicode__ = klass.__str__\n+        klass.__str__ = lambda self: self.__unicode__().encode('utf-8')\n+    return klass\n+\n def smart_text(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n     Returns a text object representing 's' -- unicode on Python 2 and str on\n@@ -99,8 +119,8 @@ def force_text(s, encoding='utf-8', strings_only=False, errors='strict'):\n                             errors) for arg in s])\n         else:\n             # Note: We use .decode() here, instead of six.text_type(s, encoding,\n-            # errors), so that if s is a SafeString, it ends up being a\n-            # SafeUnicode at the end.\n+            # errors), so that if s is a SafeBytes, it ends up being a\n+            # SafeText at the end.\n             s = s.decode(encoding, errors)\n     except UnicodeDecodeError as e:\n         if not isinstance(s, Exception):\n@@ -119,6 +139,19 @@ def smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n     Returns a bytestring version of 's', encoded as specified in 'encoding'.\n \n+    If strings_only is True, don't convert (some) non-string-like objects.\n+    \"\"\"\n+    if isinstance(s, Promise):\n+        # The input is the result of a gettext_lazy() call.\n+        return s\n+    return force_bytes(s, encoding, strings_only, errors)\n+\n+\n+def force_bytes(s, encoding='utf-8', strings_only=False, errors='strict'):\n+    \"\"\"\n+    Similar to smart_bytes, except that lazy instances are resolved to\n+    strings, rather than kept as lazy objects.\n+\n     If strings_only is True, don't convert (some) non-string-like objects.\n     \"\"\"\n     if isinstance(s, bytes):\n@@ -141,16 +174,18 @@ def smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict'):\n                 # An Exception subclass containing non-ASCII data that doesn't\n                 # know how to print itself properly. We shouldn't raise a\n                 # further exception.\n-                return ' '.join([smart_bytes(arg, encoding, strings_only,\n+                return b' '.join([force_bytes(arg, encoding, strings_only,\n                         errors) for arg in s])\n             return six.text_type(s).encode(encoding, errors)\n     else:\n         return s.encode(encoding, errors)\n \n if six.PY3:\n     smart_str = smart_text\n+    force_str = force_text\n else:\n     smart_str = smart_bytes\n+    force_str = force_bytes\n     # backwards compatibility for Python 2\n     smart_unicode = smart_text\n     force_unicode = force_text\n@@ -161,6 +196,10 @@ def smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict'):\n This is suitable for writing to sys.stdout (for instance).\n \"\"\"\n \n+force_str.__doc__ = \"\"\"\\\n+Apply force_text in Python 3 and force_bytes in Python 2.\n+\"\"\"\n+\n def iri_to_uri(iri):\n     \"\"\"\n     Convert an Internationalized Resource Identifier (IRI) portion to a URI\n@@ -186,7 +225,7 @@ def iri_to_uri(iri):\n     # converted.\n     if iri is None:\n         return iri\n-    return quote(smart_bytes(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n+    return quote(force_bytes(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n \n def filepath_to_uri(path):\n     \"\"\"Convert an file system path to a URI portion that is suitable for\n@@ -205,7 +244,7 @@ def filepath_to_uri(path):\n         return path\n     # I know about `os.sep` and `os.altsep` but I want to leave\n     # some flexibility for hardcoding separators.\n-    return quote(smart_bytes(path).replace(\"\\\\\", \"/\"), safe=b\"/~!*()'\")\n+    return quote(force_bytes(path.replace(\"\\\\\", \"/\")), safe=b\"/~!*()'\")\n \n # The encoding of the default system locale but falls back to the\n # given fallback encoding if the encoding is unsupported by python or could"
        },
        {
            "sha": "555982eede53372b698ff959f0e7b0e9fc901650",
            "filename": "django/utils/formats.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fformats.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,7 +4,7 @@\n from django.conf import settings\n from django.utils import dateformat, numberformat, datetime_safe\n from django.utils.importlib import import_module\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import force_str\n from django.utils.functional import lazy\n from django.utils.safestring import mark_safe\n from django.utils import six\n@@ -66,7 +66,7 @@ def get_format(format_type, lang=None, use_l10n=None):\n     If use_l10n is provided and is not None, that will force the value to\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n-    format_type = smart_str(format_type)\n+    format_type = force_str(format_type)\n     if use_l10n or (use_l10n is None and settings.USE_L10N):\n         if lang is None:\n             lang = get_language()\n@@ -160,14 +160,14 @@ def localize_input(value, default=None):\n         return number_format(value)\n     elif isinstance(value, datetime.datetime):\n         value = datetime_safe.new_datetime(value)\n-        format = smart_str(default or get_format('DATETIME_INPUT_FORMATS')[0])\n+        format = force_str(default or get_format('DATETIME_INPUT_FORMATS')[0])\n         return value.strftime(format)\n     elif isinstance(value, datetime.date):\n         value = datetime_safe.new_date(value)\n-        format = smart_str(default or get_format('DATE_INPUT_FORMATS')[0])\n+        format = force_str(default or get_format('DATE_INPUT_FORMATS')[0])\n         return value.strftime(format)\n     elif isinstance(value, datetime.time):\n-        format = smart_str(default or get_format('TIME_INPUT_FORMATS')[0])\n+        format = force_str(default or get_format('TIME_INPUT_FORMATS')[0])\n         return value.strftime(format)\n     return value\n "
        },
        {
            "sha": "085a8fce591227f5b4179c36e874dad9fdb84964",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -238,7 +238,6 @@ def _setup(self):\n         raise NotImplementedError\n \n     # introspection support:\n-    __members__ = property(lambda self: self.__dir__())\n     __dir__ = new_method_proxy(dir)\n \n "
        },
        {
            "sha": "2b669cc8ecc33064aec5619db8ac4d54156023b1",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,7 +11,7 @@\n     from urlparse import urlsplit, urlunsplit\n \n from django.utils.safestring import SafeData, mark_safe\n-from django.utils.encoding import smart_bytes, force_text\n+from django.utils.encoding import force_bytes, force_text\n from django.utils.functional import allow_lazy\n from django.utils import six\n from django.utils.text import normalize_newlines\n@@ -123,6 +123,17 @@ def strip_tags(value):\n     return re.sub(r'<[^>]*?>', '', force_text(value))\n strip_tags = allow_lazy(strip_tags)\n \n+def remove_tags(html, tags):\n+    \"\"\"Returns the given HTML with given tags removed.\"\"\"\n+    tags = [re.escape(tag) for tag in tags.split()]\n+    tags_re = '(%s)' % '|'.join(tags)\n+    starttag_re = re.compile(r'<%s(/?>|(\\s+[^>]*>))' % tags_re, re.U)\n+    endtag_re = re.compile('</%s>' % tags_re)\n+    html = starttag_re.sub('', html)\n+    html = endtag_re.sub('', html)\n+    return html\n+remove_tags = allow_lazy(remove_tags, six.text_type)\n+\n def strip_spaces_between_tags(value):\n     \"\"\"Returns the given HTML with spaces between tags removed.\"\"\"\n     return re.sub(r'>\\s+<', '><', force_text(value))\n@@ -143,7 +154,7 @@ def smart_urlquote(url):\n     # Handle IDN before quoting.\n     scheme, netloc, path, query, fragment = urlsplit(url)\n     try:\n-        netloc = netloc.encode('idna') # IDN -> ACE\n+        netloc = netloc.encode('idna').decode('ascii') # IDN -> ACE\n     except UnicodeError: # invalid domain part\n         pass\n     else:\n@@ -153,7 +164,7 @@ def smart_urlquote(url):\n     # contains a % not followed by two hexadecimal digits. See #9655.\n     if '%' not in url or unquoted_percents_re.search(url):\n         # See http://bugs.python.org/issue2637\n-        url = quote(smart_bytes(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n+        url = quote(force_bytes(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n \n     return force_text(url)\n \n@@ -206,7 +217,7 @@ def urlize(text, trim_url_limit=None, nofollow=False, autoescape=False):\n             elif not ':' in middle and simple_email_re.match(middle):\n                 local, domain = middle.rsplit('@', 1)\n                 try:\n-                    domain = domain.encode('idna')\n+                    domain = domain.encode('idna').decode('ascii')\n                 except UnicodeError:\n                     continue\n                 url = 'mailto:%s@%s' % (local, domain)"
        },
        {
            "sha": "d7311f253bbea4416f42f91da4fd947227310882",
            "filename": "django/utils/html_parser.py",
            "status": "modified",
            "additions": 100,
            "deletions": 88,
            "changes": 188,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fhtml_parser.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fhtml_parser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml_parser.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,102 +1,114 @@\n from django.utils.six.moves import html_parser as _html_parser\n import re\n+import sys\n \n-tagfind = re.compile('([a-zA-Z][-.a-zA-Z0-9:_]*)(?:\\s|/(?!>))*')\n+current_version = sys.version_info\n+\n+use_workaround = (\n+    (current_version < (2, 6, 8)) or\n+    (current_version >= (2, 7) and current_version < (2, 7, 3)) or\n+    (current_version >= (3, 0) and current_version < (3, 2, 3))\n+)\n \n HTMLParseError = _html_parser.HTMLParseError\n \n-class HTMLParser(_html_parser.HTMLParser):\n-    \"\"\"\n-    Patched version of stdlib's HTMLParser with patch from:\n-    http://bugs.python.org/issue670664\n-    \"\"\"\n-    def __init__(self):\n-        _html_parser.HTMLParser.__init__(self)\n-        self.cdata_tag = None\n+if not use_workaround:\n+    HTMLParser = _html_parser.HTMLParser\n+else:\n+    tagfind = re.compile('([a-zA-Z][-.a-zA-Z0-9:_]*)(?:\\s|/(?!>))*')\n \n-    def set_cdata_mode(self, tag):\n-        try:\n-            self.interesting = _html_parser.interesting_cdata\n-        except AttributeError:\n-            self.interesting = re.compile(r'</\\s*%s\\s*>' % tag.lower(), re.I)\n-        self.cdata_tag = tag.lower()\n+    class HTMLParser(_html_parser.HTMLParser):\n+        \"\"\"\n+        Patched version of stdlib's HTMLParser with patch from:\n+        http://bugs.python.org/issue670664\n+        \"\"\"\n+        def __init__(self):\n+            _html_parser.HTMLParser.__init__(self)\n+            self.cdata_tag = None\n \n-    def clear_cdata_mode(self):\n-        self.interesting = _html_parser.interesting_normal\n-        self.cdata_tag = None\n+        def set_cdata_mode(self, tag):\n+            try:\n+                self.interesting = _html_parser.interesting_cdata\n+            except AttributeError:\n+                self.interesting = re.compile(r'</\\s*%s\\s*>' % tag.lower(), re.I)\n+            self.cdata_tag = tag.lower()\n \n-    # Internal -- handle starttag, return end or -1 if not terminated\n-    def parse_starttag(self, i):\n-        self.__starttag_text = None\n-        endpos = self.check_for_whole_start_tag(i)\n-        if endpos < 0:\n-            return endpos\n-        rawdata = self.rawdata\n-        self.__starttag_text = rawdata[i:endpos]\n+        def clear_cdata_mode(self):\n+            self.interesting = _html_parser.interesting_normal\n+            self.cdata_tag = None\n \n-        # Now parse the data between i+1 and j into a tag and attrs\n-        attrs = []\n-        match = tagfind.match(rawdata, i + 1)\n-        assert match, 'unexpected call to parse_starttag()'\n-        k = match.end()\n-        self.lasttag = tag = match.group(1).lower()\n+        # Internal -- handle starttag, return end or -1 if not terminated\n+        def parse_starttag(self, i):\n+            self.__starttag_text = None\n+            endpos = self.check_for_whole_start_tag(i)\n+            if endpos < 0:\n+                return endpos\n+            rawdata = self.rawdata\n+            self.__starttag_text = rawdata[i:endpos]\n \n-        while k < endpos:\n-            m = _html_parser.attrfind.match(rawdata, k)\n-            if not m:\n-                break\n-            attrname, rest, attrvalue = m.group(1, 2, 3)\n-            if not rest:\n-                attrvalue = None\n-            elif attrvalue[:1] == '\\'' == attrvalue[-1:] or \\\n-                 attrvalue[:1] == '\"' == attrvalue[-1:]:\n-                attrvalue = attrvalue[1:-1]\n-            if attrvalue:\n-                attrvalue = self.unescape(attrvalue)\n-            attrs.append((attrname.lower(), attrvalue))\n-            k = m.end()\n+            # Now parse the data between i+1 and j into a tag and attrs\n+            attrs = []\n+            match = tagfind.match(rawdata, i + 1)\n+            assert match, 'unexpected call to parse_starttag()'\n+            k = match.end()\n+            self.lasttag = tag = match.group(1).lower()\n \n-        end = rawdata[k:endpos].strip()\n-        if end not in (\">\", \"/>\"):\n-            lineno, offset = self.getpos()\n-            if \"\\n\" in self.__starttag_text:\n-                lineno = lineno + self.__starttag_text.count(\"\\n\")\n-                offset = len(self.__starttag_text) \\\n-                         - self.__starttag_text.rfind(\"\\n\")\n+            while k < endpos:\n+                m = _html_parser.attrfind.match(rawdata, k)\n+                if not m:\n+                    break\n+                attrname, rest, attrvalue = m.group(1, 2, 3)\n+                if not rest:\n+                    attrvalue = None\n+                elif attrvalue[:1] == '\\'' == attrvalue[-1:] or \\\n+                     attrvalue[:1] == '\"' == attrvalue[-1:]:\n+                    attrvalue = attrvalue[1:-1]\n+                if attrvalue:\n+                    attrvalue = self.unescape(attrvalue)\n+                attrs.append((attrname.lower(), attrvalue))\n+                k = m.end()\n+\n+            end = rawdata[k:endpos].strip()\n+            if end not in (\">\", \"/>\"):\n+                lineno, offset = self.getpos()\n+                if \"\\n\" in self.__starttag_text:\n+                    lineno = lineno + self.__starttag_text.count(\"\\n\")\n+                    offset = len(self.__starttag_text) \\\n+                             - self.__starttag_text.rfind(\"\\n\")\n+                else:\n+                    offset = offset + len(self.__starttag_text)\n+                self.error(\"junk characters in start tag: %r\"\n+                           % (rawdata[k:endpos][:20],))\n+            if end.endswith('/>'):\n+                # XHTML-style empty tag: <span attr=\"value\" />\n+                self.handle_startendtag(tag, attrs)\n             else:\n-                offset = offset + len(self.__starttag_text)\n-            self.error(\"junk characters in start tag: %r\"\n-                       % (rawdata[k:endpos][:20],))\n-        if end.endswith('/>'):\n-            # XHTML-style empty tag: <span attr=\"value\" />\n-            self.handle_startendtag(tag, attrs)\n-        else:\n-            self.handle_starttag(tag, attrs)\n-            if tag in self.CDATA_CONTENT_ELEMENTS:\n-                self.set_cdata_mode(tag) # <--------------------------- Changed\n-        return endpos\n+                self.handle_starttag(tag, attrs)\n+                if tag in self.CDATA_CONTENT_ELEMENTS:\n+                    self.set_cdata_mode(tag) # <--------------------------- Changed\n+            return endpos\n \n-    # Internal -- parse endtag, return end or -1 if incomplete\n-    def parse_endtag(self, i):\n-        rawdata = self.rawdata\n-        assert rawdata[i:i + 2] == \"</\", \"unexpected call to parse_endtag\"\n-        match = _html_parser.endendtag.search(rawdata, i + 1) # >\n-        if not match:\n-            return -1\n-        j = match.end()\n-        match = _html_parser.endtagfind.match(rawdata, i) # </ + tag + >\n-        if not match:\n-            if self.cdata_tag is not None: # *** add ***\n-                self.handle_data(rawdata[i:j]) # *** add ***\n-                return j # *** add ***\n-            self.error(\"bad end tag: %r\" % (rawdata[i:j],))\n-        # --- changed start ---------------------------------------------------\n-        tag = match.group(1).strip()\n-        if self.cdata_tag is not None:\n-            if tag.lower() != self.cdata_tag:\n-                self.handle_data(rawdata[i:j])\n-                return j\n-        # --- changed end -----------------------------------------------------\n-        self.handle_endtag(tag.lower())\n-        self.clear_cdata_mode()\n-        return j\n+        # Internal -- parse endtag, return end or -1 if incomplete\n+        def parse_endtag(self, i):\n+            rawdata = self.rawdata\n+            assert rawdata[i:i + 2] == \"</\", \"unexpected call to parse_endtag\"\n+            match = _html_parser.endendtag.search(rawdata, i + 1) # >\n+            if not match:\n+                return -1\n+            j = match.end()\n+            match = _html_parser.endtagfind.match(rawdata, i) # </ + tag + >\n+            if not match:\n+                if self.cdata_tag is not None: # *** add ***\n+                    self.handle_data(rawdata[i:j]) # *** add ***\n+                    return j # *** add ***\n+                self.error(\"bad end tag: %r\" % (rawdata[i:j],))\n+            # --- changed start ---------------------------------------------------\n+            tag = match.group(1).strip()\n+            if self.cdata_tag is not None:\n+                if tag.lower() != self.cdata_tag:\n+                    self.handle_data(rawdata[i:j])\n+                    return j\n+            # --- changed end -----------------------------------------------------\n+            self.handle_endtag(tag.lower())\n+            self.clear_cdata_mode()\n+            return j"
        },
        {
            "sha": "d3c70f12092ba4874a057e521006fa41b5a8e5d1",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n import calendar\n import datetime\n import re\n@@ -13,7 +15,7 @@\n from email.utils import formatdate\n \n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import force_text, smart_str\n+from django.utils.encoding import force_str, force_text\n from django.utils.functional import allow_lazy\n from django.utils import six\n \n@@ -37,7 +39,7 @@ def urlquote(url, safe='/'):\n     can safely be used as part of an argument to a subsequent iri_to_uri() call\n     without double-quoting occurring.\n     \"\"\"\n-    return force_text(urllib_parse.quote(smart_str(url), smart_str(safe)))\n+    return force_text(urllib_parse.quote(force_str(url), force_str(safe)))\n urlquote = allow_lazy(urlquote, six.text_type)\n \n def urlquote_plus(url, safe=''):\n@@ -47,23 +49,23 @@ def urlquote_plus(url, safe=''):\n     returned string can safely be used as part of an argument to a subsequent\n     iri_to_uri() call without double-quoting occurring.\n     \"\"\"\n-    return force_text(urllib_parse.quote_plus(smart_str(url), smart_str(safe)))\n+    return force_text(urllib_parse.quote_plus(force_str(url), force_str(safe)))\n urlquote_plus = allow_lazy(urlquote_plus, six.text_type)\n \n def urlunquote(quoted_url):\n     \"\"\"\n     A wrapper for Python's urllib.unquote() function that can operate on\n     the result of django.utils.http.urlquote().\n     \"\"\"\n-    return force_text(urllib_parse.unquote(smart_str(quoted_url)))\n+    return force_text(urllib_parse.unquote(force_str(quoted_url)))\n urlunquote = allow_lazy(urlunquote, six.text_type)\n \n def urlunquote_plus(quoted_url):\n     \"\"\"\n     A wrapper for Python's urllib.unquote_plus() function that can operate on\n     the result of django.utils.http.urlquote_plus().\n     \"\"\"\n-    return force_text(urllib_parse.unquote_plus(smart_str(quoted_url)))\n+    return force_text(urllib_parse.unquote_plus(force_str(quoted_url)))\n urlunquote_plus = allow_lazy(urlunquote_plus, six.text_type)\n \n def urlencode(query, doseq=0):\n@@ -77,8 +79,8 @@ def urlencode(query, doseq=0):\n     elif hasattr(query, 'items'):\n         query = query.items()\n     return urllib_parse.urlencode(\n-        [(smart_str(k),\n-         [smart_str(i) for i in v] if isinstance(v, (list,tuple)) else smart_str(v))\n+        [(force_str(k),\n+         [force_str(i) for i in v] if isinstance(v, (list,tuple)) else force_str(v))\n             for k, v in query],\n         doseq)\n \n@@ -211,7 +213,7 @@ def parse_etags(etag_str):\n     if not etags:\n         # etag_str has wrong format, treat it as an opaque string then\n         return [etag_str]\n-    etags = [e.decode('string_escape') for e in etags]\n+    etags = [e.encode('ascii').decode('unicode_escape') for e in etags]\n     return etags\n \n def quote_etag(etag):"
        },
        {
            "sha": "7624bb9c76a2377335b32130e195d132b4f19e35",
            "filename": "django/utils/ipv6.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fipv6.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fipv6.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fipv6.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -263,6 +263,6 @@ def _is_shorthand_ip(ip_str):\n     \"\"\"\n     if ip_str.count('::') == 1:\n         return True\n-    if filter(lambda x: len(x) < 4, ip_str.split(':')):\n+    if any(len(x) < 4 for x in ip_str.split(':')):\n         return True\n     return False"
        },
        {
            "sha": "07e0bf4cea03b33d1a03f3beaba81418c2c72425",
            "filename": "django/utils/safestring.py",
            "status": "modified",
            "additions": 44,
            "deletions": 30,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fsafestring.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fsafestring.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsafestring.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,36 +10,43 @@\n class EscapeData(object):\n     pass\n \n-class EscapeString(bytes, EscapeData):\n+class EscapeBytes(bytes, EscapeData):\n     \"\"\"\n-    A string that should be HTML-escaped when output.\n+    A byte string that should be HTML-escaped when output.\n     \"\"\"\n     pass\n \n-class EscapeUnicode(six.text_type, EscapeData):\n+class EscapeText(six.text_type, EscapeData):\n     \"\"\"\n-    A unicode object that should be HTML-escaped when output.\n+    A unicode string object that should be HTML-escaped when output.\n     \"\"\"\n     pass\n \n+if six.PY3:\n+    EscapeString = EscapeText\n+else:\n+    EscapeString = EscapeBytes\n+    # backwards compatibility for Python 2\n+    EscapeUnicode = EscapeText\n+\n class SafeData(object):\n     pass\n \n-class SafeString(bytes, SafeData):\n+class SafeBytes(bytes, SafeData):\n     \"\"\"\n-    A string subclass that has been specifically marked as \"safe\" (requires no\n+    A bytes subclass that has been specifically marked as \"safe\" (requires no\n     further escaping) for HTML output purposes.\n     \"\"\"\n     def __add__(self, rhs):\n         \"\"\"\n-        Concatenating a safe string with another safe string or safe unicode\n-        object is safe. Otherwise, the result is no longer safe.\n+        Concatenating a safe byte string with another safe byte string or safe\n+        unicode string is safe. Otherwise, the result is no longer safe.\n         \"\"\"\n-        t = super(SafeString, self).__add__(rhs)\n-        if isinstance(rhs, SafeUnicode):\n-            return SafeUnicode(t)\n-        elif isinstance(rhs, SafeString):\n-            return SafeString(t)\n+        t = super(SafeBytes, self).__add__(rhs)\n+        if isinstance(rhs, SafeText):\n+            return SafeText(t)\n+        elif isinstance(rhs, SafeBytes):\n+            return SafeBytes(t)\n         return t\n \n     def _proxy_method(self, *args, **kwargs):\n@@ -51,25 +58,25 @@ def _proxy_method(self, *args, **kwargs):\n         method = kwargs.pop('method')\n         data = method(self, *args, **kwargs)\n         if isinstance(data, bytes):\n-            return SafeString(data)\n+            return SafeBytes(data)\n         else:\n-            return SafeUnicode(data)\n+            return SafeText(data)\n \n     decode = curry(_proxy_method, method=bytes.decode)\n \n-class SafeUnicode(six.text_type, SafeData):\n+class SafeText(six.text_type, SafeData):\n     \"\"\"\n-    A unicode subclass that has been specifically marked as \"safe\" for HTML\n-    output purposes.\n+    A unicode (Python 2) / str (Python 3) subclass that has been specifically\n+    marked as \"safe\" for HTML output purposes.\n     \"\"\"\n     def __add__(self, rhs):\n         \"\"\"\n-        Concatenating a safe unicode object with another safe string or safe\n-        unicode object is safe. Otherwise, the result is no longer safe.\n+        Concatenating a safe unicode string with another safe byte string or\n+        safe unicode string is safe. Otherwise, the result is no longer safe.\n         \"\"\"\n-        t = super(SafeUnicode, self).__add__(rhs)\n+        t = super(SafeText, self).__add__(rhs)\n         if isinstance(rhs, SafeData):\n-            return SafeUnicode(t)\n+            return SafeText(t)\n         return t\n \n     def _proxy_method(self, *args, **kwargs):\n@@ -81,12 +88,19 @@ def _proxy_method(self, *args, **kwargs):\n         method = kwargs.pop('method')\n         data = method(self, *args, **kwargs)\n         if isinstance(data, bytes):\n-            return SafeString(data)\n+            return SafeBytes(data)\n         else:\n-            return SafeUnicode(data)\n+            return SafeText(data)\n \n     encode = curry(_proxy_method, method=six.text_type.encode)\n \n+if six.PY3:\n+    SafeString = SafeText\n+else:\n+    SafeString = SafeBytes\n+    # backwards compatibility for Python 2\n+    SafeUnicode = SafeText\n+\n def mark_safe(s):\n     \"\"\"\n     Explicitly mark a string as safe for (HTML) output purposes. The returned\n@@ -97,10 +111,10 @@ def mark_safe(s):\n     if isinstance(s, SafeData):\n         return s\n     if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_bytes):\n-        return SafeString(s)\n+        return SafeBytes(s)\n     if isinstance(s, (six.text_type, Promise)):\n-        return SafeUnicode(s)\n-    return SafeString(bytes(s))\n+        return SafeText(s)\n+    return SafeString(str(s))\n \n def mark_for_escaping(s):\n     \"\"\"\n@@ -113,8 +127,8 @@ def mark_for_escaping(s):\n     if isinstance(s, (SafeData, EscapeData)):\n         return s\n     if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_bytes):\n-        return EscapeString(s)\n+        return EscapeBytes(s)\n     if isinstance(s, (six.text_type, Promise)):\n-        return EscapeUnicode(s)\n-    return EscapeString(bytes(s))\n+        return EscapeText(s)\n+    return EscapeBytes(bytes(s))\n "
        },
        {
            "sha": "e4ce9398442e3bf5e765e969f1a4e0d530206eb2",
            "filename": "django/utils/six.py",
            "status": "modified",
            "additions": 33,
            "deletions": 19,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fsix.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Fsix.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsix.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,7 +5,7 @@\n import types\n \n __author__ = \"Benjamin Peterson <benjamin@python.org>\"\n-__version__ = \"1.1.0\"\n+__version__ = \"1.2.0\"\n \n \n # True if we are running on Python 3.\n@@ -26,19 +26,23 @@\n     text_type = unicode\n     binary_type = str\n \n-    # It's possible to have sizeof(long) != sizeof(Py_ssize_t).\n-    class X(object):\n-        def __len__(self):\n-            return 1 << 31\n-    try:\n-        len(X())\n-    except OverflowError:\n-        # 32-bit\n+    if sys.platform == \"java\":\n+        # Jython always uses 32 bits.\n         MAXSIZE = int((1 << 31) - 1)\n     else:\n-        # 64-bit\n-        MAXSIZE = int((1 << 63) - 1)\n-    del X\n+        # It's possible to have sizeof(long) != sizeof(Py_ssize_t).\n+        class X(object):\n+            def __len__(self):\n+                return 1 << 31\n+        try:\n+            len(X())\n+        except OverflowError:\n+            # 32-bit\n+            MAXSIZE = int((1 << 31) - 1)\n+        else:\n+            # 64-bit\n+            MAXSIZE = int((1 << 63) - 1)\n+            del X\n \n \n def _add_doc(func, doc):\n@@ -201,22 +205,30 @@ def remove_move(name):\n     _iteritems = \"iteritems\"\n \n \n+try:\n+    advance_iterator = next\n+except NameError:\n+    def advance_iterator(it):\n+        return it.next()\n+next = advance_iterator\n+\n+\n if PY3:\n     def get_unbound_function(unbound):\n         return unbound\n \n-\n-    advance_iterator = next\n+    Iterator = object\n \n     def callable(obj):\n         return any(\"__call__\" in klass.__dict__ for klass in type(obj).__mro__)\n else:\n     def get_unbound_function(unbound):\n         return unbound.im_func\n \n+    class Iterator(object):\n \n-    def advance_iterator(it):\n-        return it.next()\n+        def next(self):\n+            return type(self).__next__(self)\n \n     callable = callable\n _add_doc(get_unbound_function,\n@@ -231,15 +243,15 @@ def advance_iterator(it):\n \n def iterkeys(d):\n     \"\"\"Return an iterator over the keys of a dictionary.\"\"\"\n-    return getattr(d, _iterkeys)()\n+    return iter(getattr(d, _iterkeys)())\n \n def itervalues(d):\n     \"\"\"Return an iterator over the values of a dictionary.\"\"\"\n-    return getattr(d, _itervalues)()\n+    return iter(getattr(d, _itervalues)())\n \n def iteritems(d):\n     \"\"\"Return an iterator over the (key, value) pairs of a dictionary.\"\"\"\n-    return getattr(d, _iteritems)()\n+    return iter(getattr(d, _iteritems)())\n \n \n if PY3:\n@@ -365,4 +377,6 @@ def iterlists(d):\n     \"\"\"Return an iterator over the values of a MultiValueDict.\"\"\"\n     return getattr(d, _iterlists)()\n \n+\n add_move(MovedModule(\"_dummy_thread\", \"dummy_thread\"))\n+add_move(MovedModule(\"_thread\", \"thread\"))"
        },
        {
            "sha": "c19708458bc2cfc745fd1cbea94d89417bd2ca2c",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,13 +4,19 @@\n import unicodedata\n import warnings\n from gzip import GzipFile\n-from django.utils.six.moves import html_entities\n from io import BytesIO\n \n from django.utils.encoding import force_text\n from django.utils.functional import allow_lazy, SimpleLazyObject\n from django.utils import six\n+from django.utils.six.moves import html_entities\n from django.utils.translation import ugettext_lazy, ugettext as _, pgettext\n+from django.utils.safestring import mark_safe\n+\n+if not six.PY3:\n+    # Import force_unicode even though this module doesn't use it, because some\n+    # people rely on it being here.\n+    from django.utils.encoding import force_unicode\n \n # Capitalizes the first letter of a string.\n capfirst = lambda x: x and force_text(x)[0].upper() + force_text(x)[1:]\n@@ -287,7 +293,7 @@ def compress_string(s):\n def javascript_quote(s, quote_double_quotes=False):\n \n     def fix(match):\n-        return b\"\\u%04x\" % ord(match.group(1))\n+        return \"\\\\u%04x\" % ord(match.group(1))\n \n     if type(s) == bytes:\n         s = s.decode('utf-8')\n@@ -378,3 +384,14 @@ def unescape_string_literal(s):\n     quote = s[0]\n     return s[1:-1].replace(r'\\%s' % quote, quote).replace(r'\\\\', '\\\\')\n unescape_string_literal = allow_lazy(unescape_string_literal)\n+\n+def slugify(value):\n+    \"\"\"\n+    Converts to lowercase, removes non-word characters (alphanumerics and\n+    underscores) and converts spaces to hyphens. Also strips leading and\n+    trailing whitespace.\n+    \"\"\"\n+    value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore').decode('ascii')\n+    value = re.sub('[^\\w\\s-]', '', value).strip().lower()\n+    return mark_safe(re.sub('[-\\s]+', '-', value))\n+slugify = allow_lazy(slugify, six.text_type)"
        },
        {
            "sha": "f3cc6348f6ae19c0edd43476085c82556bdd2480",
            "filename": "django/utils/translation/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftranslation%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftranslation%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -79,10 +79,10 @@ def pgettext(context, message):\n def npgettext(context, singular, plural, number):\n     return _trans.npgettext(context, singular, plural, number)\n \n-ngettext_lazy = lazy(ngettext, bytes)\n-gettext_lazy = lazy(gettext, bytes)\n-ungettext_lazy = lazy(ungettext, six.text_type)\n+gettext_lazy = lazy(gettext, str)\n+ngettext_lazy = lazy(ngettext, str)\n ugettext_lazy = lazy(ugettext, six.text_type)\n+ungettext_lazy = lazy(ungettext, six.text_type)\n pgettext_lazy = lazy(pgettext, six.text_type)\n npgettext_lazy = lazy(npgettext, six.text_type)\n "
        },
        {
            "sha": "9fd33a7ea8a4bff2f5ade1edfe44d7013b87ec36",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,7 +9,7 @@\n from threading import local\n \n from django.utils.importlib import import_module\n-from django.utils.encoding import smart_str, smart_text\n+from django.utils.encoding import force_str, force_text\n from django.utils.safestring import mark_safe, SafeData\n from django.utils import six\n from django.utils.six import StringIO\n@@ -259,6 +259,11 @@ def do_translate(message, translation_function):\n     return result\n \n def gettext(message):\n+    \"\"\"\n+    Returns a string of the translation of the message.\n+\n+    Returns a string on Python 3 and an UTF-8-encoded bytestring on Python 2.\n+    \"\"\"\n     return do_translate(message, 'gettext')\n \n if six.PY3:\n@@ -296,8 +301,10 @@ def do_ntranslate(singular, plural, number, translation_function):\n \n def ngettext(singular, plural, number):\n     \"\"\"\n-    Returns a UTF-8 bytestring of the translation of either the singular or\n-    plural, based on the number.\n+    Returns a string of the translation of either the singular or plural,\n+    based on the number.\n+\n+    Returns a string on Python 3 and an UTF-8-encoded bytestring on Python 2.\n     \"\"\"\n     return do_ntranslate(singular, plural, number, 'ngettext')\n \n@@ -447,7 +454,7 @@ def templatize(src, origin=None):\n     from django.conf import settings\n     from django.template import (Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK,\n             TOKEN_COMMENT, TRANSLATOR_COMMENT_MARK)\n-    src = smart_text(src, settings.FILE_CHARSET)\n+    src = force_text(src, settings.FILE_CHARSET)\n     out = StringIO()\n     message_context = None\n     intrans = False\n@@ -462,7 +469,7 @@ def templatize(src, origin=None):\n                 content = ''.join(comment)\n                 translators_comment_start = None\n                 for lineno, line in enumerate(content.splitlines(True)):\n-                    if line.lstrip().startswith(smart_text(TRANSLATOR_COMMENT_MARK)):\n+                    if line.lstrip().startswith(TRANSLATOR_COMMENT_MARK):\n                         translators_comment_start = lineno\n                 for lineno, line in enumerate(content.splitlines(True)):\n                     if translators_comment_start is not None and lineno >= translators_comment_start:\n@@ -577,7 +584,7 @@ def templatize(src, origin=None):\n                 out.write(' # %s' % t.contents)\n             else:\n                 out.write(blankout(t.contents, 'X'))\n-    return smart_str(out.getvalue())\n+    return force_str(out.getvalue())\n \n def parse_accept_lang_header(lang_string):\n     \"\"\""
        },
        {
            "sha": "654c99778e03fde5c3a4beae3049f6b00534fa76",
            "filename": "django/utils/tzinfo.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftzinfo.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Futils%2Ftzinfo.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftzinfo.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,7 +5,7 @@\n import time\n from datetime import timedelta, tzinfo\n \n-from django.utils.encoding import smart_text, smart_str, DEFAULT_LOCALE_ENCODING\n+from django.utils.encoding import force_str, force_text, DEFAULT_LOCALE_ENCODING\n \n # Python's doc say: \"A tzinfo subclass must have an __init__() method that can\n # be called with no arguments\". FixedOffset and LocalTimezone don't honor this\n@@ -53,7 +53,7 @@ def __init__(self, dt):\n         self._tzname = self.tzname(dt)\n \n     def __repr__(self):\n-        return smart_str(self._tzname)\n+        return force_str(self._tzname)\n \n     def __getinitargs__(self):\n         return self.__dt,\n@@ -72,7 +72,7 @@ def dst(self, dt):\n \n     def tzname(self, dt):\n         try:\n-            return smart_text(time.tzname[self._isdst(dt)],\n+            return force_text(time.tzname[self._isdst(dt)],\n                                  DEFAULT_LOCALE_ENCODING)\n         except UnicodeDecodeError:\n             return None"
        },
        {
            "sha": "ed99d8dfe643aaf45cba239a5bb2212ee16f486e",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,7 +14,7 @@\n from django.template.defaultfilters import force_escape, pprint\n from django.utils.html import escape\n from django.utils.importlib import import_module\n-from django.utils.encoding import smart_text, smart_bytes\n+from django.utils.encoding import force_bytes, smart_text\n from django.utils import six\n \n HIDDEN_SETTINGS = re.compile('API|TOKEN|KEY|SECRET|PASS|PROFANITIES_LIST|SIGNATURE')\n@@ -440,7 +440,7 @@ def technical_404_response(request, exception):\n         'root_urlconf': settings.ROOT_URLCONF,\n         'request_path': request.path_info[1:], # Trim leading slash\n         'urlpatterns': tried,\n-        'reason': smart_bytes(exception, errors='replace'),\n+        'reason': force_bytes(exception, errors='replace'),\n         'request': request,\n         'settings': get_safe_settings(),\n     })"
        },
        {
            "sha": "e11412ba4d2c3898d074cb6348c90d30d0386b84",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -18,6 +18,8 @@ class ContextMixin(object):\n     \"\"\"\n \n     def get_context_data(self, **kwargs):\n+        if 'view' not in kwargs:\n+            kwargs['view'] = self\n         return kwargs\n \n \n@@ -140,11 +142,11 @@ def get_template_names(self):\n \n class TemplateView(TemplateResponseMixin, ContextMixin, View):\n     \"\"\"\n-    A view that renders a template.  This view is different from all the others\n-    insofar as it also passes ``kwargs`` as ``params`` to the template context.\n+    A view that renders a template.  This view will also pass into the context\n+    any keyword arguments passed by the url conf.\n     \"\"\"\n     def get(self, request, *args, **kwargs):\n-        context = self.get_context_data(params=kwargs)\n+        context = self.get_context_data(**kwargs)\n         return self.render_to_response(context)\n \n "
        },
        {
            "sha": "d44246f0b7e4d771c9eda1d32d7360142c59e365",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -327,6 +327,7 @@ class BaseDateListView(MultipleObjectMixin, DateMixin, View):\n     Abstract base class for date-based views displaying a list of objects.\n     \"\"\"\n     allow_empty = False\n+    date_list_period = 'year'\n \n     def get(self, request, *args, **kwargs):\n         self.date_list, self.object_list, extra_context = self.get_dated_items()\n@@ -370,13 +371,18 @@ def get_dated_queryset(self, ordering=None, **lookup):\n \n         return qs\n \n-    def get_date_list(self, queryset, date_type):\n+    def get_date_list_period(self):\n+        return self.date_list_period\n+\n+    def get_date_list(self, queryset, date_type=None):\n         \"\"\"\n         Get a date list by calling `queryset.dates()`, checking along the way\n         for empty lists that aren't allowed.\n         \"\"\"\n         date_field = self.get_date_field()\n         allow_empty = self.get_allow_empty()\n+        if date_type is None:\n+            date_type = self.get_date_list_period()\n \n         date_list = queryset.dates(date_field, date_type)[::-1]\n         if date_list is not None and not date_list and not allow_empty:\n@@ -400,7 +406,7 @@ def get_dated_items(self):\n         Return (date_list, items, extra_context) for this request.\n         \"\"\"\n         qs = self.get_dated_queryset(ordering='-%s' % self.get_date_field())\n-        date_list = self.get_date_list(qs, 'year')\n+        date_list = self.get_date_list(qs)\n \n         if not date_list:\n             qs = qs.none()\n@@ -419,6 +425,7 @@ class BaseYearArchiveView(YearMixin, BaseDateListView):\n     \"\"\"\n     List of objects published in a given year.\n     \"\"\"\n+    date_list_period = 'month'\n     make_object_list = False\n \n     def get_dated_items(self):\n@@ -438,7 +445,7 @@ def get_dated_items(self):\n         }\n \n         qs = self.get_dated_queryset(ordering='-%s' % date_field, **lookup_kwargs)\n-        date_list = self.get_date_list(qs, 'month')\n+        date_list = self.get_date_list(qs)\n \n         if not self.get_make_object_list():\n             # We need this to be a queryset since parent classes introspect it\n@@ -470,6 +477,8 @@ class BaseMonthArchiveView(YearMixin, MonthMixin, BaseDateListView):\n     \"\"\"\n     List of objects published in a given year.\n     \"\"\"\n+    date_list_period = 'day'\n+\n     def get_dated_items(self):\n         \"\"\"\n         Return (date_list, items, extra_context) for this request.\n@@ -489,7 +498,7 @@ def get_dated_items(self):\n         }\n \n         qs = self.get_dated_queryset(**lookup_kwargs)\n-        date_list = self.get_date_list(qs, 'day')\n+        date_list = self.get_date_list(qs)\n \n         return (date_list, qs, {\n             'month': date,"
        },
        {
            "sha": "2ff22ce13f885dc35e7fa578fd7333eb588bc494",
            "filename": "django/views/static.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/django%2Fviews%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fstatic.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -61,7 +61,7 @@ def serve(request, path, document_root=None, show_indexes=False):\n     mimetype = mimetype or 'application/octet-stream'\n     if not was_modified_since(request.META.get('HTTP_IF_MODIFIED_SINCE'),\n                               statobj.st_mtime, statobj.st_size):\n-        return HttpResponseNotModified(content_type=mimetype)\n+        return HttpResponseNotModified()\n     with open(fullpath, 'rb') as f:\n         response = HttpResponse(f.read(), content_type=mimetype)\n     response[\"Last-Modified\"] = http_date(statobj.st_mtime)"
        },
        {
            "sha": "433fd679a18bedd39a1f7b3267e76a17ff355781",
            "filename": "docs/conf.py",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fconf.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fconf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fconf.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -190,11 +190,10 @@\n \n # -- Options for LaTeX output --------------------------------------------------\n \n-# The paper size ('letter' or 'a4').\n-#latex_paper_size = 'letter'\n-\n-# The font size ('10pt', '11pt' or '12pt').\n-#latex_font_size = '10pt'\n+latex_elements = {\n+    'preamble': ('\\\\DeclareUnicodeCharacter{2264}{\\\\ensuremath{\\\\le}}'\n+                 '\\\\DeclareUnicodeCharacter{2265}{\\\\ensuremath{\\\\ge}}')\n+}\n \n # Grouping the document tree into LaTeX files. List of tuples\n # (source start file, target name, title, author, document class [howto/manual]).\n@@ -218,9 +217,6 @@\n # If true, show URL addresses after external links.\n #latex_show_urls = False\n \n-# Additional stuff for the LaTeX preamble.\n-#latex_preamble = ''\n-\n # Documents to append as an appendix to all manuals.\n #latex_appendices = []\n "
        },
        {
            "sha": "659a8c5ad95f098d89736ddfe1644c1a617691b2",
            "filename": "docs/faq/general.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ffaq%2Fgeneral.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ffaq%2Fgeneral.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Fgeneral.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -185,6 +185,6 @@ would be happy to help you.\n \n You might also be interested in posting a job to http://djangogigs.com/ .\n If you want to find Django-capable people in your local area, try\n-http://djangopeople.net/ .\n+https://people.djangoproject.com/ .\n \n .. _developers for hire page: https://code.djangoproject.com/wiki/DevelopersForHire"
        },
        {
            "sha": "5b27af82d69be602716a3bc7440824fb49d595f2",
            "filename": "docs/howto/custom-template-tags.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fhowto%2Fcustom-template-tags.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fhowto%2Fcustom-template-tags.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-template-tags.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -189,7 +189,7 @@ passed around inside the template code:\n   They're commonly used for output that contains raw HTML that is intended\n   to be interpreted as-is on the client side.\n \n-  Internally, these strings are of type ``SafeString`` or ``SafeUnicode``.\n+  Internally, these strings are of type ``SafeBytes`` or ``SafeText``.\n   They share a common base class of ``SafeData``, so you can test\n   for them using code like:\n \n@@ -204,8 +204,8 @@ passed around inside the template code:\n   not. These strings are only escaped once, however, even if auto-escaping\n   applies.\n \n-  Internally, these strings are of type ``EscapeString`` or\n-  ``EscapeUnicode``. Generally you don't have to worry about these; they\n+  Internally, these strings are of type ``EscapeBytes`` or\n+  ``EscapeText``. Generally you don't have to worry about these; they\n   exist for the implementation of the :tfilter:`escape` filter.\n \n Template filter code falls into one of two situations:"
        },
        {
            "sha": "c4483291a34cc784cb9105bfdd2367d102031af7",
            "filename": "docs/howto/deployment/wsgi/gunicorn.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fgunicorn.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fgunicorn.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fgunicorn.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -13,7 +13,7 @@ There are two ways to use Gunicorn with Django. One is to have Gunicorn treat\n Django as just another WSGI application. The second is to use Gunicorn's\n special `integration with Django`_.\n \n-.. _integration with Django: http://gunicorn.org/run.html#django-manage-py_\n+.. _integration with Django: http://gunicorn.org/run.html#django-manage-py\n \n Installing Gunicorn\n ==================="
        },
        {
            "sha": "3f4e30385c289bb117c73decd21a8864944a9ac1",
            "filename": "docs/index.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Findex.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -104,9 +104,12 @@ to know about views via the links below:\n   :doc:`Custom storage <howto/custom-file-storage>`\n \n * **Class-based views:**\n-  :doc:`Overview<topics/class-based-views/index>` |\n-  :doc:`Built-in class-based views<ref/class-based-views/index>` |\n-  :doc:`Built-in view mixins<ref/class-based-views/mixins>`\n+  :doc:`Overview <topics/class-based-views/index>` |\n+  :doc:`Built-in display views <topics/class-based-views/generic-display>` |\n+  :doc:`Built-in editing views <topics/class-based-views/generic-editing>` |\n+  :doc:`Using mixins <topics/class-based-views/mixins>` |\n+  :doc:`API reference <ref/class-based-views/index>` |\n+  :doc:`Flattened index<ref/class-based-views/flattened-index>`\n \n * **Advanced:**\n   :doc:`Generating CSV <howto/outputting-csv>` |"
        },
        {
            "sha": "2faace99a5c0809f68909fd9e8fff6857e4f0c35",
            "filename": "docs/internals/committers.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Finternals%2Fcommitters.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Finternals%2Fcommitters.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcommitters.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -77,16 +77,14 @@ record of being helpful on the mailing lists, and a proven desire to dedicate\n serious time to Django. In return, they've been granted the coveted commit bit,\n and have free rein to hack on all parts of Django.\n \n-`Malcolm Tredinnick`_\n+Malcolm Tredinnick\n     Malcolm originally wanted to be a mathematician, somehow ended up a software\n     developer. He's contributed to many Open Source projects, has served on the\n     board of the GNOME foundation, and will kick your ass at chess.\n \n     When he's not busy being an International Man of Mystery, Malcolm lives in\n     Sydney, Australia.\n \n-.. _malcolm tredinnick: http://www.pointy-stick.com/\n-\n `Russell Keith-Magee`_\n     Russell studied physics as an undergraduate, and studied neural networks for\n     his PhD. His first job was with a startup in the defense industry developing"
        },
        {
            "sha": "53b0e1007d15dc7cca084fa7aa9fed8d57972eb2",
            "filename": "docs/internals/contributing/bugs-and-features.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Finternals%2Fcontributing%2Fbugs-and-features.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Finternals%2Fcontributing%2Fbugs-and-features.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fbugs-and-features.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -62,8 +62,6 @@ To understand the lifecycle of your ticket once you have created it, refer to\n \n .. _django-updates: http://groups.google.com/group/django-updates\n \n-.. _reporting-security-issues:\n-\n Reporting user interface bugs and features\n ------------------------------------------\n "
        },
        {
            "sha": "6d4fb7eef18563de1a92e893727457b9917f213a",
            "filename": "docs/intro/tutorial03.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fintro%2Ftutorial03.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fintro%2Ftutorial03.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial03.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -550,5 +550,16 @@ with the :ttag:`url` template tag:\n \n     <li><a href=\"{% url 'polls.views.detail' poll.id %}\">{{ poll.question }}</a></li>\n \n+.. note::\n+\n+    If ``{% url 'polls.views.detail' poll.id %}`` (with quotes) doesn't work,\n+    but ``{% url polls.views.detail poll.id %}`` (without quotes) does, that\n+    means you're using a version of Django  1.4. In this case, add the\n+    following declaration at the top of your template:\n+\n+    .. code-block:: html+django\n+\n+        {% load url from future %}\n+\n When you're comfortable with writing views, read :doc:`part 4 of this tutorial\n </intro/tutorial04>` to learn about simple form processing and generic views."
        },
        {
            "sha": "3f82b44f461908d42016ecf8c435d073711f113d",
            "filename": "docs/ref/class-based-views/base.txt",
            "status": "modified",
            "additions": 22,
            "deletions": 13,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fbase.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fbase.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fbase.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,6 +8,9 @@ themselves or inherited from. They may not provide all the capabilities\n required for projects, in which case there are Mixins and Generic class-based\n views.\n \n+View\n+----\n+\n .. class:: django.views.generic.base.View\n \n     The master class-based base view. All other class-based views inherit from\n@@ -31,13 +34,13 @@ views.\n     **Example urls.py**::\n \n         from django.conf.urls import patterns, url\n-        \n+\n         from myapp.views import MyView\n-        \n+\n         urlpatterns = patterns('',\n             url(r'^mine/$', MyView.as_view(), name='my-view'),\n         )\n-        \n+\n     **Methods**\n \n     .. method:: dispatch(request, *args, **kwargs)\n@@ -61,13 +64,16 @@ views.\n \n         The default implementation returns ``HttpResponseNotAllowed`` with list\n         of allowed methods in plain text.\n-        \n-    .. note:: \n+\n+    .. note::\n \n         Documentation on class-based views is a work in progress. As yet, only the\n         methods defined directly on the class are documented here, not methods\n         defined on superclasses.\n \n+TemplateView\n+------------\n+\n .. class:: django.views.generic.base.TemplateView\n \n     Renders a given template, passing it a ``{{ params }}`` template variable,\n@@ -84,22 +90,22 @@ views.\n     1. :meth:`dispatch()`\n     2. :meth:`http_method_not_allowed()`\n     3. :meth:`get_context_data()`\n-      \n+\n     **Example views.py**::\n \n         from django.views.generic.base import TemplateView\n-        \n+\n         from articles.models import Article\n \n         class HomePageView(TemplateView):\n \n             template_name = \"home.html\"\n-            \n+\n             def get_context_data(self, **kwargs):\n                 context = super(HomePageView, self).get_context_data(**kwargs)\n                 context['latest_articles'] = Article.objects.all()[:5]\n                 return context\n-                \n+\n     **Example urls.py**::\n \n         from django.conf.urls import patterns, url\n@@ -126,12 +132,15 @@ views.\n     * ``params``: The dictionary of keyword arguments captured from the URL\n       pattern that served the view.\n \n-    .. note:: \n+    .. note::\n \n         Documentation on class-based views is a work in progress. As yet, only the\n         methods defined directly on the class are documented here, not methods\n         defined on superclasses.\n \n+RedirectView\n+------------\n+\n .. class:: django.views.generic.base.RedirectView\n \n     Redirects to a given URL.\n@@ -159,7 +168,7 @@ views.\n \n         from django.shortcuts import get_object_or_404\n         from django.views.generic.base import RedirectView\n-        \n+\n         from articles.models import Article\n \n         class ArticleCounterRedirectView(RedirectView):\n@@ -176,7 +185,7 @@ views.\n \n         from django.conf.urls import patterns, url\n         from django.views.generic.base import RedirectView\n-        \n+\n         from article.views import ArticleCounterRedirectView\n \n         urlpatterns = patterns('',\n@@ -217,7 +226,7 @@ views.\n         behavior they wish, as long as the method returns a redirect-ready URL\n         string.\n \n-    .. note:: \n+    .. note::\n \n         Documentation on class-based views is a work in progress. As yet, only the\n         methods defined directly on the class are documented here, not methods"
        },
        {
            "sha": "cbce3690e215e959cdeb22415e1cdd1eae59d4da",
            "filename": "docs/ref/class-based-views/flattened-index.txt",
            "status": "added",
            "additions": 556,
            "deletions": 0,
            "changes": 556,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,556 @@\n+===========================================\n+Class-based generic views - flattened index\n+===========================================\n+\n+This index provides an alternate organization of the reference documentation\n+for class-based views. For each view, the effective attributes and methods from\n+the class tree are represented under that view. For the reference\n+documentation organized by the class which defines the behavior, see\n+:doc:`Class-based views</ref/class-based-views/index>`\n+\n+Simple generic views\n+--------------------\n+\n+View\n+~~~~\n+.. class:: View()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+\n+TemplateView\n+~~~~~~~~~~~~\n+.. class:: TemplateView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.base.TemplateView.get`\n+* :meth:`~django.views.generic.base.TemplateView.get_context_data`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+RedirectView\n+~~~~~~~~~~~~\n+.. class:: RedirectView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.base.RedirectView.permanent`\n+* :attr:`~django.views.generic.base.RedirectView.query_string`\n+* :attr:`~django.views.generic.base.RedirectView.url`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.RedirectView.delete`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.base.RedirectView.get`\n+* :meth:`~django.views.generic.base.RedirectView.get_redirect_url`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.base.RedirectView.options`\n+* :meth:`~django.views.generic.base.RedirectView.post`\n+* :meth:`~django.views.generic.base.RedirectView.put`\n+\n+Detail Views\n+------------\n+\n+DetailView\n+~~~~~~~~~~\n+.. class:: DetailView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.context_object_name` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.model`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.pk_url_kwarg`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.queryset` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_field` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_slug_field`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_url_kwarg`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_field`\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_suffix`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.detail.BaseDetailView.get`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_object`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+List Views\n+----------\n+\n+ListView\n+~~~~~~~~\n+.. class:: ListView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.list.BaseListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+Editing views\n+-------------\n+\n+FormView\n+~~~~~~~~\n+.. class:: FormView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.edit.FormMixin.form_class` [:meth:`~django.views.generic.edit.FormMixin.get_form_class`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.edit.FormMixin.initial` [:meth:`~django.views.generic.edit.FormMixin.get_initial`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.edit.FormMixin.success_url` [:meth:`~django.views.generic.edit.FormMixin.get_success_url`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.edit.FormMixin.form_invalid`\n+* :meth:`~django.views.generic.edit.FormMixin.form_valid`\n+* :meth:`~django.views.generic.edit.ProcessFormView.get`\n+* :meth:`~django.views.generic.edit.FormMixin.get_context_data`\n+* :meth:`~django.views.generic.edit.FormMixin.get_form`\n+* :meth:`~django.views.generic.edit.FormMixin.get_form_kwargs`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.edit.ProcessFormView.post`\n+* :meth:`~django.views.generic.edit.ProcessFormView.put`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+CreateView\n+~~~~~~~~~~\n+.. class:: CreateView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.context_object_name` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.edit.FormMixin.form_class` [:meth:`~django.views.generic.edit.FormMixin.get_form_class`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.edit.FormMixin.initial` [:meth:`~django.views.generic.edit.FormMixin.get_initial`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.model`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.pk_url_kwarg`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.queryset` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_field` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_slug_field`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_url_kwarg`\n+* :attr:`~django.views.generic.edit.FormMixin.success_url` [:meth:`~django.views.generic.edit.FormMixin.get_success_url`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_field`\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_suffix`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.edit.FormMixin.form_invalid`\n+* :meth:`~django.views.generic.edit.FormMixin.form_valid`\n+* :meth:`~django.views.generic.edit.ProcessFormView.get`\n+* :meth:`~django.views.generic.edit.FormMixin.get_context_data`\n+* :meth:`~django.views.generic.edit.FormMixin.get_form`\n+* :meth:`~django.views.generic.edit.FormMixin.get_form_kwargs`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_object`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.edit.ProcessFormView.post`\n+* :meth:`~django.views.generic.edit.ProcessFormView.put`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+UpdateView\n+~~~~~~~~~~\n+.. class:: UpdateView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.context_object_name` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.edit.FormMixin.form_class` [:meth:`~django.views.generic.edit.FormMixin.get_form_class`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.edit.FormMixin.initial` [:meth:`~django.views.generic.edit.FormMixin.get_initial`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.model`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.pk_url_kwarg`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.queryset` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_field` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_slug_field`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_url_kwarg`\n+* :attr:`~django.views.generic.edit.FormMixin.success_url` [:meth:`~django.views.generic.edit.FormMixin.get_success_url`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_field`\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_suffix`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.edit.FormMixin.form_invalid`\n+* :meth:`~django.views.generic.edit.FormMixin.form_valid`\n+* :meth:`~django.views.generic.edit.ProcessFormView.get`\n+* :meth:`~django.views.generic.edit.FormMixin.get_context_data`\n+* :meth:`~django.views.generic.edit.FormMixin.get_form`\n+* :meth:`~django.views.generic.edit.FormMixin.get_form_kwargs`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_object`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.edit.ProcessFormView.post`\n+* :meth:`~django.views.generic.edit.ProcessFormView.put`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+DeleteView\n+~~~~~~~~~~\n+.. class:: DeleteView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.context_object_name` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.model`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.pk_url_kwarg`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.queryset` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_field` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_slug_field`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_url_kwarg`\n+* :attr:`~django.views.generic.edit.DeletionMixin.success_url` [:meth:`~django.views.generic.edit.DeletionMixin.get_success_url`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_field`\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_suffix`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.edit.DeletionMixin.delete`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.detail.BaseDetailView.get`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_object`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.edit.DeletionMixin.post`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+Date-based views\n+----------------\n+\n+ArchiveIndexView\n+~~~~~~~~~~~~~~~~\n+.. class:: ArchiveIndexView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_date_list`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_items`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_queryset`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+YearArchiveView\n+~~~~~~~~~~~~~~~\n+.. class:: YearArchiveView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.dates.BaseYearArchiveView.make_object_list` [:meth:`~django.views.generic.dates.BaseYearArchiveView.get_make_object_list`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+* :attr:`~django.views.generic.dates.YearMixin.year` [:meth:`~django.views.generic.dates.YearMixin.get_year`]\n+* :attr:`~django.views.generic.dates.YearMixin.year_format` [:meth:`~django.views.generic.dates.YearMixin.get_year_format`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_date_list`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_items`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_queryset`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+MonthArchiveView\n+~~~~~~~~~~~~~~~~\n+.. class:: MonthArchiveView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n+* :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+* :attr:`~django.views.generic.dates.YearMixin.year` [:meth:`~django.views.generic.dates.YearMixin.get_year`]\n+* :attr:`~django.views.generic.dates.YearMixin.year_format` [:meth:`~django.views.generic.dates.YearMixin.get_year_format`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_date_list`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_items`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_queryset`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_next_month`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_previous_month`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+WeekArchiveView\n+~~~~~~~~~~~~~~~\n+.. class:: WeekArchiveView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+* :attr:`~django.views.generic.dates.WeekMixin.week` [:meth:`~django.views.generic.dates.WeekMixin.get_week`]\n+* :attr:`~django.views.generic.dates.WeekMixin.week_format` [:meth:`~django.views.generic.dates.WeekMixin.get_week_format`]\n+* :attr:`~django.views.generic.dates.YearMixin.year` [:meth:`~django.views.generic.dates.YearMixin.get_year`]\n+* :attr:`~django.views.generic.dates.YearMixin.year_format` [:meth:`~django.views.generic.dates.YearMixin.get_year_format`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_date_list`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_items`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_queryset`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+DayArchiveView\n+~~~~~~~~~~~~~~\n+.. class:: DayArchiveView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.dates.DayMixin.day` [:meth:`~django.views.generic.dates.DayMixin.get_day`]\n+* :attr:`~django.views.generic.dates.DayMixin.day_format` [:meth:`~django.views.generic.dates.DayMixin.get_day_format`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n+* :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+* :attr:`~django.views.generic.dates.YearMixin.year` [:meth:`~django.views.generic.dates.YearMixin.get_year`]\n+* :attr:`~django.views.generic.dates.YearMixin.year_format` [:meth:`~django.views.generic.dates.YearMixin.get_year_format`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_date_list`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_items`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_queryset`\n+* :meth:`~django.views.generic.dates.DayMixin.get_next_day`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_next_month`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.dates.DayMixin.get_previous_day`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_previous_month`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+TodayArchiveView\n+~~~~~~~~~~~~~~~~\n+.. class:: TodayArchiveView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.allow_empty` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_allow_empty`]\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.context_object_name` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.dates.DayMixin.day` [:meth:`~django.views.generic.dates.DayMixin.get_day`]\n+* :attr:`~django.views.generic.dates.DayMixin.day_format` [:meth:`~django.views.generic.dates.DayMixin.get_day_format`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n+* :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n+* :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.list.MultipleObjectTemplateResponseMixin.template_name_suffix`\n+* :attr:`~django.views.generic.dates.YearMixin.year` [:meth:`~django.views.generic.dates.YearMixin.get_year`]\n+* :attr:`~django.views.generic.dates.YearMixin.year_format` [:meth:`~django.views.generic.dates.YearMixin.get_year_format`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_date_list`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_items`\n+* :meth:`~django.views.generic.dates.BaseDateListView.get_dated_queryset`\n+* :meth:`~django.views.generic.dates.DayMixin.get_next_day`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_next_month`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.get_paginator`\n+* :meth:`~django.views.generic.dates.DayMixin.get_previous_day`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_previous_month`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.list.MultipleObjectMixin.paginate_queryset`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`\n+\n+DateDetailView\n+~~~~~~~~~~~~~~\n+.. class:: DateDetailView()\n+\n+**Attributes** (with optional accessor):\n+\n+* :attr:`~django.views.generic.dates.DateMixin.allow_future` [:meth:`~django.views.generic.dates.DateMixin.get_allow_future`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.context_object_name` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_context_object_name`]\n+* :attr:`~django.views.generic.dates.DateMixin.date_field` [:meth:`~django.views.generic.dates.DateMixin.get_date_field`]\n+* :attr:`~django.views.generic.dates.DayMixin.day` [:meth:`~django.views.generic.dates.DayMixin.get_day`]\n+* :attr:`~django.views.generic.dates.DayMixin.day_format` [:meth:`~django.views.generic.dates.DayMixin.get_day_format`]\n+* :attr:`~django.views.generic.base.View.http_method_names`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.model`\n+* :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n+* :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.pk_url_kwarg`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.queryset` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_queryset`]\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_field` [:meth:`~django.views.generic.detail.SingleObjectMixin.get_slug_field`]\n+* :attr:`~django.views.generic.detail.SingleObjectMixin.slug_url_kwarg`\n+* :attr:`~django.views.generic.base.TemplateResponseMixin.template_name` [:meth:`~django.views.generic.base.TemplateResponseMixin.get_template_names`]\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_field`\n+* :attr:`~django.views.generic.detail.SingleObjectTemplateResponseMixin.template_name_suffix`\n+* :attr:`~django.views.generic.dates.YearMixin.year` [:meth:`~django.views.generic.dates.YearMixin.get_year`]\n+* :attr:`~django.views.generic.dates.YearMixin.year_format` [:meth:`~django.views.generic.dates.YearMixin.get_year_format`]\n+\n+**Methods**\n+\n+* :meth:`~django.views.generic.base.View.as_view`\n+* :meth:`~django.views.generic.base.View.dispatch`\n+* :meth:`~django.views.generic.detail.BaseDetailView.get`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_context_data`\n+* :meth:`~django.views.generic.dates.DayMixin.get_next_day`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_next_month`\n+* :meth:`~django.views.generic.detail.SingleObjectMixin.get_object`\n+* :meth:`~django.views.generic.dates.DayMixin.get_previous_day`\n+* :meth:`~django.views.generic.dates.MonthMixin.get_previous_month`\n+* :meth:`~django.views.generic.base.View.head`\n+* :meth:`~django.views.generic.base.View.http_method_not_allowed`\n+* :meth:`~django.views.generic.base.TemplateResponseMixin.render_to_response`"
        },
        {
            "sha": "12776cbb9452046e76af5bcdbe1d6cf47c15478a",
            "filename": "docs/ref/class-based-views/generic-date-based.txt",
            "status": "modified",
            "additions": 26,
            "deletions": 1,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,6 +5,9 @@ Generic date views\n Date-based generic views (in the module :mod:`django.views.generic.dates`)\n are views for displaying drilldown pages for date-based data.\n \n+ArchiveIndexView\n+----------------\n+\n .. class:: django.views.generic.dates.ArchiveIndexView\n \n     A top-level index page showing the \"latest\" objects, by date. Objects with\n@@ -21,11 +24,17 @@ are views for displaying drilldown pages for date-based data.\n     * :class:`django.views.generic.list.MultipleObjectMixin`\n     * :class:`django.views.generic.dates.DateMixin`\n     * :class:`django.views.generic.base.View`\n-    \n+\n     **Notes**\n \n     * Uses a default ``context_object_name`` of ``latest``.\n     * Uses a default ``template_name_suffix`` of ``_archive``.\n+    * Defaults to providing ``date_list`` by year, but this can be altered to\n+      month or day using the attribute ``date_list_period``. This also applies\n+      to all subclass views.\n+\n+YearArchiveView\n+---------------\n \n .. class:: django.views.generic.dates.YearArchiveView\n \n@@ -86,6 +95,9 @@ are views for displaying drilldown pages for date-based data.\n \n     * Uses a default ``template_name_suffix`` of ``_archive_year``.\n \n+MonthArchiveView\n+----------------\n+\n .. class:: django.views.generic.dates.MonthArchiveView\n \n     A monthly archive page showing all objects in a given month. Objects with a\n@@ -134,6 +146,9 @@ are views for displaying drilldown pages for date-based data.\n \n     * Uses a default ``template_name_suffix`` of ``_archive_month``.\n \n+WeekArchiveView\n+---------------\n+\n .. class:: django.views.generic.dates.WeekArchiveView\n \n     A weekly archive page showing all objects in a given week. Objects with a\n@@ -175,6 +190,9 @@ are views for displaying drilldown pages for date-based data.\n \n     * Uses a default ``template_name_suffix`` of ``_archive_week``.\n \n+DayArchiveView\n+--------------\n+\n .. class:: django.views.generic.dates.DayArchiveView\n \n     A day archive page showing all objects in a given day. Days in the future\n@@ -225,6 +243,9 @@ are views for displaying drilldown pages for date-based data.\n \n     * Uses a default ``template_name_suffix`` of ``_archive_day``.\n \n+TodayArchiveView\n+----------------\n+\n .. class:: django.views.generic.dates.TodayArchiveView\n \n     A day archive page showing all objects for *today*. This is exactly the\n@@ -246,6 +267,10 @@ are views for displaying drilldown pages for date-based data.\n     * :class:`django.views.generic.dates.DateMixin`\n     * :class:`django.views.generic.base.View`\n \n+\n+DateDetailView\n+--------------\n+\n .. class:: django.views.generic.dates.DateDetailView\n \n     A page representing an individual object. If the object has a date value in"
        },
        {
            "sha": "ef3bc179eed6ee9461fde69ac421d58514bf1d80",
            "filename": "docs/ref/class-based-views/generic-display.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fgeneric-display.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fgeneric-display.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-display.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,6 +5,9 @@ Generic display views\n The two following generic class-based views are designed to display data. On\n many projects they are typically the most commonly used views.\n \n+DetailView\n+----------\n+\n .. class:: django.views.generic.detail.DetailView\n \n     While this view is executing, ``self.object`` will contain the object that\n@@ -39,7 +42,7 @@ many projects they are typically the most commonly used views.\n         from articles.models import Article\n \n         class ArticleDetailView(DetailView):\n-        \n+\n             model = Article\n \n             def get_context_data(self, **kwargs):\n@@ -55,7 +58,10 @@ many projects they are typically the most commonly used views.\n \n         urlpatterns = patterns('',\n             url(r'^(?P<slug>[-_\\w]+)/$', ArticleDetailView.as_view(), name='article-detail'),\n-        )    \n+        )\n+\n+ListView\n+--------\n \n .. class:: django.views.generic.list.ListView\n "
        },
        {
            "sha": "2fac06ee023ecc4298d2eedfe6b1acdd7ef2cb88",
            "filename": "docs/ref/class-based-views/generic-editing.txt",
            "status": "modified",
            "additions": 19,
            "deletions": 8,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,7 +2,7 @@\n Generic editing views\n =====================\n \n-The following views are described on this page and provide a foundation for \n+The following views are described on this page and provide a foundation for\n editing content:\n \n * :class:`django.views.generic.edit.FormView`\n@@ -13,7 +13,7 @@ editing content:\n .. note::\n \n     Some of the examples on this page assume that a model titled 'Author'\n-    has been defined. For these cases we assume the following has been defined \n+    has been defined. For these cases we assume the following has been defined\n     in `myapp/models.py`::\n \n         from django import models\n@@ -25,6 +25,9 @@ editing content:\n             def get_absolute_url(self):\n                 return reverse('author-detail', kwargs={'pk': self.pk})\n \n+FormView\n+--------\n+\n .. class:: django.views.generic.edit.FormView\n \n     A view that displays a form. On error, redisplays the form with validation\n@@ -69,6 +72,8 @@ editing content:\n                 form.send_email()\n                 return super(ContactView, self).form_valid(form)\n \n+CreateView\n+----------\n \n .. class:: django.views.generic.edit.CreateView\n \n@@ -94,7 +99,7 @@ editing content:\n     .. attribute:: template_name_suffix\n \n         The CreateView page displayed to a GET request uses a\n-        ``template_name_suffix`` of ``'_form.html'``. For \n+        ``template_name_suffix`` of ``'_form.html'``. For\n         example, changing this attribute to ``'_create_form.html'`` for a view\n         creating objects for the the example `Author` model would cause the the\n         default `template_name` to be ``'myapp/author_create_form.html'``.\n@@ -107,6 +112,9 @@ editing content:\n         class AuthorCreate(CreateView):\n             model = Author\n \n+UpdateView\n+----------\n+\n .. class:: django.views.generic.edit.UpdateView\n \n     A view that displays a form for editing an existing object, redisplaying\n@@ -133,10 +141,10 @@ editing content:\n     .. attribute:: template_name_suffix\n \n         The UpdateView page displayed to a GET request uses a\n-        ``template_name_suffix`` of ``'_form.html'``. For \n+        ``template_name_suffix`` of ``'_form.html'``. For\n         example, changing this attribute to ``'_update_form.html'`` for a view\n         updating objects for the the example `Author` model would cause the the\n-        default `template_name` to be ``'myapp/author_update_form.html'``.        \n+        default `template_name` to be ``'myapp/author_update_form.html'``.\n \n     **Example views.py**::\n \n@@ -146,6 +154,9 @@ editing content:\n         class AuthorUpdate(UpdateView):\n             model = Author\n \n+DeleteView\n+----------\n+\n .. class:: django.views.generic.edit.DeleteView\n \n     A view that displays a confirmation page and deletes an existing object.\n@@ -171,10 +182,10 @@ editing content:\n     .. attribute:: template_name_suffix\n \n         The DeleteView page displayed to a GET request uses a\n-        ``template_name_suffix`` of ``'_confirm_delete.html'``. For \n+        ``template_name_suffix`` of ``'_confirm_delete.html'``. For\n         example, changing this attribute to ``'_check_delete.html'`` for a view\n         deleting objects for the the example `Author` model would cause the the\n-        default `template_name` to be ``'myapp/author_check_delete.html'``.        \n+        default `template_name` to be ``'myapp/author_check_delete.html'``.\n \n \n     **Example views.py**::\n@@ -185,4 +196,4 @@ editing content:\n \n         class AuthorDelete(DeleteView):\n             model = Author\n-            success_url = reverse_lazy('author-list')        \n+            success_url = reverse_lazy('author-list')"
        },
        {
            "sha": "f0e7bbc6c19ab98573746d5981bf5e0b6f31f0a7",
            "filename": "docs/ref/class-based-views/index.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Findex.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,13 +6,14 @@ Class-based views API reference. For introductory material, see\n :doc:`/topics/class-based-views/index`.\n \n .. toctree::\n-   :maxdepth: 1\n+   :maxdepth: 3\n \n    base\n    generic-display\n    generic-editing\n    generic-date-based\n    mixins\n+   flattened-index\n \n Specification\n -------------"
        },
        {
            "sha": "6bf6f10b5d48917b2dbb9e1b4153ff57abfbef75",
            "filename": "docs/ref/class-based-views/mixins-date-based.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,6 +3,9 @@ Date-based mixins\n =================\n \n \n+YearMixin\n+---------\n+\n .. class:: django.views.generic.dates.YearMixin\n \n     A mixin that can be used to retrieve and provide parsing information for a\n@@ -36,6 +39,9 @@ Date-based mixins\n \n         Raises a 404 if no valid year specification can be found.\n \n+MonthMixin\n+----------\n+\n .. class:: django.views.generic.dates.MonthMixin\n \n     A mixin that can be used to retrieve and provide parsing information for a\n@@ -82,6 +88,9 @@ Date-based mixins\n         date provided. If ``allow_empty = False``, returns the previous month\n         that contained data.\n \n+DayMixin\n+--------\n+\n .. class:: django.views.generic.dates.DayMixin\n \n     A mixin that can be used to retrieve and provide parsing information for a\n@@ -127,6 +136,9 @@ Date-based mixins\n         Returns a date object containing the previous day. If\n         ``allow_empty = False``, returns the previous day that contained data.\n \n+WeekMixin\n+---------\n+\n .. class:: django.views.generic.dates.WeekMixin\n \n     A mixin that can be used to retrieve and provide parsing information for a\n@@ -161,6 +173,9 @@ Date-based mixins\n         Raises a 404 if no valid week specification can be found.\n \n \n+DateMixin\n+---------\n+\n .. class:: django.views.generic.dates.DateMixin\n \n     A mixin class providing common behavior for all date-based views.\n@@ -204,6 +219,9 @@ Date-based mixins\n         is greater than the current date/time. Returns\n         :attr:`DateMixin.allow_future` by default.\n \n+BaseDateListView\n+----------------\n+\n .. class:: django.views.generic.dates.BaseDateListView\n \n     A base class that provides common behavior for all date-based views. There"
        },
        {
            "sha": "95dd24f442e11317b91d4518f3b221a4ea092322",
            "filename": "docs/ref/class-based-views/mixins-editing.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-editing.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-editing.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,6 +14,9 @@ The following mixins are used to construct Django's editing views:\n     Examples of how these are combined into editing views can be found at\n     the documentation on ``Generic editing views``.\n \n+FormMixin\n+---------\n+\n .. class:: django.views.generic.edit.FormMixin\n \n     A mixin class that provides facilities for creating and displaying forms.\n@@ -90,6 +93,9 @@ The following mixins are used to construct Django's editing views:\n         :meth:`~django.views.generic.FormMixin.form_invalid`.\n \n \n+ModelFormMixin\n+--------------\n+\n .. class:: django.views.generic.edit.ModelFormMixin\n \n     A form mixin that works on ModelForms, rather than a standalone form.\n@@ -147,12 +153,16 @@ The following mixins are used to construct Django's editing views:\n     .. method:: form_invalid()\n \n         Renders a response, providing the invalid form as context.\n-            \n+\n+\n+ProcessFormView\n+---------------\n+\n .. class:: django.views.generic.edit.ProcessFormView\n \n     A mixin that provides basic HTTP GET and POST workflow.\n \n-    .. note:: \n+    .. note::\n \n         This is named 'ProcessFormView' and inherits directly from\n         :class:`django.views.generic.base.View`, but breaks if used"
        },
        {
            "sha": "8bc613b887971d1b01b304d5aa5eb882d8de6332",
            "filename": "docs/ref/class-based-views/mixins-multiple-object.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,6 +2,9 @@\n Multiple object mixins\n ======================\n \n+MultipleObjectMixin\n+-------------------\n+\n .. class:: django.views.generic.list.MultipleObjectMixin\n \n     A mixin that can be used to display a list of objects.\n@@ -148,6 +151,9 @@ Multiple object mixins\n       this context variable will be ``None``.\n \n \n+MultipleObjectTemplateResponseMixin\n+-----------------------------------\n+\n .. class:: django.views.generic.list.MultipleObjectTemplateResponseMixin\n \n     A mixin class that performs template-based response rendering for views"
        },
        {
            "sha": "61fc945cd3c4f5e2826c120dbaaaa28f85f656a2",
            "filename": "docs/ref/class-based-views/mixins-simple.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-simple.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-simple.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-simple.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,6 +2,9 @@\n Simple mixins\n =============\n \n+ContextMixin\n+------------\n+\n .. class:: django.views.generic.base.ContextMixin\n \n     .. versionadded:: 1.5\n@@ -14,8 +17,23 @@ Simple mixins\n \n     .. method:: get_context_data(**kwargs)\n \n-        Returns a dictionary representing the template context. The\n-        keyword arguments provided will make up the returned context.\n+        Returns a dictionary representing the template context. The keyword\n+        arguments provided will make up the returned context.\n+\n+        The template context of all class-based generic views include a\n+        ``view`` variable that points to the ``View`` instance.\n+\n+        .. admonition:: Use ``alters_data`` where appropriate\n+\n+            Note that having the view instance in the template context may\n+            expose potentially hazardous methods to template authors.  To\n+            prevent methods like this from being called in the template, set\n+            ``alters_data=True`` on those methods.  For more information, read\n+            the documentation on :ref:`rendering a template context\n+            <alters-data-description>`.\n+\n+TemplateResponseMixin\n+---------------------\n \n .. class:: django.views.generic.base.TemplateResponseMixin\n "
        },
        {
            "sha": "77f52b96c6ef9d155e104688b7793df8b1c2f00c",
            "filename": "docs/ref/class-based-views/mixins-single-object.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-single-object.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fclass-based-views%2Fmixins-single-object.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-single-object.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,6 +2,9 @@\n Single object mixins\n ====================\n \n+SingleObjectMixin\n+-----------------\n+\n .. class:: django.views.generic.detail.SingleObjectMixin\n \n     Provides a mechanism for looking up an object associated with the\n@@ -86,6 +89,9 @@ Single object mixins\n       ``context_object_name`` is specified, that variable will also be\n       set in the context, with the same value as ``object``.\n \n+SingleObjectTemplateResponseMixin\n+---------------------------------\n+\n .. class:: django.views.generic.detail.SingleObjectTemplateResponseMixin\n \n     A mixin class that performs template-based response rendering for views"
        },
        {
            "sha": "66a5a2cc4f2749bc7a7400923d3ae8129a1c381b",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -561,8 +561,6 @@ subclass::\n \n .. attribute:: ModelAdmin.list_filter\n \n-    .. versionchanged:: 1.4\n-\n     Set ``list_filter`` to activate filters in the right sidebar of the change\n     list page of the admin, as illustrated in the following screenshot:\n \n@@ -586,6 +584,8 @@ subclass::\n           class PersonAdmin(UserAdmin):\n               list_filter = ('company__name',)\n \n+    .. versionadded:: 1.4\n+\n     * a class inheriting from :mod:`django.contrib.admin.SimpleListFilter`,\n       which you need to provide the ``title`` and ``parameter_name``\n       attributes to and override the ``lookups`` and ``queryset`` methods,\n@@ -623,7 +623,7 @@ subclass::\n                    provided in the query string and retrievable via\n                    `self.value()`.\n                    \"\"\"\n-                   # Compare the requested value (either '80s' or 'other')\n+                   # Compare the requested value (either '80s' or '90s')\n                    # to decide how to filter the queryset.\n                    if self.value() == '80s':\n                        return queryset.filter(birthday__gte=date(1980, 1, 1),\n@@ -671,6 +671,8 @@ subclass::\n                                     birthday__lte=date(1999, 12, 31)).exists():\n                           yield ('90s', _('in the nineties'))\n \n+    .. versionadded:: 1.4\n+\n     * a tuple, where the first element is a field name and the second\n       element is a class inheriting from\n       :mod:`django.contrib.admin.FieldListFilter`, for example::"
        },
        {
            "sha": "4b1dd96280c053fba1e823b0b076c265915e1cd4",
            "filename": "docs/ref/contrib/comments/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -158,11 +158,13 @@ For example::\n \n .. warning::\n \n-    There's a known bug in Safari/Webkit which causes the named anchor to be\n+    There's a `known bug`_ in Safari/Webkit which causes the named anchor to be\n     forgotten following a redirect. The practical impact for comments is that\n     the Safari/webkit browsers will arrive at the correct page but will not\n     scroll to the named anchor.\n \n+.. _`known bug`: https://bugs.webkit.org/show_bug.cgi?id=24175\n+\n .. templatetag:: get_comment_count\n \n Counting comments"
        },
        {
            "sha": "8d352ff8b2772b9262a203094552bedb0060a9a6",
            "filename": "docs/ref/contrib/csrf.txt",
            "status": "modified",
            "additions": 104,
            "deletions": 43,
            "changes": 147,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcsrf.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -84,47 +84,94 @@ AJAX\n While the above method can be used for AJAX POST requests, it has some\n inconveniences: you have to remember to pass the CSRF token in as POST data with\n every POST request. For this reason, there is an alternative method: on each\n-XMLHttpRequest, set a custom `X-CSRFToken` header to the value of the CSRF\n+XMLHttpRequest, set a custom ``X-CSRFToken`` header to the value of the CSRF\n token. This is often easier, because many javascript frameworks provide hooks\n-that allow headers to be set on every request. In jQuery, you can use the\n-``ajaxSend`` event as follows:\n+that allow headers to be set on every request.\n+\n+As a first step, you must get the CSRF token itself. The recommended source for\n+the token is the ``csrftoken`` cookie, which will be set if you've enabled CSRF\n+protection for your views as outlined above.\n+\n+.. note::\n+\n+    The CSRF token cookie is named ``csrftoken`` by default, but you can control\n+    the cookie name via the :setting:`CSRF_COOKIE_NAME` setting.\n+\n+Acquiring the token is straightforward:\n \n .. code-block:: javascript\n \n-    jQuery(document).ajaxSend(function(event, xhr, settings) {\n-        function getCookie(name) {\n-            var cookieValue = null;\n-            if (document.cookie && document.cookie != '') {\n-                var cookies = document.cookie.split(';');\n-                for (var i = 0; i < cookies.length; i++) {\n-                    var cookie = jQuery.trim(cookies[i]);\n-                    // Does this cookie string begin with the name we want?\n-                    if (cookie.substring(0, name.length + 1) == (name + '=')) {\n-                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n-                        break;\n-                    }\n+    // using jQuery\n+    function getCookie(name) {\n+        var cookieValue = null;\n+        if (document.cookie && document.cookie != '') {\n+            var cookies = document.cookie.split(';');\n+            for (var i = 0; i < cookies.length; i++) {\n+                var cookie = jQuery.trim(cookies[i]);\n+                // Does this cookie string begin with the name we want?\n+                if (cookie.substring(0, name.length + 1) == (name + '=')) {\n+                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n+                    break;\n                 }\n             }\n-            return cookieValue;\n-        }\n-        function sameOrigin(url) {\n-            // url could be relative or scheme relative or absolute\n-            var host = document.location.host; // host + port\n-            var protocol = document.location.protocol;\n-            var sr_origin = '//' + host;\n-            var origin = protocol + sr_origin;\n-            // Allow absolute or scheme relative URLs to same origin\n-            return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||\n-                (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||\n-                // or any other URL that isn't scheme relative or absolute i.e relative.\n-                !(/^(\\/\\/|http:|https:).*/.test(url));\n-        }\n-        function safeMethod(method) {\n-            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\n         }\n+        return cookieValue;\n+    }\n+    var csrftoken = getCookie('csrftoken');\n+\n+The above code could be simplified by using the `jQuery cookie plugin\n+<http://plugins.jquery.com/project/Cookie>`_ to replace ``getCookie``:\n+\n+.. code-block:: javascript\n+\n+    var csrftoken = $.cookie('csrftoken');\n+\n+.. note::\n+\n+    The CSRF token is also present in the DOM, but only if explicitly included\n+    using :ttag:`csrf_token` in a template. The cookie contains the canonical\n+    token; the ``CsrfViewMiddleware`` will prefer the cookie to the token in\n+    the DOM. Regardless, you're guaranteed to have the cookie if the token is\n+    present in the DOM, so you should use the cookie!\n \n-        if (!safeMethod(settings.type) && sameOrigin(settings.url)) {\n-            xhr.setRequestHeader(\"X-CSRFToken\", getCookie('csrftoken'));\n+.. warning::\n+\n+    If your view is not rendering a template containing the :ttag:`csrf_token`\n+    template tag, Django might not set the CSRF token cookie. This is common in\n+    cases where forms are dynamically added to the page. To address this case,\n+    Django provides a view decorator which forces setting of the cookie:\n+    :func:`~django.views.decorators.csrf.ensure_csrf_cookie`.\n+\n+Finally, you'll have to actually set the header on your AJAX request, while\n+protecting the CSRF token from being sent to other domains.\n+\n+.. code-block:: javascript\n+\n+    function csrfSafeMethod(method) {\n+        // these HTTP methods do not require CSRF protection\n+        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\n+    }\n+    function sameOrigin(url) {\n+        // test that a given url is a same-origin URL\n+        // url could be relative or scheme relative or absolute\n+        var host = document.location.host; // host + port\n+        var protocol = document.location.protocol;\n+        var sr_origin = '//' + host;\n+        var origin = protocol + sr_origin;\n+        // Allow absolute or scheme relative URLs to same origin\n+        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||\n+            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||\n+            // or any other URL that isn't scheme relative or absolute i.e relative.\n+            !(/^(\\/\\/|http:|https:).*/.test(url));\n+    }\n+    $.ajaxSetup({\n+        beforeSend: function(xhr, settings) {\n+            if (!csrfSafeMethod(settings.type) && sameOrigin(settings.url)) {\n+                // Send the token to same-origin, relative URLs only.\n+                // Send the token only if the method warrants CSRF protection\n+                // Using the CSRFToken value acquired earlier\n+                xhr.setRequestHeader(\"X-CSRFToken\", csrftoken);\n+            }\n         }\n     });\n \n@@ -133,18 +180,32 @@ that allow headers to be set on every request. In jQuery, you can use the\n     Due to a bug introduced in jQuery 1.5, the example above will not work\n     correctly on that version. Make sure you are running at least jQuery 1.5.1.\n \n-Adding this to a javascript file that is included on your site will ensure that\n-AJAX POST requests that are made via jQuery will not be caught by the CSRF\n-protection.\n+You can use `settings.crossDomain <http://api.jquery.com/jQuery.ajax>`_ in\n+jQuery 1.5 and newer in order to replace the `sameOrigin` logic above:\n \n-The above code could be simplified by using the `jQuery cookie plugin\n-<http://plugins.jquery.com/project/Cookie>`_ to replace ``getCookie``, and\n-`settings.crossDomain <http://api.jquery.com/jQuery.ajax>`_ in jQuery 1.5 and\n-later to replace ``sameOrigin``.\n+.. code-block:: javascript\n+\n+    function csrfSafeMethod(method) {\n+        // these HTTP methods do not require CSRF protection\n+        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\n+    }\n+    $.ajaxSetup({\n+        crossDomain: false, // obviates need for sameOrigin test\n+        beforeSend: function(xhr, settings) {\n+            if (!csrfSafeMethod(settings.type)) {\n+                xhr.setRequestHeader(\"X-CSRFToken\", csrftoken);\n+            }\n+        }\n+    });\n+\n+.. note::\n+\n+    In a `security release blogpost`_, a simpler \"same origin test\" example\n+    was provided which only checked for a relative URL. The ``sameOrigin``\n+    test above supersedes that exampleit works for edge cases like\n+    scheme-relative or absolute URLs for the same domain.\n \n-In addition, if the CSRF cookie has not been sent to the client by use of\n-:ttag:`csrf_token`, you may need to ensure the client receives the cookie by\n-using :func:`~django.views.decorators.csrf.ensure_csrf_cookie`.\n+.. _security release blogpost: https://www.djangoproject.com/weblog/2011/feb/08/security/\n \n Other template engines\n ----------------------"
        },
        {
            "sha": "3de449708f822fd4db0c51d7d5ddac6a1cd1c7bc",
            "filename": "docs/ref/contrib/flatpages.txt",
            "status": "modified",
            "additions": 41,
            "deletions": 2,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fflatpages.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fflatpages.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fflatpages.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -42,6 +42,16 @@ To install the flatpages app, follow these steps:\n 2. Add ``'django.contrib.flatpages'`` to your :setting:`INSTALLED_APPS`\n    setting.\n \n+Then either:\n+\n+3. Add an entry in your URLconf. For example::\n+\n+    urlpatterns = patterns('',\n+        ('^pages/', include('django.contrib.flatpages.urls')),\n+    )\n+\n+or:\n+\n 3. Add ``'django.contrib.flatpages.middleware.FlatpageFallbackMiddleware'``\n    to your :setting:`MIDDLEWARE_CLASSES` setting.\n \n@@ -57,8 +67,38 @@ and ``django_flatpage_sites``. ``django_flatpage`` is a simple lookup table\n that simply maps a URL to a title and bunch of text content.\n ``django_flatpage_sites`` associates a flatpage with a site.\n \n+Using the URLconf\n+-----------------\n+\n+There are several ways to include the flat pages in your URLconf. You can\n+dedicate a particular path to flat pages::\n+\n+    urlpatterns = patterns('',\n+        ('^pages/', include('django.contrib.flatpages.urls')),\n+    )\n+\n+You can also set it up as a \"catchall\" pattern. In this case, it is important\n+to place the pattern at the end of the other urlpatterns::\n+\n+    # Your other patterns here\n+    urlpatterns += patterns('django.contrib.flatpages.views',\n+        (r'^(?P<url>.*)$', 'flatpage'),\n+    )\n+\n+Another common setup is to use flat pages for a limited set of known pages and\n+to hard code the urls, so you can reference them with the :ttag:`url` template\n+tag::\n+\n+    urlpatterns += patterns('django.contrib.flatpages.views',\n+        url(r'^about-us/$', 'flatpage', {'url': '/about-us/'}, name='about'),\n+        url(r'^license/$', 'flatpage', {'url': '/license/'}, name='license'),\n+    )\n+\n+Using the middleware\n+--------------------\n+\n The :class:`~django.contrib.flatpages.middleware.FlatpageFallbackMiddleware`\n-does all of the work.\n+can do all of the work.\n \n .. class:: FlatpageFallbackMiddleware\n \n@@ -255,4 +295,3 @@ For example:\n     {% get_flatpages '/about/' as about_pages %}\n     {% get_flatpages about_prefix as about_pages %}\n     {% get_flatpages '/about/' for someuser as about_pages %}\n-"
        },
        {
            "sha": "b8e585a4d2893bb1e38d7f005eec546793aa2aa3",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -86,8 +86,8 @@ the message itself. Here's what the :file:`forms.py` might look like::\n     section :ref:`Handling files <wizard-files>` below to learn more about\n     what to do.\n \n-Creating a ``WizardView`` class\n--------------------------------\n+Creating a ``WizardView`` subclass\n+----------------------------------\n \n The next step is to create a\n :class:`django.contrib.formtools.wizard.views.WizardView` subclass. You can\n@@ -528,7 +528,7 @@ We define our wizard in a ``views.py``::\n \n We need to add the ``ContactWizard`` to our ``urls.py`` file::\n \n-    from django.conf.urls import pattern\n+    from django.conf.urls import patterns\n \n     from myapp.forms import ContactForm1, ContactForm2\n     from myapp.views import ContactWizard, show_message_form_condition"
        },
        {
            "sha": "3e952c173b044021ee37e6d289b390e008380080",
            "filename": "docs/ref/contrib/gis/install.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 22,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -60,14 +60,14 @@ The geospatial libraries required for a GeoDjango installation depends\n on the spatial database used.  The following lists the library requirements,\n supported versions, and any notes for each of the supported database backends:\n \n-==================  ==============================  ==================  ==========================================================\n+==================  ==============================  ==================  =========================================\n Database            Library Requirements            Supported Versions  Notes\n-==================  ==============================  ==================  ==========================================================\n+==================  ==============================  ==================  =========================================\n PostgreSQL          GEOS, PROJ.4, PostGIS           8.1+                Requires PostGIS.\n MySQL               GEOS                            5.x                 Not OGC-compliant; limited functionality.\n Oracle              GEOS                            10.2, 11            XE not supported; not tested with 9.\n-SQLite              GEOS, GDAL, PROJ.4, SpatiaLite  3.6.+               Requires SpatiaLite 2.3+, pysqlite2 2.5+, and Django 1.1.\n-==================  ==============================  ==================  ==========================================================\n+SQLite              GEOS, GDAL, PROJ.4, SpatiaLite  3.6.+               Requires SpatiaLite 2.3+, pysqlite2 2.5+\n+==================  ==============================  ==================  =========================================\n \n .. _geospatial_libs:\n \n@@ -140,7 +140,7 @@ internal geometry representation used by GeoDjango (it's behind the \"lazy\"\n geometries).  Specifically, the C API library is called (e.g., ``libgeos_c.so``)\n directly from Python using ctypes.\n \n-First, download GEOS 3.2 from the refractions Web site and untar the source\n+First, download GEOS 3.3.0 from the refractions Web site and untar the source\n archive::\n \n     $ wget http://download.osgeo.org/geos/geos-3.3.0.tar.bz2\n@@ -421,7 +421,7 @@ After SQLite has been built with the R*Tree module enabled, get the latest\n SpatiaLite library source and tools bundle from the `download page`__::\n \n     $ wget http://www.gaia-gis.it/gaia-sins/libspatialite-sources/libspatialite-amalgamation-2.3.1.tar.gz\n-    $ wget http://www.gaia-gis.it/gaia-sins/libspatialite-sources/spatialite-tools-2.3.1.tar.gz\n+    $ wget http://www.gaia-gis.it/gaia-sins/spatialite-tools-sources/spatialite-tools-2.3.1.tar.gz\n     $ tar xzf libspatialite-amalgamation-2.3.1.tar.gz\n     $ tar xzf spatialite-tools-2.3.1.tar.gz\n \n@@ -467,8 +467,8 @@ pysqlite2\n ^^^^^^^^^\n \n Because SpatiaLite must be loaded as an external extension, it requires the\n-``enable_load_extension`` method, which is only available in versions 2.5+.\n-Thus, download pysqlite2 2.6, and untar::\n+``enable_load_extension`` method, which is only available in versions 2.5+ of\n+pysqlite2. Thus, download pysqlite2 2.6, and untar::\n \n     $ wget http://pysqlite.googlecode.com/files/pysqlite-2.6.0.tar.gz\n     $ tar xzf pysqlite-2.6.0.tar.gz\n@@ -582,8 +582,8 @@ Creating a spatial database for SpatiaLite\n After you've installed SpatiaLite, you'll need to create a number of spatial\n metadata tables in your database in order to perform spatial queries.\n \n-If you're using SpatiaLite 3.0 or newer, use the ``spatialite`` utility to\n-call the ``InitSpatiaMetaData()`` function, like this::\n+If you're using SpatiaLite 2.4 or newer, use the ``spatialite`` utility to\n+call the ``InitSpatialMetaData()`` function, like this::\n \n    $ spatialite geodjango.db \"SELECT InitSpatialMetaData();\"\n    the SPATIAL_REF_SYS table already contains some row(s)\n@@ -593,26 +593,26 @@ call the ``InitSpatiaMetaData()`` function, like this::\n You can safely ignore the error messages shown. When you've done this, you can\n skip the rest of this section.\n \n-If you're using a version of SpatiaLite older than 3.0, you'll need to download\n-a database-initialization file and execute its SQL queries in your database.\n+If you're using SpatiaLite 2.3, you'll need to download a\n+database-initialization file and execute its SQL queries in your database.\n \n-First, get it from the appropriate SpatiaLite Resources page (\n-http://www.gaia-gis.it/spatialite-2.3.1/resources.html for 2.3 or\n-http://www.gaia-gis.it/spatialite-2.4.0/ for 2.4)::\n+First, get it from the `SpatiaLite Resources`__ page::\n \n    $ wget http://www.gaia-gis.it/spatialite-2.3.1/init_spatialite-2.3.sql.gz\n    $ gunzip init_spatialite-2.3.sql.gz\n \n Then, use the ``spatialite`` command to initialize a spatial database::\n \n-   $ spatialite geodjango.db < init_spatialite-2.X.sql\n+   $ spatialite geodjango.db < init_spatialite-2.3.sql\n \n .. note::\n \n     The parameter ``geodjango.db`` is the *filename* of the SQLite database\n     you want to use.  Use the same in the :setting:`DATABASES` ``\"name\"`` key\n     inside your ``settings.py``.\n \n+__ http://www.gaia-gis.it/spatialite-2.3.1/resources.html\n+\n Add ``django.contrib.gis`` to :setting:`INSTALLED_APPS`\n -------------------------------------------------------\n \n@@ -643,10 +643,6 @@ Invoke the Django shell from your project and execute the\n     >>> from django.contrib.gis.utils import add_srs_entry\n     >>> add_srs_entry(900913)\n \n-.. note::\n-\n-    In Django 1.1 the name of this function is ``add_postgis_srs``.\n-\n This adds an entry for the 900913 SRID to the ``spatial_ref_sys`` (or equivalent)\n table, making it possible for the spatial database to transform coordinates in\n this projection.  You only need to execute this command *once* per spatial database.\n@@ -824,8 +820,10 @@ Download the framework packages for:\n * GDAL\n \n Install the packages in the order they are listed above, as the GDAL and SQLite\n-packages require the packages listed before them.  Afterwards, you can also\n-install the KyngChaos binary packages for `PostgreSQL and PostGIS`__.\n+packages require the packages listed before them.\n+\n+Afterwards, you can also install the KyngChaos binary packages for `PostgreSQL\n+and PostGIS`__.\n \n After installing the binary packages, you'll want to add the following to\n your ``.profile`` to be able to run the package programs from the command-line::"
        },
        {
            "sha": "d12c884a1b75f474a7fed306e3f95aad611511f3",
            "filename": "docs/ref/contrib/gis/testing.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -119,9 +119,10 @@ Settings\n ``SPATIALITE_SQL``\n ^^^^^^^^^^^^^^^^^^\n \n-Only relevant when using a SpatiaLite version older than 3.0.\n+Only relevant when using a SpatiaLite version 2.3.\n \n-By default, the GeoDjango test runner looks for the SpatiaLite SQL in the\n+By default, the GeoDjango test runner looks for the :ref:`file containing the\n+SpatiaLite dababase-initialization SQL code <create_spatialite_db>` in the\n same directory where it was invoked (by default the same directory where\n ``manage.py`` is located). To use a different location, add the following to\n your settings::"
        },
        {
            "sha": "15863aee7b6dd461eebded22c7e68e42d1de5c85",
            "filename": "docs/ref/contrib/gis/tutorial.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -671,6 +671,17 @@ of abstraction::\n \n __ http://spatialreference.org/ref/epsg/32140/\n \n+.. admonition:: Raw queries\n+\n+    When using :doc:`raw queries </topics/db/sql>`, you should generally wrap\n+    your geometry fields with the ``asText()`` SQL function so as the field\n+    value will be recognized by GEOS::\n+\n+        City.objects.raw('SELECT id, name, asText(point) from myapp_city')\n+\n+    This is not absolutely required by PostGIS, but generally you should only\n+    use raw queries when you know exactly what you are doing.\n+\n Lazy Geometries\n ---------------\n Geometries come to GeoDjango in a standardized textual representation.  Upon"
        },
        {
            "sha": "3e256e9d9e2e62726b16b1de2651da43dc643ab8",
            "filename": "docs/ref/databases.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fdatabases.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fdatabases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdatabases.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -56,10 +56,10 @@ will do some additional queries to set these parameters.\n Transaction handling\n ---------------------\n \n-:doc:`By default </topics/db/transactions>`, Django starts a transaction when a\n-database connection is first used and commits the result at the end of the\n-request/response handling. The PostgreSQL backends normally operate the same\n-as any other Django backend in this respect.\n+:doc:`By default </topics/db/transactions>`, Django runs with an open\n+transaction which it commits automatically when any built-in, data-altering\n+model function is called. The PostgreSQL backends normally operate the same as\n+any other Django backend in this respect.\n \n .. _postgresql-autocommit-mode:\n "
        },
        {
            "sha": "ada614df45781965af3972627222aea76c49c0f0",
            "filename": "docs/ref/files/file.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Ffiles%2Ffile.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Ffiles%2Ffile.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ffiles%2Ffile.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -91,14 +91,18 @@ The ``ContentFile`` Class\n .. class:: ContentFile(File)\n \n     The ``ContentFile`` class inherits from :class:`~django.core.files.File`,\n-    but unlike :class:`~django.core.files.File` it operates on string content,\n-    rather than an actual file. For example::\n+    but unlike :class:`~django.core.files.File` it operates on string content\n+    (bytes also supported), rather than an actual file. For example::\n \n         from __future__ import unicode_literals\n         from django.core.files.base import ContentFile\n \n-        f1 = ContentFile(b\"my string content\")\n-        f2 = ContentFile(\"my unicode content encoded as UTF-8\".encode('UTF-8'))\n+        f1 = ContentFile(\"esta sentencia est en espaol\")\n+        f2 = ContentFile(b\"these are bytes\")\n+\n+    .. versionchanged:: 1.5\n+\n+        ContentFile also accepts Unicode strings.\n \n .. currentmodule:: django.core.files.images\n "
        },
        {
            "sha": "275c696230f8c2f9335e77f6e413ce0c95d6018b",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 46,
            "deletions": 46,
            "changes": 92,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -70,8 +70,8 @@ If ``True``, the field is allowed to be blank. Default is ``False``.\n \n Note that this is different than :attr:`~Field.null`. :attr:`~Field.null` is\n purely database-related, whereas :attr:`~Field.blank` is validation-related. If\n-a field has ``blank=True``, validation on Django's admin site will allow entry\n-of an empty value. If a field has ``blank=False``, the field will be required.\n+a field has ``blank=True``, form validation will allow entry of an empty value.\n+If a field has ``blank=False``, the field will be required.\n \n .. _field-choices:\n \n@@ -81,14 +81,11 @@ of an empty value. If a field has ``blank=False``, the field will be required.\n .. attribute:: Field.choices\n \n An iterable (e.g., a list or tuple) of 2-tuples to use as choices for this\n-field.\n+field. If this is given, the default form widget will be a select box with\n+these choices instead of the standard text field.\n \n-If this is given, Django's admin will use a select box instead of the standard\n-text field and will limit choices to the choices given.\n-\n-A choices list is an iterable of 2-tuples; the first element in each\n-tuple is the actual value to be stored, and the second element is the\n-human-readable name. For example::\n+The first element in each tuple is the actual value to be stored, and the\n+second element is the human-readable name. For example::\n \n     YEAR_IN_SCHOOL_CHOICES = (\n         ('FR', 'Freshman'),\n@@ -176,7 +173,7 @@ scenes.\n \n .. attribute:: Field.db_index\n \n-If ``True``, djadmin:`django-admin.py sqlindexes <sqlindexes>` will output a\n+If ``True``, :djadmin:`django-admin.py sqlindexes <sqlindexes>` will output a\n ``CREATE INDEX`` statement for this field.\n \n ``db_tablespace``\n@@ -203,8 +200,8 @@ callable it will be called every time a new object is created.\n \n .. attribute:: Field.editable\n \n-If ``False``, the field will not be editable in the admin or via forms\n-automatically generated from the model class. Default is ``True``.\n+If ``False``, the field will not be displayed in the admin or any other\n+:class:`~django.forms.ModelForm`. Default is ``True``.\n \n ``error_messages``\n ------------------\n@@ -224,11 +221,11 @@ the `Field types`_ section below.\n \n .. attribute:: Field.help_text\n \n-Extra \"help\" text to be displayed under the field on the object's admin form.\n-It's useful for documentation even if your object doesn't have an admin form.\n+Extra \"help\" text to be displayed with the form widget. It's useful for\n+documentation even if your field isn't used on a form.\n \n-Note that this value is *not* HTML-escaped when it's displayed in the admin\n-interface. This lets you include HTML in :attr:`~Field.help_text` if you so\n+Note that this value is *not* HTML-escaped in automatically-generated\n+forms. This lets you include HTML in :attr:`~Field.help_text` if you so\n desire. For example::\n \n     help_text=\"Please use the following format: <em>YYYY-MM-DD</em>.\"\n@@ -259,7 +256,7 @@ Only one primary key is allowed on an object.\n \n If ``True``, this field must be unique throughout the table.\n \n-This is enforced at the database level and at the Django admin-form level. If\n+This is enforced at the database level and by model validation. If\n you try to save a model with a duplicate value in a :attr:`~Field.unique`\n field, a :exc:`django.db.IntegrityError` will be raised by the model's\n :meth:`~django.db.models.Model.save` method.\n@@ -279,7 +276,7 @@ For example, if you have a field ``title`` that has\n ``unique_for_date=\"pub_date\"``, then Django wouldn't allow the entry of two\n records with the same ``title`` and ``pub_date``.\n \n-This is enforced at the Django admin-form level but not at the database level.\n+This is enforced by model validation but not at the database level.\n \n ``unique_for_month``\n --------------------\n@@ -337,7 +334,7 @@ otherwise. See :ref:`automatic-primary-key-fields`.\n \n A 64 bit integer, much like an :class:`IntegerField` except that it is\n guaranteed to fit numbers from -9223372036854775808 to 9223372036854775807. The\n-admin represents this as an ``<input type=\"text\">`` (a single-line input).\n+default form widget for this field is a :class:`~django.forms.TextInput`.\n \n \n ``BooleanField``\n@@ -347,7 +344,8 @@ admin represents this as an ``<input type=\"text\">`` (a single-line input).\n \n A true/false field.\n \n-The admin represents this as a checkbox.\n+The default form widget for this field is a\n+:class:`~django.forms.CheckboxInput`.\n \n If you need to accept :attr:`~Field.null` values then use\n :class:`NullBooleanField` instead.\n@@ -361,7 +359,7 @@ A string field, for small- to large-sized strings.\n \n For large amounts of text, use :class:`~django.db.models.TextField`.\n \n-The admin represents this as an ``<input type=\"text\">`` (a single-line input).\n+The default form widget for this field is a :class:`~django.forms.TextInput`.\n \n :class:`CharField` has one extra required argument:\n \n@@ -414,9 +412,10 @@ optional arguments:\n     for creation of timestamps. Note that the current date is *always* used;\n     it's not just a default value that you can override.\n \n-The admin represents this as an ``<input type=\"text\">`` with a JavaScript\n-calendar, and a shortcut for \"Today\". Includes an additional ``invalid_date``\n-error message key.\n+The default form widget for this field is a\n+:class:`~django.forms.TextInput`. The admin adds a JavaScript calendar,\n+and a shortcut for \"Today\". Includes an additional ``invalid_date`` error\n+message key.\n \n .. note::\n     As currently implemented, setting ``auto_now`` or ``auto_now_add`` to\n@@ -431,8 +430,9 @@ error message key.\n A date and time, represented in Python by a ``datetime.datetime`` instance.\n Takes the same extra arguments as :class:`DateField`.\n \n-The admin represents this as two ``<input type=\"text\">`` fields, with\n-JavaScript shortcuts.\n+The default form widget for this field is a single\n+:class:`~django.forms.TextInput`. The admin uses two separate\n+:class:`~django.forms.TextInput` widgets with JavaScript shortcuts.\n \n ``DecimalField``\n ----------------\n@@ -461,7 +461,7 @@ decimal places::\n \n     models.DecimalField(..., max_digits=19, decimal_places=10)\n \n-The admin represents this as an ``<input type=\"text\">`` (a single-line input).\n+The default form widget for this field is a :class:`~django.forms.TextInput`.\n \n .. note::\n \n@@ -539,8 +539,8 @@ Also has one optional argument:\n     Optional. A storage object, which handles the storage and retrieval of your\n     files. See :doc:`/topics/files` for details on how to provide this object.\n \n-The admin represents this field as an ``<input type=\"file\">`` (a file-upload\n-widget).\n+The default form widget for this field is a\n+:class:`~django.forms.widgets.FileInput`.\n \n Using a :class:`FileField` or an :class:`ImageField` (see below) in a model\n takes a few steps:\n@@ -725,7 +725,7 @@ can change the maximum length using the :attr:`~CharField.max_length` argument.\n \n A floating-point number represented in Python by a ``float`` instance.\n \n-The admin represents this as an ``<input type=\"text\">`` (a single-line input).\n+The default form widget for this field is a :class:`~django.forms.TextInput`.\n \n .. _floatfield_vs_decimalfield:\n \n@@ -776,16 +776,16 @@ length using the :attr:`~CharField.max_length` argument.\n \n .. class:: IntegerField([**options])\n \n-An integer. The admin represents this as an ``<input type=\"text\">`` (a\n-single-line input).\n+An integer. The default form widget for this field is a\n+:class:`~django.forms.TextInput`.\n \n ``IPAddressField``\n ------------------\n \n .. class:: IPAddressField([**options])\n \n-An IP address, in string format (e.g. \"192.0.2.30\"). The admin represents this\n-as an ``<input type=\"text\">`` (a single-line input).\n+An IP address, in string format (e.g. \"192.0.2.30\"). The default form widget\n+for this field is a :class:`~django.forms.TextInput`.\n \n ``GenericIPAddressField``\n -------------------------\n@@ -795,8 +795,8 @@ as an ``<input type=\"text\">`` (a single-line input).\n .. versionadded:: 1.4\n \n An IPv4 or IPv6 address, in string format (e.g. ``192.0.2.30`` or\n-``2a02:42fe::4``). The admin represents this as an ``<input type=\"text\">``\n-(a single-line input).\n+``2a02:42fe::4``). The default form widget for this field is a\n+:class:`~django.forms.TextInput`.\n \n The IPv6 address normalization follows :rfc:`4291#section-2.2` section 2.2,\n including using the IPv4 format suggested in paragraph 3 of that section, like\n@@ -823,8 +823,8 @@ are converted to lowercase.\n .. class:: NullBooleanField([**options])\n \n Like a :class:`BooleanField`, but allows ``NULL`` as one of the options. Use\n-this instead of a :class:`BooleanField` with ``null=True``. The admin represents\n-this as a ``<select>`` box with \"Unknown\", \"Yes\" and \"No\" choices.\n+this instead of a :class:`BooleanField` with ``null=True``. The default form\n+widget for this field is a :class:`~django.forms.NullBooleanSelect`.\n \n ``PositiveIntegerField``\n ------------------------\n@@ -875,8 +875,8 @@ Like an :class:`IntegerField`, but only allows values under a certain\n \n .. class:: TextField([**options])\n \n-A large text field. The admin represents this as a ``<textarea>`` (a multi-line\n-input).\n+A large text field. The default form widget for this field is a\n+:class:`~django.forms.Textarea`.\n \n .. admonition:: MySQL users\n \n@@ -893,8 +893,8 @@ input).\n A time, represented in Python by a ``datetime.time`` instance. Accepts the same\n auto-population options as :class:`DateField`.\n \n-The admin represents this as an ``<input type=\"text\">`` with some JavaScript\n-shortcuts.\n+The default form widget for this field is a :class:`~django.forms.TextInput`.\n+The admin adds some JavaScript shortcuts.\n \n ``URLField``\n ------------\n@@ -903,7 +903,7 @@ shortcuts.\n \n A :class:`CharField` for a URL.\n \n-The admin represents this as an ``<input type=\"text\">`` (a single-line input).\n+The default form widget for this field is a :class:`~django.forms.TextInput`.\n \n Like all :class:`CharField` subclasses, :class:`URLField` takes the optional\n :attr:`~CharField.max_length`argument. If you don't specify\n@@ -979,9 +979,9 @@ define the details of how the relation works.\n .. attribute:: ForeignKey.limit_choices_to\n \n     A dictionary of lookup arguments and values (see :doc:`/topics/db/queries`)\n-    that limit the available admin choices for this object. Use this with\n-    functions from the Python ``datetime`` module to limit choices of objects by\n-    date. For example::\n+    that limit the available admin or ModelForm choices for this object. Use\n+    this with functions from the Python ``datetime`` module to limit choices of\n+    objects by date. For example::\n \n         limit_choices_to = {'pub_date__lte': datetime.now}\n "
        },
        {
            "sha": "472ac964578f807b4a723f077dd9452ec2d10893",
            "filename": "docs/ref/models/instances.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fmodels%2Finstances.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fmodels%2Finstances.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Finstances.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -48,7 +48,7 @@ that, you need to :meth:`~Model.save()`.\n     2. Add a method on a custom manager (usually preferred)::\n \n         class BookManager(models.Manager):\n-            def create_book(title):\n+            def create_book(self, title):\n                 book = self.create(title=title)\n                 # do something with the book\n                 return book\n@@ -386,6 +386,12 @@ perform an update on all fields.\n \n Specifying ``update_fields`` will force an update.\n \n+When saving a model fetched through deferred model loading\n+(:meth:`~Model.only()` or :meth:`~Model.defer()`) only the fields loaded from\n+the DB will get updated. In effect there is an automatic ``update_fields`` in\n+this case. If you assign or change any deferred field value, these fields will\n+be added to the updated fields.\n+\n Deleting objects\n ================\n \n@@ -453,9 +459,9 @@ using ``__str__()`` like this::\n         last_name = models.CharField(max_length=50)\n \n         def __str__(self):\n-            # Note use of django.utils.encoding.smart_bytes() here because\n+            # Note use of django.utils.encoding.force_bytes() here because\n             # first_name and last_name will be unicode strings.\n-            return smart_bytes('%s %s' % (self.first_name, self.last_name))\n+            return force_bytes('%s %s' % (self.first_name, self.last_name))\n \n ``get_absolute_url``\n --------------------"
        },
        {
            "sha": "b59b2ece82f3710ad1de2f5d10654b8419cf240a",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1110,6 +1110,14 @@ one, doing so will result in an error.\n     reader, is slightly faster and consumes a little less memory in the Python\n     process.\n \n+.. versionchanged:: 1.5\n+\n+.. note::\n+\n+    When calling :meth:`~Model.save()` for instances with deferred fields,\n+    only the loaded fields will be saved. See :meth:`~Model.save()` for more\n+    details.\n+\n \n only\n ~~~~\n@@ -1154,6 +1162,14 @@ All of the cautions in the note for the :meth:`defer` documentation apply to\n options. Also note that using :meth:`only` and omitting a field requested\n using :meth:`select_related` is an error as well.\n \n+.. versionchanged:: 1.5\n+\n+.. note::\n+\n+    When calling :meth:`~Model.save()` for instances with deferred fields,\n+    only the loaded fields will be saved. See :meth:`~Model.save()` for more\n+    details.\n+\n using\n ~~~~~\n "
        },
        {
            "sha": "21e99de10d93765d80319eb8e9a41fdba10cd54b",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -731,10 +731,11 @@ types of HTTP responses. Like ``HttpResponse``, these subclasses live in\n \n .. class:: HttpResponseRedirect\n \n-    The constructor takes a single argument -- the path to redirect to. This\n-    can be a fully qualified URL (e.g. ``'http://www.yahoo.com/search/'``) or\n-    an absolute path with no domain (e.g. ``'/search/'``). Note that this\n-    returns an HTTP status code 302.\n+    The first argument to the constructor is required -- the path to redirect\n+    to. This can be a fully qualified URL\n+    (e.g. ``'http://www.yahoo.com/search/'``) or an absolute path with no\n+    domain (e.g. ``'/search/'``). See :class:`HttpResponse` for other optional\n+    constructor arguments. Note that this returns an HTTP status code 302.\n \n .. class:: HttpResponsePermanentRedirect\n \n@@ -743,8 +744,9 @@ types of HTTP responses. Like ``HttpResponse``, these subclasses live in\n \n .. class:: HttpResponseNotModified\n \n-    The constructor doesn't take any arguments. Use this to designate that a\n-    page hasn't been modified since the user's last request (status code 304).\n+    The constructor doesn't take any arguments and no content should be added\n+    to this response. Use this to designate that a page hasn't been modified\n+    since the user's last request (status code 304).\n \n .. class:: HttpResponseBadRequest\n \n@@ -760,8 +762,9 @@ types of HTTP responses. Like ``HttpResponse``, these subclasses live in\n \n .. class:: HttpResponseNotAllowed\n \n-    Like :class:`HttpResponse`, but uses a 405 status code. Takes a single,\n-    required argument: a list of permitted methods (e.g. ``['GET', 'POST']``).\n+    Like :class:`HttpResponse`, but uses a 405 status code. The first argument\n+    to the constructor is required: a list of permitted methods (e.g.\n+    ``['GET', 'POST']``).\n \n .. class:: HttpResponseGone\n "
        },
        {
            "sha": "4729a2b6f19e9833a1690c0771383ee9d3a5b590",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 28,
            "deletions": 13,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -183,7 +183,7 @@ compose a prefix, version and key into a final cache key. The default\n implementation is equivalent to the function::\n \n     def make_key(key, key_prefix, version):\n-        return ':'.join([key_prefix, str(version), smart_bytes(key)])\n+        return ':'.join([key_prefix, str(version), key])\n \n You may use any key function you want, as long as it has the same\n argument signature.\n@@ -747,14 +747,15 @@ Did you catch that? NEVER deploy a site into production with :setting:`DEBUG`\n turned on.\n \n One of the main features of debug mode is the display of detailed error pages.\n-If your app raises an exception when ``DEBUG`` is ``True``, Django will display\n-a detailed traceback, including a lot of metadata about your environment, such\n-as all the currently defined Django settings (from ``settings.py``).\n+If your app raises an exception when :setting:`DEBUG` is ``True``, Django will\n+display a detailed traceback, including a lot of metadata about your\n+environment, such as all the currently defined Django settings (from\n+``settings.py``).\n \n As a security measure, Django will *not* include settings that might be\n-sensitive (or offensive), such as ``SECRET_KEY`` or ``PROFANITIES_LIST``.\n-Specifically, it will exclude any setting whose name includes any of the\n-following:\n+sensitive (or offensive), such as :setting:`SECRET_KEY` or\n+:setting:`PROFANITIES_LIST`. Specifically, it will exclude any setting whose\n+name includes any of the following:\n \n     * API\n     * KEY\n@@ -1356,7 +1357,7 @@ MANAGERS\n Default: ``()`` (Empty tuple)\n \n A tuple in the same format as :setting:`ADMINS` that specifies who should get\n-broken-link notifications when ``SEND_BROKEN_LINK_EMAILS=True``.\n+broken-link notifications when :setting:`SEND_BROKEN_LINK_EMAILS` is ``True``.\n \n .. setting:: MEDIA_ROOT\n \n@@ -1365,8 +1366,8 @@ MEDIA_ROOT\n \n Default: ``''`` (Empty string)\n \n-Absolute path to the directory that holds media for this installation, used\n-for :doc:`managing stored files </topics/files>`.\n+Absolute filesystem path to the directory that will hold :doc:`user-uploaded\n+files </topics/files>`.\n \n Example: ``\"/var/www/example.com/media/\"``\n \n@@ -1537,9 +1538,23 @@ SECRET_KEY\n \n Default: ``''`` (Empty string)\n \n-A secret key for this particular Django installation. Used to provide a seed in\n-secret-key hashing algorithms. Set this to a random string -- the longer, the\n-better. ``django-admin.py startproject`` creates one automatically.\n+A secret key for a particular Django installation. This is used to provide\n+:doc:`cryptographic signing </topics/signing>`, and should be set to a unique,\n+unpredictable value.\n+\n+:djadmin:`django-admin.py startproject <startproject>` automatically adds a\n+randomly-generated ``SECRET_KEY`` to each new project.\n+\n+.. warning::\n+\n+    **Keep this value secret.**\n+\n+    Running Django with a known :setting:`SECRET_KEY` defeats many of Django's\n+    security protections, and can lead to privilege escalation and remote code\n+    execution vulnerabilities.\n+\n+.. versionchanged:: 1.5\n+    Django will now refuse to start if :setting:`SECRET_KEY` is not set.\n \n .. setting:: SECURE_PROXY_SSL_HEADER\n "
        },
        {
            "sha": "48bd34678803884282136bc1296c2135450ba47b",
            "filename": "docs/ref/templates/api.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Ftemplates%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Ftemplates%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fapi.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -125,6 +125,10 @@ dot in a variable name, it tries the following lookups, in this order:\n * Attribute lookup. Example: ``foo.bar``\n * List-index lookup. Example: ``foo[bar]``\n \n+Note that \"bar\" in a template expression like ``{{ foo.bar }}`` will be\n+interpreted as a literal string and not using the value of the variable \"bar\",\n+if one exists in the template context.\n+\n The template system uses the first lookup type that works. It's short-circuit\n logic. Here are a few examples::\n \n@@ -198,6 +202,8 @@ straight lookups. Here are some things to keep in mind:\n * A variable can only be called if it has no required arguments. Otherwise,\n   the system will return an empty string.\n \n+.. _alters-data-description:\n+\n * Obviously, there can be side effects when calling some variables, and\n   it'd be either foolish or a security hole to allow the template system\n   to access them.\n@@ -422,6 +428,10 @@ optional, third positional argument, ``processors``. In this example, the\n                                       my_data_dictionary,\n                                       context_instance=RequestContext(request))\n \n+    Alternatively, use the :meth:`~django.shortcuts.render()` shortcut which is\n+    the same as a call to :func:`~django.shortcuts.render_to_response()` with a\n+    context_instance argument that forces the use of a ``RequestContext``.\n+\n Here's what each of the default processors does:\n \n django.contrib.auth.context_processors.auth"
        },
        {
            "sha": "de19578cac3fe8e93540db46e852d1bc35e34382",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 87,
            "deletions": 5,
            "changes": 92,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -187,6 +187,14 @@ The functions defined in this module share the following properties:\n     Useful as a mix-in. If you support Python 2 and 3 with a single code base,\n     you can inherit this mix-in and just define ``__unicode__``.\n \n+.. function:: python_2_unicode_compatible\n+\n+    A decorator that defines ``__unicode__`` and ``__str__`` methods under\n+    Python 2. Under Python 3 it does nothing.\n+\n+    To support Python 2 and 3 with a single code base, define a ``__str__``\n+    method returning text and apply this decorator to the class.\n+\n .. function:: smart_text(s, encoding='utf-8', strings_only=False, errors='strict')\n \n     .. versionadded:: 1.5\n@@ -232,14 +240,29 @@ The functions defined in this module share the following properties:\n     If ``strings_only`` is ``True``, don't convert (some) non-string-like\n     objects.\n \n+.. function:: force_bytes(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    .. versionadded:: 1.5\n+\n+    Similar to ``smart_bytes``, except that lazy instances are resolved to\n+    bytestrings, rather than kept as lazy objects.\n+\n+    If ``strings_only`` is ``True``, don't convert (some) non-string-like\n+    objects.\n+\n .. function:: smart_str(s, encoding='utf-8', strings_only=False, errors='strict')\n \n     Alias of :func:`smart_bytes` on Python 2 and :func:`smart_text` on Python\n-    3. This function always returns a :class:`str`.\n+    3. This function returns a :class:`str` or a lazy string.\n \n     For instance, this is  suitable for writing to :attr:`sys.stdout` on\n     Python 2 and 3.\n \n+.. function:: force_str(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    Alias of :func:`force_bytes` on Python 2 and :func:`force_text` on Python\n+    3. This function always returns a :class:`str`.\n+\n .. function:: iri_to_uri(iri)\n \n     Convert an Internationalized Resource Identifier (IRI) portion to a URI\n@@ -478,6 +501,33 @@ escaping HTML.\n     through :func:`conditional_escape` which (ultimately) calls\n     :func:`~django.utils.encoding.force_text` on the values.\n \n+.. function:: strip_tags(value)\n+\n+    Removes anything that looks like an html tag from the string, that is\n+    anything contained within ``<>``.\n+\n+    For example::\n+\n+        strip_tags(value)\n+\n+    If ``value`` is ``\"<b>Joel</b> <button>is</button> a <span>slug</span>\"`` the\n+    return value will be ``\"Joel is a slug\"``.\n+\n+.. function:: remove_tags(value, tags)\n+\n+    Removes a list of [X]HTML tag names from the output.\n+\n+    For example::\n+\n+        remove_tags(value, [\"b\", \"span\"])\n+\n+    If ``value`` is ``\"<b>Joel</b> <button>is</button> a <span>slug</span>\"`` the\n+    return value will be ``\"Joel <button>is</button> a slug\"``.\n+\n+    Note that this filter is case-sensitive.\n+\n+    If ``value`` is ``\"<B>Joel</B> <button>is</button> a <span>slug</span>\"`` the\n+    return value will be ``\"<B>Joel</B> <button>is</button> a slug\"``.\n \n .. _str.format: http://docs.python.org/library/stdtypes.html#str.format\n \n@@ -552,15 +602,29 @@ string\" means that the producer of the string has already turned characters\n that should not be interpreted by the HTML engine (e.g. '<') into the\n appropriate entities.\n \n+.. class:: SafeBytes\n+\n+    .. versionadded:: 1.5\n+\n+    A :class:`bytes` subclass that has been specifically marked as \"safe\"\n+    (requires no further escaping) for HTML output purposes.\n+\n .. class:: SafeString\n \n-    A string subclass that has been specifically marked as \"safe\" (requires no\n-    further escaping) for HTML output purposes.\n+    A :class:`str` subclass that has been specifically marked as \"safe\"\n+    (requires no further escaping) for HTML output purposes. This is\n+    :class:`SafeBytes` on Python 2 and :class:`SafeText` on Python 3.\n+\n+.. class:: SafeText\n+\n+    .. versionadded:: 1.5\n+\n+    A :class:`str` (in Python 3) or :class:`unicode` (in Python 2) subclass\n+    that has been specifically marked as \"safe\" for HTML output purposes.\n \n .. class:: SafeUnicode\n \n-    A unicode subclass that has been specifically marked as \"safe\" for HTML\n-    output purposes.\n+    Historical name of :class:`SafeText`. Only available under Python 2.\n \n .. function:: mark_safe(s)\n \n@@ -577,6 +641,24 @@ appropriate entities.\n     Can be called multiple times on a single string (the resulting escaping is\n     only applied once).\n \n+``django.utils.text``\n+=====================\n+\n+.. module:: django.utils.text\n+    :synopsis: Text manipulation.\n+\n+.. function:: slugify\n+\n+    Converts to lowercase, removes non-word characters (alphanumerics and\n+    underscores) and converts spaces to hyphens. Also strips leading and trailing\n+    whitespace.\n+\n+    For example::\n+\n+        slugify(value)\n+\n+    If ``value`` is ``\"Joel is a slug\"``, the output will be ``\"joel-is-a-slug\"``.\n+\n ``django.utils.translation``\n ============================\n "
        },
        {
            "sha": "16e00f9732692fca701606549a03db5d68d9cc0b",
            "filename": "docs/releases/1.3.2.txt",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.3.2.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.3.2.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3.2.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,14 @@\n+==========================\n+Django 1.3.2 release notes\n+==========================\n+\n+*July 30, 2012*\n+\n+This is the second security release in the Django 1.3 series, fixing several\n+security issues in Django 1.3. Django 1.3.2 is a recommended upgrade for\n+all users of Django 1.3.\n+\n+For a full list of issues addressed in this release, see the `security\n+advisory`_.\n+\n+.. _security advisory: https://www.djangoproject.com/weblog/2012/jul/30/security-releases-issued/"
        },
        {
            "sha": "7c6568e5b574353712745b8895ff03b485316835",
            "filename": "docs/releases/1.4.1.txt",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.4.1.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.4.1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.1.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,14 @@\n+==========================\n+Django 1.4.1 release notes\n+==========================\n+\n+*July 30, 2012*\n+\n+This is the first security release in the Django 1.4 series, fixing several\n+security issues in Django 1.4. Django 1.4.1 is a recommended upgrade for\n+all users of Django 1.4.\n+\n+For a full list of issues addressed in this release, see the `security\n+advisory`_.\n+\n+.. _security advisory: https://www.djangoproject.com/weblog/2012/jul/30/security-releases-issued/"
        },
        {
            "sha": "6f2e9aca2e31f9bb9dcbeb18adc67c021e7318fd",
            "filename": "docs/releases/1.4.2.txt",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.4.2.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.4.2.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.2.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,14 @@\n+==========================\n+Django 1.4.2 release notes\n+==========================\n+\n+*TO BE RELEASED*\n+\n+This is the second security release in the Django 1.4 series.\n+\n+Backwards incompatible changes\n+==============================\n+\n+* The newly introduced :class:`~django.db.models.GenericIPAddressField`\n+  constructor arguments have been adapted to match those of all other model\n+  fields. The first two keyword arguments are now verbose_name and name."
        },
        {
            "sha": "5728d8559a8cae649a92376dc0db272f83d9fb65",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 89,
            "deletions": 4,
            "changes": 93,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -42,6 +42,10 @@ keyword argument ``update_fields``. By using this argument it is possible to\n save only a select list of model's fields. This can be useful for performance\n reasons or when trying to avoid overwriting concurrent changes.\n \n+Deferred instances (those loaded by .only() or .defer()) will automatically\n+save just the loaded fields. If any field is set manually after load, that\n+field will also get updated on save.\n+\n See the :meth:`Model.save() <django.db.models.Model.save()>` documentation for\n more details.\n \n@@ -80,6 +84,12 @@ By passing ``False`` using this argument it is now possible to retreive the\n :class:`ContentType <django.contrib.contenttypes.models.ContentType>`\n associated with proxy models.\n \n+New ``view`` variable in class-based views context\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+In all :doc:`generic class-based views </topics/class-based-views/index>`\n+(or any class-based view inheriting from ``ContextMixin``), the context dictionary\n+contains a ``view`` variable that points to the ``View`` instance.\n+\n Minor features\n ~~~~~~~~~~~~~~\n \n@@ -134,6 +144,14 @@ year|date:\"Y\" }}``.\n ``next_year`` and ``previous_year`` were also added in the context. They are\n calculated according to ``allow_empty`` and ``allow_future``.\n \n+Context in TemplateView\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+For consistency with the design of the other generic views,\n+:class:`~django.views.generic.base.TemplateView` no longer passes a ``params``\n+dictionary into the context, instead passing the variables from the URLconf\n+directly into the context.\n+\n OPTIONS, PUT and DELETE requests in the test client\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -154,14 +172,62 @@ If you were using the ``data`` parameter in a PUT request without a\n ``content_type``, you must encode your data before passing it to the test\n client and set the ``content_type`` argument.\n \n+.. _simplejson-incompatibilities:\n+\n+System version of :mod:`simplejson` no longer used\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+:ref:`As explained below <simplejson-deprecation>`, Django 1.5 deprecates\n+:mod:`django.utils.simplejson` in favor of Python 2.6's built-in :mod:`json`\n+module. In theory, this change is harmless. Unfortunately, because of\n+incompatibilities between versions of :mod:`simplejson`, it may trigger errors\n+in some circumstances.\n+\n+JSON-related features in Django 1.4 always used :mod:`django.utils.simplejson`.\n+This module was actually:\n+\n+- A system version of :mod:`simplejson`, if one was available (ie. ``import\n+  simplejson`` works), if it was more recent than Django's built-in copy or it\n+  had the C speedups, or\n+- The :mod:`json` module from the standard library, if it was available (ie.\n+  Python 2.6 or greater), or\n+- A built-in copy of version 2.0.7 of :mod:`simplejson`.\n+\n+In Django 1.5, those features use Python's :mod:`json` module, which is based\n+on version 2.0.9 of :mod:`simplejson`.\n+\n+There are no known incompatibilities between Django's copy of version 2.0.7 and\n+Python's copy of version 2.0.9. However, there are some incompatibilities\n+between other versions of :mod:`simplejson`:\n+\n+- While the :mod:`simplejson` API is documented as always returning unicode\n+  strings, the optional C implementation can return a byte string. This was\n+  fixed in Python 2.7.\n+- :class:`simplejson.JSONEncoder` gained a ``namedtuple_as_object`` keyword\n+  argument in version 2.2.\n+\n+More information on these incompatibilities is available in `ticket #18023`_.\n+\n+The net result is that, if you have installed :mod:`simplejson` and your code\n+uses Django's serialization internals directly -- for instance\n+:class:`django.core.serializers.json.DjangoJSONEncoder`, the switch from\n+:mod:`simplejson` to :mod:`json` could break your code. (In general, changes to\n+internals aren't documented; we're making an exception here.)\n+\n+At this point, the maintainers of Django believe that using :mod:`json` from\n+the standard library offers the strongest guarantee of backwards-compatibility.\n+They recommend to use it from now on.\n+\n+.. _ticket #18023: https://code.djangoproject.com/ticket/18023#comment:10\n+\n String types of hasher method parameters\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n If you have written a :ref:`custom password hasher <auth_password_storage>`,\n your ``encode()``, ``verify()`` or ``safe_summary()`` methods should accept\n Unicode parameters (``password``, ``salt`` or ``encoded``). If any of the\n hashing methods need byte strings, you can use the\n-:func:`~django.utils.encoding.smart_bytes` utility to encode the strings.\n+:func:`~django.utils.encoding.force_bytes` utility to encode the strings.\n \n Validation of previous_page_number and next_page_number\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n@@ -257,19 +323,38 @@ Miscellaneous\n * :func:`~django.utils.http.int_to_base36` properly raises a :exc:`TypeError`\n   instead of :exc:`ValueError` for non-integer inputs.\n \n+* The ``slugify`` template filter is now available as a standard python\n+  function at :func:`django.utils.text.slugify`. Similarly, ``remove_tags`` is\n+  available at :func:`django.utils.html.remove_tags`.\n+\n Features deprecated in 1.5\n ==========================\n \n+.. _simplejson-deprecation:\n+\n ``django.utils.simplejson``\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n Since Django 1.5 drops support for Python 2.5, we can now rely on the\n-:mod:`json` module being in Python's standard library -- so we've removed\n-our own copy of ``simplejson``. You can safely change any use of\n-:mod:`django.utils.simplejson` to :mod:`json`.\n+:mod:`json` module being available in Python's standard library, so we've\n+removed our own copy of :mod:`simplejson`. You should now import :mod:`json`\n+instead :mod:`django.utils.simplejson`.\n+\n+Unfortunately, this change might have unwanted side-effects, because of\n+incompatibilities between versions of :mod:`simplejson` -- see the\n+:ref:`backwards-incompatible changes <simplejson-incompatibilities>` section.\n+If you rely on features added to :mod:`simplejson` after it became Python's\n+:mod:`json`, you should import :mod:`simplejson` explicitly.\n \n ``itercompat.product``\n ~~~~~~~~~~~~~~~~~~~~~~\n \n The :func:`~django.utils.itercompat.product` function has been deprecated. Use\n the built-in :func:`itertools.product` instead.\n+\n+``django.utils.encoding.StrAndUnicode``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :class:`~django.utils.encoding.StrAndUnicode` mix-in has been deprecated.\n+Define a ``__str__`` method and apply the\n+:func:`~django.utils.encoding.python_2_unicode_compatible` decorator instead."
        },
        {
            "sha": "fa55a4d2062ee8612ad3530f72701c0b8dba0dfd",
            "filename": "docs/releases/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Freleases%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2Findex.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -27,13 +27,16 @@ Final releases\n .. toctree::\n    :maxdepth: 1\n \n+   .. 1.4.2 (uncomment on release)\n+   1.4.1\n    1.4\n \n 1.3 release\n -----------\n .. toctree::\n    :maxdepth: 1\n \n+   1.3.2\n    1.3.1\n    1.3\n "
        },
        {
            "sha": "f8dbbb65a6a2148188d4e808f00228c6e69897ce",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -460,15 +460,15 @@ algorithm.\n Increasing the work factor\n ~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n-The PDKDF2 and bcrypt algorithms use a number of iterations or rounds of\n+The PBKDF2 and bcrypt algorithms use a number of iterations or rounds of\n hashing. This deliberately slows down attackers, making attacks against hashed\n passwords harder. However, as computing power increases, the number of\n iterations needs to be increased. We've chosen a reasonable default (and will\n increase it with each release of Django), but you may wish to tune it up or\n down, depending on your security needs and available processing power. To do so,\n you'll subclass the appropriate algorithm and override the ``iterations``\n parameters. For example, to increase the number of iterations used by the\n-default PDKDF2 algorithm:\n+default PBKDF2 algorithm:\n \n 1. Create a subclass of ``django.contrib.auth.hashers.PBKDF2PasswordHasher``::\n \n@@ -1170,24 +1170,25 @@ includes a few other useful built-in views located in\n       :file:`registration/password_reset_form.html` if not supplied.\n \n     * ``email_template_name``: The full name of a template to use for\n-      generating the email with the new password. Defaults to\n+      generating the email with the reset password link. Defaults to\n       :file:`registration/password_reset_email.html` if not supplied.\n \n     * ``subject_template_name``: The full name of a template to use for\n-      the subject of the email with the new password. Defaults\n+      the subject of the email with the reset password link. Defaults\n       to :file:`registration/password_reset_subject.txt` if not supplied.\n \n       .. versionadded:: 1.4\n \n-    * ``password_reset_form``: Form that will be used to set the password.\n-      Defaults to :class:`~django.contrib.auth.forms.PasswordResetForm`.\n+    * ``password_reset_form``: Form that will be used to get the email of\n+      the user to reset the password for. Defaults to\n+      :class:`~django.contrib.auth.forms.PasswordResetForm`.\n \n-    * ``token_generator``: Instance of the class to check the password. This\n-      will default to ``default_token_generator``, it's an instance of\n+    * ``token_generator``: Instance of the class to check the one time link.\n+      This will default to ``default_token_generator``, it's an instance of\n       ``django.contrib.auth.tokens.PasswordResetTokenGenerator``.\n \n     * ``post_reset_redirect``: The URL to redirect to after a successful\n-      password change.\n+      password reset request.\n \n     * ``from_email``: A valid email address. By default Django uses\n       the :setting:`DEFAULT_FROM_EMAIL`.\n@@ -1218,7 +1219,7 @@ includes a few other useful built-in views located in\n \n     * ``uid``: The user's id encoded in base 36.\n \n-    * ``token``: Token to check that the password is valid.\n+    * ``token``: Token to check that the reset link is valid.\n \n     Sample ``registration/password_reset_email.html`` (email body template):\n "
        },
        {
            "sha": "f13238e3427dd683c01efaf15d07c8a7fa7787cb",
            "filename": "docs/topics/cache.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fcache.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fcache.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fcache.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -864,7 +864,7 @@ key version to provide a final cache key. By default, the three parts\n are joined using colons to produce a final string::\n \n     def make_key(key, key_prefix, version):\n-        return ':'.join([key_prefix, str(version), smart_bytes(key)])\n+        return ':'.join([key_prefix, str(version), key])\n \n If you want to combine the parts in different ways, or apply other\n processing to the final key (e.g., taking a hash digest of the key"
        },
        {
            "sha": "6637bd5fcb33d6b4e1121df761d7d1d07a5a9b17",
            "filename": "docs/topics/class-based-views/index.txt",
            "status": "modified",
            "additions": 35,
            "deletions": 118,
            "changes": 153,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Findex.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,8 +11,7 @@ to structure your views and reuse code by harnessing inheritance and\n mixins. There are also some generic views for simple tasks which we'll\n get to later, but you may want to design your own structure of\n reusable views which suits your use case. For full details, see the\n-:doc:`class-based views reference\n-documentation</ref/class-based-views/index>`.\n+:doc:`class-based views reference documentation</ref/class-based-views/index>`.\n \n .. toctree::\n    :maxdepth: 1\n@@ -32,29 +31,46 @@ redirect, and :class:`~django.views.generic.base.TemplateView` extends the base\n to make it also render a template.\n \n \n-Simple usage\n-============\n+Simple usage in your URLconf\n+============================\n+\n+The simplest way to use generic views is to create them directly in your\n+URLconf. If you're only changing a few simple attributes on a class-based view,\n+you can simply pass them into the ``as_view`` method call itself::\n+\n+    from django.conf.urls import patterns, url, include\n+    from django.views.generic import TemplateView\n+\n+    urlpatterns = patterns('',\n+        (r'^about/', TemplateView.as_view(template_name=\"about.html\")),\n+    )\n+\n+Any arguments given will override the ``template_name`` on the\n+A similar overriding pattern can be used for the ``url`` attribute on\n+:class:`~django.views.generic.base.RedirectView`.\n \n-Class-based generic views (and any class-based views that inherit from\n-the base classes Django provides) can be configured in two\n-ways: subclassing, or passing in arguments directly in the URLconf.\n \n-When you subclass a class-based view, you can override attributes\n-(such as the ``template_name``) or methods (such as ``get_context_data``)\n-in your subclass to provide new values or methods. Consider, for example,\n-a view that just displays one template, ``about.html``. Django has a\n-generic view to do this - :class:`~django.views.generic.base.TemplateView` -\n-so we can just subclass it, and override the template name::\n+Subclassing generic views\n+=========================\n+\n+The second, more powerful way to use generic views is to inherit from an\n+existing view and override attributes (such as the ``template_name``) or\n+methods (such as ``get_context_data``) in your subclass to provide new values\n+or methods. Consider, for example, a view that just displays one template,\n+``about.html``. Django has a generic view to do this -\n+:class:`~django.views.generic.base.TemplateView` - so we can just subclass it,\n+and override the template name::\n \n     # some_app/views.py\n     from django.views.generic import TemplateView\n \n     class AboutView(TemplateView):\n         template_name = \"about.html\"\n \n-Then, we just need to add this new view into our URLconf. As the class-based\n-views themselves are classes, we point the URL to the ``as_view`` class method\n-instead, which is the entry point for class-based views::\n+Then we just need to add this new view into our URLconf.\n+`~django.views.generic.base.TemplateView` is a class, not a function, so we\n+point the URL to the ``as_view`` class method instead, which provides a\n+function-like entry to class-based views::\n \n     # urls.py\n     from django.conf.urls import patterns, url, include\n@@ -64,104 +80,6 @@ instead, which is the entry point for class-based views::\n         (r'^about/', AboutView.as_view()),\n     )\n \n-Alternatively, if you're only changing a few simple attributes on a\n-class-based view, you can simply pass the new attributes into the ``as_view``\n-method call itself::\n-\n-    from django.conf.urls import patterns, url, include\n-    from django.views.generic import TemplateView\n-\n-    urlpatterns = patterns('',\n-        (r'^about/', TemplateView.as_view(template_name=\"about.html\")),\n-    )\n-\n-A similar overriding pattern can be used for the ``url`` attribute on\n-:class:`~django.views.generic.base.RedirectView`.\n-\n-.. _jsonresponsemixin-example:\n-\n-More than just HTML\n--------------------\n-\n-Where class based views shine is when you want to do the same thing many times.\n-Suppose you're writing an API, and every view should return JSON instead of\n-rendered HTML.\n-\n-We can create a mixin class to use in all of our views, handling the\n-conversion to JSON once.\n-\n-For example, a simple JSON mixin might look something like this::\n-\n-    import json\n-    from django.http import HttpResponse\n-\n-    class JSONResponseMixin(object):\n-        \"\"\"\n-        A mixin that can be used to render a JSON response.\n-        \"\"\"\n-        response_class = HttpResponse\n-\n-        def render_to_response(self, context, **response_kwargs):\n-            \"\"\"\n-            Returns a JSON response, transforming 'context' to make the payload.\n-            \"\"\"\n-            response_kwargs['content_type'] = 'application/json'\n-            return self.response_class(\n-                self.convert_context_to_json(context),\n-                **response_kwargs\n-            )\n-\n-        def convert_context_to_json(self, context):\n-            \"Convert the context dictionary into a JSON object\"\n-            # Note: This is *EXTREMELY* naive; in reality, you'll need\n-            # to do much more complex handling to ensure that arbitrary\n-            # objects -- such as Django model instances or querysets\n-            # -- can be serialized as JSON.\n-            return json.dumps(context)\n-\n-Now we mix this into the base view::\n-\n-    from django.views.generic import View\n-\n-    class JSONView(JSONResponseMixin, View):\n-        pass\n-\n-Equally we could use our mixin with one of the generic views. We can make our\n-own version of :class:`~django.views.generic.detail.DetailView` by mixing\n-:class:`JSONResponseMixin` with the\n-:class:`~django.views.generic.detail.BaseDetailView` -- (the\n-:class:`~django.views.generic.detail.DetailView` before template\n-rendering behavior has been mixed in)::\n-\n-    class JSONDetailView(JSONResponseMixin, BaseDetailView):\n-        pass\n-\n-This view can then be deployed in the same way as any other\n-:class:`~django.views.generic.detail.DetailView`, with exactly the\n-same behavior -- except for the format of the response.\n-\n-If you want to be really adventurous, you could even mix a\n-:class:`~django.views.generic.detail.DetailView` subclass that is able\n-to return *both* HTML and JSON content, depending on some property of\n-the HTTP request, such as a query argument or a HTTP header. Just mix\n-in both the :class:`JSONResponseMixin` and a\n-:class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin`,\n-and override the implementation of :func:`render_to_response()` to defer\n-to the appropriate subclass depending on the type of response that the user\n-requested::\n-\n-    class HybridDetailView(JSONResponseMixin, SingleObjectTemplateResponseMixin, BaseDetailView):\n-        def render_to_response(self, context):\n-            # Look for a 'format=json' GET argument\n-            if self.request.GET.get('format','html') == 'json':\n-                return JSONResponseMixin.render_to_response(self, context)\n-            else:\n-                return SingleObjectTemplateResponseMixin.render_to_response(self, context)\n-\n-Because of the way that Python resolves method overloading, the local\n-``render_to_response()`` implementation will override the versions provided by\n-:class:`JSONResponseMixin` and\n-:class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin`.\n \n For more information on how to use the built in generic views, consult the next\n topic on :doc:`generic class based views</topics/class-based-views/generic-display>`.\n@@ -171,16 +89,15 @@ Decorating class-based views\n \n .. highlightlang:: python\n \n-The extension of class-based views isn't limited to using mixins. You\n-can use also use decorators.\n+Since class-based views aren't functions, decorating them works differently\n+depending on if you're using ``as_view`` or creating a subclass.\n \n Decorating in URLconf\n ---------------------\n \n The simplest way of decorating class-based views is to decorate the\n result of the :meth:`~django.views.generic.base.View.as_view` method.\n-The easiest place to do this is in the URLconf where you deploy your\n-view::\n+The easiest place to do this is in the URLconf where you deploy your view::\n \n     from django.contrib.auth.decorators import login_required, permission_required\n     from django.views.generic import TemplateView"
        },
        {
            "sha": "f07769fb8a3d416522c011c1afc3c652f269e928",
            "filename": "docs/topics/class-based-views/mixins.txt",
            "status": "modified",
            "additions": 115,
            "deletions": 35,
            "changes": 150,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fclass-based-views%2Fmixins.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fclass-based-views%2Fmixins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Fmixins.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -69,7 +69,7 @@ interface to working with templates in class-based views.\n     add more members to the dictionary.\n \n Building up Django's generic class-based views\n-===============================================\n+==============================================\n \n Let's look at how two of Django's generic class-based views are built\n out of mixins providing discrete functionality. We'll consider\n@@ -222,8 +222,7 @@ we'll want the functionality provided by\n :class:`~django.views.generic.detail.SingleObjectMixin`.\n \n We'll demonstrate this with the publisher modelling we used in the\n-:doc:`generic class-based views\n-introduction<generic-display>`.\n+:doc:`generic class-based views introduction<generic-display>`.\n \n .. code-block:: python\n \n@@ -233,11 +232,11 @@ introduction<generic-display>`.\n     from django.views.generic import View\n     from django.views.generic.detail import SingleObjectMixin\n     from books.models import Author\n-    \n+\n     class RecordInterest(View, SingleObjectMixin):\n         \"\"\"Records the current user's interest in an author.\"\"\"\n         model = Author\n-    \n+\n         def post(self, request, *args, **kwargs):\n             if not request.user.is_authenticated():\n                 return HttpResponseForbidden()\n@@ -256,9 +255,7 @@ we're interested in, which it just does with a simple call to\n ``self.get_object()``. Everything else is taken care of for us by the\n mixin.\n \n-We can hook this into our URLs easily enough:\n-\n-.. code-block:: python\n+We can hook this into our URLs easily enough::\n \n     # urls.py\n     from books.views import RecordInterest\n@@ -294,8 +291,6 @@ object. In order to do this, we need to have two different querysets:\n     We'll figure that out ourselves in :meth:`get_queryset()` so we\n     can take into account the Publisher we're looking at.\n \n-.. highlightlang:: python\n-\n .. note::\n \n     We have to think carefully about :meth:`get_context_data()`.\n@@ -311,15 +306,15 @@ Now we can write a new :class:`PublisherDetail`::\n     from django.views.generic import ListView\n     from django.views.generic.detail import SingleObjectMixin\n     from books.models import Publisher\n-    \n+\n     class PublisherDetail(SingleObjectMixin, ListView):\n         paginate_by = 2\n         template_name = \"books/publisher_detail.html\"\n-    \n+\n         def get_context_data(self, **kwargs):\n             kwargs['publisher'] = self.object\n             return super(PublisherDetail, self).get_context_data(**kwargs)\n-    \n+\n         def get_queryset(self):\n             self.object = self.get_object(Publisher.objects.all())\n             return self.object.book_set.all()\n@@ -339,26 +334,26 @@ have to create lots of books to see the pagination working! Here's the\n template you'd want to use::\n \n     {% extends \"base.html\" %}\n-    \n+\n     {% block content %}\n         <h2>Publisher {{ publisher.name }}</h2>\n-        \n+\n         <ol>\n           {% for book in page_obj %}\n             <li>{{ book.title }}</li>\n           {% endfor %}\n         </ol>\n-        \n+\n         <div class=\"pagination\">\n             <span class=\"step-links\">\n                 {% if page_obj.has_previous %}\n                     <a href=\"?page={{ page_obj.previous_page_number }}\">previous</a>\n                 {% endif %}\n-        \n+\n                 <span class=\"current\">\n                     Page {{ page_obj.number }} of {{ paginator.num_pages }}.\n                 </span>\n-        \n+\n                 {% if page_obj.has_next %}\n                     <a href=\"?page={{ page_obj.next_page_number }}\">next</a>\n                 {% endif %}\n@@ -428,9 +423,9 @@ code so that on ``POST`` the form gets called appropriately.\n     the views implement :meth:`get()`, and things would get much more\n     confusing.\n \n-Our new :class:`AuthorDetail` looks like this:\n+.. highlightlang:: python\n \n-.. code-block:: python\n+Our new :class:`AuthorDetail` looks like this::\n \n     # CAUTION: you almost certainly do not want to do this.\n     # It is provided as part of a discussion of problems you can\n@@ -455,7 +450,7 @@ Our new :class:`AuthorDetail` looks like this:\n                 'author-detail',\n                 kwargs = {'pk': self.object.pk},\n             )\n-    \n+\n         def get_context_data(self, **kwargs):\n             form_class = self.get_form_class()\n             form = self.get_form(form_class)\n@@ -464,22 +459,22 @@ Our new :class:`AuthorDetail` looks like this:\n             }\n             context.update(kwargs)\n             return super(AuthorDetail, self).get_context_data(**context)\n-    \n+\n         def post(self, request, *args, **kwargs):\n             form_class = self.get_form_class()\n             form = self.get_form(form_class)\n             if form.is_valid():\n                 return self.form_valid(form)\n             else:\n                 return self.form_invalid(form)\n-    \n+\n         def form_valid(self, form):\n             if not self.request.user.is_authenticated():\n                 return HttpResponseForbidden()\n             self.object = self.get_object()\n             # record the interest using the message in form.cleaned_data\n             return super(AuthorDetail, self).form_valid(form)\n-    \n+\n :meth:`get_success_url()` is just providing somewhere to redirect to,\n which gets used in the default implementation of\n :meth:`form_valid()`. We have to provide our own :meth:`post()` as\n@@ -525,21 +520,21 @@ write our own :meth:`get_context_data()` to make the\n     from django.views.generic import DetailView\n     from django import forms\n     from books.models import Author\n-    \n+\n     class AuthorInterestForm(forms.Form):\n         message = forms.CharField()\n-    \n+\n     class AuthorDisplay(DetailView):\n-    \n+\n         queryset = Author.objects.all()\n-    \n+\n         def get_context_data(self, **kwargs):\n             context = {\n                 'form': AuthorInterestForm(),\n             }\n             context.update(kwargs)\n             return super(AuthorDisplay, self).get_context_data(**context)\n-    \n+\n Then the :class:`AuthorInterest` is a simple :class:`FormView`, but we\n have to bring in :class:`SingleObjectMixin` so we can find the author\n we're talking about, and we have to remember to set\n@@ -550,7 +545,7 @@ template as :class:`AuthorDisplay` is using on ``GET``.\n \n     from django.views.generic import FormView\n     from django.views.generic.detail import SingleObjectMixin\n-    \n+\n     class AuthorInterest(FormView, SingleObjectMixin):\n         template_name = 'books/author_detail.html'\n         form_class = AuthorInterestForm\n@@ -561,13 +556,13 @@ template as :class:`AuthorDisplay` is using on ``GET``.\n                 'object': self.get_object(),\n             }\n             return super(AuthorInterest, self).get_context_data(**context)\n-    \n+\n         def get_success_url(self):\n             return reverse(\n                 'author-detail',\n                 kwargs = {'pk': self.object.pk},\n             )\n-    \n+\n         def form_valid(self, form):\n             if not self.request.user.is_authenticated():\n                 return HttpResponseForbidden()\n@@ -588,13 +583,13 @@ using a different template.\n .. code-block:: python\n \n     from django.views.generic import View\n-    \n+\n     class AuthorDetail(View):\n-    \n+\n         def get(self, request, *args, **kwargs):\n             view = AuthorDisplay.as_view()\n             return view(request, *args, **kwargs)\n-    \n+\n         def post(self, request, *args, **kwargs):\n             view = AuthorInterest.as_view()\n             return view(request, *args, **kwargs)\n@@ -603,3 +598,88 @@ This approach can also be used with any other generic class-based\n views or your own class-based views inheriting directly from\n :class:`View` or :class:`TemplateView`, as it keeps the different\n views as separate as possible.\n+\n+.. _jsonresponsemixin-example:\n+\n+More than just HTML\n+===================\n+\n+Where class based views shine is when you want to do the same thing many times.\n+Suppose you're writing an API, and every view should return JSON instead of\n+rendered HTML.\n+\n+We can create a mixin class to use in all of our views, handling the\n+conversion to JSON once.\n+\n+For example, a simple JSON mixin might look something like this::\n+\n+    import json\n+    from django.http import HttpResponse\n+\n+    class JSONResponseMixin(object):\n+        \"\"\"\n+        A mixin that can be used to render a JSON response.\n+        \"\"\"\n+        response_class = HttpResponse\n+\n+        def render_to_response(self, context, **response_kwargs):\n+            \"\"\"\n+            Returns a JSON response, transforming 'context' to make the payload.\n+            \"\"\"\n+            response_kwargs['content_type'] = 'application/json'\n+            return self.response_class(\n+                self.convert_context_to_json(context),\n+                **response_kwargs\n+            )\n+\n+        def convert_context_to_json(self, context):\n+            \"Convert the context dictionary into a JSON object\"\n+            # Note: This is *EXTREMELY* naive; in reality, you'll need\n+            # to do much more complex handling to ensure that arbitrary\n+            # objects -- such as Django model instances or querysets\n+            # -- can be serialized as JSON.\n+            return json.dumps(context)\n+\n+Now we mix this into the base TemplateView::\n+\n+    from django.views.generic import TemplateView\n+\n+    class JSONView(JSONResponseMixin, TemplateView):\n+        pass\n+\n+Equally we could use our mixin with one of the generic views. We can make our\n+own version of :class:`~django.views.generic.detail.DetailView` by mixing\n+:class:`JSONResponseMixin` with the\n+:class:`~django.views.generic.detail.BaseDetailView` -- (the\n+:class:`~django.views.generic.detail.DetailView` before template\n+rendering behavior has been mixed in)::\n+\n+    class JSONDetailView(JSONResponseMixin, BaseDetailView):\n+        pass\n+\n+This view can then be deployed in the same way as any other\n+:class:`~django.views.generic.detail.DetailView`, with exactly the\n+same behavior -- except for the format of the response.\n+\n+If you want to be really adventurous, you could even mix a\n+:class:`~django.views.generic.detail.DetailView` subclass that is able\n+to return *both* HTML and JSON content, depending on some property of\n+the HTTP request, such as a query argument or a HTTP header. Just mix\n+in both the :class:`JSONResponseMixin` and a\n+:class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin`,\n+and override the implementation of :func:`render_to_response()` to defer\n+to the appropriate subclass depending on the type of response that the user\n+requested::\n+\n+    class HybridDetailView(JSONResponseMixin, SingleObjectTemplateResponseMixin, BaseDetailView):\n+        def render_to_response(self, context):\n+            # Look for a 'format=json' GET argument\n+            if self.request.GET.get('format','html') == 'json':\n+                return JSONResponseMixin.render_to_response(self, context)\n+            else:\n+                return SingleObjectTemplateResponseMixin.render_to_response(self, context)\n+\n+Because of the way that Python resolves method overloading, the local\n+``render_to_response()`` implementation will override the versions provided by\n+:class:`JSONResponseMixin` and\n+:class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin`."
        },
        {
            "sha": "f29cc28332fedd870aaf2df57b45e96d444dc06e",
            "filename": "docs/topics/db/models.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 15,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fdb%2Fmodels.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fdb%2Fmodels.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmodels.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -108,8 +108,8 @@ determine a few things:\n \n * The database column type (e.g. ``INTEGER``, ``VARCHAR``).\n \n-* The :doc:`widget </ref/forms/widgets>` to use in Django's admin interface,\n-  if you care to use it (e.g. ``<input type=\"text\">``, ``<select>``).\n+* The default :doc:`widget </ref/forms/widgets>` to use when rendering a form\n+  field (e.g. ``<input type=\"text\">``, ``<select>``).\n \n * The minimal validation requirements, used in Django's admin and in\n   automatically-generated forms.\n@@ -143,13 +143,13 @@ ones:\n     Note that this is different than :attr:`~Field.null`.\n     :attr:`~Field.null` is purely database-related, whereas\n     :attr:`~Field.blank` is validation-related. If a field has\n-    :attr:`blank=True <Field.blank>`, validation on Django's admin site will\n+    :attr:`blank=True <Field.blank>`, form validation will\n     allow entry of an empty value. If a field has :attr:`blank=False\n     <Field.blank>`, the field will be required.\n \n :attr:`~Field.choices`\n     An iterable (e.g., a list or tuple) of 2-tuples to use as choices for\n-    this field. If this is given, Django's admin will use a select box\n+    this field. If this is given, the default form widget will be a select box\n     instead of the standard text field and will limit choices to the choices\n     given.\n \n@@ -164,7 +164,7 @@ ones:\n         )\n \n     The first element in each tuple is the value that will be stored in the\n-    database, the second element will be displayed by the admin interface,\n+    database, the second element will be displayed by the default form widget\n     or in a ModelChoiceField. Given an instance of a model object, the\n     display value for a choices field can be accessed using the\n     ``get_FOO_display`` method. For example::\n@@ -195,9 +195,8 @@ ones:\n     created.\n \n :attr:`~Field.help_text`\n-    Extra \"help\" text to be displayed under the field on the object's admin\n-    form. It's useful for documentation even if your object doesn't have an\n-    admin form.\n+    Extra \"help\" text to be displayed with the form widget. It's useful for\n+    documentation even if your field isn't used on a form.\n \n :attr:`~Field.primary_key`\n     If ``True``, this field is the primary key for the model.\n@@ -360,13 +359,12 @@ It doesn't matter which model has the\n :class:`~django.db.models.ManyToManyField`, but you should only put it in one\n of the models -- not both.\n \n-Generally, :class:`~django.db.models.ManyToManyField` instances should go in the\n-object that's going to be edited in the admin interface, if you're using\n-Django's admin. In the above example, ``toppings`` is in ``Pizza`` (rather than\n-``Topping`` having a ``pizzas`` :class:`~django.db.models.ManyToManyField` )\n-because it's more natural to think about a pizza having toppings than a\n-topping being on multiple pizzas. The way it's set up above, the ``Pizza`` admin\n-form would let users select the toppings.\n+Generally, :class:`~django.db.models.ManyToManyField` instances should go in\n+the object that's going to be edited on a form. In the above example,\n+``toppings`` is in ``Pizza`` (rather than ``Topping`` having a ``pizzas``\n+:class:`~django.db.models.ManyToManyField` ) because it's more natural to think\n+about a pizza having toppings than a topping being on multiple pizzas. The way\n+it's set up above, the ``Pizza`` form would let users select the toppings.\n \n .. seealso::\n "
        },
        {
            "sha": "03a7d3b7cd9b8f5ed7a20689ee10f60496b77772",
            "filename": "docs/topics/db/multi-db.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fdb%2Fmulti-db.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fdb%2Fmulti-db.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmulti-db.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -525,7 +525,7 @@ registered with any ``Admin`` instance::\n     admin.site.register(Author, MultiDBModelAdmin)\n     admin.site.register(Publisher, PublisherAdmin)\n \n-    othersite = admin.Site('othersite')\n+    othersite = admin.AdminSite('othersite')\n     othersite.register(Publisher, MultiDBModelAdmin)\n \n This example sets up two admin sites. On the first site, the"
        },
        {
            "sha": "60437c11209861fe6d0046fe76e0f7c69561598f",
            "filename": "docs/topics/db/queries.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fdb%2Fqueries.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fdb%2Fqueries.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fqueries.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -900,10 +900,10 @@ possible to easily create new instance with all fields' values copied. In the\n simplest case, you can just set ``pk`` to ``None``. Using our blog example::\n \n     blog = Blog(name='My blog', tagline='Blogging is easy')\n-    blog.save() # post.pk == 1\n+    blog.save() # blog.pk == 1\n \n     blog.pk = None\n-    blog.save() # post.pk == 2\n+    blog.save() # blog.pk == 2\n \n Things get more complicated if you use inheritance. Consider a subclass of\n ``Blog``::"
        },
        {
            "sha": "615dd7193c4bd4b1dc2772fd6c6c8f7bc9bb8b05",
            "filename": "docs/topics/forms/media.txt",
            "status": "modified",
            "additions": 30,
            "deletions": 30,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fforms%2Fmedia.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fforms%2Fmedia.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmedia.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -65,9 +65,9 @@ through this property::\n \n     >>> w = CalendarWidget()\n     >>> print(w.media)\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/actions.js\"></script>\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/actions.js\"></script>\n \n Here's a list of all possible ``Media`` options. There are no required options.\n \n@@ -110,9 +110,9 @@ requirements::\n \n If this last CSS definition were to be rendered, it would become the following HTML::\n \n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"screen\" rel=\"stylesheet\" />\n-    <link href=\"http://media.example.com/lo_res.css\" type=\"text/css\" media=\"tv,projector\" rel=\"stylesheet\" />\n-    <link href=\"http://media.example.com/newspaper.css\" type=\"text/css\" media=\"print\" rel=\"stylesheet\" />\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"screen\" rel=\"stylesheet\" />\n+    <link href=\"http://static.example.com/lo_res.css\" type=\"text/css\" media=\"tv,projector\" rel=\"stylesheet\" />\n+    <link href=\"http://static.example.com/newspaper.css\" type=\"text/css\" media=\"print\" rel=\"stylesheet\" />\n \n ``js``\n ~~~~~~\n@@ -140,11 +140,11 @@ basic Calendar widget from the example above::\n \n     >>> w = FancyCalendarWidget()\n     >>> print(w.media)\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <link href=\"http://media.example.com/fancy.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/actions.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/whizbang.js\"></script>\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <link href=\"http://static.example.com/fancy.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/actions.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/whizbang.js\"></script>\n \n The FancyCalendar widget inherits all the media from it's parent widget. If\n you don't want media to be inherited in this way, add an ``extend=False``\n@@ -160,8 +160,8 @@ declaration to the media declaration::\n \n     >>> w = FancyCalendarWidget()\n     >>> print(w.media)\n-    <link href=\"http://media.example.com/fancy.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/whizbang.js\"></script>\n+    <link href=\"http://static.example.com/fancy.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/whizbang.js\"></script>\n \n If you require even more control over media inheritance, define your media\n using a `dynamic property`_. Dynamic properties give you complete control over\n@@ -253,12 +253,12 @@ to filter out a medium of interest. For example::\n \n     >>> w = CalendarWidget()\n     >>> print(w.media)\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/actions.js\"></script>\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/actions.js\"></script>\n \n     >>> print(w.media)['css']\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n \n When you use the subscript operator, the value that is returned is a new\n Media object -- but one that only contains the media of interest.\n@@ -283,10 +283,10 @@ the resulting Media object contains the union of the media from both files::\n     >>> w1 = CalendarWidget()\n     >>> w2 = OtherWidget()\n     >>> print(w1.media + w2.media)\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/actions.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/whizbang.js\"></script>\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/actions.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/whizbang.js\"></script>\n \n Media on Forms\n --------------\n@@ -306,10 +306,10 @@ of adding the media definitions for all widgets that are part of the form::\n \n     >>> f = ContactForm()\n     >>> f.media\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/actions.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/whizbang.js\"></script>\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/actions.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/whizbang.js\"></script>\n \n If you want to associate additional media with a form -- for example, CSS for form\n layout -- simply add a media declaration to the form::\n@@ -325,8 +325,8 @@ layout -- simply add a media declaration to the form::\n \n     >>> f = ContactForm()\n     >>> f.media\n-    <link href=\"http://media.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <link href=\"http://media.example.com/layout.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-    <script type=\"text/javascript\" src=\"http://media.example.com/animations.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/actions.js\"></script>\n-    <script type=\"text/javascript\" src=\"http://media.example.com/whizbang.js\"></script>\n+    <link href=\"http://static.example.com/pretty.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <link href=\"http://static.example.com/layout.css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+    <script type=\"text/javascript\" src=\"http://static.example.com/animations.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/actions.js\"></script>\n+    <script type=\"text/javascript\" src=\"http://static.example.com/whizbang.js\"></script>"
        },
        {
            "sha": "8159c8850c781b14b5b940a63baaf5bc5cf6dfc5",
            "filename": "docs/topics/forms/modelforms.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmodelforms.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -200,7 +200,9 @@ The first time you call ``is_valid()`` or access the ``errors`` attribute of a\n well as :ref:`model validation <validating-objects>`. This has the side-effect\n of cleaning the model you pass to the ``ModelForm`` constructor. For instance,\n calling ``is_valid()`` on your form will convert any date fields on your model\n-to actual date objects.\n+to actual date objects. If form validation fails, only some of the updates\n+may be applied. For this reason, you'll probably want to avoid reusing the\n+model instance.\n \n \n The ``save()`` method"
        },
        {
            "sha": "b3a830c25eeb32432b782b33a68b44e3e2d58f19",
            "filename": "docs/topics/http/file-uploads.txt",
            "status": "modified",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fhttp%2Ffile-uploads.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fhttp%2Ffile-uploads.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Ffile-uploads.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -178,6 +178,52 @@ Three settings control Django's file upload behavior:\n     Which means \"try to upload to memory first, then fall back to temporary\n     files.\"\n \n+Handling uploaded files with a model\n+------------------------------------\n+\n+If you're saving a file on a :class:`~django.db.models.Model` with a\n+:class:`~django.db.models.FileField`, using a :class:`~django.forms.ModelForm`\n+makes this process much easier. The file object will be saved to the location\n+specified by the :attr:`~django.db.models.FileField.upload_to` argument of the\n+corresponding :class:`~django.db.models.FileField` when calling\n+``form.save()``::\n+\n+    from django.http import HttpResponseRedirect\n+    from django.shortcuts import render\n+    from .forms import ModelFormWithFileField\n+\n+    def upload_file(request):\n+        if request.method == 'POST':\n+            form = ModelFormWithFileField(request.POST, request.FILES)\n+            if form.is_valid():\n+                # file is saved\n+                form.save()\n+                return HttpResponseRedirect('/success/url/')\n+        else:\n+            form = ModelFormWithFileField()\n+        return render('upload.html', {'form': form})\n+\n+If you are constructing an object manually, you can simply assign the file\n+object from :attr:`request.FILES <django.http.HttpRequest.FILES>` to the file\n+field in the model::\n+\n+    from django.http import HttpResponseRedirect\n+    from django.shortcuts import render\n+    from .forms import UploadFileForm\n+    from .models import ModelWithFileField\n+\n+    def upload_file(request):\n+        if request.method == 'POST':\n+            form = UploadFileForm(request.POST, request.FILES)\n+            if form.is_valid():\n+                instance = ModelWithFileField(file_field=request.FILES['file'])\n+                instance.save()\n+                return HttpResponseRedirect('/success/url/')\n+        else:\n+            form = UploadFileForm()\n+        return render('upload.html', {'form': form})\n+\n+\n ``UploadedFile`` objects\n ========================\n "
        },
        {
            "sha": "7297184ed3a2162728a524e627dd3bbd0bfcbcae",
            "filename": "docs/topics/http/urls.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fhttp%2Furls.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fhttp%2Furls.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Furls.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -314,6 +314,9 @@ that should be called if none of the URL patterns match.\n By default, this is ``'django.views.defaults.page_not_found'``. That default\n value should suffice.\n \n+See the documentation about :ref:`the 404 (HTTP Not Found) view\n+<http_not_found_view>` for more information.\n+\n handler500\n ----------\n \n@@ -326,6 +329,9 @@ have runtime errors in view code.\n By default, this is ``'django.views.defaults.server_error'``. That default\n value should suffice.\n \n+See the documentation about :ref:`the 500 (HTTP Internal Server Error) view\n+<http_internal_server_error_view>` for more information.\n+\n Notes on capturing text in URLs\n ===============================\n \n@@ -568,10 +574,8 @@ For example::\n         (r'^blog/(?P<year>\\d{4})/$', 'year_archive', {'foo': 'bar'}),\n     )\n \n-In this example, for a request to ``/blog/2005/``, Django will call the\n-``blog.views.year_archive()`` view, passing it these keyword arguments::\n-\n-    year='2005', foo='bar'\n+In this example, for a request to ``/blog/2005/``, Django will call\n+``blog.views.year_archive(year='2005', foo='bar')``.\n \n This technique is used in the\n :doc:`syndication framework </ref/contrib/syndication>` to pass metadata and"
        },
        {
            "sha": "c4bd15e72e4865d15cda710bf8d7a3bac851b061",
            "filename": "docs/topics/http/views.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fviews.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -127,6 +127,8 @@ called ``404.html`` and located in the top level of your template tree.\n Customizing error views\n =======================\n \n+.. _http_not_found_view:\n+\n The 404 (page not found) view\n -----------------------------\n \n@@ -167,6 +169,8 @@ Four things to note about 404 views:\n   your 404 view will never be used, and your URLconf will be displayed\n   instead, with some debug information.\n \n+.. _http_internal_server_error_view:\n+\n The 500 (server error) view\n ----------------------------\n "
        },
        {
            "sha": "9bd53da2b94b1c4dfb27e1c1633f27f6eb990dd9",
            "filename": "docs/topics/i18n/translation.txt",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fi18n%2Ftranslation.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fi18n%2Ftranslation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Ftranslation.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -37,6 +37,13 @@ from your :setting:`TEMPLATE_CONTEXT_PROCESSORS` setting.\n     controls if Django should implement format localization. See\n     :doc:`/topics/i18n/formatting` for more details.\n \n+.. note::\n+\n+    Make sure you've activated translation for your project (the fastest way is\n+    to check if :setting:`MIDDLEWARE_CLASSES` includes\n+    :mod:`django.middleware.locale.LocaleMiddleware`). If you haven't yet,\n+    see :ref:`how-django-discovers-language-preference`.\n+\n Internationalization: in Python code\n ====================================\n \n@@ -317,10 +324,10 @@ Model fields and relationships ``verbose_name`` and ``help_text`` option values\n For example, to translate the help text of the *name* field in the following\n model, do the following::\n \n-    from django.utils.translation import ugettext_lazy\n+    from django.utils.translation import ugettext_lazy as _\n \n     class MyThing(models.Model):\n-        name = models.CharField(help_text=ugettext_lazy('This is the help text'))\n+        name = models.CharField(help_text=_('This is the help text'))\n \n You can mark names of ``ForeignKey``, ``ManyTomanyField`` or ``OneToOneField``\n relationship as translatable by using their ``verbose_name`` options::\n@@ -344,14 +351,14 @@ It is recommended to always provide explicit\n relying on the fallback English-centric and somewhat nave determination of\n verbose names Django performs bu looking at the model's class name::\n \n-    from django.utils.translation import ugettext_lazy\n+    from django.utils.translation import ugettext_lazy as _\n \n     class MyThing(models.Model):\n-        name = models.CharField(_('name'), help_text=ugettext_lazy('This is the help text'))\n+        name = models.CharField(_('name'), help_text=_('This is the help text'))\n \n         class Meta:\n-            verbose_name = ugettext_lazy('my thing')\n-            verbose_name_plural = ugettext_lazy('my things')\n+            verbose_name = _('my thing')\n+            verbose_name_plural = _('my things')\n \n Model methods ``short_description`` attribute values\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n@@ -456,6 +463,9 @@ Internationalization: in template code\n Translations in :doc:`Django templates </topics/templates>` uses two template\n tags and a slightly different syntax than in Python code. To give your template\n access to these tags, put ``{% load i18n %}`` toward the top of your template.\n+As with all template tags, this tag needs to be loaded in all templates which\n+use translations, even those templates that extend from other templates which\n+have already loaded the ``i18n`` tag.\n \n .. templatetag:: trans\n "
        },
        {
            "sha": "b54a9475ae73b3bb5f7f4d8f4e24c7207a090864",
            "filename": "docs/topics/logging.txt",
            "status": "modified",
            "additions": 34,
            "deletions": 4,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Flogging.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Flogging.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Flogging.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -218,10 +218,11 @@ handlers, filters and formatters that you want in your logging setup,\n and the log levels and other properties that you want those components\n to have.\n \n-Logging is configured immediately after settings have been loaded.\n-Since the loading of settings is one of the first things that Django\n-does, you can be certain that loggers are always ready for use in your\n-project code.\n+Logging is configured as soon as settings have been loaded\n+(either manually using :func:`~django.conf.settings.configure` or when at least\n+one setting is accessed). Since the loading of settings is one of the first\n+things that Django does, you can be certain that loggers are always ready for\n+use in your project code.\n \n .. _dictConfig format: http://docs.python.org/library/logging.config.html#configuration-dictionary-schema\n \n@@ -515,6 +516,35 @@ logging module.\n    through the filter. Handling of that record will not proceed if the callback\n    returns False.\n \n+   For instance, to filter out :class:`~django.http.UnreadablePostError`\n+   (raised when a user cancels an upload) from the admin emails, you would\n+   create a filter function::\n+\n+    from django.http import UnreadablePostError\n+\n+    def skip_unreadable_post(record):\n+        if record.exc_info:\n+            exc_type, exc_value = record.exc_info[:2]\n+            if isinstance(exc_value, UnreadablePostError):\n+                return False\n+        return True\n+\n+   and then add it to your logging config::\n+\n+        'filters': {\n+            'skip_unreadable_posts': {\n+                '()': 'django.utils.log.CallbackFilter',\n+                'callback': skip_unreadable_post,\n+            }\n+        },\n+        'handlers': {\n+            'mail_admins': {\n+                'level': 'ERROR',\n+                'filters': ['skip_unreadable_posts'],\n+                'class': 'django.utils.log.AdminEmailHandler'\n+            }\n+        },\n+\n .. class:: RequireDebugFalse()\n \n    .. versionadded:: 1.4"
        },
        {
            "sha": "457486caa48a0901f7f9ce68061db74cff2142f9",
            "filename": "docs/topics/python3.txt",
            "status": "modified",
            "additions": 281,
            "deletions": 27,
            "changes": 308,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fpython3.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Fpython3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fpython3.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,25 +1,213 @@\n-======================\n-Python 3 compatibility\n-======================\n+===================\n+Porting to Python 3\n+===================\n \n Django 1.5 is the first version of Django to support Python 3. The same code\n runs both on Python 2 (2.6.5) and Python 3 (3.2), thanks to the six_\n-compatibility layer and ``unicode_literals``.\n+compatibility layer.\n \n .. _six: http://packages.python.org/six/\n \n-This document is not meant as a Python 2 to Python 3 migration guide. There\n-are many existing resources, including `Python's official porting guide`_.\n-Rather, it describes guidelines that apply to Django's code and are\n-recommended for pluggable apps that run with both Python 2 and 3.\n+This document is primarily targeted at authors of pluggable application\n+who want to support both Python 2 and 3. It also describes guidelines that\n+apply to Django's code.\n+\n+Philosophy\n+==========\n+\n+This document assumes that you are familiar with the changes between Python 2\n+and Python 3. If you aren't, read `Python's official porting guide`_ first.\n+Refreshing your knowledge of unicode handling on Python 2 and 3 will help; the\n+`Pragmatic Unicode`_ presentation is a good resource.\n+\n+Django uses the *Python 2/3 Compatible Source* strategy. Of course, you're\n+free to chose another strategy for your own code, especially if you don't need\n+to stay compatible with Python 2. But authors of pluggable applications are\n+encouraged to use the same porting strategy as Django itself.\n+\n+Writing compatible code is much easier if you target Python  2.6. You will\n+most likely take advantage of the compatibility functions introduced in Django\n+1.5, like :mod:`django.utils.six`, so your application will also require\n+Django  1.5.\n+\n+Obviously, writing compatible source code adds some overhead, and that can\n+cause frustration. Django's developers have found that attempting to write\n+Python 3 code that's compatible with Python 2 is much more rewarding than the\n+opposite. Not only does that make your code more future-proof, but Python 3's\n+advantages (like the saner string handling) start shining quickly. Dealing\n+with Python 2 becomes a backwards compatibility requirement, and we as\n+developers are used to dealing with such constraints.\n+\n+Porting tools provided by Django are inspired by this philosophy, and it's\n+reflected throughout this guide.\n \n .. _Python's official porting guide: http://docs.python.org/py3k/howto/pyporting.html\n+.. _Pragmatic Unicode: http://nedbatchelder.com/text/unipain.html\n+\n+Porting tips\n+============\n+\n+Unicode literals\n+----------------\n+\n+This step consists in:\n+\n+- Adding ``from __future__ import unicode_literals`` at the top of your Python\n+  modules -- it's best to put it in each and every module, otherwise you'll\n+  keep checking the top of your files to see which mode is in effect;\n+- Removing the ``u`` prefix before unicode strings;\n+- Adding a ``b`` prefix before bytestrings.\n+\n+Performing these changes systematically guarantees backwards compatibility.\n+\n+However, Django applications generally don't need bytestrings, since Django\n+only exposes unicode interfaces to the programmer. Python 3 discourages using\n+bytestrings, except for binary data or byte-oriented interfaces. Python 2\n+makes bytestrings and unicode strings effectively interchangeable, as long as\n+they only contain ASCII data. Take advantage of this to use unicode strings\n+wherever possible and avoid the ``b`` prefixes.\n+\n+.. note::\n+\n+    Python 2's ``u`` prefix is a syntax error in Python 3.2 but it will be\n+    allowed again in Python 3.3 thanks to :pep:`414`. Thus, this\n+    transformation is optional if you target Python  3.3. It's still\n+    recommended, per the \"write Python 3 code\" philosophy.\n+\n+String handling\n+---------------\n+\n+Python 2's :class:`unicode` type was renamed :class:`str` in Python 3,\n+:class:`str` was renamed :class:`bytes`, and :class:`basestring` disappeared.\n+six_ provides :ref:`tools <string-handling-with-six>` to deal with these\n+changes.\n+\n+Django also contains several string related classes and functions in the\n+:mod:`django.utils.encoding` and :mod:`django.utils.safestring` modules. Their\n+names used the words ``str``, which doesn't mean the same thing in Python 2\n+and Python 3, and ``unicode``, which doesn't exist in Python 3. In order to\n+avoid ambiguity and confusion these concepts were renamed ``bytes`` and\n+``text``.\n+\n+Here are the name changes in :mod:`django.utils.encoding`:\n+\n+==================  ==================\n+Old name            New name\n+==================  ==================\n+``smart_str``       ``smart_bytes``\n+``smart_unicode``   ``smart_text``\n+``force_unicode``   ``force_text``\n+==================  ==================\n+\n+For backwards compatibility, the old names still work on Python 2. Under\n+Python 3, ``smart_str`` is an alias for ``smart_text``.\n+\n+.. note::\n+\n+    :mod:`django.utils.encoding` was deeply refactored in Django 1.5 to\n+    provide a more consistent API. Check its documentation for more\n+    information.\n+\n+:mod:`django.utils.safestring` is mostly used via the\n+:func:`~django.utils.safestring.mark_safe` and\n+:func:`~django.utils.safestring.mark_for_escaping` functions, which didn't\n+change. In case you're using the internals, here are the name changes:\n+\n+==================  ==================\n+Old name            New name\n+==================  ==================\n+``EscapeString``    ``EscapeBytes``\n+``EscapeUnicode``   ``EscapeText``\n+``SafeString``      ``SafeBytes``\n+``SafeUnicode``     ``SafeText``\n+==================  ==================\n+\n+For backwards compatibility, the old names still work on Python 2. Under\n+Python 3, ``EscapeString`` and ``SafeString`` are aliases for ``EscapeText``\n+and ``SafeText`` respectively.\n+\n+:meth:`__str__` and :meth:`__unicode__` methods\n+-----------------------------------------------\n+\n+In Python 2, the object model specifies :meth:`__str__` and\n+:meth:`__unicode__` methods. If these methods exist, they must return\n+:class:`str` (bytes) and :class:`unicode` (text) respectively.\n+\n+The ``print`` statement and the :func:`str` built-in call :meth:`__str__` to\n+determine the human-readable representation of an object. The :func:`unicode`\n+built-in calls :meth:`__unicode__` if it exists, and otherwise falls back to\n+:meth:`__str__` and decodes the result with the system encoding. Conversely,\n+the :class:`~django.db.models.Model` base class automatically derives\n+:meth:`__str__` from :meth:`__unicode__` by encoding to UTF-8.\n+\n+In Python 3, there's simply :meth:`__str__`, which must return :class:`str`\n+(text).\n+\n+(It is also possible to define :meth:`__bytes__`, but Django application have\n+little use for that method, because they hardly ever deal with\n+:class:`bytes`.)\n+\n+Django provides a simple way to define :meth:`__str__` and :meth:`__unicode__`\n+methods that work on Python 2 and 3: you must define a :meth:`__str__` method\n+returning text and to apply the\n+:func:`~django.utils.encoding.python_2_unicode_compatible` decorator.\n+\n+On Python 3, the decorator is a no-op. On Python 2, it defines appropriate\n+:meth:`__unicode__` and :meth:`__str__` methods (replacing the original\n+:meth:`__str__` method in the process). Here's an example::\n+\n+    from __future__ import unicode_literals\n+    from django.utils.encoding import python_2_unicode_compatible\n+\n+    @python_2_unicode_compatible\n+    class MyClass(object):\n+        def __str__(self):\n+            return \"Instance of my class\"\n+\n+This technique is the best match for Django's porting philosophy.\n+\n+Finally, note that :meth:`__repr__` must return a :class:`str` on all versions\n+of Python.\n+\n+:class:`dict` and :class:`dict`-like classes\n+--------------------------------------------\n+\n+:meth:`dict.keys`, :meth:`dict.items` and :meth:`dict.values` return lists in\n+Python 2 and iterators in Python 3. :class:`~django.http.QueryDict` and the\n+:class:`dict`-like classes defined in :mod:`django.utils.datastructures`\n+behave likewise in Python 3.\n+\n+six_ provides compatibility functions to work around this change:\n+:func:`~six.iterkeys`, :func:`~six.iteritems`, and :func:`~six.itervalues`.\n+Django's bundled version adds :func:`~django.utils.six.iterlists` for\n+:class:`~django.utils.datastructures.MultiValueDict` and its subclasses.\n+\n+:class:`~django.http.HttpRequest` and :class:`~django.http.HttpResponse` objects\n+--------------------------------------------------------------------------------\n+\n+According to :pep:`3333`:\n+\n+- headers are always :class:`str` objects,\n+- input and output streams are always :class:`bytes` objects.\n+\n+Specifically, :attr:`HttpResponse.content <django.http.HttpResponse.content>`\n+contains :class:`bytes`, which may become an issue if you compare it with a\n+:class:`str` in your tests. The preferred solution is to rely on\n+:meth:`~django.test.TestCase.assertContains` and\n+:meth:`~django.test.TestCase.assertNotContains`. These methods accept a\n+response and a unicode string as arguments.\n+\n+Coding guidelines\n+=================\n+\n+The following guidelines are enforced in Django's source code. They're also\n+recommended for third-party application who follow the same porting strategy.\n \n Syntax requirements\n-===================\n+-------------------\n \n Unicode\n--------\n+~~~~~~~\n \n In Python 3, all strings are considered Unicode by default. The ``unicode``\n type from Python 2 is called ``str`` in Python 3, and ``str`` becomes\n@@ -36,17 +224,25 @@ In order to enable the same behavior in Python 2, every module must import\n     my_string = \"This is an unicode literal\"\n     my_bytestring = b\"This is a bytestring\"\n \n-If you need a byte string under Python 2 and a unicode string under Python 3,\n-use the :func:`str` builtin::\n+If you need a byte string literal under Python 2 and a unicode string literal\n+under Python 3, use the :func:`str` builtin::\n \n     str('my string')\n \n-Be cautious if you have to `slice bytestrings`_.\n+In Python 3, there aren't any automatic conversions between :class:`str` and\n+:class:`bytes`, and the :mod:`codecs` module became more strict.\n+:meth:`str.decode` always returns :class:`bytes`, and :meth:`bytes.decode`\n+always returns :class:`str`. As a consequence, the following pattern is\n+sometimes necessary::\n+\n+    value = value.encode('ascii', 'ignore').decode('ascii')\n+\n+Be cautious if you have to `index bytestrings`_.\n \n-.. _slice bytestrings: http://docs.python.org/py3k/howto/pyporting.html#bytes-literals\n+.. _index bytestrings: http://docs.python.org/py3k/howto/pyporting.html#bytes-literals\n \n Exceptions\n-----------\n+~~~~~~~~~~\n \n When you capture exceptions, use the ``as`` keyword::\n \n@@ -59,17 +255,64 @@ This older syntax was removed in Python 3::\n \n     try:\n         ...\n-    except MyException, exc:\n+    except MyException, exc:    # Don't do that!\n         ...\n \n The syntax to reraise an exception with a different traceback also changed.\n Use :func:`six.reraise`.\n \n+Magic methods\n+-------------\n+\n+Use the patterns below to handle magic methods renamed in Python 3.\n+\n+Iterators\n+~~~~~~~~~\n+\n+::\n+\n+    class MyIterator(object):\n+        def __iter__(self):\n+            return self             # implement some logic here\n+\n+        def __next__(self):\n+            raise StopIteration     # implement some logic here\n+\n+        next = __next__             # Python 2 compatibility\n+\n+Boolean evaluation\n+~~~~~~~~~~~~~~~~~~\n+\n+::\n+\n+    class MyBoolean(object):\n+\n+        def __bool__(self):\n+            return True             # implement some logic here\n+\n+        __nonzero__ = __bool__      # Python 2 compatibility\n+\n+Division\n+~~~~~~~~\n+\n+::\n+\n+    class MyDivisible(object):\n+\n+        def __truediv__(self, other):\n+            return self / other     # implement some logic here\n+\n+        __div__ = __truediv__           # Python 2 compatibility\n+\n+        def __itruediv__(self, other):\n+            return self // other    # implement some logic here\n+\n+        __idiv__ = __itruediv__         # Python 2 compatibility\n \n .. module: django.utils.six\n \n Writing compatible code with six\n-================================\n+--------------------------------\n \n six_ is the canonical compatibility library for supporting Python 2 and 3 in\n a single codebase. Read its documentation!\n@@ -78,8 +321,10 @@ a single codebase. Read its documentation!\n \n Here are the most common changes required to write compatible code.\n \n-String types\n-------------\n+.. _string-handling-with-six:\n+\n+String handling\n+~~~~~~~~~~~~~~~\n \n The ``basestring`` and ``unicode`` types were removed in Python 3, and the\n meaning of ``str`` changed. To test these types, use the following idioms::\n@@ -92,29 +337,35 @@ Python  2.6 provides ``bytes`` as an alias for ``str``, so you don't need\n :attr:`six.binary_type`.\n \n ``long``\n---------\n+~~~~~~~~\n \n The ``long`` type no longer exists in Python 3. ``1L`` is a syntax error. Use\n :data:`six.integer_types` check if a value is an integer or a long::\n \n     isinstance(myvalue, six.integer_types)      # replacement for (int, long)\n \n ``xrange``\n-----------\n+~~~~~~~~~~\n \n Import :func:`six.moves.xrange` wherever you use ``xrange``.\n \n Moved modules\n--------------\n+~~~~~~~~~~~~~\n \n Some modules were renamed in Python 3. The :mod:`django.utils.six.moves\n <six.moves>` module provides a compatible location to import them.\n \n-In addition to six' defaults, Django's version provides ``dummy_thread`` as\n-``_dummy_thread``.\n+The ``urllib``, ``urllib2`` and ``urlparse`` modules were reworked in depth\n+and :mod:`django.utils.six.moves <six.moves>` doesn't handle them. Django\n+explicitly tries both locations, as follows::\n+\n+    try:\n+        from urllib.parse import urlparse, urlunparse\n+    except ImportError:     # Python 2\n+        from urlparse import urlparse, urlunparse\n \n PY3\n----\n+~~~\n \n If you need different code in Python 2 and Python 3, check :data:`six.PY3`::\n \n@@ -129,9 +380,9 @@ function.\n .. module:: django.utils.six\n \n Customizations of six\n-=====================\n+---------------------\n \n-The version of six bundled with Django includes a few additional tools:\n+The version of six bundled with Django includes one extra function:\n \n .. function:: iterlists(MultiValueDict)\n \n@@ -140,3 +391,6 @@ The version of six bundled with Django includes a few additional tools:\n     :meth:`~django.utils.datastructures.MultiValueDict.iterlists()` on Python\n     2 and :meth:`~django.utils.datastructures.MultiValueDict.lists()` on\n     Python 3.\n+\n+In addition to six' defaults moves, Django's version provides ``thread`` as\n+``_thread`` and ``dummy_thread`` as ``_dummy_thread``."
        },
        {
            "sha": "af45a8d95b9f1b01bf1a72a8edf1989bb76eab29",
            "filename": "docs/topics/templates.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Ftemplates.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Ftemplates.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftemplates.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -102,7 +102,7 @@ Use a dot (``.``) to access attributes of a variable.\n     attempts to loop over a ``collections.defaultdict``::\n \n         {% for k, v in defaultdict.iteritems %}\n-\t    Do something with k and v here...\n+            Do something with k and v here...\n         {% endfor %}\n \n     Because dictionary lookup happens first, that behavior kicks in and provides\n@@ -116,6 +116,10 @@ If you use a variable that doesn't exist, the template system will insert\n the value of the :setting:`TEMPLATE_STRING_IF_INVALID` setting, which is set\n to ``''`` (the empty string) by default.\n \n+Note that \"bar\" in a template expression like ``{{ foo.bar }}`` will be\n+interpreted as a literal string and not using the value of the variable \"bar\",\n+if one exists in the template context.\n+\n Filters\n =======\n "
        },
        {
            "sha": "c4c73733f591acbd26c87e97a1f0379e93200840",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2039,7 +2039,7 @@ out the `full reference`_ for more details.\n             self.selenium.find_element_by_xpath('//input[@value=\"Log in\"]').click()\n             # Wait until the response is received\n             WebDriverWait(self.selenium, timeout).until(\n-                lambda driver: driver.find_element_by_tag_name('body'), timeout=10)\n+                lambda driver: driver.find_element_by_tag_name('body'))\n \n     The tricky thing here is that there's really no such thing as a \"page load,\"\n     especially in modern Web apps that generate HTML dynamically after the"
        },
        {
            "sha": "e189ffb47b46f32985c5861f9d0653854431698c",
            "filename": "setup.cfg",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/setup.cfg",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/setup.cfg",
            "contents_url": "https://api.github.com/repos/django/django/contents/setup.cfg?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,4 +1,4 @@\n [bdist_rpm]\n-doc_files = docs extras AUTHORS INSTALL LICENSE README\n+doc_files = docs extras AUTHORS INSTALL LICENSE README.rst\n install-script = scripts/rpm-install.sh\n "
        },
        {
            "sha": "b4f797ee03e84e74d6262ac1014895c2d4544db4",
            "filename": "tests/modeltests/aggregation/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Faggregation%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Faggregation%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Faggregation%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,22 +1,26 @@\n # coding: utf-8\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Author(models.Model):\n     name = models.CharField(max_length=100)\n     age = models.IntegerField()\n     friends = models.ManyToManyField('self', blank=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Publisher(models.Model):\n     name = models.CharField(max_length=255)\n     num_awards = models.IntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     isbn = models.CharField(max_length=9)\n     name = models.CharField(max_length=255)\n@@ -28,15 +32,16 @@ class Book(models.Model):\n     publisher = models.ForeignKey(Publisher)\n     pubdate = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Store(models.Model):\n     name = models.CharField(max_length=255)\n     books = models.ManyToManyField(Book)\n     original_opening = models.DateTimeField()\n     friday_night_closing = models.TimeField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n "
        },
        {
            "sha": "660beddf497f01a2d90203c1ce71bd6dd5520dcc",
            "filename": "tests/modeltests/basic/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fbasic%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fbasic%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbasic%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,14 +5,16 @@\n This is a basic model with only two non-primary-key fields.\n \"\"\"\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100, default='Default headline')\n     pub_date = models.DateTimeField()\n \n     class Meta:\n         ordering = ('pub_date','headline')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline"
        },
        {
            "sha": "2fa33a9680589ff6af713bb5df9997c3a217460c",
            "filename": "tests/modeltests/choices/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fchoices%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fchoices%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fchoices%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,16 +10,18 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n GENDER_CHOICES = (\n     ('M', 'Male'),\n     ('F', 'Female'),\n )\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=20)\n     gender = models.CharField(max_length=1, choices=GENDER_CHOICES)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "16f0563d6bb0655fdb212dd16be9346ea4097a47",
            "filename": "tests/modeltests/custom_columns/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_columns%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_columns%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_columns%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -18,24 +18,27 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Author(models.Model):\n     first_name = models.CharField(max_length=30, db_column='firstname')\n     last_name = models.CharField(max_length=30, db_column='last')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s %s' % (self.first_name, self.last_name)\n \n     class Meta:\n         db_table = 'my_author_table'\n         ordering = ('last_name','first_name')\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     authors = models.ManyToManyField(Author, db_table='my_m2m_table')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     class Meta:"
        },
        {
            "sha": "de7c1772ed6204c752090a14eba57fb51eb85d2d",
            "filename": "tests/modeltests/custom_managers/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_managers%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_managers%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_managers%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,20 +12,22 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n # An example of a custom manager called \"objects\".\n \n class PersonManager(models.Manager):\n     def get_fun_people(self):\n         return self.filter(fun=True)\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     first_name = models.CharField(max_length=30)\n     last_name = models.CharField(max_length=30)\n     fun = models.BooleanField()\n     objects = PersonManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)\n \n # An example of a custom manager that sets get_query_set().\n@@ -34,14 +36,15 @@ class PublishedBookManager(models.Manager):\n     def get_query_set(self):\n         return super(PublishedBookManager, self).get_query_set().filter(is_published=True)\n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     title = models.CharField(max_length=50)\n     author = models.CharField(max_length=30)\n     is_published = models.BooleanField()\n     published_objects = PublishedBookManager()\n     authors = models.ManyToManyField(Person, related_name='books')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n # An example of providing multiple custom managers.\n@@ -50,12 +53,13 @@ class FastCarManager(models.Manager):\n     def get_query_set(self):\n         return super(FastCarManager, self).get_query_set().filter(top_speed__gt=150)\n \n+@python_2_unicode_compatible\n class Car(models.Model):\n     name = models.CharField(max_length=10)\n     mileage = models.IntegerField()\n     top_speed = models.IntegerField(help_text=\"In miles per hour.\")\n     cars = models.Manager()\n     fast_cars = FastCarManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "cef3fd722bebe39f2944035dd33d68596b595543",
            "filename": "tests/modeltests/custom_methods/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_methods%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_methods%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_methods%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,13 +7,15 @@\n import datetime\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     def was_published_today(self):"
        },
        {
            "sha": "92096a0ff7cf85115d3be073487c063c7358ed98",
            "filename": "tests/modeltests/custom_pk/fields.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_pk%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_pk%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_pk%2Ffields.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,25 +3,26 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class MyWrapper(object):\n     def __init__(self, value):\n         self.value = value\n \n     def __repr__(self):\n         return \"<%s: %s>\" % (self.__class__.__name__, self.value)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.value\n \n     def __eq__(self, other):\n         if isinstance(other, self.__class__):\n             return self.value == other.value\n         return self.value == other\n \n-class MyAutoField(models.CharField):\n-    __metaclass__ = models.SubfieldBase\n+class MyAutoField(six.with_metaclass(models.SubfieldBase, models.CharField)):\n \n     def __init__(self, *args, **kwargs):\n         kwargs['max_length'] = 10\n@@ -30,7 +31,7 @@ def __init__(self, *args, **kwargs):\n     def pre_save(self, instance, add):\n         value = getattr(instance, self.attname, None)\n         if not value:\n-            value = MyWrapper(''.join(random.sample(string.lowercase, 10)))\n+            value = MyWrapper(''.join(random.sample(string.ascii_lowercase, 10)))\n             setattr(instance, self.attname, value)\n         return value\n "
        },
        {
            "sha": "5ef9b69f0c8d67651f528fddc129b211292068c3",
            "filename": "tests/modeltests/custom_pk/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_pk%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fcustom_pk%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_pk%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,31 +11,35 @@\n from django.db import models\n \n from .fields import MyAutoField\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Employee(models.Model):\n     employee_code = models.IntegerField(primary_key=True, db_column = 'code')\n     first_name = models.CharField(max_length=20)\n     last_name = models.CharField(max_length=20)\n     class Meta:\n         ordering = ('last_name', 'first_name')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)\n \n+@python_2_unicode_compatible\n class Business(models.Model):\n     name = models.CharField(max_length=20, primary_key=True)\n     employees = models.ManyToManyField(Employee)\n     class Meta:\n         verbose_name_plural = 'businesses'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Bar(models.Model):\n     id = MyAutoField(primary_key=True, db_index=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return repr(self.pk)\n \n "
        },
        {
            "sha": "0688cbc9840745b15022c16922b2ba65340cee36",
            "filename": "tests/modeltests/defer/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fdefer%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fdefer%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdefer%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,18 +3,20 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Secondary(models.Model):\n     first = models.CharField(max_length=50)\n     second = models.CharField(max_length=50)\n \n+@python_2_unicode_compatible\n class Primary(models.Model):\n     name = models.CharField(max_length=50)\n     value = models.CharField(max_length=50)\n     related = models.ForeignKey(Secondary)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class Child(Primary):"
        },
        {
            "sha": "e0cec426eacf2230ea06ac7f56379e0f5bc27bc0",
            "filename": "tests/modeltests/delete/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fdelete%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fdelete%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdelete%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,6 +1,10 @@\n+from __future__ import unicode_literals\n+\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class R(models.Model):\n     is_default = models.BooleanField(default=False)\n "
        },
        {
            "sha": "7982f435d0cb127e8c0b82af2f9a43a9ffb30e62",
            "filename": "tests/modeltests/distinct_on_fields/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fdistinct_on_fields%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fdistinct_on_fields%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdistinct_on_fields%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,7 +1,9 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n+@python_2_unicode_compatible\n class Tag(models.Model):\n     name = models.CharField(max_length=10)\n     parent = models.ForeignKey('self', blank=True, null=True,\n@@ -10,32 +12,35 @@ class Tag(models.Model):\n     class Meta:\n         ordering = ['name']\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Celebrity(models.Model):\n     name = models.CharField(\"Name\", max_length=20)\n     greatest_fan = models.ForeignKey(\"Fan\", null=True, unique=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class Fan(models.Model):\n     fan_of = models.ForeignKey(Celebrity)\n \n+@python_2_unicode_compatible\n class Staff(models.Model):\n     id = models.IntegerField(primary_key=True)\n     name = models.CharField(max_length=50)\n     organisation = models.CharField(max_length=100)\n     tags = models.ManyToManyField(Tag, through='StaffTag')\n     coworkers = models.ManyToManyField('self')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class StaffTag(models.Model):\n     staff = models.ForeignKey(Staff)\n     tag = models.ForeignKey(Tag)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s -> %s\" % (self.tag, self.staff)"
        },
        {
            "sha": "f592a0eb135a3590ddd28ba4576e393e44c850f3",
            "filename": "tests/modeltests/expressions/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fexpressions%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fexpressions%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fexpressions%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,15 +4,18 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Employee(models.Model):\n     firstname = models.CharField(max_length=50)\n     lastname = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s %s' % (self.firstname, self.lastname)\n \n+@python_2_unicode_compatible\n class Company(models.Model):\n     name = models.CharField(max_length=100)\n     num_employees = models.PositiveIntegerField()\n@@ -25,5 +28,5 @@ class Company(models.Model):\n         related_name='company_point_of_contact_set',\n         null=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "c99d4871cd1eddb11bdd302729abffc371fbfead",
            "filename": "tests/modeltests/field_defaults/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffield_defaults%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffield_defaults%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_defaults%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -13,11 +13,13 @@\n from datetime import datetime\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100, default='Default headline')\n     pub_date = models.DateTimeField(default=datetime.now)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline"
        },
        {
            "sha": "a3867e3671edee7149191934f7f5377893665eb6",
            "filename": "tests/modeltests/field_subclassing/fields.py",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,8 +5,10 @@\n from django.db import models\n from django.utils.encoding import force_text\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Small(object):\n     \"\"\"\n     A simple class to show that non-trivial Python objects can be used as\n@@ -15,19 +17,15 @@ class Small(object):\n     def __init__(self, first, second):\n         self.first, self.second = first, second\n \n-    def __unicode__(self):\n-        return '%s%s' % (force_text(self.first), force_text(self.second))\n-\n     def __str__(self):\n-        return six.text_type(self).encode('utf-8')\n+        return '%s%s' % (force_text(self.first), force_text(self.second))\n \n-class SmallField(models.Field):\n+class SmallField(six.with_metaclass(models.SubfieldBase, models.Field)):\n     \"\"\"\n     Turns the \"Small\" class into a Django field. Because of the similarities\n     with normal character fields and the fact that Small.__unicode__ does\n     something sensible, we don't need to implement a lot here.\n     \"\"\"\n-    __metaclass__ = models.SubfieldBase\n \n     def __init__(self, *args, **kwargs):\n         kwargs['max_length'] = 2\n@@ -57,8 +55,7 @@ class SmallerField(SmallField):\n     pass\n \n \n-class JSONField(models.TextField):\n-    __metaclass__ = models.SubfieldBase\n+class JSONField(six.with_metaclass(models.SubfieldBase, models.TextField)):\n \n     description = (\"JSONField automatically serializes and desializes values to \"\n         \"and from JSON.\")"
        },
        {
            "sha": "642573cc83bf92b5635df9900fa90ee8a4225920",
            "filename": "tests/modeltests/field_subclassing/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffield_subclassing%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffield_subclassing%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,13 +8,15 @@\n from django.utils.encoding import force_text\n \n from .fields import SmallField, SmallerField, JSONField\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class MyModel(models.Model):\n     name = models.CharField(max_length=10)\n     data = SmallField('small field')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return force_text(self.name)\n \n class OtherModel(models.Model):"
        },
        {
            "sha": "71ca1032054168b93fefd1c7a6649705a791f78b",
            "filename": "tests/modeltests/files/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -20,7 +20,7 @@ def tearDown(self):\n         shutil.rmtree(temp_storage_location)\n \n     def test_files(self):\n-        temp_storage.save('tests/default.txt', ContentFile(b'default content'))\n+        temp_storage.save('tests/default.txt', ContentFile('default content'))\n         # Attempting to access a FileField from the class raises a descriptive\n         # error\n         self.assertRaises(AttributeError, lambda: Storage.normal)\n@@ -31,7 +31,7 @@ def test_files(self):\n         self.assertRaises(ValueError, lambda: obj1.normal.size)\n \n         # Saving a file enables full functionality.\n-        obj1.normal.save(\"django_test.txt\", ContentFile(b\"content\"))\n+        obj1.normal.save(\"django_test.txt\", ContentFile(\"content\"))\n         self.assertEqual(obj1.normal.name, \"tests/django_test.txt\")\n         self.assertEqual(obj1.normal.size, 7)\n         self.assertEqual(obj1.normal.read(), b\"content\")\n@@ -59,7 +59,7 @@ def test_files(self):\n \n         # Save another file with the same name.\n         obj2 = Storage()\n-        obj2.normal.save(\"django_test.txt\", ContentFile(b\"more content\"))\n+        obj2.normal.save(\"django_test.txt\", ContentFile(\"more content\"))\n         self.assertEqual(obj2.normal.name, \"tests/django_test_1.txt\")\n         self.assertEqual(obj2.normal.size, 12)\n \n@@ -70,13 +70,13 @@ def test_files(self):\n \n         # Deleting an object does not delete the file it uses.\n         obj2.delete()\n-        obj2.normal.save(\"django_test.txt\", ContentFile(b\"more content\"))\n+        obj2.normal.save(\"django_test.txt\", ContentFile(\"more content\"))\n         self.assertEqual(obj2.normal.name, \"tests/django_test_2.txt\")\n \n         # Multiple files with the same name get _N appended to them.\n         objs = [Storage() for i in range(3)]\n         for o in objs:\n-            o.normal.save(\"multiple_files.txt\", ContentFile(b\"Same Content\"))\n+            o.normal.save(\"multiple_files.txt\", ContentFile(\"Same Content\"))\n         self.assertEqual(\n             [o.normal.name for o in objs],\n             [\"tests/multiple_files.txt\", \"tests/multiple_files_1.txt\", \"tests/multiple_files_2.txt\"]\n@@ -100,7 +100,7 @@ def test_files(self):\n         # Verify the fix for #5655, making sure the directory is only\n         # determined once.\n         obj4 = Storage()\n-        obj4.random.save(\"random_file\", ContentFile(b\"random content\"))\n+        obj4.random.save(\"random_file\", ContentFile(\"random content\"))\n         self.assertTrue(obj4.random.name.endswith(\"/random_file\"))\n \n     def test_max_length(self):\n@@ -135,6 +135,6 @@ def test_context_manager(self):\n     def test_file_mode(self):\n         # Should not set mode to None if it is not present.\n         # See #14681, stdlib gzip module crashes if mode is set to None\n-        file = SimpleUploadedFile(\"mode_test.txt\", \"content\")\n+        file = SimpleUploadedFile(\"mode_test.txt\", b\"content\")\n         self.assertFalse(hasattr(file, 'mode'))\n         g = gzip.GzipFile(fileobj=file)"
        },
        {
            "sha": "8bd35019264b848c13700ac9333328ef8bd45ec9",
            "filename": "tests/modeltests/fixtures/models.py",
            "status": "modified",
            "additions": 15,
            "deletions": 7,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffixtures%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffixtures%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,57 +12,63 @@\n from django.contrib.contenttypes import generic\n from django.contrib.contenttypes.models import ContentType\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Category(models.Model):\n     title = models.CharField(max_length=100)\n     description = models.TextField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n     class Meta:\n         ordering = ('title',)\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100, default='Default headline')\n     pub_date = models.DateTimeField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     class Meta:\n         ordering = ('-pub_date', 'headline')\n \n+@python_2_unicode_compatible\n class Blog(models.Model):\n     name = models.CharField(max_length=100)\n     featured = models.ForeignKey(Article, related_name='fixtures_featured_set')\n     articles = models.ManyToManyField(Article, blank=True,\n                                       related_name='fixtures_articles_set')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Tag(models.Model):\n     name = models.CharField(max_length=100)\n     tagged_type = models.ForeignKey(ContentType, related_name=\"fixtures_tag_set\")\n     tagged_id = models.PositiveIntegerField(default=0)\n     tagged = generic.GenericForeignKey(ct_field='tagged_type',\n                                        fk_field='tagged_id')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '<%s: %s> tagged \"%s\"' % (self.tagged.__class__.__name__,\n                                          self.tagged, self.name)\n \n class PersonManager(models.Manager):\n     def get_by_natural_key(self, name):\n         return self.get(name=name)\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     objects = PersonManager()\n     name = models.CharField(max_length=100)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n     class Meta:\n@@ -79,19 +85,21 @@ class Spy(Person):\n     objects = SpyManager()\n     cover_blown = models.BooleanField(default=False)\n \n+@python_2_unicode_compatible\n class Visa(models.Model):\n     person = models.ForeignKey(Person)\n     permissions = models.ManyToManyField(Permission, blank=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s %s' % (self.person.name,\n                           ', '.join(p.name for p in self.permissions.all()))\n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     name = models.CharField(max_length=100)\n     authors = models.ManyToManyField(Person)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         authors = ' and '.join(a.name for a in self.authors.all())\n         return '%s by %s' % (self.name, authors) if authors else self.name\n "
        },
        {
            "sha": "deeba48aa9f55e710bf84b34264159e82b335e5f",
            "filename": "tests/modeltests/fixtures_model_package/models/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffixtures_model_package%2Fmodels%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ffixtures_model_package%2Fmodels%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures_model_package%2Fmodels%2F__init__.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,11 +1,13 @@\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100, default='Default headline')\n     pub_date = models.DateTimeField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     class Meta:"
        },
        {
            "sha": "2f025e660b42aff7d5a7419be3db448d02ee758e",
            "filename": "tests/modeltests/generic_relations/models.py",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fgeneric_relations%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fgeneric_relations%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fgeneric_relations%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,8 +14,10 @@\n from django.contrib.contenttypes import generic\n from django.contrib.contenttypes.models import ContentType\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class TaggedItem(models.Model):\n     \"\"\"A tag on an item.\"\"\"\n     tag = models.SlugField()\n@@ -27,12 +29,13 @@ class TaggedItem(models.Model):\n     class Meta:\n         ordering = [\"tag\", \"content_type__name\"]\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.tag\n \n class ValuableTaggedItem(TaggedItem):\n     value = models.PositiveIntegerField()\n \n+@python_2_unicode_compatible\n class Comparison(models.Model):\n     \"\"\"\n     A model that tests having multiple GenericForeignKeys\n@@ -48,9 +51,10 @@ class Comparison(models.Model):\n     first_obj = generic.GenericForeignKey(ct_field=\"content_type1\", fk_field=\"object_id1\")\n     other_obj = generic.GenericForeignKey(ct_field=\"content_type2\", fk_field=\"object_id2\")\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s is %s than %s\" % (self.first_obj, self.comparative, self.other_obj)\n \n+@python_2_unicode_compatible\n class Animal(models.Model):\n     common_name = models.CharField(max_length=150)\n     latin_name = models.CharField(max_length=150)\n@@ -60,25 +64,27 @@ class Animal(models.Model):\n                                           object_id_field=\"object_id1\",\n                                           content_type_field=\"content_type1\")\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.common_name\n \n+@python_2_unicode_compatible\n class Vegetable(models.Model):\n     name = models.CharField(max_length=150)\n     is_yucky = models.BooleanField(default=True)\n \n     tags = generic.GenericRelation(TaggedItem)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Mineral(models.Model):\n     name = models.CharField(max_length=150)\n     hardness = models.PositiveSmallIntegerField()\n \n     # note the lack of an explicit GenericRelation here...\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class GeckoManager(models.Manager):"
        },
        {
            "sha": "fe594dd802250ef1a1b1de90511007194598ead4",
            "filename": "tests/modeltests/get_latest/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fget_latest%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fget_latest%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_latest%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,23 +9,26 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateField()\n     expire_date = models.DateField()\n     class Meta:\n         get_latest_by = 'pub_date'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=30)\n     birthday = models.DateField()\n \n     # Note that this model doesn't have \"get_latest_by\" set.\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "bda060569e3c147f5b1df33e9ce611bd2d2d9da0",
            "filename": "tests/modeltests/get_object_or_404/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fget_object_or_404%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fget_object_or_404%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_object_or_404%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,23 +11,26 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Author(models.Model):\n     name = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class ArticleManager(models.Manager):\n     def get_query_set(self):\n         return super(ArticleManager, self).get_query_set().filter(authors__name__icontains='sir')\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     authors = models.ManyToManyField(Author)\n     title = models.CharField(max_length=50)\n     objects = models.Manager()\n     by_a_sir = ArticleManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title"
        },
        {
            "sha": "678f5a401c08a4113bb08723711b3a102533eed0",
            "filename": "tests/modeltests/get_or_create/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fget_or_create%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fget_or_create%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_or_create%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,14 +9,16 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     first_name = models.CharField(max_length=100)\n     last_name = models.CharField(max_length=100)\n     birthday = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s %s' % (self.first_name, self.last_name)\n \n class ManualPrimaryKeyTest(models.Model):"
        },
        {
            "sha": "e1fc68743e31634ab598702f93e610f71f38afb5",
            "filename": "tests/modeltests/invalid_models/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Finvalid_models%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Finvalid_models%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Finvalid_models%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,11 +1,11 @@\n import copy\n import sys\n-from io import BytesIO\n \n from django.core.management.validation import get_validation_errors\n from django.db.models.loading import cache, load_app\n \n from django.utils import unittest\n+from django.utils.six import StringIO\n \n \n class InvalidModelTestCase(unittest.TestCase):\n@@ -16,7 +16,7 @@ def setUp(self):\n         # coloring attached (makes matching the results easier). We restore\n         # sys.stderr afterwards.\n         self.old_stdout = sys.stdout\n-        self.stdout = BytesIO()\n+        self.stdout = StringIO()\n         sys.stdout = self.stdout\n \n         # This test adds dummy applications to the app cache. These"
        },
        {
            "sha": "f388ddf403dca795b9bb2462210991d97fef6d15",
            "filename": "tests/modeltests/lookup/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Flookup%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Flookup%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Flookup%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,21 +8,23 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Author(models.Model):\n     name = models.CharField(max_length=100)\n     class Meta:\n         ordering = ('name', )\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateTimeField()\n     author = models.ForeignKey(Author, blank=True, null=True)\n     class Meta:\n         ordering = ('-pub_date', 'headline')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n class Tag(models.Model):\n@@ -31,24 +33,27 @@ class Tag(models.Model):\n     class Meta:\n         ordering = ('name', )\n \n+@python_2_unicode_compatible\n class Season(models.Model):\n     year = models.PositiveSmallIntegerField()\n     gt = models.IntegerField(null=True, blank=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.year)\n \n+@python_2_unicode_compatible\n class Game(models.Model):\n     season = models.ForeignKey(Season, related_name='games')\n     home = models.CharField(max_length=100)\n     away = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s at %s\" % (self.away, self.home)\n \n+@python_2_unicode_compatible\n class Player(models.Model):\n     name = models.CharField(max_length=100)\n     games = models.ManyToManyField(Game, related_name='players')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "99c7b0101795fd52f89529b37547e0b8ac924d3c",
            "filename": "tests/modeltests/m2m_and_m2o/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_and_m2o%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_and_m2o%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_and_m2o%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,17 +7,19 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class User(models.Model):\n     username = models.CharField(max_length=20)\n \n+@python_2_unicode_compatible\n class Issue(models.Model):\n     num = models.IntegerField()\n     cc = models.ManyToManyField(User, blank=True, related_name='test_issue_cc')\n     client = models.ForeignKey(User, related_name='test_issue_client')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.num)\n \n     class Meta:"
        },
        {
            "sha": "e9ae422afb5a9cea8dacc360ed6e8874458c09e5",
            "filename": "tests/modeltests/m2m_intermediary/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_intermediary%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_intermediary%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_intermediary%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -12,27 +12,31 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Reporter(models.Model):\n     first_name = models.CharField(max_length=30)\n     last_name = models.CharField(max_length=30)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n+@python_2_unicode_compatible\n class Writer(models.Model):\n     reporter = models.ForeignKey(Reporter)\n     article = models.ForeignKey(Article)\n     position = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s (%s)' % (self.reporter, self.position)\n "
        },
        {
            "sha": "c2e3b030a4419f034b7f95b37a2a19e222aa09c4",
            "filename": "tests/modeltests/m2m_multiple/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_multiple%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_multiple%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_multiple%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,16 +8,19 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Category(models.Model):\n     name = models.CharField(max_length=20)\n     class Meta:\n        ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=50)\n     pub_date = models.DateTimeField()\n@@ -26,6 +29,6 @@ class Article(models.Model):\n     class Meta:\n        ordering = ('pub_date',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n "
        },
        {
            "sha": "b69930208c2bf74102d1394310b2522f75fa2c2e",
            "filename": "tests/modeltests/m2m_recursive/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_recursive%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_recursive%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_recursive%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -17,12 +17,14 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=20)\n     friends = models.ManyToManyField('self')\n     idols = models.ManyToManyField('self', symmetrical=False, related_name='stalkers')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "e997d87f21bbfc1f3787921e96c143dffe42b759",
            "filename": "tests/modeltests/m2m_signals/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_signals%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_signals%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_signals%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,15 +1,18 @@\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Part(models.Model):\n     name = models.CharField(max_length=20)\n \n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Car(models.Model):\n     name = models.CharField(max_length=20)\n     default_parts = models.ManyToManyField(Part)\n@@ -18,12 +21,13 @@ class Car(models.Model):\n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class SportsCar(Car):\n     price = models.IntegerField()\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=20)\n     fans = models.ManyToManyField('self', related_name='idols', symmetrical=False)\n@@ -32,5 +36,5 @@ class Person(models.Model):\n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "a896f6d9ff874fc51b87ba7a4dc9e2e51730db68",
            "filename": "tests/modeltests/m2m_through/models.py",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_through%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2m_through%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_through%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,18 +1,21 @@\n from datetime import datetime\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n # M2M described on one of the models\n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=128)\n \n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Group(models.Model):\n     name = models.CharField(max_length=128)\n     members = models.ManyToManyField(Person, through='Membership')\n@@ -22,9 +25,10 @@ class Group(models.Model):\n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Membership(models.Model):\n     person = models.ForeignKey(Person)\n     group = models.ForeignKey(Group)\n@@ -34,16 +38,17 @@ class Membership(models.Model):\n     class Meta:\n         ordering = ('date_joined', 'invite_reason', 'group')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s is a member of %s\" % (self.person.name, self.group.name)\n \n+@python_2_unicode_compatible\n class CustomMembership(models.Model):\n     person = models.ForeignKey(Person, db_column=\"custom_person_column\", related_name=\"custom_person_related_name\")\n     group = models.ForeignKey(Group)\n     weird_fk = models.ForeignKey(Membership, null=True)\n     date_joined = models.DateTimeField(default=datetime.now)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s is a member of %s\" % (self.person.name, self.group.name)\n \n     class Meta:\n@@ -54,11 +59,12 @@ class TestNoDefaultsOrNulls(models.Model):\n     group = models.ForeignKey(Group)\n     nodefaultnonull = models.CharField(max_length=5)\n \n+@python_2_unicode_compatible\n class PersonSelfRefM2M(models.Model):\n     name = models.CharField(max_length=5)\n     friends = models.ManyToManyField('self', through=\"Friendship\", symmetrical=False)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class Friendship(models.Model):"
        },
        {
            "sha": "2775d713dd3137d00a6d3eaf73755647f6b00bb9",
            "filename": "tests/modeltests/m2o_recursive/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2o_recursive%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fm2o_recursive%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2o_recursive%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,19 +11,22 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Category(models.Model):\n     name = models.CharField(max_length=20)\n     parent = models.ForeignKey('self', blank=True, null=True, related_name='child_set')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     full_name = models.CharField(max_length=20)\n     mother = models.ForeignKey('self', null=True, related_name='mothers_child_set')\n     father = models.ForeignKey('self', null=True, related_name='fathers_child_set')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.full_name"
        },
        {
            "sha": "a196c85092b25c2448233d73b151e064f3866680",
            "filename": "tests/modeltests/many_to_many/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmany_to_many%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmany_to_many%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_many%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,22 +8,25 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Publication(models.Model):\n     title = models.CharField(max_length=30)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n     class Meta:\n         ordering = ('title',)\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     publications = models.ManyToManyField(Publication)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     class Meta:"
        },
        {
            "sha": "4e2ed67eeaab3a5eaa300c75beaafd26e4b845f8",
            "filename": "tests/modeltests/many_to_one/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmany_to_one%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmany_to_one%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,22 +6,25 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Reporter(models.Model):\n     first_name = models.CharField(max_length=30)\n     last_name = models.CharField(max_length=30)\n     email = models.EmailField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateField()\n     reporter = models.ForeignKey(Reporter)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     class Meta:"
        },
        {
            "sha": "e00ca85928a795e2159f4c3ce3c2cd23347e0ee8",
            "filename": "tests/modeltests/many_to_one_null/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmany_to_one_null%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmany_to_one_null%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one_null%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -6,20 +6,23 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Reporter(models.Model):\n     name = models.CharField(max_length=30)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     reporter = models.ForeignKey(Reporter, null=True)\n \n     class Meta:\n         ordering = ('headline',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline"
        },
        {
            "sha": "90b019b611bc5b7d39815813c89dd7d51f0884c5",
            "filename": "tests/modeltests/model_forms/models.py",
            "status": "modified",
            "additions": 37,
            "deletions": 15,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,6 +14,7 @@\n from django.core.files.storage import FileSystemStorage\n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n temp_storage_dir = tempfile.mkdtemp(dir=os.environ['DJANGO_TEST_TEMP_DIR'])\n@@ -31,23 +32,29 @@\n     ('l', 'Live'),\n )\n \n+@python_2_unicode_compatible\n class Category(models.Model):\n     name = models.CharField(max_length=20)\n     slug = models.SlugField(max_length=20)\n     url = models.CharField('The URL', max_length=40)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+    def __repr__(self):\n+        return self.__str__()\n+\n+@python_2_unicode_compatible\n class Writer(models.Model):\n     name = models.CharField(max_length=50, help_text='Use both first and last names.')\n \n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=50)\n     slug = models.SlugField()\n@@ -64,7 +71,7 @@ def save(self):\n             self.created = datetime.date.today()\n         return super(Article, self).save()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n class ImprovedArticle(models.Model):\n@@ -76,26 +83,29 @@ class ImprovedArticleWithParentLink(models.Model):\n class BetterWriter(Writer):\n     score = models.IntegerField()\n \n+@python_2_unicode_compatible\n class WriterProfile(models.Model):\n     writer = models.OneToOneField(Writer, primary_key=True)\n     age = models.PositiveIntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s is %s\" % (self.writer, self.age)\n \n from django.contrib.localflavor.us.models import PhoneNumberField\n+@python_2_unicode_compatible\n class PhoneNumber(models.Model):\n     phone = PhoneNumberField()\n     description = models.CharField(max_length=20)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.phone\n \n+@python_2_unicode_compatible\n class TextFile(models.Model):\n     description = models.CharField(max_length=20)\n     file = models.FileField(storage=temp_storage, upload_to='tests', max_length=15)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.description\n \n try:\n@@ -110,6 +120,7 @@ def __unicode__(self):\n \n     test_images = True\n \n+    @python_2_unicode_compatible\n     class ImageFile(models.Model):\n         def custom_upload_path(self, filename):\n             path = self.path or 'tests'\n@@ -125,9 +136,10 @@ def custom_upload_path(self, filename):\n                                   width_field='width', height_field='height')\n         path = models.CharField(max_length=16, blank=True, default='')\n \n-        def __unicode__(self):\n+        def __str__(self):\n             return self.description\n \n+    @python_2_unicode_compatible\n     class OptionalImageFile(models.Model):\n         def custom_upload_path(self, filename):\n             path = self.path or 'tests'\n@@ -141,28 +153,31 @@ def custom_upload_path(self, filename):\n         height = models.IntegerField(editable=False, null=True)\n         path = models.CharField(max_length=16, blank=True, default='')\n \n-        def __unicode__(self):\n+        def __str__(self):\n             return self.description\n except ImportError:\n     test_images = False\n \n+@python_2_unicode_compatible\n class CommaSeparatedInteger(models.Model):\n     field = models.CommaSeparatedIntegerField(max_length=20)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.field\n \n+@python_2_unicode_compatible\n class Product(models.Model):\n     slug = models.SlugField(unique=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.slug\n \n+@python_2_unicode_compatible\n class Price(models.Model):\n     price = models.DecimalField(max_digits=10, decimal_places=2)\n     quantity = models.PositiveIntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s for %s\" % (self.quantity, self.price)\n \n     class Meta:\n@@ -171,6 +186,7 @@ class Meta:\n class ArticleStatus(models.Model):\n     status = models.CharField(max_length=2, choices=ARTICLE_STATUS_CHAR, blank=True, null=True)\n \n+@python_2_unicode_compatible\n class Inventory(models.Model):\n     barcode = models.PositiveIntegerField(unique=True)\n     parent = models.ForeignKey('self', to_field='barcode', blank=True, null=True)\n@@ -179,9 +195,12 @@ class Inventory(models.Model):\n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+    def __repr__(self):\n+        return self.__str__()\n+\n class Book(models.Model):\n     title = models.CharField(max_length=40)\n     author = models.ForeignKey(Writer, blank=True, null=True)\n@@ -202,31 +221,34 @@ class Meta:\n class DerivedBook(Book, BookXtra):\n     pass\n \n+@python_2_unicode_compatible\n class ExplicitPK(models.Model):\n     key = models.CharField(max_length=20, primary_key=True)\n     desc = models.CharField(max_length=20, blank=True, unique=True)\n     class Meta:\n         unique_together = ('key', 'desc')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.key\n \n+@python_2_unicode_compatible\n class Post(models.Model):\n     title = models.CharField(max_length=50, unique_for_date='posted', blank=True)\n     slug = models.CharField(max_length=50, unique_for_year='posted', blank=True)\n     subtitle = models.CharField(max_length=50, unique_for_month='posted', blank=True)\n     posted = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class DerivedPost(Post):\n     pass\n \n+@python_2_unicode_compatible\n class BigInt(models.Model):\n     biggie = models.BigIntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.biggie)\n \n class MarkupField(models.CharField):"
        },
        {
            "sha": "038ce322871a40c1b2f67ac4e1940e83f7a52a30",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 34,
            "changes": 69,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -179,14 +179,14 @@ class Meta:\n \n class ModelFormBaseTest(TestCase):\n     def test_base_form(self):\n-        self.assertEqual(BaseCategoryForm.base_fields.keys(),\n+        self.assertEqual(list(BaseCategoryForm.base_fields),\n                          ['name', 'slug', 'url'])\n \n     def test_extra_fields(self):\n         class ExtraFields(BaseCategoryForm):\n             some_extra_field = forms.BooleanField()\n \n-        self.assertEqual(ExtraFields.base_fields.keys(),\n+        self.assertEqual(list(ExtraFields.base_fields),\n                          ['name', 'slug', 'url', 'some_extra_field'])\n \n     def test_replace_field(self):\n@@ -215,7 +215,7 @@ class Meta:\n                 model = Category\n                 fields = ['url']\n \n-        self.assertEqual(LimitFields.base_fields.keys(),\n+        self.assertEqual(list(LimitFields.base_fields),\n                          ['url'])\n \n     def test_exclude_fields(self):\n@@ -224,7 +224,7 @@ class Meta:\n                 model = Category\n                 exclude = ['url']\n \n-        self.assertEqual(ExcludeFields.base_fields.keys(),\n+        self.assertEqual(list(ExcludeFields.base_fields),\n                          ['name', 'slug'])\n \n     def test_confused_form(self):\n@@ -237,7 +237,7 @@ class Meta:\n                 fields = ['name', 'url']\n                 exclude = ['url']\n \n-        self.assertEqual(ConfusedForm.base_fields.keys(),\n+        self.assertEqual(list(ConfusedForm.base_fields),\n                          ['name'])\n \n     def test_mixmodel_form(self):\n@@ -254,13 +254,13 @@ class Meta:\n             # overrides BaseCategoryForm.Meta.\n \n         self.assertEqual(\n-            MixModelForm.base_fields.keys(),\n+            list(MixModelForm.base_fields),\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n     def test_article_form(self):\n         self.assertEqual(\n-            ArticleForm.base_fields.keys(),\n+            list(ArticleForm.base_fields),\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n@@ -270,7 +270,7 @@ class BadForm(ArticleForm, BaseCategoryForm):\n             pass\n \n         self.assertEqual(\n-            BadForm.base_fields.keys(),\n+            list(BadForm.base_fields),\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n@@ -282,7 +282,7 @@ class SubCategoryForm(BaseCategoryForm):\n             \"\"\"\n             pass\n \n-        self.assertEqual(SubCategoryForm.base_fields.keys(),\n+        self.assertEqual(list(SubCategoryForm.base_fields),\n                          ['name', 'slug', 'url'])\n \n     def test_subclassmeta_form(self):\n@@ -312,7 +312,7 @@ class Meta:\n                 model = Category\n                 fields = ['url', 'name']\n \n-        self.assertEqual(OrderFields.base_fields.keys(),\n+        self.assertEqual(list(OrderFields.base_fields),\n                          ['url', 'name'])\n         self.assertHTMLEqual(\n             str(OrderFields()),\n@@ -327,7 +327,7 @@ class Meta:\n                 fields = ['slug', 'url', 'name']\n                 exclude = ['url']\n \n-        self.assertEqual(OrderFields2.base_fields.keys(),\n+        self.assertEqual(list(OrderFields2.base_fields),\n                          ['slug', 'name'])\n \n \n@@ -751,9 +751,9 @@ def test_with_data(self):\n         self.assertEqual(new_art.headline, 'New headline')\n \n         # Add some categories and test the many-to-many form output.\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n         new_art.categories.add(Category.objects.get(name='Entertainment'))\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [\"Entertainment\"])\n+        self.assertQuerysetEqual(new_art.categories.all(), [\"Entertainment\"])\n         f = TestArticleForm(auto_id=False, instance=new_art)\n         self.assertHTMLEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n <li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n@@ -815,7 +815,7 @@ def test_with_data(self):\n         new_art = f.save()\n         self.assertEqual(new_art.id == art_id_1, True)\n         new_art = Article.objects.get(id=art_id_1)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')),\n+        self.assertQuerysetEqual(new_art.categories.order_by('name'),\n                          [\"Entertainment\", \"It's a test\"])\n \n         # Now, submit form data with no categories. This deletes the existing categories.\n@@ -824,7 +824,7 @@ def test_with_data(self):\n         new_art = f.save()\n         self.assertEqual(new_art.id == art_id_1, True)\n         new_art = Article.objects.get(id=art_id_1)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n \n         # Create a new article, with categories, via the form.\n         f = ArticleForm({'headline': 'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': '1967-11-01',\n@@ -833,7 +833,7 @@ def test_with_data(self):\n         art_id_2 = new_art.id\n         self.assertEqual(art_id_2 not in (None, art_id_1), True)\n         new_art = Article.objects.get(id=art_id_2)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(new_art.categories.order_by('name'), [\"Entertainment\", \"It's a test\"])\n \n         # Create a new article, with no categories, via the form.\n         f = ArticleForm({'headline': 'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': '1967-11-01',\n@@ -842,7 +842,7 @@ def test_with_data(self):\n         art_id_3 = new_art.id\n         self.assertEqual(art_id_3 not in (None, art_id_1, art_id_2), True)\n         new_art = Article.objects.get(id=art_id_3)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n \n         # Create a new article, with categories, via the form, but use commit=False.\n         # The m2m data won't be saved until save_m2m() is invoked on the form.\n@@ -857,11 +857,11 @@ def test_with_data(self):\n \n         # The instance doesn't have m2m data yet\n         new_art = Article.objects.get(id=art_id_4)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n \n         # Save the m2m data on the form\n         f.save_m2m()\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(new_art.categories.order_by('name'), [\"Entertainment\", \"It's a test\"])\n \n         # Here, we define a custom ModelForm. Because it happens to have the same fields as\n         # the Category model, we can just call the form's save() to apply its changes to an\n@@ -1007,12 +1007,12 @@ def test_with_data(self):\n             f.clean(None)\n         with self.assertRaises(ValidationError):\n             f.clean([])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c1.id])), [\"Entertainment\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c2.id])), [\"It's a test\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([str(c1.id)])), [\"Entertainment\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([str(c1.id), str(c2.id)])), [\"Entertainment\", \"It's a test\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c1.id, str(c2.id)])), [\"Entertainment\", \"It's a test\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean((c1.id, str(c2.id)))), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([c1.id]), [\"Entertainment\"])\n+        self.assertQuerysetEqual(f.clean([c2.id]), [\"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([str(c1.id)]), [\"Entertainment\"])\n+        self.assertQuerysetEqual(f.clean([str(c1.id), str(c2.id)]), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([c1.id, str(c2.id)]), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean((c1.id, str(c2.id))), [\"Entertainment\", \"It's a test\"])\n         with self.assertRaises(ValidationError):\n             f.clean(['100'])\n         with self.assertRaises(ValidationError):\n@@ -1025,7 +1025,7 @@ def test_with_data(self):\n         # than caching it at time of instantiation.\n         c6 = Category.objects.create(id=6, name='Sixth', url='6th')\n         self.assertEqual(c6.name, 'Sixth')\n-        self.assertEqual(map(lambda o: o.name, f.clean([c6.id])), [\"Sixth\"])\n+        self.assertQuerysetEqual(f.clean([c6.id]), [\"Sixth\"])\n \n         # Delete a Category object *after* the ModelMultipleChoiceField has already been\n         # instantiated. This proves clean() checks the database during clean() rather\n@@ -1050,7 +1050,7 @@ def test_with_data(self):\n             (c1.pk, 'Entertainment'),\n             (c2.pk, \"It's a test\"),\n             (c3.pk, 'Third')])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c3.id])), [\"Third\"])\n+        self.assertQuerysetEqual(f.clean([c3.id]), [\"Third\"])\n         with self.assertRaises(ValidationError):\n             f.clean([c4.id])\n         with self.assertRaises(ValidationError):\n@@ -1066,13 +1066,13 @@ def test_with_data(self):\n \n         # OneToOneField ###############################################################\n \n-        self.assertEqual(ImprovedArticleForm.base_fields.keys(), ['article'])\n+        self.assertEqual(list(ImprovedArticleForm.base_fields), ['article'])\n \n-        self.assertEqual(ImprovedArticleWithParentLinkForm.base_fields.keys(), [])\n+        self.assertEqual(list(ImprovedArticleWithParentLinkForm.base_fields), [])\n \n         bw = BetterWriter(name='Joe Better', score=10)\n         bw.save()\n-        self.assertEqual(sorted(model_to_dict(bw).keys()),\n+        self.assertEqual(sorted(model_to_dict(bw)),\n                          ['id', 'name', 'score', 'writer_ptr'])\n \n         form = BetterWriterForm({'name': 'Some Name', 'score': 12})\n@@ -1463,7 +1463,7 @@ class Meta:\n                 model = Category\n                 fields = ['description', 'url']\n \n-        self.assertEqual(CategoryForm.base_fields.keys(),\n+        self.assertEqual(list(CategoryForm.base_fields),\n                          ['description', 'url'])\n \n         self.assertHTMLEqual(six.text_type(CategoryForm()), '''<tr><th><label for=\"id_description\">Description:</label></th><td><input type=\"text\" name=\"description\" id=\"id_description\" /></td></tr>\n@@ -1472,14 +1472,15 @@ class Meta:\n \n         field = forms.ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n         self.assertEqual(tuple(field.choices), ((86, 'Apple'), (87, 'Core'), (22, 'Pear')))\n-        self.assertEqual(map(lambda o: o.name, field.clean([86])), ['Apple'])\n+        self.assertQuerysetEqual(field.clean([86]), ['Apple'])\n \n         form = SelectInventoryForm({'items': [87, 22]})\n         self.assertEqual(form.is_valid(), True)\n         self.assertEqual(len(form.cleaned_data), 1)\n-        self.assertEqual(map(lambda o: o.name, form.cleaned_data['items']), ['Core', 'Pear'])\n+        self.assertQuerysetEqual(form.cleaned_data['items'], ['Core', 'Pear'])\n \n     def test_model_field_that_returns_none_to_exclude_itself_with_explicit_fields(self):\n-        self.assertEqual(CustomFieldForExclusionForm.base_fields.keys(), ['name'])\n+        self.assertEqual(list(CustomFieldForExclusionForm.base_fields),\n+                         ['name'])\n         self.assertHTMLEqual(six.text_type(CustomFieldForExclusionForm()),\n                          '''<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"10\" /></td></tr>''')"
        },
        {
            "sha": "ae152448abd15b38d13c9f71aca3b2a865a0be1a",
            "filename": "tests/modeltests/model_formsets/models.py",
            "status": "modified",
            "additions": 37,
            "deletions": 18,
            "changes": 55,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_formsets%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_formsets%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_formsets%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,20 +4,23 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Author(models.Model):\n     name = models.CharField(max_length=100)\n \n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class BetterAuthor(Author):\n     write_speed = models.IntegerField()\n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     author = models.ForeignKey(Author)\n     title = models.CharField(max_length=100)\n@@ -28,20 +31,22 @@ class Meta:\n         )\n         ordering = ['id']\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n+@python_2_unicode_compatible\n class BookWithCustomPK(models.Model):\n     my_pk = models.DecimalField(max_digits=5, decimal_places=0, primary_key=True)\n     author = models.ForeignKey(Author)\n     title = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s: %s' % (self.my_pk, self.title)\n \n class Editor(models.Model):\n     name = models.CharField(max_length=100)\n \n+@python_2_unicode_compatible\n class BookWithOptionalAltEditor(models.Model):\n     author = models.ForeignKey(Author)\n     # Optional secondary author\n@@ -53,21 +58,23 @@ class Meta:\n             ('author', 'title', 'alt_editor'),\n         )\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n+@python_2_unicode_compatible\n class AlternateBook(Book):\n     notes = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s - %s' % (self.title, self.notes)\n \n+@python_2_unicode_compatible\n class AuthorMeeting(models.Model):\n     name = models.CharField(max_length=100)\n     authors = models.ManyToManyField(Author)\n     created = models.DateField(editable=False)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class CustomPrimaryKey(models.Model):\n@@ -77,19 +84,21 @@ class CustomPrimaryKey(models.Model):\n \n # models for inheritance tests.\n \n+@python_2_unicode_compatible\n class Place(models.Model):\n     name = models.CharField(max_length=50)\n     city = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Owner(models.Model):\n     auto_id = models.AutoField(primary_key=True)\n     name = models.CharField(max_length=100)\n     place = models.ForeignKey(Place)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s at %s\" % (self.name, self.place)\n \n class Location(models.Model):\n@@ -98,30 +107,34 @@ class Location(models.Model):\n     lat = models.CharField(max_length=100)\n     lon = models.CharField(max_length=100)\n \n+@python_2_unicode_compatible\n class OwnerProfile(models.Model):\n     owner = models.OneToOneField(Owner, primary_key=True)\n     age = models.PositiveIntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s is %d\" % (self.owner.name, self.age)\n \n+@python_2_unicode_compatible\n class Restaurant(Place):\n     serves_pizza = models.BooleanField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Product(models.Model):\n     slug = models.SlugField(unique=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.slug\n \n+@python_2_unicode_compatible\n class Price(models.Model):\n     price = models.DecimalField(max_digits=10, decimal_places=2)\n     quantity = models.PositiveIntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s for %s\" % (self.quantity, self.price)\n \n     class Meta:\n@@ -136,20 +149,22 @@ class ClassyMexicanRestaurant(MexicanRestaurant):\n \n # models for testing unique_together validation when a fk is involved and\n # using inlineformset_factory.\n+@python_2_unicode_compatible\n class Repository(models.Model):\n     name = models.CharField(max_length=25)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Revision(models.Model):\n     repository = models.ForeignKey(Repository)\n     revision = models.CharField(max_length=40)\n \n     class Meta:\n         unique_together = ((\"repository\", \"revision\"),)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s (%s)\" % (self.revision, six.text_type(self.repository))\n \n # models for testing callable defaults (see bug #7975). If you define a model\n@@ -167,32 +182,36 @@ class Membership(models.Model):\n class Team(models.Model):\n     name = models.CharField(max_length=100)\n \n+@python_2_unicode_compatible\n class Player(models.Model):\n     team = models.ForeignKey(Team, null=True)\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n # Models for testing custom ModelForm save methods in formsets and inline formsets\n+@python_2_unicode_compatible\n class Poet(models.Model):\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Poem(models.Model):\n     poet = models.ForeignKey(Poet)\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Post(models.Model):\n     title = models.CharField(max_length=50, unique_for_date='posted', blank=True)\n     slug = models.CharField(max_length=50, unique_for_year='posted', blank=True)\n     subtitle = models.CharField(max_length=50, unique_for_month='posted', blank=True)\n     posted = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "2101f394f77043863f2a363d79d6b1d448adde0b",
            "filename": "tests/modeltests/model_inheritance/models.py",
            "status": "modified",
            "additions": 19,
            "deletions": 9,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_inheritance%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_inheritance%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_inheritance%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,11 +14,13 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n #\n # Abstract base classes\n #\n \n+@python_2_unicode_compatible\n class CommonInfo(models.Model):\n     name = models.CharField(max_length=50)\n     age = models.PositiveIntegerField()\n@@ -27,7 +29,7 @@ class Meta:\n         abstract = True\n         ordering = ['name']\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s %s' % (self.__class__.__name__, self.name)\n \n class Worker(CommonInfo):\n@@ -49,14 +51,15 @@ class StudentWorker(Student, Worker):\n class Post(models.Model):\n     title = models.CharField(max_length=50)\n \n+@python_2_unicode_compatible\n class Attachment(models.Model):\n     post = models.ForeignKey(Post, related_name='attached_%(class)s_set')\n     content = models.TextField()\n \n     class Meta:\n         abstract = True\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.content\n \n class Comment(Attachment):\n@@ -69,17 +72,19 @@ class Link(Attachment):\n # Multi-table inheritance\n #\n \n+@python_2_unicode_compatible\n class Chef(models.Model):\n     name = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the chef\" % self.name\n \n+@python_2_unicode_compatible\n class Place(models.Model):\n     name = models.CharField(max_length=50)\n     address = models.CharField(max_length=80)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the place\" % self.name\n \n class Rating(models.Model):\n@@ -89,6 +94,7 @@ class Meta:\n         abstract = True\n         ordering = ['-rating']\n \n+@python_2_unicode_compatible\n class Restaurant(Place, Rating):\n     serves_hot_dogs = models.BooleanField()\n     serves_pizza = models.BooleanField()\n@@ -97,27 +103,30 @@ class Restaurant(Place, Rating):\n     class Meta(Rating.Meta):\n         db_table = 'my_restaurant'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the restaurant\" % self.name\n \n+@python_2_unicode_compatible\n class ItalianRestaurant(Restaurant):\n     serves_gnocchi = models.BooleanField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the italian restaurant\" % self.name\n \n+@python_2_unicode_compatible\n class Supplier(Place):\n     customers = models.ManyToManyField(Restaurant, related_name='provider')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the supplier\" % self.name\n \n+@python_2_unicode_compatible\n class ParkingLot(Place):\n     # An explicit link to the parent (we can control the attribute name).\n     parent = models.OneToOneField(Place, primary_key=True, parent_link=True)\n     main_site = models.ForeignKey(Place, related_name='lot')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the parking lot\" % self.name\n \n #\n@@ -139,10 +148,11 @@ class NamedURL(models.Model):\n     class Meta:\n         abstract = True\n \n+@python_2_unicode_compatible\n class Copy(NamedURL):\n     content = models.TextField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.content\n \n class Mixin(object):"
        },
        {
            "sha": "801724df182fda5d0330645ffdcc1a248e0e4b99",
            "filename": "tests/modeltests/model_inheritance_same_model_name/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_inheritance_same_model_name%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fmodel_inheritance_same_model_name%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_inheritance_same_model_name%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,12 +11,14 @@\n from django.db import models\n \n from ..model_inheritance.models import NamedURL\n+from django.utils.encoding import python_2_unicode_compatible\n \n #\n # Abstract base classes with related models\n #\n+@python_2_unicode_compatible\n class Copy(NamedURL):\n     content = models.TextField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.content"
        },
        {
            "sha": "9599496cb7d67a65833a8783f9bc0ed50e4e387e",
            "filename": "tests/modeltests/one_to_one/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fone_to_one%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fone_to_one%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fone_to_one%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,28 +8,32 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Place(models.Model):\n     name = models.CharField(max_length=50)\n     address = models.CharField(max_length=80)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the place\" % self.name\n \n+@python_2_unicode_compatible\n class Restaurant(models.Model):\n     place = models.OneToOneField(Place, primary_key=True)\n     serves_hot_dogs = models.BooleanField()\n     serves_pizza = models.BooleanField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the restaurant\" % self.place.name\n \n+@python_2_unicode_compatible\n class Waiter(models.Model):\n     restaurant = models.ForeignKey(Restaurant)\n     name = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s the waiter at %s\" % (self.name, self.restaurant)\n \n class ManualPrimaryKey(models.Model):\n@@ -40,10 +44,11 @@ class RelatedModel(models.Model):\n     link = models.OneToOneField(ManualPrimaryKey)\n     name = models.CharField(max_length = 50)\n \n+@python_2_unicode_compatible\n class MultiModel(models.Model):\n     link1 = models.OneToOneField(Place)\n     link2 = models.OneToOneField(ManualPrimaryKey)\n     name = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"Multimodel %s\" % self.name"
        },
        {
            "sha": "f146b2e72ddf69d4cd263671ca990e61606478cc",
            "filename": "tests/modeltests/or_lookups/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2For_lookups%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2For_lookups%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2For_lookups%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,14 +10,16 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=50)\n     pub_date = models.DateTimeField()\n \n     class Meta:\n        ordering = ('pub_date',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline"
        },
        {
            "sha": "06bb56b14197ac64fb7d3113cd2ff8c318cf11d7",
            "filename": "tests/modeltests/order_with_respect_to/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Forder_with_respect_to%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Forder_with_respect_to%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Forder_with_respect_to%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,27 +4,30 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Question(models.Model):\n     text = models.CharField(max_length=200)\n \n+@python_2_unicode_compatible\n class Answer(models.Model):\n     text = models.CharField(max_length=200)\n     question = models.ForeignKey(Question)\n \n     class Meta:\n         order_with_respect_to = 'question'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.text)\n \n+@python_2_unicode_compatible\n class Post(models.Model):\n     title = models.CharField(max_length=200)\n     parent = models.ForeignKey(\"self\", related_name=\"children\", null=True)\n \n     class Meta:\n         order_with_respect_to = \"parent\"\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title"
        },
        {
            "sha": "67126e1bdaea5b9565163e970af0b417f1caca8e",
            "filename": "tests/modeltests/ordering/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fordering%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fordering%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fordering%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -14,22 +14,25 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateTimeField()\n     class Meta:\n         ordering = ('-pub_date', 'headline')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n+@python_2_unicode_compatible\n class ArticlePKOrdering(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateTimeField()\n     class Meta:\n         ordering = ('-pk',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline"
        },
        {
            "sha": "779d3029ba3522ff5e144b080190e94e72601dc5",
            "filename": "tests/modeltests/pagination/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fpagination%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fpagination%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fpagination%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,11 +7,13 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100, default='Default headline')\n     pub_date = models.DateTimeField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline"
        },
        {
            "sha": "12ce0e3ecbc322c2347a1c3b880dc8da68f3bf7a",
            "filename": "tests/modeltests/pagination/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fpagination%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fpagination%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fpagination%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -28,7 +28,7 @@ def test_paginator(self):\n         paginator = Paginator(Article.objects.all(), 5)\n         self.assertEqual(9, paginator.count)\n         self.assertEqual(2, paginator.num_pages)\n-        self.assertEqual([1, 2], paginator.page_range)\n+        self.assertEqual([1, 2], list(paginator.page_range))\n \n     def test_first_page(self):\n         paginator = Paginator(Article.objects.all(), 5)\n@@ -78,13 +78,13 @@ def test_empty_page(self):\n         paginator = Paginator(Article.objects.filter(id=0), 5, allow_empty_first_page=True)\n         self.assertEqual(0, paginator.count)\n         self.assertEqual(1, paginator.num_pages)\n-        self.assertEqual([1], paginator.page_range)\n+        self.assertEqual([1], list(paginator.page_range))\n \n         # Empty paginators with allow_empty_first_page=False.\n         paginator = Paginator(Article.objects.filter(id=0), 5, allow_empty_first_page=False)\n         self.assertEqual(0, paginator.count)\n         self.assertEqual(0, paginator.num_pages)\n-        self.assertEqual([], paginator.page_range)\n+        self.assertEqual([], list(paginator.page_range))\n \n     def test_invalid_page(self):\n         paginator = Paginator(Article.objects.all(), 5)\n@@ -108,7 +108,7 @@ def test_paginate_list(self):\n         paginator = Paginator([1, 2, 3, 4, 5, 6, 7, 8, 9], 3)\n         self.assertEqual(9, paginator.count)\n         self.assertEqual(3, paginator.num_pages)\n-        self.assertEqual([1, 2, 3], paginator.page_range)\n+        self.assertEqual([1, 2, 3], list(paginator.page_range))\n         p = paginator.page(2)\n         self.assertEqual(\"<Page 2 of 3>\", six.text_type(p))\n         self.assertEqual([4, 5, 6], p.object_list)\n@@ -125,10 +125,10 @@ def test_paginate_misc_classes(self):\n         paginator = Paginator(CountContainer(), 10)\n         self.assertEqual(42, paginator.count)\n         self.assertEqual(5, paginator.num_pages)\n-        self.assertEqual([1, 2, 3, 4, 5], paginator.page_range)\n+        self.assertEqual([1, 2, 3, 4, 5], list(paginator.page_range))\n \n         # Paginator can be passed other objects that implement __len__.\n         paginator = Paginator(LenContainer(), 10)\n         self.assertEqual(42, paginator.count)\n         self.assertEqual(5, paginator.num_pages)\n-        self.assertEqual([1, 2, 3, 4, 5], paginator.page_range)\n+        self.assertEqual([1, 2, 3, 4, 5], list(paginator.page_range))"
        },
        {
            "sha": "85488f08790d32ae272309261d060cdfbede2242",
            "filename": "tests/modeltests/prefetch_related/models.py",
            "status": "modified",
            "additions": 15,
            "deletions": 7,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fprefetch_related%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fprefetch_related%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fprefetch_related%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,16 +1,18 @@\n from django.contrib.contenttypes import generic\n from django.contrib.contenttypes.models import ContentType\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n ## Basic tests\n \n+@python_2_unicode_compatible\n class Author(models.Model):\n     name = models.CharField(max_length=50, unique=True)\n     first_book = models.ForeignKey('Book', related_name='first_time_authors')\n     favorite_authors = models.ManyToManyField(\n         'self', through='FavoriteAuthors', symmetrical=False, related_name='favors_me')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n     class Meta:\n@@ -30,22 +32,24 @@ class Meta:\n          ordering = ['id']\n \n \n+@python_2_unicode_compatible\n class AuthorAddress(models.Model):\n     author = models.ForeignKey(Author, to_field='name', related_name='addresses')\n     address = models.TextField()\n \n     class Meta:\n         ordering = ['id']\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.address\n \n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     title = models.CharField(max_length=255)\n     authors = models.ManyToManyField(Author, related_name='books')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n     class Meta:\n@@ -58,11 +62,12 @@ class BookWithYear(Book):\n         AuthorWithAge, related_name='books_with_year')\n \n \n+@python_2_unicode_compatible\n class Reader(models.Model):\n     name = models.CharField(max_length=50)\n     books_read = models.ManyToManyField(Book, related_name='read_by')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n     class Meta:\n@@ -86,13 +91,14 @@ def get_query_set(self):\n         return super(TeacherManager, self).get_query_set().prefetch_related('qualifications')\n \n \n+@python_2_unicode_compatible\n class Teacher(models.Model):\n     name = models.CharField(max_length=50)\n     qualifications = models.ManyToManyField(Qualification)\n \n     objects = TeacherManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s (%s)\" % (self.name, \", \".join(q.name for q in self.qualifications.all()))\n \n     class Meta:\n@@ -109,6 +115,7 @@ class Meta:\n \n ## GenericRelation/GenericForeignKey tests\n \n+@python_2_unicode_compatible\n class TaggedItem(models.Model):\n     tag = models.SlugField()\n     content_type = models.ForeignKey(ContentType, related_name=\"taggeditem_set2\")\n@@ -119,7 +126,7 @@ class TaggedItem(models.Model):\n     created_by_fkey = models.PositiveIntegerField(null=True)\n     created_by = generic.GenericForeignKey('created_by_ct', 'created_by_fkey',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.tag\n \n \n@@ -169,12 +176,13 @@ class Meta:\n \n ## Models for nullable FK tests\n \n+@python_2_unicode_compatible\n class Employee(models.Model):\n     name = models.CharField(max_length=50)\n     boss = models.ForeignKey('self', null=True,\n                              related_name='serfs')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n     class Meta:"
        },
        {
            "sha": "614a5fc1d6c2c2ffd4f665bca18ce03237816a1a",
            "filename": "tests/modeltests/prefetch_related/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fprefetch_related%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fprefetch_related%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fprefetch_related%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -352,7 +352,7 @@ def test_foreignkey_to_inherited(self):\n         with self.assertNumQueries(2):\n             qs = BookReview.objects.prefetch_related('book')\n             titles = [obj.book.title for obj in qs]\n-        self.assertEquals(titles, [\"Poems\", \"More poems\"])\n+        self.assertEqual(titles, [\"Poems\", \"More poems\"])\n \n     def test_m2m_to_inheriting_model(self):\n         qs = AuthorWithAge.objects.prefetch_related('books_with_year')"
        },
        {
            "sha": "39fee7ee6dcd0fad02344ad611c4b3cb27de8c68",
            "filename": "tests/modeltests/proxy_model_inheritance/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fproxy_model_inheritance%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fproxy_model_inheritance%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fproxy_model_inheritance%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -24,7 +24,8 @@ class ProxyModelInheritanceTests(TransactionTestCase):\n     def setUp(self):\n         self.old_sys_path = sys.path[:]\n         sys.path.append(os.path.dirname(os.path.abspath(__file__)))\n-        map(load_app, settings.INSTALLED_APPS)\n+        for app in settings.INSTALLED_APPS:\n+            load_app(app)\n \n     def tearDown(self):\n         sys.path = self.old_sys_path"
        },
        {
            "sha": "6c962aadc8c907b81b84c4fd508a6825a7a1ae85",
            "filename": "tests/modeltests/proxy_models/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fproxy_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fproxy_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fproxy_models%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,6 +5,7 @@\n providing a modified interface to the data from the base class.\n \"\"\"\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n # A couple of managers for testing managing overriding in proxy model cases.\n \n@@ -16,6 +17,7 @@ class SubManager(models.Manager):\n     def get_query_set(self):\n         return super(SubManager, self).get_query_set().exclude(name=\"wilma\")\n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     \"\"\"\n     A simple concrete base class.\n@@ -24,7 +26,7 @@ class Person(models.Model):\n \n     objects = PersonManager()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class Abstract(models.Model):\n@@ -82,10 +84,11 @@ class Meta:\n class LowerStatusPerson(MyPersonProxy):\n     status = models.CharField(max_length=80)\n \n+@python_2_unicode_compatible\n class User(models.Model):\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class UserProxy(User):\n@@ -100,11 +103,12 @@ class Meta:\n class Country(models.Model):\n     name = models.CharField(max_length=50)\n \n+@python_2_unicode_compatible\n class State(models.Model):\n     name = models.CharField(max_length=50)\n     country = models.ForeignKey(Country)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class StateProxy(State):\n@@ -124,11 +128,12 @@ class Meta:\n         proxy = True\n \n \n+@python_2_unicode_compatible\n class Issue(models.Model):\n     summary = models.CharField(max_length=255)\n     assignee = models.ForeignKey(TrackerUser)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return ':'.join((self.__class__.__name__,self.summary,))\n \n class Bug(Issue):"
        },
        {
            "sha": "8e942b20e8e2a12a02e65b08345449dddef81bc9",
            "filename": "tests/modeltests/reserved_names/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Freserved_names%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Freserved_names%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Freserved_names%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,8 +8,10 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Thing(models.Model):\n     when = models.CharField(max_length=1, primary_key=True)\n     join = models.CharField(max_length=1)\n@@ -22,5 +24,5 @@ class Thing(models.Model):\n     class Meta:\n        db_table = 'select'\n \n-    def __unicode__(self):\n-        return self.when\n\\ No newline at end of file\n+    def __str__(self):\n+        return self.when"
        },
        {
            "sha": "ed58177770908e8b65c7b8fdcd18a8468fad2ebd",
            "filename": "tests/modeltests/reverse_lookup/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Freverse_lookup%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Freverse_lookup%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Freverse_lookup%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,25 +5,29 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class User(models.Model):\n     name = models.CharField(max_length=200)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Poll(models.Model):\n     question = models.CharField(max_length=200)\n     creator = models.ForeignKey(User)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.question\n \n+@python_2_unicode_compatible\n class Choice(models.Model):\n     name = models.CharField(max_length=100)\n     poll = models.ForeignKey(Poll, related_name=\"poll_choice\")\n     related_poll = models.ForeignKey(Poll, related_name=\"related_choice\")\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "a6e1abfb77fc7c89352a0309453a61a12cf5156a",
            "filename": "tests/modeltests/save_delete_hooks/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fsave_delete_hooks%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fsave_delete_hooks%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fsave_delete_hooks%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,8 +7,10 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     first_name = models.CharField(max_length=20)\n     last_name = models.CharField(max_length=20)\n@@ -17,7 +19,7 @@ def __init__(self, *args, **kwargs):\n         super(Person, self).__init__(*args, **kwargs)\n         self.data = []\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)\n \n     def save(self, *args, **kwargs):"
        },
        {
            "sha": "ec41957adfc2a3f486beefd9652799b7abd9e4d0",
            "filename": "tests/modeltests/select_related/models.py",
            "status": "modified",
            "additions": 18,
            "deletions": 9,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fselect_related%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fselect_related%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fselect_related%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -8,52 +8,61 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n # Who remembers high school biology?\n \n+@python_2_unicode_compatible\n class Domain(models.Model):\n     name = models.CharField(max_length=50)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Kingdom(models.Model):\n     name = models.CharField(max_length=50)\n     domain = models.ForeignKey(Domain)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Phylum(models.Model):\n     name = models.CharField(max_length=50)\n     kingdom = models.ForeignKey(Kingdom)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Klass(models.Model):\n     name = models.CharField(max_length=50)\n     phylum = models.ForeignKey(Phylum)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Order(models.Model):\n     name = models.CharField(max_length=50)\n     klass = models.ForeignKey(Klass)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Family(models.Model):\n     name = models.CharField(max_length=50)\n     order = models.ForeignKey(Order)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Genus(models.Model):\n     name = models.CharField(max_length=50)\n     family = models.ForeignKey(Family)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Species(models.Model):\n     name = models.CharField(max_length=50)\n     genus = models.ForeignKey(Genus)\n-    def __unicode__(self):\n-        return self.name\n\\ No newline at end of file\n+    def __str__(self):\n+        return self.name"
        },
        {
            "sha": "569f2cec49e1d250cff142c11240971e562adb0b",
            "filename": "tests/modeltests/serializers/models.py",
            "status": "modified",
            "additions": 17,
            "deletions": 12,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fserializers%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fserializers%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fserializers%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -11,28 +11,32 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Category(models.Model):\n     name = models.CharField(max_length=20)\n \n     class Meta:\n        ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Author(models.Model):\n     name = models.CharField(max_length=20)\n \n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     author = models.ForeignKey(Author)\n     headline = models.CharField(max_length=50)\n@@ -42,28 +46,31 @@ class Article(models.Model):\n     class Meta:\n        ordering = ('pub_date',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n \n+@python_2_unicode_compatible\n class AuthorProfile(models.Model):\n     author = models.OneToOneField(Author, primary_key=True)\n     date_of_birth = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"Profile of %s\" % self.author\n \n \n+@python_2_unicode_compatible\n class Actor(models.Model):\n     name = models.CharField(max_length=20, primary_key=True)\n \n     class Meta:\n         ordering = ('name',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Movie(models.Model):\n     actor = models.ForeignKey(Actor)\n     title = models.CharField(max_length=50)\n@@ -72,30 +79,27 @@ class Movie(models.Model):\n     class Meta:\n        ordering = ('title',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n \n class Score(models.Model):\n     score = models.FloatField()\n \n \n+@python_2_unicode_compatible\n class Team(object):\n     def __init__(self, title):\n         self.title = title\n \n-    def __unicode__(self):\n-        raise NotImplementedError(\"Not so simple\")\n-\n     def __str__(self):\n         raise NotImplementedError(\"Not so simple\")\n \n     def to_string(self):\n         return \"%s\" % self.title\n \n \n-class TeamField(models.CharField):\n-    __metaclass__ = models.SubfieldBase\n+class TeamField(six.with_metaclass(models.SubfieldBase, models.CharField)):\n \n     def __init__(self):\n         super(TeamField, self).__init__(max_length=100)\n@@ -112,10 +116,11 @@ def value_to_string(self, obj):\n         return self._get_val_from_obj(obj).to_string()\n \n \n+@python_2_unicode_compatible\n class Player(models.Model):\n     name = models.CharField(max_length=50)\n     rank = models.IntegerField()\n     team = TeamField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s (%d) playing for %s' % (self.name, self.rank, self.team.to_string())"
        },
        {
            "sha": "e39f17b68a23b136194152a1253ede0573c5c701",
            "filename": "tests/modeltests/serializers/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fserializers%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -114,8 +114,8 @@ def test_altering_serialized_output(self):\n         Tests the ability to create new objects by\n         modifying serialized content.\n         \"\"\"\n-        old_headline = b\"Poker has no place on ESPN\"\n-        new_headline = b\"Poker has no place on television\"\n+        old_headline = \"Poker has no place on ESPN\"\n+        new_headline = \"Poker has no place on television\"\n         serial_str = serializers.serialize(self.serializer_name,\n                                            Article.objects.all())\n         serial_str = serial_str.replace(old_headline, new_headline)\n@@ -285,7 +285,7 @@ def test_forward_refs(self):\n \n class XmlSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"xml\"\n-    pkless_str = b\"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+    pkless_str = \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object model=\"serializers.category\">\n         <field type=\"CharField\" name=\"name\">Reference</field>\n@@ -331,7 +331,7 @@ def _get_field_values(serial_str, field_name):\n \n class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n     serializer_name = \"xml\"\n-    fwd_ref_str = b\"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+    fwd_ref_str = \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object pk=\"1\" model=\"serializers.article\">\n         <field to=\"serializers.author\" name=\"author\" rel=\"ManyToOneRel\">1</field>\n@@ -351,7 +351,7 @@ class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, Transacti\n \n class JsonSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"json\"\n-    pkless_str = b\"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n+    pkless_str = \"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n \n     @staticmethod\n     def _validate_output(serial_str):\n@@ -381,7 +381,7 @@ def _get_field_values(serial_str, field_name):\n \n class JsonSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n     serializer_name = \"json\"\n-    fwd_ref_str = b\"\"\"[\n+    fwd_ref_str = \"\"\"[\n     {\n         \"pk\": 1,\n         \"model\": \"serializers.article\",\n@@ -414,7 +414,7 @@ class JsonSerializerTransactionTestCase(SerializersTransactionTestBase, Transact\n else:\n     class YamlSerializerTestCase(SerializersTestBase, TestCase):\n         serializer_name = \"yaml\"\n-        fwd_ref_str = b\"\"\"- fields:\n+        fwd_ref_str = \"\"\"- fields:\n     headline: Forward references pose no problem\n     pub_date: 2006-06-16 15:00:00\n     categories: [1]\n@@ -430,7 +430,7 @@ class YamlSerializerTestCase(SerializersTestBase, TestCase):\n   pk: 1\n   model: serializers.author\"\"\"\n \n-        pkless_str = b\"\"\"- fields:\n+        pkless_str = \"\"\"- fields:\n     name: Reference\n   pk: null\n   model: serializers.category\"\"\"\n@@ -470,7 +470,7 @@ def _get_field_values(serial_str, field_name):\n \n     class YamlSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n         serializer_name = \"yaml\"\n-        fwd_ref_str = b\"\"\"- fields:\n+        fwd_ref_str = \"\"\"- fields:\n     headline: Forward references pose no problem\n     pub_date: 2006-06-16 15:00:00\n     categories: [1]"
        },
        {
            "sha": "e54a22fce9c88368f0de1c2e5060c6dad5bbf82c",
            "filename": "tests/modeltests/signals/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fsignals%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fsignals%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fsignals%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,18 +4,21 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     first_name = models.CharField(max_length=20)\n     last_name = models.CharField(max_length=20)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)\n \n+@python_2_unicode_compatible\n class Car(models.Model):\n     make = models.CharField(max_length=20)\n     model = models.CharField(max_length=20)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.make, self.model)"
        },
        {
            "sha": "488012e8619e43d122de9767961db3f03c53912b",
            "filename": "tests/modeltests/str/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fstr%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fstr%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fstr%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -15,6 +15,7 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Article(models.Model):\n@@ -26,9 +27,10 @@ def __str__(self):\n         # in ASCII.\n         return self.headline\n \n+@python_2_unicode_compatible\n class InternationalArticle(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateTimeField()\n \n-    def __unicode__(self):\n-        return self.headline\n\\ No newline at end of file\n+    def __str__(self):\n+        return self.headline"
        },
        {
            "sha": "2c11ac8c789493a0632d1fd0f867195fbef2fada",
            "filename": "tests/modeltests/str/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fstr%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fstr%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fstr%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,23 +4,32 @@\n import datetime\n \n from django.test import TestCase\n+from django.utils import six\n+from django.utils.unittest import skipIf\n \n from .models import Article, InternationalArticle\n \n \n class SimpleTests(TestCase):\n+\n+    @skipIf(six.PY3, \"tests a __str__ method returning unicode under Python 2\")\n     def test_basic(self):\n         a = Article.objects.create(\n             headline=b'Area man programs in Python',\n             pub_date=datetime.datetime(2005, 7, 28)\n         )\n-        self.assertEqual(str(a), b'Area man programs in Python')\n-        self.assertEqual(repr(a), b'<Article: Area man programs in Python>')\n+        self.assertEqual(str(a), str('Area man programs in Python'))\n+        self.assertEqual(repr(a), str('<Article: Area man programs in Python>'))\n \n     def test_international(self):\n         a = InternationalArticle.objects.create(\n             headline='Girl wins 12.500 in lottery',\n             pub_date=datetime.datetime(2005, 7, 28)\n         )\n-        # The default str() output will be the UTF-8 encoded output of __unicode__().\n-        self.assertEqual(str(a), b'Girl wins \\xe2\\x82\\xac12.500 in lottery')\n+        if six.PY3:\n+            self.assertEqual(str(a), 'Girl wins 12.500 in lottery')\n+        else:\n+            # On Python 2, the default str() output will be the UTF-8 encoded\n+            # output of __unicode__() -- or __str__() when the\n+            # python_2_unicode_compatible decorator is used.\n+            self.assertEqual(str(a), b'Girl wins \\xe2\\x82\\xac12.500 in lottery')"
        },
        {
            "sha": "1d9c999f21b0c0bc6279a5cca1a712c16f7f25bb",
            "filename": "tests/modeltests/test_client/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ftest_client%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ftest_client%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftest_client%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -91,7 +91,7 @@ def test_raw_post(self):\n                                     content_type=\"text/xml\")\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.templates[0].name, \"Book template\")\n-        self.assertEqual(response.content, \"Blink - Malcolm Gladwell\")\n+        self.assertEqual(response.content, b\"Blink - Malcolm Gladwell\")\n \n     def test_redirect(self):\n         \"GET a URL that redirects elsewhere\""
        },
        {
            "sha": "4621f0a60cdb71161c5316de97456d06c6698dee",
            "filename": "tests/modeltests/timezones/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftimezones%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -467,6 +467,7 @@ def test_raw_sql(self):\n                 [event],\n                 transform=lambda d: d)\n \n+    @requires_tz_support\n     def test_filter_date_field_with_aware_datetime(self):\n         # Regression test for #17742\n         day = datetime.date(2011, 9, 1)"
        },
        {
            "sha": "0f8d6b16ec17abc401e7c20c6796dd26a64cb60c",
            "filename": "tests/modeltests/transactions/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ftransactions%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Ftransactions%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftransactions%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -9,8 +9,10 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Reporter(models.Model):\n     first_name = models.CharField(max_length=30)\n     last_name = models.CharField(max_length=30)\n@@ -19,5 +21,5 @@ class Reporter(models.Model):\n     class Meta:\n         ordering = ('first_name', 'last_name')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.first_name, self.last_name)"
        },
        {
            "sha": "0eef69977c256267a4b9436b38176b885b59c394",
            "filename": "tests/modeltests/unmanaged_models/models.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Funmanaged_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Funmanaged_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Funmanaged_models%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,19 +4,22 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n #  All of these models are created in the database by Django.\n \n+@python_2_unicode_compatible\n class A01(models.Model):\n     f_a = models.CharField(max_length=10, db_index=True)\n     f_b = models.IntegerField()\n \n     class Meta:\n         db_table = 'a01'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.f_a\n \n+@python_2_unicode_compatible\n class B01(models.Model):\n     fk_a = models.ForeignKey(A01)\n     f_a = models.CharField(max_length=10, db_index=True)\n@@ -27,9 +30,10 @@ class Meta:\n         # 'managed' is True by default. This tests we can set it explicitly.\n         managed = True\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.f_a\n \n+@python_2_unicode_compatible\n class C01(models.Model):\n     mm_a = models.ManyToManyField(A01, db_table='d01')\n     f_a = models.CharField(max_length=10, db_index=True)\n@@ -38,23 +42,25 @@ class C01(models.Model):\n     class Meta:\n         db_table = 'c01'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.f_a\n \n # All of these models use the same tables as the previous set (they are shadows\n # of possibly a subset of the columns). There should be no creation errors,\n # since we have told Django they aren't managed by Django.\n \n+@python_2_unicode_compatible\n class A02(models.Model):\n     f_a = models.CharField(max_length=10, db_index=True)\n \n     class Meta:\n         db_table = 'a01'\n         managed = False\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.f_a\n \n+@python_2_unicode_compatible\n class B02(models.Model):\n     class Meta:\n         db_table = 'b01'\n@@ -64,11 +70,12 @@ class Meta:\n     f_a = models.CharField(max_length=10, db_index=True)\n     f_b = models.IntegerField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.f_a\n \n # To re-use the many-to-many intermediate table, we need to manually set up\n # things up.\n+@python_2_unicode_compatible\n class C02(models.Model):\n     mm_a = models.ManyToManyField(A02, through=\"Intermediate\")\n     f_a = models.CharField(max_length=10, db_index=True)\n@@ -78,7 +85,7 @@ class Meta:\n         db_table = 'c01'\n         managed = False\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.f_a\n \n class Intermediate(models.Model):"
        },
        {
            "sha": "08472d98b1ef4852041fdafd503dd482a517affe",
            "filename": "tests/modeltests/update/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fupdate%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fupdate%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fupdate%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -5,21 +5,24 @@\n \n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class DataPoint(models.Model):\n     name = models.CharField(max_length=20)\n     value = models.CharField(max_length=20)\n     another_value = models.CharField(max_length=20, blank=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.name)\n \n+@python_2_unicode_compatible\n class RelatedPoint(models.Model):\n     name = models.CharField(max_length=20)\n     data = models.ForeignKey(DataPoint)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.name)\n \n "
        },
        {
            "sha": "bf5dd99166b7bb495753f477ea1bf9bdc6d6c473",
            "filename": "tests/modeltests/update_only_fields/models.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fupdate_only_fields%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fupdate_only_fields%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fupdate_only_fields%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,5 +1,6 @@\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n GENDER_CHOICES = (\n     ('M', 'Male'),\n@@ -10,11 +11,13 @@ class Account(models.Model):\n     num = models.IntegerField()\n \n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=20)\n     gender = models.CharField(max_length=1, choices=GENDER_CHOICES)\n+    pid = models.IntegerField(null=True, default=None)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n@@ -24,11 +27,12 @@ class Employee(Person):\n     accounts = models.ManyToManyField('Account', related_name='employees', blank=True, null=True)\n \n \n+@python_2_unicode_compatible\n class Profile(models.Model):\n     name = models.CharField(max_length=200)\n     salary = models.FloatField(default=1000.0)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n "
        },
        {
            "sha": "c904c972369012a7e32311114ddafad86c75ac18",
            "filename": "tests/modeltests/update_only_fields/tests.py",
            "status": "modified",
            "additions": 101,
            "deletions": 0,
            "changes": 101,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -18,6 +18,107 @@ def test_update_fields_basic(self):\n         self.assertEqual(s.gender, 'F')\n         self.assertEqual(s.name, 'Ian')\n \n+    def test_update_fields_deferred(self):\n+        s = Person.objects.create(name='Sara', gender='F', pid=22)\n+        self.assertEqual(s.gender, 'F')\n+\n+        s1 = Person.objects.defer(\"gender\", \"pid\").get(pk=s.pk)\n+        s1.name = \"Emily\"\n+        s1.gender = \"M\"\n+\n+        with self.assertNumQueries(1):\n+            s1.save()\n+\n+        s2 = Person.objects.get(pk=s1.pk)\n+        self.assertEqual(s2.name, \"Emily\")\n+        self.assertEqual(s2.gender, \"M\")\n+\n+    def test_update_fields_only_1(self):\n+        s = Person.objects.create(name='Sara', gender='F')\n+        self.assertEqual(s.gender, 'F')\n+\n+        s1 = Person.objects.only('name').get(pk=s.pk)\n+        s1.name = \"Emily\"\n+        s1.gender = \"M\"\n+\n+        with self.assertNumQueries(1):\n+            s1.save()\n+\n+        s2 = Person.objects.get(pk=s1.pk)\n+        self.assertEqual(s2.name, \"Emily\")\n+        self.assertEqual(s2.gender, \"M\")\n+\n+    def test_update_fields_only_2(self):\n+        s = Person.objects.create(name='Sara', gender='F', pid=22)\n+        self.assertEqual(s.gender, 'F')\n+\n+        s1 = Person.objects.only('name').get(pk=s.pk)\n+        s1.name = \"Emily\"\n+        s1.gender = \"M\"\n+\n+        with self.assertNumQueries(2):\n+            s1.save(update_fields=['pid'])\n+\n+        s2 = Person.objects.get(pk=s1.pk)\n+        self.assertEqual(s2.name, \"Sara\")\n+        self.assertEqual(s2.gender, \"F\")\n+\n+    def test_update_fields_only_repeated(self):\n+        s = Person.objects.create(name='Sara', gender='F')\n+        self.assertEqual(s.gender, 'F')\n+\n+        s1 = Person.objects.only('name').get(pk=s.pk)\n+        s1.gender = 'M'\n+        with self.assertNumQueries(1):\n+            s1.save()\n+        # Test that the deferred class does not remember that gender was\n+        # set, instead the instace should remember this.\n+        s1 = Person.objects.only('name').get(pk=s.pk)\n+        with self.assertNumQueries(1):\n+            s1.save()\n+\n+    def test_update_fields_inheritance_defer(self):\n+        profile_boss = Profile.objects.create(name='Boss', salary=3000)\n+        e1 = Employee.objects.create(name='Sara', gender='F',\n+            employee_num=1, profile=profile_boss)\n+        e1 = Employee.objects.only('name').get(pk=e1.pk)\n+        e1.name = 'Linda'\n+        with self.assertNumQueries(1):\n+            e1.save()\n+        self.assertEqual(Employee.objects.get(pk=e1.pk).name,\n+                         'Linda')\n+\n+    def test_update_fields_fk_defer(self):\n+        profile_boss = Profile.objects.create(name='Boss', salary=3000)\n+        profile_receptionist = Profile.objects.create(name='Receptionist', salary=1000)\n+        e1 = Employee.objects.create(name='Sara', gender='F',\n+            employee_num=1, profile=profile_boss)\n+        e1 = Employee.objects.only('profile').get(pk=e1.pk)\n+        e1.profile = profile_receptionist\n+        with self.assertNumQueries(1):\n+            e1.save()\n+        self.assertEqual(Employee.objects.get(pk=e1.pk).profile, profile_receptionist)\n+        e1.profile_id = profile_boss.pk\n+        with self.assertNumQueries(1):\n+            e1.save()\n+        self.assertEqual(Employee.objects.get(pk=e1.pk).profile, profile_boss)\n+\n+    def test_select_related_only_interaction(self):\n+        profile_boss = Profile.objects.create(name='Boss', salary=3000)\n+        e1 = Employee.objects.create(name='Sara', gender='F',\n+            employee_num=1, profile=profile_boss)\n+        e1 = Employee.objects.only('profile__salary').select_related('profile').get(pk=e1.pk)\n+        profile_boss.name = 'Clerk'\n+        profile_boss.salary = 1000\n+        profile_boss.save()\n+        # The loaded salary of 3000 gets saved, the name of 'Clerk' isn't\n+        # overwritten.\n+        with self.assertNumQueries(1):\n+            e1.profile.save()\n+        reloaded_profile = Profile.objects.get(pk=profile_boss.pk)\n+        self.assertEqual(reloaded_profile.name, profile_boss.name)\n+        self.assertEqual(reloaded_profile.salary, 3000)\n+\n     def test_update_fields_m2m(self):\n         profile_boss = Profile.objects.create(name='Boss', salary=3000)\n         e1 = Employee.objects.create(name='Sara', gender='F',"
        },
        {
            "sha": "db083290fb848d48d6cd9653d7e8212b201ff59f",
            "filename": "tests/modeltests/validation/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fvalidation%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fvalidation%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -4,6 +4,7 @@\n \n from django.core.exceptions import ValidationError\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n def validate_answer_to_universe(value):\n@@ -66,13 +67,14 @@ def clean(self):\n         if self.pub_date is None:\n             self.pub_date = datetime.now()\n \n+@python_2_unicode_compatible\n class Post(models.Model):\n     title = models.CharField(max_length=50, unique_for_date='posted', blank=True)\n     slug = models.CharField(max_length=50, unique_for_year='posted', blank=True)\n     subtitle = models.CharField(max_length=50, unique_for_month='posted', blank=True)\n     posted = models.DateField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class FlexibleDatePost(models.Model):\n@@ -89,6 +91,8 @@ class GenericIPAddressTestModel(models.Model):\n     generic_ip = models.GenericIPAddressField(blank=True, null=True, unique=True)\n     v4_ip = models.GenericIPAddressField(blank=True, null=True, protocol=\"ipv4\")\n     v6_ip = models.GenericIPAddressField(blank=True, null=True, protocol=\"ipv6\")\n+    ip_verbose_name = models.GenericIPAddressField(\"IP Address Verbose\",\n+            blank=True, null=True)\n \n class GenericIPAddrUnpackUniqueTest(models.Model):\n     generic_v4unpack_ip = models.GenericIPAddressField(blank=True, unique=True, unpack_ipv4=True)"
        },
        {
            "sha": "58b7b94e7fe9091a26617aef579d1c47f39f33f7",
            "filename": "tests/modeltests/validation/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fvalidation%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fmodeltests%2Fvalidation%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -79,7 +79,7 @@ def test_partial_validation(self):\n             'pub_date': '2010-1-10 14:49:00'\n         }\n         form = ArticleForm(data)\n-        self.assertEqual(form.errors.keys(), [])\n+        self.assertEqual(list(form.errors), [])\n         article = form.save(commit=False)\n         article.author = self.author\n         article.save()\n@@ -95,7 +95,7 @@ def test_validation_with_empty_blank_field(self):\n         }\n         article = Article(author_id=self.author.id)\n         form = ArticleForm(data, instance=article)\n-        self.assertEqual(form.errors.keys(), [])\n+        self.assertEqual(list(form.errors), [])\n         self.assertNotEqual(form.instance.pub_date, None)\n         article = form.save()\n \n@@ -108,7 +108,7 @@ def test_validation_with_invalid_blank_field(self):\n         }\n         article = Article(author_id=self.author.id)\n         form = ArticleForm(data, instance=article)\n-        self.assertEqual(form.errors.keys(), ['pub_date'])\n+        self.assertEqual(list(form.errors), ['pub_date'])\n \n \n class GenericIPAddressFieldTests(ValidationTestCase):"
        },
        {
            "sha": "4ba2f9c503baca3509dfe257a3db5f750a8cbcbf",
            "filename": "tests/regressiontests/admin_changelist/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,4 +1,5 @@\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n class Event(models.Model):\n     # Oracle can have problems with a column named \"date\"\n@@ -20,17 +21,19 @@ class Band(models.Model):\n     nr_of_members = models.PositiveIntegerField()\n     genres = models.ManyToManyField(Genre)\n \n+@python_2_unicode_compatible\n class Musician(models.Model):\n     name = models.CharField(max_length=30)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Group(models.Model):\n     name = models.CharField(max_length=30)\n     members = models.ManyToManyField(Musician, through='Membership')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class Membership(models.Model):"
        },
        {
            "sha": "be88c9a1619bca1f2be1d2831c895e00af6c1973",
            "filename": "tests/regressiontests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -317,7 +317,7 @@ def test_pagination(self):\n                 m.list_editable, m)\n         self.assertEqual(cl.query_set.count(), 60)\n         self.assertEqual(cl.paginator.count, 60)\n-        self.assertEqual(cl.paginator.page_range, [1, 2, 3, 4, 5, 6])\n+        self.assertEqual(list(cl.paginator.page_range), [1, 2, 3, 4, 5, 6])\n \n         # Test custom queryset\n         m = FilteredChildAdmin(Child, admin.site)\n@@ -327,7 +327,7 @@ def test_pagination(self):\n                 m.list_editable, m)\n         self.assertEqual(cl.query_set.count(), 30)\n         self.assertEqual(cl.paginator.count, 30)\n-        self.assertEqual(cl.paginator.page_range, [1, 2, 3])\n+        self.assertEqual(list(cl.paginator.page_range), [1, 2, 3])\n \n     def test_computed_list_display_localization(self):\n         \"\"\""
        },
        {
            "sha": "a63cf8135c494d4dd36782e21699e31500f406ef",
            "filename": "tests/regressiontests/admin_custom_urls/fixtures/actions.json",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_custom_urls%2Ffixtures%2Factions.json",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_custom_urls%2Ffixtures%2Factions.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Ffixtures%2Factions.json?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -40,5 +40,12 @@\n     \"fields\": {\n       \"description\": \"An action with a name suspected of being a XSS attempt\"\n     }\n+  },\n+  {\n+    \"pk\": \"The name of an action\", \n+    \"model\": \"admin_custom_urls.action\", \n+    \"fields\": {\n+      \"description\": \"A generic action\"\n+    }\n   }\n-]\n\\ No newline at end of file\n+]"
        },
        {
            "sha": "a5b4983b0991ab2ed38b47696e682d8ce4d5251e",
            "filename": "tests/regressiontests/admin_custom_urls/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_custom_urls%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_custom_urls%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,13 +2,15 @@\n \n from django.contrib import admin\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Action(models.Model):\n     name = models.CharField(max_length=50, primary_key=True)\n     description = models.CharField(max_length=70)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n@@ -26,7 +28,7 @@ def remove_url(self, name):\n         Remove all entries named 'name' from the ModelAdmin instance URL\n         patterns list\n         \"\"\"\n-        return filter(lambda e: e.name != name, super(ActionAdmin, self).get_urls())\n+        return [url for url in super(ActionAdmin, self).get_urls() if url.name != name]\n \n     def get_urls(self):\n         # Add the URL of our custom 'add_view' view to the front of the URLs"
        },
        {
            "sha": "64ff9f66928e8addd77eab7748901eca89360ac2",
            "filename": "tests/regressiontests/admin_custom_urls/tests.py",
            "status": "modified",
            "additions": 30,
            "deletions": 13,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,6 +10,12 @@\n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminCustomUrlsTest(TestCase):\n+    \"\"\"\n+    Remember that:\n+    * The Action model has a CharField PK.\n+    * The ModelAdmin for Action customizes the add_view URL, it's\n+      '<app name>/<model name>/!add/'\n+    \"\"\"\n     fixtures = ['users.json', 'actions.json']\n \n     def setUp(self):\n@@ -20,23 +26,24 @@ def tearDown(self):\n \n     def testBasicAddGet(self):\n         \"\"\"\n-        A smoke test to ensure GET on the add_view works.\n+        Ensure GET on the add_view works.\n         \"\"\"\n         response = self.client.get('/custom_urls/admin/admin_custom_urls/action/!add/')\n         self.assertIsInstance(response, TemplateResponse)\n         self.assertEqual(response.status_code, 200)\n \n     def testAddWithGETArgs(self):\n+        \"\"\"\n+        Ensure GET on the add_view plus specifying a field value in the query\n+        string works.\n+        \"\"\"\n         response = self.client.get('/custom_urls/admin/admin_custom_urls/action/!add/', {'name': 'My Action'})\n         self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            'value=\"My Action\"' in response.content,\n-            \"Couldn't find an input with the right value in the response.\"\n-        )\n+        self.assertContains(response, 'value=\"My Action\"')\n \n     def testBasicAddPost(self):\n         \"\"\"\n-        A smoke test to ensure POST on add_view works.\n+        Ensure POST on add_view works.\n         \"\"\"\n         post_data = {\n             '_popup': '1',\n@@ -50,8 +57,7 @@ def testBasicAddPost(self):\n \n     def testAdminUrlsNoClash(self):\n         \"\"\"\n-        Test that some admin URLs work correctly. The model has a CharField\n-        PK and the add_view URL has been customized.\n+        Test that some admin URLs work correctly.\n         \"\"\"\n         # Should get the change_view for model instance with PK 'add', not show\n         # the add_view\n@@ -60,17 +66,28 @@ def testAdminUrlsNoClash(self):\n         self.assertContains(response, 'Change action')\n \n         # Ditto, but use reverse() to build the URL\n-        path = reverse('admin:%s_action_change' % Action._meta.app_label,\n+        url = reverse('admin:%s_action_change' % Action._meta.app_label,\n                 args=('add',))\n-        response = self.client.get(path)\n+        response = self.client.get(url)\n         self.assertEqual(response.status_code, 200)\n         self.assertContains(response, 'Change action')\n \n         # Should correctly get the change_view for the model instance with the\n-        # funny-looking PK\n-        path = reverse('admin:%s_action_change' % Action._meta.app_label,\n+        # funny-looking PK (the one wth a 'path/to/html/document.html' value)\n+        url = reverse('admin:%s_action_change' % Action._meta.app_label,\n                 args=(\"path/to/html/document.html\",))\n-        response = self.client.get(path)\n+        response = self.client.get(url)\n         self.assertEqual(response.status_code, 200)\n         self.assertContains(response, 'Change action')\n         self.assertContains(response, 'value=\"path/to/html/document.html\"')\n+\n+    def testChangeViewHistoryButton(self):\n+        url = reverse('admin:%s_action_change' % Action._meta.app_label,\n+                args=('The name of an action',))\n+        response = self.client.get(url)\n+        self.assertEqual(response.status_code, 200)\n+        expected_link = reverse('admin:%s_action_history' %\n+                                Action._meta.app_label,\n+                                args=('The name of an action',))\n+        self.assertContains(response, '<a href=\"%s\" class=\"historylink\"' %\n+                            expected_link)"
        },
        {
            "sha": "e0b8bde2de4499a7d036b8f677ae95f0972b77e6",
            "filename": "tests/regressiontests/admin_filters/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,8 +2,10 @@\n \n from django.contrib.auth.models import User\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     title = models.CharField(max_length=50)\n     year = models.PositiveIntegerField(null=True, blank=True)\n@@ -13,20 +15,22 @@ class Book(models.Model):\n     date_registered = models.DateField(null=True)\n     no = models.IntegerField(verbose_name='number', blank=True, null=True) # This field is intentionally 2 characters long. See #16080.\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n \n+@python_2_unicode_compatible\n class Department(models.Model):\n     code = models.CharField(max_length=4, unique=True)\n     description = models.CharField(max_length=50, blank=True, null=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.description\n \n+@python_2_unicode_compatible\n class Employee(models.Model):\n     department = models.ForeignKey(Department, to_field=\"code\")\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name"
        },
        {
            "sha": "5b703a74818d00b8e6beb5fa90ca46648a69f917",
            "filename": "tests/regressiontests/admin_inlines/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -7,22 +7,26 @@\n from django.db import models\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.contenttypes import generic\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Parent(models.Model):\n     name = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Teacher(models.Model):\n     name = models.CharField(max_length=50)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Child(models.Model):\n     name = models.CharField(max_length=50)\n     teacher = models.ForeignKey(Teacher)\n@@ -31,7 +35,7 @@ class Child(models.Model):\n     object_id = models.PositiveIntegerField()\n     parent = generic.GenericForeignKey()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return 'I am %s, a child of %s' % (self.name, self.parent)\n \n "
        },
        {
            "sha": "873eaded88aad5f82fd542c3804cac7a22a3446c",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/ticket-18091-non-ascii-template.txt",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fticket-18091-non-ascii-template.txt",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fticket-18091-non-ascii-template.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fticket-18091-non-ascii-template.txt?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -0,0 +1,2 @@\n+Some non-ASCII text for testing ticket #18091:\n+ "
        },
        {
            "sha": "cd96052098010b85ca1fc011da19e4a563ff3578",
            "filename": "tests/regressiontests/admin_scripts/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_scripts%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_scripts%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,11 +1,13 @@\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100, default='Default headline')\n     pub_date = models.DateTimeField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.headline\n \n     class Meta:"
        },
        {
            "sha": "2710f809297b1bcfc7291a7f45a2673de9fb3242",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 6,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,15 +1,18 @@\n+# -*- coding: utf-8 -*-\n \"\"\"\n A series of tests to establish that the command-line managment tools work as\n advertised - especially with regards to the handling of the DJANGO_SETTINGS_MODULE\n and default settings.py files.\n \"\"\"\n+from __future__ import unicode_literals\n \n import os\n import re\n import shutil\n import socket\n import subprocess\n import sys\n+import codecs\n \n from django import conf, bin, get_version\n from django.conf import settings\n@@ -71,6 +74,10 @@ def remove_settings(self, filename, is_dir=False):\n                 os.remove(full_name + 'c')\n         except OSError:\n             pass\n+        # Also remove a __pycache__ directory, if it exists\n+        cache_name = os.path.join(test_dir, '__pycache__')\n+        if os.path.isdir(cache_name):\n+            shutil.rmtree(cache_name)\n \n     def _ext_backend_paths(self):\n         \"\"\"\n@@ -110,14 +117,11 @@ def run_test(self, script, args, settings_file=None, apps=None):\n         python_path.extend(ext_backend_base_dirs)\n         os.environ[python_path_var_name] = os.pathsep.join(python_path)\n \n-        # Silence the DeprecationWarning caused by having a locale directory\n-        # in the project directory.\n-        cmd = [sys.executable, '-Wignore:::django.utils.translation', script]\n-\n         # Move to the test directory and run\n         os.chdir(test_dir)\n-        out, err = subprocess.Popen(cmd + args,\n-                stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()\n+        out, err = subprocess.Popen([sys.executable, script] + args,\n+                stdout=subprocess.PIPE, stderr=subprocess.PIPE,\n+                universal_newlines=True).communicate()\n \n         # Restore the old environment\n         if old_django_settings_module:\n@@ -1572,3 +1576,17 @@ def test_custom_project_destination_missing(self):\n         self.assertOutput(err, \"Destination directory '%s' does not exist, please create it first.\" % testproject_dir)\n         self.assertFalse(os.path.exists(testproject_dir))\n \n+\n+    def test_custom_project_template_with_non_ascii_templates(self):\n+        \"Ticket 18091: Make sure the startproject management command is able to render templates with non-ASCII content\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template')\n+        args = ['startproject', '--template', template_path, '--extension=txt', 'customtestproject']\n+        testproject_dir = os.path.join(test_dir, 'customtestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        path = os.path.join(testproject_dir, 'ticket-18091-non-ascii-template.txt')\n+        self.assertEqual(codecs.open(path, 'r', 'utf-8').read(),\n+                         'Some non-ASCII text for testing ticket #18091:\\n \\n')"
        },
        {
            "sha": "b3504a1fa473a0877760f69dda120ac344197d82",
            "filename": "tests/regressiontests/admin_util/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_util%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_util%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_util%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -1,5 +1,6 @@\n from django.db import models\n from django.utils import six\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Article(models.Model):\n@@ -18,11 +19,12 @@ def test_from_model_with_override(self):\n         return \"nothing\"\n     test_from_model_with_override.short_description = \"not What you Expect\"\n \n+@python_2_unicode_compatible\n class Count(models.Model):\n     num = models.PositiveSmallIntegerField()\n     parent = models.ForeignKey('self', null=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return six.text_type(self.num)\n \n class Event(models.Model):"
        },
        {
            "sha": "d04740ce951b7fe1b6895c1ba7575aa31d3f924a",
            "filename": "tests/regressiontests/admin_util/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_util%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_util%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_util%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -171,7 +171,7 @@ def test_label_for_field(self):\n         )\n         self.assertEqual(\n             label_for_field(\"__str__\", Article),\n-            b\"article\"\n+            str(\"article\")\n         )\n \n         self.assertRaises("
        },
        {
            "sha": "d23849a2a85ff94b98e24e9776cddbd15ec1b20d",
            "filename": "tests/regressiontests/admin_validation/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_validation%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_validation%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_validation%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -3,12 +3,14 @@\n \"\"\"\n \n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Album(models.Model):\n     title = models.CharField(max_length=150)\n \n \n+@python_2_unicode_compatible\n class Song(models.Model):\n     title = models.CharField(max_length=150)\n     album = models.ForeignKey(Album)\n@@ -17,7 +19,7 @@ class Song(models.Model):\n     class Meta:\n         ordering = ('title',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n     def readonly_method_on_model(self):"
        },
        {
            "sha": "0d5e327ecff59fe11f25d6d8523e9fb4de5da77d",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 61,
            "deletions": 30,
            "changes": 91,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -10,6 +10,7 @@\n from django.contrib.contenttypes.models import ContentType\n from django.core.files.storage import FileSystemStorage\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class Section(models.Model):\n@@ -20,6 +21,7 @@ class Section(models.Model):\n     name = models.CharField(max_length=100)\n \n \n+@python_2_unicode_compatible\n class Article(models.Model):\n     \"\"\"\n     A simple article to test admin views. Test backwards compatibility.\n@@ -29,7 +31,7 @@ class Article(models.Model):\n     date = models.DateTimeField()\n     section = models.ForeignKey(Section, null=True, blank=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n     def model_year(self):\n@@ -38,50 +40,55 @@ def model_year(self):\n     model_year.short_description = ''\n \n \n+@python_2_unicode_compatible\n class Book(models.Model):\n     \"\"\"\n     A simple book that has chapters.\n     \"\"\"\n     name = models.CharField(max_length=100, verbose_name='Name?')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Promo(models.Model):\n     name = models.CharField(max_length=100, verbose_name='Name?')\n     book = models.ForeignKey(Book)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Chapter(models.Model):\n     title = models.CharField(max_length=100, verbose_name='Title?')\n     content = models.TextField()\n     book = models.ForeignKey(Book)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n     class Meta:\n         # Use a utf-8 bytestring to ensure it works (see #11710)\n         verbose_name = 'Chapter?'\n \n \n+@python_2_unicode_compatible\n class ChapterXtra1(models.Model):\n     chap = models.OneToOneField(Chapter, verbose_name='Chap?')\n     xtra = models.CharField(max_length=100, verbose_name='Xtra?')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return 'Xtra1: %s' % self.xtra\n \n \n+@python_2_unicode_compatible\n class ChapterXtra2(models.Model):\n     chap = models.OneToOneField(Chapter, verbose_name='Chap?')\n     xtra = models.CharField(max_length=100, verbose_name='Xtra?')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return 'Xtra2: %s' % self.xtra\n \n \n@@ -94,58 +101,64 @@ class CustomArticle(models.Model):\n     date = models.DateTimeField()\n \n \n+@python_2_unicode_compatible\n class ModelWithStringPrimaryKey(models.Model):\n     string_pk = models.CharField(max_length=255, primary_key=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.string_pk\n \n     def get_absolute_url(self):\n         return '/dummy/%s/' % self.string_pk\n \n \n+@python_2_unicode_compatible\n class Color(models.Model):\n     value = models.CharField(max_length=10)\n     warm = models.BooleanField()\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.value\n \n # we replicate Color to register with another ModelAdmin\n class Color2(Color):\n     class Meta:\n         proxy = True\n \n+@python_2_unicode_compatible\n class Thing(models.Model):\n     title = models.CharField(max_length=20)\n     color = models.ForeignKey(Color, limit_choices_to={'warm': True})\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n \n+@python_2_unicode_compatible\n class Actor(models.Model):\n     name = models.CharField(max_length=50)\n     age = models.IntegerField()\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Inquisition(models.Model):\n     expected = models.BooleanField()\n     leader = models.ForeignKey(Actor)\n     country = models.CharField(max_length=20)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"by %s from %s\" % (self.leader, self.country)\n \n \n+@python_2_unicode_compatible\n class Sketch(models.Model):\n     title = models.CharField(max_length=100)\n     inquisition = models.ForeignKey(Inquisition, limit_choices_to={'leader__name': 'Palin',\n                                                                    'leader__age': 27,\n                                                                    'expected': False,\n                                                                    })\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n \n@@ -161,6 +174,7 @@ class Fabric(models.Model):\n     surface = models.CharField(max_length=20, choices=NG_CHOICES)\n \n \n+@python_2_unicode_compatible\n class Person(models.Model):\n     GENDER_CHOICES = (\n         (1, \"Male\"),\n@@ -171,20 +185,22 @@ class Person(models.Model):\n     age = models.IntegerField(default=21)\n     alive = models.BooleanField()\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Persona(models.Model):\n     \"\"\"\n     A simple persona associated with accounts, to test inlining of related\n     accounts which inherit from a common accounts class.\n     \"\"\"\n     name = models.CharField(blank=False,  max_length=80)\n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Account(models.Model):\n     \"\"\"\n     A simple, generic account encapsulating the information shared by all\n@@ -194,7 +210,7 @@ class Account(models.Model):\n     persona = models.ForeignKey(Persona, related_name=\"accounts\")\n     servicename = 'generic service'\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s: %s\" % (self.servicename, self.username)\n \n \n@@ -208,11 +224,12 @@ class BarAccount(Account):\n     servicename = 'bar'\n \n \n+@python_2_unicode_compatible\n class Subscriber(models.Model):\n     name = models.CharField(blank=False, max_length=80)\n     email = models.EmailField(blank=False, max_length=175)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s (%s)\" % (self.name, self.email)\n \n \n@@ -249,8 +266,9 @@ class Child(models.Model):\n     name = models.CharField(max_length=30, blank=True)\n \n \n+@python_2_unicode_compatible\n class EmptyModel(models.Model):\n-    def __unicode__(self):\n+    def __str__(self):\n         return \"Primary key = %s\" % self.id\n \n \n@@ -332,14 +350,15 @@ class FancyDoodad(Doodad):\n     expensive = models.BooleanField(default=True)\n \n \n+@python_2_unicode_compatible\n class Category(models.Model):\n     collector = models.ForeignKey(Collector)\n     order = models.PositiveIntegerField()\n \n     class Meta:\n         ordering = ('order',)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return '%s:o%s' % (self.id, self.order)\n \n \n@@ -376,84 +395,93 @@ def awesomeness_level(self):\n         return \"Very awesome.\"\n \n \n+@python_2_unicode_compatible\n class Gadget(models.Model):\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Villain(models.Model):\n     name = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n class SuperVillain(Villain):\n     pass\n \n \n+@python_2_unicode_compatible\n class FunkyTag(models.Model):\n     \"Because we all know there's only one real use case for GFKs.\"\n     name = models.CharField(max_length=25)\n     content_type = models.ForeignKey(ContentType)\n     object_id = models.PositiveIntegerField()\n     content_object = generic.GenericForeignKey('content_type', 'object_id')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class Plot(models.Model):\n     name = models.CharField(max_length=100)\n     team_leader = models.ForeignKey(Villain, related_name='lead_plots')\n     contact = models.ForeignKey(Villain, related_name='contact_plots')\n     tags = generic.GenericRelation(FunkyTag)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class PlotDetails(models.Model):\n     details = models.CharField(max_length=100)\n     plot = models.OneToOneField(Plot)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.details\n \n \n+@python_2_unicode_compatible\n class SecretHideout(models.Model):\n     \"\"\" Secret! Not registered with the admin! \"\"\"\n     location = models.CharField(max_length=100)\n     villain = models.ForeignKey(Villain)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.location\n \n \n+@python_2_unicode_compatible\n class SuperSecretHideout(models.Model):\n     \"\"\" Secret! Not registered with the admin! \"\"\"\n     location = models.CharField(max_length=100)\n     supervillain = models.ForeignKey(SuperVillain)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.location\n \n \n+@python_2_unicode_compatible\n class CyclicOne(models.Model):\n     name = models.CharField(max_length=25)\n     two = models.ForeignKey('CyclicTwo')\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n+@python_2_unicode_compatible\n class CyclicTwo(models.Model):\n     name = models.CharField(max_length=25)\n     one = models.ForeignKey(CyclicOne)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n \n@@ -484,11 +512,12 @@ class Question(models.Model):\n     question = models.CharField(max_length=20)\n \n \n+@python_2_unicode_compatible\n class Answer(models.Model):\n     question = models.ForeignKey(Question, on_delete=models.PROTECT)\n     answer = models.CharField(max_length=20)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.answer\n \n \n@@ -523,11 +552,12 @@ class Paper(models.Model):\n     author = models.CharField(max_length=30, blank=True, null=True)\n \n \n+@python_2_unicode_compatible\n class CoverLetter(models.Model):\n     author = models.CharField(max_length=30)\n     date_written = models.DateField(null=True, blank=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.author\n \n \n@@ -575,10 +605,11 @@ class AdminOrderedCallable(models.Model):\n     order = models.IntegerField()\n     stuff = models.CharField(max_length=200)\n \n+@python_2_unicode_compatible\n class Report(models.Model):\n     title = models.CharField(max_length=100)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.title\n \n "
        },
        {
            "sha": "cf7d4855fb3bf1ec457f9bb31c46ac2b1c8d77b5",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 160,
            "deletions": 189,
            "changes": 349,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -30,7 +30,7 @@\n from django.test import TestCase\n from django.utils import formats, translation, unittest\n from django.utils.cache import get_max_age\n-from django.utils.encoding import iri_to_uri\n+from django.utils.encoding import iri_to_uri, force_bytes\n from django.utils.html import escape\n from django.utils.http import urlencode\n from django.utils import six\n@@ -78,12 +78,22 @@ def tearDown(self):\n         self.client.logout()\n         formats.reset_format_cache()\n \n+    def assertContentBefore(self, response, text1, text2, failing_msg=None):\n+        \"\"\"\n+        Testing utility asserting that text1 appears before text2 in response\n+        content.\n+        \"\"\"\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTrue(response.content.index(force_bytes(text1)) < response.content.index(force_bytes(text2)),\n+            failing_msg\n+        )\n+\n     def testTrailingSlashRequired(self):\n         \"\"\"\n         If you leave off the trailing slash, app should redirect and add it.\n         \"\"\"\n-        request = self.client.get('/test_admin/%s/admin_views/article/add' % self.urlbit)\n-        self.assertRedirects(request,\n+        response = self.client.get('/test_admin/%s/admin_views/article/add' % self.urlbit)\n+        self.assertRedirects(response,\n             '/test_admin/%s/admin_views/article/add/' % self.urlbit, status_code=301\n         )\n \n@@ -219,38 +229,32 @@ def testChangeListSortingCallable(self):\n         (column 2 is callable_year in ArticleAdmin)\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/article/' % self.urlbit, {'o': 2})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index('Oldest content') < response.content.index('Middle content') and\n-            response.content.index('Middle content') < response.content.index('Newest content'),\n-            \"Results of sorting on callable are out of order.\"\n-        )\n+        self.assertContentBefore(response, 'Oldest content', 'Middle content',\n+            \"Results of sorting on callable are out of order.\")\n+        self.assertContentBefore(response, 'Middle content', 'Newest content',\n+            \"Results of sorting on callable are out of order.\")\n \n     def testChangeListSortingModel(self):\n         \"\"\"\n         Ensure we can sort on a list_display field that is a Model method\n         (colunn 3 is 'model_year' in ArticleAdmin)\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/article/' % self.urlbit, {'o': '-3'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index('Newest content') < response.content.index('Middle content') and\n-            response.content.index('Middle content') < response.content.index('Oldest content'),\n-            \"Results of sorting on Model method are out of order.\"\n-        )\n+        self.assertContentBefore(response, 'Newest content', 'Middle content',\n+            \"Results of sorting on Model method are out of order.\")\n+        self.assertContentBefore(response, 'Middle content', 'Oldest content',\n+            \"Results of sorting on Model method are out of order.\")\n \n     def testChangeListSortingModelAdmin(self):\n         \"\"\"\n         Ensure we can sort on a list_display field that is a ModelAdmin method\n         (colunn 4 is 'modeladmin_year' in ArticleAdmin)\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/article/' % self.urlbit, {'o': '4'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index('Oldest content') < response.content.index('Middle content') and\n-            response.content.index('Middle content') < response.content.index('Newest content'),\n-            \"Results of sorting on ModelAdmin method are out of order.\"\n-        )\n+        self.assertContentBefore(response, 'Oldest content', 'Middle content',\n+            \"Results of sorting on ModelAdmin method are out of order.\")\n+        self.assertContentBefore(response, 'Middle content', 'Newest content',\n+            \"Results of sorting on ModelAdmin method are out of order.\")\n \n     def testChangeListSortingMultiple(self):\n         p1 = Person.objects.create(name=\"Chris\", gender=1, alive=True)\n@@ -262,19 +266,13 @@ def testChangeListSortingMultiple(self):\n         # This hard-codes the URL because it'll fail if it runs against the\n         # 'admin2' custom admin (which doesn't have the Person model).\n         response = self.client.get('/test_admin/admin/admin_views/person/', {'o': '1.2'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p3.id) < response.content.index(link % p1.id) and\n-            response.content.index(link % p1.id) < response.content.index(link % p2.id)\n-        )\n+        self.assertContentBefore(response, link % p3.id, link % p1.id)\n+        self.assertContentBefore(response, link % p1.id, link % p2.id)\n \n         # Sort by gender descending, name\n         response = self.client.get('/test_admin/admin/admin_views/person/', {'o': '-2.1'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p2.id) < response.content.index(link % p3.id) and\n-            response.content.index(link % p3.id) < response.content.index(link % p1.id)\n-        )\n+        self.assertContentBefore(response, link % p2.id, link % p3.id)\n+        self.assertContentBefore(response, link % p3.id, link % p1.id)\n \n     def testChangeListSortingPreserveQuerySetOrdering(self):\n         \"\"\"\n@@ -291,11 +289,8 @@ def testChangeListSortingPreserveQuerySetOrdering(self):\n         # This hard-codes the URL because it'll fail if it runs against the\n         # 'admin2' custom admin (which doesn't have the Person model).\n         response = self.client.get('/test_admin/admin/admin_views/person/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p3.id) < response.content.index(link % p2.id) and\n-            response.content.index(link % p2.id) < response.content.index(link % p1.id)\n-        )\n+        self.assertContentBefore(response, link % p3.id, link % p2.id)\n+        self.assertContentBefore(response, link % p2.id, link % p1.id)\n \n     def testChangeListSortingModelMeta(self):\n         # Test ordering on Model Meta is respected\n@@ -305,17 +300,11 @@ def testChangeListSortingModelMeta(self):\n         link = '<a href=\"%s/'\n \n         response = self.client.get('/test_admin/admin/admin_views/language/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % l2.pk) < response.content.index(link % l1.pk)\n-        )\n+        self.assertContentBefore(response, link % l2.pk, link % l1.pk)\n \n         # Test we can override with query string\n         response = self.client.get('/test_admin/admin/admin_views/language/', {'o':'-1'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % l1.pk) < response.content.index(link % l2.pk)\n-        )\n+        self.assertContentBefore(response, link % l1.pk, link % l2.pk)\n \n     def testChangeListSortingOverrideModelAdmin(self):\n         # Test ordering on Model Admin is respected, and overrides Model Meta\n@@ -325,10 +314,7 @@ def testChangeListSortingOverrideModelAdmin(self):\n \n         link = '<a href=\"%s/'\n         response = self.client.get('/test_admin/admin/admin_views/podcast/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p1.pk) < response.content.index(link % p2.pk)\n-        )\n+        self.assertContentBefore(response, link % p1.pk, link % p2.pk)\n \n     def testMultipleSortSameField(self):\n         # Check that we get the columns we expect if we have two columns\n@@ -339,32 +325,24 @@ def testMultipleSortSameField(self):\n \n         link = '<a href=\"%s/'\n         response = self.client.get('/test_admin/admin/admin_views/podcast/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p1.pk) < response.content.index(link % p2.pk)\n-        )\n+        self.assertContentBefore(response, link % p1.pk, link % p2.pk)\n \n         p1 = ComplexSortedPerson.objects.create(name=\"Bob\", age=10)\n         p2 = ComplexSortedPerson.objects.create(name=\"Amy\", age=20)\n         link = '<a href=\"%s/'\n \n         response = self.client.get('/test_admin/admin/admin_views/complexsortedperson/', {})\n-        self.assertEqual(response.status_code, 200)\n         # Should have 5 columns (including action checkbox col)\n         self.assertContains(response, '<th scope=\"col\"', count=5)\n \n         self.assertContains(response, 'Name')\n         self.assertContains(response, 'Colored name')\n \n         # Check order\n-        self.assertTrue(\n-            response.content.index('Name') < response.content.index('Colored name')\n-        )\n+        self.assertContentBefore(response, 'Name', 'Colored name')\n \n         # Check sorting - should be by name\n-        self.assertTrue(\n-            response.content.index(link % p2.id) < response.content.index(link % p1.id)\n-        )\n+        self.assertContentBefore(response, link % p2.id, link % p1.id)\n \n     def testSortIndicatorsAdminOrder(self):\n         \"\"\"\n@@ -389,8 +367,8 @@ def testSortIndicatorsAdminOrder(self):\n             # the implicit 'action_checkbox' and 1 being the column 'stuff'.\n             self.assertEqual(response.context['cl'].get_ordering_field_columns(), {2: 'asc'})\n             # Check order of records.\n-            self.assertTrue(response.content.index('The First Item') <\n-                response.content.index('The Middle Item') < response.content.index('The Last Item'))\n+            self.assertContentBefore(response, 'The First Item', 'The Middle Item')\n+            self.assertContentBefore(response, 'The Middle Item', 'The Last Item')\n \n     def testLimitedFilter(self):\n         \"\"\"Ensure admin changelist filters do not contain objects excluded via limit_choices_to.\n@@ -480,26 +458,22 @@ def testNamedGroupFieldChoicesChangeList(self):\n         has been used in the choices option of a field.\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/fabric/' % self.urlbit)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            '<a href=\"1/\">Horizontal</a>' in response.content and\n-            '<a href=\"2/\">Vertical</a>' in response.content,\n-            \"Changelist table isn't showing the right human-readable values set by a model field 'choices' option named group.\"\n-        )\n+        fail_msg = \"Changelist table isn't showing the right human-readable values set by a model field 'choices' option named group.\"\n+        self.assertContains(response, '<a href=\"1/\">Horizontal</a>', msg_prefix=fail_msg, html=True)\n+        self.assertContains(response, '<a href=\"2/\">Vertical</a>', msg_prefix=fail_msg, html=True)\n \n     def testNamedGroupFieldChoicesFilter(self):\n         \"\"\"\n         Ensures the filter UI shows correctly when at least one named group has\n         been used in the choices option of a model field.\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/fabric/' % self.urlbit)\n-        self.assertEqual(response.status_code, 200)\n+        fail_msg = \"Changelist filter isn't showing options contained inside a model field 'choices' option named group.\"\n         self.assertContains(response, '<div id=\"changelist-filter\">')\n-        self.assertTrue(\n-            '<a href=\"?surface__exact=x\">Horizontal</a>' in response.content and\n-            '<a href=\"?surface__exact=y\">Vertical</a>' in response.content,\n-            \"Changelist filter isn't showing options contained inside a model field 'choices' option named group.\"\n-        )\n+        self.assertContains(response,\n+            '<a href=\"?surface__exact=x\">Horizontal</a>', msg_prefix=fail_msg, html=True)\n+        self.assertContains(response,\n+            '<a href=\"?surface__exact=y\">Vertical</a>', msg_prefix=fail_msg, html=True)\n \n     def testChangeListNullBooleanDisplay(self):\n         Post.objects.create(public=None)\n@@ -590,8 +564,8 @@ def test_hide_change_password(self):\n         user.save()\n \n         response = self.client.get('/test_admin/admin/')\n-        self.assertFalse(reverse('admin:password_change') in response.content,\n-            msg='The \"change password\" link should not be displayed if a user does not have a usable password.')\n+        self.assertNotContains(response, reverse('admin:password_change'),\n+            msg_prefix='The \"change password\" link should not be displayed if a user does not have a usable password.')\n \n     def test_change_view_with_show_delete_extra_context(self):\n         \"\"\"\n@@ -618,7 +592,7 @@ def tearDown(self):\n \n     def testChangeFormUrlHasCorrectValue(self):\n         \"\"\"\n-        Tests whether change_view has form_url in request.context\n+        Tests whether change_view has form_url in response.context\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/section/1/' % self.urlbit)\n         self.assertTrue('form_url' in response.context, msg='form_url not present in response.context')\n@@ -755,39 +729,39 @@ def testCustomAdminSiteLoginForm(self):\n \n     def testCustomAdminSiteLoginTemplate(self):\n         self.client.logout()\n-        request = self.client.get('/test_admin/admin2/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/login.html')\n-        self.assertTrue('Hello from a custom login template' in request.content)\n+        response = self.client.get('/test_admin/admin2/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/login.html')\n+        self.assertContains(response, 'Hello from a custom login template')\n \n     def testCustomAdminSiteLogoutTemplate(self):\n-        request = self.client.get('/test_admin/admin2/logout/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/logout.html')\n-        self.assertTrue('Hello from a custom logout template' in request.content)\n+        response = self.client.get('/test_admin/admin2/logout/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/logout.html')\n+        self.assertContains(response, 'Hello from a custom logout template')\n \n     def testCustomAdminSiteIndexViewAndTemplate(self):\n-        request = self.client.get('/test_admin/admin2/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/index.html')\n-        self.assertTrue('Hello from a custom index template *bar*' in request.content)\n+        response = self.client.get('/test_admin/admin2/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/index.html')\n+        self.assertContains(response, 'Hello from a custom index template *bar*')\n \n     def testCustomAdminSitePasswordChangeTemplate(self):\n-        request = self.client.get('/test_admin/admin2/password_change/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/password_change_form.html')\n-        self.assertTrue('Hello from a custom password change form template' in request.content)\n+        response = self.client.get('/test_admin/admin2/password_change/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/password_change_form.html')\n+        self.assertContains(response, 'Hello from a custom password change form template')\n \n     def testCustomAdminSitePasswordChangeDoneTemplate(self):\n-        request = self.client.get('/test_admin/admin2/password_change/done/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/password_change_done.html')\n-        self.assertTrue('Hello from a custom password change done template' in request.content)\n+        response = self.client.get('/test_admin/admin2/password_change/done/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/password_change_done.html')\n+        self.assertContains(response, 'Hello from a custom password change done template')\n \n     def testCustomAdminSiteView(self):\n         self.client.login(username='super', password='secret')\n         response = self.client.get('/test_admin/%s/my_view/' % self.urlbit)\n-        self.assertEqual(response.content, \"Django is a magical pony!\")\n+        self.assertEqual(response.content, b\"Django is a magical pony!\")\n \n def get_perm(Model, perm):\n     \"\"\"Return the permission object, for the Model\"\"\"\n@@ -885,16 +859,16 @@ def testLogin(self):\n         a 200 status code.\n         \"\"\"\n         # Super User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.super_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Test if user enters e-mail address\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.super_email_login)\n         self.assertContains(login, \"Your e-mail address is not your username\")\n         # only correct passwords get a username hint\n@@ -907,47 +881,47 @@ def testLogin(self):\n         self.assertContains(login, ERROR_MESSAGE)\n \n         # Add User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.adduser_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Change User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.changeuser_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Delete User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.deleteuser_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Regular User should not be able to login.\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.joepublic_login)\n         self.assertEqual(login.status_code, 200)\n         self.assertContains(login, ERROR_MESSAGE)\n \n         # Requests without username should not return 500 errors.\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.no_username_login)\n         self.assertEqual(login.status_code, 200)\n         form = login.context[0].get('form')\n         self.assertEqual(form.errors['username'][0], 'This field is required.')\n \n     def testLoginSuccessfullyRedirectsToOriginalUrl(self):\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         query_string = 'the-answer=42'\n         redirect_url = '/test_admin/admin/?%s' % query_string\n         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n@@ -967,8 +941,8 @@ def testAddView(self):\n         self.client.post('/test_admin/admin/', self.changeuser_login)\n         # make sure the view removes test cookie\n         self.assertEqual(self.client.session.test_cookie_worked(), False)\n-        request = self.client.get('/test_admin/admin/admin_views/article/add/')\n-        self.assertEqual(request.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/add/')\n+        self.assertEqual(response.status_code, 403)\n         # Try POST just to make sure\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertEqual(post.status_code, 403)\n@@ -979,10 +953,9 @@ def testAddView(self):\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.adduser_login)\n         addpage = self.client.get('/test_admin/admin/admin_views/article/add/')\n-        self.assertEqual(addpage.status_code, 200)\n         change_list_link = '&rsaquo; <a href=\"/test_admin/admin/admin_views/article/\">Articles</a>'\n-        self.assertFalse(change_list_link in addpage.content,\n-                    'User restricted to add permission is given link to change list view in breadcrumbs.')\n+        self.assertNotContains(addpage, change_list_link,\n+            msg_prefix='User restricted to add permission is given link to change list view in breadcrumbs.')\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertRedirects(post, '/test_admin/admin/')\n         self.assertEqual(Article.objects.all().count(), 4)\n@@ -994,9 +967,8 @@ def testAddView(self):\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.super_login)\n         addpage = self.client.get('/test_admin/admin/admin_views/article/add/')\n-        self.assertEqual(addpage.status_code, 200)\n-        self.assertFalse(change_list_link not in addpage.content,\n-                    'Unrestricted user is not given link to change list view in breadcrumbs.')\n+        self.assertContains(addpage, change_list_link,\n+            msg_prefix='Unrestricted user is not given link to change list view in breadcrumbs.')\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertRedirects(post, '/test_admin/admin/admin_views/article/')\n         self.assertEqual(Article.objects.all().count(), 5)\n@@ -1022,21 +994,21 @@ def testChangeView(self):\n         # add user shoud not be able to view the list of article or change any of them\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.adduser_login)\n-        request = self.client.get('/test_admin/admin/admin_views/article/')\n-        self.assertEqual(request.status_code, 403)\n-        request = self.client.get('/test_admin/admin/admin_views/article/1/')\n-        self.assertEqual(request.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/')\n+        self.assertEqual(response.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/1/')\n+        self.assertEqual(response.status_code, 403)\n         post = self.client.post('/test_admin/admin/admin_views/article/1/', change_dict)\n         self.assertEqual(post.status_code, 403)\n         self.client.get('/test_admin/admin/logout/')\n \n         # change user can view all items and edit them\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.changeuser_login)\n-        request = self.client.get('/test_admin/admin/admin_views/article/')\n-        self.assertEqual(request.status_code, 200)\n-        request = self.client.get('/test_admin/admin/admin_views/article/1/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/admin_views/article/')\n+        self.assertEqual(response.status_code, 200)\n+        response = self.client.get('/test_admin/admin/admin_views/article/1/')\n+        self.assertEqual(response.status_code, 200)\n         post = self.client.post('/test_admin/admin/admin_views/article/1/', change_dict)\n         self.assertRedirects(post, '/test_admin/admin/admin_views/article/')\n         self.assertEqual(Article.objects.get(pk=1).content, '<p>edited article</p>')\n@@ -1058,33 +1030,33 @@ def testChangeView(self):\n         RowLevelChangePermissionModel.objects.create(id=2, name=\"even id\")\n         for login_dict in [self.super_login, self.changeuser_login, self.adduser_login, self.deleteuser_login]:\n             self.client.post('/test_admin/admin/', login_dict)\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n-            self.assertEqual(request.status_code, 403)\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n+            self.assertEqual(response.status_code, 403)\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')\n-            self.assertEqual(request.status_code, 403)\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n-            self.assertEqual(request.status_code, 200)\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed'})\n+            self.assertEqual(response.status_code, 403)\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n+            self.assertEqual(response.status_code, 200)\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')\n-            self.assertRedirects(request, '/test_admin/admin/')\n+            self.assertRedirects(response, '/test_admin/admin/')\n             self.client.get('/test_admin/admin/logout/')\n         for login_dict in [self.joepublic_login, self.no_username_login]:\n             self.client.post('/test_admin/admin/', login_dict)\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed again'})\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed again'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n             self.client.get('/test_admin/admin/logout/')\n \n     def testConditionallyShowAddSectionLink(self):\n@@ -1114,14 +1086,13 @@ def testCustomModelAdminTemplates(self):\n         self.client.post('/test_admin/admin/', self.super_login)\n \n         # Test custom change list template with custom extra context\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/')\n-        self.assertEqual(request.status_code, 200)\n-        self.assertTrue(\"var hello = 'Hello!';\" in request.content)\n-        self.assertTemplateUsed(request, 'custom_admin/change_list.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/')\n+        self.assertContains(response, \"var hello = 'Hello!';\")\n+        self.assertTemplateUsed(response, 'custom_admin/change_list.html')\n \n         # Test custom add form template\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/add/')\n-        self.assertTemplateUsed(request, 'custom_admin/add_form.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/add/')\n+        self.assertTemplateUsed(response, 'custom_admin/add_form.html')\n \n         # Add an article so we can test delete, change, and history views\n         post = self.client.post('/test_admin/admin/admin_views/customarticle/add/', {\n@@ -1135,18 +1106,18 @@ def testCustomModelAdminTemplates(self):\n \n         # Test custom delete, change, and object history templates\n         # Test custom change form template\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/%d/' % article_pk)\n-        self.assertTemplateUsed(request, 'custom_admin/change_form.html')\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/%d/delete/' % article_pk)\n-        self.assertTemplateUsed(request, 'custom_admin/delete_confirmation.html')\n-        request = self.client.post('/test_admin/admin/admin_views/customarticle/', data={\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/%d/' % article_pk)\n+        self.assertTemplateUsed(response, 'custom_admin/change_form.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/%d/delete/' % article_pk)\n+        self.assertTemplateUsed(response, 'custom_admin/delete_confirmation.html')\n+        response = self.client.post('/test_admin/admin/admin_views/customarticle/', data={\n                 'index': 0,\n                 'action': ['delete_selected'],\n                 '_selected_action': ['1'],\n             })\n-        self.assertTemplateUsed(request, 'custom_admin/delete_selected_confirmation.html')\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/%d/history/' % article_pk)\n-        self.assertTemplateUsed(request, 'custom_admin/object_history.html')\n+        self.assertTemplateUsed(response, 'custom_admin/delete_selected_confirmation.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/%d/history/' % article_pk)\n+        self.assertTemplateUsed(response, 'custom_admin/object_history.html')\n \n         self.client.get('/test_admin/admin/logout/')\n \n@@ -1158,8 +1129,8 @@ def testDeleteView(self):\n         # add user shoud not be able to delete articles\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.adduser_login)\n-        request = self.client.get('/test_admin/admin/admin_views/article/1/delete/')\n-        self.assertEqual(request.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/1/delete/')\n+        self.assertEqual(response.status_code, 403)\n         post = self.client.post('/test_admin/admin/admin_views/article/1/delete/', delete_dict)\n         self.assertEqual(post.status_code, 403)\n         self.assertEqual(Article.objects.all().count(), 3)\n@@ -1246,9 +1217,9 @@ def test_nesting(self):\n         Objects should be nested to display the relationships that\n         cause them to be scheduled for deletion.\n         \"\"\"\n-        pattern = re.compile(r\"\"\"<li>Plot: <a href=\".+/admin_views/plot/1/\">World Domination</a>\\s*<ul>\\s*<li>Plot details: <a href=\".+/admin_views/plotdetails/1/\">almost finished</a>\"\"\")\n+        pattern = re.compile(br\"\"\"<li>Plot: <a href=\".+/admin_views/plot/1/\">World Domination</a>\\s*<ul>\\s*<li>Plot details: <a href=\".+/admin_views/plotdetails/1/\">almost finished</a>\"\"\")\n         response = self.client.get('/test_admin/admin/admin_views/villain/%s/delete/' % quote(1))\n-        self.assertTrue(pattern.search(response.content))\n+        self.assertRegexpMatches(response.content, pattern)\n \n     def test_cyclic(self):\n         \"\"\"\n@@ -1407,9 +1378,9 @@ def test_recentactions_without_content_type(self):\n         logentry.content_type = None\n         logentry.save()\n \n-        counted_presence_before = response.content.count(should_contain)\n+        counted_presence_before = response.content.count(force_bytes(should_contain))\n         response = self.client.get('/test_admin/admin/')\n-        counted_presence_after = response.content.count(should_contain)\n+        counted_presence_after = response.content.count(force_bytes(should_contain))\n         self.assertEqual(counted_presence_before - 1,\n                           counted_presence_after)\n \n@@ -1512,8 +1483,8 @@ def test_secure_view_shows_login_if_not_logged_in(self):\n         self.assertTemplateUsed(response, 'admin/login.html')\n \n     def test_secure_view_login_successfully_redirects_to_original_url(self):\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         query_string = 'the-answer=42'\n         redirect_url = '/test_admin/admin/secure-view/?%s' % query_string\n         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n@@ -1529,8 +1500,8 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         a 200 status code.\n         \"\"\"\n         # Super User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.super_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n@@ -1539,8 +1510,8 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         self.assertEqual(self.client.session.test_cookie_worked(), False)\n \n         # Test if user enters e-mail address\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.super_email_login)\n         self.assertContains(login, \"Your e-mail address is not your username\")\n         # only correct passwords get a username hint\n@@ -1553,32 +1524,32 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         self.assertContains(login, ERROR_MESSAGE)\n \n         # Add User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.adduser_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Change User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.changeuser_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Delete User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.deleteuser_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Regular User should not be able to login.\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.joepublic_login)\n         self.assertEqual(login.status_code, 200)\n         # Login.context is a list of context dicts we just need to check the first one.\n@@ -2107,7 +2078,7 @@ def testInline(self):\n         foo_user = \"foo username\"\n         bar_user = \"bar username\"\n \n-        name_re = re.compile('name=\"(.*?)\"')\n+        name_re = re.compile(b'name=\"(.*?)\"')\n \n         # test the add case\n         response = self.client.get('/test_admin/admin/admin_views/persona/add/')\n@@ -2214,7 +2185,7 @@ def test_model_admin_default_delete_action(self):\n         confirmation = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n         self.assertIsInstance(confirmation, TemplateResponse)\n         self.assertContains(confirmation, \"Are you sure you want to delete the selected subscribers?\")\n-        self.assertTrue(confirmation.content.count(ACTION_CHECKBOX_NAME) == 2)\n+        self.assertContains(confirmation, ACTION_CHECKBOX_NAME, count=2)\n         response = self.client.post('/test_admin/admin/admin_views/subscriber/', delete_confirmation_data)\n         self.assertEqual(Subscriber.objects.count(), 0)\n \n@@ -2390,7 +2361,7 @@ def test_selection_counter(self):\n     def test_popup_actions(self):\n         \"\"\" Actions should not be shown in popups. \"\"\"\n         response = self.client.get('/test_admin/admin/admin_views/subscriber/')\n-        self.assertNotEquals(response.context[\"action_form\"], None)\n+        self.assertNotEqual(response.context[\"action_form\"], None)\n         response = self.client.get(\n             '/test_admin/admin/admin_views/subscriber/?%s' % IS_POPUP_VAR)\n         self.assertEqual(response.context[\"action_form\"], None)\n@@ -2514,7 +2485,7 @@ def setUp(self):\n         # to use a NamedTemporaryFile.\n         tdir = tempfile.gettempdir()\n         file1 = tempfile.NamedTemporaryFile(suffix=\".file1\", dir=tdir)\n-        file1.write('a' * (2 ** 21))\n+        file1.write(b'a' * (2 ** 21))\n         filename = file1.name\n         file1.close()\n         self.gallery = Gallery(name=\"Test Gallery\")\n@@ -3197,9 +3168,9 @@ def test_limit_choices_to(self):\n                                                   country=\"Spain\")\n         response = self.client.get('/test_admin/admin/admin_views/sketch/add/')\n         # Find the link\n-        m = re.search(r'<a href=\"([^\"]*)\"[^>]* id=\"lookup_id_inquisition\"', response.content)\n+        m = re.search(br'<a href=\"([^\"]*)\"[^>]* id=\"lookup_id_inquisition\"', response.content)\n         self.assertTrue(m) # Got a match\n-        popup_url = m.groups()[0].replace(\"&amp;\", \"&\")\n+        popup_url = m.groups()[0].decode().replace(\"&amp;\", \"&\")\n \n         # Handle relative links\n         popup_url = urljoin(response.request['PATH_INFO'], popup_url)"
        },
        {
            "sha": "2e452798b70fd9d9a5e52f3b21d7a1285726ba41",
            "filename": "tests/regressiontests/admin_widgets/models.py",
            "status": "modified",
            "additions": 16,
            "deletions": 8,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b546e7eb633022ee1962570387f22fb2bcea46ed/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py?ref=b546e7eb633022ee1962570387f22fb2bcea46ed",
            "patch": "@@ -2,39 +2,44 @@\n \n from django.db import models\n from django.contrib.auth.models import User\n+from django.utils.encoding import python_2_unicode_compatible\n \n \n class MyFileField(models.FileField):\n     pass\n \n+@python_2_unicode_compatible\n class Member(models.Model):\n     name = models.CharField(max_length=100)\n     birthdate = models.DateTimeField(blank=True, null=True)\n     gender = models.CharField(max_length=1, blank=True, choices=[('M','Male'), ('F', 'Female')])\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Band(models.Model):\n     name = models.CharField(max_length=100)\n     members = models.ManyToManyField(Member)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n+@python_2_unicode_compatible\n class Album(models.Model):\n     band = models.ForeignKey(Band)\n     name = models.CharField(max_length=100)\n     cover_art = models.FileField(upload_to='albums')\n     backside_art = MyFileField(upload_to='albums_back', null=True)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n class HiddenInventoryManager(models.Manager):\n     def get_query_set(self):\n         return super(HiddenInventoryManager, self).get_query_set().filter(hidden=False)\n \n+@python_2_unicode_compatible\n class Inventory(models.Model):\n    barcode = models.PositiveIntegerField(unique=True)\n    parent = models.ForeignKey('self', to_field='barcode', blank=True, null=True)\n@@ -45,7 +50,7 @@ class Inventory(models.Model):\n    default_manager = models.Manager()\n    objects = HiddenInventoryManager()\n \n-   def __unicode__(self):\n+   def __str__(self):\n       return self.name\n \n class Event(models.Model):\n@@ -56,12 +61,13 @@ class Event(models.Model):\n     link = models.URLField(blank=True)\n     min_age = models.IntegerField(blank=True, null=True)\n \n+@python_2_unicode_compatible\n class Car(models.Model):\n     owner = models.ForeignKey(User)\n     make = models.CharField(max_length=30)\n     model = models.CharField(max_length=30)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return \"%s %s\" % (self.make, self.model)\n \n class CarTire(models.Model):\n@@ -103,19 +109,21 @@ class Advisor(models.Model):\n     companies = models.ManyToManyField(Company)\n \n \n+@python_2_unicode_compatible\n class Student(models.Model):\n     name = models.CharField(max_length=255)\n \n-    def __unicode__(self):\n+    def __str__(self):\n         return self.name\n \n     class Meta:\n         ordering = ('name',)\n \n+@python_2_unicode_compatible\n class School(models.Model):\n     name = models.CharField(max_length=255)\n     students = models.ManyToManyField(Student, related_name='current_schools')\n     alumni = models.ManyToManyField(Student, related_name='previous_schools')\n \n-    def __unicode__(self):\n-        return self.name\n\\ No newline at end of file\n+    def __str__(self):\n+        return self.name"
        }
    ],
    "stats": {
        "total": 8394,
        "additions": 5821,
        "deletions": 2573
    }
}