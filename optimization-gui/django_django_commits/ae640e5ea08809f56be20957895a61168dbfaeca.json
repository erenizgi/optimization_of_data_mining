{
    "author": "ramiro",
    "message": "Fixed #17796 -- Rolled back [17588] because the fix for the original relatively\ncorner case (boolean fields under MySQL spatial backend) had a wider scope with\npotentially unintended consequences affecting the main MySQL backend and the\nrequired changes wouldn't be appropiate at this point of the 1.4 development\ncycle.\n\nRefs #15169.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17603 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "ae640e5ea08809f56be20957895a61168dbfaeca",
    "files": [
        {
            "sha": "4d2d78a81d59443ba2a9a19811b3670f01ec4bb8",
            "filename": "django/contrib/gis/db/backends/mysql/compiler.py",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/c471cfd67425a6394a6f91bf6e71573e8f482850/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/c471cfd67425a6394a6f91bf6e71573e8f482850/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py?ref=c471cfd67425a6394a6f91bf6e71573e8f482850",
            "patch": "@@ -1,22 +0,0 @@\n-from django.contrib.gis.db.models.sql.compiler import GeoSQLCompiler as BaseGeoSQLCompiler\n-from django.db.backends.mysql import compiler\n-\n-SQLCompiler = compiler.SQLCompiler\n-\n-class GeoSQLCompiler(BaseGeoSQLCompiler, SQLCompiler):\n-    pass\n-\n-class SQLInsertCompiler(compiler.SQLInsertCompiler, GeoSQLCompiler):\n-    pass\n-\n-class SQLDeleteCompiler(compiler.SQLDeleteCompiler, GeoSQLCompiler):\n-    pass\n-\n-class SQLUpdateCompiler(compiler.SQLUpdateCompiler, GeoSQLCompiler):\n-    pass\n-\n-class SQLAggregateCompiler(compiler.SQLAggregateCompiler, GeoSQLCompiler):\n-    pass\n-\n-class SQLDateCompiler(compiler.SQLDateCompiler, GeoSQLCompiler):\n-    pass"
        },
        {
            "sha": "1653636dd42bf946c34ce3ae052d4b973cf84fa6",
            "filename": "django/contrib/gis/db/backends/mysql/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -5,7 +5,7 @@\n \n class MySQLOperations(DatabaseOperations, BaseSpatialOperations):\n \n-    compiler_module = 'django.contrib.gis.db.backends.mysql.compiler'\n+    compiler_module = 'django.contrib.gis.db.models.sql.compiler'\n     mysql = True\n     name = 'mysql'\n     select = 'AsText(%s)'"
        },
        {
            "sha": "07eea32b6920d057d80971571bb2e86dfc845850",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -185,10 +185,9 @@ def resolve_columns(self, row, fields=()):\n                                self.query.extra_select_fields.get(a, None),\n                                self.connection)\n                   for v, a in izip(row[rn_offset:index_start], aliases)]\n-\n-        if self.connection.ops.oracle or self.connection.ops.mysql or getattr(self.query, 'geo_values', False):\n-            # We resolve the rest of the columns if we're on MySQL, Oracle or\n-            # if the `geo_values` attribute is defined.\n+        if self.connection.ops.oracle or getattr(self.query, 'geo_values', False):\n+            # We resolve the rest of the columns if we're on Oracle or if\n+            # the `geo_values` attribute is defined.\n             for value, field in map(None, row[index_start:], fields):\n                 values.append(self.query.convert_values(value, field, self.connection))\n         else:"
        },
        {
            "sha": "c300dcd52798b88e21b853baf4665be6b9d9f2fa",
            "filename": "django/contrib/gis/db/models/sql/query.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -56,8 +56,8 @@ def convert_values(self, value, field, connection):\n         extra selection objects into Geometry and Distance objects.\n         TODO: Make converted objects 'lazy' for less overhead.\n         \"\"\"\n-        if connection.ops.oracle or connection.ops.mysql:\n-            # On MySQL and Oracle, call their version of `convert_values` first.\n+        if connection.ops.oracle:\n+            # Running through Oracle's first.\n             value = super(GeoQuery, self).convert_values(value, field or GeomField(), connection)\n \n         if value is None:"
        },
        {
            "sha": "1ac830953a7687e8f2caec7b67a262b85e176610",
            "filename": "django/contrib/gis/tests/geoapp/models.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -34,10 +34,6 @@ class Track(models.Model):\n     objects = models.GeoManager()\n     def __unicode__(self): return self.name\n \n-class Truth(models.Model):\n-    val = models.BooleanField()\n-    objects = models.GeoManager()\n-\n if not spatialite:\n     class Feature(models.Model):\n         name = models.CharField(max_length=20)"
        },
        {
            "sha": "1e684402867daa0d7babb38d34ed4e3817400734",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -7,7 +7,7 @@\n from django.db.models import Count\n from django.test import TestCase\n \n-from .models import City, PennsylvaniaCity, State, Truth\n+from .models import City, PennsylvaniaCity, State\n \n \n class GeoRegressionTests(TestCase):\n@@ -64,11 +64,3 @@ def test06_defer_or_only_with_annotate(self):\n         \"Regression for #16409 - make sure defer() and only() work with annotate()\"\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).defer('name')), list)\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).only('name')), list)\n-\n-    def test04_boolean_conversion(self):\n-        \"Testing Boolean value conversion with the spatial backend, see #15169.\"\n-        t1 = Truth.objects.create(val=True)\n-        t2 = Truth.objects.create(val=False)\n-\n-        self.assertTrue(Truth.objects.get(pk=1).val is True)\n-        self.assertTrue(Truth.objects.get(pk=2).val is False)"
        },
        {
            "sha": "e30cb90a936e93b1fa931c9a0fa8b6e33b856773",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -190,12 +190,6 @@ def _can_introspect_foreign_keys(self):\n class DatabaseOperations(BaseDatabaseOperations):\n     compiler_module = \"django.db.backends.mysql.compiler\"\n \n-    def convert_values(self, value, field):\n-        if (field and field.get_internal_type() in (\"BooleanField\", \"NullBooleanField\") and\n-            value in (0, 1)):\n-            value = bool(value)\n-        return value\n-\n     def date_extract_sql(self, lookup_type, field_name):\n         # http://dev.mysql.com/doc/mysql/en/date-and-time-functions.html\n         if lookup_type == 'week_day':"
        },
        {
            "sha": "bd4105ff8eeecbd4fc18ffcb8fa7845eb6f22ea5",
            "filename": "django/db/backends/mysql/compiler.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/ae640e5ea08809f56be20957895a61168dbfaeca/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py?ref=ae640e5ea08809f56be20957895a61168dbfaeca",
            "patch": "@@ -5,7 +5,10 @@ def resolve_columns(self, row, fields=()):\n         values = []\n         index_extra_select = len(self.query.extra_select.keys())\n         for value, field in map(None, row[index_extra_select:], fields):\n-            values.append(self.query.convert_values(value, field, connection=self.connection))\n+            if (field and field.get_internal_type() in (\"BooleanField\", \"NullBooleanField\") and\n+                value in (0, 1)):\n+                value = bool(value)\n+            values.append(value)\n         return row[:index_extra_select] + tuple(values)\n \n class SQLInsertCompiler(compiler.SQLInsertCompiler, SQLCompiler):"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 11,
        "deletions": 49
    }
}