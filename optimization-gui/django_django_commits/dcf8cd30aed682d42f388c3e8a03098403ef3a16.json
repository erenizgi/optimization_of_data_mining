{
    "author": "claudep",
    "message": "Updated FormattingTests test case to use settings contexts",
    "sha": "dcf8cd30aed682d42f388c3e8a03098403ef3a16",
    "files": [
        {
            "sha": "ba7415c05351d3ef3541e3b2e0876b1f889f5bb9",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 96,
            "deletions": 112,
            "changes": 208,
            "blob_url": "https://github.com/django/django/blob/dcf8cd30aed682d42f388c3e8a03098403ef3a16/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/dcf8cd30aed682d42f388c3e8a03098403ef3a16/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=dcf8cd30aed682d42f388c3e8a03098403ef3a16",
            "patch": "@@ -337,14 +337,10 @@ def test_bad_placeholder_2(self):\n             self.assertEqual(rendered, 'My other name is James.')\n \n \n+@override_settings(USE_L10N=True)\n class FormattingTests(TestCase):\n \n     def setUp(self):\n-        self.use_i18n = settings.USE_I18N\n-        self.use_l10n = settings.USE_L10N\n-        self.use_thousand_separator = settings.USE_THOUSAND_SEPARATOR\n-        self.thousand_separator = settings.THOUSAND_SEPARATOR\n-        self.number_grouping = settings.NUMBER_GROUPING\n         self.n = decimal.Decimal('66666.666')\n         self.f = 99999.999\n         self.d = datetime.date(2009, 12, 31)\n@@ -360,24 +356,16 @@ def setUp(self):\n             'l': self.l,\n         })\n \n-    def tearDown(self):\n-        # Restore defaults\n-        settings.USE_I18N = self.use_i18n\n-        settings.USE_L10N = self.use_l10n\n-        settings.USE_THOUSAND_SEPARATOR = self.use_thousand_separator\n-        settings.THOUSAND_SEPARATOR = self.thousand_separator\n-        settings.NUMBER_GROUPING = self.number_grouping\n-\n     def test_locale_independent(self):\n         \"\"\"\n         Localization of numbers\n         \"\"\"\n-        with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=False):\n+        with self.settings(USE_THOUSAND_SEPARATOR=False):\n             self.assertEqual('66666.66', nformat(self.n, decimal_sep='.', decimal_pos=2, grouping=3, thousand_sep=','))\n             self.assertEqual('66666A6', nformat(self.n, decimal_sep='A', decimal_pos=1, grouping=1, thousand_sep='B'))\n             self.assertEqual('66666', nformat(self.n, decimal_sep='X', decimal_pos=0, grouping=1, thousand_sep='Y'))\n \n-        with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True):\n+        with self.settings(USE_THOUSAND_SEPARATOR=True):\n             self.assertEqual('66,666.66', nformat(self.n, decimal_sep='.', decimal_pos=2, grouping=3, thousand_sep=','))\n             self.assertEqual('6B6B6B6B6A6', nformat(self.n, decimal_sep='A', decimal_pos=1, grouping=1, thousand_sep='B'))\n             self.assertEqual('-66666.6', nformat(-66666.666, decimal_sep='.', decimal_pos=1))\n@@ -390,12 +378,12 @@ def test_locale_independent(self):\n             self.assertEqual('31.12.2009 в 20:50', Template('{{ dt|date:\"d.m.Y в H:i\" }}').render(self.ctxt))\n             self.assertEqual('⌚ 10:15', Template('{{ t|time:\"⌚ H:i\" }}').render(self.ctxt))\n \n+    @override_settings(USE_L10N=False)\n     def test_l10n_disabled(self):\n         \"\"\"\n         Catalan locale with format i18n disabled translations will be used,\n         but not formats\n         \"\"\"\n-        settings.USE_L10N = False\n         with translation.override('ca', deactivate=True):\n             self.assertEqual('N j, Y', get_format('DATE_FORMAT'))\n             self.assertEqual(0, get_format('FIRST_DAY_OF_WEEK'))\n@@ -474,13 +462,12 @@ def test_false_like_locale_formats(self):\n         fr_formats.FIRST_DAY_OF_WEEK = 0\n \n         with translation.override('fr'):\n-            with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True,\n-                               THOUSAND_SEPARATOR='!'):\n+            with self.settings(USE_THOUSAND_SEPARATOR=True, THOUSAND_SEPARATOR='!'):\n                 self.assertEqual('', get_format('THOUSAND_SEPARATOR'))\n                 # Even a second time (after the format has been cached)...\n                 self.assertEqual('', get_format('THOUSAND_SEPARATOR'))\n \n-            with self.settings(USE_L10N=True, FIRST_DAY_OF_WEEK=1):\n+            with self.settings(FIRST_DAY_OF_WEEK=1):\n                 self.assertEqual(0, get_format('FIRST_DAY_OF_WEEK'))\n                 # Even a second time (after the format has been cached)...\n                 self.assertEqual(0, get_format('FIRST_DAY_OF_WEEK'))\n@@ -490,7 +477,6 @@ def test_false_like_locale_formats(self):\n         fr_formats.FIRST_DAY_OF_WEEK = backup_FIRST_DAY_OF_WEEK\n \n     def test_l10n_enabled(self):\n-        settings.USE_L10N = True\n         # Catalan locale\n         with translation.override('ca', deactivate=True):\n             self.assertEqual('j \\d\\e F \\d\\e Y', get_format('DATE_FORMAT'))\n@@ -502,67 +488,70 @@ def test_l10n_enabled(self):\n             self.assertEqual('31/12/2009 20:50', date_format(self.dt, 'SHORT_DATETIME_FORMAT'))\n             self.assertEqual('No localizable', localize('No localizable'))\n \n-            settings.USE_THOUSAND_SEPARATOR = True\n-            self.assertEqual('66.666,666', localize(self.n))\n-            self.assertEqual('99.999,999', localize(self.f))\n-            self.assertEqual('10.000', localize(self.l))\n-            self.assertEqual('True', localize(True))\n-\n-            settings.USE_THOUSAND_SEPARATOR = False\n-            self.assertEqual('66666,666', localize(self.n))\n-            self.assertEqual('99999,999', localize(self.f))\n-            self.assertEqual('10000', localize(self.l))\n-            self.assertEqual('31 de desembre de 2009', localize(self.d))\n-            self.assertEqual('31 de desembre de 2009 a les 20:50', localize(self.dt))\n+            with self.settings(USE_THOUSAND_SEPARATOR=True):\n+                self.assertEqual('66.666,666', localize(self.n))\n+                self.assertEqual('99.999,999', localize(self.f))\n+                self.assertEqual('10.000', localize(self.l))\n+                self.assertEqual('True', localize(True))\n+\n+            with self.settings(USE_THOUSAND_SEPARATOR=False):\n+                self.assertEqual('66666,666', localize(self.n))\n+                self.assertEqual('99999,999', localize(self.f))\n+                self.assertEqual('10000', localize(self.l))\n+                self.assertEqual('31 de desembre de 2009', localize(self.d))\n+                self.assertEqual('31 de desembre de 2009 a les 20:50', localize(self.dt))\n \n-            settings.USE_THOUSAND_SEPARATOR = True\n-            self.assertEqual('66.666,666', Template('{{ n }}').render(self.ctxt))\n-            self.assertEqual('99.999,999', Template('{{ f }}').render(self.ctxt))\n-            self.assertEqual('10.000', Template('{{ l }}').render(self.ctxt))\n+            with self.settings(USE_THOUSAND_SEPARATOR=True):\n+                self.assertEqual('66.666,666', Template('{{ n }}').render(self.ctxt))\n+                self.assertEqual('99.999,999', Template('{{ f }}').render(self.ctxt))\n+                self.assertEqual('10.000', Template('{{ l }}').render(self.ctxt))\n \n-            form3 = I18nForm({\n-                'decimal_field': '66.666,666',\n-                'float_field': '99.999,999',\n-                'date_field': '31/12/2009',\n-                'datetime_field': '31/12/2009 20:50',\n-                'time_field': '20:50',\n-                'integer_field': '1.234',\n-            })\n-            self.assertEqual(True, form3.is_valid())\n-            self.assertEqual(decimal.Decimal('66666.666'), form3.cleaned_data['decimal_field'])\n-            self.assertEqual(99999.999, form3.cleaned_data['float_field'])\n-            self.assertEqual(datetime.date(2009, 12, 31), form3.cleaned_data['date_field'])\n-            self.assertEqual(datetime.datetime(2009, 12, 31, 20, 50), form3.cleaned_data['datetime_field'])\n-            self.assertEqual(datetime.time(20, 50), form3.cleaned_data['time_field'])\n-            self.assertEqual(1234, form3.cleaned_data['integer_field'])\n-\n-            settings.USE_THOUSAND_SEPARATOR = False\n-            self.assertEqual('66666,666', Template('{{ n }}').render(self.ctxt))\n-            self.assertEqual('99999,999', Template('{{ f }}').render(self.ctxt))\n-            self.assertEqual('31 de desembre de 2009', Template('{{ d }}').render(self.ctxt))\n-            self.assertEqual('31 de desembre de 2009 a les 20:50', Template('{{ dt }}').render(self.ctxt))\n-            self.assertEqual('66666,67', Template('{{ n|floatformat:2 }}').render(self.ctxt))\n-            self.assertEqual('100000,0', Template('{{ f|floatformat }}').render(self.ctxt))\n-            self.assertEqual('10:15:48', Template('{{ t|time:\"TIME_FORMAT\" }}').render(self.ctxt))\n-            self.assertEqual('31/12/2009', Template('{{ d|date:\"SHORT_DATE_FORMAT\" }}').render(self.ctxt))\n-            self.assertEqual('31/12/2009 20:50', Template('{{ dt|date:\"SHORT_DATETIME_FORMAT\" }}').render(self.ctxt))\n-            self.assertEqual(date_format(datetime.datetime.now(), \"DATE_FORMAT\"), Template('{% now \"DATE_FORMAT\" %}').render(self.ctxt))\n-\n-            form4 = I18nForm({\n-                'decimal_field': '66666,666',\n-                'float_field': '99999,999',\n-                'date_field': '31/12/2009',\n-                'datetime_field': '31/12/2009 20:50',\n-                'time_field': '20:50',\n-                'integer_field': '1234',\n-            })\n-            self.assertEqual(True, form4.is_valid())\n-            self.assertEqual(decimal.Decimal('66666.666'), form4.cleaned_data['decimal_field'])\n-            self.assertEqual(99999.999, form4.cleaned_data['float_field'])\n-            self.assertEqual(datetime.date(2009, 12, 31), form4.cleaned_data['date_field'])\n-            self.assertEqual(datetime.datetime(2009, 12, 31, 20, 50), form4.cleaned_data['datetime_field'])\n-            self.assertEqual(datetime.time(20, 50), form4.cleaned_data['time_field'])\n-            self.assertEqual(1234, form4.cleaned_data['integer_field'])\n+            with self.settings(USE_THOUSAND_SEPARATOR=True):\n+                form3 = I18nForm({\n+                    'decimal_field': '66.666,666',\n+                    'float_field': '99.999,999',\n+                    'date_field': '31/12/2009',\n+                    'datetime_field': '31/12/2009 20:50',\n+                    'time_field': '20:50',\n+                    'integer_field': '1.234',\n+                })\n+                self.assertEqual(True, form3.is_valid())\n+                self.assertEqual(decimal.Decimal('66666.666'), form3.cleaned_data['decimal_field'])\n+                self.assertEqual(99999.999, form3.cleaned_data['float_field'])\n+                self.assertEqual(datetime.date(2009, 12, 31), form3.cleaned_data['date_field'])\n+                self.assertEqual(datetime.datetime(2009, 12, 31, 20, 50), form3.cleaned_data['datetime_field'])\n+                self.assertEqual(datetime.time(20, 50), form3.cleaned_data['time_field'])\n+                self.assertEqual(1234, form3.cleaned_data['integer_field'])\n+\n+            with self.settings(USE_THOUSAND_SEPARATOR=False):\n+                self.assertEqual('66666,666', Template('{{ n }}').render(self.ctxt))\n+                self.assertEqual('99999,999', Template('{{ f }}').render(self.ctxt))\n+                self.assertEqual('31 de desembre de 2009', Template('{{ d }}').render(self.ctxt))\n+                self.assertEqual('31 de desembre de 2009 a les 20:50', Template('{{ dt }}').render(self.ctxt))\n+                self.assertEqual('66666,67', Template('{{ n|floatformat:2 }}').render(self.ctxt))\n+                self.assertEqual('100000,0', Template('{{ f|floatformat }}').render(self.ctxt))\n+                self.assertEqual('10:15:48', Template('{{ t|time:\"TIME_FORMAT\" }}').render(self.ctxt))\n+                self.assertEqual('31/12/2009', Template('{{ d|date:\"SHORT_DATE_FORMAT\" }}').render(self.ctxt))\n+                self.assertEqual('31/12/2009 20:50', Template('{{ dt|date:\"SHORT_DATETIME_FORMAT\" }}').render(self.ctxt))\n+                self.assertEqual(date_format(datetime.datetime.now(), \"DATE_FORMAT\"),\n+                                 Template('{% now \"DATE_FORMAT\" %}').render(self.ctxt))\n+\n+            with self.settings(USE_THOUSAND_SEPARATOR=False):\n+                form4 = I18nForm({\n+                    'decimal_field': '66666,666',\n+                    'float_field': '99999,999',\n+                    'date_field': '31/12/2009',\n+                    'datetime_field': '31/12/2009 20:50',\n+                    'time_field': '20:50',\n+                    'integer_field': '1234',\n+                })\n+                self.assertEqual(True, form4.is_valid())\n+                self.assertEqual(decimal.Decimal('66666.666'), form4.cleaned_data['decimal_field'])\n+                self.assertEqual(99999.999, form4.cleaned_data['float_field'])\n+                self.assertEqual(datetime.date(2009, 12, 31), form4.cleaned_data['date_field'])\n+                self.assertEqual(datetime.datetime(2009, 12, 31, 20, 50), form4.cleaned_data['datetime_field'])\n+                self.assertEqual(datetime.time(20, 50), form4.cleaned_data['time_field'])\n+                self.assertEqual(1234, form4.cleaned_data['integer_field'])\n \n             form5 = SelectDateForm({\n                 'date_field_month': '12',\n@@ -593,32 +582,32 @@ def test_l10n_enabled(self):\n             self.assertEqual('12/31/2009 8:50 p.m.', date_format(self.dt, 'SHORT_DATETIME_FORMAT'))\n             self.assertEqual('No localizable', localize('No localizable'))\n \n-            settings.USE_THOUSAND_SEPARATOR = True\n-            self.assertEqual('66,666.666', localize(self.n))\n-            self.assertEqual('99,999.999', localize(self.f))\n-            self.assertEqual('10,000', localize(self.l))\n-\n-            settings.USE_THOUSAND_SEPARATOR = False\n-            self.assertEqual('66666.666', localize(self.n))\n-            self.assertEqual('99999.999', localize(self.f))\n-            self.assertEqual('10000', localize(self.l))\n-            self.assertEqual('Dec. 31, 2009', localize(self.d))\n-            self.assertEqual('Dec. 31, 2009, 8:50 p.m.', localize(self.dt))\n+            with self.settings(USE_THOUSAND_SEPARATOR=True):\n+                self.assertEqual('66,666.666', localize(self.n))\n+                self.assertEqual('99,999.999', localize(self.f))\n+                self.assertEqual('10,000', localize(self.l))\n \n-            settings.USE_THOUSAND_SEPARATOR = True\n-            self.assertEqual('66,666.666', Template('{{ n }}').render(self.ctxt))\n-            self.assertEqual('99,999.999', Template('{{ f }}').render(self.ctxt))\n-            self.assertEqual('10,000', Template('{{ l }}').render(self.ctxt))\n+            with self.settings(USE_THOUSAND_SEPARATOR=False):\n+                self.assertEqual('66666.666', localize(self.n))\n+                self.assertEqual('99999.999', localize(self.f))\n+                self.assertEqual('10000', localize(self.l))\n+                self.assertEqual('Dec. 31, 2009', localize(self.d))\n+                self.assertEqual('Dec. 31, 2009, 8:50 p.m.', localize(self.dt))\n \n-            settings.USE_THOUSAND_SEPARATOR = False\n-            self.assertEqual('66666.666', Template('{{ n }}').render(self.ctxt))\n-            self.assertEqual('99999.999', Template('{{ f }}').render(self.ctxt))\n-            self.assertEqual('Dec. 31, 2009', Template('{{ d }}').render(self.ctxt))\n-            self.assertEqual('Dec. 31, 2009, 8:50 p.m.', Template('{{ dt }}').render(self.ctxt))\n-            self.assertEqual('66666.67', Template('{{ n|floatformat:2 }}').render(self.ctxt))\n-            self.assertEqual('100000.0', Template('{{ f|floatformat }}').render(self.ctxt))\n-            self.assertEqual('12/31/2009', Template('{{ d|date:\"SHORT_DATE_FORMAT\" }}').render(self.ctxt))\n-            self.assertEqual('12/31/2009 8:50 p.m.', Template('{{ dt|date:\"SHORT_DATETIME_FORMAT\" }}').render(self.ctxt))\n+            with self.settings(USE_THOUSAND_SEPARATOR=True):\n+                self.assertEqual('66,666.666', Template('{{ n }}').render(self.ctxt))\n+                self.assertEqual('99,999.999', Template('{{ f }}').render(self.ctxt))\n+                self.assertEqual('10,000', Template('{{ l }}').render(self.ctxt))\n+\n+            with self.settings(USE_THOUSAND_SEPARATOR=False):\n+                self.assertEqual('66666.666', Template('{{ n }}').render(self.ctxt))\n+                self.assertEqual('99999.999', Template('{{ f }}').render(self.ctxt))\n+                self.assertEqual('Dec. 31, 2009', Template('{{ d }}').render(self.ctxt))\n+                self.assertEqual('Dec. 31, 2009, 8:50 p.m.', Template('{{ dt }}').render(self.ctxt))\n+                self.assertEqual('66666.67', Template('{{ n|floatformat:2 }}').render(self.ctxt))\n+                self.assertEqual('100000.0', Template('{{ f|floatformat }}').render(self.ctxt))\n+                self.assertEqual('12/31/2009', Template('{{ d|date:\"SHORT_DATE_FORMAT\" }}').render(self.ctxt))\n+                self.assertEqual('12/31/2009 8:50 p.m.', Template('{{ dt|date:\"SHORT_DATETIME_FORMAT\" }}').render(self.ctxt))\n \n             form5 = I18nForm({\n                 'decimal_field': '66666.666',\n@@ -652,7 +641,7 @@ def test_sub_locales(self):\n         \"\"\"\n         Check if sublocales fall back to the main locale\n         \"\"\"\n-        with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True):\n+        with self.settings(USE_THOUSAND_SEPARATOR=True):\n             with translation.override('de-at', deactivate=True):\n                 self.assertEqual('66.666,666', Template('{{ n }}').render(self.ctxt))\n             with translation.override('es-us', deactivate=True):\n@@ -662,7 +651,6 @@ def test_localized_input(self):\n         \"\"\"\n         Tests if form input is correctly localized\n         \"\"\"\n-        settings.USE_L10N = True\n         with translation.override('de-at', deactivate=True):\n             form6 = CompanyForm({\n                 'name': 'acme',\n@@ -685,7 +673,6 @@ def test_iter_format_modules(self):\n         \"\"\"\n         Tests the iter_format_modules function.\n         \"\"\"\n-        settings.USE_L10N = True\n         with translation.override('de-at', deactivate=True):\n             de_format_mod = import_module('django.conf.locale.de.formats')\n             self.assertEqual(list(iter_format_modules('de')), [de_format_mod])\n@@ -698,19 +685,16 @@ def test_iter_format_modules_stability(self):\n         Tests the iter_format_modules function always yields format modules in\n         a stable and correct order in presence of both base ll and ll_CC formats.\n         \"\"\"\n-        settings.USE_L10N = True\n         en_format_mod = import_module('django.conf.locale.en.formats')\n         en_gb_format_mod = import_module('django.conf.locale.en_GB.formats')\n         self.assertEqual(list(iter_format_modules('en-gb')), [en_gb_format_mod, en_format_mod])\n \n     def test_get_format_modules_lang(self):\n-        with self.settings(USE_L10N=True):\n-            with translation.override('de', deactivate=True):\n-                self.assertEqual('.', get_format('DECIMAL_SEPARATOR', lang='en'))\n+        with translation.override('de', deactivate=True):\n+            self.assertEqual('.', get_format('DECIMAL_SEPARATOR', lang='en'))\n \n     def test_get_format_modules_stability(self):\n-        with self.settings(USE_L10N=True,\n-                FORMAT_MODULE_PATH='regressiontests.i18n.other.locale'):\n+        with self.settings(FORMAT_MODULE_PATH='regressiontests.i18n.other.locale'):\n             with translation.override('de', deactivate=True):\n                 old = str(\"%r\") % get_format_modules(reverse=True)\n                 new = str(\"%r\") % get_format_modules(reverse=True) # second try"
        }
    ],
    "stats": {
        "total": 208,
        "additions": 96,
        "deletions": 112
    }
}