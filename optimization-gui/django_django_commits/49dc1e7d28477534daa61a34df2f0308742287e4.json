{
    "author": "andrewgodwin",
    "message": "Fix altering of indexes alongside uniques",
    "sha": "49dc1e7d28477534daa61a34df2f0308742287e4",
    "files": [
        {
            "sha": "960fd7035de208083210207409f0e22834611b1c",
            "filename": "django/db/backends/schema.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/49dc1e7d28477534daa61a34df2f0308742287e4/django%2Fdb%2Fbackends%2Fschema.py",
            "raw_url": "https://github.com/django/django/raw/49dc1e7d28477534daa61a34df2f0308742287e4/django%2Fdb%2Fbackends%2Fschema.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fschema.py?ref=49dc1e7d28477534daa61a34df2f0308742287e4",
            "patch": "@@ -397,7 +397,7 @@ def alter_field(self, model, old_field, new_field, strict=False):\n                     },\n                 )\n         # Removed an index?\n-        if old_field.db_index and not new_field.db_index and not old_field.unique and not new_field.unique:\n+        if old_field.db_index and not new_field.db_index and not old_field.unique and not (not new_field.unique and old_field.unique):\n             # Find the index for this field\n             index_names = self._constraint_names(model, [old_field.column], index=True)\n             if strict and len(index_names) != 1:\n@@ -525,7 +525,7 @@ def alter_field(self, model, old_field, new_field, strict=False):\n                 }\n             )\n         # Added an index?\n-        if not old_field.db_index and new_field.db_index and not old_field.unique and not new_field.unique:\n+        if not old_field.db_index and new_field.db_index and not new_field.unique and not (not old_field.unique and new_field.unique):\n             self.execute(\n                 self.sql_create_index % {\n                     \"table\": self.quote_name(model._meta.db_table),"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}