{
    "author": "adrianholovaty",
    "message": "Fixed #17323 -- Renamed HttpRequest.raw_post_data to request.body. Thanks for the patch, dstufft\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17210 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3f003a3c4b5338915e3889da8bf10577296459b3",
    "files": [
        {
            "sha": "93142d92008c184c8ca3cc044e836b2a0b1bced2",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 19,
            "deletions": 12,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -4,6 +4,8 @@\n import os\n import re\n import time\n+import warnings\n+\n from pprint import pformat\n from urllib import urlencode, quote\n from urlparse import urljoin\n@@ -315,14 +317,19 @@ def parse_file_upload(self, META, post_data):\n         parser = MultiPartParser(META, post_data, self.upload_handlers, self.encoding)\n         return parser.parse()\n \n-    def _get_raw_post_data(self):\n-        if not hasattr(self, '_raw_post_data'):\n+    @property\n+    def body(self):\n+        if not hasattr(self, '_body'):\n             if self._read_started:\n-                raise Exception(\"You cannot access raw_post_data after reading from request's data stream\")\n-            self._raw_post_data = self.read()\n-            self._stream = StringIO(self._raw_post_data)\n-        return self._raw_post_data\n-    raw_post_data = property(_get_raw_post_data)\n+                raise Exception(\"You cannot access body after reading from request's data stream\")\n+            self._body = self.read()\n+            self._stream = StringIO(self._body)\n+        return self._body\n+\n+    @property\n+    def raw_post_data(self):\n+        warnings.warn('HttpRequest.raw_post_data has been deprecated. Use HttpRequest.body instead.', PendingDeprecationWarning)\n+        return self.body\n \n     def _mark_post_parse_error(self):\n         self._post = QueryDict('')\n@@ -334,14 +341,14 @@ def _load_post_and_files(self):\n         if self.method != 'POST':\n             self._post, self._files = QueryDict('', encoding=self._encoding), MultiValueDict()\n             return\n-        if self._read_started and not hasattr(self, '_raw_post_data'):\n+        if self._read_started and not hasattr(self, '_body'):\n             self._mark_post_parse_error()\n             return\n \n         if self.META.get('CONTENT_TYPE', '').startswith('multipart'):\n-            if hasattr(self, '_raw_post_data'):\n+            if hasattr(self, '_body'):\n                 # Use already read data\n-                data = StringIO(self._raw_post_data)\n+                data = StringIO(self._body)\n             else:\n                 data = self\n             try:\n@@ -357,14 +364,14 @@ def _load_post_and_files(self):\n                 self._mark_post_parse_error()\n                 raise\n         else:\n-            self._post, self._files = QueryDict(self.raw_post_data, encoding=self._encoding), MultiValueDict()\n+            self._post, self._files = QueryDict(self.body, encoding=self._encoding), MultiValueDict()\n \n     ## File-like and iterator interface.\n     ##\n     ## Expects self._stream to be set to an appropriate source of bytes by\n     ## a corresponding request subclass (WSGIRequest or ModPythonRequest).\n     ## Also when request data has already been read by request.POST or\n-    ## request.raw_post_data, self._stream points to a StringIO instance\n+    ## request.body, self._stream points to a StringIO instance\n     ## containing that data.\n \n     def read(self, *args, **kwargs):"
        },
        {
            "sha": "cae3f9f36c26195fd05ab8f04d0f9f9ec4188060",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -257,6 +257,10 @@ these changes.\n * Setting the ``is_safe`` and ``needs_autoescape`` flags as attributes of\n   template filter functions will no longer be supported.\n \n+* The attribute ``HttpRequest.raw_post_data`` was renamed to ``HttpRequest.body``\n+  in 1.4. The backward compatibility will be removed --\n+  ``HttpRequest.raw_post_data`` will no longer work.\n+\n 2.0\n ---\n "
        },
        {
            "sha": "b0be311de90a940ac0d84efa184a54f7de12669a",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 11,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -30,6 +30,20 @@ Attributes\n \n All attributes except ``session`` should be considered read-only.\n \n+.. attribute:: HttpRequest.body\n+\n+    .. versionchanged:: 1.4\n+    Before Django 1.4, ``HttpRequest.body`` was named ``HttpRequest.raw_post_data``.\n+\n+    The raw HTTP request body as a byte string. This is useful for processing\n+    data in different ways than conventional HTML forms: binary images,\n+    XML payload etc. For processing conventional form data, use ``HttpRequest.POST``.\n+\n+    .. versionadded:: 1.3\n+\n+    You can also read from an HttpRequest using a file-like interface. See\n+    :meth:`HttpRequest.read()`.\n+\n .. attribute:: HttpRequest.path\n \n     A string representing the full path to the requested page, not including\n@@ -170,17 +184,6 @@ All attributes except ``session`` should be considered read-only.\n     support activated. See the :doc:`session documentation\n     </topics/http/sessions>` for full details.\n \n-.. attribute:: HttpRequest.raw_post_data\n-\n-    The raw HTTP POST data as a byte string. This is useful for processing\n-    data in different formats than of conventional HTML forms: binary images,\n-    XML payload etc. For processing form data use ``HttpRequest.POST``.\n-\n-    .. versionadded:: 1.3\n-\n-    You can also read from an HttpRequest using file-like interface. See\n-    :meth:`HttpRequest.read()`.\n-\n .. attribute:: HttpRequest.urlconf\n \n     Not defined by Django itself, but will be read if other code (e.g., a custom"
        },
        {
            "sha": "7ffc1aa65494e02a5989fe4e5900295b6e63277f",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -995,3 +995,10 @@ useful, it was removed in Django 1.4. If you relied on it, you must edit your\n settings file to list all your applications explicitly.\n \n .. _this can't be done reliably: http://docs.python.org/tutorial/modules.html#importing-from-a-package\n+\n+``HttpRequest.raw_post_data`` renamed to ``HttpRequest.body``\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+This attribute was confusingly named ``HttpRequest.raw_post_data``, but it\n+actually provided the body of the HTTP request. It's been renamed to\n+``HttpRequest.body``, and ``HttpRequest.raw_post_data`` has been deprecated."
        },
        {
            "sha": "6ea7213a02a735544495fc5ced7d8003431000cb",
            "filename": "tests/modeltests/test_client/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fmodeltests%2Ftest_client%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fmodeltests%2Ftest_client%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftest_client%2Fviews.py?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -44,7 +44,7 @@ def raw_post_view(request):\n     \"\"\"A view which expects raw XML to be posted and returns content extracted\n     from the XML\"\"\"\n     if request.method == 'POST':\n-        root = parseString(request.raw_post_data)\n+        root = parseString(request.body)\n         first_book = root.firstChild.firstChild\n         title, author = [n.firstChild.nodeValue for n in first_book.childNodes]\n         t = Template(\"{{ title }} - {{ author }}\", name=\"Book template\")"
        },
        {
            "sha": "7927d270984a693c69cadb44a1ac738b630ab3f0",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 17,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -1,11 +1,13 @@\n import time\n+import warnings\n from datetime import datetime, timedelta\n from StringIO import StringIO\n \n from django.conf import settings\n from django.core.handlers.modpython import ModPythonRequest\n from django.core.handlers.wsgi import WSGIRequest, LimitedStream\n from django.http import HttpRequest, HttpResponse, parse_cookie, build_request_repr\n+from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils import unittest\n from django.utils.http import cookie_date\n \n@@ -294,36 +296,36 @@ def test_stream(self):\n     def test_read_after_value(self):\n         \"\"\"\n         Reading from request is allowed after accessing request contents as\n-        POST or raw_post_data.\n+        POST or body.\n         \"\"\"\n         payload = 'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n         self.assertEqual(request.POST, {u'name': [u'value']})\n-        self.assertEqual(request.raw_post_data, 'name=value')\n+        self.assertEqual(request.body, 'name=value')\n         self.assertEqual(request.read(), 'name=value')\n \n     def test_value_after_read(self):\n         \"\"\"\n-        Construction of POST or raw_post_data is not allowed after reading\n+        Construction of POST or body is not allowed after reading\n         from request.\n         \"\"\"\n         payload = 'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n         self.assertEqual(request.read(2), 'na')\n-        self.assertRaises(Exception, lambda: request.raw_post_data)\n+        self.assertRaises(Exception, lambda: request.body)\n         self.assertEqual(request.POST, {})\n \n-    def test_raw_post_data_after_POST_multipart(self):\n+    def test_body_after_POST_multipart(self):\n         \"\"\"\n-        Reading raw_post_data after parsing multipart is not allowed\n+        Reading body after parsing multipart is not allowed\n         \"\"\"\n         # Because multipart is used for large amounts fo data i.e. file uploads,\n         # we don't want the data held in memory twice, and we don't want to\n-        # silence the error by setting raw_post_data = '' either.\n+        # silence the error by setting body = '' either.\n         payload = \"\\r\\n\".join([\n                 '--boundary',\n                 'Content-Disposition: form-data; name=\"name\"',\n@@ -336,7 +338,7 @@ def test_raw_post_data_after_POST_multipart(self):\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n         self.assertEqual(request.POST, {u'name': [u'value']})\n-        self.assertRaises(Exception, lambda: request.raw_post_data)\n+        self.assertRaises(Exception, lambda: request.body)\n \n     def test_POST_multipart_with_content_length_zero(self):\n         \"\"\"\n@@ -366,33 +368,33 @@ def test_read_by_lines(self):\n                                'wsgi.input': StringIO(payload)})\n         self.assertEqual(list(request), ['name=value'])\n \n-    def test_POST_after_raw_post_data_read(self):\n+    def test_POST_after_body_read(self):\n         \"\"\"\n-        POST should be populated even if raw_post_data is read first\n+        POST should be populated even if body is read first\n         \"\"\"\n         payload = 'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n-        raw_data = request.raw_post_data\n+        raw_data = request.body\n         self.assertEqual(request.POST, {u'name': [u'value']})\n \n-    def test_POST_after_raw_post_data_read_and_stream_read(self):\n+    def test_POST_after_body_read_and_stream_read(self):\n         \"\"\"\n-        POST should be populated even if raw_post_data is read first, and then\n+        POST should be populated even if body is read first, and then\n         the stream is read second.\n         \"\"\"\n         payload = 'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n-        raw_data = request.raw_post_data\n+        raw_data = request.body\n         self.assertEqual(request.read(1), u'n')\n         self.assertEqual(request.POST, {u'name': [u'value']})\n \n-    def test_POST_after_raw_post_data_read_and_stream_read_multipart(self):\n+    def test_POST_after_body_read_and_stream_read_multipart(self):\n         \"\"\"\n-        POST should be populated even if raw_post_data is read first, and then\n+        POST should be populated even if body is read first, and then\n         the stream is read second. Using multipart/form-data instead of urlencoded.\n         \"\"\"\n         payload = \"\\r\\n\".join([\n@@ -406,7 +408,23 @@ def test_POST_after_raw_post_data_read_and_stream_read_multipart(self):\n                                'CONTENT_TYPE': 'multipart/form-data; boundary=boundary',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n-        raw_data = request.raw_post_data\n+        raw_data = request.body\n         # Consume enough data to mess up the parsing:\n         self.assertEqual(request.read(13), u'--boundary\\r\\nC')\n         self.assertEqual(request.POST, {u'name': [u'value']})\n+\n+    def test_raw_post_data_returns_body(self):\n+        \"\"\"\n+        HttpRequest.raw_post_body should be the same as HttpRequest.body\n+        \"\"\"\n+        payload = 'Hello There!'\n+        request = WSGIRequest({\n+            'REQUEST_METHOD': 'POST',\n+            'CONTENT_LENGTH': len(payload),\n+            'wsgi.input': StringIO(payload)\n+        })\n+\n+        warnings_state = get_warnings_state()\n+        warnings.filterwarnings('ignore', category=DeprecationWarning, module='django.http')\n+        self.assertEqual(request.body, request.raw_post_data)\n+        restore_warnings_state(warnings_state)"
        },
        {
            "sha": "4ddd95705553be2bfc5181caca520ce1692ad36d",
            "filename": "tests/regressiontests/test_client_regress/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -975,15 +975,16 @@ def test_response_no_template(self):\n \n class ReadLimitedStreamTest(TestCase):\n     \"\"\"\n-    Tests that ensure that HttpRequest.raw_post_data, HttpRequest.read() and\n+    Tests that ensure that HttpRequest.body, HttpRequest.read() and\n     HttpRequest.read(BUFFER) have proper LimitedStream behaviour.\n \n     Refs #14753, #15785\n     \"\"\"\n-    def test_raw_post_data_from_empty_request(self):\n-        \"\"\"HttpRequest.raw_post_data on a test client GET request should return\n+\n+    def test_body_from_empty_request(self):\n+        \"\"\"HttpRequest.body on a test client GET request should return\n         the empty string.\"\"\"\n-        self.assertEquals(self.client.get(\"/test_client_regress/raw_post_data/\").content, '')\n+        self.assertEquals(self.client.get(\"/test_client_regress/body/\").content, '')\n \n     def test_read_from_empty_request(self):\n         \"\"\"HttpRequest.read() on a test client GET request should return the"
        },
        {
            "sha": "d869c234eb1439c0ece8deb591c0e2c1f5466649",
            "filename": "tests/regressiontests/test_client_regress/urls.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Ftest_client_regress%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Ftest_client_regress%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Furls.py?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -31,7 +31,7 @@\n     (r'^parse_unicode_json/$', views.return_json_file),\n     (r'^check_headers/$', views.check_headers),\n     (r'^check_headers_redirect/$', RedirectView.as_view(url='/test_client_regress/check_headers/')),\n-    (r'^raw_post_data/$', views.raw_post_data),\n+    (r'^body/$', views.body),\n     (r'^read_all/$', views.read_all),\n     (r'^read_buffer/$', views.read_buffer),\n     (r'^request_context_view/$', views.request_context_view),"
        },
        {
            "sha": "ebb68c4c827e46d454a870add8802ed12d1d7ba3",
            "filename": "tests/regressiontests/test_client_regress/views.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/3f003a3c4b5338915e3889da8bf10577296459b3/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py?ref=3f003a3c4b5338915e3889da8bf10577296459b3",
            "patch": "@@ -1,3 +1,5 @@\n+import warnings\n+\n from django.conf import settings\n from django.contrib.auth.decorators import login_required\n from django.http import HttpResponse, HttpResponseRedirect\n@@ -79,7 +81,7 @@ def return_json_file(request):\n         charset = settings.DEFAULT_CHARSET\n \n     # This just checks that the uploaded data is JSON\n-    obj_dict = simplejson.loads(request.raw_post_data.decode(charset))\n+    obj_dict = simplejson.loads(request.body.decode(charset))\n     obj_json = simplejson.dumps(obj_dict, encoding=charset,\n                                 cls=DjangoJSONEncoder,\n                                 ensure_ascii=False)\n@@ -92,9 +94,9 @@ def check_headers(request):\n     \"A view that responds with value of the X-ARG-CHECK header\"\n     return HttpResponse('HTTP_X_ARG_CHECK: %s' % request.META.get('HTTP_X_ARG_CHECK', 'Undefined'))\n \n-def raw_post_data(request):\n-    \"A view that is requested with GET and accesses request.raw_post_data. Refs #14753.\"\n-    return HttpResponse(request.raw_post_data)\n+def body(request):\n+    \"A view that is requested with GET and accesses request.body. Refs #14753.\"\n+    return HttpResponse(request.body)\n \n def read_all(request):\n     \"A view that is requested with accesses request.read().\""
        }
    ],
    "stats": {
        "total": 142,
        "additions": 92,
        "deletions": 50
    }
}