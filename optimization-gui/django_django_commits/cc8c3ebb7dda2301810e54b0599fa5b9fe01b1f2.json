{
    "author": "alex",
    "message": "Converted Chilean localflavor doctests to unittests.  We have always been at war with doctests.  Thanks to Idan Gazit.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14936 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2",
    "files": [
        {
            "sha": "15b8c7b285e045134e5c75b7b22744b972cf6495",
            "filename": "tests/regressiontests/forms/localflavor/cl.py",
            "status": "modified",
            "additions": 56,
            "deletions": 74,
            "changes": 130,
            "blob_url": "https://github.com/django/django/blob/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fcl.py",
            "raw_url": "https://github.com/django/django/raw/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fcl.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fcl.py?ref=cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2",
            "patch": "@@ -1,74 +1,56 @@\n-\n-# Tests for the contrib/localflavor/ CL form fields.\n-\n-tests = r\"\"\"\n-## CLRutField #############################################################\n-\n-CLRutField is a Field that checks the validity of the Chilean\n-personal identification number (RUT). It has two modes relaxed (default) and\n-strict.\n-\n->>> from django.contrib.localflavor.cl.forms import CLRutField\n->>> rut = CLRutField()\n-\n->>> rut.clean('11-6')\n-u'11-6'\n->>> rut.clean('116')\n-u'11-6'\n-\n-# valid format, bad verifier.\n->>> rut.clean('11.111.111-0')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'The Chilean RUT is not valid.']\n->>> rut.clean('111')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'The Chilean RUT is not valid.']\n-\n->>> rut.clean('767484100')\n-u'76.748.410-0'\n->>> rut.clean('78.412.790-7')\n-u'78.412.790-7'\n->>> rut.clean('8.334.6043')\n-u'8.334.604-3'\n->>> rut.clean('76793310-K')\n-u'76.793.310-K'\n-\n-Strict RUT usage (does not allow imposible values)\n->>> rut = CLRutField(strict=True)\n-\n->>> rut.clean('11-6')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Chilean RUT. The format is XX.XXX.XXX-X.']\n-\n-# valid format, bad verifier.\n->>> rut.clean('11.111.111-0')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'The Chilean RUT is not valid.']\n-\n-# Correct input, invalid format.\n->>> rut.clean('767484100')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Chilean RUT. The format is XX.XXX.XXX-X.']\n->>> rut.clean('78.412.790-7')\n-u'78.412.790-7'\n->>> rut.clean('8.334.6043')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Chilean RUT. The format is XX.XXX.XXX-X.']\n->>> rut.clean('76793310-K')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Chilean RUT. The format is XX.XXX.XXX-X.']\n-\n-## CLRegionSelect #########################################################\n->>> from django.contrib.localflavor.cl.forms import CLRegionSelect\n->>> f = CLRegionSelect()\n-\n->>> f.render('foo', 'bar')\n-u'<select name=\"foo\">\\n<option value=\"RM\">Regi\\xf3n Metropolitana de Santiago</option>\\n<option value=\"I\">Regi\\xf3n de Tarapac\\xe1</option>\\n<option value=\"II\">Regi\\xf3n de Antofagasta</option>\\n<option value=\"III\">Regi\\xf3n de Atacama</option>\\n<option value=\"IV\">Regi\\xf3n de Coquimbo</option>\\n<option value=\"V\">Regi\\xf3n de Valpara\\xedso</option>\\n<option value=\"VI\">Regi\\xf3n del Libertador Bernardo O&#39;Higgins</option>\\n<option value=\"VII\">Regi\\xf3n del Maule</option>\\n<option value=\"VIII\">Regi\\xf3n del B\\xedo B\\xedo</option>\\n<option value=\"IX\">Regi\\xf3n de la Araucan\\xeda</option>\\n<option value=\"X\">Regi\\xf3n de los Lagos</option>\\n<option value=\"XI\">Regi\\xf3n de Ays\\xe9n del General Carlos Ib\\xe1\\xf1ez del Campo</option>\\n<option value=\"XII\">Regi\\xf3n de Magallanes y la Ant\\xe1rtica Chilena</option>\\n<option value=\"XIV\">Regi\\xf3n de Los R\\xedos</option>\\n<option value=\"XV\">Regi\\xf3n de Arica-Parinacota</option>\\n</select>'\n-\"\"\"\n+from django.contrib.localflavor.cl.forms import CLRutField, CLRegionSelect\n+from django.core.exceptions import ValidationError\n+\n+from utils import LocalFlavorTestCase\n+\n+\n+class CLLocalFlavorTests(LocalFlavorTestCase):\n+    def test_CLRegionSelect(self):\n+        f = CLRegionSelect()\n+        out = u'''<select name=\"foo\">\n+<option value=\"RM\">Regi\\xf3n Metropolitana de Santiago</option>\n+<option value=\"I\">Regi\\xf3n de Tarapac\\xe1</option>\n+<option value=\"II\">Regi\\xf3n de Antofagasta</option>\n+<option value=\"III\">Regi\\xf3n de Atacama</option>\n+<option value=\"IV\">Regi\\xf3n de Coquimbo</option>\n+<option value=\"V\">Regi\\xf3n de Valpara\\xedso</option>\n+<option value=\"VI\">Regi\\xf3n del Libertador Bernardo O&#39;Higgins</option>\n+<option value=\"VII\">Regi\\xf3n del Maule</option>\n+<option value=\"VIII\">Regi\\xf3n del B\\xedo B\\xedo</option>\n+<option value=\"IX\">Regi\\xf3n de la Araucan\\xeda</option>\n+<option value=\"X\">Regi\\xf3n de los Lagos</option>\n+<option value=\"XI\">Regi\\xf3n de Ays\\xe9n del General Carlos Ib\\xe1\\xf1ez del Campo</option>\n+<option value=\"XII\">Regi\\xf3n de Magallanes y la Ant\\xe1rtica Chilena</option>\n+<option value=\"XIV\">Regi\\xf3n de Los R\\xedos</option>\n+<option value=\"XV\">Regi\\xf3n de Arica-Parinacota</option>\n+</select>'''\n+        self.assertEqual(f.render('foo', 'bar'), out)\n+\n+    def test_CLRutField(self):\n+        error_invalid =  [u'The Chilean RUT is not valid.']\n+        error_format = [u'Enter a valid Chilean RUT. The format is XX.XXX.XXX-X.']\n+        valid = {\n+            '11-6': '11-6',\n+            '116': '11-6',\n+            '767484100': '76.748.410-0',\n+            '78.412.790-7': '78.412.790-7',\n+            '8.334.6043': '8.334.604-3',\n+            '76793310-K': '76.793.310-K',\n+        }\n+        invalid = {\n+            '11.111.111-0': error_invalid,\n+            '111': error_invalid,\n+        }\n+        self.assertFieldOutput(CLRutField, valid, invalid)\n+\n+        # deal with special \"Strict Mode\".\n+        invalid = {\n+            '11-6': error_format,\n+            '767484100': error_format,\n+            '8.334.6043': error_format,\n+            '76793310-K': error_format,\n+            '11.111.111-0': error_invalid\n+        }\n+        self.assertFieldOutput(CLRutField,\n+            {}, invalid, field_kwargs={\"strict\": True}\n+        )"
        },
        {
            "sha": "df1c3c2de36627d3c1023a8ef2af1591b6684676",
            "filename": "tests/regressiontests/forms/localflavor/utils.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py?ref=cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2",
            "patch": "@@ -4,7 +4,8 @@\n \n \n class LocalFlavorTestCase(TestCase):\n-    def assertFieldOutput(self, fieldclass, valid, invalid):\n+    def assertFieldOutput(self, fieldclass, valid, invalid, field_args=[],\n+        field_kwargs={}, empty_value=u''):\n         \"\"\"Asserts that a field behaves correctly with various inputs.\n \n         Args:\n@@ -13,10 +14,12 @@ def assertFieldOutput(self, fieldclass, valid, invalid):\n                     cleaned values.\n             invalid: a dictionary mapping invalid inputs to one or more\n                     raised error messages.\n+            fieldargs: the args passed to instantiate the field\n+            fieldkwargs: the kwargs passed to instantiate the field\n+            emptyvalue: the expected clean output for inputs in EMPTY_VALUES\n         \"\"\"\n-\n-        required = fieldclass()\n-        optional = fieldclass(required=False)\n+        required = fieldclass(*field_args, **field_kwargs)\n+        optional = fieldclass(*field_args, required=False, **field_kwargs)\n         # test valid inputs\n         for input, output in valid.items():\n             self.assertEqual(required.clean(input), output)\n@@ -33,6 +36,5 @@ def assertFieldOutput(self, fieldclass, valid, invalid):\n         error_required = u'This field is required'\n         for e in EMPTY_VALUES:\n             self.assertRaisesRegexp(ValidationError, error_required,\n-                required.clean, e\n-            )\n-            self.assertEqual(optional.clean(e), u'')\n+                required.clean, e)\n+            self.assertEqual(optional.clean(e), empty_value)"
        },
        {
            "sha": "143ada198101cb07e53d98ab4a398601e0c6fcb7",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2",
            "patch": "@@ -1,5 +1,4 @@\n # -*- coding: utf-8 -*-\n-from localflavor.cl import tests as localflavor_cl_tests\n from localflavor.cz import tests as localflavor_cz_tests\n from localflavor.es import tests as localflavor_es_tests\n from localflavor.fi import tests as localflavor_fi_tests\n@@ -30,12 +29,12 @@\n from localflavor.br import BRLocalFlavorTests\n from localflavor.ca import CALocalFlavorTests\n from localflavor.ch import CHLocalFlavorTests\n+from localflavor.cl import CLLocalFlavorTests\n from localflavor.il import ILLocalFlavorTests\n from localflavor.tr import TRLocalFlavorTests\n \n \n __test__ = {\n-    'localflavor_cl_tests': localflavor_cl_tests,\n     'localflavor_cz_tests': localflavor_cz_tests,\n     'localflavor_es_tests': localflavor_es_tests,\n     'localflavor_fi_tests': localflavor_fi_tests,"
        },
        {
            "sha": "ea2f098ba8dde5a496a2625a644c94f2166a082a",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=cc8c3ebb7dda2301810e54b0599fa5b9fe01b1f2",
            "patch": "@@ -20,6 +20,7 @@\n     BRLocalFlavorTests,\n     CALocalFlavorTests,\n     CHLocalFlavorTests,\n+    CLLocalFlavorTests,\n     DELocalFlavorTests,\n     ILLocalFlavorTests,\n     TRLocalFlavorTests,"
        }
    ],
    "stats": {
        "total": 150,
        "additions": 67,
        "deletions": 83
    }
}