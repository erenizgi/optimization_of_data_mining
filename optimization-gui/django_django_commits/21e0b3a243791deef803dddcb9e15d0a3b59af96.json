{
    "author": "jezdez",
    "message": "Fixed #16424 -- Fixed regression in collect static management command introduced in r16509 that prevented prefixed collection.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16519 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "21e0b3a243791deef803dddcb9e15d0a3b59af96",
    "files": [
        {
            "sha": "246f960583c571b3330bc55b25e468a04cfbb441",
            "filename": "django/contrib/staticfiles/management/commands/collectstatic.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/21e0b3a243791deef803dddcb9e15d0a3b59af96/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "raw_url": "https://github.com/django/django/raw/21e0b3a243791deef803dddcb9e15d0a3b59af96/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py?ref=21e0b3a243791deef803dddcb9e15d0a3b59af96",
            "patch": "@@ -107,8 +107,10 @@ def handle_noargs(self, **options):\n             for path, storage in finder.list(self.ignore_patterns):\n                 # Prefix the relative path if the source storage contains it\n                 if getattr(storage, 'prefix', None):\n-                    path = os.path.join(storage.prefix, path)\n-                handler(path, path, storage)\n+                    prefixed_path = os.path.join(storage.prefix, path)\n+                else:\n+                    prefixed_path = path\n+                handler(path, prefixed_path, storage)\n \n         actual_count = len(self.copied_files) + len(self.symlinked_files)\n         unmodified_count = len(self.unmodified_files)"
        },
        {
            "sha": "d3a017895ce66c9c8c2f009c4c50bba5419a03be",
            "filename": "tests/regressiontests/staticfiles_tests/project/prefixed/test.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/21e0b3a243791deef803dddcb9e15d0a3b59af96/tests%2Fregressiontests%2Fstaticfiles_tests%2Fproject%2Fprefixed%2Ftest.txt",
            "raw_url": "https://github.com/django/django/raw/21e0b3a243791deef803dddcb9e15d0a3b59af96/tests%2Fregressiontests%2Fstaticfiles_tests%2Fproject%2Fprefixed%2Ftest.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Fproject%2Fprefixed%2Ftest.txt?ref=21e0b3a243791deef803dddcb9e15d0a3b59af96",
            "patch": "@@ -0,0 +1 @@\n+Prefix!\n\\ No newline at end of file"
        },
        {
            "sha": "77b771d23d2006eac7e2d7afc6bd506e0a13390c",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/21e0b3a243791deef803dddcb9e15d0a3b59af96/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/21e0b3a243791deef803dddcb9e15d0a3b59af96/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=21e0b3a243791deef803dddcb9e15d0a3b59af96",
            "patch": "@@ -54,7 +54,10 @@ def assertFileNotFound(self, filepath):\n     STATIC_URL = '/static/',\n     MEDIA_ROOT =  os.path.join(TEST_ROOT, 'project', 'site_media', 'media'),\n     STATIC_ROOT = os.path.join(TEST_ROOT, 'project', 'site_media', 'static'),\n-    STATICFILES_DIRS = (os.path.join(TEST_ROOT, 'project', 'documents'),),\n+    STATICFILES_DIRS = (\n+        os.path.join(TEST_ROOT, 'project', 'documents'),\n+        ('prefix', os.path.join(TEST_ROOT, 'project', 'prefixed')),\n+    ),\n     STATICFILES_FINDERS = (\n         'django.contrib.staticfiles.finders.FileSystemFinder',\n         'django.contrib.staticfiles.finders.AppDirectoriesFinder',\n@@ -105,6 +108,7 @@ def test_staticfiles_dirs(self):\n         Can find a file in a STATICFILES_DIRS directory.\n         \"\"\"\n         self.assertFileContains('test.txt', 'Can we find')\n+        self.assertFileContains(os.path.join('prefix', 'test.txt'), 'Prefix')\n \n     def test_staticfiles_dirs_subdir(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 13,
        "additions": 10,
        "deletions": 3
    }
}