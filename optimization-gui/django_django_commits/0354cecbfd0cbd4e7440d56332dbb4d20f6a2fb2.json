{
    "author": "andrewgodwin",
    "message": "Fix nullability changing code",
    "sha": "0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2",
    "files": [
        {
            "sha": "09d1202aadfd932cc5b2b91e595b81bdd19d71d7",
            "filename": "django/db/backends/schema.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2/django%2Fdb%2Fbackends%2Fschema.py",
            "raw_url": "https://github.com/django/django/raw/0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2/django%2Fdb%2Fbackends%2Fschema.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fschema.py?ref=0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2",
            "patch": "@@ -495,7 +495,7 @@ def alter_field(self, model, old_field, new_field, strict=False):\n                 ))\n             else:\n                 actions.append((\n-                    self.sql_alter_column_null % {\n+                    self.sql_alter_column_not_null % {\n                         \"column\": self.quote_name(new_field.column),\n                         \"type\": new_type,\n                     },"
        },
        {
            "sha": "c1df0c798173c09e2aeb1e3590b3285721382ac8",
            "filename": "django/db/backends/sqlite3/schema.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2/django%2Fdb%2Fbackends%2Fsqlite3%2Fschema.py",
            "raw_url": "https://github.com/django/django/raw/0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2/django%2Fdb%2Fbackends%2Fsqlite3%2Fschema.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fschema.py?ref=0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2",
            "patch": "@@ -153,4 +153,4 @@ def _alter_many_to_many(self, model, old_field, new_field, strict):\n             self.quote_name(old_field.rel.through._meta.db_table),\n         ))\n         # Delete the old through table\n-        self.delete_model(old_field.rel.through, force=True)\n+        self.delete_model(old_field.rel.through)"
        },
        {
            "sha": "9818b0451c6384c2ac22913236baaca4c314a411",
            "filename": "tests/modeltests/schema/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fschema%2Ftests.py?ref=0354cecbfd0cbd4e7440d56332dbb4d20f6a2fb2",
            "patch": "@@ -205,12 +205,28 @@ def test_alter(self):\n             Author._meta.get_field_by_name(\"name\")[0],\n             new_field,\n             strict=True,\n-          )\n+        )\n         editor.commit()\n         # Ensure the field is right afterwards\n         columns = self.column_classes(Author)\n         self.assertEqual(columns['name'][0], \"TextField\")\n         self.assertEqual(columns['name'][1][6], True)\n+        # Change nullability again\n+        new_field2 = TextField(null=False)\n+        new_field2.set_attributes_from_name(\"name\")\n+        editor = connection.schema_editor()\n+        editor.start()\n+        editor.alter_field(\n+            Author,\n+            new_field,\n+            new_field2,\n+            strict=True,\n+        )\n+        editor.commit()\n+        # Ensure the field is right afterwards\n+        columns = self.column_classes(Author)\n+        self.assertEqual(columns['name'][0], \"TextField\")\n+        self.assertEqual(columns['name'][1][6], False)\n \n     def test_rename(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 22,
        "additions": 19,
        "deletions": 3
    }
}