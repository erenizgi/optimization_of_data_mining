{
    "author": "carljm",
    "message": "Added a new required ALLOWED_HOSTS setting for HTTP host header validation.\n\nThis is a security fix; disclosure and advisory coming shortly.",
    "sha": "d51fb74360b94f2a856573174f8aae3cd905dd35",
    "files": [
        {
            "sha": "659f2f42b71074ba32b47d5a010b6c91d0405bcc",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -29,6 +29,10 @@\n #   * Receive x-headers\n INTERNAL_IPS = ()\n \n+# Hosts/domain names that are valid for this site.\n+# \"*\" matches anything, \".example.com\" matches example.com and all subdomains\n+ALLOWED_HOSTS = []\n+\n # Local time zone for this installation. All choices can be found here:\n # http://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n # systems may support all possibilities). When USE_TZ is True, this is"
        },
        {
            "sha": "d46f3279228516b79cb4fc4d54de9930b196c97c",
            "filename": "django/conf/project_template/project_name/settings.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fproject_name%2Fsettings.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -25,6 +25,10 @@\n \n TEMPLATE_DEBUG = True\n \n+# Hosts/domain names that are valid for this site; required if DEBUG is False\n+# See https://docs.djangoproject.com/en/{{ docs_version }}/ref/settings/#allowed-hosts\n+ALLOWED_HOSTS = []\n+\n \n # Application definition\n "
        },
        {
            "sha": "229e2943982cae4e4201372d72a246a6138cac2c",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -108,6 +108,7 @@ def test_email_found_custom_from(self):\n         self.assertEqual(len(mail.outbox), 1)\n         self.assertEqual(\"staffmember@example.com\", mail.outbox[0].from_email)\n \n+    @override_settings(ALLOWED_HOSTS=['adminsite.com'])\n     def test_admin_reset(self):\n         \"If the reset view is marked as being for admin, the HTTP_HOST header is used for a domain override.\"\n         response = self.client.post('/admin_password_reset/',"
        },
        {
            "sha": "7937873a000d29f6df5984a731742c71b5f114b0",
            "filename": "django/contrib/contenttypes/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Ftests.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -6,6 +6,7 @@\n from django.contrib.sites.models import Site, get_current_site\n from django.http import HttpRequest, Http404\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils.http import urlquote\n from django.utils import six\n from django.utils.encoding import python_2_unicode_compatible\n@@ -203,6 +204,7 @@ def test_get_for_concrete_models(self):\n         })\n \n \n+    @override_settings(ALLOWED_HOSTS=['example.com'])\n     def test_shortcut_view(self):\n         \"\"\"\n         Check that the shortcut view (used for the admin \"view on site\""
        },
        {
            "sha": "cdbd78b80dec5e6f8392a91b277c297e7646f0e1",
            "filename": "django/contrib/sites/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fcontrib%2Fsites%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fcontrib%2Fsites%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsites%2Ftests.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -5,6 +5,7 @@\n from django.core.exceptions import ObjectDoesNotExist\n from django.http import HttpRequest\n from django.test import TestCase\n+from django.test.utils import override_settings\n \n \n class SitesFrameworkTests(TestCase):\n@@ -41,6 +42,7 @@ def test_site_cache(self):\n         site = Site.objects.get_current()\n         self.assertEqual(\"Example site\", site.name)\n \n+    @override_settings(ALLOWED_HOSTS=['example.com'])\n     def test_get_current_site(self):\n         # Test that the correct Site object is returned\n         request = HttpRequest()"
        },
        {
            "sha": "2c19e4ee8c4772b25a12640bf234f0dc1e197ebe",
            "filename": "django/http/request.py",
            "status": "modified",
            "additions": 48,
            "deletions": 5,
            "changes": 53,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fhttp%2Frequest.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Fhttp%2Frequest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Frequest.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -64,11 +64,12 @@ def get_host(self):\n             if server_port != ('443' if self.is_secure() else '80'):\n                 host = '%s:%s' % (host, server_port)\n \n-        # Disallow potentially poisoned hostnames.\n-        if not host_validation_re.match(host.lower()):\n-            raise SuspiciousOperation('Invalid HTTP_HOST header: %s' % host)\n-\n-        return host\n+        allowed_hosts = ['*'] if settings.DEBUG else settings.ALLOWED_HOSTS\n+        if validate_host(host, allowed_hosts):\n+            return host\n+        else:\n+            raise SuspiciousOperation(\n+                \"Invalid HTTP_HOST header (you may need to set ALLOWED_HOSTS): %s\" % host)\n \n     def get_full_path(self):\n         # RFC 3986 requires query string arguments to be in the ASCII range.\n@@ -450,3 +451,45 @@ def bytes_to_text(s, encoding):\n         return six.text_type(s, encoding, 'replace')\n     else:\n         return s\n+\n+\n+def validate_host(host, allowed_hosts):\n+    \"\"\"\n+    Validate the given host header value for this site.\n+\n+    Check that the host looks valid and matches a host or host pattern in the\n+    given list of ``allowed_hosts``. Any pattern beginning with a period\n+    matches a domain and all its subdomains (e.g. ``.example.com`` matches\n+    ``example.com`` and any subdomain), ``*`` matches anything, and anything\n+    else must match exactly.\n+\n+    Return ``True`` for a valid host, ``False`` otherwise.\n+\n+    \"\"\"\n+    # All validation is case-insensitive\n+    host = host.lower()\n+\n+    # Basic sanity check\n+    if not host_validation_re.match(host):\n+        return False\n+\n+    # Validate only the domain part.\n+    if host[-1] == ']':\n+        # It's an IPv6 address without a port.\n+        domain = host\n+    else:\n+        domain = host.rsplit(':', 1)[0]\n+\n+    for pattern in allowed_hosts:\n+        pattern = pattern.lower()\n+        match = (\n+            pattern == '*' or\n+            pattern.startswith('.') and (\n+                domain.endswith(pattern) or domain == pattern[1:]\n+                ) or\n+            pattern == domain\n+            )\n+        if match:\n+            return True\n+\n+    return False"
        },
        {
            "sha": "5d20120f58ae46a73b5a4f7397e7a892151e801d",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -78,6 +78,9 @@ def setup_test_environment():\n     mail.original_email_backend = settings.EMAIL_BACKEND\n     settings.EMAIL_BACKEND = 'django.core.mail.backends.locmem.EmailBackend'\n \n+    settings._original_allowed_hosts = settings.ALLOWED_HOSTS\n+    settings.ALLOWED_HOSTS = ['*']\n+\n     mail.outbox = []\n \n     deactivate()\n@@ -96,6 +99,9 @@ def teardown_test_environment():\n     settings.EMAIL_BACKEND = mail.original_email_backend\n     del mail.original_email_backend\n \n+    settings.ALLOWED_HOSTS = settings._original_allowed_hosts\n+    del settings._original_allowed_hosts\n+\n     del mail.outbox\n \n "
        },
        {
            "sha": "bba936d837ccc59fa52428d020554065b5e69d87",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -56,6 +56,42 @@ of (Full name, email address). Example::\n Note that Django will email *all* of these people whenever an error happens.\n See :doc:`/howto/error-reporting` for more information.\n \n+.. setting:: ALLOWED_HOSTS\n+\n+ALLOWED_HOSTS\n+-------------\n+\n+Default: ``[]`` (Empty list)\n+\n+A list of strings representing the host/domain names that this Django site can\n+serve. This is a security measure to prevent an attacker from poisoning caches\n+and password reset emails with links to malicious hosts by submitting requests\n+with a fake HTTP ``Host`` header, which is possible even under many\n+seemingly-safe webserver configurations.\n+\n+Values in this list can be fully qualified names (e.g. ``'www.example.com'``),\n+in which case they will be matched against the request's ``Host`` header\n+exactly (case-insensitive, not including port). A value beginning with a period\n+can be used as a subdomain wildcard: ``'.example.com'`` will match\n+``example.com``, ``www.example.com``, and any other subdomain of\n+``example.com``. A value of ``'*'`` will match anything; in this case you are\n+responsible to provide your own validation of the ``Host`` header (perhaps in a\n+middleware; if so this middleware must be listed first in\n+:setting:`MIDDLEWARE_CLASSES`).\n+\n+If the ``Host`` header (or ``X-Forwarded-Host`` if\n+:setting:`USE_X_FORWARDED_HOST` is enabled) does not match any value in this\n+list, the :meth:`django.http.HttpRequest.get_host()` method will raise\n+:exc:`~django.core.exceptions.SuspiciousOperation`.\n+\n+When :setting:`DEBUG` is ``True`` or when running tests, host validation is\n+disabled; any host will be accepted. Thus it's usually only necessary to set it\n+in production.\n+\n+This validation only applies via :meth:`~django.http.HttpRequest.get_host()`;\n+if your code accesses the ``Host`` header directly from ``request.META`` you\n+are bypassing this security protection.\n+\n .. setting:: ALLOWED_INCLUDE_ROOTS\n \n ALLOWED_INCLUDE_ROOTS"
        },
        {
            "sha": "63f97587625fa994078244a1743c131656ebffdd",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -354,6 +354,16 @@ Backwards incompatible changes in 1.5\n     deprecation timeline for a given feature, its removal may appear as a\n     backwards incompatible change.\n \n+``ALLOWED_HOSTS`` required in production\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The new :setting:`ALLOWED_HOSTS` setting validates the request's ``Host``\n+header and protects against host-poisoning attacks. This setting is now\n+required whenever :setting:`DEBUG` is ``False``, or else\n+:meth:`django.http.HttpRequest.get_host()` will raise\n+:exc:`~django.core.exceptions.SuspiciousOperation`. For more details see the\n+:setting:`full documentation<ALLOWED_HOSTS>` for the new setting.\n+\n Managers on abstract models\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "566202eefa6d6c4405f6477745a18d2d5e9ebd10",
            "filename": "docs/topics/security.txt",
            "status": "modified",
            "additions": 30,
            "deletions": 37,
            "changes": 67,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/docs%2Ftopics%2Fsecurity.txt",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/docs%2Ftopics%2Fsecurity.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fsecurity.txt?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -160,47 +160,40 @@ server, there are some additional steps you may need:\n \n .. _host-headers-virtual-hosting:\n \n-Host headers and virtual hosting\n-================================\n+Host header validation\n+======================\n \n-Django uses the ``Host`` header provided by the client to construct URLs\n-in certain cases. While these values are sanitized to prevent Cross\n-Site Scripting attacks, they can be used for Cross-Site Request\n-Forgery and cache poisoning attacks in some circumstances. We\n-recommend you ensure your Web server is configured such that:\n+Django uses the ``Host`` header provided by the client to construct URLs in\n+certain cases. While these values are sanitized to prevent Cross Site Scripting\n+attacks, a fake ``Host`` value can be used for Cross-Site Request Forgery,\n+cache poisoning attacks, and poisoning links in emails.\n \n-* It always validates incoming HTTP ``Host`` headers against the expected\n-  host name.\n-* Disallows requests with no ``Host`` header.\n-* Is *not* configured with a catch-all virtual host that forwards requests\n-  to a Django application.\n+Because even seemingly-secure webserver configurations are susceptible to fake\n+``Host`` headers, Django validates ``Host`` headers against the\n+:setting:`ALLOWED_HOSTS` setting in the\n+:meth:`django.http.HttpRequest.get_host()` method.\n+\n+This validation only applies via :meth:`~django.http.HttpRequest.get_host()`;\n+if your code accesses the ``Host`` header directly from ``request.META`` you\n+are bypassing this security protection.\n+\n+For more details see the full :setting:`ALLOWED_HOSTS` documentation.\n+\n+.. warning::\n+\n+   Previous versions of this document recommended configuring your webserver to\n+   ensure it validates incoming HTTP ``Host`` headers. While this is still\n+   recommended, in many common webservers a configuration that seems to\n+   validate the ``Host`` header may not in fact do so. For instance, even if\n+   Apache is configured such that your Django site is served from a non-default\n+   virtual host with the ``ServerName`` set, it is still possible for an HTTP\n+   request to match this virtual host and supply a fake ``Host`` header. Thus,\n+   Django now requires that you set :setting:`ALLOWED_HOSTS` explicitly rather\n+   than relying on webserver configuration.\n \n Additionally, as of 1.3.1, Django requires you to explicitly enable support for\n-the ``X-Forwarded-Host`` header if your configuration requires it.\n-\n-Configuration for Apache\n-------------------------\n-\n-The easiest way to get the described behavior in Apache is as follows. Create\n-a `virtual host`_ using the ServerName_ and ServerAlias_ directives to restrict\n-the domains Apache reacts to. Please keep in mind that while the directives do\n-support ports the match is only performed against the hostname. This means that\n-the ``Host`` header could still contain a port pointing to another webserver on\n-the same machine. The next step is to make sure that your newly created virtual\n-host is not also the default virtual host. Apache uses the first virtual host\n-found in the configuration file as default virtual host.  As such you have to\n-ensure that you have another virtual host which will act as catch-all virtual\n-host. Just add one if you do not have one already, there is nothing special\n-about it aside from ensuring it is the first virtual host in the configuration\n-file. Debian/Ubuntu users usually don't have to take any action, since Apache\n-ships with a default virtual host in ``sites-available`` which is linked into\n-``sites-enabled`` as ``000-default`` and included from ``apache2.conf``. Just\n-make sure not to name your site ``000-abc``, since files are included in\n-alphabetical order.\n-\n-.. _virtual host: http://httpd.apache.org/docs/2.2/vhosts/\n-.. _ServerName: http://httpd.apache.org/docs/2.2/mod/core.html#servername\n-.. _ServerAlias: http://httpd.apache.org/docs/2.2/mod/core.html#serveralias\n+the ``X-Forwarded-Host`` header (via the :setting:`USE_X_FORWARDED_HOST`\n+setting) if your configuration requires it.\n \n \n .. _additional-security-topics:"
        },
        {
            "sha": "5300b2172aae5692923ebdef073f599345769f66",
            "filename": "tests/regressiontests/csrf_tests/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -7,6 +7,7 @@\n from django.middleware.csrf import CsrfViewMiddleware, CSRF_KEY_LENGTH\n from django.template import RequestContext, Template\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.views.decorators.csrf import csrf_exempt, requires_csrf_token, ensure_csrf_cookie\n \n \n@@ -269,6 +270,7 @@ def test_token_node_with_new_csrf_cookie(self):\n         csrf_cookie = resp2.cookies[settings.CSRF_COOKIE_NAME]\n         self._check_token_present(resp, csrf_id=csrf_cookie.value)\n \n+    @override_settings(ALLOWED_HOSTS=['www.example.com'])\n     def test_https_bad_referer(self):\n         \"\"\"\n         Test that a POST HTTPS request with a bad referer is rejected\n@@ -281,6 +283,7 @@ def test_https_bad_referer(self):\n         self.assertNotEqual(None, req2)\n         self.assertEqual(403, req2.status_code)\n \n+    @override_settings(ALLOWED_HOSTS=['www.example.com'])\n     def test_https_good_referer(self):\n         \"\"\"\n         Test that a POST HTTPS request with a good referer is accepted\n@@ -292,6 +295,7 @@ def test_https_good_referer(self):\n         req2 = CsrfViewMiddleware().process_view(req, post_form_view, (), {})\n         self.assertEqual(None, req2)\n \n+    @override_settings(ALLOWED_HOSTS=['www.example.com'])\n     def test_https_good_referer_2(self):\n         \"\"\"\n         Test that a POST HTTPS request with a good referer is accepted"
        },
        {
            "sha": "345376d2df75a9251bdb4036f6622593c9a0db71",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 22,
            "deletions": 2,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/d51fb74360b94f2a856573174f8aae3cd905dd35/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d51fb74360b94f2a856573174f8aae3cd905dd35/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=d51fb74360b94f2a856573174f8aae3cd905dd35",
            "patch": "@@ -84,7 +84,13 @@ def test_httprequest_location(self):\n         self.assertEqual(request.build_absolute_uri(location=\"/path/with:colons\"),\n             'http://www.example.com/path/with:colons')\n \n-    @override_settings(USE_X_FORWARDED_HOST=False)\n+    @override_settings(\n+        USE_X_FORWARDED_HOST=False,\n+        ALLOWED_HOSTS=[\n+            'forward.com', 'example.com', 'internal.com', '12.34.56.78',\n+            '[2001:19f0:feee::dead:beef:cafe]', 'xn--4ca9at.com',\n+            '.multitenant.com', 'INSENSITIVE.com',\n+            ])\n     def test_http_get_host(self):\n         # Check if X_FORWARDED_HOST is provided.\n         request = HttpRequest()\n@@ -131,6 +137,9 @@ def test_http_get_host(self):\n             '[2001:19f0:feee::dead:beef:cafe]',\n             '[2001:19f0:feee::dead:beef:cafe]:8080',\n             'xn--4ca9at.com', # Punnycode for öäü.com\n+            'anything.multitenant.com',\n+            'multitenant.com',\n+            'insensitive.com',\n         ]\n \n         poisoned_hosts = [\n@@ -139,6 +148,7 @@ def test_http_get_host(self):\n             'example.com:dr.frankenstein@evil.tld:80',\n             'example.com:80/badpath',\n             'example.com: recovermypassword.com',\n+            'other.com', # not in ALLOWED_HOSTS\n         ]\n \n         for host in legit_hosts:\n@@ -156,7 +166,7 @@ def test_http_get_host(self):\n                 }\n                 request.get_host()\n \n-    @override_settings(USE_X_FORWARDED_HOST=True)\n+    @override_settings(USE_X_FORWARDED_HOST=True, ALLOWED_HOSTS=['*'])\n     def test_http_get_host_with_x_forwarded_host(self):\n         # Check if X_FORWARDED_HOST is provided.\n         request = HttpRequest()\n@@ -229,6 +239,16 @@ def test_http_get_host_with_x_forwarded_host(self):\n                 request.get_host()\n \n \n+    @override_settings(DEBUG=True, ALLOWED_HOSTS=[])\n+    def test_host_validation_disabled_in_debug_mode(self):\n+        \"\"\"If ALLOWED_HOSTS is empty and DEBUG is True, all hosts pass.\"\"\"\n+        request = HttpRequest()\n+        request.META = {\n+            'HTTP_HOST': 'example.com',\n+        }\n+        self.assertEqual(request.get_host(), 'example.com')\n+\n+\n     def test_near_expiration(self):\n         \"Cookie will expire when an near expiration time is provided\"\n         response = HttpResponse()"
        }
    ],
    "stats": {
        "total": 213,
        "additions": 169,
        "deletions": 44
    }
}