{
    "author": "jezdez",
    "message": "Fixed #10498 -- Fixed using ugettext_lazy values when creating model instances. Thanks to Claude Paroz and Jonas Obrist.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17641 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c988397279147b9d38c5b3feed9647c586fa049a",
    "files": [
        {
            "sha": "53b62df135c602c2e284ad38c35530b02d93830b",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/c988397279147b9d38c5b3feed9647c586fa049a/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/c988397279147b9d38c5b3feed9647c586fa049a/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=c988397279147b9d38c5b3feed9647c586fa049a",
            "patch": "@@ -20,7 +20,7 @@\n from django.db.models import signals\n from django.db.models.loading import register_models, get_model\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.functional import curry\n+from django.utils.functional import curry, Promise\n from django.utils.encoding import smart_str, force_unicode\n from django.utils.text import get_text_list, capfirst\n \n@@ -297,10 +297,14 @@ def __init__(self, *args, **kwargs):\n             # is *not* consumed. We rely on this, so don't change the order\n             # without changing the logic.\n             for val, field in izip(args, fields_iter):\n+                if isinstance(val, Promise):\n+                    val = force_unicode(val)\n                 setattr(self, field.attname, val)\n         else:\n             # Slower, kwargs-ready version.\n             for val, field in izip(args, fields_iter):\n+                if isinstance(val, Promise):\n+                    val = force_unicode(val)\n                 setattr(self, field.attname, val)\n                 kwargs.pop(field.name, None)\n                 # Maintain compatibility with existing calls.\n@@ -354,6 +358,8 @@ def __init__(self, *args, **kwargs):\n                 # checked) by the RelatedObjectDescriptor.\n                 setattr(self, field.name, rel_obj)\n             else:\n+                if isinstance(val, Promise):\n+                    val = force_unicode(val)\n                 setattr(self, field.attname, val)\n \n         if kwargs:"
        },
        {
            "sha": "d9d67bbb98a1e847efd67e025d484b24a86e7744",
            "filename": "tests/modeltests/many_to_one/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/c988397279147b9d38c5b3feed9647c586fa049a/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c988397279147b9d38c5b3feed9647c586fa049a/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py?ref=c988397279147b9d38c5b3feed9647c586fa049a",
            "patch": "@@ -5,6 +5,7 @@\n \n from django.core.exceptions import MultipleObjectsReturned\n from django.test import TestCase\n+from django.utils.translation import ugettext_lazy\n \n from .models import Article, Reporter\n \n@@ -412,3 +413,14 @@ def test_manager_class_caching(self):\n \n         # Same as each other\n         self.assertTrue(r1.article_set.__class__ is r2.article_set.__class__)\n+\n+    def test_create_relation_with_ugettext_lazy(self):\n+        reporter = Reporter.objects.create(first_name='John',\n+                                           last_name='Smith',\n+                                           email='john.smith@example.com')\n+        lazy = ugettext_lazy(u'test')\n+        reporter.article_set.create(headline=lazy,\n+                                    pub_date=datetime(2011, 6, 10))\n+        notlazy = unicode(lazy)\n+        article = reporter.article_set.get()\n+        self.assertEqual(article.headline, notlazy)"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 19,
        "deletions": 1
    }
}