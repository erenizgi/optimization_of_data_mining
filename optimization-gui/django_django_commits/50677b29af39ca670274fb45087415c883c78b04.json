{
    "author": "akaariai",
    "message": "Made a couple of selenium tests wait for page loaded\n\nThe admin_widgets tests were issuing click() to the browser but\ndidn't wait for the effects of those clicks. This caused the resulting\nrequest to be processed concurrently with the test case. When using\nin-memory SQLite this caused weird failures.\n\nAlso added wait_page_loaded() to admin selenium tests for code\nreuse.\n\nFixed #19856",
    "sha": "50677b29af39ca670274fb45087415c883c78b04",
    "files": [
        {
            "sha": "c99488cd41ca84ea6f7c9fb76ad79cb5ea6188df",
            "filename": "django/contrib/admin/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/50677b29af39ca670274fb45087415c883c78b04/django%2Fcontrib%2Fadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/50677b29af39ca670274fb45087415c883c78b04/django%2Fcontrib%2Fadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftests.py?ref=50677b29af39ca670274fb45087415c883c78b04",
            "patch": "@@ -41,6 +41,20 @@ def wait_loaded_tag(self, tag_name, timeout=10):\n             timeout\n         )\n \n+    def wait_page_loaded(self):\n+        \"\"\"\n+        Block until page has started to load.\n+        \"\"\"\n+        from selenium.common.exceptions import TimeoutException\n+        try:\n+            # Wait for the next page to be loaded\n+            self.wait_loaded_tag('body')\n+        except TimeoutException:\n+            # IE7 occasionnally returns an error \"Internet Explorer cannot\n+            # display the webpage\" and doesn't load the next page. We just\n+            # ignore it.\n+            pass\n+\n     def admin_login(self, username, password, login_url='/admin/'):\n         \"\"\"\n         Helper function to log into the admin.\n@@ -53,8 +67,7 @@ def admin_login(self, username, password, login_url='/admin/'):\n         login_text = _('Log in')\n         self.selenium.find_element_by_xpath(\n             '//input[@value=\"%s\"]' % login_text).click()\n-        # Wait for the next page to be loaded.\n-        self.wait_loaded_tag('body')\n+        self.wait_page_loaded()\n \n     def get_css_value(self, selector, attribute):\n         \"\"\""
        },
        {
            "sha": "f5a54b08b6ea8a3eaec838ed6c1a1180297cc2b8",
            "filename": "tests/regressiontests/admin_inlines/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/50677b29af39ca670274fb45087415c883c78b04/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/50677b29af39ca670274fb45087415c883c78b04/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py?ref=50677b29af39ca670274fb45087415c883c78b04",
            "patch": "@@ -546,15 +546,7 @@ def test_add_inlines(self):\n         self.selenium.find_element_by_name('profile_set-2-last_name').send_keys('2 last name 2')\n \n         self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n-\n-        try:\n-            # Wait for the next page to be loaded.\n-            self.wait_loaded_tag('body')\n-        except TimeoutException:\n-            # IE7 occasionnally returns an error \"Internet Explorer cannot\n-            # display the webpage\" and doesn't load the next page. We just\n-            # ignore it.\n-            pass\n+        self.wait_page_loaded()\n \n         # Check that the objects have been created in the database\n         self.assertEqual(ProfileCollection.objects.all().count(), 1)"
        },
        {
            "sha": "cd83b738978c73ffa11f41ec4e5cc7c301db75bf",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/50677b29af39ca670274fb45087415c883c78b04/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/50677b29af39ca670274fb45087415c883c78b04/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=50677b29af39ca670274fb45087415c883c78b04",
            "patch": "@@ -3262,16 +3262,7 @@ def test_prepopulated_fields(self):\n \n         # Save and check that everything is properly stored in the database\n         self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n-\n-        try:\n-            # Wait for the next page to be loaded.\n-            self.wait_loaded_tag('body')\n-        except TimeoutException:\n-            # IE7 occasionnally returns an error \"Internet Explorer cannot\n-            # display the webpage\" and doesn't load the next page. We just\n-            # ignore it.\n-            pass\n-\n+        self.wait_page_loaded()\n         self.assertEqual(MainPrepopulated.objects.all().count(), 1)\n         MainPrepopulated.objects.get(\n             name=' this is the mAin nÀMë and it\\'s awεšome',"
        },
        {
            "sha": "d559b53531dfeaca6b538399fdb6529d8ff185e5",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/50677b29af39ca670274fb45087415c883c78b04/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/50677b29af39ca670274fb45087415c883c78b04/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=50677b29af39ca670274fb45087415c883c78b04",
            "patch": "@@ -644,12 +644,14 @@ def test_basic(self):\n         self.selenium.get(\n             '%s%s' % (self.live_server_url, '/admin_widgets/school/%s/' % self.school.id))\n \n+        self.wait_page_loaded()\n         self.execute_basic_operations('vertical', 'students')\n         self.execute_basic_operations('horizontal', 'alumni')\n \n         # Save and check that everything is properly stored in the database ---\n         self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n-        self.school = models.School.objects.get(id=self.school.id) # Reload from database\n+        self.wait_page_loaded()\n+        self.school = models.School.objects.get(id=self.school.id)  # Reload from database\n         self.assertEqual(list(self.school.students.all()),\n                          [self.arthur, self.cliff, self.jason, self.john])\n         self.assertEqual(list(self.school.alumni.all()),\n@@ -728,6 +730,7 @@ def test_filter(self):\n \n         # Save and check that everything is properly stored in the database ---\n         self.selenium.find_element_by_xpath('//input[@value=\"Save\"]').click()\n+        self.wait_page_loaded()\n         self.school = models.School.objects.get(id=self.school.id) # Reload from database\n         self.assertEqual(list(self.school.students.all()),\n                          [self.jason, self.peter])"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 21,
        "deletions": 22
    }
}