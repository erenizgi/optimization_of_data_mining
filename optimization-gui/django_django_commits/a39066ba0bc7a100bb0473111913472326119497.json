{
    "author": "freakboy3742",
    "message": "Fixed #16299 -- Ensure that unicode strings can be used to identify classes in ForeignKey and ManyToManyFields. Unicode strings aren't actually legal as class names, but this is an issue if you use from __future__ import unicode_literals in your models.py file. Thanks to Martijn Bastiaan for the report, and Anthony Briggs for the final patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16663 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a39066ba0bc7a100bb0473111913472326119497",
    "files": [
        {
            "sha": "0cd52a3122c6e42cf6a7ef2d7f620f7a1450217e",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a39066ba0bc7a100bb0473111913472326119497/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/a39066ba0bc7a100bb0473111913472326119497/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=a39066ba0bc7a100bb0473111913472326119497",
            "patch": "@@ -385,7 +385,7 @@ def _fill_related_objects_cache(self):\n                     cache[obj] = model\n         for klass in get_models(include_auto_created=True, only_installed=False):\n             for f in klass._meta.local_fields:\n-                if f.rel and not isinstance(f.rel.to, str) and self == f.rel.to._meta:\n+                if f.rel and not isinstance(f.rel.to, basestring) and self == f.rel.to._meta:\n                     cache[RelatedObject(f.rel.to, klass, f)] = None\n         self._related_objects_cache = cache\n \n@@ -422,7 +422,7 @@ def _fill_related_many_to_many_cache(self):\n                     cache[obj] = model\n         for klass in get_models(only_installed=False):\n             for f in klass._meta.local_many_to_many:\n-                if f.rel and not isinstance(f.rel.to, str) and self == f.rel.to._meta:\n+                if f.rel and not isinstance(f.rel.to, basestring) and self == f.rel.to._meta:\n                     cache[RelatedObject(f.rel.to, klass, f)] = None\n         if app_cache_ready():\n             self._related_many_to_many_cache = cache"
        },
        {
            "sha": "e32ff04ea81561724cbd039af9f440bf3fff9da4",
            "filename": "tests/modeltests/invalid_models/invalid_models/models.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/a39066ba0bc7a100bb0473111913472326119497/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/a39066ba0bc7a100bb0473111913472326119497/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py?ref=a39066ba0bc7a100bb0473111913472326119497",
            "patch": "@@ -1,3 +1,4 @@\n+#encoding=utf-8\n \"\"\"\n 26. Invalid models\n \n@@ -218,6 +219,16 @@ class InvalidSetNull(models.Model):\n class InvalidSetDefault(models.Model):\n     fk = models.ForeignKey('self', on_delete=models.SET_DEFAULT)\n \n+class UnicodeForeignKeys(models.Model):\n+    \"\"\"Foreign keys which can translate to ascii should be OK, but fail if they're not.\"\"\"\n+    good = models.ForeignKey(u'FKTarget')\n+    also_good = models.ManyToManyField(u'FKTarget', related_name='unicode2')\n+\n+    # In Python 3 this should become legal, but currently causes unicode errors\n+    # when adding the errors in core/management/validation.py\n+    #bad = models.ForeignKey(u'â˜…')\n+\n+\n model_errors = \"\"\"invalid_models.fielderrors: \"charfield\": CharFields require a \"max_length\" attribute that is a positive integer.\n invalid_models.fielderrors: \"charfield2\": CharFields require a \"max_length\" attribute that is a positive integer.\n invalid_models.fielderrors: \"charfield3\": CharFields require a \"max_length\" attribute that is a positive integer."
        }
    ],
    "stats": {
        "total": 15,
        "additions": 13,
        "deletions": 2
    }
}