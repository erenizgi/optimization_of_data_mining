{
    "author": "ptone",
    "message": "Merge pull request #931 from catalanojuan/fix-admin-log-dependency-on-user-id-field-20088\n\nFixed #20088 -- Changed get_admin_log not to depend on User id field",
    "sha": "7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb",
    "files": [
        {
            "sha": "f70ee2731d6b20084634923bada7c3aa114f534c",
            "filename": "django/contrib/admin/templatetags/log.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py?ref=7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb",
            "patch": "@@ -16,8 +16,8 @@ def render(self, context):\n         else:\n             user_id = self.user\n             if not user_id.isdigit():\n-                user_id = context[self.user].id\n-            context[self.varname] = LogEntry.objects.filter(user__id__exact=user_id).select_related('content_type', 'user')[:int(self.limit)]\n+                user_id = context[self.user].pk\n+            context[self.varname] = LogEntry.objects.filter(user__pk__exact=user_id).select_related('content_type', 'user')[:int(self.limit)]\n         return ''\n \n @register.tag"
        },
        {
            "sha": "242e4b7b6c602f065b77f1728e6c0a4126b4a769",
            "filename": "tests/admin_changelist/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb/tests%2Fadmin_changelist%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb/tests%2Fadmin_changelist%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fadmin_changelist%2Fmodels.py?ref=7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb",
            "patch": "@@ -87,3 +87,6 @@ class OrderedObject(models.Model):\n     number = models.IntegerField(default=0, db_column='number_val')\n \n     objects = OrderedObjectManager()\n+\n+class CustomIdUser(models.Model):\n+    uuid = models.AutoField(primary_key=True)"
        },
        {
            "sha": "ce5056e8f0320b33f3c3ae5c73d9af354a2d9c62",
            "filename": "tests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 1,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb/tests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb/tests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fadmin_changelist%2Ftests.py?ref=7a3409fc645c3e9c839fef08f05ec3bbcd9fb9cb",
            "patch": "@@ -20,7 +20,7 @@\n     SwallowAdmin, DynamicListFilterChildAdmin)\n from .models import (Event, Child, Parent, Genre, Band, Musician, Group,\n     Quartet, Membership, ChordsMusician, ChordsBand, Invitation, Swallow,\n-    UnorderedObject, OrderedObject)\n+    UnorderedObject, OrderedObject, CustomIdUser)\n \n \n class ChangeListTests(TestCase):\n@@ -563,3 +563,22 @@ def test_dynamic_list_filter(self):\n         request = self._mocked_authenticated_request('/child/', user_parents)\n         response = m.changelist_view(request)\n         self.assertEqual(response.context_data['cl'].list_filter, ('parent', 'name', 'age'))\n+\n+class AdminLogNodeTestCase(TestCase):\n+\n+    def test_get_admin_log_templatetag_custom_user(self):\n+        \"\"\"\n+        Regression test for ticket #20088: admin log depends on User model\n+        having id field as primary key.\n+\n+        The old implementation raised an AttributeError when trying to use\n+        the id field.\n+        \"\"\"\n+        context = Context({'user': CustomIdUser()})\n+        template_string = '{% load log %}{% get_admin_log 10 as admin_log for_user user %}'\n+\n+        template = Template(template_string)\n+\n+        # Rendering should be u'' since this templatetag just logs,\n+        # it doesn't render any string.\n+        self.assertEquals(template.render(context), u'')"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 25,
        "deletions": 3
    }
}