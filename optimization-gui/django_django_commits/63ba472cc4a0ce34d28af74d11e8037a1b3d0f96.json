{
    "author": "kmtracey",
    "message": "Fix #13864: Removed database error raised when force_update is requsted on save of an inherited model with no fields of its own. Thanks fva, gregmuellegger, and markb1.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17088 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "63ba472cc4a0ce34d28af74d11e8037a1b3d0f96",
    "files": [
        {
            "sha": "8224cda639a728ea30115bdf04c46b5cf8c30f1d",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=63ba472cc4a0ce34d28af74d11e8037a1b3d0f96",
            "patch": "@@ -87,6 +87,7 @@ answer newbie questions, and generally made Django that much better:\n     Julian Bez\n     Arvis Bickovskis <viestards.lists@gmail.com>\n     Natalia Bidart <nataliabidart@gmail.com>\n+    Mark Biggers <biggers@utsl.com>\n     Paul Bissex <http://e-scribe.com/>\n     Simon Blanchard\n     David Blewett <david@dawninglight.net>"
        },
        {
            "sha": "ebd67bef0520e042210dc33515e1dc4abc1c9af4",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=63ba472cc4a0ce34d28af74d11e8037a1b3d0f96",
            "patch": "@@ -526,9 +526,10 @@ def save_base(self, raw=False, cls=None, origin=None, force_insert=False,\n                     # It does already exist, so do an UPDATE.\n                     if force_update or non_pks:\n                         values = [(f, None, (raw and getattr(self, f.attname) or f.pre_save(self, False))) for f in non_pks]\n-                        rows = manager.using(using).filter(pk=pk_val)._update(values)\n-                        if force_update and not rows:\n-                            raise DatabaseError(\"Forced update did not affect any rows.\")\n+                        if values:\n+                            rows = manager.using(using).filter(pk=pk_val)._update(values)\n+                            if force_update and not rows:\n+                                raise DatabaseError(\"Forced update did not affect any rows.\")\n                 else:\n                     record_exists = False\n             if not pk_set or not record_exists:"
        },
        {
            "sha": "c356312606936bf328d33a9614d84a42c84333ad",
            "filename": "tests/modeltests/force_insert_update/models.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/tests%2Fmodeltests%2Fforce_insert_update%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/tests%2Fmodeltests%2Fforce_insert_update%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fforce_insert_update%2Fmodels.py?ref=63ba472cc4a0ce34d28af74d11e8037a1b3d0f96",
            "patch": "@@ -9,6 +9,16 @@ class Counter(models.Model):\n     name = models.CharField(max_length = 10)\n     value = models.IntegerField()\n \n+class InheritedCounter(Counter):\n+    tag = models.CharField(max_length=10)\n+\n+class ProxyCounter(Counter):\n+    class Meta:\n+        proxy = True\n+\n+class SubCounter(Counter):\n+    pass\n+\n class WithCustomPK(models.Model):\n     name = models.IntegerField(primary_key=True)\n     value = models.IntegerField()"
        },
        {
            "sha": "a5b2dcebb5c697437be80f19a3445dfe92d5e27a",
            "filename": "tests/modeltests/force_insert_update/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 2,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/tests%2Fmodeltests%2Fforce_insert_update%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/63ba472cc4a0ce34d28af74d11e8037a1b3d0f96/tests%2Fmodeltests%2Fforce_insert_update%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fforce_insert_update%2Ftests.py?ref=63ba472cc4a0ce34d28af74d11e8037a1b3d0f96",
            "patch": "@@ -3,14 +3,15 @@\n from django.db import transaction, IntegrityError, DatabaseError\n from django.test import TestCase\n \n-from .models import Counter, WithCustomPK\n+from .models import (Counter, WithCustomPK, InheritedCounter, ProxyCounter,\n+                     SubCounter)\n \n \n class ForceTests(TestCase):\n     def test_force_update(self):\n         c = Counter.objects.create(name=\"one\", value=1)\n-        # The normal case\n \n+        # The normal case\n         c.value = 2\n         c.save()\n         # Same thing, via an update\n@@ -38,3 +39,25 @@ def test_force_update(self):\n         # the data isn't in the database already.\n         obj = WithCustomPK(name=1, value=1)\n         self.assertRaises(DatabaseError, obj.save, force_update=True)\n+\n+\n+class InheritanceTests(TestCase):\n+    def test_force_update_on_inherited_model(self):\n+        a = InheritedCounter(name=\"count\", value=1, tag=\"spam\")\n+        a.save()\n+        a.save(force_update=True)\n+\n+    def test_force_update_on_proxy_model(self):\n+        a = ProxyCounter(name=\"count\", value=1)\n+        a.save()\n+        a.save(force_update=True)\n+\n+    def test_force_update_on_inherited_model_without_fields(self):\n+        '''\n+        Issue 13864: force_update fails on subclassed models, if they don't\n+        specify custom fields.\n+        '''\n+        a = SubCounter(name=\"count\", value=1)\n+        a.save()\n+        a.value = 2\n+        a.save(force_update=True)"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 40,
        "deletions": 5
    }
}