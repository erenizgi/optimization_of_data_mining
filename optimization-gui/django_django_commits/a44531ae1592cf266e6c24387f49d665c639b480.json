{
    "author": "aaugustin",
    "message": "Fixed #18862 -- Honored script prefix in FlatPage.get_absolute_url.",
    "sha": "a44531ae1592cf266e6c24387f49d665c639b480",
    "files": [
        {
            "sha": "896bfa3eac6bffe2da41c526f03e1d2d8790e967",
            "filename": "django/contrib/flatpages/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a44531ae1592cf266e6c24387f49d665c639b480/django%2Fcontrib%2Fflatpages%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/a44531ae1592cf266e6c24387f49d665c639b480/django%2Fcontrib%2Fflatpages%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Fmodels.py?ref=a44531ae1592cf266e6c24387f49d665c639b480",
            "patch": "@@ -2,6 +2,7 @@\n \n from django.db import models\n from django.contrib.sites.models import Site\n+from django.core.urlresolvers import get_script_prefix\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import iri_to_uri, python_2_unicode_compatible\n \n@@ -26,4 +27,5 @@ def __str__(self):\n         return \"%s -- %s\" % (self.url, self.title)\n \n     def get_absolute_url(self):\n-        return iri_to_uri(self.url)\n+        # Handle script prefix manually because we bypass reverse()\n+        return iri_to_uri(get_script_prefix().rstrip('/') + self.url)"
        },
        {
            "sha": "af12c420e0e8ac0f2a9c677b9bc7009b4de52eb8",
            "filename": "django/contrib/flatpages/tests/models.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/a44531ae1592cf266e6c24387f49d665c639b480/django%2Fcontrib%2Fflatpages%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/a44531ae1592cf266e6c24387f49d665c639b480/django%2Fcontrib%2Fflatpages%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftests%2Fmodels.py?ref=a44531ae1592cf266e6c24387f49d665c639b480",
            "patch": "@@ -2,6 +2,7 @@\n \n from __future__ import unicode_literals\n \n+from django.core.urlresolvers import set_script_prefix, clear_script_prefix\n from django.contrib.flatpages.models import FlatPage\n from django.test import TestCase\n \n@@ -12,4 +13,10 @@ def test_get_absolute_url_urlencodes(self):\n         pf = FlatPage(title=\"Café!\", url='/café/')\n         self.assertEqual(pf.get_absolute_url(), '/caf%C3%A9/')\n \n-\n+    def test_get_absolute_url_honors_script_prefix(self):\n+        pf = FlatPage(title=\"Tea!\", url='/tea/')\n+        set_script_prefix('/beverages/')\n+        try:\n+            self.assertEqual(pf.get_absolute_url(), '/beverages/tea/')\n+        finally:\n+            clear_script_prefix()"
        },
        {
            "sha": "e8d6a46c6895be658bf3bdd55677e4d669e95836",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/a44531ae1592cf266e6c24387f49d665c639b480/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/a44531ae1592cf266e6c24387f49d665c639b480/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=a44531ae1592cf266e6c24387f49d665c639b480",
            "patch": "@@ -521,6 +521,15 @@ def get_script_prefix():\n     \"\"\"\n     return getattr(_prefixes, \"value\", '/')\n \n+def clear_script_prefix():\n+    \"\"\"\n+    Unsets the script prefix for the current thread.\n+    \"\"\"\n+    try:\n+        del _prefixes.value\n+    except AttributeError:\n+        pass\n+\n def set_urlconf(urlconf_name):\n     \"\"\"\n     Sets the URLconf for the current thread (overriding the default one in"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 20,
        "deletions": 2
    }
}