{
    "author": "freakboy3742",
    "message": "Removed deprecated DB backend functions for creating m2m tables.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15979 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f9972bcf8675d26291f09c7acbc9da2f5f1a2327",
    "files": [
        {
            "sha": "9b11a63341bb40cff0e416c27cd5d716a5ff9c30",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 0,
            "deletions": 127,
            "changes": 127,
            "blob_url": "https://github.com/django/django/blob/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=f9972bcf8675d26291f09c7acbc9da2f5f1a2327",
            "patch": "@@ -132,115 +132,6 @@ def sql_for_pending_references(self, model, style, pending_references):\n             del pending_references[model]\n         return final_output\n \n-    def sql_for_many_to_many(self, model, style):\n-        \"Return the CREATE TABLE statments for all the many-to-many tables defined on a model\"\n-        import warnings\n-        warnings.warn(\n-            'Database creation API for m2m tables has been deprecated. M2M models are now automatically generated',\n-            DeprecationWarning\n-        )\n-\n-        output = []\n-        for f in model._meta.local_many_to_many:\n-            if model._meta.managed or f.rel.to._meta.managed:\n-                output.extend(self.sql_for_many_to_many_field(model, f, style))\n-        return output\n-\n-    def sql_for_many_to_many_field(self, model, f, style):\n-        \"Return the CREATE TABLE statements for a single m2m field\"\n-        import warnings\n-        warnings.warn(\n-            'Database creation API for m2m tables has been deprecated. M2M models are now automatically generated',\n-            DeprecationWarning\n-        )\n-\n-        from django.db import models\n-        from django.db.backends.util import truncate_name\n-\n-        output = []\n-        if f.auto_created:\n-            opts = model._meta\n-            qn = self.connection.ops.quote_name\n-            tablespace = f.db_tablespace or opts.db_tablespace\n-            if tablespace:\n-                sql = self.connection.ops.tablespace_sql(tablespace, inline=True)\n-                if sql:\n-                    tablespace_sql = ' ' + sql\n-                else:\n-                    tablespace_sql = ''\n-            else:\n-                tablespace_sql = ''\n-            table_output = [style.SQL_KEYWORD('CREATE TABLE') + ' ' + \\\n-                style.SQL_TABLE(qn(f.m2m_db_table())) + ' (']\n-            table_output.append('    %s %s %s%s,' %\n-                (style.SQL_FIELD(qn('id')),\n-                style.SQL_COLTYPE(models.AutoField(primary_key=True).db_type(connection=self.connection)),\n-                style.SQL_KEYWORD('NOT NULL PRIMARY KEY'),\n-                tablespace_sql))\n-\n-            deferred = []\n-            inline_output, deferred = self.sql_for_inline_many_to_many_references(model, f, style)\n-            table_output.extend(inline_output)\n-\n-            table_output.append('    %s (%s, %s)%s' %\n-                (style.SQL_KEYWORD('UNIQUE'),\n-                style.SQL_FIELD(qn(f.m2m_column_name())),\n-                style.SQL_FIELD(qn(f.m2m_reverse_name())),\n-                tablespace_sql))\n-            table_output.append(')')\n-            if opts.db_tablespace:\n-                # f.db_tablespace is only for indices, so ignore its value here.\n-                table_output.append(self.connection.ops.tablespace_sql(opts.db_tablespace))\n-            table_output.append(';')\n-            output.append('\\n'.join(table_output))\n-\n-            for r_table, r_col, table, col in deferred:\n-                r_name = '%s_refs_%s_%s' % (r_col, col, self._digest(r_table, table))\n-                output.append(style.SQL_KEYWORD('ALTER TABLE') + ' %s ADD CONSTRAINT %s FOREIGN KEY (%s) REFERENCES %s (%s)%s;' %\n-                (qn(r_table),\n-                qn(truncate_name(r_name, self.connection.ops.max_name_length())),\n-                qn(r_col), qn(table), qn(col),\n-                self.connection.ops.deferrable_sql()))\n-\n-            # Add any extra SQL needed to support auto-incrementing PKs\n-            autoinc_sql = self.connection.ops.autoinc_sql(f.m2m_db_table(), 'id')\n-            if autoinc_sql:\n-                for stmt in autoinc_sql:\n-                    output.append(stmt)\n-        return output\n-\n-    def sql_for_inline_many_to_many_references(self, model, field, style):\n-        \"Create the references to other tables required by a many-to-many table\"\n-        import warnings\n-        warnings.warn(\n-            'Database creation API for m2m tables has been deprecated. M2M models are now automatically generated',\n-            DeprecationWarning\n-        )\n-\n-        from django.db import models\n-        opts = model._meta\n-        qn = self.connection.ops.quote_name\n-\n-        table_output = [\n-            '    %s %s %s %s (%s)%s,' %\n-                (style.SQL_FIELD(qn(field.m2m_column_name())),\n-                style.SQL_COLTYPE(models.ForeignKey(model).db_type(connection=self.connection)),\n-                style.SQL_KEYWORD('NOT NULL REFERENCES'),\n-                style.SQL_TABLE(qn(opts.db_table)),\n-                style.SQL_FIELD(qn(opts.pk.column)),\n-                self.connection.ops.deferrable_sql()),\n-            '    %s %s %s %s (%s)%s,' %\n-                (style.SQL_FIELD(qn(field.m2m_reverse_name())),\n-                style.SQL_COLTYPE(models.ForeignKey(field.rel.to).db_type(connection=self.connection)),\n-                style.SQL_KEYWORD('NOT NULL REFERENCES'),\n-                style.SQL_TABLE(qn(field.rel.to._meta.db_table)),\n-                style.SQL_FIELD(qn(field.rel.to._meta.pk.column)),\n-                self.connection.ops.deferrable_sql())\n-        ]\n-        deferred = []\n-\n-        return table_output, deferred\n-\n     def sql_indexes_for_model(self, model, style):\n         \"Returns the CREATE INDEX SQL statements for a single model\"\n         if not model._meta.managed or model._meta.proxy:\n@@ -314,24 +205,6 @@ def sql_remove_table_constraints(self, model, references_to_delete, style):\n         del references_to_delete[model]\n         return output\n \n-    def sql_destroy_many_to_many(self, model, f, style):\n-        \"Returns the DROP TABLE statements for a single m2m field\"\n-        import warnings\n-        warnings.warn(\n-            'Database creation API for m2m tables has been deprecated. M2M models are now automatically generated',\n-            DeprecationWarning\n-        )\n-\n-        qn = self.connection.ops.quote_name\n-        output = []\n-        if f.auto_created:\n-            output.append(\"%s %s;\" % (style.SQL_KEYWORD('DROP TABLE'),\n-                style.SQL_TABLE(qn(f.m2m_db_table()))))\n-            ds = self.connection.ops.drop_sequence_sql(\"%s_%s\" % (model._meta.db_table, f.column))\n-            if ds:\n-                output.append(ds)\n-        return output\n-\n     def create_test_db(self, verbosity=1, autoclobber=False):\n         \"\"\"\n         Creates a test database, prompting the user for confirmation if the"
        }
    ],
    "stats": {
        "total": 127,
        "additions": 0,
        "deletions": 127
    }
}