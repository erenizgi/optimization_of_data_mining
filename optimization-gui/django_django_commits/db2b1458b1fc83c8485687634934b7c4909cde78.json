{
    "author": "jezdez",
    "message": "Fixed #17047 -- Improved django.db.utils.load_backend to raise a better exception when using a unqualified database backend name. Thanks, Jonas Obrist.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17274 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "db2b1458b1fc83c8485687634934b7c4909cde78",
    "files": [
        {
            "sha": "3f5b86ee121f6cff053fe996a1f9e533f2a92431",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/db2b1458b1fc83c8485687634934b7c4909cde78/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/db2b1458b1fc83c8485687634934b7c4909cde78/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=db2b1458b1fc83c8485687634934b7c4909cde78",
            "patch": "@@ -32,16 +32,26 @@ def load_backend(backend_name):\n                     and not f.startswith('.')]\n         except EnvironmentError:\n             available_backends = []\n-        if backend_name.startswith('django.db.backends.'):\n+        full_notation = backend_name.startswith('django.db.backends.')\n+        if full_notation:\n             backend_name = backend_name[19:] # See #15621.\n         if backend_name not in available_backends:\n-            error_msg = (\"%r isn't an available database backend. \\n\" +\n-                \"Try using django.db.backends.XXX, where XXX is one of:\\n    %s\\n\" +\n-                \"Error was: %s\") % \\\n-                (backend_name, \", \".join(map(repr, sorted(available_backends))), e_user)\n+            backend_reprs = map(repr, sorted(available_backends))\n+            error_msg = (\"%r isn't an available database backend.\\n\"\n+                         \"Try using django.db.backends.XXX, where XXX \"\n+                         \"is one of:\\n    %s\\nError was: %s\" %\n+                         (backend_name, \", \".join(backend_reprs), e_user))\n+            raise ImproperlyConfigured(error_msg)\n+        elif not full_notation:\n+            # user tried to use the old notation for the database backend\n+            error_msg = (\"%r isn't an available database backend.\\n\"\n+                         \"Try using django.db.backends.%s instead.\\n\"\n+                         \"Error was: %s\" %\n+                         (backend_name, backend_name, e_user))\n             raise ImproperlyConfigured(error_msg)\n         else:\n-            raise # If there's some other error, this must be an error in Django itself.\n+            # If there's some other error, this must be an error in Django\n+            raise\n \n \n class ConnectionDoesNotExist(Exception):"
        },
        {
            "sha": "b561b4eb2d422a23ac13b16ceb5bdf49071df1b7",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/db2b1458b1fc83c8485687634934b7c4909cde78/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/db2b1458b1fc83c8485687634934b7c4909cde78/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=db2b1458b1fc83c8485687634934b7c4909cde78",
            "patch": "@@ -7,11 +7,12 @@\n \n from django.conf import settings\n from django.core.management.color import no_style\n+from django.core.exceptions import ImproperlyConfigured\n from django.db import (backend, connection, connections, DEFAULT_DB_ALIAS,\n     IntegrityError, transaction)\n from django.db.backends.signals import connection_created\n from django.db.backends.postgresql_psycopg2 import version as pg_version\n-from django.db.utils import ConnectionHandler, DatabaseError\n+from django.db.utils import ConnectionHandler, DatabaseError, load_backend\n from django.test import TestCase, skipUnlessDBFeature, TransactionTestCase\n from django.utils import unittest\n \n@@ -582,4 +583,11 @@ def runner2(other_thread_connection):\n         t1.start()\n         t1.join()\n         # No exception was raised\n-        self.assertEqual(len(exceptions), 0)\n\\ No newline at end of file\n+        self.assertEqual(len(exceptions), 0)\n+\n+\n+class BackendLoadingTests(TestCase):\n+    def test_old_style_backends_raise_useful_exception(self):\n+        self.assertRaisesRegexp(ImproperlyConfigured,\n+            \"Try using django.db.backends.sqlite3 instead\",\n+            load_backend, 'sqlite3')"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 26,
        "deletions": 8
    }
}