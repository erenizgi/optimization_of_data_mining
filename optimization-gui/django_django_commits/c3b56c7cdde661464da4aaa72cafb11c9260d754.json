{
    "author": "claudep",
    "message": "Used call_command in i18n compilation tests.\n\nNow that call_command does not raise SystemExit any more, we can\nuse call_command again for testing compilemessages.",
    "sha": "c3b56c7cdde661464da4aaa72cafb11c9260d754",
    "files": [
        {
            "sha": "d88e1feef63ab0c937f5b8adff876fa6a4e7bc47",
            "filename": "tests/regressiontests/i18n/commands/compilation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 17,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/c3b56c7cdde661464da4aaa72cafb11c9260d754/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "raw_url": "https://github.com/django/django/raw/c3b56c7cdde661464da4aaa72cafb11c9260d754/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py?ref=c3b56c7cdde661464da4aaa72cafb11c9260d754",
            "patch": "@@ -1,8 +1,7 @@\n import os\n from io import BytesIO\n \n-from django.core.management import CommandError\n-from django.core.management.commands.compilemessages import compile_messages\n+from django.core.management import call_command, CommandError\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils import translation\n@@ -25,11 +24,9 @@ class PoFileTests(MessageCompilationTests):\n \n     def test_bom_rejection(self):\n         os.chdir(test_dir)\n-        # We don't use the django.core.management infrastructure (call_command()\n-        # et al) because CommandError's cause exit(1) there. We test the\n-        # underlying compile_messages function instead\n-        out = BytesIO()\n-        self.assertRaises(CommandError, compile_messages, out, locale=self.LOCALE)\n+        with self.assertRaisesRegexp(CommandError,\n+                \"file has a BOM \\(Byte Order Mark\\)\"):\n+            call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n         self.assertFalse(os.path.exists(self.MO_FILE))\n \n \n@@ -45,11 +42,7 @@ def setUp(self):\n \n     def test_percent_symbol_in_po_file(self):\n         os.chdir(test_dir)\n-        # We don't use the django.core.management infrastructure (call_command()\n-        # et al) because CommandError's cause exit(1) there. We test the\n-        # underlying compile_messages function instead\n-        out = BytesIO()\n-        compile_messages(out, locale=self.LOCALE)\n+        call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n         self.assertTrue(os.path.exists(self.MO_FILE))\n \n \n@@ -64,11 +57,7 @@ class PercentRenderingTests(MessageCompilationTests):\n     def test_percent_symbol_escaping(self):\n         from django.template import Template, Context\n         os.chdir(test_dir)\n-        # We don't use the django.core.management infrastructure (call_command()\n-        # et al) because CommandError's cause exit(1) there. We test the\n-        # underlying compile_messages function instead\n-        out = BytesIO()\n-        compile_messages(out, locale=self.LOCALE)\n+        call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n         with translation.override(self.LOCALE):\n             t = Template('{% load i18n %}{% trans \"Looks like a str fmt spec %% o but shouldn\\'t be interpreted as such\" %}')\n             rendered = t.render(Context({}))"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 6,
        "deletions": 17
    }
}