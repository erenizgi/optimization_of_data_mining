{
    "author": "charettes",
    "message": "Fixed #9800 -- Allow \"isPermaLink\" attribute in <guid> element of an RSS item.\n\nThanks @rtnpro for the patch!",
    "sha": "5449240c548bb6877923791d02e800c6b25393f5",
    "files": [
        {
            "sha": "a80b9d1fae0dbacc270a12d16d80f1c5dc786c8b",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/5449240c548bb6877923791d02e800c6b25393f5/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/5449240c548bb6877923791d02e800c6b25393f5/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=5449240c548bb6877923791d02e800c6b25393f5",
            "patch": "@@ -184,6 +184,8 @@ def get_feed(self, obj, request):\n                 link = link,\n                 description = description,\n                 unique_id = self.__get_dynamic_attr('item_guid', item, link),\n+                unique_id_is_permalink = self.__get_dynamic_attr(\n+                    'item_guid_is_permalink', item),\n                 enclosure = enc,\n                 pubdate = pubdate,\n                 author_name = author_name,"
        },
        {
            "sha": "7eba842a89b2bac7c19111d906374553a3094b76",
            "filename": "django/utils/feedgenerator.py",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/5449240c548bb6877923791d02e800c6b25393f5/django%2Futils%2Ffeedgenerator.py",
            "raw_url": "https://github.com/django/django/raw/5449240c548bb6877923791d02e800c6b25393f5/django%2Futils%2Ffeedgenerator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffeedgenerator.py?ref=5449240c548bb6877923791d02e800c6b25393f5",
            "patch": "@@ -113,8 +113,8 @@ def __init__(self, title, link, description, language=None, author_email=None,\n \n     def add_item(self, title, link, description, author_email=None,\n         author_name=None, author_link=None, pubdate=None, comments=None,\n-        unique_id=None, enclosure=None, categories=(), item_copyright=None,\n-        ttl=None, **kwargs):\n+        unique_id=None, unique_id_is_permalink=None, enclosure=None,\n+        categories=(), item_copyright=None, ttl=None, **kwargs):\n         \"\"\"\n         Adds an item to the feed. All args are expected to be Python Unicode\n         objects except pubdate, which is a datetime.datetime object, and\n@@ -136,6 +136,7 @@ def add_item(self, title, link, description, author_email=None,\n             'pubdate': pubdate,\n             'comments': to_unicode(comments),\n             'unique_id': to_unicode(unique_id),\n+            'unique_id_is_permalink': unique_id_is_permalink,\n             'enclosure': enclosure,\n             'categories': categories or (),\n             'item_copyright': to_unicode(item_copyright),\n@@ -280,7 +281,11 @@ def add_item_elements(self, handler, item):\n         if item['comments'] is not None:\n             handler.addQuickElement(\"comments\", item['comments'])\n         if item['unique_id'] is not None:\n-            handler.addQuickElement(\"guid\", item['unique_id'])\n+            guid_attrs = {}\n+            if isinstance(item.get('unique_id_is_permalink'), bool):\n+                guid_attrs['isPermaLink'] = str(\n+                    item['unique_id_is_permalink']).lower()\n+            handler.addQuickElement(\"guid\", item['unique_id'], guid_attrs)\n         if item['ttl'] is not None:\n             handler.addQuickElement(\"ttl\", item['ttl'])\n "
        },
        {
            "sha": "65aa7b57b40c7a5800c9f7aac851335ffe5b344d",
            "filename": "docs/ref/contrib/syndication.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/5449240c548bb6877923791d02e800c6b25393f5/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "raw_url": "https://github.com/django/django/raw/5449240c548bb6877923791d02e800c6b25393f5/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsyndication.txt?ref=5449240c548bb6877923791d02e800c6b25393f5",
            "patch": "@@ -624,6 +624,18 @@ This example illustrates all possible attributes and methods for a\n             Takes an item, as return by items(), and returns the item's ID.\n             \"\"\"\n \n+        # ITEM_GUID_IS_PERMALINK -- The following method is optional. If\n+        # provided, it sets the 'isPermaLink' attribute of an item's\n+        # GUID element. This method is used only when 'item_guid' is\n+        # specified.\n+\n+        def item_guid_is_permalink(self, obj):\n+            \"\"\"\n+            Takes an item, as returned by items(), and returns a boolean.\n+            \"\"\"\n+\n+        item_guid_is_permalink = False  # Hard coded value\n+\n         # ITEM AUTHOR NAME -- One of the following three is optional. The\n         # framework looks for them in this order.\n "
        },
        {
            "sha": "25757057b95fd22ef760b323522ee5c843e386df",
            "filename": "tests/regressiontests/syndication/feeds.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/5449240c548bb6877923791d02e800c6b25393f5/tests%2Fregressiontests%2Fsyndication%2Ffeeds.py",
            "raw_url": "https://github.com/django/django/raw/5449240c548bb6877923791d02e800c6b25393f5/tests%2Fregressiontests%2Fsyndication%2Ffeeds.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ffeeds.py?ref=5449240c548bb6877923791d02e800c6b25393f5",
            "patch": "@@ -42,6 +42,19 @@ def item_pubdate(self, item):\n     item_copyright = 'Copyright (c) 2007, Sally Smith'\n \n \n+class TestRss2FeedWithGuidIsPermaLinkTrue(TestRss2Feed):\n+    def item_guid_is_permalink(self, item):\n+        return True\n+\n+\n+class TestRss2FeedWithGuidIsPermaLinkFalse(TestRss2Feed):\n+    def item_guid(self, item):\n+        return str(item.pk)\n+\n+    def item_guid_is_permalink(self, item):\n+        return False\n+\n+\n class TestRss091Feed(TestRss2Feed):\n     feed_type = feedgenerator.RssUserland091Feed\n "
        },
        {
            "sha": "8885dc28c0d99adefefec1419e5020a7611d49c3",
            "filename": "tests/regressiontests/syndication/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/5449240c548bb6877923791d02e800c6b25393f5/tests%2Fregressiontests%2Fsyndication%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/5449240c548bb6877923791d02e800c6b25393f5/tests%2Fregressiontests%2Fsyndication%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ftests.py?ref=5449240c548bb6877923791d02e800c6b25393f5",
            "patch": "@@ -103,9 +103,43 @@ def test_rss2_feed(self):\n             'author': 'test@example.com (Sally Smith)',\n         })\n         self.assertCategories(items[0], ['python', 'testing'])\n-\n         for item in items:\n             self.assertChildNodes(item, ['title', 'link', 'description', 'guid', 'category', 'pubDate', 'author'])\n+            # Assert that <guid> does not have any 'isPermaLink' attribute\n+            self.assertIsNone(item.getElementsByTagName(\n+                'guid')[0].attributes.get('isPermaLink'))\n+\n+    def test_rss2_feed_guid_permalink_false(self):\n+        \"\"\"\n+        Test if the 'isPermaLink' attribute of <guid> element of an item\n+        in the RSS feed is 'false'.\n+        \"\"\"\n+        response = self.client.get(\n+            '/syndication/rss2/guid_ispermalink_false/')\n+        doc = minidom.parseString(response.content)\n+        chan = doc.getElementsByTagName(\n+            'rss')[0].getElementsByTagName('channel')[0]\n+        items = chan.getElementsByTagName('item')\n+        for item in items:\n+            self.assertEqual(\n+                item.getElementsByTagName('guid')[0].attributes.get(\n+                    'isPermaLink').value, \"false\")\n+\n+    def test_rss2_feed_guid_permalink_true(self):\n+        \"\"\"\n+        Test if the 'isPermaLink' attribute of <guid> element of an item\n+        in the RSS feed is 'true'.\n+        \"\"\"\n+        response = self.client.get(\n+            '/syndication/rss2/guid_ispermalink_true/')\n+        doc = minidom.parseString(response.content)\n+        chan = doc.getElementsByTagName(\n+            'rss')[0].getElementsByTagName('channel')[0]\n+        items = chan.getElementsByTagName('item')\n+        for item in items:\n+            self.assertEqual(\n+                item.getElementsByTagName('guid')[0].attributes.get(\n+                    'isPermaLink').value, \"true\")\n \n     def test_rss091_feed(self):\n         \"\"\""
        },
        {
            "sha": "ec3c8cc596109805c150d5337264c2fca09b40c5",
            "filename": "tests/regressiontests/syndication/urls.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/5449240c548bb6877923791d02e800c6b25393f5/tests%2Fregressiontests%2Fsyndication%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/5449240c548bb6877923791d02e800c6b25393f5/tests%2Fregressiontests%2Fsyndication%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Furls.py?ref=5449240c548bb6877923791d02e800c6b25393f5",
            "patch": "@@ -8,6 +8,10 @@\n urlpatterns = patterns('django.contrib.syndication.views',\n     (r'^syndication/complex/(?P<foo>.*)/$', feeds.ComplexFeed()),\n     (r'^syndication/rss2/$', feeds.TestRss2Feed()),\n+    (r'^syndication/rss2/guid_ispermalink_true/$',\n+        feeds.TestRss2FeedWithGuidIsPermaLinkTrue()),\n+    (r'^syndication/rss2/guid_ispermalink_false/$',\n+        feeds.TestRss2FeedWithGuidIsPermaLinkFalse()),\n     (r'^syndication/rss091/$', feeds.TestRss091Feed()),\n     (r'^syndication/no_pubdate/$', feeds.TestNoPubdateFeed()),\n     (r'^syndication/atom/$', feeds.TestAtomFeed()),"
        }
    ],
    "stats": {
        "total": 78,
        "additions": 74,
        "deletions": 4
    }
}