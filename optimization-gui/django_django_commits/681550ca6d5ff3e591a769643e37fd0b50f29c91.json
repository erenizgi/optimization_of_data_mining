{
    "author": "claudep",
    "message": "Removed custom WSGIRequestHandler.get_environ\n\nWe probably historically customized it for good reasons, but\ncurrently, the differences with upstream Python are not\nsignificant any longer.\nAlso fixes #19075 for which a test has been added.",
    "sha": "681550ca6d5ff3e591a769643e37fd0b50f29c91",
    "files": [
        {
            "sha": "a7004f2c2fe283f6eb678f72cdb50a08aa22fa27",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 1,
            "deletions": 33,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/681550ca6d5ff3e591a769643e37fd0b50f29c91/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/681550ca6d5ff3e591a769643e37fd0b50f29c91/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=681550ca6d5ff3e591a769643e37fd0b50f29c91",
            "patch": "@@ -14,9 +14,8 @@\n import sys\n import traceback\n try:\n-    from urllib.parse import unquote, urljoin\n+    from urllib.parse import urljoin\n except ImportError:     # Python 2\n-    from urllib import unquote\n     from urlparse import urljoin\n from django.utils.six.moves import socketserver\n from wsgiref import simple_server\n@@ -139,37 +138,6 @@ def __init__(self, *args, **kwargs):\n         self.style = color_style()\n         super(WSGIRequestHandler, self).__init__(*args, **kwargs)\n \n-    def get_environ(self):\n-        env = self.server.base_environ.copy()\n-        env['SERVER_PROTOCOL'] = self.request_version\n-        env['REQUEST_METHOD'] = self.command\n-        if '?' in self.path:\n-            path,query = self.path.split('?',1)\n-        else:\n-            path,query = self.path,''\n-\n-        env['PATH_INFO'] = unquote(path)\n-        env['QUERY_STRING'] = query\n-        env['REMOTE_ADDR'] = self.client_address[0]\n-        env['CONTENT_TYPE'] = self.headers.get('content-type', 'text/plain')\n-\n-        length = self.headers.get('content-length')\n-        if length:\n-            env['CONTENT_LENGTH'] = length\n-\n-        for key, value in self.headers.items():\n-            key = key.replace('-','_').upper()\n-            value = value.strip()\n-            if key in env:\n-                # Skip content length, type, etc.\n-                continue\n-            if 'HTTP_' + key in env:\n-                # Comma-separate multiple headers\n-                env['HTTP_' + key] += ',' + value\n-            else:\n-                env['HTTP_' + key] = value\n-        return env\n-\n     def log_message(self, format, *args):\n         # Don't bother logging requests for admin images or the favicon.\n         if (self.path.startswith(self.admin_static_prefix)"
        },
        {
            "sha": "f54e34ce285f562fe71fef0d0ae106f65b019e59",
            "filename": "tests/regressiontests/servers/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/681550ca6d5ff3e591a769643e37fd0b50f29c91/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/681550ca6d5ff3e591a769643e37fd0b50f29c91/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Ftests.py?ref=681550ca6d5ff3e591a769643e37fd0b50f29c91",
            "patch": "@@ -1,6 +1,9 @@\n+# -*- encoding: utf-8 -*-\n \"\"\"\n Tests for django.core.servers.\n \"\"\"\n+from __future__ import unicode_literals\n+\n import os\n try:\n     from urllib.request import urlopen, HTTPError\n@@ -11,6 +14,7 @@\n from django.test import LiveServerTestCase\n from django.core.servers.basehttp import WSGIServerException\n from django.test.utils import override_settings\n+from django.utils.http import urlencode\n \n from .models import Person\n \n@@ -134,6 +138,10 @@ def test_media_files(self):\n         f = self.urlopen('/media/example_media_file.txt')\n         self.assertEqual(f.read().rstrip(b'\\r\\n'), b'example media file')\n \n+    def test_environ(self):\n+        f = self.urlopen('/environ_view/?%s' % urlencode({'q': 'тест'}))\n+        self.assertIn(b\"QUERY_STRING: 'q=%D1%82%D0%B5%D1%81%D1%82'\", f.read())\n+\n \n class LiveServerDatabase(LiveServerBase):\n "
        },
        {
            "sha": "a857c45f95f6744746a64a935819a8a142083064",
            "filename": "tests/regressiontests/servers/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/681550ca6d5ff3e591a769643e37fd0b50f29c91/tests%2Fregressiontests%2Fservers%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/681550ca6d5ff3e591a769643e37fd0b50f29c91/tests%2Fregressiontests%2Fservers%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Furls.py?ref=681550ca6d5ff3e591a769643e37fd0b50f29c91",
            "patch": "@@ -9,4 +9,5 @@\n     url(r'^example_view/$', views.example_view),\n     url(r'^model_view/$', views.model_view),\n     url(r'^create_model_instance/$', views.create_model_instance),\n-)\n\\ No newline at end of file\n+    url(r'^environ_view/$', views.environ_view),\n+)"
        },
        {
            "sha": "00baf4b5ac6af80c9aacaefdb8a9acdbc30391e9",
            "filename": "tests/regressiontests/servers/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/681550ca6d5ff3e591a769643e37fd0b50f29c91/tests%2Fregressiontests%2Fservers%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/681550ca6d5ff3e591a769643e37fd0b50f29c91/tests%2Fregressiontests%2Fservers%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Fviews.py?ref=681550ca6d5ff3e591a769643e37fd0b50f29c91",
            "patch": "@@ -14,4 +14,8 @@ def model_view(request):\n def create_model_instance(request):\n     person = Person(name='emily')\n     person.save()\n-    return HttpResponse('')\n\\ No newline at end of file\n+    return HttpResponse('')\n+\n+\n+def environ_view(request):\n+    return HttpResponse(\"\\n\".join([\"%s: %r\" % (k, v) for k, v in request.environ.items()]))"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 16,
        "deletions": 35
    }
}