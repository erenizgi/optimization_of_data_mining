{
    "author": "claudep",
    "message": "Fixed #18807 -- Made 404.html and 500.html optional\n\nThanks Aymeric Augustin for the report and Jannis Leidel for the\nreview.",
    "sha": "8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
    "files": [
        {
            "sha": "ec7a233ff7cc3e549fa3db9ae1a0c5e861212130",
            "filename": "django/views/defaults.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/django%2Fviews%2Fdefaults.py",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/django%2Fviews%2Fdefaults.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdefaults.py?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -1,6 +1,6 @@\n from django import http\n from django.template import (Context, RequestContext,\n-                             loader, TemplateDoesNotExist)\n+                             loader, Template, TemplateDoesNotExist)\n from django.views.decorators.csrf import requires_csrf_token\n \n \n@@ -17,8 +17,13 @@ def page_not_found(request, template_name='404.html'):\n         request_path\n             The path of the requested URL (e.g., '/app/pages/bad_page/')\n     \"\"\"\n-    t = loader.get_template(template_name) # You need to create a 404.html template.\n-    return http.HttpResponseNotFound(t.render(RequestContext(request, {'request_path': request.path})))\n+    try:\n+        template = loader.get_template(template_name)\n+    except TemplateDoesNotExist:\n+        template = Template(\n+            '<h1>Not Found</h1>'\n+            '<p>The requested URL {{ request_path }} was not found on this server.</p>')\n+    return http.HttpResponseNotFound(template.render(RequestContext(request, {'request_path': request.path})))\n \n \n @requires_csrf_token\n@@ -29,8 +34,11 @@ def server_error(request, template_name='500.html'):\n     Templates: :template:`500.html`\n     Context: None\n     \"\"\"\n-    t = loader.get_template(template_name) # You need to create a 500.html template.\n-    return http.HttpResponseServerError(t.render(Context({})))\n+    try:\n+        template = loader.get_template(template_name)\n+    except TemplateDoesNotExist:\n+        return http.HttpResponseServerError('<h1>Server Error (500)</h1>')\n+    return http.HttpResponseServerError(template.render(Context({})))\n \n \n # This can be called when CsrfViewMiddleware.process_view has not run,"
        },
        {
            "sha": "f3501026f8d1a62541485977b95dfeab82d53413",
            "filename": "docs/intro/tutorial03.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Fintro%2Ftutorial03.txt",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Fintro%2Ftutorial03.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial03.txt?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -366,11 +366,10 @@ special: It's just a normal view.\n \n You normally won't have to bother with writing 404 views. If you don't set\n ``handler404``, the built-in view :func:`django.views.defaults.page_not_found`\n-is used by default. In this case, you still have one obligation: create a\n-``404.html`` template in the root of your template directory. The default 404\n-view will use that template for all 404 errors. If :setting:`DEBUG` is set to\n-``False`` (in your settings module) and if you didn't create a ``404.html``\n-file, an ``Http500`` is raised instead. So remember to create a ``404.html``.\n+is used by default. Optionally, you can create a ``404.html`` template\n+in the root of your template directory. The default 404 view will then use that\n+template for all 404 errors when :setting:`DEBUG` is set to ``False`` (in your\n+settings module).\n \n A couple more things to note about 404 views:\n "
        },
        {
            "sha": "7ff9165642f2ac54fbdfece122ff5a88b3a66c30",
            "filename": "docs/ref/contrib/flatpages.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Fref%2Fcontrib%2Fflatpages.txt",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Fref%2Fcontrib%2Fflatpages.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fflatpages.txt?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -158,9 +158,7 @@ For more on middleware, read the :doc:`middleware docs\n     :class:`~django.contrib.flatpages.middleware.FlatpageFallbackMiddleware`\n     only steps in once another view has successfully produced a 404 response.\n     If another view or middleware class attempts to produce a 404 but ends up\n-    raising an exception instead (such as a ``TemplateDoesNotExist``\n-    exception if your site does not have an appropriate template to\n-    use for HTTP 404 responses), the response will become an HTTP 500\n+    raising an exception instead, the response will become an HTTP 500\n     (\"Internal Server Error\") and the\n     :class:`~django.contrib.flatpages.middleware.FlatpageFallbackMiddleware`\n     will not attempt to serve a flat page."
        },
        {
            "sha": "d87efda0afb1c49cc87dab390f8c238b18789f15",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -185,6 +185,12 @@ Django 1.5 also includes several smaller improvements worth noting:\n   look up permissions by using ``{% if 'someapp.someperm' in perms %}``\n   in templates.\n \n+* It's not required any more to have ``404.html`` and ``500.html`` templates in\n+  the root templates directory. Django will output some basic error messages for\n+  both situations when those templates are not found. Of course, it's still\n+  recommended as good practice to provide those templates in order to present\n+  pretty error pages to the user.\n+\n Backwards incompatible changes in 1.5\n =====================================\n "
        },
        {
            "sha": "7c4d1bbb6ee0ebc631af4e2f2ec04149abb01db4",
            "filename": "docs/topics/http/views.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 22,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/docs%2Ftopics%2Fhttp%2Fviews.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fviews.txt?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -134,13 +134,12 @@ The 404 (page not found) view\n \n When you raise an ``Http404`` exception, Django loads a special view devoted\n to handling 404 errors. By default, it's the view\n-``django.views.defaults.page_not_found``, which loads and renders the template\n-``404.html``.\n+``django.views.defaults.page_not_found``, which either produces a very simple\n+\"Not Found\" message or loads and renders the template ``404.html`` if you\n+created it in your root template directory.\n \n-This means you need to define a ``404.html`` template in your root template\n-directory. This template will be used for all 404 errors. The default 404 view\n-will pass one variable to the template: ``request_path``, which is the URL\n-that resulted in the error.\n+The default 404 view will pass one variable to the template: ``request_path``,\n+which is the URL that resulted in the error.\n \n The ``page_not_found`` view should suffice for 99% of Web applications, but if\n you want to override it, you can specify ``handler404`` in your URLconf, like\n@@ -152,15 +151,11 @@ Behind the scenes, Django determines the 404 view by looking for\n ``handler404`` in your root URLconf, and falling back to\n ``django.views.defaults.page_not_found`` if you did not define one.\n \n-Four things to note about 404 views:\n+Three things to note about 404 views:\n \n * The 404 view is also called if Django doesn't find a match after\n   checking every regular expression in the URLconf.\n \n-* If you don't define your own 404 view — and simply use the default,\n-  which is recommended — you still have one obligation: you must create a\n-  ``404.html`` template in the root of your template directory.\n-\n * The 404 view is passed a :class:`~django.template.RequestContext` and\n   will have access to variables supplied by your\n   :setting:`TEMPLATE_CONTEXT_PROCESSORS` setting (e.g., ``MEDIA_URL``).\n@@ -176,13 +171,12 @@ The 500 (server error) view\n \n Similarly, Django executes special-case behavior in the case of runtime errors\n in view code. If a view results in an exception, Django will, by default, call\n-the view ``django.views.defaults.server_error``, which loads and renders the\n-template ``500.html``.\n+the view ``django.views.defaults.server_error``, which either produces a very\n+simple \"Server Error\" message or loads and renders the template ``500.html`` if\n+you created it in your root template directory.\n \n-This means you need to define a ``500.html`` template in your root template\n-directory. This template will be used for all server errors. The default 500\n-view passes no variables to this template and is rendered with an empty\n-``Context`` to lessen the chance of additional errors.\n+The default 500 view passes no variables to the ``500.html`` template and is\n+rendered with an empty ``Context`` to lessen the chance of additional errors.\n \n This ``server_error`` view should suffice for 99% of Web applications, but if\n you want to override the view, you can specify ``handler500`` in your URLconf,\n@@ -194,11 +188,7 @@ Behind the scenes, Django determines the 500 view by looking for\n ``handler500`` in your root URLconf, and falling back to\n ``django.views.defaults.server_error`` if you did not define one.\n \n-Two things to note about 500 views:\n-\n-* If you don't define your own 500 view — and simply use the default,\n-  which is recommended — you still have one obligation: you must create a\n-  ``500.html`` template in the root of your template directory.\n+One thing to note about 500 views:\n \n * If :setting:`DEBUG` is set to ``True`` (in your settings module), then\n   your 500 view will never be used, and the traceback will be displayed"
        },
        {
            "sha": "a150d1ce2a9ff11809a55bfc2353ec78a6382e35",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -229,11 +229,11 @@ def test_loader_debug_origin(self):\n             loader.template_source_loaders = (filesystem.Loader(),)\n \n             # We rely on the fact that runtests.py sets up TEMPLATE_DIRS to\n-            # point to a directory containing a 404.html file. Also that\n+            # point to a directory containing a login.html file. Also that\n             # the file system and app directories loaders both inherit the\n             # load_template method from the BaseLoader class, so we only need\n             # to test one of them.\n-            load_name = '404.html'\n+            load_name = 'login.html'\n             template = loader.get_template(load_name)\n             template_name = template.nodelist[0].source[0].name\n             self.assertTrue(template_name.endswith(load_name),"
        },
        {
            "sha": "f4243216635b582f6192dbb6e14c760afa26010d",
            "filename": "tests/regressiontests/test_client_regress/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -628,15 +628,6 @@ def setUp(self):\n                 if hasattr(template_loader, 'reset'):\n                     template_loader.reset()\n \n-    @override_settings(TEMPLATE_DIRS=(),)\n-    def test_no_404_template(self):\n-        \"Missing templates are correctly reported by test client\"\n-        try:\n-            response = self.client.get(\"/no_such_view/\")\n-            self.fail(\"Should get error about missing template\")\n-        except TemplateDoesNotExist:\n-            pass\n-\n     @override_settings(\n         TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'bad_templates'),)\n     )"
        },
        {
            "sha": "3ca7f7913633517cfd15fbacd5479bb54c869de4",
            "filename": "tests/regressiontests/views/tests/defaults.py",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/tests%2Fregressiontests%2Fviews%2Ftests%2Fdefaults.py",
            "raw_url": "https://github.com/django/django/raw/8bd7b598b6de1be1e3f72f3a1ee62803b1c02010/tests%2Fregressiontests%2Fviews%2Ftests%2Fdefaults.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fdefaults.py?ref=8bd7b598b6de1be1e3f72f3a1ee62803b1c02010",
            "patch": "@@ -1,7 +1,8 @@\n-from __future__ import absolute_import\n+from __future__ import absolute_import, unicode_literals\n \n-from django.test import TestCase\n from django.contrib.contenttypes.models import ContentType\n+from django.test import TestCase\n+from django.test.utils import setup_test_template_loader, restore_template_loaders\n \n from ..models import Author, Article, UrlArticle\n \n@@ -71,6 +72,23 @@ def test_server_error(self):\n         response = self.client.get('/views/server_error/')\n         self.assertEqual(response.status_code, 500)\n \n+    def test_custom_templates(self):\n+        \"\"\"\n+        Test that 404.html and 500.html templates are picked by their respective\n+        handler.\n+        \"\"\"\n+        setup_test_template_loader(\n+            {'404.html': 'This is a test template for a 404 error.',\n+             '500.html': 'This is a test template for a 500 error.'}\n+        )\n+        try:\n+            for code, url in ((404, '/views/non_existing_url/'), (500, '/views/server_error/')):\n+                response = self.client.get(url)\n+                self.assertContains(response, \"test template for a %d error\" % code,\n+                    status_code=code)\n+        finally:\n+            restore_template_loaders()\n+\n     def test_get_absolute_url_attributes(self):\n         \"A model can set attributes on the get_absolute_url method\"\n         self.assertTrue(getattr(UrlArticle.get_absolute_url, 'purge', False),"
        },
        {
            "sha": "da627e222211149910abb3c527bd14cd7c0a7bb6",
            "filename": "tests/templates/404.html",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/864a0514b85637ee92d6f1ba596997195dfc7107/tests%2Ftemplates%2F404.html",
            "raw_url": "https://github.com/django/django/raw/864a0514b85637ee92d6f1ba596997195dfc7107/tests%2Ftemplates%2F404.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Ftemplates%2F404.html?ref=864a0514b85637ee92d6f1ba596997195dfc7107",
            "patch": "@@ -1 +0,0 @@\n-Django Internal Tests: 404 Error\n\\ No newline at end of file"
        },
        {
            "sha": "ff028cbeb017904a13d360ced51debbe5a39f31e",
            "filename": "tests/templates/500.html",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/864a0514b85637ee92d6f1ba596997195dfc7107/tests%2Ftemplates%2F500.html",
            "raw_url": "https://github.com/django/django/raw/864a0514b85637ee92d6f1ba596997195dfc7107/tests%2Ftemplates%2F500.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Ftemplates%2F500.html?ref=864a0514b85637ee92d6f1ba596997195dfc7107",
            "patch": "@@ -1 +0,0 @@\n-Django Internal Tests: 500 Error\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 108,
        "additions": 58,
        "deletions": 50
    }
}