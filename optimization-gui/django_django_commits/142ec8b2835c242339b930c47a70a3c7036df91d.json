{
    "author": "claudep",
    "message": "Fixed #8404 -- Isolated auth password-related tests from custom templates",
    "sha": "142ec8b2835c242339b930c47a70a3c7036df91d",
    "files": [
        {
            "sha": "42bea825f592da4d5b19016696ec3b946d4eebe7",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/142ec8b2835c242339b930c47a70a3c7036df91d/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/142ec8b2835c242339b930c47a70a3c7036df91d/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=142ec8b2835c242339b930c47a70a3c7036df91d",
            "patch": "@@ -1,3 +1,4 @@\n+import itertools\n import os\n import re\n \n@@ -49,8 +50,10 @@ def login(self, password='password'):\n         self.assertTrue(response.url.endswith(settings.LOGIN_REDIRECT_URL))\n         self.assertTrue(SESSION_KEY in self.client.session)\n \n-    def assertContainsEscaped(self, response, text, **kwargs):\n-        return self.assertContains(response, escape(force_text(text)), **kwargs)\n+    def assertFormError(self, response, error):\n+        \"\"\"Assert that error is found in response.context['form'] errors\"\"\"\n+        form_errors = list(itertools.chain(*response.context['form'].errors.values()))\n+        self.assertIn(force_text(text), form_errors)\n \n \n @skipIfCustomUser\n@@ -87,7 +90,7 @@ def test_email_not_found(self):\n         response = self.client.get('/password_reset/')\n         self.assertEqual(response.status_code, 200)\n         response = self.client.post('/password_reset/', {'email': 'not_a_real_email@email.com'})\n-        self.assertContainsEscaped(response, PasswordResetForm.error_messages['unknown'])\n+        self.assertFormError(response, PasswordResetForm.error_messages['unknown'])\n         self.assertEqual(len(mail.outbox), 0)\n \n     def test_email_found(self):\n@@ -214,7 +217,7 @@ def test_confirm_different_passwords(self):\n         url, path = self._test_confirm_start()\n         response = self.client.post(path, {'new_password1': 'anewpassword',\n                                            'new_password2': 'x'})\n-        self.assertContainsEscaped(response, SetPasswordForm.error_messages['password_mismatch'])\n+        self.assertFormError(response, SetPasswordForm.error_messages['password_mismatch'])\n \n \n @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n@@ -248,7 +251,7 @@ def fail_login(self, password='password'):\n             'username': 'testclient',\n             'password': password,\n         })\n-        self.assertContainsEscaped(response, AuthenticationForm.error_messages['invalid_login'] % {\n+        self.assertFormError(response, AuthenticationForm.error_messages['invalid_login'] % {\n                 'username': User._meta.get_field('username').verbose_name\n             })\n \n@@ -262,7 +265,7 @@ def test_password_change_fails_with_invalid_old_password(self):\n             'new_password1': 'password1',\n             'new_password2': 'password1',\n         })\n-        self.assertContainsEscaped(response, PasswordChangeForm.error_messages['password_incorrect'])\n+        self.assertFormError(response, PasswordChangeForm.error_messages['password_incorrect'])\n \n     def test_password_change_fails_with_mismatched_passwords(self):\n         self.login()\n@@ -271,7 +274,7 @@ def test_password_change_fails_with_mismatched_passwords(self):\n             'new_password1': 'password1',\n             'new_password2': 'donuts',\n         })\n-        self.assertContainsEscaped(response, SetPasswordForm.error_messages['password_mismatch'])\n+        self.assertFormError(response, SetPasswordForm.error_messages['password_mismatch'])\n \n     def test_password_change_succeeds(self):\n         self.login()"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
    }
}