{
    "author": "jezdez",
    "message": "Merge pull request #943 from stephrdev/trac-19433\n\nFixed #19433 -- Added some class attributes to pass initial form lists to the WizardView.",
    "sha": "f2c55d2ee1b161b8ea96bed446deb45c63039e0a",
    "files": [
        {
            "sha": "14c6e6a6858c458ff4900dd933e5be86180f7fcd",
            "filename": "django/contrib/formtools/tests/wizard/forms.py",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/f2c55d2ee1b161b8ea96bed446deb45c63039e0a/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/f2c55d2ee1b161b8ea96bed446deb45c63039e0a/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fforms.py?ref=f2c55d2ee1b161b8ea96bed446deb45c63039e0a",
            "patch": "@@ -78,6 +78,12 @@ def get_form_kwargs(self, step, *args, **kwargs):\n             kwargs['test'] = True\n         return kwargs\n \n+class TestWizardWithInitAttrs(TestWizard):\n+    form_list = [Step1, Step2]\n+    condition_dict = {'step2': True}\n+    initial_dict = {'start': {'name': 'value1'}}\n+    instance_dict = {'start': User()}\n+\n class FormTests(TestCase):\n     def test_form_init(self):\n         testform = TestWizard.get_initkwargs([Step1, Step2])\n@@ -91,6 +97,9 @@ def test_form_init(self):\n         self.assertEqual(\n             testform['form_list'], {'0': Step1, '1': Step2, 'finish': Step3})\n \n+        testform = TestWizardWithInitAttrs.get_initkwargs()\n+        self.assertEqual(testform['form_list'], {'0': Step1, '1': Step2})\n+\n     def test_first_step(self):\n         request = get_request()\n \n@@ -132,6 +141,11 @@ def test_form_condition(self):\n         response, instance = testform(request)\n         self.assertEqual(instance.get_next_step(), 'step3')\n \n+        testform = TestWizardWithInitAttrs.as_view(\n+            [('start', Step1), ('step2', Step2), ('step3', Step3)])\n+        response, instance = testform(request)\n+        self.assertEqual(instance.get_next_step(), 'step2')\n+\n     def test_form_kwargs(self):\n         request = get_request()\n \n@@ -162,6 +176,13 @@ def test_form_initial(self):\n         self.assertEqual(instance.get_form_initial('start'), {'name': 'value1'})\n         self.assertEqual(instance.get_form_initial('step2'), {})\n \n+        testform = TestWizardWithInitAttrs.as_view(\n+            [('start', Step1), ('step2', Step2)])\n+        response, instance = testform(request)\n+\n+        self.assertEqual(instance.get_form_initial('start'), {'name': 'value1'})\n+        self.assertEqual(instance.get_form_initial('step2'), {})\n+\n     def test_form_instance(self):\n         request = get_request()\n         the_instance = TestModel()\n@@ -176,6 +197,14 @@ def test_form_instance(self):\n             instance.get_form_instance('non_exist_instance'),\n             None)\n \n+        testform = TestWizardWithInitAttrs.as_view(\n+            [('start', TestModelForm), ('step2', Step2)])\n+        response, instance = testform(request)\n+\n+        self.assertEqual(\n+            instance.get_form_instance('start'),\n+            TestWizardWithInitAttrs.instance_dict['start'])\n+\n     def test_formset_instance(self):\n         request = get_request()\n         the_instance1, created = TestModel.objects.get_or_create("
        },
        {
            "sha": "4379e6cdebd65f90a7fd1c859969ff2b3649482f",
            "filename": "django/contrib/formtools/wizard/views.py",
            "status": "modified",
            "additions": 18,
            "deletions": 10,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/f2c55d2ee1b161b8ea96bed446deb45c63039e0a/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/f2c55d2ee1b161b8ea96bed446deb45c63039e0a/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py?ref=f2c55d2ee1b161b8ea96bed446deb45c63039e0a",
            "patch": "@@ -120,8 +120,8 @@ def as_view(cls, *args, **kwargs):\n         return super(WizardView, cls).as_view(**initkwargs)\n \n     @classmethod\n-    def get_initkwargs(cls, form_list, initial_dict=None,\n-            instance_dict=None, condition_dict=None, *args, **kwargs):\n+    def get_initkwargs(cls, form_list=None, initial_dict=None,\n+        instance_dict=None, condition_dict=None, *args, **kwargs):\n         \"\"\"\n         Creates a dict with all needed parameters for the form wizard instances.\n \n@@ -144,12 +144,20 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n           will be called with the wizardview instance as the only argument.\n           If the return value is true, the step's form will be used.\n         \"\"\"\n+\n         kwargs.update({\n-            'initial_dict': initial_dict or {},\n-            'instance_dict': instance_dict or {},\n-            'condition_dict': condition_dict or {},\n+            'initial_dict': initial_dict or kwargs.pop('initial_dict',\n+                getattr(cls, 'initial_dict', None)) or {},\n+            'instance_dict': instance_dict or kwargs.pop('instance_dict',\n+                getattr(cls, 'instance_dict', None)) or {},\n+            'condition_dict': condition_dict or kwargs.pop('condition_dict',\n+                getattr(cls, 'condition_dict', None)) or {}\n         })\n-        init_form_list = SortedDict()\n+\n+        form_list = form_list or kwargs.pop('form_list',\n+            getattr(cls, 'form_list', None)) or []\n+\n+        computed_form_list = SortedDict()\n \n         assert len(form_list) > 0, 'at least one form is needed'\n \n@@ -158,13 +166,13 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n             if isinstance(form, (list, tuple)):\n                 # if the element is a tuple, add the tuple to the new created\n                 # sorted dictionary.\n-                init_form_list[six.text_type(form[0])] = form[1]\n+                computed_form_list[six.text_type(form[0])] = form[1]\n             else:\n                 # if not, add the form with a zero based counter as unicode\n-                init_form_list[six.text_type(i)] = form\n+                computed_form_list[six.text_type(i)] = form\n \n         # walk through the new created list of forms\n-        for form in six.itervalues(init_form_list):\n+        for form in six.itervalues(computed_form_list):\n             if issubclass(form, formsets.BaseFormSet):\n                 # if the element is based on BaseFormSet (FormSet/ModelFormSet)\n                 # we need to override the form variable.\n@@ -179,7 +187,7 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n                             \"wizard view in order to handle file uploads.\")\n \n         # build the kwargs for the wizardview instances\n-        kwargs['form_list'] = init_form_list\n+        kwargs['form_list'] = computed_form_list\n         return kwargs\n \n     def get_prefix(self, *args, **kwargs):"
        },
        {
            "sha": "f8d46fd2914155f05882d45e106a016fa16ee9ea",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/f2c55d2ee1b161b8ea96bed446deb45c63039e0a/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/f2c55d2ee1b161b8ea96bed446deb45c63039e0a/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=f2c55d2ee1b161b8ea96bed446deb45c63039e0a",
            "patch": "@@ -245,6 +245,13 @@ wizard's ``as_view()`` method takes a list of your\n         (r'^contact/$', ContactWizard.as_view([ContactForm1, ContactForm2])),\n     )\n \n+.. versionchanged:: 1.6\n+\n+You can also pass the form list as a class attribute named ``form_list``.\n+\n+    class ContactWizard(WizardView):\n+        form_list = [ContactForm1, ContactForm2]\n+\n .. _wizard-template-for-each-form:\n \n Using a different template for each form\n@@ -295,6 +302,14 @@ The ``urls.py`` file would contain something like::\n         (r'^checkout/$', OrderWizard.as_view(FORMS, condition_dict={'cc': pay_by_credit_card})),\n     )\n \n+.. versionchanged:: 1.6\n+\n+The ``condiction_dict`` can be passed as attribute for the ``as_view()``\n+method or as a class attribute named ``condition_dict``.\n+\n+    class OrderWizard(WizardView):\n+        condition_dict = {'cc': pay_by_credit_card}\n+\n Note that the ``OrderWizard`` object is initialized with a list of pairs.\n The first element in the pair is a string that corresponds to the name of the\n step and the second is the form class.\n@@ -550,6 +565,11 @@ Providing initial data for the forms\n     The ``initial_dict`` can also take a list of dictionaries for a specific\n     step if the step is a ``FormSet``.\n \n+    .. versionchanged:: 1.6\n+\n+    The ``initial_dict`` can also be added as a class attribute named\n+    ``initial_dict`` to avoid having the initial data in the ``urls.py``.\n+\n .. _wizard-files:\n \n Handling files"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 67,
        "deletions": 10
    }
}