{
    "author": "aaugustin",
    "message": "Fixed a test that was broken at r16978. Refs #17055.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16993 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d75337fc7b63400a4d866955d84d3092822c95ab",
    "files": [
        {
            "sha": "fcc8c9401127cbbf991438b5858b125de59215d2",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/d75337fc7b63400a4d866955d84d3092822c95ab/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/d75337fc7b63400a4d866955d84d3092822c95ab/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=d75337fc7b63400a4d866955d84d3092822c95ab",
            "patch": "@@ -52,8 +52,12 @@ def _make_token_with_timestamp(self, user, timestamp):\n         # invalid as soon as it is used.\n         # We limit the hash to 20 chars to keep URL short\n         key_salt = \"django.contrib.auth.tokens.PasswordResetTokenGenerator\"\n+\n+        # Ensure results are consistent across DB backends\n+        login_timestamp = user.last_login.replace(microsecond=0, tzinfo=None)\n+\n         value = (unicode(user.id) + user.password +\n-                unicode(user.last_login) + unicode(timestamp))\n+                unicode(login_timestamp) + unicode(timestamp))\n         hash = salted_hmac(key_salt, value).hexdigest()[::2]\n         return \"%s-%s\" % (ts_b36, hash)\n "
        }
    ],
    "stats": {
        "total": 6,
        "additions": 5,
        "deletions": 1
    }
}