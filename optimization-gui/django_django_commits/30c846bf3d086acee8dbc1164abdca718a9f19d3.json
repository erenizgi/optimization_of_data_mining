{
    "author": "aaugustin",
    "message": "Fixed #6669 -- Ensured database connections are marked as dirty by CursorDebugWrapper.execute/executemany. Refs #9964. Thanks james at 10gic net for the report and Claude Paroz for the patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17368 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "30c846bf3d086acee8dbc1164abdca718a9f19d3",
    "files": [
        {
            "sha": "3ba1cb00cd81ea6482607bcde1912f4d4ef405ea",
            "filename": "django/db/backends/util.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/30c846bf3d086acee8dbc1164abdca718a9f19d3/django%2Fdb%2Fbackends%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/30c846bf3d086acee8dbc1164abdca718a9f19d3/django%2Fdb%2Fbackends%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Futil.py?ref=30c846bf3d086acee8dbc1164abdca718a9f19d3",
            "patch": "@@ -16,9 +16,12 @@ def __init__(self, cursor, db):\n         self.cursor = cursor\n         self.db = db\n \n-    def __getattr__(self, attr):\n+    def set_dirty(self):\n         if self.db.is_managed():\n             self.db.set_dirty()\n+\n+    def __getattr__(self, attr):\n+        self.set_dirty()\n         if attr in self.__dict__:\n             return self.__dict__[attr]\n         else:\n@@ -31,6 +34,7 @@ def __iter__(self):\n class CursorDebugWrapper(CursorWrapper):\n \n     def execute(self, sql, params=()):\n+        self.set_dirty()\n         start = time()\n         try:\n             return self.cursor.execute(sql, params)\n@@ -47,6 +51,7 @@ def execute(self, sql, params=()):\n             )\n \n     def executemany(self, sql, param_list):\n+        self.set_dirty()\n         start = time()\n         try:\n             return self.cursor.executemany(sql, param_list)"
        },
        {
            "sha": "59722630df0a85e863ffeee2b4198de3676aee7f",
            "filename": "tests/regressiontests/transactions_regress/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/30c846bf3d086acee8dbc1164abdca718a9f19d3/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/30c846bf3d086acee8dbc1164abdca718a9f19d3/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py?ref=30c846bf3d086acee8dbc1164abdca718a9f19d3",
            "patch": "@@ -4,6 +4,7 @@\n from django.db import connection, transaction\n from django.db.transaction import commit_on_success, commit_manually, TransactionManagementError\n from django.test import TransactionTestCase, skipUnlessDBFeature\n+from django.test.utils import override_settings\n from django.utils.unittest import skipIf\n \n from .models import Mod, M2mA, M2mB\n@@ -166,6 +167,13 @@ def create_system_user():\n         except:\n             self.fail(\"A transaction consisting of a failed operation was not closed.\")\n \n+    @override_settings(DEBUG=True)\n+    def test_failing_query_transaction_closed_debug(self):\n+        \"\"\"\n+        Regression for #6669. Same test as above, with DEBUG=True.\n+        \"\"\"\n+        self.test_failing_query_transaction_closed()\n+\n \n class TestManyToManyAddTransaction(TransactionTestCase):\n     def test_manyrelated_add_commit(self):"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 14,
        "deletions": 1
    }
}