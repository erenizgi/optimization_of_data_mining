{
    "author": "aaugustin",
    "message": "Fixed #5241 -- Kept active transalation in LocaleMiddleware.process_response.",
    "sha": "aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9",
    "files": [
        {
            "sha": "9b2ef8ff3222700357268a2c19ddcce19907c35a",
            "filename": "django/middleware/locale.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9/django%2Fmiddleware%2Flocale.py",
            "raw_url": "https://github.com/django/django/raw/aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9/django%2Fmiddleware%2Flocale.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Flocale.py?ref=aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9",
            "patch": "@@ -51,7 +51,7 @@ def process_response(self, request, response):\n                     request.is_secure() and 'https' or 'http',\n                     request.get_host(), language, request.get_full_path())\n                 return HttpResponseRedirect(language_url)\n-        translation.deactivate()\n+\n         if not (self.is_language_prefix_patterns_used()\n                 and language_from_path):\n             patch_vary_headers(response, ('Accept-Language',))"
        },
        {
            "sha": "3038c4813c3bba92609208313ff59a8644d776ae",
            "filename": "tests/i18n/tests.py",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9/tests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9/tests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fi18n%2Ftests.py?ref=aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9",
            "patch": "@@ -1096,3 +1096,26 @@ def test_multiple_locale_direct_switch_btrans(self):\n             t = Template(\"{% load i18n %}{% blocktrans %}No{% endblocktrans %}\")\n         with translation.override('nl'):\n             self.assertEqual(t.render(Context({})), 'Nee')\n+\n+\n+@override_settings(\n+    USE_I18N=True,\n+    LANGUAGES=(\n+        ('en', 'English'),\n+        ('fr', 'French'),\n+    ),\n+    MIDDLEWARE_CLASSES=(\n+        'django.middleware.locale.LocaleMiddleware',\n+        'django.middleware.common.CommonMiddleware',\n+    ),\n+)\n+class LocaleMiddlewareTests(TestCase):\n+\n+    urls = 'i18n.urls'\n+\n+    def test_streaming_response(self):\n+        # Regression test for #5241\n+        response = self.client.get('/fr/streaming/')\n+        self.assertContains(response, \"Oui/Non\")\n+        response = self.client.get('/en/streaming/')\n+        self.assertContains(response, \"Yes/No\")"
        },
        {
            "sha": "c118265dabfb37bef70d892101e576cd0ae4584f",
            "filename": "tests/i18n/urls.py",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9/tests%2Fi18n%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9/tests%2Fi18n%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fi18n%2Furls.py?ref=aa089b106b6cfc9a47cd54a0f9eb44bd44811ed9",
            "patch": "@@ -0,0 +1,9 @@\n+from __future__ import unicode_literals\n+\n+from django.conf.urls.i18n import i18n_patterns\n+from django.http import StreamingHttpResponse\n+from django.utils.translation import ugettext_lazy as _\n+\n+urlpatterns = i18n_patterns('',\n+    (r'^streaming/$', lambda r: StreamingHttpResponse([_(\"Yes\"), \"/\", _(\"No\")])),\n+)"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 33,
        "deletions": 1
    }
}