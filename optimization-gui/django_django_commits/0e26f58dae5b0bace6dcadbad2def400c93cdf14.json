{
    "author": "ramiro",
    "message": "Corrected change in behavior regarding the page shown after the 'Save' button is pressed when adding a user through the admin.\n\nIt had been introduced in trunk (r13503) and between 1.2.1 and 1.2.2 (r13504). The original fix intended to correct a similar problem introduced between 1.1 and 1.2 (r12218) this time in the 'Save and add another' button.\nWe have now tests for the three buttons present in the Add User admin form to avoid future regressions.\nThanks to Juan Pedro Fisanotti and Cesar H. Roldan for their work.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14628 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0e26f58dae5b0bace6dcadbad2def400c93cdf14",
    "files": [
        {
            "sha": "497e9b9f462b748312ba7ae9a5252910a2b3228f",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/0e26f58dae5b0bace6dcadbad2def400c93cdf14/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/0e26f58dae5b0bace6dcadbad2def400c93cdf14/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=0e26f58dae5b0bace6dcadbad2def400c93cdf14",
            "patch": "@@ -1,4 +1,3 @@\n-from django import template\n from django.db import transaction\n from django.conf import settings\n from django.contrib import admin\n@@ -137,6 +136,17 @@ def user_change_password(self, request, id):\n             'root_path': self.admin_site.root_path,\n         }, context_instance=RequestContext(request))\n \n+    def response_add(self, request, obj, post_url_continue='../%s/'):\n+        \"\"\"\n+        Determines the HttpResponse for the add_view stage. It mostly defers to\n+        its superclass implementation but is customized because the User model\n+        has a slightly different workflow.\n+        \"\"\"\n+        if '_addanother' not in request.POST:\n+            # The 'Save' button should act like the 'Save and continue\n+            # editing' button\n+            request.POST['_continue'] = 1\n+        return super(UserAdmin, self).response_add(request, obj, post_url_continue)\n \n admin.site.register(Group, GroupAdmin)\n admin.site.register(User, UserAdmin)"
        },
        {
            "sha": "4c9630633221e103cedf29c87dffa89b793dc573",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 12,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/0e26f58dae5b0bace6dcadbad2def400c93cdf14/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0e26f58dae5b0bace6dcadbad2def400c93cdf14/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=0e26f58dae5b0bace6dcadbad2def400c93cdf14",
            "patch": "@@ -18,7 +18,7 @@\n from django.utils.cache import get_max_age\n from django.utils.encoding import iri_to_uri\n from django.utils.html import escape\n-from django.utils.translation import get_date_formats, activate, deactivate\n+from django.utils.translation import activate, deactivate\n from django.utils import unittest\n \n # local test models\n@@ -1538,7 +1538,7 @@ def test_model_without_action_still_has_jquery(self):\n     def test_action_column_class(self):\n         \"Tests that the checkbox column class is present in the response\"\n         response = self.client.get('/test_admin/admin/admin_views/subscriber/')\n-        self.assertNotEquals(response.context[\"action_form\"], None)\n+        self.assertNotEqual(response.context[\"action_form\"], None)\n         self.assert_('action-checkbox-column' in response.content,\n             \"Expected an action-checkbox-column in response\")\n \n@@ -2164,7 +2164,19 @@ def setUp(self):\n     def tearDown(self):\n         self.client.logout()\n \n-    def test_user_creation(self):\n+    def test_save_button(self):\n+        user_count = User.objects.count()\n+        response = self.client.post('/test_admin/admin/auth/user/add/', {\n+            'username': 'newuser',\n+            'password1': 'newpassword',\n+            'password2': 'newpassword',\n+        })\n+        new_user = User.objects.order_by('-id')[0]\n+        self.assertRedirects(response, '/test_admin/admin/auth/user/%s/' % new_user.pk)\n+        self.assertEqual(User.objects.count(), user_count + 1)\n+        self.assertNotEqual(new_user.password, UNUSABLE_PASSWORD)\n+\n+    def test_save_continue_editing_button(self):\n         user_count = User.objects.count()\n         response = self.client.post('/test_admin/admin/auth/user/add/', {\n             'username': 'newuser',\n@@ -2174,30 +2186,31 @@ def test_user_creation(self):\n         })\n         new_user = User.objects.order_by('-id')[0]\n         self.assertRedirects(response, '/test_admin/admin/auth/user/%s/' % new_user.pk)\n-        self.assertEquals(User.objects.count(), user_count + 1)\n-        self.assertNotEquals(new_user.password, UNUSABLE_PASSWORD)\n+        self.assertEqual(User.objects.count(), user_count + 1)\n+        self.assertNotEqual(new_user.password, UNUSABLE_PASSWORD)\n \n     def test_password_mismatch(self):\n         response = self.client.post('/test_admin/admin/auth/user/add/', {\n             'username': 'newuser',\n             'password1': 'newpassword',\n             'password2': 'mismatch',\n         })\n-        self.assertEquals(response.status_code, 200)\n+        self.assertEqual(response.status_code, 200)\n         adminform = response.context['adminform']\n-        self.assert_('password' not in adminform.form.errors)\n-        self.assertEquals(adminform.form.errors['password2'],\n+        self.assertTrue('password' not in adminform.form.errors)\n+        self.assertEqual(adminform.form.errors['password2'],\n                           [u\"The two password fields didn't match.\"])\n \n     def test_user_fk_popup(self):\n         response = self.client.get('/test_admin/admin/admin_views/album/add/')\n-        self.failUnlessEqual(response.status_code, 200)\n+        self.assertEqual(response.status_code, 200)\n         self.assertContains(response, '/test_admin/admin/auth/user/add')\n         self.assertContains(response, 'class=\"add-another\" id=\"add_id_owner\" onclick=\"return showAddAnotherPopup(this);\"')\n         response = self.client.get('/test_admin/admin/auth/user/add/?_popup=1')\n         self.assertNotContains(response, 'name=\"_continue\"')\n+        self.assertNotContains(response, 'name=\"_addanother\"')\n \n-    def test_user_add_another(self):\n+    def test_save_add_another_button(self):\n         user_count = User.objects.count()\n         response = self.client.post('/test_admin/admin/auth/user/add/', {\n             'username': 'newuser',\n@@ -2207,8 +2220,8 @@ def test_user_add_another(self):\n         })\n         new_user = User.objects.order_by('-id')[0]\n         self.assertRedirects(response, '/test_admin/admin/auth/user/add/')\n-        self.assertEquals(User.objects.count(), user_count + 1)\n-        self.assertNotEquals(new_user.password, UNUSABLE_PASSWORD)\n+        self.assertEqual(User.objects.count(), user_count + 1)\n+        self.assertNotEqual(new_user.password, UNUSABLE_PASSWORD)\n \n try:\n     import docutils"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 36,
        "deletions": 13
    }
}