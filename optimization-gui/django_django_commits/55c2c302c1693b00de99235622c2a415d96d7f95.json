{
    "author": "spookylukey",
    "message": "Refactoring of 'fully_decorated' for clarity and removal of duplication.\n\nAlso allows re-use of 'full_decorator' if we need it.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16271 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "55c2c302c1693b00de99235622c2a415d96d7f95",
    "files": [
        {
            "sha": "d9a6b4caf7e71100d499c1c4dcab644634b856b8",
            "filename": "tests/regressiontests/decorators/tests.py",
            "status": "modified",
            "additions": 43,
            "deletions": 28,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/55c2c302c1693b00de99235622c2a415d96d7f95/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/55c2c302c1693b00de99235622c2a415d96d7f95/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdecorators%2Ftests.py?ref=55c2c302c1693b00de99235622c2a415d96d7f95",
            "patch": "@@ -16,35 +16,50 @@ def fully_decorated(request):\n     return HttpResponse('<html><body>dummy</body></html>')\n fully_decorated.anything = \"Expected __dict__\"\n \n-# django.views.decorators.http\n-fully_decorated = require_http_methods([\"GET\"])(fully_decorated)\n-fully_decorated = require_GET(fully_decorated)\n-fully_decorated = require_POST(fully_decorated)\n-fully_decorated = require_safe(fully_decorated)\n-\n-# django.views.decorators.vary\n-fully_decorated = vary_on_headers('Accept-language')(fully_decorated)\n-fully_decorated = vary_on_cookie(fully_decorated)\n-\n-# django.views.decorators.cache\n-fully_decorated = cache_page(60*15)(fully_decorated)\n-fully_decorated = cache_control(private=True)(fully_decorated)\n-fully_decorated = never_cache(fully_decorated)\n-\n-# django.contrib.auth.decorators\n-# Apply user_passes_test twice to check #9474\n-fully_decorated = user_passes_test(lambda u:True)(fully_decorated)\n-fully_decorated = login_required(fully_decorated)\n-fully_decorated = permission_required('change_world')(fully_decorated)\n-\n-# django.contrib.admin.views.decorators\n-fully_decorated = staff_member_required(fully_decorated)\n-\n-# django.utils.functional\n-fully_decorated = memoize(fully_decorated, {}, 1)\n-fully_decorated = allow_lazy(fully_decorated)\n-fully_decorated = lazy(fully_decorated)\n \n+def compose(*functions):\n+    # compose(f, g)(*args, **kwargs) == f(g(*args, **kwargs))\n+    functions = list(reversed(functions))\n+    def _inner(*args, **kwargs):\n+        result = functions[0](*args, **kwargs)\n+        for f in functions[1:]:\n+            result = f(result)\n+        return result\n+    return _inner\n+\n+\n+full_decorator = compose(\n+    # django.views.decorators.http\n+    require_http_methods([\"GET\"]),\n+    require_GET,\n+    require_POST,\n+    require_safe,\n+\n+    # django.views.decorators.vary\n+    vary_on_headers('Accept-language'),\n+    vary_on_cookie,\n+\n+    # django.views.decorators.cache\n+    cache_page(60*15),\n+    cache_control(private=True),\n+    never_cache,\n+\n+    # django.contrib.auth.decorators\n+    # Apply user_passes_test twice to check #9474\n+    user_passes_test(lambda u:True),\n+    login_required,\n+    permission_required('change_world'),\n+\n+    # django.contrib.admin.views.decorators\n+    staff_member_required,\n+\n+    # django.utils.functional\n+    lambda f: memoize(f, {}, 1),\n+    allow_lazy,\n+    lazy,\n+)\n+\n+fully_decorated = full_decorator(fully_decorated)\n \n class DecoratorsTest(TestCase):\n "
        }
    ],
    "stats": {
        "total": 71,
        "additions": 43,
        "deletions": 28
    }
}