{
    "author": "SmileyChris",
    "message": "Paginator._get_page hook\n\nThis allows for Paginator subclasses to easily override the Page class\nthat gets used.\n\nTook the opportunity to also do some non-invasive PEP8 tidying of the\npaginator module.",
    "sha": "fbfa654a15487f9a49e9a5d34a4e9694fe878a8f",
    "files": [
        {
            "sha": "9ccff51a34d97f8be8338512f8ed435ddf376cd2",
            "filename": "django/core/paginator.py",
            "status": "modified",
            "additions": 32,
            "deletions": 7,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/fbfa654a15487f9a49e9a5d34a4e9694fe878a8f/django%2Fcore%2Fpaginator.py",
            "raw_url": "https://github.com/django/django/raw/fbfa654a15487f9a49e9a5d34a4e9694fe878a8f/django%2Fcore%2Fpaginator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fpaginator.py?ref=fbfa654a15487f9a49e9a5d34a4e9694fe878a8f",
            "patch": "@@ -7,22 +7,29 @@\n class InvalidPage(Exception):\n     pass\n \n+\n class PageNotAnInteger(InvalidPage):\n     pass\n \n+\n class EmptyPage(InvalidPage):\n     pass\n \n+\n class Paginator(object):\n-    def __init__(self, object_list, per_page, orphans=0, allow_empty_first_page=True):\n+\n+    def __init__(self, object_list, per_page, orphans=0,\n+                 allow_empty_first_page=True):\n         self.object_list = object_list\n         self.per_page = int(per_page)\n         self.orphans = int(orphans)\n         self.allow_empty_first_page = allow_empty_first_page\n         self._num_pages = self._count = None\n \n     def validate_number(self, number):\n-        \"Validates the given 1-based page number.\"\n+        \"\"\"\n+        Validates the given 1-based page number.\n+        \"\"\"\n         try:\n             number = int(number)\n         except (TypeError, ValueError):\n@@ -37,16 +44,29 @@ def validate_number(self, number):\n         return number\n \n     def page(self, number):\n-        \"Returns a Page object for the given 1-based page number.\"\n+        \"\"\"\n+        Returns a Page object for the given 1-based page number.\n+        \"\"\"\n         number = self.validate_number(number)\n         bottom = (number - 1) * self.per_page\n         top = bottom + self.per_page\n         if top + self.orphans >= self.count:\n             top = self.count\n-        return Page(self.object_list[bottom:top], number, self)\n+        return self._get_page(self.object_list[bottom:top], number, self)\n+\n+    def _get_page(self, *args, **kwargs):\n+        \"\"\"\n+        Returns an instance of a single page.\n+\n+        This hook can be used by subclasses to use an alternative to the\n+        standard :cls:`Page` object.\n+        \"\"\"\n+        return Page(*args, **kwargs)\n \n     def _get_count(self):\n-        \"Returns the total number of objects, across all pages.\"\n+        \"\"\"\n+        Returns the total number of objects, across all pages.\n+        \"\"\"\n         if self._count is None:\n             try:\n                 self._count = self.object_list.count()\n@@ -59,7 +79,9 @@ def _get_count(self):\n     count = property(_get_count)\n \n     def _get_num_pages(self):\n-        \"Returns the total number of pages.\"\n+        \"\"\"\n+        Returns the total number of pages.\n+        \"\"\"\n         if self._num_pages is None:\n             if self.count == 0 and not self.allow_empty_first_page:\n                 self._num_pages = 0\n@@ -77,9 +99,12 @@ def _get_page_range(self):\n         return range(1, self.num_pages + 1)\n     page_range = property(_get_page_range)\n \n-QuerySetPaginator = Paginator # For backwards-compatibility.\n+\n+QuerySetPaginator = Paginator   # For backwards-compatibility.\n+\n \n class Page(collections.Sequence):\n+\n     def __init__(self, object_list, number, paginator):\n         self.object_list = object_list\n         self.number = number"
        },
        {
            "sha": "47a932c7e3fa3471302a68d8d397d1f614d6dcb6",
            "filename": "tests/regressiontests/pagination/custom.py",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/fbfa654a15487f9a49e9a5d34a4e9694fe878a8f/tests%2Fregressiontests%2Fpagination%2Fcustom.py",
            "raw_url": "https://github.com/django/django/raw/fbfa654a15487f9a49e9a5d34a4e9694fe878a8f/tests%2Fregressiontests%2Fpagination%2Fcustom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination%2Fcustom.py?ref=fbfa654a15487f9a49e9a5d34a4e9694fe878a8f",
            "patch": "@@ -0,0 +1,20 @@\n+from django.core.paginator import Paginator, Page\n+\n+\n+class ValidAdjacentNumsPage(Page):\n+\n+    def next_page_number(self):\n+        if not self.has_next():\n+            return None\n+        return super(ValidAdjacentNumsPage, self).next_page_number()\n+\n+    def previous_page_number(self):\n+        if not self.has_previous():\n+            return None\n+        return super(ValidAdjacentNumsPage, self).previous_page_number()\n+\n+\n+class ValidAdjacentNumsPaginator(Paginator):\n+\n+    def _get_page(self, *args, **kwargs):\n+        return ValidAdjacentNumsPage(*args, **kwargs)"
        },
        {
            "sha": "b06bebf7700549185f5b7537a3ca1f8484350f06",
            "filename": "tests/regressiontests/pagination/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/fbfa654a15487f9a49e9a5d34a4e9694fe878a8f/tests%2Fregressiontests%2Fpagination%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fbfa654a15487f9a49e9a5d34a4e9694fe878a8f/tests%2Fregressiontests%2Fpagination%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination%2Ftests.py?ref=fbfa654a15487f9a49e9a5d34a4e9694fe878a8f",
            "patch": "@@ -9,6 +9,7 @@\n from django.utils import unittest\n \n from .models import Article\n+from .custom import ValidAdjacentNumsPaginator\n \n \n class PaginationTests(unittest.TestCase):\n@@ -217,6 +218,20 @@ def test_page_sequence(self):\n         self.assertEqual(''.join(page2), 'fghijk')\n         self.assertEqual(''.join(reversed(page2)), 'kjihgf')\n \n+    def test_get_page_hook(self):\n+        \"\"\"\n+        Tests that a Paginator subclass can use the ``_get_page`` hook to\n+        return an alternative to the standard Page class.\n+        \"\"\"\n+        eleven = 'abcdefghijk'\n+        paginator = ValidAdjacentNumsPaginator(eleven, per_page=6)\n+        page1 = paginator.page(1)\n+        page2 = paginator.page(2)\n+        self.assertEquals(page1.previous_page_number(), None)\n+        self.assertEquals(page1.next_page_number(), 2)\n+        self.assertEquals(page2.previous_page_number(), 1)\n+        self.assertEquals(page2.next_page_number(), None)\n+\n \n class ModelPaginationTests(TestCase):\n     \"\"\""
        }
    ],
    "stats": {
        "total": 74,
        "additions": 67,
        "deletions": 7
    }
}