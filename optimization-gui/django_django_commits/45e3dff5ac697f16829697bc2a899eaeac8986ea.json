{
    "author": "jphalip",
    "message": "Ensured that `makemessages` doesn't leave any temporary file over if the parsing of a template file fails. Refs #8536.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17240 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "45e3dff5ac697f16829697bc2a899eaeac8986ea",
    "files": [
        {
            "sha": "e31c6c8d316c887b6e68fc5e59015ef2221b1d34",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/45e3dff5ac697f16829697bc2a899eaeac8986ea/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/45e3dff5ac697f16829697bc2a899eaeac8986ea/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=45e3dff5ac697f16829697bc2a899eaeac8986ea",
            "patch": "@@ -229,9 +229,10 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                 if file_ext in extensions:\n                     src = open(orig_file, \"rU\").read()\n                     thefile = '%s.py' % file\n+                    content = templatize(src, orig_file[2:])\n                     f = open(os.path.join(dirpath, thefile), \"w\")\n                     try:\n-                        f.write(templatize(src, orig_file[2:]))\n+                        f.write(content)\n                     finally:\n                         f.close()\n                 if verbosity > 1:"
        },
        {
            "sha": "b1fc0025c7c7fb0df44f51502d5399a503245b3f",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/45e3dff5ac697f16829697bc2a899eaeac8986ea/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/45e3dff5ac697f16829697bc2a899eaeac8986ea/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=45e3dff5ac697f16829697bc2a899eaeac8986ea",
            "patch": "@@ -108,16 +108,14 @@ def test_extraction_error(self):\n         os.chdir(self.test_dir)\n         shutil.copyfile('./templates/template_with_error.tpl', './templates/template_with_error.html')\n         self.assertRaises(SyntaxError, management.call_command, 'makemessages', locale=LOCALE, verbosity=0)\n-        try:\n+        with self.assertRaises(SyntaxError) as context_manager:\n             management.call_command('makemessages', locale=LOCALE, verbosity=0)\n-        except SyntaxError, e:\n-            self.assertRegexpMatches(\n-                str(e),\n+        self.assertRegexpMatches(str(context_manager.exception),\n                 r'Translation blocks must not include other block tags: blocktrans \\(file templates[/\\\\]template_with_error\\.html, line 3\\)'\n             )\n-        finally:\n-            os.remove('./templates/template_with_error.html')\n-            os.remove('./templates/template_with_error.html.py') # Waiting for #8536 to be fixed\n+        os.remove('./templates/template_with_error.html')\n+        # Check that the temporary file was cleaned up\n+        self.assertFalse(os.path.exists('./templates/template_with_error.html.py'))\n \n     def test_template_message_context_extractor(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 15,
        "additions": 7,
        "deletions": 8
    }
}