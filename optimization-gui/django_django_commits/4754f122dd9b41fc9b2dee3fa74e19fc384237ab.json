{
    "author": "tswicegood",
    "message": "Moved the admin inline JS to new JS files for cleanliness.",
    "sha": "4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
    "files": [
        {
            "sha": "0a3699d5163cfbb6282843befe208c51283b094a",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -506,6 +506,7 @@ answer newbie questions, and generally made Django that much better:\n     Johan C. Stöver <johan@nilling.nl>\n     Nowell Strite <http://nowell.strite.org/>\n     Thomas Stromberg <tstromberg@google.com>\n+    Travis Swicegood <travis@domain51.com>\n     Pascal Varet\n     SuperJared\n     Radek Švarz <http://www.svarz.cz/translate/>"
        },
        {
            "sha": "67b59cc31c7834bf240a5e52535bd0405292fd03",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -1456,8 +1456,10 @@ def has_delete_permission(self, request, obj=None):\n         return request.user.has_perm(\n             self.opts.app_label + '.' + self.opts.get_delete_permission())\n \n+\n class StackedInline(InlineModelAdmin):\n     template = 'admin/edit_inline/stacked.html'\n \n+\n class TabularInline(InlineModelAdmin):\n     template = 'admin/edit_inline/tabular.html'"
        },
        {
            "sha": "4dc9459ff3661ab4792fa8255e63b194af832645",
            "filename": "django/contrib/admin/static/admin/js/inlines.js",
            "status": "modified",
            "additions": 254,
            "deletions": 118,
            "changes": 372,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.js",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.js?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -9,128 +9,264 @@\n  * All rights reserved.\n  *\n  * Spiced up with Code from Zain Memon's GSoC project 2009\n- * and modified for Django by Jannis Leidel\n+ * and modified for Django by Jannis Leidel, Travis Swicegood and Julien Phalip.\n  *\n  * Licensed under the New BSD License\n  * See: http://www.opensource.org/licenses/bsd-license.php\n  */\n (function($) {\n-\t$.fn.formset = function(opts) {\n-\t\tvar options = $.extend({}, $.fn.formset.defaults, opts);\n-\t\tvar updateElementIndex = function(el, prefix, ndx) {\n-\t\t\tvar id_regex = new RegExp(\"(\" + prefix + \"-(\\\\d+|__prefix__))\");\n-\t\t\tvar replacement = prefix + \"-\" + ndx;\n-\t\t\tif ($(el).attr(\"for\")) {\n-\t\t\t\t$(el).attr(\"for\", $(el).attr(\"for\").replace(id_regex, replacement));\n-\t\t\t}\n-\t\t\tif (el.id) {\n-\t\t\t\tel.id = el.id.replace(id_regex, replacement);\n-\t\t\t}\n-\t\t\tif (el.name) {\n-\t\t\t\tel.name = el.name.replace(id_regex, replacement);\n-\t\t\t}\n-\t\t};\n-\t\tvar totalForms = $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\").attr(\"autocomplete\", \"off\");\n-\t\tvar nextIndex = parseInt(totalForms.val(), 10);\n-\t\tvar maxForms = $(\"#id_\" + options.prefix + \"-MAX_NUM_FORMS\").attr(\"autocomplete\", \"off\");\n-\t\t// only show the add button if we are allowed to add more items,\n+  $.fn.formset = function(opts) {\n+    var options = $.extend({}, $.fn.formset.defaults, opts);\n+    var $this = $(this);\n+    var $parent = $this.parent();\n+    var updateElementIndex = function(el, prefix, ndx) {\n+      var id_regex = new RegExp(\"(\" + prefix + \"-(\\\\d+|__prefix__))\");\n+      var replacement = prefix + \"-\" + ndx;\n+      if ($(el).attr(\"for\")) {\n+        $(el).attr(\"for\", $(el).attr(\"for\").replace(id_regex, replacement));\n+      }\n+      if (el.id) {\n+        el.id = el.id.replace(id_regex, replacement);\n+      }\n+      if (el.name) {\n+        el.name = el.name.replace(id_regex, replacement);\n+      }\n+    };\n+    var totalForms = $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\").attr(\"autocomplete\", \"off\");\n+    var nextIndex = parseInt(totalForms.val(), 10);\n+    var maxForms = $(\"#id_\" + options.prefix + \"-MAX_NUM_FORMS\").attr(\"autocomplete\", \"off\");\n+    // only show the add button if we are allowed to add more items,\n         // note that max_num = None translates to a blank string.\n-\t\tvar showAddButton = maxForms.val() === '' || (maxForms.val()-totalForms.val()) > 0;\n-\t\t$(this).each(function(i) {\n-\t\t\t$(this).not(\".\" + options.emptyCssClass).addClass(options.formCssClass);\n-\t\t});\n-\t\tif ($(this).length && showAddButton) {\n-\t\t\tvar addButton;\n-\t\t\tif ($(this).attr(\"tagName\") == \"TR\") {\n-\t\t\t\t// If forms are laid out as table rows, insert the\n-\t\t\t\t// \"add\" button in a new table row:\n-\t\t\t\tvar numCols = this.eq(-1).children().length;\n-\t\t\t\t$(this).parent().append('<tr class=\"' + options.addCssClass + '\"><td colspan=\"' + numCols + '\"><a href=\"javascript:void(0)\">' + options.addText + \"</a></tr>\");\n-\t\t\t\taddButton = $(this).parent().find(\"tr:last a\");\n-\t\t\t} else {\n-\t\t\t\t// Otherwise, insert it immediately after the last form:\n-\t\t\t\t$(this).filter(\":last\").after('<div class=\"' + options.addCssClass + '\"><a href=\"javascript:void(0)\">' + options.addText + \"</a></div>\");\n-\t\t\t\taddButton = $(this).filter(\":last\").next().find(\"a\");\n-\t\t\t}\n-\t\t\taddButton.click(function(e) {\n-\t\t\t\te.preventDefault();\n-\t\t\t\tvar totalForms = $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\");\n-\t\t\t\tvar template = $(\"#\" + options.prefix + \"-empty\");\n-\t\t\t\tvar row = template.clone(true);\n-\t\t\t\trow.removeClass(options.emptyCssClass)\n-\t\t\t\t\t.addClass(options.formCssClass)\n-\t\t\t\t\t.attr(\"id\", options.prefix + \"-\" + nextIndex);\n-\t\t\t\tif (row.is(\"tr\")) {\n-\t\t\t\t\t// If the forms are laid out in table rows, insert\n-\t\t\t\t\t// the remove button into the last table cell:\n-\t\t\t\t\trow.children(\":last\").append('<div><a class=\"' + options.deleteCssClass +'\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></div>\");\n-\t\t\t\t} else if (row.is(\"ul\") || row.is(\"ol\")) {\n-\t\t\t\t\t// If they're laid out as an ordered/unordered list,\n-\t\t\t\t\t// insert an <li> after the last list item:\n-\t\t\t\t\trow.append('<li><a class=\"' + options.deleteCssClass +'\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></li>\");\n-\t\t\t\t} else {\n-\t\t\t\t\t// Otherwise, just insert the remove button as the\n-\t\t\t\t\t// last child element of the form's container:\n-\t\t\t\t\trow.children(\":first\").append('<span><a class=\"' + options.deleteCssClass + '\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></span>\");\n-\t\t\t\t}\n-\t\t\t\trow.find(\"*\").each(function() {\n-\t\t\t\t\tupdateElementIndex(this, options.prefix, totalForms.val());\n-\t\t\t\t});\n-\t\t\t\t// Insert the new form when it has been fully edited\n-\t\t\t\trow.insertBefore($(template));\n-\t\t\t\t// Update number of total forms\n-\t\t\t\t$(totalForms).val(parseInt(totalForms.val(), 10) + 1);\n-\t\t\t\tnextIndex += 1;\n-\t\t\t\t// Hide add button in case we've hit the max, except we want to add infinitely\n-\t\t\t\tif ((maxForms.val() !== '') && (maxForms.val()-totalForms.val()) <= 0) {\n-\t\t\t\t\taddButton.parent().hide();\n-\t\t\t\t}\n-\t\t\t\t// The delete button of each row triggers a bunch of other things\n-\t\t\t\trow.find(\"a.\" + options.deleteCssClass).click(function(e) {\n-\t\t\t\t\te.preventDefault();\n-\t\t\t\t\t// Remove the parent form containing this button:\n-\t\t\t\t\tvar row = $(this).parents(\".\" + options.formCssClass);\n-\t\t\t\t\trow.remove();\n-\t\t\t\t\tnextIndex -= 1;\n-\t\t\t\t\t// If a post-delete callback was provided, call it with the deleted form:\n-\t\t\t\t\tif (options.removed) {\n-\t\t\t\t\t\toptions.removed(row);\n-\t\t\t\t\t}\n-\t\t\t\t\t// Update the TOTAL_FORMS form count.\n-\t\t\t\t\tvar forms = $(\".\" + options.formCssClass);\n-\t\t\t\t\t$(\"#id_\" + options.prefix + \"-TOTAL_FORMS\").val(forms.length);\n-\t\t\t\t\t// Show add button again once we drop below max\n-\t\t\t\t\tif ((maxForms.val() === '') || (maxForms.val()-forms.length) > 0) {\n-\t\t\t\t\t\taddButton.parent().show();\n-\t\t\t\t\t}\n-\t\t\t\t\t// Also, update names and ids for all remaining form controls\n-\t\t\t\t\t// so they remain in sequence:\n-\t\t\t\t\tfor (var i=0, formCount=forms.length; i<formCount; i++)\n-\t\t\t\t\t{\n-\t\t\t\t\t\tupdateElementIndex($(forms).get(i), options.prefix, i);\n-\t\t\t\t\t\t$(forms.get(i)).find(\"*\").each(function() {\n-\t\t\t\t\t\t\tupdateElementIndex(this, options.prefix, i);\n-\t\t\t\t\t\t});\n-\t\t\t\t\t}\n-\t\t\t\t});\n-\t\t\t\t// If a post-add callback was supplied, call it with the added form:\n-\t\t\t\tif (options.added) {\n-\t\t\t\t\toptions.added(row);\n-\t\t\t\t}\n-\t\t\t});\n-\t\t}\n-\t\treturn this;\n-\t};\n-\t/* Setup plugin defaults */\n-\t$.fn.formset.defaults = {\n-\t\tprefix: \"form\",\t\t\t\t\t// The form prefix for your django formset\n-\t\taddText: \"add another\",\t\t\t// Text for the add link\n-\t\tdeleteText: \"remove\",\t\t\t// Text for the delete link\n-\t\taddCssClass: \"add-row\",\t\t\t// CSS class applied to the add link\n-\t\tdeleteCssClass: \"delete-row\",\t// CSS class applied to the delete link\n-\t\temptyCssClass: \"empty-row\",\t\t// CSS class applied to the empty row\n-\t\tformCssClass: \"dynamic-form\",\t// CSS class applied to each form in a formset\n-\t\tadded: null,\t\t\t\t\t// Function called each time a new form is added\n-\t\tremoved: null\t\t\t\t\t// Function called each time a form is deleted\n-\t};\n+    var showAddButton = maxForms.val() === '' || (maxForms.val()-totalForms.val()) > 0;\n+    $this.each(function(i) {\n+      $(this).not(\".\" + options.emptyCssClass).addClass(options.formCssClass);\n+    });\n+    if ($this.length && showAddButton) {\n+      var addButton;\n+      if ($this.attr(\"tagName\") == \"TR\") {\n+        // If forms are laid out as table rows, insert the\n+        // \"add\" button in a new table row:\n+        var numCols = this.eq(-1).children().length;\n+        $parent.append('<tr class=\"' + options.addCssClass + '\"><td colspan=\"' + numCols + '\"><a href=\"javascript:void(0)\">' + options.addText + \"</a></tr>\");\n+        addButton = $parent.find(\"tr:last a\");\n+      } else {\n+        // Otherwise, insert it immediately after the last form:\n+        $this.filter(\":last\").after('<div class=\"' + options.addCssClass + '\"><a href=\"javascript:void(0)\">' + options.addText + \"</a></div>\");\n+        addButton = $this.filter(\":last\").next().find(\"a\");\n+      }\n+      addButton.click(function(e) {\n+        e.preventDefault();\n+        var totalForms = $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\");\n+        var template = $(\"#\" + options.prefix + \"-empty\");\n+        var row = template.clone(true);\n+        row.removeClass(options.emptyCssClass)\n+          .addClass(options.formCssClass)\n+          .attr(\"id\", options.prefix + \"-\" + nextIndex);\n+        if (row.is(\"tr\")) {\n+          // If the forms are laid out in table rows, insert\n+          // the remove button into the last table cell:\n+          row.children(\":last\").append('<div><a class=\"' + options.deleteCssClass +'\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></div>\");\n+        } else if (row.is(\"ul\") || row.is(\"ol\")) {\n+          // If they're laid out as an ordered/unordered list,\n+          // insert an <li> after the last list item:\n+          row.append('<li><a class=\"' + options.deleteCssClass +'\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></li>\");\n+        } else {\n+          // Otherwise, just insert the remove button as the\n+          // last child element of the form's container:\n+          row.children(\":first\").append('<span><a class=\"' + options.deleteCssClass + '\" href=\"javascript:void(0)\">' + options.deleteText + \"</a></span>\");\n+        }\n+        row.find(\"*\").each(function() {\n+          updateElementIndex(this, options.prefix, totalForms.val());\n+        });\n+        // Insert the new form when it has been fully edited\n+        row.insertBefore($(template));\n+        // Update number of total forms\n+        $(totalForms).val(parseInt(totalForms.val(), 10) + 1);\n+        nextIndex += 1;\n+        // Hide add button in case we've hit the max, except we want to add infinitely\n+        if ((maxForms.val() !== '') && (maxForms.val()-totalForms.val()) <= 0) {\n+          addButton.parent().hide();\n+        }\n+        // The delete button of each row triggers a bunch of other things\n+        row.find(\"a.\" + options.deleteCssClass).click(function(e) {\n+          e.preventDefault();\n+          // Remove the parent form containing this button:\n+          var row = $(this).parents(\".\" + options.formCssClass);\n+          row.remove();\n+          nextIndex -= 1;\n+          // If a post-delete callback was provided, call it with the deleted form:\n+          if (options.removed) {\n+            options.removed(row);\n+          }\n+          // Update the TOTAL_FORMS form count.\n+          var forms = $(\".\" + options.formCssClass);\n+          $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\").val(forms.length);\n+          // Show add button again once we drop below max\n+          if ((maxForms.val() === '') || (maxForms.val()-forms.length) > 0) {\n+            addButton.parent().show();\n+          }\n+          // Also, update names and ids for all remaining form controls\n+          // so they remain in sequence:\n+          for (var i=0, formCount=forms.length; i<formCount; i++)\n+          {\n+            updateElementIndex($(forms).get(i), options.prefix, i);\n+            $(forms.get(i)).find(\"*\").each(function() {\n+              updateElementIndex(this, options.prefix, i);\n+            });\n+          }\n+        });\n+        // If a post-add callback was supplied, call it with the added form:\n+        if (options.added) {\n+          options.added(row);\n+        }\n+      });\n+    }\n+    return this;\n+  };\n+\n+  /* Setup plugin defaults */\n+  $.fn.formset.defaults = {\n+    prefix: \"form\",          // The form prefix for your django formset\n+    addText: \"add another\",      // Text for the add link\n+    deleteText: \"remove\",      // Text for the delete link\n+    addCssClass: \"add-row\",      // CSS class applied to the add link\n+    deleteCssClass: \"delete-row\",  // CSS class applied to the delete link\n+    emptyCssClass: \"empty-row\",    // CSS class applied to the empty row\n+    formCssClass: \"dynamic-form\",  // CSS class applied to each form in a formset\n+    added: null,          // Function called each time a new form is added\n+    removed: null          // Function called each time a form is deleted\n+  };\n+\n+\n+  // Tabular inlines ---------------------------------------------------------\n+  $.fn.tabularFormset = function(options) {\n+    var $rows = $(this);\n+    var alternatingRows = function(row) {\n+      $($rows.selector).not(\".add-row\").removeClass(\"row1 row2\")\n+        .filter(\":even\").addClass(\"row1\").end()\n+        .filter(\":odd\").addClass(\"row2\");\n+    };\n+\n+    var reinitDateTimeShortCuts = function() {\n+      // Reinitialize the calendar and clock widgets by force\n+      if (typeof DateTimeShortcuts != \"undefined\") {\n+        $(\".datetimeshortcuts\").remove();\n+        DateTimeShortcuts.init();\n+      }\n+    };\n+\n+    var updateSelectFilter = function() {\n+      // If any SelectFilter widgets are a part of the new form,\n+      // instantiate a new SelectFilter instance for it.\n+      if (typeof SelectFilter != 'undefined'){\n+        $('.selectfilter').each(function(index, value){\n+          var namearr = value.name.split('-');\n+          SelectFilter.init(value.id, namearr[namearr.length-1], false, options.adminStaticPrefix );\n+        });\n+        $('.selectfilterstacked').each(function(index, value){\n+          var namearr = value.name.split('-');\n+          SelectFilter.init(value.id, namearr[namearr.length-1], true, options.adminStaticPrefix );\n+        });\n+      }\n+    };\n+\n+    var initPrepopulatedFields = function(row) {\n+      row.find('.prepopulated_field').each(function() {\n+        var field = $(this),\n+            input = field.find('input, select, textarea'),\n+            dependency_list = input.data('dependency_list') || [],\n+            dependencies = [];\n+        $.each(dependency_list, function(i, field_name) {\n+          dependencies.push('#' + row.find('.field-' + field_name).find('input, select, textarea').attr('id'));\n+        });\n+        if (dependencies.length) {\n+          input.prepopulate(dependencies, input.attr('maxlength'));\n+        }\n+      });\n+    };\n+\n+    $rows.formset({\n+      prefix: options.prefix,\n+      addText: options.addText,\n+      formCssClass: \"dynamic-\" + options.prefix,\n+      deleteCssClass: \"inline-deletelink\",\n+      deleteText: options.deleteText,\n+      emptyCssClass: \"empty-form\",\n+      removed: alternatingRows,\n+      added: function(row) {\n+        initPrepopulatedFields(row);\n+        reinitDateTimeShortCuts();\n+        updateSelectFilter();\n+        alternatingRows(row);\n+      }\n+    });\n+\n+    return $rows;\n+  };\n+\n+  // Stacked inlines ---------------------------------------------------------\n+  $.fn.stackedFormset = function(options) {\n+    var $rows = $(this);\n+    var updateInlineLabel = function(row) {\n+      $($rows.selector).find(\".inline_label\").each(function(i) {\n+        var count = i + 1;\n+        $(this).html($(this).html().replace(/(#\\d+)/g, \"#\" + count));\n+      });\n+    };\n+\n+    var reinitDateTimeShortCuts = function() {\n+      // Reinitialize the calendar and clock widgets by force, yuck.\n+      if (typeof DateTimeShortcuts != \"undefined\") {\n+        $(\".datetimeshortcuts\").remove();\n+        DateTimeShortcuts.init();\n+      }\n+    };\n+\n+    var updateSelectFilter = function() {\n+      // If any SelectFilter widgets were added, instantiate a new instance.\n+      if (typeof SelectFilter != \"undefined\"){\n+        $(\".selectfilter\").each(function(index, value){\n+          var namearr = value.name.split('-');\n+          SelectFilter.init(value.id, namearr[namearr.length-1], false, options.adminStaticPrefix);\n+        });\n+        $(\".selectfilterstacked\").each(function(index, value){\n+          var namearr = value.name.split('-');\n+          SelectFilter.init(value.id, namearr[namearr.length-1], true, options.adminStaticPrefix);\n+        });\n+      }\n+    };\n+\n+    var initPrepopulatedFields = function(row) {\n+      row.find('.prepopulated_field').each(function() {\n+        var field = $(this),\n+            input = field.find('input, select, textarea'),\n+            dependency_list = input.data('dependency_list') || [],\n+            dependencies = [];\n+        $.each(dependency_list, function(i, field_name) {\n+          dependencies.push('#' + row.find('.form-row .field-' + field_name).find('input, select, textarea').attr('id'));\n+        });\n+        if (dependencies.length) {\n+          input.prepopulate(dependencies, input.attr('maxlength'));\n+        }\n+      });\n+    };\n+\n+    $rows.formset({\n+      prefix: options.prefix,\n+      addText: options.addText,\n+      formCssClass: \"dynamic-\" + options.prefix,\n+      deleteCssClass: \"inline-deletelink\",\n+      deleteText: options.deleteText,\n+      emptyCssClass: \"empty-form\",\n+      removed: updateInlineLabel,\n+      added: (function(row) {\n+        initPrepopulatedFields(row);\n+        reinitDateTimeShortCuts();\n+        updateSelectFilter();\n+        updateInlineLabel(row);\n+      })\n+    });\n+\n+    return $rows;\n+  };\n })(django.jQuery);"
        },
        {
            "sha": "d48ee0a0984a0f68863cb3129175f9330c0c8f4d",
            "filename": "django/contrib/admin/static/admin/js/inlines.min.js",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.min.js",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.min.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.min.js?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -1,5 +1,9 @@\n-(function(b){b.fn.formset=function(g){var a=b.extend({},b.fn.formset.defaults,g),k=function(c,f,e){var d=RegExp(\"(\"+f+\"-(\\\\d+|__prefix__))\");f=f+\"-\"+e;b(c).attr(\"for\")&&b(c).attr(\"for\",b(c).attr(\"for\").replace(d,f));if(c.id)c.id=c.id.replace(d,f);if(c.name)c.name=c.name.replace(d,f)};g=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").attr(\"autocomplete\",\"off\");var l=parseInt(g.val(),10),h=b(\"#id_\"+a.prefix+\"-MAX_NUM_FORMS\").attr(\"autocomplete\",\"off\");g=h.val()===\"\"||h.val()-g.val()>0;b(this).each(function(){b(this).not(\".\"+\n-a.emptyCssClass).addClass(a.formCssClass)});if(b(this).length&&g){var j;if(b(this).attr(\"tagName\")==\"TR\"){g=this.eq(-1).children().length;b(this).parent().append('<tr class=\"'+a.addCssClass+'\"><td colspan=\"'+g+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></tr>\");j=b(this).parent().find(\"tr:last a\")}else{b(this).filter(\":last\").after('<div class=\"'+a.addCssClass+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></div>\");j=b(this).filter(\":last\").next().find(\"a\")}j.click(function(c){c.preventDefault();\n-var f=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\");c=b(\"#\"+a.prefix+\"-empty\");var e=c.clone(true);e.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr(\"id\",a.prefix+\"-\"+l);if(e.is(\"tr\"))e.children(\":last\").append('<div><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></div>\");else e.is(\"ul\")||e.is(\"ol\")?e.append('<li><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></li>\"):e.children(\":first\").append('<span><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+\n-a.deleteText+\"</a></span>\");e.find(\"*\").each(function(){k(this,a.prefix,f.val())});e.insertBefore(b(c));b(f).val(parseInt(f.val(),10)+1);l+=1;h.val()!==\"\"&&h.val()-f.val()<=0&&j.parent().hide();e.find(\"a.\"+a.deleteCssClass).click(function(d){d.preventDefault();d=b(this).parents(\".\"+a.formCssClass);d.remove();l-=1;a.removed&&a.removed(d);d=b(\".\"+a.formCssClass);b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").val(d.length);if(h.val()===\"\"||h.val()-d.length>0)j.parent().show();for(var i=0,m=d.length;i<m;i++){k(b(d).get(i),\n-a.prefix,i);b(d.get(i)).find(\"*\").each(function(){k(this,a.prefix,i)})}});a.added&&a.added(e)})}return this};b.fn.formset.defaults={prefix:\"form\",addText:\"add another\",deleteText:\"remove\",addCssClass:\"add-row\",deleteCssClass:\"delete-row\",emptyCssClass:\"empty-row\",formCssClass:\"dynamic-form\",added:null,removed:null}})(django.jQuery);\n+(function(b){b.fn.formset=function(d){var a=b.extend({},b.fn.formset.defaults,d),c=b(this),d=c.parent(),i=function(a,e,g){var d=RegExp(\"(\"+e+\"-(\\\\d+|__prefix__))\"),e=e+\"-\"+g;b(a).attr(\"for\")&&b(a).attr(\"for\",b(a).attr(\"for\").replace(d,e));a.id&&(a.id=a.id.replace(d,e));a.name&&(a.name=a.name.replace(d,e))},f=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").attr(\"autocomplete\",\"off\"),g=parseInt(f.val(),10),e=b(\"#id_\"+a.prefix+\"-MAX_NUM_FORMS\").attr(\"autocomplete\",\"off\"),f=\"\"===e.val()||0<e.val()-f.val();c.each(function(){b(this).not(\".\"+\n+a.emptyCssClass).addClass(a.formCssClass)});if(c.length&&f){var h;\"TR\"==c.attr(\"tagName\")?(c=this.eq(-1).children().length,d.append('<tr class=\"'+a.addCssClass+'\"><td colspan=\"'+c+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></tr>\"),h=d.find(\"tr:last a\")):(c.filter(\":last\").after('<div class=\"'+a.addCssClass+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></div>\"),h=c.filter(\":last\").next().find(\"a\"));h.click(function(d){d.preventDefault();var f=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\"),d=b(\"#\"+a.prefix+\n+\"-empty\"),c=d.clone(true);c.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr(\"id\",a.prefix+\"-\"+g);c.is(\"tr\")?c.children(\":last\").append('<div><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></div>\"):c.is(\"ul\")||c.is(\"ol\")?c.append('<li><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></li>\"):c.children(\":first\").append('<span><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></span>\");c.find(\"*\").each(function(){i(this,\n+a.prefix,f.val())});c.insertBefore(b(d));b(f).val(parseInt(f.val(),10)+1);g=g+1;e.val()!==\"\"&&e.val()-f.val()<=0&&h.parent().hide();c.find(\"a.\"+a.deleteCssClass).click(function(d){d.preventDefault();d=b(this).parents(\".\"+a.formCssClass);d.remove();g=g-1;a.removed&&a.removed(d);d=b(\".\"+a.formCssClass);b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").val(d.length);(e.val()===\"\"||e.val()-d.length>0)&&h.parent().show();for(var c=0,f=d.length;c<f;c++){i(b(d).get(c),a.prefix,c);b(d.get(c)).find(\"*\").each(function(){i(this,\n+a.prefix,c)})}});a.added&&a.added(c)})}return this};b.fn.formset.defaults={prefix:\"form\",addText:\"add another\",deleteText:\"remove\",addCssClass:\"add-row\",deleteCssClass:\"delete-row\",emptyCssClass:\"empty-row\",formCssClass:\"dynamic-form\",added:null,removed:null};b.fn.tabularFormset=function(d){var a=b(this),c=function(){b(a.selector).not(\".add-row\").removeClass(\"row1 row2\").filter(\":even\").addClass(\"row1\").end().filter(\":odd\").addClass(\"row2\")};a.formset({prefix:d.prefix,addText:d.addText,formCssClass:\"dynamic-\"+\n+d.prefix,deleteCssClass:\"inline-deletelink\",deleteText:d.deleteText,emptyCssClass:\"empty-form\",removed:c,added:function(a){a.find(\".prepopulated_field\").each(function(){var d=b(this).find(\"input, select, textarea\"),c=d.data(\"dependency_list\")||[],e=[];b.each(c,function(d,b){e.push(\"#\"+a.find(\".field-\"+b).find(\"input, select, textarea\").attr(\"id\"))});e.length&&d.prepopulate(e,d.attr(\"maxlength\"))});\"undefined\"!=typeof DateTimeShortcuts&&(b(\".datetimeshortcuts\").remove(),DateTimeShortcuts.init());\"undefined\"!=\n+typeof SelectFilter&&(b(\".selectfilter\").each(function(a,b){var c=b.name.split(\"-\");SelectFilter.init(b.id,c[c.length-1],false,d.adminStaticPrefix)}),b(\".selectfilterstacked\").each(function(a,b){var c=b.name.split(\"-\");SelectFilter.init(b.id,c[c.length-1],true,d.adminStaticPrefix)}));c(a)}});return a};b.fn.stackedFormset=function(d){var a=b(this),c=function(){b(a.selector).find(\".inline_label\").each(function(a){a+=1;b(this).html(b(this).html().replace(/(#\\d+)/g,\"#\"+a))})};a.formset({prefix:d.prefix,\n+addText:d.addText,formCssClass:\"dynamic-\"+d.prefix,deleteCssClass:\"inline-deletelink\",deleteText:d.deleteText,emptyCssClass:\"empty-form\",removed:c,added:function(a){a.find(\".prepopulated_field\").each(function(){var d=b(this).find(\"input, select, textarea\"),c=d.data(\"dependency_list\")||[],e=[];b.each(c,function(d,b){e.push(\"#\"+a.find(\".form-row .field-\"+b).find(\"input, select, textarea\").attr(\"id\"))});e.length&&d.prepopulate(e,d.attr(\"maxlength\"))});\"undefined\"!=typeof DateTimeShortcuts&&(b(\".datetimeshortcuts\").remove(),\n+DateTimeShortcuts.init());\"undefined\"!=typeof SelectFilter&&(b(\".selectfilter\").each(function(a,b){var c=b.name.split(\"-\");SelectFilter.init(b.id,c[c.length-1],false,d.adminStaticPrefix)}),b(\".selectfilterstacked\").each(function(a,b){var c=b.name.split(\"-\");SelectFilter.init(b.id,c[c.length-1],true,d.adminStaticPrefix)}));c(a)}});return a}})(django.jQuery);"
        },
        {
            "sha": "2025dd8083b3e058401e8dfc703fc7170296d225",
            "filename": "django/contrib/admin/templates/admin/edit_inline/stacked.html",
            "status": "modified",
            "additions": 6,
            "deletions": 58,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -20,63 +20,11 @@ <h3><b>{{ inline_admin_formset.opts.verbose_name|title }}:</b>&nbsp;<span class=\n \n <script type=\"text/javascript\">\n (function($) {\n-    $(document).ready(function() {\n-        var rows = \"#{{ inline_admin_formset.formset.prefix }}-group .inline-related\";\n-        var updateInlineLabel = function(row) {\n-            $(rows).find(\".inline_label\").each(function(i) {\n-                var count = i + 1;\n-                $(this).html($(this).html().replace(/(#\\d+)/g, \"#\" + count));\n-            });\n-        };\n-        var reinitDateTimeShortCuts = function() {\n-            // Reinitialize the calendar and clock widgets by force, yuck.\n-            if (typeof DateTimeShortcuts != \"undefined\") {\n-                $(\".datetimeshortcuts\").remove();\n-                DateTimeShortcuts.init();\n-            }\n-        };\n-        var updateSelectFilter = function() {\n-            // If any SelectFilter widgets were added, instantiate a new instance.\n-            if (typeof SelectFilter != \"undefined\"){\n-                $(\".selectfilter\").each(function(index, value){\n-                  var namearr = value.name.split('-');\n-                  SelectFilter.init(value.id, namearr[namearr.length-1], false, \"{% static \"admin/\" %}\");\n-                });\n-                $(\".selectfilterstacked\").each(function(index, value){\n-                  var namearr = value.name.split('-');\n-                  SelectFilter.init(value.id, namearr[namearr.length-1], true, \"{% static \"admin/\" %}\");\n-                });\n-            }\n-        };\n-        var initPrepopulatedFields = function(row) {\n-            row.find('.prepopulated_field').each(function() {\n-                var field = $(this);\n-                var input = field.find('input, select, textarea');\n-                var dependency_list = input.data('dependency_list') || [];\n-                var dependencies = [];\n-                $.each(dependency_list, function(i, field_name) {\n-                  dependencies.push('#' + row.find('.form-row .field-' + field_name).find('input, select, textarea').attr('id'));\n-                });\n-                if (dependencies.length) {\n-                    input.prepopulate(dependencies, input.attr('maxlength'));\n-                }\n-            });\n-        };\n-        $(rows).formset({\n-            prefix: \"{{ inline_admin_formset.formset.prefix }}\",\n-            addText: \"{% blocktrans with verbose_name=inline_admin_formset.opts.verbose_name|title %}Add another {{ verbose_name }}{% endblocktrans %}\",\n-            formCssClass: \"dynamic-{{ inline_admin_formset.formset.prefix }}\",\n-            deleteCssClass: \"inline-deletelink\",\n-            deleteText: \"{% trans \"Remove\" %}\",\n-            emptyCssClass: \"empty-form\",\n-            removed: updateInlineLabel,\n-            added: (function(row) {\n-                initPrepopulatedFields(row);\n-                reinitDateTimeShortCuts();\n-                updateSelectFilter();\n-                updateInlineLabel(row);\n-            })\n-        });\n-    });\n+  $(\"#{{ inline_admin_formset.formset.prefix }}-group .inline-related\").stackedFormset({\n+    prefix: '{{ inline_admin_formset.formset.prefix }}',\n+    adminStaticPrefix: '{% static \"admin/\" %}',\n+    deleteText: \"{% trans \"Remove\" %}\",\n+    addText: \"{% blocktrans with verbose_name=inline_admin_formset.opts.verbose_name|title %}Add another {{ verbose_name }}{% endblocktrans %}\"\n+  });\n })(django.jQuery);\n </script>"
        },
        {
            "sha": "f2757ede4882051f20e5a50633f04636d94972e3",
            "filename": "django/contrib/admin/templates/admin/edit_inline/tabular.html",
            "status": "modified",
            "additions": 7,
            "deletions": 58,
            "changes": 65,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -67,64 +67,13 @@ <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}</h2>\n </div>\n \n <script type=\"text/javascript\">\n+\n (function($) {\n-    $(document).ready(function($) {\n-        var rows = \"#{{ inline_admin_formset.formset.prefix }}-group .tabular.inline-related tbody tr\";\n-        var alternatingRows = function(row) {\n-            $(rows).not(\".add-row\").removeClass(\"row1 row2\")\n-                .filter(\":even\").addClass(\"row1\").end()\n-                .filter(rows + \":odd\").addClass(\"row2\");\n-        }\n-        var reinitDateTimeShortCuts = function() {\n-            // Reinitialize the calendar and clock widgets by force\n-            if (typeof DateTimeShortcuts != \"undefined\") {\n-                $(\".datetimeshortcuts\").remove();\n-                DateTimeShortcuts.init();\n-            }\n-        }\n-        var updateSelectFilter = function() {\n-            // If any SelectFilter widgets are a part of the new form,\n-            // instantiate a new SelectFilter instance for it.\n-            if (typeof SelectFilter != \"undefined\"){\n-                $(\".selectfilter\").each(function(index, value){\n-                  var namearr = value.name.split('-');\n-                  SelectFilter.init(value.id, namearr[namearr.length-1], false, \"{% static \"admin/\" %}\");\n-                });\n-                $(\".selectfilterstacked\").each(function(index, value){\n-                  var namearr = value.name.split('-');\n-                  SelectFilter.init(value.id, namearr[namearr.length-1], true, \"{% static \"admin/\" %}\");\n-                });\n-            }\n-        }\n-        var initPrepopulatedFields = function(row) {\n-            row.find('.prepopulated_field').each(function() {\n-                var field = $(this);\n-                var input = field.find('input, select, textarea');\n-                var dependency_list = input.data('dependency_list') || [];\n-                var dependencies = [];\n-                $.each(dependency_list, function(i, field_name) {\n-                  dependencies.push('#' + row.find('.field-' + field_name).find('input, select, textarea').attr('id'));\n-                });\n-                if (dependencies.length) {\n-                    input.prepopulate(dependencies, input.attr('maxlength'));\n-                }\n-            });\n-        }\n-        $(rows).formset({\n-            prefix: \"{{ inline_admin_formset.formset.prefix }}\",\n-            addText: \"{% blocktrans with verbose_name=inline_admin_formset.opts.verbose_name|title %}Add another {{ verbose_name }}{% endblocktrans %}\",\n-            formCssClass: \"dynamic-{{ inline_admin_formset.formset.prefix }}\",\n-            deleteCssClass: \"inline-deletelink\",\n-            deleteText: \"{% trans \"Remove\" %}\",\n-            emptyCssClass: \"empty-form\",\n-            removed: alternatingRows,\n-            added: (function(row) {\n-                initPrepopulatedFields(row);\n-                reinitDateTimeShortCuts();\n-                updateSelectFilter();\n-                alternatingRows(row);\n-            })\n-        });\n-    });\n+  $(\"#{{ inline_admin_formset.formset.prefix }}-group .tabular.inline-related tbody tr\").tabularFormset({\n+    prefix: \"{{ inline_admin_formset.formset.prefix }}\",\n+    adminStaticPrefix: '{% static \"admin/\" %}',\n+    addText: \"{% blocktrans with inline_admin_formset.opts.verbose_name|title as verbose_name %}Add another {{ verbose_name }}{% endblocktrans %}\",\n+    deleteText: \"{% trans 'Remove' %}\"\n+  });\n })(django.jQuery);\n </script>"
        },
        {
            "sha": "57f45ab0ffae00221671764ce324f217bafa3d59",
            "filename": "tests/regressiontests/admin_inlines/tests.py",
            "status": "modified",
            "additions": 59,
            "deletions": 2,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4754f122dd9b41fc9b2dee3fa74e19fc384237ab/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_inlines%2Ftests.py?ref=4754f122dd9b41fc9b2dee3fa74e19fc384237ab",
            "patch": "@@ -8,10 +8,11 @@\n from django.test.utils import override_settings\n \n # local test models\n-from .admin import InnerInline\n+from .admin import InnerInline, TitleInline, site\n from .models import (Holder, Inner, Holder2, Inner2, Holder3, Inner3, Person,\n     OutfitItem, Fashionista, Teacher, Parent, Child, Author, Book, Profile,\n-    ProfileCollection, ParentModelWithCustomPk, ChildModel1, ChildModel2)\n+    ProfileCollection, ParentModelWithCustomPk, ChildModel1, ChildModel2,\n+    Title)\n \n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n@@ -408,6 +409,47 @@ class SeleniumFirefoxTests(AdminSeleniumWebDriverTestCase):\n     fixtures = ['admin-views-users.xml']\n     urls = \"regressiontests.admin_inlines.urls\"\n \n+    def test_add_stackeds(self):\n+        \"\"\"\n+        Ensure that the \"Add another XXX\" link correctly adds items to the\n+        stacked formset.\n+        \"\"\"\n+        self.admin_login(username='super', password='secret')\n+        self.selenium.get('%s%s' % (self.live_server_url,\n+            '/admin/admin_inlines/holder4/add/'))\n+\n+        inline_id = '#inner4stacked_set-group'\n+        rows_length = lambda: len(self.selenium.find_elements_by_css_selector(\n+            '%s .dynamic-inner4stacked_set' % inline_id))\n+        self.assertEqual(rows_length(), 3)\n+\n+        add_button = self.selenium.find_element_by_link_text(\n+            'Add another Inner4 Stacked')\n+        add_button.click()\n+\n+        self.assertEqual(rows_length(), 4)\n+\n+    def test_delete_stackeds(self):\n+        self.admin_login(username='super', password='secret')\n+        self.selenium.get('%s%s' % (self.live_server_url,\n+            '/admin/admin_inlines/holder4/add/'))\n+\n+        inline_id = '#inner4stacked_set-group'\n+        rows_length = lambda: len(self.selenium.find_elements_by_css_selector(\n+            '%s .dynamic-inner4stacked_set' % inline_id))\n+        self.assertEqual(rows_length(), 3)\n+\n+        add_button = self.selenium.find_element_by_link_text(\n+            'Add another Inner4 Stacked')\n+        add_button.click()\n+        add_button.click()\n+\n+        self.assertEqual(rows_length(), 5, msg=\"sanity check\")\n+        for delete_link in self.selenium.find_elements_by_css_selector(\n+                '%s .inline-deletelink' % inline_id):\n+            delete_link.click()\n+        self.assertEqual(rows_length(), 3)\n+\n     def test_add_inlines(self):\n         \"\"\"\n         Ensure that the \"Add another XXX\" link correctly adds items to the\n@@ -516,6 +558,21 @@ def test_delete_inlines(self):\n         self.assertEqual(len(self.selenium.find_elements_by_css_selector(\n             'form#profilecollection_form tr.dynamic-profile_set#profile_set-2')), 1)\n \n+    def test_alternating_rows(self):\n+        self.admin_login(username='super', password='secret')\n+        self.selenium.get('%s%s' % (self.live_server_url,\n+            '/admin/admin_inlines/profilecollection/add/'))\n+\n+        # Add a few inlines\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+        self.selenium.find_element_by_link_text('Add another Profile').click()\n+\n+        row_selector = 'form#profilecollection_form tr.dynamic-profile_set'\n+        self.assertEqual(len(self.selenium.find_elements_by_css_selector(\n+            \"%s.row1\" % row_selector)), 2, msg=\"Expect two row1 styled rows\")\n+        self.assertEqual(len(self.selenium.find_elements_by_css_selector(\n+            \"%s.row2\" % row_selector)), 1, msg=\"Expect one row2 styled row\")\n+\n \n class SeleniumChromeTests(SeleniumFirefoxTests):\n     webdriver_class = 'selenium.webdriver.chrome.webdriver.WebDriver'"
        }
    ],
    "stats": {
        "total": 579,
        "additions": 338,
        "deletions": 241
    }
}