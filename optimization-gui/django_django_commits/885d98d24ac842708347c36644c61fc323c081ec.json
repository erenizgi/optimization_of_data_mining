{
    "author": "aaugustin",
    "message": "Fixed #20028 -- Made atomic usable on callable instances.\n\nThanks Anssi for the report.",
    "sha": "885d98d24ac842708347c36644c61fc323c081ec",
    "files": [
        {
            "sha": "1ff1a8437e41f23d3bf9423de4af726502afac74",
            "filename": "django/db/transaction.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/885d98d24ac842708347c36644c61fc323c081ec/django%2Fdb%2Ftransaction.py",
            "raw_url": "https://github.com/django/django/raw/885d98d24ac842708347c36644c61fc323c081ec/django%2Fdb%2Ftransaction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Ftransaction.py?ref=885d98d24ac842708347c36644c61fc323c081ec",
            "patch": "@@ -17,6 +17,7 @@\n from functools import wraps\n \n from django.db import connections, DatabaseError, DEFAULT_DB_ALIAS\n+from django.utils.decorators import available_attrs\n \n \n class TransactionManagementError(Exception):\n@@ -313,7 +314,7 @@ def __exit__(self, exc_type, exc_value, traceback):\n \n \n     def __call__(self, func):\n-        @wraps(func)\n+        @wraps(func, assigned=available_attrs(func))\n         def inner(*args, **kwargs):\n             with self:\n                 return func(*args, **kwargs)"
        },
        {
            "sha": "e53a320481ba9c55ee9d5b2b75a7e02642006eca",
            "filename": "tests/transactions/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/885d98d24ac842708347c36644c61fc323c081ec/tests%2Ftransactions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/885d98d24ac842708347c36644c61fc323c081ec/tests%2Ftransactions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Ftransactions%2Ftests.py?ref=885d98d24ac842708347c36644c61fc323c081ec",
            "patch": "@@ -300,6 +300,17 @@ def test_atomic_prevents_calling_transaction_management_methods(self):\n                 transaction.leave_transaction_management()\n \n \n+class AtomicMiscTests(TransactionTestCase):\n+\n+    def test_wrap_callable_instance(self):\n+        # Regression test for #20028\n+        class Callable(object):\n+            def __call__(self):\n+                pass\n+        # Must not raise an exception\n+        transaction.atomic(Callable())\n+\n+\n class IgnorePendingDeprecationWarningsMixin(object):\n \n     def setUp(self):"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 13,
        "deletions": 1
    }
}