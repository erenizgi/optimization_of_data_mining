{
    "author": "alex",
    "message": "Fixed #5893 -- Added a flag to FilePathField to allow listing folders, in addition to regular files.  Thank you to Brian Rosner, for encouraging me to first contribute to Django 4 years ago.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17925 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
    "files": [
        {
            "sha": "272ac5be4196adb65ac67dffa52cc7d31c997068",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
            "patch": "@@ -89,6 +89,8 @@ def get_validation_errors(outfile, app=None):\n                         e.add(opts, '\"%s\": To use ImageFields, you need to install the Python Imaging Library. Get it at http://www.pythonware.com/products/pil/ .' % f.name)\n             if isinstance(f, models.BooleanField) and getattr(f, 'null', False):\n                 e.add(opts, '\"%s\": BooleanFields do not accept null values. Use a NullBooleanField instead.' % f.name)\n+            if isinstance(f, models.FilePathField) and not (f.allow_files or f.allow_folders):\n+                e.add(opts, '\"%s\": FilePathFields must have either allow_files or allow_folders set to True.' % f.name)\n             if f.choices:\n                 if isinstance(f.choices, basestring) or not is_iterable(f.choices):\n                     e.add(opts, '\"%s\": \"choices\" should be iterable (e.g., a tuple or list).' % f.name)"
        },
        {
            "sha": "e240d39cc49a045a99600aeaa8f3a1acf361491a",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
            "patch": "@@ -909,8 +909,9 @@ class FilePathField(Field):\n     description = _(\"File path\")\n \n     def __init__(self, verbose_name=None, name=None, path='', match=None,\n-                 recursive=False, **kwargs):\n+                 recursive=False, allow_files=True, allow_folders=False, **kwargs):\n         self.path, self.match, self.recursive = path, match, recursive\n+        self.allow_files, self.allow_folders =  allow_files, allow_folders\n         kwargs['max_length'] = kwargs.get('max_length', 100)\n         Field.__init__(self, verbose_name, name, **kwargs)\n \n@@ -920,6 +921,8 @@ def formfield(self, **kwargs):\n             'match': self.match,\n             'recursive': self.recursive,\n             'form_class': forms.FilePathField,\n+            'allow_files': self.allow_files,\n+            'allow_folders': self.allow_folders,\n         }\n         defaults.update(kwargs)\n         return super(FilePathField, self).formfield(**defaults)"
        },
        {
            "sha": "3cf730e152b5581dda6d3e713ac23664fbf1b5d4",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 17,
            "deletions": 8,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
            "patch": "@@ -909,10 +909,11 @@ def compress(self, data_list):\n         raise NotImplementedError('Subclasses must implement this method.')\n \n class FilePathField(ChoiceField):\n-    def __init__(self, path, match=None, recursive=False, required=True,\n-                 widget=None, label=None, initial=None, help_text=None,\n-                 *args, **kwargs):\n+    def __init__(self, path, match=None, recursive=False, allow_files=True,\n+                 allow_folders=False, required=True, widget=None, label=None,\n+                 initial=None, help_text=None, *args, **kwargs):\n         self.path, self.match, self.recursive = path, match, recursive\n+        self.allow_files, self.allow_folders = allow_files, allow_folders\n         super(FilePathField, self).__init__(choices=(), required=required,\n             widget=widget, label=label, initial=initial, help_text=help_text,\n             *args, **kwargs)\n@@ -927,15 +928,23 @@ def __init__(self, path, match=None, recursive=False, required=True,\n \n         if recursive:\n             for root, dirs, files in sorted(os.walk(self.path)):\n-                for f in files:\n-                    if self.match is None or self.match_re.search(f):\n-                        f = os.path.join(root, f)\n-                        self.choices.append((f, f.replace(path, \"\", 1)))\n+                if self.allow_files:\n+                    for f in files:\n+                        if self.match is None or self.match_re.search(f):\n+                            f = os.path.join(root, f)\n+                            self.choices.append((f, f.replace(path, \"\", 1)))\n+                if self.allow_folders:\n+                    for f in dirs:\n+                        if self.match is None or self.match_re.search(f):\n+                            f = os.path.join(root, f)\n+                            self.choices.append((f, f.replace(path, \"\", 1)))\n         else:\n             try:\n                 for f in sorted(os.listdir(self.path)):\n                     full_file = os.path.join(self.path, f)\n-                    if os.path.isfile(full_file) and (self.match is None or self.match_re.search(f)):\n+                    if (((self.allow_files and os.path.isfile(full_file)) or\n+                        (self.allow_folders and os.path.isdir(full_file))) and\n+                        (self.match is None or self.match_re.search(f))):\n                         self.choices.append((full_file, f))\n             except OSError:\n                 pass"
        },
        {
            "sha": "fa5800692f838617b362c10d5faf934a7f647b6a",
            "filename": "docs/ref/forms/fields.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/docs%2Fref%2Fforms%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/docs%2Fref%2Fforms%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Ffields.txt?ref=3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
            "patch": "@@ -555,6 +555,23 @@ For each field, we describe the default widget used if you don't specify\n         A regular expression pattern; only files with names matching this expression\n         will be allowed as choices.\n \n+    .. attribute:: allow_files\n+\n+        .. versionadded:: 1.5\n+\n+        Optional.  Either ``True`` or ``False``.  Default is ``True``.  Specifies\n+        whether files in the specified location should be included.  Either this or\n+        :attr:`allow_folders` must be ``True``.\n+\n+    .. attribute:: allow_folders\n+\n+        .. versionadded:: 1.5\n+\n+        Optional.  Either ``True`` or ``False``.  Default is ``False``.  Specifies\n+        whether folders in the specified location should be included.  Either this or\n+        :attr:`allow_files` must be ``True``.\n+\n+\n ``FloatField``\n ~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "d1f12ffc951836cee63d517fa19db657a562d086",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
            "patch": "@@ -691,6 +691,23 @@ directory on the filesystem. Has three special arguments, of which the first is\n     Optional. Either ``True`` or ``False``. Default is ``False``. Specifies\n     whether all subdirectories of :attr:`~FilePathField.path` should be included\n \n+.. attribute:: FilePathField.allow_files\n+\n+    .. versionadded:: 1.5\n+\n+    Optional.  Either ``True`` or ``False``.  Default is ``True``.  Specifies\n+    whether files in the specified location should be included.  Either this or\n+    :attr:`~FilePathField.allow_folders` must be ``True``.\n+\n+.. attribute:: FilePathField.allow_folders\n+\n+    .. versionadded:: 1.5\n+\n+    Optional.  Either ``True`` or ``False``.  Default is ``False``.  Specifies\n+    whether folders in the specified location should be included.  Either this\n+    or :attr:`~FilePathField.allow_files` must be ``True``.\n+\n+\n Of course, these arguments can be used together.\n \n The one potential gotcha is that :attr:`~FilePathField.match` applies to the"
        },
        {
            "sha": "4e942a1ca706002a1fe296ba9f02fec7022488fc",
            "filename": "tests/regressiontests/forms/tests/fields.py",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/3c5ff9d703be67b43655c5a40e8ee3719ad2871b/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py?ref=3c5ff9d703be67b43655c5a40e8ee3719ad2871b",
            "patch": "@@ -981,6 +981,42 @@ def test_filepathfield_4(self):\n             self.assertEqual(exp[1], got[1])\n             self.assertTrue(got[0].endswith(exp[0]))\n \n+    def test_filepathfield_folders(self):\n+        path = forms.__file__\n+        path = os.path.dirname(path) + '/'\n+        f = FilePathField(path=path, allow_folders=True, allow_files=False)\n+        f.choices.sort()\n+        expected = [\n+            ('/django/forms/extras', 'extras'),\n+        ]\n+        for exp, got in zip(expected, fix_os_paths(f.choices)):\n+            self.assertEqual(exp[1], got[1])\n+            self.assert_(got[0].endswith(exp[0]))\n+\n+        f = FilePathField(path=path, allow_folders=True, allow_files=True)\n+        f.choices.sort()\n+        expected = [\n+            ('/django/forms/__init__.py', '__init__.py'),\n+            ('/django/forms/__init__.pyc', '__init__.pyc'),\n+            ('/django/forms/extras', 'extras'),\n+            ('/django/forms/fields.py', 'fields.py'),\n+            ('/django/forms/fields.pyc', 'fields.pyc'),\n+            ('/django/forms/forms.py', 'forms.py'),\n+            ('/django/forms/forms.pyc', 'forms.pyc'),\n+            ('/django/forms/formsets.py', 'formsets.py'),\n+            ('/django/forms/formsets.pyc', 'formsets.pyc'),\n+            ('/django/forms/models.py', 'models.py'),\n+            ('/django/forms/models.pyc', 'models.pyc'),\n+            ('/django/forms/util.py', 'util.py'),\n+            ('/django/forms/util.pyc', 'util.pyc'),\n+            ('/django/forms/widgets.py', 'widgets.py'),\n+            ('/django/forms/widgets.pyc', 'widgets.pyc')\n+        ]\n+        for exp, got in zip(expected, fix_os_paths(f.choices)):\n+            self.assertEqual(exp[1], got[1])\n+            self.assertEqual(exp[1], got[1])\n+\n+\n     # SplitDateTimeField ##########################################################\n \n     def test_splitdatetimefield_1(self):"
        }
    ],
    "stats": {
        "total": 102,
        "additions": 93,
        "deletions": 9
    }
}