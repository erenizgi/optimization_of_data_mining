{
    "author": "alex",
    "message": "Fixed #14424 -- corrected a NameError when instantiating a RelatedFieldWidgetWrapper.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14683 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3498849532151f618ff36eea4bd315de6f500687",
    "files": [
        {
            "sha": "f06c5e421c6ab722430f69716fc5003a18106793",
            "filename": "django/contrib/admin/widgets.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3498849532151f618ff36eea4bd315de6f500687/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/3498849532151f618ff36eea4bd315de6f500687/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fwidgets.py?ref=3498849532151f618ff36eea4bd315de6f500687",
            "patch": "@@ -203,7 +203,7 @@ def __init__(self, widget, rel, admin_site, can_add_related=None):\n         # Backwards compatible check for whether a user can add related\n         # objects.\n         if can_add_related is None:\n-            can_add_related = rel_to in self.admin_site._registry\n+            can_add_related = rel.to in admin_site._registry\n         self.can_add_related = can_add_related\n         # so we can check if the related object is registered with this AdminSite\n         self.admin_site = admin_site"
        },
        {
            "sha": "c187584996fd27ff25985a78b657263b066b20da",
            "filename": "tests/regressiontests/admin_widgets/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/3498849532151f618ff36eea4bd315de6f500687/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/3498849532151f618ff36eea4bd315de6f500687/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Fmodels.py?ref=3498849532151f618ff36eea4bd315de6f500687",
            "patch": "@@ -1,8 +1,9 @@\n from django.db import models\n from django.contrib.auth.models import User\n \n-class MyFileField(models.FileField): \n-    pass \n+\n+class MyFileField(models.FileField):\n+    pass\n \n class Member(models.Model):\n     name = models.CharField(max_length=100)"
        },
        {
            "sha": "489013fea3dd4e4d40b61653ca85528dd60e7ffb",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/3498849532151f618ff36eea4bd315de6f500687/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3498849532151f618ff36eea4bd315de6f500687/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=3498849532151f618ff36eea4bd315de6f500687",
            "patch": "@@ -6,9 +6,9 @@\n from django.conf import settings\n from django.contrib import admin\n from django.contrib.admin import widgets\n-from django.contrib.admin.widgets import FilteredSelectMultiple, AdminSplitDateTime\n-from django.contrib.admin.widgets import (AdminFileWidget, ForeignKeyRawIdWidget,\n-    ManyToManyRawIdWidget)\n+from django.contrib.admin.widgets import (FilteredSelectMultiple,\n+    AdminSplitDateTime, AdminFileWidget, ForeignKeyRawIdWidget, AdminRadioSelect,\n+    RelatedFieldWidgetWrapper, ManyToManyRawIdWidget)\n from django.core.files.storage import default_storage\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.db.models import DateField\n@@ -31,7 +31,8 @@ def assertFormfield(self, model, fieldname, widgetclass, **admin_overrides):\n         and verify that the returned formfield is appropriate.\n         \"\"\"\n         # Override any settings on the model admin\n-        class MyModelAdmin(admin.ModelAdmin): pass\n+        class MyModelAdmin(admin.ModelAdmin):\n+            pass\n         for k in admin_overrides:\n             setattr(MyModelAdmin, k, admin_overrides[k])\n \n@@ -314,3 +315,11 @@ def test_render(self):\n         self.assertEqual(w._has_changed([1, 2], [u'1', u'2']), False)\n         self.assertEqual(w._has_changed([1, 2], [u'1']), True)\n         self.assertEqual(w._has_changed([1, 2], [u'1', u'3']), True)\n+\n+class RelatedFieldWidgetWrapperTests(DjangoTestCase):\n+    def test_no_can_add_related(self):\n+        rel = models.Inventory._meta.get_field('parent').rel\n+        w = AdminRadioSelect()\n+        # Used to fail with a name error.\n+        w = RelatedFieldWidgetWrapper(w, rel, admin.site)\n+        self.assertFalse(w.can_add_related)"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 17,
        "deletions": 7
    }
}