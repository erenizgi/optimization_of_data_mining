{
    "author": "aaugustin",
    "message": "Fixed #17067 -- reverted some backwards-incompatible changes from r16933 and added tests.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17010 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "14d24eb438c9930ff76302f263d0f2a8b42d13c1",
    "files": [
        {
            "sha": "30ef746f6c09fe32ceb3a1a0ced80caaa773245a",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/14d24eb438c9930ff76302f263d0f2a8b42d13c1/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/14d24eb438c9930ff76302f263d0f2a8b42d13c1/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=14d24eb438c9930ff76302f263d0f2a8b42d13c1",
            "patch": "@@ -182,12 +182,16 @@ def _base_environ(self, **request):\n         \"\"\"\n         The base environment for a request.\n         \"\"\"\n-        # This is a minimal valid WSGI environ dictionary, plus HTTP_COOKIE\n-        # for cookie support. Empty strings are omitted.\n+        # This is a minimal valid WSGI environ dictionary, plus:\n+        # - HTTP_COOKIE: for cookie support,\n+        # - REMOTE_ADDR: often useful, see #8551.\n         # See http://www.python.org/dev/peps/pep-3333/#environ-variables\n         environ = {\n             'HTTP_COOKIE':       self.cookies.output(header='', sep='; '),\n+            'PATH_INFO':         '/',\n+            'REMOTE_ADDR':       '127.0.0.1',\n             'REQUEST_METHOD':    'GET',\n+            'SCRIPT_NAME':       '',\n             'SERVER_NAME':       'testserver',\n             'SERVER_PORT':       '80',\n             'SERVER_PROTOCOL':   'HTTP/1.1',"
        },
        {
            "sha": "ff851971ff7a55430f31268ecd312612021b37f5",
            "filename": "tests/regressiontests/test_client_regress/models.py",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/14d24eb438c9930ff76302f263d0f2a8b42d13c1/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/14d24eb438c9930ff76302f263d0f2a8b42d13c1/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py?ref=14d24eb438c9930ff76302f263d0f2a8b42d13c1",
            "patch": "@@ -994,3 +994,23 @@ def test_request_after_client(self):\n     def test_request_after_client_2(self):\n         # This test is executed after the previous one\n         self.common_test_that_should_always_pass()\n+\n+\n+class RequestFactoryEnvironmentTests(TestCase):\n+    \"\"\"\n+    Regression tests for #8551 and #17067: ensure that environment variables\n+    are set correctly in RequestFactory.\n+    \"\"\"\n+\n+    def setUp(self):\n+        self.factory = RequestFactory()\n+\n+    def test_should_set_correct_env_variables(self):\n+        request = self.factory.get('/path/')\n+\n+        self.assertEqual(request.META.get('REMOTE_ADDR'), '127.0.0.1')\n+        self.assertEqual(request.META.get('SERVER_NAME'), 'testserver')\n+        self.assertEqual(request.META.get('SERVER_PORT'), '80')\n+        self.assertEqual(request.META.get('SERVER_PROTOCOL'), 'HTTP/1.1')\n+        self.assertEqual(request.META.get('SCRIPT_NAME') +\n+                         request.META.get('PATH_INFO'), '/path/')"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 26,
        "deletions": 2
    }
}