{
    "author": "alex",
    "message": "Fixed #16393 -- FormWizard's cookie storage backend now works with all versions of simplejson and the standard library json module.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17014 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "358e5a8031be14efe33dc62e821408c2a6a8e85a",
    "files": [
        {
            "sha": "274e07ffbea148c3403599014b75769c39f70b09",
            "filename": "django/contrib/formtools/wizard/storage/base.py",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/358e5a8031be14efe33dc62e821408c2a6a8e85a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/358e5a8031be14efe33dc62e821408c2a6a8e85a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py?ref=358e5a8031be14efe33dc62e821408c2a6a8e85a",
            "patch": "@@ -1,9 +1,11 @@\n from django.core.files.uploadedfile import UploadedFile\n-from django.utils.functional import lazy_property\n+from django.utils.datastructures import MultiValueDict\n from django.utils.encoding import smart_str\n+from django.utils.functional import lazy_property\n \n from django.contrib.formtools.wizard.storage.exceptions import NoFileStorageConfigured\n \n+\n class BaseStorage(object):\n     step_key = 'step'\n     step_data_key = 'step_data'\n@@ -43,9 +45,20 @@ def _set_extra_data(self, extra_data):\n     extra_data = lazy_property(_get_extra_data, _set_extra_data)\n \n     def get_step_data(self, step):\n-        return self.data[self.step_data_key].get(step, None)\n+        # When reading the serialized data, upconvert it to a MultiValueDict,\n+        # some serializers (json) don't preserve the type of the object.\n+        values = self.data[self.step_data_key].get(step, None)\n+        if values is not None:\n+            values = MultiValueDict(values)\n+        return values\n \n     def set_step_data(self, step, cleaned_data):\n+        # If the value is a MultiValueDict, convert it to a regular dict of the\n+        # underlying contents.  Some serializers call the public API on it (as\n+        # opposed to the underlying dict methods), in which case the content\n+        # can be truncated (__getitem__ returns only the first item).\n+        if isinstance(cleaned_data, MultiValueDict):\n+            cleaned_data = dict(cleaned_data.lists())\n         self.data[self.step_data_key][step] = cleaned_data\n \n     @property"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}