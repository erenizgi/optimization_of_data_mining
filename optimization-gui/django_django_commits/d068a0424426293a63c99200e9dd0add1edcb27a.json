{
    "author": "spookylukey",
    "message": "Fixed #15284 - improved example jQuery code for adding X-CSRF-Token\n\nUsing the ajaxSend event is better than beforeSend, because the beforeSend\ncallback can have only one value, which makes it painful if it is needed by\nmultiple bits of javascript.\n\nThanks to LukeMaurer for report and initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15515 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d068a0424426293a63c99200e9dd0add1edcb27a",
    "files": [
        {
            "sha": "a6731223e0839e7114571f7e2c339d1d9a4af865",
            "filename": "docs/ref/contrib/csrf.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 19,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/d068a0424426293a63c99200e9dd0add1edcb27a/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "raw_url": "https://github.com/django/django/raw/d068a0424426293a63c99200e9dd0add1edcb27a/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcsrf.txt?ref=d068a0424426293a63c99200e9dd0add1edcb27a",
            "patch": "@@ -90,31 +90,29 @@ every POST request. For this reason, there is an alternative method: on each\n XMLHttpRequest, set a custom `X-CSRFToken` header to the value of the CSRF\n token. This is often easier, because many javascript frameworks provide hooks\n that allow headers to be set on every request. In jQuery, you can use the\n-``beforeSend`` hook as follows:\n+``ajaxSend`` event as follows:\n \n .. code-block:: javascript\n \n-    $.ajaxSetup({\n-        beforeSend: function(xhr, settings) {\n-            function getCookie(name) {\n-                var cookieValue = null;\n-                if (document.cookie && document.cookie != '') {\n-                    var cookies = document.cookie.split(';');\n-                    for (var i = 0; i < cookies.length; i++) {\n-                        var cookie = jQuery.trim(cookies[i]);\n-                        // Does this cookie string begin with the name we want?\n-                        if (cookie.substring(0, name.length + 1) == (name + '=')) {\n-                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n-                            break;\n-                        }\n+    $('html').ajaxSend(function(event, xhr, settings) {\n+        function getCookie(name) {\n+            var cookieValue = null;\n+            if (document.cookie && document.cookie != '') {\n+                var cookies = document.cookie.split(';');\n+                for (var i = 0; i < cookies.length; i++) {\n+                    var cookie = jQuery.trim(cookies[i]);\n+                    // Does this cookie string begin with the name we want?\n+                    if (cookie.substring(0, name.length + 1) == (name + '=')) {\n+                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n+                        break;\n                     }\n                 }\n-                return cookieValue;\n-            }\n-            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n-                // Only send the token to relative URLs i.e. locally.\n-                xhr.setRequestHeader(\"X-CSRFToken\", getCookie('csrftoken'));\n             }\n+            return cookieValue;\n+        }\n+        if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n+            // Only send the token to relative URLs i.e. locally.\n+            xhr.setRequestHeader(\"X-CSRFToken\", getCookie('csrftoken'));\n         }\n     });\n "
        }
    ],
    "stats": {
        "total": 36,
        "additions": 17,
        "deletions": 19
    }
}