{
    "author": "aaugustin",
    "message": "Fixed #19634 -- Added proper __hash__ methods.\n\nClasses overriding __eq__ need a __hash__ such that equal objects have\nthe same hash.\n\nThanks akaariai for the report and regebro for the patch.",
    "sha": "e76147a83a7306d6d83057b982207ddab37eb942",
    "files": [
        {
            "sha": "b77455e6e1d7b3ea085cca7ec0c83b41b9c96c15",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -51,7 +51,8 @@ def __eq__(self, other):\n     def __ne__(self, other):\n         return not self == other\n \n-    __hash__ = object.__hash__\n+    def __hash__(self):\n+        return hash(self.alias)\n \n     def get_connection_params(self):\n         raise NotImplementedError"
        },
        {
            "sha": "2702876397d98120b033209aeed5185eb82fcea3",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -135,7 +135,8 @@ def __lt__(self, other):\n             return self.creation_counter < other.creation_counter\n         return NotImplemented\n \n-    __hash__ = object.__hash__\n+    def __hash__(self):\n+        return hash(self.creation_counter)\n \n     def __deepcopy__(self, memodict):\n         # We don't have to deepcopy very much here, since most things are not"
        },
        {
            "sha": "e631f177e92ccb0e7c89a069ac0753b5511df998",
            "filename": "django/db/models/fields/files.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -30,7 +30,6 @@ def __ne__(self, other):\n         return not self.__eq__(other)\n \n     def __hash__(self):\n-        # Required because we defined a custom __eq__.\n         return hash(self.name)\n \n     # The standard File contains most of the necessary properties, but"
        },
        {
            "sha": "c7731d41feb6a1c9f206b164ba68aa31ce5d1258",
            "filename": "django/dispatch/saferef.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdispatch%2Fsaferef.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/django%2Fdispatch%2Fsaferef.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fsaferef.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -152,7 +152,8 @@ def __str__(self):\n \n     __repr__ = __str__\n \n-    __hash__ = object.__hash__\n+    def __hash__(self):\n+        return hash(self.key)\n \n     def __bool__( self ):\n         \"\"\"Whether we are still a valid reference\"\"\""
        },
        {
            "sha": "cda9dfab2705035777e180320fbeb33b45bee53f",
            "filename": "django/test/html.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/django%2Ftest%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/django%2Ftest%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fhtml.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -85,7 +85,8 @@ def __eq__(self, element):\n             return False\n         return True\n \n-    __hash__ = object.__hash__\n+    def __hash__(self):\n+        return hash((self.name,) + tuple(a for a in self.attributes))\n \n     def __ne__(self, element):\n         return not self.__eq__(element)"
        },
        {
            "sha": "69a32b101a1ca265aaa57e788bcbfe134b6113d3",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -152,7 +152,8 @@ def __lt__(self, other):\n                 other = other.__cast()\n             return self.__cast() < other\n \n-        __hash__ = object.__hash__\n+        def __hash__(self):\n+            return hash(self.__cast())\n \n         def __mod__(self, rhs):\n             if self._delegate_bytes and not six.PY3:"
        },
        {
            "sha": "b0413b1ebc2bebd980fecb65f7c4576387cdf888",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/e76147a83a7306d6d83057b982207ddab37eb942/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e76147a83a7306d6d83057b982207ddab37eb942/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=e76147a83a7306d6d83057b982207ddab37eb942",
            "patch": "@@ -576,9 +576,11 @@ def test_default_connection_thread_local(self):\n         different for each thread.\n         Refs #17258.\n         \"\"\"\n-        connections_set = set()\n+        # Map connections by id because connections with identical aliases\n+        # have the same hash.\n+        connections_dict = {}\n         connection.cursor()\n-        connections_set.add(connection)\n+        connections_dict[id(connection)] = connection\n         def runner():\n             # Passing django.db.connection between threads doesn't work while\n             # connections[DEFAULT_DB_ALIAS] does.\n@@ -588,19 +590,19 @@ def runner():\n             # main thread.\n             connection.allow_thread_sharing = True\n             connection.cursor()\n-            connections_set.add(connection)\n+            connections_dict[id(connection)] = connection\n         for x in range(2):\n             t = threading.Thread(target=runner)\n             t.start()\n             t.join()\n         # Check that each created connection got different inner connection.\n         self.assertEqual(\n-            len(set([conn.connection for conn in connections_set])),\n+            len(set(conn.connection for conn in connections_dict.values())),\n             3)\n         # Finish by closing the connections opened by the other threads (the\n         # connection opened in the main thread will automatically be closed on\n         # teardown).\n-        for conn in connections_set:\n+        for conn in connections_dict.values() :\n             if conn is not connection:\n                 conn.close()\n \n@@ -609,25 +611,27 @@ def test_connections_thread_local(self):\n         Ensure that the connections are different for each thread.\n         Refs #17258.\n         \"\"\"\n-        connections_set = set()\n+        # Map connections by id because connections with identical aliases\n+        # have the same hash.\n+        connections_dict = {}\n         for conn in connections.all():\n-            connections_set.add(conn)\n+            connections_dict[id(conn)] = conn\n         def runner():\n             from django.db import connections\n             for conn in connections.all():\n                 # Allow thread sharing so the connection can be closed by the\n                 # main thread.\n                 conn.allow_thread_sharing = True\n-                connections_set.add(conn)\n+                connections_dict[id(conn)] = conn\n         for x in range(2):\n             t = threading.Thread(target=runner)\n             t.start()\n             t.join()\n-        self.assertEqual(len(connections_set), 6)\n+        self.assertEqual(len(connections_dict), 6)\n         # Finish by closing the connections opened by the other threads (the\n         # connection opened in the main thread will automatically be closed on\n         # teardown).\n-        for conn in connections_set:\n+        for conn in connections_dict.values():\n             if conn is not connection:\n                 conn.close()\n "
        }
    ],
    "stats": {
        "total": 40,
        "additions": 24,
        "deletions": 16
    }
}