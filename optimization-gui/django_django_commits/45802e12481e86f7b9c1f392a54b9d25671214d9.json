{
    "author": "claudep",
    "message": "Merged pagination tests\n\nIt is simpler/cleaner to have all pagination tests in a single file.\nRefs #16122.",
    "sha": "45802e12481e86f7b9c1f392a54b9d25671214d9",
    "files": [
        {
            "sha": "12ce0e3ecbc322c2347a1c3b880dc8da68f3bf7a",
            "filename": "tests/modeltests/pagination/tests.py",
            "status": "removed",
            "additions": 0,
            "deletions": 134,
            "changes": 134,
            "blob_url": "https://github.com/django/django/blob/cafb266954e21dd55ddfa90597bcf02c022bcb7d/tests%2Fmodeltests%2Fpagination%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/cafb266954e21dd55ddfa90597bcf02c022bcb7d/tests%2Fmodeltests%2Fpagination%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fpagination%2Ftests.py?ref=cafb266954e21dd55ddfa90597bcf02c022bcb7d",
            "patch": "@@ -1,134 +0,0 @@\n-from __future__ import absolute_import, unicode_literals\n-\n-from datetime import datetime\n-\n-from django.core.paginator import Paginator, InvalidPage, EmptyPage\n-from django.test import TestCase\n-from django.utils import six\n-\n-from .models import Article\n-\n-\n-class CountContainer(object):\n-    def count(self):\n-        return 42\n-\n-class LenContainer(object):\n-    def __len__(self):\n-        return 42\n-\n-class PaginationTests(TestCase):\n-    def setUp(self):\n-        # Prepare a list of objects for pagination.\n-        for x in range(1, 10):\n-            a = Article(headline='Article %s' % x, pub_date=datetime(2005, 7, 29))\n-            a.save()\n-\n-    def test_paginator(self):\n-        paginator = Paginator(Article.objects.all(), 5)\n-        self.assertEqual(9, paginator.count)\n-        self.assertEqual(2, paginator.num_pages)\n-        self.assertEqual([1, 2], list(paginator.page_range))\n-\n-    def test_first_page(self):\n-        paginator = Paginator(Article.objects.all(), 5)\n-        p = paginator.page(1)\n-        self.assertEqual(\"<Page 1 of 2>\", six.text_type(p))\n-        self.assertQuerysetEqual(p.object_list, [\n-                \"<Article: Article 1>\",\n-                \"<Article: Article 2>\",\n-                \"<Article: Article 3>\",\n-                \"<Article: Article 4>\",\n-                \"<Article: Article 5>\"\n-            ]\n-        )\n-        self.assertTrue(p.has_next())\n-        self.assertFalse(p.has_previous())\n-        self.assertTrue(p.has_other_pages())\n-        self.assertEqual(2, p.next_page_number())\n-        self.assertRaises(InvalidPage, p.previous_page_number)\n-        self.assertEqual(1, p.start_index())\n-        self.assertEqual(5, p.end_index())\n-\n-    def test_last_page(self):\n-        paginator = Paginator(Article.objects.all(), 5)\n-        p = paginator.page(2)\n-        self.assertEqual(\"<Page 2 of 2>\", six.text_type(p))\n-        self.assertQuerysetEqual(p.object_list, [\n-                \"<Article: Article 6>\",\n-                \"<Article: Article 7>\",\n-                \"<Article: Article 8>\",\n-                \"<Article: Article 9>\"\n-            ]\n-        )\n-        self.assertFalse(p.has_next())\n-        self.assertTrue(p.has_previous())\n-        self.assertTrue(p.has_other_pages())\n-        self.assertRaises(InvalidPage, p.next_page_number)\n-        self.assertEqual(1, p.previous_page_number())\n-        self.assertEqual(6, p.start_index())\n-        self.assertEqual(9, p.end_index())\n-\n-    def test_empty_page(self):\n-        paginator = Paginator(Article.objects.all(), 5)\n-        self.assertRaises(EmptyPage, paginator.page, 0)\n-        self.assertRaises(EmptyPage, paginator.page, 3)\n-\n-        # Empty paginators with allow_empty_first_page=True.\n-        paginator = Paginator(Article.objects.filter(id=0), 5, allow_empty_first_page=True)\n-        self.assertEqual(0, paginator.count)\n-        self.assertEqual(1, paginator.num_pages)\n-        self.assertEqual([1], list(paginator.page_range))\n-\n-        # Empty paginators with allow_empty_first_page=False.\n-        paginator = Paginator(Article.objects.filter(id=0), 5, allow_empty_first_page=False)\n-        self.assertEqual(0, paginator.count)\n-        self.assertEqual(0, paginator.num_pages)\n-        self.assertEqual([], list(paginator.page_range))\n-\n-    def test_invalid_page(self):\n-        paginator = Paginator(Article.objects.all(), 5)\n-        self.assertRaises(InvalidPage, paginator.page, 7)\n-\n-    def test_orphans(self):\n-        # Add a few more records to test out the orphans feature.\n-        for x in range(10, 13):\n-            Article(headline=\"Article %s\" % x, pub_date=datetime(2006, 10, 6)).save()\n-\n-        # With orphans set to 3 and 10 items per page, we should get all 12 items on a single page.\n-        paginator = Paginator(Article.objects.all(), 10, orphans=3)\n-        self.assertEqual(1, paginator.num_pages)\n-\n-        # With orphans only set to 1, we should get two pages.\n-        paginator = Paginator(Article.objects.all(), 10, orphans=1)\n-        self.assertEqual(2, paginator.num_pages)\n-\n-    def test_paginate_list(self):\n-        # Paginators work with regular lists/tuples, too -- not just with QuerySets.\n-        paginator = Paginator([1, 2, 3, 4, 5, 6, 7, 8, 9], 3)\n-        self.assertEqual(9, paginator.count)\n-        self.assertEqual(3, paginator.num_pages)\n-        self.assertEqual([1, 2, 3], list(paginator.page_range))\n-        p = paginator.page(2)\n-        self.assertEqual(\"<Page 2 of 3>\", six.text_type(p))\n-        self.assertEqual([4, 5, 6], p.object_list)\n-        self.assertTrue(p.has_next())\n-        self.assertTrue(p.has_previous())\n-        self.assertTrue(p.has_other_pages())\n-        self.assertEqual(3, p.next_page_number())\n-        self.assertEqual(1, p.previous_page_number())\n-        self.assertEqual(4, p.start_index())\n-        self.assertEqual(6, p.end_index())\n-\n-    def test_paginate_misc_classes(self):\n-        # Paginator can be passed other objects with a count() method.\n-        paginator = Paginator(CountContainer(), 10)\n-        self.assertEqual(42, paginator.count)\n-        self.assertEqual(5, paginator.num_pages)\n-        self.assertEqual([1, 2, 3, 4, 5], list(paginator.page_range))\n-\n-        # Paginator can be passed other objects that implement __len__.\n-        paginator = Paginator(LenContainer(), 10)\n-        self.assertEqual(42, paginator.count)\n-        self.assertEqual(5, paginator.num_pages)\n-        self.assertEqual([1, 2, 3, 4, 5], list(paginator.page_range))"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/pagination/__init__.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/45802e12481e86f7b9c1f392a54b9d25671214d9/tests%2Fregressiontests%2Fpagination%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/45802e12481e86f7b9c1f392a54b9d25671214d9/tests%2Fregressiontests%2Fpagination%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination%2F__init__.py?ref=45802e12481e86f7b9c1f392a54b9d25671214d9",
            "previous_filename": "tests/modeltests/pagination/__init__.py"
        },
        {
            "sha": "9dc8d4b776b4adbd46f62e16cb2c56c6fe34c72f",
            "filename": "tests/regressiontests/pagination/models.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/45802e12481e86f7b9c1f392a54b9d25671214d9/tests%2Fregressiontests%2Fpagination%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/45802e12481e86f7b9c1f392a54b9d25671214d9/tests%2Fregressiontests%2Fpagination%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination%2Fmodels.py?ref=45802e12481e86f7b9c1f392a54b9d25671214d9",
            "patch": "@@ -1,11 +1,3 @@\n-\"\"\"\n-30. Object pagination\n-\n-Django provides a framework for paginating a list of objects in a few lines\n-of code. This is often useful for dividing search results or long lists of\n-objects into easily readable pages.\n-\"\"\"\n-\n from django.db import models\n from django.utils.encoding import python_2_unicode_compatible\n ",
            "previous_filename": "tests/modeltests/pagination/models.py"
        },
        {
            "sha": "a49f9b8fa1246f1ac5164ef8ce602e8f0aeb9717",
            "filename": "tests/regressiontests/pagination/tests.py",
            "status": "renamed",
            "additions": 95,
            "deletions": 13,
            "changes": 108,
            "blob_url": "https://github.com/django/django/blob/45802e12481e86f7b9c1f392a54b9d25671214d9/tests%2Fregressiontests%2Fpagination%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/45802e12481e86f7b9c1f392a54b9d25671214d9/tests%2Fregressiontests%2Fpagination%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination%2Ftests.py?ref=45802e12481e86f7b9c1f392a54b9d25671214d9",
            "patch": "@@ -1,9 +1,17 @@\n-from __future__ import unicode_literals\n+from __future__ import absolute_import, unicode_literals\n \n-from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger\n-from django.utils.unittest import TestCase\n+from datetime import datetime\n \n-class PaginatorTests(TestCase):\n+from django.core.paginator import (Paginator, EmptyPage, InvalidPage,\n+    PageNotAnInteger)\n+from django.test import TestCase\n+from django.utils import six\n+from django.utils import unittest\n+\n+from .models import Article\n+\n+\n+class PaginationTests(unittest.TestCase):\n     \"\"\"\n     Tests for the Paginator and Page classes.\n     \"\"\"\n@@ -31,15 +39,6 @@ def check_attribute(self, name, paginator, expected, params, coerce=None):\n             \"For '%s', expected %s but got %s.  Paginator parameters were: %s\"\n             % (name, expected, got, params))\n \n-    def test_invalid_page_number(self):\n-        \"\"\"\n-        Tests that invalid page numbers result in the correct exception being\n-        raised.\n-        \"\"\"\n-        paginator = Paginator([1, 2, 3], 2)\n-        self.assertRaises(PageNotAnInteger, paginator.validate_number, None)\n-        self.assertRaises(PageNotAnInteger, paginator.validate_number, 'x')\n-\n     def test_paginator(self):\n         \"\"\"\n         Tests the paginator attributes using varying inputs.\n@@ -107,6 +106,38 @@ def test_paginator(self):\n         for params, output in tests:\n             self.check_paginator(params, output)\n \n+    def test_invalid_page_number(self):\n+        \"\"\"\n+        Tests that invalid page numbers result in the correct exception being\n+        raised.\n+        \"\"\"\n+        paginator = Paginator([1, 2, 3], 2)\n+        self.assertRaises(InvalidPage, paginator.page, 3)\n+        self.assertRaises(PageNotAnInteger, paginator.validate_number, None)\n+        self.assertRaises(PageNotAnInteger, paginator.validate_number, 'x')\n+        # With no content and allow_empty_first_page=True, 1 is a valid page number\n+        paginator = Paginator([], 2)\n+        self.assertEqual(paginator.validate_number(1), 1)\n+\n+    def test_paginate_misc_classes(self):\n+        class CountContainer(object):\n+            def count(self):\n+                return 42\n+        # Paginator can be passed other objects with a count() method.\n+        paginator = Paginator(CountContainer(), 10)\n+        self.assertEqual(42, paginator.count)\n+        self.assertEqual(5, paginator.num_pages)\n+        self.assertEqual([1, 2, 3, 4, 5], list(paginator.page_range))\n+\n+        # Paginator can be passed other objects that implement __len__.\n+        class LenContainer(object):\n+            def __len__(self):\n+                return 42\n+        paginator = Paginator(LenContainer(), 10)\n+        self.assertEqual(42, paginator.count)\n+        self.assertEqual(5, paginator.num_pages)\n+        self.assertEqual([1, 2, 3, 4, 5], list(paginator.page_range))\n+\n     def check_indexes(self, params, page_num, indexes):\n         \"\"\"\n         Helper method that instantiates a Paginator object from the passed\n@@ -168,6 +199,7 @@ def test_page_indexes(self):\n         for params, first, last in tests:\n             self.check_indexes(params, 'first', first)\n             self.check_indexes(params, 'last', last)\n+\n         # When no items and no empty first page, we should get EmptyPage error.\n         self.assertRaises(EmptyPage, self.check_indexes, ([], 4, 0, False), 1, None)\n         self.assertRaises(EmptyPage, self.check_indexes, ([], 4, 1, False), 1, None)\n@@ -184,3 +216,53 @@ def test_page_sequence(self):\n         self.assertFalse('a' in page2)\n         self.assertEqual(''.join(page2), 'fghijk')\n         self.assertEqual(''.join(reversed(page2)), 'kjihgf')\n+\n+\n+class ModelPaginationTests(TestCase):\n+    \"\"\"\n+    Test pagination with Django model instances\n+    \"\"\"\n+    def setUp(self):\n+        # Prepare a list of objects for pagination.\n+        for x in range(1, 10):\n+            a = Article(headline='Article %s' % x, pub_date=datetime(2005, 7, 29))\n+            a.save()\n+\n+    def test_first_page(self):\n+        paginator = Paginator(Article.objects.all(), 5)\n+        p = paginator.page(1)\n+        self.assertEqual(\"<Page 1 of 2>\", six.text_type(p))\n+        self.assertQuerysetEqual(p.object_list, [\n+                \"<Article: Article 1>\",\n+                \"<Article: Article 2>\",\n+                \"<Article: Article 3>\",\n+                \"<Article: Article 4>\",\n+                \"<Article: Article 5>\"\n+            ]\n+        )\n+        self.assertTrue(p.has_next())\n+        self.assertFalse(p.has_previous())\n+        self.assertTrue(p.has_other_pages())\n+        self.assertEqual(2, p.next_page_number())\n+        self.assertRaises(InvalidPage, p.previous_page_number)\n+        self.assertEqual(1, p.start_index())\n+        self.assertEqual(5, p.end_index())\n+\n+    def test_last_page(self):\n+        paginator = Paginator(Article.objects.all(), 5)\n+        p = paginator.page(2)\n+        self.assertEqual(\"<Page 2 of 2>\", six.text_type(p))\n+        self.assertQuerysetEqual(p.object_list, [\n+                \"<Article: Article 6>\",\n+                \"<Article: Article 7>\",\n+                \"<Article: Article 8>\",\n+                \"<Article: Article 9>\"\n+            ]\n+        )\n+        self.assertFalse(p.has_next())\n+        self.assertTrue(p.has_previous())\n+        self.assertTrue(p.has_other_pages())\n+        self.assertRaises(InvalidPage, p.next_page_number)\n+        self.assertEqual(1, p.previous_page_number())\n+        self.assertEqual(6, p.start_index())\n+        self.assertEqual(9, p.end_index())",
            "previous_filename": "tests/regressiontests/pagination_regress/tests.py"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/pagination_regress/__init__.py",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/cafb266954e21dd55ddfa90597bcf02c022bcb7d/tests%2Fregressiontests%2Fpagination_regress%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/cafb266954e21dd55ddfa90597bcf02c022bcb7d/tests%2Fregressiontests%2Fpagination_regress%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination_regress%2F__init__.py?ref=cafb266954e21dd55ddfa90597bcf02c022bcb7d"
        },
        {
            "sha": "cde172db68adab3ef50ec69dc3f1bb31e75ba2c0",
            "filename": "tests/regressiontests/pagination_regress/models.py",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/cafb266954e21dd55ddfa90597bcf02c022bcb7d/tests%2Fregressiontests%2Fpagination_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/cafb266954e21dd55ddfa90597bcf02c022bcb7d/tests%2Fregressiontests%2Fpagination_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination_regress%2Fmodels.py?ref=cafb266954e21dd55ddfa90597bcf02c022bcb7d",
            "patch": "@@ -1 +0,0 @@\n-# Models file for tests to run."
        }
    ],
    "stats": {
        "total": 251,
        "additions": 95,
        "deletions": 156
    }
}