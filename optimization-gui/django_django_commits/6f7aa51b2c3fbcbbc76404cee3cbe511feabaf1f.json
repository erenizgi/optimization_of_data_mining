{
    "author": "jphalip",
    "message": "Fixed #17864 -- Added Hong Kong localflavor. Thanks to mrkschan and Adrien Lemaire.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17886 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f",
    "files": [
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/localflavor/hk/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/django%2Fcontrib%2Flocalflavor%2Fhk%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/django%2Fcontrib%2Flocalflavor%2Fhk%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fhk%2F__init__.py?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f"
        },
        {
            "sha": "852ef7d4b21ec394d2c08e448e76b4744efee45d",
            "filename": "django/contrib/localflavor/hk/forms.py",
            "status": "added",
            "additions": 71,
            "deletions": 0,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/django%2Fcontrib%2Flocalflavor%2Fhk%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/django%2Fcontrib%2Flocalflavor%2Fhk%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fhk%2Fforms.py?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f",
            "patch": "@@ -0,0 +1,71 @@\n+\"\"\"\n+Hong Kong specific Form helpers\n+\"\"\"\n+from __future__ import absolute_import\n+\n+import re\n+\n+from django.core.validators import EMPTY_VALUES\n+from django.forms import CharField\n+from django.forms import ValidationError\n+from django.utils.encoding import smart_unicode\n+from django.utils.translation import ugettext_lazy as _\n+\n+\n+hk_phone_digits_re = re.compile(r'^(?:852-?)?(\\d{4})[-\\.]?(\\d{4})$')\n+hk_special_numbers = ('999', '992', '112')\n+hk_phone_prefixes = ('2', '3', '5', '6', '8', '9')\n+hk_formats = ['XXXX-XXXX', '852-XXXX-XXXX', '(+852) XXXX-XXXX',\n+    'XXXX XXXX', 'XXXXXXXX']\n+\n+\n+\n+class HKPhoneNumberField(CharField):\n+    \"\"\"\n+    Validate Hong Kong phone number.\n+    The input format can be either one of the followings:\n+    'XXXX-XXXX', '852-XXXX-XXXX', '(+852) XXXX-XXXX',\n+    'XXXX XXXX', or 'XXXXXXXX'.\n+    The output format is 'XXXX-XXXX'.\n+\n+    Note: The phone number shall not start with 999, 992, or 112.\n+          And, it should start with either 2, 3, 5, 6, 8, or 9.\n+\n+    Ref - http://en.wikipedia.org/wiki/Telephone_numbers_in_Hong_Kong\n+    \"\"\"\n+    default_error_messages = {\n+        'disguise': _('Phone number should not start with ' \\\n+                    'one of the followings: %s.' % \\\n+                    ', '.join(hk_special_numbers)),\n+        'invalid': _('Phone number must be in one of the following formats: '\n+                    '%s.' % ', '.join(hk_formats)),\n+        'prefix': _('Phone number should start with ' \\\n+                  'one of the followings: %s.' % \\\n+                  ', '.join(hk_phone_prefixes)),\n+    }\n+\n+    def __init__(self, *args, **kwargs):\n+        super(HKPhoneNumberField, self).__init__(*args, **kwargs)\n+\n+    def clean(self, value):\n+        super(HKPhoneNumberField, self).clean(value)\n+\n+        if value in EMPTY_VALUES:\n+            return u''\n+\n+        value = re.sub('(\\(|\\)|\\s+|\\+)', '', smart_unicode(value))\n+        m = hk_phone_digits_re.search(value)\n+        if not m:\n+            raise ValidationError(self.error_messages['invalid'])\n+\n+        value = u'%s-%s' % (m.group(1), m.group(2))\n+        for special in hk_special_numbers:\n+            if value.startswith(special):\n+                raise ValidationError(self.error_messages['disguise'])\n+\n+        prefix_found = map(lambda prefix: value.startswith(prefix),\n+                           hk_phone_prefixes)\n+        if not any(prefix_found):\n+            raise ValidationError(self.error_messages['prefix'])\n+\n+        return value"
        },
        {
            "sha": "61c8c7ae47bffeb7fb9c16f0be005274df209257",
            "filename": "docs/ref/contrib/localflavor.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Flocalflavor.txt?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f",
            "patch": "@@ -51,6 +51,7 @@ Countries currently supported by :mod:`~django.contrib.localflavor` are:\n * Finland_\n * France_\n * Germany_\n+* `Hong Kong`_\n * Iceland_\n * India_\n * Indonesia_\n@@ -108,6 +109,7 @@ Here's an example of how to use them::\n .. _Finland: `Finland (fi)`_\n .. _France: `France (fr)`_\n .. _Germany: `Germany (de)`_\n+.. _Hong Kong: `Hong Kong (hk)`_\n .. _The Netherlands: `The Netherlands (nl)`_\n .. _Iceland: `Iceland (is\\_)`_\n .. _India: `India (in\\_)`_\n@@ -560,6 +562,14 @@ Germany (``de``)\n \n     A ``Select`` widget that uses a list of German states as its choices.\n \n+Hong Kong (``hk``)\n+==================\n+\n+.. class:: hk.forms.HKPhoneNumberField\n+\n+    A form field that validates input as a Hong Kong phone number.\n+\n+\n The Netherlands (``nl``)\n ========================\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/localflavor/hk/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Fhk%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Fhk%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fhk%2F__init__.py?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f"
        },
        {
            "sha": "a6233d424513ab88ad5c589ef814829af6202c47",
            "filename": "tests/regressiontests/localflavor/hk/forms.py",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Fhk%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Fhk%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fhk%2Fforms.py?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f",
            "patch": "@@ -0,0 +1,11 @@\n+from __future__ import absolute_import\n+\n+from django.forms import ModelForm\n+\n+from .models import HKPlace\n+\n+\n+class HKPlaceForm(ModelForm):\n+\n+    class Meta:\n+        model = HKPlace"
        },
        {
            "sha": "ed5e623ee2ba418a36bc599fc4158b5c68037193",
            "filename": "tests/regressiontests/localflavor/hk/tests.py",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Fhk%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Fhk%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fhk%2Ftests.py?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f",
            "patch": "@@ -0,0 +1,35 @@\n+from __future__ import absolute_import\n+\n+from django.contrib.localflavor.hk.forms import HKPhoneNumberField\n+from django.test import SimpleTestCase\n+\n+\n+class HKLocalFlavorTests(SimpleTestCase):\n+    \"\"\"Tests for Hong Kong Local Flavors\"\"\"\n+\n+    def test_HKPhoneNumberField(self):\n+        error_msgs = HKPhoneNumberField.default_error_messages\n+        valid = {\n+            '2111-1111': '2111-1111',\n+            '3111 1111': '3111-1111',\n+            '51111111': '5111-1111',\n+            '852-6111-1111': '6111-1111',\n+            '(+852) 8111-1111': '8111-1111',\n+            '(+852) 9111-1111': '9111-1111',\n+            '85291111111': '9111-1111',\n+        }\n+        invalid = {\n+            '9991-1111': [error_msgs['disguise'], ],\n+            '9921-1111': [error_msgs['disguise'], ],\n+            '1121-1111': [error_msgs['disguise'], ],\n+            '99987654': [error_msgs['disguise'], ],\n+            '99287654': [error_msgs['disguise'], ],\n+            '11287654': [error_msgs['disguise'], ],\n+            '1': [error_msgs['invalid'], ],\n+            '2111--1111': [error_msgs['invalid'], ],\n+            '11111111': [error_msgs['prefix'], ],\n+            '00000000': [error_msgs['prefix'], ],\n+            '44444444': [error_msgs['prefix'], ],\n+            '77777777': [error_msgs['prefix'], ],\n+        }\n+        self.assertFieldOutput(HKPhoneNumberField, valid, invalid)"
        },
        {
            "sha": "856e518bed3a906105da5cc413258691e2eafa2a",
            "filename": "tests/regressiontests/localflavor/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f/tests%2Fregressiontests%2Flocalflavor%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Ftests.py?ref=6f7aa51b2c3fbcbbc76404cee3cbe511feabaf1f",
            "patch": "@@ -18,6 +18,7 @@\n from .fr.tests import FRLocalFlavorTests\n from .gb.tests import GBLocalFlavorTests\n from .generic.tests import GenericLocalFlavorTests\n+from .hk.tests import HKLocalFlavorTests\n from .hr.tests import HRLocalFlavorTests\n from .id.tests import IDLocalFlavorTests\n from .ie.tests import IELocalFlavorTests"
        }
    ],
    "stats": {
        "total": 128,
        "additions": 128,
        "deletions": 0
    }
}