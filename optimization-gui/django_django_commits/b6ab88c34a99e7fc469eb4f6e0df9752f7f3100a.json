{
    "author": "jbronn",
    "message": "Fixed #14439 -- Improved documentation for running the GeoDjango test suite.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15015 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a",
    "files": [
        {
            "sha": "d7e14fd075ec7ed66a638cada02eccc3fcbe5ed8",
            "filename": "docs/internals/contributing.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a/docs%2Finternals%2Fcontributing.txt",
            "raw_url": "https://github.com/django/django/raw/b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a/docs%2Finternals%2Fcontributing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing.txt?ref=b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a",
            "patch": "@@ -853,6 +853,8 @@ discovered, please follow these guidelines:\n     * The release branch maintainer may back out commits to the release\n       branch without permission if the commit breaks the release branch.\n \n+.. _unit-tests:\n+\n Unit tests\n ==========\n \n@@ -871,6 +873,8 @@ The Django tests all use the testing infrastructure that ships with Django for\n testing applications. See :doc:`Testing Django applications </topics/testing>`\n for an explanation of how to write new tests.\n \n+.. _running-unit-tests:\n+\n Running the unit tests\n ----------------------\n "
        },
        {
            "sha": "5ba73511328f87fbac8d7b2a8b06df8fd230f737",
            "filename": "docs/ref/contrib/gis/testing.txt",
            "status": "modified",
            "additions": 86,
            "deletions": 36,
            "changes": 122,
            "blob_url": "https://github.com/django/django/blob/b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt?ref=b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a",
            "patch": "@@ -4,18 +4,13 @@ Testing GeoDjango Apps\n \n .. versionchanged:: 1.2\n \n-In Django 1.2, the addition of :ref:`spatial-backends`\n-simplified the process of testing GeoDjango applications.  Specifically, testing\n-GeoDjango applications is now the same as :doc:`/topics/testing`.\n+In Django 1.2, the addition of :ref:`spatial-backends` simplified the\n+process of testing GeoDjango applications -- the process is now the\n+same as :doc:`/topics/testing`.\n \n Included in this documentation are some additional notes and settings\n for :ref:`testing-postgis` and :ref:`testing-spatialite` users.\n \n-.. note::\n-\n-    Django 1.1 users are still required to use a custom :setting:`TEST_RUNNER`.\n-    See the :ref:`testing-1.1` section for more details.\n-\n .. _testing-postgis:\n \n PostGIS\n@@ -42,24 +37,21 @@ database to use.  In Django versions 1.2 and above, it automatically\n defaults to ``'template_postgis'`` (the same name used in the\n :ref:`installation documentation <spatialdb_template>`).\n \n-.. note::\n-\n-    Django 1.1 users will still have to define the :setting:`POSTGIS_TEMPLATE`\n-    with a value, for example::\n-\n-        POSTGIS_TEMPLATE='template_postgis'\n-\n .. setting:: POSTGIS_VERSION\n \n ``POSTGIS_VERSION``\n ^^^^^^^^^^^^^^^^^^^\n+\n .. versionadded:: 1.1\n \n When GeoDjango's spatial backend initializes on PostGIS, it has to perform\n-a SQL query to determine the version.  Setting the version manually\n-prevents this query to the database::\n+a SQL query to determine the version in order to figure out what\n+features are available.  Advanced users wishing to prevent this additional\n+query may set the version manually using a 3-tuple of integers specifying\n+the major, minor, and subminor version numbers for PostGIS.  For example,\n+to configure for PostGIS 1.5.2 you would use::\n \n-    POSTGIS_VERSION=('1.3.6', 1, 3, 6)\n+    POSTGIS_VERSION = (1, 5, 2)\n \n Obtaining Sufficient Privileges\n -------------------------------\n@@ -74,6 +66,7 @@ you may be required to use a database superuser.\n \n Create Database User\n ^^^^^^^^^^^^^^^^^^^^\n+\n To make database user with the ability to create databases, use the\n following command::\n \n@@ -89,6 +82,7 @@ Alternatively, you may alter an existing user's role from the SQL shell\n \n Create Database Superuser\n ^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n This may be done at the time the user is created, for example::\n \n     $ createuser --superuser <user_name>\n@@ -112,6 +106,7 @@ Create Local PostgreSQL Database\n \n Windows\n -------\n+\n On Windows platforms the pgAdmin III utility may also be used as\n a simple way to add superuser privileges to your database user.\n \n@@ -142,6 +137,7 @@ Settings\n \n ``SPATIALITE_SQL``\n ^^^^^^^^^^^^^^^^^^\n+\n .. versionadded:: 1.1\n \n By default, the GeoDjango test runner looks for the SpatiaLite SQL in the\n@@ -153,29 +149,83 @@ you may add the following to your settings::\n \n __ http://www.gaia-gis.it/spatialite/init_spatialite-2.3.zip\n \n-.. _testing-1.1:\n \n-Testing GeoDjango Applications in 1.1\n-=====================================\n+.. _geodjango-tests:\n \n-In Django 1.1, to accommodate the extra steps required to scaffalod a\n-spatial database automatically, a test runner customized for GeoDjango\n-must be used.  To use this runner, configure :setting:`TEST_RUNNER` as follows::\n+GeoDjango Tests\n+===============\n \n-    TEST_RUNNER='django.contrib.gis.tests.run_tests'\n+.. versionchanged:: 1.3\n \n-.. note::\n+GeoDjango's test suite may be run in one of two ways, either by itself or\n+with the rest of :ref:`Django's unit tests <unit-tests>`.\n+\n+Run only GeoDjango tests\n+------------------------\n+\n+To run *only* the tests for GeoDjango, the :setting:`TEST_RUNNER`\n+setting must be changed to use the\n+:class:`~django.contrib.gis.tests.GeoDjangoTestSuiteRunner`::\n+\n+    TEST_RUNNER = 'django.contrib.gis.tests.GeoDjangoTestSuiteRunner'\n+\n+Example\n+^^^^^^^\n+\n+First, you'll need a bare-bones settings file, like below, that is\n+customized with your spatial database name and user::\n+\n+    TEST_RUNNER = 'django.contrib.gis.tests.GeoDjangoTestSuiteRunner'\n+\n+    DATABASES = {\n+        'default': {\n+            'ENGINE': 'django.contrib.gis.db.backends.postgis',\n+            'NAME': 'a_spatial_database',\n+            'USER': 'db_user'\n+        }\n+    }\n+\n+Assuming the above is in a file called ``postgis.py`` that is in the\n+the same directory as ``manage.py`` of your Django project, then\n+you may run the tests with the following command::\n+\n+    $ python manage.py test --settings=postgis\n+\n+Run with ``runtests.py``\n+------------------------\n+\n+To have the GeoDjango tests executed when\n+:ref:`running the Django test suite <running-unit-tests>` with ``runtests.py``\n+all of the databases in the settings file must be using one of the\n+:ref:`spatial database backends <spatial-backends>`.\n+\n+.. warning::\n+\n+    Do not change the :setting:`TEST_RUNNER` setting \n+    when running the GeoDjango tests with ``runtests.py``.\n+\n+Example\n+^^^^^^^\n \n-    In order to create a spatial database, the :setting:`USER` setting\n-    (or :setting:`TEST_USER`, if optionally defined on Oracle) requires\n-    elevated privileges.  When using PostGIS or MySQL, the database user\n-    must have at least the ability to create databases.  When testing on Oracle,\n-    the user should be a superuser.\n+The following is an example bare-bones settings file with spatial backends\n+that can be used to run the entire Django test suite, including those\n+in :mod:`django.contrib.gis`::\n \n-GeoDjango Test Suite\n-====================\n+    DATABASES = {\n+        'default': {\n+            'ENGINE': 'django.contrib.gis.db.backends.postgis',\n+            'NAME': 'geodjango',\n+            'USER': 'geodjango',\n+        },\n+       'other': {\n+            'ENGINE': 'django.contrib.gis.db.backends.postgis',\n+            'NAME': 'other',\n+            'USER': 'geodjango',\n+       }\n+    }\n \n-To run GeoDjango's own internal test suite, configure the\n-:setting:`TEST_RUNNER` setting as follows::\n+Assuming the settings above were in a ``postgis.py`` file in the same\n+directory as ``runtests.py``, then all Django and GeoDjango tests would\n+be performed when executing the command::\n \n-    TEST_RUNNER='django.contrib.gis.tests.run_gis_tests'\n+    $ ./runtests.py --settings=postgis"
        },
        {
            "sha": "0bf212452e5f3ed991867dc848c649703d449a02",
            "filename": "docs/releases/1.3.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a/docs%2Freleases%2F1.3.txt",
            "raw_url": "https://github.com/django/django/raw/b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a/docs%2Freleases%2F1.3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3.txt?ref=b6ab88c34a99e7fc469eb4f6e0df9752f7f3100a",
            "patch": "@@ -185,6 +185,13 @@ If you provide a custom auth backend with ``supports_inactive_user`` set to\n This is useful for further centralizing the permission handling. See the\n :ref:`authentication docs <topics-auth>` for more details.\n \n+GeoDjango\n+~~~~~~~~~\n+\n+The GeoDjango test suite is now included when\n+:ref:`running the Django test suite <running-unit-tests>` with ``runtests.py``\n+when using :ref:`spatial database backends <spatial-backends>`.\n+\n Everything else\n ~~~~~~~~~~~~~~~\n \n@@ -513,3 +520,11 @@ attribute.\n Those commands have been deprecated. The ``flush`` and ``sqlflush`` commands\n can be used to delete everything. You can also use ALTER TABLE or DROP TABLE\n statements manually.\n+\n+\n+GeoDjango\n+~~~~~~~~~\n+\n+The :setting:`TEST_RUNNER` previously used to execute the GeoDjango test suite,\n+:func:`django.contrib.gis.tests.run_gis_tests`, is deprecated in favor of\n+the :class:`django.contrib.gis.tests.GeoDjangoTestSuiteRunner` class."
        }
    ],
    "stats": {
        "total": 141,
        "additions": 105,
        "deletions": 36
    }
}