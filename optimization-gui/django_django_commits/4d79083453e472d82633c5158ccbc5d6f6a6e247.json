{
    "author": "jphalip",
    "message": "Fixed #17111 -- Made the `redirect_to` generic view properly handle query strings with percent symbols. Thanks, Chris Adams.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17034 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4d79083453e472d82633c5158ccbc5d6f6a6e247",
    "files": [
        {
            "sha": "c3cf40716305d59ef6db2959d1fabc859e337359",
            "filename": "django/views/generic/simple.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4d79083453e472d82633c5158ccbc5d6f6a6e247/django%2Fviews%2Fgeneric%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/4d79083453e472d82633c5158ccbc5d6f6a6e247/django%2Fviews%2Fgeneric%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fsimple.py?ref=4d79083453e472d82633c5158ccbc5d6f6a6e247",
            "patch": "@@ -49,12 +49,16 @@ def redirect_to(request, url, permanent=True, query_string=False, **kwargs):\n \n     \"\"\"\n     args = request.META.get('QUERY_STRING', '')\n-    if args and query_string and url is not None:\n-        url = \"%s?%s\" % (url, args)\n \n     if url is not None:\n+        if kwargs:\n+            url = url % kwargs\n+\n+        if args and query_string:\n+            url = \"%s?%s\" % (url, args)\n+\n         klass = permanent and HttpResponsePermanentRedirect or HttpResponseRedirect\n-        return klass(url % kwargs)\n+        return klass(url)\n     else:\n         logger.warning('Gone: %s' % request.path,\n                     extra={"
        },
        {
            "sha": "40a6c012ff393266beca0ab8a1c0a0573b870d39",
            "filename": "tests/regressiontests/views/generic_urls.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4d79083453e472d82633c5158ccbc5d6f6a6e247/tests%2Fregressiontests%2Fviews%2Fgeneric_urls.py",
            "raw_url": "https://github.com/django/django/raw/4d79083453e472d82633c5158ccbc5d6f6a6e247/tests%2Fregressiontests%2Fviews%2Fgeneric_urls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fgeneric_urls.py?ref=4d79083453e472d82633c5158ccbc5d6f6a6e247",
            "patch": "@@ -115,4 +115,5 @@\n     (r'^simple/redirect_to_none/$', 'redirect_to', dict(url=None)),\n     (r'^simple/redirect_to_arg/(?P<id>\\d+)/$', 'redirect_to', dict(url='/simple/target_arg/%(id)s/')),\n     (r'^simple/redirect_to_query/$', 'redirect_to', dict(url='/simple/target/', query_string=True)),\n+    (r'^simple/redirect_to_arg_and_query/(?P<id>\\d+)/$', 'redirect_to', dict(url='/simple/target_arg/%(id)s/', query_string=True)),\n )"
        },
        {
            "sha": "7dcf08a0323f47dc1eea91d0238ad06a9918184a",
            "filename": "tests/regressiontests/views/tests/generic/simple.py",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4d79083453e472d82633c5158ccbc5d6f6a6e247/tests%2Fregressiontests%2Fviews%2Ftests%2Fgeneric%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/4d79083453e472d82633c5158ccbc5d6f6a6e247/tests%2Fregressiontests%2Fviews%2Ftests%2Fgeneric%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fgeneric%2Fsimple.py?ref=4d79083453e472d82633c5158ccbc5d6f6a6e247",
            "patch": "@@ -48,9 +48,17 @@ def test_redirect_to_allows_query_string_to_be_passed(self):\n         self.assertEqual(response.status_code, 301)\n         self.assertEqual('http://testserver/simple/target/?param1=foo&param2=bar', response['Location'])\n \n+        # Confirm that the contents of the query string are not subject to\n+        # string interpolation (Refs #17111):\n+        response = self.client.get('/simple/redirect_to_query/?param1=foo&param2=hist%C3%B3ria')\n+        self.assertEqual(response.status_code, 301)\n+        self.assertEqual('http://testserver/simple/target/?param1=foo&param2=hist%C3%B3ria', response['Location'])\n+        response = self.client.get('/simple/redirect_to_arg_and_query/99/?param1=foo&param2=hist%C3%B3ria')\n+        self.assertEqual(response.status_code, 301)\n+        self.assertEqual('http://testserver/simple/target_arg/99/?param1=foo&param2=hist%C3%B3ria', response['Location'])\n+\n     def test_redirect_to_when_meta_contains_no_query_string(self):\n         \"regression for #16705\"\n         # we can't use self.client.get because it always sets QUERY_STRING\n         response = self.client.request(PATH_INFO='/simple/redirect_to/')\n         self.assertEqual(response.status_code, 301)\n-        "
        }
    ],
    "stats": {
        "total": 21,
        "additions": 17,
        "deletions": 4
    }
}