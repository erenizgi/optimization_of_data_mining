{
    "author": "malcolmt",
    "message": "Make ManyToManyField model references more robust.\n\nIn r16679 a test was added to verify something had been fixed when a\nunicode string type was passed in as a model name. The name has to be\nASCII convertible, but in Python 2.6 and earlier, it must also have str\ntype.\n\nThis commit fixes the problem for earlier Python versions and is almost\nidentical to a patch from b.leskes in #6045.\n\nFixes #16689. Refs #6045.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16682 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "587fbff3dd500cd3444dc7a0717e541307ff869d",
    "files": [
        {
            "sha": "d904f56cd6b5704b0d05e756ee96a46772fcb537",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/587fbff3dd500cd3444dc7a0717e541307ff869d/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/587fbff3dd500cd3444dc7a0717e541307ff869d/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=587fbff3dd500cd3444dc7a0717e541307ff869d",
            "patch": "@@ -1007,6 +1007,10 @@ def __init__(self, to, **kwargs):\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n         except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, basestring), \"%s(%r) is invalid. First parameter to ManyToManyField must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n+            # Python 2.6 and earlier require dictionary keys to be of str type,\n+            # not unicode and class names must be ASCII (in Python 2.x), so we\n+            # forcibly coerce it here (breaks early if there's a problem).\n+            to = str(to)\n \n         kwargs['verbose_name'] = kwargs.get('verbose_name', None)\n         kwargs['rel'] = ManyToManyRel(to,"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}