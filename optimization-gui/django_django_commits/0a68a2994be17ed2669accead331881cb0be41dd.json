{
    "author": "jezdez",
    "message": "Fixed #18254 -- Added ability to the static template tags to store the result in a contextt variable. Many thanks to Andrei Antoukh for the initial patch.",
    "sha": "0a68a2994be17ed2669accead331881cb0be41dd",
    "files": [
        {
            "sha": "71339ea8cd43f6886619a3ea76c2c09716987609",
            "filename": "django/contrib/staticfiles/templatetags/staticfiles.py",
            "status": "modified",
            "additions": 27,
            "deletions": 3,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/0a68a2994be17ed2669accead331881cb0be41dd/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py",
            "raw_url": "https://github.com/django/django/raw/0a68a2994be17ed2669accead331881cb0be41dd/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py?ref=0a68a2994be17ed2669accead331881cb0be41dd",
            "patch": "@@ -1,13 +1,37 @@\n from django import template\n+from django.templatetags.static import StaticNode\n from django.contrib.staticfiles.storage import staticfiles_storage\n \n register = template.Library()\n \n \n-@register.simple_tag\n-def static(path):\n+class StaticFilesNode(StaticNode):\n+\n+    def url(self, context):\n+        path = self.path.resolve(context)\n+        return staticfiles_storage.url(path)\n+\n+\n+@register.tag('static')\n+def do_static(parser, token):\n     \"\"\"\n     A template tag that returns the URL to a file\n     using staticfiles' storage backend\n+\n+    Usage::\n+\n+        {% static path [as varname] %}\n+\n+    Examples::\n+\n+        {% static \"myapp/css/base.css\" %}\n+        {% static variable_with_path %}\n+        {% static \"myapp/css/base.css\" as admin_base_css %}\n+        {% static variable_with_path as varname %}\n+\n     \"\"\"\n-    return staticfiles_storage.url(path)\n+    return StaticFilesNode.handle_token(parser, token)\n+\n+\n+def static(path):\n+    return StaticNode.handle_simple(path)"
        },
        {
            "sha": "4b2d66d52126672b5084b1cffdcf76ee14f2722e",
            "filename": "django/templatetags/static.py",
            "status": "modified",
            "additions": 59,
            "deletions": 4,
            "changes": 63,
            "blob_url": "https://github.com/django/django/blob/0a68a2994be17ed2669accead331881cb0be41dd/django%2Ftemplatetags%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/0a68a2994be17ed2669accead331881cb0be41dd/django%2Ftemplatetags%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fstatic.py?ref=0a68a2994be17ed2669accead331881cb0be41dd",
            "patch": "@@ -1,9 +1,11 @@\n from urlparse import urljoin\n from django import template\n+from django.template.base import Node\n from django.utils.encoding import iri_to_uri\n \n register = template.Library()\n \n+\n class PrefixNode(template.Node):\n \n     def __repr__(self):\n@@ -48,6 +50,7 @@ def render(self, context):\n         context[self.varname] = prefix\n         return ''\n \n+\n @register.tag\n def get_static_prefix(parser, token):\n     \"\"\"\n@@ -66,6 +69,7 @@ def get_static_prefix(parser, token):\n     \"\"\"\n     return PrefixNode.handle_token(parser, token, \"STATIC_URL\")\n \n+\n @register.tag\n def get_media_prefix(parser, token):\n     \"\"\"\n@@ -84,19 +88,70 @@ def get_media_prefix(parser, token):\n     \"\"\"\n     return PrefixNode.handle_token(parser, token, \"MEDIA_URL\")\n \n-@register.simple_tag\n-def static(path):\n+\n+class StaticNode(Node):\n+    def __init__(self, varname=None, path=None):\n+        if path is None:\n+            raise template.TemplateSyntaxError(\n+                \"Static template nodes must be given a path to return.\")\n+        self.path = path\n+        self.varname = varname\n+\n+    def url(self, context):\n+        path = self.path.resolve(context)\n+        return self.handle_simple(path)\n+\n+    def render(self, context):\n+        url = self.url(context)\n+        if self.varname is None:\n+            return url\n+        context[self.varname] = url\n+        return ''\n+\n+    @classmethod\n+    def handle_simple(cls, path):\n+        return urljoin(PrefixNode.handle_simple(\"STATIC_URL\"), path)\n+\n+    @classmethod\n+    def handle_token(cls, parser, token):\n+        \"\"\"\n+        Class method to parse prefix node and return a Node.\n+        \"\"\"\n+        bits = token.split_contents()\n+\n+        if len(bits) < 2:\n+            raise template.TemplateSyntaxError(\n+                \"'%s' takes at least one argument (path to file)\" % bits[0])\n+\n+        path = parser.compile_filter(bits[1])\n+\n+        if len(bits) >= 2 and bits[-2] == 'as':\n+            varname = bits[3]\n+        else:\n+            varname = None\n+\n+        return cls(varname, path)\n+\n+\n+@register.tag('static')\n+def do_static(parser, token):\n     \"\"\"\n     Joins the given path with the STATIC_URL setting.\n \n     Usage::\n \n-        {% static path %}\n+        {% static path [as varname] %}\n \n     Examples::\n \n         {% static \"myapp/css/base.css\" %}\n         {% static variable_with_path %}\n+        {% static \"myapp/css/base.css\" as admin_base_css %}\n+        {% static variable_with_path as varname %}\n \n     \"\"\"\n-    return urljoin(PrefixNode.handle_simple(\"STATIC_URL\"), path)\n+    return StaticNode.handle_token(parser, token)\n+\n+\n+def static(path):\n+    return StaticNode.handle_simple(path)"
        },
        {
            "sha": "f5557dff9148e2217a445fbf19539269f09253c2",
            "filename": "docs/ref/contrib/staticfiles.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/0a68a2994be17ed2669accead331881cb0be41dd/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "raw_url": "https://github.com/django/django/raw/0a68a2994be17ed2669accead331881cb0be41dd/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fstaticfiles.txt?ref=0a68a2994be17ed2669accead331881cb0be41dd",
            "patch": "@@ -387,6 +387,17 @@ The previous example is equal to calling the ``url`` method of an instance of\n useful when using a non-local storage backend to deploy files as documented\n in :ref:`staticfiles-from-cdn`.\n \n+.. versionadded:: 1.5\n+\n+If you'd like to retrieve a static URL without displaying it, you can use a\n+slightly different call::\n+\n+.. code-block:: html+django\n+\n+    {% load static from staticfiles %}\n+    {% static \"images/hi.jpg\" as myphoto %}\n+    <img src=\"{{ myphoto }}\" alt=\"Hi!\" />\n+\n Other Helpers\n =============\n "
        },
        {
            "sha": "71f57acdbfc95b92a9c5035dfec036f090acb561",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/0a68a2994be17ed2669accead331881cb0be41dd/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/0a68a2994be17ed2669accead331881cb0be41dd/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=0a68a2994be17ed2669accead331881cb0be41dd",
            "patch": "@@ -2354,6 +2354,17 @@ It is also able to consume standard context variables, e.g. assuming a\n     {% load static %}\n     <link rel=\"stylesheet\" href=\"{% static user_stylesheet %}\" type=\"text/css\" media=\"screen\" />\n \n+If you'd like to retrieve a static URL without displaying it, you can use a\n+slightly different call::\n+\n+.. versionadded:: 1.5\n+\n+.. code-block:: html+django\n+\n+    {% load static %}\n+    {% static \"images/hi.jpg\" as myphoto %}\n+    <img src=\"{{ myphoto }}\"></img>\n+\n .. note::\n \n     The :mod:`staticfiles<django.contrib.staticfiles>` contrib app also ships"
        },
        {
            "sha": "7678d7f100feef03af52f42e9334ac5ad9a4aa9d",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/0a68a2994be17ed2669accead331881cb0be41dd/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0a68a2994be17ed2669accead331881cb0be41dd/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=0a68a2994be17ed2669accead331881cb0be41dd",
            "patch": "@@ -87,14 +87,16 @@ def render_template(self, template, **kwargs):\n             template = loader.get_template_from_string(template)\n         return template.render(Context(kwargs)).strip()\n \n-    def static_template_snippet(self, path):\n+    def static_template_snippet(self, path, asvar=False):\n+        if asvar:\n+            return \"{%% load static from staticfiles %%}{%% static '%s' as var %%}{{ var }}\" % path\n         return \"{%% load static from staticfiles %%}{%% static '%s' %%}\" % path\n \n-    def assertStaticRenders(self, path, result, **kwargs):\n-        template = self.static_template_snippet(path)\n+    def assertStaticRenders(self, path, result, asvar=False, **kwargs):\n+        template = self.static_template_snippet(path, asvar)\n         self.assertEqual(self.render_template(template, **kwargs), result)\n \n-    def assertStaticRaises(self, exc, path, result, **kwargs):\n+    def assertStaticRaises(self, exc, path, result, asvar=False, **kwargs):\n         self.assertRaises(exc, self.assertStaticRenders, path, result, **kwargs)\n \n \n@@ -368,6 +370,8 @@ def test_template_tag_return(self):\n                                 \"/static/does/not/exist.png\")\n         self.assertStaticRenders(\"test/file.txt\",\n                                  \"/static/test/file.dad0999e4f8f.txt\")\n+        self.assertStaticRenders(\"test/file.txt\",\n+                                 \"/static/test/file.dad0999e4f8f.txt\", asvar=True)\n         self.assertStaticRenders(\"cached/styles.css\",\n                                  \"/static/cached/styles.93b1147e8552.css\")\n         self.assertStaticRenders(\"path/\","
        },
        {
            "sha": "4aa71f97094e9328d1c1a965e6b44c7795a3f557",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0a68a2994be17ed2669accead331881cb0be41dd/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0a68a2994be17ed2669accead331881cb0be41dd/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=0a68a2994be17ed2669accead331881cb0be41dd",
            "patch": "@@ -1616,6 +1616,8 @@ def get_template_tests(self):\n             'static-prefixtag04': ('{% load static %}{% get_media_prefix as media_prefix %}{{ media_prefix }}', {}, settings.MEDIA_URL),\n             'static-statictag01': ('{% load static %}{% static \"admin/base.css\" %}', {}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n             'static-statictag02': ('{% load static %}{% static base_css %}', {'base_css': 'admin/base.css'}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n+            'static-statictag03': ('{% load static %}{% static \"admin/base.css\" as foo %}{{ foo }}', {}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n+            'static-statictag04': ('{% load static %}{% static base_css as foo %}{{ foo }}', {'base_css': 'admin/base.css'}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n \n             # Verbatim template tag outputs contents without rendering.\n             'verbatim-tag01': ('{% verbatim %}{{bare   }}{% endverbatim %}', {}, '{{bare   }}'),"
        }
    ],
    "stats": {
        "total": 129,
        "additions": 118,
        "deletions": 11
    }
}