{
    "author": "kmtracey",
    "message": "Fix #16813: Restore checking whether a backend supports inctive users before sending inactive users in for permission checking. Thanks apollo13 for the report and poirier for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17084 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f4f61baa8c4e5213d17d99ed562186895b389952",
    "files": [
        {
            "sha": "3f60b25de01c3588a874e62a5bee57aa0bea80ff",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/f4f61baa8c4e5213d17d99ed562186895b389952/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/f4f61baa8c4e5213d17d99ed562186895b389952/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=f4f61baa8c4e5213d17d99ed562186895b389952",
            "patch": "@@ -408,6 +408,7 @@ answer newbie questions, and generally made Django that much better:\n     Michael Placentra II <someone@michaelplacentra2.net>\n     plisk\n     Daniel Poelzleithner <http://poelzi.org/>\n+    Dan Poirier <poirier@pobox.com>\n     polpak@yahoo.com\n     Ross Poulton <ross@rossp.org>\n     Mihai Preda <mihai_preda@yahoo.com>"
        },
        {
            "sha": "0fc18fda4d5d9df07750784f34aa60f32524b13a",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/f4f61baa8c4e5213d17d99ed562186895b389952/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/f4f61baa8c4e5213d17d99ed562186895b389952/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=f4f61baa8c4e5213d17d99ed562186895b389952",
            "patch": "@@ -142,22 +142,28 @@ def _user_get_all_permissions(user, obj):\n \n \n def _user_has_perm(user, perm, obj):\n+    anon = user.is_anonymous()\n+    active = user.is_active\n     for backend in auth.get_backends():\n-        if hasattr(backend, \"has_perm\"):\n-            if obj is not None:\n-                if backend.has_perm(user, perm, obj):\n+        if anon or active or backend.supports_inactive_user:\n+            if hasattr(backend, \"has_perm\"):\n+                if obj is not None:\n+                    if backend.has_perm(user, perm, obj):\n+                            return True\n+                else:\n+                    if backend.has_perm(user, perm):\n                         return True\n-            else:\n-                if backend.has_perm(user, perm):\n-                    return True\n     return False\n \n \n def _user_has_module_perms(user, app_label):\n+    anon = user.is_anonymous()\n+    active = user.is_active\n     for backend in auth.get_backends():\n-        if hasattr(backend, \"has_module_perms\"):\n-            if backend.has_module_perms(user, app_label):\n-                return True\n+        if anon or active or backend.supports_inactive_user:\n+            if hasattr(backend, \"has_module_perms\"):\n+                if backend.has_module_perms(user, app_label):\n+                    return True\n     return False\n \n "
        },
        {
            "sha": "0337ef14f37542c07af534977c668fc9bd465686",
            "filename": "django/contrib/auth/tests/auth_backends.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/f4f61baa8c4e5213d17d99ed562186895b389952/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "raw_url": "https://github.com/django/django/raw/f4f61baa8c4e5213d17d99ed562186895b389952/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py?ref=f4f61baa8c4e5213d17d99ed562186895b389952",
            "patch": "@@ -300,7 +300,7 @@ def tearDown(self):\n \n     def test_has_perm(self):\n         self.assertEqual(self.user1.has_perm('perm', TestObj()), False)\n-        self.assertEqual(self.user1.has_perm('inactive', TestObj()), True)\n+        self.assertEqual(self.user1.has_perm('inactive', TestObj()), False)\n \n     def test_has_module_perms(self):\n         self.assertEqual(self.user1.has_module_perms(\"app1\"), False)"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 17,
        "deletions": 10
    }
}