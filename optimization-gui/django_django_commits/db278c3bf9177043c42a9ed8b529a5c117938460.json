{
    "author": "aaugustin",
    "message": "Fixed #19525 -- Reverted dcd4383107 and 05d333ba3b.\n\nRefs #9893, #18515.\n\nThanks Russell for the report.",
    "sha": "db278c3bf9177043c42a9ed8b529a5c117938460",
    "files": [
        {
            "sha": "e0cc27a081de308d6c4287f09563f67d46ba2d65",
            "filename": "django/db/models/fields/files.py",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/db278c3bf9177043c42a9ed8b529a5c117938460/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "raw_url": "https://github.com/django/django/raw/db278c3bf9177043c42a9ed8b529a5c117938460/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py?ref=db278c3bf9177043c42a9ed8b529a5c117938460",
            "patch": "@@ -3,7 +3,6 @@\n \n from django import forms\n from django.db.models.fields import Field\n-from django.core.exceptions import ValidationError\n from django.core.files.base import File\n from django.core.files.storage import default_storage\n from django.core.files.images import ImageFile\n@@ -207,10 +206,6 @@ def __set__(self, instance, value):\n \n class FileField(Field):\n \n-    default_error_messages = {\n-        'max_length': _('Filename is %(extra)d characters too long.')\n-    }\n-\n     # The class to wrap instance attributes in. Accessing the file object off\n     # the instance will always return an instance of attr_class.\n     attr_class = FieldFile\n@@ -233,25 +228,6 @@ def __init__(self, verbose_name=None, name=None, upload_to='', storage=None, **k\n         kwargs['max_length'] = kwargs.get('max_length', 100)\n         super(FileField, self).__init__(verbose_name, name, **kwargs)\n \n-    def validate(self, value, model_instance):\n-        \"\"\"\n-        Validates that the generated file name still fits within max_length.\n-        \"\"\"\n-        # The generated file name stored in the database is generally longer\n-        # than the uploaded file name. Using the length of generated name in\n-        # the error message would be confusing. However, in the common case\n-        # (ie. upload_to='path/to/upload/dir'), the length of the generated\n-        # name equals the length of the uploaded name plus a constant. Thus\n-        # we can tell the user how much shorter the name should be (roughly).\n-        if value and value._committed:\n-            filename = value.name\n-        else:\n-            filename = self.generate_filename(model_instance, value.name)\n-        length = len(filename)\n-        if self.max_length and length > self.max_length:\n-            error_values = {'extra': length - self.max_length}\n-            raise ValidationError(self.error_messages['max_length'] % error_values)\n-\n     def get_internal_type(self):\n         return \"FileField\"\n "
        },
        {
            "sha": "41344727485c2f2b98915e17fdca498cff42e736",
            "filename": "tests/modeltests/files/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/db278c3bf9177043c42a9ed8b529a5c117938460/tests%2Fmodeltests%2Ffiles%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/db278c3bf9177043c42a9ed8b529a5c117938460/tests%2Fmodeltests%2Ffiles%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Fmodels.py?ref=db278c3bf9177043c42a9ed8b529a5c117938460",
            "patch": "@@ -26,5 +26,5 @@ def random_upload_to(self, filename):\n \n     normal = models.FileField(storage=temp_storage, upload_to='tests')\n     custom = models.FileField(storage=temp_storage, upload_to=custom_upload_to)\n-    random = models.FileField(storage=temp_storage, upload_to=random_upload_to, max_length=16)\n+    random = models.FileField(storage=temp_storage, upload_to=random_upload_to)\n     default = models.FileField(storage=temp_storage, upload_to='tests', default='tests/default.txt')"
        },
        {
            "sha": "50d1915c2856d34c16cad962f06880e8392fdbc6",
            "filename": "tests/modeltests/files/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/db278c3bf9177043c42a9ed8b529a5c117938460/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/db278c3bf9177043c42a9ed8b529a5c117938460/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Ftests.py?ref=db278c3bf9177043c42a9ed8b529a5c117938460",
            "patch": "@@ -5,7 +5,6 @@\n import tempfile\n \n from django.core.cache import cache\n-from django.core.exceptions import ValidationError\n from django.core.files import File\n from django.core.files.base import ContentFile\n from django.core.files.uploadedfile import SimpleUploadedFile\n@@ -103,24 +102,6 @@ def test_files(self):\n         obj4.random.save(\"random_file\", ContentFile(\"random content\"))\n         self.assertTrue(obj4.random.name.endswith(\"/random_file\"))\n \n-    def test_max_length(self):\n-        \"\"\"\n-        Test that FileField validates the length of the generated file name\n-        that will be stored in the database. Regression for #9893.\n-        \"\"\"\n-        # upload_to = 'unused', so file names are saved as '456/xxxxx'.\n-        # max_length = 16, so names longer than 12 characters are rejected.\n-        s1 = Storage(random=SimpleUploadedFile(12 * 'x', b\"content\"))\n-        s1.full_clean()\n-        with self.assertRaises(ValidationError):\n-            Storage(random=SimpleUploadedFile(13 * 'x', b\"content\")).full_clean()\n-\n-        # Ticket #18515: validation for an already saved file should not check\n-        # against a regenerated file name (and potentially raise a ValidationError\n-        # if max_length is exceeded\n-        s1.save()\n-        s1.full_clean()\n-\n \n class FileTests(unittest.TestCase):\n     def test_context_manager(self):"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 1,
        "deletions": 44
    }
}