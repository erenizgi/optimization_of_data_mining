{
    "author": "SmileyChris",
    "message": "Fixes #10427 -- Abstract the value generation of a BoundField\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14734 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f",
    "files": [
        {
            "sha": "1cf6f2a3a28188a742f7278e747fdc12d26e6930",
            "filename": "django/forms/forms.py",
            "status": "modified",
            "additions": 16,
            "deletions": 10,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f/django%2Fforms%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f/django%2Fforms%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fforms.py?ref=d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f",
            "patch": "@@ -432,20 +432,11 @@ def as_widget(self, widget=None, attrs=None, only_initial=False):\n             else:\n                 attrs['id'] = self.html_initial_id\n \n-        if not self.form.is_bound:\n-            data = self.form.initial.get(self.name, self.field.initial)\n-            if callable(data):\n-                data = data()\n-        else:\n-            data = self.field.bound_data(\n-                self.data, self.form.initial.get(self.name, self.field.initial))\n-        data = self.field.prepare_value(data)\n-\n         if not only_initial:\n             name = self.html_name\n         else:\n             name = self.html_initial_name\n-        return widget.render(name, data, attrs=attrs)\n+        return widget.render(name, self.value(), attrs=attrs)\n \n     def as_text(self, attrs=None, **kwargs):\n         \"\"\"\n@@ -470,6 +461,21 @@ def _data(self):\n         return self.field.widget.value_from_datadict(self.form.data, self.form.files, self.html_name)\n     data = property(_data)\n \n+    def value(self):\n+        \"\"\"\n+        Returns the value for this BoundField, using the initial value if\n+        the form is not bound or the data otherwise.\n+        \"\"\"\n+        if not self.form.is_bound:\n+            data = self.form.initial.get(self.name, self.field.initial)\n+            if callable(data):\n+                data = data()\n+        else:\n+            data = self.field.bound_data(\n+                self.data, self.form.initial.get(self.name, self.field.initial)\n+            )\n+        return self.field.prepare_value(data)\n+\n     def label_tag(self, contents=None, attrs=None):\n         \"\"\"\n         Wraps the given contents in a <label>, if the field has an ID attribute."
        },
        {
            "sha": "5a688b6042ed64f7b4a8c63a9e9edb20a1123d74",
            "filename": "docs/ref/forms/api.txt",
            "status": "modified",
            "additions": 55,
            "deletions": 42,
            "changes": 97,
            "blob_url": "https://github.com/django/django/blob/d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f/docs%2Fref%2Fforms%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f/docs%2Fref%2Fforms%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fapi.txt?ref=d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f",
            "patch": "@@ -584,36 +584,29 @@ More granular output\n The ``as_p()``, ``as_ul()`` and ``as_table()`` methods are simply shortcuts for\n lazy developers -- they're not the only way a form object can be displayed.\n \n-To display the HTML for a single field in your form, use dictionary lookup\n-syntax using the field's name as the key, and print the resulting object::\n+.. class:: BoundField\n \n-    >>> f = ContactForm()\n-    >>> print f['subject']\n-    <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" />\n-    >>> print f['message']\n-    <input type=\"text\" name=\"message\" id=\"id_message\" />\n-    >>> print f['sender']\n-    <input type=\"text\" name=\"sender\" id=\"id_sender\" />\n-    >>> print f['cc_myself']\n-    <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\" />\n+   Used to display HTML or access attributes for a single field of a\n+   :class:`Form` instance.\n+   \n+   The :meth:`__unicode__` and :meth:`__str__` methods of this object displays\n+   the HTML for this field.\n \n-Call ``str()`` or ``unicode()`` on the field to get its rendered HTML as a\n-string or Unicode object, respectively::\n+To retrieve a single ``BoundField``, use dictionary lookup syntax on your form\n+using the field's name as the key::\n \n-    >>> str(f['subject'])\n-    '<input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" />'\n-    >>> unicode(f['subject'])\n-    u'<input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" />'\n+\t>>> form = ContactForm()\n+\t>>> print form['subject']\n+\t<input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" />\n \n-Form objects define a custom ``__iter__()`` method, which allows you to loop\n-through their fields::\n+To retrieve all ``BoundField`` objects, iterate the form::\n \n-    >>> f = ContactForm()\n-    >>> for field in f: print field\n-    <input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" />\n-    <input type=\"text\" name=\"message\" id=\"id_message\" />\n-    <input type=\"text\" name=\"sender\" id=\"id_sender\" />\n-    <input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\" />\n+\t>>> form = ContactForm()\n+\t>>> for boundfield in form: print boundfield\n+\t<input id=\"id_subject\" type=\"text\" name=\"subject\" maxlength=\"100\" />\n+\t<input type=\"text\" name=\"message\" id=\"id_message\" />\n+\t<input type=\"text\" name=\"sender\" id=\"id_sender\" />\n+\t<input type=\"checkbox\" name=\"cc_myself\" id=\"id_cc_myself\" />\n \n The field-specific output honors the form object's ``auto_id`` setting::\n \n@@ -624,26 +617,31 @@ The field-specific output honors the form object's ``auto_id`` setting::\n     >>> print f['message']\n     <input type=\"text\" name=\"message\" id=\"id_message\" />\n \n-For a field's list of errors, access the field's ``errors`` attribute. This\n-is a list-like object that is displayed as an HTML ``<ul class=\"errorlist\">``\n-when printed::\n+For a field's list of errors, access the field's ``errors`` attribute.\n \n-    >>> data = {'subject': 'hi', 'message': '', 'sender': '', 'cc_myself': ''}\n-    >>> f = ContactForm(data, auto_id=False)\n-    >>> print f['message']\n-    <input type=\"text\" name=\"message\" />\n-    >>> f['message'].errors\n-    [u'This field is required.']\n-    >>> print f['message'].errors\n-    <ul class=\"errorlist\"><li>This field is required.</li></ul>\n-    >>> f['subject'].errors\n-    []\n-    >>> print f['subject'].errors\n+.. attribute:: BoundField.errors\n \n-    >>> str(f['subject'].errors)\n-    ''\n+    A list-like object that is displayed as an HTML ``<ul class=\"errorlist\">``\n+    when printed::\n \n-.. versionadded:: 1.2\n+        >>> data = {'subject': 'hi', 'message': '', 'sender': '', 'cc_myself': ''}\n+        >>> f = ContactForm(data, auto_id=False)\n+        >>> print f['message']\n+        <input type=\"text\" name=\"message\" />\n+        >>> f['message'].errors\n+        [u'This field is required.']\n+        >>> print f['message'].errors\n+        <ul class=\"errorlist\"><li>This field is required.</li></ul>\n+        >>> f['subject'].errors\n+        []\n+        >>> print f['subject'].errors\n+\n+        >>> str(f['subject'].errors)\n+\t    ''\n+\n+.. method:: BoundField.css_classes()\n+\n+   .. versionadded:: 1.2\n \n When you use Django's rendering shortcuts, CSS classes are used to\n indicate required form fields or fields that contain errors. If you're\n@@ -662,6 +660,21 @@ those classes as an argument::\n \t>>> f['message'].css_classes('foo bar')\n \t'foo bar required'\n \n+.. method:: BoundField.values()\n+\n+   .. versionadded:: 1.3\n+\n+Use this method to render the raw value of this field as it would be rendered\n+by a ``Widget``::\n+\n+    >>> initial = {'subject': 'welcome'}\n+    >>> unbound_form = ContactForm(initial=initial)\n+    >>> bound_form = ContactForm(data, initial=initial)\n+    >>> print unbound_form['subject'].value\n+    welcome\n+    >>> print bound_form['subject'].value\n+    hi\n+\n .. _binding-uploaded-files:\n \n Binding uploaded files to a form"
        },
        {
            "sha": "91a7472cd19093d6307b95867fd2fa294b2a3074",
            "filename": "tests/regressiontests/forms/tests/forms.py",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py?ref=d3f5f219f5f42ac3504ed626dcb92f4ee2dc3d5f",
            "patch": "@@ -1151,6 +1151,21 @@ class UserRegistration(Form):\n <option value=\"w\">whiz</option>\n </select></li>\"\"\")\n \n+    def test_boundfield_values(self):\n+        # It's possible to get to the value which would be used for rendering\n+        # the widget for a field by using the BoundField's value method.\n+ \n+        class UserRegistration(Form):\n+            username = CharField(max_length=10, initial='djangonaut')\n+            password = CharField(widget=PasswordInput)\n+\n+        unbound = UserRegistration()\n+        bound = UserRegistration({'password': 'foo'})\n+        self.assertEqual(bound['username'].value(), None)\n+        self.assertEqual(unbound['username'].value(), 'djangonaut')\n+        self.assertEqual(bound['password'].value(), 'foo')\n+        self.assertEqual(unbound['password'].value(), None)\n+\n     def test_help_text(self):\n         # You can specify descriptive text for a field by using the 'help_text' argument)\n         class UserRegistration(Form):"
        }
    ],
    "stats": {
        "total": 138,
        "additions": 86,
        "deletions": 52
    }
}