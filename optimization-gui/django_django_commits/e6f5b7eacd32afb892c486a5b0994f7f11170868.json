{
    "author": "claudep",
    "message": "Fixed #9806 -- Allowed editing GeometryField with OpenLayersWidget\n\nThanks Paul Winkler for the initial patch.",
    "sha": "e6f5b7eacd32afb892c486a5b0994f7f11170868",
    "files": [
        {
            "sha": "7e79be18603ab30fb2fcf1f0bcb9477394203096",
            "filename": "django/contrib/gis/admin/options.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/e6f5b7eacd32afb892c486a5b0994f7f11170868/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/e6f5b7eacd32afb892c486a5b0994f7f11170868/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py?ref=e6f5b7eacd32afb892c486a5b0994f7f11170868",
            "patch": "@@ -94,6 +94,7 @@ class OLMap(self.widget):\n                       'scrollable' : self.scrollable,\n                       'layerswitcher' : self.layerswitcher,\n                       'collection_type' : collection_type,\n+                      'is_generic' : db_field.geom_type == 'GEOMETRY',\n                       'is_linestring' : db_field.geom_type in ('LINESTRING', 'MULTILINESTRING'),\n                       'is_polygon' : db_field.geom_type in ('POLYGON', 'MULTIPOLYGON'),\n                       'is_point' : db_field.geom_type in ('POINT', 'MULTIPOINT'),"
        },
        {
            "sha": "ceb8e9c9bd9c9cc6e7c43740657b9d767b3984c3",
            "filename": "django/contrib/gis/admin/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e6f5b7eacd32afb892c486a5b0994f7f11170868/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/e6f5b7eacd32afb892c486a5b0994f7f11170868/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py?ref=e6f5b7eacd32afb892c486a5b0994f7f11170868",
            "patch": "@@ -40,7 +40,8 @@ def render(self, name, value, attrs=None):\n                 )\n                 value = None\n \n-        if value and value.geom_type.upper() != self.geom_type:\n+        if (value and value.geom_type.upper() != self.geom_type and\n+                self.geom_type != 'GEOMETRY'):\n             value = None\n \n         # Constructing the dictionary of the map options."
        },
        {
            "sha": "924621ea49459975357cdf678181bc89394cd30a",
            "filename": "django/contrib/gis/templates/gis/admin/openlayers.js",
            "status": "modified",
            "additions": 12,
            "deletions": 16,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/e6f5b7eacd32afb892c486a5b0994f7f11170868/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js",
            "raw_url": "https://github.com/django/django/raw/e6f5b7eacd32afb892c486a5b0994f7f11170868/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js?ref=e6f5b7eacd32afb892c486a5b0994f7f11170868",
            "patch": "@@ -6,6 +6,7 @@ OpenLayers.Projection.addTransform(\"EPSG:4326\", \"EPSG:3857\", OpenLayers.Layer.Sp\n {{ module }}.wkt_f = new OpenLayers.Format.WKT();\n {{ module }}.is_collection = {{ is_collection|yesno:\"true,false\" }};\n {{ module }}.collection_type = '{{ collection_type }}';\n+{{ module }}.is_generic = {{ is_generic|yesno:\"true,false\" }};\n {{ module }}.is_linestring = {{ is_linestring|yesno:\"true,false\" }};\n {{ module }}.is_polygon = {{ is_polygon|yesno:\"true,false\" }};\n {{ module }}.is_point = {{ is_point|yesno:\"true,false\" }};\n@@ -89,24 +90,19 @@ OpenLayers.Projection.addTransform(\"EPSG:4326\", \"EPSG:3857\", OpenLayers.Layer.Sp\n // Create an array of controls based on geometry type\n {{ module }}.getControls = function(lyr){\n   {{ module }}.panel = new OpenLayers.Control.Panel({'displayClass': 'olControlEditingToolbar'});\n-  var nav = new OpenLayers.Control.Navigation();\n-  var draw_ctl;\n-  if ({{ module }}.is_linestring){\n-    draw_ctl = new OpenLayers.Control.DrawFeature(lyr, OpenLayers.Handler.Path, {'displayClass': 'olControlDrawFeaturePath'});\n-  } else if ({{ module }}.is_polygon){\n-    draw_ctl = new OpenLayers.Control.DrawFeature(lyr, OpenLayers.Handler.Polygon, {'displayClass': 'olControlDrawFeaturePolygon'});\n-  } else if ({{ module }}.is_point){\n-    draw_ctl = new OpenLayers.Control.DrawFeature(lyr, OpenLayers.Handler.Point, {'displayClass': 'olControlDrawFeaturePoint'});\n+  {{ module }}.controls = [new OpenLayers.Control.Navigation()];\n+  if (!{{ module }}.modifiable && lyr.features.length) return;\n+  if ({{ module }}.is_linestring || {{ module }}.is_generic){\n+    {{ module }}.controls.push(new OpenLayers.Control.DrawFeature(lyr, OpenLayers.Handler.Path, {'displayClass': 'olControlDrawFeaturePath'}));\n+  }\n+  if ({{ module }}.is_polygon || {{ module }}.is_generic){\n+    {{ module }}.controls.push(new OpenLayers.Control.DrawFeature(lyr, OpenLayers.Handler.Polygon, {'displayClass': 'olControlDrawFeaturePolygon'}));\n+  }\n+  if ({{ module }}.is_point || {{ module }}.is_generic){\n+    {{ module }}.controls.push(new OpenLayers.Control.DrawFeature(lyr, OpenLayers.Handler.Point, {'displayClass': 'olControlDrawFeaturePoint'}));\n   }\n   if ({{ module }}.modifiable){\n-    var mod = new OpenLayers.Control.ModifyFeature(lyr, {'displayClass': 'olControlModifyFeature'});\n-    {{ module }}.controls = [nav, draw_ctl, mod];\n-  } else {\n-    if(!lyr.features.length){\n-      {{ module }}.controls = [nav, draw_ctl];\n-    } else {\n-      {{ module }}.controls = [nav];\n-    }\n+    {{ module }}.controls.push(new OpenLayers.Control.ModifyFeature(lyr, {'displayClass': 'olControlModifyFeature'}));\n   }\n };\n {{ module }}.init = function(){"
        },
        {
            "sha": "dd7a9a463e4499465109efe97b1f53750de5b776",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e6f5b7eacd32afb892c486a5b0994f7f11170868/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/e6f5b7eacd32afb892c486a5b0994f7f11170868/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=e6f5b7eacd32afb892c486a5b0994f7f11170868",
            "patch": "@@ -134,6 +134,9 @@ Minor features\n * SimpleLazyObjects will now present more helpful representations in shell\n   debugging situations.\n \n+* Generic :class:`~django.contrib.gis.db.models.GeometryField` is now editable\n+  with the OpenLayers widget in the admin.\n+\n Backwards incompatible changes in 1.6\n =====================================\n "
        }
    ],
    "stats": {
        "total": 35,
        "additions": 18,
        "deletions": 17
    }
}