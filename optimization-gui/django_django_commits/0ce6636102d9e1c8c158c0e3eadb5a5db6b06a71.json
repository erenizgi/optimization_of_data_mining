{
    "author": "carljm",
    "message": "Fixed #17277 - Wrap IOErrors raised due to client disconnect in a specific IOError subclass so they can be distinguished from more serious errors. Thanks David Lowe.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17493 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71",
    "files": [
        {
            "sha": "60a92d5f1c725422707784864aa0c307dba7421d",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71",
            "patch": "@@ -3,6 +3,7 @@\n import datetime\n import os\n import re\n+import sys\n import time\n import warnings\n \n@@ -177,6 +178,8 @@ def build_request_repr(request, path_override=None, GET_override=None,\n                       unicode(cookies),\n                       unicode(meta)))\n \n+class UnreadablePostError(IOError):\n+    pass\n \n class HttpRequest(object):\n     \"\"\"A basic HTTP request.\"\"\"\n@@ -321,7 +324,10 @@ def body(self):\n         if not hasattr(self, '_body'):\n             if self._read_started:\n                 raise Exception(\"You cannot access body after reading from request's data stream\")\n-            self._body = self.read()\n+            try:\n+                self._body = self.read()\n+            except IOError, e:\n+                raise UnreadablePostError, e, sys.exc_traceback\n             self._stream = StringIO(self._body)\n         return self._body\n "
        },
        {
            "sha": "d4239448dd9298ef888a74a4f1698fcd8e727491",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=0ce6636102d9e1c8c158c0e3eadb5a5db6b06a71",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import with_statement\n+\n import time\n import warnings\n from datetime import datetime, timedelta\n@@ -6,7 +8,7 @@\n from django.conf import settings\n from django.core.handlers.modpython import ModPythonRequest\n from django.core.handlers.wsgi import WSGIRequest, LimitedStream\n-from django.http import HttpRequest, HttpResponse, parse_cookie, build_request_repr\n+from django.http import HttpRequest, HttpResponse, parse_cookie, build_request_repr, UnreadablePostError\n from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils import unittest\n from django.utils.http import cookie_date\n@@ -430,3 +432,21 @@ def test_raw_post_data_returns_body(self):\n             self.assertEqual(request.body, request.raw_post_data)\n         finally:\n             restore_warnings_state(warnings_state)\n+\n+\n+    def test_POST_connection_error(self):\n+        \"\"\"\n+        If wsgi.input.read() raises an exception while trying to read() the\n+        POST, the exception should be identifiable (not a generic IOError).\n+        \"\"\"\n+        class ExplodingStringIO(StringIO):\n+            def read(self, len=0):\n+                raise IOError(\"kaboom!\")\n+\n+        payload = 'name=value'\n+        request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_LENGTH': len(payload),\n+                               'wsgi.input': ExplodingStringIO(payload)})\n+\n+        with self.assertRaises(UnreadablePostError):\n+            request.raw_post_data"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 28,
        "deletions": 2
    }
}