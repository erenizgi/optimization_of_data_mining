{
    "author": "freakboy3742",
    "message": "Fixed #14698 -- Ensure that module_has_sumodule doesn't mistake a cache miss for an existent package. Thanks to ≈Åukasz Rekucki for the report and patch, and to shields for the test case.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15362 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "56ebab9d8596f63db38053816ec961656e49ed38",
    "files": [
        {
            "sha": "32ca69a9fd77813a10c3c73bcf3a0d9c1c813cd7",
            "filename": "django/utils/module_loading.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/56ebab9d8596f63db38053816ec961656e49ed38/django%2Futils%2Fmodule_loading.py",
            "raw_url": "https://github.com/django/django/raw/56ebab9d8596f63db38053816ec961656e49ed38/django%2Futils%2Fmodule_loading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fmodule_loading.py?ref=56ebab9d8596f63db38053816ec961656e49ed38",
            "patch": "@@ -6,8 +6,11 @@\n def module_has_submodule(package, module_name):\n     \"\"\"See if 'module' is in 'package'.\"\"\"\n     name = \".\".join([package.__name__, module_name])\n-    if name in sys.modules:\n-        return True\n+    try:\n+        # None indicates a cached miss; see mark_miss() in Python/import.c.\n+        return sys.modules[name] is not None\n+    except KeyError:\n+        pass\n     for finder in sys.meta_path:\n         if finder.find_module(name):\n             return True"
        },
        {
            "sha": "24c0b0753f8018d6b3f27bdb8c2acb714ddb1390",
            "filename": "tests/regressiontests/utils/module_loading.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/56ebab9d8596f63db38053816ec961656e49ed38/tests%2Fregressiontests%2Futils%2Fmodule_loading.py",
            "raw_url": "https://github.com/django/django/raw/56ebab9d8596f63db38053816ec961656e49ed38/tests%2Fregressiontests%2Futils%2Fmodule_loading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fmodule_loading.py?ref=56ebab9d8596f63db38053816ec961656e49ed38",
            "patch": "@@ -25,6 +25,10 @@ def test_loader(self):\n         self.assertFalse(module_has_submodule(test_module, 'no_such_module'))\n         self.assertRaises(ImportError, import_module, 'regressiontests.utils.test_module.no_such_module')\n \n+        # Don't be confused by caching of import misses\n+        import types  # causes attempted import of regressiontests.utils.types\n+        self.assertFalse(module_has_submodule(sys.modules['regressiontests.utils'], 'types'))\n+\n class EggLoader(unittest.TestCase):\n     def setUp(self):\n         self.old_path = sys.path[:]"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 9,
        "deletions": 2
    }
}