{
    "author": "carljm",
    "message": "Reorganized proxy-delete tests for easier addition of new tests. Refs #16128.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17755 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "edcaf8b7ffb035c3b699b6fb72a0d467e5ec2474",
    "files": [
        {
            "sha": "889fba81bed5faa05ac8b7325f2e9ea265fe5f9d",
            "filename": "tests/regressiontests/delete_regress/tests.py",
            "status": "modified",
            "additions": 30,
            "deletions": 36,
            "changes": 66,
            "blob_url": "https://github.com/django/django/blob/edcaf8b7ffb035c3b699b6fb72a0d467e5ec2474/tests%2Fregressiontests%2Fdelete_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/edcaf8b7ffb035c3b699b6fb72a0d467e5ec2474/tests%2Fregressiontests%2Fdelete_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdelete_regress%2Ftests.py?ref=edcaf8b7ffb035c3b699b6fb72a0d467e5ec2474",
            "patch": "@@ -152,28 +152,35 @@ def test_large_deletes(self):\n \n class ProxyDeleteTest(TestCase):\n     \"\"\"\n-    Tests on_delete behavior for proxy models. Deleting the *proxy*\n-    instance bubbles through to its non-proxy and *all* referring objects\n-    are deleted.\n+    Tests on_delete behavior for proxy models.\n \n     See #16128.\n \n     \"\"\"\n-\n-    def setUp(self):\n+    def create_image(self):\n+        \"\"\"Return an Image referenced by both a FooImage and a FooFile.\"\"\"\n         # Create an Image\n-        self.test_image = Image()\n-        self.test_image.save()\n-        foo_image = FooImage(my_image=self.test_image)\n+        test_image = Image()\n+        test_image.save()\n+        foo_image = FooImage(my_image=test_image)\n         foo_image.save()\n \n         # Get the Image instance as a File\n-        test_file = File.objects.get(pk=self.test_image.pk)\n+        test_file = File.objects.get(pk=test_image.pk)\n         foo_file = FooFile(my_file=test_file)\n         foo_file.save()\n \n+        return test_image\n+\n+\n+    def test_delete_proxy(self):\n+        \"\"\"\n+        Deleting the *proxy* instance bubbles through to its non-proxy and\n+        *all* referring objects are deleted.\n+\n+        \"\"\"\n+        self.create_image()\n \n-    def test_delete(self):\n         Image.objects.all().delete()\n \n         # An Image deletion == File deletion\n@@ -185,28 +192,19 @@ def test_delete(self):\n         self.assertEqual(len(FooFile.objects.all()), 0)\n \n \n+    def test_delete_proxy_of_proxy(self):\n+        \"\"\"\n+        Deleting a proxy-of-proxy instance should bubble through to its proxy\n+        and non-proxy parents, deleting *all* referring objects.\n \n-class ProxyOfProxyDeleteTest(ProxyDeleteTest):\n-    \"\"\"\n-    Tests on_delete behavior for proxy-of-proxy models. Deleting the *proxy*\n-    instance should bubble through to its proxy and non-proxy variants.\n-    Deleting *all* referring objects.\n-\n-    See #16128.\n-\n-    \"\"\"\n-\n-    def setUp(self):\n-        # Create the Image, FooImage and FooFile instances\n-        super(ProxyOfProxyDeleteTest, self).setUp()\n+        \"\"\"\n+        test_image = self.create_image()\n \n         # Get the Image as a Photo\n-        test_photo = Photo.objects.get(pk=self.test_image.pk)\n+        test_photo = Photo.objects.get(pk=test_image.pk)\n         foo_photo = FooPhoto(my_photo=test_photo)\n         foo_photo.save()\n \n-\n-    def test_delete(self):\n         Photo.objects.all().delete()\n \n         # A Photo deletion == Image deletion == File deletion\n@@ -221,18 +219,14 @@ def test_delete(self):\n         self.assertEqual(len(FooImage.objects.all()), 0)\n \n \n+    def test_delete_concrete_parent(self):\n+        \"\"\"\n+        Deleting an instance of a concrete model should also delete objects\n+        referencing its proxy subclass.\n \n-class ProxyParentDeleteTest(ProxyDeleteTest):\n-    \"\"\"\n-    Tests on_delete cascade behavior for proxy models. Deleting the\n-    *non-proxy* instance of a model should delete objects referencing the\n-    proxy.\n-\n-    See #16128.\n-\n-    \"\"\"\n+        \"\"\"\n+        self.create_image()\n \n-    def test_delete(self):\n         File.objects.all().delete()\n \n         # A File deletion == Image deletion"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 30,
        "deletions": 36
    }
}