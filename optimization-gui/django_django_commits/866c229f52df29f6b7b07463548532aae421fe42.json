{
    "author": "aaugustin",
    "message": "Fixed #17294 -- Supported nullable DateTimeFields when time zone support is enabled. Thanks pressureman for the report.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17148 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "866c229f52df29f6b7b07463548532aae421fe42",
    "files": [
        {
            "sha": "04b13aa5c88cdabd166fbbae541b6b917ab642fb",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/866c229f52df29f6b7b07463548532aae421fe42/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/866c229f52df29f6b7b07463548532aae421fe42/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=866c229f52df29f6b7b07463548532aae421fe42",
            "patch": "@@ -786,7 +786,7 @@ def pre_save(self, model_instance, add):\n \n     def get_prep_value(self, value):\n         value = self.to_python(value)\n-        if settings.USE_TZ and timezone.is_naive(value):\n+        if value is not None and settings.USE_TZ and timezone.is_naive(value):\n             # For backwards compatibility, interpret naive datetimes in local\n             # time. This won't work during DST change, but we can't do much\n             # about it, so we let the exceptions percolate up the call stack."
        },
        {
            "sha": "0476d46f7ec76409deca9725f98699e0b8f81e0f",
            "filename": "django/utils/timezone.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/866c229f52df29f6b7b07463548532aae421fe42/django%2Futils%2Ftimezone.py",
            "raw_url": "https://github.com/django/django/raw/866c229f52df29f6b7b07463548532aae421fe42/django%2Futils%2Ftimezone.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimezone.py?ref=866c229f52df29f6b7b07463548532aae421fe42",
            "patch": "@@ -228,6 +228,9 @@ def now():\n     else:\n         return datetime.now()\n \n+# By design, these four functions don't perform any checks on their arguments.\n+# The caller should ensure that they don't receive an invalid value like None.\n+\n def is_aware(value):\n     \"\"\"\n     Determines if a given datetime.datetime is aware."
        },
        {
            "sha": "9296edf92494d9f339cd01aa89298ffc88804a7c",
            "filename": "tests/modeltests/timezones/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/866c229f52df29f6b7b07463548532aae421fe42/tests%2Fmodeltests%2Ftimezones%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/866c229f52df29f6b7b07463548532aae421fe42/tests%2Fmodeltests%2Ftimezones%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftimezones%2Fmodels.py?ref=866c229f52df29f6b7b07463548532aae421fe42",
            "patch": "@@ -3,6 +3,9 @@\n class Event(models.Model):\n     dt = models.DateTimeField()\n \n+class MaybeEvent(models.Model):\n+    dt = models.DateTimeField(blank=True, null=True)\n+\n class Timestamp(models.Model):\n     created = models.DateTimeField(auto_now_add=True)\n     updated = models.DateTimeField(auto_now=True)"
        },
        {
            "sha": "5d86e9322eb2ab1484bacac99df7c19e5e5a9af9",
            "filename": "tests/modeltests/timezones/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/866c229f52df29f6b7b07463548532aae421fe42/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/866c229f52df29f6b7b07463548532aae421fe42/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftimezones%2Ftests.py?ref=866c229f52df29f6b7b07463548532aae421fe42",
            "patch": "@@ -25,7 +25,7 @@\n from django.utils.unittest import skipIf\n \n from .forms import EventForm, EventSplitForm, EventModelForm\n-from .models import Event, Timestamp\n+from .models import Event, MaybeEvent, Timestamp\n \n \n # These tests use the EAT (Eastern Africa Time) and ICT (Indochina Time)\n@@ -403,6 +403,11 @@ def test_query_dates(self):\n                  datetime.datetime(2011, 1, 1, tzinfo=UTC)],\n                 transform=lambda d: d)\n \n+    def test_null_datetime(self):\n+        # Regression for #17294\n+        e = MaybeEvent.objects.create()\n+        self.assertEqual(e.dt, None)\n+\n NewDatabaseTests = override_settings(USE_TZ=True)(NewDatabaseTests)\n \n "
        }
    ],
    "stats": {
        "total": 15,
        "additions": 13,
        "deletions": 2
    }
}