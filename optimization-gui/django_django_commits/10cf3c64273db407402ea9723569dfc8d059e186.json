{
    "author": "claudep",
    "message": "Used catch_warnings instead of save/restore methods. Refs #17049.",
    "sha": "10cf3c64273db407402ea9723569dfc8d059e186",
    "files": [
        {
            "sha": "88828e8a38fec45efb9850fffbbaf3017a64de48",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 13,
            "deletions": 14,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -7,16 +7,12 @@\n from django.contrib.formtools import preview, utils\n from django.contrib.formtools.wizard import FormWizard\n from django.test import TestCase\n-from django.test.utils import get_warnings_state, restore_warnings_state\n from django.test.utils import override_settings\n from django.utils import unittest\n \n from django.contrib.formtools.tests.wizard import *\n from django.contrib.formtools.tests.forms import *\n \n-warnings.filterwarnings('ignore', category=PendingDeprecationWarning,\n-                        module='django.contrib.formtools.wizard')\n-\n success_string = \"Done was called!\"\n \n class TestFormPreview(preview.FormPreview):\n@@ -41,20 +37,12 @@ class PreviewTests(TestCase):\n \n     def setUp(self):\n         super(PreviewTests, self).setUp()\n-        self.save_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning,\n-                                module='django.contrib.formtools.wizard.legacy')\n-\n         # Create a FormPreview instance to share between tests\n         self.preview = preview.FormPreview(TestForm)\n         input_template = '<input type=\"hidden\" name=\"%s\" value=\"%s\" />'\n         self.input = input_template % (self.preview.unused_name('stage'), \"%d\")\n         self.test_data = {'field1':u'foo', 'field1_':u'asdf'}\n \n-    def tearDown(self):\n-        super(PreviewTests, self).tearDown()\n-        self.restore_warnings_state()\n-\n     def test_unused_name(self):\n         \"\"\"\n         Verifies name mangling to get uniue field name.\n@@ -130,8 +118,9 @@ def test_bool_submit(self):\n         self.test_data.update({'stage':2})\n         hash = self.preview.security_hash(None, TestForm(self.test_data))\n         self.test_data.update({'hash':hash, 'bool1':u'False'})\n-        response = self.client.post('/preview/', self.test_data)\n-        self.assertEqual(response.content, success_string)\n+        with warnings.catch_warnings(record=True):\n+            response = self.client.post('/preview/', self.test_data)\n+            self.assertEqual(response.content, success_string)\n \n     def test_form_submit_good_hash(self):\n         \"\"\"\n@@ -241,6 +230,16 @@ class WizardTests(TestCase):\n         }\n     )\n \n+    def setUp(self):\n+        super(WizardTests, self).setUp()\n+        self.save_warnings_state()\n+        warnings.filterwarnings('ignore', category=DeprecationWarning,\n+                                module='django.contrib.formtools.wizard')\n+\n+    def tearDown(self):\n+        super(WizardTests, self).tearDown()\n+        self.restore_warnings_state()\n+\n     def test_step_starts_at_zero(self):\n         \"\"\"\n         step should be zero for the first form"
        },
        {
            "sha": "f31c056e6591bf4361d2c3a300a3d9505a07e9af",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 14,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -12,11 +12,10 @@\n from django.contrib.sessions.backends.signed_cookies import SessionStore as CookieSession\n from django.contrib.sessions.models import Session\n from django.contrib.sessions.middleware import SessionMiddleware\n-from django.core.cache.backends.base import CacheKeyWarning\n from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.http import HttpResponse\n from django.test import TestCase, RequestFactory\n-from django.test.utils import override_settings, get_warnings_state, restore_warnings_state\n+from django.test.utils import override_settings\n from django.utils import timezone\n from django.utils import unittest\n \n@@ -302,12 +301,10 @@ def test_exists_searches_cache_first(self):\n             self.assertTrue(self.session.exists(self.session.session_key))\n \n     def test_load_overlong_key(self):\n-        warnings_state = get_warnings_state()\n-        warnings.filterwarnings('ignore',\n-                                category=CacheKeyWarning)\n-        self.session._session_key = (string.ascii_letters + string.digits) * 20\n-        self.assertEqual(self.session.load(), {})\n-        restore_warnings_state(warnings_state)\n+        with warnings.catch_warnings(record=True) as w:\n+            self.session._session_key = (string.ascii_letters + string.digits) * 20\n+            self.assertEqual(self.session.load(), {})\n+            self.assertEqual(len(w), 1)\n \n \n @override_settings(USE_TZ=True)\n@@ -353,12 +350,10 @@ class CacheSessionTests(SessionTestsMixin, unittest.TestCase):\n     backend = CacheSession\n \n     def test_load_overlong_key(self):\n-        warnings_state = get_warnings_state()\n-        warnings.filterwarnings('ignore',\n-                                category=CacheKeyWarning)\n-        self.session._session_key = (string.ascii_letters + string.digits) * 20\n-        self.assertEqual(self.session.load(), {})\n-        restore_warnings_state(warnings_state)\n+        with warnings.catch_warnings(record=True) as w:\n+            self.session._session_key = (string.ascii_letters + string.digits) * 20\n+            self.assertEqual(self.session.load(), {})\n+            self.assertEqual(len(w), 1)\n \n \n class SessionMiddlewareTests(unittest.TestCase):"
        },
        {
            "sha": "f0e2977b31326eb550b7891aa7c127d07f39e3b7",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -466,20 +466,19 @@ def func(key, *args):\n \n         old_func = self.cache.key_func\n         self.cache.key_func = func\n-        # On Python 2.6+ we could use the catch_warnings context\n-        # manager to test this warning nicely. Since we can't do that\n-        # yet, the cleanest option is to temporarily ask for\n-        # CacheKeyWarning to be raised as an exception.\n-        _warnings_state = get_warnings_state()\n-        warnings.simplefilter(\"error\", CacheKeyWarning)\n \n         try:\n-            # memcached does not allow whitespace or control characters in keys\n-            self.assertRaises(CacheKeyWarning, self.cache.set, 'key with spaces', 'value')\n-            # memcached limits key length to 250\n-            self.assertRaises(CacheKeyWarning, self.cache.set, 'a' * 251, 'value')\n+            with warnings.catch_warnings(record=True) as w:\n+                # memcached does not allow whitespace or control characters in keys\n+                self.cache.set('key with spaces', 'value')\n+                self.assertEqual(len(w), 2)\n+                self.assertTrue(isinstance(w[0].message, CacheKeyWarning))\n+            with warnings.catch_warnings(record=True) as w:\n+                # memcached limits key length to 250\n+                self.cache.set('a' * 251, 'value')\n+                self.assertEqual(len(w), 1)\n+                self.assertTrue(isinstance(w[0].message, CacheKeyWarning))\n         finally:\n-            restore_warnings_state(_warnings_state)\n             self.cache.key_func = old_func\n \n     def test_cache_versioning_get_set(self):\n@@ -1450,7 +1449,8 @@ def setUp(self):\n         self.default_cache = get_cache('default')\n         self.other_cache = get_cache('other')\n         self.save_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning, module='django.views.decorators.cache')\n+        warnings.filterwarnings('ignore', category=DeprecationWarning,\n+            module='django.views.decorators.cache')\n \n     def tearDown(self):\n         self.restore_warnings_state()"
        },
        {
            "sha": "975502273a41f9601661f8aee555c1f6dcdbc7dc",
            "filename": "tests/regressiontests/decorators/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 17,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdecorators%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -5,7 +5,6 @@\n from django.contrib.auth.decorators import login_required, permission_required, user_passes_test\n from django.http import HttpResponse, HttpRequest, HttpResponseNotAllowed\n from django.middleware.clickjacking import XFrameOptionsMiddleware\n-from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils.decorators import method_decorator\n from django.utils.functional import allow_lazy, lazy, memoize\n from django.utils.unittest import TestCase\n@@ -68,14 +67,6 @@ def _inner(*args, **kwargs):\n \n class DecoratorsTest(TestCase):\n \n-    def setUp(self):\n-        self.warning_state = get_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning,\n-                                module='django.views.decorators.cache')\n-\n-    def tearDown(self):\n-        restore_warnings_state(self.warning_state)\n-\n     def test_attributes(self):\n         \"\"\"\n         Tests that django decorators set certain attributes of the wrapped\n@@ -131,14 +122,16 @@ def test_cache_page_old_style(self):\n         \"\"\"\n         def my_view(request):\n             return \"response\"\n-        my_view_cached = cache_page(my_view, 123)\n-        self.assertEqual(my_view_cached(HttpRequest()), \"response\")\n-        my_view_cached2 = cache_page(my_view, 123, key_prefix=\"test\")\n-        self.assertEqual(my_view_cached2(HttpRequest()), \"response\")\n-        my_view_cached3 = cache_page(my_view)\n-        self.assertEqual(my_view_cached3(HttpRequest()), \"response\")\n-        my_view_cached4 = cache_page()(my_view)\n-        self.assertEqual(my_view_cached4(HttpRequest()), \"response\")\n+        with warnings.catch_warnings(record=True) as w:\n+            my_view_cached = cache_page(my_view, 123)\n+            self.assertEqual(my_view_cached(HttpRequest()), \"response\")\n+            my_view_cached2 = cache_page(my_view, 123, key_prefix=\"test\")\n+            self.assertEqual(my_view_cached2(HttpRequest()), \"response\")\n+            my_view_cached3 = cache_page(my_view)\n+            self.assertEqual(my_view_cached3(HttpRequest()), \"response\")\n+            my_view_cached4 = cache_page()(my_view)\n+            self.assertEqual(my_view_cached4(HttpRequest()), \"response\")\n+            self.assertEqual(len(w), 4)\n \n     def test_require_safe_accepts_only_safe_methods(self):\n         \"\"\""
        },
        {
            "sha": "a7d98ec7d48345824d5f40d59f6ac978657c644c",
            "filename": "tests/regressiontests/forms/tests/fields.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -28,7 +28,6 @@\n import pickle\n import re\n import os\n-import warnings\n from decimal import Decimal\n \n from django.core.files.uploadedfile import SimpleUploadedFile"
        },
        {
            "sha": "91d4c29eb2e746481994337ad81dc8d918bface4",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -10,14 +10,6 @@\n from .models import Book, BookSigning\n \n \n-import warnings\n-warnings.filterwarnings(\n-        'error', r\"DateTimeField received a naive datetime\",\n-        RuntimeWarning, r'django\\.db\\.models\\.fields')\n-\n-\n-\n-\n class ArchiveIndexViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'"
        },
        {
            "sha": "8ef7377ecc466b5ca1a2f894f90057b81d459889",
            "filename": "tests/regressiontests/i18n/patterns/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -1,5 +1,4 @@\n import os\n-import warnings\n \n from django.core.exceptions import ImproperlyConfigured\n from django.core.urlresolvers import reverse, clear_url_caches"
        },
        {
            "sha": "e4c045b9d8aaa97e9464fffb195c05e0870504a3",
            "filename": "tests/regressiontests/logging_tests/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flogging_tests%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -4,7 +4,7 @@\n from django.conf import compat_patch_logging_config\n from django.core import mail\n from django.test import TestCase, RequestFactory\n-from django.test.utils import override_settings, get_warnings_state, restore_warnings_state\n+from django.test.utils import override_settings\n from django.utils.log import CallbackFilter, RequireDebugFalse, getLogger\n \n \n@@ -42,12 +42,9 @@ def test_filter_added(self):\n         \"\"\"\n         config = copy.deepcopy(OLD_LOGGING)\n \n-        warnings_state = get_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning, module='django.conf')\n-        try:\n+        with warnings.catch_warnings(record=True) as w:\n             compat_patch_logging_config(config)\n-        finally:\n-            restore_warnings_state(warnings_state)\n+            self.assertEqual(len(w), 1)\n \n         self.assertEqual(\n             config[\"handlers\"][\"mail_admins\"][\"filters\"],\n@@ -60,7 +57,8 @@ def test_filter_configuration(self):\n \n         \"\"\"\n         config = copy.deepcopy(OLD_LOGGING)\n-        compat_patch_logging_config(config)\n+        with warnings.catch_warnings(record=True):\n+            compat_patch_logging_config(config)\n \n         flt = config[\"filters\"][\"require_debug_false\"]\n         self.assertEqual(flt[\"()\"], \"django.utils.log.RequireDebugFalse\")"
        },
        {
            "sha": "d1c089672005442578495e64875bd1006c434d95",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -6,7 +6,6 @@\n from django.conf import settings\n from django.core.handlers.wsgi import WSGIRequest, LimitedStream\n from django.http import HttpRequest, HttpResponse, parse_cookie, build_request_repr, UnreadablePostError\n-from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils import unittest\n from django.utils.http import cookie_date\n from django.utils.timezone import utc\n@@ -398,13 +397,9 @@ def test_raw_post_data_returns_body(self):\n             'wsgi.input': StringIO(payload)\n         })\n \n-        warnings_state = get_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning, module='django.http')\n-        try:\n+        with warnings.catch_warnings(record=True) as w:\n             self.assertEqual(request.body, request.raw_post_data)\n-        finally:\n-            restore_warnings_state(warnings_state)\n-\n+            self.assertEqual(len(w), 1)\n \n     def test_POST_connection_error(self):\n         \"\"\"\n@@ -420,10 +415,7 @@ def read(self, len=0):\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': ExplodingStringIO(payload)})\n \n-        warnings_state = get_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning, module='django.http')\n-        try:\n+        with warnings.catch_warnings(record=True) as w:\n             with self.assertRaises(UnreadablePostError):\n                 request.raw_post_data\n-        finally:\n-            restore_warnings_state(warnings_state)\n+            self.assertEqual(len(w), 1)"
        },
        {
            "sha": "7f30cb987a73934f673d73ece9dedfae90c9c856",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -6,7 +6,6 @@\n import shutil\n import sys\n import tempfile\n-import warnings\n from StringIO import StringIO\n \n from django.template import loader, Context\n@@ -511,11 +510,8 @@ def test_cache_key_memcache_validation(self):\n         \"\"\"\n         name = \"/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/\" + chr(22) + chr(180)\n         cache_key = storage.staticfiles_storage.cache_key(name)\n-        self.save_warnings_state()\n         cache_validator = BaseCache({})\n-        warnings.filterwarnings('error', category=CacheKeyWarning)\n         cache_validator.validate_key(cache_key)\n-        self.restore_warnings_state()\n         self.assertEqual(cache_key, 'staticfiles:e95bbc36387084582df2a70750d7b351')\n \n "
        },
        {
            "sha": "ab625a90dcf33c8e716419e45a3b6cd0c44264c9",
            "filename": "tests/regressiontests/test_client_regress/views.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -1,5 +1,4 @@\n import json\n-import warnings\n \n from django.conf import settings\n from django.contrib.auth.decorators import login_required"
        },
        {
            "sha": "6457845c6f7b74180b5d06a48ce24b830b566812",
            "filename": "tests/regressiontests/utils/text.py",
            "status": "modified",
            "additions": 18,
            "deletions": 21,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/10cf3c64273db407402ea9723569dfc8d059e186/tests%2Fregressiontests%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftext.py?ref=10cf3c64273db407402ea9723569dfc8d059e186",
            "patch": "@@ -8,13 +8,6 @@ class TestUtilsText(SimpleTestCase):\n \n     # In Django 1.6 truncate_words() and truncate_html_words() will be removed\n     # so these tests will need to be adapted accordingly\n-    def setUp(self):\n-        self.save_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning, module='django.utils.text')\n-\n-    def tearDown(self):\n-        self.restore_warnings_state()\n-\n     def test_truncate_chars(self):\n         truncator = text.Truncator(\n             u'The quick brown fox jumped over the lazy dog.'\n@@ -79,22 +72,26 @@ def test_truncate_html_words(self):\n             'id=\"mylink\">brown...</a></p>', truncator.words(3, '...', html=True))\n \n     def test_old_truncate_words(self):\n-        self.assertEqual(u'The quick brown fox jumped over the lazy dog.',\n-            text.truncate_words(u'The quick brown fox jumped over the lazy dog.', 10))\n-        self.assertEqual(u'The quick brown fox ...',\n-            text.truncate_words('The quick brown fox jumped over the lazy dog.', 4))\n-        self.assertEqual(u'The quick brown fox ....',\n-            text.truncate_words('The quick brown fox jumped over the lazy dog.', 4, '....'))\n+        with warnings.catch_warnings(record=True) as w:\n+            self.assertEqual(u'The quick brown fox jumped over the lazy dog.',\n+                text.truncate_words(u'The quick brown fox jumped over the lazy dog.', 10))\n+            self.assertEqual(u'The quick brown fox ...',\n+                text.truncate_words('The quick brown fox jumped over the lazy dog.', 4))\n+            self.assertEqual(u'The quick brown fox ....',\n+                text.truncate_words('The quick brown fox jumped over the lazy dog.', 4, '....'))\n+            self.assertEqual(len(w), 3)\n \n     def test_old_truncate_html_words(self):\n-        self.assertEqual(u'<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>',\n-            text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 10))\n-        self.assertEqual(u'<p><strong><em>The quick brown fox ...</em></strong></p>',\n-            text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 4))\n-        self.assertEqual(u'<p><strong><em>The quick brown fox ....</em></strong></p>',\n-            text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 4, '....'))\n-        self.assertEqual(u'<p><strong><em>The quick brown fox</em></strong></p>',\n-            text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 4, None))\n+        with warnings.catch_warnings(record=True) as w:\n+            self.assertEqual(u'<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>',\n+                text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 10))\n+            self.assertEqual(u'<p><strong><em>The quick brown fox ...</em></strong></p>',\n+                text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 4))\n+            self.assertEqual(u'<p><strong><em>The quick brown fox ....</em></strong></p>',\n+                text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 4, '....'))\n+            self.assertEqual(u'<p><strong><em>The quick brown fox</em></strong></p>',\n+                text.truncate_html_words('<p><strong><em>The quick brown fox jumped over the lazy dog.</em></strong></p>', 4, None))\n+            self.assertEqual(len(w), 4)\n \n     def test_wrap(self):\n         digits = '1234 67 9'"
        }
    ],
    "stats": {
        "total": 183,
        "additions": 71,
        "deletions": 112
    }
}