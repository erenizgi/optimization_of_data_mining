{
    "author": "claudep",
    "message": "Fixed #15076 -- Quoted ForeignKey target class names in inspectdb when class is defined below.\n\nThanks saschwarz for the report, jeff@deserettechnology.com for the initial patch and Ramiro Morales for the review. \n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17942 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "ddc5d59c6a547f76797d99510df8c3cec61e5f89",
    "files": [
        {
            "sha": "af2da451545b30e442bad911c65657376f83d452",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/ddc5d59c6a547f76797d99510df8c3cec61e5f89/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/ddc5d59c6a547f76797d99510df8c3cec61e5f89/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=ddc5d59c6a547f76797d99510df8c3cec61e5f89",
            "patch": "@@ -41,8 +41,10 @@ def handle_inspection(self, options):\n         yield ''\n         yield 'from %s import models' % self.db_module\n         yield ''\n+        known_models = []\n         for table_name in connection.introspection.get_table_list(cursor):\n             yield 'class %s(models.Model):' % table2model(table_name)\n+            known_models.append(table2model(table_name))\n             try:\n                 relations = connection.introspection.get_relations(cursor, table_name)\n             except NotImplementedError:\n@@ -83,7 +85,12 @@ def handle_inspection(self, options):\n \n                 if i in relations:\n                     rel_to = relations[i][1] == table_name and \"'self'\" or table2model(relations[i][1])\n-                    field_type = 'ForeignKey(%s' % rel_to\n+\n+                    if rel_to in known_models:\n+                        field_type = 'ForeignKey(%s' % rel_to\n+                    else:\n+                        field_type = \"ForeignKey('%s'\" % rel_to\n+\n                     if att_name.endswith('_id'):\n                         att_name = att_name[:-3]\n                     else:"
        },
        {
            "sha": "6896bf9126ca09ec521ffe114c59186567081e8a",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/ddc5d59c6a547f76797d99510df8c3cec61e5f89/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ddc5d59c6a547f76797d99510df8c3cec61e5f89/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=ddc5d59c6a547f76797d99510df8c3cec61e5f89",
            "patch": "@@ -12,7 +12,8 @@ def test_attribute_name_not_python_keyword(self):\n         call_command('inspectdb', stdout=out)\n         error_message = \"inspectdb generated an attribute name which is a python keyword\"\n         self.assertNotIn(\"from = models.ForeignKey(InspectdbPeople)\", out.getvalue(), msg=error_message)\n-        self.assertIn(\"from_field = models.ForeignKey(InspectdbPeople)\", out.getvalue())\n+        # As InspectdbPeople model is defined after InspectdbMessage, it should be quoted\n+        self.assertIn(\"from_field = models.ForeignKey('InspectdbPeople')\", out.getvalue())\n         self.assertIn(\"people_pk = models.ForeignKey(InspectdbPeople, primary_key=True)\",\n             out.getvalue())\n         self.assertIn(\"people_unique = models.ForeignKey(InspectdbPeople, unique=True)\","
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}