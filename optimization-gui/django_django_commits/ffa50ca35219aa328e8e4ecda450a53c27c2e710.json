{
    "author": "claudep",
    "message": "Fixed #19382 -- Stopped smtp backend raising exception when already closed\n\nThanks Sebastian Noack for the report and the initial patch.",
    "sha": "ffa50ca35219aa328e8e4ecda450a53c27c2e710",
    "files": [
        {
            "sha": "3ae08f4340dcbf6add74cb38202b3c3f23c073be",
            "filename": "django/core/mail/backends/smtp.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/ffa50ca35219aa328e8e4ecda450a53c27c2e710/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py",
            "raw_url": "https://github.com/django/django/raw/ffa50ca35219aa328e8e4ecda450a53c27c2e710/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py?ref=ffa50ca35219aa328e8e4ecda450a53c27c2e710",
            "patch": "@@ -60,6 +60,8 @@ def open(self):\n \n     def close(self):\n         \"\"\"Closes the connection to the email server.\"\"\"\n+        if self.connection is None:\n+            return\n         try:\n             try:\n                 self.connection.quit()"
        },
        {
            "sha": "059dd6d09ad0f3aadfb4155941d337c657c2ce73",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/ffa50ca35219aa328e8e4ecda450a53c27c2e710/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ffa50ca35219aa328e8e4ecda450a53c27c2e710/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=ffa50ca35219aa328e8e4ecda450a53c27c2e710",
            "patch": "@@ -492,6 +492,16 @@ def test_recipient_without_domain(self):\n         self.assertEqual(message.get('from'), \"tester\")\n         self.assertEqual(message.get('to'), \"django\")\n \n+    def test_close_connection(self):\n+        \"\"\"\n+        Test that connection can be closed (even when not explicitely opened)\n+        \"\"\"\n+        conn = mail.get_connection(username='', password='')\n+        try:\n+            conn.close()\n+        except Exception as e:\n+            self.fail(\"close() unexpectedly raised an exception: %s\" % e)\n+\n \n class LocmemBackendTests(BaseEmailBackendTests, TestCase):\n     email_backend = 'django.core.mail.backends.locmem.EmailBackend'"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 12,
        "deletions": 0
    }
}