{
    "author": "SmileyChris",
    "message": "Fix broken tests due to changes in r15591 by updating the test store_rendered_templates signal handler.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15600 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4419f5fc00d82bdc022b0b188bb75a452c575d6f",
    "files": [
        {
            "sha": "cf0c92906554fa8f1e5686622ff01273c705c153",
            "filename": "django/template/context.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/4419f5fc00d82bdc022b0b188bb75a452c575d6f/django%2Ftemplate%2Fcontext.py",
            "raw_url": "https://github.com/django/django/raw/4419f5fc00d82bdc022b0b188bb75a452c575d6f/django%2Ftemplate%2Fcontext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fcontext.py?ref=4419f5fc00d82bdc022b0b188bb75a452c575d6f",
            "patch": "@@ -1,5 +1,7 @@\n+from copy import copy\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n+from django.http import HttpRequest\n \n # Cache of actual callables.\n _standard_context_processors = None\n@@ -17,13 +19,21 @@ def __init__(self, dict_=None):\n         dict_ = dict_ or {}\n         self.dicts = [dict_]\n \n+    def __copy__(self):\n+        duplicate = self._new()\n+        duplicate.dicts = [dict_ for dict_ in self.dicts]\n+        return duplicate\n+\n     def __repr__(self):\n         return repr(self.dicts)\n \n     def __iter__(self):\n         for d in reversed(self.dicts):\n             yield d\n \n+    def _new(self):\n+        return self.__class__()\n+\n     def push(self):\n         d = {}\n         self.dicts.append(d)\n@@ -73,6 +83,16 @@ def __init__(self, dict_=None, autoescape=True, current_app=None, use_l10n=None)\n         self.render_context = RenderContext()\n         super(Context, self).__init__(dict_)\n \n+    def __copy__(self):\n+        duplicate = super(Context, self).__copy__()\n+        duplicate.render_context = copy(self.render_context)\n+        return duplicate\n+\n+    def _new(self):\n+        return self.__class__(autoescape=self.autoescape,\n+                              current_app=self.current_app,\n+                              use_l10n=self.use_l10n)\n+\n     def update(self, other_dict):\n         \"Pushes other_dict to the stack of dictionaries in the Context\"\n         if not hasattr(other_dict, '__getitem__'):\n@@ -148,3 +168,8 @@ def __init__(self, request, dict=None, processors=None, current_app=None, use_l1\n             processors = tuple(processors)\n         for processor in get_standard_processors() + processors:\n             self.update(processor(request))\n+\n+    def _new(self):\n+        return self.__class__(request=HttpRequest(),\n+                              current_app=self.current_app,\n+                              use_l10n=self.use_l10n)"
        },
        {
            "sha": "dd0d811b0299f217b921c05225e2872ccc9f7c8d",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4419f5fc00d82bdc022b0b188bb75a452c575d6f/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/4419f5fc00d82bdc022b0b188bb75a452c575d6f/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=4419f5fc00d82bdc022b0b188bb75a452c575d6f",
            "patch": "@@ -5,6 +5,7 @@\n import re\n import mimetypes\n import warnings\n+from copy import copy\n try:\n     from cStringIO import StringIO\n except ImportError:\n@@ -91,9 +92,12 @@ def __call__(self, environ):\n def store_rendered_templates(store, signal, sender, template, context, **kwargs):\n     \"\"\"\n     Stores templates and contexts that are rendered.\n+\n+    The context is copied so that it is an accurate representation at the time\n+    of rendering.\n     \"\"\"\n     store.setdefault('templates', []).append(template)\n-    store.setdefault('context', ContextList()).append(context)\n+    store.setdefault('context', ContextList()).append(copy(context))\n \n def encode_multipart(boundary, data):\n     \"\"\""
        }
    ],
    "stats": {
        "total": 31,
        "additions": 30,
        "deletions": 1
    }
}