{
    "author": "claudep",
    "message": "Fixed #19488 -- Made i18n_patterns redirect work with non-slash-ending paths\n\nThanks Daniel Gerzo for the report and the initial patch.",
    "sha": "bcdb4898cae2f24599b39845b8e4cd7edc202424",
    "files": [
        {
            "sha": "f693e4d242a2d461a861e95bd841ff79424f90e8",
            "filename": "django/middleware/locale.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/bcdb4898cae2f24599b39845b8e4cd7edc202424/django%2Fmiddleware%2Flocale.py",
            "raw_url": "https://github.com/django/django/raw/bcdb4898cae2f24599b39845b8e4cd7edc202424/django%2Fmiddleware%2Flocale.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Flocale.py?ref=bcdb4898cae2f24599b39845b8e4cd7edc202424",
            "patch": "@@ -31,10 +31,12 @@ def process_response(self, request, response):\n                     and self.is_language_prefix_patterns_used()):\n             urlconf = getattr(request, 'urlconf', None)\n             language_path = '/%s%s' % (language, request.path_info)\n-            if settings.APPEND_SLASH and not language_path.endswith('/'):\n-                language_path = language_path + '/'\n+            path_valid = is_valid_path(language_path, urlconf)\n+            if (not path_valid and settings.APPEND_SLASH\n+                    and not language_path.endswith('/')):\n+                path_valid = is_valid_path(\"%s/\" % language_path, urlconf)\n \n-            if is_valid_path(language_path, urlconf):\n+            if path_valid:\n                 language_url = \"%s://%s/%s%s\" % (\n                     request.is_secure() and 'https' or 'http',\n                     request.get_host(), language, request.get_full_path())"
        },
        {
            "sha": "639e03f2887740e32fb75692ba72dd75bd4186e0",
            "filename": "tests/regressiontests/i18n/patterns/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/bcdb4898cae2f24599b39845b8e4cd7edc202424/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/bcdb4898cae2f24599b39845b8e4cd7edc202424/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py?ref=bcdb4898cae2f24599b39845b8e4cd7edc202424",
            "patch": "@@ -115,6 +115,7 @@ def test_users_url(self):\n \n         with translation.override('nl'):\n             self.assertEqual(reverse('users'), '/nl/gebruikers/')\n+            self.assertEqual(reverse('prefixed_xml'), '/nl/prefixed.xml')\n \n         with translation.override('pt-br'):\n             self.assertEqual(reverse('users'), '/pt-br/usuarios/')\n@@ -186,6 +187,9 @@ def test_en_redirect(self):\n         self.assertIn(('http://testserver/en/account/register/', 301), response.redirect_chain)\n         self.assertRedirects(response, '/en/account/register/', 302)\n \n+        response = self.client.get('/prefixed.xml', HTTP_ACCEPT_LANGUAGE='en', follow=True)\n+        self.assertRedirects(response, '/en/prefixed.xml', 302)\n+\n \n class URLRedirectWithoutTrailingSlashSettingTests(URLTestCaseBase):\n     \"\"\""
        },
        {
            "sha": "00b90b14b7a2c50db78b84e3c012ba5ec1135a26",
            "filename": "tests/regressiontests/i18n/patterns/urls/default.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bcdb4898cae2f24599b39845b8e4cd7edc202424/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Furls%2Fdefault.py",
            "raw_url": "https://github.com/django/django/raw/bcdb4898cae2f24599b39845b8e4cd7edc202424/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Furls%2Fdefault.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Furls%2Fdefault.py?ref=bcdb4898cae2f24599b39845b8e4cd7edc202424",
            "patch": "@@ -14,6 +14,7 @@\n \n urlpatterns += i18n_patterns('',\n     url(r'^prefixed/$', view, name='prefixed'),\n+    url(r'^prefixed\\.xml$', view, name='prefixed_xml'),\n     url(_(r'^users/$'), view, name='users'),\n     url(_(r'^account/'), include('regressiontests.i18n.patterns.urls.namespace', namespace='account')),\n )"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 10,
        "deletions": 3
    }
}