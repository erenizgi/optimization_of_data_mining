{
    "author": "andrewgodwin",
    "message": "Backed out [16356] due to later rejection of #16182.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16426 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "838a16ec2055cd9736c9d426acf9fdd092e72469",
    "files": [
        {
            "sha": "054777a260efeb5ada7ec2a759467eb62d892fe0",
            "filename": "django/core/signing.py",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/838a16ec2055cd9736c9d426acf9fdd092e72469/django%2Fcore%2Fsigning.py",
            "raw_url": "https://github.com/django/django/raw/838a16ec2055cd9736c9d426acf9fdd092e72469/django%2Fcore%2Fsigning.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fsigning.py?ref=838a16ec2055cd9736c9d426acf9fdd092e72469",
            "patch": "@@ -158,12 +158,8 @@ def unsign(self, signed_value):\n \n \n class TimestampSigner(Signer):\n-    def __init__(self, *args, **kwargs):\n-        self.time_func = kwargs.pop('time', time.time)\n-        super(TimestampSigner, self).__init__(*args, **kwargs)\n-    \n     def timestamp(self):\n-        return baseconv.base62.encode(int(self.time_func() * 10000))\n+        return baseconv.base62.encode(int(time.time()))\n \n     def sign(self, value):\n         value = smart_str('%s%s%s' % (value, self.sep, self.timestamp()))\n@@ -172,10 +168,10 @@ def sign(self, value):\n     def unsign(self, value, max_age=None):\n         result =  super(TimestampSigner, self).unsign(value)\n         value, timestamp = result.rsplit(self.sep, 1)\n-        timestamp = baseconv.base62.decode(timestamp) / 10000.0\n+        timestamp = baseconv.base62.decode(timestamp)\n         if max_age is not None:\n             # Check timestamp is not older than max_age\n-            age = self.time_func() - timestamp\n+            age = time.time() - timestamp\n             if age > max_age:\n                 raise SignatureExpired(\n                     'Signature age %s > %s seconds' % (age, max_age))"
        },
        {
            "sha": "0b0cacf10ef7c1d32c8631bfd3e5fcd2bff1c4e9",
            "filename": "tests/regressiontests/signing/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 17,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/838a16ec2055cd9736c9d426acf9fdd092e72469/tests%2Fregressiontests%2Fsigning%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/838a16ec2055cd9736c9d426acf9fdd092e72469/tests%2Fregressiontests%2Fsigning%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsigning%2Ftests.py?ref=838a16ec2055cd9736c9d426acf9fdd092e72469",
            "patch": "@@ -1,3 +1,5 @@\n+import time\n+\n from django.core import signing\n from django.test import TestCase\n from django.utils.encoding import force_unicode\n@@ -96,21 +98,19 @@ class TestTimestampSigner(TestCase):\n \n     def test_timestamp_signer(self):\n         value = u'hello'\n-        signer = signing.TimestampSigner('predictable-key',\n-            time=lambda: 123456789)\n-        ts = signer.sign(value)\n-        self.assertNotEqual(ts,\n-            signing.Signer('predictable-key').sign(value))\n+        _time = time.time\n+        time.time = lambda: 123456789\n+        try:\n+            signer = signing.TimestampSigner('predictable-key')\n+            ts = signer.sign(value)\n+            self.assertNotEqual(ts,\n+                signing.Signer('predictable-key').sign(value))\n \n-        self.assertEqual(signer.unsign(ts), value)\n-        signer = signing.TimestampSigner('predictable-key',\n-            time=lambda: 123456800)\n-        self.assertEqual(signer.unsign(ts, max_age=12), value)\n-        self.assertEqual(signer.unsign(ts, max_age=11), value)\n-        self.assertRaises(\n-            signing.SignatureExpired, signer.unsign, ts, max_age=10)\n-    \n-    def test_timestamp_precision(self):\n-        one = signing.TimestampSigner('key', time=lambda: 123.4567).sign('v')\n-        two = signing.TimestampSigner('key', time=lambda: 123.4568).sign('v')\n-        self.assertNotEqual(one, two)\n+            self.assertEqual(signer.unsign(ts), value)\n+            time.time = lambda: 123456800\n+            self.assertEqual(signer.unsign(ts, max_age=12), value)\n+            self.assertEqual(signer.unsign(ts, max_age=11), value)\n+            self.assertRaises(\n+                signing.SignatureExpired, signer.unsign, ts, max_age=10)\n+        finally:\n+            time.time = _time"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 20,
        "deletions": 24
    }
}