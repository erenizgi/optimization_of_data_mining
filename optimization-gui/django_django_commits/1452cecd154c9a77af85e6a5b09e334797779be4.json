{
    "author": "jphalip",
    "message": "Fixed 16938 -- Ensured that the active locale's formats take precedence over the default settings even if they would be interpreted as False in a conditional test (e.g. 0 or empty string). Thanks to pikerr for the report and initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17017 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "1452cecd154c9a77af85e6a5b09e334797779be4",
    "files": [
        {
            "sha": "e283490b17b9b953530db83e1730e958f0b97b2b",
            "filename": "django/utils/formats.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/1452cecd154c9a77af85e6a5b09e334797779be4/django%2Futils%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/1452cecd154c9a77af85e6a5b09e334797779be4/django%2Futils%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fformats.py?ref=1452cecd154c9a77af85e6a5b09e334797779be4",
            "patch": "@@ -71,7 +71,12 @@ def get_format(format_type, lang=None, use_l10n=None):\n             lang = get_language()\n         cache_key = (format_type, lang)\n         try:\n-            return _format_cache[cache_key] or getattr(settings, format_type)\n+            cached = _format_cache[cache_key]\n+            if cached is not None:\n+                return cached\n+            else:\n+                # Return the general setting by default\n+                return getattr(settings, format_type)\n         except KeyError:\n             for module in get_format_modules(lang):\n                 try:"
        },
        {
            "sha": "17395ffb2423841d163a56e6f9f8c4487d84ebf2",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/1452cecd154c9a77af85e6a5b09e334797779be4/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/1452cecd154c9a77af85e6a5b09e334797779be4/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=1452cecd154c9a77af85e6a5b09e334797779be4",
            "patch": "@@ -14,7 +14,8 @@\n from django.test.utils import override_settings\n from django.utils import translation\n from django.utils.formats import (get_format, date_format, time_format,\n-    localize, localize_input, iter_format_modules, get_format_modules)\n+    localize, localize_input, iter_format_modules, get_format_modules,\n+    number_format)\n from django.utils.importlib import import_module\n from django.utils.numberformat import format as nformat\n from django.utils.safestring import mark_safe, SafeString, SafeUnicode\n@@ -397,6 +398,39 @@ def test_l10n_disabled(self):\n                 self.assertEqual(u'66666.67', Template('{{ n|floatformat:2 }}').render(self.ctxt))\n                 self.assertEqual(u'100000.0', Template('{{ f|floatformat }}').render(self.ctxt))\n \n+    def test_false_like_locale_formats(self):\n+        \"\"\"\n+        Ensure that the active locale's formats take precedence over the\n+        default settings even if they would be interpreted as False in a\n+        conditional test (e.g. 0 or empty string).\n+        Refs #16938.\n+        \"\"\"\n+        from django.conf.locale.fr import formats as fr_formats\n+\n+        # Back up original formats\n+        backup_THOUSAND_SEPARATOR = fr_formats.THOUSAND_SEPARATOR\n+        backup_FIRST_DAY_OF_WEEK = fr_formats.FIRST_DAY_OF_WEEK\n+\n+        # Set formats that would get interpreted as False in a conditional test\n+        fr_formats.THOUSAND_SEPARATOR = ''\n+        fr_formats.FIRST_DAY_OF_WEEK = 0\n+\n+        with translation.override('fr'):\n+            with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True,\n+                               THOUSAND_SEPARATOR='!'):\n+                self.assertEqual('', get_format('THOUSAND_SEPARATOR'))\n+                # Even a second time (after the format has been cached)...\n+                self.assertEqual('', get_format('THOUSAND_SEPARATOR'))\n+\n+            with self.settings(USE_L10N=True, FIRST_DAY_OF_WEEK=1):\n+                self.assertEqual(0, get_format('FIRST_DAY_OF_WEEK'))\n+                # Even a second time (after the format has been cached)...\n+                self.assertEqual(0, get_format('FIRST_DAY_OF_WEEK'))\n+\n+        # Restore original formats\n+        fr_formats.THOUSAND_SEPARATOR = backup_THOUSAND_SEPARATOR\n+        fr_formats.FIRST_DAY_OF_WEEK = backup_FIRST_DAY_OF_WEEK\n+\n     def test_l10n_enabled(self):\n         settings.USE_L10N = True\n         # Catalan locale"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 41,
        "deletions": 2
    }
}