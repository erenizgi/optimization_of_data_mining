{
    "author": "aaugustin",
    "message": "Fixed #16705 - Made the test client adhere to the WSGI spec -- in particular, removed the assumption that environ['QUERY_STRING'] exists.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16933 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e2f9c11736db9e23004733760303f605f1cfb924",
    "files": [
        {
            "sha": "4dd2e14652443f41fa78c82da3a957443a9d61c3",
            "filename": "django/middleware/common.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e2f9c11736db9e23004733760303f605f1cfb924/django%2Fmiddleware%2Fcommon.py",
            "raw_url": "https://github.com/django/django/raw/e2f9c11736db9e23004733760303f605f1cfb924/django%2Fmiddleware%2Fcommon.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcommon.py?ref=e2f9c11736db9e23004733760303f605f1cfb924",
            "patch": "@@ -85,7 +85,7 @@ def process_request(self, request):\n                 new_url[0], urlquote(new_url[1]))\n         else:\n             newurl = urlquote(new_url[1])\n-        if request.GET:\n+        if request.META.get('QUERY_STRING', ''):\n             newurl += '?' + request.META['QUERY_STRING']\n         return http.HttpResponsePermanentRedirect(newurl)\n "
        },
        {
            "sha": "a5ef075f3cd8b3995624a4de2910ecf919584429",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/e2f9c11736db9e23004733760303f605f1cfb924/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/e2f9c11736db9e23004733760303f605f1cfb924/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=e2f9c11736db9e23004733760303f605f1cfb924",
            "patch": "@@ -182,18 +182,18 @@ def _base_environ(self, **request):\n         \"\"\"\n         The base environment for a request.\n         \"\"\"\n+        # This is a minimal valid WSGI environ dictionary, plus HTTP_COOKIE\n+        # for cookie support. Empty strings are omitted.\n+        # See http://www.python.org/dev/peps/pep-3333/#environ-variables\n         environ = {\n             'HTTP_COOKIE':       self.cookies.output(header='', sep='; '),\n-            'PATH_INFO':         '/',\n-            'QUERY_STRING':      '',\n-            'REMOTE_ADDR':       '127.0.0.1',\n             'REQUEST_METHOD':    'GET',\n-            'SCRIPT_NAME':       '',\n             'SERVER_NAME':       'testserver',\n             'SERVER_PORT':       '80',\n             'SERVER_PROTOCOL':   'HTTP/1.1',\n             'wsgi.version':      (1,0),\n             'wsgi.url_scheme':   'http',\n+            'wsgi.input':        FakePayload(''),\n             'wsgi.errors':       self.errors,\n             'wsgi.multiprocess': True,\n             'wsgi.multithread':  False,\n@@ -235,7 +235,6 @@ def get(self, path, data={}, **extra):\n             'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'GET',\n-            'wsgi.input':      FakePayload('')\n         }\n         r.update(extra)\n         return self.request(**r)\n@@ -267,7 +266,6 @@ def head(self, path, data={}, **extra):\n             'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'HEAD',\n-            'wsgi.input':      FakePayload('')\n         }\n         r.update(extra)\n         return self.request(**r)\n@@ -280,7 +278,6 @@ def options(self, path, data={}, **extra):\n             'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'OPTIONS',\n-            'wsgi.input':      FakePayload('')\n         }\n         r.update(extra)\n         return self.request(**r)\n@@ -311,7 +308,6 @@ def delete(self, path, data={}, **extra):\n             'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'DELETE',\n-            'wsgi.input':      FakePayload('')\n         }\n         r.update(extra)\n         return self.request(**r)"
        },
        {
            "sha": "ea14281a71e9292d7be9471625c2bc2713b61901",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e2f9c11736db9e23004733760303f605f1cfb924/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/e2f9c11736db9e23004733760303f605f1cfb924/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=e2f9c11736db9e23004733760303f605f1cfb924",
            "patch": "@@ -140,7 +140,7 @@ def get_redirect_url(self, **kwargs):\n         are provided as kwargs to this method.\n         \"\"\"\n         if self.url:\n-            args = self.request.META[\"QUERY_STRING\"]\n+            args = self.request.META.get('QUERY_STRING', '')\n             if args and self.query_string:\n                 url = \"%s?%s\" % (self.url, args)\n             else:"
        },
        {
            "sha": "0e1e6b083a52801c2e9a7df3f2d19a4c469eebba",
            "filename": "django/views/generic/simple.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e2f9c11736db9e23004733760303f605f1cfb924/django%2Fviews%2Fgeneric%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/e2f9c11736db9e23004733760303f605f1cfb924/django%2Fviews%2Fgeneric%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fsimple.py?ref=e2f9c11736db9e23004733760303f605f1cfb924",
            "patch": "@@ -48,7 +48,7 @@ def redirect_to(request, url, permanent=True, query_string=False, **kwargs):\n     from the request is appended to the URL.\n \n     \"\"\"\n-    args = request.META[\"QUERY_STRING\"]\n+    args = request.META.get('QUERY_STRING', '')\n     if args and query_string and url is not None:\n         url = \"%s?%s\" % (url, args)\n "
        },
        {
            "sha": "00fa0d9b796e310cf605d4e20f57b3f328dbfdc0",
            "filename": "tests/regressiontests/generic_views/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/e2f9c11736db9e23004733760303f605f1cfb924/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/e2f9c11736db9e23004733760303f605f1cfb924/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py?ref=e2f9c11736db9e23004733760303f605f1cfb924",
            "patch": "@@ -248,7 +248,7 @@ def test_no_url(self):\n         response = RedirectView.as_view()(self.rf.get('/foo/'))\n         self.assertEqual(response.status_code, 410)\n \n-    def test_permanaent_redirect(self):\n+    def test_permanent_redirect(self):\n         \"Default is a permanent redirect\"\n         response = RedirectView.as_view(url='/bar/')(self.rf.get('/foo/'))\n         self.assertEqual(response.status_code, 301)\n@@ -305,3 +305,9 @@ def test_redirect_DELETE(self):\n         response = RedirectView.as_view(url='/bar/')(self.rf.delete('/foo/'))\n         self.assertEqual(response.status_code, 301)\n         self.assertEqual(response['Location'], '/bar/')\n+\n+    def test_redirect_when_meta_contains_no_query_string(self):\n+        \"regression for #16705\"\n+        # we can't use self.rf.get because it always sets QUERY_STRING\n+        response = RedirectView.as_view(url='/bar/')(self.rf.request(PATH_INFO='/foo/'))\n+        self.assertEqual(response.status_code, 301)"
        },
        {
            "sha": "be54af9185c3e46ddab06d3fe57fe2ad3dfe27ec",
            "filename": "tests/regressiontests/views/tests/generic/simple.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/e2f9c11736db9e23004733760303f605f1cfb924/tests%2Fregressiontests%2Fviews%2Ftests%2Fgeneric%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/e2f9c11736db9e23004733760303f605f1cfb924/tests%2Fregressiontests%2Fviews%2Ftests%2Fgeneric%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fgeneric%2Fsimple.py?ref=e2f9c11736db9e23004733760303f605f1cfb924",
            "patch": "@@ -47,3 +47,10 @@ def test_redirect_to_allows_query_string_to_be_passed(self):\n         response = self.client.get('/simple/redirect_to_query/?param1=foo&param2=bar')\n         self.assertEqual(response.status_code, 301)\n         self.assertEqual('http://testserver/simple/target/?param1=foo&param2=bar', response['Location'])\n+\n+    def test_redirect_to_when_meta_contains_no_query_string(self):\n+        \"regression for #16705\"\n+        # we can't use self.client.get because it always sets QUERY_STRING\n+        response = self.client.request(PATH_INFO='/simple/redirect_to/')\n+        self.assertEqual(response.status_code, 301)\n+        "
        }
    ],
    "stats": {
        "total": 33,
        "additions": 21,
        "deletions": 12
    }
}