{
    "author": "aaugustin",
    "message": "Fixed #16366 -- Prevented some failures of the django.contrib.auth tests when run within a project. Thanks to everyone who contributed to the patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17598 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "abf2d4295f0ec52fdafdda956ad3e5bc59e63d63",
    "files": [
        {
            "sha": "8f77940a612c45127be78128174e4b90d9d1245c",
            "filename": "django/contrib/auth/tests/context_processors.py",
            "status": "modified",
            "additions": 21,
            "deletions": 10,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/abf2d4295f0ec52fdafdda956ad3e5bc59e63d63/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/abf2d4295f0ec52fdafdda956ad3e5bc59e63d63/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py?ref=abf2d4295f0ec52fdafdda956ad3e5bc59e63d63",
            "patch": "@@ -1,9 +1,11 @@\n import os\n \n-from django.conf import settings\n+from django.conf import global_settings\n from django.contrib.auth import authenticate\n from django.db.models import Q\n+from django.template import context\n from django.test import TestCase\n+from django.test.utils import override_settings\n \n \n class AuthContextProcessorTests(TestCase):\n@@ -13,28 +15,31 @@ class AuthContextProcessorTests(TestCase):\n     urls = 'django.contrib.auth.tests.urls'\n     fixtures = ['context-processors-users.xml']\n \n-    def setUp(self):\n-        self.old_TEMPLATE_DIRS = settings.TEMPLATE_DIRS\n-        settings.TEMPLATE_DIRS = (\n-            os.path.join(os.path.dirname(__file__), 'templates'),\n-        )\n-\n-    def tearDown(self):\n-        settings.TEMPLATE_DIRS = self.old_TEMPLATE_DIRS\n-\n+    @override_settings(\n+        MIDDLEWARE_CLASSES=global_settings.MIDDLEWARE_CLASSES,\n+        TEMPLATE_CONTEXT_PROCESSORS=global_settings.TEMPLATE_CONTEXT_PROCESSORS,\n+    )\n     def test_session_not_accessed(self):\n         \"\"\"\n         Tests that the session is not accessed simply by including\n         the auth context processor\n         \"\"\"\n+        context._standard_context_processors = None\n+\n         response = self.client.get('/auth_processor_no_attr_access/')\n         self.assertContains(response, \"Session not accessed\")\n \n+    @override_settings(\n+        MIDDLEWARE_CLASSES=global_settings.MIDDLEWARE_CLASSES,\n+        TEMPLATE_CONTEXT_PROCESSORS=global_settings.TEMPLATE_CONTEXT_PROCESSORS,\n+    )\n     def test_session_is_accessed(self):\n         \"\"\"\n         Tests that the session is accessed if the auth context processor\n         is used and relevant attributes accessed.\n         \"\"\"\n+        context._standard_context_processors = None\n+\n         response = self.client.get('/auth_processor_attr_access/')\n         self.assertContains(response, \"Session accessed\")\n \n@@ -86,3 +91,9 @@ def test_user_attrs(self):\n         # See bug #12060\n         self.assertEqual(response.context['user'], user)\n         self.assertEqual(user, response.context['user'])\n+\n+AuthContextProcessorTests = override_settings(\n+    TEMPLATE_DIRS = (\n+            os.path.join(os.path.dirname(__file__), 'templates'),\n+        )\n+)(AuthContextProcessorTests)"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 21,
        "deletions": 10
    }
}