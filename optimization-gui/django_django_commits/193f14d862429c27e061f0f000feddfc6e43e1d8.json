{
    "author": "ramiro",
    "message": "Fixed #15157 -- Modified evaluation of literals surrounded by _(' and ')' in templates to be evaluated at render time instead of at compile time by using ugettext_lazy. Thanks Jonathan S for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15327 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "193f14d862429c27e061f0f000feddfc6e43e1d8",
    "files": [
        {
            "sha": "49ef0b85eb06c33eb21ed74b8f3f408136d67208",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/193f14d862429c27e061f0f000feddfc6e43e1d8/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/193f14d862429c27e061f0f000feddfc6e43e1d8/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=193f14d862429c27e061f0f000feddfc6e43e1d8",
            "patch": "@@ -9,7 +9,7 @@\n from django.utils.functional import curry, Promise\n from django.utils.text import smart_split, unescape_string_literal, get_text_list\n from django.utils.encoding import smart_unicode, force_unicode, smart_str\n-from django.utils.translation import ugettext as _\n+from django.utils.translation import ugettext_lazy\n from django.utils.safestring import SafeData, EscapeData, mark_safe, mark_for_escaping\n from django.utils.formats import localize\n from django.utils.html import escape\n@@ -655,7 +655,7 @@ def resolve(self, context):\n             # We're dealing with a literal, so it's already been \"resolved\"\n             value = self.literal\n         if self.translate:\n-            return _(value)\n+            return ugettext_lazy(value)\n         return value\n \n     def __repr__(self):"
        },
        {
            "sha": "055656b3cb0a2255dbce353141e53ea9f2d1beec",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 132,
            "deletions": 1,
            "changes": 133,
            "blob_url": "https://github.com/django/django/blob/193f14d862429c27e061f0f000feddfc6e43e1d8/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/193f14d862429c27e061f0f000feddfc6e43e1d8/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=193f14d862429c27e061f0f000feddfc6e43e1d8",
            "patch": "@@ -15,7 +15,7 @@\n from django.utils.safestring import mark_safe, SafeString, SafeUnicode\n from django.utils.translation import (ugettext, ugettext_lazy, activate,\n         deactivate, gettext_lazy, pgettext, npgettext, to_locale,\n-        get_language_info)\n+        get_language_info, get_language)\n from django.utils.unittest import TestCase\n \n \n@@ -743,3 +743,134 @@ def test_localized_language_info(self):\n         self.assertEqual(li['name_local'], u'Deutsch')\n         self.assertEqual(li['name'], 'German')\n         self.assertEqual(li['bidi'], False)\n+\n+\n+class MultipleLocaleActivationTests(TestCase):\n+    \"\"\"\n+    Tests for template rendering behavior when multiple locales are activated\n+    during the lifetime of the same process.\n+    \"\"\"\n+    def setUp(self):\n+        self._old_language = get_language()\n+\n+    def tearDown(self):\n+        activate(self._old_language)\n+\n+    def test_single_locale_activation(self):\n+        \"\"\"\n+        Simple baseline behavior with one locale for all the supported i18n constructs.\n+        \"\"\"\n+        activate('fr')\n+        self.assertEqual(Template(\"{{ _('Yes') }}\").render(Context({})), 'Oui')\n+        self.assertEqual(Template(\"{% load i18n %}{% trans 'Yes' %}\").render(Context({})), 'Oui')\n+        self.assertEqual(Template(\"{% load i18n %}{% blocktrans %}Yes{% endblocktrans %}\").render(Context({})), 'Oui')\n+\n+    # Literal marked up with _() in a filter expression\n+\n+    def test_multiple_locale_filter(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{{ 0|yesno:_('yes,no,maybe') }}\")\n+        activate(self._old_language)\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'nee')\n+\n+    def test_multiple_locale_filter_deactivate(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{{ 0|yesno:_('yes,no,maybe') }}\")\n+        deactivate()\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'nee')\n+\n+    def test_multiple_locale_filter_direct_switch(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{{ 0|yesno:_('yes,no,maybe') }}\")\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'nee')\n+\n+    # Literal marked up with _()\n+\n+    def test_multiple_locale(self):\n+        activate('de')\n+        t = Template(\"{{ _('No') }}\")\n+        activate(self._old_language)\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_deactivate(self):\n+        activate('de')\n+        t = Template(\"{{ _('No') }}\")\n+        deactivate()\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_direct_switch(self):\n+        activate('de')\n+        t = Template(\"{{ _('No') }}\")\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    # Literal marked up with _(), loading the i18n template tag library\n+\n+    def test_multiple_locale_loadi18n(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{{ _('No') }}\")\n+        activate(self._old_language)\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_loadi18n_deactivate(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{{ _('No') }}\")\n+        deactivate()\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_loadi18n_direct_switch(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{{ _('No') }}\")\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    # trans i18n tag\n+\n+    def test_multiple_locale_trans(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{% trans 'No' %}\")\n+        activate(self._old_language)\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_deactivate_trans(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{% trans 'No' %}\")\n+        deactivate()\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_direct_switch_trans(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{% trans 'No' %}\")\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    # blocktrans i18n tag\n+\n+    def test_multiple_locale_btrans(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{% blocktrans %}No{% endblocktrans %}\")\n+        activate(self._old_language)\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_deactivate_btrans(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{% blocktrans %}No{% endblocktrans %}\")\n+        deactivate()\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')\n+\n+    def test_multiple_locale_direct_switch_btrans(self):\n+        activate('de')\n+        t = Template(\"{% load i18n %}{% blocktrans %}No{% endblocktrans %}\")\n+        activate('nl')\n+        self.assertEqual(t.render(Context({})), 'Nee')"
        }
    ],
    "stats": {
        "total": 137,
        "additions": 134,
        "deletions": 3
    }
}