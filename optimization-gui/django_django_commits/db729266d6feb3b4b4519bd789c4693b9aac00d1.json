{
    "author": "claudep",
    "message": "[py3] Fixed 'iterable but non string' detection\n\nIn Python 3, the str type has an __iter__ attribute. Therefore, the\npresence of an __iter__ attribute is not sufficient to distinguish\n'standard' iterables (list, tuple) from strings.",
    "sha": "db729266d6feb3b4b4519bd789c4693b9aac00d1",
    "files": [
        {
            "sha": "90370bd9783fa4962d1748ac318dd6128234f416",
            "filename": "django/contrib/admin/helpers.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "raw_url": "https://github.com/django/django/raw/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fhelpers.py?ref=db729266d6feb3b4b4519bd789c4693b9aac00d1",
            "patch": "@@ -94,7 +94,7 @@ def __iter__(self):\n class Fieldline(object):\n     def __init__(self, form, field, readonly_fields=None, model_admin=None):\n         self.form = form # A django.forms.Form instance\n-        if not hasattr(field, \"__iter__\"):\n+        if not hasattr(field, \"__iter__\") or isinstance(field, six.text_type):\n             self.fields = [field]\n         else:\n             self.fields = field"
        },
        {
            "sha": "a1fff6f9bbc37517e4dfa893e31883579f94e819",
            "filename": "django/core/serializers/python.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fcore%2Fserializers%2Fpython.py",
            "raw_url": "https://github.com/django/django/raw/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fcore%2Fserializers%2Fpython.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpython.py?ref=db729266d6feb3b4b4519bd789c4693b9aac00d1",
            "patch": "@@ -98,7 +98,7 @@ def Deserializer(object_list, **options):\n             if field.rel and isinstance(field.rel, models.ManyToManyRel):\n                 if hasattr(field.rel.to._default_manager, 'get_by_natural_key'):\n                     def m2m_convert(value):\n-                        if hasattr(value, '__iter__'):\n+                        if hasattr(value, '__iter__') and not isinstance(value, six.text_type):\n                             return field.rel.to._default_manager.db_manager(db).get_by_natural_key(*value).pk\n                         else:\n                             return smart_text(field.rel.to._meta.pk.to_python(value))\n@@ -110,7 +110,7 @@ def m2m_convert(value):\n             elif field.rel and isinstance(field.rel, models.ManyToOneRel):\n                 if field_value is not None:\n                     if hasattr(field.rel.to._default_manager, 'get_by_natural_key'):\n-                        if hasattr(field_value, '__iter__'):\n+                        if hasattr(field_value, '__iter__') and not isinstance(field_value, six.text_type):\n                             obj = field.rel.to._default_manager.db_manager(db).get_by_natural_key(*field_value)\n                             value = getattr(obj, field.rel.field_name)\n                             # If this is a natural foreign key to an object that"
        },
        {
            "sha": "0b07d31d9a43f6ffcb9665f645f82f938a4b0c94",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=db729266d6feb3b4b4519bd789c4693b9aac00d1",
            "patch": "@@ -1035,6 +1035,6 @@ def clean(self, value):\n         return qs\n \n     def prepare_value(self, value):\n-        if hasattr(value, '__iter__'):\n+        if hasattr(value, '__iter__') and not isinstance(value, six.text_type):\n             return [super(ModelMultipleChoiceField, self).prepare_value(v) for v in value]\n         return super(ModelMultipleChoiceField, self).prepare_value(value)"
        },
        {
            "sha": "cc138917b910fe2d1c499877f26c4b4d2258f7ed",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/db729266d6feb3b4b4519bd789c4693b9aac00d1/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=db729266d6feb3b4b4519bd789c4693b9aac00d1",
            "patch": "@@ -656,7 +656,7 @@ def _get_content(self):\n         return b''.join([smart_bytes(e, self._charset) for e in self._container])\n \n     def _set_content(self, value):\n-        if hasattr(value, '__iter__'):\n+        if hasattr(value, '__iter__') and not isinstance(value, (bytes, six.text_type)):\n             self._container = value\n             self._base_content_is_iter = True\n         else:"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 5,
        "deletions": 5
    }
}