{
    "author": "jezdez",
    "message": "Fixed #16516 -- Relaxed the blocktrans rendering a little by falling back to the default language if resolving one of the arguments fails, raising a KeyError. Thanks, Claude Paroz and Aymeric Augustin.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16723 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
    "files": [
        {
            "sha": "519354985f4d5b2cbc14e2bfb5f28d3222d719d2",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
            "patch": "@@ -128,7 +128,12 @@ def render(self, context):\n         result = re.sub(u'%(?!\\()', u'%%', result)\n         data = dict([(v, _render_value_in_context(context.get(v, ''), context)) for v in vars])\n         context.pop()\n-        return result % data\n+        try:\n+            result = result % data\n+        except KeyError:\n+            with translation.override(None):\n+                result = self.render(context)\n+        return result\n \n \n class LanguageNode(Node):"
        },
        {
            "sha": "8ad9c5d59a2a3e643bd876779b56382fa32ca1bd",
            "filename": "django/utils/translation/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/django%2Futils%2Ftranslation%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/django%2Futils%2Ftranslation%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2F__init__.py?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
            "patch": "@@ -115,7 +115,10 @@ def __init__(self, language, deactivate=False):\n         self.old_language = get_language()\n \n     def __enter__(self):\n-        activate(self.language)\n+        if self.language is not None:\n+            activate(self.language)\n+        else:\n+            deactivate_all()\n \n     def __exit__(self, exc_type, exc_value, traceback):\n         if self.deactivate:"
        },
        {
            "sha": "1755ee77b32a1e9e71dcb87fbb0def5e221392e9",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
            "patch": "@@ -532,15 +532,18 @@ For a complete discussion on the usage of the following see the\n     useful when we want delayed translations to appear as the original string\n     for some reason.\n \n-.. function:: override(language)\n+.. function:: override(language, deactivate=False)\n \n     .. versionadded:: 1.4\n \n     A Python context manager that uses\n     :func:`django.utils.translation.activate` to fetch the translation object\n     for a given language, installing it as the translation object for the\n-    current thread and deinstalls it again on exit with\n-    :func:`django.utils.translation.deactivate`.\n+    current thread and reinstall the previous active language on exit.\n+    Optionally it can simply deinstall the temporary translation on exit with\n+    :func:`django.utils.translation.deactivate` if the deactivate argument is\n+    True. If you pass None as the language argument, a NullTranslations()\n+    instance is installed while the context is active.\n \n .. function:: get_language()\n "
        },
        {
            "sha": "dbeb77c87963fcdb65a5d473294f23c336105662",
            "filename": "docs/topics/i18n/internationalization.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Finternationalization.txt?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
            "patch": "@@ -512,6 +512,13 @@ You can use multiple expressions inside a single ``blocktrans`` tag::\n .. note:: The previous more verbose format is still supported:\n    ``{% blocktrans with book|title as book_t and author|title as author_t %}``\n \n+.. versionchanged:: 1.4\n+\n+If resolving one of the block arguments fails, blocktrans will fall back to\n+the default language by deactivating the currently active language\n+temporarily with the :func:`~django.utils.translation.deactivate_all`\n+function.\n+\n This tag also provides for pluralization. To use it:\n \n     * Designate and bind a counter value with the name ``count``. This value will"
        },
        {
            "sha": "f0a21797676abbe377b4637c57fe40fce594a5b2",
            "filename": "tests/regressiontests/i18n/other/locale/fr/LC_MESSAGES/django.mo",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2"
        },
        {
            "sha": "8e9b9e10344ee55e6edfb873ddfeff8d773b1a48",
            "filename": "tests/regressiontests/i18n/other/locale/fr/LC_MESSAGES/django.po",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
            "patch": "@@ -0,0 +1,21 @@\n+# SOME DESCRIPTIVE TITLE.\n+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER\n+# This file is distributed under the same license as the PACKAGE package.\n+# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.\n+#\n+msgid \"\"\n+msgstr \"\"\n+\"Project-Id-Version: django tests\\n\"\n+\"Report-Msgid-Bugs-To: \\n\"\n+\"POT-Creation-Date: 2010-02-14 17:33+0100\\n\"\n+\"PO-Revision-Date: 2011-01-21 21:37-0300\\n\"\n+\"Last-Translator: Claude\\n\"\n+\"Language-Team: fr <fr@li.org>\\n\"\n+\"MIME-Version: 1.0\\n\"\n+\"Content-Type: text/plain; charset=UTF-8\\n\"\n+\"Content-Transfer-Encoding: 8bit\\n\"\n+\"Plural-Forms: nplurals=2; plural=(n != 1)\\n\"\n+\n+#: template.html:3\n+msgid \"My name is %(person)s.\"\n+msgstr \"Mon nom est %(personne)s.\""
        },
        {
            "sha": "f230e5955603614ff189ab2cb3c056d70160ff71",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/16bb9c594cf7306f4b2fc3ba915be43b05dad5d2/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=16bb9c594cf7306f4b2fc3ba915be43b05dad5d2",
            "patch": "@@ -9,6 +9,7 @@\n from django.conf import settings\n from django.template import Template, Context\n from django.test import TestCase, RequestFactory\n+from django.test.utils import override_settings\n from django.utils.formats import (get_format, date_format, time_format,\n     localize, localize_input, iter_format_modules, get_format_modules)\n from django.utils.importlib import import_module\n@@ -27,13 +28,18 @@\n from patterns.tests import *\n from test_warnings import DeprecationWarningTests\n \n+here = os.path.dirname(os.path.abspath(__file__))\n+\n class TranslationTests(TestCase):\n \n     def test_override(self):\n         activate('de')\n         with translation.override('pl'):\n             self.assertEqual(get_language(), 'pl')\n         self.assertEqual(get_language(), 'de')\n+        with translation.override(None):\n+            self.assertEqual(get_language(), settings.LANGUAGE_CODE)\n+        self.assertEqual(get_language(), 'de')\n         deactivate()\n \n     def test_lazy_objects(self):\n@@ -67,7 +73,7 @@ def test_lazy_pickle(self):\n     def test_pgettext(self):\n         # Reset translation catalog to include other/locale/de\n         extended_locale_paths = settings.LOCALE_PATHS + (\n-            os.path.join(os.path.dirname(os.path.abspath(__file__)), 'other', 'locale'),\n+            os.path.join(here, 'other', 'locale'),\n         )\n         with self.settings(LOCALE_PATHS=extended_locale_paths):\n             from django.utils.translation import trans_real\n@@ -129,6 +135,18 @@ def test_to_language(self):\n         self.assertEqual(to_language('en_US'), 'en-us')\n         self.assertEqual(to_language('sr_Lat'), 'sr-lat')\n \n+    @override_settings(LOCALE_PATHS=(os.path.join(here, 'other', 'locale'),))\n+    def test_bad_placeholder(self):\n+        \"\"\"\n+        Error in translation file should not crash template rendering\n+        (%(person)s is translated as %(personne)s in fr.po)\n+        \"\"\"\n+        from django.template import Template, Context\n+        with translation.override('fr'):\n+            t = Template('{% load i18n %}{% blocktrans %}My name is {{ person }}.{% endblocktrans %}')\n+            rendered = t.render(Context({'person': 'James'}))\n+            self.assertEqual(rendered, 'My name is James.')\n+\n \n class FormattingTests(TestCase):\n \n@@ -636,7 +654,7 @@ class LocalePathsResolutionOrderI18NTests(ResolutionOrderI18NTests):\n \n     def setUp(self):\n         self.old_locale_paths = settings.LOCALE_PATHS\n-        settings.LOCALE_PATHS += (os.path.join(os.path.dirname(os.path.abspath(__file__)), 'other', 'locale'),)\n+        settings.LOCALE_PATHS += (os.path.join(here, 'other', 'locale'),)\n         super(LocalePathsResolutionOrderI18NTests, self).setUp()\n \n     def tearDown(self):"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 64,
        "deletions": 7
    }
}