{
    "author": "PaulMcMillan",
    "message": "Fixed #17693. Input validation and tests for base36 conversion utils. Thanks Keryn Knight for the report.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17525 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6072e108e2738dbde7c2ad976a45745551859a20",
    "files": [
        {
            "sha": "1431f472463d1ddf9367f02599d561e397f76a98",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6072e108e2738dbde7c2ad976a45745551859a20/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/6072e108e2738dbde7c2ad976a45745551859a20/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=6072e108e2738dbde7c2ad976a45745551859a20",
            "patch": "@@ -171,6 +171,8 @@ def int_to_base36(i):\n     \"\"\"\n     digits = \"0123456789abcdefghijklmnopqrstuvwxyz\"\n     factor = 0\n+    if (i < 0) or (i > sys.maxint):\n+        raise ValueError(\"Base36 conversion input too large or incorrect type.\")\n     # Find starting factor\n     while True:\n         factor += 1"
        },
        {
            "sha": "f7ec638dd5ff7347d933270d25bfd76d36ef255c",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6072e108e2738dbde7c2ad976a45745551859a20/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/6072e108e2738dbde7c2ad976a45745551859a20/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=6072e108e2738dbde7c2ad976a45745551859a20",
            "patch": "@@ -444,7 +444,7 @@ Atom1Feed\n \n .. function:: int_to_base36(i)\n \n-    Converts an integer to a base 36 string.\n+    Converts a positive integer less than sys.maxint to a base 36 string.\n \n ``django.utils.safestring``\n ==========================="
        },
        {
            "sha": "a6e7a8f2fc10ae190e9c2a8eefbb546a9c51cd93",
            "filename": "tests/regressiontests/utils/http.py",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/6072e108e2738dbde7c2ad976a45745551859a20/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/6072e108e2738dbde7c2ad976a45745551859a20/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fhttp.py?ref=6072e108e2738dbde7c2ad976a45745551859a20",
            "patch": "@@ -1,3 +1,5 @@\n+import sys\n+\n from django.utils import http\n from django.utils import unittest\n from django.utils.datastructures import MultiValueDict\n@@ -98,3 +100,25 @@ def no_content_response_with_unsafe_content_type():\n         utils.fix_IE_for_vary(ie_request, response)\n         self.assertFalse('Vary' in response)\n \n+    def test_base36(self):\n+        # reciprocity works\n+        for n in [0, 1, 1000, 1000000, sys.maxint]:\n+            self.assertEqual(n, http.base36_to_int(http.int_to_base36(n)))\n+\n+        # bad input\n+        for n in [-1, sys.maxint+1, '1', 'foo', {1:2}, (1,2,3)]:\n+            self.assertRaises(ValueError, http.int_to_base36, n)\n+        \n+        for n in ['#', ' ']:\n+            self.assertRaises(ValueError, http.base36_to_int, n)\n+\n+        for n in [123, {1:2}, (1,2,3)]:\n+            self.assertRaises(TypeError, http.base36_to_int, n)\n+\n+        # non-integer input\n+        self.assertRaises(TypeError, http.int_to_base36, 3.141)\n+        \n+        # more explicit output testing\n+        for n, b36 in [(0,'0'), (1,'1'), (42,'16'), (818469960,'django')]:\n+            self.assertEqual(http.int_to_base36(n), b36)\n+            self.assertEqual(http.base36_to_int(b36), n)"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 27,
        "deletions": 1
    }
}