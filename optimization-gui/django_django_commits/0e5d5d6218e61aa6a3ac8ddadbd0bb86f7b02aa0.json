{
    "author": "jezdez",
    "message": "Fixed #15662 -- Made sure the module_has_submodule utility function follow correct PEP 302, passing the package as the second argument to the find_module method of the importer. Thanks, Bradley Ayers.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16075 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0",
    "files": [
        {
            "sha": "4b76f6cbdd10d5b9d461943a22f173356d4ed2ff",
            "filename": "django/utils/module_loading.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0/django%2Futils%2Fmodule_loading.py",
            "raw_url": "https://github.com/django/django/raw/0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0/django%2Futils%2Fmodule_loading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fmodule_loading.py?ref=0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0",
            "patch": "@@ -12,7 +12,7 @@ def module_has_submodule(package, module_name):\n     except KeyError:\n         pass\n     for finder in sys.meta_path:\n-        if finder.find_module(name):\n+        if finder.find_module(name, package):\n             return True\n     for entry in package.__path__:  # No __path__, then not a package.\n         try:"
        },
        {
            "sha": "2e9d167fe9dffe93820dd3f37e82be684e17c694",
            "filename": "tests/regressiontests/utils/module_loading.py",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0/tests%2Fregressiontests%2Futils%2Fmodule_loading.py",
            "raw_url": "https://github.com/django/django/raw/0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0/tests%2Fregressiontests%2Futils%2Fmodule_loading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fmodule_loading.py?ref=0e5d5d6218e61aa6a3ac8ddadbd0bb86f7b02aa0",
            "patch": "@@ -1,5 +1,6 @@\n import os\n import sys\n+import imp\n from zipimport import zipimporter\n \n from django.utils import unittest\n@@ -8,6 +9,12 @@\n \n \n class DefaultLoader(unittest.TestCase):\n+    def setUp(self):\n+        sys.meta_path.insert(0, ProxyFinder())\n+\n+    def tearDown(self):\n+        sys.meta_path.pop(0)\n+\n     def test_loader(self):\n         \"Normal module existence can be tested\"\n         test_module = import_module('regressiontests.utils.test_module')\n@@ -25,6 +32,10 @@ def test_loader(self):\n         self.assertFalse(module_has_submodule(test_module, 'no_such_module'))\n         self.assertRaises(ImportError, import_module, 'regressiontests.utils.test_module.no_such_module')\n \n+        # A child that doesn't exist, but is the name of a package on the path\n+        self.assertFalse(module_has_submodule(test_module, 'django'))\n+        self.assertRaises(ImportError, import_module, 'regressiontests.utils.test_module.django')\n+\n         # Don't be confused by caching of import misses\n         import types  # causes attempted import of regressiontests.utils.types\n         self.assertFalse(module_has_submodule(sys.modules['regressiontests.utils'], 'types'))\n@@ -84,6 +95,25 @@ def test_deep_loader(self):\n         self.assertFalse(module_has_submodule(egg_module, 'no_such_module'))\n         self.assertRaises(ImportError, import_module, 'egg_module.sub1.sub2.no_such_module')\n \n+class ProxyFinder(object):\n+    def __init__(self):\n+        self._cache = {}\n+\n+    def find_module(self, fullname, path=None):\n+        tail = fullname.rsplit('.', 1)[-1]\n+        try:\n+            self._cache[fullname] = imp.find_module(tail, path)\n+        except ImportError:\n+            return None\n+        else:\n+            return self  # this is a loader as well\n+\n+    def load_module(self, fullname):\n+        if fullname in sys.modules:\n+            return sys.modules[fullname]\n+        fd, fn, info = self._cache[fullname]\n+        return imp.load_module(fullname, fd, fn, info)\n+\n class TestFinder(object):\n     def __init__(self, *args, **kwargs):\n         self.importer = zipimporter(*args, **kwargs)"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 31,
        "deletions": 1
    }
}