{
    "author": "freakboy3742",
    "message": "Fixed #19401 -- Ensure that swappable model references are case insensitive.\n\nThis is necessary because get_model() checks are case insensitive, and if the swapable check isn't, the\nswappable logic gets tied up in knots with models that are partially swapped out.\n\nThanks to chris@cogdon.org for the report and extensive analysis, and Preston for his work on the draft patch.",
    "sha": "c04c03daa3620dc5106740a976738ada35203ab5",
    "files": [
        {
            "sha": "45b32b0ea412ec787de5cee01cf09e04d3ca53d1",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/c04c03daa3620dc5106740a976738ada35203ab5/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/c04c03daa3620dc5106740a976738ada35203ab5/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=c04c03daa3620dc5106740a976738ada35203ab5",
            "patch": "@@ -213,12 +213,25 @@ def _swapped(self):\n         \"\"\"\n         Has this model been swapped out for another? If so, return the model\n         name of the replacement; otherwise, return None.\n+\n+        For historical reasons, model name lookups using get_model() are\n+        case insensitive, so we make sure we are case insensitive here.\n         \"\"\"\n         if self.swappable:\n-            model_label = '%s.%s' % (self.app_label, self.object_name)\n+            model_label = '%s.%s' % (self.app_label, self.object_name.lower())\n             swapped_for = getattr(settings, self.swappable, None)\n-            if swapped_for not in (None, model_label):\n-                return swapped_for\n+            if swapped_for:\n+                try:\n+                    swapped_label, swapped_object = swapped_for.split('.')\n+                except ValueError:\n+                    # setting not in the format app_label.model_name\n+                    # raising ImproperlyConfigured here causes problems with\n+                    # test cleanup code - instead it is raised in get_user_model\n+                    # or as part of validation.\n+                    return swapped_for\n+\n+                if '%s.%s' % (swapped_label, swapped_object.lower()) not in (None, model_label):\n+                    return swapped_for\n         return None\n     swapped = property(_swapped)\n "
        },
        {
            "sha": "089b391416f32b5c6c3cf58db371cd5b7baf54c2",
            "filename": "tests/regressiontests/swappable_models/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/c04c03daa3620dc5106740a976738ada35203ab5/tests%2Fregressiontests%2Fswappable_models%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c04c03daa3620dc5106740a976738ada35203ab5/tests%2Fregressiontests%2Fswappable_models%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fswappable_models%2Ftests.py?ref=c04c03daa3620dc5106740a976738ada35203ab5",
            "patch": "@@ -9,6 +9,8 @@\n from django.test import TestCase\n from django.test.utils import override_settings\n \n+from regressiontests.swappable_models.models import Article\n+\n \n class SwappableModelTests(TestCase):\n     def setUp(self):\n@@ -44,3 +46,13 @@ def test_generated_data(self):\n                        for ct in ContentType.objects.all()]\n         self.assertIn(('swappable_models', 'alternatearticle'), apps_models)\n         self.assertNotIn(('swappable_models', 'article'), apps_models)\n+\n+    @override_settings(TEST_ARTICLE_MODEL='swappable_models.article')\n+    def test_case_insensitive(self):\n+        \"Model names are case insensitive. Check that model swapping honors this.\"\n+        try:\n+            Article.objects.all()\n+        except AttributeError:\n+            self.fail('Swappable model names should be case insensitive.')\n+\n+        self.assertIsNone(Article._meta.swapped)"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 28,
        "deletions": 3
    }
}