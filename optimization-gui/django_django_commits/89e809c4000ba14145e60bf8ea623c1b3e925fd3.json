{
    "author": "timgraham",
    "message": "Merge pull request #195 from pydanny/ajax-docs-example\n\nAdded example of AJAX form submission for CBVs.",
    "sha": "89e809c4000ba14145e60bf8ea623c1b3e925fd3",
    "files": [
        {
            "sha": "7bae3c692d6b85955a806376bbdf8d2739307675",
            "filename": "docs/topics/class-based-views/generic-editing.txt",
            "status": "modified",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/89e809c4000ba14145e60bf8ea623c1b3e925fd3/docs%2Ftopics%2Fclass-based-views%2Fgeneric-editing.txt",
            "raw_url": "https://github.com/django/django/raw/89e809c4000ba14145e60bf8ea623c1b3e925fd3/docs%2Ftopics%2Fclass-based-views%2Fgeneric-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Fgeneric-editing.txt?ref=89e809c4000ba14145e60bf8ea623c1b3e925fd3",
            "patch": "@@ -203,3 +203,43 @@ Note that you'll need to :ref:`decorate this\n view<decorating-class-based-views>` using\n :func:`~django.contrib.auth.decorators.login_required`, or\n alternatively handle unauthorised users in the :meth:`form_valid()`.\n+\n+AJAX example\n+------------\n+\n+Here is a simple example showing how you might go about implementing a form that\n+works for AJAX requests as well as 'normal' form POSTs::\n+\n+    import json\n+\n+    from django.http import HttpResponse\n+    from django.views.generic.edit import CreateView\n+    from django.views.generic.detail import SingleObjectTemplateResponseMixin\n+\n+    class AjaxableResponseMixin(object):\n+        \"\"\"\n+        Mixin to add AJAX support to a form.\n+        Must be used with an object-based FormView (e.g. CreateView)\n+        \"\"\"\n+        def render_to_json_response(self, context, **response_kwargs):\n+            data = json.dumps(context)\n+            response_kwargs['content_type'] = 'application/json'\n+            return HttpResponse(data, **response_kwargs)\n+\n+        def form_invalid(self, form):\n+            if self.request.is_ajax():\n+                return self.render_to_json_response(form.errors, status=400)\n+            else:\n+                return super(AjaxableResponseMixin, self).form_invalid(form)\n+\n+        def form_valid(self, form):\n+            if self.request.is_ajax():\n+                data = {\n+                    'pk': form.instance.pk,\n+                }\n+                return self.render_to_json_response(data)\n+            else:\n+                return super(AjaxableResponseMixin, self).form_valid(form)\n+\n+    class AuthorCreate(AjaxableResponseMixin, CreateView):\n+        model = Author"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 40,
        "deletions": 0
    }
}