{
    "author": "aaugustin",
    "message": "Removed a Python 3-compatibility hack.\n\nThanks Preston Holmes for the patch.",
    "sha": "ae4125ffce6c0a82e9016f67d60d31bc7595887c",
    "files": [
        {
            "sha": "002e2aff65975c10c4f990baf541a74d3a3007e6",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 13,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/ae4125ffce6c0a82e9016f67d60d31bc7595887c/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/ae4125ffce6c0a82e9016f67d60d31bc7595887c/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=ae4125ffce6c0a82e9016f67d60d31bc7595887c",
            "patch": "@@ -34,7 +34,10 @@ class ModelBase(type):\n     \"\"\"\n     def __new__(cls, name, bases, attrs):\n         super_new = super(ModelBase, cls).__new__\n-        parents = [b for b in bases if isinstance(b, ModelBase)]\n+        # six.with_metaclass() inserts an extra class called 'NewBase' in the\n+        # inheritance tree: Model -> NewBase -> object. Ignore this class.\n+        parents = [b for b in bases if isinstance(b, ModelBase) and\n+                not (b.__name__ == 'NewBase' and b.__mro__ == (b, object))]\n         if not parents:\n             # If this isn't a subclass of Model, don't do anything special.\n             return super_new(cls, name, bases, attrs)\n@@ -276,8 +279,7 @@ def __init__(self, db=None):\n         # This impacts validation only; it has no effect on the actual save.\n         self.adding = True\n \n-\n-class ModelWithoutMeta(object):\n+class Model(six.with_metaclass(ModelBase, object)):\n     _deferred = False\n \n     def __init__(self, *args, **kwargs):\n@@ -370,7 +372,7 @@ def __init__(self, *args, **kwargs):\n                     pass\n             if kwargs:\n                 raise TypeError(\"'%s' is an invalid keyword argument for this function\" % kwargs.keys()[0])\n-        super(ModelWithoutMeta, self).__init__()\n+        super(Model, self).__init__()\n         signals.post_init.send(sender=self.__class__, instance=self)\n \n     def __repr__(self):\n@@ -402,7 +404,7 @@ def __reduce__(self):\n         only module-level classes can be pickled by the default path.\n         \"\"\"\n         if not self._deferred:\n-            return super(ModelWithoutMeta, self).__reduce__()\n+            return super(Model, self).__reduce__()\n         data = self.__dict__\n         defers = []\n         for field in self._meta.fields:\n@@ -877,14 +879,6 @@ def clean_fields(self, exclude=None):\n             raise ValidationError(errors)\n \n \n-# For unknown reasons, six.with_metaclass doesn't work correctly for Model.\n-# Fallback to exec'ing the appropriate syntax for each Python version.\n-\n-if six.PY3:\n-    six.exec_(\"class Model(ModelWithoutMeta, metaclass=ModelBase): pass\")\n-else:\n-    six.exec_(\"class Model(ModelWithoutMeta): __metaclass__ = ModelBase\")\n-\n \n ############################################\n # HELPER FUNCTIONS (CURRIED MODEL METHODS) #"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 7,
        "deletions": 13
    }
}