{
    "author": "spookylukey",
    "message": "Removed Django 1.2 compatibility fallback for contrib.comments forms hash.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15953 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "5fa11b00352ec14c30a1eeea1377339adc8fc3ff",
    "files": [
        {
            "sha": "d497572488e100c26e25dbd31377167accf4fe9a",
            "filename": "django/contrib/comments/forms.py",
            "status": "modified",
            "additions": 1,
            "deletions": 13,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/5fa11b00352ec14c30a1eeea1377339adc8fc3ff/django%2Fcontrib%2Fcomments%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/5fa11b00352ec14c30a1eeea1377339adc8fc3ff/django%2Fcontrib%2Fcomments%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fforms.py?ref=5fa11b00352ec14c30a1eeea1377339adc8fc3ff",
            "patch": "@@ -1,5 +1,4 @@\n import datetime\n-import hashlib\n import time\n from django import forms\n from django.forms.util import ErrorDict\n@@ -47,12 +46,7 @@ def clean_security_hash(self):\n         expected_hash = self.generate_security_hash(**security_hash_dict)\n         actual_hash = self.cleaned_data[\"security_hash\"]\n         if not constant_time_compare(expected_hash, actual_hash):\n-            # Fallback to Django 1.2 method for compatibility\n-            # PendingDeprecationWarning <- here to remind us to remove this\n-            # fallback in Django 1.5\n-            expected_hash_old = self._generate_security_hash_old(**security_hash_dict)\n-            if not constant_time_compare(expected_hash_old, actual_hash):\n-                raise forms.ValidationError(\"Security hash check failed.\")\n+            raise forms.ValidationError(\"Security hash check failed.\")\n         return actual_hash\n \n     def clean_timestamp(self):\n@@ -95,12 +89,6 @@ def generate_security_hash(self, content_type, object_pk, timestamp):\n         value = \"-\".join(info)\n         return salted_hmac(key_salt, value).hexdigest()\n \n-    def _generate_security_hash_old(self, content_type, object_pk, timestamp):\n-        \"\"\"Generate a (SHA1) security hash from the provided info.\"\"\"\n-        # Django 1.2 compatibility\n-        info = (content_type, object_pk, timestamp, settings.SECRET_KEY)\n-        return hashlib.sha1(\"\".join(info)).hexdigest()\n-\n class CommentDetailsForm(CommentSecurityForm):\n     \"\"\"\n     Handles the specific details of the comment (name, comment, etc.)."
        },
        {
            "sha": "2c5e1fe551162989ff97846065dab232f18b15e4",
            "filename": "tests/regressiontests/comment_tests/tests/comment_form_tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/5fa11b00352ec14c30a1eeea1377339adc8fc3ff/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fcomment_form_tests.py",
            "raw_url": "https://github.com/django/django/raw/5fa11b00352ec14c30a1eeea1377339adc8fc3ff/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fcomment_form_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fcomment_form_tests.py?ref=5fa11b00352ec14c30a1eeea1377339adc8fc3ff",
            "patch": "@@ -1,4 +1,3 @@\n-import hashlib\n import time\n \n from django.conf import settings\n@@ -46,23 +45,6 @@ def testContentTypeTampering(self):\n     def testObjectPKTampering(self):\n         self.tamperWithForm(object_pk=\"3\")\n \n-    def testDjango12Hash(self):\n-        # Ensure we can use the hashes generated by Django 1.2\n-        a = Article.objects.get(pk=1)\n-        d = self.getValidData(a)\n-\n-        content_type = d['content_type']\n-        object_pk = d['object_pk']\n-        timestamp = d['timestamp']\n-\n-        # The Django 1.2 method hard-coded here:\n-        info = (content_type, object_pk, timestamp, settings.SECRET_KEY)\n-        security_hash = hashlib.sha1(\"\".join(info)).hexdigest()\n-\n-        d['security_hash'] = security_hash\n-        f = CommentForm(a, data=d)\n-        self.assertTrue(f.is_valid(), f.errors)\n-\n     def testSecurityErrors(self):\n         f = self.tamperWithForm(honeypot=\"I am a robot\")\n         self.assertTrue(\"honeypot\" in f.security_errors())"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 1,
        "deletions": 31
    }
}