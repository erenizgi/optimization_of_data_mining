{
    "author": "gsong",
    "message": "Fixed #19896 -- Committed after clearing cache in the database.",
    "sha": "44164c5c308da32a804dfb03ce0bffde2a6b4c56",
    "files": [
        {
            "sha": "bb91d8cb0547dbd46aa57cef624c2111632c1a03",
            "filename": "django/core/cache/backends/db.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/44164c5c308da32a804dfb03ce0bffde2a6b4c56/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/44164c5c308da32a804dfb03ce0bffde2a6b4c56/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fdb.py?ref=44164c5c308da32a804dfb03ce0bffde2a6b4c56",
            "patch": "@@ -184,6 +184,7 @@ def clear(self):\n         table = connections[db].ops.quote_name(self._table)\n         cursor = connections[db].cursor()\n         cursor.execute('DELETE FROM %s' % table)\n+        transaction.commit_unless_managed(using=db)\n \n # For backwards compatibility\n class CacheClass(DatabaseCache):"
        },
        {
            "sha": "b446465d3201dec33c6e95fbcdccd3bbb902072b",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/44164c5c308da32a804dfb03ce0bffde2a6b4c56/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/44164c5c308da32a804dfb03ce0bffde2a6b4c56/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=44164c5c308da32a804dfb03ce0bffde2a6b4c56",
            "patch": "@@ -18,7 +18,7 @@\n from django.core.cache import get_cache\n from django.core.cache.backends.base import (CacheKeyWarning,\n     InvalidCacheBackendError)\n-from django.db import router\n+from django.db import router, transaction\n from django.http import (HttpResponse, HttpRequest, StreamingHttpResponse,\n     QueryDict)\n from django.middleware.cache import (FetchFromCacheMiddleware,\n@@ -836,6 +836,13 @@ def test_second_call_doesnt_crash(self):\n                 interactive=False\n             )\n \n+    def test_clear_commits_transaction(self):\n+        # Ensure the database transaction is committed (#19896)\n+        self.cache.set(\"key1\", \"spam\")\n+        self.cache.clear()\n+        transaction.rollback()\n+        self.assertEqual(self.cache.get(\"key1\"), None)\n+\n \n @override_settings(USE_TZ=True)\n class DBCacheWithTimeZoneTests(DBCacheTests):"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
    }
}