{
    "author": "aaugustin",
    "message": "Fixed #17348 -- Implemented {% elif %}. Refs #3100.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17187 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "19cbdf8c8f6f5da5687cfec659841176b6af7d67",
    "files": [
        {
            "sha": "b7c36f5710c142c1aefeb73a93da6b9e4a5f1669",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 51,
            "deletions": 26,
            "changes": 77,
            "blob_url": "https://github.com/django/django/blob/19cbdf8c8f6f5da5687cfec659841176b6af7d67/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/19cbdf8c8f6f5da5687cfec659841176b6af7d67/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=19cbdf8c8f6f5da5687cfec659841176b6af7d67",
            "patch": "@@ -250,31 +250,37 @@ def render(self, context):\n         return self.nodelist_false.render(context)\n \n class IfNode(Node):\n-    child_nodelists = ('nodelist_true', 'nodelist_false')\n \n-    def __init__(self, var, nodelist_true, nodelist_false=None):\n-        self.nodelist_true, self.nodelist_false = nodelist_true, nodelist_false\n-        self.var = var\n+    def __init__(self, conditions_nodelists):\n+        self.conditions_nodelists = conditions_nodelists\n \n     def __repr__(self):\n-        return \"<If node>\"\n+        return \"<IfNode>\"\n \n     def __iter__(self):\n-        for node in self.nodelist_true:\n-            yield node\n-        for node in self.nodelist_false:\n-            yield node\n+        for _, nodelist in self.conditions_nodelists:\n+            for node in nodelist:\n+                yield node\n+\n+    @property\n+    def nodelist(self):\n+        return NodeList(node for _, nodelist in self.conditions_nodelists for node in nodelist)\n \n     def render(self, context):\n-        try:\n-            var = self.var.eval(context)\n-        except VariableDoesNotExist:\n-            var = None\n+        for condition, nodelist in self.conditions_nodelists:\n \n-        if var:\n-            return self.nodelist_true.render(context)\n-        else:\n-            return self.nodelist_false.render(context)\n+            if condition is not None:           # if / elif clause\n+                try:\n+                    match = condition.eval(context)\n+                except VariableDoesNotExist:\n+                    match = None\n+            else:                               # else clause\n+                match = True\n+\n+            if match:\n+                return nodelist.render(context)\n+\n+        return ''\n \n class RegroupNode(Node):\n     def __init__(self, target, expression, var_name):\n@@ -825,15 +831,18 @@ def do_if(parser, token):\n \n         {% if athlete_list %}\n             Number of athletes: {{ athlete_list|count }}\n+        {% elif athlete_in_locker_room_list %}\n+            Athletes should be out of the locker room soon!\n         {% else %}\n             No athletes.\n         {% endif %}\n \n     In the above, if ``athlete_list`` is not empty, the number of athletes will\n     be displayed by the ``{{ athlete_list|count }}`` variable.\n \n-    As you can see, the ``if`` tag can take an option ``{% else %}`` clause\n-    that will be displayed if the test fails.\n+    As you can see, the ``if`` tag may take one or several `` {% elif %}``\n+    clauses, as well as an ``{% else %}`` clause that will be displayed if all\n+    previous conditions fail. These clauses are optional.\n \n     ``if`` tags may use ``or``, ``and`` or ``not`` to test a number of\n     variables or to negate a given variable::\n@@ -871,16 +880,32 @@ def do_if(parser, token):\n \n     Operator precedence follows Python.\n     \"\"\"\n+    # {% if ... %}\n     bits = token.split_contents()[1:]\n-    var = TemplateIfParser(parser, bits).parse()\n-    nodelist_true = parser.parse(('else', 'endif'))\n+    condition = TemplateIfParser(parser, bits).parse()\n+    nodelist = parser.parse(('elif', 'else', 'endif'))\n+    conditions_nodelists = [(condition, nodelist)]\n     token = parser.next_token()\n+\n+    # {% elif ... %} (repeatable)\n+    while token.contents.startswith('elif'):\n+        bits = token.split_contents()[1:]\n+        condition = TemplateIfParser(parser, bits).parse()\n+        nodelist = parser.parse(('elif', 'else', 'endif'))\n+        conditions_nodelists.append((condition, nodelist))\n+        token = parser.next_token()\n+\n+    # {% else %} (optional)\n     if token.contents == 'else':\n-        nodelist_false = parser.parse(('endif',))\n-        parser.delete_first_token()\n-    else:\n-        nodelist_false = NodeList()\n-    return IfNode(var, nodelist_true, nodelist_false)\n+        nodelist = parser.parse(('endif',))\n+        conditions_nodelists.append((None, nodelist))\n+        token = parser.next_token()\n+\n+    # {% endif %}\n+    assert token.contents == 'endif'\n+\n+    return IfNode(conditions_nodelists)\n+\n \n @register.tag\n def ifchanged(parser, token):"
        },
        {
            "sha": "c592b7903732524c7d03be8f8155d028fda8d0fd",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/19cbdf8c8f6f5da5687cfec659841176b6af7d67/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/19cbdf8c8f6f5da5687cfec659841176b6af7d67/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=19cbdf8c8f6f5da5687cfec659841176b6af7d67",
            "patch": "@@ -366,15 +366,22 @@ block are output::\n \n     {% if athlete_list %}\n         Number of athletes: {{ athlete_list|length }}\n+    {% elif athlete_in_locker_room_list %}\n+        Athletes should be out of the locker room soon!\n     {% else %}\n         No athletes.\n     {% endif %}\n \n In the above, if ``athlete_list`` is not empty, the number of athletes will be\n displayed by the ``{{ athlete_list|length }}`` variable.\n \n-As you can see, the ``if`` tag can take an optional ``{% else %}`` clause that\n-will be displayed if the test fails.\n+As you can see, the ``if`` tag may take one or several `` {% elif %}``\n+clauses, as well as an ``{% else %}`` clause that will be displayed if all\n+previous conditions fail. These clauses are optional.\n+\n+.. versionadded:: 1.4\n+\n+The ``if`` tag now supports ``{% elif %}`` clauses.\n \n Boolean operators\n ^^^^^^^^^^^^^^^^^"
        },
        {
            "sha": "491556bfa26e02a19af1461e498c059e25aa3e89",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/19cbdf8c8f6f5da5687cfec659841176b6af7d67/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/19cbdf8c8f6f5da5687cfec659841176b6af7d67/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=19cbdf8c8f6f5da5687cfec659841176b6af7d67",
            "patch": "@@ -484,6 +484,8 @@ Django 1.4 also includes several smaller improvements worth noting:\n   be able to retrieve a translation string without displaying it but setting\n   a template context variable instead.\n \n+* The :ttag:`if` template tag now supports ``{% elif %}`` clauses.\n+\n * A new plain text version of the HTTP 500 status code internal error page\n   served when :setting:`DEBUG` is ``True`` is now sent to the client when\n   Django detects that the request has originated in JavaScript code"
        },
        {
            "sha": "4e0c1f19e4882559caf1b9ba4552f5026f9bc63c",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/19cbdf8c8f6f5da5687cfec659841176b6af7d67/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/19cbdf8c8f6f5da5687cfec659841176b6af7d67/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=19cbdf8c8f6f5da5687cfec659841176b6af7d67",
            "patch": "@@ -394,7 +394,7 @@ def test_invalid_block_suggestion(self):\n         try:\n             t = Template(\"{% if 1 %}lala{% endblock %}{% endif %}\")\n         except TemplateSyntaxError, e:\n-            self.assertEqual(e.args[0], \"Invalid block tag: 'endblock', expected 'else' or 'endif'\")\n+            self.assertEqual(e.args[0], \"Invalid block tag: 'endblock', expected 'elif', 'else' or 'endif'\")\n \n     def test_templates(self):\n         template_tests = self.get_template_tests()\n@@ -823,6 +823,17 @@ def get_template_tests(self):\n             'if-tag02': (\"{% if foo %}yes{% else %}no{% endif %}\", {\"foo\": False}, \"no\"),\n             'if-tag03': (\"{% if foo %}yes{% else %}no{% endif %}\", {}, \"no\"),\n \n+            'if-tag04': (\"{% if foo %}foo{% elif bar %}bar{% endif %}\", {'foo': True}, \"foo\"),\n+            'if-tag05': (\"{% if foo %}foo{% elif bar %}bar{% endif %}\", {'bar': True}, \"bar\"),\n+            'if-tag06': (\"{% if foo %}foo{% elif bar %}bar{% endif %}\", {}, \"\"),\n+            'if-tag07': (\"{% if foo %}foo{% elif bar %}bar{% else %}nothing{% endif %}\", {'foo': True}, \"foo\"),\n+            'if-tag08': (\"{% if foo %}foo{% elif bar %}bar{% else %}nothing{% endif %}\", {'bar': True}, \"bar\"),\n+            'if-tag09': (\"{% if foo %}foo{% elif bar %}bar{% else %}nothing{% endif %}\", {}, \"nothing\"),\n+            'if-tag10': (\"{% if foo %}foo{% elif bar %}bar{% elif baz %}baz{% else %}nothing{% endif %}\", {'foo': True}, \"foo\"),\n+            'if-tag11': (\"{% if foo %}foo{% elif bar %}bar{% elif baz %}baz{% else %}nothing{% endif %}\", {'bar': True}, \"bar\"),\n+            'if-tag12': (\"{% if foo %}foo{% elif bar %}bar{% elif baz %}baz{% else %}nothing{% endif %}\", {'baz': True}, \"baz\"),\n+            'if-tag13': (\"{% if foo %}foo{% elif bar %}bar{% elif baz %}baz{% else %}nothing{% endif %}\", {}, \"nothing\"),\n+\n             # Filters\n             'if-tag-filter01': (\"{% if foo|length == 5 %}yes{% else %}no{% endif %}\", {'foo': 'abcde'}, \"yes\"),\n             'if-tag-filter02': (\"{% if foo|upper == 'ABC' %}yes{% else %}no{% endif %}\", {}, \"no\"),"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 74,
        "deletions": 29
    }
}