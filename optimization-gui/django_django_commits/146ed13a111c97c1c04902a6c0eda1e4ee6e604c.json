{
    "author": "aaugustin",
    "message": "Fixed #17083 -- Allowed sessions to use non-default cache.",
    "sha": "146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
    "files": [
        {
            "sha": "c533efc41cae68cebe3533317d2f4530bd5655c0",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
            "patch": "@@ -445,6 +445,7 @@\n # SESSIONS #\n ############\n \n+SESSION_CACHE_ALIAS = 'default'                         # Cache to store session data if using the cache session backend.\n SESSION_COOKIE_NAME = 'sessionid'                       # Cookie name. This can be whatever you want.\n SESSION_COOKIE_AGE = 60 * 60 * 24 * 7 * 2               # Age of cookie, in seconds (default: 2 weeks).\n SESSION_COOKIE_DOMAIN = None                            # A string like \".example.com\", or None for standard domain cookie."
        },
        {
            "sha": "596042fcb3220dd196e5a1e06e249f68d2db0708",
            "filename": "django/contrib/sessions/backends/cache.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py?ref=146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
            "patch": "@@ -1,5 +1,6 @@\n+from django.conf import settings\n from django.contrib.sessions.backends.base import SessionBase, CreateError\n-from django.core.cache import cache\n+from django.core.cache import get_cache\n from django.utils.six.moves import xrange\n \n KEY_PREFIX = \"django.contrib.sessions.cache\"\n@@ -10,7 +11,7 @@ class SessionStore(SessionBase):\n     A cache-based session store.\n     \"\"\"\n     def __init__(self, session_key=None):\n-        self._cache = cache\n+        self._cache = get_cache(settings.SESSION_CACHE_ALIAS)\n         super(SessionStore, self).__init__(session_key)\n \n     @property"
        },
        {
            "sha": "da79ac9de6077633a8626fd39b373eb25c4759eb",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 22,
            "deletions": 4,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
            "patch": "@@ -13,8 +13,8 @@\n from django.contrib.sessions.backends.signed_cookies import SessionStore as CookieSession\n from django.contrib.sessions.models import Session\n from django.contrib.sessions.middleware import SessionMiddleware\n+from django.core.cache import get_cache\n from django.core import management\n-from django.core.cache import DEFAULT_CACHE_ALIAS\n from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.http import HttpResponse\n from django.test import TestCase, RequestFactory\n@@ -136,8 +136,8 @@ def test_clear(self):\n         self.assertTrue(self.session.modified)\n \n     def test_save(self):\n-        if (hasattr(self.session, '_cache') and\n-                'DummyCache' in settings.CACHES[DEFAULT_CACHE_ALIAS]['BACKEND']):\n+        if (hasattr(self.session, '_cache') and'DummyCache' in\n+            settings.CACHES[settings.SESSION_CACHE_ALIAS]['BACKEND']):\n             raise unittest.SkipTest(\"Session saving tests require a real cache backend\")\n         self.session.save()\n         self.assertTrue(self.session.exists(self.session.session_key))\n@@ -355,7 +355,8 @@ class CacheDBSessionTests(SessionTestsMixin, TestCase):\n \n     backend = CacheDBSession\n \n-    @unittest.skipIf('DummyCache' in settings.CACHES[DEFAULT_CACHE_ALIAS]['BACKEND'],\n+    @unittest.skipIf('DummyCache' in\n+        settings.CACHES[settings.SESSION_CACHE_ALIAS]['BACKEND'],\n         \"Session saving tests require a real cache backend\")\n     def test_exists_searches_cache_first(self):\n         self.session.save()\n@@ -454,6 +455,23 @@ def test_load_overlong_key(self):\n             self.session._session_key = (string.ascii_letters + string.digits) * 20\n             self.assertEqual(self.session.load(), {})\n \n+    def test_default_cache(self):\n+        self.session.save()\n+        self.assertNotEqual(get_cache('default').get(self.session.cache_key), None)\n+\n+    @override_settings(CACHES={\n+        'default': {\n+            'BACKEND': 'django.core.cache.backends.dummy.DummyCache',\n+        },\n+        'sessions': {\n+            'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',\n+        },\n+    }, SESSION_CACHE_ALIAS='sessions')\n+    def test_non_default_cache(self):\n+        self.session.save()\n+        self.assertEqual(get_cache('default').get(self.session.cache_key), None)\n+        self.assertNotEqual(get_cache('sessions').get(self.session.cache_key), None)\n+\n \n class SessionMiddlewareTests(unittest.TestCase):\n "
        },
        {
            "sha": "e8b41afb3955a04b48afebdcd5c6a85d7cef542f",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
            "patch": "@@ -1693,6 +1693,16 @@ This is useful if you have multiple Django instances running under the same\n hostname. They can use different cookie paths, and each instance will only see\n its own session cookie.\n \n+.. setting:: SESSION_CACHE_ALIAS\n+\n+SESSION_CACHE_ALIAS\n+-------------------\n+\n+Default: ``default``\n+\n+If you're using :ref:`cache-based session storage <cached-sessions-backend>`,\n+this selects the cache to use.\n+\n .. setting:: SESSION_COOKIE_SECURE\n \n SESSION_COOKIE_SECURE"
        },
        {
            "sha": "e18a78afc8a861faacca7b2b767d07bf1953bb48",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
            "patch": "@@ -299,6 +299,9 @@ Django 1.5 also includes several smaller improvements worth noting:\n * RemoteUserMiddleware now forces logout when the REMOTE_USER header\n   disappears during the same browser session.\n \n+* The :ref:`cache-based session backend <cached-sessions-backend>` can store\n+  session data in a non-default cache.\n+\n Backwards incompatible changes in 1.5\n =====================================\n "
        },
        {
            "sha": "baf8aa5cb5b3649643264d8a83d7dc4e5f23bf86",
            "filename": "docs/topics/http/sessions.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "raw_url": "https://github.com/django/django/raw/146ed13a111c97c1c04902a6c0eda1e4ee6e604c/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fsessions.txt?ref=146ed13a111c97c1c04902a6c0eda1e4ee6e604c",
            "patch": "@@ -45,6 +45,8 @@ If you want to use a database-backed session, you need to add\n Once you have configured your installation, run ``manage.py syncdb``\n to install the single database table that stores session data.\n \n+.. _cached-sessions-backend:\n+\n Using cached sessions\n ---------------------\n \n@@ -62,6 +64,13 @@ sure you've configured your cache; see the :doc:`cache documentation\n     sessions directly instead of sending everything through the file or\n     database cache backends.\n \n+If you have multiple caches defined in :setting:`CACHES`, Django will use the\n+default cache. To use another cache, set :setting:`SESSION_CACHE_ALIAS` to the\n+name of that cache.\n+\n+.. versionchanged:: 1.5\n+    The :setting:`SESSION_CACHE_ALIAS` setting was added.\n+\n Once your cache is configured, you've got two choices for how to store data in\n the cache:\n "
        }
    ],
    "stats": {
        "total": 54,
        "additions": 48,
        "deletions": 6
    }
}