{
    "author": "claudep",
    "message": "Add a BinaryField model field\n\nThanks Michael Jung, Charl Botha and Florian Apolloner for review\nand help on the patch.",
    "sha": "8ee1eddb7e148de89aebde9e68da495633fc1ec9",
    "files": [
        {
            "sha": "3a57c29479ad2a107cca8b2029ee6d38e8ec1b55",
            "filename": "django/db/backends/mysql/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Fmysql%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Fmysql%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fcreation.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -7,6 +7,7 @@ class DatabaseCreation(BaseDatabaseCreation):\n     # If a column type is set to None, it won't be included in the output.\n     data_types = {\n         'AutoField':         'integer AUTO_INCREMENT',\n+        'BinaryField':       'longblob',\n         'BooleanField':      'bool',\n         'CharField':         'varchar(%(max_length)s)',\n         'CommaSeparatedIntegerField': 'varchar(%(max_length)s)',"
        },
        {
            "sha": "aaca74e8d1ee67d80c0d2708d12257c3fdd60d81",
            "filename": "django/db/backends/oracle/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -17,6 +17,7 @@ class DatabaseCreation(BaseDatabaseCreation):\n \n     data_types = {\n         'AutoField':                    'NUMBER(11)',\n+        'BinaryField':                  'BLOB',\n         'BooleanField':                 'NUMBER(1) CHECK (%(qn_column)s IN (0,1))',\n         'CharField':                    'NVARCHAR2(%(max_length)s)',\n         'CommaSeparatedIntegerField':   'VARCHAR2(%(max_length)s)',"
        },
        {
            "sha": "b19926b44026efc0225dddb729d0231327808099",
            "filename": "django/db/backends/postgresql_psycopg2/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -11,6 +11,7 @@ class DatabaseCreation(BaseDatabaseCreation):\n     # If a column type is set to None, it won't be included in the output.\n     data_types = {\n         'AutoField':         'serial',\n+        'BinaryField':       'bytea',\n         'BooleanField':      'boolean',\n         'CharField':         'varchar(%(max_length)s)',\n         'CommaSeparatedIntegerField': 'varchar(%(max_length)s)',"
        },
        {
            "sha": "c90a697e3528df4f6496722e04c60f9b36d916f6",
            "filename": "django/db/backends/sqlite3/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -9,6 +9,7 @@ class DatabaseCreation(BaseDatabaseCreation):\n     # schema inspection is more useful.\n     data_types = {\n         'AutoField':                    'integer',\n+        'BinaryField':                  'BLOB',\n         'BooleanField':                 'bool',\n         'CharField':                    'varchar(%(max_length)s)',\n         'CommaSeparatedIntegerField':   'varchar(%(max_length)s)',"
        },
        {
            "sha": "8302aaceaac60e9e305479de4d8dfb3c5a6128ed",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -1291,3 +1291,30 @@ def formfield(self, **kwargs):\n         }\n         defaults.update(kwargs)\n         return super(URLField, self).formfield(**defaults)\n+\n+class BinaryField(Field):\n+    description = _(\"Raw binary data\")\n+\n+    def __init__(self, *args, **kwargs):\n+        kwargs['editable'] = False\n+        super(BinaryField, self).__init__(*args, **kwargs)\n+        if self.max_length is not None:\n+            self.validators.append(validators.MaxLengthValidator(self.max_length))\n+\n+    def get_internal_type(self):\n+        return \"BinaryField\"\n+\n+    def get_default(self):\n+        if self.has_default() and not callable(self.default):\n+            return self.default\n+        default = super(BinaryField, self).get_default()\n+        if default == '':\n+            return b''\n+        return default\n+\n+    def get_db_prep_value(self, value, connection, prepared=False):\n+        value = super(BinaryField, self\n+            ).get_db_prep_value(value, connection, prepared)\n+        if value is not None:\n+            return connection.Database.Binary(value)\n+        return value"
        },
        {
            "sha": "208c5c1112f029dd3e8871a6aee3e33abd403607",
            "filename": "django/utils/six.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Futils%2Fsix.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/django%2Futils%2Fsix.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsix.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -394,10 +394,14 @@ def with_metaclass(meta, base=object):\n     _iterlists = \"lists\"\n     _assertRaisesRegex = \"assertRaisesRegex\"\n     _assertRegex = \"assertRegex\"\n+    memoryview = memoryview\n else:\n     _iterlists = \"iterlists\"\n     _assertRaisesRegex = \"assertRaisesRegexp\"\n     _assertRegex = \"assertRegexpMatches\"\n+    # memoryview and buffer are not stricly equivalent, but should be fine for\n+    # django core usage (mainly BinaryField)\n+    memoryview = buffer\n \n \n def iterlists(d):"
        },
        {
            "sha": "1dbc8c39983c1fd487351a19b9c3e2b00272c161",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -347,6 +347,22 @@ A 64 bit integer, much like an :class:`IntegerField` except that it is\n guaranteed to fit numbers from -9223372036854775808 to 9223372036854775807. The\n default form widget for this field is a :class:`~django.forms.TextInput`.\n \n+``BinaryField``\n+-------------------\n+\n+.. class:: BinaryField([**options])\n+\n+.. versionadded:: 1.6\n+\n+A field to store raw binary data. It only supports ``bytes`` assignment. Be\n+aware that this field has limited functionality. For example, it is not possible\n+to filter a queryset on a ``BinaryField`` value.\n+\n+.. admonition:: Abusing ``BinaryField``\n+\n+    Although you might think about storing files in the database, consider that\n+    it is bad design in 99% of the cases. This field is *not* a replacement for\n+    proper :ref.`static files <static-files> handling.\n \n ``BooleanField``\n ----------------"
        },
        {
            "sha": "89e7ff17eec0bc75592565d8b989a7799f1a7273",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -53,6 +53,12 @@ UTC. This limitation was lifted in Django 1.6. Use :meth:`QuerySet.datetimes()\n <django.db.models.query.QuerySet.datetimes>` to perform time zone aware\n aggregation on a :class:`~django.db.models.DateTimeField`.\n \n+``BinaryField`` model field\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+A new :class:`django.db.models.BinaryField` model field allows to store raw\n+binary data in the database.\n+\n Minor features\n ~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "c3b2f7fccb886408d592b0811662f9fec14cbc6f",
            "filename": "tests/model_fields/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/tests%2Fmodel_fields%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/tests%2Fmodel_fields%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodel_fields%2Fmodels.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -106,6 +106,10 @@ class VerboseNameField(models.Model):\n class DecimalLessThanOne(models.Model):\n     d = models.DecimalField(max_digits=3, decimal_places=3)\n \n+class DataModel(models.Model):\n+    short_data = models.BinaryField(max_length=10, default=b'\\x08')\n+    data = models.BinaryField()\n+\n ###############################################################################\n # FileField\n "
        },
        {
            "sha": "eaf84773e3a9980fe0dd7b7a4a4c604c4c022803",
            "filename": "tests/model_fields/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/8ee1eddb7e148de89aebde9e68da495633fc1ec9/tests%2Fmodel_fields%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8ee1eddb7e148de89aebde9e68da495633fc1ec9/tests%2Fmodel_fields%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodel_fields%2Ftests.py?ref=8ee1eddb7e148de89aebde9e68da495633fc1ec9",
            "patch": "@@ -12,8 +12,8 @@\n from django.utils import unittest\n \n from .models import (Foo, Bar, Whiz, BigD, BigS, Image, BigInt, Post,\n-    NullBooleanModel, BooleanModel, Document, RenamedField, VerboseNameField,\n-    FksToBooleans)\n+    NullBooleanModel, BooleanModel, DataModel, Document, RenamedField,\n+    VerboseNameField, FksToBooleans)\n \n from .imagefield import (ImageFieldTests, ImageFieldTwoDimensionsTests,\n     TwoImageFieldTests, ImageFieldNoDimensionsTests,\n@@ -424,3 +424,25 @@ def test_changed(self):\n         field = d._meta.get_field('myfile')\n         field.save_form_data(d, 'else.txt')\n         self.assertEqual(d.myfile, 'else.txt')\n+\n+\n+class BinaryFieldTests(test.TestCase):\n+    binary_data = b'\\x00\\x46\\xFE'\n+\n+    def test_set_and_retrieve(self):\n+        data_set = (self.binary_data, six.memoryview(self.binary_data))\n+        for bdata in data_set:\n+            dm = DataModel(data=bdata)\n+            dm.save()\n+            dm = DataModel.objects.get(pk=dm.pk)\n+            self.assertEqual(bytes(dm.data), bytes(bdata))\n+            # Resave (=update)\n+            dm.save()\n+            dm = DataModel.objects.get(pk=dm.pk)\n+            self.assertEqual(bytes(dm.data), bytes(bdata))\n+            # Test default value\n+            self.assertEqual(bytes(dm.short_data), b'\\x08')\n+\n+    def test_max_length(self):\n+        dm = DataModel(short_data=self.binary_data*4)\n+        self.assertRaises(ValidationError, dm.full_clean)"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 85,
        "deletions": 2
    }
}