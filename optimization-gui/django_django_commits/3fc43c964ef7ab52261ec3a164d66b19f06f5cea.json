{
    "author": "charettes",
    "message": "Fixed #19545 -- Make sure media/is_multipart work with empty formsets",
    "sha": "3fc43c964ef7ab52261ec3a164d66b19f06f5cea",
    "files": [
        {
            "sha": "ee9a2b5f63d09dd9157b376a98f5d1db817504a4",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/3fc43c964ef7ab52261ec3a164d66b19f06f5cea/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/3fc43c964ef7ab52261ec3a164d66b19f06f5cea/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=3fc43c964ef7ab52261ec3a164d66b19f06f5cea",
            "patch": "@@ -333,7 +333,10 @@ def is_multipart(self):\n         Returns True if the formset needs to be multipart, i.e. it\n         has FileInput. Otherwise, False.\n         \"\"\"\n-        return self.forms and self.forms[0].is_multipart()\n+        if self.forms:\n+            return self.forms[0].is_multipart()\n+        else:\n+            return self.empty_form.is_multipart()\n \n     @property\n     def media(self):\n@@ -342,7 +345,7 @@ def media(self):\n         if self.forms:\n             return self.forms[0].media\n         else:\n-            return Media()\n+            return self.empty_form.media\n \n     def as_table(self):\n         \"Returns this formset rendered as HTML <tr>s -- excluding the <table></table>.\""
        },
        {
            "sha": "ef6f40c3e30686bc7157c15547bd58eaa365abcd",
            "filename": "tests/regressiontests/forms/tests/formsets.py",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/3fc43c964ef7ab52261ec3a164d66b19f06f5cea/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/3fc43c964ef7ab52261ec3a164d66b19f06f5cea/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py?ref=3fc43c964ef7ab52261ec3a164d66b19f06f5cea",
            "patch": "@@ -1,8 +1,9 @@\n # -*- coding: utf-8 -*-\n from __future__ import unicode_literals\n \n-from django.forms import Form, CharField, IntegerField, ValidationError, DateField\n-from django.forms.formsets import formset_factory, BaseFormSet\n+from django.forms import (CharField, DateField, FileField, Form, IntegerField,\n+    ValidationError)\n+from django.forms.formsets import BaseFormSet, formset_factory\n from django.forms.util import ErrorList\n from django.test import TestCase\n \n@@ -974,11 +975,23 @@ def test_empty_forms_are_unbound(self):\n         self.assertHTMLEqual(empty_forms[0].as_p(), empty_forms[1].as_p())\n \n class TestEmptyFormSet(TestCase):\n-    \"Test that an empty formset still calls clean()\"\n     def test_empty_formset_is_valid(self):\n+        \"\"\"Test that an empty formset still calls clean()\"\"\"\n         EmptyFsetWontValidateFormset = formset_factory(FavoriteDrinkForm, extra=0, formset=EmptyFsetWontValidate)\n         formset = EmptyFsetWontValidateFormset(data={'form-INITIAL_FORMS':'0', 'form-TOTAL_FORMS':'0'},prefix=\"form\")\n         formset2 = EmptyFsetWontValidateFormset(data={'form-INITIAL_FORMS':'0', 'form-TOTAL_FORMS':'1', 'form-0-name':'bah' },prefix=\"form\")\n         self.assertFalse(formset.is_valid())\n         self.assertFalse(formset2.is_valid())\n \n+    def test_empty_formset_media(self):\n+        \"\"\"Make sure media is available on empty formset, refs #19545\"\"\"\n+        class MediaForm(Form):\n+            class Media:\n+                js = ('some-file.js',)\n+        self.assertIn('some-file.js', str(formset_factory(MediaForm, extra=0)().media))\n+\n+    def test_empty_formset_is_multipart(self):\n+        \"\"\"Make sure `is_multipart()` works with empty formset, refs #19545\"\"\"\n+        class FileForm(Form):\n+            file = FileField()\n+        self.assertTrue(formset_factory(FileForm, extra=0)().is_multipart())"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 21,
        "deletions": 5
    }
}