{
    "author": "akaariai",
    "message": "Fixed empty strings + to_field regression on Oracle\n\nQuerying the reverse side of nullable to_field relation, where both\nsides can contain null values resulted in incorrect results. The reason\nwas not detecting '' as NULL.\n\nRefs #17541",
    "sha": "09fcb70c804b76fccc8fc0ac545873e5ab30c00a",
    "files": [
        {
            "sha": "bea88ba3377e446202d526af95f894d0ecaea2c2",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/09fcb70c804b76fccc8fc0ac545873e5ab30c00a/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/09fcb70c804b76fccc8fc0ac545873e5ab30c00a/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=09fcb70c804b76fccc8fc0ac545873e5ab30c00a",
            "patch": "@@ -1,6 +1,6 @@\n from operator import attrgetter\n \n-from django.db import connection, router\n+from django.db import connection, connections, router\n from django.db.backends import util\n from django.db.models import signals, get_model\n from django.db.models.fields import (AutoField, Field, IntegerField,\n@@ -496,7 +496,8 @@ def get_query_set(self):\n                 except (AttributeError, KeyError):\n                     db = self._db or router.db_for_read(self.model, instance=self.instance)\n                     qs = super(RelatedManager, self).get_query_set().using(db).filter(**self.core_filters)\n-                    if getattr(self.instance, attname) is None:\n+                    val = getattr(self.instance, attname)\n+                    if val is None or val == '' and connections[db].features.interprets_empty_strings_as_nulls:\n                         return qs.none()\n                     qs._known_related_objects = {rel_field: {self.instance.pk: self.instance}}\n                     return qs"
        },
        {
            "sha": "a9969a7e903892fe1360a873981504c6c9416f58",
            "filename": "tests/regressiontests/many_to_one_regress/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/09fcb70c804b76fccc8fc0ac545873e5ab30c00a/tests%2Fregressiontests%2Fmany_to_one_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/09fcb70c804b76fccc8fc0ac545873e5ab30c00a/tests%2Fregressiontests%2Fmany_to_one_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmany_to_one_regress%2Ftests.py?ref=09fcb70c804b76fccc8fc0ac545873e5ab30c00a",
            "patch": "@@ -126,7 +126,7 @@ def test_relation_unsaved(self):\n         # Now the model is saved, so we will need to execute an query.\n         with self.assertNumQueries(1):\n             self.assertEqual(th.child_set.count(), 0)\n-    \n+\n     def test_related_null_to_field(self):\n         c1 = Car.objects.create()\n         c2 = Car.objects.create()"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 4,
        "deletions": 3
    }
}