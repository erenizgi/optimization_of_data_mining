{
    "author": "jezdez",
    "message": "Fixed #12771 -- Added naturaltime filter to humanize contrib app. Thanks, phinpho, djansoft and xtrqt.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16071 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "ea248f0107eb3bed5a4a0fb65d6065e5691bea0a",
    "files": [
        {
            "sha": "0c6d389e3443030546ee6fbc8ad0d0dac82489d8",
            "filename": "django/contrib/humanize/templatetags/humanize.py",
            "status": "modified",
            "additions": 34,
            "deletions": 2,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/ea248f0107eb3bed5a4a0fb65d6065e5691bea0a/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "raw_url": "https://github.com/django/django/raw/ea248f0107eb3bed5a4a0fb65d6065e5691bea0a/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py?ref=ea248f0107eb3bed5a4a0fb65d6065e5691bea0a",
            "patch": "@@ -2,7 +2,7 @@\n from django.utils.encoding import force_unicode\n from django import template\n from django.template import defaultfilters\n-from datetime import date\n+from datetime import date, datetime\n import re\n \n register = template.Library()\n@@ -83,7 +83,7 @@ def naturalday(value, arg=None):\n     present day returns representing string. Otherwise, returns a string\n     formatted according to settings.DATE_FORMAT.\n     \"\"\"\n-    try: \n+    try:\n         value = date(value.year, value.month, value.day)\n     except AttributeError:\n         # Passed value wasn't a date object\n@@ -100,3 +100,35 @@ def naturalday(value, arg=None):\n         return _(u'yesterday')\n     return defaultfilters.date(value, arg)\n register.filter(naturalday)\n+\n+def naturaltime(value, arg=None):\n+    \"\"\"\n+    For date and time values shows how many seconds, minutes or hours ago compared to\n+    current timestamp returns representing string. Otherwise, returns a string\n+    formatted according to settings.DATE_FORMAT\n+    \"\"\"\n+    try:\n+        value = datetime(value.year, value.month, value.day, value.hour, value.minute, value.second)\n+    except AttributeError:\n+        return value\n+    except ValueError:\n+        return value\n+\n+    delta = datetime.now() - value\n+    if delta.days != 0:\n+        value = date(value.year, value.month, value.day)\n+        return naturalday(value, arg)\n+    elif delta.seconds == 0:\n+        return _(u'now')\n+    elif delta.seconds < 60:\n+        return _(u'%s seconds ago' % (delta.seconds))\n+    elif delta.seconds / 60 < 2:\n+        return _(r'a minute ago')\n+    elif delta.seconds / 60 < 60:\n+        return _(u'%s minutes ago' % (delta.seconds/60))\n+    elif delta.seconds / 60 / 60 < 2:\n+        return _(u'an hour ago')\n+    elif delta.seconds / 60 / 60 < 24:\n+        return _(u'%s hours ago' % (delta.seconds/60/60))\n+    return naturalday(value, arg)\n+register.filter(naturaltime)"
        },
        {
            "sha": "f7afb9c5e84e97169afec4ba775088b2e9eb7d21",
            "filename": "docs/ref/contrib/humanize.txt",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/ea248f0107eb3bed5a4a0fb65d6065e5691bea0a/docs%2Fref%2Fcontrib%2Fhumanize.txt",
            "raw_url": "https://github.com/django/django/raw/ea248f0107eb3bed5a4a0fb65d6065e5691bea0a/docs%2Fref%2Fcontrib%2Fhumanize.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fhumanize.txt?ref=ea248f0107eb3bed5a4a0fb65d6065e5691bea0a",
            "patch": "@@ -82,6 +82,31 @@ Examples (when 'today' is 17 Feb 2007):\n     * Any other day is formatted according to given argument or the\n       :setting:`DATE_FORMAT` setting if no argument is given.\n \n+.. templatefilter:: naturaltime\n+\n+naturaltime\n+-----------\n+\n+.. versionadded:: 1.4\n+\n+For date and time values shows how many seconds, minutes or hours ago compared\n+to current timestamp returns representing string. Otherwise, it behaves like\n+:tfilter:`naturaldate`, so it can also take string argument for date formating.\n+\n+**Argument:** Date formatting string as described in the :tfilter:`date` tag.\n+\n+Examples (when 'now' is 17 Feb 2007 16:30:00):\n+\n+    * ``17 Feb 2007 16:30:00`` becomes ``now``.\n+    * ``17 Feb 2007 16:29:31`` becomes ``29 seconds ago``.\n+    * ``17 Feb 2007 16:29:00`` becomes ``a minute ago``.\n+    * ``17 Feb 2007 16:25:35`` becomes ``4 minutes ago``.\n+    * ``17 Feb 2007 15:30:29`` becomes ``an hours ago``.\n+    * ``17 Feb 2007 13:31:29`` becomes ``2 hours ago``.\n+    * ``16 Feb 2007 13:31:29`` becomes ``yesterday``.\n+    * Any other day is formatted according to given argument or the\n+      :setting:`DATE_FORMAT` setting if no argument is given.\n+\n .. templatefilter:: ordinal\n \n ordinal"
        },
        {
            "sha": "476de786ce6fd0e75b66415da7a540d01eadafa8",
            "filename": "tests/regressiontests/humanize/tests.py",
            "status": "modified",
            "additions": 27,
            "deletions": 1,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/ea248f0107eb3bed5a4a0fb65d6065e5691bea0a/tests%2Fregressiontests%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ea248f0107eb3bed5a4a0fb65d6065e5691bea0a/tests%2Fregressiontests%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhumanize%2Ftests.py?ref=ea248f0107eb3bed5a4a0fb65d6065e5691bea0a",
            "patch": "@@ -1,4 +1,4 @@\n-from datetime import timedelta, date\n+from datetime import timedelta, date, datetime\n \n from django.template import Template, Context, add_to_builtins\n from django.utils import unittest\n@@ -72,6 +72,32 @@ def test_naturalday(self):\n                        someday_result, u\"I'm not a date value\", None)\n         self.humanize_tester(test_list, result_list, 'naturalday')\n \n+    def test_naturaltime(self):\n+        from django.template import defaultfilters\n+        now = datetime.now()\n+        seconds_ago = now - timedelta(seconds=30)\n+        a_minute_ago = now - timedelta(minutes=1, seconds=30)\n+        minutes_ago = now - timedelta(minutes=2)\n+        an_hour_ago = now - timedelta(hours=1, minutes=30, seconds=30)\n+        hours_ago = now - timedelta(hours=23, minutes=50, seconds=50)\n+\n+        test_list = (now, a_minute_ago, an_hour_ago)\n+        result_list = (_(u'now'), _(u'a minute ago'), _(u'an hour ago'))\n+        self.humanize_tester(test_list, result_list, 'naturaltime')\n+\n+        t = Template('{{ seconds_ago|%s }}' % 'naturaltime')\n+        rendered = t.render(Context(locals())).strip()\n+        self.assertTrue(u' seconds ago' in rendered)\n+\n+        t = Template('{{ minutes_ago|%s }}' % 'naturaltime')\n+        rendered = t.render(Context(locals())).strip()\n+        self.assertTrue(u' minutes ago' in rendered)\n+\n+        t = Template('{{ hours_ago|%s }}' % 'naturaltime')\n+        rendered = t.render(Context(locals())).strip()\n+        self.assertTrue(u' hours ago' in rendered)\n+\n+\n if __name__ == '__main__':\n     unittest.main()\n "
        }
    ],
    "stats": {
        "total": 89,
        "additions": 86,
        "deletions": 3
    }
}