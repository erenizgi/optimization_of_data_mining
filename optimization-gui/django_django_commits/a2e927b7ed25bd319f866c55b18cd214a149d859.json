{
    "author": "mgrouchy",
    "message": "BaseCache now has a no-op close method as per ticket #18582\n\nAlso removed the hasattr check when firing request_finished signal for\ncaches with a 'close' method. Should be safe to call `cache.close`\neverywhere now",
    "sha": "a2e927b7ed25bd319f866c55b18cd214a149d859",
    "files": [
        {
            "sha": "44b6a90700c6d2bc8abf91c58562367e96d2b55d",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a2e927b7ed25bd319f866c55b18cd214a149d859/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/a2e927b7ed25bd319f866c55b18cd214a149d859/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=a2e927b7ed25bd319f866c55b18cd214a149d859",
            "patch": "@@ -229,6 +229,7 @@ answer newbie questions, and generally made Django that much better:\n     Simon Greenhill <dev@simon.net.nz>\n     Owen Griffiths\n     Espen Grindhaug <http://grindhaug.org/>\n+    Mike Grouchy <http://mikegrouchy.com/>\n     Janos Guljas\n     Thomas GÃ¼ttler <hv@tbz-pariv.de>\n     Horst Gutmann <zerok@zerokspot.com>"
        },
        {
            "sha": "457433925ae69e4af7c43b55f3cbd3c14c9839ab",
            "filename": "django/core/cache/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/a2e927b7ed25bd319f866c55b18cd214a149d859/django%2Fcore%2Fcache%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a2e927b7ed25bd319f866c55b18cd214a149d859/django%2Fcore%2Fcache%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2F__init__.py?ref=a2e927b7ed25bd319f866c55b18cd214a149d859",
            "patch": "@@ -133,11 +133,9 @@ def get_cache(backend, **kwargs):\n             \"Could not find backend '%s': %s\" % (backend, e))\n     cache = backend_cls(location, params)\n     # Some caches -- python-memcached in particular -- need to do a cleanup at the\n-    # end of a request cycle. If the cache provides a close() method, wire it up\n-    # here.\n-    if hasattr(cache, 'close'):\n-        signals.request_finished.connect(cache.close)\n+    # end of a request cycle. If not implemented in a particular backend\n+    # cache.close is a no-op\n+    signals.request_finished.connect(cache.close)\n     return cache\n \n cache = get_cache(DEFAULT_CACHE_ALIAS)\n-"
        },
        {
            "sha": "e28ebbe2cfdbe9c86d47ff1a7307a007da2c05df",
            "filename": "django/core/cache/backends/base.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/a2e927b7ed25bd319f866c55b18cd214a149d859/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/a2e927b7ed25bd319f866c55b18cd214a149d859/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fbase.py?ref=a2e927b7ed25bd319f866c55b18cd214a149d859",
            "patch": "@@ -6,15 +6,18 @@\n from django.utils.encoding import smart_str\n from django.utils.importlib import import_module\n \n+\n class InvalidCacheBackendError(ImproperlyConfigured):\n     pass\n \n+\n class CacheKeyWarning(DjangoRuntimeWarning):\n     pass\n \n # Memcached does not accept keys longer than this.\n MEMCACHE_MAX_KEY_LENGTH = 250\n \n+\n def default_key_func(key, key_prefix, version):\n     \"\"\"\n     Default function to generate keys.\n@@ -25,6 +28,7 @@ def default_key_func(key, key_prefix, version):\n     \"\"\"\n     return ':'.join([key_prefix, str(version), smart_str(key)])\n \n+\n def get_key_func(key_func):\n     \"\"\"\n     Function to decide which key function to use.\n@@ -40,6 +44,7 @@ def get_key_func(key_func):\n             return getattr(key_func_module, key_func_name)\n     return default_key_func\n \n+\n class BaseCache(object):\n     def __init__(self, params):\n         timeout = params.get('timeout', params.get('TIMEOUT', 300))\n@@ -221,3 +226,7 @@ def decr_version(self, key, delta=1, version=None):\n         the new version.\n         \"\"\"\n         return self.incr_version(key, -delta, version)\n+\n+    def close(self, **kwargs):\n+        \"\"\"Close the cache connection\"\"\"\n+        pass"
        },
        {
            "sha": "85f4c64aa84f3a29e20d6210b3ee303d04e99475",
            "filename": "docs/topics/cache.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/a2e927b7ed25bd319f866c55b18cd214a149d859/docs%2Ftopics%2Fcache.txt",
            "raw_url": "https://github.com/django/django/raw/a2e927b7ed25bd319f866c55b18cd214a149d859/docs%2Ftopics%2Fcache.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fcache.txt?ref=a2e927b7ed25bd319f866c55b18cd214a149d859",
            "patch": "@@ -779,6 +779,16 @@ nonexistent cache key.::\n     However, if the backend doesn't natively provide an increment/decrement\n     operation, it will be implemented using a two-step retrieve/update.\n \n+\n+You can close the connection to your cache with ``close()`` if implemented by\n+the cache backend.\n+\n+    >>> cache.close()\n+\n+.. note::\n+\n+    For caches that don't implement ``close`` methods it is a no-op.\n+\n .. _cache_key_prefixing:\n \n Cache key prefixing"
        },
        {
            "sha": "b85c8d4cf397afbb5ddab5f5da27eda3b347ce60",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a2e927b7ed25bd319f866c55b18cd214a149d859/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a2e927b7ed25bd319f866c55b18cd214a149d859/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=a2e927b7ed25bd319f866c55b18cd214a149d859",
            "patch": "@@ -266,6 +266,10 @@ def test_decr(self):\n         self.assertEqual(self.cache.get('answer'), 32)\n         self.assertRaises(ValueError, self.cache.decr, 'does_not_exist')\n \n+    def test_close(self):\n+        self.assertTrue(hasattr(self.cache, 'close'))\n+        self.cache.close()\n+\n     def test_data_types(self):\n         # Many different data types can be cached\n         stuff = {"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 27,
        "deletions": 5
    }
}