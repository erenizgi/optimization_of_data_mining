{
    "author": "jezdez",
    "message": "Fixed #17689 -- Stopped the CachedStaticFilesStorage from trying to hash paths that aren't files.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17535 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "758a0cd0f1c646abf6f7d4f01850d3729ad603e0",
    "files": [
        {
            "sha": "ac83f522eeae9f339a4fd73865ba9c25863734ec",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/758a0cd0f1c646abf6f7d4f01850d3729ad603e0/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/758a0cd0f1c646abf6f7d4f01850d3729ad603e0/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=758a0cd0f1c646abf6f7d4f01850d3729ad603e0",
            "patch": "@@ -105,13 +105,16 @@ def url(self, name, force=False):\n             hashed_name, fragment = name, ''\n         else:\n             clean_name, fragment = urldefrag(name)\n-            cache_key = self.cache_key(name)\n-            hashed_name = self.cache.get(cache_key)\n-            if hashed_name is None:\n-                hashed_name = self.hashed_name(clean_name).replace('\\\\', '/')\n-                # set the cache if there was a miss\n-                # (e.g. if cache server goes down)\n-                self.cache.set(cache_key, hashed_name)\n+            if urlsplit(clean_name).path.endswith('/'):  # don't hash paths\n+                hashed_name = name\n+            else:\n+                cache_key = self.cache_key(name)\n+                hashed_name = self.cache.get(cache_key)\n+                if hashed_name is None:\n+                    hashed_name = self.hashed_name(clean_name).replace('\\\\', '/')\n+                    # set the cache if there was a miss\n+                    # (e.g. if cache server goes down)\n+                    self.cache.set(cache_key, hashed_name)\n \n         final_url = super(CachedFilesMixin, self).url(hashed_name)\n "
        },
        {
            "sha": "9834885fdd9df01e89127b0ab224c46430dd0787",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/758a0cd0f1c646abf6f7d4f01850d3729ad603e0/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/758a0cd0f1c646abf6f7d4f01850d3729ad603e0/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=758a0cd0f1c646abf6f7d4f01850d3729ad603e0",
            "patch": "@@ -317,6 +317,10 @@ def test_template_tag_return(self):\n                                  \"/static/test/file.ea5bccaf16d5.txt\")\n         self.assertStaticRenders(\"cached/styles.css\",\n                                  \"/static/cached/styles.93b1147e8552.css\")\n+        self.assertStaticRenders(\"path/\",\n+                                 \"/static/path/\")\n+        self.assertStaticRenders(\"path/?query\",\n+                                 \"/static/path/?query\")\n \n     def test_template_tag_simple_content(self):\n         relpath = self.cached_file_path(\"cached/styles.css\")"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 14,
        "deletions": 7
    }
}