{
    "author": "jphalip",
    "message": "Fixed #17165 -- Fixed `SelectDateWidget._has_changed()` to work correctly with a localized date format.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17071 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e",
    "files": [
        {
            "sha": "4fb4869e689a70f9df4c251a8796ab9092b0aaa9",
            "filename": "django/forms/extras/widgets.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e/django%2Fforms%2Fextras%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e/django%2Fforms%2Fextras%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fextras%2Fwidgets.py?ref=b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e",
            "patch": "@@ -134,3 +134,8 @@ def create_select(self, name, field, value, val, choices):\n         s = Select(choices=choices)\n         select_html = s.render(field % name, val, local_attrs)\n         return select_html\n+\n+    def _has_changed(self, initial, data):\n+        input_format = get_format('DATE_INPUT_FORMATS')[0]\n+        data = datetime_safe.datetime.strptime(data, input_format).date()\n+        return super(SelectDateWidget, self)._has_changed(initial, data)\n\\ No newline at end of file"
        },
        {
            "sha": "cbec105e948a7fd23cb17e993309463d5f8f724f",
            "filename": "tests/regressiontests/forms/tests/extra.py",
            "status": "modified",
            "additions": 57,
            "deletions": 0,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py?ref=b2948d81798e78e0b3bcb016bd4efa4d66bc5d8e",
            "patch": "@@ -17,6 +17,9 @@\n class GetDate(Form):\n     mydate = DateField(widget=SelectDateWidget)\n \n+class GetDateShowHiddenInitial(Form):\n+    mydate = DateField(widget=SelectDateWidget, show_hidden_initial=True)\n+\n class FormsExtraTestCase(unittest.TestCase, AssertFormErrorsMixin):\n     ###############\n     # Extra stuff #\n@@ -697,6 +700,60 @@ def test_l10n(self):\n         w = SelectDateWidget(years=('1899',))\n         self.assertEqual(w.value_from_datadict({'date_year': '1899', 'date_month': '8', 'date_day': '13'}, {}, 'date'), '13-08-1899')\n \n+    def test_l10n_date_changed(self):\n+        \"\"\"\n+        Ensure that SelectDateWidget._has_changed() works correctly with a\n+        localized date format.\n+        Refs #17165.\n+        \"\"\"\n+        # With Field.show_hidden_initial=False -----------------------\n+        b = GetDate({\n+            'mydate_year': '2008',\n+            'mydate_month': '4',\n+            'mydate_day': '1',\n+        }, initial={'mydate': datetime.date(2008, 4, 1)})\n+        self.assertFalse(b.has_changed())\n+\n+        b = GetDate({\n+            'mydate_year': '2008',\n+            'mydate_month': '4',\n+            'mydate_day': '2',\n+        }, initial={'mydate': datetime.date(2008, 4, 1)})\n+        self.assertTrue(b.has_changed())\n+\n+        # With Field.show_hidden_initial=True ------------------------\n+        b = GetDateShowHiddenInitial({\n+            'mydate_year': '2008',\n+            'mydate_month': '4',\n+            'mydate_day': '1',\n+            'initial-mydate': HiddenInput()._format_value(datetime.date(2008, 4, 1))\n+        }, initial={'mydate': datetime.date(2008, 4, 1)})\n+        self.assertFalse(b.has_changed())\n+\n+        b = GetDateShowHiddenInitial({\n+            'mydate_year': '2008',\n+            'mydate_month': '4',\n+            'mydate_day': '22',\n+            'initial-mydate': HiddenInput()._format_value(datetime.date(2008, 4, 1))\n+        }, initial={'mydate': datetime.date(2008, 4, 1)})\n+        self.assertTrue(b.has_changed())\n+\n+        b = GetDateShowHiddenInitial({\n+            'mydate_year': '2008',\n+            'mydate_month': '4',\n+            'mydate_day': '22',\n+            'initial-mydate': HiddenInput()._format_value(datetime.date(2008, 4, 1))\n+        }, initial={'mydate': datetime.date(2008, 4, 22)})\n+        self.assertTrue(b.has_changed())\n+\n+        b = GetDateShowHiddenInitial({\n+            'mydate_year': '2008',\n+            'mydate_month': '4',\n+            'mydate_day': '22',\n+            'initial-mydate': HiddenInput()._format_value(datetime.date(2008, 4, 22))\n+        }, initial={'mydate': datetime.date(2008, 4, 1)})\n+        self.assertFalse(b.has_changed())\n+\n     def test_l10n_invalid_date_in(self):\n         # Invalid dates shouldn't be allowed\n         a = GetDate({'mydate_month':'2', 'mydate_day':'31', 'mydate_year':'2010'})"
        }
    ],
    "stats": {
        "total": 62,
        "additions": 62,
        "deletions": 0
    }
}