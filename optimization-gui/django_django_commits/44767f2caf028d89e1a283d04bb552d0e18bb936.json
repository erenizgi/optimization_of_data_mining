{
    "author": "etianen",
    "message": "Use unicode.translate to speed up js escaping.",
    "sha": "44767f2caf028d89e1a283d04bb552d0e18bb936",
    "files": [
        {
            "sha": "cc8372906bc81fc27c04fbbed3a8d25443acf794",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 15,
            "deletions": 18,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/44767f2caf028d89e1a283d04bb552d0e18bb936/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/44767f2caf028d89e1a283d04bb552d0e18bb936/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=44767f2caf028d89e1a283d04bb552d0e18bb936",
            "patch": "@@ -42,29 +42,26 @@ def escape(text):\n     return mark_safe(force_text(text).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('\"', '&quot;').replace(\"'\", '&#39;'))\n escape = allow_lazy(escape, six.text_type)\n \n-_base_js_escapes = (\n-    ('\\\\', '\\\\u005C'),\n-    ('\\'', '\\\\u0027'),\n-    ('\"', '\\\\u0022'),\n-    ('>', '\\\\u003E'),\n-    ('<', '\\\\u003C'),\n-    ('&', '\\\\u0026'),\n-    ('=', '\\\\u003D'),\n-    ('-', '\\\\u002D'),\n-    (';', '\\\\u003B'),\n-    ('\\u2028', '\\\\u2028'),\n-    ('\\u2029', '\\\\u2029')\n-)\n+_js_escapes = {\n+    ord('\\\\'): '\\\\u005C',\n+    ord('\\''): '\\\\u0027',\n+    ord('\"'): '\\\\u0022',\n+    ord('>'): '\\\\u003E',\n+    ord('<'): '\\\\u003C',\n+    ord('&'): '\\\\u0026',\n+    ord('='): '\\\\u003D',\n+    ord('-'): '\\\\u002D',\n+    ord(';'): '\\\\u003B',\n+    ord('\\u2028'): '\\\\u2028',\n+    ord('\\u2029'): '\\\\u2029'\n+}\n \n # Escape every ASCII character with a value less than 32.\n-_js_escapes = (_base_js_escapes +\n-               tuple([('%c' % z, '\\\\u%04X' % z) for z in range(32)]))\n+_js_escapes.update((ord('%c' % z), '\\\\u%04X' % z) for z in range(32))\n \n def escapejs(value):\n     \"\"\"Hex encodes characters for use in JavaScript strings.\"\"\"\n-    for bad, good in _js_escapes:\n-        value = mark_safe(force_text(value).replace(bad, good))\n-    return value\n+    return mark_safe(force_text(value).translate(_js_escapes))\n escapejs = allow_lazy(escapejs, six.text_type)\n \n def conditional_escape(text):"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 15,
        "deletions": 18
    }
}