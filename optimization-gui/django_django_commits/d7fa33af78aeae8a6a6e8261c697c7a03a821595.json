{
    "author": "freakboy3742",
    "message": "Fixed #14928 -- Ensure that a fully qualified domain name can be used for runserver. Thanks to Karmel Allison for the report, ≈Åukasz Rekucki for the patch, and claudep for the tests.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15215 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d7fa33af78aeae8a6a6e8261c697c7a03a821595",
    "files": [
        {
            "sha": "55c7869fea68ae1d0a532a91fd4d21ddc42cd7b2",
            "filename": "django/core/management/commands/runserver.py",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/d7fa33af78aeae8a6a6e8261c697c7a03a821595/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py",
            "raw_url": "https://github.com/django/django/raw/d7fa33af78aeae8a6a6e8261c697c7a03a821595/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py?ref=d7fa33af78aeae8a6a6e8261c697c7a03a821595",
            "patch": "@@ -9,7 +9,12 @@\n from django.core.servers.basehttp import AdminMediaHandler, run, WSGIServerException\n from django.utils import autoreload\n \n-naiveip_re = r'^(?:(?P<addr>\\d{1,3}(?:\\.\\d{1,3}){3}|\\[[a-fA-F0-9:]+\\]):)?(?P<port>\\d+)$'\n+naiveip_re = re.compile(r\"\"\"^(?:\n+(?P<addr>\n+    (?P<ipv4>\\d{1,3}(?:\\.\\d{1,3}){3}) |         # IPv4 address\n+    (?P<ipv6>\\[[a-fA-F0-9:]+\\]) |               # IPv6 address\n+    (?P<fqdn>[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*) # FQDN\n+):)?(?P<port>\\d+)$\"\"\", re.X)\n DEFAULT_PORT = \"8000\"\n \n class BaseRunserverCommand(BaseCommand):\n@@ -33,28 +38,29 @@ def get_handler(self, *args, **options):\n \n     def handle(self, addrport='', *args, **options):\n         self.use_ipv6 = options.get('use_ipv6')\n-        if self.use_ipv6 and not hasattr(socket, 'AF_INET6'):\n+        if self.use_ipv6 and not socket.has_ipv6:\n             raise CommandError('Your Python does not support IPv6.')\n         if args:\n             raise CommandError('Usage is runserver %s' % self.args)\n+        self._raw_ipv6 = False\n         if not addrport:\n             self.addr = ''\n             self.port = DEFAULT_PORT\n         else:\n             m = re.match(naiveip_re, addrport)\n             if m is None:\n-                raise CommandError('%r is not a valid port number'\n+                raise CommandError('\"%s\" is not a valid port number '\n                                    'or address:port pair.' % addrport)\n-            self.addr, self.port = m.groups()\n+            self.addr, _ipv4, _ipv6, _fqdn, self.port = m.groups()\n             if not self.port.isdigit():\n                 raise CommandError(\"%r is not a valid port number.\" % self.port)\n             if self.addr:\n-                if self.addr.startswith('[') and self.addr.endswith(']'):\n+                if _ipv6:\n                     self.addr = self.addr[1:-1]\n                     self.use_ipv6 = True\n-                elif self.use_ipv6:\n-                    raise CommandError('IPv6 addresses must be surrounded '\n-                                       'with brackets, e.g. [::1].')\n+                    self._raw_ipv6 = True\n+                elif self.use_ipv6 and not _fqdn:\n+                    raise CommandError('\"%s\" is not a valid IPv6 address.' % self.addr)\n         if not self.addr:\n             self.addr = self.use_ipv6 and '::1' or '127.0.0.1'\n         self.run(*args, **options)\n@@ -86,7 +92,7 @@ def inner_run(self, *args, **options):\n         ) % {\n             \"version\": self.get_version(),\n             \"settings\": settings.SETTINGS_MODULE,\n-            \"addr\": self.use_ipv6 and '[%s]' % self.addr or self.addr,\n+            \"addr\": self._raw_ipv6 and '[%s]' % self.addr or self.addr,\n             \"port\": self.port,\n             \"quit_command\": quit_command,\n         })"
        },
        {
            "sha": "1150acb0cd6ed7a65dacf792239e95d9f4d45283",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/d7fa33af78aeae8a6a6e8261c697c7a03a821595/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/d7fa33af78aeae8a6a6e8261c697c7a03a821595/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=d7fa33af78aeae8a6a6e8261c697c7a03a821595",
            "patch": "@@ -616,7 +616,7 @@ Example usage::\n \n Run a FastCGI server as a daemon and write the spawned PID in a file.\n \n-runserver [port or ipaddr:port]\n+runserver [port or address:port]\n -------------------------------\n \n .. django-admin:: runserver\n@@ -653,8 +653,10 @@ machines on the network, use its own IP address (e.g. ``192.168.2.1``) or\n \n .. versionchanged:: 1.3\n \n-You can also provide an IPv6 address surrounded by brackets\n-(eg. ``[200a::1]:8000``). This will automaticaly enable IPv6 support.\n+You can provide an IPv6 address surrounded by brackets\n+(e.g. ``[200a::1]:8000``). This will automatically enable IPv6 support.\n+\n+A hostname containing ASCII-only characters can also be used.\n \n .. django-admin-option:: --adminmedia\n \n@@ -721,6 +723,14 @@ Port 7000 on IPv6 address ``2001:0db8:1234:5678::9``::\n \n     django-admin.py runserver [2001:0db8:1234:5678::9]:7000\n \n+Port 8000 on IPv4 address of host ``localhost``::\n+\n+    django-admin.py runserver localhost:8000\n+\n+Port 8000 on IPv6 address of host ``localhost``::\n+\n+    django-admin.py runserver -6 localhost:8000\n+\n Serving static files with the development server\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "ae37eb3a952400a82b6d40f5fa2cfc3db49755f7",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/django/django/blob/d7fa33af78aeae8a6a6e8261c697c7a03a821595/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d7fa33af78aeae8a6a6e8261c697c7a03a821595/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=d7fa33af78aeae8a6a6e8261c697c7a03a821595",
            "patch": "@@ -999,6 +999,61 @@ def test_app_with_import(self):\n         self.assertNoOutput(err)\n         self.assertOutput(out, '0 errors found')\n \n+class ManageRunserver(AdminScriptTestCase):\n+    def setUp(self):\n+        from django.core.management.commands.runserver import BaseRunserverCommand\n+        def monkey_run(*args, **options): return\n+\n+        self.cmd = BaseRunserverCommand()\n+        self.cmd.run = monkey_run\n+\n+    def assertServerSettings(self, addr, port, ipv6=None, raw_ipv6=False):\n+        self.assertEqual(self.cmd.addr, addr)\n+        self.assertEqual(self.cmd.port, port)\n+        self.assertEqual(self.cmd.use_ipv6, ipv6)\n+        self.assertEqual(self.cmd._raw_ipv6, raw_ipv6)\n+\n+    def test_runserver_addrport(self):\n+        self.cmd.handle()\n+        self.assertServerSettings('127.0.0.1', '8000')\n+\n+        self.cmd.handle(addrport=\"1.2.3.4:8000\")\n+        self.assertServerSettings('1.2.3.4', '8000')\n+\n+        self.cmd.handle(addrport=\"7000\")\n+        self.assertServerSettings('127.0.0.1', '7000')\n+\n+        # IPv6\n+        self.cmd.handle(addrport=\"\", use_ipv6=True)\n+        self.assertServerSettings('::1', '8000', ipv6=True)\n+\n+        self.cmd.handle(addrport=\"7000\", use_ipv6=True)\n+        self.assertServerSettings('::1', '7000', ipv6=True)\n+\n+        self.cmd.handle(addrport=\"[2001:0db8:1234:5678::9]:7000\")\n+        self.assertServerSettings('2001:0db8:1234:5678::9', '7000', ipv6=True, raw_ipv6=True)\n+\n+        # Hostname\n+        self.cmd.handle(addrport=\"localhost:8000\")\n+        self.assertServerSettings('localhost', '8000')\n+\n+        self.cmd.handle(addrport=\"test.domain.local:7000\")\n+        self.assertServerSettings('test.domain.local', '7000')\n+\n+        self.cmd.handle(addrport=\"test.domain.local:7000\", use_ipv6=True)\n+        self.assertServerSettings('test.domain.local', '7000', ipv6=True)\n+\n+        # Potentially ambiguous\n+\n+        # Only 4 characters, all of which coudl be in an ipv6 address\n+        self.cmd.handle(addrport=\"beef:7654\")\n+        self.assertServerSettings('beef', '7654')\n+\n+        # Uses only characters that could be in an ipv6 address\n+        self.cmd.handle(addrport=\"deadbeef:7654\")\n+        self.assertServerSettings('deadbeef', '7654')\n+\n+\n ##########################################################################\n # COMMAND PROCESSING TESTS\n # Check that user-space commands are correctly handled - in particular,"
        }
    ],
    "stats": {
        "total": 95,
        "additions": 83,
        "deletions": 12
    }
}