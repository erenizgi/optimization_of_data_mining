{
    "author": "akaariai",
    "message": "Made table_names() output sorted.\n\nFixed #18218 -- previously Django's introspection table_names() and\nget_table_list() methods did not sort the output consistently. This\nresulted in random order of inspected models.\n\nThis commit also removed all external usages of get_table_list().\ntable_names() should be used instead.\n\nThanks to claudep for patch and report.",
    "sha": "527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
    "files": [
        {
            "sha": "10fd9bd463812e736616d7519b428bed6796ed7b",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
            "patch": "@@ -42,7 +42,7 @@ def handle_inspection(self, options):\n         yield 'from %s import models' % self.db_module\n         yield ''\n         known_models = []\n-        for table_name in connection.introspection.get_table_list(cursor):\n+        for table_name in connection.introspection.table_names(cursor):\n             yield 'class %s(models.Model):' % table2model(table_name)\n             known_models.append(table2model(table_name))\n             try:"
        },
        {
            "sha": "68c72b3487ff8747b9024610f351590064e6e6d1",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
            "patch": "@@ -63,7 +63,7 @@ def sql_delete(app, style, connection):\n \n     # Figure out which tables already exist\n     if cursor:\n-        table_names = connection.introspection.get_table_list(cursor)\n+        table_names = connection.introspection.table_names(cursor)\n     else:\n         table_names = []\n "
        },
        {
            "sha": "a85e7b984c6cf3af612c65e145c9606afc05b11c",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 17,
            "deletions": 4,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
            "patch": "@@ -898,10 +898,23 @@ def table_name_converter(self, name):\n         \"\"\"\n         return name\n \n-    def table_names(self):\n-        \"Returns a list of names of all tables that exist in the database.\"\n-        cursor = self.connection.cursor()\n-        return self.get_table_list(cursor)\n+    def table_names(self, cursor=None):\n+        \"\"\"\n+        Returns a list of names of all tables that exist in the database.\n+        The returned table list is sorted by Python's default sorting. We\n+        do NOT use database's ORDER BY here to avoid subtle differences\n+        in sorting order between databases.\n+        \"\"\"\n+        if cursor is None:\n+            cursor = self.connection.cursor()\n+        return sorted(self.get_table_list(cursor))\n+\n+    def get_table_list(self, cursor):\n+        \"\"\"\n+        Returns an unsorted list of names of all tables that exist in the\n+        database.\n+        \"\"\"\n+        raise NotImplementedError\n \n     def django_table_names(self, only_existing=False):\n         \"\"\""
        },
        {
            "sha": "1be7998c499084ddcb535213cba8ba5d046af543",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
            "patch": "@@ -454,7 +454,7 @@ def check_constraints(self, table_names=None):\n         \"\"\"\n         cursor = self.cursor()\n         if table_names is None:\n-            table_names = self.introspection.get_table_list(cursor)\n+            table_names = self.introspection.table_names(cursor)\n         for table_name in table_names:\n             primary_key_column_name = self.introspection.get_primary_key_column(cursor, table_name)\n             if not primary_key_column_name:"
        },
        {
            "sha": "8f883e2dc3a565671d1eed91c2b0d273b8090461",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
            "patch": "@@ -295,7 +295,7 @@ def check_constraints(self, table_names=None):\n         \"\"\"\n         cursor = self.cursor()\n         if table_names is None:\n-            table_names = self.introspection.get_table_list(cursor)\n+            table_names = self.introspection.table_names(cursor)\n         for table_name in table_names:\n             primary_key_column_name = self.introspection.get_primary_key_column(cursor, table_name)\n             if not primary_key_column_name:"
        },
        {
            "sha": "b425b6401df9727efed9000ea855bb31a9199db2",
            "filename": "tests/regressiontests/introspection/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/tests%2Fregressiontests%2Fintrospection%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9/tests%2Fregressiontests%2Fintrospection%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fintrospection%2Ftests.py?ref=527cce80dc03b57f8654f4a5ea64a17a1b3ef7d9",
            "patch": "@@ -40,6 +40,7 @@ class IntrospectionTests(TestCase):\n \n     def test_table_names(self):\n         tl = connection.introspection.table_names()\n+        self.assertEqual(tl, sorted(tl))\n         self.assertTrue(Reporter._meta.db_table in tl,\n                      \"'%s' isn't in table_list().\" % Reporter._meta.db_table)\n         self.assertTrue(Article._meta.db_table in tl,"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 22,
        "deletions": 8
    }
}