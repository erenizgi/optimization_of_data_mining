{
    "author": "aaugustin",
    "message": "Simplified time zone support in the Oracle backend. Avoided outputtypehandler which doesn't exist in cx_Oracle < 4.4.1.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17171 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2693aa890ea6c8273dcdaeab6101203f37ffb1f3",
    "files": [
        {
            "sha": "105730c69c109f703ad7532f1da2d2775e8b875e",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 18,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/2693aa890ea6c8273dcdaeab6101203f37ffb1f3/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/2693aa890ea6c8273dcdaeab6101203f37ffb1f3/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=2693aa890ea6c8273dcdaeab6101203f37ffb1f3",
            "patch": "@@ -485,24 +485,6 @@ def _cursor(self):\n                            \" NLS_TERRITORY = 'AMERICA'\"\n                            + (\" TIME_ZONE = 'UTC'\" if settings.USE_TZ else ''))\n \n-            def datetime_converter(dt):\n-                # Confirm that dt is naive before overwriting its tzinfo.\n-                if dt is not None and is_naive(dt):\n-                    dt = dt.replace(tzinfo=utc)\n-                return dt\n-\n-            def output_type_handler(cursor, name, default_type,\n-                                    size, precision, scale):\n-                # datetimes are returned as TIMESTAMP, except the results\n-                # of \"dates\" queries, which are returned as DATETIME.\n-                if settings.USE_TZ and default_type in (Database.TIMESTAMP,\n-                                                        Database.DATETIME):\n-                    return cursor.var(default_type,\n-                                      arraysize=cursor.arraysize,\n-                                      outconverter=datetime_converter)\n-\n-            self.connection.outputtypehandler = output_type_handler\n-\n             if 'operators' not in self.__dict__:\n                 # Ticket #14149: Check whether our LIKE implementation will\n                 # work for this connection or we need to fall back on LIKEC.\n@@ -794,6 +776,12 @@ def _rowfactory(row, cursor):\n                 value = decimal.Decimal(value)\n             else:\n                 value = int(value)\n+        # datetimes are returned as TIMESTAMP, except the results\n+        # of \"dates\" queries, which are returned as DATETIME.\n+        elif desc[1] in (Database.TIMESTAMP, Database.DATETIME):\n+            # Confirm that dt is naive before overwriting its tzinfo.\n+            if settings.USE_TZ and value is not None and is_naive(value):\n+                value = value.replace(tzinfo=utc)\n         elif desc[1] in (Database.STRING, Database.FIXED_CHAR,\n                          Database.LONG_STRING):\n             value = to_unicode(value)"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 6,
        "deletions": 18
    }
}