{
    "author": "freakboy3742",
    "message": "Fixed #12893 -- Added tests to validate that the right queryset is always used in model admins. Thanks to mk and Julien Phalip for their work on the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15578 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "de161fbf21a77509d93804a66b28d2f28731e7e4",
    "files": [
        {
            "sha": "1f3cb5955ae91ba151427caa18cb5fe70ea66095",
            "filename": "tests/regressiontests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/de161fbf21a77509d93804a66b28d2f28731e7e4/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/de161fbf21a77509d93804a66b28d2f28731e7e4/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py?ref=de161fbf21a77509d93804a66b28d2f28731e7e4",
            "patch": "@@ -223,12 +223,50 @@ def test_distinct_for_m2m_to_inherited_in_list_filter(self):\n         # There's only one ChordsBand instance\n         self.assertEqual(cl.result_count, 1)\n \n+    def test_pagination(self):\n+        \"\"\"\n+        Regression tests for #12893: Pagination in admins changelist doesn't\n+        use queryset set by modeladmin.\n+        \"\"\"\n+        parent = Parent.objects.create(name='anything')\n+        for i in range(30):\n+            Child.objects.create(name='name %s' % i, parent=parent)\n+            Child.objects.create(name='filtered %s' % i, parent=parent)\n+\n+        request = MockRequest()\n+\n+        # Test default queryset\n+        m = ChildAdmin(Child, admin.site)\n+        cl = ChangeList(request, Child, m.list_display, m.list_display_links,\n+                m.list_filter, m.date_hierarchy, m.search_fields,\n+                m.list_select_related, m.list_per_page, m.list_editable, m)\n+        self.assertEqual(cl.query_set.count(), 60)\n+        self.assertEqual(cl.paginator.count, 60)\n+        self.assertEqual(cl.paginator.page_range, [1, 2, 3, 4, 5, 6])\n+\n+        # Test custom queryset\n+        m = FilteredChildAdmin(Child, admin.site)\n+        cl = ChangeList(request, Child, m.list_display, m.list_display_links,\n+                m.list_filter, m.date_hierarchy, m.search_fields,\n+                m.list_select_related, m.list_per_page, m.list_editable, m)\n+        self.assertEqual(cl.query_set.count(), 30)\n+        self.assertEqual(cl.paginator.count, 30)\n+        self.assertEqual(cl.paginator.page_range, [1, 2, 3])\n+\n \n class ChildAdmin(admin.ModelAdmin):\n     list_display = ['name', 'parent']\n+    list_per_page = 10\n     def queryset(self, request):\n         return super(ChildAdmin, self).queryset(request).select_related(\"parent__name\")\n \n+class FilteredChildAdmin(admin.ModelAdmin):\n+    list_display = ['name', 'parent']\n+    list_per_page = 10\n+    def queryset(self, request):\n+        return super(FilteredChildAdmin, self).queryset(request).filter(\n+            name__contains='filtered')\n+\n class MockRequest(object):\n     GET = {}\n "
        }
    ],
    "stats": {
        "total": 38,
        "additions": 38,
        "deletions": 0
    }
}