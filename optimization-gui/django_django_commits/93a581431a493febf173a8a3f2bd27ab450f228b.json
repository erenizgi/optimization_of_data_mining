{
    "author": "jphalip",
    "message": "Fixed #15221 -- Made the admin filters on foreign key and m2m relationships display the related field's verbose name instead of that of the related model.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16991 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "93a581431a493febf173a8a3f2bd27ab450f228b",
    "files": [
        {
            "sha": "ed98a9ebb5618d75acc69c2167d81c47628c0cd8",
            "filename": "django/contrib/admin/filters.py",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/93a581431a493febf173a8a3f2bd27ab450f228b/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "raw_url": "https://github.com/django/django/raw/93a581431a493febf173a8a3f2bd27ab450f228b/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ffilters.py?ref=93a581431a493febf173a8a3f2bd27ab450f228b",
            "patch": "@@ -146,14 +146,11 @@ class RelatedFieldListFilter(FieldListFilter):\n     def __init__(self, field, request, params, model, model_admin, field_path):\n         super(RelatedFieldListFilter, self).__init__(\n             field, request, params, model, model_admin, field_path)\n-\n         other_model = get_model_from_relation(field)\n-        if isinstance(field, (models.ManyToManyField,\n-                          models.related.RelatedObject)):\n-            # no direct field on this model, get name from other model\n-            self.lookup_title = other_model._meta.verbose_name\n+        if hasattr(field, 'verbose_name'):\n+            self.lookup_title = field.verbose_name\n         else:\n-            self.lookup_title = field.verbose_name # use field name\n+            self.lookup_title = other_model._meta.verbose_name\n         rel_name = other_model._meta.pk.name\n         self.lookup_kwarg = '%s__%s__exact' % (self.field_path, rel_name)\n         self.lookup_kwarg_isnull = '%s__isnull' % (self.field_path)"
        },
        {
            "sha": "2fa6e6631dc06074b8dd13b6cd4372641d181b07",
            "filename": "tests/regressiontests/admin_filters/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/93a581431a493febf173a8a3f2bd27ab450f228b/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/93a581431a493febf173a8a3f2bd27ab450f228b/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py?ref=93a581431a493febf173a8a3f2bd27ab450f228b",
            "patch": "@@ -5,8 +5,8 @@\n class Book(models.Model):\n     title = models.CharField(max_length=50)\n     year = models.PositiveIntegerField(null=True, blank=True)\n-    author = models.ForeignKey(User, related_name='books_authored', blank=True, null=True)\n-    contributors = models.ManyToManyField(User, related_name='books_contributed', blank=True, null=True)\n+    author = models.ForeignKey(User, verbose_name=\"Verbose Author\", related_name='books_authored', blank=True, null=True)\n+    contributors = models.ManyToManyField(User, verbose_name=\"Verbose Contributors\", related_name='books_contributed', blank=True, null=True)\n     is_best_seller = models.NullBooleanField(default=0)\n     date_registered = models.DateField(null=True)\n     no = models.IntegerField(verbose_name=u'number', blank=True, null=True) # This field is intentionally 2 characters long. See #16080."
        },
        {
            "sha": "28693aef98937d5459c6817becc76e6ed1f20c69",
            "filename": "tests/regressiontests/admin_filters/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/93a581431a493febf173a8a3f2bd27ab450f228b/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/93a581431a493febf173a8a3f2bd27ab450f228b/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py?ref=93a581431a493febf173a8a3f2bd27ab450f228b",
            "patch": "@@ -244,7 +244,7 @@ def test_relatedfieldlistfilter_foreignkey(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), u'author')\n+        self.assertEquals(force_unicode(filterspec.title), u'Verbose Author')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?author__isnull=True')\n@@ -254,7 +254,7 @@ def test_relatedfieldlistfilter_foreignkey(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), u'author')\n+        self.assertEquals(force_unicode(filterspec.title), u'Verbose Author')\n         # order of choices depends on User model, which has no order\n         choice = select_by(filterspec.choices(changelist), \"display\", \"alfred\")\n         self.assertEqual(choice['selected'], True)\n@@ -272,7 +272,7 @@ def test_relatedfieldlistfilter_manytomany(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][2]\n-        self.assertEqual(force_unicode(filterspec.title), u'user')\n+        self.assertEquals(force_unicode(filterspec.title), u'Verbose Contributors')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?contributors__isnull=True')\n@@ -282,7 +282,7 @@ def test_relatedfieldlistfilter_manytomany(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][2]\n-        self.assertEqual(force_unicode(filterspec.title), u'user')\n+        self.assertEquals(force_unicode(filterspec.title), u'Verbose Contributors')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"bob\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?contributors__id__exact=%d' % self.bob.pk)\n@@ -483,7 +483,7 @@ def test_simplelistfilter(self):\n         self.assertEqual(choices[3]['query_string'], '?publication-decade=the+00s&author__id__exact=%s' % self.alfred.pk)\n \n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), u'author')\n+        self.assertEquals(force_unicode(filterspec.title), u'Verbose Author')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"alfred\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?publication-decade=the+00s&author__id__exact=%s' % self.alfred.pk)"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 10,
        "deletions": 13
    }
}