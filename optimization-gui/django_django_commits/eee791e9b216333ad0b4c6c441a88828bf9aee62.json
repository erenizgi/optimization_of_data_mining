{
    "author": "bohyn",
    "message": "Merge branch 'master' of https://github.com/django/django",
    "sha": "eee791e9b216333ad0b4c6c441a88828bf9aee62",
    "files": [
        {
            "sha": "45a0544e6573b69e86229a4d0edf46032ee28f4b",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -93,7 +93,7 @@ answer newbie questions, and generally made Django that much better:\n     Simon Blanchard\n     David Blewett <david@dawninglight.net>\n     Matt Boersma <matt@sprout.org>\n-    boobsd@gmail.com\n+    Artem Gnilov <boobsd@gmail.com>\n     Mat√≠as Bordese\n     Nate Bragg <jonathan.bragg@alum.rpi.edu>\n     Sean Brant\n@@ -211,7 +211,6 @@ answer newbie questions, and generally made Django that much better:\n     Dimitris Glezos <dimitris@glezos.com>\n     glin@seznam.cz\n     martin.glueck@gmail.com\n-    Artyom Gnilov <boobsd@gmail.com>\n     Ben Godfrey <http://aftnn.org>\n     GomoX <gomo@datafull.com>\n     Guilherme Mesquita Gondim <semente@taurinus.org>\n@@ -347,6 +346,7 @@ answer newbie questions, and generally made Django that much better:\n     Frantisek Malina <vizualbod@vizualbod.com>\n     Mike Malone <mjmalone@gmail.com>\n     Martin Maney <http://www.chipy.org/Martin_Maney>\n+    Michael Manfre <mmanfre@gmail.com>\n     masonsimon+django@gmail.com\n     Manuzhai\n     Petr Marhoun <petr.marhoun@gmail.com>\n@@ -401,6 +401,7 @@ answer newbie questions, and generally made Django that much better:\n     Christian Oudard <christian.oudard@gmail.com>\n     oggie rob <oz.robharvey@gmail.com>\n     oggy <ognjen.maric@gmail.com>\n+    Jens Page\n     Jay Parlar <parlar@gmail.com>\n     Carlos Eduardo de Paula <carlosedp@gmail.com>\n     John Paulett <john@paulett.org>"
        },
        {
            "sha": "8494970aa18bbae656d0cb53d3532e8c3a906252",
            "filename": "django/contrib/admin/static/admin/js/actions.js",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Factions.js",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Factions.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Factions.js?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -3,15 +3,15 @@\n \t\tvar options = $.extend({}, $.fn.actions.defaults, opts);\n \t\tvar actionCheckboxes = $(this);\n \t\tvar list_editable_changed = false;\n-\t\tchecker = function(checked) {\n+\t\tvar checker = function(checked) {\n \t\t\tif (checked) {\n \t\t\t\tshowQuestion();\n \t\t\t} else {\n \t\t\t\treset();\n \t\t\t}\n \t\t\t$(actionCheckboxes).attr(\"checked\", checked)\n \t\t\t\t.parent().parent().toggleClass(options.selectedClass, checked);\n-\t\t}\n+\t\t},\n \t\tupdateCounter = function() {\n \t\t\tvar sel = $(actionCheckboxes).filter(\":checked\").length;\n \t\t\t$(options.counterContainer).html(interpolate(\n@@ -29,30 +29,30 @@\n \t\t\t\t}\n \t\t\t\treturn value;\n \t\t\t});\n-\t\t}\n+\t\t},\n \t\tshowQuestion = function() {\n \t\t\t$(options.acrossClears).hide();\n \t\t\t$(options.acrossQuestions).show();\n \t\t\t$(options.allContainer).hide();\n-\t\t}\n+\t\t},\n \t\tshowClear = function() {\n \t\t\t$(options.acrossClears).show();\n \t\t\t$(options.acrossQuestions).hide();\n \t\t\t$(options.actionContainer).toggleClass(options.selectedClass);\n \t\t\t$(options.allContainer).show();\n \t\t\t$(options.counterContainer).hide();\n-\t\t}\n+\t\t},\n \t\treset = function() {\n \t\t\t$(options.acrossClears).hide();\n \t\t\t$(options.acrossQuestions).hide();\n \t\t\t$(options.allContainer).hide();\n \t\t\t$(options.counterContainer).show();\n-\t\t}\n+\t\t},\n \t\tclearAcross = function() {\n \t\t\treset();\n \t\t\t$(options.acrossInput).val(0);\n \t\t\t$(options.actionContainer).removeClass(options.selectedClass);\n-\t\t}\n+\t\t};\n \t\t// Show counter by default\n \t\t$(options.counterContainer).show();\n \t\t// Check state of checkboxes and reinit state if needed\n@@ -81,9 +81,9 @@\n \t\t});\n \t\tlastChecked = null;\n \t\t$(actionCheckboxes).click(function(event) {\n-\t\t\tif (!event) { var event = window.event; }\n+\t\t\tif (!event) { event = window.event; }\n \t\t\tvar target = event.target ? event.target : event.srcElement;\n-\t\t\tif (lastChecked && $.data(lastChecked) != $.data(target) && event.shiftKey == true) {\n+\t\t\tif (lastChecked && $.data(lastChecked) != $.data(target) && event.shiftKey === true) {\n \t\t\t\tvar inrange = false;\n \t\t\t\t$(lastChecked).attr(\"checked\", target.checked)\n \t\t\t\t\t.parent().parent().toggleClass(options.selectedClass, target.checked);\n@@ -124,7 +124,7 @@\n \t\t\t\t}\n \t\t\t}\n \t\t});\n-\t}\n+\t};\n \t/* Setup plugin defaults */\n \t$.fn.actions.defaults = {\n \t\tactionContainer: \"div.actions\",\n@@ -135,5 +135,5 @@\n \t\tacrossClears: \"div.actions span.clear\",\n \t\tallToggle: \"#action-toggle\",\n \t\tselectedClass: \"selected\"\n-\t}\n+\t};\n })(django.jQuery);"
        },
        {
            "sha": "2c6300094fdf5c2b6d2f70b945ec1eb0aa6b996f",
            "filename": "django/contrib/admin/static/admin/js/actions.min.js",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Factions.min.js",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Factions.min.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Factions.min.js?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,7 +1,6 @@\n-(function(a){a.fn.actions=function(g){var b=a.extend({},a.fn.actions.defaults,g),f=a(this),e=!1;checker=function(c){c?showQuestion():reset();a(f).attr(\"checked\",c).parent().parent().toggleClass(b.selectedClass,c)};updateCounter=function(){var c=a(f).filter(\":checked\").length;a(b.counterContainer).html(interpolate(ngettext(\"%(sel)s of %(cnt)s selected\",\"%(sel)s of %(cnt)s selected\",c),{sel:c,cnt:_actions_icnt},!0));a(b.allToggle).attr(\"checked\",function(){c==f.length?(value=!0,showQuestion()):(value=\n-!1,clearAcross());return value})};showQuestion=function(){a(b.acrossClears).hide();a(b.acrossQuestions).show();a(b.allContainer).hide()};showClear=function(){a(b.acrossClears).show();a(b.acrossQuestions).hide();a(b.actionContainer).toggleClass(b.selectedClass);a(b.allContainer).show();a(b.counterContainer).hide()};reset=function(){a(b.acrossClears).hide();a(b.acrossQuestions).hide();a(b.allContainer).hide();a(b.counterContainer).show()};clearAcross=function(){reset();a(b.acrossInput).val(0);a(b.actionContainer).removeClass(b.selectedClass)};\n-a(b.counterContainer).show();a(this).filter(\":checked\").each(function(){a(this).parent().parent().toggleClass(b.selectedClass);updateCounter();1==a(b.acrossInput).val()&&showClear()});a(b.allToggle).show().click(function(){checker(a(this).attr(\"checked\"));updateCounter()});a(\"div.actions span.question a\").click(function(c){c.preventDefault();a(b.acrossInput).val(1);showClear()});a(\"div.actions span.clear a\").click(function(c){c.preventDefault();a(b.allToggle).attr(\"checked\",!1);clearAcross();checker(0);\n-updateCounter()});lastChecked=null;a(f).click(function(c){if(!c)c=window.event;var d=c.target?c.target:c.srcElement;if(lastChecked&&a.data(lastChecked)!=a.data(d)&&!0==c.shiftKey){var e=!1;a(lastChecked).attr(\"checked\",d.checked).parent().parent().toggleClass(b.selectedClass,d.checked);a(f).each(function(){if(a.data(this)==a.data(lastChecked)||a.data(this)==a.data(d))e=e?!1:!0;e&&a(this).attr(\"checked\",d.checked).parent().parent().toggleClass(b.selectedClass,d.checked)})}a(d).parent().parent().toggleClass(b.selectedClass,\n-d.checked);lastChecked=d;updateCounter()});a(\"form#changelist-form table#result_list tr\").find(\"td:gt(0) :input\").change(function(){e=!0});a('form#changelist-form button[name=\"index\"]').click(function(){if(e)return confirm(gettext(\"You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost.\"))});a('form#changelist-form input[name=\"_save\"]').click(function(){var b=!1;a(\"div.actions select option:selected\").each(function(){a(this).val()&&(b=!0)});\n-if(b)return e?confirm(gettext(\"You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.\")):confirm(gettext(\"You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.\"))})};a.fn.actions.defaults={actionContainer:\"div.actions\",counterContainer:\"span.action-counter\",allContainer:\"div.actions span.all\",acrossInput:\"div.actions input.select-across\",\n-acrossQuestions:\"div.actions span.question\",acrossClears:\"div.actions span.clear\",allToggle:\"#action-toggle\",selectedClass:\"selected\"}})(django.jQuery);\n+(function(a){a.fn.actions=function(m){var b=a.extend({},a.fn.actions.defaults,m),f=a(this),e=!1,j=function(c){c?h():i();a(f).attr(\"checked\",c).parent().parent().toggleClass(b.selectedClass,c)},g=function(){var c=a(f).filter(\":checked\").length;a(b.counterContainer).html(interpolate(ngettext(\"%(sel)s of %(cnt)s selected\",\"%(sel)s of %(cnt)s selected\",c),{sel:c,cnt:_actions_icnt},!0));a(b.allToggle).attr(\"checked\",function(){c==f.length?(value=!0,h()):(value=!1,k());return value})},h=function(){a(b.acrossClears).hide();\n+a(b.acrossQuestions).show();a(b.allContainer).hide()},l=function(){a(b.acrossClears).show();a(b.acrossQuestions).hide();a(b.actionContainer).toggleClass(b.selectedClass);a(b.allContainer).show();a(b.counterContainer).hide()},i=function(){a(b.acrossClears).hide();a(b.acrossQuestions).hide();a(b.allContainer).hide();a(b.counterContainer).show()},k=function(){i();a(b.acrossInput).val(0);a(b.actionContainer).removeClass(b.selectedClass)};a(b.counterContainer).show();a(this).filter(\":checked\").each(function(){a(this).parent().parent().toggleClass(b.selectedClass);\n+g();1==a(b.acrossInput).val()&&l()});a(b.allToggle).show().click(function(){j(a(this).attr(\"checked\"));g()});a(\"div.actions span.question a\").click(function(c){c.preventDefault();a(b.acrossInput).val(1);l()});a(\"div.actions span.clear a\").click(function(c){c.preventDefault();a(b.allToggle).attr(\"checked\",!1);k();j(0);g()});lastChecked=null;a(f).click(function(c){c||(c=window.event);var d=c.target?c.target:c.srcElement;if(lastChecked&&a.data(lastChecked)!=a.data(d)&&!0===c.shiftKey){var e=!1;a(lastChecked).attr(\"checked\",\n+d.checked).parent().parent().toggleClass(b.selectedClass,d.checked);a(f).each(function(){if(a.data(this)==a.data(lastChecked)||a.data(this)==a.data(d))e=e?false:true;e&&a(this).attr(\"checked\",d.checked).parent().parent().toggleClass(b.selectedClass,d.checked)})}a(d).parent().parent().toggleClass(b.selectedClass,d.checked);lastChecked=d;g()});a(\"form#changelist-form table#result_list tr\").find(\"td:gt(0) :input\").change(function(){e=!0});a('form#changelist-form button[name=\"index\"]').click(function(){if(e)return confirm(gettext(\"You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost.\"))});\n+a('form#changelist-form input[name=\"_save\"]').click(function(){var b=!1;a(\"div.actions select option:selected\").each(function(){a(this).val()&&(b=!0)});if(b)return e?confirm(gettext(\"You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.\")):confirm(gettext(\"You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.\"))})};\n+a.fn.actions.defaults={actionContainer:\"div.actions\",counterContainer:\"span.action-counter\",allContainer:\"div.actions span.all\",acrossInput:\"div.actions input.select-across\",acrossQuestions:\"div.actions span.question\",acrossClears:\"div.actions span.clear\",allToggle:\"#action-toggle\",selectedClass:\"selected\"}})(django.jQuery);"
        },
        {
            "sha": "668e1157c81b02b83662610188dffd6bef9976b1",
            "filename": "django/contrib/admin/static/admin/js/inlines.js",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.js",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.js?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -31,11 +31,11 @@\n \t\t\t}\n \t\t};\n \t\tvar totalForms = $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\").attr(\"autocomplete\", \"off\");\n-\t\tvar nextIndex = parseInt(totalForms.val());\n+\t\tvar nextIndex = parseInt(totalForms.val(), 10);\n \t\tvar maxForms = $(\"#id_\" + options.prefix + \"-MAX_NUM_FORMS\").attr(\"autocomplete\", \"off\");\n \t\t// only show the add button if we are allowed to add more items,\n         // note that max_num = None translates to a blank string.\n-\t\tvar showAddButton = maxForms.val() == '' || (maxForms.val()-totalForms.val()) > 0;\n+\t\tvar showAddButton = maxForms.val() === '' || (maxForms.val()-totalForms.val()) > 0;\n \t\t$(this).each(function(i) {\n \t\t\t$(this).not(\".\" + options.emptyCssClass).addClass(options.formCssClass);\n \t\t});\n@@ -52,13 +52,14 @@\n \t\t\t\t$(this).filter(\":last\").after('<div class=\"' + options.addCssClass + '\"><a href=\"javascript:void(0)\">' + options.addText + \"</a></div>\");\n \t\t\t\taddButton = $(this).filter(\":last\").next().find(\"a\");\n \t\t\t}\n-\t\t\taddButton.click(function() {\n+\t\t\taddButton.click(function(e) {\n+\t\t\t\te.preventDefault();\n \t\t\t\tvar totalForms = $(\"#id_\" + options.prefix + \"-TOTAL_FORMS\");\n \t\t\t\tvar template = $(\"#\" + options.prefix + \"-empty\");\n \t\t\t\tvar row = template.clone(true);\n \t\t\t\trow.removeClass(options.emptyCssClass)\n-\t\t\t\t    .addClass(options.formCssClass)\n-\t\t\t\t    .attr(\"id\", options.prefix + \"-\" + nextIndex);\n+\t\t\t\t\t.addClass(options.formCssClass)\n+\t\t\t\t\t.attr(\"id\", options.prefix + \"-\" + nextIndex);\n \t\t\t\tif (row.is(\"tr\")) {\n \t\t\t\t\t// If the forms are laid out in table rows, insert\n \t\t\t\t\t// the remove button into the last table cell:\n@@ -78,14 +79,15 @@\n \t\t\t\t// Insert the new form when it has been fully edited\n \t\t\t\trow.insertBefore($(template));\n \t\t\t\t// Update number of total forms\n-\t\t\t\t$(totalForms).val(parseInt(totalForms.val()) + 1);\n+\t\t\t\t$(totalForms).val(parseInt(totalForms.val(), 10) + 1);\n \t\t\t\tnextIndex += 1;\n \t\t\t\t// Hide add button in case we've hit the max, except we want to add infinitely\n-\t\t\t\tif ((maxForms.val() != '') && (maxForms.val()-totalForms.val()) <= 0) {\n+\t\t\t\tif ((maxForms.val() !== '') && (maxForms.val()-totalForms.val()) <= 0) {\n \t\t\t\t\taddButton.parent().hide();\n \t\t\t\t}\n \t\t\t\t// The delete button of each row triggers a bunch of other things\n-\t\t\t\trow.find(\"a.\" + options.deleteCssClass).click(function() {\n+\t\t\t\trow.find(\"a.\" + options.deleteCssClass).click(function(e) {\n+\t\t\t\t\te.preventDefault();\n \t\t\t\t\t// Remove the parent form containing this button:\n \t\t\t\t\tvar row = $(this).parents(\".\" + options.formCssClass);\n \t\t\t\t\trow.remove();\n@@ -98,7 +100,7 @@\n \t\t\t\t\tvar forms = $(\".\" + options.formCssClass);\n \t\t\t\t\t$(\"#id_\" + options.prefix + \"-TOTAL_FORMS\").val(forms.length);\n \t\t\t\t\t// Show add button again once we drop below max\n-\t\t\t\t\tif ((maxForms.val() == '') || (maxForms.val()-forms.length) > 0) {\n+\t\t\t\t\tif ((maxForms.val() === '') || (maxForms.val()-forms.length) > 0) {\n \t\t\t\t\t\taddButton.parent().show();\n \t\t\t\t\t}\n \t\t\t\t\t// Also, update names and ids for all remaining form controls\n@@ -110,17 +112,15 @@\n \t\t\t\t\t\t\tupdateElementIndex(this, options.prefix, i);\n \t\t\t\t\t\t});\n \t\t\t\t\t}\n-\t\t\t\t\treturn false;\n \t\t\t\t});\n \t\t\t\t// If a post-add callback was supplied, call it with the added form:\n \t\t\t\tif (options.added) {\n \t\t\t\t\toptions.added(row);\n \t\t\t\t}\n-\t\t\t\treturn false;\n \t\t\t});\n \t\t}\n \t\treturn this;\n-\t}\n+\t};\n \t/* Setup plugin defaults */\n \t$.fn.formset.defaults = {\n \t\tprefix: \"form\",\t\t\t\t\t// The form prefix for your django formset\n@@ -132,5 +132,5 @@\n \t\tformCssClass: \"dynamic-form\",\t// CSS class applied to each form in a formset\n \t\tadded: null,\t\t\t\t\t// Function called each time a new form is added\n \t\tremoved: null\t\t\t\t\t// Function called each time a form is deleted\n-\t}\n+\t};\n })(django.jQuery);"
        },
        {
            "sha": "53dd92f2f942f31cad5cabd3365291f7f5381fcc",
            "filename": "django/contrib/admin/static/admin/js/inlines.min.js",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.min.js",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.min.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fjs%2Finlines.min.js?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,5 @@\n-(function(b){b.fn.formset=function(c){var a=b.extend({},b.fn.formset.defaults,c),j=function(a,e,d){var i=RegExp(\"(\"+e+\"-(\\\\d+|__prefix__))\"),e=e+\"-\"+d;b(a).attr(\"for\")&&b(a).attr(\"for\",b(a).attr(\"for\").replace(i,e));if(a.id)a.id=a.id.replace(i,e);if(a.name)a.name=a.name.replace(i,e)},c=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").attr(\"autocomplete\",\"off\"),g=parseInt(c.val()),f=b(\"#id_\"+a.prefix+\"-MAX_NUM_FORMS\").attr(\"autocomplete\",\"off\"),c=\"\"==f.val()||0<f.val()-c.val();b(this).each(function(){b(this).not(\".\"+\n-a.emptyCssClass).addClass(a.formCssClass)});if(b(this).length&&c){var h;\"TR\"==b(this).attr(\"tagName\")?(c=this.eq(0).children().length,b(this).parent().append('<tr class=\"'+a.addCssClass+'\"><td colspan=\"'+c+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></tr>\"),h=b(this).parent().find(\"tr:last a\")):(b(this).filter(\":last\").after('<div class=\"'+a.addCssClass+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></div>\"),h=b(this).filter(\":last\").next().find(\"a\"));h.click(function(){var c=b(\"#id_\"+a.prefix+\n-\"-TOTAL_FORMS\"),e=b(\"#\"+a.prefix+\"-empty\"),d=e.clone(!0);d.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr(\"id\",a.prefix+\"-\"+g);d.is(\"tr\")?d.children(\":last\").append('<div><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></div>\"):d.is(\"ul\")||d.is(\"ol\")?d.append('<li><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></li>\"):d.children(\":first\").append('<span><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\n-\"</a></span>\");d.find(\"*\").each(function(){j(this,a.prefix,c.val())});d.insertBefore(b(e));b(c).val(parseInt(c.val())+1);g+=1;\"\"!=f.val()&&0>=f.val()-c.val()&&h.parent().hide();d.find(\"a.\"+a.deleteCssClass).click(function(){var c=b(this).parents(\".\"+a.formCssClass);c.remove();g-=1;a.removed&&a.removed(c);c=b(\".\"+a.formCssClass);b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").val(c.length);(\"\"==f.val()||0<f.val()-c.length)&&h.parent().show();for(var d=0,e=c.length;d<e;d++)j(b(c).get(d),a.prefix,d),b(c.get(d)).find(\"*\").each(function(){j(this,\n-a.prefix,d)});return!1});a.added&&a.added(d);return!1})}return this};b.fn.formset.defaults={prefix:\"form\",addText:\"add another\",deleteText:\"remove\",addCssClass:\"add-row\",deleteCssClass:\"delete-row\",emptyCssClass:\"empty-row\",formCssClass:\"dynamic-form\",added:null,removed:null}})(django.jQuery);\n+(function(b){b.fn.formset=function(c){var a=b.extend({},b.fn.formset.defaults,c),j=function(a,f,d){var e=RegExp(\"(\"+f+\"-(\\\\d+|__prefix__))\"),f=f+\"-\"+d;b(a).attr(\"for\")&&b(a).attr(\"for\",b(a).attr(\"for\").replace(e,f));a.id&&(a.id=a.id.replace(e,f));a.name&&(a.name=a.name.replace(e,f))},c=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").attr(\"autocomplete\",\"off\"),h=parseInt(c.val(),10),g=b(\"#id_\"+a.prefix+\"-MAX_NUM_FORMS\").attr(\"autocomplete\",\"off\"),c=\"\"===g.val()||0<g.val()-c.val();b(this).each(function(){b(this).not(\".\"+\n+a.emptyCssClass).addClass(a.formCssClass)});if(b(this).length&&c){var i;\"TR\"==b(this).attr(\"tagName\")?(c=this.eq(0).children().length,b(this).parent().append('<tr class=\"'+a.addCssClass+'\"><td colspan=\"'+c+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></tr>\"),i=b(this).parent().find(\"tr:last a\")):(b(this).filter(\":last\").after('<div class=\"'+a.addCssClass+'\"><a href=\"javascript:void(0)\">'+a.addText+\"</a></div>\"),i=b(this).filter(\":last\").next().find(\"a\"));i.click(function(c){c.preventDefault();\n+var f=b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\"),c=b(\"#\"+a.prefix+\"-empty\"),d=c.clone(true);d.removeClass(a.emptyCssClass).addClass(a.formCssClass).attr(\"id\",a.prefix+\"-\"+h);d.is(\"tr\")?d.children(\":last\").append('<div><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></div>\"):d.is(\"ul\")||d.is(\"ol\")?d.append('<li><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+a.deleteText+\"</a></li>\"):d.children(\":first\").append('<span><a class=\"'+a.deleteCssClass+'\" href=\"javascript:void(0)\">'+\n+a.deleteText+\"</a></span>\");d.find(\"*\").each(function(){j(this,a.prefix,f.val())});d.insertBefore(b(c));b(f).val(parseInt(f.val(),10)+1);h=h+1;g.val()!==\"\"&&g.val()-f.val()<=0&&i.parent().hide();d.find(\"a.\"+a.deleteCssClass).click(function(e){e.preventDefault();e=b(this).parents(\".\"+a.formCssClass);e.remove();h=h-1;a.removed&&a.removed(e);e=b(\".\"+a.formCssClass);b(\"#id_\"+a.prefix+\"-TOTAL_FORMS\").val(e.length);(g.val()===\"\"||g.val()-e.length>0)&&i.parent().show();for(var c=0,d=e.length;c<d;c++){j(b(e).get(c),\n+a.prefix,c);b(e.get(c)).find(\"*\").each(function(){j(this,a.prefix,c)})}});a.added&&a.added(d)})}return this};b.fn.formset.defaults={prefix:\"form\",addText:\"add another\",deleteText:\"remove\",addCssClass:\"add-row\",deleteCssClass:\"delete-row\",emptyCssClass:\"empty-row\",formCssClass:\"dynamic-form\",added:null,removed:null}})(django.jQuery);"
        },
        {
            "sha": "91ea0844b1dc2548e023c5dc417f2ceeaa9114ac",
            "filename": "django/contrib/admin/templates/admin/index.html",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Findex.html",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Findex.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Findex.html?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -15,8 +15,12 @@\n {% if app_list %}\n     {% for app in app_list %}\n         <div class=\"module\">\n-        <table summary=\"{% blocktrans with name=app.name %}Models available in the {{ name }} application.{% endblocktrans %}\">\n-        <caption><a href=\"{{ app.app_url }}\" class=\"section\">{% blocktrans with name=app.name %}{{ name }}{% endblocktrans %}</a></caption>\n+        <table>\n+        <caption>\n+            <a href=\"{{ app.app_url }}\" class=\"section\" title=\"{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}\">\n+                {% blocktrans with name=app.name %}{{ name }}{% endblocktrans %}\n+            </a>\n+        </caption>\n         {% for model in app.models %}\n             <tr>\n             {% if model.admin_url %}"
        },
        {
            "sha": "85e03f3b75c5662f81e3f5066c7d37f393363d2b",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,4 +1,5 @@\n import operator\n+from functools import reduce\n \n from django.core.exceptions import SuspiciousOperation, ImproperlyConfigured\n from django.core.paginator import InvalidPage"
        },
        {
            "sha": "f3f1a7b671cbb1abf7579ae858a5323dd31dadd2",
            "filename": "django/contrib/auth/management/commands/createsuperuser.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -80,15 +80,15 @@ def handle(self, *args, **options):\n                     if default_username and username == '':\n                         username = default_username\n                     if not RE_VALID_USERNAME.match(username):\n-                        sys.stderr.write(\"Error: That username is invalid. Use only letters, digits and underscores.\\n\")\n+                        self.stderr.write(\"Error: That username is invalid. Use only letters, digits and underscores.\")\n                         username = None\n                         continue\n                     try:\n                         User.objects.using(database).get(username=username)\n                     except User.DoesNotExist:\n                         break\n                     else:\n-                        sys.stderr.write(\"Error: That username is already taken.\\n\")\n+                        self.stderr.write(\"Error: That username is already taken.\")\n                         username = None\n \n                 # Get an email\n@@ -98,7 +98,7 @@ def handle(self, *args, **options):\n                     try:\n                         is_valid_email(email)\n                     except exceptions.ValidationError:\n-                        sys.stderr.write(\"Error: That e-mail address is invalid.\\n\")\n+                        self.stderr.write(\"Error: That e-mail address is invalid.\")\n                         email = None\n                     else:\n                         break\n@@ -109,19 +109,19 @@ def handle(self, *args, **options):\n                         password = getpass.getpass()\n                         password2 = getpass.getpass('Password (again): ')\n                         if password != password2:\n-                            sys.stderr.write(\"Error: Your passwords didn't match.\\n\")\n+                            self.stderr.write(\"Error: Your passwords didn't match.\")\n                             password = None\n                             continue\n                     if password.strip() == '':\n-                        sys.stderr.write(\"Error: Blank passwords aren't allowed.\\n\")\n+                        self.stderr.write(\"Error: Blank passwords aren't allowed.\")\n                         password = None\n                         continue\n                     break\n             except KeyboardInterrupt:\n-                sys.stderr.write(\"\\nOperation cancelled.\\n\")\n+                self.stderr.write(\"\\nOperation cancelled.\")\n                 sys.exit(1)\n \n         User.objects.db_manager(database).create_superuser(username, email, password)\n         if verbosity >= 1:\n-          self.stdout.write(\"Superuser created successfully.\\n\")\n+          self.stdout.write(\"Superuser created successfully.\")\n "
        },
        {
            "sha": "81ab0aa05299a0af7816b3080b64dfaa62966f73",
            "filename": "django/contrib/auth/tests/management.py",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -2,6 +2,7 @@\n \n from django.contrib.auth import models, management\n from django.contrib.auth.management.commands import changepassword\n+from django.core.management.base import CommandError\n from django.test import TestCase\n \n \n@@ -56,16 +57,10 @@ def test_that_changepassword_command_changes_joes_password(self):\n     def test_that_max_tries_exits_1(self):\n         \"\"\"\n         A CommandError should be thrown by handle() if the user enters in\n-        mismatched passwords three times. This should be caught by execute() and\n-        converted to a SystemExit\n+        mismatched passwords three times.\n         \"\"\"\n         command = changepassword.Command()\n         command._get_pass = lambda *args: args or 'foo'\n \n-        self.assertRaises(\n-            SystemExit,\n-            command.execute,\n-            \"joe\",\n-            stdout=self.stdout,\n-            stderr=self.stderr\n-        )\n+        with self.assertRaises(CommandError):\n+            command.execute(\"joe\", stdout=self.stdout, stderr=self.stderr)"
        },
        {
            "sha": "71aa84de1277990c1191bf2901ae93cf8d042b43",
            "filename": "django/contrib/flatpages/fixtures/example_site.json",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ffixtures%2Fexample_site.json",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ffixtures%2Fexample_site.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ffixtures%2Fexample_site.json?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -0,0 +1,11 @@\n+[\n+  {\n+    \"pk\": 1,\n+    \"model\": \"sites.site\",\n+    \"fields\": {\n+      \"domain\": \"example.com\",\n+      \"name\": \"example.com\"\n+    }\n+  }\n+]\n+"
        },
        {
            "sha": "e64c4bb1025248bfefc08f2798f7496149690180",
            "filename": "django/contrib/flatpages/tests/csrf.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fcsrf.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fcsrf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftests%2Fcsrf.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -18,9 +18,10 @@\n     TEMPLATE_DIRS=(\n         os.path.join(os.path.dirname(__file__), 'templates'),\n     ),\n+    SITE_ID=1,\n )\n class FlatpageCSRFTests(TestCase):\n-    fixtures = ['sample_flatpages']\n+    fixtures = ['sample_flatpages', 'example_site']\n     urls = 'django.contrib.flatpages.tests.urls'\n \n     def setUp(self):"
        },
        {
            "sha": "0e54176aa25d78c114d5b07331fd33672a2ebb4e",
            "filename": "django/contrib/flatpages/tests/forms.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftests%2Fforms.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -5,7 +5,10 @@\n from django.test.utils import override_settings\n from django.utils import translation\n \n+@override_settings(SITE_ID=1)\n class FlatpageAdminFormTests(TestCase):\n+    fixtures = ['example_site']\n+\n     def setUp(self):\n         self.form_data = {\n             'title': \"A test page\",\n@@ -89,5 +92,5 @@ def test_flatpage_nosites(self):\n \n         self.assertEqual(\n             f.errors,\n-            {'sites': [u'This field is required.']})\n+            {'sites': [translation.ugettext(u'This field is required.')]})\n "
        },
        {
            "sha": "4afa4ff982239c06b1f3782f71b81edd2e5bb890",
            "filename": "django/contrib/flatpages/tests/middleware.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fmiddleware.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fmiddleware.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftests%2Fmiddleware.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -19,9 +19,10 @@\n     TEMPLATE_DIRS=(\n         os.path.join(os.path.dirname(__file__), 'templates'),\n     ),\n+    SITE_ID=1,\n )\n class FlatpageMiddlewareTests(TestCase):\n-    fixtures = ['sample_flatpages']\n+    fixtures = ['sample_flatpages', 'example_site']\n     urls = 'django.contrib.flatpages.tests.urls'\n \n     def test_view_flatpage(self):\n@@ -75,7 +76,7 @@ def test_fallback_flatpage_special_chars(self):\n             enable_comments=False,\n             registration_required=False,\n         )\n-        fp.sites.add(1)\n+        fp.sites.add(settings.SITE_ID)\n \n         response = self.client.get('/some.very_special~chars-here/')\n         self.assertEqual(response.status_code, 200)\n@@ -96,9 +97,10 @@ def test_fallback_flatpage_special_chars(self):\n     TEMPLATE_DIRS=(\n         os.path.join(os.path.dirname(__file__), 'templates'),\n     ),\n+    SITE_ID=1,\n )\n class FlatpageMiddlewareAppendSlashTests(TestCase):\n-    fixtures = ['sample_flatpages']\n+    fixtures = ['sample_flatpages', 'example_site']\n     urls = 'django.contrib.flatpages.tests.urls'\n \n     def test_redirect_view_flatpage(self):\n@@ -130,7 +132,7 @@ def test_redirect_fallback_flatpage_special_chars(self):\n             enable_comments=False,\n             registration_required=False,\n         )\n-        fp.sites.add(1)\n+        fp.sites.add(settings.SITE_ID)\n \n         response = self.client.get('/some.very_special~chars-here')\n         self.assertRedirects(response, '/some.very_special~chars-here/', status_code=301)\n@@ -144,7 +146,7 @@ def test_redirect_fallback_flatpage_root(self):\n             enable_comments=False,\n             registration_required=False,\n         )\n-        fp.sites.add(1)\n+        fp.sites.add(settings.SITE_ID)\n \n         response = self.client.get('/')\n         self.assertEqual(response.status_code, 200)"
        },
        {
            "sha": "aebc62277e6ebd626f445deffda20595f5a8a77f",
            "filename": "django/contrib/flatpages/tests/templatetags.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Ftemplatetags.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Ftemplatetags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftests%2Ftemplatetags.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -18,6 +18,7 @@\n     TEMPLATE_DIRS=(\n         os.path.join(os.path.dirname(__file__), 'templates'),\n     ),\n+    SITE_ID=1,\n )\n class FlatpageTemplateTagTests(TestCase):\n     fixtures = ['sample_flatpages']"
        },
        {
            "sha": "b69bd6abb426c6ca87507819ccab4f2da7824403",
            "filename": "django/contrib/flatpages/tests/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fflatpages%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftests%2Fviews.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -19,9 +19,10 @@\n     TEMPLATE_DIRS=(\n         os.path.join(os.path.dirname(__file__), 'templates'),\n     ),\n+    SITE_ID=1,\n )\n class FlatpageViewTests(TestCase):\n-    fixtures = ['sample_flatpages']\n+    fixtures = ['sample_flatpages', 'example_site']\n     urls = 'django.contrib.flatpages.tests.urls'\n \n     def test_view_flatpage(self):\n@@ -85,9 +86,10 @@ def test_view_flatpage_special_chars(self):\n     TEMPLATE_DIRS=(\n         os.path.join(os.path.dirname(__file__), 'templates'),\n     ),\n+    SITE_ID=1,\n )\n class FlatpageViewAppendSlashTests(TestCase):\n-    fixtures = ['sample_flatpages']\n+    fixtures = ['sample_flatpages', 'example_site']\n     urls = 'django.contrib.flatpages.tests.urls'\n \n     def test_redirect_view_flatpage(self):\n@@ -119,7 +121,7 @@ def test_redirect_view_flatpage_special_chars(self):\n             enable_comments=False,\n             registration_required=False,\n         )\n-        fp.sites.add(1)\n+        fp.sites.add(settings.SITE_ID)\n \n         response = self.client.get('/flatpage_root/some.very_special~chars-here')\n         self.assertRedirects(response, '/flatpage_root/some.very_special~chars-here/', status_code=301)"
        },
        {
            "sha": "b5d905071f66941346061ef8300a30dfc702019a",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 27,
            "deletions": 30,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -156,18 +156,15 @@ def test_form_submit_bad_hash(self):\n \n \n class FormHmacTests(unittest.TestCase):\n-    \"\"\"\n-    Same as SecurityHashTests, but with form_hmac\n-    \"\"\"\n \n     def test_textfield_hash(self):\n         \"\"\"\n         Regression test for #10034: the hash generation function should ignore\n         leading/trailing whitespace so as to be friendly to broken browsers that\n         submit it (usually in textareas).\n         \"\"\"\n-        f1 = HashTestForm({'name': 'joe', 'bio': 'Nothing notable.'})\n-        f2 = HashTestForm({'name': '  joe', 'bio': 'Nothing notable.  '})\n+        f1 = HashTestForm({'name': u'joe', 'bio': u'Nothing notable.'})\n+        f2 = HashTestForm({'name': u'  joe', 'bio': u'Nothing notable.  '})\n         hash1 = utils.form_hmac(f1)\n         hash2 = utils.form_hmac(f2)\n         self.assertEqual(hash1, hash2)\n@@ -269,10 +266,10 @@ def test_good_hash(self):\n         Form should advance if the hash is present and good, as calculated using\n         current method.\n         \"\"\"\n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n-                \"wizard_step\": \"1\"}\n+        data = {\"0-field\": u\"test\",\n+                \"1-field\": u\"test2\",\n+                \"hash_0\": u\"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"wizard_step\": u\"1\"}\n         response = self.client.post('/wizard1/', data)\n         self.assertEqual(2, response.context['step0'])\n \n@@ -294,18 +291,18 @@ def process_step(self, request, form, step):\n                     reached[0] = True\n \n         wizard = WizardWithProcessStep([WizardPageOneForm])\n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n-                \"wizard_step\": \"1\"}\n+        data = {\"0-field\": u\"test\",\n+                \"1-field\": u\"test2\",\n+                \"hash_0\": u\"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"wizard_step\": u\"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n \n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n-                \"hash_1\": \"d5b434e3934cc92fee4bd2964c4ebc06f81d362d\",\n-                \"wizard_step\": \"2\"}\n+        data = {\"0-field\": u\"test\",\n+                \"1-field\": u\"test2\",\n+                \"hash_0\": \"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"hash_1\": u\"1e6f6315da42e62f33a30640ec7e007ad3fbf1a1\",\n+                \"wizard_step\": u\"2\"}\n         self.assertRaises(http.Http404, wizard, DummyRequest(POST=data))\n \n     def test_14498(self):\n@@ -324,10 +321,10 @@ def process_step(self, request, form, step):\n         wizard = WizardWithProcessStep([WizardPageOneForm,\n                                         WizardPageTwoForm,\n                                         WizardPageThreeForm])\n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n-                \"wizard_step\": \"1\"}\n+        data = {\"0-field\": u\"test\",\n+                \"1-field\": u\"test2\",\n+                \"hash_0\": u\"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"wizard_step\": u\"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n \n@@ -348,10 +345,10 @@ def done(self, request, form_list):\n         wizard = Wizard([WizardPageOneForm,\n                          WizardPageTwoForm])\n \n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n-                \"wizard_step\": \"1\"}\n+        data = {\"0-field\": u\"test\",\n+                \"1-field\": u\"test2\",\n+                \"hash_0\": u\"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"wizard_step\": u\"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n \n@@ -374,10 +371,10 @@ def process_step(self, request, form, step):\n         wizard = WizardWithProcessStep([WizardPageOneForm,\n                                         WizardPageTwoForm,\n                                         WizardPageThreeForm])\n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n-                \"wizard_step\": \"1\"}\n+        data = {\"0-field\": u\"test\",\n+                \"1-field\": u\"test2\",\n+                \"hash_0\": u\"cd13b1db3e8f55174bc5745a1b1a53408d4fd1ca\",\n+                \"wizard_step\": u\"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n "
        },
        {
            "sha": "37913fa078e7f03b4fc275b9576831c690c21bcd",
            "filename": "django/contrib/formtools/tests/wizard/namedwizardtests/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fnamedwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fnamedwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fnamedwizardtests%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -120,7 +120,7 @@ def test_form_finish(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(\n             reverse(self.wizard_urlname,\n                     kwargs={'step': response.context['wizard']['steps'].current}),\n@@ -147,7 +147,7 @@ def test_form_finish(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['form_list']\n-        self.assertEqual(all_data[1]['file1'].read(), open(__file__).read())\n+        self.assertEqual(all_data[1]['file1'].read(), open(__file__, 'rb').read())\n         del all_data[1]['file1']\n         self.assertEqual(all_data, [\n             {'name': u'Pony', 'thirsty': True, 'user': self.testuser},\n@@ -168,7 +168,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(\n             reverse(self.wizard_urlname,\n                     kwargs={'step': response.context['wizard']['steps'].current}),\n@@ -180,7 +180,9 @@ def test_cleaned_data(self):\n         response = self.client.get(step2_url)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n-        self.assertEqual(response.context['wizard']['form'].files['form2-file1'].read(), open(__file__).read())\n+        self.assertEqual(\n+            response.context['wizard']['form'].files['form2-file1'].read(),\n+            open(__file__, 'rb').read())\n \n         response = self.client.post(\n             reverse(self.wizard_urlname,\n@@ -197,7 +199,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['all_cleaned_data']\n-        self.assertEqual(all_data['file1'].read(), open(__file__).read())\n+        self.assertEqual(all_data['file1'].read(), open(__file__, 'rb').read())\n         del all_data['file1']\n         self.assertEqual(\n             all_data,\n@@ -221,7 +223,7 @@ def test_manipulated_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(\n             reverse(self.wizard_urlname,\n                     kwargs={'step': response.context['wizard']['steps'].current}),"
        },
        {
            "sha": "a9a81ba70fd52d9121fff47ae22ab9079d66dfc4",
            "filename": "django/contrib/formtools/tests/wizard/wizardtests/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -80,7 +80,7 @@ def test_form_finish(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n@@ -93,7 +93,7 @@ def test_form_finish(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['form_list']\n-        self.assertEqual(all_data[1]['file1'].read(), open(__file__).read())\n+        self.assertEqual(all_data[1]['file1'].read(), open(__file__, 'rb').read())\n         del all_data[1]['file1']\n         self.assertEqual(all_data, [\n             {'name': u'Pony', 'thirsty': True, 'user': self.testuser},\n@@ -110,7 +110,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n \n@@ -121,7 +121,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['all_cleaned_data']\n-        self.assertEqual(all_data['file1'].read(), open(__file__).read())\n+        self.assertEqual(all_data['file1'].read(), open(__file__, 'rb').read())\n         del all_data['file1']\n         self.assertEqual(all_data, {\n             'name': u'Pony', 'thirsty': True, 'user': self.testuser,\n@@ -138,7 +138,7 @@ def test_manipulated_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n \n@@ -165,7 +165,7 @@ def test_form_refresh(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__)\n+        post_data['form2-file1'] = open(__file__, 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form3')"
        },
        {
            "sha": "96a0092a35685e0a04ad3f215715eaab0345e66e",
            "filename": "django/contrib/formtools/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fformtools%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Futils.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,7 +1,5 @@\n-try:\n-    import cPickle as pickle\n-except ImportError:\n-    import pickle\n+# Do not try cPickle here (see #18340)\n+import pickle\n \n from django.utils.crypto import salted_hmac\n "
        },
        {
            "sha": "6913bf5870032c039315e7f4e7cdb86430feabf7",
            "filename": "django/contrib/gis/admin/options.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -36,6 +36,7 @@ class GeoModelAdmin(ModelAdmin):\n     wms_url = 'http://vmap0.tiles.osgeo.org/wms/vmap0'\n     wms_layer = 'basic'\n     wms_name = 'OpenLayers WMS'\n+    wms_options = {'format': 'image/jpeg'}\n     debug = False\n     widget = OpenLayersWidget\n \n@@ -76,6 +77,12 @@ def get_map_widget(self, db_field):\n         class OLMap(self.widget):\n             template = self.map_template\n             geom_type = db_field.geom_type\n+\n+            wms_options = ''\n+            if self.wms_options:\n+                wms_options = [\"%s: '%s'\" % pair for pair in self.wms_options.items()]\n+                wms_options = ', %s' % ', '.join(wms_options)\n+\n             params = {'default_lon' : self.default_lon,\n                       'default_lat' : self.default_lat,\n                       'default_zoom' : self.default_zoom,\n@@ -106,6 +113,7 @@ class OLMap(self.widget):\n                       'wms_url' : self.wms_url,\n                       'wms_layer' : self.wms_layer,\n                       'wms_name' : self.wms_name,\n+                      'wms_options' : wms_options,\n                       'debug' : self.debug,\n                       }\n         return OLMap"
        },
        {
            "sha": "36c03eb51e8f3c04793c21ba887c9ab37b87ff79",
            "filename": "django/contrib/gis/gdal/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgdal%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgdal%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,5 @@\n from ctypes import c_void_p\n-from types import NoneType\n+\n from django.contrib.gis.gdal.error import GDALException\n \n class GDALBase(object):\n@@ -26,7 +26,7 @@ def _set_ptr(self, ptr):\n         # compatible type or None (NULL).\n         if isinstance(ptr, (int, long)):\n             self._ptr = self.ptr_type(ptr)\n-        elif isinstance(ptr, (self.ptr_type, NoneType)):\n+        elif ptr is None or isinstance(ptr, self.ptr_type):\n             self._ptr = ptr\n         else:\n             raise TypeError('Incompatible pointer type')"
        },
        {
            "sha": "eb72a38775df3c9d4f74c3481b80703cf2d10892",
            "filename": "django/contrib/gis/gdal/tests/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -2,10 +2,12 @@\n Module for executing all of the GDAL tests.  None\n of these tests require the use of the database.\n \"\"\"\n+from __future__ import absolute_import\n+\n from django.utils.unittest import TestSuite, TextTestRunner\n \n # Importing the GDAL test modules.\n-import test_driver, test_ds, test_envelope, test_geom, test_srs\n+from . import test_driver, test_ds, test_envelope, test_geom, test_srs\n \n test_suites = [test_driver.suite(),\n                test_ds.suite(),"
        },
        {
            "sha": "8b519a242d01de6398aac9931410af8e8aa825e9",
            "filename": "django/contrib/gis/geoip/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeoip%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeoip%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeoip%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -11,8 +11,10 @@\n  Grab GeoIP.dat.gz and GeoLiteCity.dat.gz, and unzip them in the directory\n  corresponding to settings.GEOIP_PATH.\n \"\"\"\n+from __future__ import absolute_import\n+\n try:\n-    from django.contrib.gis.geoip.base import GeoIP, GeoIPException\n+    from .base import GeoIP, GeoIPException\n     HAS_GEOIP = True\n except:\n     HAS_GEOIP = False"
        },
        {
            "sha": "754bcce7ad6698b980b9dddf44536334007c1ba0",
            "filename": "django/contrib/gis/geos/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,5 @@\n from ctypes import c_void_p\n-from types import NoneType\n+\n from django.contrib.gis.geos.error import GEOSException\n \n # Trying to import GDAL libraries, if available.  Have to place in\n@@ -41,7 +41,7 @@ def _get_ptr(self):\n     def _set_ptr(self, ptr):\n         # Only allow the pointer to be set with pointers of the\n         # compatible type or None (NULL).\n-        if isinstance(ptr, (self.ptr_type, NoneType)):\n+        if ptr is None or isinstance(ptr, self.ptr_type):\n             self._ptr = ptr\n         else:\n             raise TypeError('Incompatible pointer type')"
        },
        {
            "sha": "1a9dcf0b5bef334369454299fde99c4d7f0b8489",
            "filename": "django/contrib/gis/geos/mutable_list.py",
            "status": "modified",
            "additions": 20,
            "deletions": 9,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -8,6 +8,9 @@\n \n Author: Aryeh Leib Taurog.\n \"\"\"\n+from django.utils.functional import total_ordering\n+\n+@total_ordering\n class ListMixin(object):\n     \"\"\"\n     A base class which provides complete list interface.\n@@ -143,20 +146,28 @@ def __imul__(self, n):\n                 self.extend(cache)\n         return self\n \n-    def __cmp__(self, other):\n-        'cmp'\n+    def __eq__(self, other):\n+        for i in range(len(self)):\n+            try:\n+                c = self[i] == other[i]\n+            except IndexError:\n+                # must be other is shorter\n+                return False\n+            if not c:\n+                return False\n+        return True\n+\n+    def __lt__(self, other):\n         slen = len(self)\n         for i in range(slen):\n             try:\n-                c = cmp(self[i], other[i])\n+                c = self[i] < other[i]\n             except IndexError:\n                 # must be other is shorter\n-                return 1\n-            else:\n-                # elements not equal\n-                if c: return c\n-\n-        return cmp(slen, len(other))\n+                return False\n+            if c:\n+                return c\n+        return slen < len(other)\n \n     ### Public list interface Methods ###\n     ## Non-mutating ##"
        },
        {
            "sha": "ccf960c68f4d73c0fba1ae18e218e09daea8d7d7",
            "filename": "django/contrib/gis/geos/tests/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,8 +1,10 @@\n \"\"\"\n GEOS Testing module.\n \"\"\"\n+from __future__ import absolute_import\n+\n from django.utils.unittest import TestSuite, TextTestRunner\n-import test_geos, test_io, test_geos_mutation, test_mutable_list\n+from . import test_geos, test_io, test_geos_mutation, test_mutable_list\n \n test_suites = [\n     test_geos.suite(),"
        },
        {
            "sha": "f435cdaff199e53cd29fc66cd49ce442184180e6",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 65,
            "deletions": 60,
            "changes": 125,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,26 +1,31 @@\n import ctypes\n import random\n-import unittest\n-from django.contrib.gis.geos import *\n+\n+from django.contrib.gis.geos import (GEOSException, GEOSIndexError, GEOSGeometry,\n+    GeometryCollection, Point, MultiPoint, Polygon, MultiPolygon, LinearRing,\n+    LineString, MultiLineString, fromfile, fromstr, geos_version_info)\n from django.contrib.gis.geos.base import gdal, numpy, GEOSBase\n from django.contrib.gis.geos.libgeos import GEOS_PREPARE\n from django.contrib.gis.geometry.test_data import TestDataMixin\n \n+from django.utils import unittest\n+\n+\n class GEOSTest(unittest.TestCase, TestDataMixin):\n \n     @property\n     def null_srid(self):\n         \"\"\"\n         Returns the proper null SRID depending on the GEOS version.\n-        See the comments in `test15_srid` for more details.\n+        See the comments in `test_srid` for more details.\n         \"\"\"\n         info = geos_version_info()\n         if info['version'] == '3.0.0' and info['release_candidate']:\n             return -1\n         else:\n             return None\n \n-    def test00_base(self):\n+    def test_base(self):\n         \"Tests out the GEOSBase class.\"\n         # Testing out GEOSBase class, which provides a `ptr` property\n         # that abstracts out access to underlying C pointers.\n@@ -62,19 +67,19 @@ class FakeGeom2(GEOSBase):\n             self.assertRaises(TypeError, fg1._set_ptr, bad_ptr)\n             self.assertRaises(TypeError, fg2._set_ptr, bad_ptr)\n \n-    def test01a_wkt(self):\n+    def test_wkt(self):\n         \"Testing WKT output.\"\n         for g in self.geometries.wkt_out:\n             geom = fromstr(g.wkt)\n             self.assertEqual(g.ewkt, geom.wkt)\n \n-    def test01b_hex(self):\n+    def test_hex(self):\n         \"Testing HEX output.\"\n         for g in self.geometries.hex_wkt:\n             geom = fromstr(g.wkt)\n             self.assertEqual(g.hex, geom.hex)\n \n-    def test01b_hexewkb(self):\n+    def test_hexewkb(self):\n         \"Testing (HEX)EWKB output.\"\n         from binascii import a2b_hex\n \n@@ -124,14 +129,14 @@ def test01b_hexewkb(self):\n         # Redundant sanity check.\n         self.assertEqual(4326, GEOSGeometry(hexewkb_2d).srid)\n \n-    def test01c_kml(self):\n+    def test_kml(self):\n         \"Testing KML output.\"\n         for tg in self.geometries.wkt_out:\n             geom = fromstr(tg.wkt)\n             kml = getattr(tg, 'kml', False)\n             if kml: self.assertEqual(kml, geom.kml)\n \n-    def test01d_errors(self):\n+    def test_errors(self):\n         \"Testing the Error handlers.\"\n         # string-based\n         print(\"\\nBEGIN - expecting GEOS_ERROR; safe to ignore.\\n\")\n@@ -154,23 +159,23 @@ class NotAGeometry(object):\n         # None\n         self.assertRaises(TypeError, GEOSGeometry, None)\n \n-    def test01e_wkb(self):\n+    def test_wkb(self):\n         \"Testing WKB output.\"\n         from binascii import b2a_hex\n         for g in self.geometries.hex_wkt:\n             geom = fromstr(g.wkt)\n             wkb = geom.wkb\n             self.assertEqual(b2a_hex(wkb).upper(), g.hex)\n \n-    def test01f_create_hex(self):\n+    def test_create_hex(self):\n         \"Testing creation from HEX.\"\n         for g in self.geometries.hex_wkt:\n             geom_h = GEOSGeometry(g.hex)\n             # we need to do this so decimal places get normalised\n             geom_t = fromstr(g.wkt)\n             self.assertEqual(geom_t.wkt, geom_h.wkt)\n \n-    def test01g_create_wkb(self):\n+    def test_create_wkb(self):\n         \"Testing creation from WKB.\"\n         from binascii import a2b_hex\n         for g in self.geometries.hex_wkt:\n@@ -180,7 +185,7 @@ def test01g_create_wkb(self):\n             geom_t = fromstr(g.wkt)\n             self.assertEqual(geom_t.wkt, geom_h.wkt)\n \n-    def test01h_ewkt(self):\n+    def test_ewkt(self):\n         \"Testing EWKT.\"\n         srids = (-1, 32140)\n         for srid in srids:\n@@ -191,17 +196,17 @@ def test01h_ewkt(self):\n                 self.assertEqual(srid, poly.shell.srid)\n                 self.assertEqual(srid, fromstr(poly.ewkt).srid) # Checking export\n \n-    def test01i_json(self):\n+    @unittest.skipUnless(gdal.HAS_GDAL and gdal.GEOJSON, \"gdal >= 1.5 is required\")\n+    def test_json(self):\n         \"Testing GeoJSON input/output (via GDAL).\"\n-        if not gdal or not gdal.GEOJSON: return\n         for g in self.geometries.json_geoms:\n             geom = GEOSGeometry(g.wkt)\n             if not hasattr(g, 'not_equal'):\n                 self.assertEqual(g.json, geom.json)\n                 self.assertEqual(g.json, geom.geojson)\n             self.assertEqual(GEOSGeometry(g.wkt), GEOSGeometry(geom.json))\n \n-    def test01k_fromfile(self):\n+    def test_fromfile(self):\n         \"Testing the fromfile() factory.\"\n         from io import BytesIO\n         ref_pnt = GEOSGeometry('POINT(5 23)')\n@@ -218,7 +223,7 @@ def test01k_fromfile(self):\n             pnt = fromfile(fh)\n             self.assertEqual(ref_pnt, pnt)\n \n-    def test01k_eq(self):\n+    def test_eq(self):\n         \"Testing equivalence.\"\n         p = fromstr('POINT(5 23)')\n         self.assertEqual(p, p.wkt)\n@@ -233,7 +238,7 @@ def test01k_eq(self):\n             self.assertNotEqual(g, {'foo' : 'bar'})\n             self.assertNotEqual(g, False)\n \n-    def test02a_points(self):\n+    def test_points(self):\n         \"Testing Point objects.\"\n         prev = fromstr('POINT(0 0)')\n         for p in self.geometries.points:\n@@ -288,7 +293,7 @@ def test02a_points(self):\n \n             prev = pnt # setting the previous geometry\n \n-    def test02b_multipoints(self):\n+    def test_multipoints(self):\n         \"Testing MultiPoint objects.\"\n         for mp in self.geometries.multipoints:\n             mpnt = fromstr(mp.wkt)\n@@ -307,7 +312,7 @@ def test02b_multipoints(self):\n                 self.assertEqual(p.empty, False)\n                 self.assertEqual(p.valid, True)\n \n-    def test03a_linestring(self):\n+    def test_linestring(self):\n         \"Testing LineString objects.\"\n         prev = fromstr('POINT(0 0)')\n         for l in self.geometries.linestrings:\n@@ -333,7 +338,7 @@ def test03a_linestring(self):\n             self.assertEqual(ls.wkt, LineString(*tuple(Point(tup) for tup in ls.tuple)).wkt) # Point individual arguments\n             if numpy: self.assertEqual(ls, LineString(numpy.array(ls.tuple))) # as numpy array\n \n-    def test03b_multilinestring(self):\n+    def test_multilinestring(self):\n         \"Testing MultiLineString objects.\"\n         prev = fromstr('POINT(0 0)')\n         for l in self.geometries.multilinestrings:\n@@ -357,7 +362,7 @@ def test03b_multilinestring(self):\n             self.assertEqual(ml.wkt, MultiLineString(*tuple(s.clone() for s in ml)).wkt)\n             self.assertEqual(ml, MultiLineString(*tuple(LineString(s.tuple) for s in ml)))\n \n-    def test04_linearring(self):\n+    def test_linearring(self):\n         \"Testing LinearRing objects.\"\n         for rr in self.geometries.linearrings:\n             lr = fromstr(rr.wkt)\n@@ -373,14 +378,15 @@ def test04_linearring(self):\n             self.assertEqual(lr, LinearRing([list(tup) for tup in lr.tuple]))\n             if numpy: self.assertEqual(lr, LinearRing(numpy.array(lr.tuple)))\n \n-    def test05a_polygons(self):\n-        \"Testing Polygon objects.\"\n-\n-        # Testing `from_bbox` class method\n+    def test_polygons_from_bbox(self):\n+        \"Testing `from_bbox` class method.\"\n         bbox = (-180, -90, 180, 90)\n-        p = Polygon.from_bbox( bbox )\n+        p = Polygon.from_bbox(bbox)\n         self.assertEqual(bbox, p.extent)\n \n+    def test_polygons(self):\n+        \"Testing Polygon objects.\"\n+\n         prev = fromstr('POINT(0 0)')\n         for p in self.geometries.polygons:\n             # Creating the Polygon, testing its properties.\n@@ -437,7 +443,7 @@ def test05a_polygons(self):\n             self.assertEqual(poly.wkt, Polygon(*tuple(r for r in poly)).wkt)\n             self.assertEqual(poly.wkt, Polygon(*tuple(LinearRing(r.tuple) for r in poly)).wkt)\n \n-    def test05b_multipolygons(self):\n+    def test_multipolygons(self):\n         \"Testing MultiPolygon objects.\"\n         print(\"\\nBEGIN - expecting GEOS_NOTICE; safe to ignore.\\n\")\n         prev = fromstr('POINT (0 0)')\n@@ -460,7 +466,7 @@ def test05b_multipolygons(self):\n \n         print(\"\\nEND - expecting GEOS_NOTICE; safe to ignore.\\n\")\n \n-    def test06a_memory_hijinks(self):\n+    def test_memory_hijinks(self):\n         \"Testing Geometry __del__() on rings and polygons.\"\n         #### Memory issues with rings and polygons\n \n@@ -483,7 +489,7 @@ def test06a_memory_hijinks(self):\n         # Access to these rings is OK since they are clones.\n         s1, s2 = str(ring1), str(ring2)\n \n-    def test08_coord_seq(self):\n+    def test_coord_seq(self):\n         \"Testing Coordinate Sequence objects.\"\n         for p in self.geometries.polygons:\n             if p.ext_ring_cs:\n@@ -510,7 +516,7 @@ def test08_coord_seq(self):\n                         cs[i] = tset\n                         self.assertEqual(tset[j], cs[i][j])\n \n-    def test09_relate_pattern(self):\n+    def test_relate_pattern(self):\n         \"Testing relate() and relate_pattern().\"\n         g = fromstr('POINT (0 0)')\n         self.assertRaises(GEOSException, g.relate_pattern, 0, 'invalid pattern, yo')\n@@ -520,7 +526,7 @@ def test09_relate_pattern(self):\n             self.assertEqual(rg.result, a.relate_pattern(b, rg.pattern))\n             self.assertEqual(rg.pattern, a.relate(b))\n \n-    def test10_intersection(self):\n+    def test_intersection(self):\n         \"Testing intersects() and intersection().\"\n         for i in xrange(len(self.geometries.topology_geoms)):\n             a = fromstr(self.geometries.topology_geoms[i].wkt_a)\n@@ -533,7 +539,7 @@ def test10_intersection(self):\n             a &= b # testing __iand__\n             self.assertEqual(i1, a)\n \n-    def test11_union(self):\n+    def test_union(self):\n         \"Testing union().\"\n         for i in xrange(len(self.geometries.topology_geoms)):\n             a = fromstr(self.geometries.topology_geoms[i].wkt_a)\n@@ -545,7 +551,7 @@ def test11_union(self):\n             a |= b # testing __ior__\n             self.assertEqual(u1, a)\n \n-    def test12_difference(self):\n+    def test_difference(self):\n         \"Testing difference().\"\n         for i in xrange(len(self.geometries.topology_geoms)):\n             a = fromstr(self.geometries.topology_geoms[i].wkt_a)\n@@ -557,7 +563,7 @@ def test12_difference(self):\n             a -= b # testing __isub__\n             self.assertEqual(d1, a)\n \n-    def test13_symdifference(self):\n+    def test_symdifference(self):\n         \"Testing sym_difference().\"\n         for i in xrange(len(self.geometries.topology_geoms)):\n             a = fromstr(self.geometries.topology_geoms[i].wkt_a)\n@@ -569,7 +575,7 @@ def test13_symdifference(self):\n             a ^= b # testing __ixor__\n             self.assertEqual(d1, a)\n \n-    def test14_buffer(self):\n+    def test_buffer(self):\n         \"Testing buffer().\"\n         for bg in self.geometries.buffer_geoms:\n             g = fromstr(bg.wkt)\n@@ -597,7 +603,7 @@ def test14_buffer(self):\n                     self.assertAlmostEqual(exp_ring[k][0], buf_ring[k][0], 9)\n                     self.assertAlmostEqual(exp_ring[k][1], buf_ring[k][1], 9)\n \n-    def test15_srid(self):\n+    def test_srid(self):\n         \"Testing the SRID property and keyword.\"\n         # Testing SRID keyword on Point\n         pnt = Point(5, 23, srid=4326)\n@@ -635,7 +641,7 @@ def test15_srid(self):\n         p3 = fromstr(p1.hex, srid=-1) # -1 is intended.\n         self.assertEqual(-1, p3.srid)\n \n-    def test16_mutable_geometries(self):\n+    def test_mutable_geometries(self):\n         \"Testing the mutability of Polygons and Geometry Collections.\"\n         ### Testing the mutability of Polygons ###\n         for p in self.geometries.polygons:\n@@ -699,7 +705,7 @@ def test16_mutable_geometries(self):\n         #self.assertEqual((3.14, 2.71), mpoly[0].shell[0])\n         #del mpoly\n \n-    def test17_threed(self):\n+    def test_threed(self):\n         \"Testing three-dimensional geometries.\"\n         # Testing a 3D Point\n         pnt = Point(2, 3, 8)\n@@ -715,7 +721,7 @@ def test17_threed(self):\n         ls[0] = (1.,2.,3.)\n         self.assertEqual((1.,2.,3.), ls[0])\n \n-    def test18_distance(self):\n+    def test_distance(self):\n         \"Testing the distance() function.\"\n         # Distance to self should be 0.\n         pnt = Point(0, 0)\n@@ -733,7 +739,7 @@ def test18_distance(self):\n         ls2 = LineString((5, 2), (6, 1), (7, 0))\n         self.assertEqual(3, ls1.distance(ls2))\n \n-    def test19_length(self):\n+    def test_length(self):\n         \"Testing the length property.\"\n         # Points have 0 length.\n         pnt = Point(0, 0)\n@@ -751,7 +757,7 @@ def test19_length(self):\n         mpoly = MultiPolygon(poly.clone(), poly)\n         self.assertEqual(8.0, mpoly.length)\n \n-    def test20a_emptyCollections(self):\n+    def test_emptyCollections(self):\n         \"Testing empty geometries and collections.\"\n         gc1 = GeometryCollection([])\n         gc2 = fromstr('GEOMETRYCOLLECTION EMPTY')\n@@ -789,7 +795,7 @@ def test20a_emptyCollections(self):\n             else:\n                 self.assertRaises(GEOSIndexError, g.__getitem__, 0)\n \n-    def test20b_collections_of_collections(self):\n+    def test_collections_of_collections(self):\n         \"Testing GeometryCollection handling of other collections.\"\n         # Creating a GeometryCollection WKT string composed of other\n         # collections and polygons.\n@@ -808,9 +814,9 @@ def test20b_collections_of_collections(self):\n         # And, they should be equal.\n         self.assertEqual(gc1, gc2)\n \n-    def test21_test_gdal(self):\n+    @unittest.skipUnless(gdal.HAS_GDAL, \"gdal is required\")\n+    def test_gdal(self):\n         \"Testing `ogr` and `srs` properties.\"\n-        if not gdal.HAS_GDAL: return\n         g1 = fromstr('POINT(5 23)')\n         self.assertEqual(True, isinstance(g1.ogr, gdal.OGRGeometry))\n         self.assertEqual(g1.srs, None)\n@@ -821,7 +827,7 @@ def test21_test_gdal(self):\n         self.assertEqual(g2.hex, g2.ogr.hex)\n         self.assertEqual('WGS 84', g2.srs.name)\n \n-    def test22_copy(self):\n+    def test_copy(self):\n         \"Testing use with the Python `copy` module.\"\n         import copy\n         poly = GEOSGeometry('POLYGON((0 0, 0 23, 23 23, 23 0, 0 0), (5 5, 5 10, 10 10, 10 5, 5 5))')\n@@ -830,9 +836,9 @@ def test22_copy(self):\n         self.assertNotEqual(poly._ptr, cpy1._ptr)\n         self.assertNotEqual(poly._ptr, cpy2._ptr)\n \n-    def test23_transform(self):\n+    @unittest.skipUnless(gdal.HAS_GDAL, \"gdal is required\")\n+    def test_transform(self):\n         \"Testing `transform` method.\"\n-        if not gdal.HAS_GDAL: return\n         orig = GEOSGeometry('POINT (-104.609 38.255)', 4326)\n         trans = GEOSGeometry('POINT (992385.4472045 481455.4944650)', 2774)\n \n@@ -855,7 +861,7 @@ def test23_transform(self):\n             self.assertAlmostEqual(trans.x, p.x, prec)\n             self.assertAlmostEqual(trans.y, p.y, prec)\n \n-    def test23_transform_noop(self):\n+    def test_transform_noop(self):\n         \"\"\" Testing `transform` method (SRID match) \"\"\"\n         # transform() should no-op if source & dest SRIDs match,\n         # regardless of whether GDAL is available.\n@@ -890,7 +896,7 @@ def test23_transform_noop(self):\n         finally:\n             gdal.HAS_GDAL = old_has_gdal\n \n-    def test23_transform_nosrid(self):\n+    def test_transform_nosrid(self):\n         \"\"\" Testing `transform` method (no SRID or negative SRID) \"\"\"\n \n         g = GEOSGeometry('POINT (-104.609 38.255)', srid=None)\n@@ -905,7 +911,7 @@ def test23_transform_nosrid(self):\n         g = GEOSGeometry('POINT (-104.609 38.255)', srid=-1)\n         self.assertRaises(GEOSException, g.transform, 2774, clone=True)\n \n-    def test23_transform_nogdal(self):\n+    def test_transform_nogdal(self):\n         \"\"\" Testing `transform` method (GDAL not available) \"\"\"\n         old_has_gdal = gdal.HAS_GDAL\n         try:\n@@ -919,7 +925,7 @@ def test23_transform_nogdal(self):\n         finally:\n             gdal.HAS_GDAL = old_has_gdal\n \n-    def test24_extent(self):\n+    def test_extent(self):\n         \"Testing `extent` method.\"\n         # The xmin, ymin, xmax, ymax of the MultiPoint should be returned.\n         mp = MultiPoint(Point(5, 23), Point(0, 0), Point(10, 50))\n@@ -935,7 +941,7 @@ def test24_extent(self):\n         xmax, ymax = max(x), max(y)\n         self.assertEqual((xmin, ymin, xmax, ymax), poly.extent)\n \n-    def test25_pickle(self):\n+    def test_pickle(self):\n         \"Testing pickling and unpickling support.\"\n         # Using both pickle and cPickle -- just 'cause.\n         import pickle, cPickle\n@@ -958,9 +964,9 @@ def get_geoms(lst, srid=None):\n                 self.assertEqual(geom, tmpg)\n                 if not no_srid: self.assertEqual(geom.srid, tmpg.srid)\n \n-    def test26_prepared(self):\n+    @unittest.skipUnless(GEOS_PREPARE, \"geos >= 3.1.0 is required\")\n+    def test_prepared(self):\n         \"Testing PreparedGeometry support.\"\n-        if not GEOS_PREPARE: return\n         # Creating a simple multipolygon and getting a prepared version.\n         mpoly = GEOSGeometry('MULTIPOLYGON(((0 0,0 5,5 5,5 0,0 0)),((5 5,5 10,10 10,10 5,5 5)))')\n         prep = mpoly.prepared\n@@ -974,7 +980,7 @@ def test26_prepared(self):\n             self.assertEqual(mpoly.intersects(pnt), prep.intersects(pnt))\n             self.assertEqual(c, prep.covers(pnt))\n \n-    def test26_line_merge(self):\n+    def test_line_merge(self):\n         \"Testing line merge support\"\n         ref_geoms = (fromstr('LINESTRING(1 1, 1 1, 3 3)'),\n                      fromstr('MULTILINESTRING((1 1, 3 3), (3 3, 4 2))'),\n@@ -985,10 +991,9 @@ def test26_line_merge(self):\n         for geom, merged in zip(ref_geoms, ref_merged):\n             self.assertEqual(merged, geom.merged)\n \n-    def test27_valid_reason(self):\n+    @unittest.skipUnless(GEOS_PREPARE, \"geos >= 3.1.0 is required\")\n+    def test_valid_reason(self):\n         \"Testing IsValidReason support\"\n-        # Skipping tests if GEOS < v3.1.\n-        if not GEOS_PREPARE: return\n \n         g = GEOSGeometry(\"POINT(0 0)\")\n         self.assertTrue(g.valid)\n@@ -1005,7 +1010,7 @@ def test27_valid_reason(self):\n \n         print(\"\\nEND - expecting GEOS_NOTICE; safe to ignore.\\n\")\n \n-    def test28_geos_version(self):\n+    def test_geos_version(self):\n         \"Testing the GEOS version regular expression.\"\n         from django.contrib.gis.geos.libgeos import version_regex\n         versions = [ ('3.0.0rc4-CAPI-1.3.3', '3.0.0'),"
        },
        {
            "sha": "eaf12dad6d81eca2e6ebdfefa72a081080d613ec",
            "filename": "django/contrib/gis/maps/google/overlays.py",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,7 @@\n-from django.utils.safestring import mark_safe\n from django.contrib.gis.geos import fromstr, Point, LineString, LinearRing, Polygon\n+from django.utils.functional import total_ordering\n+from django.utils.safestring import mark_safe\n+\n \n class GEvent(object):\n     \"\"\"\n@@ -166,6 +168,7 @@ def js_params(self):\n         return '%s, \"%s\", %s, %s' % (self.latlngs, self.color, self.weight, self.opacity)\n \n \n+@total_ordering\n class GIcon(object):\n     \"\"\"\n     Creates a GIcon object to pass into a Gmarker object.\n@@ -231,8 +234,11 @@ def __init__(self, varname, image=None, iconsize=None,\n         self.iconanchor = iconanchor\n         self.infowindowanchor = infowindowanchor\n \n-    def __cmp__(self, other):\n-        return cmp(self.varname, other.varname)\n+    def __eq__(self, other):\n+        return self.varname == other.varname\n+\n+    def __lt__(self, other):\n+        return self.varname < other.varname\n     \n     def __hash__(self):\n         # XOR with hash of GIcon type so that hash('varname') won't "
        },
        {
            "sha": "46e198c4107946165e36739fd92623ad7ef90bd2",
            "filename": "django/contrib/gis/measure.py",
            "status": "modified",
            "additions": 20,
            "deletions": 4,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmeasure.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -38,6 +38,8 @@\n __all__ = ['A', 'Area', 'D', 'Distance']\n from decimal import Decimal\n \n+from django.utils.functional import total_ordering\n+\n class MeasureBase(object):\n     def default_units(self, kwargs):\n         \"\"\"\n@@ -84,6 +86,7 @@ def unit_attname(cls, unit_str):\n         else:\n             raise Exception('Could not find a unit keyword associated with \"%s\"' % unit_str)\n \n+@total_ordering\n class Distance(MeasureBase):\n     UNITS = {\n         'chain' : 20.1168,\n@@ -178,9 +181,15 @@ def __repr__(self):\n     def __str__(self):\n         return '%s %s' % (getattr(self, self._default_unit), self._default_unit)\n \n-    def __cmp__(self, other):\n+    def __eq__(self, other):\n+        if isinstance(other, Distance):\n+            return self.m == other.m\n+        else:\n+            return NotImplemented\n+\n+    def __lt__(self, other):\n         if isinstance(other, Distance):\n-            return cmp(self.m, other.m)\n+            return self.m < other.m\n         else:\n             return NotImplemented\n \n@@ -244,6 +253,7 @@ def __idiv__(self, other):\n     def __nonzero__(self):\n         return bool(self.m)\n \n+@total_ordering\n class Area(MeasureBase):\n     # Getting the square units values and the alias dictionary.\n     UNITS = dict([('sq_%s' % k, v ** 2) for k, v in Distance.UNITS.items()])\n@@ -267,9 +277,15 @@ def __repr__(self):\n     def __str__(self):\n         return '%s %s' % (getattr(self, self._default_unit), self._default_unit)\n \n-    def __cmp__(self, other):\n+    def __eq__(self, other):\n+        if isinstance(other, Area):\n+            return self.sq_m == other.sq_m\n+        else:\n+            return NotImplemented\n+\n+    def __lt__(self, other):\n         if isinstance(other, Area):\n-            return cmp(self.sq_m, other.sq_m)\n+            return self.sq_m < other.sq_m\n         else:\n             return NotImplemented\n "
        },
        {
            "sha": "f54b75e25831c364750a8ef1779eabbb8e1b740d",
            "filename": "django/contrib/gis/templates/gis/admin/openlayers.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -111,7 +111,7 @@ OpenLayers.Projection.addTransform(\"EPSG:4326\", \"EPSG:3857\", OpenLayers.Layer.Sp\n     // The admin map for this geometry field.\n     {{ module }}.map = new OpenLayers.Map('{{ id }}_map', options);\n     // Base Layer\n-    {{ module }}.layers.base = {% block base_layer %}new OpenLayers.Layer.WMS( \"{{ wms_name }}\", \"{{ wms_url }}\", {layers: '{{ wms_layer }}'} );{% endblock %}\n+    {{ module }}.layers.base = {% block base_layer %}new OpenLayers.Layer.WMS(\"{{ wms_name }}\", \"{{ wms_url }}\", {layers: '{{ wms_layer }}'{{ wms_options|safe }}});{% endblock %}\n     {{ module }}.map.addLayer({{ module }}.layers.base);\n     {% block extra_layers %}{% endblock %}\n     {% if is_linestring %}OpenLayers.Feature.Vector.style[\"default\"][\"strokeWidth\"] = 3; // Default too thin for linestrings. {% endif %}"
        },
        {
            "sha": "53c00c65881100279282843da9d4160b794c4325",
            "filename": "django/contrib/gis/tests/geoadmin/tests.py",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -2,6 +2,7 @@\n \n from django.test import TestCase\n from django.contrib.gis import admin\n+from django.contrib.gis.geos import Point\n \n from .models import City\n \n@@ -14,3 +15,21 @@ def test01_ensure_geographic_media(self):\n         admin_js = geoadmin.media.render_js()\n         self.assertTrue(any([geoadmin.openlayers_url in js for js in admin_js]))\n \n+    def test_olmap_OSM_rendering(self):\n+        geoadmin = admin.site._registry[City]\n+        result = geoadmin.get_map_widget(City._meta.get_field('point'))(\n+            ).render('point', Point(-79.460734, 40.18476))\n+        self.assertIn(\n+            \"\"\"geodjango_point.layers.base = new OpenLayers.Layer.OSM(\"OpenStreetMap (Mapnik)\");\"\"\",\n+            result)\n+\n+    def test_olmap_WMS_rendering(self):\n+        admin.site.unregister(City)\n+        admin.site.register(City, admin.GeoModelAdmin)\n+\n+        geoadmin = admin.site._registry[City]\n+        result = geoadmin.get_map_widget(City._meta.get_field('point'))(\n+            ).render('point', Point(-79.460734, 40.18476))\n+        self.assertIn(\n+            \"\"\"geodjango_point.layers.base = new OpenLayers.Layer.WMS(\"OpenLayers WMS\", \"http://vmap0.tiles.osgeo.org/wms/vmap0\", {layers: \\'basic\\', format: 'image/jpeg'});\"\"\",\n+            result)"
        },
        {
            "sha": "b58dccdf37e3b808f45f8cfaed5ff2e8c6a1990e",
            "filename": "django/contrib/gis/tests/layermap/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -17,6 +17,7 @@ class CountyFeat(models.Model):\n \n class City(models.Model):\n     name = models.CharField(max_length=25)\n+    name_txt = models.TextField(default='')\n     population = models.IntegerField()\n     density = models.DecimalField(max_digits=7, decimal_places=1)\n     dt = models.DateField()"
        },
        {
            "sha": "85b8d0c8b5dc0f56fc90ad7da4e37cbaa9b2bb3d",
            "filename": "django/contrib/gis/tests/layermap/tests.py",
            "status": "modified",
            "additions": 34,
            "deletions": 31,
            "changes": 65,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -4,11 +4,11 @@\n from copy import copy\n from decimal import Decimal\n \n-from django.utils.unittest import TestCase\n-\n from django.contrib.gis.gdal import DataSource\n from django.contrib.gis.tests.utils import mysql\n-from django.contrib.gis.utils.layermapping import LayerMapping, LayerMapError, InvalidDecimal, MissingForeignKey\n+from django.contrib.gis.utils.layermapping import (LayerMapping, LayerMapError,\n+    InvalidDecimal, MissingForeignKey)\n+from django.test import TestCase\n \n from .models import (\n     City, County, CountyFeat, Interstate, ICity1, ICity2, Invalid, State,\n@@ -28,7 +28,7 @@\n \n class LayerMapTest(TestCase):\n \n-    def test01_init(self):\n+    def test_init(self):\n         \"Testing LayerMapping initialization.\"\n \n         # Model field that does not exist.\n@@ -46,22 +46,14 @@ def test01_init(self):\n         # Incrementing through the bad mapping dictionaries and\n         # ensuring that a LayerMapError is raised.\n         for bad_map in (bad1, bad2, bad3):\n-            try:\n+            with self.assertRaises(LayerMapError):\n                 lm = LayerMapping(City, city_shp, bad_map)\n-            except LayerMapError:\n-                pass\n-            else:\n-                self.fail('Expected a LayerMapError.')\n \n         # A LookupError should be thrown for bogus encodings.\n-        try:\n+        with self.assertRaises(LookupError):\n             lm = LayerMapping(City, city_shp, city_mapping, encoding='foobar')\n-        except LookupError:\n-            pass\n-        else:\n-            self.fail('Expected a LookupError')\n \n-    def test02_simple_layermap(self):\n+    def test_simple_layermap(self):\n         \"Test LayerMapping import of a simple point shapefile.\"\n         # Setting up for the LayerMapping.\n         lm = LayerMapping(City, city_shp, city_mapping)\n@@ -85,18 +77,14 @@ def test02_simple_layermap(self):\n             self.assertAlmostEqual(pnt1.x, pnt2.x, 5)\n             self.assertAlmostEqual(pnt1.y, pnt2.y, 5)\n \n-    def test03_layermap_strict(self):\n+    def test_layermap_strict(self):\n         \"Testing the `strict` keyword, and import of a LineString shapefile.\"\n         # When the `strict` keyword is set an error encountered will force\n         # the importation to stop.\n-        try:\n+        with self.assertRaises(InvalidDecimal):\n             lm = LayerMapping(Interstate, inter_shp, inter_mapping)\n             lm.save(silent=True, strict=True)\n-        except InvalidDecimal:\n-            # No transactions for geoms on MySQL; delete added features.\n-            if mysql: Interstate.objects.all().delete()\n-        else:\n-            self.fail('Should have failed on strict import with invalid decimal values.')\n+        Interstate.objects.all().delete()\n \n         # This LayerMapping should work b/c `strict` is not set.\n         lm = LayerMapping(Interstate, inter_shp, inter_mapping)\n@@ -137,7 +125,7 @@ def county_helper(self, county_feat=True):\n                 qs = CountyFeat.objects.filter(name=name)\n                 self.assertEqual(n, qs.count())\n \n-    def test04_layermap_unique_multigeometry_fk(self):\n+    def test_layermap_unique_multigeometry_fk(self):\n         \"Testing the `unique`, and `transform`, geometry collection conversion, and ForeignKey mappings.\"\n         # All the following should work.\n         try:\n@@ -176,8 +164,9 @@ def test04_layermap_unique_multigeometry_fk(self):\n         self.assertRaises(MissingForeignKey, lm.save, silent=True, strict=True)\n \n         # Now creating the state models so the ForeignKey mapping may work.\n-        co, hi, tx = State(name='Colorado'), State(name='Hawaii'), State(name='Texas')\n-        co.save(), hi.save(), tx.save()\n+        State.objects.bulk_create([\n+            State(name='Colorado'), State(name='Hawaii'), State(name='Texas')\n+        ])\n \n         # If a mapping is specified as a collection, all OGR fields that\n         # are not collections will be converted into them.  For example,\n@@ -203,16 +192,19 @@ def test04_layermap_unique_multigeometry_fk(self):\n         # The county helper is called to ensure integrity of County models.\n         self.county_helper()\n \n-    def test05_test_fid_range_step(self):\n+    def test_test_fid_range_step(self):\n         \"Tests the `fid_range` keyword and the `step` keyword of .save().\"\n         # Function for clearing out all the counties before testing.\n         def clear_counties(): County.objects.all().delete()\n \n+        State.objects.bulk_create([\n+            State(name='Colorado'), State(name='Hawaii'), State(name='Texas')\n+        ])\n+\n         # Initializing the LayerMapping object to use in these tests.\n         lm = LayerMapping(County, co_shp, co_mapping, transform=False, unique='name')\n \n         # Bad feature id ranges should raise a type error.\n-        clear_counties()\n         bad_ranges = (5.0, 'foo', co_shp)\n         for bad in bad_ranges:\n             self.assertRaises(TypeError, lm.save, fid_range=bad)\n@@ -241,8 +233,10 @@ def clear_counties(): County.objects.all().delete()\n         self.assertEqual(2, qs.count())\n         hi, co = tuple(qs)\n         hi_idx, co_idx = tuple(map(NAMES.index, ('Honolulu', 'Pueblo')))\n-        self.assertEqual('Pueblo', co.name); self.assertEqual(NUMS[co_idx], len(co.mpoly))\n-        self.assertEqual('Honolulu', hi.name); self.assertEqual(NUMS[hi_idx], len(hi.mpoly))\n+        self.assertEqual('Pueblo', co.name)\n+        self.assertEqual(NUMS[co_idx], len(co.mpoly))\n+        self.assertEqual('Honolulu', hi.name)\n+        self.assertEqual(NUMS[hi_idx], len(hi.mpoly))\n \n         # Testing the `step` keyword -- should get the same counties\n         # regardless of we use a step that divides equally, that is odd,\n@@ -252,7 +246,7 @@ def clear_counties(): County.objects.all().delete()\n             lm.save(step=st, strict=True)\n             self.county_helper(county_feat=False)\n \n-    def test06_model_inheritance(self):\n+    def test_model_inheritance(self):\n         \"Tests LayerMapping on inherited models.  See #12093.\"\n         icity_mapping = {'name' : 'Name',\n                          'population' : 'Population',\n@@ -272,9 +266,18 @@ def test06_model_inheritance(self):\n         self.assertEqual(6, ICity1.objects.count())\n         self.assertEqual(3, ICity2.objects.count())\n \n-    def test07_invalid_layer(self):\n+    def test_invalid_layer(self):\n         \"Tests LayerMapping on invalid geometries.  See #15378.\"\n         invalid_mapping = {'point': 'POINT'}\n         lm = LayerMapping(Invalid, invalid_shp, invalid_mapping,\n                           source_srs=4326)\n         lm.save(silent=True)\n+\n+    def test_textfield(self):\n+        \"Tests that String content fits also in a TextField\"\n+        mapping = copy(city_mapping)\n+        mapping['name_txt'] = 'Name'\n+        lm = LayerMapping(City, city_shp, mapping)\n+        lm.save(silent=True, strict=True)\n+        self.assertEqual(City.objects.count(), 3)\n+        self.assertEqual(City.objects.all().order_by('name_txt')[0].name_txt, \"Houston\")"
        },
        {
            "sha": "48d6c1b70e219d004049d99c7b2c341cfeb34587",
            "filename": "django/contrib/gis/utils/layermapping.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -332,7 +332,7 @@ def verify_ogr_field(self, ogr_field, model_field):\n                 val = unicode(ogr_field.value, self.encoding)\n             else:\n                 val = ogr_field.value\n-                if len(val) > model_field.max_length:\n+                if model_field.max_length and len(val) > model_field.max_length:\n                     raise InvalidString('%s model field maximum string length is %s, given %s characters.' %\n                                         (model_field.name, model_field.max_length, len(val)))\n         elif isinstance(ogr_field, OFTReal) and isinstance(model_field, models.DecimalField):"
        },
        {
            "sha": "bf6684766bc979d1461e39bdd50cc7731fd5ba84",
            "filename": "django/contrib/humanize/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -190,7 +190,7 @@ def now(self, tz=None):\n         orig_humanize_datetime = humanize.datetime\n         orig_timesince_datetime = timesince.datetime\n         humanize.datetime = MockDateTime\n-        timesince.datetime = new.module(\"mock_datetime\")\n+        timesince.datetime = new.module(b\"mock_datetime\")\n         timesince.datetime.datetime = MockDateTime\n \n         try:"
        },
        {
            "sha": "51f681f4fcb09e71305bce2988d40de65fb7e852",
            "filename": "django/contrib/localflavor/es/es_provinces.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Flocalflavor%2Fes%2Fes_provinces.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Flocalflavor%2Fes%2Fes_provinces.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fes%2Fes_provinces.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -2,7 +2,7 @@\n from django.utils.translation import ugettext_lazy as _\n \n PROVINCE_CHOICES = (\n-    ('01', _('Arava')),\n+    ('01', _('Araba')),\n     ('02', _('Albacete')),\n     ('03', _('Alacant')),\n     ('04', _('Almeria')),"
        },
        {
            "sha": "1f64c61ecb9cdb941abcb00de7a1fb157af7a78a",
            "filename": "django/contrib/messages/tests/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,5 @@\n from django import http\n-from django.conf import settings\n+from django.conf import settings, global_settings\n from django.contrib.messages import constants, utils, get_level, set_level\n from django.contrib.messages.api import MessageFailure\n from django.contrib.messages.storage import default_storage, base\n@@ -57,6 +57,7 @@ class BaseTest(TestCase):\n     def setUp(self):\n         self.settings_override = override_settings_tags(\n             TEMPLATE_DIRS   = (),\n+            TEMPLATE_CONTEXT_PROCESSORS = global_settings.TEMPLATE_CONTEXT_PROCESSORS,\n             MESSAGE_TAGS    = '',\n             MESSAGE_STORAGE = '%s.%s' % (self.storage_class.__module__,\n                                          self.storage_class.__name__),"
        },
        {
            "sha": "224277e2a0ada1e8b2ad8f4e0f1c0424c6ece4ba",
            "filename": "django/contrib/sitemaps/tests/base.py",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,6 +1,3 @@\n-import os\n-\n-from django.conf import settings\n from django.contrib.auth.models import User\n from django.contrib.sites.models import Site\n from django.test import TestCase\n@@ -13,16 +10,9 @@ class SitemapTestsBase(TestCase):\n \n     def setUp(self):\n         self.base_url = '%s://%s' % (self.protocol, self.domain)\n-        self.old_USE_L10N = settings.USE_L10N\n-        self.old_TEMPLATE_DIRS = settings.TEMPLATE_DIRS\n-        settings.TEMPLATE_DIRS = (\n-            os.path.join(os.path.dirname(__file__), 'templates'),\n-        )\n         self.old_Site_meta_installed = Site._meta.installed\n         # Create a user that will double as sitemap content\n         User.objects.create_user('testuser', 'test@example.com', 's3krit')\n \n     def tearDown(self):\n-        settings.USE_L10N = self.old_USE_L10N\n-        settings.TEMPLATE_DIRS = self.old_TEMPLATE_DIRS\n         Site._meta.installed = self.old_Site_meta_installed"
        },
        {
            "sha": "5786aa48d577e8523390840d62e3fddcbe6a9604",
            "filename": "django/contrib/sitemaps/tests/http.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,15 +1,19 @@\n+import os\n from datetime import date\n+\n from django.conf import settings\n from django.contrib.auth.models import User\n from django.contrib.sitemaps import Sitemap, GenericSitemap\n from django.contrib.sites.models import Site\n from django.core.exceptions import ImproperlyConfigured\n+from django.test.utils import override_settings\n from django.utils.unittest import skipUnless\n from django.utils.formats import localize\n from django.utils.translation import activate, deactivate\n \n from .base import SitemapTestsBase\n \n+\n class HTTPSitemapTests(SitemapTestsBase):\n \n     def test_simple_sitemap_index(self):\n@@ -21,6 +25,9 @@ def test_simple_sitemap_index(self):\n </sitemapindex>\n \"\"\" % self.base_url)\n \n+    @override_settings(\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+    )\n     def test_simple_sitemap_custom_index(self):\n         \"A simple sitemap index can be rendered with a custom template\"\n         response = self.client.get('/simple/custom-index.xml')\n@@ -49,6 +56,9 @@ def test_simple_sitemap(self):\n </urlset>\n \"\"\" % (self.base_url, date.today()))\n \n+    @override_settings(\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+    )\n     def test_simple_custom_sitemap(self):\n         \"A simple sitemap can be rendered with a custom template\"\n         response = self.client.get('/simple/custom-sitemap.xml')\n@@ -60,10 +70,9 @@ def test_simple_custom_sitemap(self):\n \"\"\" % (self.base_url, date.today()))\n \n     @skipUnless(settings.USE_I18N, \"Internationalization is not enabled\")\n+    @override_settings(USE_L10N=True)\n     def test_localized_priority(self):\n         \"The priority value should not be localized (Refs #14164)\"\n-        # Localization should be active\n-        settings.USE_L10N = True\n         activate('fr')\n         self.assertEqual(u'0,3', localize(0.3))\n "
        },
        {
            "sha": "669c04043bbbec59f4219bc929f24914a2f069d6",
            "filename": "django/contrib/staticfiles/management/commands/collectstatic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -4,7 +4,7 @@\n \n from django.core.files.storage import FileSystemStorage\n from django.core.management.base import CommandError, NoArgsCommand\n-from django.utils.encoding import smart_str, smart_unicode\n+from django.utils.encoding import smart_unicode\n from django.utils.datastructures import SortedDict\n \n from django.contrib.staticfiles import finders, storage\n@@ -178,15 +178,12 @@ def handle_noargs(self, **options):\n                                    ', %s post-processed'\n                                    % post_processed_count or ''),\n             }\n-            self.stdout.write(smart_str(summary))\n+            self.stdout.write(summary)\n \n     def log(self, msg, level=2):\n         \"\"\"\n         Small log helper\n         \"\"\"\n-        msg = smart_str(msg)\n-        if not msg.endswith(\"\\n\"):\n-            msg += \"\\n\"\n         if self.verbosity >= level:\n             self.stdout.write(msg)\n "
        },
        {
            "sha": "dc4406e4584a14021249ce25029838a970ae0dbd",
            "filename": "django/contrib/staticfiles/management/commands/findstatic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Ffindstatic.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Ffindstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Ffindstatic.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -23,9 +23,7 @@ def handle_label(self, path, **options):\n                 result = [result]\n             output = u'\\n  '.join(\n                 (smart_unicode(os.path.realpath(path)) for path in result))\n-            self.stdout.write(\n-                smart_str(u\"Found '%s' here:\\n  %s\\n\" % (path, output)))\n+            self.stdout.write(u\"Found '%s' here:\\n  %s\" % (path, output))\n         else:\n             if verbosity >= 1:\n-                self.stderr.write(\n-                    smart_str(\"No matching file found for '%s'.\\n\" % path))\n+                self.stderr.write(\"No matching file found for '%s'.\" % path)"
        },
        {
            "sha": "fd8f9efb027bb6841043bc4c6efa9862c2363f87",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -64,6 +64,17 @@ def __init__(self, *args, **kwargs):\n                 compiled = re.compile(pattern)\n                 self._patterns.setdefault(extension, []).append(compiled)\n \n+    def file_hash(self, name, content=None):\n+        \"\"\"\n+        Retuns a hash of the file with the given name and optional content.\n+        \"\"\"\n+        if content is None:\n+            return None\n+        md5 = hashlib.md5()\n+        for chunk in content.chunks():\n+            md5.update(chunk)\n+        return md5.hexdigest()[:12]\n+\n     def hashed_name(self, name, content=None):\n         parsed_name = urlsplit(unquote(name))\n         clean_name = parsed_name.path.strip()\n@@ -78,13 +89,11 @@ def hashed_name(self, name, content=None):\n                 return name\n         path, filename = os.path.split(clean_name)\n         root, ext = os.path.splitext(filename)\n-        # Get the MD5 hash of the file\n-        md5 = hashlib.md5()\n-        for chunk in content.chunks():\n-            md5.update(chunk)\n-        md5sum = md5.hexdigest()[:12]\n-        hashed_name = os.path.join(path, u\"%s.%s%s\" %\n-                                   (root, md5sum, ext))\n+        file_hash = self.file_hash(clean_name, content)\n+        if file_hash is not None:\n+            file_hash = u\".%s\" % file_hash\n+        hashed_name = os.path.join(path, u\"%s%s%s\" %\n+                                   (root, file_hash, ext))\n         unparsed_name = list(parsed_name)\n         unparsed_name[2] = hashed_name\n         # Special casing for a @font-face hack, like url(myfont.eot?#iefix\")"
        },
        {
            "sha": "3ba519188bfacbd63c0f920ce28987a4b308be7b",
            "filename": "django/core/context_processors.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcontext_processors.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -22,7 +22,7 @@ def _get_val():\n             # In order to be able to provide debugging info in the\n             # case of misconfiguration, we use a sentinel value\n             # instead of returning an empty dict.\n-            return 'NOTPROVIDED'\n+            return b'NOTPROVIDED'\n         else:\n             return token\n     _get_val = lazy(_get_val, str)"
        },
        {
            "sha": "e3d1dc9c7e17bcd1ea5552117cd06871180fa2d7",
            "filename": "django/core/exceptions.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fexceptions.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fexceptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fexceptions.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,6 +1,7 @@\n \"\"\"\n Global Django exception and warning classes.\n \"\"\"\n+from functools import reduce\n \n class DjangoRuntimeWarning(RuntimeWarning):\n     pass"
        },
        {
            "sha": "a2d703c963f120ff2871f04e7505a3ad9ca067d2",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -12,7 +12,8 @@ def __init__(self, file, name=None):\n         if name is None:\n             name = getattr(file, 'name', None)\n         self.name = name\n-        self.mode = getattr(file, 'mode', None)\n+        if hasattr(file, 'mode'):\n+            self.mode = file.mode\n \n     def __str__(self):\n         return smart_str(self.name or '')\n@@ -125,7 +126,7 @@ class ContentFile(File):\n     A File-like object that takes just raw content, rather than an actual file.\n     \"\"\"\n     def __init__(self, content, name=None):\n-        content = content or ''\n+        content = content or b''\n         super(ContentFile, self).__init__(BytesIO(content), name=name)\n         self.size = len(content)\n "
        },
        {
            "sha": "97d53482e4ccdd9799cc2a7695cde8d08192fabc",
            "filename": "django/core/files/uploadedfile.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Ffiles%2Fuploadedfile.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Ffiles%2Fuploadedfile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fuploadedfile.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -30,8 +30,8 @@ def __init__(self, file=None, name=None, content_type=None, size=None, charset=N\n         self.charset = charset\n \n     def __repr__(self):\n-        return \"<%s: %s (%s)>\" % (\n-            self.__class__.__name__, smart_str(self.name), self.content_type)\n+        return smart_str(\"<%s: %s (%s)>\" % (\n+            self.__class__.__name__, self.name, self.content_type))\n \n     def _get_name(self):\n         return self._name"
        },
        {
            "sha": "128ff7ac64fa0798272fc89c6a9ee1ad4158d392",
            "filename": "django/core/handlers/wsgi.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fwsgi.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -78,32 +78,32 @@ class LimitedStream(object):\n     def __init__(self, stream, limit, buf_size=64 * 1024 * 1024):\n         self.stream = stream\n         self.remaining = limit\n-        self.buffer = ''\n+        self.buffer = b''\n         self.buf_size = buf_size\n \n     def _read_limited(self, size=None):\n         if size is None or size > self.remaining:\n             size = self.remaining\n         if size == 0:\n-            return ''\n+            return b''\n         result = self.stream.read(size)\n         self.remaining -= len(result)\n         return result\n \n     def read(self, size=None):\n         if size is None:\n             result = self.buffer + self._read_limited()\n-            self.buffer = ''\n+            self.buffer = b''\n         elif size < len(self.buffer):\n             result = self.buffer[:size]\n             self.buffer = self.buffer[size:]\n         else: # size >= len(self.buffer)\n             result = self.buffer + self._read_limited(size - len(self.buffer))\n-            self.buffer = ''\n+            self.buffer = b''\n         return result\n \n     def readline(self, size=None):\n-        while '\\n' not in self.buffer and \\\n+        while b'\\n' not in self.buffer and \\\n               (size is None or len(self.buffer) < size):\n             if size:\n                 # since size is not None here, len(self.buffer) < size"
        },
        {
            "sha": "a204f6f0bcb894da2f971f0a0495dea0a7fe32ca",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 46,
            "deletions": 32,
            "changes": 78,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -45,6 +45,29 @@ def handle_default_options(options):\n         sys.path.insert(0, options.pythonpath)\n \n \n+class OutputWrapper(object):\n+    \"\"\"\n+    Wrapper around stdout/stderr\n+    \"\"\"\n+    def __init__(self, out, style_func=None, ending='\\n'):\n+        self._out = out\n+        self.style_func = None\n+        if hasattr(out, 'isatty') and out.isatty():\n+            self.style_func = style_func\n+        self.ending = ending\n+\n+    def __getattr__(self, name):\n+        return getattr(self._out, name)\n+\n+    def write(self, msg, style_func=None, ending=None):\n+        ending = ending is None and self.ending or ending\n+        if ending and not msg.endswith(ending):\n+            msg += ending\n+        style_func = [f for f in (style_func, self.style_func, lambda x:x)\n+                      if f is not None][0]\n+        self._out.write(smart_str(style_func(msg)))\n+\n+\n class BaseCommand(object):\n     \"\"\"\n     The base class from which all management commands ultimately\n@@ -74,8 +97,9 @@ class BaseCommand(object):\n        output and, if the command is intended to produce a block of\n        SQL statements, will be wrapped in ``BEGIN`` and ``COMMIT``.\n \n-    4. If ``handle()`` raised a ``CommandError``, ``execute()`` will\n-       instead print an error message to ``stderr``.\n+    4. If ``handle()`` or ``execute()`` raised any exception (e.g.\n+       ``CommandError``), ``run_from_argv()`` will  instead print an error\n+       message to ``stderr``.\n \n     Thus, the ``handle()`` method is typically the starting point for\n     subclasses; many built-in commands and command types either place\n@@ -187,46 +211,42 @@ def print_help(self, prog_name, subcommand):\n     def run_from_argv(self, argv):\n         \"\"\"\n         Set up any environment changes requested (e.g., Python path\n-        and Django settings), then run this command.\n-\n+        and Django settings), then run this command. If the\n+        command raises a ``CommandError``, intercept it and print it sensibly\n+        to stderr.\n         \"\"\"\n         parser = self.create_parser(argv[0], argv[1])\n         options, args = parser.parse_args(argv[2:])\n         handle_default_options(options)\n-        self.execute(*args, **options.__dict__)\n+        try:\n+            self.execute(*args, **options.__dict__)\n+        except Exception as e:\n+            if options.traceback:\n+                self.stderr.write(traceback.format_exc())\n+            self.stderr.write('%s: %s' % (e.__class__.__name__, e))\n+            sys.exit(1)\n \n     def execute(self, *args, **options):\n         \"\"\"\n         Try to execute this command, performing model validation if\n         needed (as controlled by the attribute\n-        ``self.requires_model_validation``, except if force-skipped). If the\n-        command raises a ``CommandError``, intercept it and print it sensibly\n-        to stderr.\n+        ``self.requires_model_validation``, except if force-skipped).\n         \"\"\"\n-        show_traceback = options.get('traceback', False)\n \n         # Switch to English, because django-admin.py creates database content\n         # like permissions, and those shouldn't contain any translations.\n         # But only do this if we can assume we have a working settings file,\n         # because django.utils.translation requires settings.\n         saved_lang = None\n+        self.stdout = OutputWrapper(options.get('stdout', sys.stdout))\n+        self.stderr = OutputWrapper(options.get('stderr', sys.stderr), self.style.ERROR)\n+\n         if self.can_import_settings:\n-            try:\n-                from django.utils import translation\n-                saved_lang = translation.get_language()\n-                translation.activate('en-us')\n-            except ImportError as e:\n-                # If settings should be available, but aren't,\n-                # raise the error and quit.\n-                if show_traceback:\n-                    traceback.print_exc()\n-                else:\n-                    sys.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n-                sys.exit(1)\n+            from django.utils import translation\n+            saved_lang = translation.get_language()\n+            translation.activate('en-us')\n \n         try:\n-            self.stdout = options.get('stdout', sys.stdout)\n-            self.stderr = options.get('stderr', sys.stderr)\n             if self.requires_model_validation and not options.get('skip_validation'):\n                 self.validate()\n             output = self.handle(*args, **options)\n@@ -237,16 +257,10 @@ def execute(self, *args, **options):\n                     from django.db import connections, DEFAULT_DB_ALIAS\n                     connection = connections[options.get('database', DEFAULT_DB_ALIAS)]\n                     if connection.ops.start_transaction_sql():\n-                        self.stdout.write(self.style.SQL_KEYWORD(connection.ops.start_transaction_sql()) + '\\n')\n+                        self.stdout.write(self.style.SQL_KEYWORD(connection.ops.start_transaction_sql()))\n                 self.stdout.write(output)\n                 if self.output_transaction:\n-                    self.stdout.write('\\n' + self.style.SQL_KEYWORD(\"COMMIT;\") + '\\n')\n-        except CommandError as e:\n-            if show_traceback:\n-                traceback.print_exc()\n-            else:\n-                self.stderr.write(smart_str(self.style.ERROR('Error: %s\\n' % e)))\n-            sys.exit(1)\n+                    self.stdout.write('\\n' + self.style.SQL_KEYWORD(\"COMMIT;\"))\n         finally:\n             if saved_lang is not None:\n                 translation.activate(saved_lang)\n@@ -266,7 +280,7 @@ def validate(self, app=None, display_num_errors=False):\n             error_text = s.read()\n             raise CommandError(\"One or more models did not validate:\\n%s\" % error_text)\n         if display_num_errors:\n-            self.stdout.write(\"%s error%s found\\n\" % (num_errors, num_errors != 1 and 's' or ''))\n+            self.stdout.write(\"%s error%s found\" % (num_errors, num_errors != 1 and 's' or ''))\n \n     def handle(self, *args, **options):\n         \"\"\""
        },
        {
            "sha": "fdc3535cf663c700cf7726ee9f479b2297d7d585",
            "filename": "django/core/management/commands/compilemessages.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -5,7 +5,7 @@\n from django.core.management.base import BaseCommand, CommandError\n \n def has_bom(fn):\n-    with open(fn, 'r') as f:\n+    with open(fn, 'rb') as f:\n         sample = f.read(4)\n     return sample[:3] == '\\xef\\xbb\\xbf' or \\\n             sample.startswith(codecs.BOM_UTF16_LE) or \\"
        },
        {
            "sha": "bcc47e17c80ad84ad7124137c1794d451caaac5d",
            "filename": "django/core/management/commands/createcachetable.py",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Fcreatecachetable.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Fcreatecachetable.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcreatecachetable.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,7 +1,7 @@\n from optparse import make_option\n \n from django.core.cache.backends.db import BaseDatabaseCache\n-from django.core.management.base import LabelCommand\n+from django.core.management.base import LabelCommand, CommandError\n from django.db import connections, router, transaction, models, DEFAULT_DB_ALIAS\n from django.db.utils import DatabaseError\n \n@@ -55,11 +55,10 @@ def handle_label(self, tablename, **options):\n         try:\n             curs.execute(\"\\n\".join(full_statement))\n         except DatabaseError as e:\n-            self.stderr.write(\n-                self.style.ERROR(\"Cache table '%s' could not be created.\\nThe error was: %s.\\n\" %\n-                    (tablename, e)))\n             transaction.rollback_unless_managed(using=db)\n-        else:\n-            for statement in index_output:\n-                curs.execute(statement)\n-            transaction.commit_unless_managed(using=db)\n+            raise CommandError(\n+                \"Cache table '%s' could not be created.\\nThe error was: %s.\" %\n+                    (tablename, e))\n+        for statement in index_output:\n+            curs.execute(statement)\n+        transaction.commit_unless_managed(using=db)"
        },
        {
            "sha": "9059625dec2ece045e075f9e53bd004d3687321b",
            "filename": "django/core/management/commands/dumpdata.py",
            "status": "modified",
            "additions": 16,
            "deletions": 12,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -97,20 +97,24 @@ def handle(self, *app_labels, **options):\n         except KeyError:\n             raise CommandError(\"Unknown serialization format: %s\" % format)\n \n-        # Now collate the objects to be serialized.\n-        objects = []\n-        for model in sort_dependencies(app_list.items()):\n-            if model in excluded_models:\n-                continue\n-            if not model._meta.proxy and router.allow_syncdb(using, model):\n-                if use_base_manager:\n-                    objects.extend(model._base_manager.using(using).all())\n-                else:\n-                    objects.extend(model._default_manager.using(using).all())\n+        def get_objects():\n+            # Collate the objects to be serialized.\n+            for model in sort_dependencies(app_list.items()):\n+                if model in excluded_models:\n+                    continue\n+                if not model._meta.proxy and router.allow_syncdb(using, model):\n+                    if use_base_manager:\n+                        objects = model._base_manager\n+                    else:\n+                        objects = model._default_manager\n+                    for obj in objects.using(using).\\\n+                            order_by(model._meta.pk.name).iterator():\n+                        yield obj\n \n         try:\n-            return serializers.serialize(format, objects, indent=indent,\n-                        use_natural_keys=use_natural_keys)\n+            self.stdout.ending = None\n+            serializers.serialize(format, get_objects(), indent=indent,\n+                    use_natural_keys=use_natural_keys, stream=self.stdout)\n         except Exception as e:\n             if show_traceback:\n                 raise"
        },
        {
            "sha": "a524e64f65294aa614d55f87fb448bc1064c78b3",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -26,6 +26,8 @@ def handle_noargs(self, **options):\n \n     def handle_inspection(self, options):\n         connection = connections[options.get('database')]\n+        # 'table_name_filter' is a stealth option\n+        table_name_filter = options.get('table_name_filter')\n \n         table2model = lambda table_name: table_name.title().replace('_', '').replace(' ', '').replace('-', '')\n \n@@ -43,6 +45,9 @@ def handle_inspection(self, options):\n         yield ''\n         known_models = []\n         for table_name in connection.introspection.table_names(cursor):\n+            if table_name_filter is not None and callable(table_name_filter):\n+                if not table_name_filter(table_name):\n+                    continue\n             yield 'class %s(models.Model):' % table2model(table_name)\n             known_models.append(table2model(table_name))\n             try:"
        },
        {
            "sha": "f44edf7ade20771159b2e916fc287987a5f3cf69",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 18,
            "deletions": 18,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -34,11 +34,11 @@ def handle(self, *fixture_labels, **options):\n         using = options.get('database')\n \n         connection = connections[using]\n-        self.style = no_style()\n \n         if not len(fixture_labels):\n             self.stderr.write(\n-                self.style.ERROR(\"No database fixture specified. Please provide the path of at least one fixture in the command line.\\n\")\n+                \"No database fixture specified. Please provide the path of at \"\n+                \"least one fixture in the command line.\"\n             )\n             return\n \n@@ -124,11 +124,11 @@ def read(self):\n \n                     if formats:\n                         if verbosity >= 2:\n-                            self.stdout.write(\"Loading '%s' fixtures...\\n\" % fixture_name)\n+                            self.stdout.write(\"Loading '%s' fixtures...\" % fixture_name)\n                     else:\n                         self.stderr.write(\n-                            self.style.ERROR(\"Problem installing fixture '%s': %s is not a known serialization format.\\n\" %\n-                                (fixture_name, format)))\n+                            \"Problem installing fixture '%s': %s is not a known serialization format.\" %\n+                                (fixture_name, format))\n                         if commit:\n                             transaction.rollback(using=using)\n                             transaction.leave_transaction_management(using=using)\n@@ -141,7 +141,7 @@ def read(self):\n \n                     for fixture_dir in fixture_dirs:\n                         if verbosity >= 2:\n-                            self.stdout.write(\"Checking %s for fixtures...\\n\" % humanize(fixture_dir))\n+                            self.stdout.write(\"Checking %s for fixtures...\" % humanize(fixture_dir))\n \n                         label_found = False\n                         for combo in product([using, None], formats, compression_formats):\n@@ -154,21 +154,21 @@ def read(self):\n                             )\n \n                             if verbosity >= 3:\n-                                self.stdout.write(\"Trying %s for %s fixture '%s'...\\n\" % \\\n+                                self.stdout.write(\"Trying %s for %s fixture '%s'...\" % \\\n                                     (humanize(fixture_dir), file_name, fixture_name))\n                             full_path = os.path.join(fixture_dir, file_name)\n                             open_method = compression_types[compression_format]\n                             try:\n                                 fixture = open_method(full_path, 'r')\n                             except IOError:\n                                 if verbosity >= 2:\n-                                    self.stdout.write(\"No %s fixture '%s' in %s.\\n\" % \\\n+                                    self.stdout.write(\"No %s fixture '%s' in %s.\" % \\\n                                         (format, fixture_name, humanize(fixture_dir)))\n                             else:\n                                 try:\n                                     if label_found:\n-                                        self.stderr.write(self.style.ERROR(\"Multiple fixtures named '%s' in %s. Aborting.\\n\" %\n-                                            (fixture_name, humanize(fixture_dir))))\n+                                        self.stderr.write(\"Multiple fixtures named '%s' in %s. Aborting.\" %\n+                                            (fixture_name, humanize(fixture_dir)))\n                                         if commit:\n                                             transaction.rollback(using=using)\n                                             transaction.leave_transaction_management(using=using)\n@@ -178,7 +178,7 @@ def read(self):\n                                     objects_in_fixture = 0\n                                     loaded_objects_in_fixture = 0\n                                     if verbosity >= 2:\n-                                        self.stdout.write(\"Installing %s fixture '%s' from %s.\\n\" % \\\n+                                        self.stdout.write(\"Installing %s fixture '%s' from %s.\" % \\\n                                             (format, fixture_name, humanize(fixture_dir)))\n \n                                     objects = serializers.deserialize(format, fixture, using=using)\n@@ -209,8 +209,8 @@ def read(self):\n                                 # error was encountered during fixture loading.\n                                 if objects_in_fixture == 0:\n                                     self.stderr.write(\n-                                        self.style.ERROR(\"No fixture data found for '%s'. (File format may be invalid.)\\n\" %\n-                                            (fixture_name)))\n+                                        \"No fixture data found for '%s'. (File format may be invalid.)\" %\n+                                            (fixture_name))\n                                     if commit:\n                                         transaction.rollback(using=using)\n                                         transaction.leave_transaction_management(using=using)\n@@ -231,16 +231,16 @@ def read(self):\n                 traceback.print_exc()\n             else:\n                 self.stderr.write(\n-                    self.style.ERROR(\"Problem installing fixture '%s': %s\\n\" %\n+                    \"Problem installing fixture '%s': %s\" %\n                          (full_path, ''.join(traceback.format_exception(sys.exc_type,\n-                             sys.exc_value, sys.exc_traceback)))))\n+                             sys.exc_value, sys.exc_traceback))))\n             return\n \n \n         # If we found even one object in a fixture, we need to reset the\n         # database sequences.\n         if loaded_object_count > 0:\n-            sequence_sql = connection.ops.sequence_reset_sql(self.style, models)\n+            sequence_sql = connection.ops.sequence_reset_sql(no_style(), models)\n             if sequence_sql:\n                 if verbosity >= 2:\n                     self.stdout.write(\"Resetting sequences\\n\")\n@@ -253,10 +253,10 @@ def read(self):\n \n         if verbosity >= 1:\n             if fixture_object_count == loaded_object_count:\n-                self.stdout.write(\"Installed %d object(s) from %d fixture(s)\\n\" % (\n+                self.stdout.write(\"Installed %d object(s) from %d fixture(s)\" % (\n                     loaded_object_count, fixture_count))\n             else:\n-                self.stdout.write(\"Installed %d object(s) (of %d) from %d fixture(s)\\n\" % (\n+                self.stdout.write(\"Installed %d object(s) (of %d) from %d fixture(s)\" % (\n                     loaded_object_count, fixture_object_count, fixture_count))\n \n         # Close the DB connection. This is required as a workaround for an"
        },
        {
            "sha": "c067c9c32284001058e52cf2f9e2bd67e43cb501",
            "filename": "django/core/management/commands/runserver.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -120,12 +120,12 @@ def inner_run(self, *args, **options):\n                 error_text = ERRORS[e.args[0].args[0]]\n             except (AttributeError, KeyError):\n                 error_text = str(e)\n-            sys.stderr.write(self.style.ERROR(\"Error: %s\" % error_text) + '\\n')\n+            sys.stderr.write(\"Error: %s\" % error_text)\n             # Need to use an OS exit because sys.exit doesn't work in a thread\n             os._exit(1)\n         except KeyboardInterrupt:\n             if shutdown_message:\n-                self.stdout.write(\"%s\\n\" % shutdown_message)\n+                self.stdout.write(shutdown_message)\n             sys.exit(0)\n \n "
        },
        {
            "sha": "623aa69debf087fdcfc84f4bf8c12e7ce003388b",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -16,7 +16,6 @@\n import django\n from django.template import Template, Context\n from django.utils import archive\n-from django.utils.encoding import smart_str\n from django.utils._os import rmtree_errorhandler\n from django.core.management.base import BaseCommand, CommandError\n from django.core.management.commands.makemessages import handle_extensions\n@@ -166,11 +165,10 @@ def handle(self, app_or_project, name, target=None, **options):\n                     shutil.copymode(old_path, new_path)\n                     self.make_writeable(new_path)\n                 except OSError:\n-                    notice = self.style.NOTICE(\n+                    self.stderr.write(\n                         \"Notice: Couldn't set permission bits on %s. You're \"\n                         \"probably using an uncommon filesystem setup. No \"\n-                        \"problem.\\n\" % new_path)\n-                    sys.stderr.write(smart_str(notice))\n+                        \"problem.\" % new_path, self.style.NOTICE)\n \n         if self.paths_to_remove:\n             if self.verbosity >= 2:"
        },
        {
            "sha": "04053c1f8fa8ac6e12ebefa1e7a9354bd874d597",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -39,6 +39,7 @@ def serialize(self, queryset, **options):\n         self.use_natural_keys = options.pop(\"use_natural_keys\", False)\n \n         self.start_serialization()\n+        self.first = True\n         for obj in queryset:\n             self.start_object(obj)\n             # Use the concrete parent class' _meta instead of the object's _meta\n@@ -57,6 +58,8 @@ def serialize(self, queryset, **options):\n                     if self.selected_fields is None or field.attname in self.selected_fields:\n                         self.handle_m2m_field(obj, field)\n             self.end_object(obj)\n+            if self.first:\n+                self.first = False\n         self.end_serialization()\n         return self.getvalue()\n "
        },
        {
            "sha": "fce00600f4a802ddc3aca6c2086321175d3de0f8",
            "filename": "django/core/serializers/json.py",
            "status": "modified",
            "additions": 27,
            "deletions": 2,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fserializers%2Fjson.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fserializers%2Fjson.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fjson.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -21,13 +21,38 @@ class Serializer(PythonSerializer):\n     \"\"\"\n     internal_use_only = False\n \n-    def end_serialization(self):\n+    def start_serialization(self):\n         if json.__version__.split('.') >= ['2', '1', '3']:\n             # Use JS strings to represent Python Decimal instances (ticket #16850)\n             self.options.update({'use_decimal': False})\n-        json.dump(self.objects, self.stream, cls=DjangoJSONEncoder, **self.options)\n+        self._current = None\n+        self.json_kwargs = self.options.copy()\n+        self.json_kwargs.pop('stream', None)\n+        self.json_kwargs.pop('fields', None)\n+        self.stream.write(\"[\")\n+\n+    def end_serialization(self):\n+        if self.options.get(\"indent\"):\n+            self.stream.write(\"\\n\")\n+        self.stream.write(\"]\")\n+        if self.options.get(\"indent\"):\n+            self.stream.write(\"\\n\")\n+\n+    def end_object(self, obj):\n+        # self._current has the field data\n+        indent = self.options.get(\"indent\")\n+        if not self.first:\n+            self.stream.write(\",\")\n+            if not indent:\n+                self.stream.write(\" \")\n+        if indent:\n+            self.stream.write(\"\\n\")\n+        json.dump(self.get_dump_object(obj), self.stream,\n+                  cls=DjangoJSONEncoder, **self.json_kwargs)\n+        self._current = None\n \n     def getvalue(self):\n+        # overwrite PythonSerializer.getvalue() with base Serializer.getvalue()\n         if callable(getattr(self.stream, 'getvalue', None)):\n             return self.stream.getvalue()\n "
        },
        {
            "sha": "49120434ebe8d8aa73ff283daa3a311c9a99b94b",
            "filename": "django/core/serializers/python.py",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fserializers%2Fpython.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fserializers%2Fpython.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpython.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -27,13 +27,16 @@ def start_object(self, obj):\n         self._current = {}\n \n     def end_object(self, obj):\n-        self.objects.append({\n-            \"model\"  : smart_unicode(obj._meta),\n-            \"pk\"     : smart_unicode(obj._get_pk_val(), strings_only=True),\n-            \"fields\" : self._current\n-        })\n+        self.objects.append(self.get_dump_object(obj))\n         self._current = None\n \n+    def get_dump_object(self, obj):\n+        return {\n+            \"pk\": smart_unicode(obj._get_pk_val(), strings_only=True),\n+            \"model\": smart_unicode(obj._meta),\n+            \"fields\": self._current\n+        }\n+\n     def handle_field(self, obj, field):\n         value = field._get_val_from_obj(obj)\n         # Protected types (i.e., primitives like None, numbers, dates,"
        },
        {
            "sha": "be2962d660f6a82f42af9e3c59622233e0d9248f",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 12,
            "deletions": 14,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -146,25 +146,23 @@ def get_environ(self):\n         env['PATH_INFO'] = urllib.unquote(path)\n         env['QUERY_STRING'] = query\n         env['REMOTE_ADDR'] = self.client_address[0]\n+        env['CONTENT_TYPE'] = self.headers.get('content-type', 'text/plain')\n \n-        if self.headers.typeheader is None:\n-            env['CONTENT_TYPE'] = self.headers.type\n-        else:\n-            env['CONTENT_TYPE'] = self.headers.typeheader\n-\n-        length = self.headers.getheader('content-length')\n+        length = self.headers.get('content-length')\n         if length:\n             env['CONTENT_LENGTH'] = length\n \n-        for h in self.headers.headers:\n-            k,v = h.split(':',1)\n-            k=k.replace('-','_').upper(); v=v.strip()\n-            if k in env:\n-                continue                    # skip content length, type,etc.\n-            if 'HTTP_'+k in env:\n-                env['HTTP_'+k] += ','+v     # comma-separate multiple headers\n+        for key, value in self.headers.items():\n+            key = key.replace('-','_').upper()\n+            value = value.strip()\n+            if key in env:\n+                # Skip content length, type, etc.\n+                continue\n+            if 'HTTP_' + key in env:\n+                # Comma-separate multiple headers\n+                env['HTTP_' + key] += ',' + value\n             else:\n-                env['HTTP_'+k] = v\n+                env['HTTP_' + key] = value\n         return env\n \n     def log_message(self, format, *args):"
        },
        {
            "sha": "78ce00511ce3f9b24e306723414d67ed6677ce15",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -306,10 +306,8 @@ def resolve(self, path):\n                         tried.append([pattern])\n                 else:\n                     if sub_match:\n-                        sub_match_dict = dict([(smart_str(k), v) for k, v in match.groupdict().items()])\n-                        sub_match_dict.update(self.default_kwargs)\n-                        for k, v in sub_match.kwargs.iteritems():\n-                            sub_match_dict[smart_str(k)] = v\n+                        sub_match_dict = dict(match.groupdict(), **self.default_kwargs)\n+                        sub_match_dict.update(sub_match.kwargs)\n                         return ResolverMatch(sub_match.func, sub_match.args, sub_match_dict, sub_match.url_name, self.app_name or sub_match.app_name, [self.namespace] + sub_match.namespaces)\n                     tried.append([pattern])\n             raise Resolver404({'tried': tried, 'path': new_path})"
        },
        {
            "sha": "f26653f7b44996def9943f5ff8ef4396c1e2ed3e",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -399,6 +399,9 @@ class BaseDatabaseFeatures(object):\n     # in the SQL standard.\n     supports_tablespaces = False\n \n+    # Does the backend reset sequences between tests?\n+    supports_sequence_reset = True\n+\n     # Features that need to be confirmed at runtime\n     # Cache whether the confirmation has been performed.\n     _confirmed = False\n@@ -414,10 +417,11 @@ def __init__(self, connection):\n \n     def confirm(self):\n         \"Perform manual checks of any database features that might vary between installs\"\n-        self._confirmed = True\n-        self.supports_transactions = self._supports_transactions()\n-        self.supports_stddev = self._supports_stddev()\n-        self.can_introspect_foreign_keys = self._can_introspect_foreign_keys()\n+        if not self._confirmed:\n+            self._confirmed = True\n+            self.supports_transactions = self._supports_transactions()\n+            self.supports_stddev = self._supports_stddev()\n+            self.can_introspect_foreign_keys = self._can_introspect_foreign_keys()\n \n     def _supports_transactions(self):\n         \"Confirm support for transactions\"\n@@ -439,8 +443,9 @@ class StdDevPop(object):\n \n         try:\n             self.connection.ops.check_aggregate_support(StdDevPop())\n+            return True\n         except NotImplementedError:\n-            self.supports_stddev = False\n+            return False\n \n     def _can_introspect_foreign_keys(self):\n         \"Confirm support for introspected foreign keys\""
        },
        {
            "sha": "1df487bd92816b4408de3563f4bb98ad47ddd538",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -418,11 +418,20 @@ def _rollback(self):\n     @cached_property\n     def mysql_version(self):\n         if not self.server_version:\n+            new_connection = False\n             if not self._valid_connection():\n+                # Ensure we have a connection with the DB by using a temporary\n+                # cursor\n+                new_connection = True\n                 self.cursor().close()\n-            m = server_version_re.match(self.connection.get_server_info())\n+            server_info = self.connection.get_server_info()\n+            if new_connection:\n+                # Make sure we close the connection\n+                self.connection.close()\n+                self.connection = None\n+            m = server_version_re.match(server_info)\n             if not m:\n-                raise Exception('Unable to determine MySQL version from version string %r' % self.connection.get_server_info())\n+                raise Exception('Unable to determine MySQL version from version string %r' % server_info)\n             self.server_version = tuple([int(x) for x in m.groups()])\n         return self.server_version\n "
        },
        {
            "sha": "fe512dfee5791f30579f1b0aa6ae0ef3e353caa2",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -83,6 +83,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     ignores_nulls_in_unique_constraints = False\n     has_bulk_insert = True\n     supports_tablespaces = True\n+    supports_sequence_reset = False\n \n class DatabaseOperations(BaseDatabaseOperations):\n     compiler_module = \"django.db.backends.oracle.compiler\""
        },
        {
            "sha": "4fba304e23786442d5ae6217b8dc8fef22dbe545",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -51,15 +51,15 @@ def adapt_datetime_with_timezone_support(value):\n             default_timezone = timezone.get_default_timezone()\n             value = timezone.make_aware(value, default_timezone)\n         value = value.astimezone(timezone.utc).replace(tzinfo=None)\n-    return value.isoformat(\" \")\n-\n-Database.register_converter(\"bool\", lambda s: str(s) == '1')\n-Database.register_converter(\"time\", parse_time)\n-Database.register_converter(\"date\", parse_date)\n-Database.register_converter(\"datetime\", parse_datetime_with_timezone_support)\n-Database.register_converter(\"timestamp\", parse_datetime_with_timezone_support)\n-Database.register_converter(\"TIMESTAMP\", parse_datetime_with_timezone_support)\n-Database.register_converter(\"decimal\", util.typecast_decimal)\n+    return value.isoformat(b\" \")\n+\n+Database.register_converter(b\"bool\", lambda s: str(s) == '1')\n+Database.register_converter(b\"time\", parse_time)\n+Database.register_converter(b\"date\", parse_date)\n+Database.register_converter(b\"datetime\", parse_datetime_with_timezone_support)\n+Database.register_converter(b\"timestamp\", parse_datetime_with_timezone_support)\n+Database.register_converter(b\"TIMESTAMP\", parse_datetime_with_timezone_support)\n+Database.register_converter(b\"decimal\", util.typecast_decimal)\n Database.register_adapter(datetime.datetime, adapt_datetime_with_timezone_support)\n Database.register_adapter(decimal.Decimal, util.rev_typecast_decimal)\n if Database.version_info >= (2, 4, 1):"
        },
        {
            "sha": "13238fc9dcfc33a36cd090da08e9394889722266",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -57,11 +57,11 @@ def __new__(cls, name, bases, attrs):\n \n         new_class.add_to_class('_meta', Options(meta, **kwargs))\n         if not abstract:\n-            new_class.add_to_class('DoesNotExist', subclass_exception('DoesNotExist',\n+            new_class.add_to_class('DoesNotExist', subclass_exception(b'DoesNotExist',\n                     tuple(x.DoesNotExist\n                             for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n                                     or (ObjectDoesNotExist,), module))\n-            new_class.add_to_class('MultipleObjectsReturned', subclass_exception('MultipleObjectsReturned',\n+            new_class.add_to_class('MultipleObjectsReturned', subclass_exception(b'MultipleObjectsReturned',\n                     tuple(x.MultipleObjectsReturned\n                             for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n                                     or (MultipleObjectsReturned,), module))\n@@ -404,20 +404,14 @@ def __reduce__(self):\n         # and as a result, the super call will cause an infinite recursion.\n         # See #10547 and #12121.\n         defers = []\n-        pk_val = None\n         if self._deferred:\n             from django.db.models.query_utils import deferred_class_factory\n             factory = deferred_class_factory\n             for field in self._meta.fields:\n                 if isinstance(self.__class__.__dict__.get(field.attname),\n                         DeferredAttribute):\n                     defers.append(field.attname)\n-                    if pk_val is None:\n-                        # The pk_val and model values are the same for all\n-                        # DeferredAttribute classes, so we only need to do this\n-                        # once.\n-                        obj = self.__class__.__dict__[field.attname]\n-                        model = obj.model_ref()\n+            model = self._meta.proxy_for_model\n         else:\n             factory = simple_class_factory\n         return (model_unpickle, (model, defers, factory), data)"
        },
        {
            "sha": "d572cce28f847fd2596a9f11066178bf7f0bd502",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 15,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,3 +1,4 @@\n+import collections\n import copy\n import datetime\n import decimal\n@@ -16,7 +17,7 @@\n from django.utils.text import capfirst\n from django.utils import timezone\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode, force_unicode, smart_str\n+from django.utils.encoding import smart_unicode, force_unicode\n from django.utils.ipv6 import clean_ipv6_address\n \n class NOT_PROVIDED:\n@@ -436,7 +437,7 @@ def bind(self, fieldmapping, original, bound_field_class):\n         return bound_field_class(self, fieldmapping, original)\n \n     def _get_choices(self):\n-        if hasattr(self._choices, 'next'):\n+        if isinstance(self._choices, collections.Iterator):\n             choices, self._choices = tee(self._choices)\n             return choices\n         else:\n@@ -529,7 +530,7 @@ def to_python(self, value):\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def validate(self, value, model_instance):\n@@ -581,7 +582,7 @@ def to_python(self, value):\n             return True\n         if value in ('f', 'False', '0'):\n             return False\n-        msg = self.error_messages['invalid'] % str(value)\n+        msg = self.error_messages['invalid'] % value\n         raise exceptions.ValidationError(msg)\n \n     def get_prep_lookup(self, lookup_type, value):\n@@ -677,16 +678,14 @@ def to_python(self, value):\n             return value\n         if isinstance(value, datetime.datetime):\n             if settings.USE_TZ and timezone.is_aware(value):\n-                # Convert aware datetimes to the current time zone\n+                # Convert aware datetimes to the default time zone\n                 # before casting them to dates (#17742).\n                 default_timezone = timezone.get_default_timezone()\n                 value = timezone.make_naive(value, default_timezone)\n             return value.date()\n         if isinstance(value, datetime.date):\n             return value\n \n-        value = smart_str(value)\n-\n         try:\n             parsed = parse_date(value)\n             if parsed is not None:\n@@ -778,8 +777,6 @@ def to_python(self, value):\n                 value = timezone.make_aware(value, default_timezone)\n             return value\n \n-        value = smart_str(value)\n-\n         try:\n             parsed = parse_datetime(value)\n             if parsed is not None:\n@@ -861,7 +858,7 @@ def to_python(self, value):\n         try:\n             return decimal.Decimal(value)\n         except decimal.InvalidOperation:\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def _format(self, value):\n@@ -966,7 +963,7 @@ def to_python(self, value):\n         try:\n             return float(value)\n         except (TypeError, ValueError):\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def formfield(self, **kwargs):\n@@ -1001,7 +998,7 @@ def to_python(self, value):\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n-            msg = self.error_messages['invalid'] % str(value)\n+            msg = self.error_messages['invalid'] % value\n             raise exceptions.ValidationError(msg)\n \n     def formfield(self, **kwargs):\n@@ -1106,7 +1103,7 @@ def to_python(self, value):\n             return True\n         if value in ('f', 'False', '0'):\n             return False\n-        msg = self.error_messages['invalid'] % str(value)\n+        msg = self.error_messages['invalid'] % value\n         raise exceptions.ValidationError(msg)\n \n     def get_prep_lookup(self, lookup_type, value):\n@@ -1227,8 +1224,6 @@ def to_python(self, value):\n             # database backend (e.g. Oracle), so we'll be accommodating.\n             return value.time()\n \n-        value = smart_str(value)\n-\n         try:\n             parsed = parse_time(value)\n             if parsed is not None:"
        },
        {
            "sha": "34cf84dbc0a7fa0acd0c412ada25cb91b40a7562",
            "filename": "django/db/models/fields/files.py",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -3,6 +3,7 @@\n \n from django import forms\n from django.db.models.fields import Field\n+from django.core.exceptions import ValidationError\n from django.core.files.base import File\n from django.core.files.storage import default_storage\n from django.core.files.images import ImageFile\n@@ -204,6 +205,11 @@ def __set__(self, instance, value):\n         instance.__dict__[self.field.name] = value\n \n class FileField(Field):\n+\n+    default_error_messages = {\n+        'max_length': _(u'Filename is %(extra)d characters too long.')\n+    }\n+\n     # The class to wrap instance attributes in. Accessing the file object off\n     # the instance will always return an instance of attr_class.\n     attr_class = FieldFile\n@@ -226,6 +232,21 @@ def __init__(self, verbose_name=None, name=None, upload_to='', storage=None, **k\n         kwargs['max_length'] = kwargs.get('max_length', 100)\n         super(FileField, self).__init__(verbose_name, name, **kwargs)\n \n+    def validate(self, value, model_instance):\n+        \"\"\"\n+        Validates that the generated file name still fits within max_length.\n+        \"\"\"\n+        # The generated file name stored in the database is generally longer\n+        # than the uploaded file name. Using the length of generated name in\n+        # the error message would be confusing. However, in the common case\n+        # (ie. upload_to='path/to/upload/dir'), the length of the generated\n+        # name equals the length of the uploaded name plus a constant. Thus\n+        # we can tell the user how much shorter the name should be (roughly).\n+        length = len(self.generate_filename(model_instance, value.name))\n+        if self.max_length and length > self.max_length:\n+            error_values = {'extra': length - self.max_length}\n+            raise ValidationError(self.error_messages['max_length'] % error_values)\n+\n     def get_internal_type(self):\n         return \"FileField\"\n "
        },
        {
            "sha": "c4f95a12d24691a6f06fb3f9b1451568cd435052",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 40,
            "deletions": 23,
            "changes": 63,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -237,13 +237,18 @@ def get_query_set(self, **db_hints):\n         return self.related.model._base_manager.using(db)\n \n     def get_prefetch_query_set(self, instances):\n-        vals = set(instance._get_pk_val() for instance in instances)\n-        params = {'%s__pk__in' % self.related.field.name: vals}\n-        return (self.get_query_set(instance=instances[0]).filter(**params),\n-                attrgetter(self.related.field.attname),\n-                lambda obj: obj._get_pk_val(),\n-                True,\n-                self.cache_name)\n+        rel_obj_attr = attrgetter(self.related.field.attname)\n+        instance_attr = lambda obj: obj._get_pk_val()\n+        instances_dict = dict((instance_attr(inst), inst) for inst in instances)\n+        params = {'%s__pk__in' % self.related.field.name: instances_dict.keys()}\n+        qs = self.get_query_set(instance=instances[0]).filter(**params)\n+        # Since we're going to assign directly in the cache,\n+        # we must manage the reverse relation cache manually.\n+        rel_obj_cache_name = self.related.field.get_cache_name()\n+        for rel_obj in qs:\n+            instance = instances_dict[rel_obj_attr(rel_obj)]\n+            setattr(rel_obj, rel_obj_cache_name, instance)\n+        return qs, rel_obj_attr, instance_attr, True, self.cache_name\n \n     def __get__(self, instance, instance_type=None):\n         if instance is None:\n@@ -324,17 +329,23 @@ def get_query_set(self, **db_hints):\n             return QuerySet(self.field.rel.to).using(db)\n \n     def get_prefetch_query_set(self, instances):\n-        vals = set(getattr(instance, self.field.attname) for instance in instances)\n+        rel_obj_attr = attrgetter(self.field.rel.field_name)\n+        instance_attr = attrgetter(self.field.attname)\n+        instances_dict = dict((instance_attr(inst), inst) for inst in instances)\n         other_field = self.field.rel.get_related_field()\n         if other_field.rel:\n-            params = {'%s__pk__in' % self.field.rel.field_name: vals}\n+            params = {'%s__pk__in' % self.field.rel.field_name: instances_dict.keys()}\n         else:\n-            params = {'%s__in' % self.field.rel.field_name: vals}\n-        return (self.get_query_set(instance=instances[0]).filter(**params),\n-                attrgetter(self.field.rel.field_name),\n-                attrgetter(self.field.attname),\n-                True,\n-                self.cache_name)\n+            params = {'%s__in' % self.field.rel.field_name: instances_dict.keys()}\n+        qs = self.get_query_set(instance=instances[0]).filter(**params)\n+        # Since we're going to assign directly in the cache,\n+        # we must manage the reverse relation cache manually.\n+        if not self.field.rel.multiple:\n+            rel_obj_cache_name = self.field.related.get_cache_name()\n+            for rel_obj in qs:\n+                instance = instances_dict[rel_obj_attr(rel_obj)]\n+                setattr(rel_obj, rel_obj_cache_name, instance)\n+        return qs, rel_obj_attr, instance_attr, True, self.cache_name\n \n     def __get__(self, instance, instance_type=None):\n         if instance is None:\n@@ -467,18 +478,24 @@ def get_query_set(self):\n                     return self.instance._prefetched_objects_cache[rel_field.related_query_name()]\n                 except (AttributeError, KeyError):\n                     db = self._db or router.db_for_read(self.model, instance=self.instance)\n-                    return super(RelatedManager, self).get_query_set().using(db).filter(**self.core_filters)\n+                    qs = super(RelatedManager, self).get_query_set().using(db).filter(**self.core_filters)\n+                    qs._known_related_object = (rel_field.name, self.instance)\n+                    return qs\n \n             def get_prefetch_query_set(self, instances):\n+                rel_obj_attr = attrgetter(rel_field.get_attname())\n+                instance_attr = attrgetter(attname)\n+                instances_dict = dict((instance_attr(inst), inst) for inst in instances)\n                 db = self._db or router.db_for_read(self.model, instance=instances[0])\n-                query = {'%s__%s__in' % (rel_field.name, attname):\n-                             set(getattr(obj, attname) for obj in instances)}\n+                query = {'%s__%s__in' % (rel_field.name, attname): instances_dict.keys()}\n                 qs = super(RelatedManager, self).get_query_set().using(db).filter(**query)\n-                return (qs,\n-                        attrgetter(rel_field.get_attname()),\n-                        attrgetter(attname),\n-                        False,\n-                        rel_field.related_query_name())\n+                # Since we just bypassed this class' get_query_set(), we must manage\n+                # the reverse relation manually.\n+                for rel_obj in qs:\n+                    instance = instances_dict[rel_obj_attr(rel_obj)]\n+                    setattr(rel_obj, rel_field.name, instance)\n+                cache_name = rel_field.related_query_name()\n+                return qs, rel_obj_attr, instance_attr, False, cache_name\n \n             def add(self, *objs):\n                 for obj in objs:"
        },
        {
            "sha": "755820c3b0bad4111f85c770e879a8b67a22bd9b",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 13,
            "deletions": 8,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -41,6 +41,7 @@ def __init__(self, model=None, query=None, using=None):\n         self._for_write = False\n         self._prefetch_related_lookups = []\n         self._prefetch_done = False\n+        self._known_related_object = None       # (attname, rel_obj)\n \n     ########################\n     # PYTHON MAGIC METHODS #\n@@ -282,9 +283,10 @@ def iterator(self):\n                     init_list.append(field.attname)\n             model_cls = deferred_class_factory(self.model, skip)\n \n-        # Cache db and model outside the loop\n+        # Cache db, model and known_related_object outside the loop\n         db = self.db\n         model = self.model\n+        kro_attname, kro_instance = self._known_related_object or (None, None)\n         compiler = self.query.get_compiler(using=db)\n         if fill_cache:\n             klass_info = get_klass_info(model, max_depth=max_depth,\n@@ -294,12 +296,12 @@ def iterator(self):\n                 obj, _ = get_cached_row(row, index_start, db, klass_info,\n                                         offset=len(aggregate_select))\n             else:\n+                # Omit aggregates in object creation.\n+                row_data = row[index_start:aggregate_start]\n                 if skip:\n-                    row_data = row[index_start:aggregate_start]\n                     obj = model_cls(**dict(zip(init_list, row_data)))\n                 else:\n-                    # Omit aggregates in object creation.\n-                    obj = model(*row[index_start:aggregate_start])\n+                    obj = model(*row_data)\n \n                 # Store the source database of the object\n                 obj._state.db = db\n@@ -313,7 +315,11 @@ def iterator(self):\n             # Add the aggregates to the model\n             if aggregate_select:\n                 for i, aggregate in enumerate(aggregate_select):\n-                    setattr(obj, aggregate, row[i+aggregate_start])\n+                    setattr(obj, aggregate, row[i + aggregate_start])\n+\n+            # Add the known related object to the model, if there is one\n+            if kro_instance:\n+                setattr(obj, kro_attname, kro_instance)\n \n             yield obj\n \n@@ -864,6 +870,7 @@ def _clone(self, klass=None, setup=False, **kwargs):\n         c = klass(model=self.model, query=query, using=self._db)\n         c._for_write = self._for_write\n         c._prefetch_related_lookups = self._prefetch_related_lookups[:]\n+        c._known_related_object = self._known_related_object\n         c.__dict__.update(kwargs)\n         if setup and hasattr(c, '_setup_query'):\n             c._setup_query()\n@@ -1781,9 +1788,7 @@ def prefetch_one_level(instances, prefetcher, attname):\n     rel_obj_cache = {}\n     for rel_obj in all_related_objects:\n         rel_attr_val = rel_obj_attr(rel_obj)\n-        if rel_attr_val not in rel_obj_cache:\n-            rel_obj_cache[rel_attr_val] = []\n-        rel_obj_cache[rel_attr_val].append(rel_obj)\n+        rel_obj_cache.setdefault(rel_attr_val, []).append(rel_obj)\n \n     for obj in instances:\n         instance_attr_val = instance_attr(obj)"
        },
        {
            "sha": "5676fdce9a7deb0998fccfb6ad1d9ba0f6e9ddbd",
            "filename": "django/db/models/query_utils.py",
            "status": "modified",
            "additions": 32,
            "deletions": 17,
            "changes": 49,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fquery_utils.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fquery_utils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery_utils.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -6,8 +6,6 @@\n circular import difficulties.\n \"\"\"\n \n-import weakref\n-\n from django.db.backends import util\n from django.utils import tree\n \n@@ -70,36 +68,39 @@ class DeferredAttribute(object):\n     \"\"\"\n     def __init__(self, field_name, model):\n         self.field_name = field_name\n-        self.model_ref = weakref.ref(model)\n-        self.loaded = False\n \n     def __get__(self, instance, owner):\n         \"\"\"\n         Retrieves and caches the value from the datastore on the first lookup.\n         Returns the cached value.\n         \"\"\"\n         from django.db.models.fields import FieldDoesNotExist\n+        non_deferred_model = instance._meta.proxy_for_model\n+        opts = non_deferred_model._meta\n \n         assert instance is not None\n-        cls = self.model_ref()\n         data = instance.__dict__\n         if data.get(self.field_name, self) is self:\n             # self.field_name is the attname of the field, but only() takes the\n             # actual name, so we need to translate it here.\n             try:\n-                cls._meta.get_field_by_name(self.field_name)\n-                name = self.field_name\n+                f = opts.get_field_by_name(self.field_name)[0]\n             except FieldDoesNotExist:\n-                name = [f.name for f in cls._meta.fields\n-                    if f.attname == self.field_name][0]\n-            # We use only() instead of values() here because we want the\n-            # various data coersion methods (to_python(), etc.) to be called\n-            # here.\n-            val = getattr(\n-                cls._base_manager.filter(pk=instance.pk).only(name).using(\n-                    instance._state.db).get(),\n-                self.field_name\n-            )\n+                f = [f for f in opts.fields\n+                     if f.attname == self.field_name][0]\n+            name = f.name\n+            # Lets see if the field is part of the parent chain. If so we\n+            # might be able to reuse the already loaded value. Refs #18343.\n+            val = self._check_parent_chain(instance, name)\n+            if val is None:\n+                # We use only() instead of values() here because we want the\n+                # various data coersion methods (to_python(), etc.) to be\n+                # called here.\n+                val = getattr(\n+                    non_deferred_model._base_manager.only(name).using(\n+                        instance._state.db).get(pk=instance.pk),\n+                    self.field_name\n+                )\n             data[self.field_name] = val\n         return data[self.field_name]\n \n@@ -110,6 +111,20 @@ def __set__(self, instance, value):\n         \"\"\"\n         instance.__dict__[self.field_name] = value\n \n+    def _check_parent_chain(self, instance, name):\n+        \"\"\"\n+        Check if the field value can be fetched from a parent field already \n+        loaded in the instance. This can be done if the to-be fetched\n+        field is a primary key field.\n+        \"\"\"\n+        opts = instance._meta\n+        f = opts.get_field_by_name(name)[0]\n+        link_field = opts.get_ancestor_link(f.model)\n+        if f.primary_key and f != link_field:\n+            return getattr(instance, link_field.attname)\n+        return None\n+\n+\n def select_related_descend(field, restricted, requested, reverse=False):\n     \"\"\"\n     Returns True if this field should be used to descend deeper for"
        },
        {
            "sha": "5801b2f42804732703ad2fcbd183d98b8431fd75",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -455,6 +455,9 @@ def _setup_joins(self, pieces, opts, alias):\n             alias = self.query.get_initial_alias()\n         field, target, opts, joins, _, _ = self.query.setup_joins(pieces,\n                 opts, alias, False)\n+        # We will later on need to promote those joins that were added to the\n+        # query afresh above.\n+        joins_to_promote = [j for j in joins if self.query.alias_refcount[j] < 2]\n         alias = joins[-1]\n         col = target.column\n         if not field.rel:\n@@ -466,8 +469,9 @@ def _setup_joins(self, pieces, opts, alias):\n         # Must use left outer joins for nullable fields and their relations.\n         # Ordering or distinct must not affect the returned set, and INNER\n         # JOINS for nullable fields could do this.\n-        self.query.promote_alias_chain(joins,\n-            self.query.alias_map[joins[0]].join_type == self.query.LOUTER)\n+        if joins_to_promote:\n+            self.query.promote_alias_chain(joins_to_promote,\n+                self.query.alias_map[joins_to_promote[0]].join_type == self.query.LOUTER)\n         return field, col, alias, joins, opts\n \n     def _final_join_removal(self, col, alias):\n@@ -1015,6 +1019,12 @@ def pre_sql_setup(self):\n         query.extra = {}\n         query.select = []\n         query.add_fields([query.model._meta.pk.name])\n+        # Recheck the count - it is possible that fiddling with the select\n+        # fields above removes tables from the query. Refs #18304.\n+        count = query.count_active_tables()\n+        if not self.query.related_updates and count == 1:\n+            return\n+\n         must_pre_select = count > 1 and not self.connection.features.update_can_self_select\n \n         # Now we adjust the current query: reset the where clause and get rid"
        },
        {
            "sha": "5515bc4f839009f73628efeb5351b835d0bf3fc9",
            "filename": "django/db/models/sql/where.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -4,6 +4,7 @@\n \n from __future__ import absolute_import\n \n+import collections\n import datetime\n from itertools import repeat\n \n@@ -49,7 +50,7 @@ def add(self, data, connector):\n             return\n \n         obj, lookup_type, value = data\n-        if hasattr(value, '__iter__') and hasattr(value, 'next'):\n+        if isinstance(value, collections.Iterator):\n             # Consume any generators immediately, so that we can determine\n             # emptiness and transform any non-empty values correctly.\n             value = list(value)"
        },
        {
            "sha": "2a2c8739fb7fd204bd3a4f9bd1dca7a0db8c9e21",
            "filename": "django/dispatch/saferef.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdispatch%2Fsaferef.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fdispatch%2Fsaferef.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fsaferef.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -155,12 +155,12 @@ def __str__(self):\n     def __nonzero__( self ):\n         \"\"\"Whether we are still a valid reference\"\"\"\n         return self() is not None\n-    \n-    def __cmp__( self, other ):\n+\n+    def __eq__(self, other):\n         \"\"\"Compare with another reference\"\"\"\n-        if not isinstance (other,self.__class__):\n-            return cmp( self.__class__, type(other) )\n-        return cmp( self.key, other.key)\n+        if not isinstance(other, self.__class__):\n+            return self.__class__ == type(other)\n+        return self.key == other.key\n     \n     def __call__(self):\n         \"\"\"Return a strong reference to the bound method"
        },
        {
            "sha": "3811510326ba81847d74eee12d2c27d05c5ee9b7",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -446,7 +446,7 @@ def _get_regex(self):\n \n     def _set_regex(self, regex):\n         if isinstance(regex, basestring):\n-            regex = re.compile(regex)\n+            regex = re.compile(regex, re.UNICODE)\n         self._regex = regex\n         if hasattr(self, '_regex_validator') and self._regex_validator in self.validators:\n             self.validators.remove(self._regex_validator)\n@@ -932,12 +932,16 @@ def __init__(self, path, match=None, recursive=False, allow_files=True,\n                             self.choices.append((f, f.replace(path, \"\", 1)))\n                 if self.allow_folders:\n                     for f in dirs:\n+                        if f == '__pycache__':\n+                            continue\n                         if self.match is None or self.match_re.search(f):\n                             f = os.path.join(root, f)\n                             self.choices.append((f, f.replace(path, \"\", 1)))\n         else:\n             try:\n                 for f in sorted(os.listdir(self.path)):\n+                    if f == '__pycache__':\n+                        continue\n                     full_file = os.path.join(self.path, f)\n                     if (((self.allow_files and os.path.isfile(full_file)) or\n                         (self.allow_folders and os.path.isdir(full_file))) and"
        },
        {
            "sha": "5fcf9590eb6c586b6c0c8fcdebf2bf6086088b6b",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -388,10 +388,10 @@ def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n     parent = (object,)\n     if hasattr(form, 'Meta'):\n         parent = (form.Meta, object)\n-    Meta = type('Meta', parent, attrs)\n+    Meta = type(b'Meta', parent, attrs)\n \n     # Give this new form class a reasonable name.\n-    class_name = model.__name__ + 'Form'\n+    class_name = model.__name__ + b'Form'\n \n     # Class attributes for the new form class.\n     form_class_attrs = {"
        },
        {
            "sha": "bf848deb388a856eabbe7dc7b04d2ed38acae083",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -18,7 +18,7 @@\n # See ticket #13007, http://bugs.python.org/issue2193 and http://trac.edgewall.org/ticket/2256\n _tc = Cookie.SimpleCookie()\n try:\n-    _tc.load('foo:bar=1')\n+    _tc.load(b'foo:bar=1')\n     _cookie_allows_colon_in_names = True\n except Cookie.CookieError:\n     _cookie_allows_colon_in_names = False\n@@ -650,8 +650,8 @@ def delete_cookie(self, key, path='/', domain=None):\n \n     def _get_content(self):\n         if self.has_header('Content-Encoding'):\n-            return ''.join([str(e) for e in self._container])\n-        return ''.join([smart_str(e, self._charset) for e in self._container])\n+            return b''.join([str(e) for e in self._container])\n+        return b''.join([smart_str(e, self._charset) for e in self._container])\n \n     def _set_content(self, value):\n         if hasattr(value, '__iter__'):"
        },
        {
            "sha": "162c08e38d062bb5dc138b7829ed6067f867cf5e",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 19,
            "deletions": 19,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -268,7 +268,7 @@ def __init__(self, producer, length=None):\n         \"\"\"\n         self._producer = producer\n         self._empty = False\n-        self._leftover = ''\n+        self._leftover = b''\n         self.length = length\n         self.position = 0\n         self._remaining = length\n@@ -282,7 +282,7 @@ def parts():\n             remaining = (size is not None and [size] or [self._remaining])[0]\n             # do the whole thing in one shot if no limit was provided.\n             if remaining is None:\n-                yield ''.join(self)\n+                yield b''.join(self)\n                 return\n \n             # otherwise do some bookkeeping to return exactly enough\n@@ -298,7 +298,7 @@ def parts():\n                 remaining -= len(emitting)\n                 yield emitting\n \n-        out = ''.join(parts())\n+        out = b''.join(parts())\n         return out\n \n     def next(self):\n@@ -311,7 +311,7 @@ def next(self):\n         \"\"\"\n         if self._leftover:\n             output = self._leftover\n-            self._leftover = ''\n+            self._leftover = b''\n         else:\n             output = next(self._producer)\n             self._unget_history = []\n@@ -341,7 +341,7 @@ def unget(self, bytes):\n             return\n         self._update_unget_history(len(bytes))\n         self.position -= len(bytes)\n-        self._leftover = ''.join([bytes, self._leftover])\n+        self._leftover = b''.join([bytes, self._leftover])\n \n     def _update_unget_history(self, num_bytes):\n         \"\"\"\n@@ -459,7 +459,7 @@ def next(self):\n         if not chunks:\n             raise StopIteration()\n \n-        chunk = ''.join(chunks)\n+        chunk = b''.join(chunks)\n         boundary = self._find_boundary(chunk, len(chunk) < self._rollback)\n \n         if boundary:\n@@ -495,9 +495,9 @@ def _find_boundary(self, data, eof = False):\n             end = index\n             next = index + len(self._boundary)\n             # backup over CRLF\n-            if data[max(0,end-1)] == '\\n':\n+            if data[max(0,end-1)] == b'\\n':\n                 end -= 1\n-            if data[max(0,end-1)] == '\\r':\n+            if data[max(0,end-1)] == b'\\r':\n                 end -= 1\n             return end, next\n \n@@ -531,7 +531,7 @@ def parse_boundary_stream(stream, max_header_size):\n     # 'find' returns the top of these four bytes, so we'll\n     # need to munch them later to prevent them from polluting\n     # the payload.\n-    header_end = chunk.find('\\r\\n\\r\\n')\n+    header_end = chunk.find(b'\\r\\n\\r\\n')\n \n     def _parse_header(line):\n         main_value_pair, params = parse_header(line)\n@@ -557,7 +557,7 @@ def _parse_header(line):\n     outdict = {}\n \n     # Eliminate blank lines\n-    for line in header.split('\\r\\n'):\n+    for line in header.split(b'\\r\\n'):\n         # This terminology (\"main value\" and \"dictionary of\n         # parameters\") is from the Python docs.\n         try:\n@@ -580,7 +580,7 @@ def _parse_header(line):\n class Parser(object):\n     def __init__(self, stream, boundary):\n         self._stream = stream\n-        self._separator = '--' + boundary\n+        self._separator = b'--' + boundary\n \n     def __iter__(self):\n         boundarystream = InterBoundaryIter(self._stream, self._separator)\n@@ -590,27 +590,27 @@ def __iter__(self):\n \n def parse_header(line):\n     \"\"\" Parse the header into a key-value. \"\"\"\n-    plist = _parse_header_params(';' + line)\n+    plist = _parse_header_params(b';' + line)\n     key = plist.pop(0).lower()\n     pdict = {}\n     for p in plist:\n-        i = p.find('=')\n+        i = p.find(b'=')\n         if i >= 0:\n             name = p[:i].strip().lower()\n             value = p[i+1:].strip()\n-            if len(value) >= 2 and value[0] == value[-1] == '\"':\n+            if len(value) >= 2 and value[0] == value[-1] == b'\"':\n                 value = value[1:-1]\n-                value = value.replace('\\\\\\\\', '\\\\').replace('\\\\\"', '\"')\n+                value = value.replace(b'\\\\\\\\', b'\\\\').replace(b'\\\\\"', b'\"')\n             pdict[name] = value\n     return key, pdict\n \n def _parse_header_params(s):\n     plist = []\n-    while s[:1] == ';':\n+    while s[:1] == b';':\n         s = s[1:]\n-        end = s.find(';')\n-        while end > 0 and s.count('\"', 0, end) % 2:\n-            end = s.find(';', end + 1)\n+        end = s.find(b';')\n+        while end > 0 and s.count(b'\"', 0, end) % 2:\n+            end = s.find(b';', end + 1)\n         if end < 0:\n             end = len(s)\n         f = s[:end]"
        },
        {
            "sha": "6e0f079de7a63352cda24fcf4168f2d64ac9183f",
            "filename": "django/template/loaders/app_directories.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftemplate%2Floaders%2Fapp_directories.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftemplate%2Floaders%2Fapp_directories.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floaders%2Fapp_directories.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -52,7 +52,7 @@ def get_template_sources(self, template_name, template_dirs=None):\n     def load_template_source(self, template_name, template_dirs=None):\n         for filepath in self.get_template_sources(template_name, template_dirs):\n             try:\n-                with open(filepath) as fp:\n+                with open(filepath, 'rb') as fp:\n                     return (fp.read().decode(settings.FILE_CHARSET), filepath)\n             except IOError:\n                 pass"
        },
        {
            "sha": "e87cfef987ef4009dc85f83f2d96d192bedc71c5",
            "filename": "django/template/loaders/filesystem.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftemplate%2Floaders%2Ffilesystem.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftemplate%2Floaders%2Ffilesystem.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floaders%2Ffilesystem.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -34,7 +34,7 @@ def load_template_source(self, template_name, template_dirs=None):\n         tried = []\n         for filepath in self.get_template_sources(template_name, template_dirs):\n             try:\n-                with open(filepath) as fp:\n+                with open(filepath, 'rb') as fp:\n                     return (fp.read().decode(settings.FILE_CHARSET), filepath)\n             except IOError:\n                 tried.append(filepath)"
        },
        {
            "sha": "e090781080d8eb0998b10cc3e012ffe6d2006cd9",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -148,7 +148,7 @@ def render(self, context):\n         context.pop()\n         try:\n             result = result % data\n-        except KeyError:\n+        except (KeyError, ValueError):\n             with translation.override(None):\n                 result = self.render(context)\n         return result"
        },
        {
            "sha": "3cc6a6e5376a6474e4de93e257aa958e4fec9e7b",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 32,
            "deletions": 38,
            "changes": 70,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -155,7 +155,6 @@ def encode_file(boundary, key, file):\n     ]\n \n \n-\n class RequestFactory(object):\n     \"\"\"\n     Class that lets you create mock Request objects for use in testing.\n@@ -227,7 +226,7 @@ def _get_path(self, parsed):\n             return urllib.unquote(parsed[2])\n \n     def get(self, path, data={}, **extra):\n-        \"Construct a GET request\"\n+        \"Construct a GET request.\"\n \n         parsed = urlparse(path)\n         r = {\n@@ -270,49 +269,39 @@ def head(self, path, data={}, **extra):\n         r.update(extra)\n         return self.request(**r)\n \n-    def options(self, path, data={}, **extra):\n-        \"Constrict an OPTIONS request\"\n-\n-        parsed = urlparse(path)\n-        r = {\n-            'PATH_INFO':       self._get_path(parsed),\n-            'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n-            'REQUEST_METHOD': 'OPTIONS',\n-        }\n-        r.update(extra)\n-        return self.request(**r)\n+    def options(self, path, data='', content_type='application/octet-stream',\n+            **extra):\n+        \"Construct an OPTIONS request.\"\n+        return self.generic('OPTIONS', path, data, content_type, **extra)\n \n-    def put(self, path, data={}, content_type=MULTIPART_CONTENT,\n+    def put(self, path, data='', content_type='application/octet-stream',\n             **extra):\n         \"Construct a PUT request.\"\n+        return self.generic('PUT', path, data, content_type, **extra)\n \n-        put_data = self._encode_data(data, content_type)\n+    def delete(self, path, data='', content_type='application/octet-stream',\n+            **extra):\n+        \"Construct a DELETE request.\"\n+        return self.generic('DELETE', path, data, content_type, **extra)\n \n+    def generic(self, method, path,\n+                data='', content_type='application/octet-stream', **extra):\n         parsed = urlparse(path)\n+        data = smart_str(data, settings.DEFAULT_CHARSET)\n         r = {\n-            'CONTENT_LENGTH': len(put_data),\n-            'CONTENT_TYPE':   content_type,\n             'PATH_INFO':      self._get_path(parsed),\n             'QUERY_STRING':   parsed[4],\n-            'REQUEST_METHOD': 'PUT',\n-            'wsgi.input':     FakePayload(put_data),\n+            'REQUEST_METHOD': method,\n         }\n+        if data:\n+            r.update({\n+                'CONTENT_LENGTH': len(data),\n+                'CONTENT_TYPE':   content_type,\n+                'wsgi.input':     FakePayload(data),\n+            })\n         r.update(extra)\n         return self.request(**r)\n \n-    def delete(self, path, data={}, **extra):\n-        \"Construct a DELETE request.\"\n-\n-        parsed = urlparse(path)\n-        r = {\n-            'PATH_INFO':       self._get_path(parsed),\n-            'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n-            'REQUEST_METHOD': 'DELETE',\n-        }\n-        r.update(extra)\n-        return self.request(**r)\n-\n-\n class Client(RequestFactory):\n     \"\"\"\n     A class that can act as a client for testing purposes.\n@@ -445,30 +434,35 @@ def head(self, path, data={}, follow=False, **extra):\n             response = self._handle_redirects(response, **extra)\n         return response\n \n-    def options(self, path, data={}, follow=False, **extra):\n+    def options(self, path, data='', content_type='application/octet-stream',\n+            follow=False, **extra):\n         \"\"\"\n         Request a response from the server using OPTIONS.\n         \"\"\"\n-        response = super(Client, self).options(path, data=data, **extra)\n+        response = super(Client, self).options(path,\n+                data=data, content_type=content_type, **extra)\n         if follow:\n             response = self._handle_redirects(response, **extra)\n         return response\n \n-    def put(self, path, data={}, content_type=MULTIPART_CONTENT,\n+    def put(self, path, data='', content_type='application/octet-stream',\n             follow=False, **extra):\n         \"\"\"\n         Send a resource to the server using PUT.\n         \"\"\"\n-        response = super(Client, self).put(path, data=data, content_type=content_type, **extra)\n+        response = super(Client, self).put(path,\n+                data=data, content_type=content_type, **extra)\n         if follow:\n             response = self._handle_redirects(response, **extra)\n         return response\n \n-    def delete(self, path, data={}, follow=False, **extra):\n+    def delete(self, path, data='', content_type='application/octet-stream',\n+            follow=False, **extra):\n         \"\"\"\n         Send a DELETE request to the server.\n         \"\"\"\n-        response = super(Client, self).delete(path, data=data, **extra)\n+        response = super(Client, self).delete(path,\n+                data=data, content_type=content_type, **extra)\n         if follow:\n             response = self._handle_redirects(response, **extra)\n         return response"
        },
        {
            "sha": "8b81a2ffa2295b62e4e10e44e3ffcfd3e44c14b4",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -23,7 +23,7 @@\n \n from django.conf import settings\n from django.core.cache import get_cache\n-from django.utils.encoding import smart_str, iri_to_uri, force_unicode\n+from django.utils.encoding import iri_to_uri, force_unicode\n from django.utils.http import http_date\n from django.utils.timezone import get_current_timezone_name\n from django.utils.translation import get_language\n@@ -53,7 +53,7 @@ def dictvalue(t):\n         if t[1] is True:\n             return t[0]\n         else:\n-            return t[0] + '=' + smart_str(t[1])\n+            return '%s=%s' % (t[0], t[1])\n \n     if response.has_header('Cache-Control'):\n         cc = cc_delim_re.split(response['Cache-Control'])"
        },
        {
            "sha": "9d6486c601931f0716f487d3685ed38f63bab397",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -8,6 +8,7 @@\n import binascii\n import operator\n import time\n+from functools import reduce\n \n # Use the system PRNG if possible\n import random\n@@ -23,8 +24,8 @@\n from django.conf import settings\n \n \n-_trans_5c = \"\".join([chr(x ^ 0x5C) for x in xrange(256)])\n-_trans_36 = \"\".join([chr(x ^ 0x36) for x in xrange(256)])\n+_trans_5c = b\"\".join([chr(x ^ 0x5C) for x in xrange(256)])\n+_trans_36 = b\"\".join([chr(x ^ 0x36) for x in xrange(256)])\n \n \n def salted_hmac(key_salt, value, secret=None):\n@@ -148,11 +149,11 @@ def pbkdf2(password, salt, iterations, dklen=0, digest=None):\n \n     def F(i):\n         def U():\n-            u = salt + struct.pack('>I', i)\n+            u = salt + struct.pack(b'>I', i)\n             for j in xrange(int(iterations)):\n                 u = _fast_hmac(password, u, digest).digest()\n                 yield _bin_to_long(u)\n         return _long_to_bin(reduce(operator.xor, U()), hex_format_string)\n \n     T = [F(x) for x in range(1, l + 1)]\n-    return ''.join(T[:-1]) + T[-1][:r]\n+    return b''.join(T[:-1]) + T[-1][:r]"
        },
        {
            "sha": "6b246ac59bb77a3d8381514da37bb96e92f50f6b",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,4 +1,3 @@\n-import types\n import urllib\n import locale\n import datetime\n@@ -45,7 +44,7 @@ def is_protected_type(obj):\n     force_unicode(strings_only=True).\n     \"\"\"\n     return isinstance(obj, (\n-        types.NoneType,\n+        type(None),\n         int, long,\n         datetime.datetime, datetime.date, datetime.time,\n         float, Decimal)\n@@ -107,7 +106,7 @@ def smart_str(s, encoding='utf-8', strings_only=False, errors='strict'):\n \n     If strings_only is True, don't convert (some) non-string-like objects.\n     \"\"\"\n-    if strings_only and isinstance(s, (types.NoneType, int)):\n+    if strings_only and (s is None or isinstance(s, int)):\n         return s\n     if isinstance(s, Promise):\n         return unicode(s).encode(encoding, errors)\n@@ -154,7 +153,7 @@ def iri_to_uri(iri):\n     # converted.\n     if iri is None:\n         return iri\n-    return urllib.quote(smart_str(iri), safe=\"/#%[]=:;$&()+,!?*@'~\")\n+    return urllib.quote(smart_str(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n \n def filepath_to_uri(path):\n     \"\"\"Convert an file system path to a URI portion that is suitable for\n@@ -173,7 +172,7 @@ def filepath_to_uri(path):\n         return path\n     # I know about `os.sep` and `os.altsep` but I want to leave\n     # some flexibility for hardcoding separators.\n-    return urllib.quote(smart_str(path).replace(\"\\\\\", \"/\"), safe=\"/~!*()'\")\n+    return urllib.quote(smart_str(path).replace(\"\\\\\", \"/\"), safe=b\"/~!*()'\")\n \n # The encoding of the default system locale but falls back to the\n # given fallback encoding if the encoding is unsupported by python or could"
        },
        {
            "sha": "31466ee8b810476dd5e8d803789cc591a4d115d5",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 15,
            "deletions": 8,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -58,6 +58,7 @@ def lazy(func, *resultclasses):\n     function is evaluated on every access.\n     \"\"\"\n \n+    @total_ordering\n     class __proxy__(Promise):\n         \"\"\"\n         Encapsulate a function call and act as a proxy for methods that are\n@@ -124,17 +125,23 @@ def __unicode_cast(self):\n         def __str_cast(self):\n             return str(func(*self.__args, **self.__kw))\n \n-        def __cmp__(self, rhs):\n+        def __cast(self):\n             if self._delegate_str:\n-                s = str(func(*self.__args, **self.__kw))\n+                return self.__str_cast()\n             elif self._delegate_unicode:\n-                s = unicode(func(*self.__args, **self.__kw))\n+                return self.__unicode_cast()\n             else:\n-                s = func(*self.__args, **self.__kw)\n-            if isinstance(rhs, Promise):\n-                return -cmp(rhs, s)\n-            else:\n-                return cmp(s, rhs)\n+                return func(*self.__args, **self.__kw)\n+\n+        def __eq__(self, other):\n+            if isinstance(other, Promise):\n+                other = other.__cast()\n+            return self.__cast() == other\n+\n+        def __lt__(self, other):\n+            if isinstance(other, Promise):\n+                other = other.__cast()\n+            return self.__cast() < other\n \n         def __mod__(self, rhs):\n             if self._delegate_str:"
        },
        {
            "sha": "1b1a16a91193e71521ea3a98252b201c99368aca",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -116,7 +116,7 @@ def smart_urlquote(url):\n     # contains a % not followed by two hexadecimal digits. See #9655.\n     if '%' not in url or unquoted_percents_re.search(url):\n         # See http://bugs.python.org/issue2637\n-        url = urllib.quote(smart_str(url), safe='!*\\'();:@&=+$,/?#[]~')\n+        url = urllib.quote(smart_str(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n \n     return force_unicode(url)\n "
        },
        {
            "sha": "d95cd62017541de030af87941972a2d7403ebc46",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 15,
            "deletions": 4,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -155,9 +155,20 @@ def get_traceback_frame_variables(self, request, tb_frame):\n         Replaces the values of variables marked as sensitive with\n         stars (*********).\n         \"\"\"\n-        func_name = tb_frame.f_code.co_name\n-        func = tb_frame.f_globals.get(func_name)\n-        sensitive_variables = getattr(func, 'sensitive_variables', [])\n+        # Loop through the frame's callers to see if the sensitive_variables\n+        # decorator was used.\n+        current_frame = tb_frame.f_back\n+        sensitive_variables = None\n+        while current_frame is not None:\n+            if (current_frame.f_code.co_name == 'sensitive_variables_wrapper'\n+                and 'sensitive_variables_wrapper' in current_frame.f_locals):\n+                # The sensitive_variables decorator was used, so we take note\n+                # of the sensitive variables' names.\n+                wrapper = current_frame.f_locals['sensitive_variables_wrapper']\n+                sensitive_variables = getattr(wrapper, 'sensitive_variables', None)\n+                break\n+            current_frame = current_frame.f_back\n+\n         cleansed = []\n         if self.is_active(request) and sensitive_variables:\n             if sensitive_variables == '__ALL__':\n@@ -333,7 +344,7 @@ def _get_lines_from_file(self, filename, lineno, context_lines, loader=None, mod\n                 source = source.splitlines()\n         if source is None:\n             try:\n-                with open(filename) as fp:\n+                with open(filename, 'rb') as fp:\n                     source = fp.readlines()\n             except (OSError, IOError):\n                 pass"
        },
        {
            "sha": "5c222963d379ea2583843dcab953ef8d38e478df",
            "filename": "django/views/decorators/debug.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fdecorators%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fdecorators%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fdebug.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -26,13 +26,13 @@ def my_function()\n     \"\"\"\n     def decorator(func):\n         @functools.wraps(func)\n-        def wrapper(*args, **kwargs):\n+        def sensitive_variables_wrapper(*args, **kwargs):\n             if variables:\n-                wrapper.sensitive_variables = variables\n+                sensitive_variables_wrapper.sensitive_variables = variables\n             else:\n-                wrapper.sensitive_variables = '__ALL__'\n+                sensitive_variables_wrapper.sensitive_variables = '__ALL__'\n             return func(*args, **kwargs)\n-        return wrapper\n+        return sensitive_variables_wrapper\n     return decorator\n \n \n@@ -61,11 +61,11 @@ def my_view(request)\n     \"\"\"\n     def decorator(view):\n         @functools.wraps(view)\n-        def wrapper(request, *args, **kwargs):\n+        def sensitive_post_parameters_wrapper(request, *args, **kwargs):\n             if parameters:\n                 request.sensitive_post_parameters = parameters\n             else:\n                 request.sensitive_post_parameters = '__ALL__'\n             return view(request, *args, **kwargs)\n-        return wrapper\n+        return sensitive_post_parameters_wrapper\n     return decorator"
        },
        {
            "sha": "7d3649cbfff815f2171da6c7444ee6fe564d354c",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -79,14 +79,22 @@ def dispatch(self, request, *args, **kwargs):\n         return handler(request, *args, **kwargs)\n \n     def http_method_not_allowed(self, request, *args, **kwargs):\n-        allowed_methods = [m for m in self.http_method_names if hasattr(self, m)]\n         logger.warning('Method Not Allowed (%s): %s', request.method, request.path,\n             extra={\n                 'status_code': 405,\n                 'request': self.request\n             }\n         )\n-        return http.HttpResponseNotAllowed(allowed_methods)\n+        return http.HttpResponseNotAllowed(self._allowed_methods())\n+\n+    def options(self, request, *args, **kwargs):\n+        response = http.HttpResponse()\n+        response['Allow'] = ', '.join(self._allowed_methods())\n+        response['Content-Length'] = 0\n+        return response\n+\n+    def _allowed_methods(self):\n+        return [m.upper() for m in self.http_method_names if hasattr(self, m)]\n \n \n class TemplateResponseMixin(object):"
        },
        {
            "sha": "3e6ab0fa0ca048184d97f1854fbfba2b39c927a5",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 168,
            "deletions": 77,
            "changes": 245,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -23,7 +23,9 @@ def get_year_format(self):\n         return self.year_format\n \n     def get_year(self):\n-        \"Return the year for which this view should display data\"\n+        \"\"\"\n+        Return the year for which this view should display data.\n+        \"\"\"\n         year = self.year\n         if year is None:\n             try:\n@@ -35,6 +37,32 @@ def get_year(self):\n                     raise Http404(_(u\"No year specified\"))\n         return year\n \n+    def get_next_year(self, date):\n+        \"\"\"\n+        Get the next valid year.\n+        \"\"\"\n+        return _get_next_prev(self, date, is_previous=False, period='year')\n+\n+    def get_previous_year(self, date):\n+        \"\"\"\n+        Get the previous valid year.\n+        \"\"\"\n+        return _get_next_prev(self, date, is_previous=True, period='year')\n+\n+    def _get_next_year(self, date):\n+        \"\"\"\n+        Return the start date of the next interval.\n+\n+        The interval is defined by start date <= item date < next start date.\n+        \"\"\"\n+        return date.replace(year=date.year + 1, month=1, day=1)\n+\n+    def _get_current_year(self, date):\n+        \"\"\"\n+        Return the start date of the current interval.\n+        \"\"\"\n+        return date.replace(month=1, day=1)\n+\n \n class MonthMixin(object):\n     month_format = '%b'\n@@ -48,7 +76,9 @@ def get_month_format(self):\n         return self.month_format\n \n     def get_month(self):\n-        \"Return the month for which this view should display data\"\n+        \"\"\"\n+        Return the month for which this view should display data.\n+        \"\"\"\n         month = self.month\n         if month is None:\n             try:\n@@ -64,20 +94,30 @@ def get_next_month(self, date):\n         \"\"\"\n         Get the next valid month.\n         \"\"\"\n-        # next must be the first day of the next month.\n-        if date.month == 12:\n-            next = date.replace(year=date.year + 1, month=1, day=1)\n-        else:\n-            next = date.replace(month=date.month + 1, day=1)\n-        return _get_next_prev(self, next, is_previous=False, period='month')\n+        return _get_next_prev(self, date, is_previous=False, period='month')\n \n     def get_previous_month(self, date):\n         \"\"\"\n         Get the previous valid month.\n         \"\"\"\n-        # prev must be the last day of the previous month.\n-        prev = date.replace(day=1) - datetime.timedelta(days=1)\n-        return _get_next_prev(self, prev, is_previous=True, period='month')\n+        return _get_next_prev(self, date, is_previous=True, period='month')\n+\n+    def _get_next_month(self, date):\n+        \"\"\"\n+        Return the start date of the next interval.\n+\n+        The interval is defined by start date <= item date < next start date.\n+        \"\"\"\n+        if date.month == 12:\n+            return date.replace(year=date.year + 1, month=1, day=1)\n+        else:\n+            return date.replace(month=date.month + 1, day=1)\n+\n+    def _get_current_month(self, date):\n+        \"\"\"\n+        Return the start date of the previous interval.\n+        \"\"\"\n+        return date.replace(day=1)\n \n \n class DayMixin(object):\n@@ -92,7 +132,9 @@ def get_day_format(self):\n         return self.day_format\n \n     def get_day(self):\n-        \"Return the day for which this view should display data\"\n+        \"\"\"\n+        Return the day for which this view should display data.\n+        \"\"\"\n         day = self.day\n         if day is None:\n             try:\n@@ -108,15 +150,27 @@ def get_next_day(self, date):\n         \"\"\"\n         Get the next valid day.\n         \"\"\"\n-        next = date + datetime.timedelta(days=1)\n-        return _get_next_prev(self, next, is_previous=False, period='day')\n+        return _get_next_prev(self, date, is_previous=False, period='day')\n \n     def get_previous_day(self, date):\n         \"\"\"\n         Get the previous valid day.\n         \"\"\"\n-        prev = date - datetime.timedelta(days=1)\n-        return _get_next_prev(self, prev, is_previous=True, period='day')\n+        return _get_next_prev(self, date, is_previous=True, period='day')\n+\n+    def _get_next_day(self, date):\n+        \"\"\"\n+        Return the start date of the next interval.\n+\n+        The interval is defined by start date <= item date < next start date.\n+        \"\"\"\n+        return date + datetime.timedelta(days=1)\n+\n+    def _get_current_day(self, date):\n+        \"\"\"\n+        Return the start date of the current interval.\n+        \"\"\"\n+        return date\n \n \n class WeekMixin(object):\n@@ -131,7 +185,9 @@ def get_week_format(self):\n         return self.week_format\n \n     def get_week(self):\n-        \"Return the week for which this view should display data\"\n+        \"\"\"\n+        Return the week for which this view should display data\n+        \"\"\"\n         week = self.week\n         if week is None:\n             try:\n@@ -147,19 +203,34 @@ def get_next_week(self, date):\n         \"\"\"\n         Get the next valid week.\n         \"\"\"\n-        # next must be the first day of the next week.\n-        next = date + datetime.timedelta(days=7 - self._get_weekday(date))\n-        return _get_next_prev(self, next, is_previous=False, period='week')\n+        return _get_next_prev(self, date, is_previous=False, period='week')\n \n     def get_previous_week(self, date):\n         \"\"\"\n         Get the previous valid week.\n         \"\"\"\n-        # prev must be the last day of the previous week.\n-        prev = date - datetime.timedelta(days=self._get_weekday(date) + 1)\n-        return _get_next_prev(self, prev, is_previous=True, period='week')\n+        return _get_next_prev(self, date, is_previous=True, period='week')\n+\n+    def _get_next_week(self, date):\n+        \"\"\"\n+        Return the start date of the next interval.\n+\n+        The interval is defined by start date <= item date < next start date.\n+        \"\"\"\n+        return date + datetime.timedelta(days=7 - self._get_weekday(date))\n+\n+    def _get_current_week(self, date):\n+        \"\"\"\n+        Return the start date of the current interval.\n+        \"\"\"\n+        return date - datetime.timedelta(self._get_weekday(date))\n \n     def _get_weekday(self, date):\n+        \"\"\"\n+        Return the weekday for a given date.\n+\n+        The first day according to the week format is 0 and the last day is 6.\n+        \"\"\"\n         week_format = self.get_week_format()\n         if week_format == '%W':                 # week starts on Monday\n             return date.weekday()\n@@ -168,6 +239,7 @@ def _get_weekday(self, date):\n         else:\n             raise ValueError(\"unknown week format: %s\" % week_format)\n \n+\n class DateMixin(object):\n     \"\"\"\n     Mixin class for views manipulating date-based data.\n@@ -255,7 +327,7 @@ def get_dated_items(self):\n         \"\"\"\n         raise NotImplementedError('A DateView must provide an implementation of get_dated_items()')\n \n-    def get_dated_queryset(self, **lookup):\n+    def get_dated_queryset(self, ordering=None, **lookup):\n         \"\"\"\n         Get a queryset properly filtered according to `allow_future` and any\n         extra lookup kwargs.\n@@ -266,14 +338,17 @@ def get_dated_queryset(self, **lookup):\n         allow_empty = self.get_allow_empty()\n         paginate_by = self.get_paginate_by(qs)\n \n+        if ordering is not None:\n+            qs = qs.order_by(ordering)\n+\n         if not allow_future:\n-            now = timezone.now() if self.uses_datetime_field else datetime.date.today()\n+            now = timezone.now() if self.uses_datetime_field else timezone_today()\n             qs = qs.filter(**{'%s__lte' % date_field: now})\n \n         if not allow_empty:\n             # When pagination is enabled, it's better to do a cheap query\n             # than to load the unpaginated queryset in memory.\n-            is_empty = not bool(qs) if paginate_by is None else not qs.exists()\n+            is_empty = len(qs) == 0 if paginate_by is None else not qs.exists()\n             if is_empty:\n                 raise Http404(_(u\"No %(verbose_name_plural)s available\") % {\n                         'verbose_name_plural': force_unicode(qs.model._meta.verbose_name_plural)\n@@ -310,15 +385,13 @@ def get_dated_items(self):\n         \"\"\"\n         Return (date_list, items, extra_context) for this request.\n         \"\"\"\n-        qs = self.get_dated_queryset()\n+        qs = self.get_dated_queryset(ordering='-%s' % self.get_date_field())\n         date_list = self.get_date_list(qs, 'year')\n \n-        if date_list:\n-            object_list = qs.order_by('-' + self.get_date_field())\n-        else:\n-            object_list = qs.none()\n+        if not date_list:\n+            qs = qs.none()\n \n-        return (date_list, object_list, {})\n+        return (date_list, qs, {})\n \n \n class ArchiveIndexView(MultipleObjectTemplateResponseMixin, BaseArchiveIndexView):\n@@ -344,23 +417,25 @@ def get_dated_items(self):\n         date = _date_from_string(year, self.get_year_format())\n \n         since = self._make_date_lookup_arg(date)\n-        until = self._make_date_lookup_arg(datetime.date(date.year + 1, 1, 1))\n+        until = self._make_date_lookup_arg(self._get_next_year(date))\n         lookup_kwargs = {\n             '%s__gte' % date_field: since,\n             '%s__lt' % date_field: until,\n         }\n \n-        qs = self.get_dated_queryset(**lookup_kwargs)\n+        qs = self.get_dated_queryset(ordering='-%s' % date_field, **lookup_kwargs)\n         date_list = self.get_date_list(qs, 'month')\n \n-        if self.get_make_object_list():\n-            object_list = qs.order_by('-' + date_field)\n-        else:\n+        if not self.get_make_object_list():\n             # We need this to be a queryset since parent classes introspect it\n             # to find information about the model.\n-            object_list = qs.none()\n+            qs = qs.none()\n \n-        return (date_list, object_list, {'year': year})\n+        return (date_list, qs, {\n+            'year': date,\n+            'next_year': self.get_next_year(date),\n+            'previous_year': self.get_previous_year(date),\n+        })\n \n     def get_make_object_list(self):\n         \"\"\"\n@@ -392,12 +467,8 @@ def get_dated_items(self):\n         date = _date_from_string(year, self.get_year_format(),\n                                  month, self.get_month_format())\n \n-        # Construct a date-range lookup.\n         since = self._make_date_lookup_arg(date)\n-        if date.month == 12:\n-            until = self._make_date_lookup_arg(datetime.date(date.year + 1, 1, 1))\n-        else:\n-            until = self._make_date_lookup_arg(datetime.date(date.year, date.month + 1, 1))\n+        until = self._make_date_lookup_arg(self._get_next_month(date))\n         lookup_kwargs = {\n             '%s__gte' % date_field: since,\n             '%s__lt' % date_field: until,\n@@ -442,9 +513,8 @@ def get_dated_items(self):\n                                  week_start, '%w',\n                                  week, week_format)\n \n-        # Construct a date-range lookup.\n         since = self._make_date_lookup_arg(date)\n-        until = self._make_date_lookup_arg(date + datetime.timedelta(days=7))\n+        until = self._make_date_lookup_arg(self._get_next_week(date))\n         lookup_kwargs = {\n             '%s__gte' % date_field: since,\n             '%s__lt' % date_field: until,\n@@ -585,22 +655,22 @@ def _date_from_string(year, year_format, month='', month_format='', day='', day_\n         })\n \n \n-def _get_next_prev(generic_view, naive_result, is_previous, period):\n+def _get_next_prev(generic_view, date, is_previous, period):\n     \"\"\"\n     Helper: Get the next or the previous valid date. The idea is to allow\n     links on month/day views to never be 404s by never providing a date\n     that'll be invalid for the given view.\n \n-    This is a bit complicated since it handles both next and previous months\n-    and days (for MonthArchiveView and DayArchiveView); hence the coupling to generic_view.\n+    This is a bit complicated since it handles different intervals of time,\n+    hence the coupling to generic_view.\n \n     However in essence the logic comes down to:\n \n         * If allow_empty and allow_future are both true, this is easy: just\n-          return the naive result (just the next/previous day or month,\n+          return the naive result (just the next/previous day/week/month,\n           reguardless of object existence.)\n \n-        * If allow_empty is true, allow_future is false, and the naive month\n+        * If allow_empty is true, allow_future is false, and the naive result\n           isn't in the future, then return it; otherwise return None.\n \n         * If allow_empty is false and allow_future is true, return the next\n@@ -616,9 +686,23 @@ def _get_next_prev(generic_view, naive_result, is_previous, period):\n     allow_empty = generic_view.get_allow_empty()\n     allow_future = generic_view.get_allow_future()\n \n-    # If allow_empty is True the naive value will be valid\n+    get_current = getattr(generic_view, '_get_current_%s' % period)\n+    get_next = getattr(generic_view, '_get_next_%s' % period)\n+\n+    # Bounds of the current interval\n+    start, end = get_current(date), get_next(date)\n+\n+    # If allow_empty is True, the naive result will be valid\n     if allow_empty:\n-        result = naive_result\n+        if is_previous:\n+            result = get_current(start - datetime.timedelta(days=1))\n+        else:\n+            result = end\n+\n+        if allow_future or result <= timezone_today():\n+            return result\n+        else:\n+            return None\n \n     # Otherwise, we'll need to go to the database to look for an object\n     # whose date_field is at least (greater than/less than) the given\n@@ -627,39 +711,46 @@ def _get_next_prev(generic_view, naive_result, is_previous, period):\n         # Construct a lookup and an ordering depending on whether we're doing\n         # a previous date or a next date lookup.\n         if is_previous:\n-            lookup = {'%s__lte' % date_field: generic_view._make_date_lookup_arg(naive_result)}\n+            lookup = {'%s__lt' % date_field: generic_view._make_date_lookup_arg(start)}\n             ordering = '-%s' % date_field\n         else:\n-            lookup = {'%s__gte' % date_field: generic_view._make_date_lookup_arg(naive_result)}\n+            lookup = {'%s__gte' % date_field: generic_view._make_date_lookup_arg(end)}\n             ordering = date_field\n \n+        # Filter out objects in the future if appropriate.\n+        if not allow_future:\n+            # Fortunately, to match the implementation of allow_future,\n+            # we need __lte, which doesn't conflict with __lt above.\n+            if generic_view.uses_datetime_field:\n+                now = timezone.now()\n+            else:\n+                now = timezone_today()\n+            lookup['%s__lte' % date_field] = now\n+\n         qs = generic_view.get_queryset().filter(**lookup).order_by(ordering)\n \n         # Snag the first object from the queryset; if it doesn't exist that\n         # means there's no next/previous link available.\n         try:\n             result = getattr(qs[0], date_field)\n         except IndexError:\n-            result = None\n-\n-    # Convert datetimes to a dates\n-    if result and generic_view.uses_datetime_field:\n-        if settings.USE_TZ:\n-            result = timezone.localtime(result)\n-        result = result.date()\n-\n-    if result:\n-        if period == 'month':\n-            # first day of the month\n-            result = result.replace(day=1)\n-        elif period == 'week':\n-            # monday of the week\n-            result = result - datetime.timedelta(days=generic_view._get_weekday(result))\n-        elif period != 'day':\n-            raise ValueError('invalid period: %s' % period)\n-\n-    # Check against future dates.\n-    if result and (allow_future or result < datetime.date.today()):\n-        return result\n+            return None\n+\n+        # Convert datetimes to dates in the current time zone.\n+        if generic_view.uses_datetime_field:\n+            if settings.USE_TZ:\n+                result = timezone.localtime(result)\n+            result = result.date()\n+\n+        # Return the first day of the period.\n+        return get_current(result)\n+\n+\n+def timezone_today():\n+    \"\"\"\n+    Return the current date in the current time zone.\n+    \"\"\"\n+    if settings.USE_TZ:\n+        return timezone.localtime(timezone.now()).date()\n     else:\n-        return None\n+        return datetime.date.today()"
        },
        {
            "sha": "4b5281745e02d7eaef4768d40e007cb5926fa5d6",
            "filename": "django/views/generic/detail.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Fdetail.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Fdetail.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdetail.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,6 +1,5 @@\n from django.core.exceptions import ImproperlyConfigured, ObjectDoesNotExist\n from django.http import Http404\n-from django.utils.encoding import smart_str\n from django.utils.translation import ugettext as _\n from django.views.generic.base import TemplateResponseMixin, ContextMixin, View\n \n@@ -81,7 +80,7 @@ def get_context_object_name(self, obj):\n         if self.context_object_name:\n             return self.context_object_name\n         elif hasattr(obj, '_meta'):\n-            return smart_str(obj._meta.object_name.lower())\n+            return obj._meta.object_name.lower()\n         else:\n             return None\n \n@@ -108,7 +107,7 @@ class SingleObjectTemplateResponseMixin(TemplateResponseMixin):\n     def get_template_names(self):\n         \"\"\"\n         Return a list of template names to be used for the request. Must return\n-        a list. May not be called if get_template is overridden.\n+        a list. May not be called if render_to_response is overridden.\n         \"\"\"\n         try:\n             names = super(SingleObjectTemplateResponseMixin, self).get_template_names()"
        },
        {
            "sha": "ae45fd2218cab244e5fe7eb6b74ce9c77b81b0ef",
            "filename": "django/views/generic/list.py",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/django%2Fviews%2Fgeneric%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Flist.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,7 +1,6 @@\n from django.core.paginator import Paginator, InvalidPage\n from django.core.exceptions import ImproperlyConfigured\n from django.http import Http404\n-from django.utils.encoding import smart_str\n from django.utils.translation import ugettext as _\n from django.views.generic.base import TemplateResponseMixin, ContextMixin, View\n \n@@ -16,7 +15,7 @@ class MultipleObjectMixin(ContextMixin):\n \n     def get_queryset(self):\n         \"\"\"\n-        Get the list of items for this view. This must be an interable, and may\n+        Get the list of items for this view. This must be an iterable, and may\n         be a queryset (in which qs-specific behavior will be enabled).\n         \"\"\"\n         if self.queryset is not None:\n@@ -77,7 +76,7 @@ def get_context_object_name(self, object_list):\n         if self.context_object_name:\n             return self.context_object_name\n         elif hasattr(object_list, 'model'):\n-            return smart_str('%s_list' % object_list.model._meta.object_name.lower())\n+            return '%s_list' % object_list.model._meta.object_name.lower()\n         else:\n             return None\n \n@@ -113,9 +112,19 @@ class BaseListView(MultipleObjectMixin, View):\n     def get(self, request, *args, **kwargs):\n         self.object_list = self.get_queryset()\n         allow_empty = self.get_allow_empty()\n-        if not allow_empty and len(self.object_list) == 0:\n-            raise Http404(_(u\"Empty list and '%(class_name)s.allow_empty' is False.\")\n-                          % {'class_name': self.__class__.__name__})\n+\n+        if not allow_empty:\n+            # When pagination is enabled and object_list is a queryset,\n+            # it's better to do a cheap query than to load the unpaginated\n+            # queryset in memory.\n+            if (self.get_paginate_by(self.object_list) is not None\n+                and hasattr(self.object_list, 'exists')):\n+                is_empty = not self.object_list.exists()\n+            else:\n+                is_empty = len(self.object_list) == 0\n+            if is_empty:\n+                raise Http404(_(u\"Empty list and '%(class_name)s.allow_empty' is False.\")\n+                        % {'class_name': self.__class__.__name__})\n         context = self.get_context_data(object_list=self.object_list)\n         return self.render_to_response(context)\n \n@@ -126,7 +135,7 @@ class MultipleObjectTemplateResponseMixin(TemplateResponseMixin):\n     def get_template_names(self):\n         \"\"\"\n         Return a list of template names to be used for the request. Must return\n-        a list. May not be called if get_template is overridden.\n+        a list. May not be called if render_to_response is overridden.\n         \"\"\"\n         try:\n             names = super(MultipleObjectTemplateResponseMixin, self).get_template_names()"
        },
        {
            "sha": "4a27bdf7a90b3d66392aecfb14113ec259616314",
            "filename": "docs/howto/custom-management-commands.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fhowto%2Fcustom-management-commands.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fhowto%2Fcustom-management-commands.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-management-commands.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -61,7 +61,7 @@ look like this:\n                 poll.opened = False\n                 poll.save()\n \n-                self.stdout.write('Successfully closed poll \"%s\"\\n' % poll_id)\n+                self.stdout.write('Successfully closed poll \"%s\"' % poll_id)\n \n .. note::\n     When you are using management commands and wish to provide console\n@@ -317,8 +317,12 @@ Exception class indicating a problem while executing a management\n command.\n \n If this exception is raised during the execution of a management\n-command, it will be caught and turned into a nicely-printed error\n-message to the appropriate output stream (i.e., stderr); as a\n-result, raising this exception (with a sensible description of the\n+command from a command line console, it will be caught and turned into a\n+nicely-printed error message to the appropriate output stream (i.e., stderr);\n+as a result, raising this exception (with a sensible description of the\n error) is the preferred way to indicate that something has gone\n wrong in the execution of a command.\n+\n+If a management command is called from code through\n+:ref:`call_command <call-command>`, it's up to you to catch the exception\n+when needed."
        },
        {
            "sha": "fc30df9fb8d9068827e3ecc8b9c9d1a57cdbe00a",
            "filename": "docs/intro/_images/admin10.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin10.png",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin10.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin10.png?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "8576fcb883cf7108f85091b17c670dfefc83a801",
            "filename": "docs/intro/_images/admin11.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin11.png",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin11.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin11.png?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "81accc9d49277dadbe1ac3d6227d187f1cebd9c3",
            "filename": "docs/intro/_images/admin11t.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin11t.png",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin11t.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin11t.png?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "2b4b1abc71fe6ec452e32e42f19915b007265459",
            "filename": "docs/intro/_images/admin12.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin12.png",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2F_images%2Fadmin12.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin12.png?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "250c0f1f412ff404b68d292c3e8527596dbc8521",
            "filename": "docs/intro/tutorial01.txt",
            "status": "modified",
            "additions": 28,
            "deletions": 17,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial01.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial01.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial01.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -13,9 +13,19 @@ It'll consist of two parts:\n * An admin site that lets you add, change and delete polls.\n \n We'll assume you have :doc:`Django installed </intro/install>` already. You can\n-tell Django is installed by running the Python interactive interpreter and\n-typing ``import django``. If that command runs successfully, with no errors,\n-Django is installed.\n+tell Django is installed and which version by running the following command:\n+\n+.. code-block:: bash\n+\n+    python -c \"import django; print(django.get_version())\"\n+\n+You should see either the version of your Django installation or an error\n+telling \"No module named django\". Check also that the version number matches\n+the version of this tutorial. If they don't match, you can refer to the\n+tutorial for your version of Django or update Django to the newest version.\n+\n+See :doc:`How to install Django </topics/install>` for advice on how to remove\n+older versions of Django and install a newer one.\n \n .. admonition:: Where to get help:\n \n@@ -339,9 +349,10 @@ The first step in writing a database Web app in Django is to define your models\n    the :ref:`DRY Principle <dry>`. The goal is to define your data model in one\n    place and automatically derive things from it.\n \n-In our simple poll app, we'll create two models: polls and choices. A poll has\n-a question and a publication date. A choice has two fields: the text of the\n-choice and a vote tally. Each choice is associated with a poll.\n+In our simple poll app, we'll create two models: ``Poll`` and ``Choice``.\n+A ``Poll`` has a question and a publication date. A ``Choice`` has two fields:\n+the text of the choice and a vote tally. Each ``Choice`` is associated with a\n+``Poll``.\n \n These concepts are represented by simple Python classes. Edit the\n :file:`polls/models.py` file so it looks like this::\n@@ -354,7 +365,7 @@ These concepts are represented by simple Python classes. Edit the\n \n     class Choice(models.Model):\n         poll = models.ForeignKey(Poll)\n-        choice = models.CharField(max_length=200)\n+        choice_text = models.CharField(max_length=200)\n         votes = models.IntegerField()\n \n The code is straightforward. Each model is represented by a class that\n@@ -384,8 +395,8 @@ Some :class:`~django.db.models.Field` classes have required elements.\n schema, but in validation, as we'll soon see.\n \n Finally, note a relationship is defined, using\n-:class:`~django.db.models.ForeignKey`. That tells Django each Choice is related\n-to a single Poll. Django supports all the common database relationships:\n+:class:`~django.db.models.ForeignKey`. That tells Django each ``Choice`` is related\n+to a single ``Poll``. Django supports all the common database relationships:\n many-to-ones, many-to-manys and one-to-ones.\n \n .. _`Python path`: http://docs.python.org/tutorial/modules.html#the-module-search-path\n@@ -397,7 +408,7 @@ That small bit of model code gives Django a lot of information. With it, Django\n is able to:\n \n * Create a database schema (``CREATE TABLE`` statements) for this app.\n-* Create a Python database-access API for accessing Poll and Choice objects.\n+* Create a Python database-access API for accessing ``Poll`` and ``Choice`` objects.\n \n But first we need to tell our project that the ``polls`` app is installed.\n \n@@ -446,7 +457,7 @@ statements for the polls app):\n     CREATE TABLE \"polls_choice\" (\n         \"id\" serial NOT NULL PRIMARY KEY,\n         \"poll_id\" integer NOT NULL REFERENCES \"polls_poll\" (\"id\") DEFERRABLE INITIALLY DEFERRED,\n-        \"choice\" varchar(200) NOT NULL,\n+        \"choice_text\" varchar(200) NOT NULL,\n         \"votes\" integer NOT NULL\n     );\n     COMMIT;\n@@ -597,7 +608,7 @@ of this object. Let's fix that by editing the polls model (in the\n     class Choice(models.Model):\n         # ...\n         def __unicode__(self):\n-            return self.choice\n+            return self.choice_text\n \n It's important to add :meth:`~django.db.models.Model.__unicode__` methods to\n your models, not only for your own sanity when dealing with the interactive\n@@ -678,7 +689,7 @@ Save these changes and start a new Python interactive shell by running\n     True\n \n     # Give the Poll a couple of Choices. The create call constructs a new\n-    # choice object, does the INSERT statement, adds the choice to the set\n+    # Choice object, does the INSERT statement, adds the choice to the set\n     # of available choices and returns the new Choice object. Django creates\n     # a set to hold the \"other side\" of a ForeignKey relation\n     # (e.g. a poll's choices) which can be accessed via the API.\n@@ -689,11 +700,11 @@ Save these changes and start a new Python interactive shell by running\n     []\n \n     # Create three choices.\n-    >>> p.choice_set.create(choice='Not much', votes=0)\n+    >>> p.choice_set.create(choice_text='Not much', votes=0)\n     <Choice: Not much>\n-    >>> p.choice_set.create(choice='The sky', votes=0)\n+    >>> p.choice_set.create(choice_text='The sky', votes=0)\n     <Choice: The sky>\n-    >>> c = p.choice_set.create(choice='Just hacking again', votes=0)\n+    >>> c = p.choice_set.create(choice_text='Just hacking again', votes=0)\n \n     # Choice objects have API access to their related Poll objects.\n     >>> c.poll\n@@ -713,7 +724,7 @@ Save these changes and start a new Python interactive shell by running\n     [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]\n \n     # Let's delete one of the choices. Use delete() for that.\n-    >>> c = p.choice_set.filter(choice__startswith='Just hacking')\n+    >>> c = p.choice_set.filter(choice_text__startswith='Just hacking')\n     >>> c.delete()\n \n For more information on model relations, see :doc:`Accessing related objects"
        },
        {
            "sha": "0d95f6ff373f7602833a5bee8aaa78b817666f73",
            "filename": "docs/intro/tutorial02.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial02.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial02.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial02.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -276,11 +276,11 @@ in that window and click \"Save,\" Django will save the poll to the database and\n dynamically add it as the selected choice on the \"Add choice\" form you're\n looking at.\n \n-But, really, this is an inefficient way of adding Choice objects to the system.\n+But, really, this is an inefficient way of adding ``Choice`` objects to the system.\n It'd be better if you could add a bunch of Choices directly when you create the\n-Poll object. Let's make that happen.\n+``Poll`` object. Let's make that happen.\n \n-Remove the ``register()`` call for the Choice model. Then, edit the ``Poll``\n+Remove the ``register()`` call for the ``Choice`` model. Then, edit the ``Poll``\n registration code to read::\n \n     class ChoiceInline(admin.StackedInline):\n@@ -296,7 +296,7 @@ registration code to read::\n \n     admin.site.register(Poll, PollAdmin)\n \n-This tells Django: \"Choice objects are edited on the Poll admin page. By\n+This tells Django: \"``Choice`` objects are edited on the ``Poll`` admin page. By\n default, provide enough fields for 3 choices.\"\n \n Load the \"Add poll\" page to see how that looks, you may need to restart your development server:\n@@ -309,7 +309,7 @@ by ``extra`` -- and each time you come back to the \"Change\" page for an\n already-created object, you get another three extra slots.\n \n One small problem, though. It takes a lot of screen space to display all the\n-fields for entering related Choice objects. For that reason, Django offers a\n+fields for entering related ``Choice`` objects. For that reason, Django offers a\n tabular way of displaying inline related objects; you just need to change\n the ``ChoiceInline`` declaration to read::\n \n@@ -397,7 +397,7 @@ search terms, Django will search the ``question`` field. You can use as many\n fields as you'd like -- although because it uses a ``LIKE`` query behind the\n scenes, keep it reasonable, to keep your database happy.\n \n-Finally, because Poll objects have dates, it'd be convenient to be able to\n+Finally, because ``Poll`` objects have dates, it'd be convenient to be able to\n drill down by date. Add this line::\n \n     date_hierarchy = 'pub_date'"
        },
        {
            "sha": "fd3a04ba93abc364c8986811194b6ac2be16197b",
            "filename": "docs/intro/tutorial03.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial03.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial03.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial03.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -400,7 +400,7 @@ like:\n     <h1>{{ poll.question }}</h1>\n     <ul>\n     {% for choice in poll.choice_set.all %}\n-        <li>{{ choice.choice }}</li>\n+        <li>{{ choice.choice_text }}</li>\n     {% endfor %}\n     </ul>\n \n@@ -412,7 +412,7 @@ list-index lookup.\n \n Method-calling happens in the :ttag:`{% for %}<for>` loop:\n ``poll.choice_set.all`` is interpreted as the Python code\n-``poll.choice_set.all()``, which returns an iterable of Choice objects and is\n+``poll.choice_set.all()``, which returns an iterable of ``Choice`` objects and is\n suitable for use in the :ttag:`{% for %}<for>` tag.\n \n See the :doc:`template guide </topics/templates>` for more about templates."
        },
        {
            "sha": "fac1433a8dd500c571c28dfd8dac7db262bb1b09",
            "filename": "docs/intro/tutorial04.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial04.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fintro%2Ftutorial04.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial04.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -22,7 +22,7 @@ tutorial, so that the template contains an HTML ``<form>`` element:\n     {% csrf_token %}\n     {% for choice in poll.choice_set.all %}\n         <input type=\"radio\" name=\"choice\" id=\"choice{{ forloop.counter }}\" value=\"{{ choice.id }}\" />\n-        <label for=\"choice{{ forloop.counter }}\">{{ choice.choice }}</label><br />\n+        <label for=\"choice{{ forloop.counter }}\">{{ choice.choice_text }}</label><br />\n     {% endfor %}\n     <input type=\"submit\" value=\"Vote\" />\n     </form>\n@@ -168,7 +168,7 @@ Now, create a ``results.html`` template:\n \n     <ul>\n     {% for choice in poll.choice_set.all %}\n-        <li>{{ choice.choice }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}</li>\n+        <li>{{ choice.choice_text }} -- {{ choice.votes }} vote{{ choice.votes|pluralize }}</li>\n     {% endfor %}\n     </ul>\n "
        },
        {
            "sha": "acd9db2d6650e07033e9ef5361c5b457aeadfbcc",
            "filename": "docs/ref/class-based-views.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fclass-based-views.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fclass-based-views.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1171,7 +1171,15 @@ YearArchiveView\n       have objects available according to ``queryset``, represented as\n       ``datetime.datetime`` objects, in ascending order.\n \n-    * ``year``: The given year, as a four-character string.\n+    * ``year``: A ``datetime.date`` object representing the given year.\n+\n+    * ``next_year``: A ``datetime.date`` object representing the first day\n+      of the next year. If the next year is in the future, this will be\n+      ``None``.\n+\n+    * ``previous_year``: A ``datetime.date`` object representing the first\n+      day of the previous year. Unlike ``next_year``, this will never be\n+      ``None``.\n \n     **Notes**\n \n@@ -1255,6 +1263,14 @@ WeekArchiveView\n     * ``week``: A ``datetime.date`` object representing the first day of\n       the given week.\n \n+    * ``next_week``: A ``datetime.date`` object representing the first day\n+      of the next week. If the next week is in the future, this will be\n+      ``None``.\n+\n+    * ``previous_week``: A ``datetime.date`` object representing the first\n+      day of the previous week. Unlike ``next_week``, this will never be\n+      ``None``.\n+\n     **Notes**\n \n     * Uses a default ``template_name_suffix`` of ``_archive_week``."
        },
        {
            "sha": "7aafbe89f35234618c42cf691df2b65ab53165d1",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -186,6 +186,7 @@ Here's a full example template:\n .. code-block:: html+django\n \n     {% extends \"base.html\" %}\n+    {% load i18n %}\n \n     {% block head %}\n     {{ wizard.form.media }}"
        },
        {
            "sha": "b9e3a7acd3a7d208114c5a119eddc3dbbaca1840",
            "filename": "docs/ref/contrib/gis/geoquerysets.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -941,7 +941,7 @@ of the geometry field in each model converted to the requested output format.\n ``geohash``\n ~~~~~~~~~~~\n \n-.. method:: GeoQuerySet.geohash(preceision=20, **kwargs)\n+.. method:: GeoQuerySet.geohash(precision=20, **kwargs)\n \n .. versionadded:: 1.2\n "
        },
        {
            "sha": "2bdf8253163494bd079e6d9185aa417a373cf6cf",
            "filename": "docs/ref/contrib/staticfiles.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fstaticfiles.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -348,6 +348,15 @@ CachedStaticFilesStorage\n     :setting:`CACHES` setting named ``'staticfiles'``. It falls back to using\n     the ``'default'`` cache backend.\n \n+    .. method:: file_hash(name, content=None)\n+\n+    .. versionadded:: 1.5\n+\n+    The method that is used when creating the hashed name of a file.\n+    Needs to return a hash for the given file name and content.\n+    By default it calculates a MD5 hash from the content's chunks as\n+    mentioned above.\n+\n .. _`far future Expires headers`: http://developer.yahoo.com/performance/rules.html#expires\n .. _`@import`: http://www.w3.org/TR/CSS2/cascade.html#at-import\n .. _`url()`: http://www.w3.org/TR/CSS2/syndata.html#uri"
        },
        {
            "sha": "10108d1f4fc7ff306d7a3d152cda5d59a366eb6b",
            "filename": "docs/ref/files/file.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Ffiles%2Ffile.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Ffiles%2Ffile.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ffiles%2Ffile.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -96,7 +96,7 @@ The ``ContentFile`` Class\n \n         from django.core.files.base import ContentFile\n \n-        f1 = ContentFile(\"my string content\")\n+        f1 = ContentFile(b\"my string content\")\n         f2 = ContentFile(u\"my unicode content encoded as UTF-8\".encode('UTF-8'))\n \n .. currentmodule:: django.core.files.images"
        },
        {
            "sha": "a1b76f65e1d1524efa1eaaa1a721c16fd6f57877",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1605,7 +1605,8 @@ method.\n \n This takes some explanation. By default, ``is_secure()`` is able to determine\n whether a request is secure by looking at whether the requested URL uses\n-\"https://\".\n+\"https://\". This is important for Django's CSRF protection, and may be used\n+by your own code or third-party apps.\n \n If your Django app is behind a proxy, though, the proxy may be \"swallowing\" the\n fact that a request is HTTPS, using a non-HTTPS connection between the proxy\n@@ -1635,7 +1636,7 @@ available in ``request.META``.)\n \n .. warning::\n \n-    **You will probably open security holes in your site if you set this without knowing what you're doing. Seriously.**\n+    **You will probably open security holes in your site if you set this without knowing what you're doing. And if you fail to set it when you should. Seriously.**\n \n     Make sure ALL of the following are true before setting this (assuming the\n     values from the example above):"
        },
        {
            "sha": "e945e0d4ca5cb71ab6e5eef69ec99edb931dda1b",
            "filename": "docs/ref/templates/api.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Ftemplates%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Ftemplates%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fapi.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -790,9 +790,10 @@ templating functions, call :func:`django.conf.settings.configure()` with any\n settings you wish to specify. You might want to consider setting at least\n :setting:`TEMPLATE_DIRS` (if you're going to use template loaders),\n :setting:`DEFAULT_CHARSET` (although the default of ``utf-8`` is probably fine)\n-and :setting:`TEMPLATE_DEBUG`. All available settings are described in the\n-:doc:`settings documentation </ref/settings>`, and any setting starting with\n-``TEMPLATE_`` is of obvious interest.\n+and :setting:`TEMPLATE_DEBUG`. If you plan to use the :ttag:`url` template tag,\n+you will also need to set the :setting:`ROOT_URLCONF` setting. All available\n+settings are described in the :doc:`settings documentation </ref/settings>`,\n+and any setting starting with ``TEMPLATE_`` is of obvious interest.\n \n .. _topic-template-alternate-language:\n "
        },
        {
            "sha": "46ce4138a4f665091ffbe8a5925d4be1b53482ac",
            "filename": "docs/ref/unicode.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Funicode.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Fref%2Funicode.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Funicode.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -269,15 +269,15 @@ You can pass either Unicode strings or UTF-8 bytestrings as arguments to\n querysets are identical::\n \n     qs = People.objects.filter(name__contains=u'√Ö')\n-    qs = People.objects.filter(name__contains='\\xc3\\x85') # UTF-8 encoding of √Ö\n+    qs = People.objects.filter(name__contains=b'\\xc3\\x85') # UTF-8 encoding of √Ö\n \n Templates\n =========\n \n You can use either Unicode or bytestrings when creating templates manually::\n \n \tfrom django.template import Template\n-\tt1 = Template('This is a bytestring template.')\n+\tt1 = Template(b'This is a bytestring template.')\n \tt2 = Template(u'This is a Unicode template.')\n \n But the common case is to read templates from the filesystem, and this creates"
        },
        {
            "sha": "0d86a52670162b31007807e579e079caca3fea64",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 60,
            "deletions": 1,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -44,6 +44,24 @@ reasons or when trying to avoid overwriting concurrent changes.\n See the :meth:`Model.save() <django.db.models.Model.save()>` documentation for\n more details.\n \n+Caching of related model instances\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+When traversing relations, the ORM will avoid re-fetching objects that were\n+previously loaded. For example, with the tutorial's models::\n+\n+    >>> first_poll = Poll.objects.all()[0]\n+    >>> first_choice = first_poll.choice_set.all()[0]\n+    >>> first_choice.poll is first_poll\n+    True\n+\n+In Django 1.5, the third line no longer triggers a new SQL query to fetch\n+``first_choice.poll``; it was set by the second line.\n+\n+For one-to-one relationships, both sides can be cached. For many-to-one\n+relationships, only the single side of the relationship can be cached. This\n+is particularly helpful in combination with ``prefetch_related``.\n+\n Minor features\n ~~~~~~~~~~~~~~\n \n@@ -55,6 +73,15 @@ Django 1.5 also includes several smaller improvements worth noting:\n * :mod:`django.utils.timezone` provides a helper for converting aware\n   datetimes between time zones. See :func:`~django.utils.timezone.localtime`.\n \n+* The generic views support OPTIONS requests.\n+\n+* Management commands do not raise ``SystemExit`` any more when called by code\n+  from :ref:`call_command <call-command>`. Any exception raised by the command\n+  (mostly :ref:`CommandError <ref-command-exceptions>`) is propagated.\n+\n+* The dumpdata management command outputs one row at a time, preventing\n+  out-of-memory errors when dumping large datasets.\n+\n * In the localflavor for Canada, \"pq\" was added to the acceptable codes for\n   Quebec. It's an old abbreviation.\n \n@@ -69,6 +96,38 @@ Backwards incompatible changes in 1.5\n     deprecation timeline for a given feature, its removal may appear as a\n     backwards incompatible change.\n \n+Context in year archive class-based views\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+For consistency with the other date-based generic views,\n+:class:`~django.views.generic.dates.YearArchiveView` now passes ``year`` in\n+the context as a :class:`datetime.date` rather than a string.  If you are\n+using ``{{ year }}`` in your templates, you must replace it with ``{{\n+year|date:\"Y\" }}``.\n+\n+``next_year`` and ``previous_year`` were also added in the context. They are\n+calculated according to ``allow_empty`` and ``allow_future``.\n+\n+OPTIONS, PUT and DELETE requests in the test client\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Unlike GET and POST, these HTTP methods aren't implemented by web browsers.\n+Rather, they're used in APIs, which transfer data in various formats such as\n+JSON or XML. Since such requests may contain arbitrary data, Django doesn't\n+attempt to decode their body.\n+\n+However, the test client used to build a query string for OPTIONS and DELETE\n+requests like for GET, and a request body for PUT requests like for POST. This\n+encoding was arbitrary and inconsistent with Django's behavior when it\n+receives the requests, so it was removed in Django 1.5.\n+\n+If you were using the ``data`` parameter in an OPTIONS or a DELETE request,\n+you must convert it to a query string and append it to the ``path`` parameter.\n+\n+If you were using the ``data`` parameter in a PUT request without a\n+``content_type``, you must encode your data before passing it to the test\n+client and set the ``content_type`` argument.\n+\n Features deprecated in 1.5\n ==========================\n \n@@ -84,4 +143,4 @@ our own copy of ``simplejson``. You can safely change any use of\n ~~~~~~~~~~~~~~~~~~~~~~\n \n The :func:`~django.utils.itercompat.product` function has been deprecated. Use\n-the built-in `itertools.product` instead.\n+the built-in :func:`itertools.product` instead."
        },
        {
            "sha": "13c2b994e4796cdc0e4c009213702c34741765be",
            "filename": "docs/topics/class-based-views.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fclass-based-views.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fclass-based-views.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -35,9 +35,6 @@ Django ships with generic views to do the following:\n \n * Present date-based objects in year/month/day archive pages,\n   associated detail, and \"latest\" pages.\n-  `The Django Weblog <https://www.djangoproject.com/weblog/>`_'s\n-  year, month, and day archives are built with these, as would be a typical\n-  newspaper's archives.\n \n * Allow users to create, update, and delete objects -- with or\n   without authorization."
        },
        {
            "sha": "42b9d1f490d4a3f0b4365faee1297313f321575f",
            "filename": "docs/topics/forms/formsets.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fformsets.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -152,6 +152,8 @@ As we can see, ``formset.errors`` is a list whose entries correspond to the\n forms in the formset. Validation was performed for each of the two forms, and\n the expected error message appears for the second item.\n \n+.. versionadded:: 1.4\n+\n We can also check if form data differs from the initial data (i.e. the form was\n sent without any data)::\n "
        },
        {
            "sha": "4870ffc0942a2a58fd86ab12ee8b5f3f97838610",
            "filename": "docs/topics/forms/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fforms%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fforms%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Findex.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -99,7 +99,7 @@ The standard pattern for processing a form in a view looks like this:\n        else:\n            form = ContactForm() # An unbound form\n \n-       return render_to_response('contact.html', {\n+       return render(request, 'contact.html', {\n            'form': form,\n        })\n "
        },
        {
            "sha": "1d9dd4b3c68ec74f6d3b416a888240471289225b",
            "filename": "docs/topics/i18n/timezones.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fi18n%2Ftimezones.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fi18n%2Ftimezones.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Ftimezones.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -656,7 +656,7 @@ Usage\n        >>> from django.utils.dateparse import parse_datetime\n        >>> naive = parse_datetime(\"2012-02-21 10:28:45\")\n        >>> import pytz\n-       >>> pytz.timezone(\"Europe/Helsinki\").localize(naive)\n+       >>> pytz.timezone(\"Europe/Helsinki\").localize(naive, is_dst=None)\n        datetime.datetime(2012, 2, 21, 10, 28, 45, tzinfo=<DstTzInfo 'Europe/Helsinki' EET+2:00:00 STD>)\n \n    Note that ``localize`` is a pytz extension to the :class:`~datetime.tzinfo`"
        },
        {
            "sha": "5e2eefe139ffc097b84837ef50ba3341621835b4",
            "filename": "docs/topics/install.txt",
            "status": "modified",
            "additions": 86,
            "deletions": 52,
            "changes": 138,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Finstall.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -154,34 +154,19 @@ If you are upgrading your installation of Django from a previous version,\n you will need to uninstall the old Django version before installing the\n new version.\n \n-If you installed Django using ``setup.py install``, uninstalling\n-is as simple as deleting the ``django`` directory from your Python\n-``site-packages``.\n+If you installed Django using pip_ or ``easy_install`` previously, installing\n+with pip_ or ``easy_install`` again will automatically take care of the old\n+version, so you don't need to do it yourself.\n \n-If you installed Django from a Python egg, remove the Django ``.egg`` file,\n-and remove the reference to the egg in the file named ``easy-install.pth``.\n-This file should also be located in your ``site-packages`` directory.\n+If you previously installed Django using ``python setup.py install``,\n+uninstalling is as simple as deleting the ``django`` directory from your Python\n+``site-packages``. To find the directory you need to remove, you can run the\n+following at your shell prompt (not the interactive Python prompt):\n \n-.. _finding-site-packages:\n+.. code-block:: bash\n \n-.. admonition:: Where are my ``site-packages`` stored?\n+    python -c \"import sys; sys.path = sys.path[1:]; import django; print(django.__path__)\"\n \n-    The location of the ``site-packages`` directory depends on the operating\n-    system, and the location in which Python was installed. To find out your\n-    system's ``site-packages`` location, execute the following:\n-\n-    .. code-block:: bash\n-\n-        python -c \"from distutils.sysconfig import get_python_lib; print(get_python_lib())\"\n-\n-    (Note that this should be run from a shell prompt, not a Python interactive\n-    prompt.)\n-\n-    Some Debian-based Linux distributions have separate ``site-packages``\n-    directories for user-installed packages, such as when installing Django\n-    from a downloaded tarball. The command  listed above will give you the\n-    system's ``site-packages``, the user's directory can be found in\n-    ``/usr/local/lib/`` instead of ``/usr/lib/``.\n \n .. _install-django-code:\n \n@@ -253,6 +238,15 @@ Installing an official release manually\n    run the command ``python setup.py install``. This will install Django in\n    your Python installation's ``site-packages`` directory.\n \n+   .. admonition:: Removing an old version\n+\n+       If you use this installation technique, it is particularly important\n+       that you :ref:`remove any existing\n+       installations<removing-old-versions-of-django>` of Django\n+       first. Otherwise, you can end up with a broken installation that\n+       includes files from previous versions that have since been removed from\n+       Django.\n+\n .. _download page: https://www.djangoproject.com/download/\n .. _bsdtar: http://gnuwin32.sourceforge.net/packages/bsdtar.htm\n .. _7-zip: http://www.7-zip.org/\n@@ -291,48 +285,88 @@ latest bug fixes and improvements, follow these instructions:\n \n    This will create a directory ``django-trunk`` in your current directory.\n \n-3. Next, make sure that the Python interpreter can load Django's code. The most\n-   convenient way to do this is to `modify Python's search path`_. Add a ``.pth``\n-   file containing the full path to the ``django-trunk`` directory to your\n-   system's ``site-packages`` directory. For example, on a Unix-like system:\n+3. Make sure that the Python interpreter can load Django's code. The most\n+   convenient way to do this is via pip_. Run the following command:\n \n    .. code-block:: bash\n \n-       echo WORKING-DIR/django-trunk > SITE-PACKAGES-DIR/django.pth\n+       sudo pip install -e django-trunk/\n \n-   (In the above line, change ``SITE-PACKAGES-DIR`` to match the location of\n-   your system's ``site-packages`` directory, as explained in the\n-   :ref:`Where are my site-packages stored? <finding-site-packages>` section\n-   above. Change ``WORKING-DIR/django-trunk`` to match the full path to your\n-   new ``django-trunk`` directory.)\n+   (If using a virtualenv_ you can omit ``sudo``.)\n \n-4. On Unix-like systems, create a symbolic link to the file\n-   ``django-trunk/django/bin/django-admin.py`` in a directory on your system\n-   path, such as ``/usr/local/bin``. For example:\n-\n-   .. code-block:: bash\n+   This will make Django's code importable, and will also make the\n+   ``django-admin.py`` utility command available. In other words, you're all\n+   set!\n \n-       ln -s WORKING-DIR/django-trunk/django/bin/django-admin.py /usr/local/bin/\n-\n-   (In the above line, change WORKING-DIR to match the full path to your new\n-   ``django-trunk`` directory.)\n-\n-   This simply lets you type ``django-admin.py`` from within any directory,\n-   rather than having to qualify the command with the full path to the file.\n-\n-   On Windows systems, the same result can be achieved by copying the file\n-   ``django-trunk/django/bin/django-admin.py`` to somewhere on your system\n-   path, for example ``C:\\Python27\\Scripts``.\n+   If you don't have pip_ available, see the alternative instructions for\n+   `installing the development version without pip`_.\n \n .. warning::\n \n     Don't run ``sudo python setup.py install``, because you've already\n-    carried out the equivalent actions in steps 3 and 4. Furthermore, this is\n-    known to cause problems when updating to a more recent version of Django.\n+    carried out the equivalent actions in step 3.\n \n When you want to update your copy of the Django source code, just run the\n command ``git pull`` from within the ``django-trunk`` directory. When you do\n this, Git will automatically download any changes.\n \n .. _Git: http://git-scm.com/\n .. _`modify Python's search path`: http://docs.python.org/install/index.html#modifying-python-s-search-path\n+.. _installing-the-development-version-without-pip:\n+\n+Installing the development version without pip\n+----------------------------------------------\n+\n+If you don't have pip_, you can instead manually `modify Python's search\n+path`_.\n+\n+First follow steps 1 and 2 above, so that you have a ``django-trunk`` directory\n+with a checkout of Django's latest code in it. Then add a ``.pth`` file\n+containing the full path to the ``django-trunk`` directory to your system's\n+``site-packages`` directory. For example, on a Unix-like system:\n+\n+.. code-block:: bash\n+\n+    echo WORKING-DIR/django-trunk > SITE-PACKAGES-DIR/django.pth\n+\n+In the above line, change ``WORKING-DIR/django-trunk`` to match the full path\n+to your new ``django-trunk`` directory, and change ``SITE-PACKAGES-DIR`` to\n+match the location of your system's ``site-packages`` directory.\n+\n+The location of the ``site-packages`` directory depends on the operating\n+system, and the location in which Python was installed. To find your system's\n+``site-packages`` location, execute the following:\n+\n+.. code-block:: bash\n+\n+    python -c \"from distutils.sysconfig import get_python_lib; print(get_python_lib())\"\n+\n+(Note that this should be run from a shell prompt, not a Python interactive\n+prompt.)\n+\n+Some Debian-based Linux distributions have separate ``site-packages``\n+directories for user-installed packages, such as when installing Django from\n+a downloaded tarball. The command listed above will give you the system's\n+``site-packages``, the user's directory can be found in ``/usr/local/lib/``\n+instead of ``/usr/lib/``.\n+\n+Next you need to make the ``django-admin.py`` utility available in your\n+shell PATH.\n+\n+On Unix-like systems, create a symbolic link to the file\n+``django-trunk/django/bin/django-admin.py`` in a directory on your system\n+path, such as ``/usr/local/bin``. For example:\n+\n+.. code-block:: bash\n+\n+    ln -s WORKING-DIR/django-trunk/django/bin/django-admin.py /usr/local/bin/\n+\n+(In the above line, change WORKING-DIR to match the full path to your new\n+``django-trunk`` directory.)\n+\n+This simply lets you type ``django-admin.py`` from within any directory,\n+rather than having to qualify the command with the full path to the file.\n+\n+On Windows systems, the same result can be achieved by copying the file\n+``django-trunk/django/bin/django-admin.py`` to somewhere on your system\n+path, for example ``C:\\Python27\\Scripts``."
        },
        {
            "sha": "151853d4ac5a695ce1cf8678112bde459600bc20",
            "filename": "docs/topics/security.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 13,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fsecurity.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fsecurity.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fsecurity.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -122,22 +122,19 @@ transferred between client and server, and in some cases -- **active** network\n attackers -- to alter data that is sent in either direction.\n \n If you want the protection that HTTPS provides, and have enabled it on your\n-server, there are some additional steps to consider to ensure that sensitive\n-information is not leaked:\n+server, there are some additional steps you may need:\n+\n+* If necessary, set :setting:`SECURE_PROXY_SSL_HEADER`, ensuring that you have\n+  understood the warnings there thoroughly. Failure to do this can result\n+  in CSRF vulnerabilities, and failure to do it correctly can also be\n+  dangerous!\n \n * Set up redirection so that requests over HTTP are redirected to HTTPS.\n \n-  It is possible to do this with a piece of Django middleware. However, this has\n-  problems for the common case of a Django app running behind a reverse\n-  proxy. Often, reverse proxies are configured to set the ``X-Forwarded-SSL``\n-  header (or equivalent) if the incoming connection was HTTPS, and the absence\n-  of this header could be used to detect a request that was not HTTPS. However,\n-  this method usually cannot be relied on, as a client, or a malicious active\n-  network attacker, could also set this header.\n-\n-  So, for the case of a reverse proxy, it is recommended that the main Web\n-  server should be configured to do the redirect to HTTPS, or configured to send\n-  HTTP requests to an app that unconditionally redirects to HTTPS.\n+  This could be done using a custom middleware. Please note the caveats under\n+  :setting:`SECURE_PROXY_SSL_HEADER`. For the case of a reverse proxy, it may be\n+  easier or more secure to configure the main Web server to do the redirect to\n+  HTTPS.\n \n * Use 'secure' cookies.\n "
        },
        {
            "sha": "88fa7b68641c17eec79f8460bf1424b578163d15",
            "filename": "docs/topics/settings.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fsettings.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -220,7 +220,7 @@ In this example, default settings are taken from ``myapp_defaults``, and the\n The following example, which uses ``myapp_defaults`` as a positional argument,\n is equivalent::\n \n-    settings.configure(myapp_defaults, DEBUG = True)\n+    settings.configure(myapp_defaults, DEBUG=True)\n \n Normally, you will not need to override the defaults in this fashion. The\n Django defaults are sufficiently tame that you can safely use them. Be aware\n@@ -242,7 +242,16 @@ is accessed.\n \n If you set ``DJANGO_SETTINGS_MODULE``, access settings values somehow, *then*\n call ``configure()``, Django will raise a ``RuntimeError`` indicating\n-that settings have already been configured.\n+that settings have already been configured. There is a property just for this\n+purpose:\n+\n+.. attribute: django.conf.settings.configured\n+\n+For example::\n+\n+    from django.conf import settings\n+    if not settings.configured:\n+        settings.configure(myapp_defaults, DEBUG=True)\n \n Also, it's an error to call ``configure()`` more than once, or to call\n ``configure()`` after any setting has been accessed."
        },
        {
            "sha": "f35c545c30bd52292c306956bfd1a5838d29abef",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 34,
            "deletions": 23,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -805,45 +805,56 @@ arguments at time of construction:\n \n     .. method:: Client.head(path, data={}, follow=False, **extra)\n \n-        Makes a HEAD request on the provided ``path`` and returns a ``Response``\n-        object. Useful for testing RESTful interfaces. Acts just like\n-        :meth:`Client.get` except it does not return a message body.\n+        Makes a HEAD request on the provided ``path`` and returns a\n+        ``Response`` object. This method works just like :meth:`Client.get`,\n+        including the ``follow`` and ``extra`` arguments, except it does not\n+        return a message body.\n \n-        If you set ``follow`` to ``True`` the client will follow any redirects\n-        and a ``redirect_chain`` attribute will be set in the response object\n-        containing tuples of the intermediate urls and status codes.\n-\n-    .. method:: Client.options(path, data={}, follow=False, **extra)\n+    .. method:: Client.options(path, data='', content_type='application/octet-stream', follow=False, **extra)\n \n         Makes an OPTIONS request on the provided ``path`` and returns a\n         ``Response`` object. Useful for testing RESTful interfaces.\n \n-        If you set ``follow`` to ``True`` the client will follow any redirects\n-        and a ``redirect_chain`` attribute will be set in the response object\n-        containing tuples of the intermediate urls and status codes.\n+        When ``data`` is provided, it is used as the request body, and\n+        a ``Content-Type`` header is set to ``content_type``.\n \n-        The ``extra`` argument acts the same as for :meth:`Client.get`.\n+        .. versionchanged:: 1.5\n+            :meth:`Client.options` used to process ``data`` like\n+            :meth:`Client.get`.\n+\n+        The ``follow`` and ``extra`` arguments act the same as for\n+        :meth:`Client.get`.\n \n-    .. method:: Client.put(path, data={}, content_type=MULTIPART_CONTENT, follow=False, **extra)\n+    .. method:: Client.put(path, data='', content_type='application/octet-stream', follow=False, **extra)\n \n         Makes a PUT request on the provided ``path`` and returns a\n-        ``Response`` object. Useful for testing RESTful interfaces. Acts just\n-        like :meth:`Client.post` except with the PUT request method.\n+        ``Response`` object. Useful for testing RESTful interfaces.\n \n-        If you set ``follow`` to ``True`` the client will follow any redirects\n-        and a ``redirect_chain`` attribute will be set in the response object\n-        containing tuples of the intermediate urls and status codes.\n+        When ``data`` is provided, it is used as the request body, and\n+        a ``Content-Type`` header is set to ``content_type``.\n+\n+        .. versionchanged:: 1.5\n+            :meth:`Client.put` used to process ``data`` like\n+            :meth:`Client.post`.\n \n-    .. method:: Client.delete(path, follow=False, **extra)\n+        The ``follow`` and ``extra`` arguments act the same as for\n+        :meth:`Client.get`.\n+\n+    .. method:: Client.delete(path, data='', content_type='application/octet-stream', follow=False, **extra)\n \n         Makes an DELETE request on the provided ``path`` and returns a\n         ``Response`` object. Useful for testing RESTful interfaces.\n \n-        If you set ``follow`` to ``True`` the client will follow any redirects\n-        and a ``redirect_chain`` attribute will be set in the response object\n-        containing tuples of the intermediate urls and status codes.\n+        When ``data`` is provided, it is used as the request body, and\n+        a ``Content-Type`` header is set to ``content_type``.\n+\n+        .. versionchanged:: 1.5\n+            :meth:`Client.delete` used to process ``data`` like\n+            :meth:`Client.get`.\n+\n+        The ``follow`` and ``extra`` arguments act the same as for\n+        :meth:`Client.get`.\n \n-        The ``extra`` argument acts the same as for :meth:`Client.get`.\n \n     .. method:: Client.login(**credentials)\n "
        },
        {
            "sha": "165c5e9f735be959ce6a054a342418fb208d8143",
            "filename": "setup.py",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/setup.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/setup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/setup.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,9 +1,25 @@\n from distutils.core import setup\n from distutils.command.install_data import install_data\n from distutils.command.install import INSTALL_SCHEMES\n+from distutils.sysconfig import get_python_lib\n import os\n import sys\n \n+# Warn if we are installing over top of an existing installation. This can\n+# cause issues where files that were deleted from a more recent Django are\n+# still present in site-packages. See #18115.\n+overlay_warning = False\n+if \"install\" in sys.argv:\n+    # We have to try also with an explicit prefix of /usr/local in order to\n+    # catch Debian's custom user site-packages directory.\n+    for lib_path in get_python_lib(), get_python_lib(prefix=\"/usr/local\"):\n+        existing_path = os.path.abspath(os.path.join(lib_path, \"django\"))\n+        if os.path.exists(existing_path):\n+            # We note the need for the warning here, but present it after the\n+            # command is run, so it's more likely to be seen.\n+            overlay_warning = True\n+            break\n+\n class osx_install_data(install_data):\n     # On MacOS, the platform-specific lib dir is /System/Library/Framework/Python/.../\n     # which is wrong. Python 2.5 supplied with MacOS 10.5 has an Apple-specific fix\n@@ -97,3 +113,23 @@ def fullsplit(path, result=None):\n         'Topic :: Software Development :: Libraries :: Python Modules',\n    ],\n )\n+\n+if overlay_warning:\n+    sys.stderr.write(\"\"\"\n+\n+========\n+WARNING!\n+========\n+\n+You have just installed Django over top of an existing\n+installation, without removing it first. Because of this,\n+your install may now include extraneous files from a\n+previous version that have since been removed from\n+Django. This is known to cause a variety of problems. You\n+should manually remove the\n+\n+%(existing_path)s\n+\n+directory and re-install Django.\n+\n+\"\"\" % { \"existing_path\": existing_path })"
        },
        {
            "sha": "eb09162b01e5df51af72682d71a540582578b1ee",
            "filename": "tests/modeltests/defer/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fdefer%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fdefer%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdefer%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -158,3 +158,18 @@ def test_defer_proxy(self):\n         self.assert_delayed(child, 1)\n         self.assertEqual(child.name, 'p1')\n         self.assertEqual(child.value, 'xx')\n+\n+    def test_defer_inheritance_pk_chaining(self):\n+        \"\"\"\n+        When an inherited model is fetched from the DB, its PK is also fetched.\n+        When getting the PK of the parent model it is useful to use the already\n+        fetched parent model PK if it happens to be available. Tests that this\n+        is done.\n+        \"\"\"\n+        s1 = Secondary.objects.create(first=\"x1\", second=\"y1\")\n+        bc = BigChild.objects.create(name=\"b1\", value=\"foo\", related=s1,\n+                                     other=\"bar\")\n+        bc_deferred = BigChild.objects.only('name').get(pk=bc.pk)\n+        with self.assertNumQueries(0):\n+            bc_deferred.id\n+        self.assertEqual(bc_deferred.pk, bc_deferred.id)"
        },
        {
            "sha": "48755123f2b55755487e2bc1b9b3214e8af17531",
            "filename": "tests/modeltests/field_subclassing/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -17,6 +17,10 @@ def test_defer(self):\n         self.assertTrue(isinstance(d.data, list))\n         self.assertEqual(d.data, [1, 2, 3])\n \n+        d = DataModel.objects.defer(\"data\").get(pk=d.pk)\n+        self.assertTrue(isinstance(d.data, list))\n+        self.assertEqual(d.data, [1, 2, 3])\n+        # Refetch for save\n         d = DataModel.objects.defer(\"data\").get(pk=d.pk)\n         d.save()\n "
        },
        {
            "sha": "837723a049344035980d0e94ed167f04d28abdde",
            "filename": "tests/modeltests/files/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import absolute_import\n \n+import gzip\n import shutil\n import tempfile\n \n@@ -8,11 +9,12 @@\n from django.core.files.base import ContentFile\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.test import TestCase\n+from django.utils import unittest\n \n from .models import Storage, temp_storage, temp_storage_location\n \n \n-class FileTests(TestCase):\n+class FileStorageTests(TestCase):\n     def tearDown(self):\n         shutil.rmtree(temp_storage_location)\n \n@@ -106,6 +108,8 @@ def test_files(self):\n         obj3.default.delete()\n         obj4.random.delete()\n \n+\n+class FileTests(unittest.TestCase):\n     def test_context_manager(self):\n         orig_file = tempfile.TemporaryFile()\n         base_file = File(orig_file)\n@@ -114,3 +118,10 @@ def test_context_manager(self):\n             self.assertFalse(f.closed)\n         self.assertTrue(f.closed)\n         self.assertTrue(orig_file.closed)\n+\n+    def test_file_mode(self):\n+        # Should not set mode to None if it is not present.\n+        # See #14681, stdlib gzip module crashes if mode is set to None\n+        file = SimpleUploadedFile(\"mode_test.txt\", \"content\")\n+        self.assertFalse(hasattr(file, 'mode'))\n+        g = gzip.GzipFile(fileobj=file)"
        },
        {
            "sha": "478bbe912988f6b87044c405c9a2b523d227ef7b",
            "filename": "tests/modeltests/fixtures/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -54,25 +54,25 @@ def test_loading_and_dumping(self):\n         ])\n \n         # Dump the current contents of the database as a JSON fixture\n-        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n+        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n \n         # Try just dumping the contents of fixtures.Category\n         self._dumpdata_assert(['fixtures.Category'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}]')\n \n         # ...and just fixtures.Article\n-        self._dumpdata_assert(['fixtures.Article'], '[{\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}]')\n+        self._dumpdata_assert(['fixtures.Article'], '[{\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}]')\n \n         # ...and both\n-        self._dumpdata_assert(['fixtures.Category', 'fixtures.Article'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}]')\n+        self._dumpdata_assert(['fixtures.Category', 'fixtures.Article'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}]')\n \n         # Specify a specific model twice\n-        self._dumpdata_assert(['fixtures.Article', 'fixtures.Article'], '[{\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}]')\n+        self._dumpdata_assert(['fixtures.Article', 'fixtures.Article'], '[{\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}]')\n \n         # Specify a dump that specifies Article both explicitly and implicitly\n-        self._dumpdata_assert(['fixtures.Article', 'fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n+        self._dumpdata_assert(['fixtures.Article', 'fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n \n         # Same again, but specify in the reverse order\n-        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n+        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n \n         # Specify one model from one application, and an entire other application.\n         self._dumpdata_assert(['fixtures.Category', 'sites'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 1, \"model\": \"sites.site\", \"fields\": {\"domain\": \"example.com\", \"name\": \"example.com\"}}]')\n@@ -143,17 +143,17 @@ def test_loading_and_dumping(self):\n         ])\n \n         # By default, you get raw keys on dumpdata\n-        self._dumpdata_assert(['fixtures.book'], '[{\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}, {\"pk\": 1, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Music for all ages\", \"authors\": [3, 1]}}]')\n+        self._dumpdata_assert(['fixtures.book'], '[{\"pk\": 1, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Music for all ages\", \"authors\": [3, 1]}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n \n         # But you can get natural keys if you ask for them and they are available\n-        self._dumpdata_assert(['fixtures.book'], '[{\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}, {\"pk\": 1, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Music for all ages\", \"authors\": [[\"Artist formerly known as \\\\\"Prince\\\\\"\"], [\"Django Reinhardt\"]]}}]', natural_keys=True)\n+        self._dumpdata_assert(['fixtures.book'], '[{\"pk\": 1, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Music for all ages\", \"authors\": [[\"Artist formerly known as \\\\\"Prince\\\\\"\"], [\"Django Reinhardt\"]]}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]', natural_keys=True)\n \n         # Dump the current contents of the database as a JSON fixture\n-        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 5, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"XML identified as leading cause of cancer\", \"pub_date\": \"2006-06-16T16:00:00\"}}, {\"pk\": 4, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Django conquers world!\", \"pub_date\": \"2006-06-16T15:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Copyright is fine the way it is\", \"pub_date\": \"2006-06-16T14:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker on TV is great!\", \"pub_date\": \"2006-06-16T11:00:00\"}}, {\"pk\": 1, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"copyright\", \"tagged_id\": 3}}, {\"pk\": 2, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"legal\", \"tagged_id\": 3}}, {\"pk\": 3, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"django\", \"tagged_id\": 4}}, {\"pk\": 4, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"world domination\", \"tagged_id\": 4}}, {\"pk\": 3, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Artist formerly known as \\\\\"Prince\\\\\"\"}}, {\"pk\": 1, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Django Reinhardt\"}}, {\"pk\": 2, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Stephane Grappelli\"}}, {\"pk\": 1, \"model\": \"fixtures.visa\", \"fields\": {\"person\": [\"Django Reinhardt\"], \"permissions\": [[\"add_user\", \"auth\", \"user\"], [\"change_user\", \"auth\", \"user\"], [\"delete_user\", \"auth\", \"user\"]]}}, {\"pk\": 2, \"model\": \"fixtures.visa\", \"fields\": {\"person\": [\"Stephane Grappelli\"], \"permissions\": [[\"add_user\", \"auth\", \"user\"], [\"delete_user\", \"auth\", \"user\"]]}}, {\"pk\": 3, \"model\": \"fixtures.visa\", \"fields\": {\"person\": [\"Artist formerly known as \\\\\"Prince\\\\\"\"], \"permissions\": [[\"change_user\", \"auth\", \"user\"]]}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}, {\"pk\": 1, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Music for all ages\", \"authors\": [[\"Artist formerly known as \\\\\"Prince\\\\\"\"], [\"Django Reinhardt\"]]}}]', natural_keys=True)\n+        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker on TV is great!\", \"pub_date\": \"2006-06-16T11:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Copyright is fine the way it is\", \"pub_date\": \"2006-06-16T14:00:00\"}}, {\"pk\": 4, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Django conquers world!\", \"pub_date\": \"2006-06-16T15:00:00\"}}, {\"pk\": 5, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"XML identified as leading cause of cancer\", \"pub_date\": \"2006-06-16T16:00:00\"}}, {\"pk\": 1, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"copyright\", \"tagged_id\": 3}}, {\"pk\": 2, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"legal\", \"tagged_id\": 3}}, {\"pk\": 3, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"django\", \"tagged_id\": 4}}, {\"pk\": 4, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"world domination\", \"tagged_id\": 4}}, {\"pk\": 1, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Django Reinhardt\"}}, {\"pk\": 2, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Stephane Grappelli\"}}, {\"pk\": 3, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Artist formerly known as \\\\\"Prince\\\\\"\"}}, {\"pk\": 1, \"model\": \"fixtures.visa\", \"fields\": {\"person\": [\"Django Reinhardt\"], \"permissions\": [[\"add_user\", \"auth\", \"user\"], [\"change_user\", \"auth\", \"user\"], [\"delete_user\", \"auth\", \"user\"]]}}, {\"pk\": 2, \"model\": \"fixtures.visa\", \"fields\": {\"person\": [\"Stephane Grappelli\"], \"permissions\": [[\"add_user\", \"auth\", \"user\"], [\"delete_user\", \"auth\", \"user\"]]}}, {\"pk\": 3, \"model\": \"fixtures.visa\", \"fields\": {\"person\": [\"Artist formerly known as \\\\\"Prince\\\\\"\"], \"permissions\": [[\"change_user\", \"auth\", \"user\"]]}}, {\"pk\": 1, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Music for all ages\", \"authors\": [[\"Artist formerly known as \\\\\"Prince\\\\\"\"], [\"Django Reinhardt\"]]}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]', natural_keys=True)\n \n         # Dump the current contents of the database as an XML fixture\n         self._dumpdata_assert(['fixtures'], \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<django-objects version=\"1.0\"><object pk=\"1\" model=\"fixtures.category\"><field type=\"CharField\" name=\"title\">News Stories</field><field type=\"TextField\" name=\"description\">Latest news stories</field></object><object pk=\"5\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">XML identified as leading cause of cancer</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T16:00:00</field></object><object pk=\"4\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Django conquers world!</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T15:00:00</field></object><object pk=\"3\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Copyright is fine the way it is</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T14:00:00</field></object><object pk=\"2\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Poker on TV is great!</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T11:00:00</field></object><object pk=\"1\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">copyright</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"2\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">legal</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"3\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">django</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">4</field></object><object pk=\"4\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">world domination</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">4</field></object><object pk=\"3\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Artist formerly known as \"Prince\"</field></object><object pk=\"1\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Django Reinhardt</field></object><object pk=\"2\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Stephane Grappelli</field></object><object pk=\"1\" model=\"fixtures.visa\"><field to=\"fixtures.person\" name=\"person\" rel=\"ManyToOneRel\"><natural>Django Reinhardt</natural></field><field to=\"auth.permission\" name=\"permissions\" rel=\"ManyToManyRel\"><object><natural>add_user</natural><natural>auth</natural><natural>user</natural></object><object><natural>change_user</natural><natural>auth</natural><natural>user</natural></object><object><natural>delete_user</natural><natural>auth</natural><natural>user</natural></object></field></object><object pk=\"2\" model=\"fixtures.visa\"><field to=\"fixtures.person\" name=\"person\" rel=\"ManyToOneRel\"><natural>Stephane Grappelli</natural></field><field to=\"auth.permission\" name=\"permissions\" rel=\"ManyToManyRel\"><object><natural>add_user</natural><natural>auth</natural><natural>user</natural></object><object><natural>delete_user</natural><natural>auth</natural><natural>user</natural></object></field></object><object pk=\"3\" model=\"fixtures.visa\"><field to=\"fixtures.person\" name=\"person\" rel=\"ManyToOneRel\"><natural>Artist formerly known as \"Prince\"</natural></field><field to=\"auth.permission\" name=\"permissions\" rel=\"ManyToManyRel\"><object><natural>change_user</natural><natural>auth</natural><natural>user</natural></object></field></object><object pk=\"10\" model=\"fixtures.book\"><field type=\"CharField\" name=\"name\">Achieving self-awareness of Python programs</field><field to=\"fixtures.person\" name=\"authors\" rel=\"ManyToManyRel\"></field></object><object pk=\"1\" model=\"fixtures.book\"><field type=\"CharField\" name=\"name\">Music for all ages</field><field to=\"fixtures.person\" name=\"authors\" rel=\"ManyToManyRel\"><object><natural>Artist formerly known as \"Prince\"</natural></object><object><natural>Django Reinhardt</natural></object></field></object></django-objects>\"\"\", format='xml', natural_keys=True)\n+<django-objects version=\"1.0\"><object pk=\"1\" model=\"fixtures.category\"><field type=\"CharField\" name=\"title\">News Stories</field><field type=\"TextField\" name=\"description\">Latest news stories</field></object><object pk=\"2\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Poker on TV is great!</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T11:00:00</field></object><object pk=\"3\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Copyright is fine the way it is</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T14:00:00</field></object><object pk=\"4\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Django conquers world!</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T15:00:00</field></object><object pk=\"5\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">XML identified as leading cause of cancer</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T16:00:00</field></object><object pk=\"1\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">copyright</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"2\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">legal</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"3\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">django</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">4</field></object><object pk=\"4\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">world domination</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">4</field></object><object pk=\"1\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Django Reinhardt</field></object><object pk=\"2\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Stephane Grappelli</field></object><object pk=\"3\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Artist formerly known as \"Prince\"</field></object><object pk=\"1\" model=\"fixtures.visa\"><field to=\"fixtures.person\" name=\"person\" rel=\"ManyToOneRel\"><natural>Django Reinhardt</natural></field><field to=\"auth.permission\" name=\"permissions\" rel=\"ManyToManyRel\"><object><natural>add_user</natural><natural>auth</natural><natural>user</natural></object><object><natural>change_user</natural><natural>auth</natural><natural>user</natural></object><object><natural>delete_user</natural><natural>auth</natural><natural>user</natural></object></field></object><object pk=\"2\" model=\"fixtures.visa\"><field to=\"fixtures.person\" name=\"person\" rel=\"ManyToOneRel\"><natural>Stephane Grappelli</natural></field><field to=\"auth.permission\" name=\"permissions\" rel=\"ManyToManyRel\"><object><natural>add_user</natural><natural>auth</natural><natural>user</natural></object><object><natural>delete_user</natural><natural>auth</natural><natural>user</natural></object></field></object><object pk=\"3\" model=\"fixtures.visa\"><field to=\"fixtures.person\" name=\"person\" rel=\"ManyToOneRel\"><natural>Artist formerly known as \"Prince\"</natural></field><field to=\"auth.permission\" name=\"permissions\" rel=\"ManyToManyRel\"><object><natural>change_user</natural><natural>auth</natural><natural>user</natural></object></field></object><object pk=\"1\" model=\"fixtures.book\"><field type=\"CharField\" name=\"name\">Music for all ages</field><field to=\"fixtures.person\" name=\"authors\" rel=\"ManyToManyRel\"><object><natural>Artist formerly known as \"Prince\"</natural></object><object><natural>Django Reinhardt</natural></object></field></object><object pk=\"10\" model=\"fixtures.book\"><field type=\"CharField\" name=\"name\">Achieving self-awareness of Python programs</field><field to=\"fixtures.person\" name=\"authors\" rel=\"ManyToManyRel\"></field></object></django-objects>\"\"\", format='xml', natural_keys=True)\n \n     def test_dumpdata_with_excludes(self):\n         # Load fixture1 which has a site, two articles, and a category\n@@ -185,14 +185,14 @@ def test_dumpdata_with_excludes(self):\n             exclude_list=['fixtures.Article', 'fixtures.Book', 'sites'])\n \n         # Excluding a bogus app should throw an error\n-        self.assertRaises(SystemExit,\n+        self.assertRaises(management.CommandError,\n                           self._dumpdata_assert,\n                           ['fixtures', 'sites'],\n                           '',\n                           exclude_list=['foo_app'])\n \n         # Excluding a bogus model should throw an error\n-        self.assertRaises(SystemExit,\n+        self.assertRaises(management.CommandError,\n                           self._dumpdata_assert,\n                           ['fixtures', 'sites'],\n                           '',\n@@ -292,11 +292,11 @@ def test_output_formats(self):\n         ])\n \n         # Dump the current contents of the database as a JSON fixture\n-        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 1, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"copyright\", \"tagged_id\": 3}}, {\"pk\": 2, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"law\", \"tagged_id\": 3}}, {\"pk\": 1, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Django Reinhardt\"}}, {\"pk\": 3, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Prince\"}}, {\"pk\": 2, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Stephane Grappelli\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]', natural_keys=True)\n+        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 1, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"copyright\", \"tagged_id\": 3}}, {\"pk\": 2, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"law\", \"tagged_id\": 3}}, {\"pk\": 1, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Django Reinhardt\"}}, {\"pk\": 2, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Stephane Grappelli\"}}, {\"pk\": 3, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Prince\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]', natural_keys=True)\n \n         # Dump the current contents of the database as an XML fixture\n         self._dumpdata_assert(['fixtures'], \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n-<django-objects version=\"1.0\"><object pk=\"1\" model=\"fixtures.category\"><field type=\"CharField\" name=\"title\">News Stories</field><field type=\"TextField\" name=\"description\">Latest news stories</field></object><object pk=\"3\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Time to reform copyright</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T13:00:00</field></object><object pk=\"2\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Poker has no place on ESPN</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T12:00:00</field></object><object pk=\"1\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">copyright</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"2\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">law</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"1\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Django Reinhardt</field></object><object pk=\"3\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Prince</field></object><object pk=\"2\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Stephane Grappelli</field></object><object pk=\"10\" model=\"fixtures.book\"><field type=\"CharField\" name=\"name\">Achieving self-awareness of Python programs</field><field to=\"fixtures.person\" name=\"authors\" rel=\"ManyToManyRel\"></field></object></django-objects>\"\"\", format='xml', natural_keys=True)\n+<django-objects version=\"1.0\"><object pk=\"1\" model=\"fixtures.category\"><field type=\"CharField\" name=\"title\">News Stories</field><field type=\"TextField\" name=\"description\">Latest news stories</field></object><object pk=\"2\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Poker has no place on ESPN</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T12:00:00</field></object><object pk=\"3\" model=\"fixtures.article\"><field type=\"CharField\" name=\"headline\">Time to reform copyright</field><field type=\"DateTimeField\" name=\"pub_date\">2006-06-16T13:00:00</field></object><object pk=\"1\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">copyright</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"2\" model=\"fixtures.tag\"><field type=\"CharField\" name=\"name\">law</field><field to=\"contenttypes.contenttype\" name=\"tagged_type\" rel=\"ManyToOneRel\"><natural>fixtures</natural><natural>article</natural></field><field type=\"PositiveIntegerField\" name=\"tagged_id\">3</field></object><object pk=\"1\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Django Reinhardt</field></object><object pk=\"2\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Stephane Grappelli</field></object><object pk=\"3\" model=\"fixtures.person\"><field type=\"CharField\" name=\"name\">Prince</field></object><object pk=\"10\" model=\"fixtures.book\"><field type=\"CharField\" name=\"name\">Achieving self-awareness of Python programs</field><field to=\"fixtures.person\" name=\"authors\" rel=\"ManyToManyRel\"></field></object></django-objects>\"\"\", format='xml', natural_keys=True)\n \n class FixtureTransactionTests(TransactionTestCase):\n     def _dumpdata_assert(self, args, output, format='json'):\n@@ -329,7 +329,7 @@ def test_format_discovery(self):\n         ])\n \n         # Dump the current contents of the database as a JSON fixture\n-        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n+        self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]')\n \n         # Load fixture 4 (compressed), using format discovery\n         management.call_command('loaddata', 'fixture4', verbosity=0, commit=False)"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/modeltests/known_related_objects/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fknown_related_objects%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "2f2b1c56276688a023ee2c416657d500c5539b2a",
            "filename": "tests/modeltests/known_related_objects/fixtures/tournament.json",
            "status": "added",
            "additions": 65,
            "deletions": 0,
            "changes": 65,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2Ffixtures%2Ftournament.json",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2Ffixtures%2Ftournament.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fknown_related_objects%2Ffixtures%2Ftournament.json?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -0,0 +1,65 @@\n+[\n+    {\n+        \"pk\": 1,\n+        \"model\": \"known_related_objects.tournament\",\n+        \"fields\": {\n+            \"name\": \"Tourney 1\"\n+            }\n+        },\n+    {\n+        \"pk\": 2,\n+        \"model\": \"known_related_objects.tournament\",\n+        \"fields\": {\n+            \"name\": \"Tourney 2\"\n+            }\n+        },\n+    {\n+        \"pk\": 1,\n+        \"model\": \"known_related_objects.pool\",\n+        \"fields\": {\n+            \"tournament\": 1,\n+            \"name\": \"T1 Pool 1\"\n+            }\n+        },\n+    {\n+        \"pk\": 2,\n+        \"model\": \"known_related_objects.pool\",\n+        \"fields\": {\n+            \"tournament\": 1,\n+            \"name\": \"T1 Pool 2\"\n+            }\n+        },\n+    {\n+        \"pk\": 3,\n+        \"model\": \"known_related_objects.pool\",\n+        \"fields\": {\n+            \"tournament\": 2,\n+            \"name\": \"T2 Pool 1\"\n+            }\n+        },\n+    {\n+        \"pk\": 4,\n+        \"model\": \"known_related_objects.pool\",\n+        \"fields\": {\n+            \"tournament\": 2,\n+            \"name\": \"T2 Pool 2\"\n+            }\n+        },\n+    {\n+        \"pk\": 1,\n+        \"model\": \"known_related_objects.poolstyle\",\n+        \"fields\": {\n+            \"name\": \"T1 Pool 2 Style\",\n+            \"pool\": 2\n+            }\n+        },\n+    {\n+        \"pk\": 2,\n+        \"model\": \"known_related_objects.poolstyle\",\n+        \"fields\": {\n+            \"name\": \"T2 Pool 1 Style\",\n+            \"pool\": 3\n+            }\n+        }\n+]\n+"
        },
        {
            "sha": "4c516dd7e89f79c505e7508a0bd9ea0465f174ea",
            "filename": "tests/modeltests/known_related_objects/models.py",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fknown_related_objects%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -0,0 +1,19 @@\n+\"\"\"\n+Existing related object instance caching.\n+\n+Test that queries are not redone when going back through known relations.\n+\"\"\"\n+\n+from django.db import models\n+\n+class Tournament(models.Model):\n+    name = models.CharField(max_length=30)\n+\n+class Pool(models.Model):\n+    name = models.CharField(max_length=30)\n+    tournament = models.ForeignKey(Tournament)\n+\n+class PoolStyle(models.Model):\n+    name = models.CharField(max_length=30)\n+    pool = models.OneToOneField(Pool)\n+"
        },
        {
            "sha": "24feab22419cd5e3a46d09fa0a78a70861bf44af",
            "filename": "tests/modeltests/known_related_objects/tests.py",
            "status": "added",
            "additions": 88,
            "deletions": 0,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fknown_related_objects%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fknown_related_objects%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -0,0 +1,88 @@\n+from __future__ import absolute_import\n+\n+from django.test import TestCase\n+\n+from .models import Tournament, Pool, PoolStyle\n+\n+class ExistingRelatedInstancesTests(TestCase):\n+    fixtures = ['tournament.json']\n+\n+    def test_foreign_key(self):\n+        with self.assertNumQueries(2):\n+            tournament = Tournament.objects.get(pk=1)\n+            pool = tournament.pool_set.all()[0]\n+            self.assertIs(tournament, pool.tournament)\n+\n+    def test_foreign_key_prefetch_related(self):\n+        with self.assertNumQueries(2):\n+            tournament = (Tournament.objects.prefetch_related('pool_set').get(pk=1))\n+            pool = tournament.pool_set.all()[0]\n+            self.assertIs(tournament, pool.tournament)\n+\n+    def test_foreign_key_multiple_prefetch(self):\n+        with self.assertNumQueries(2):\n+            tournaments = list(Tournament.objects.prefetch_related('pool_set'))\n+            pool1 = tournaments[0].pool_set.all()[0]\n+            self.assertIs(tournaments[0], pool1.tournament)\n+            pool2 = tournaments[1].pool_set.all()[0]\n+            self.assertIs(tournaments[1], pool2.tournament)\n+\n+    def test_one_to_one(self):\n+        with self.assertNumQueries(2):\n+            style = PoolStyle.objects.get(pk=1)\n+            pool = style.pool\n+            self.assertIs(style, pool.poolstyle)\n+\n+    def test_one_to_one_select_related(self):\n+        with self.assertNumQueries(1):\n+            style = PoolStyle.objects.select_related('pool').get(pk=1)\n+            pool = style.pool\n+            self.assertIs(style, pool.poolstyle)\n+\n+    def test_one_to_one_multi_select_related(self):\n+        with self.assertNumQueries(1):\n+            poolstyles = list(PoolStyle.objects.select_related('pool'))\n+            self.assertIs(poolstyles[0], poolstyles[0].pool.poolstyle)\n+            self.assertIs(poolstyles[1], poolstyles[1].pool.poolstyle)\n+\n+    def test_one_to_one_prefetch_related(self):\n+        with self.assertNumQueries(2):\n+            style = PoolStyle.objects.prefetch_related('pool').get(pk=1)\n+            pool = style.pool\n+            self.assertIs(style, pool.poolstyle)\n+\n+    def test_one_to_one_multi_prefetch_related(self):\n+        with self.assertNumQueries(2):\n+            poolstyles = list(PoolStyle.objects.prefetch_related('pool'))\n+            self.assertIs(poolstyles[0], poolstyles[0].pool.poolstyle)\n+            self.assertIs(poolstyles[1], poolstyles[1].pool.poolstyle)\n+\n+    def test_reverse_one_to_one(self):\n+        with self.assertNumQueries(2):\n+            pool = Pool.objects.get(pk=2)\n+            style = pool.poolstyle\n+            self.assertIs(pool, style.pool)\n+\n+    def test_reverse_one_to_one_select_related(self):\n+        with self.assertNumQueries(1):\n+            pool = Pool.objects.select_related('poolstyle').get(pk=2)\n+            style = pool.poolstyle\n+            self.assertIs(pool, style.pool)\n+\n+    def test_reverse_one_to_one_prefetch_related(self):\n+        with self.assertNumQueries(2):\n+            pool = Pool.objects.prefetch_related('poolstyle').get(pk=2)\n+            style = pool.poolstyle\n+            self.assertIs(pool, style.pool)\n+\n+    def test_reverse_one_to_one_multi_select_related(self):\n+        with self.assertNumQueries(1):\n+            pools = list(Pool.objects.select_related('poolstyle'))\n+            self.assertIs(pools[1], pools[1].poolstyle.pool)\n+            self.assertIs(pools[2], pools[2].poolstyle.pool)\n+\n+    def test_reverse_one_to_one_multi_prefetch_related(self):\n+        with self.assertNumQueries(2):\n+            pools = list(Pool.objects.prefetch_related('poolstyle'))\n+            self.assertIs(pools[1], pools[1].poolstyle.pool)\n+            self.assertIs(pools[2], pools[2].poolstyle.pool)"
        },
        {
            "sha": "af8bcbca4e5a23bdfd0e6b0f6047e30e5f8b12b6",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1126,7 +1126,7 @@ def test_file_field(self):\n \n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n+                files={'file': SimpleUploadedFile('test1.txt', b'hello world')})\n         self.assertEqual(f.is_valid(), True)\n         self.assertEqual(type(f.cleaned_data['file']), SimpleUploadedFile)\n         instance = f.save()\n@@ -1135,7 +1135,7 @@ def test_file_field(self):\n         instance.file.delete()\n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n+                files={'file': SimpleUploadedFile('test1.txt', b'hello world')})\n         self.assertEqual(f.is_valid(), True)\n         self.assertEqual(type(f.cleaned_data['file']), SimpleUploadedFile)\n         instance = f.save()\n@@ -1144,7 +1144,7 @@ def test_file_field(self):\n         # Check if the max_length attribute has been inherited from the model.\n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test-maxlength.txt', 'hello world')})\n+                files={'file': SimpleUploadedFile('test-maxlength.txt', b'hello world')})\n         self.assertEqual(f.is_valid(), False)\n \n         # Edit an instance that already has the file defined in the model. This will not\n@@ -1165,7 +1165,7 @@ def test_file_field(self):\n \n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test2.txt', 'hello world')}, instance=instance)\n+                files={'file': SimpleUploadedFile('test2.txt', b'hello world')}, instance=instance)\n         self.assertEqual(f.is_valid(), True)\n         instance = f.save()\n         self.assertEqual(instance.file.name, 'tests/test2.txt')\n@@ -1174,7 +1174,7 @@ def test_file_field(self):\n         instance.file.delete()\n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test2.txt', 'hello world')})\n+                files={'file': SimpleUploadedFile('test2.txt', b'hello world')})\n         self.assertEqual(f.is_valid(), True)\n         instance = f.save()\n         self.assertEqual(instance.file.name, 'tests/test2.txt')\n@@ -1193,7 +1193,7 @@ def test_file_field(self):\n \n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test3.txt', 'hello world')}, instance=instance)\n+                files={'file': SimpleUploadedFile('test3.txt', b'hello world')}, instance=instance)\n         self.assertEqual(f.is_valid(), True)\n         instance = f.save()\n         self.assertEqual(instance.file.name, 'tests/test3.txt')\n@@ -1215,7 +1215,7 @@ def test_file_field(self):\n \n         f = TextFileForm(\n                 data={'description': u'Assistance'},\n-                files={'file': SimpleUploadedFile('test3.txt', 'hello world')})\n+                files={'file': SimpleUploadedFile('test3.txt', b'hello world')})\n         self.assertEqual(f.is_valid(), True)\n         instance = f.save()\n         self.assertEqual(instance.file.name, 'tests/test3.txt')"
        },
        {
            "sha": "695d3f836c68f9b5b348887583fcb72f7f81352c",
            "filename": "tests/modeltests/model_inheritance/tests.py",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fmodel_inheritance%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fmodel_inheritance%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_inheritance%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -275,3 +275,21 @@ def test_multiple_table(self):\n     def test_mixin_init(self):\n         m = MixinModel()\n         self.assertEqual(m.other_attr, 1)\n+\n+    def test_update_query_counts(self):\n+        \"\"\"\n+        Test that update queries do not generate non-necessary queries.\n+        Refs #18304.\n+        \"\"\"\n+        c = Chef.objects.create(name=\"Albert\")\n+        ir = ItalianRestaurant.objects.create(\n+            name=\"Ristorante Miron\",\n+            address=\"1234 W. Ash\",\n+            serves_hot_dogs=False,\n+            serves_pizza=False,\n+            serves_gnocchi=True,\n+            rating=4,\n+            chef=c\n+        )\n+        with self.assertNumQueries(6):\n+            ir.save()"
        },
        {
            "sha": "e792c944a10eb32d4620daadf3b716f98396ddc3",
            "filename": "tests/modeltests/serializers/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fserializers%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -113,8 +113,8 @@ def test_altering_serialized_output(self):\n         Tests the ability to create new objects by\n         modifying serialized content.\n         \"\"\"\n-        old_headline = \"Poker has no place on ESPN\"\n-        new_headline = \"Poker has no place on television\"\n+        old_headline = b\"Poker has no place on ESPN\"\n+        new_headline = b\"Poker has no place on television\"\n         serial_str = serializers.serialize(self.serializer_name,\n                                            Article.objects.all())\n         serial_str = serial_str.replace(old_headline, new_headline)\n@@ -284,7 +284,7 @@ def test_forward_refs(self):\n \n class XmlSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"xml\"\n-    pkless_str = \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+    pkless_str = b\"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object model=\"serializers.category\">\n         <field type=\"CharField\" name=\"name\">Reference</field>\n@@ -330,7 +330,7 @@ def _get_field_values(serial_str, field_name):\n \n class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n     serializer_name = \"xml\"\n-    fwd_ref_str = \"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+    fwd_ref_str = b\"\"\"<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object pk=\"1\" model=\"serializers.article\">\n         <field to=\"serializers.author\" name=\"author\" rel=\"ManyToOneRel\">1</field>\n@@ -350,7 +350,7 @@ class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, Transacti\n \n class JsonSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"json\"\n-    pkless_str = \"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n+    pkless_str = b\"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n \n     @staticmethod\n     def _validate_output(serial_str):\n@@ -380,7 +380,7 @@ def _get_field_values(serial_str, field_name):\n \n class JsonSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n     serializer_name = \"json\"\n-    fwd_ref_str = \"\"\"[\n+    fwd_ref_str = b\"\"\"[\n     {\n         \"pk\": 1,\n         \"model\": \"serializers.article\",\n@@ -413,7 +413,7 @@ class JsonSerializerTransactionTestCase(SerializersTransactionTestBase, Transact\n else:\n     class YamlSerializerTestCase(SerializersTestBase, TestCase):\n         serializer_name = \"yaml\"\n-        fwd_ref_str = \"\"\"- fields:\n+        fwd_ref_str = b\"\"\"- fields:\n     headline: Forward references pose no problem\n     pub_date: 2006-06-16 15:00:00\n     categories: [1]\n@@ -429,7 +429,7 @@ class YamlSerializerTestCase(SerializersTestBase, TestCase):\n   pk: 1\n   model: serializers.author\"\"\"\n \n-        pkless_str = \"\"\"- fields:\n+        pkless_str = b\"\"\"- fields:\n     name: Reference\n   pk: null\n   model: serializers.category\"\"\"\n@@ -469,7 +469,7 @@ def _get_field_values(serial_str, field_name):\n \n     class YamlSerializerTransactionTestCase(SerializersTransactionTestBase, TransactionTestCase):\n         serializer_name = \"yaml\"\n-        fwd_ref_str = \"\"\"- fields:\n+        fwd_ref_str = b\"\"\"- fields:\n     headline: Forward references pose no problem\n     pub_date: 2006-06-16 15:00:00\n     categories: [1]"
        },
        {
            "sha": "1b0eb0972fa1c4ae59a274300e5c015fcd86298b",
            "filename": "tests/modeltests/str/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fstr%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fstr%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fstr%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -11,16 +11,16 @@\n class SimpleTests(TestCase):\n     def test_basic(self):\n         a = Article.objects.create(\n-            headline='Area man programs in Python',\n+            headline=b'Area man programs in Python',\n             pub_date=datetime.datetime(2005, 7, 28)\n         )\n-        self.assertEqual(str(a), 'Area man programs in Python')\n-        self.assertEqual(repr(a), '<Article: Area man programs in Python>')\n+        self.assertEqual(str(a), b'Area man programs in Python')\n+        self.assertEqual(repr(a), b'<Article: Area man programs in Python>')\n \n     def test_international(self):\n         a = InternationalArticle.objects.create(\n             headline=u'Girl wins ‚Ç¨12.500 in lottery',\n             pub_date=datetime.datetime(2005, 7, 28)\n         )\n         # The default str() output will be the UTF-8 encoded output of __unicode__().\n-        self.assertEqual(str(a), 'Girl wins \\xe2\\x82\\xac12.500 in lottery')\n\\ No newline at end of file\n+        self.assertEqual(str(a), b'Girl wins \\xe2\\x82\\xac12.500 in lottery')"
        },
        {
            "sha": "e843bd7ab94dbfe07105b0984d1158fdeb74b888",
            "filename": "tests/modeltests/update_only_fields/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,6 +1,6 @@\n from __future__ import absolute_import\n \n-from django.test import TestCase, skipUnlessDBFeature\n+from django.test import TestCase\n from django.db.models.signals import pre_save, post_save\n from .models import Person, Employee, ProxyEmployee, Profile, Account\n \n@@ -123,9 +123,6 @@ def post_save_receiver(**kwargs):\n         self.assertEqual(len(pre_save_data), 0)\n         self.assertEqual(len(post_save_data), 0)\n \n-    # A bug in SQLUpdateCompiler prevents this test from succeeding on MySQL\n-    # Require update_can_self_select for this test for now. Refs #18304.\n-    @skipUnlessDBFeature('update_can_self_select')\n     def test_num_queries_inheritance(self):\n         s = Employee.objects.create(name='Sara', gender='F')\n         s.employee_num = 1"
        },
        {
            "sha": "911530d223d85523cbb6027a3e03cc0cb1c23b26",
            "filename": "tests/modeltests/user_commands/management/commands/dance.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fuser_commands%2Fmanagement%2Fcommands%2Fdance.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fuser_commands%2Fmanagement%2Fcommands%2Fdance.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fuser_commands%2Fmanagement%2Fcommands%2Fdance.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,18 +1,20 @@\n from optparse import make_option\n \n-from django.core.management.base import BaseCommand\n+from django.core.management.base import BaseCommand, CommandError\n \n \n class Command(BaseCommand):\n     help = \"Dance around like a madman.\"\n     args = ''\n     requires_model_validation = True\n \n-    option_list =[\n+    option_list = BaseCommand.option_list + (\n         make_option(\"-s\", \"--style\", default=\"Rock'n'Roll\"),\n         make_option(\"-x\", \"--example\")\n-    ]\n+    )\n \n     def handle(self, *args, **options):\n         example = options[\"example\"]\n+        if example == \"raise\":\n+            raise CommandError()\n         self.stdout.write(\"I don't feel like dancing %s.\" % options[\"style\"])"
        },
        {
            "sha": "509f13f62f33aa0b55768ca0605d623046c2993b",
            "filename": "tests/modeltests/user_commands/tests.py",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fuser_commands%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fuser_commands%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fuser_commands%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,3 +1,4 @@\n+import sys\n from StringIO import StringIO\n \n from django.core import management\n@@ -11,13 +12,13 @@ def test_command(self):\n         out = StringIO()\n         management.call_command('dance', stdout=out)\n         self.assertEqual(out.getvalue(),\n-            \"I don't feel like dancing Rock'n'Roll.\")\n+            \"I don't feel like dancing Rock'n'Roll.\\n\")\n \n     def test_command_style(self):\n         out = StringIO()\n         management.call_command('dance', style='Jive', stdout=out)\n         self.assertEqual(out.getvalue(),\n-            \"I don't feel like dancing Jive.\")\n+            \"I don't feel like dancing Jive.\\n\")\n \n     def test_language_preserved(self):\n         out = StringIO()\n@@ -26,4 +27,20 @@ def test_language_preserved(self):\n             self.assertEqual(translation.get_language(), 'fr')\n \n     def test_explode(self):\n+        \"\"\" Test that an unknown command raises CommandError \"\"\"\n         self.assertRaises(CommandError, management.call_command, ('explode',))\n+\n+    def test_system_exit(self):\n+        \"\"\" Exception raised in a command should raise CommandError with\n+            call_command, but SystemExit when run from command line\n+        \"\"\"\n+        with self.assertRaises(CommandError):\n+            management.call_command('dance', example=\"raise\")\n+        old_stderr = sys.stderr\n+        sys.stderr = err = StringIO()\n+        try:\n+            with self.assertRaises(SystemExit):\n+                management.ManagementUtility(['manage.py', 'dance', '--example=raise']).execute()\n+        finally:\n+            sys.stderr = old_stderr\n+        self.assertIn(\"CommandError\", err.getvalue())"
        },
        {
            "sha": "4aea3d52de690474ed652264db81a35761c5cf7c",
            "filename": "tests/modeltests/validation/test_error_messages.py",
            "status": "modified",
            "additions": 52,
            "deletions": 104,
            "changes": 156,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,146 +1,94 @@\n+# -*- encoding: utf-8 -*-\n from django.core.exceptions import ValidationError\n from django.db import models\n from django.utils.unittest import TestCase\n \n \n class ValidationMessagesTest(TestCase):\n \n+    def _test_validation_messages(self, field, value, expected):\n+        with self.assertRaises(ValidationError) as cm:\n+            field.clean(value, None)\n+        self.assertEqual(cm.exception.messages, expected)\n+\n     def test_autofield_field_raises_error_message(self):\n         f = models.AutoField(primary_key=True)\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [u\"'foo' value must be an integer.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value must be an integer.\"])\n         # primary_key must be True. Refs #12467.\n-        self.assertRaises(AssertionError, models.AutoField, 'primary_key', False)\n-        try:\n+        with self.assertRaisesRegexp(AssertionError,\n+                \"AutoFields must have primary_key=True.\"):\n             models.AutoField(primary_key=False)\n-        except AssertionError as e:\n-            self.assertEqual(str(e), \"AutoFields must have primary_key=True.\")\n \n     def test_integer_field_raises_error_message(self):\n         f = models.IntegerField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [u\"'foo' value must be an integer.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value must be an integer.\"])\n \n     def test_boolean_field_raises_error_message(self):\n         f = models.BooleanField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages,\n-                        [u\"'foo' value must be either True or False.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value must be either True or False.\"])\n \n     def test_float_field_raises_error_message(self):\n         f = models.FloatField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [u\"'foo' value must be a float.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value must be a float.\"])\n \n     def test_decimal_field_raises_error_message(self):\n         f = models.DecimalField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages,\n-                        [u\"'foo' value must be a decimal number.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value must be a decimal number.\"])\n \n     def test_null_boolean_field_raises_error_message(self):\n         f = models.NullBooleanField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages,\n-                        [u\"'foo' value must be either None, True or False.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value must be either None, True or False.\"])\n \n     def test_date_field_raises_error_message(self):\n         f = models.DateField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'foo' value has an invalid date format. \"\n-                u\"It must be in YYYY-MM-DD format.\"])\n-\n-        self.assertRaises(ValidationError, f.clean, 'aaaa-10-10', None)\n-        try:\n-            f.clean('aaaa-10-10', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'aaaa-10-10' value has an invalid date format. \"\n-                u\"It must be in YYYY-MM-DD format.\"])\n-\n-        self.assertRaises(ValidationError, f.clean, '2011-13-10', None)\n-        try:\n-            f.clean('2011-13-10', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-13-10' value has the correct format (YYYY-MM-DD) \"\n-                u\"but it is an invalid date.\"])\n-\n-        self.assertRaises(ValidationError, f.clean, '2011-10-32', None)\n-        try:\n-            f.clean('2011-10-32', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-10-32' value has the correct format (YYYY-MM-DD) \"\n-                u\"but it is an invalid date.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value has an invalid date format. \"\n+             u\"It must be in YYYY-MM-DD format.\"])\n+\n+        self._test_validation_messages(f, 'aaaa-10-10',\n+            [u\"'aaaa-10-10' value has an invalid date format. \"\n+             u\"It must be in YYYY-MM-DD format.\"])\n+\n+        self._test_validation_messages(f, '2011-13-10',\n+            [u\"'2011-13-10' value has the correct format (YYYY-MM-DD) \"\n+             u\"but it is an invalid date.\"])\n+\n+        self._test_validation_messages(f, '2011-10-32',\n+            [u\"'2011-10-32' value has the correct format (YYYY-MM-DD) \"\n+             u\"but it is an invalid date.\"])\n \n     def test_datetime_field_raises_error_message(self):\n         f = models.DateTimeField()\n         # Wrong format\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'foo' value has an invalid format. It must be \"\n-                u\"in YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ] format.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value has an invalid format. It must be \"\n+             u\"in YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ] format.\"])\n \n         # Correct format but invalid date\n-        self.assertRaises(ValidationError, f.clean, '2011-10-32', None)\n-        try:\n-            f.clean('2011-10-32', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-10-32' value has the correct format \"\n-                u\"(YYYY-MM-DD) but it is an invalid date.\"])\n+        self._test_validation_messages(f, '2011-10-32',\n+            [u\"'2011-10-32' value has the correct format \"\n+             u\"(YYYY-MM-DD) but it is an invalid date.\"])\n \n         # Correct format but invalid date/time\n-        self.assertRaises(ValidationError, f.clean, '2011-10-32 10:10', None)\n-        try:\n-            f.clean('2011-10-32 10:10', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-10-32 10:10' value has the correct format \"\n-                u\"(YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]) \"\n-                u\"but it is an invalid date/time.\"])\n+        self._test_validation_messages(f, '2011-10-32 10:10',\n+            [u\"'2011-10-32 10:10' value has the correct format \"\n+             u\"(YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]) \"\n+             u\"but it is an invalid date/time.\"])\n \n     def test_time_field_raises_error_message(self):\n         f = models.TimeField()\n         # Wrong format\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'foo' value has an invalid format. It must be in \"\n-                u\"HH:MM[:ss[.uuuuuu]] format.\"])\n+        self._test_validation_messages(f, u'f√µo',\n+            [u\"'f√µo' value has an invalid format. It must be in \"\n+             u\"HH:MM[:ss[.uuuuuu]] format.\"])\n+\n         # Correct format but invalid time\n-        self.assertRaises(ValidationError, f.clean, '25:50', None)\n-        try:\n-            f.clean('25:50', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'25:50' value has the correct format \"\n-                u\"(HH:MM[:ss[.uuuuuu]]) but it is an invalid time.\"])\n+        self._test_validation_messages(f, '25:50',\n+            [u\"'25:50' value has the correct format \"\n+             u\"(HH:MM[:ss[.uuuuuu]]) but it is an invalid time.\"])"
        },
        {
            "sha": "ecb16df53a000d9b2937ff9b08e4e7704a0a7a1c",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -13,13 +13,12 @@\n \n from django import conf, bin, get_version\n from django.conf import settings\n+from django.db import connection\n from django.test.simple import DjangoTestSuiteRunner\n from django.utils import unittest\n from django.test import LiveServerTestCase\n \n test_dir = os.path.dirname(os.path.dirname(__file__))\n-expected_query_re = re.compile(r'CREATE TABLE [`\"]admin_scripts_article[`\"]', re.IGNORECASE)\n-\n \n class AdminScriptTestCase(unittest.TestCase):\n     def write_settings(self, filename, apps=None, is_dir=False, sdict=None):\n@@ -859,14 +858,18 @@ def test_builtin_with_settings(self):\n         \"alternate: manage.py builtin commands work with settings provided as argument\"\n         args = ['sqlall', '--settings=alternate_settings', 'admin_scripts']\n         out, err = self.run_manage(args)\n-        self.assertRegexpMatches(out, expected_query_re)\n+        expected = ('create table %s'\n+                    % connection.ops.quote_name('admin_scripts_article'))\n+        self.assertTrue(expected.lower() in out.lower())\n         self.assertNoOutput(err)\n \n     def test_builtin_with_environment(self):\n         \"alternate: manage.py builtin commands work if settings are provided in the environment\"\n         args = ['sqlall', 'admin_scripts']\n         out, err = self.run_manage(args, 'alternate_settings')\n-        self.assertRegexpMatches(out, expected_query_re)\n+        expected = ('create table %s'\n+                    % connection.ops.quote_name('admin_scripts_article'))\n+        self.assertTrue(expected.lower() in out.lower())\n         self.assertNoOutput(err)\n \n     def test_builtin_with_bad_settings(self):"
        },
        {
            "sha": "055f494dcd541960d39ac11f297547a69e77bada",
            "filename": "tests/regressiontests/admin_util/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fadmin_util%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fadmin_util%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_util%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -170,7 +170,7 @@ def test_label_for_field(self):\n         )\n         self.assertEqual(\n             label_for_field(\"__str__\", Article),\n-            \"article\"\n+            b\"article\"\n         )\n \n         self.assertRaises("
        },
        {
            "sha": "be1d2940512b72c45f329a3b96eeeacd4f8fd81c",
            "filename": "tests/regressiontests/admin_widgets/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_widgets%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -280,7 +280,7 @@ def test_render(self):\n         )\n \n         self.assertHTMLEqual(\n-            conditional_escape(w.render('test', SimpleUploadedFile('test', 'content'))),\n+            conditional_escape(w.render('test', SimpleUploadedFile('test', b'content'))),\n             '<input type=\"file\" name=\"test\" />',\n         )\n "
        },
        {
            "sha": "109e1a5bcc3e06bb8da02ae2dd5595b626bf6adf",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -89,6 +89,12 @@ def test_autoincrement(self):\n         else:\n             self.assertFalse(found_reset)\n \n+    @unittest.skipUnless(connection.vendor == 'mysql',\n+                        \"Test valid only for MySQL\")\n+    def test_server_version_connections(self):\n+        connection.close()\n+        connection.mysql_version\n+        self.assertTrue(connection.connection is None)\n \n class DateQuotingTest(TestCase):\n \n@@ -397,6 +403,12 @@ def test_database_operations_helper_class(self):\n         self.assertTrue(hasattr(connection.ops, 'connection'))\n         self.assertEqual(connection, connection.ops.connection)\n \n+    def test_supports_needed_confirm(self):\n+        connection.features.confirm()\n+        self.assertIn(connection.features.supports_transactions, (True, False))\n+        self.assertIn(connection.features.supports_stddev, (True, False))\n+        self.assertIn(connection.features.can_introspect_foreign_keys, (True, False))\n+\n     def test_duplicate_table_error(self):\n         \"\"\" Test that creating an existing table returns a DatabaseError \"\"\"\n         cursor = connection.cursor()"
        },
        {
            "sha": "88fe5471cf2d8c28321a29eba506cb2958618700",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -7,7 +7,6 @@\n import hashlib\n import os\n import re\n-import StringIO\n import tempfile\n import time\n import warnings\n@@ -820,9 +819,14 @@ def test_old_initialization(self):\n         self.perform_cull_test(50, 18)\n \n     def test_second_call_doesnt_crash(self):\n-        err = StringIO.StringIO()\n-        management.call_command('createcachetable', self._table_name, verbosity=0, interactive=False, stderr=err)\n-        self.assertTrue(\"Cache table 'test cache table' could not be created\" in err.getvalue())\n+        with self.assertRaisesRegexp(management.CommandError,\n+                \"Cache table 'test cache table' could not be created\"):\n+            management.call_command(\n+               'createcachetable',\n+                self._table_name,\n+                verbosity=0,\n+                interactive=False\n+            )\n \n \n @override_settings(USE_TZ=True)"
        },
        {
            "sha": "97aeff5eaa0f262daa8ac36207db8cf496aa6b12",
            "filename": "tests/regressiontests/conditional_processing/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fconditional_processing%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fconditional_processing%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fconditional_processing%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -63,10 +63,10 @@ def testIfNoneMatch(self):\n \n     def testIfMatch(self):\n         self.client.defaults['HTTP_IF_MATCH'] = '\"%s\"' % ETAG\n-        response = self.client.put('/condition/etag/', {'data': ''})\n+        response = self.client.put('/condition/etag/')\n         self.assertEqual(response.status_code, 200)\n         self.client.defaults['HTTP_IF_MATCH'] = '\"%s\"' % EXPIRED_ETAG\n-        response = self.client.put('/condition/etag/', {'data': ''})\n+        response = self.client.put('/condition/etag/')\n         self.assertEqual(response.status_code, 412)\n \n     def testBothHeaders(self):"
        },
        {
            "sha": "2d9b4f755fa86a47a5d19318a69446c754374f87",
            "filename": "tests/regressiontests/csrf_tests/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -47,7 +47,7 @@ def is_secure(self):\n class CsrfViewMiddlewareTest(TestCase):\n     # The csrf token is potentially from an untrusted source, so could have\n     # characters that need dealing with.\n-    _csrf_id_cookie = \"<1>\\xc2\\xa1\"\n+    _csrf_id_cookie = b\"<1>\\xc2\\xa1\"\n     _csrf_id = \"1\"\n \n     def _get_GET_no_csrf_cookie_request(self):"
        },
        {
            "sha": "87035d96d70a97a45c1caa52f157fe34adc5cd7b",
            "filename": "tests/regressiontests/file_storage/tests.py",
            "status": "modified",
            "additions": 27,
            "deletions": 27,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_storage%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -127,7 +127,7 @@ def test_file_accessed_time(self):\n         \"\"\"\n         self.assertFalse(self.storage.exists('test.file'))\n \n-        f = ContentFile('custom contents')\n+        f = ContentFile(b'custom contents')\n         f_name = self.storage.save('test.file', f)\n         atime = self.storage.accessed_time(f_name)\n \n@@ -143,7 +143,7 @@ def test_file_created_time(self):\n         \"\"\"\n         self.assertFalse(self.storage.exists('test.file'))\n \n-        f = ContentFile('custom contents')\n+        f = ContentFile(b'custom contents')\n         f_name = self.storage.save('test.file', f)\n         ctime = self.storage.created_time(f_name)\n \n@@ -160,7 +160,7 @@ def test_file_modified_time(self):\n         \"\"\"\n         self.assertFalse(self.storage.exists('test.file'))\n \n-        f = ContentFile('custom contents')\n+        f = ContentFile(b'custom contents')\n         f_name = self.storage.save('test.file', f)\n         mtime = self.storage.modified_time(f_name)\n \n@@ -177,7 +177,7 @@ def test_file_save_without_name(self):\n         \"\"\"\n         self.assertFalse(self.storage.exists('test.file'))\n \n-        f = ContentFile('custom contents')\n+        f = ContentFile(b'custom contents')\n         f.name = 'test.file'\n \n         storage_f_name = self.storage.save(None, f)\n@@ -194,11 +194,11 @@ def test_file_save_with_path(self):\n         \"\"\"\n         self.assertFalse(self.storage.exists('path/to'))\n         self.storage.save('path/to/test.file',\n-            ContentFile('file saved with path'))\n+            ContentFile(b'file saved with path'))\n \n         self.assertTrue(self.storage.exists('path/to'))\n         self.assertEqual(self.storage.open('path/to/test.file').read(),\n-            'file saved with path')\n+            b'file saved with path')\n \n         self.assertTrue(os.path.exists(\n             os.path.join(self.temp_dir, 'path', 'to', 'test.file')))\n@@ -211,7 +211,7 @@ def test_file_path(self):\n         \"\"\"\n         self.assertFalse(self.storage.exists('test.file'))\n \n-        f = ContentFile('custom contents')\n+        f = ContentFile(b'custom contents')\n         f_name = self.storage.save('test.file', f)\n \n         self.assertEqual(self.storage.path(f_name),\n@@ -246,8 +246,8 @@ def test_listdir(self):\n         self.assertFalse(self.storage.exists('storage_test_2'))\n         self.assertFalse(self.storage.exists('storage_dir_1'))\n \n-        f = self.storage.save('storage_test_1', ContentFile('custom content'))\n-        f = self.storage.save('storage_test_2', ContentFile('custom content'))\n+        f = self.storage.save('storage_test_1', ContentFile(b'custom content'))\n+        f = self.storage.save('storage_test_2', ContentFile(b'custom content'))\n         os.mkdir(os.path.join(self.temp_dir, 'storage_dir_1'))\n \n         dirs, files = self.storage.listdir('')\n@@ -304,18 +304,18 @@ def fake_makedirs(path):\n             os.makedirs = fake_makedirs\n \n             self.storage.save('normal/test.file',\n-                ContentFile('saved normally'))\n+                ContentFile(b'saved normally'))\n             self.assertEqual(self.storage.open('normal/test.file').read(),\n-                'saved normally')\n+                b'saved normally')\n \n             self.storage.save('raced/test.file',\n-                ContentFile('saved with race'))\n+                ContentFile(b'saved with race'))\n             self.assertEqual(self.storage.open('raced/test.file').read(),\n-                'saved with race')\n+                b'saved with race')\n \n             # Check that OSErrors aside from EEXIST are still raised.\n             self.assertRaises(OSError,\n-                self.storage.save, 'error/test.file', ContentFile('not saved'))\n+                self.storage.save, 'error/test.file', ContentFile(b'not saved'))\n         finally:\n             os.makedirs = real_makedirs\n \n@@ -341,16 +341,16 @@ def fake_remove(path):\n         try:\n             os.remove = fake_remove\n \n-            self.storage.save('normal.file', ContentFile('delete normally'))\n+            self.storage.save('normal.file', ContentFile(b'delete normally'))\n             self.storage.delete('normal.file')\n             self.assertFalse(self.storage.exists('normal.file'))\n \n-            self.storage.save('raced.file', ContentFile('delete with race'))\n+            self.storage.save('raced.file', ContentFile(b'delete with race'))\n             self.storage.delete('raced.file')\n             self.assertFalse(self.storage.exists('normal.file'))\n \n             # Check that OSErrors aside from ENOENT are still raised.\n-            self.storage.save('error.file', ContentFile('delete with error'))\n+            self.storage.save('error.file', ContentFile(b'delete with error'))\n             self.assertRaises(OSError, self.storage.delete, 'error.file')\n         finally:\n             os.remove = real_remove\n@@ -374,9 +374,9 @@ class CustomStorageTests(FileStorageTests):\n     storage_class = CustomStorage\n \n     def test_custom_get_available_name(self):\n-        first = self.storage.save('custom_storage', ContentFile('custom contents'))\n+        first = self.storage.save('custom_storage', ContentFile(b'custom contents'))\n         self.assertEqual(first, 'custom_storage')\n-        second = self.storage.save('custom_storage', ContentFile('more contents'))\n+        second = self.storage.save('custom_storage', ContentFile(b'more contents'))\n         self.assertEqual(second, 'custom_storage.2')\n         self.storage.delete(first)\n         self.storage.delete(second)\n@@ -410,7 +410,7 @@ def tearDown(self):\n         shutil.rmtree(self.storage_dir)\n \n     def save_file(self, name):\n-        name = self.storage.save(name, SlowFile(\"Data\"))\n+        name = self.storage.save(name, SlowFile(b\"Data\"))\n \n     def test_race_condition(self):\n         self.thread.start()\n@@ -433,7 +433,7 @@ def tearDown(self):\n         shutil.rmtree(self.storage_dir)\n \n     def test_file_upload_permissions(self):\n-        name = self.storage.save(\"the_file\", ContentFile(\"data\"))\n+        name = self.storage.save(\"the_file\", ContentFile(b\"data\"))\n         actual_mode = os.stat(self.storage.path(name))[0] & 0777\n         self.assertEqual(actual_mode, 0666)\n \n@@ -453,8 +453,8 @@ def test_directory_with_dot(self):\n         sure we still mangle the file name instead of the directory name.\n         \"\"\"\n \n-        self.storage.save('dotted.path/test', ContentFile(\"1\"))\n-        self.storage.save('dotted.path/test', ContentFile(\"2\"))\n+        self.storage.save('dotted.path/test', ContentFile(b\"1\"))\n+        self.storage.save('dotted.path/test', ContentFile(b\"2\"))\n \n         self.assertFalse(os.path.exists(os.path.join(self.storage_dir, 'dotted_.path')))\n         self.assertTrue(os.path.exists(os.path.join(self.storage_dir, 'dotted.path/test')))\n@@ -465,8 +465,8 @@ def test_first_character_dot(self):\n         File names with a dot as their first character don't have an extension,\n         and the underscore should get added to the end.\n         \"\"\"\n-        self.storage.save('dotted.path/.test', ContentFile(\"1\"))\n-        self.storage.save('dotted.path/.test', ContentFile(\"2\"))\n+        self.storage.save('dotted.path/.test', ContentFile(b\"1\"))\n+        self.storage.save('dotted.path/.test', ContentFile(b\"2\"))\n \n         self.assertTrue(os.path.exists(os.path.join(self.storage_dir, 'dotted.path/.test')))\n         self.assertTrue(os.path.exists(os.path.join(self.storage_dir, 'dotted.path/.test_1')))\n@@ -542,11 +542,11 @@ class ContentFileTestCase(unittest.TestCase):\n     Test that the constructor of ContentFile accepts 'name' (#16590).\n     \"\"\"\n     def test_content_file_default_name(self):\n-        self.assertEqual(ContentFile(\"content\").name, None)\n+        self.assertEqual(ContentFile(b\"content\").name, None)\n \n     def test_content_file_custom_name(self):\n         name = \"I can have a name too!\"\n-        self.assertEqual(ContentFile(\"content\", name=name).name, name)\n+        self.assertEqual(ContentFile(b\"content\", name=name).name, name)\n \n class NoNameFileTestCase(unittest.TestCase):\n     \"\"\""
        },
        {
            "sha": "c8de8035f9f965ea3992f7e2eff024987671cfb1",
            "filename": "tests/regressiontests/file_uploads/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -24,7 +24,7 @@\n \n class FileUploadTests(TestCase):\n     def test_simple_upload(self):\n-        with open(__file__) as fp:\n+        with open(__file__, 'rb') as fp:\n             post_data = {\n                 'name': 'Ringo',\n                 'file_field': fp,\n@@ -36,11 +36,11 @@ def test_large_upload(self):\n         tdir = tempfile.gettempdir()\n \n         file1 = tempfile.NamedTemporaryFile(suffix=\".file1\", dir=tdir)\n-        file1.write('a' * (2 ** 21))\n+        file1.write(b'a' * (2 ** 21))\n         file1.seek(0)\n \n         file2 = tempfile.NamedTemporaryFile(suffix=\".file2\", dir=tdir)\n-        file2.write('a' * (10 * 2 ** 20))\n+        file2.write(b'a' * (10 * 2 ** 20))\n         file2.seek(0)\n \n         post_data = {\n@@ -89,7 +89,7 @@ def test_unicode_file_name(self):\n \n         # This file contains chinese symbols and an accented char in the name.\n         with open(os.path.join(tdir, UNICODE_FILENAME.encode('utf-8')), 'w+b') as file1:\n-            file1.write('b' * (2 ** 10))\n+            file1.write(b'b' * (2 ** 10))\n             file1.seek(0)\n \n             post_data = {\n@@ -214,20 +214,20 @@ def test_empty_multipart_handled_gracefully(self):\n             'CONTENT_TYPE': client.MULTIPART_CONTENT,\n             'PATH_INFO': '/file_uploads/echo/',\n             'REQUEST_METHOD': 'POST',\n-            'wsgi.input': client.FakePayload(''),\n+            'wsgi.input': client.FakePayload(b''),\n         }\n         got = json.loads(self.client.request(**r).content)\n         self.assertEqual(got, {})\n \n     def test_custom_upload_handler(self):\n         # A small file (under the 5M quota)\n         smallfile = tempfile.NamedTemporaryFile()\n-        smallfile.write('a' * (2 ** 21))\n+        smallfile.write(b'a' * (2 ** 21))\n         smallfile.seek(0)\n \n         # A big file (over the quota)\n         bigfile = tempfile.NamedTemporaryFile()\n-        bigfile.write('a' * (10 * 2 ** 20))\n+        bigfile.write(b'a' * (10 * 2 ** 20))\n         bigfile.seek(0)\n \n         # Small file posting should work.\n@@ -242,7 +242,7 @@ def test_custom_upload_handler(self):\n \n     def test_broken_custom_upload_handler(self):\n         f = tempfile.NamedTemporaryFile()\n-        f.write('a' * (2 ** 21))\n+        f.write(b'a' * (2 ** 21))\n         f.seek(0)\n \n         # AttributeError: You cannot alter upload handlers after the upload has been processed.\n@@ -255,15 +255,15 @@ def test_broken_custom_upload_handler(self):\n \n     def test_fileupload_getlist(self):\n         file1 = tempfile.NamedTemporaryFile()\n-        file1.write('a' * (2 ** 23))\n+        file1.write(b'a' * (2 ** 23))\n         file1.seek(0)\n \n         file2 = tempfile.NamedTemporaryFile()\n-        file2.write('a' * (2 * 2 ** 18))\n+        file2.write(b'a' * (2 * 2 ** 18))\n         file2.seek(0)\n \n         file2a = tempfile.NamedTemporaryFile()\n-        file2a.write('a' * (5 * 2 ** 20))\n+        file2a.write(b'a' * (5 * 2 ** 20))\n         file2a.seek(0)\n \n         response = self.client.post('/file_uploads/getlist_count/', {\n@@ -299,14 +299,14 @@ def handle_uncaught_exception(self, request, resolver, exc_info):\n         # this test would fail.  So we need to know exactly what kind of error\n         # it raises when there is an attempt to read more than the available bytes:\n         try:\n-            client.FakePayload('a').read(2)\n+            client.FakePayload(b'a').read(2)\n         except Exception as reference_error:\n             pass\n \n         # install the custom handler that tries to access request.POST\n         self.client.handler = POSTAccessingHandler()\n \n-        with open(__file__) as fp:\n+        with open(__file__, 'rb') as fp:\n             post_data = {\n                 'name': 'Ringo',\n                 'file_field': fp,\n@@ -374,7 +374,7 @@ def test_readonly_root(self):\n         \"\"\"Permission errors are not swallowed\"\"\"\n         os.chmod(temp_storage.location, 0500)\n         try:\n-            self.obj.testfile.save('foo.txt', SimpleUploadedFile('foo.txt', 'x'))\n+            self.obj.testfile.save('foo.txt', SimpleUploadedFile('foo.txt', b'x'))\n         except OSError as err:\n             self.assertEqual(err.errno, errno.EACCES)\n         except Exception:\n@@ -383,9 +383,9 @@ def test_readonly_root(self):\n     def test_not_a_directory(self):\n         \"\"\"The correct IOError is raised when the upload directory name exists but isn't a directory\"\"\"\n         # Create a file with the upload directory name\n-        open(UPLOAD_TO, 'w').close()\n+        open(UPLOAD_TO, 'wb').close()\n         try:\n-            self.obj.testfile.save('foo.txt', SimpleUploadedFile('foo.txt', 'x'))\n+            self.obj.testfile.save('foo.txt', SimpleUploadedFile('foo.txt', b'x'))\n         except IOError as err:\n             # The test needs to be done on a specific string as IOError\n             # is raised even without the patch (just not early enough)"
        },
        {
            "sha": "0e2cc3a9b2c2d4bb491e5242572213be7a218e17",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -185,25 +185,6 @@ def test_empty(self):\n             \"No fixture data found for 'empty'. (File format may be invalid.)\\n\"\n         )\n \n-    def test_abort_loaddata_on_error(self):\n-        \"\"\"\n-        Test for ticket #4371 -- If any of the fixtures contain an error,\n-        loading is aborted.\n-        Validate that error conditions are caught correctly\n-        \"\"\"\n-        stderr = BytesIO()\n-        management.call_command(\n-            'loaddata',\n-            'empty',\n-            verbosity=0,\n-            commit=False,\n-            stderr=stderr,\n-        )\n-        self.assertEqual(\n-            stderr.getvalue(),\n-            \"No fixture data found for 'empty'. (File format may be invalid.)\\n\"\n-        )\n-\n     def test_error_message(self):\n         \"\"\"\n         (Regression for #9011 - error message is correct)"
        },
        {
            "sha": "4d442de382587ddbcca643400fb81fa9a4b88ba9",
            "filename": "tests/regressiontests/forms/tests/fields.py",
            "status": "modified",
            "additions": 29,
            "deletions": 30,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -478,6 +478,14 @@ def test_regexfield_5(self):\n         self.assertRaisesMessage(ValidationError, \"[u'Ensure this value has at most 10 characters (it has 11).']\", f.clean, '12345678901')\n         self.assertRaisesMessage(ValidationError, \"[u'Enter a valid value.']\", f.clean, '12345a')\n \n+    def test_regexfield_6(self):\n+        \"\"\"\n+        Ensure that it works with unicode characters.\n+        Refs #.\n+        \"\"\"\n+        f = RegexField('^\\w+$')\n+        self.assertEqual(u'√©√®√∏√ß√é√é‰Ω†Â•Ω', f.clean(u'√©√®√∏√ß√é√é‰Ω†Â•Ω'))\n+\n     def test_change_regex_after_init(self):\n         f = RegexField('^[a-z]+$')\n         f.regex = '^\\d+$'\n@@ -540,27 +548,27 @@ def test_filefield_1(self):\n         self.assertRaisesMessage(ValidationError, \"[u'This field is required.']\", f.clean, None)\n         self.assertRaisesMessage(ValidationError, \"[u'This field is required.']\", f.clean, None, '')\n         self.assertEqual('files/test2.pdf', f.clean(None, 'files/test2.pdf'))\n-        self.assertRaisesMessage(ValidationError, \"[u'No file was submitted. Check the encoding type on the form.']\", f.clean, SimpleUploadedFile('', ''))\n-        self.assertRaisesMessage(ValidationError, \"[u'No file was submitted. Check the encoding type on the form.']\", f.clean, SimpleUploadedFile('', ''), '')\n+        self.assertRaisesMessage(ValidationError, \"[u'No file was submitted. Check the encoding type on the form.']\", f.clean, SimpleUploadedFile('', b''))\n+        self.assertRaisesMessage(ValidationError, \"[u'No file was submitted. Check the encoding type on the form.']\", f.clean, SimpleUploadedFile('', b''), '')\n         self.assertEqual('files/test3.pdf', f.clean(None, 'files/test3.pdf'))\n         self.assertRaisesMessage(ValidationError, \"[u'No file was submitted. Check the encoding type on the form.']\", f.clean, 'some content that is not a file')\n         self.assertRaisesMessage(ValidationError, \"[u'The submitted file is empty.']\", f.clean, SimpleUploadedFile('name', None))\n-        self.assertRaisesMessage(ValidationError, \"[u'The submitted file is empty.']\", f.clean, SimpleUploadedFile('name', ''))\n-        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('name', 'Some File Content'))))\n-        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('ÊàëÈöªÊ∞£Â¢äËàπË£ùÊªøÊôíÈ±î.txt', '‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§Å‡§°‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§®‡§æ‡§µ ‡§∏‡§∞‡•ç‡§™‡§Æ‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π'))))\n-        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('name', 'Some File Content'), 'files/test4.pdf')))\n+        self.assertRaisesMessage(ValidationError, \"[u'The submitted file is empty.']\", f.clean, SimpleUploadedFile('name', b''))\n+        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('name', b'Some File Content'))))\n+        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('ÊàëÈöªÊ∞£Â¢äËàπË£ùÊªøÊôíÈ±î.txt', u'‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§Å‡§°‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§®‡§æ‡§µ ‡§∏‡§∞‡•ç‡§™‡§Æ‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π'.encode('utf-8')))))\n+        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('name', b'Some File Content'), 'files/test4.pdf')))\n \n     def test_filefield_2(self):\n         f = FileField(max_length = 5)\n-        self.assertRaisesMessage(ValidationError, \"[u'Ensure this filename has at most 5 characters (it has 18).']\", f.clean, SimpleUploadedFile('test_maxlength.txt', 'hello world'))\n+        self.assertRaisesMessage(ValidationError, \"[u'Ensure this filename has at most 5 characters (it has 18).']\", f.clean, SimpleUploadedFile('test_maxlength.txt', b'hello world'))\n         self.assertEqual('files/test1.pdf', f.clean('', 'files/test1.pdf'))\n         self.assertEqual('files/test2.pdf', f.clean(None, 'files/test2.pdf'))\n-        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('name', 'Some File Content'))))\n+        self.assertEqual(SimpleUploadedFile, type(f.clean(SimpleUploadedFile('name', b'Some File Content'))))\n \n     def test_filefield_3(self):\n         f = FileField(allow_empty_file=True)\n         self.assertEqual(SimpleUploadedFile,\n-                         type(f.clean(SimpleUploadedFile('name', ''))))\n+                         type(f.clean(SimpleUploadedFile('name', b''))))\n \n     # URLField ##################################################################\n \n@@ -977,39 +985,30 @@ def test_filepathfield_4(self):\n             self.assertTrue(got[0].endswith(exp[0]))\n \n     def test_filepathfield_folders(self):\n-        path = forms.__file__\n-        path = os.path.dirname(path) + '/'\n+        path = os.path.dirname(__file__) + '/filepath_test_files/'\n         f = FilePathField(path=path, allow_folders=True, allow_files=False)\n         f.choices.sort()\n         expected = [\n-            ('/django/forms/extras', 'extras'),\n+            ('/tests/regressiontests/forms/tests/filepath_test_files/directory', 'directory'),\n         ]\n         for exp, got in zip(expected, fix_os_paths(f.choices)):\n             self.assertEqual(exp[1], got[1])\n-            self.assert_(got[0].endswith(exp[0]))\n+            self.assertTrue(got[0].endswith(exp[0]))\n \n         f = FilePathField(path=path, allow_folders=True, allow_files=True)\n         f.choices.sort()\n         expected = [\n-            ('/django/forms/__init__.py', '__init__.py'),\n-            ('/django/forms/__init__.pyc', '__init__.pyc'),\n-            ('/django/forms/extras', 'extras'),\n-            ('/django/forms/fields.py', 'fields.py'),\n-            ('/django/forms/fields.pyc', 'fields.pyc'),\n-            ('/django/forms/forms.py', 'forms.py'),\n-            ('/django/forms/forms.pyc', 'forms.pyc'),\n-            ('/django/forms/formsets.py', 'formsets.py'),\n-            ('/django/forms/formsets.pyc', 'formsets.pyc'),\n-            ('/django/forms/models.py', 'models.py'),\n-            ('/django/forms/models.pyc', 'models.pyc'),\n-            ('/django/forms/util.py', 'util.py'),\n-            ('/django/forms/util.pyc', 'util.pyc'),\n-            ('/django/forms/widgets.py', 'widgets.py'),\n-            ('/django/forms/widgets.pyc', 'widgets.pyc')\n+            ('/tests/regressiontests/forms/tests/filepath_test_files/.dot-file', '.dot-file'),\n+            ('/tests/regressiontests/forms/tests/filepath_test_files/directory', 'directory'),\n+            ('/tests/regressiontests/forms/tests/filepath_test_files/fake-image.jpg', 'fake-image.jpg'),\n+            ('/tests/regressiontests/forms/tests/filepath_test_files/real-text-file.txt', 'real-text-file.txt'),\n         ]\n-        for exp, got in zip(expected, fix_os_paths(f.choices)):\n-            self.assertEqual(exp[1], got[1])\n+\n+        actual = fix_os_paths(f.choices)\n+        self.assertEqual(len(expected), len(actual))\n+        for exp, got in zip(expected, actual):\n             self.assertEqual(exp[1], got[1])\n+            self.assertTrue(got[0].endswith(exp[0]))\n \n \n     # SplitDateTimeField ##########################################################"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/forms/tests/filepath_test_files/.dot-file",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2F.dot-file",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2F.dot-file",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2F.dot-file?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/forms/tests/filepath_test_files/directory/.keep",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Fdirectory%2F.keep",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Fdirectory%2F.keep",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Fdirectory%2F.keep?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/forms/tests/filepath_test_files/fake-image.jpg",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Ffake-image.jpg",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Ffake-image.jpg",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Ffake-image.jpg?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/forms/tests/filepath_test_files/real-text-file.txt",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Freal-text-file.txt",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Freal-text-file.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffilepath_test_files%2Freal-text-file.txt?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "16cf46fc29b6b3097bc2807dfd23161c9955392f",
            "filename": "tests/regressiontests/forms/tests/forms.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1463,17 +1463,17 @@ class FileForm(Form):\n         f = FileForm(data={}, files={}, auto_id=False)\n         self.assertHTMLEqual(f.as_table(), '<tr><th>File1:</th><td><ul class=\"errorlist\"><li>This field is required.</li></ul><input type=\"file\" name=\"file1\" /></td></tr>')\n \n-        f = FileForm(data={}, files={'file1': SimpleUploadedFile('name', '')}, auto_id=False)\n+        f = FileForm(data={}, files={'file1': SimpleUploadedFile('name', b'')}, auto_id=False)\n         self.assertHTMLEqual(f.as_table(), '<tr><th>File1:</th><td><ul class=\"errorlist\"><li>The submitted file is empty.</li></ul><input type=\"file\" name=\"file1\" /></td></tr>')\n \n         f = FileForm(data={}, files={'file1': 'something that is not a file'}, auto_id=False)\n         self.assertHTMLEqual(f.as_table(), '<tr><th>File1:</th><td><ul class=\"errorlist\"><li>No file was submitted. Check the encoding type on the form.</li></ul><input type=\"file\" name=\"file1\" /></td></tr>')\n \n-        f = FileForm(data={}, files={'file1': SimpleUploadedFile('name', 'some content')}, auto_id=False)\n+        f = FileForm(data={}, files={'file1': SimpleUploadedFile('name', b'some content')}, auto_id=False)\n         self.assertHTMLEqual(f.as_table(), '<tr><th>File1:</th><td><input type=\"file\" name=\"file1\" /></td></tr>')\n         self.assertTrue(f.is_valid())\n \n-        f = FileForm(data={}, files={'file1': SimpleUploadedFile('ÊàëÈöªÊ∞£Â¢äËàπË£ùÊªøÊôíÈ±î.txt', '‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§Å‡§°‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§®‡§æ‡§µ ‡§∏‡§∞‡•ç‡§™‡§Æ‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π')}, auto_id=False)\n+        f = FileForm(data={}, files={'file1': SimpleUploadedFile('ÊàëÈöªÊ∞£Â¢äËàπË£ùÊªøÊôíÈ±î.txt', u'‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§Å‡§°‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§®‡§æ‡§µ ‡§∏‡§∞‡•ç‡§™‡§Æ‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π'.encode('utf-8'))}, auto_id=False)\n         self.assertHTMLEqual(f.as_table(), '<tr><th>File1:</th><td><input type=\"file\" name=\"file1\" /></td></tr>')\n \n     def test_basic_processing_in_view(self):"
        },
        {
            "sha": "7f569651c7dcce3cc2ce9031c8a30d342bae4c3b",
            "filename": "tests/regressiontests/forms/tests/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -106,7 +106,7 @@ def test_initial_instance_value(self):\n class FormsModelTestCase(TestCase):\n     def test_unicode_filename(self):\n         # FileModel with unicode filename and data #########################\n-        f = FileForm(data={}, files={'file1': SimpleUploadedFile('ÊàëÈöªÊ∞£Â¢äËàπË£ùÊªøÊôíÈ±î.txt', '‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§Å‡§°‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§®‡§æ‡§µ ‡§∏‡§∞‡•ç‡§™‡§Æ‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π')}, auto_id=False)\n+        f = FileForm(data={}, files={'file1': SimpleUploadedFile('ÊàëÈöªÊ∞£Â¢äËàπË£ùÊªøÊôíÈ±î.txt', u'‡§Æ‡•á‡§∞‡•Ä ‡§Æ‡§Å‡§°‡§∞‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§®‡§æ‡§µ ‡§∏‡§∞‡•ç‡§™‡§Æ‡•Ä‡§®‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞‡•Ä ‡§π'.encode('utf-8'))}, auto_id=False)\n         self.assertTrue(f.is_valid())\n         self.assertTrue('file1' in f.cleaned_data)\n         m = FileModel.objects.create(file=f.cleaned_data['file1'])\n@@ -177,7 +177,7 @@ class A(models.Model):\n         class Meta:\n             model=A\n \n-        self.assertRaises(ValueError, ModelFormMetaclass, 'Form', (ModelForm,), {'Meta': Meta})\n+        self.assertRaises(ValueError, ModelFormMetaclass, b'Form', (ModelForm,), {'Meta': Meta})\n \n         class B(models.Model):\n             pass\n@@ -195,4 +195,4 @@ class B(models.Model):\n         class Meta:\n             model=A\n \n-        self.assertTrue(issubclass(ModelFormMetaclass('Form', (ModelForm,), {'Meta': Meta}), ModelForm))\n+        self.assertTrue(issubclass(ModelFormMetaclass(b'Form', (ModelForm,), {'Meta': Meta}), ModelForm))"
        },
        {
            "sha": "20c11f99a86dac4f277d21028154a45f70cf2e84",
            "filename": "tests/regressiontests/forms/tests/regressions.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fregressions.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fregressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fregressions.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -54,10 +54,11 @@ class SomeForm(Form):\n \n         # Testing choice validation with UTF-8 bytestrings as input (these are the\n         # Russian abbreviations \"–º–µ—Å.\" and \"—à—Ç.\".\n-        UNITS = (('\\xd0\\xbc\\xd0\\xb5\\xd1\\x81.', '\\xd0\\xbc\\xd0\\xb5\\xd1\\x81.'), ('\\xd1\\x88\\xd1\\x82.', '\\xd1\\x88\\xd1\\x82.'))\n+        UNITS = ((b'\\xd0\\xbc\\xd0\\xb5\\xd1\\x81.', b'\\xd0\\xbc\\xd0\\xb5\\xd1\\x81.'),\n+                 (b'\\xd1\\x88\\xd1\\x82.', b'\\xd1\\x88\\xd1\\x82.'))\n         f = ChoiceField(choices=UNITS)\n         self.assertEqual(f.clean(u'\\u0448\\u0442.'), u'\\u0448\\u0442.')\n-        self.assertEqual(f.clean('\\xd1\\x88\\xd1\\x82.'), u'\\u0448\\u0442.')\n+        self.assertEqual(f.clean(b'\\xd1\\x88\\xd1\\x82.'), u'\\u0448\\u0442.')\n \n         # Translated error messages used to be buggy.\n         with override('ru'):"
        },
        {
            "sha": "8630b456665f3cc59c4943ec4f0e762a46f307ca",
            "filename": "tests/regressiontests/forms/tests/widgets.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1182,7 +1182,7 @@ def test_clear_input_checked_returns_false_only_if_not_required(self):\n         \"\"\"\n         widget = ClearableFileInput()\n         widget.is_required = True\n-        f = SimpleUploadedFile('something.txt', 'content')\n+        f = SimpleUploadedFile('something.txt', b'content')\n         self.assertEqual(widget.value_from_datadict(\n                 data={'myfile-clear': True},\n                 files={'myfile': f},"
        },
        {
            "sha": "fc3dc05fd75bd32a224bf14452b8e578846198bd",
            "filename": "tests/regressiontests/generic_views/base.py",
            "status": "modified",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -173,6 +173,58 @@ def test_dispatch_decoration(self):\n         \"\"\"\n         self.assertTrue(DecoratedDispatchView.as_view().is_decorated)\n \n+    def test_head_no_get(self):\n+        \"\"\"\n+        Test that a view class with no get responds to a HEAD request with HTTP\n+        405.\n+        \"\"\"\n+        request = self.rf.head('/')\n+        view = PostOnlyView.as_view()\n+        self.assertEqual(405, view(request).status_code)\n+\n+    def test_options(self):\n+        \"\"\"\n+        Test that views respond to HTTP OPTIONS requests with an Allow header\n+        appropriate for the methods implemented by the view class.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = SimpleView.as_view()\n+        response = view(request)\n+        self.assertEqual(200, response.status_code)\n+        self.assertTrue(response['Allow'])\n+\n+    def test_options_for_get_view(self):\n+        \"\"\"\n+        Test that a view implementing GET allows GET and HEAD.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = SimpleView.as_view()\n+        response = view(request)\n+        self._assert_allows(response, 'GET', 'HEAD')\n+\n+    def test_options_for_get_and_post_view(self):\n+        \"\"\"\n+        Test that a view implementing GET and POST allows GET, HEAD, and POST.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = SimplePostView.as_view()\n+        response = view(request)\n+        self._assert_allows(response, 'GET', 'HEAD', 'POST')\n+\n+    def test_options_for_post_view(self):\n+        \"\"\"\n+        Test that a view implementing POST allows POST.\n+        \"\"\"\n+        request = self.rf.options('/')\n+        view = PostOnlyView.as_view()\n+        response = view(request)\n+        self._assert_allows(response, 'POST')\n+\n+    def _assert_allows(self, response, *expected_methods):\n+        \"Assert allowed HTTP methods reported in the Allow response header\"\n+        response_allows = set(response['Allow'].split(', '))\n+        self.assertEqual(set(expected_methods + ('OPTIONS',)), response_allows)\n+\n \n class TemplateViewTest(TestCase):\n     urls = 'regressiontests.generic_views.urls'"
        },
        {
            "sha": "ad65fd9f10f042c72db85bf2e841e496564ced28",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 28,
            "deletions": 3,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -86,10 +86,15 @@ def test_paginated_archive_view_does_not_load_entire_table(self):\n         # 1 query for years list + 1 query for books\n         with self.assertNumQueries(2):\n             self.client.get('/dates/books/')\n-        # same as above + 1 query to test if books exist\n-        with self.assertNumQueries(3):\n+        # same as above + 1 query to test if books exist + 1 query to count them\n+        with self.assertNumQueries(4):\n             self.client.get('/dates/books/paginated/')\n \n+    def test_no_duplicate_query(self):\n+        # Regression test for #18354\n+        with self.assertNumQueries(2):\n+            self.client.get('/dates/books/reverse/')\n+\n     def test_datetime_archive_view(self):\n         BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n         res = self.client.get('/dates/booksignings/')\n@@ -110,9 +115,13 @@ def test_year_view(self):\n         res = self.client.get('/dates/books/2008/')\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(list(res.context['date_list']), [datetime.datetime(2008, 10, 1)])\n-        self.assertEqual(res.context['year'], '2008')\n+        self.assertEqual(res.context['year'], datetime.date(2008, 1, 1))\n         self.assertTemplateUsed(res, 'generic_views/book_archive_year.html')\n \n+        # Since allow_empty=False, next/prev years must be valid (#7164)\n+        self.assertEqual(res.context['next_year'], None)\n+        self.assertEqual(res.context['previous_year'], datetime.date(2006, 1, 1))\n+\n     def test_year_view_make_object_list(self):\n         res = self.client.get('/dates/books/2006/make_object_list/')\n         self.assertEqual(res.status_code, 200)\n@@ -129,6 +138,10 @@ def test_year_view_empty(self):\n         self.assertEqual(list(res.context['date_list']), [])\n         self.assertEqual(list(res.context['book_list']), [])\n \n+        # Since allow_empty=True, next/prev are allowed to be empty years (#7164)\n+        self.assertEqual(res.context['next_year'], datetime.date(2000, 1, 1))\n+        self.assertEqual(res.context['previous_year'], datetime.date(1998, 1, 1))\n+\n     def test_year_view_allow_future(self):\n         # Create a new book in the future\n         year = datetime.date.today().year + 1\n@@ -155,6 +168,11 @@ def test_year_view_invalid_pattern(self):\n         res = self.client.get('/dates/books/no_year/')\n         self.assertEqual(res.status_code, 404)\n \n+    def test_no_duplicate_query(self):\n+        # Regression test for #18354\n+        with self.assertNumQueries(4):\n+            self.client.get('/dates/books/2008/reverse/')\n+\n     def test_datetime_year_view(self):\n         BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n         res = self.client.get('/dates/booksignings/2008/')\n@@ -446,6 +464,13 @@ def test_day_view_allow_future(self):\n         self.assertEqual(res.context['next_day'], future)\n         self.assertEqual(res.context['previous_day'], datetime.date(2006, 5, 1))\n \n+        # allow_future for yesterday, next_day is today (#17192)\n+        today = datetime.date.today()\n+        yesterday = today - datetime.timedelta(days=1)\n+        res = self.client.get('/dates/books/%s/allow_empty_and_future/'\n+                              % yesterday.strftime('%Y/%b/%d').lower())\n+        self.assertEqual(res.context['next_day'], today)\n+\n     def test_day_view_paginated(self):\n         res = self.client.get('/dates/books/2008/oct/1/')\n         self.assertEqual(res.status_code, 200)"
        },
        {
            "sha": "b925758524f8849df2d9a6c9499cd95a56ee98a4",
            "filename": "tests/regressiontests/generic_views/list.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Flist.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -159,6 +159,16 @@ def test_duplicate_context_object_name(self):\n     def test_missing_items(self):\n         self.assertRaises(ImproperlyConfigured, self.client.get, '/list/authors/invalid/')\n \n+    def test_paginated_list_view_does_not_load_entire_table(self):\n+        # Regression test for #17535\n+        self._make_authors(3)\n+        # 1 query for authors\n+        with self.assertNumQueries(1):\n+            self.client.get('/list/authors/notempty/')\n+        # same as above + 1 query to test if authors exist + 1 query for pagination\n+        with self.assertNumQueries(3):\n+            self.client.get('/list/authors/notempty/paginated/')\n+\n     def _make_authors(self, n):\n         Author.objects.all().delete()\n         for i in range(n):"
        },
        {
            "sha": "03f45a38c23c7c3c4858c3377adfc2fbc1aa1cb3",
            "filename": "tests/regressiontests/generic_views/templates/generic_views/book_archive.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Ftemplates%2Fgeneric_views%2Fbook_archive.html",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Ftemplates%2Fgeneric_views%2Fbook_archive.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Ftemplates%2Fgeneric_views%2Fbook_archive.html?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1 +1 @@\n-Archive of books from {{ date_list }}.\n\\ No newline at end of file\n+Archive of books from {{ date_list }}. {{ object_list|length }} books found."
        },
        {
            "sha": "fde198dcaffd5fbf342c5e62ce0a58abce45b4d8",
            "filename": "tests/regressiontests/generic_views/templates/generic_views/book_archive_year.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Ftemplates%2Fgeneric_views%2Fbook_archive_year.html",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Ftemplates%2Fgeneric_views%2Fbook_archive_year.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Ftemplates%2Fgeneric_views%2Fbook_archive_year.html?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1 +1 @@\n-Archive of books from {{ year }}.\n\\ No newline at end of file\n+Archive of books from {{ year }}. {{ object_list|length }} books found."
        },
        {
            "sha": "14d4f685a6be3e2fa8f3e1c3e84232e3125d71e4",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -4,6 +4,7 @@\n from django.views.decorators.cache import cache_page\n from django.views.generic import TemplateView\n \n+from . import models\n from . import views\n \n \n@@ -108,6 +109,8 @@\n         views.BookArchive.as_view(queryset=None)),\n     (r'^dates/books/paginated/$',\n         views.BookArchive.as_view(paginate_by=10)),\n+    (r'^dates/books/reverse/$',\n+        views.BookArchive.as_view(queryset=models.Book.objects.order_by('pubdate'))),\n     (r'^dates/booksignings/$',\n         views.BookSigningArchive.as_view()),\n \n@@ -128,6 +131,8 @@\n         views.AuthorList.as_view(paginate_by=30)),\n     (r'^list/authors/notempty/$',\n         views.AuthorList.as_view(allow_empty=False)),\n+    (r'^list/authors/notempty/paginated/$',\n+        views.AuthorList.as_view(allow_empty=False, paginate_by=2)),\n     (r'^list/authors/template_name/$',\n         views.AuthorList.as_view(template_name='generic_views/list.html')),\n     (r'^list/authors/template_name_suffix/$',\n@@ -158,6 +163,8 @@\n         views.BookYearArchive.as_view(make_object_list=True, paginate_by=30)),\n     (r'^dates/books/no_year/$',\n         views.BookYearArchive.as_view()),\n+    (r'^dates/books/(?P<year>\\d{4})/reverse/$',\n+        views.BookYearArchive.as_view(queryset=models.Book.objects.order_by('pubdate'))),\n     (r'^dates/booksignings/(?P<year>\\d{4})/$',\n         views.BookSigningYearArchive.as_view()),\n \n@@ -202,6 +209,8 @@\n         views.BookDayArchive.as_view(allow_empty=True)),\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/allow_future/$',\n         views.BookDayArchive.as_view(allow_future=True)),\n+    (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/allow_empty_and_future/$',\n+        views.BookDayArchive.as_view(allow_empty=True, allow_future=True)),\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/paginated/$',\n         views.BookDayArchive.as_view(paginate_by=True)),\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/no_day/$',"
        },
        {
            "sha": "ae2062c756b4b6ed7c839cb09b0a9fc996a928f8",
            "filename": "tests/regressiontests/handlers/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fhandlers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fhandlers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhandlers%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -28,7 +28,7 @@ def test_lock_safety(self):\n     def test_bad_path_info(self):\n         \"\"\"Tests for bug #15672 ('request' referenced before assignment)\"\"\"\n         environ = RequestFactory().get('/').environ\n-        environ['PATH_INFO'] = '\\xed'\n+        environ['PATH_INFO'] = b'\\xed'\n         handler = WSGIHandler()\n         response = handler(environ, lambda *a, **k: None)\n         self.assertEqual(response.status_code, 400)"
        },
        {
            "sha": "218c5b5b3bfc014bcff2490b01239ade5eb5f092",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -174,7 +174,7 @@ def test_invalid_input_encoding(self):\n         QueryDicts must be able to handle invalid input encoding (in this\n         case, bad UTF-8 encoding).\n         \"\"\"\n-        q = QueryDict('foo=bar&foo=\\xff')\n+        q = QueryDict(b'foo=bar&foo=\\xff')\n         self.assertEqual(q['foo'], u'\\ufffd')\n         self.assertEqual(q.getlist('foo'), [u'bar', u'\\ufffd'])\n \n@@ -198,7 +198,7 @@ def test_update_from_querydict(self):\n \n     def test_non_default_encoding(self):\n         \"\"\"#13572 - QueryDict with a non-default encoding\"\"\"\n-        q = QueryDict('sbb=one', encoding='rot_13')\n+        q = QueryDict(b'sbb=one', encoding='rot_13')\n         self.assertEqual(q.encoding , 'rot_13' )\n         self.assertEqual(q.items() , [(u'foo', u'bar')] )\n         self.assertEqual(q.urlencode() , 'sbb=one' )\n@@ -285,8 +285,8 @@ def test_iter_content(self):\n             except StopIteration:\n                 break\n         #'\\xde\\x9e' == unichr(1950).encode('utf-8')\n-        self.assertEqual(result, ['1', '2', '3', '\\xde\\x9e'])\n-        self.assertEqual(r.content, '123\\xde\\x9e')\n+        self.assertEqual(result, ['1', '2', '3', b'\\xde\\x9e'])\n+        self.assertEqual(r.content, b'123\\xde\\x9e')\n \n         #with Content-Encoding header\n         r = HttpResponse([1,1,2,4,8])\n@@ -321,7 +321,7 @@ def test_decode_2(self):\n         Test that we haven't broken normal encoding\n         \"\"\"\n         c = SimpleCookie()\n-        c['test'] = \"\\xf0\"\n+        c['test'] = b\"\\xf0\"\n         c2 = SimpleCookie()\n         c2.load(c.output())\n         self.assertEqual(c['test'].value, c2['test'].value)"
        },
        {
            "sha": "d88e1feef63ab0c937f5b8adff876fa6a4e7bc47",
            "filename": "tests/regressiontests/i18n/commands/compilation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 17,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,8 +1,7 @@\n import os\n from io import BytesIO\n \n-from django.core.management import CommandError\n-from django.core.management.commands.compilemessages import compile_messages\n+from django.core.management import call_command, CommandError\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils import translation\n@@ -25,11 +24,9 @@ class PoFileTests(MessageCompilationTests):\n \n     def test_bom_rejection(self):\n         os.chdir(test_dir)\n-        # We don't use the django.core.management infrastructure (call_command()\n-        # et al) because CommandError's cause exit(1) there. We test the\n-        # underlying compile_messages function instead\n-        out = BytesIO()\n-        self.assertRaises(CommandError, compile_messages, out, locale=self.LOCALE)\n+        with self.assertRaisesRegexp(CommandError,\n+                \"file has a BOM \\(Byte Order Mark\\)\"):\n+            call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n         self.assertFalse(os.path.exists(self.MO_FILE))\n \n \n@@ -45,11 +42,7 @@ def setUp(self):\n \n     def test_percent_symbol_in_po_file(self):\n         os.chdir(test_dir)\n-        # We don't use the django.core.management infrastructure (call_command()\n-        # et al) because CommandError's cause exit(1) there. We test the\n-        # underlying compile_messages function instead\n-        out = BytesIO()\n-        compile_messages(out, locale=self.LOCALE)\n+        call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n         self.assertTrue(os.path.exists(self.MO_FILE))\n \n \n@@ -64,11 +57,7 @@ class PercentRenderingTests(MessageCompilationTests):\n     def test_percent_symbol_escaping(self):\n         from django.template import Template, Context\n         os.chdir(test_dir)\n-        # We don't use the django.core.management infrastructure (call_command()\n-        # et al) because CommandError's cause exit(1) there. We test the\n-        # underlying compile_messages function instead\n-        out = BytesIO()\n-        compile_messages(out, locale=self.LOCALE)\n+        call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n         with translation.override(self.LOCALE):\n             t = Template('{% load i18n %}{% trans \"Looks like a str fmt spec %% o but shouldn\\'t be interpreted as such\" %}')\n             rendered = t.render(Context({}))"
        },
        {
            "sha": "478338bc886a2445f9a1c7004b49f4bac719d5fb",
            "filename": "tests/regressiontests/i18n/other/locale/fr/LC_MESSAGES/django.mo",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62"
        },
        {
            "sha": "dafb6139ae832d93f556b76f44953db83e496186",
            "filename": "tests/regressiontests/i18n/other/locale/fr/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -17,5 +17,11 @@ msgstr \"\"\n \"Plural-Forms: nplurals=2; plural=(n != 1)\\n\"\n \n #: template.html:3\n+# Note: Intentional: variable name is translated.\n msgid \"My name is %(person)s.\"\n msgstr \"Mon nom est %(personne)s.\"\n+\n+#: template.html:3\n+# Note: Intentional: the variable name is badly formatted (missing 's' at the end)\n+msgid \"My other name is %(person)s.\"\n+msgstr \"Mon autre nom est %(person).\"\n\\ No newline at end of file"
        },
        {
            "sha": "78e41321af7e3ee9b4d6effb5f83de692412bc69",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -230,7 +230,7 @@ def test_safe_status(self):\n         \"\"\"\n         Translating a string requiring no auto-escaping shouldn't change the \"safe\" status.\n         \"\"\"\n-        s = mark_safe('Password')\n+        s = mark_safe(b'Password')\n         self.assertEqual(SafeString, type(s))\n         with translation.override('de', deactivate=True):\n             self.assertEqual(SafeUnicode, type(ugettext(s)))\n@@ -270,17 +270,31 @@ def test_to_language(self):\n         self.assertEqual(to_language('sr_Lat'), 'sr-lat')\n \n     @override_settings(LOCALE_PATHS=(os.path.join(here, 'other', 'locale'),))\n-    def test_bad_placeholder(self):\n+    def test_bad_placeholder_1(self):\n         \"\"\"\n         Error in translation file should not crash template rendering\n         (%(person)s is translated as %(personne)s in fr.po)\n+        Refs #16516.\n         \"\"\"\n         from django.template import Template, Context\n         with translation.override('fr'):\n             t = Template('{% load i18n %}{% blocktrans %}My name is {{ person }}.{% endblocktrans %}')\n             rendered = t.render(Context({'person': 'James'}))\n             self.assertEqual(rendered, 'My name is James.')\n \n+    @override_settings(LOCALE_PATHS=(os.path.join(here, 'other', 'locale'),))\n+    def test_bad_placeholder_2(self):\n+        \"\"\"\n+        Error in translation file should not crash template rendering\n+        (%(person) misses a 's' in fr.po, causing the string formatting to fail)\n+        Refs #18393.\n+        \"\"\"\n+        from django.template import Template, Context\n+        with translation.override('fr'):\n+            t = Template('{% load i18n %}{% blocktrans %}My other name is {{ person }}.{% endblocktrans %}')\n+            rendered = t.render(Context({'person': 'James'}))\n+            self.assertEqual(rendered, 'My other name is James.')\n+\n \n class FormattingTests(TestCase):\n "
        },
        {
            "sha": "29435b83751e8e94b255682c53b83416353afcd2",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -6,10 +6,28 @@\n \n class InspectDBTestCase(TestCase):\n \n+    def test_stealth_table_name_filter_option(self):\n+        out = StringIO()\n+        # Lets limit the introspection to tables created for models of this\n+        # application\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_'),\n+                     stdout=out)\n+        error_message = \"inspectdb has examined a table that should have been filtered out.\"\n+        # contrib.contenttypes is one of the apps always installed when running\n+        # the Django test suite, check that one of its tables hasn't been\n+        # inspected\n+        self.assertNotIn(\"class DjangoContentType(models.Model):\", out.getvalue(), msg=error_message)\n+        out.close()\n+\n     @skipUnlessDBFeature('can_introspect_foreign_keys')\n     def test_attribute_name_not_python_keyword(self):\n         out = StringIO()\n-        call_command('inspectdb', stdout=out)\n+        # Lets limit the introspection to tables created for models of this\n+        # application\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_'),\n+                     stdout=out)\n         error_message = \"inspectdb generated an attribute name which is a python keyword\"\n         self.assertNotIn(\"from = models.ForeignKey(InspectdbPeople)\", out.getvalue(), msg=error_message)\n         # As InspectdbPeople model is defined after InspectdbMessage, it should be quoted\n@@ -23,7 +41,11 @@ def test_attribute_name_not_python_keyword(self):\n     def test_digits_column_name_introspection(self):\n         \"\"\"Introspection of column names consist/start with digits (#16536/#17676)\"\"\"\n         out = StringIO()\n-        call_command('inspectdb', stdout=out)\n+        # Lets limit the introspection to tables created for models of this\n+        # application\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_'),\n+                     stdout=out)\n         error_message = \"inspectdb generated a model field name which is a number\"\n         self.assertNotIn(\"    123 = models.CharField\", out.getvalue(), msg=error_message)\n         self.assertIn(\"number_123 = models.CharField\", out.getvalue())"
        },
        {
            "sha": "c13eac6d611f560ad0a611fa95959b93f2e3243c",
            "filename": "tests/regressiontests/localflavor/es/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Flocalflavor%2Fes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Flocalflavor%2Fes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fes%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -31,7 +31,7 @@ def test_ESRegionSelect(self):\n     def test_ESProvinceSelect(self):\n         f = ESProvinceSelect()\n         out = u'''<select name=\"provinces\">\n-<option value=\"01\">Arava</option>\n+<option value=\"01\">Araba</option>\n <option value=\"02\">Albacete</option>\n <option value=\"03\">Alacant</option>\n <option value=\"04\">Almeria</option>"
        },
        {
            "sha": "3a8add6e34e67008ee468a25c261b9b8ca677ada",
            "filename": "tests/regressiontests/localflavor/mk/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Flocalflavor%2Fmk%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Flocalflavor%2Fmk%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fmk%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -92,7 +92,7 @@ def test_field_blank_option(self):\n         \"\"\"\n         Test that the empty option is there.\n         \"\"\"\n-        municipality_select_html = \"\"\"\\\n+        municipality_select_html = b\"\"\"\\\n <select name=\"municipality\" id=\"id_municipality\">\n <option value=\"\">---------</option>\n <option value=\"AD\">Aerodrom</option>"
        },
        {
            "sha": "85e73c197f7ef91b6e4ae1d794ed5604090a46e9",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 25,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -86,7 +86,7 @@ def test_message_header_overrides(self):\n         \"\"\"\n         headers = {\"date\": \"Fri, 09 Nov 2001 01:08:47 -0000\", \"Message-ID\": \"foo\"}\n         email = EmailMessage('subject', 'content', 'from@example.com', ['to@example.com'], headers=headers)\n-        self.assertEqual(email.message().as_string(), 'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: subject\\nFrom: from@example.com\\nTo: to@example.com\\ndate: Fri, 09 Nov 2001 01:08:47 -0000\\nMessage-ID: foo\\n\\ncontent')\n+        self.assertEqual(email.message().as_string(), b'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: subject\\nFrom: from@example.com\\nTo: to@example.com\\ndate: Fri, 09 Nov 2001 01:08:47 -0000\\nMessage-ID: foo\\n\\ncontent')\n \n     def test_from_header(self):\n         \"\"\"\n@@ -168,7 +168,7 @@ def test_encoding(self):\n         email = EmailMessage('Subject', 'Firstname S√ºrname is a great guy.', 'from@example.com', ['other@example.com'])\n         email.encoding = 'iso-8859-1'\n         message = email.message()\n-        self.assertTrue(message.as_string().startswith('Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\nSubject: Subject\\nFrom: from@example.com\\nTo: other@example.com'))\n+        self.assertTrue(message.as_string().startswith(b'Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\nSubject: Subject\\nFrom: from@example.com\\nTo: other@example.com'))\n         self.assertEqual(message.get_payload(), 'Firstname S=FCrname is a great guy.')\n \n         # Make sure MIME attachments also works correctly with other encodings than utf-8\n@@ -177,8 +177,8 @@ def test_encoding(self):\n         msg = EmailMultiAlternatives('Subject', text_content, 'from@example.com', ['to@example.com'])\n         msg.encoding = 'iso-8859-1'\n         msg.attach_alternative(html_content, \"text/html\")\n-        self.assertEqual(msg.message().get_payload(0).as_string(), 'Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\nFirstname S=FCrname is a great guy.')\n-        self.assertEqual(msg.message().get_payload(1).as_string(), 'Content-Type: text/html; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\n<p>Firstname S=FCrname is a <strong>great</strong> guy.</p>')\n+        self.assertEqual(msg.message().get_payload(0).as_string(), b'Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\nFirstname S=FCrname is a great guy.')\n+        self.assertEqual(msg.message().get_payload(1).as_string(), b'Content-Type: text/html; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\n<p>Firstname S=FCrname is a <strong>great</strong> guy.</p>')\n \n     def test_attachments(self):\n         \"\"\"Regression test for #9367\"\"\"\n@@ -188,7 +188,7 @@ def test_attachments(self):\n         html_content = '<p>This is an <strong>important</strong> message.</p>'\n         msg = EmailMultiAlternatives(subject, text_content, from_email, [to], headers=headers)\n         msg.attach_alternative(html_content, \"text/html\")\n-        msg.attach(\"an attachment.pdf\", \"%PDF-1.4.%...\", mimetype=\"application/pdf\")\n+        msg.attach(\"an attachment.pdf\", b\"%PDF-1.4.%...\", mimetype=\"application/pdf\")\n         msg_str = msg.message().as_string()\n         message = email.message_from_string(msg_str)\n         self.assertTrue(message.is_multipart())\n@@ -205,7 +205,7 @@ def test_non_ascii_attachment_filename(self):\n         content = 'This is the message.'\n         msg = EmailMessage(subject, content, from_email, [to], headers=headers)\n         # Unicode in file name\n-        msg.attach(u\"une pi√®ce jointe.pdf\", \"%PDF-1.4.%...\", mimetype=\"application/pdf\")\n+        msg.attach(u\"une pi√®ce jointe.pdf\", b\"%PDF-1.4.%...\", mimetype=\"application/pdf\")\n         msg_str = msg.message().as_string()\n         message = email.message_from_string(msg_str)\n         payload = message.get_payload()\n@@ -289,31 +289,31 @@ def test_dont_mangle_from_in_body(self):\n         # Regression for #13433 - Make sure that EmailMessage doesn't mangle\n         # 'From ' in message body.\n         email = EmailMessage('Subject', 'From the future', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n-        self.assertFalse('>From the future' in email.message().as_string())\n+        self.assertFalse(b'>From the future' in email.message().as_string())\n \n     def test_dont_base64_encode(self):\n         # Ticket #3472\n         # Shouldn't use Base64 encoding at all\n         msg = EmailMessage('Subject', 'UTF-8 encoded body', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n-        self.assertFalse('Content-Transfer-Encoding: base64' in msg.message().as_string())\n+        self.assertFalse(b'Content-Transfer-Encoding: base64' in msg.message().as_string())\n \n         # Ticket #11212\n         # Shouldn't use quoted printable, should detect it can represent content with 7 bit data\n         msg = EmailMessage('Subject', 'Body with only ASCII characters.', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n         s = msg.message().as_string()\n-        self.assertFalse('Content-Transfer-Encoding: quoted-printable' in s)\n-        self.assertTrue('Content-Transfer-Encoding: 7bit' in s)\n+        self.assertFalse(b'Content-Transfer-Encoding: quoted-printable' in s)\n+        self.assertTrue(b'Content-Transfer-Encoding: 7bit' in s)\n \n         # Shouldn't use quoted printable, should detect it can represent content with 8 bit data\n         msg = EmailMessage('Subject', 'Body with latin characters: √†√°√§.', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n         s = msg.message().as_string()\n-        self.assertFalse('Content-Transfer-Encoding: quoted-printable' in s)\n-        self.assertTrue('Content-Transfer-Encoding: 8bit' in s)\n+        self.assertFalse(b'Content-Transfer-Encoding: quoted-printable' in s)\n+        self.assertTrue(b'Content-Transfer-Encoding: 8bit' in s)\n \n         msg = EmailMessage('Subject', u'Body with non latin characters: –ê –ë –í –ì –î –ï –ñ –Ö –ó –ò –Ü –ö –õ –ú –ù –û –ü.', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n         s = msg.message().as_string()\n-        self.assertFalse('Content-Transfer-Encoding: quoted-printable' in s)\n-        self.assertTrue('Content-Transfer-Encoding: 8bit' in s)\n+        self.assertFalse(b'Content-Transfer-Encoding: quoted-printable' in s)\n+        self.assertTrue(b'Content-Transfer-Encoding: 8bit' in s)\n \n \n class BaseEmailBackendTests(object):\n@@ -438,7 +438,7 @@ def test_message_cc_header(self):\n         email = EmailMessage('Subject', 'Content', 'from@example.com', ['to@example.com'], cc=['cc@example.com'])\n         mail.get_connection().send_messages([email])\n         message = self.get_the_message()\n-        self.assertStartsWith(message.as_string(), 'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: Subject\\nFrom: from@example.com\\nTo: to@example.com\\nCc: cc@example.com\\nDate: ')\n+        self.assertStartsWith(message.as_string(), b'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: Subject\\nFrom: from@example.com\\nTo: to@example.com\\nCc: cc@example.com\\nDate: ')\n \n     def test_idn_send(self):\n         \"\"\"\n@@ -500,14 +500,14 @@ class FileBackendTests(BaseEmailBackendTests, TestCase):\n     email_backend = 'django.core.mail.backends.filebased.EmailBackend'\n \n     def setUp(self):\n+        super(FileBackendTests, self).setUp()\n         self.tmp_dir = tempfile.mkdtemp()\n         self.addCleanup(shutil.rmtree, self.tmp_dir)\n-        self.settings_override = override_settings(EMAIL_FILE_PATH=self.tmp_dir)\n-        self.settings_override.enable()\n-        super(FileBackendTests, self).setUp()\n+        self._settings_override = override_settings(EMAIL_FILE_PATH=self.tmp_dir)\n+        self._settings_override.enable()\n \n     def tearDown(self):\n-        self.settings_override.disable()\n+        self._settings_override.disable()\n         super(FileBackendTests, self).tearDown()\n \n     def flush_mailbox(self):\n@@ -517,8 +517,8 @@ def flush_mailbox(self):\n     def get_mailbox_content(self):\n         messages = []\n         for filename in os.listdir(self.tmp_dir):\n-            with open(os.path.join(self.tmp_dir, filename)) as fp:\n-                session = fp.read().split('\\n' + ('-' * 79) + '\\n')\n+            with open(os.path.join(self.tmp_dir, filename), 'rb') as fp:\n+                session = fp.read().split(b'\\n' + (b'-' * 79) + b'\\n')\n             messages.extend(email.message_from_string(m) for m in session if m)\n         return messages\n \n@@ -569,7 +569,7 @@ def flush_mailbox(self):\n         self.stream = sys.stdout = StringIO()\n \n     def get_mailbox_content(self):\n-        messages = self.stream.getvalue().split('\\n' + ('-' * 79) + '\\n')\n+        messages = self.stream.getvalue().split(b'\\n' + (b'-' * 79) + b'\\n')\n         return [email.message_from_string(m) for m in messages if m]\n \n     def test_console_stream_kwarg(self):\n@@ -644,15 +644,15 @@ class SMTPBackendTests(BaseEmailBackendTests, TestCase):\n     @classmethod\n     def setUpClass(cls):\n         cls.server = FakeSMTPServer(('127.0.0.1', 0), None)\n-        cls.settings_override = override_settings(\n+        cls._settings_override = override_settings(\n             EMAIL_HOST=\"127.0.0.1\",\n             EMAIL_PORT=cls.server.socket.getsockname()[1])\n-        cls.settings_override.enable()\n+        cls._settings_override.enable()\n         cls.server.start()\n \n     @classmethod\n     def tearDownClass(cls):\n-        cls.settings_override.disable()\n+        cls._settings_override.disable()\n         cls.server.stop()\n \n     def setUp(self):"
        },
        {
            "sha": "9c0f888a99c34bd229aa825a78fbe9c0f761dd87",
            "filename": "tests/regressiontests/model_fields/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fmodel_fields%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fmodel_fields%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_fields%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -208,7 +208,7 @@ def test_return_type(self):\n         # Verify that when an extra clause exists, the boolean\n         # conversions are applied with an offset\n         b5 = BooleanModel.objects.all().extra(\n-            select={'string_length': 'LENGTH(string)'})[0]\n+            select={'string_col': 'string'})[0]\n         self.assertFalse(isinstance(b5.pk, bool))\n \n class ChoicesTests(test.TestCase):\n@@ -365,3 +365,15 @@ def test_changed(self):\n         field = d._meta.get_field('myfile')\n         field.save_form_data(d, 'else.txt')\n         self.assertEqual(d.myfile, 'else.txt')\n+\n+    def test_max_length(self):\n+        \"\"\"\n+        Test that FileField validates the length of the generated file name\n+        that will be stored in the database. Regression for #9893.\n+\n+        \"\"\"\n+        # upload_to = 'unused', so file names are saved as 'unused/xxxxx'.\n+        # max_length = 100, so names longer than 93 characters are rejected.\n+        Document(myfile=93 * 'x').full_clean()\n+        with self.assertRaises(ValidationError):\n+            Document(myfile=94 * 'x').full_clean()"
        },
        {
            "sha": "d33f52af9adc0fdd1731d2d15f4ac171bec878ab",
            "filename": "tests/regressiontests/model_forms_regress/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fmodel_forms_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fmodel_forms_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_forms_regress%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -394,7 +394,7 @@ def test_full_clear(self):\n         form = DocumentForm()\n         self.assertTrue('name=\"myfile\"' in unicode(form))\n         self.assertTrue('myfile-clear' not in unicode(form))\n-        form = DocumentForm(files={'myfile': SimpleUploadedFile('something.txt', 'content')})\n+        form = DocumentForm(files={'myfile': SimpleUploadedFile('something.txt', b'content')})\n         self.assertTrue(form.is_valid())\n         doc = form.save(commit=False)\n         self.assertEqual(doc.myfile.name, 'something.txt')\n@@ -411,11 +411,11 @@ def test_clear_and_file_contradiction(self):\n         includes the current file and the clear checkbox.\n \n         \"\"\"\n-        form = DocumentForm(files={'myfile': SimpleUploadedFile('something.txt', 'content')})\n+        form = DocumentForm(files={'myfile': SimpleUploadedFile('something.txt', b'content')})\n         self.assertTrue(form.is_valid())\n         doc = form.save(commit=False)\n         form = DocumentForm(instance=doc,\n-                            files={'myfile': SimpleUploadedFile('something.txt', 'content')},\n+                            files={'myfile': SimpleUploadedFile('something.txt', b'content')},\n                             data={'myfile-clear': 'true'})\n         self.assertTrue(not form.is_valid())\n         self.assertEqual(form.errors['myfile'],"
        },
        {
            "sha": "e4ce9d7b60c49d1bb96c56869f7709496685bfd2",
            "filename": "tests/regressiontests/queries/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fqueries%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fqueries%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fqueries%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -264,7 +264,7 @@ def __unicode__(self):\n         return self.name\n \n class RelatedObject(models.Model):\n-    single = models.ForeignKey(SingleObject)\n+    single = models.ForeignKey(SingleObject, null=True)\n \n     class Meta:\n         ordering = ['single']"
        },
        {
            "sha": "1035a388402abab8df04a53815cb1cb29ed8f5af",
            "filename": "tests/regressiontests/queries/tests.py",
            "status": "modified",
            "additions": 57,
            "deletions": 2,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fqueries%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -19,7 +19,8 @@\n     ManagedModel, Member, NamedCategory, Note, Number, Plaything, PointerA,\n     Ranking, Related, Report, ReservedName, Tag, TvChef, Valid, X, Food, Eaten,\n     Node, ObjectA, ObjectB, ObjectC, CategoryItem, SimpleCategory,\n-    SpecialCategory, OneToOneCategory, NullableName, ProxyCategory)\n+    SpecialCategory, OneToOneCategory, NullableName, ProxyCategory,\n+    SingleObject, RelatedObject)\n \n \n class BaseQuerysetTest(TestCase):\n@@ -843,6 +844,39 @@ def test_ticket17429(self):\n         )\n         Tag._meta.ordering = original_ordering\n \n+    def test_exclude(self):\n+        self.assertQuerysetEqual(\n+            Item.objects.exclude(tags__name='t4'),\n+            [repr(i) for i in Item.objects.filter(~Q(tags__name='t4'))])\n+        self.assertQuerysetEqual(\n+            Item.objects.exclude(Q(tags__name='t4')|Q(tags__name='t3')),\n+            [repr(i) for i in Item.objects.filter(~(Q(tags__name='t4')|Q(tags__name='t3')))])\n+        self.assertQuerysetEqual(\n+            Item.objects.exclude(Q(tags__name='t4')|~Q(tags__name='t3')),\n+            [repr(i) for i in Item.objects.filter(~(Q(tags__name='t4')|~Q(tags__name='t3')))])\n+\n+    def test_nested_exclude(self):\n+        self.assertQuerysetEqual(\n+            Item.objects.exclude(~Q(tags__name='t4')),\n+            [repr(i) for i in Item.objects.filter(~~Q(tags__name='t4'))])\n+\n+    def test_double_exclude(self):\n+        self.assertQuerysetEqual(\n+            Item.objects.filter(Q(tags__name='t4')),\n+            [repr(i) for i in Item.objects.filter(~~Q(tags__name='t4'))])\n+        self.assertQuerysetEqual(\n+            Item.objects.filter(Q(tags__name='t4')),\n+            [repr(i) for i in Item.objects.filter(~Q(~Q(tags__name='t4')))])\n+\n+    @unittest.expectedFailure\n+    def test_exclude_in(self):\n+        self.assertQuerysetEqual(\n+            Item.objects.exclude(Q(tags__name__in=['t4', 't3'])),\n+            [repr(i) for i in Item.objects.filter(~Q(tags__name__in=['t4', 't3']))])\n+        self.assertQuerysetEqual(\n+            Item.objects.filter(Q(tags__name__in=['t4', 't3'])),\n+            [repr(i) for i in Item.objects.filter(~~Q(tags__name__in=['t4', 't3']))])\n+\n class Queries2Tests(TestCase):\n     def setUp(self):\n         Number.objects.create(num=4)\n@@ -1321,12 +1355,33 @@ class NullableRelOrderingTests(TestCase):\n     def test_ticket10028(self):\n         # Ordering by model related to nullable relations(!) should use outer\n         # joins, so that all results are included.\n-        _ = Plaything.objects.create(name=\"p1\")\n+        Plaything.objects.create(name=\"p1\")\n         self.assertQuerysetEqual(\n             Plaything.objects.all(),\n             ['<Plaything: p1>']\n         )\n \n+    def test_join_already_in_query(self):\n+        # Ordering by model related to nullable relations should not change\n+        # the join type of already existing joins.\n+        Plaything.objects.create(name=\"p1\")\n+        s = SingleObject.objects.create(name='s')\n+        r = RelatedObject.objects.create(single=s)\n+        Plaything.objects.create(name=\"p2\", others=r)\n+        qs = Plaything.objects.all().filter(others__isnull=False).order_by('pk')\n+        self.assertTrue('INNER' in str(qs.query))\n+        qs = qs.order_by('others__single__name')\n+        # The ordering by others__single__pk will add one new join (to single)\n+        # and that join must be LEFT join. The already existing join to related\n+        # objects must be kept INNER. So, we have both a INNER and a LEFT join\n+        # in the query.\n+        self.assertTrue('LEFT' in str(qs.query))\n+        self.assertTrue('INNER' in str(qs.query))\n+        self.assertQuerysetEqual(\n+            qs,\n+            ['<Plaything: p2>']\n+        )\n+\n \n class DisjunctiveFilterTests(TestCase):\n     def setUp(self):"
        },
        {
            "sha": "3d2b19619441902a43dd4a7316691d3a017290a5",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 44,
            "deletions": 44,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -204,91 +204,91 @@ def test_httponly_cookie(self):\n \n     def test_limited_stream(self):\n         # Read all of a limited stream\n-        stream = LimitedStream(StringIO('test'), 2)\n-        self.assertEqual(stream.read(), 'te')\n+        stream = LimitedStream(StringIO(b'test'), 2)\n+        self.assertEqual(stream.read(), b'te')\n         # Reading again returns nothing.\n-        self.assertEqual(stream.read(), '')\n+        self.assertEqual(stream.read(), b'')\n \n         # Read a number of characters greater than the stream has to offer\n-        stream = LimitedStream(StringIO('test'), 2)\n-        self.assertEqual(stream.read(5), 'te')\n+        stream = LimitedStream(StringIO(b'test'), 2)\n+        self.assertEqual(stream.read(5), b'te')\n         # Reading again returns nothing.\n-        self.assertEqual(stream.readline(5), '')\n+        self.assertEqual(stream.readline(5), b'')\n \n         # Read sequentially from a stream\n-        stream = LimitedStream(StringIO('12345678'), 8)\n-        self.assertEqual(stream.read(5), '12345')\n-        self.assertEqual(stream.read(5), '678')\n+        stream = LimitedStream(StringIO(b'12345678'), 8)\n+        self.assertEqual(stream.read(5), b'12345')\n+        self.assertEqual(stream.read(5), b'678')\n         # Reading again returns nothing.\n-        self.assertEqual(stream.readline(5), '')\n+        self.assertEqual(stream.readline(5), b'')\n \n         # Read lines from a stream\n-        stream = LimitedStream(StringIO('1234\\n5678\\nabcd\\nefgh\\nijkl'), 24)\n+        stream = LimitedStream(StringIO(b'1234\\n5678\\nabcd\\nefgh\\nijkl'), 24)\n         # Read a full line, unconditionally\n-        self.assertEqual(stream.readline(), '1234\\n')\n+        self.assertEqual(stream.readline(), b'1234\\n')\n         # Read a number of characters less than a line\n-        self.assertEqual(stream.readline(2), '56')\n+        self.assertEqual(stream.readline(2), b'56')\n         # Read the rest of the partial line\n-        self.assertEqual(stream.readline(), '78\\n')\n+        self.assertEqual(stream.readline(), b'78\\n')\n         # Read a full line, with a character limit greater than the line length\n-        self.assertEqual(stream.readline(6), 'abcd\\n')\n+        self.assertEqual(stream.readline(6), b'abcd\\n')\n         # Read the next line, deliberately terminated at the line end\n-        self.assertEqual(stream.readline(4), 'efgh')\n+        self.assertEqual(stream.readline(4), b'efgh')\n         # Read the next line... just the line end\n-        self.assertEqual(stream.readline(), '\\n')\n+        self.assertEqual(stream.readline(), b'\\n')\n         # Read everything else.\n-        self.assertEqual(stream.readline(), 'ijkl')\n+        self.assertEqual(stream.readline(), b'ijkl')\n \n         # Regression for #15018\n         # If a stream contains a newline, but the provided length\n         # is less than the number of provided characters, the newline\n         # doesn't reset the available character count\n-        stream = LimitedStream(StringIO('1234\\nabcdef'), 9)\n-        self.assertEqual(stream.readline(10), '1234\\n')\n-        self.assertEqual(stream.readline(3), 'abc')\n+        stream = LimitedStream(StringIO(b'1234\\nabcdef'), 9)\n+        self.assertEqual(stream.readline(10), b'1234\\n')\n+        self.assertEqual(stream.readline(3), b'abc')\n         # Now expire the available characters\n-        self.assertEqual(stream.readline(3), 'd')\n+        self.assertEqual(stream.readline(3), b'd')\n         # Reading again returns nothing.\n-        self.assertEqual(stream.readline(2), '')\n+        self.assertEqual(stream.readline(2), b'')\n \n         # Same test, but with read, not readline.\n-        stream = LimitedStream(StringIO('1234\\nabcdef'), 9)\n-        self.assertEqual(stream.read(6), '1234\\na')\n-        self.assertEqual(stream.read(2), 'bc')\n-        self.assertEqual(stream.read(2), 'd')\n-        self.assertEqual(stream.read(2), '')\n-        self.assertEqual(stream.read(), '')\n+        stream = LimitedStream(StringIO(b'1234\\nabcdef'), 9)\n+        self.assertEqual(stream.read(6), b'1234\\na')\n+        self.assertEqual(stream.read(2), b'bc')\n+        self.assertEqual(stream.read(2), b'd')\n+        self.assertEqual(stream.read(2), b'')\n+        self.assertEqual(stream.read(), b'')\n \n     def test_stream(self):\n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n-        self.assertEqual(request.read(), 'name=value')\n+        self.assertEqual(request.read(), b'name=value')\n \n     def test_read_after_value(self):\n         \"\"\"\n         Reading from request is allowed after accessing request contents as\n         POST or body.\n         \"\"\"\n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n         self.assertEqual(request.POST, {u'name': [u'value']})\n-        self.assertEqual(request.body, 'name=value')\n-        self.assertEqual(request.read(), 'name=value')\n+        self.assertEqual(request.body, b'name=value')\n+        self.assertEqual(request.read(), b'name=value')\n \n     def test_value_after_read(self):\n         \"\"\"\n         Construction of POST or body is not allowed after reading\n         from request.\n         \"\"\"\n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n-        self.assertEqual(request.read(2), 'na')\n+        self.assertEqual(request.read(2), b'na')\n         self.assertRaises(Exception, lambda: request.body)\n         self.assertEqual(request.POST, {})\n \n@@ -335,17 +335,17 @@ def test_POST_multipart_with_content_length_zero(self):\n         self.assertEqual(request.POST, {})\n \n     def test_read_by_lines(self):\n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n-        self.assertEqual(list(request), ['name=value'])\n+        self.assertEqual(list(request), [b'name=value'])\n \n     def test_POST_after_body_read(self):\n         \"\"\"\n         POST should be populated even if body is read first\n         \"\"\"\n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n@@ -357,12 +357,12 @@ def test_POST_after_body_read_and_stream_read(self):\n         POST should be populated even if body is read first, and then\n         the stream is read second.\n         \"\"\"\n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': StringIO(payload)})\n         raw_data = request.body\n-        self.assertEqual(request.read(1), u'n')\n+        self.assertEqual(request.read(1), b'n')\n         self.assertEqual(request.POST, {u'name': [u'value']})\n \n     def test_POST_after_body_read_and_stream_read_multipart(self):\n@@ -383,14 +383,14 @@ def test_POST_after_body_read_and_stream_read_multipart(self):\n                                'wsgi.input': StringIO(payload)})\n         raw_data = request.body\n         # Consume enough data to mess up the parsing:\n-        self.assertEqual(request.read(13), u'--boundary\\r\\nC')\n+        self.assertEqual(request.read(13), b'--boundary\\r\\nC')\n         self.assertEqual(request.POST, {u'name': [u'value']})\n \n     def test_raw_post_data_returns_body(self):\n         \"\"\"\n         HttpRequest.raw_post_body should be the same as HttpRequest.body\n         \"\"\"\n-        payload = 'Hello There!'\n+        payload = b'Hello There!'\n         request = WSGIRequest({\n             'REQUEST_METHOD': 'POST',\n             'CONTENT_LENGTH': len(payload),\n@@ -409,7 +409,7 @@ class ExplodingStringIO(StringIO):\n             def read(self, len=0):\n                 raise IOError(\"kaboom!\")\n \n-        payload = 'name=value'\n+        payload = b'name=value'\n         request = WSGIRequest({'REQUEST_METHOD': 'POST',\n                                'CONTENT_LENGTH': len(payload),\n                                'wsgi.input': ExplodingStringIO(payload)})"
        },
        {
            "sha": "9537e1feb3622740c608e67caa59405cbef7c749",
            "filename": "tests/regressiontests/servers/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -113,23 +113,23 @@ def test_view(self):\n         Refs #2879.\n         \"\"\"\n         f = self.urlopen('/example_view/')\n-        self.assertEqual(f.read(), 'example view')\n+        self.assertEqual(f.read(), b'example view')\n \n     def test_static_files(self):\n         \"\"\"\n         Ensure that the LiveServerTestCase serves static files.\n         Refs #2879.\n         \"\"\"\n         f = self.urlopen('/static/example_static_file.txt')\n-        self.assertEqual(f.read(), 'example static file\\n')\n+        self.assertEqual(f.read().rstrip(b'\\r\\n'), b'example static file')\n \n     def test_media_files(self):\n         \"\"\"\n         Ensure that the LiveServerTestCase serves media files.\n         Refs #2879.\n         \"\"\"\n         f = self.urlopen('/media/example_media_file.txt')\n-        self.assertEqual(f.read(), 'example media file\\n')\n+        self.assertEqual(f.read().rstrip(b'\\r\\n'), b'example media file')\n \n \n class LiveServerDatabase(LiveServerBase):"
        },
        {
            "sha": "1da3345806b0689bda19cfce5c536ae1e321bea4",
            "filename": "tests/regressiontests/signing/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fsigning%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fsigning%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsigning%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -12,8 +12,8 @@ def test_signature(self):\n         signer = signing.Signer('predictable-secret')\n         signer2 = signing.Signer('predictable-secret2')\n         for s in (\n-            'hello',\n-            '3098247:529:087:',\n+            b'hello',\n+            b'3098247:529:087:',\n             u'\\u2019'.encode('utf-8'),\n         ):\n             self.assertEqual(\n@@ -69,7 +69,7 @@ def test_dumps_loads(self):\n         \"dumps and loads be reversible for any JSON serializable object\"\n         objects = (\n             ['a', 'list'],\n-            'a string',\n+            b'a string',\n             u'a unicode string \\u2019',\n             {'a': 'dictionary'},\n         )"
        },
        {
            "sha": "4d49e6fbb27ee11fde0f710e45e03f5dd342e687",
            "filename": "tests/regressiontests/staticfiles_tests/storage.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fstaticfiles_tests%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fstaticfiles_tests%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Fstorage.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,5 +1,6 @@\n from datetime import datetime\n from django.core.files import storage\n+from django.contrib.staticfiles.storage import CachedStaticFilesStorage\n \n class DummyStorage(storage.Storage):\n     \"\"\"\n@@ -17,3 +18,9 @@ def exists(self, name):\n \n     def modified_time(self, name):\n         return datetime.date(1970, 1, 1)\n+\n+\n+class SimpleCachedStaticFilesStorage(CachedStaticFilesStorage):\n+\n+    def file_hash(self, name, content=None):\n+        return 'deploy12345'"
        },
        {
            "sha": "3711d92448c4ee4729db9e94da7db2fde6442658",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 76,
            "deletions": 46,
            "changes": 122,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -6,11 +6,11 @@\n import shutil\n import sys\n import tempfile\n-from StringIO import StringIO\n+from io import BytesIO\n \n from django.template import loader, Context\n from django.conf import settings\n-from django.core.cache.backends.base import BaseCache, CacheKeyWarning\n+from django.core.cache.backends.base import BaseCache\n from django.core.exceptions import ImproperlyConfigured\n from django.core.files.storage import default_storage\n from django.core.management import call_command\n@@ -187,30 +187,22 @@ class TestFindStatic(CollectionTestCase, TestDefaults):\n     Test ``findstatic`` management command.\n     \"\"\"\n     def _get_file(self, filepath):\n-        _stdout = sys.stdout\n-        sys.stdout = StringIO()\n-        try:\n-            call_command('findstatic', filepath, all=False, verbosity='0')\n-            sys.stdout.seek(0)\n-            lines = [l.strip() for l in sys.stdout.readlines()]\n-            contents = codecs.open(\n-                smart_unicode(lines[1].strip()), \"r\", \"utf-8\").read()\n-        finally:\n-            sys.stdout = _stdout\n+        out = BytesIO()\n+        call_command('findstatic', filepath, all=False, verbosity=0, stdout=out)\n+        out.seek(0)\n+        lines = [l.strip() for l in out.readlines()]\n+        contents = codecs.open(\n+            smart_unicode(lines[1].strip()), \"r\", \"utf-8\").read()\n         return contents\n \n     def test_all_files(self):\n         \"\"\"\n         Test that findstatic returns all candidate files if run without --first.\n         \"\"\"\n-        _stdout = sys.stdout\n-        sys.stdout = StringIO()\n-        try:\n-            call_command('findstatic', 'test/file.txt', verbosity='0')\n-            sys.stdout.seek(0)\n-            lines = [l.strip() for l in sys.stdout.readlines()]\n-        finally:\n-            sys.stdout = _stdout\n+        out = BytesIO()\n+        call_command('findstatic', 'test/file.txt', verbosity=0, stdout=out)\n+        out.seek(0)\n+        lines = [l.strip() for l in out.readlines()]\n         self.assertEqual(len(lines), 3)  # three because there is also the \"Found <file> here\" line\n         self.assertIn('project', lines[1])\n         self.assertIn('apps', lines[2])\n@@ -387,8 +379,8 @@ def test_template_tag_simple_content(self):\n         self.assertEqual(relpath, \"cached/styles.93b1147e8552.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertNotIn(\"cached/other.css\", content)\n-            self.assertIn(\"other.d41d8cd98f00.css\", content)\n+            self.assertNotIn(b\"cached/other.css\", content)\n+            self.assertIn(b\"other.d41d8cd98f00.css\", content)\n \n     def test_path_with_querystring(self):\n         relpath = self.cached_file_path(\"cached/styles.css?spam=eggs\")\n@@ -397,71 +389,71 @@ def test_path_with_querystring(self):\n         with storage.staticfiles_storage.open(\n                 \"cached/styles.93b1147e8552.css\") as relfile:\n             content = relfile.read()\n-            self.assertNotIn(\"cached/other.css\", content)\n-            self.assertIn(\"other.d41d8cd98f00.css\", content)\n+            self.assertNotIn(b\"cached/other.css\", content)\n+            self.assertIn(b\"other.d41d8cd98f00.css\", content)\n \n     def test_path_with_fragment(self):\n         relpath = self.cached_file_path(\"cached/styles.css#eggs\")\n         self.assertEqual(relpath, \"cached/styles.93b1147e8552.css#eggs\")\n         with storage.staticfiles_storage.open(\n                 \"cached/styles.93b1147e8552.css\") as relfile:\n             content = relfile.read()\n-            self.assertNotIn(\"cached/other.css\", content)\n-            self.assertIn(\"other.d41d8cd98f00.css\", content)\n+            self.assertNotIn(b\"cached/other.css\", content)\n+            self.assertIn(b\"other.d41d8cd98f00.css\", content)\n \n     def test_path_with_querystring_and_fragment(self):\n         relpath = self.cached_file_path(\"cached/css/fragments.css\")\n         self.assertEqual(relpath, \"cached/css/fragments.75433540b096.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertIn('fonts/font.a4b0478549d0.eot?#iefix', content)\n-            self.assertIn('fonts/font.b8d603e42714.svg#webfontIyfZbseF', content)\n-            self.assertIn('data:font/woff;charset=utf-8;base64,d09GRgABAAAAADJoAA0AAAAAR2QAAQAAAAAAAAAAAAA', content)\n-            self.assertIn('#default#VML', content)\n+            self.assertIn(b'fonts/font.a4b0478549d0.eot?#iefix', content)\n+            self.assertIn(b'fonts/font.b8d603e42714.svg#webfontIyfZbseF', content)\n+            self.assertIn(b'data:font/woff;charset=utf-8;base64,d09GRgABAAAAADJoAA0AAAAAR2QAAQAAAAAAAAAAAAA', content)\n+            self.assertIn(b'#default#VML', content)\n \n     def test_template_tag_absolute(self):\n         relpath = self.cached_file_path(\"cached/absolute.css\")\n         self.assertEqual(relpath, \"cached/absolute.23f087ad823a.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertNotIn(\"/static/cached/styles.css\", content)\n-            self.assertIn(\"/static/cached/styles.93b1147e8552.css\", content)\n-            self.assertIn('/static/cached/img/relative.acae32e4532b.png', content)\n+            self.assertNotIn(b\"/static/cached/styles.css\", content)\n+            self.assertIn(b\"/static/cached/styles.93b1147e8552.css\", content)\n+            self.assertIn(b'/static/cached/img/relative.acae32e4532b.png', content)\n \n     def test_template_tag_denorm(self):\n         relpath = self.cached_file_path(\"cached/denorm.css\")\n         self.assertEqual(relpath, \"cached/denorm.c5bd139ad821.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertNotIn(\"..//cached///styles.css\", content)\n-            self.assertIn(\"../cached/styles.93b1147e8552.css\", content)\n-            self.assertNotIn(\"url(img/relative.png )\", content)\n-            self.assertIn('url(\"img/relative.acae32e4532b.png', content)\n+            self.assertNotIn(b\"..//cached///styles.css\", content)\n+            self.assertIn(b\"../cached/styles.93b1147e8552.css\", content)\n+            self.assertNotIn(b\"url(img/relative.png )\", content)\n+            self.assertIn(b'url(\"img/relative.acae32e4532b.png', content)\n \n     def test_template_tag_relative(self):\n         relpath = self.cached_file_path(\"cached/relative.css\")\n         self.assertEqual(relpath, \"cached/relative.2217ea7273c2.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertNotIn(\"../cached/styles.css\", content)\n-            self.assertNotIn('@import \"styles.css\"', content)\n-            self.assertNotIn('url(img/relative.png)', content)\n-            self.assertIn('url(\"img/relative.acae32e4532b.png\")', content)\n-            self.assertIn(\"../cached/styles.93b1147e8552.css\", content)\n+            self.assertNotIn(b\"../cached/styles.css\", content)\n+            self.assertNotIn(b'@import \"styles.css\"', content)\n+            self.assertNotIn(b'url(img/relative.png)', content)\n+            self.assertIn(b'url(\"img/relative.acae32e4532b.png\")', content)\n+            self.assertIn(b\"../cached/styles.93b1147e8552.css\", content)\n \n     def test_template_tag_deep_relative(self):\n         relpath = self.cached_file_path(\"cached/css/window.css\")\n         self.assertEqual(relpath, \"cached/css/window.9db38d5169f3.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertNotIn('url(img/window.png)', content)\n-            self.assertIn('url(\"img/window.acae32e4532b.png\")', content)\n+            self.assertNotIn(b'url(img/window.png)', content)\n+            self.assertIn(b'url(\"img/window.acae32e4532b.png\")', content)\n \n     def test_template_tag_url(self):\n         relpath = self.cached_file_path(\"cached/url.css\")\n         self.assertEqual(relpath, \"cached/url.615e21601e4b.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n-            self.assertIn(\"https://\", relfile.read())\n+            self.assertIn(b\"https://\", relfile.read())\n \n     def test_cache_invalidation(self):\n         name = \"cached/styles.css\"\n@@ -508,13 +500,51 @@ def test_cache_key_memcache_validation(self):\n         \"\"\"\n         Handle cache key creation correctly, see #17861.\n         \"\"\"\n-        name = \"/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/\" + chr(22) + chr(180)\n+        name = b\"/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/long filename/ with spaces Here and ?#%#$/other/stuff/some crazy/\" + chr(22) + chr(180)\n         cache_key = storage.staticfiles_storage.cache_key(name)\n         cache_validator = BaseCache({})\n         cache_validator.validate_key(cache_key)\n         self.assertEqual(cache_key, 'staticfiles:e95bbc36387084582df2a70750d7b351')\n \n \n+# we set DEBUG to False here since the template tag wouldn't work otherwise\n+@override_settings(**dict(TEST_SETTINGS,\n+    STATICFILES_STORAGE='regressiontests.staticfiles_tests.storage.SimpleCachedStaticFilesStorage',\n+    DEBUG=False,\n+))\n+class TestCollectionSimpleCachedStorage(BaseCollectionTestCase,\n+        BaseStaticFilesTestCase, TestCase):\n+    \"\"\"\n+    Tests for the Cache busting storage\n+    \"\"\"\n+    def cached_file_path(self, path):\n+        fullpath = self.render_template(self.static_template_snippet(path))\n+        return fullpath.replace(settings.STATIC_URL, '')\n+\n+    def test_template_tag_return(self):\n+        \"\"\"\n+        Test the CachedStaticFilesStorage backend.\n+        \"\"\"\n+        self.assertStaticRaises(ValueError,\n+                                \"does/not/exist.png\",\n+                                \"/static/does/not/exist.png\")\n+        self.assertStaticRenders(\"test/file.txt\",\n+                                 \"/static/test/file.deploy12345.txt\")\n+        self.assertStaticRenders(\"cached/styles.css\",\n+                                 \"/static/cached/styles.deploy12345.css\")\n+        self.assertStaticRenders(\"path/\",\n+                                 \"/static/path/\")\n+        self.assertStaticRenders(\"path/?query\",\n+                                 \"/static/path/?query\")\n+\n+    def test_template_tag_simple_content(self):\n+        relpath = self.cached_file_path(\"cached/styles.css\")\n+        self.assertEqual(relpath, \"cached/styles.deploy12345.css\")\n+        with storage.staticfiles_storage.open(relpath) as relfile:\n+            content = relfile.read()\n+            self.assertNotIn(\"cached/other.css\", content)\n+            self.assertIn(\"other.deploy12345.css\", content)\n+\n if sys.platform != 'win32':\n \n     class TestCollectionLinks(CollectionTestCase, TestDefaults):"
        },
        {
            "sha": "b3f90169cad7fcb93fdc63936710bbf0f3d779bb",
            "filename": "tests/regressiontests/string_lookup/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fstring_lookup%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fstring_lookup%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstring_lookup%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -54,7 +54,7 @@ def test_unicode_chars_in_queries(self):\n         self.assertEqual(Foo.objects.get(friend__contains=u'\\xe7'), fx)\n \n         # We can also do the above query using UTF-8 strings.\n-        self.assertEqual(Foo.objects.get(friend__contains='\\xc3\\xa7'), fx)\n+        self.assertEqual(Foo.objects.get(friend__contains=b'\\xc3\\xa7'), fx)\n \n     def test_queries_on_textfields(self):\n         \"\"\""
        },
        {
            "sha": "8590dd25af1ae8a347d1e3443d989b30b84c4fcf",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -192,17 +192,17 @@ def test_template_sources(path, template_dirs, expected_sources):\n         test_template_sources('../dir1blah', template_dirs, [])\n \n         # UTF-8 bytestrings are permitted.\n-        test_template_sources('\\xc3\\x85ngstr\\xc3\\xb6m', template_dirs,\n+        test_template_sources(b'\\xc3\\x85ngstr\\xc3\\xb6m', template_dirs,\n                               [u'/dir1/√Öngstr√∂m', u'/dir2/√Öngstr√∂m'])\n         # Unicode strings are permitted.\n         test_template_sources(u'√Öngstr√∂m', template_dirs,\n                               [u'/dir1/√Öngstr√∂m', u'/dir2/√Öngstr√∂m'])\n-        test_template_sources(u'√Öngstr√∂m', ['/Stra√üe'], [u'/Stra√üe/√Öngstr√∂m'])\n-        test_template_sources('\\xc3\\x85ngstr\\xc3\\xb6m', ['/Stra√üe'],\n+        test_template_sources(u'√Öngstr√∂m', [b'/Stra\\xc3\\x9fe'], [u'/Stra√üe/√Öngstr√∂m'])\n+        test_template_sources(b'\\xc3\\x85ngstr\\xc3\\xb6m', [b'/Stra\\xc3\\x9fe'],\n                               [u'/Stra√üe/√Öngstr√∂m'])\n         # Invalid UTF-8 encoding in bytestrings is not. Should raise a\n         # semi-useful error message.\n-        test_template_sources('\\xc3\\xc3', template_dirs, UnicodeDecodeError)\n+        test_template_sources(b'\\xc3\\xc3', template_dirs, UnicodeDecodeError)\n \n         # Case insensitive tests (for win32). Not run unless we're on\n         # a case insensitive operating system.\n@@ -1239,11 +1239,11 @@ def get_template_tests(self):\n             'i18n02': ('{% load i18n %}{% trans \"xxxyyyxxx\" %}', {}, \"xxxyyyxxx\"),\n \n             # simple translation of a variable\n-            'i18n03': ('{% load i18n %}{% blocktrans %}{{ anton }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u\"√Ö\"),\n+            'i18n03': ('{% load i18n %}{% blocktrans %}{{ anton }}{% endblocktrans %}', {'anton': b'\\xc3\\x85'}, u\"√Ö\"),\n \n             # simple translation of a variable and filter\n-            'i18n04': ('{% load i18n %}{% blocktrans with berta=anton|lower %}{{ berta }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u'√•'),\n-            'legacyi18n04': ('{% load i18n %}{% blocktrans with anton|lower as berta %}{{ berta }}{% endblocktrans %}', {'anton': '\\xc3\\x85'}, u'√•'),\n+            'i18n04': ('{% load i18n %}{% blocktrans with berta=anton|lower %}{{ berta }}{% endblocktrans %}', {'anton': b'\\xc3\\x85'}, u'√•'),\n+            'legacyi18n04': ('{% load i18n %}{% blocktrans with anton|lower as berta %}{{ berta }}{% endblocktrans %}', {'anton': b'\\xc3\\x85'}, u'√•'),\n \n             # simple translation of a string with interpolation\n             'i18n05': ('{% load i18n %}{% blocktrans %}xxx{{ anton }}xxx{% endblocktrans %}', {'anton': 'yyy'}, \"xxxyyyxxx\"),"
        },
        {
            "sha": "0e0cefeb8eb3c18a44b976a11d61fc0001710ff0",
            "filename": "tests/regressiontests/templates/unicode.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftemplates%2Funicode.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftemplates%2Funicode.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Funicode.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -10,16 +10,16 @@ def test_template(self):\n         t1 = Template(u'≈†ƒêƒÜ≈Ωƒá≈æ≈°ƒë {{ var }}')\n         # Templates can also be created from bytestrings. These are assumed to\n         # be encoded using UTF-8.\n-        s = '\\xc5\\xa0\\xc4\\x90\\xc4\\x86\\xc5\\xbd\\xc4\\x87\\xc5\\xbe\\xc5\\xa1\\xc4\\x91 {{ var }}'\n+        s = b'\\xc5\\xa0\\xc4\\x90\\xc4\\x86\\xc5\\xbd\\xc4\\x87\\xc5\\xbe\\xc5\\xa1\\xc4\\x91 {{ var }}'\n         t2 = Template(s)\n-        s = '\\x80\\xc5\\xc0'\n+        s = b'\\x80\\xc5\\xc0'\n         self.assertRaises(TemplateEncodingError, Template, s)\n \n         # Contexts can be constructed from unicode or UTF-8 bytestrings.\n-        c1 = Context({\"var\": \"foo\"})\n-        c2 = Context({u\"var\": \"foo\"})\n-        c3 = Context({\"var\": u\"ƒêƒë\"})\n-        c4 = Context({u\"var\": \"\\xc4\\x90\\xc4\\x91\"})\n+        c1 = Context({b\"var\": b\"foo\"})\n+        c2 = Context({u\"var\": b\"foo\"})\n+        c3 = Context({b\"var\": u\"ƒêƒë\"})\n+        c4 = Context({u\"var\": b\"\\xc4\\x90\\xc4\\x91\"})\n \n         # Since both templates and all four contexts represent the same thing,\n         # they all render the same (and are returned as unicode objects and"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/test_client_regress/models.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1034,
            "changes": 1034,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -1,1034 +0,0 @@\n-# -*- coding: utf-8 -*-\n-\"\"\"\n-Regression tests for the Test Client, especially the customized assertions.\n-\"\"\"\n-import os\n-\n-from django.conf import settings\n-from django.core.exceptions import SuspiciousOperation\n-from django.core.urlresolvers import reverse\n-from django.template import (TemplateDoesNotExist, TemplateSyntaxError,\n-    Context, Template, loader)\n-import django.template.context\n-from django.test import Client, TestCase\n-from django.test.client import encode_file, RequestFactory\n-from django.test.utils import ContextList, override_settings\n-from django.template.response import SimpleTemplateResponse\n-from django.http import HttpResponse\n-\n-\n-class AssertContainsTests(TestCase):\n-    def setUp(self):\n-        self.old_templates = settings.TEMPLATE_DIRS\n-        settings.TEMPLATE_DIRS = (os.path.join(os.path.dirname(__file__), 'templates'),)\n-\n-    def tearDown(self):\n-        settings.TEMPLATE_DIRS = self.old_templates\n-\n-    def test_contains(self):\n-        \"Responses can be inspected for content, including counting repeated substrings\"\n-        response = self.client.get('/test_client_regress/no_template_view/')\n-\n-        self.assertNotContains(response, 'never')\n-        self.assertContains(response, 'never', 0)\n-        self.assertContains(response, 'once')\n-        self.assertContains(response, 'once', 1)\n-        self.assertContains(response, 'twice')\n-        self.assertContains(response, 'twice', 2)\n-\n-        try:\n-            self.assertContains(response, 'text', status_code=999)\n-        except AssertionError as e:\n-            self.assertIn(\"Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n-        try:\n-            self.assertContains(response, 'text', status_code=999, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n-\n-        try:\n-            self.assertNotContains(response, 'text', status_code=999)\n-        except AssertionError as e:\n-            self.assertIn(\"Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n-        try:\n-            self.assertNotContains(response, 'text', status_code=999, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n-\n-        try:\n-            self.assertNotContains(response, 'once')\n-        except AssertionError as e:\n-            self.assertIn(\"Response should not contain 'once'\", str(e))\n-        try:\n-            self.assertNotContains(response, 'once', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Response should not contain 'once'\", str(e))\n-\n-        try:\n-            self.assertContains(response, 'never', 1)\n-        except AssertionError as e:\n-            self.assertIn(\"Found 0 instances of 'never' in response (expected 1)\", str(e))\n-        try:\n-            self.assertContains(response, 'never', 1, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Found 0 instances of 'never' in response (expected 1)\", str(e))\n-\n-        try:\n-            self.assertContains(response, 'once', 0)\n-        except AssertionError as e:\n-            self.assertIn(\"Found 1 instances of 'once' in response (expected 0)\", str(e))\n-        try:\n-            self.assertContains(response, 'once', 0, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Found 1 instances of 'once' in response (expected 0)\", str(e))\n-\n-        try:\n-            self.assertContains(response, 'once', 2)\n-        except AssertionError as e:\n-            self.assertIn(\"Found 1 instances of 'once' in response (expected 2)\", str(e))\n-        try:\n-            self.assertContains(response, 'once', 2, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Found 1 instances of 'once' in response (expected 2)\", str(e))\n-\n-        try:\n-            self.assertContains(response, 'twice', 1)\n-        except AssertionError as e:\n-            self.assertIn(\"Found 2 instances of 'twice' in response (expected 1)\", str(e))\n-        try:\n-            self.assertContains(response, 'twice', 1, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Found 2 instances of 'twice' in response (expected 1)\", str(e))\n-\n-        try:\n-            self.assertContains(response, 'thrice')\n-        except AssertionError as e:\n-            self.assertIn(\"Couldn't find 'thrice' in response\", str(e))\n-        try:\n-            self.assertContains(response, 'thrice', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Couldn't find 'thrice' in response\", str(e))\n-\n-        try:\n-            self.assertContains(response, 'thrice', 3)\n-        except AssertionError as e:\n-            self.assertIn(\"Found 0 instances of 'thrice' in response (expected 3)\", str(e))\n-        try:\n-            self.assertContains(response, 'thrice', 3, msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Found 0 instances of 'thrice' in response (expected 3)\", str(e))\n-\n-    def test_unicode_contains(self):\n-        \"Unicode characters can be found in template context\"\n-        #Regression test for #10183\n-        r = self.client.get('/test_client_regress/check_unicode/')\n-        self.assertContains(r, u'„Åï„Åã„Åç')\n-        self.assertContains(r, '\\xe5\\xb3\\xa0'.decode('utf-8'))\n-\n-    def test_unicode_not_contains(self):\n-        \"Unicode characters can be searched for, and not found in template context\"\n-        #Regression test for #10183\n-        r = self.client.get('/test_client_regress/check_unicode/')\n-        self.assertNotContains(r, u'„ÅØ„Åü„Åë')\n-        self.assertNotContains(r, '\\xe3\\x81\\xaf\\xe3\\x81\\x9f\\xe3\\x81\\x91'.decode('utf-8'))\n-\n-    def test_assert_contains_renders_template_response(self):\n-        \"\"\" Test that we can pass in an unrendered SimpleTemplateReponse\n-            without throwing an error.\n-            Refs #15826.\n-        \"\"\"\n-        response = SimpleTemplateResponse(Template('Hello'), status=200)\n-        self.assertContains(response, 'Hello')\n-\n-    def test_assert_contains_using_non_template_response(self):\n-        \"\"\" Test that auto-rendering does not affect responses that aren't\n-            instances (or subclasses) of SimpleTemplateResponse.\n-            Refs #15826.\n-        \"\"\"\n-        response = HttpResponse('Hello')\n-        self.assertContains(response, 'Hello')\n-\n-    def test_assert_not_contains_renders_template_response(self):\n-        \"\"\" Test that we can pass in an unrendered SimpleTemplateReponse\n-            without throwing an error.\n-            Refs #15826.\n-        \"\"\"\n-        response = SimpleTemplateResponse(Template('Hello'), status=200)\n-        self.assertNotContains(response, 'Bye')\n-\n-    def test_assert_not_contains_using_non_template_response(self):\n-        \"\"\" Test that auto-rendering does not affect responses that aren't\n-            instances (or subclasses) of SimpleTemplateResponse.\n-            Refs #15826.\n-        \"\"\"\n-        response = HttpResponse('Hello')\n-        self.assertNotContains(response, 'Bye')\n-\n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n-class AssertTemplateUsedTests(TestCase):\n-    fixtures = ['testdata.json']\n-\n-    def test_no_context(self):\n-        \"Template usage assertions work then templates aren't in use\"\n-        response = self.client.get('/test_client_regress/no_template_view/')\n-\n-        # Check that the no template case doesn't mess with the template assertions\n-        self.assertTemplateNotUsed(response, 'GET Template')\n-\n-        try:\n-            self.assertTemplateUsed(response, 'GET Template')\n-        except AssertionError as e:\n-            self.assertIn(\"No templates used to render the response\", str(e))\n-\n-        try:\n-            self.assertTemplateUsed(response, 'GET Template', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: No templates used to render the response\", str(e))\n-\n-    def test_single_context(self):\n-        \"Template assertions work when there is a single context\"\n-        response = self.client.get('/test_client/post_view/', {})\n-\n-        try:\n-            self.assertTemplateNotUsed(response, 'Empty GET Template')\n-        except AssertionError as e:\n-            self.assertIn(\"Template 'Empty GET Template' was used unexpectedly in rendering the response\", str(e))\n-\n-        try:\n-            self.assertTemplateNotUsed(response, 'Empty GET Template', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Template 'Empty GET Template' was used unexpectedly in rendering the response\", str(e))\n-\n-        try:\n-            self.assertTemplateUsed(response, 'Empty POST Template')\n-        except AssertionError as e:\n-            self.assertIn(\"Template 'Empty POST Template' was not a template used to render the response. Actual template(s) used: Empty GET Template\", str(e))\n-\n-        try:\n-            self.assertTemplateUsed(response, 'Empty POST Template', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Template 'Empty POST Template' was not a template used to render the response. Actual template(s) used: Empty GET Template\", str(e))\n-\n-    def test_multiple_context(self):\n-        \"Template assertions work when there are multiple contexts\"\n-        post_data = {\n-            'text': 'Hello World',\n-            'email': 'foo@example.com',\n-            'value': 37,\n-            'single': 'b',\n-            'multi': ('b','c','e')\n-        }\n-        response = self.client.post('/test_client/form_view_with_template/', post_data)\n-        self.assertContains(response, 'POST data OK')\n-        try:\n-            self.assertTemplateNotUsed(response, \"form_view.html\")\n-        except AssertionError as e:\n-            self.assertIn(\"Template 'form_view.html' was used unexpectedly in rendering the response\", str(e))\n-\n-        try:\n-            self.assertTemplateNotUsed(response, 'base.html')\n-        except AssertionError as e:\n-            self.assertIn(\"Template 'base.html' was used unexpectedly in rendering the response\", str(e))\n-\n-        try:\n-            self.assertTemplateUsed(response, \"Valid POST Template\")\n-        except AssertionError as e:\n-            self.assertIn(\"Template 'Valid POST Template' was not a template used to render the response. Actual template(s) used: form_view.html, base.html\", str(e))\n-\n-class AssertRedirectsTests(TestCase):\n-    def test_redirect_page(self):\n-        \"An assertion is raised if the original page couldn't be retrieved as expected\"\n-        # This page will redirect with code 301, not 302\n-        response = self.client.get('/test_client/permanent_redirect_view/')\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/')\n-        except AssertionError as e:\n-            self.assertIn(\"Response didn't redirect as expected: Response code was 301 (expected 302)\", str(e))\n-\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Response didn't redirect as expected: Response code was 301 (expected 302)\", str(e))\n-\n-    def test_lost_query(self):\n-        \"An assertion is raised if the redirect location doesn't preserve GET parameters\"\n-        response = self.client.get('/test_client/redirect_view/', {'var': 'value'})\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/')\n-        except AssertionError as e:\n-            self.assertIn(\"Response redirected to 'http://testserver/test_client/get_view/?var=value', expected 'http://testserver/test_client/get_view/'\", str(e))\n-\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Response redirected to 'http://testserver/test_client/get_view/?var=value', expected 'http://testserver/test_client/get_view/'\", str(e))\n-\n-    def test_incorrect_target(self):\n-        \"An assertion is raised if the response redirects to another target\"\n-        response = self.client.get('/test_client/permanent_redirect_view/')\n-        try:\n-            # Should redirect to get_view\n-            self.assertRedirects(response, '/test_client/some_view/')\n-        except AssertionError as e:\n-            self.assertIn(\"Response didn't redirect as expected: Response code was 301 (expected 302)\", str(e))\n-\n-    def test_target_page(self):\n-        \"An assertion is raised if the response redirect target cannot be retrieved as expected\"\n-        response = self.client.get('/test_client/double_redirect_view/')\n-        try:\n-            # The redirect target responds with a 301 code, not 200\n-            self.assertRedirects(response, 'http://testserver/test_client/permanent_redirect_view/')\n-        except AssertionError as e:\n-            self.assertIn(\"Couldn't retrieve redirection page '/test_client/permanent_redirect_view/': response code was 301 (expected 200)\", str(e))\n-\n-        try:\n-            # The redirect target responds with a 301 code, not 200\n-            self.assertRedirects(response, 'http://testserver/test_client/permanent_redirect_view/', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Couldn't retrieve redirection page '/test_client/permanent_redirect_view/': response code was 301 (expected 200)\", str(e))\n-\n-    def test_redirect_chain(self):\n-        \"You can follow a redirect chain of multiple redirects\"\n-        response = self.client.get('/test_client_regress/redirects/further/more/', {}, follow=True)\n-        self.assertRedirects(response, '/test_client_regress/no_template_view/',\n-            status_code=301, target_status_code=200)\n-\n-        self.assertEqual(len(response.redirect_chain), 1)\n-        self.assertEqual(response.redirect_chain[0], ('http://testserver/test_client_regress/no_template_view/', 301))\n-\n-    def test_multiple_redirect_chain(self):\n-        \"You can follow a redirect chain of multiple redirects\"\n-        response = self.client.get('/test_client_regress/redirects/', {}, follow=True)\n-        self.assertRedirects(response, '/test_client_regress/no_template_view/',\n-            status_code=301, target_status_code=200)\n-\n-        self.assertEqual(len(response.redirect_chain), 3)\n-        self.assertEqual(response.redirect_chain[0], ('http://testserver/test_client_regress/redirects/further/', 301))\n-        self.assertEqual(response.redirect_chain[1], ('http://testserver/test_client_regress/redirects/further/more/', 301))\n-        self.assertEqual(response.redirect_chain[2], ('http://testserver/test_client_regress/no_template_view/', 301))\n-\n-    def test_redirect_chain_to_non_existent(self):\n-        \"You can follow a chain to a non-existent view\"\n-        response = self.client.get('/test_client_regress/redirect_to_non_existent_view2/', {}, follow=True)\n-        self.assertRedirects(response, '/test_client_regress/non_existent_view/',\n-            status_code=301, target_status_code=404)\n-\n-    def test_redirect_chain_to_self(self):\n-        \"Redirections to self are caught and escaped\"\n-        response = self.client.get('/test_client_regress/redirect_to_self/', {}, follow=True)\n-        # The chain of redirects stops once the cycle is detected.\n-        self.assertRedirects(response, '/test_client_regress/redirect_to_self/',\n-            status_code=301, target_status_code=301)\n-        self.assertEqual(len(response.redirect_chain), 2)\n-\n-    def test_circular_redirect(self):\n-        \"Circular redirect chains are caught and escaped\"\n-        response = self.client.get('/test_client_regress/circular_redirect_1/', {}, follow=True)\n-        # The chain of redirects will get back to the starting point, but stop there.\n-        self.assertRedirects(response, '/test_client_regress/circular_redirect_2/',\n-            status_code=301, target_status_code=301)\n-        self.assertEqual(len(response.redirect_chain), 4)\n-\n-    def test_redirect_chain_post(self):\n-        \"A redirect chain will be followed from an initial POST post\"\n-        response = self.client.post('/test_client_regress/redirects/',\n-            {'nothing': 'to_send'}, follow=True)\n-        self.assertRedirects(response,\n-            '/test_client_regress/no_template_view/', 301, 200)\n-        self.assertEqual(len(response.redirect_chain), 3)\n-\n-    def test_redirect_chain_head(self):\n-        \"A redirect chain will be followed from an initial HEAD request\"\n-        response = self.client.head('/test_client_regress/redirects/',\n-            {'nothing': 'to_send'}, follow=True)\n-        self.assertRedirects(response,\n-            '/test_client_regress/no_template_view/', 301, 200)\n-        self.assertEqual(len(response.redirect_chain), 3)\n-\n-    def test_redirect_chain_options(self):\n-        \"A redirect chain will be followed from an initial OPTIONS request\"\n-        response = self.client.options('/test_client_regress/redirects/',\n-            {'nothing': 'to_send'}, follow=True)\n-        self.assertRedirects(response,\n-            '/test_client_regress/no_template_view/', 301, 200)\n-        self.assertEqual(len(response.redirect_chain), 3)\n-\n-    def test_redirect_chain_put(self):\n-        \"A redirect chain will be followed from an initial PUT request\"\n-        response = self.client.put('/test_client_regress/redirects/',\n-            {'nothing': 'to_send'}, follow=True)\n-        self.assertRedirects(response,\n-            '/test_client_regress/no_template_view/', 301, 200)\n-        self.assertEqual(len(response.redirect_chain), 3)\n-\n-    def test_redirect_chain_delete(self):\n-        \"A redirect chain will be followed from an initial DELETE request\"\n-        response = self.client.delete('/test_client_regress/redirects/',\n-            {'nothing': 'to_send'}, follow=True)\n-        self.assertRedirects(response,\n-            '/test_client_regress/no_template_view/', 301, 200)\n-        self.assertEqual(len(response.redirect_chain), 3)\n-\n-    def test_redirect_to_different_host(self):\n-        \"The test client will preserve scheme, host and port changes\"\n-        response = self.client.get('/test_client_regress/redirect_other_host/', follow=True)\n-        self.assertRedirects(response,\n-            'https://otherserver:8443/test_client_regress/no_template_view/',\n-            status_code=301, target_status_code=200)\n-        # We can't use is_secure() or get_host()\n-        # because response.request is a dictionary, not an HttpRequest\n-        self.assertEqual(response.request.get('wsgi.url_scheme'), 'https')\n-        self.assertEqual(response.request.get('SERVER_NAME'), 'otherserver')\n-        self.assertEqual(response.request.get('SERVER_PORT'), '8443')\n-\n-    def test_redirect_chain_on_non_redirect_page(self):\n-        \"An assertion is raised if the original page couldn't be retrieved as expected\"\n-        # This page will redirect with code 301, not 302\n-        response = self.client.get('/test_client/get_view/', follow=True)\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/')\n-        except AssertionError as e:\n-            self.assertIn(\"Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n-\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n-\n-    def test_redirect_on_non_redirect_page(self):\n-        \"An assertion is raised if the original page couldn't be retrieved as expected\"\n-        # This page will redirect with code 301, not 302\n-        response = self.client.get('/test_client/get_view/')\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/')\n-        except AssertionError as e:\n-            self.assertIn(\"Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n-\n-        try:\n-            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n-\n-\n-class AssertFormErrorTests(TestCase):\n-    def test_unknown_form(self):\n-        \"An assertion is raised if the form name is unknown\"\n-        post_data = {\n-            'text': 'Hello World',\n-            'email': 'not an email address',\n-            'value': 37,\n-            'single': 'b',\n-            'multi': ('b','c','e')\n-        }\n-        response = self.client.post('/test_client/form_view/', post_data)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTemplateUsed(response, \"Invalid POST Template\")\n-\n-        try:\n-            self.assertFormError(response, 'wrong_form', 'some_field', 'Some error.')\n-        except AssertionError as e:\n-            self.assertIn(\"The form 'wrong_form' was not used to render the response\", str(e))\n-        try:\n-            self.assertFormError(response, 'wrong_form', 'some_field', 'Some error.', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: The form 'wrong_form' was not used to render the response\", str(e))\n-\n-    def test_unknown_field(self):\n-        \"An assertion is raised if the field name is unknown\"\n-        post_data = {\n-            'text': 'Hello World',\n-            'email': 'not an email address',\n-            'value': 37,\n-            'single': 'b',\n-            'multi': ('b','c','e')\n-        }\n-        response = self.client.post('/test_client/form_view/', post_data)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTemplateUsed(response, \"Invalid POST Template\")\n-\n-        try:\n-            self.assertFormError(response, 'form', 'some_field', 'Some error.')\n-        except AssertionError as e:\n-            self.assertIn(\"The form 'form' in context 0 does not contain the field 'some_field'\", str(e))\n-        try:\n-            self.assertFormError(response, 'form', 'some_field', 'Some error.', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: The form 'form' in context 0 does not contain the field 'some_field'\", str(e))\n-\n-    def test_noerror_field(self):\n-        \"An assertion is raised if the field doesn't have any errors\"\n-        post_data = {\n-            'text': 'Hello World',\n-            'email': 'not an email address',\n-            'value': 37,\n-            'single': 'b',\n-            'multi': ('b','c','e')\n-        }\n-        response = self.client.post('/test_client/form_view/', post_data)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTemplateUsed(response, \"Invalid POST Template\")\n-\n-        try:\n-            self.assertFormError(response, 'form', 'value', 'Some error.')\n-        except AssertionError as e:\n-            self.assertIn(\"The field 'value' on form 'form' in context 0 contains no errors\", str(e))\n-        try:\n-            self.assertFormError(response, 'form', 'value', 'Some error.', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: The field 'value' on form 'form' in context 0 contains no errors\", str(e))\n-\n-    def test_unknown_error(self):\n-        \"An assertion is raised if the field doesn't contain the provided error\"\n-        post_data = {\n-            'text': 'Hello World',\n-            'email': 'not an email address',\n-            'value': 37,\n-            'single': 'b',\n-            'multi': ('b','c','e')\n-        }\n-        response = self.client.post('/test_client/form_view/', post_data)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTemplateUsed(response, \"Invalid POST Template\")\n-\n-        try:\n-            self.assertFormError(response, 'form', 'email', 'Some error.')\n-        except AssertionError as e:\n-            self.assertIn(\"The field 'email' on form 'form' in context 0 does not contain the error 'Some error.' (actual errors: [u'Enter a valid e-mail address.'])\", str(e))\n-        try:\n-            self.assertFormError(response, 'form', 'email', 'Some error.', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: The field 'email' on form 'form' in context 0 does not contain the error 'Some error.' (actual errors: [u'Enter a valid e-mail address.'])\", str(e))\n-\n-    def test_unknown_nonfield_error(self):\n-        \"\"\"\n-        Checks that an assertion is raised if the form's non field errors\n-        doesn't contain the provided error.\n-        \"\"\"\n-        post_data = {\n-            'text': 'Hello World',\n-            'email': 'not an email address',\n-            'value': 37,\n-            'single': 'b',\n-            'multi': ('b','c','e')\n-        }\n-        response = self.client.post('/test_client/form_view/', post_data)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTemplateUsed(response, \"Invalid POST Template\")\n-\n-        try:\n-            self.assertFormError(response, 'form', None, 'Some error.')\n-        except AssertionError as e:\n-            self.assertIn(\"The form 'form' in context 0 does not contain the non-field error 'Some error.' (actual errors: )\", str(e))\n-        try:\n-            self.assertFormError(response, 'form', None, 'Some error.', msg_prefix='abc')\n-        except AssertionError as e:\n-            self.assertIn(\"abc: The form 'form' in context 0 does not contain the non-field error 'Some error.' (actual errors: )\", str(e))\n-\n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n-class LoginTests(TestCase):\n-    fixtures = ['testdata']\n-\n-    def test_login_different_client(self):\n-        \"Check that using a different test client doesn't violate authentication\"\n-\n-        # Create a second client, and log in.\n-        c = Client()\n-        login = c.login(username='testclient', password='password')\n-        self.assertTrue(login, 'Could not log in')\n-\n-        # Get a redirection page with the second client.\n-        response = c.get(\"/test_client_regress/login_protected_redirect_view/\")\n-\n-        # At this points, the self.client isn't logged in.\n-        # Check that assertRedirects uses the original client, not the\n-        # default client.\n-        self.assertRedirects(response, \"http://testserver/test_client_regress/get_view/\")\n-\n-\n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n-class SessionEngineTests(TestCase):\n-    fixtures = ['testdata']\n-\n-    def setUp(self):\n-        self.old_SESSION_ENGINE = settings.SESSION_ENGINE\n-        settings.SESSION_ENGINE = 'regressiontests.test_client_regress.session'\n-\n-    def tearDown(self):\n-        settings.SESSION_ENGINE = self.old_SESSION_ENGINE\n-\n-    def test_login(self):\n-        \"A session engine that modifies the session key can be used to log in\"\n-        login = self.client.login(username='testclient', password='password')\n-        self.assertTrue(login, 'Could not log in')\n-\n-        # Try to access a login protected page.\n-        response = self.client.get(\"/test_client/login_protected_view/\")\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.context['user'].username, 'testclient')\n-\n-\n-class URLEscapingTests(TestCase):\n-    def test_simple_argument_get(self):\n-        \"Get a view that has a simple string argument\"\n-        response = self.client.get(reverse('arg_view', args=['Slartibartfast']))\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'Howdy, Slartibartfast')\n-\n-    def test_argument_with_space_get(self):\n-        \"Get a view that has a string argument that requires escaping\"\n-        response = self.client.get(reverse('arg_view', args=['Arthur Dent']))\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'Hi, Arthur')\n-\n-    def test_simple_argument_post(self):\n-        \"Post for a view that has a simple string argument\"\n-        response = self.client.post(reverse('arg_view', args=['Slartibartfast']))\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'Howdy, Slartibartfast')\n-\n-    def test_argument_with_space_post(self):\n-        \"Post for a view that has a string argument that requires escaping\"\n-        response = self.client.post(reverse('arg_view', args=['Arthur Dent']))\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'Hi, Arthur')\n-\n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n-class ExceptionTests(TestCase):\n-    fixtures = ['testdata.json']\n-\n-    def test_exception_cleared(self):\n-        \"#5836 - A stale user exception isn't re-raised by the test client.\"\n-\n-        login = self.client.login(username='testclient',password='password')\n-        self.assertTrue(login, 'Could not log in')\n-        try:\n-            response = self.client.get(\"/test_client_regress/staff_only/\")\n-            self.fail(\"General users should not be able to visit this page\")\n-        except SuspiciousOperation:\n-            pass\n-\n-        # At this point, an exception has been raised, and should be cleared.\n-\n-        # This next operation should be successful; if it isn't we have a problem.\n-        login = self.client.login(username='staff', password='password')\n-        self.assertTrue(login, 'Could not log in')\n-        try:\n-            self.client.get(\"/test_client_regress/staff_only/\")\n-        except SuspiciousOperation:\n-            self.fail(\"Staff should be able to visit this page\")\n-\n-class TemplateExceptionTests(TestCase):\n-    def setUp(self):\n-        # Reset the loaders so they don't try to render cached templates.\n-        if loader.template_source_loaders is not None:\n-            for template_loader in loader.template_source_loaders:\n-                if hasattr(template_loader, 'reset'):\n-                    template_loader.reset()\n-        self.old_templates = settings.TEMPLATE_DIRS\n-        settings.TEMPLATE_DIRS = ()\n-\n-    def tearDown(self):\n-        settings.TEMPLATE_DIRS = self.old_templates\n-\n-    def test_no_404_template(self):\n-        \"Missing templates are correctly reported by test client\"\n-        try:\n-            response = self.client.get(\"/no_such_view/\")\n-            self.fail(\"Should get error about missing template\")\n-        except TemplateDoesNotExist:\n-            pass\n-\n-    def test_bad_404_template(self):\n-        \"Errors found when rendering 404 error templates are re-raised\"\n-        settings.TEMPLATE_DIRS = (os.path.join(os.path.dirname(__file__), 'bad_templates'),)\n-        try:\n-            response = self.client.get(\"/no_such_view/\")\n-            self.fail(\"Should get error about syntax error in template\")\n-        except TemplateSyntaxError:\n-            pass\n-\n-# We need two different tests to check URLconf substitution -  one to check\n-# it was changed, and another one (without self.urls) to check it was reverted on\n-# teardown. This pair of tests relies upon the alphabetical ordering of test execution.\n-class UrlconfSubstitutionTests(TestCase):\n-    urls = 'regressiontests.test_client_regress.urls'\n-\n-    def test_urlconf_was_changed(self):\n-        \"TestCase can enforce a custom URLconf on a per-test basis\"\n-        url = reverse('arg_view', args=['somename'])\n-        self.assertEqual(url, '/arg_view/somename/')\n-\n-# This test needs to run *after* UrlconfSubstitutionTests; the zz prefix in the\n-# name is to ensure alphabetical ordering.\n-class zzUrlconfSubstitutionTests(TestCase):\n-    def test_urlconf_was_reverted(self):\n-        \"URLconf is reverted to original value after modification in a TestCase\"\n-        url = reverse('arg_view', args=['somename'])\n-        self.assertEqual(url, '/test_client_regress/arg_view/somename/')\n-\n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n-class ContextTests(TestCase):\n-    fixtures = ['testdata']\n-\n-    def test_single_context(self):\n-        \"Context variables can be retrieved from a single context\"\n-        response = self.client.get(\"/test_client_regress/request_data/\", data={'foo':'whiz'})\n-        self.assertEqual(response.context.__class__, Context)\n-        self.assertTrue('get-foo' in response.context)\n-        self.assertEqual(response.context['get-foo'], 'whiz')\n-        self.assertEqual(response.context['request-foo'], 'whiz')\n-        self.assertEqual(response.context['data'], 'sausage')\n-\n-        try:\n-            response.context['does-not-exist']\n-            self.fail('Should not be able to retrieve non-existent key')\n-        except KeyError as e:\n-            self.assertEqual(e.args[0], 'does-not-exist')\n-\n-    def test_inherited_context(self):\n-        \"Context variables can be retrieved from a list of contexts\"\n-        response = self.client.get(\"/test_client_regress/request_data_extended/\", data={'foo':'whiz'})\n-        self.assertEqual(response.context.__class__, ContextList)\n-        self.assertEqual(len(response.context), 2)\n-        self.assertTrue('get-foo' in response.context)\n-        self.assertEqual(response.context['get-foo'], 'whiz')\n-        self.assertEqual(response.context['request-foo'], 'whiz')\n-        self.assertEqual(response.context['data'], 'bacon')\n-\n-        try:\n-            response.context['does-not-exist']\n-            self.fail('Should not be able to retrieve non-existent key')\n-        except KeyError as e:\n-            self.assertEqual(e.args[0], 'does-not-exist')\n-\n-    def test_15368(self):\n-        # Need to insert a context processor that assumes certain things about\n-        # the request instance. This triggers a bug caused by some ways of\n-        # copying RequestContext.\n-        try:\n-            django.template.context._standard_context_processors = (lambda request: {'path': request.special_path},)\n-            response = self.client.get(\"/test_client_regress/request_context_view/\")\n-            self.assertContains(response, 'Path: /test_client_regress/request_context_view/')\n-        finally:\n-            django.template.context._standard_context_processors = None\n-\n-\n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n-class SessionTests(TestCase):\n-    fixtures = ['testdata.json']\n-\n-    def test_session(self):\n-        \"The session isn't lost if a user logs in\"\n-        # The session doesn't exist to start.\n-        response = self.client.get('/test_client_regress/check_session/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'NO')\n-\n-        # This request sets a session variable.\n-        response = self.client.get('/test_client_regress/set_session/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'set_session')\n-\n-        # Check that the session has been modified\n-        response = self.client.get('/test_client_regress/check_session/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'YES')\n-\n-        # Log in\n-        login = self.client.login(username='testclient',password='password')\n-        self.assertTrue(login, 'Could not log in')\n-\n-        # Session should still contain the modified value\n-        response = self.client.get('/test_client_regress/check_session/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'YES')\n-\n-    def test_logout(self):\n-        \"\"\"Logout should work whether the user is logged in or not (#9978).\"\"\"\n-        self.client.logout()\n-        login = self.client.login(username='testclient',password='password')\n-        self.assertTrue(login, 'Could not log in')\n-        self.client.logout()\n-        self.client.logout()\n-\n-class RequestMethodTests(TestCase):\n-    def test_get(self):\n-        \"Request a view via request method GET\"\n-        response = self.client.get('/test_client_regress/request_methods/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: GET')\n-\n-    def test_post(self):\n-        \"Request a view via request method POST\"\n-        response = self.client.post('/test_client_regress/request_methods/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: POST')\n-\n-    def test_head(self):\n-        \"Request a view via request method HEAD\"\n-        response = self.client.head('/test_client_regress/request_methods/')\n-        self.assertEqual(response.status_code, 200)\n-        # A HEAD request doesn't return any content.\n-        self.assertNotEqual(response.content, 'request method: HEAD')\n-        self.assertEqual(response.content, '')\n-\n-    def test_options(self):\n-        \"Request a view via request method OPTIONS\"\n-        response = self.client.options('/test_client_regress/request_methods/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: OPTIONS')\n-\n-    def test_put(self):\n-        \"Request a view via request method PUT\"\n-        response = self.client.put('/test_client_regress/request_methods/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: PUT')\n-\n-    def test_delete(self):\n-        \"Request a view via request method DELETE\"\n-        response = self.client.delete('/test_client_regress/request_methods/')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: DELETE')\n-\n-class RequestMethodStringDataTests(TestCase):\n-    def test_post(self):\n-        \"Request a view with string data via request method POST\"\n-        # Regression test for #11371\n-        data = u'{\"test\": \"json\"}'\n-        response = self.client.post('/test_client_regress/request_methods/', data=data, content_type='application/json')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: POST')\n-\n-    def test_put(self):\n-        \"Request a view with string data via request method PUT\"\n-        # Regression test for #11371\n-        data = u'{\"test\": \"json\"}'\n-        response = self.client.put('/test_client_regress/request_methods/', data=data, content_type='application/json')\n-        self.assertEqual(response.status_code, 200)\n-        self.assertEqual(response.content, 'request method: PUT')\n-\n-class QueryStringTests(TestCase):\n-    def test_get_like_requests(self):\n-        # See: https://code.djangoproject.com/ticket/10571.\n-        # Removed 'put' and 'delete' here as they are 'GET-like requests'\n-        for method_name in ('get','head','options'):\n-            # A GET-like request can pass a query string as data\n-            method = getattr(self.client, method_name)\n-            response = method(\"/test_client_regress/request_data/\", data={'foo':'whiz'})\n-            self.assertEqual(response.context['get-foo'], 'whiz')\n-            self.assertEqual(response.context['request-foo'], 'whiz')\n-\n-            # A GET-like request can pass a query string as part of the URL\n-            response = method(\"/test_client_regress/request_data/?foo=whiz\")\n-            self.assertEqual(response.context['get-foo'], 'whiz')\n-            self.assertEqual(response.context['request-foo'], 'whiz')\n-\n-            # Data provided in the URL to a GET-like request is overridden by actual form data\n-            response = method(\"/test_client_regress/request_data/?foo=whiz\", data={'foo':'bang'})\n-            self.assertEqual(response.context['get-foo'], 'bang')\n-            self.assertEqual(response.context['request-foo'], 'bang')\n-\n-            response = method(\"/test_client_regress/request_data/?foo=whiz\", data={'bar':'bang'})\n-            self.assertEqual(response.context['get-foo'], None)\n-            self.assertEqual(response.context['get-bar'], 'bang')\n-            self.assertEqual(response.context['request-foo'], None)\n-            self.assertEqual(response.context['request-bar'], 'bang')\n-\n-    def test_post_like_requests(self):\n-        # A POST-like request can pass a query string as data\n-        response = self.client.post(\"/test_client_regress/request_data/\", data={'foo':'whiz'})\n-        self.assertEqual(response.context['get-foo'], None)\n-        self.assertEqual(response.context['post-foo'], 'whiz')\n-\n-        # A POST-like request can pass a query string as part of the URL\n-        response = self.client.post(\"/test_client_regress/request_data/?foo=whiz\")\n-        self.assertEqual(response.context['get-foo'], 'whiz')\n-        self.assertEqual(response.context['post-foo'], None)\n-        self.assertEqual(response.context['request-foo'], 'whiz')\n-\n-        # POST data provided in the URL augments actual form data\n-        response = self.client.post(\"/test_client_regress/request_data/?foo=whiz\", data={'foo':'bang'})\n-        self.assertEqual(response.context['get-foo'], 'whiz')\n-        self.assertEqual(response.context['post-foo'], 'bang')\n-        self.assertEqual(response.context['request-foo'], 'bang')\n-\n-        response = self.client.post(\"/test_client_regress/request_data/?foo=whiz\", data={'bar':'bang'})\n-        self.assertEqual(response.context['get-foo'], 'whiz')\n-        self.assertEqual(response.context['get-bar'], None)\n-        self.assertEqual(response.context['post-foo'], None)\n-        self.assertEqual(response.context['post-bar'], 'bang')\n-        self.assertEqual(response.context['request-foo'], 'whiz')\n-        self.assertEqual(response.context['request-bar'], 'bang')\n-\n-class UnicodePayloadTests(TestCase):\n-    def test_simple_unicode_payload(self):\n-        \"A simple ASCII-only unicode JSON document can be POSTed\"\n-        # Regression test for #10571\n-        json = u'{\"english\": \"mountain pass\"}'\n-        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json\")\n-        self.assertEqual(response.content, json)\n-        response = self.client.put(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json\")\n-        self.assertEqual(response.content, json)\n-\n-    def test_unicode_payload_utf8(self):\n-        \"A non-ASCII unicode data encoded as UTF-8 can be POSTed\"\n-        # Regression test for #10571\n-        json = u'{\"dog\": \"—Å–æ–±–∞–∫–∞\"}'\n-        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json; charset=utf-8\")\n-        self.assertEqual(response.content, json.encode('utf-8'))\n-        response = self.client.put(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json; charset=utf-8\")\n-        self.assertEqual(response.content, json.encode('utf-8'))\n-\n-    def test_unicode_payload_utf16(self):\n-        \"A non-ASCII unicode data encoded as UTF-16 can be POSTed\"\n-        # Regression test for #10571\n-        json = u'{\"dog\": \"—Å–æ–±–∞–∫–∞\"}'\n-        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json; charset=utf-16\")\n-        self.assertEqual(response.content, json.encode('utf-16'))\n-        response = self.client.put(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json; charset=utf-16\")\n-        self.assertEqual(response.content, json.encode('utf-16'))\n-\n-    def test_unicode_payload_non_utf(self):\n-        \"A non-ASCII unicode data as a non-UTF based encoding can be POSTed\"\n-        #Regression test for #10571\n-        json = u'{\"dog\": \"—Å–æ–±–∞–∫–∞\"}'\n-        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json; charset=koi8-r\")\n-        self.assertEqual(response.content, json.encode('koi8-r'))\n-        response = self.client.put(\"/test_client_regress/parse_unicode_json/\", json,\n-                                    content_type=\"application/json; charset=koi8-r\")\n-        self.assertEqual(response.content, json.encode('koi8-r'))\n-\n-class DummyFile(object):\n-    def __init__(self, filename):\n-        self.name = filename\n-    def read(self):\n-        return 'TEST_FILE_CONTENT'\n-\n-class UploadedFileEncodingTest(TestCase):\n-    def test_file_encoding(self):\n-        encoded_file = encode_file('TEST_BOUNDARY', 'TEST_KEY', DummyFile('test_name.bin'))\n-        self.assertEqual('--TEST_BOUNDARY', encoded_file[0])\n-        self.assertEqual('Content-Disposition: form-data; name=\"TEST_KEY\"; filename=\"test_name.bin\"', encoded_file[1])\n-        self.assertEqual('TEST_FILE_CONTENT', encoded_file[-1])\n-\n-    def test_guesses_content_type_on_file_encoding(self):\n-        self.assertEqual('Content-Type: application/octet-stream',\n-                         encode_file('IGNORE', 'IGNORE', DummyFile(\"file.bin\"))[2])\n-        self.assertEqual('Content-Type: text/plain',\n-                         encode_file('IGNORE', 'IGNORE', DummyFile(\"file.txt\"))[2])\n-        self.assertIn(encode_file('IGNORE', 'IGNORE', DummyFile(\"file.zip\"))[2], (\n-                        'Content-Type: application/x-compress',\n-                        'Content-Type: application/x-zip',\n-                        'Content-Type: application/x-zip-compressed',\n-                        'Content-Type: application/zip',))\n-        self.assertEqual('Content-Type: application/octet-stream',\n-                         encode_file('IGNORE', 'IGNORE', DummyFile(\"file.unknown\"))[2])\n-\n-class RequestHeadersTest(TestCase):\n-    def test_client_headers(self):\n-        \"A test client can receive custom headers\"\n-        response = self.client.get(\"/test_client_regress/check_headers/\", HTTP_X_ARG_CHECK='Testing 123')\n-        self.assertEqual(response.content, \"HTTP_X_ARG_CHECK: Testing 123\")\n-        self.assertEqual(response.status_code, 200)\n-\n-    def test_client_headers_redirect(self):\n-        \"Test client headers are preserved through redirects\"\n-        response = self.client.get(\"/test_client_regress/check_headers_redirect/\", follow=True, HTTP_X_ARG_CHECK='Testing 123')\n-        self.assertEqual(response.content, \"HTTP_X_ARG_CHECK: Testing 123\")\n-        self.assertRedirects(response, '/test_client_regress/check_headers/',\n-            status_code=301, target_status_code=200)\n-\n-\n-class ReadLimitedStreamTest(TestCase):\n-    \"\"\"\n-    Tests that ensure that HttpRequest.body, HttpRequest.read() and\n-    HttpRequest.read(BUFFER) have proper LimitedStream behavior.\n-\n-    Refs #14753, #15785\n-    \"\"\"\n-\n-    def test_body_from_empty_request(self):\n-        \"\"\"HttpRequest.body on a test client GET request should return\n-        the empty string.\"\"\"\n-        self.assertEqual(self.client.get(\"/test_client_regress/body/\").content, '')\n-\n-    def test_read_from_empty_request(self):\n-        \"\"\"HttpRequest.read() on a test client GET request should return the\n-        empty string.\"\"\"\n-        self.assertEqual(self.client.get(\"/test_client_regress/read_all/\").content, '')\n-\n-    def test_read_numbytes_from_empty_request(self):\n-        \"\"\"HttpRequest.read(LARGE_BUFFER) on a test client GET request should\n-        return the empty string.\"\"\"\n-        self.assertEqual(self.client.get(\"/test_client_regress/read_buffer/\").content, '')\n-\n-    def test_read_from_nonempty_request(self):\n-        \"\"\"HttpRequest.read() on a test client PUT request with some payload\n-        should return that payload.\"\"\"\n-        payload = 'foobar'\n-        self.assertEqual(self.client.put(\"/test_client_regress/read_all/\",\n-                                          data=payload,\n-                                          content_type='text/plain').content, payload)\n-\n-    def test_read_numbytes_from_nonempty_request(self):\n-        \"\"\"HttpRequest.read(LARGE_BUFFER) on a test client PUT request with\n-        some payload should return that payload.\"\"\"\n-        payload = 'foobar'\n-        self.assertEqual(self.client.put(\"/test_client_regress/read_buffer/\",\n-                                          data=payload,\n-                                          content_type='text/plain').content, payload)\n-\n-\n-class RequestFactoryStateTest(TestCase):\n-    \"\"\"Regression tests for #15929.\"\"\"\n-    # These tests are checking that certain middleware don't change certain\n-    # global state. Alternatively, from the point of view of a test, they are\n-    # ensuring test isolation behavior. So, unusually, it doesn't make sense to\n-    # run the tests individually, and if any are failing it is confusing to run\n-    # them with any other set of tests.\n-\n-    def setUp(self):\n-        self.factory = RequestFactory()\n-\n-    def common_test_that_should_always_pass(self):\n-        request = self.factory.get('/')\n-        request.session = {}\n-        self.assertFalse(hasattr(request, 'user'))\n-\n-    def test_request(self):\n-        self.common_test_that_should_always_pass()\n-\n-    def test_request_after_client(self):\n-        # apart from the next line the three tests are identical\n-        self.client.get('/')\n-        self.common_test_that_should_always_pass()\n-\n-    def test_request_after_client_2(self):\n-        # This test is executed after the previous one\n-        self.common_test_that_should_always_pass()\n-\n-\n-class RequestFactoryEnvironmentTests(TestCase):\n-    \"\"\"\n-    Regression tests for #8551 and #17067: ensure that environment variables\n-    are set correctly in RequestFactory.\n-    \"\"\"\n-\n-    def setUp(self):\n-        self.factory = RequestFactory()\n-\n-    def test_should_set_correct_env_variables(self):\n-        request = self.factory.get('/path/')\n-\n-        self.assertEqual(request.META.get('REMOTE_ADDR'), '127.0.0.1')\n-        self.assertEqual(request.META.get('SERVER_NAME'), 'testserver')\n-        self.assertEqual(request.META.get('SERVER_PORT'), '80')\n-        self.assertEqual(request.META.get('SERVER_PROTOCOL'), 'HTTP/1.1')\n-        self.assertEqual(request.META.get('SCRIPT_NAME') +\n-                         request.META.get('PATH_INFO'), '/path/')"
        },
        {
            "sha": "ece487a211de26fbaa0d82bfb825c359cfc67d33",
            "filename": "tests/regressiontests/test_client_regress/tests.py",
            "status": "added",
            "additions": 1006,
            "deletions": 0,
            "changes": 1006,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -0,0 +1,1006 @@\n+# -*- coding: utf-8 -*-\n+\"\"\"\n+Regression tests for the Test Client, especially the customized assertions.\n+\"\"\"\n+import os\n+\n+from django.conf import settings\n+from django.core.exceptions import SuspiciousOperation\n+from django.core.urlresolvers import reverse\n+from django.template import (TemplateDoesNotExist, TemplateSyntaxError,\n+    Context, Template, loader)\n+import django.template.context\n+from django.test import Client, TestCase\n+from django.test.client import encode_file, RequestFactory\n+from django.test.utils import ContextList, override_settings\n+from django.template.response import SimpleTemplateResponse\n+from django.http import HttpResponse\n+\n+\n+@override_settings(\n+    TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+)\n+class AssertContainsTests(TestCase):\n+    def test_contains(self):\n+        \"Responses can be inspected for content, including counting repeated substrings\"\n+        response = self.client.get('/test_client_regress/no_template_view/')\n+\n+        self.assertNotContains(response, 'never')\n+        self.assertContains(response, 'never', 0)\n+        self.assertContains(response, 'once')\n+        self.assertContains(response, 'once', 1)\n+        self.assertContains(response, 'twice')\n+        self.assertContains(response, 'twice', 2)\n+\n+        try:\n+            self.assertContains(response, 'text', status_code=999)\n+        except AssertionError as e:\n+            self.assertIn(\"Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n+        try:\n+            self.assertContains(response, 'text', status_code=999, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n+\n+        try:\n+            self.assertNotContains(response, 'text', status_code=999)\n+        except AssertionError as e:\n+            self.assertIn(\"Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n+        try:\n+            self.assertNotContains(response, 'text', status_code=999, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Couldn't retrieve content: Response code was 200 (expected 999)\", str(e))\n+\n+        try:\n+            self.assertNotContains(response, 'once')\n+        except AssertionError as e:\n+            self.assertIn(\"Response should not contain 'once'\", str(e))\n+        try:\n+            self.assertNotContains(response, 'once', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Response should not contain 'once'\", str(e))\n+\n+        try:\n+            self.assertContains(response, 'never', 1)\n+        except AssertionError as e:\n+            self.assertIn(\"Found 0 instances of 'never' in response (expected 1)\", str(e))\n+        try:\n+            self.assertContains(response, 'never', 1, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Found 0 instances of 'never' in response (expected 1)\", str(e))\n+\n+        try:\n+            self.assertContains(response, 'once', 0)\n+        except AssertionError as e:\n+            self.assertIn(\"Found 1 instances of 'once' in response (expected 0)\", str(e))\n+        try:\n+            self.assertContains(response, 'once', 0, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Found 1 instances of 'once' in response (expected 0)\", str(e))\n+\n+        try:\n+            self.assertContains(response, 'once', 2)\n+        except AssertionError as e:\n+            self.assertIn(\"Found 1 instances of 'once' in response (expected 2)\", str(e))\n+        try:\n+            self.assertContains(response, 'once', 2, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Found 1 instances of 'once' in response (expected 2)\", str(e))\n+\n+        try:\n+            self.assertContains(response, 'twice', 1)\n+        except AssertionError as e:\n+            self.assertIn(\"Found 2 instances of 'twice' in response (expected 1)\", str(e))\n+        try:\n+            self.assertContains(response, 'twice', 1, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Found 2 instances of 'twice' in response (expected 1)\", str(e))\n+\n+        try:\n+            self.assertContains(response, 'thrice')\n+        except AssertionError as e:\n+            self.assertIn(\"Couldn't find 'thrice' in response\", str(e))\n+        try:\n+            self.assertContains(response, 'thrice', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Couldn't find 'thrice' in response\", str(e))\n+\n+        try:\n+            self.assertContains(response, 'thrice', 3)\n+        except AssertionError as e:\n+            self.assertIn(\"Found 0 instances of 'thrice' in response (expected 3)\", str(e))\n+        try:\n+            self.assertContains(response, 'thrice', 3, msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Found 0 instances of 'thrice' in response (expected 3)\", str(e))\n+\n+    def test_unicode_contains(self):\n+        \"Unicode characters can be found in template context\"\n+        #Regression test for #10183\n+        r = self.client.get('/test_client_regress/check_unicode/')\n+        self.assertContains(r, u'„Åï„Åã„Åç')\n+        self.assertContains(r, b'\\xe5\\xb3\\xa0'.decode('utf-8'))\n+\n+    def test_unicode_not_contains(self):\n+        \"Unicode characters can be searched for, and not found in template context\"\n+        #Regression test for #10183\n+        r = self.client.get('/test_client_regress/check_unicode/')\n+        self.assertNotContains(r, u'„ÅØ„Åü„Åë')\n+        self.assertNotContains(r, b'\\xe3\\x81\\xaf\\xe3\\x81\\x9f\\xe3\\x81\\x91'.decode('utf-8'))\n+\n+    def test_assert_contains_renders_template_response(self):\n+        \"\"\" Test that we can pass in an unrendered SimpleTemplateReponse\n+            without throwing an error.\n+            Refs #15826.\n+        \"\"\"\n+        response = SimpleTemplateResponse(Template('Hello'), status=200)\n+        self.assertContains(response, 'Hello')\n+\n+    def test_assert_contains_using_non_template_response(self):\n+        \"\"\" Test that auto-rendering does not affect responses that aren't\n+            instances (or subclasses) of SimpleTemplateResponse.\n+            Refs #15826.\n+        \"\"\"\n+        response = HttpResponse('Hello')\n+        self.assertContains(response, 'Hello')\n+\n+    def test_assert_not_contains_renders_template_response(self):\n+        \"\"\" Test that we can pass in an unrendered SimpleTemplateReponse\n+            without throwing an error.\n+            Refs #15826.\n+        \"\"\"\n+        response = SimpleTemplateResponse(Template('Hello'), status=200)\n+        self.assertNotContains(response, 'Bye')\n+\n+    def test_assert_not_contains_using_non_template_response(self):\n+        \"\"\" Test that auto-rendering does not affect responses that aren't\n+            instances (or subclasses) of SimpleTemplateResponse.\n+            Refs #15826.\n+        \"\"\"\n+        response = HttpResponse('Hello')\n+        self.assertNotContains(response, 'Bye')\n+\n+@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n+class AssertTemplateUsedTests(TestCase):\n+    fixtures = ['testdata.json']\n+\n+    def test_no_context(self):\n+        \"Template usage assertions work then templates aren't in use\"\n+        response = self.client.get('/test_client_regress/no_template_view/')\n+\n+        # Check that the no template case doesn't mess with the template assertions\n+        self.assertTemplateNotUsed(response, 'GET Template')\n+\n+        try:\n+            self.assertTemplateUsed(response, 'GET Template')\n+        except AssertionError as e:\n+            self.assertIn(\"No templates used to render the response\", str(e))\n+\n+        try:\n+            self.assertTemplateUsed(response, 'GET Template', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: No templates used to render the response\", str(e))\n+\n+    def test_single_context(self):\n+        \"Template assertions work when there is a single context\"\n+        response = self.client.get('/test_client/post_view/', {})\n+\n+        try:\n+            self.assertTemplateNotUsed(response, 'Empty GET Template')\n+        except AssertionError as e:\n+            self.assertIn(\"Template 'Empty GET Template' was used unexpectedly in rendering the response\", str(e))\n+\n+        try:\n+            self.assertTemplateNotUsed(response, 'Empty GET Template', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Template 'Empty GET Template' was used unexpectedly in rendering the response\", str(e))\n+\n+        try:\n+            self.assertTemplateUsed(response, 'Empty POST Template')\n+        except AssertionError as e:\n+            self.assertIn(\"Template 'Empty POST Template' was not a template used to render the response. Actual template(s) used: Empty GET Template\", str(e))\n+\n+        try:\n+            self.assertTemplateUsed(response, 'Empty POST Template', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Template 'Empty POST Template' was not a template used to render the response. Actual template(s) used: Empty GET Template\", str(e))\n+\n+    def test_multiple_context(self):\n+        \"Template assertions work when there are multiple contexts\"\n+        post_data = {\n+            'text': 'Hello World',\n+            'email': 'foo@example.com',\n+            'value': 37,\n+            'single': 'b',\n+            'multi': ('b','c','e')\n+        }\n+        response = self.client.post('/test_client/form_view_with_template/', post_data)\n+        self.assertContains(response, 'POST data OK')\n+        try:\n+            self.assertTemplateNotUsed(response, \"form_view.html\")\n+        except AssertionError as e:\n+            self.assertIn(\"Template 'form_view.html' was used unexpectedly in rendering the response\", str(e))\n+\n+        try:\n+            self.assertTemplateNotUsed(response, 'base.html')\n+        except AssertionError as e:\n+            self.assertIn(\"Template 'base.html' was used unexpectedly in rendering the response\", str(e))\n+\n+        try:\n+            self.assertTemplateUsed(response, \"Valid POST Template\")\n+        except AssertionError as e:\n+            self.assertIn(\"Template 'Valid POST Template' was not a template used to render the response. Actual template(s) used: form_view.html, base.html\", str(e))\n+\n+class AssertRedirectsTests(TestCase):\n+    def test_redirect_page(self):\n+        \"An assertion is raised if the original page couldn't be retrieved as expected\"\n+        # This page will redirect with code 301, not 302\n+        response = self.client.get('/test_client/permanent_redirect_view/')\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/')\n+        except AssertionError as e:\n+            self.assertIn(\"Response didn't redirect as expected: Response code was 301 (expected 302)\", str(e))\n+\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Response didn't redirect as expected: Response code was 301 (expected 302)\", str(e))\n+\n+    def test_lost_query(self):\n+        \"An assertion is raised if the redirect location doesn't preserve GET parameters\"\n+        response = self.client.get('/test_client/redirect_view/', {'var': 'value'})\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/')\n+        except AssertionError as e:\n+            self.assertIn(\"Response redirected to 'http://testserver/test_client/get_view/?var=value', expected 'http://testserver/test_client/get_view/'\", str(e))\n+\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Response redirected to 'http://testserver/test_client/get_view/?var=value', expected 'http://testserver/test_client/get_view/'\", str(e))\n+\n+    def test_incorrect_target(self):\n+        \"An assertion is raised if the response redirects to another target\"\n+        response = self.client.get('/test_client/permanent_redirect_view/')\n+        try:\n+            # Should redirect to get_view\n+            self.assertRedirects(response, '/test_client/some_view/')\n+        except AssertionError as e:\n+            self.assertIn(\"Response didn't redirect as expected: Response code was 301 (expected 302)\", str(e))\n+\n+    def test_target_page(self):\n+        \"An assertion is raised if the response redirect target cannot be retrieved as expected\"\n+        response = self.client.get('/test_client/double_redirect_view/')\n+        try:\n+            # The redirect target responds with a 301 code, not 200\n+            self.assertRedirects(response, 'http://testserver/test_client/permanent_redirect_view/')\n+        except AssertionError as e:\n+            self.assertIn(\"Couldn't retrieve redirection page '/test_client/permanent_redirect_view/': response code was 301 (expected 200)\", str(e))\n+\n+        try:\n+            # The redirect target responds with a 301 code, not 200\n+            self.assertRedirects(response, 'http://testserver/test_client/permanent_redirect_view/', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Couldn't retrieve redirection page '/test_client/permanent_redirect_view/': response code was 301 (expected 200)\", str(e))\n+\n+    def test_redirect_chain(self):\n+        \"You can follow a redirect chain of multiple redirects\"\n+        response = self.client.get('/test_client_regress/redirects/further/more/', {}, follow=True)\n+        self.assertRedirects(response, '/test_client_regress/no_template_view/',\n+            status_code=301, target_status_code=200)\n+\n+        self.assertEqual(len(response.redirect_chain), 1)\n+        self.assertEqual(response.redirect_chain[0], ('http://testserver/test_client_regress/no_template_view/', 301))\n+\n+    def test_multiple_redirect_chain(self):\n+        \"You can follow a redirect chain of multiple redirects\"\n+        response = self.client.get('/test_client_regress/redirects/', {}, follow=True)\n+        self.assertRedirects(response, '/test_client_regress/no_template_view/',\n+            status_code=301, target_status_code=200)\n+\n+        self.assertEqual(len(response.redirect_chain), 3)\n+        self.assertEqual(response.redirect_chain[0], ('http://testserver/test_client_regress/redirects/further/', 301))\n+        self.assertEqual(response.redirect_chain[1], ('http://testserver/test_client_regress/redirects/further/more/', 301))\n+        self.assertEqual(response.redirect_chain[2], ('http://testserver/test_client_regress/no_template_view/', 301))\n+\n+    def test_redirect_chain_to_non_existent(self):\n+        \"You can follow a chain to a non-existent view\"\n+        response = self.client.get('/test_client_regress/redirect_to_non_existent_view2/', {}, follow=True)\n+        self.assertRedirects(response, '/test_client_regress/non_existent_view/',\n+            status_code=301, target_status_code=404)\n+\n+    def test_redirect_chain_to_self(self):\n+        \"Redirections to self are caught and escaped\"\n+        response = self.client.get('/test_client_regress/redirect_to_self/', {}, follow=True)\n+        # The chain of redirects stops once the cycle is detected.\n+        self.assertRedirects(response, '/test_client_regress/redirect_to_self/',\n+            status_code=301, target_status_code=301)\n+        self.assertEqual(len(response.redirect_chain), 2)\n+\n+    def test_circular_redirect(self):\n+        \"Circular redirect chains are caught and escaped\"\n+        response = self.client.get('/test_client_regress/circular_redirect_1/', {}, follow=True)\n+        # The chain of redirects will get back to the starting point, but stop there.\n+        self.assertRedirects(response, '/test_client_regress/circular_redirect_2/',\n+            status_code=301, target_status_code=301)\n+        self.assertEqual(len(response.redirect_chain), 4)\n+\n+    def test_redirect_chain_post(self):\n+        \"A redirect chain will be followed from an initial POST post\"\n+        response = self.client.post('/test_client_regress/redirects/',\n+            {'nothing': 'to_send'}, follow=True)\n+        self.assertRedirects(response,\n+            '/test_client_regress/no_template_view/', 301, 200)\n+        self.assertEqual(len(response.redirect_chain), 3)\n+\n+    def test_redirect_chain_head(self):\n+        \"A redirect chain will be followed from an initial HEAD request\"\n+        response = self.client.head('/test_client_regress/redirects/',\n+            {'nothing': 'to_send'}, follow=True)\n+        self.assertRedirects(response,\n+            '/test_client_regress/no_template_view/', 301, 200)\n+        self.assertEqual(len(response.redirect_chain), 3)\n+\n+    def test_redirect_chain_options(self):\n+        \"A redirect chain will be followed from an initial OPTIONS request\"\n+        response = self.client.options('/test_client_regress/redirects/',\n+            follow=True)\n+        self.assertRedirects(response,\n+            '/test_client_regress/no_template_view/', 301, 200)\n+        self.assertEqual(len(response.redirect_chain), 3)\n+\n+    def test_redirect_chain_put(self):\n+        \"A redirect chain will be followed from an initial PUT request\"\n+        response = self.client.put('/test_client_regress/redirects/',\n+            follow=True)\n+        self.assertRedirects(response,\n+            '/test_client_regress/no_template_view/', 301, 200)\n+        self.assertEqual(len(response.redirect_chain), 3)\n+\n+    def test_redirect_chain_delete(self):\n+        \"A redirect chain will be followed from an initial DELETE request\"\n+        response = self.client.delete('/test_client_regress/redirects/',\n+            follow=True)\n+        self.assertRedirects(response,\n+            '/test_client_regress/no_template_view/', 301, 200)\n+        self.assertEqual(len(response.redirect_chain), 3)\n+\n+    def test_redirect_to_different_host(self):\n+        \"The test client will preserve scheme, host and port changes\"\n+        response = self.client.get('/test_client_regress/redirect_other_host/', follow=True)\n+        self.assertRedirects(response,\n+            'https://otherserver:8443/test_client_regress/no_template_view/',\n+            status_code=301, target_status_code=200)\n+        # We can't use is_secure() or get_host()\n+        # because response.request is a dictionary, not an HttpRequest\n+        self.assertEqual(response.request.get('wsgi.url_scheme'), 'https')\n+        self.assertEqual(response.request.get('SERVER_NAME'), 'otherserver')\n+        self.assertEqual(response.request.get('SERVER_PORT'), '8443')\n+\n+    def test_redirect_chain_on_non_redirect_page(self):\n+        \"An assertion is raised if the original page couldn't be retrieved as expected\"\n+        # This page will redirect with code 301, not 302\n+        response = self.client.get('/test_client/get_view/', follow=True)\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/')\n+        except AssertionError as e:\n+            self.assertIn(\"Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n+\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n+\n+    def test_redirect_on_non_redirect_page(self):\n+        \"An assertion is raised if the original page couldn't be retrieved as expected\"\n+        # This page will redirect with code 301, not 302\n+        response = self.client.get('/test_client/get_view/')\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/')\n+        except AssertionError as e:\n+            self.assertIn(\"Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n+\n+        try:\n+            self.assertRedirects(response, '/test_client/get_view/', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: Response didn't redirect as expected: Response code was 200 (expected 302)\", str(e))\n+\n+\n+class AssertFormErrorTests(TestCase):\n+    def test_unknown_form(self):\n+        \"An assertion is raised if the form name is unknown\"\n+        post_data = {\n+            'text': 'Hello World',\n+            'email': 'not an email address',\n+            'value': 37,\n+            'single': 'b',\n+            'multi': ('b','c','e')\n+        }\n+        response = self.client.post('/test_client/form_view/', post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTemplateUsed(response, \"Invalid POST Template\")\n+\n+        try:\n+            self.assertFormError(response, 'wrong_form', 'some_field', 'Some error.')\n+        except AssertionError as e:\n+            self.assertIn(\"The form 'wrong_form' was not used to render the response\", str(e))\n+        try:\n+            self.assertFormError(response, 'wrong_form', 'some_field', 'Some error.', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: The form 'wrong_form' was not used to render the response\", str(e))\n+\n+    def test_unknown_field(self):\n+        \"An assertion is raised if the field name is unknown\"\n+        post_data = {\n+            'text': 'Hello World',\n+            'email': 'not an email address',\n+            'value': 37,\n+            'single': 'b',\n+            'multi': ('b','c','e')\n+        }\n+        response = self.client.post('/test_client/form_view/', post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTemplateUsed(response, \"Invalid POST Template\")\n+\n+        try:\n+            self.assertFormError(response, 'form', 'some_field', 'Some error.')\n+        except AssertionError as e:\n+            self.assertIn(\"The form 'form' in context 0 does not contain the field 'some_field'\", str(e))\n+        try:\n+            self.assertFormError(response, 'form', 'some_field', 'Some error.', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: The form 'form' in context 0 does not contain the field 'some_field'\", str(e))\n+\n+    def test_noerror_field(self):\n+        \"An assertion is raised if the field doesn't have any errors\"\n+        post_data = {\n+            'text': 'Hello World',\n+            'email': 'not an email address',\n+            'value': 37,\n+            'single': 'b',\n+            'multi': ('b','c','e')\n+        }\n+        response = self.client.post('/test_client/form_view/', post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTemplateUsed(response, \"Invalid POST Template\")\n+\n+        try:\n+            self.assertFormError(response, 'form', 'value', 'Some error.')\n+        except AssertionError as e:\n+            self.assertIn(\"The field 'value' on form 'form' in context 0 contains no errors\", str(e))\n+        try:\n+            self.assertFormError(response, 'form', 'value', 'Some error.', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: The field 'value' on form 'form' in context 0 contains no errors\", str(e))\n+\n+    def test_unknown_error(self):\n+        \"An assertion is raised if the field doesn't contain the provided error\"\n+        post_data = {\n+            'text': 'Hello World',\n+            'email': 'not an email address',\n+            'value': 37,\n+            'single': 'b',\n+            'multi': ('b','c','e')\n+        }\n+        response = self.client.post('/test_client/form_view/', post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTemplateUsed(response, \"Invalid POST Template\")\n+\n+        try:\n+            self.assertFormError(response, 'form', 'email', 'Some error.')\n+        except AssertionError as e:\n+            self.assertIn(\"The field 'email' on form 'form' in context 0 does not contain the error 'Some error.' (actual errors: [u'Enter a valid e-mail address.'])\", str(e))\n+        try:\n+            self.assertFormError(response, 'form', 'email', 'Some error.', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: The field 'email' on form 'form' in context 0 does not contain the error 'Some error.' (actual errors: [u'Enter a valid e-mail address.'])\", str(e))\n+\n+    def test_unknown_nonfield_error(self):\n+        \"\"\"\n+        Checks that an assertion is raised if the form's non field errors\n+        doesn't contain the provided error.\n+        \"\"\"\n+        post_data = {\n+            'text': 'Hello World',\n+            'email': 'not an email address',\n+            'value': 37,\n+            'single': 'b',\n+            'multi': ('b','c','e')\n+        }\n+        response = self.client.post('/test_client/form_view/', post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTemplateUsed(response, \"Invalid POST Template\")\n+\n+        try:\n+            self.assertFormError(response, 'form', None, 'Some error.')\n+        except AssertionError as e:\n+            self.assertIn(\"The form 'form' in context 0 does not contain the non-field error 'Some error.' (actual errors: )\", str(e))\n+        try:\n+            self.assertFormError(response, 'form', None, 'Some error.', msg_prefix='abc')\n+        except AssertionError as e:\n+            self.assertIn(\"abc: The form 'form' in context 0 does not contain the non-field error 'Some error.' (actual errors: )\", str(e))\n+\n+@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n+class LoginTests(TestCase):\n+    fixtures = ['testdata']\n+\n+    def test_login_different_client(self):\n+        \"Check that using a different test client doesn't violate authentication\"\n+\n+        # Create a second client, and log in.\n+        c = Client()\n+        login = c.login(username='testclient', password='password')\n+        self.assertTrue(login, 'Could not log in')\n+\n+        # Get a redirection page with the second client.\n+        response = c.get(\"/test_client_regress/login_protected_redirect_view/\")\n+\n+        # At this points, the self.client isn't logged in.\n+        # Check that assertRedirects uses the original client, not the\n+        # default client.\n+        self.assertRedirects(response, \"http://testserver/test_client_regress/get_view/\")\n+\n+\n+@override_settings(\n+    PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',),\n+    SESSION_ENGINE='regressiontests.test_client_regress.session'\n+)\n+class SessionEngineTests(TestCase):\n+    fixtures = ['testdata']\n+\n+    def test_login(self):\n+        \"A session engine that modifies the session key can be used to log in\"\n+        login = self.client.login(username='testclient', password='password')\n+        self.assertTrue(login, 'Could not log in')\n+\n+        # Try to access a login protected page.\n+        response = self.client.get(\"/test_client/login_protected_view/\")\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['user'].username, 'testclient')\n+\n+\n+class URLEscapingTests(TestCase):\n+    def test_simple_argument_get(self):\n+        \"Get a view that has a simple string argument\"\n+        response = self.client.get(reverse('arg_view', args=['Slartibartfast']))\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'Howdy, Slartibartfast')\n+\n+    def test_argument_with_space_get(self):\n+        \"Get a view that has a string argument that requires escaping\"\n+        response = self.client.get(reverse('arg_view', args=['Arthur Dent']))\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'Hi, Arthur')\n+\n+    def test_simple_argument_post(self):\n+        \"Post for a view that has a simple string argument\"\n+        response = self.client.post(reverse('arg_view', args=['Slartibartfast']))\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'Howdy, Slartibartfast')\n+\n+    def test_argument_with_space_post(self):\n+        \"Post for a view that has a string argument that requires escaping\"\n+        response = self.client.post(reverse('arg_view', args=['Arthur Dent']))\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'Hi, Arthur')\n+\n+@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n+class ExceptionTests(TestCase):\n+    fixtures = ['testdata.json']\n+\n+    def test_exception_cleared(self):\n+        \"#5836 - A stale user exception isn't re-raised by the test client.\"\n+\n+        login = self.client.login(username='testclient',password='password')\n+        self.assertTrue(login, 'Could not log in')\n+        try:\n+            response = self.client.get(\"/test_client_regress/staff_only/\")\n+            self.fail(\"General users should not be able to visit this page\")\n+        except SuspiciousOperation:\n+            pass\n+\n+        # At this point, an exception has been raised, and should be cleared.\n+\n+        # This next operation should be successful; if it isn't we have a problem.\n+        login = self.client.login(username='staff', password='password')\n+        self.assertTrue(login, 'Could not log in')\n+        try:\n+            self.client.get(\"/test_client_regress/staff_only/\")\n+        except SuspiciousOperation:\n+            self.fail(\"Staff should be able to visit this page\")\n+\n+\n+class TemplateExceptionTests(TestCase):\n+    def setUp(self):\n+        # Reset the loaders so they don't try to render cached templates.\n+        if loader.template_source_loaders is not None:\n+            for template_loader in loader.template_source_loaders:\n+                if hasattr(template_loader, 'reset'):\n+                    template_loader.reset()\n+\n+    @override_settings(TEMPLATE_DIRS=(),)\n+    def test_no_404_template(self):\n+        \"Missing templates are correctly reported by test client\"\n+        try:\n+            response = self.client.get(\"/no_such_view/\")\n+            self.fail(\"Should get error about missing template\")\n+        except TemplateDoesNotExist:\n+            pass\n+\n+    @override_settings(\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'bad_templates'),)\n+    )\n+    def test_bad_404_template(self):\n+        \"Errors found when rendering 404 error templates are re-raised\"\n+        try:\n+            response = self.client.get(\"/no_such_view/\")\n+            self.fail(\"Should get error about syntax error in template\")\n+        except TemplateSyntaxError:\n+            pass\n+\n+# We need two different tests to check URLconf substitution -  one to check\n+# it was changed, and another one (without self.urls) to check it was reverted on\n+# teardown. This pair of tests relies upon the alphabetical ordering of test execution.\n+class UrlconfSubstitutionTests(TestCase):\n+    urls = 'regressiontests.test_client_regress.urls'\n+\n+    def test_urlconf_was_changed(self):\n+        \"TestCase can enforce a custom URLconf on a per-test basis\"\n+        url = reverse('arg_view', args=['somename'])\n+        self.assertEqual(url, '/arg_view/somename/')\n+\n+# This test needs to run *after* UrlconfSubstitutionTests; the zz prefix in the\n+# name is to ensure alphabetical ordering.\n+class zzUrlconfSubstitutionTests(TestCase):\n+    def test_urlconf_was_reverted(self):\n+        \"URLconf is reverted to original value after modification in a TestCase\"\n+        url = reverse('arg_view', args=['somename'])\n+        self.assertEqual(url, '/test_client_regress/arg_view/somename/')\n+\n+@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n+class ContextTests(TestCase):\n+    fixtures = ['testdata']\n+\n+    def test_single_context(self):\n+        \"Context variables can be retrieved from a single context\"\n+        response = self.client.get(\"/test_client_regress/request_data/\", data={'foo':'whiz'})\n+        self.assertEqual(response.context.__class__, Context)\n+        self.assertTrue('get-foo' in response.context)\n+        self.assertEqual(response.context['get-foo'], 'whiz')\n+        self.assertEqual(response.context['request-foo'], 'whiz')\n+        self.assertEqual(response.context['data'], 'sausage')\n+\n+        try:\n+            response.context['does-not-exist']\n+            self.fail('Should not be able to retrieve non-existent key')\n+        except KeyError as e:\n+            self.assertEqual(e.args[0], 'does-not-exist')\n+\n+    def test_inherited_context(self):\n+        \"Context variables can be retrieved from a list of contexts\"\n+        response = self.client.get(\"/test_client_regress/request_data_extended/\", data={'foo':'whiz'})\n+        self.assertEqual(response.context.__class__, ContextList)\n+        self.assertEqual(len(response.context), 2)\n+        self.assertTrue('get-foo' in response.context)\n+        self.assertEqual(response.context['get-foo'], 'whiz')\n+        self.assertEqual(response.context['request-foo'], 'whiz')\n+        self.assertEqual(response.context['data'], 'bacon')\n+\n+        try:\n+            response.context['does-not-exist']\n+            self.fail('Should not be able to retrieve non-existent key')\n+        except KeyError as e:\n+            self.assertEqual(e.args[0], 'does-not-exist')\n+\n+    def test_15368(self):\n+        # Need to insert a context processor that assumes certain things about\n+        # the request instance. This triggers a bug caused by some ways of\n+        # copying RequestContext.\n+        try:\n+            django.template.context._standard_context_processors = (lambda request: {'path': request.special_path},)\n+            response = self.client.get(\"/test_client_regress/request_context_view/\")\n+            self.assertContains(response, 'Path: /test_client_regress/request_context_view/')\n+        finally:\n+            django.template.context._standard_context_processors = None\n+\n+\n+@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n+class SessionTests(TestCase):\n+    fixtures = ['testdata.json']\n+\n+    def test_session(self):\n+        \"The session isn't lost if a user logs in\"\n+        # The session doesn't exist to start.\n+        response = self.client.get('/test_client_regress/check_session/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'NO')\n+\n+        # This request sets a session variable.\n+        response = self.client.get('/test_client_regress/set_session/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'set_session')\n+\n+        # Check that the session has been modified\n+        response = self.client.get('/test_client_regress/check_session/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'YES')\n+\n+        # Log in\n+        login = self.client.login(username='testclient',password='password')\n+        self.assertTrue(login, 'Could not log in')\n+\n+        # Session should still contain the modified value\n+        response = self.client.get('/test_client_regress/check_session/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'YES')\n+\n+    def test_logout(self):\n+        \"\"\"Logout should work whether the user is logged in or not (#9978).\"\"\"\n+        self.client.logout()\n+        login = self.client.login(username='testclient',password='password')\n+        self.assertTrue(login, 'Could not log in')\n+        self.client.logout()\n+        self.client.logout()\n+\n+class RequestMethodTests(TestCase):\n+    def test_get(self):\n+        \"Request a view via request method GET\"\n+        response = self.client.get('/test_client_regress/request_methods/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: GET')\n+\n+    def test_post(self):\n+        \"Request a view via request method POST\"\n+        response = self.client.post('/test_client_regress/request_methods/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: POST')\n+\n+    def test_head(self):\n+        \"Request a view via request method HEAD\"\n+        response = self.client.head('/test_client_regress/request_methods/')\n+        self.assertEqual(response.status_code, 200)\n+        # A HEAD request doesn't return any content.\n+        self.assertNotEqual(response.content, b'request method: HEAD')\n+        self.assertEqual(response.content, b'')\n+\n+    def test_options(self):\n+        \"Request a view via request method OPTIONS\"\n+        response = self.client.options('/test_client_regress/request_methods/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: OPTIONS')\n+\n+    def test_put(self):\n+        \"Request a view via request method PUT\"\n+        response = self.client.put('/test_client_regress/request_methods/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: PUT')\n+\n+    def test_delete(self):\n+        \"Request a view via request method DELETE\"\n+        response = self.client.delete('/test_client_regress/request_methods/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: DELETE')\n+\n+class RequestMethodStringDataTests(TestCase):\n+    def test_post(self):\n+        \"Request a view with string data via request method POST\"\n+        # Regression test for #11371\n+        data = u'{\"test\": \"json\"}'\n+        response = self.client.post('/test_client_regress/request_methods/', data=data, content_type='application/json')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: POST')\n+\n+    def test_put(self):\n+        \"Request a view with string data via request method PUT\"\n+        # Regression test for #11371\n+        data = u'{\"test\": \"json\"}'\n+        response = self.client.put('/test_client_regress/request_methods/', data=data, content_type='application/json')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.content, b'request method: PUT')\n+\n+class QueryStringTests(TestCase):\n+    def test_get_like_requests(self):\n+        # See: https://code.djangoproject.com/ticket/10571.\n+        for method_name in ('get', 'head'):\n+            # A GET-like request can pass a query string as data\n+            method = getattr(self.client, method_name)\n+            response = method(\"/test_client_regress/request_data/\", data={'foo':'whiz'})\n+            self.assertEqual(response.context['get-foo'], 'whiz')\n+            self.assertEqual(response.context['request-foo'], 'whiz')\n+\n+            # A GET-like request can pass a query string as part of the URL\n+            response = method(\"/test_client_regress/request_data/?foo=whiz\")\n+            self.assertEqual(response.context['get-foo'], 'whiz')\n+            self.assertEqual(response.context['request-foo'], 'whiz')\n+\n+            # Data provided in the URL to a GET-like request is overridden by actual form data\n+            response = method(\"/test_client_regress/request_data/?foo=whiz\", data={'foo':'bang'})\n+            self.assertEqual(response.context['get-foo'], 'bang')\n+            self.assertEqual(response.context['request-foo'], 'bang')\n+\n+            response = method(\"/test_client_regress/request_data/?foo=whiz\", data={'bar':'bang'})\n+            self.assertEqual(response.context['get-foo'], None)\n+            self.assertEqual(response.context['get-bar'], 'bang')\n+            self.assertEqual(response.context['request-foo'], None)\n+            self.assertEqual(response.context['request-bar'], 'bang')\n+\n+    def test_post_like_requests(self):\n+        # A POST-like request can pass a query string as data\n+        response = self.client.post(\"/test_client_regress/request_data/\", data={'foo':'whiz'})\n+        self.assertEqual(response.context['get-foo'], None)\n+        self.assertEqual(response.context['post-foo'], 'whiz')\n+\n+        # A POST-like request can pass a query string as part of the URL\n+        response = self.client.post(\"/test_client_regress/request_data/?foo=whiz\")\n+        self.assertEqual(response.context['get-foo'], 'whiz')\n+        self.assertEqual(response.context['post-foo'], None)\n+        self.assertEqual(response.context['request-foo'], 'whiz')\n+\n+        # POST data provided in the URL augments actual form data\n+        response = self.client.post(\"/test_client_regress/request_data/?foo=whiz\", data={'foo':'bang'})\n+        self.assertEqual(response.context['get-foo'], 'whiz')\n+        self.assertEqual(response.context['post-foo'], 'bang')\n+        self.assertEqual(response.context['request-foo'], 'bang')\n+\n+        response = self.client.post(\"/test_client_regress/request_data/?foo=whiz\", data={'bar':'bang'})\n+        self.assertEqual(response.context['get-foo'], 'whiz')\n+        self.assertEqual(response.context['get-bar'], None)\n+        self.assertEqual(response.context['post-foo'], None)\n+        self.assertEqual(response.context['post-bar'], 'bang')\n+        self.assertEqual(response.context['request-foo'], 'whiz')\n+        self.assertEqual(response.context['request-bar'], 'bang')\n+\n+class UnicodePayloadTests(TestCase):\n+    def test_simple_unicode_payload(self):\n+        \"A simple ASCII-only unicode JSON document can be POSTed\"\n+        # Regression test for #10571\n+        json = u'{\"english\": \"mountain pass\"}'\n+        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n+                                    content_type=\"application/json\")\n+        self.assertEqual(response.content, json)\n+\n+    def test_unicode_payload_utf8(self):\n+        \"A non-ASCII unicode data encoded as UTF-8 can be POSTed\"\n+        # Regression test for #10571\n+        json = u'{\"dog\": \"—Å–æ–±–∞–∫–∞\"}'\n+        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n+                                    content_type=\"application/json; charset=utf-8\")\n+        self.assertEqual(response.content, json.encode('utf-8'))\n+\n+    def test_unicode_payload_utf16(self):\n+        \"A non-ASCII unicode data encoded as UTF-16 can be POSTed\"\n+        # Regression test for #10571\n+        json = u'{\"dog\": \"—Å–æ–±–∞–∫–∞\"}'\n+        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n+                                    content_type=\"application/json; charset=utf-16\")\n+        self.assertEqual(response.content, json.encode('utf-16'))\n+\n+    def test_unicode_payload_non_utf(self):\n+        \"A non-ASCII unicode data as a non-UTF based encoding can be POSTed\"\n+        #Regression test for #10571\n+        json = u'{\"dog\": \"—Å–æ–±–∞–∫–∞\"}'\n+        response = self.client.post(\"/test_client_regress/parse_unicode_json/\", json,\n+                                    content_type=\"application/json; charset=koi8-r\")\n+        self.assertEqual(response.content, json.encode('koi8-r'))\n+\n+class DummyFile(object):\n+    def __init__(self, filename):\n+        self.name = filename\n+    def read(self):\n+        return 'TEST_FILE_CONTENT'\n+\n+class UploadedFileEncodingTest(TestCase):\n+    def test_file_encoding(self):\n+        encoded_file = encode_file('TEST_BOUNDARY', 'TEST_KEY', DummyFile('test_name.bin'))\n+        self.assertEqual(b'--TEST_BOUNDARY', encoded_file[0])\n+        self.assertEqual(b'Content-Disposition: form-data; name=\"TEST_KEY\"; filename=\"test_name.bin\"', encoded_file[1])\n+        self.assertEqual(b'TEST_FILE_CONTENT', encoded_file[-1])\n+\n+    def test_guesses_content_type_on_file_encoding(self):\n+        self.assertEqual(b'Content-Type: application/octet-stream',\n+                         encode_file('IGNORE', 'IGNORE', DummyFile(\"file.bin\"))[2])\n+        self.assertEqual(b'Content-Type: text/plain',\n+                         encode_file('IGNORE', 'IGNORE', DummyFile(\"file.txt\"))[2])\n+        self.assertIn(encode_file('IGNORE', 'IGNORE', DummyFile(\"file.zip\"))[2], (\n+                        b'Content-Type: application/x-compress',\n+                        b'Content-Type: application/x-zip',\n+                        b'Content-Type: application/x-zip-compressed',\n+                        b'Content-Type: application/zip',))\n+        self.assertEqual(b'Content-Type: application/octet-stream',\n+                         encode_file('IGNORE', 'IGNORE', DummyFile(\"file.unknown\"))[2])\n+\n+class RequestHeadersTest(TestCase):\n+    def test_client_headers(self):\n+        \"A test client can receive custom headers\"\n+        response = self.client.get(\"/test_client_regress/check_headers/\", HTTP_X_ARG_CHECK='Testing 123')\n+        self.assertEqual(response.content, b\"HTTP_X_ARG_CHECK: Testing 123\")\n+        self.assertEqual(response.status_code, 200)\n+\n+    def test_client_headers_redirect(self):\n+        \"Test client headers are preserved through redirects\"\n+        response = self.client.get(\"/test_client_regress/check_headers_redirect/\", follow=True, HTTP_X_ARG_CHECK='Testing 123')\n+        self.assertEqual(response.content, b\"HTTP_X_ARG_CHECK: Testing 123\")\n+        self.assertRedirects(response, '/test_client_regress/check_headers/',\n+            status_code=301, target_status_code=200)\n+\n+\n+class ReadLimitedStreamTest(TestCase):\n+    \"\"\"\n+    Tests that ensure that HttpRequest.body, HttpRequest.read() and\n+    HttpRequest.read(BUFFER) have proper LimitedStream behavior.\n+\n+    Refs #14753, #15785\n+    \"\"\"\n+\n+    def test_body_from_empty_request(self):\n+        \"\"\"HttpRequest.body on a test client GET request should return\n+        the empty string.\"\"\"\n+        self.assertEqual(self.client.get(\"/test_client_regress/body/\").content, b'')\n+\n+    def test_read_from_empty_request(self):\n+        \"\"\"HttpRequest.read() on a test client GET request should return the\n+        empty string.\"\"\"\n+        self.assertEqual(self.client.get(\"/test_client_regress/read_all/\").content, b'')\n+\n+    def test_read_numbytes_from_empty_request(self):\n+        \"\"\"HttpRequest.read(LARGE_BUFFER) on a test client GET request should\n+        return the empty string.\"\"\"\n+        self.assertEqual(self.client.get(\"/test_client_regress/read_buffer/\").content, b'')\n+\n+    def test_read_from_nonempty_request(self):\n+        \"\"\"HttpRequest.read() on a test client PUT request with some payload\n+        should return that payload.\"\"\"\n+        payload = b'foobar'\n+        self.assertEqual(self.client.put(\"/test_client_regress/read_all/\",\n+                                          data=payload,\n+                                          content_type='text/plain').content, payload)\n+\n+    def test_read_numbytes_from_nonempty_request(self):\n+        \"\"\"HttpRequest.read(LARGE_BUFFER) on a test client PUT request with\n+        some payload should return that payload.\"\"\"\n+        payload = b'foobar'\n+        self.assertEqual(self.client.put(\"/test_client_regress/read_buffer/\",\n+                                          data=payload,\n+                                          content_type='text/plain').content, payload)\n+\n+\n+class RequestFactoryStateTest(TestCase):\n+    \"\"\"Regression tests for #15929.\"\"\"\n+    # These tests are checking that certain middleware don't change certain\n+    # global state. Alternatively, from the point of view of a test, they are\n+    # ensuring test isolation behavior. So, unusually, it doesn't make sense to\n+    # run the tests individually, and if any are failing it is confusing to run\n+    # them with any other set of tests.\n+\n+    def common_test_that_should_always_pass(self):\n+        request = RequestFactory().get('/')\n+        request.session = {}\n+        self.assertFalse(hasattr(request, 'user'))\n+\n+    def test_request(self):\n+        self.common_test_that_should_always_pass()\n+\n+    def test_request_after_client(self):\n+        # apart from the next line the three tests are identical\n+        self.client.get('/')\n+        self.common_test_that_should_always_pass()\n+\n+    def test_request_after_client_2(self):\n+        # This test is executed after the previous one\n+        self.common_test_that_should_always_pass()\n+\n+\n+class RequestFactoryEnvironmentTests(TestCase):\n+    \"\"\"\n+    Regression tests for #8551 and #17067: ensure that environment variables\n+    are set correctly in RequestFactory.\n+    \"\"\"\n+\n+    def test_should_set_correct_env_variables(self):\n+        request = RequestFactory().get('/path/')\n+\n+        self.assertEqual(request.META.get('REMOTE_ADDR'), '127.0.0.1')\n+        self.assertEqual(request.META.get('SERVER_NAME'), 'testserver')\n+        self.assertEqual(request.META.get('SERVER_PORT'), '80')\n+        self.assertEqual(request.META.get('SERVER_PROTOCOL'), 'HTTP/1.1')\n+        self.assertEqual(request.META.get('SCRIPT_NAME') +\n+                         request.META.get('PATH_INFO'), '/path/')"
        },
        {
            "sha": "3a934ea0477c1d5ea307e1f5a0a929059264db8f",
            "filename": "tests/regressiontests/test_client_regress/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -5,7 +5,6 @@\n from django.http import HttpResponse, HttpResponseRedirect\n from django.core.exceptions import SuspiciousOperation\n from django.shortcuts import render_to_response\n-from django.utils.encoding import smart_str\n from django.core.serializers.json import DjangoJSONEncoder\n from django.test.client import CONTENT_TYPE_RE\n from django.template import RequestContext\n@@ -84,8 +83,8 @@ def return_json_file(request):\n     obj_json = json.dumps(obj_dict, encoding=charset,\n                                 cls=DjangoJSONEncoder,\n                                 ensure_ascii=False)\n-    response = HttpResponse(smart_str(obj_json, encoding=charset), status=200,\n-                            mimetype='application/json; charset=' + charset)\n+    response = HttpResponse(obj_json.encode(charset), status=200,\n+                            mimetype='application/json; charset=%s' % charset)\n     response['Content-Disposition'] = 'attachment; filename=testfile.json'\n     return response\n "
        },
        {
            "sha": "05f99105aa4d0705332c9ce4626022d959d21cea",
            "filename": "tests/regressiontests/test_runner/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_runner%2Ftests.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -8,8 +8,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.core.management import call_command\n from django import db\n-from django.db import connection\n-from django.test import simple, TransactionTestCase\n+from django.test import simple, TransactionTestCase, skipUnlessDBFeature\n from django.test.simple import DjangoTestSuiteRunner, get_tests\n from django.test.testcases import connections_support_transactions\n from django.utils import unittest\n@@ -291,16 +290,12 @@ class AutoIncrementResetTest(TransactionTestCase):\n     and check that both times they get \"1\" as their PK value. That is, we test\n     that AutoField values start from 1 for each transactional test case.\n     \"\"\"\n-    @unittest.skipIf(connection.vendor == 'oracle',\n-                     \"Oracle's auto-increment fields are not reset between \"\n-                     \"tests\")\n+    @skipUnlessDBFeature('supports_sequence_reset')\n     def test_autoincrement_reset1(self):\n         p = Person.objects.create(first_name='Jack', last_name='Smith')\n         self.assertEqual(p.pk, 1)\n \n-    @unittest.skipIf(connection.vendor == 'oracle',\n-                     \"Oracle's auto-increment fields are not reset between \"\n-                     \"tests\")\n+    @skipUnlessDBFeature('supports_sequence_reset')\n     def test_autoincrement_reset2(self):\n         p = Person.objects.create(first_name='Jack', last_name='Smith')\n         self.assertEqual(p.pk, 1)"
        },
        {
            "sha": "1e12679af21e2db0a7a51f0709ae0b515a5e1ed0",
            "filename": "tests/regressiontests/views/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2F__init__.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -3,8 +3,8 @@\n class BrokenException(Exception):\n     pass\n \n-except_args = ('Broken!',           # plain exception with ASCII text\n+except_args = (b'Broken!',           # plain exception with ASCII text\n                u'¬°Broken!',         # non-ASCII unicode data\n-               '¬°Broken!',          # non-ASCII, utf-8 encoded bytestring\n-               '\\xa1Broken!', )     # non-ASCII, latin1 bytestring\n+               u'¬°Broken!'.encode('utf-8'), # non-ASCII, utf-8 encoded bytestring\n+               b'\\xa1Broken!', )     # non-ASCII, latin1 bytestring\n "
        },
        {
            "sha": "e8a7d49e79b831e5357e08ce8b000e105bab3ef7",
            "filename": "tests/regressiontests/views/tests/debug.py",
            "status": "modified",
            "additions": 63,
            "deletions": 41,
            "changes": 104,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -10,13 +10,12 @@\n from django.test.utils import (setup_test_template_loader,\n                                restore_template_loaders)\n from django.core.urlresolvers import reverse\n-from django.template import TemplateSyntaxError\n from django.views.debug import ExceptionReporter\n from django.core import mail\n \n from .. import BrokenException, except_args\n from ..views import (sensitive_view, non_sensitive_view, paranoid_view,\n-    custom_exception_reporter_filter_view)\n+    custom_exception_reporter_filter_view, sensitive_method_view)\n \n \n class DebugViewTests(TestCase):\n@@ -238,7 +237,8 @@ class ExceptionReportTestMixin(object):\n                       'hash-brown-key': 'hash-brown-value',\n                       'bacon-key': 'bacon-value',}\n \n-    def verify_unsafe_response(self, view, check_for_vars=True):\n+    def verify_unsafe_response(self, view, check_for_vars=True,\n+                               check_for_POST_params=True):\n         \"\"\"\n         Asserts that potentially sensitive info are displayed in the response.\n         \"\"\"\n@@ -250,13 +250,14 @@ def verify_unsafe_response(self, view, check_for_vars=True):\n             self.assertContains(response, 'scrambled', status_code=500)\n             self.assertContains(response, 'sauce', status_code=500)\n             self.assertContains(response, 'worcestershire', status_code=500)\n+        if check_for_POST_params:\n+            for k, v in self.breakfast_data.items():\n+                # All POST parameters are shown.\n+                self.assertContains(response, k, status_code=500)\n+                self.assertContains(response, v, status_code=500)\n \n-        for k, v in self.breakfast_data.items():\n-            # All POST parameters are shown.\n-            self.assertContains(response, k, status_code=500)\n-            self.assertContains(response, v, status_code=500)\n-\n-    def verify_safe_response(self, view, check_for_vars=True):\n+    def verify_safe_response(self, view, check_for_vars=True,\n+                             check_for_POST_params=True):\n         \"\"\"\n         Asserts that certain sensitive info are not displayed in the response.\n         \"\"\"\n@@ -269,18 +270,19 @@ def verify_safe_response(self, view, check_for_vars=True):\n             # Sensitive variable's name is shown but not its value.\n             self.assertContains(response, 'sauce', status_code=500)\n             self.assertNotContains(response, 'worcestershire', status_code=500)\n+        if check_for_POST_params:\n+            for k, v in self.breakfast_data.items():\n+                # All POST parameters' names are shown.\n+                self.assertContains(response, k, status_code=500)\n+            # Non-sensitive POST parameters' values are shown.\n+            self.assertContains(response, 'baked-beans-value', status_code=500)\n+            self.assertContains(response, 'hash-brown-value', status_code=500)\n+            # Sensitive POST parameters' values are not shown.\n+            self.assertNotContains(response, 'sausage-value', status_code=500)\n+            self.assertNotContains(response, 'bacon-value', status_code=500)\n \n-        for k, v in self.breakfast_data.items():\n-            # All POST parameters' names are shown.\n-            self.assertContains(response, k, status_code=500)\n-        # Non-sensitive POST parameters' values are shown.\n-        self.assertContains(response, 'baked-beans-value', status_code=500)\n-        self.assertContains(response, 'hash-brown-value', status_code=500)\n-        # Sensitive POST parameters' values are not shown.\n-        self.assertNotContains(response, 'sausage-value', status_code=500)\n-        self.assertNotContains(response, 'bacon-value', status_code=500)\n-\n-    def verify_paranoid_response(self, view, check_for_vars=True):\n+    def verify_paranoid_response(self, view, check_for_vars=True,\n+                                 check_for_POST_params=True):\n         \"\"\"\n         Asserts that no variables or POST parameters are displayed in the response.\n         \"\"\"\n@@ -292,14 +294,14 @@ def verify_paranoid_response(self, view, check_for_vars=True):\n             self.assertNotContains(response, 'scrambled', status_code=500)\n             self.assertContains(response, 'sauce', status_code=500)\n             self.assertNotContains(response, 'worcestershire', status_code=500)\n+        if check_for_POST_params:\n+            for k, v in self.breakfast_data.items():\n+                # All POST parameters' names are shown.\n+                self.assertContains(response, k, status_code=500)\n+                # No POST parameters' values are shown.\n+                self.assertNotContains(response, v, status_code=500)\n \n-        for k, v in self.breakfast_data.items():\n-            # All POST parameters' names are shown.\n-            self.assertContains(response, k, status_code=500)\n-            # No POST parameters' values are shown.\n-            self.assertNotContains(response, v, status_code=500)\n-\n-    def verify_unsafe_email(self, view):\n+    def verify_unsafe_email(self, view, check_for_POST_params=True):\n         \"\"\"\n         Asserts that potentially sensitive info are displayed in the email report.\n         \"\"\"\n@@ -314,12 +316,13 @@ def verify_unsafe_email(self, view):\n             self.assertNotIn('scrambled', email.body)\n             self.assertNotIn('sauce', email.body)\n             self.assertNotIn('worcestershire', email.body)\n-            for k, v in self.breakfast_data.items():\n-                # All POST parameters are shown.\n-                self.assertIn(k, email.body)\n-                self.assertIn(v, email.body)\n+            if check_for_POST_params:\n+                for k, v in self.breakfast_data.items():\n+                    # All POST parameters are shown.\n+                    self.assertIn(k, email.body)\n+                    self.assertIn(v, email.body)\n \n-    def verify_safe_email(self, view):\n+    def verify_safe_email(self, view, check_for_POST_params=True):\n         \"\"\"\n         Asserts that certain sensitive info are not displayed in the email report.\n         \"\"\"\n@@ -334,15 +337,16 @@ def verify_safe_email(self, view):\n             self.assertNotIn('scrambled', email.body)\n             self.assertNotIn('sauce', email.body)\n             self.assertNotIn('worcestershire', email.body)\n-            for k, v in self.breakfast_data.items():\n-                # All POST parameters' names are shown.\n-                self.assertIn(k, email.body)\n-            # Non-sensitive POST parameters' values are shown.\n-            self.assertIn('baked-beans-value', email.body)\n-            self.assertIn('hash-brown-value', email.body)\n-            # Sensitive POST parameters' values are not shown.\n-            self.assertNotIn('sausage-value', email.body)\n-            self.assertNotIn('bacon-value', email.body)\n+            if check_for_POST_params:\n+                for k, v in self.breakfast_data.items():\n+                    # All POST parameters' names are shown.\n+                    self.assertIn(k, email.body)\n+                # Non-sensitive POST parameters' values are shown.\n+                self.assertIn('baked-beans-value', email.body)\n+                self.assertIn('hash-brown-value', email.body)\n+                # Sensitive POST parameters' values are not shown.\n+                self.assertNotIn('sausage-value', email.body)\n+                self.assertNotIn('bacon-value', email.body)\n \n     def verify_paranoid_email(self, view):\n         \"\"\"\n@@ -425,6 +429,24 @@ def test_custom_exception_reporter_filter(self):\n             self.verify_unsafe_response(custom_exception_reporter_filter_view)\n             self.verify_unsafe_email(custom_exception_reporter_filter_view)\n \n+    def test_sensitive_method(self):\n+        \"\"\"\n+        Ensure that the sensitive_variables decorator works with object\n+        methods.\n+        Refs #18379.\n+        \"\"\"\n+        with self.settings(DEBUG=True):\n+            self.verify_unsafe_response(sensitive_method_view,\n+                                        check_for_POST_params=False)\n+            self.verify_unsafe_email(sensitive_method_view,\n+                                     check_for_POST_params=False)\n+\n+        with self.settings(DEBUG=False):\n+            self.verify_safe_response(sensitive_method_view,\n+                                      check_for_POST_params=False)\n+            self.verify_safe_email(sensitive_method_view,\n+                                   check_for_POST_params=False)\n+\n \n class AjaxResponseExceptionReporterFilter(TestCase, ExceptionReportTestMixin):\n     \"\"\""
        },
        {
            "sha": "9d87ade13787852fcce278d78dba11b6282ec427",
            "filename": "tests/regressiontests/views/tests/static.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -29,7 +29,7 @@ def test_serve(self):\n         for filename in media_files:\n             response = self.client.get('/views/%s/%s' % (self.prefix, filename))\n             file_path = path.join(media_dir, filename)\n-            with open(file_path) as fp:\n+            with open(file_path, 'rb') as fp:\n                 self.assertEqual(fp.read(), response.content)\n             self.assertEqual(len(response.content), int(response['Content-Length']))\n             self.assertEqual(mimetypes.guess_type(file_path)[1], response.get('Content-Encoding', None))\n@@ -41,14 +41,14 @@ def test_unknown_mime_type(self):\n     def test_copes_with_empty_path_component(self):\n         file_name = 'file.txt'\n         response = self.client.get('/views/%s//%s' % (self.prefix, file_name))\n-        with open(path.join(media_dir, file_name)) as fp:\n+        with open(path.join(media_dir, file_name), 'rb') as fp:\n             self.assertEqual(fp.read(), response.content)\n \n     def test_is_modified_since(self):\n         file_name = 'file.txt'\n         response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n             HTTP_IF_MODIFIED_SINCE='Thu, 1 Jan 1970 00:00:00 GMT')\n-        with open(path.join(media_dir, file_name)) as fp:\n+        with open(path.join(media_dir, file_name), 'rb') as fp:\n             self.assertEqual(fp.read(), response.content)\n \n     def test_not_modified_since(self):\n@@ -71,7 +71,7 @@ def test_invalid_if_modified_since(self):\n         invalid_date = 'Mon, 28 May 999999999999 28:25:26 GMT'\n         response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n                                    HTTP_IF_MODIFIED_SINCE=invalid_date)\n-        with open(path.join(media_dir, file_name)) as fp:\n+        with open(path.join(media_dir, file_name), 'rb') as fp:\n             self.assertEqual(fp.read(), response.content)\n         self.assertEqual(len(response.content),\n                           int(response['Content-Length']))\n@@ -86,7 +86,7 @@ def test_invalid_if_modified_since2(self):\n         invalid_date = ': 1291108438, Wed, 20 Oct 2010 14:05:00 GMT'\n         response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n                                    HTTP_IF_MODIFIED_SINCE=invalid_date)\n-        with open(path.join(media_dir, file_name)) as fp:\n+        with open(path.join(media_dir, file_name), 'rb') as fp:\n             self.assertEqual(fp.read(), response.content)\n         self.assertEqual(len(response.content),\n                           int(response['Content-Length']))"
        },
        {
            "sha": "2836d1bdde64c86cc699525e170227f1e42edd18",
            "filename": "tests/regressiontests/views/views.py",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/eee791e9b216333ad0b4c6c441a88828bf9aee62/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fviews.py?ref=eee791e9b216333ad0b4c6c441a88828bf9aee62",
            "patch": "@@ -2,7 +2,6 @@\n \n import sys\n \n-from django import forms\n from django.core.exceptions import PermissionDenied\n from django.core.urlresolvers import get_resolver\n from django.http import HttpResponse, HttpResponseRedirect\n@@ -14,7 +13,7 @@\n from django.utils.log import getLogger\n \n from . import BrokenException, except_args\n-from .models import Article\n+\n \n \n def index_page(request):\n@@ -209,3 +208,23 @@ def custom_exception_reporter_filter_view(request):\n         exc_info = sys.exc_info()\n         send_log(request, exc_info)\n         return technical_500_response(request, *exc_info)\n+\n+\n+class Klass(object):\n+\n+    @sensitive_variables('sauce')\n+    def method(self, request):\n+        # Do not just use plain strings for the variables' values in the code\n+        # so that the tests don't return false positives when the function's\n+        # source is displayed in the exception report.\n+        cooked_eggs = ''.join(['s', 'c', 'r', 'a', 'm', 'b', 'l', 'e', 'd'])\n+        sauce = ''.join(['w', 'o', 'r', 'c', 'e', 's', 't', 'e', 'r', 's', 'h', 'i', 'r', 'e'])\n+        try:\n+            raise Exception\n+        except Exception:\n+            exc_info = sys.exc_info()\n+            send_log(request, exc_info)\n+            return technical_500_response(request, *exc_info)\n+\n+def sensitive_method_view(request):\n+    return Klass().method(request)\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 5599,
        "additions": 3275,
        "deletions": 2324
    }
}