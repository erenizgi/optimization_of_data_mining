{
    "author": "claudep",
    "message": "Fixed #16123 -- Ensured strptime receive proper string type\n\nstrptime generates an UnicodeEncodeError when using a non-ascii\nunicode string on Python 2.",
    "sha": "4b3f7110ae1e9ef7862c67a38431780080f0062c",
    "files": [
        {
            "sha": "0b96dc4153345895602e2f20a6a822fe0ac81414",
            "filename": "django/forms/extras/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4b3f7110ae1e9ef7862c67a38431780080f0062c/django%2Fforms%2Fextras%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/4b3f7110ae1e9ef7862c67a38431780080f0062c/django%2Fforms%2Fextras%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fextras%2Fwidgets.py?ref=4b3f7110ae1e9ef7862c67a38431780080f0062c",
            "patch": "@@ -9,6 +9,7 @@\n from django.forms.widgets import Widget, Select\n from django.utils import datetime_safe\n from django.utils.dates import MONTHS\n+from django.utils.encoding import force_str\n from django.utils.safestring import mark_safe\n from django.utils.formats import get_format\n from django.utils import six\n@@ -69,7 +70,7 @@ def render(self, name, value, attrs=None):\n                 if settings.USE_L10N:\n                     try:\n                         input_format = get_format('DATE_INPUT_FORMATS')[0]\n-                        v = datetime.datetime.strptime(value, input_format)\n+                        v = datetime.datetime.strptime(force_str(value), input_format)\n                         year_val, month_val, day_val = v.year, v.month, v.day\n                     except ValueError:\n                         pass"
        },
        {
            "sha": "d16b501baaf1445c85b3bbf24f2412cef8f71fb7",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4b3f7110ae1e9ef7862c67a38431780080f0062c/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/4b3f7110ae1e9ef7862c67a38431780080f0062c/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=4b3f7110ae1e9ef7862c67a38431780080f0062c",
            "patch": "@@ -23,7 +23,7 @@\n     NullBooleanSelect, SelectMultiple, DateInput, DateTimeInput, TimeInput,\n     SplitDateTimeWidget, SplitHiddenDateTimeWidget, FILE_INPUT_CONTRADICTION)\n from django.utils import formats\n-from django.utils.encoding import smart_text, force_text\n+from django.utils.encoding import smart_text, force_str, force_text\n from django.utils.ipv6 import clean_ipv6_address\n from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n@@ -395,7 +395,7 @@ def to_python(self, value):\n         return super(DateField, self).to_python(value)\n \n     def strptime(self, value, format):\n-        return datetime.datetime.strptime(value, format).date()\n+        return datetime.datetime.strptime(force_str(value), format).date()\n \n \n class TimeField(BaseTemporalField):\n@@ -417,7 +417,7 @@ def to_python(self, value):\n         return super(TimeField, self).to_python(value)\n \n     def strptime(self, value, format):\n-        return datetime.datetime.strptime(value, format).time()\n+        return datetime.datetime.strptime(force_str(value), format).time()\n \n class DateTimeField(BaseTemporalField):\n     widget = DateTimeInput\n@@ -455,7 +455,7 @@ def to_python(self, value):\n         return from_current_timezone(result)\n \n     def strptime(self, value, format):\n-        return datetime.datetime.strptime(value, format)\n+        return datetime.datetime.strptime(force_str(value), format)\n \n class RegexField(CharField):\n     def __init__(self, regex, max_length=None, min_length=None, error_message=None, *args, **kwargs):"
        },
        {
            "sha": "9ffaca44709745ac218fa62ef0b5a54956b1953d",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4b3f7110ae1e9ef7862c67a38431780080f0062c/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/4b3f7110ae1e9ef7862c67a38431780080f0062c/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=4b3f7110ae1e9ef7862c67a38431780080f0062c",
            "patch": "@@ -5,7 +5,7 @@\n from django.db import models\n from django.core.exceptions import ImproperlyConfigured\n from django.http import Http404\n-from django.utils.encoding import force_text\n+from django.utils.encoding import force_str, force_text\n from django.utils.functional import cached_property\n from django.utils.translation import ugettext as _\n from django.utils import timezone\n@@ -673,7 +673,7 @@ def _date_from_string(year, year_format, month='', month_format='', day='', day_\n     format = delim.join((year_format, month_format, day_format))\n     datestr = delim.join((year, month, day))\n     try:\n-        return datetime.datetime.strptime(datestr, format).date()\n+        return datetime.datetime.strptime(force_str(datestr), format).date()\n     except ValueError:\n         raise Http404(_(\"Invalid date string '%(datestr)s' given format '%(format)s'\") % {\n             'datestr': datestr,"
        },
        {
            "sha": "c533370b68710f76ab1383bc511ac1018a792101",
            "filename": "tests/regressiontests/forms/tests/fields.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4b3f7110ae1e9ef7862c67a38431780080f0062c/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/4b3f7110ae1e9ef7862c67a38431780080f0062c/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py?ref=4b3f7110ae1e9ef7862c67a38431780080f0062c",
            "patch": "@@ -370,6 +370,16 @@ def test_datefield_changed(self):\n         self.assertFalse(f._has_changed(d, '17/09/2007'))\n         self.assertFalse(f._has_changed(d.strftime(format), '17/09/2007'))\n \n+    def test_datefield_strptime(self):\n+        \"\"\"Test that field.strptime doesn't raise an UnicodeEncodeError (#16123)\"\"\"\n+        f = DateField()\n+        try:\n+            f.strptime('31 мая 2011', '%d-%b-%y')\n+        except Exception as e:\n+            # assertIsInstance or assertRaises cannot be used because UnicodeEncodeError\n+            # is a subclass of ValueError\n+            self.assertEqual(e.__class__, ValueError)\n+\n     # TimeField ###################################################################\n \n     def test_timefield_1(self):"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 18,
        "deletions": 7
    }
}