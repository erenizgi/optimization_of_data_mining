{
    "author": "akaariai",
    "message": "Fixed a regression in gis introduced by Query.select_fields removal",
    "sha": "92fc263a2898b804c3b46447fd47e2898fbf8ff1",
    "files": [
        {
            "sha": "c89912b2d9d0a6f26c6a76b18ce355de07162fa1",
            "filename": "django/contrib/gis/db/models/query.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/92fc263a2898b804c3b46447fd47e2898fbf8ff1/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/92fc263a2898b804c3b46447fd47e2898fbf8ff1/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py?ref=92fc263a2898b804c3b46447fd47e2898fbf8ff1",
            "patch": "@@ -760,8 +760,10 @@ def _geocol_select(self, geo_field, field_name):\n             self.query.add_select_related([field_name])\n             compiler = self.query.get_compiler(self.db)\n             compiler.pre_sql_setup()\n-            rel_table, rel_col = self.query.related_select_cols[self.query.related_select_fields.index(geo_field)]\n-            return compiler._field_column(geo_field, rel_table)\n+            for (rel_table, rel_col), field in self.query.related_select_cols:\n+                if field == geo_field:\n+                    return compiler._field_column(geo_field, rel_table)\n+            raise ValueError(\"%r not in self.query.related_select_cols\" % geo_field)\n         elif not geo_field in opts.local_fields:\n             # This geographic field is inherited from another model, so we have to\n             # use the db table for the _parent_ model instead."
        }
    ],
    "stats": {
        "total": 6,
        "additions": 4,
        "deletions": 2
    }
}