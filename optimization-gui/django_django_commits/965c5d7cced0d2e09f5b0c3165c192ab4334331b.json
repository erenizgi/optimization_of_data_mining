{
    "author": "aaugustin",
    "message": "Fixed #14202 -- made the atom:link element optional in feeds.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17029 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "965c5d7cced0d2e09f5b0c3165c192ab4334331b",
    "files": [
        {
            "sha": "7d7c7af65cb5f54aef4141236d58f0d425e46529",
            "filename": "django/utils/feedgenerator.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/965c5d7cced0d2e09f5b0c3165c192ab4334331b/django%2Futils%2Ffeedgenerator.py",
            "raw_url": "https://github.com/django/django/raw/965c5d7cced0d2e09f5b0c3165c192ab4334331b/django%2Futils%2Ffeedgenerator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffeedgenerator.py?ref=965c5d7cced0d2e09f5b0c3165c192ab4334331b",
            "patch": "@@ -224,7 +224,9 @@ def add_root_elements(self, handler):\n         handler.addQuickElement(u\"title\", self.feed['title'])\n         handler.addQuickElement(u\"link\", self.feed['link'])\n         handler.addQuickElement(u\"description\", self.feed['description'])\n-        handler.addQuickElement(u\"atom:link\", None, {u\"rel\": u\"self\", u\"href\": self.feed['feed_url']})\n+        if self.feed['feed_url'] is not None:\n+            handler.addQuickElement(u\"atom:link\", None,\n+                    {u\"rel\": u\"self\", u\"href\": self.feed['feed_url']})\n         if self.feed['language'] is not None:\n             handler.addQuickElement(u\"language\", self.feed['language'])\n         for cat in self.feed['categories']:"
        },
        {
            "sha": "6b85abf89c5e85cd06003bc12d4160dce5d2717f",
            "filename": "tests/regressiontests/utils/feedgenerator.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/965c5d7cced0d2e09f5b0c3165c192ab4334331b/tests%2Fregressiontests%2Futils%2Ffeedgenerator.py",
            "raw_url": "https://github.com/django/django/raw/965c5d7cced0d2e09f5b0c3165c192ab4334331b/tests%2Fregressiontests%2Futils%2Ffeedgenerator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ffeedgenerator.py?ref=965c5d7cced0d2e09f5b0c3165c192ab4334331b",
            "patch": "@@ -87,3 +87,16 @@ def test_atom1_mime_type(self):\n             atom_feed.mime_type, \"application/atom+xml; charset=utf-8\"\n         )\n \n+    # Two regression tests for #14202\n+\n+    def test_feed_without_feed_url_gets_rendered_without_atom_link(self):\n+        feed = feedgenerator.Rss201rev2Feed('title', '/link/', 'descr')\n+        self.assertEquals(feed.feed['feed_url'], None)\n+        feed_content = feed.writeString('utf-8')\n+        self.assertNotIn('<atom:link href=', feed_content)\n+\n+    def test_feed_with_feed_url_gets_rendered_with_atom_link(self):\n+        feed = feedgenerator.Rss201rev2Feed('title', '/link/', 'descr', feed_url='/feed/')\n+        self.assertEquals(feed.feed['feed_url'], '/feed/')\n+        feed_content = feed.writeString('utf-8')\n+        self.assertIn('<atom:link href=\"/feed/\" rel=\"self\"></atom:link>', feed_content)"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 16,
        "deletions": 1
    }
}