{
    "author": "claudep",
    "message": "Cleaned up test_client_regress tests",
    "sha": "ea4e0aad9efd691aa200bf7bbabd282267234b3a",
    "files": [
        {
            "sha": "293c0ff5576d925bafd873a656c7271a7a2349e6",
            "filename": "tests/regressiontests/test_client_regress/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 28,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/ea4e0aad9efd691aa200bf7bbabd282267234b3a/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ea4e0aad9efd691aa200bf7bbabd282267234b3a/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py?ref=ea4e0aad9efd691aa200bf7bbabd282267234b3a",
            "patch": "@@ -17,14 +17,10 @@\n from django.http import HttpResponse\n \n \n+@override_settings(\n+    TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+)\n class AssertContainsTests(TestCase):\n-    def setUp(self):\n-        self.old_templates = settings.TEMPLATE_DIRS\n-        settings.TEMPLATE_DIRS = (os.path.join(os.path.dirname(__file__), 'templates'),)\n-\n-    def tearDown(self):\n-        settings.TEMPLATE_DIRS = self.old_templates\n-\n     def test_contains(self):\n         \"Responses can be inspected for content, including counting repeated substrings\"\n         response = self.client.get('/test_client_regress/no_template_view/')\n@@ -544,17 +540,13 @@ def test_login_different_client(self):\n         self.assertRedirects(response, \"http://testserver/test_client_regress/get_view/\")\n \n \n-@override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n+@override_settings(\n+    PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',),\n+    SESSION_ENGINE='regressiontests.test_client_regress.session'\n+)\n class SessionEngineTests(TestCase):\n     fixtures = ['testdata']\n \n-    def setUp(self):\n-        self.old_SESSION_ENGINE = settings.SESSION_ENGINE\n-        settings.SESSION_ENGINE = 'regressiontests.test_client_regress.session'\n-\n-    def tearDown(self):\n-        settings.SESSION_ENGINE = self.old_SESSION_ENGINE\n-\n     def test_login(self):\n         \"A session engine that modifies the session key can be used to log in\"\n         login = self.client.login(username='testclient', password='password')\n@@ -616,18 +608,15 @@ def test_exception_cleared(self):\n         except SuspiciousOperation:\n             self.fail(\"Staff should be able to visit this page\")\n \n+\n+@override_settings(TEMPLATE_DIRS=())\n class TemplateExceptionTests(TestCase):\n     def setUp(self):\n         # Reset the loaders so they don't try to render cached templates.\n         if loader.template_source_loaders is not None:\n             for template_loader in loader.template_source_loaders:\n                 if hasattr(template_loader, 'reset'):\n                     template_loader.reset()\n-        self.old_templates = settings.TEMPLATE_DIRS\n-        settings.TEMPLATE_DIRS = ()\n-\n-    def tearDown(self):\n-        settings.TEMPLATE_DIRS = self.old_templates\n \n     def test_no_404_template(self):\n         \"Missing templates are correctly reported by test client\"\n@@ -980,11 +969,8 @@ class RequestFactoryStateTest(TestCase):\n     # run the tests individually, and if any are failing it is confusing to run\n     # them with any other set of tests.\n \n-    def setUp(self):\n-        self.factory = RequestFactory()\n-\n     def common_test_that_should_always_pass(self):\n-        request = self.factory.get('/')\n+        request = RequestFactory().get('/')\n         request.session = {}\n         self.assertFalse(hasattr(request, 'user'))\n \n@@ -1007,11 +993,8 @@ class RequestFactoryEnvironmentTests(TestCase):\n     are set correctly in RequestFactory.\n     \"\"\"\n \n-    def setUp(self):\n-        self.factory = RequestFactory()\n-\n     def test_should_set_correct_env_variables(self):\n-        request = self.factory.get('/path/')\n+        request = RequestFactory().get('/path/')\n \n         self.assertEqual(request.META.get('REMOTE_ADDR'), '127.0.0.1')\n         self.assertEqual(request.META.get('SERVER_NAME'), 'testserver')"
        },
        {
            "sha": "3a934ea0477c1d5ea307e1f5a0a929059264db8f",
            "filename": "tests/regressiontests/test_client_regress/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/ea4e0aad9efd691aa200bf7bbabd282267234b3a/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/ea4e0aad9efd691aa200bf7bbabd282267234b3a/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fviews.py?ref=ea4e0aad9efd691aa200bf7bbabd282267234b3a",
            "patch": "@@ -5,7 +5,6 @@\n from django.http import HttpResponse, HttpResponseRedirect\n from django.core.exceptions import SuspiciousOperation\n from django.shortcuts import render_to_response\n-from django.utils.encoding import smart_str\n from django.core.serializers.json import DjangoJSONEncoder\n from django.test.client import CONTENT_TYPE_RE\n from django.template import RequestContext\n@@ -84,8 +83,8 @@ def return_json_file(request):\n     obj_json = json.dumps(obj_dict, encoding=charset,\n                                 cls=DjangoJSONEncoder,\n                                 ensure_ascii=False)\n-    response = HttpResponse(smart_str(obj_json, encoding=charset), status=200,\n-                            mimetype='application/json; charset=' + charset)\n+    response = HttpResponse(obj_json.encode(charset), status=200,\n+                            mimetype='application/json; charset=%s' % charset)\n     response['Content-Disposition'] = 'attachment; filename=testfile.json'\n     return response\n "
        }
    ],
    "stats": {
        "total": 44,
        "additions": 13,
        "deletions": 31
    }
}