{
    "author": "jezdez",
    "message": "Added contrib apps to ignore list when running makemessages in the Djagno source tree and added a --no-obsolete option in preparation of moving app translations out of core.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15258 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "cf179e195d5525e0233385be97a53a6c5d7c6985",
    "files": [
        {
            "sha": "1b3116435545a966ba5178917cb5a40c3f65fc36",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/cf179e195d5525e0233385be97a53a6c5d7c6985/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/cf179e195d5525e0233385be97a53a6c5d7c6985/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=cf179e195d5525e0233385be97a53a6c5d7c6985",
            "patch": "@@ -115,7 +115,8 @@ def copy_plural_forms(msgs, locale, domain, verbosity):\n \n \n def make_messages(locale=None, domain='django', verbosity='1', all=False,\n-        extensions=None, symlinks=False, ignore_patterns=[], no_wrap=False):\n+        extensions=None, symlinks=False, ignore_patterns=[], no_wrap=False,\n+        no_obsolete=False):\n     \"\"\"\n     Uses the locale directory from the Django SVN tree or an application/\n     project to process all\n@@ -133,6 +134,8 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n     if os.path.isdir(os.path.join('conf', 'locale')):\n         localedir = os.path.abspath(os.path.join('conf', 'locale'))\n         invoked_for_django = True\n+        # Ignoring all contrib apps\n+        ignore_patterns += ['contrib/*']\n     elif os.path.isdir('locale'):\n         localedir = os.path.abspath('locale')\n     else:\n@@ -288,6 +291,11 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n             finally:\n                 f.close()\n             os.unlink(potfile)\n+            if no_obsolete:\n+                msgs, errors = _popen('msgattrib %s -o \"%s\" --no-obsolete \"%s\"' %\n+                                      (wrap, pofile, pofile))\n+                if errors:\n+                    raise CommandError(\"errors happened while running msgattrib\\n%s\" % errors)\n \n \n class Command(BaseCommand):\n@@ -309,6 +317,8 @@ class Command(BaseCommand):\n             default=True, help=\"Don't ignore the common glob-style patterns 'CVS', '.*' and '*~'.\"),\n         make_option('--no-wrap', action='store_true', dest='no_wrap',\n             default=False, help=\"Don't break long message lines into several lines\"),\n+        make_option('--no-obsolete', action='store_true', dest='no_obsolete',\n+            default=False, help=\"Remove obsolete message strings\"),\n     )\n     help = \"Runs over the entire source tree of the current directory and pulls out all strings marked for translation. It creates (or updates) a message file in the conf/locale (in the django tree) or locale (for project and application) directory.\"\n \n@@ -330,7 +340,7 @@ def handle(self, *args, **options):\n             ignore_patterns += ['CVS', '.*', '*~']\n         ignore_patterns = list(set(ignore_patterns))\n         no_wrap = options.get('no_wrap')\n-\n+        no_obsolete = options.get('no_obsolete')\n         if domain == 'djangojs':\n             extensions = handle_extensions(extensions or ['js'])\n         else:\n@@ -340,4 +350,4 @@ def handle(self, *args, **options):\n             sys.stdout.write('examining files with the extensions: %s\\n'\n                              % get_text_list(list(extensions), 'and'))\n \n-        make_messages(locale, domain, verbosity, process_all, extensions, symlinks, ignore_patterns, no_wrap)\n+        make_messages(locale, domain, verbosity, process_all, extensions, symlinks, ignore_patterns, no_wrap, no_obsolete)"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
    }
}