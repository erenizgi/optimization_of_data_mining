{
    "author": "unknown",
    "message": "Fixed #18362 - Made model.save() update_fields accept attnames",
    "sha": "0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b",
    "files": [
        {
            "sha": "82283d591c960a8a1433ed8be09717eceb460a49",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b",
            "patch": "@@ -468,8 +468,15 @@ def save(self, force_insert=False, force_update=False, using=None,\n                 return\n \n             update_fields = frozenset(update_fields)\n-            field_names = set([field.name for field in self._meta.fields\n-                               if not field.primary_key])\n+            field_names = set()\n+\n+            for field in self._meta.fields:\n+                if not field.primary_key:\n+                    field_names.add(field.name)\n+\n+                    if field.name != field.attname:\n+                        field_names.add(field.attname)\n+\n             non_model_fields = update_fields.difference(field_names)\n \n             if non_model_fields:\n@@ -534,7 +541,7 @@ def save_base(self, raw=False, cls=None, origin=None, force_insert=False,\n             non_pks = [f for f in meta.local_fields if not f.primary_key]\n \n             if update_fields:\n-                non_pks = [f for f in non_pks if f.name in update_fields]\n+                non_pks = [f for f in non_pks if f.name in update_fields or f.attname in update_fields]\n \n             # First, try an UPDATE. If that doesn't update anything, do an INSERT.\n             pk_val = self._get_pk_val(meta)"
        },
        {
            "sha": "bce53ca621d752b725d117a9e66440c03b39e52f",
            "filename": "tests/modeltests/update_only_fields/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fupdate_only_fields%2Ftests.py?ref=0f49b2bce2d5b3c5891c8a329bab7dffe16fc79b",
            "patch": "@@ -55,6 +55,14 @@ def test_update_fields_inheritance(self):\n         self.assertEqual(e3.name, 'Ian')\n         self.assertEqual(e3.profile, profile_receptionist)\n \n+        with self.assertNumQueries(1):\n+            e3.profile = profile_boss\n+            e3.save(update_fields=['profile_id'])\n+\n+        e4 = Employee.objects.get(pk=e3.pk)\n+        self.assertEqual(e4.profile, profile_boss)\n+        self.assertEqual(e4.profile_id, profile_boss.pk)\n+\n     def test_update_fields_inheritance_with_proxy_model(self):\n         profile_boss = Profile.objects.create(name='Boss', salary=3000)\n         profile_receptionist = Profile.objects.create(name='Receptionist', salary=1000)"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}