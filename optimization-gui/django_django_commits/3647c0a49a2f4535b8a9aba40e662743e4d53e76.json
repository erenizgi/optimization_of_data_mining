{
    "author": "akaariai",
    "message": "Avoided unnecessary recreation of RelatedObjects\n\nRefs #19399. Thanks to Track alias KJ for the patch.",
    "sha": "3647c0a49a2f4535b8a9aba40e662743e4d53e76",
    "files": [
        {
            "sha": "f49a3c22325badb4905108ad28ee052181f63530",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/3647c0a49a2f4535b8a9aba40e662743e4d53e76/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/3647c0a49a2f4535b8a9aba40e662743e4d53e76/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=3647c0a49a2f4535b8a9aba40e662743e4d53e76",
            "patch": "@@ -27,7 +27,6 @@ def get_validation_errors(outfile, app=None):\n     \"\"\"\n     from django.db import models, connection\n     from django.db.models.loading import get_app_errors\n-    from django.db.models.fields.related import RelatedObject\n     from django.db.models.deletion import SET_NULL, SET_DEFAULT\n \n     e = ModelErrorCollection(outfile)\n@@ -154,7 +153,7 @@ def get_validation_errors(outfile, app=None):\n                     e.add(opts, \"Field '%s' under model '%s' must have a unique=True constraint.\" % (f.rel.field_name, f.rel.to.__name__))\n \n                 rel_opts = f.rel.to._meta\n-                rel_name = RelatedObject(f.rel.to, cls, f).get_accessor_name()\n+                rel_name = f.related.get_accessor_name()\n                 rel_query_name = f.related_query_name()\n                 if not f.rel.is_hidden():\n                     for r in rel_opts.fields:\n@@ -278,7 +277,7 @@ def get_validation_errors(outfile, app=None):\n                 )\n \n             rel_opts = f.rel.to._meta\n-            rel_name = RelatedObject(f.rel.to, cls, f).get_accessor_name()\n+            rel_name = f.related.get_accessor_name()\n             rel_query_name = f.related_query_name()\n             # If rel_name is none, there is no reverse accessor (this only\n             # occurs for symmetrical m2m relations to self). If this is the"
        },
        {
            "sha": "952596b51411075d35676eb9829f04f7b174a535",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/3647c0a49a2f4535b8a9aba40e662743e4d53e76/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/3647c0a49a2f4535b8a9aba40e662743e4d53e76/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=3647c0a49a2f4535b8a9aba40e662743e4d53e76",
            "patch": "@@ -4,7 +4,6 @@\n from bisect import bisect\n \n from django.conf import settings\n-from django.db.models.related import RelatedObject\n from django.db.models.fields.related import ManyToManyRel\n from django.db.models.fields import AutoField, FieldDoesNotExist\n from django.db.models.fields.proxy import OrderWrt\n@@ -424,10 +423,10 @@ def _fill_related_objects_cache(self):\n                 for f in klass._meta.local_fields:\n                     if f.rel and not isinstance(f.rel.to, six.string_types):\n                         if self == f.rel.to._meta:\n-                            cache[RelatedObject(f.rel.to, klass, f)] = None\n-                            proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n+                            cache[f.related] = None\n+                            proxy_cache[f.related] = None\n                         elif self.concrete_model == f.rel.to._meta.concrete_model:\n-                            proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n+                            proxy_cache[f.related] = None\n         self._related_objects_cache = cache\n         self._related_objects_proxy_cache = proxy_cache\n \n@@ -468,7 +467,7 @@ def _fill_related_many_to_many_cache(self):\n                     if (f.rel\n                             and not isinstance(f.rel.to, six.string_types)\n                             and self == f.rel.to._meta):\n-                        cache[RelatedObject(f.rel.to, klass, f)] = None\n+                        cache[f.related] = None\n         if app_cache_ready():\n             self._related_many_to_many_cache = cache\n         return cache"
        },
        {
            "sha": "74886d7ae04456dae3166524789108909e90b989",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/3647c0a49a2f4535b8a9aba40e662743e4d53e76/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/3647c0a49a2f4535b8a9aba40e662743e4d53e76/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=3647c0a49a2f4535b8a9aba40e662743e4d53e76",
            "patch": "@@ -702,14 +702,11 @@ class BaseInlineFormSet(BaseModelFormSet):\n     \"\"\"A formset for child objects related to a parent.\"\"\"\n     def __init__(self, data=None, files=None, instance=None,\n                  save_as_new=False, prefix=None, queryset=None, **kwargs):\n-        from django.db.models.fields.related import RelatedObject\n         if instance is None:\n             self.instance = self.fk.rel.to()\n         else:\n             self.instance = instance\n         self.save_as_new = save_as_new\n-        # is there a better way to get the object descriptor?\n-        self.rel_name = RelatedObject(self.fk.rel.to, self.model, self.fk).get_accessor_name()\n         if queryset is None:\n             queryset = self.model._default_manager\n         if self.instance.pk:"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 6,
        "deletions": 11
    }
}