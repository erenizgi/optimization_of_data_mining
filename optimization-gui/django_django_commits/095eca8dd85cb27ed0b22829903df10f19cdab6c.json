{
    "author": "aaugustin",
    "message": "Fixed #19101 -- Decoding of non-ASCII POST data on Python 3.\n\nThanks Claude Paroz.",
    "sha": "095eca8dd85cb27ed0b22829903df10f19cdab6c",
    "files": [
        {
            "sha": "5bcc8749822725f592bd00f43ca03ff253d22469",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/095eca8dd85cb27ed0b22829903df10f19cdab6c/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/095eca8dd85cb27ed0b22829903df10f19cdab6c/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=095eca8dd85cb27ed0b22829903df10f19cdab6c",
            "patch": "@@ -110,7 +110,7 @@ def parse(self):\n         # HTTP spec says that Content-Length >= 0 is valid\n         # handling content-length == 0 before continuing\n         if self._content_length == 0:\n-            return QueryDict(MultiValueDict(), encoding=self._encoding), MultiValueDict()\n+            return QueryDict('', encoding=self._encoding), MultiValueDict()\n \n         # See if the handler will want to take care of the parsing.\n         # This allows overriding everything if somebody wants it."
        },
        {
            "sha": "d3f0888d477a6ab3ddbed4fe84d0c426ce25d037",
            "filename": "django/http/request.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/095eca8dd85cb27ed0b22829903df10f19cdab6c/django%2Fhttp%2Frequest.py",
            "raw_url": "https://github.com/django/django/raw/095eca8dd85cb27ed0b22829903df10f19cdab6c/django%2Fhttp%2Frequest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Frequest.py?ref=095eca8dd85cb27ed0b22829903df10f19cdab6c",
            "patch": "@@ -276,6 +276,9 @@ def __init__(self, query_string, mutable=False, encoding=None):\n             encoding = settings.DEFAULT_CHARSET\n         self.encoding = encoding\n         if six.PY3:\n+            if isinstance(query_string, bytes):\n+                # query_string contains URL-encoded data, a subset of ASCII.\n+                query_string = query_string.decode()\n             for key, value in parse_qsl(query_string or '',\n                                         keep_blank_values=True,\n                                         encoding=encoding):"
        },
        {
            "sha": "164c1082fe319584913f756e04810fffc14ada75",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/095eca8dd85cb27ed0b22829903df10f19cdab6c/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/095eca8dd85cb27ed0b22829903df10f19cdab6c/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=095eca8dd85cb27ed0b22829903df10f19cdab6c",
            "patch": "@@ -12,7 +12,7 @@\n from django.test.client import FakePayload\n from django.test.utils import override_settings, str_prefix\n from django.utils import unittest\n-from django.utils.http import cookie_date\n+from django.utils.http import cookie_date, urlencode\n from django.utils.timezone import utc\n \n \n@@ -353,6 +353,16 @@ def test_value_after_read(self):\n         self.assertRaises(Exception, lambda: request.body)\n         self.assertEqual(request.POST, {})\n \n+    def test_non_ascii_POST(self):\n+        payload = FakePayload(urlencode({'key': 'España'}))\n+        request = WSGIRequest({\n+            'REQUEST_METHOD': 'POST',\n+            'CONTENT_LENGTH': len(payload),\n+            'CONTENT_TYPE': 'application/x-www-form-urlencoded',\n+            'wsgi.input': payload,\n+        })\n+        self.assertEqual(request.POST, {'key': ['España']})\n+\n     def test_alternate_charset_POST(self):\n         \"\"\"\n         Test a POST with non-utf-8 payload encoding."
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}