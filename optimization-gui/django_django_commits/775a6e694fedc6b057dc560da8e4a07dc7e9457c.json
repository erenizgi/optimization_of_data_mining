{
    "author": "ramiro",
    "message": "Fixed #15632 -- Ignore unrelated content in template multi-line comment blocks when looking for tokens that identify comments for translators. Thanks andrew AT ie-grad DOT ru for the report and Claude Paroz for spotting the problem and helping to fix it.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15882 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "775a6e694fedc6b057dc560da8e4a07dc7e9457c",
    "files": [
        {
            "sha": "b8478354bde38542f1807bf97ec1a6095f0a575a",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/775a6e694fedc6b057dc560da8e4a07dc7e9457c/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/775a6e694fedc6b057dc560da8e4a07dc7e9457c/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=775a6e694fedc6b057dc560da8e4a07dc7e9457c",
            "patch": "@@ -435,7 +435,8 @@ def templatize(src, origin=None):\n     does so by translating the Django translation tags into standard gettext\n     function invocations.\n     \"\"\"\n-    from django.template import Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK, TOKEN_COMMENT\n+    from django.template import (Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK,\n+            TOKEN_COMMENT, TRANSLATOR_COMMENT_MARK)\n     out = StringIO()\n     intrans = False\n     inplural = False\n@@ -446,7 +447,16 @@ def templatize(src, origin=None):\n     for t in Lexer(src, origin).tokenize():\n         if incomment:\n             if t.token_type == TOKEN_BLOCK and t.contents == 'endcomment':\n-                out.write(' # %s' % ''.join(comment))\n+                content = u''.join(comment)\n+                translators_comment_start = None\n+                for lineno, line in enumerate(content.splitlines(True)):\n+                    if line.lstrip().startswith(TRANSLATOR_COMMENT_MARK):\n+                        translators_comment_start = lineno\n+                for lineno, line in enumerate(content.splitlines(True)):\n+                    if translators_comment_start is not None and lineno >= translators_comment_start:\n+                        out.write(u' # %s' % line)\n+                    else:\n+                        out.write(u' #\\n')\n                 incomment = False\n                 comment = []\n             else:"
        },
        {
            "sha": "0d70d2641dc459c4371ed8d7dc32ba37b75fea17",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/775a6e694fedc6b057dc560da8e4a07dc7e9457c/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/775a6e694fedc6b057dc560da8e4a07dc7e9457c/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=775a6e694fedc6b057dc560da8e4a07dc7e9457c",
            "patch": "@@ -49,7 +49,19 @@ def test_comments_extractor(self):\n         self.assertTrue('This comment should not be extracted' not in po_contents)\n         # Comments in templates\n         self.assertTrue('#. Translators: Django template comment for translators' in po_contents)\n-        self.assertTrue('#. Translators: Django comment block for translators' in po_contents)\n+        self.assertTrue(\"#. Translators: Django comment block for translators\\n#. string's meaning unveiled\" in po_contents)\n+\n+        self.assertTrue('#. Translators: One-line translator comment #1' in po_contents)\n+        self.assertTrue('#. Translators: Two-line translator comment #1\\n#. continued here.' in po_contents)\n+\n+        self.assertTrue('#. Translators: One-line translator comment #2' in po_contents)\n+        self.assertTrue('#. Translators: Two-line translator comment #2\\n#. continued here.' in po_contents)\n+\n+        self.assertTrue('#. Translators: One-line translator comment #3' in po_contents)\n+        self.assertTrue('#. Translators: Two-line translator comment #3\\n#. continued here.' in po_contents)\n+\n+        self.assertTrue('#. Translators: One-line translator comment #4' in po_contents)\n+        self.assertTrue('#. Translators: Two-line translator comment #4\\n#. continued here.' in po_contents)\n \n     def test_templatize(self):\n         os.chdir(self.test_dir)"
        },
        {
            "sha": "86c7772580f75eb14ddf93d0e3f58824b6c6183c",
            "filename": "tests/regressiontests/i18n/commands/templates/test.html",
            "status": "modified",
            "additions": 45,
            "deletions": 1,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/775a6e694fedc6b057dc560da8e4a07dc7e9457c/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html",
            "raw_url": "https://github.com/django/django/raw/775a6e694fedc6b057dc560da8e4a07dc7e9457c/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Ftemplates%2Ftest.html?ref=775a6e694fedc6b057dc560da8e4a07dc7e9457c",
            "patch": "@@ -1,8 +1,52 @@\n {% load i18n %}\n-{% comment %}Translators: Django comment block for translators {% endcomment %}\n+{% comment %}Translators: Django comment block for translators\n+string's meaning unveiled\n+{% endcomment %}\n {% trans \"This literal should be included.\" %}\n {% trans \"This literal should also be included wrapped or not wrapped depending on the use of the --no-wrap option.\" %}\n \n {# Translators: Django template comment for translators #}\n <p>{% blocktrans %}I think that 100% is more that 50% of anything.{% endblocktrans %}</p>\n {% blocktrans with 'txt' as obj %}I think that 100% is more that 50% of {{ obj }}.{% endblocktrans %}\n+\n+{% comment %}Some random comment\n+Some random comment\n+Translators: One-line translator comment #1\n+{% endcomment %}\n+{% trans \"Translatable literal #1a\" %}\n+\n+{% comment %}Some random comment\n+Some random comment\n+Translators: Two-line translator comment #1\n+continued here.\n+{% endcomment %}\n+{% trans \"Translatable literal #1b\" %}\n+\n+{% comment %}Some random comment\n+Translators: One-line translator comment #2\n+{% endcomment %}\n+{% trans \"Translatable literal #2a\" %}\n+\n+{% comment %}Some random comment\n+Translators: Two-line translator comment #2\n+continued here.\n+{% endcomment %}\n+{% trans \"Translatable literal #2b\" %}\n+\n+{% comment %}\n+    Translators: One-line translator comment #3\n+{% endcomment %}\n+{% trans \"Translatable literal #3a\" %}\n+\n+{% comment %}\n+Translators: Two-line translator comment #3\n+continued here.\n+{% endcomment %}\n+{% trans \"Translatable literal #3b\" %}\n+\n+{% comment %} Translators: One-line translator comment #4{% endcomment %}\n+{% trans \"Translatable literal #4a\" %}\n+\n+{% comment %}  Translators: Two-line translator comment #4\n+continued here.{% endcomment %}\n+{% trans \"Translatable literal #4b\" %}"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 70,
        "deletions": 4
    }
}