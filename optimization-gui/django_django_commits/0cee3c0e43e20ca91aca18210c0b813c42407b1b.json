{
    "author": "aaugustin",
    "message": "Updated a test that doesn't make sense with autocommit.",
    "sha": "0cee3c0e43e20ca91aca18210c0b813c42407b1b",
    "files": [
        {
            "sha": "142c09d3cf9e9367a93a42e48e764230e08be5e8",
            "filename": "tests/transactions_regress/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 13,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/0cee3c0e43e20ca91aca18210c0b813c42407b1b/tests%2Ftransactions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0cee3c0e43e20ca91aca18210c0b813c42407b1b/tests%2Ftransactions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Ftransactions_regress%2Ftests.py?ref=0cee3c0e43e20ca91aca18210c0b813c42407b1b",
            "patch": "@@ -4,7 +4,7 @@\n from django.db.transaction import commit_on_success, commit_manually, TransactionManagementError\n from django.test import TransactionTestCase, skipUnlessDBFeature\n from django.test.utils import override_settings\n-from django.utils.unittest import skipIf, skipUnless, expectedFailure\n+from django.utils.unittest import skipIf, skipUnless\n \n from transactions.tests import IgnorePendingDeprecationWarningsMixin\n \n@@ -187,22 +187,24 @@ def tearDown(self):\n             connections[DEFAULT_DB_ALIAS].close()\n             connections[DEFAULT_DB_ALIAS] = self._old_backend\n \n-    # TODO: update this test to account for database-level autocommit.\n-    @expectedFailure\n     def test_commit(self):\n         \"\"\"\n         Users are allowed to commit and rollback connections.\n         \"\"\"\n-        # The starting value is False, not None.\n-        self.assertIs(connection._dirty, False)\n-        list(Mod.objects.all())\n-        self.assertTrue(connection.is_dirty())\n-        connection.commit()\n-        self.assertFalse(connection.is_dirty())\n-        list(Mod.objects.all())\n-        self.assertTrue(connection.is_dirty())\n-        connection.rollback()\n-        self.assertFalse(connection.is_dirty())\n+        connection.set_autocommit(False)\n+        try:\n+            # The starting value is False, not None.\n+            self.assertIs(connection._dirty, False)\n+            list(Mod.objects.all())\n+            self.assertTrue(connection.is_dirty())\n+            connection.commit()\n+            self.assertFalse(connection.is_dirty())\n+            list(Mod.objects.all())\n+            self.assertTrue(connection.is_dirty())\n+            connection.rollback()\n+            self.assertFalse(connection.is_dirty())\n+        finally:\n+            connection.set_autocommit(True)\n \n     def test_enter_exit_management(self):\n         orig_dirty = connection._dirty"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 15,
        "deletions": 13
    }
}