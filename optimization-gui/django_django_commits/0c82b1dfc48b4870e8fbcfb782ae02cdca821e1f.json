{
    "author": "aaugustin",
    "message": "Fixed #19929 -- Improved error when MySQL doesn't have TZ definitions.\n\nThanks tomas_00 for the report.",
    "sha": "0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f",
    "files": [
        {
            "sha": "7ddee9785cb00d331d122677d2ad130bd6166aa7",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f",
            "patch": "@@ -1057,6 +1057,10 @@ def results_iter(self):\n                 # Datetimes are artifically returned in UTC on databases that\n                 # don't support time zone. Restore the zone used in the query.\n                 if settings.USE_TZ:\n+                    if datetime is None:\n+                        raise ValueError(\"Database returned an invalid value \"\n+                                         \"in QuerySet.dates(). Are time zone \"\n+                                         \"definitions installed?\")\n                     datetime = datetime.replace(tzinfo=None)\n                     datetime = timezone.make_aware(datetime, self.query.tzinfo)\n                 yield datetime"
        },
        {
            "sha": "9a0f3ca7f8e47b02c72c50a9ceda600fed10bd81",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=0c82b1dfc48b4870e8fbcfb782ae02cdca821e1f",
            "patch": "@@ -142,6 +142,13 @@ subclass::\n     e.g. if all the dates are in one month, it'll show the day-level\n     drill-down only.\n \n+    .. note::\n+\n+        ``date_hierarchy`` uses :meth:`QuerySet.datetimes()\n+        <django.db.models.query.QuerySet.datetimes>` internally. Please refer\n+        to its documentation for some caveats when time zone support is\n+        enabled (:setting:`USE_TZ = True <USE_TZ>`).\n+\n .. attribute:: ModelAdmin.exclude\n \n     This attribute, if given, should be a list of field names to exclude from"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}