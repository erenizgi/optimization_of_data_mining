{
    "author": "aaugustin",
    "message": "Fixed #19487 -- Used str in the test client's WSGI environ.\n\nThis regression was introduced by the unicode_literals patch. The WSGI\nspec mandates that environ contains native strings.",
    "sha": "d9a0b6ab36b6beb4251acf1de1fdf255e1223e02",
    "files": [
        {
            "sha": "a3c04bb20dbefb1bcf9f99340499c6f6ff79cd99",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 23,
            "deletions": 23,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/d9a0b6ab36b6beb4251acf1de1fdf255e1223e02/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/d9a0b6ab36b6beb4251acf1de1fdf255e1223e02/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=d9a0b6ab36b6beb4251acf1de1fdf255e1223e02",
            "patch": "@@ -21,7 +21,7 @@\n from django.template import TemplateDoesNotExist\n from django.test import signals\n from django.utils.functional import curry\n-from django.utils.encoding import force_bytes\n+from django.utils.encoding import force_bytes, force_str\n from django.utils.http import urlencode\n from django.utils.importlib import import_module\n from django.utils.itercompat import is_iterable\n@@ -205,15 +205,15 @@ def _base_environ(self, **request):\n         # See http://www.python.org/dev/peps/pep-3333/#environ-variables\n         environ = {\n             'HTTP_COOKIE':       self.cookies.output(header='', sep='; '),\n-            'PATH_INFO':         '/',\n-            'REMOTE_ADDR':       '127.0.0.1',\n-            'REQUEST_METHOD':    'GET',\n-            'SCRIPT_NAME':       '',\n-            'SERVER_NAME':       'testserver',\n-            'SERVER_PORT':       '80',\n-            'SERVER_PROTOCOL':   'HTTP/1.1',\n+            'PATH_INFO':         str('/'),\n+            'REMOTE_ADDR':       str('127.0.0.1'),\n+            'REQUEST_METHOD':    str('GET'),\n+            'SCRIPT_NAME':       str(''),\n+            'SERVER_NAME':       str('testserver'),\n+            'SERVER_PORT':       str('80'),\n+            'SERVER_PROTOCOL':   str('HTTP/1.1'),\n             'wsgi.version':      (1, 0),\n-            'wsgi.url_scheme':   'http',\n+            'wsgi.url_scheme':   str('http'),\n             'wsgi.input':        FakePayload(b''),\n             'wsgi.errors':       self.errors,\n             'wsgi.multiprocess': True,\n@@ -241,21 +241,21 @@ def _encode_data(self, data, content_type, ):\n             return force_bytes(data, encoding=charset)\n \n     def _get_path(self, parsed):\n+        path = force_str(parsed[2])\n         # If there are parameters, add them\n         if parsed[3]:\n-            return unquote(parsed[2] + \";\" + parsed[3])\n-        else:\n-            return unquote(parsed[2])\n+            path += str(\";\") + force_str(parsed[3])\n+        return unquote(path)\n \n     def get(self, path, data={}, **extra):\n         \"Construct a GET request.\"\n \n         parsed = urlparse(path)\n         r = {\n-            'CONTENT_TYPE':    'text/html; charset=utf-8',\n+            'CONTENT_TYPE':    str('text/html; charset=utf-8'),\n             'PATH_INFO':       self._get_path(parsed),\n-            'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n-            'REQUEST_METHOD': 'GET',\n+            'QUERY_STRING':    urlencode(data, doseq=True) or force_str(parsed[4]),\n+            'REQUEST_METHOD':  str('GET'),\n         }\n         r.update(extra)\n         return self.request(**r)\n@@ -271,8 +271,8 @@ def post(self, path, data={}, content_type=MULTIPART_CONTENT,\n             'CONTENT_LENGTH': len(post_data),\n             'CONTENT_TYPE':   content_type,\n             'PATH_INFO':      self._get_path(parsed),\n-            'QUERY_STRING':   parsed[4],\n-            'REQUEST_METHOD': 'POST',\n+            'QUERY_STRING':   force_str(parsed[4]),\n+            'REQUEST_METHOD': str('POST'),\n             'wsgi.input':     FakePayload(post_data),\n         }\n         r.update(extra)\n@@ -283,10 +283,10 @@ def head(self, path, data={}, **extra):\n \n         parsed = urlparse(path)\n         r = {\n-            'CONTENT_TYPE':    'text/html; charset=utf-8',\n+            'CONTENT_TYPE':    str('text/html; charset=utf-8'),\n             'PATH_INFO':       self._get_path(parsed),\n-            'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n-            'REQUEST_METHOD': 'HEAD',\n+            'QUERY_STRING':    urlencode(data, doseq=True) or force_str(parsed[4]),\n+            'REQUEST_METHOD':  str('HEAD'),\n         }\n         r.update(extra)\n         return self.request(**r)\n@@ -312,13 +312,13 @@ def generic(self, method, path,\n         data = force_bytes(data, settings.DEFAULT_CHARSET)\n         r = {\n             'PATH_INFO':      self._get_path(parsed),\n-            'QUERY_STRING':   parsed[4],\n-            'REQUEST_METHOD': method,\n+            'QUERY_STRING':   force_str(parsed[4]),\n+            'REQUEST_METHOD': str(method),\n         }\n         if data:\n             r.update({\n                 'CONTENT_LENGTH': len(data),\n-                'CONTENT_TYPE':   content_type,\n+                'CONTENT_TYPE':   str(content_type),\n                 'wsgi.input':     FakePayload(data),\n             })\n         r.update(extra)"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 23,
        "deletions": 23
    }
}