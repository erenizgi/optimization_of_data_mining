{
    "author": "aaugustin",
    "message": "Stopped using non-standard __globals__ and __code__ attributes.\n\nSome alternative implementations don't have them.\n\nCloses #19944.",
    "sha": "9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188",
    "files": [
        {
            "sha": "3bfba3ba081541a9c2cb85566275b246d424c547",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.encoding import force_text, iri_to_uri, smart_text\n from django.utils.html import escape\n from django.utils.http import http_date\n+from django.utils import six\n from django.utils.timezone import is_naive\n \n \n@@ -69,15 +70,14 @@ def __get_dynamic_attr(self, attname, obj, default=None):\n         except AttributeError:\n             return default\n         if callable(attr):\n-            # Check __code__.co_argcount rather than try/excepting the\n-            # function and catching the TypeError, because something inside\n-            # the function may raise the TypeError. This technique is more\n-            # accurate.\n-            if hasattr(attr, '__code__'):\n-                argcount = attr.__code__.co_argcount\n-            else:\n-                argcount = attr.__call__.__code__.co_argcount\n-            if argcount == 2: # one argument is 'self'\n+            # Check co_argcount rather than try/excepting the function and\n+            # catching the TypeError, because something inside the function\n+            # may raise the TypeError. This technique is more accurate.\n+            try:\n+                code = six.get_function_code(attr)\n+            except AttributeError:\n+                code = six.get_function_code(attr.__call__)\n+            if code.co_argcount == 2:       # one argument is 'self'\n                 return attr(obj)\n             else:\n                 return attr()"
        },
        {
            "sha": "9b8ddc9696f981672ceb19d0810e6c3e0c2f8ef8",
            "filename": "django/test/_doctest.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188/django%2Ftest%2F_doctest.py",
            "raw_url": "https://github.com/django/django/raw/9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188/django%2Ftest%2F_doctest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F_doctest.py?ref=9d4a5b00f1977d8cddf8e241fa4bb8a9e819f188",
            "patch": "@@ -883,7 +883,7 @@ def _from_module(self, module, object):\n         if module is None:\n             return True\n         elif inspect.isfunction(object):\n-            return module.__dict__ is object.__globals__\n+            return module.__dict__ is six.get_function_globals(object)\n         elif inspect.isclass(object):\n             return module.__name__ == object.__module__\n         elif inspect.getmodule(object) is not None:\n@@ -1021,7 +1021,7 @@ def _find_lineno(self, obj, source_lines):\n \n         # Find the line number for functions & methods.\n         if inspect.ismethod(obj): obj = obj.__func__\n-        if inspect.isfunction(obj): obj = obj.__code__\n+        if inspect.isfunction(obj): obj = six.get_function_code(obj)\n         if inspect.istraceback(obj): obj = obj.tb_frame\n         if inspect.isframe(obj): obj = obj.f_code\n         if inspect.iscode(obj):"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 11,
        "deletions": 11
    }
}