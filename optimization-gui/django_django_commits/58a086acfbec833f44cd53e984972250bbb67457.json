{
    "author": "aaugustin",
    "message": "Required serializer to use bytes in loads/dumps\n\nloads has no way to tell if it should provide text or bytes to the\nserializer; bytes are more reasonnable for a serialized representation,\nand are the only option for pickled data.\n\ndumps can perform conversions on the value it receives from the\nserializer; but for consistency it seems better to require bytes too.\n\nThe current code would cause an exception when loading pickled session\ndata. See next commit.\n\nAlso fixed a bug when checking for compressed data.",
    "sha": "58a086acfbec833f44cd53e984972250bbb67457",
    "files": [
        {
            "sha": "92ab968123eb35d83ca0b6a10ae5e5c0c75bbe21",
            "filename": "django/core/signing.py",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/58a086acfbec833f44cd53e984972250bbb67457/django%2Fcore%2Fsigning.py",
            "raw_url": "https://github.com/django/django/raw/58a086acfbec833f44cd53e984972250bbb67457/django%2Fcore%2Fsigning.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fsigning.py?ref=58a086acfbec833f44cd53e984972250bbb67457",
            "patch": "@@ -97,10 +97,10 @@ class JSONSerializer(object):\n     signing.loads.\n     \"\"\"\n     def dumps(self, obj):\n-        return json.dumps(obj, separators=(',', ':'))\n+        return json.dumps(obj, separators=(',', ':')).encode('latin-1')\n \n     def loads(self, data):\n-        return json.loads(data)\n+        return json.loads(data.decode('latin-1'))\n \n \n def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer, compress=False):\n@@ -116,8 +116,10 @@ def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer,\n     only valid for a given namespace. Leaving this at the default\n     value or re-using a salt value across different parts of your\n     application without good cause is a security risk.\n+\n+    The serializer is expected to return a bytestring.\n     \"\"\"\n-    data = force_bytes(serializer().dumps(obj))\n+    data = serializer().dumps(obj)\n \n     # Flag for if it's been compressed or not\n     is_compressed = False\n@@ -136,20 +138,22 @@ def dumps(obj, key=None, salt='django.core.signing', serializer=JSONSerializer,\n \n def loads(s, key=None, salt='django.core.signing', serializer=JSONSerializer, max_age=None):\n     \"\"\"\n-    Reverse of dumps(), raises BadSignature if signature fails\n+    Reverse of dumps(), raises BadSignature if signature fails.\n+\n+    The serializer is expected to accept a bytestring.\n     \"\"\"\n     # TimestampSigner.unsign always returns unicode but base64 and zlib\n     # compression operate on bytes.\n     base64d = force_bytes(TimestampSigner(key, salt=salt).unsign(s, max_age=max_age))\n     decompress = False\n-    if base64d[0] == b'.':\n+    if base64d[:1] == b'.':\n         # It's compressed; uncompress it first\n         base64d = base64d[1:]\n         decompress = True\n     data = b64_decode(base64d)\n     if decompress:\n         data = zlib.decompress(data)\n-    return serializer().loads(force_str(data))\n+    return serializer().loads(data)\n \n \n class Signer(object):"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 10,
        "deletions": 6
    }
}