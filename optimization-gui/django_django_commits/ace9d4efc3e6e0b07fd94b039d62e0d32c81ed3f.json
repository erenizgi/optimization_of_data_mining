{
    "author": "aaugustin",
    "message": "Made ungettext_lazy usable for messages that do not contain the count.\n\nFixed #19160 (again). Thanks Alexey Boriskin.",
    "sha": "ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f",
    "files": [
        {
            "sha": "6fd52b6023f144e9ea1ee54fd6e3cd287a6e8090",
            "filename": "django/utils/translation/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/django%2Futils%2Ftranslation%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/django%2Futils%2Ftranslation%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2F__init__.py?ref=ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f",
            "patch": "@@ -106,7 +106,13 @@ def __mod__(self, rhs):\n                 else:\n                     number_value = rhs\n                 kwargs['number'] = number_value\n-                return func(**kwargs) % rhs\n+                translated = func(**kwargs)\n+                try:\n+                    translated = translated % rhs\n+                except TypeError:\n+                    # String doesn't contain a placeholder for the number\n+                    pass\n+                return translated\n \n         proxy = lazy(lambda **kwargs: NumberAwareString(), NumberAwareString)(**kwargs)\n     return proxy"
        },
        {
            "sha": "ef64b650ec8b1f316a2d1162f32d66eecb857338",
            "filename": "tests/regressiontests/i18n/other/locale/de/LC_MESSAGES/django.mo",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo?ref=ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f"
        },
        {
            "sha": "822fa3796b846e19048a9bab7053ad852b8a67d5",
            "filename": "tests/regressiontests/i18n/other/locale/de/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po?ref=ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f",
            "patch": "@@ -47,6 +47,12 @@ msgid_plural \"%d good results\"\n msgstr[0] \"%d gutes Resultat\"\n msgstr[1] \"%d guten Resultate\"\n \n+#: models.py:11\n+msgid \"good result\"\n+msgid_plural \"good results\"\n+msgstr[0] \"gutes Resultat\"\n+msgstr[1] \"guten Resultate\"\n+\n #: models.py:11\n msgctxt \"Exclamation\"\n msgid \"%d good result\""
        },
        {
            "sha": "7b4fd0eff8892d7edb5e1e30fa53b7685be51078",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 31,
            "deletions": 28,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=ace9d4efc3e6e0b07fd94b039d62e0d32c81ed3f",
            "patch": "@@ -102,39 +102,42 @@ def test_lazy_pickle(self):\n \n     @override_settings(LOCALE_PATHS=extended_locale_paths)\n     def test_ungettext_lazy(self):\n-        s0 = ungettext_lazy(\"%d good result\", \"%d good results\")\n-        s1 = ngettext_lazy(str(\"%d good result\"), str(\"%d good results\"))\n-        s2 = npgettext_lazy('Exclamation', '%d good result', '%d good results')\n+        simple_with_format = ungettext_lazy('%d good result', '%d good results')\n+        simple_str_with_format = ngettext_lazy(str('%d good result'), str('%d good results'))\n+        simple_context_with_format = npgettext_lazy('Exclamation', '%d good result', '%d good results')\n+        simple_without_format = ungettext_lazy('good result', 'good results')\n         with translation.override('de'):\n-            self.assertEqual(s0 % 1, \"1 gutes Resultat\")\n-            self.assertEqual(s0 % 4, \"4 guten Resultate\")\n-            self.assertEqual(s1 % 1, str(\"1 gutes Resultat\"))\n-            self.assertEqual(s1 % 4, str(\"4 guten Resultate\"))\n-            self.assertEqual(s2 % 1, \"1 gutes Resultat!\")\n-            self.assertEqual(s2 % 4, \"4 guten Resultate!\")\n-\n-        s3 = ungettext_lazy(\"Hi %(name)s, %(num)d good result\", \"Hi %(name)s, %(num)d good results\", 4)\n-        s4 = ungettext_lazy(\"Hi %(name)s, %(num)d good result\", \"Hi %(name)s, %(num)d good results\", 'num')\n-        s5 = ngettext_lazy(str(\"Hi %(name)s, %(num)d good result\"), str(\"Hi %(name)s, %(num)d good results\"), 4)\n-        s6 = ngettext_lazy(str(\"Hi %(name)s, %(num)d good result\"), str(\"Hi %(name)s, %(num)d good results\"), 'num')\n-        s7 = npgettext_lazy('Greeting', \"Hi %(name)s, %(num)d good result\", \"Hi %(name)s, %(num)d good results\", 4)\n-        s8 = npgettext_lazy('Greeting', \"Hi %(name)s, %(num)d good result\", \"Hi %(name)s, %(num)d good results\", 'num')\n+            self.assertEqual(simple_with_format % 1, '1 gutes Resultat')\n+            self.assertEqual(simple_with_format % 4, '4 guten Resultate')\n+            self.assertEqual(simple_str_with_format % 1, str('1 gutes Resultat'))\n+            self.assertEqual(simple_str_with_format % 4, str('4 guten Resultate'))\n+            self.assertEqual(simple_context_with_format % 1, '1 gutes Resultat!')\n+            self.assertEqual(simple_context_with_format % 4, '4 guten Resultate!')\n+            self.assertEqual(simple_without_format % 1, 'gutes Resultat')\n+            self.assertEqual(simple_without_format % 4, 'guten Resultate')\n+\n+        complex_nonlazy = ungettext_lazy('Hi %(name)s, %(num)d good result', 'Hi %(name)s, %(num)d good results', 4)\n+        complex_deferred = ungettext_lazy('Hi %(name)s, %(num)d good result', 'Hi %(name)s, %(num)d good results', 'num')\n+        complex_str_nonlazy = ngettext_lazy(str('Hi %(name)s, %(num)d good result'), str('Hi %(name)s, %(num)d good results'), 4)\n+        complex_str_deferred = ngettext_lazy(str('Hi %(name)s, %(num)d good result'), str('Hi %(name)s, %(num)d good results'), 'num')\n+        complex_context_nonlazy = npgettext_lazy('Greeting', 'Hi %(name)s, %(num)d good result', 'Hi %(name)s, %(num)d good results', 4)\n+        complex_context_deferred = npgettext_lazy('Greeting', 'Hi %(name)s, %(num)d good result', 'Hi %(name)s, %(num)d good results', 'num')\n         with translation.override('de'):\n-            self.assertEqual(s3 % {'num': 4, 'name': 'Jim'}, \"Hallo Jim, 4 guten Resultate\")\n-            self.assertEqual(s4 % {'name': 'Jim', 'num': 1}, \"Hallo Jim, 1 gutes Resultat\")\n-            self.assertEqual(s4 % {'name': 'Jim', 'num': 5}, \"Hallo Jim, 5 guten Resultate\")\n+            self.assertEqual(complex_nonlazy % {'num': 4, 'name': 'Jim'}, 'Hallo Jim, 4 guten Resultate')\n+            self.assertEqual(complex_deferred % {'name': 'Jim', 'num': 1}, 'Hallo Jim, 1 gutes Resultat')\n+            self.assertEqual(complex_deferred % {'name': 'Jim', 'num': 5}, 'Hallo Jim, 5 guten Resultate')\n             with six.assertRaisesRegex(self, KeyError, 'Your dictionary lacks key.*'):\n-                s4 % {'name': 'Jim'}\n-            self.assertEqual(s5 % {'num': 4, 'name': 'Jim'}, str(\"Hallo Jim, 4 guten Resultate\"))\n-            self.assertEqual(s6 % {'name': 'Jim', 'num': 1}, str(\"Hallo Jim, 1 gutes Resultat\"))\n-            self.assertEqual(s6 % {'name': 'Jim', 'num': 5}, str(\"Hallo Jim, 5 guten Resultate\"))\n+                complex_deferred % {'name': 'Jim'}\n+            self.assertEqual(complex_str_nonlazy % {'num': 4, 'name': 'Jim'}, str('Hallo Jim, 4 guten Resultate'))\n+            self.assertEqual(complex_str_deferred % {'name': 'Jim', 'num': 1}, str('Hallo Jim, 1 gutes Resultat'))\n+            self.assertEqual(complex_str_deferred % {'name': 'Jim', 'num': 5}, str('Hallo Jim, 5 guten Resultate'))\n             with six.assertRaisesRegex(self, KeyError, 'Your dictionary lacks key.*'):\n-                s6 % {'name': 'Jim'}\n-            self.assertEqual(s7 % {'num': 4, 'name': 'Jim'}, \"Willkommen Jim, 4 guten Resultate\")\n-            self.assertEqual(s8 % {'name': 'Jim', 'num': 1}, \"Willkommen Jim, 1 gutes Resultat\")\n-            self.assertEqual(s8 % {'name': 'Jim', 'num': 5}, \"Willkommen Jim, 5 guten Resultate\")\n+                complex_str_deferred % {'name': 'Jim'}\n+            self.assertEqual(complex_context_nonlazy % {'num': 4, 'name': 'Jim'}, 'Willkommen Jim, 4 guten Resultate')\n+            self.assertEqual(complex_context_deferred % {'name': 'Jim', 'num': 1}, 'Willkommen Jim, 1 gutes Resultat')\n+            self.assertEqual(complex_context_deferred % {'name': 'Jim', 'num': 5}, 'Willkommen Jim, 5 guten Resultate')\n             with six.assertRaisesRegex(self, KeyError, 'Your dictionary lacks key.*'):\n-                s8 % {'name': 'Jim'}\n+                complex_context_deferred % {'name': 'Jim'}\n \n     @override_settings(LOCALE_PATHS=extended_locale_paths)\n     def test_pgettext(self):"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 44,
        "deletions": 29
    }
}