{
    "author": "claudep",
    "message": "Fixed #11340 -- Prevented HttpResponseNotModified to have content/content-type\n\nThe HTTP 1.1 spec tells that the 304 response MUST NOT contain a\nmessage body.\nThanks aparajita for the report.",
    "sha": "7cfe8e8fce7677ec696f42a7d1501a97e8191a3d",
    "files": [
        {
            "sha": "7782ebe64823912f470114dfb0d1635b145bcc54",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=7cfe8e8fce7677ec696f42a7d1501a97e8191a3d",
            "patch": "@@ -744,6 +744,16 @@ class HttpResponsePermanentRedirect(HttpResponseRedirectBase):\n class HttpResponseNotModified(HttpResponse):\n     status_code = 304\n \n+    def __init__(self, *args, **kwargs):\n+        super(HttpResponseNotModified, self).__init__(*args, **kwargs)\n+        del self['content-type']\n+\n+    @HttpResponse.content.setter\n+    def content(self, value):\n+        if value:\n+            raise AttributeError(\"You cannot set content to a 304 (Not Modified) response\")\n+        self._container = []\n+\n class HttpResponseBadRequest(HttpResponse):\n     status_code = 400\n "
        },
        {
            "sha": "2ff22ce13f885dc35e7fa578fd7333eb588bc494",
            "filename": "django/views/static.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/django%2Fviews%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/django%2Fviews%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fstatic.py?ref=7cfe8e8fce7677ec696f42a7d1501a97e8191a3d",
            "patch": "@@ -61,7 +61,7 @@ def serve(request, path, document_root=None, show_indexes=False):\n     mimetype = mimetype or 'application/octet-stream'\n     if not was_modified_since(request.META.get('HTTP_IF_MODIFIED_SINCE'),\n                               statobj.st_mtime, statobj.st_size):\n-        return HttpResponseNotModified(content_type=mimetype)\n+        return HttpResponseNotModified()\n     with open(fullpath, 'rb') as f:\n         response = HttpResponse(f.read(), content_type=mimetype)\n     response[\"Last-Modified\"] = http_date(statobj.st_mtime)"
        },
        {
            "sha": "8d514dc5337988426c7923af4cdffd1b8475c709",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=7cfe8e8fce7677ec696f42a7d1501a97e8191a3d",
            "patch": "@@ -743,8 +743,9 @@ types of HTTP responses. Like ``HttpResponse``, these subclasses live in\n \n .. class:: HttpResponseNotModified\n \n-    The constructor doesn't take any arguments. Use this to designate that a\n-    page hasn't been modified since the user's last request (status code 304).\n+    The constructor doesn't take any arguments and no content should be added\n+    to this response. Use this to designate that a page hasn't been modified\n+    since the user's last request (status code 304).\n \n .. class:: HttpResponseBadRequest\n "
        },
        {
            "sha": "c84b2cd44e8c68f08870464bdb7413945a539c10",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7cfe8e8fce7677ec696f42a7d1501a97e8191a3d/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=7cfe8e8fce7677ec696f42a7d1501a97e8191a3d",
            "patch": "@@ -6,7 +6,7 @@\n \n from django.core.exceptions import SuspiciousOperation\n from django.http import (QueryDict, HttpResponse, HttpResponseRedirect,\n-                         HttpResponsePermanentRedirect,\n+                         HttpResponsePermanentRedirect, HttpResponseNotModified,\n                          SimpleCookie, BadHeaderError,\n                          parse_cookie)\n from django.utils import six\n@@ -330,6 +330,16 @@ def test_unsafe_redirect(self):\n                               HttpResponsePermanentRedirect, url)\n \n \n+class HttpResponseSubclassesTests(unittest.TestCase):\n+    def test_not_modified(self):\n+        response = HttpResponseNotModified()\n+        self.assertEqual(response.status_code, 304)\n+        # 304 responses should not have content/content-type\n+        with self.assertRaises(AttributeError):\n+            response.content = \"Hello dear\"\n+        self.assertNotIn('content-type', response)\n+\n+\n class CookieTests(unittest.TestCase):\n     def test_encode(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 29,
        "additions": 25,
        "deletions": 4
    }
}