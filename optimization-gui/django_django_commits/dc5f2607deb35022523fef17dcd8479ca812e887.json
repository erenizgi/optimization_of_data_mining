{
    "author": "ramiro",
    "message": "Fixed #15029 -- Moved to database backends the ability to decide if two DATABASES items are different when creating temporary databases for tests.\nhG: Enter commit message.  Lines beginning with 'HG:' are removed.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15392 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "dc5f2607deb35022523fef17dcd8479ca812e887",
    "files": [
        {
            "sha": "ef594b7bfc5c084bf419045945a965b879ac8acb",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/dc5f2607deb35022523fef17dcd8479ca812e887/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/dc5f2607deb35022523fef17dcd8479ca812e887/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=dc5f2607deb35022523fef17dcd8479ca812e887",
            "patch": "@@ -476,3 +476,17 @@ def set_autocommit(self):\n     def sql_table_creation_suffix(self):\n         \"SQL to append to the end of the test table creation statements\"\n         return ''\n+\n+    def test_db_signature(self):\n+        \"\"\"\n+        Returns a tuple with elements of self.connection.settings_dict (a\n+        DATABASES setting value) that uniquely identify a database\n+        accordingly to the RDBMS particularities.\n+        \"\"\"\n+        settings_dict = self.connection.settings_dict\n+        return (\n+            settings_dict['HOST'],\n+            settings_dict['PORT'],\n+            settings_dict['ENGINE'],\n+            settings_dict['NAME']\n+        )"
        },
        {
            "sha": "08b130229fcdca56087c6941cd0b6638ede2cf42",
            "filename": "django/db/backends/oracle/creation.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/dc5f2607deb35022523fef17dcd8479ca812e887/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/dc5f2607deb35022523fef17dcd8479ca812e887/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py?ref=dc5f2607deb35022523fef17dcd8479ca812e887",
            "patch": "@@ -259,3 +259,13 @@ def _get_test_db_name(self):\n         names as handled by Django haven't real counterparts in Oracle.\n         \"\"\"\n         return self.connection.settings_dict['NAME']\n+\n+    def test_db_signature(self):\n+        settings_dict = self.connection.settings_dict\n+        return (\n+            settings_dict['HOST'],\n+            settings_dict['PORT'],\n+            settings_dict['ENGINE'],\n+            settings_dict['NAME'],\n+            settings_dict['TEST_USER'],\n+        )"
        },
        {
            "sha": "c1230678a7c4fe23ee2fa2cc64711c165ec78732",
            "filename": "django/test/simple.py",
            "status": "modified",
            "additions": 9,
            "deletions": 13,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/dc5f2607deb35022523fef17dcd8479ca812e887/django%2Ftest%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/dc5f2607deb35022523fef17dcd8479ca812e887/django%2Ftest%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsimple.py?ref=dc5f2607deb35022523fef17dcd8479ca812e887",
            "patch": "@@ -1,6 +1,3 @@\n-import sys\n-import signal\n-\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n from django.db.models import get_app, get_apps\n@@ -203,7 +200,7 @@ def dependency_ordered(test_databases, dependencies):\n         deferred = []\n \n         while test_databases:\n-            signature, aliases = test_databases.pop()\n+            signature, (db_name, aliases) = test_databases.pop()\n             dependencies_satisfied = True\n             for alias in aliases:\n                 if alias in dependencies:\n@@ -217,10 +214,10 @@ def dependency_ordered(test_databases, dependencies):\n                     resolved_databases.add(alias)\n \n             if dependencies_satisfied:\n-                ordered_test_databases.append((signature, aliases))\n+                ordered_test_databases.append((signature, (db_name, aliases)))\n                 changed = True\n             else:\n-                deferred.append((signature, aliases))\n+                deferred.append((signature, (db_name, aliases)))\n \n         if not changed:\n             raise ImproperlyConfigured(\"Circular dependency in TEST_DEPENDENCIES\")\n@@ -276,12 +273,11 @@ def setup_databases(self, **kwargs):\n                 # Store a tuple with DB parameters that uniquely identify it.\n                 # If we have two aliases with the same values for that tuple,\n                 # we only need to create the test database once.\n-                test_databases.setdefault((\n-                        connection.settings_dict['HOST'],\n-                        connection.settings_dict['PORT'],\n-                        connection.settings_dict['ENGINE'],\n-                        connection.settings_dict['NAME'],\n-                    ), []).append(alias)\n+                item = test_databases.setdefault(\n+                    connection.creation.test_db_signature(),\n+                    (connection.settings_dict['NAME'], [])\n+                )\n+                item[1].append(alias)\n \n                 if 'TEST_DEPENDENCIES' in connection.settings_dict:\n                     dependencies[alias] = connection.settings_dict['TEST_DEPENDENCIES']\n@@ -292,7 +288,7 @@ def setup_databases(self, **kwargs):\n         # Second pass -- actually create the databases.\n         old_names = []\n         mirrors = []\n-        for (host, port, engine, db_name), aliases in dependency_ordered(test_databases.items(), dependencies):\n+        for signature, (db_name, aliases) in dependency_ordered(test_databases.items(), dependencies):\n             # Actually create the database for the first connection\n             connection = connections[aliases[0]]\n             old_names.append((connection, db_name, True))"
        },
        {
            "sha": "dfdd57498ce808892443bdea4ecb883e31f1768a",
            "filename": "tests/regressiontests/test_runner/tests.py",
            "status": "modified",
            "additions": 14,
            "deletions": 14,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/dc5f2607deb35022523fef17dcd8479ca812e887/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/dc5f2607deb35022523fef17dcd8479ca812e887/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_runner%2Ftests.py?ref=dc5f2607deb35022523fef17dcd8479ca812e887",
            "patch": "@@ -33,17 +33,17 @@ class DependencyOrderingTests(unittest.TestCase):\n \n     def test_simple_dependencies(self):\n         raw = [\n-            ('s1', ['alpha']),\n-            ('s2', ['bravo']),\n-            ('s3', ['charlie']),\n+            ('s1', ('s1_db', ['alpha'])),\n+            ('s2', ('s2_db', ['bravo'])),\n+            ('s3', ('s3_db', ['charlie'])),\n         ]\n         dependencies = {\n             'alpha': ['charlie'],\n             'bravo': ['charlie'],\n         }\n \n         ordered = simple.dependency_ordered(raw, dependencies=dependencies)\n-        ordered_sigs = [sig for sig,aliases in ordered]\n+        ordered_sigs = [sig for sig,value in ordered]\n \n         self.assertIn('s1', ordered_sigs)\n         self.assertIn('s2', ordered_sigs)\n@@ -53,17 +53,17 @@ def test_simple_dependencies(self):\n \n     def test_chained_dependencies(self):\n         raw = [\n-            ('s1', ['alpha']),\n-            ('s2', ['bravo']),\n-            ('s3', ['charlie']),\n+            ('s1', ('s1_db', ['alpha'])),\n+            ('s2', ('s2_db', ['bravo'])),\n+            ('s3', ('s3_db', ['charlie'])),\n         ]\n         dependencies = {\n             'alpha': ['bravo'],\n             'bravo': ['charlie'],\n         }\n \n         ordered = simple.dependency_ordered(raw, dependencies=dependencies)\n-        ordered_sigs = [sig for sig,aliases in ordered]\n+        ordered_sigs = [sig for sig,value in ordered]\n \n         self.assertIn('s1', ordered_sigs)\n         self.assertIn('s2', ordered_sigs)\n@@ -78,10 +78,10 @@ def test_chained_dependencies(self):\n \n     def test_multiple_dependencies(self):\n         raw = [\n-            ('s1', ['alpha']),\n-            ('s2', ['bravo']),\n-            ('s3', ['charlie']),\n-            ('s4', ['delta']),\n+            ('s1', ('s1_db', ['alpha'])),\n+            ('s2', ('s2_db', ['bravo'])),\n+            ('s3', ('s3_db', ['charlie'])),\n+            ('s4', ('s4_db', ['delta'])),\n         ]\n         dependencies = {\n             'alpha': ['bravo','delta'],\n@@ -108,8 +108,8 @@ def test_multiple_dependencies(self):\n \n     def test_circular_dependencies(self):\n         raw = [\n-            ('s1', ['alpha']),\n-            ('s2', ['bravo']),\n+            ('s1', ('s1_db', ['alpha'])),\n+            ('s2', ('s2_db', ['bravo'])),\n         ]\n         dependencies = {\n             'bravo': ['alpha'],"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 47,
        "deletions": 27
    }
}