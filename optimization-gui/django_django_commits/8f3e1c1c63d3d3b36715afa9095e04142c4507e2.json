{
    "author": "jezdez",
    "message": "Fixed #6392 -- Made django.contrib.humanize template tags locale aware. Thanks, Dave McLain.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16168 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
    "files": [
        {
            "sha": "1639f6ecbd0facb15b53fe959e901169a45bd439",
            "filename": "django/contrib/humanize/locale/de/LC_MESSAGES/django.mo",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.mo?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2"
        },
        {
            "sha": "8a7843bbc8b45a2d7a161ea3ce247b2d450ff9e1",
            "filename": "django/contrib/humanize/locale/de/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 68,
            "deletions": 20,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Flocale%2Fde%2FLC_MESSAGES%2Fdjango.po?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2011-03-15 13:18-0400\\n\"\n+\"POT-Creation-Date: 2011-05-06 14:14+0200\\n\"\n \"PO-Revision-Date: 2011-03-04 18:39+0000\\n\"\n \"Last-Translator: Jannis <jannis@leidel.info>\\n\"\n \"Language-Team: German <>\\n\"\n@@ -14,87 +14,135 @@ msgstr \"\"\n \"Language: de\\n\"\n \"Plural-Forms: nplurals=2; plural=(n != 1)\\n\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"th\"\n msgstr \".\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"st\"\n msgstr \".\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"nd\"\n msgstr \".\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"rd\"\n msgstr \".\"\n \n-#: templatetags/humanize.py:54\n+#: templatetags/humanize.py:68\n #, python-format\n msgid \"%(value).1f million\"\n msgid_plural \"%(value).1f million\"\n msgstr[0] \"%(value).1f Million\"\n msgstr[1] \"%(value).1f Millionen\"\n \n-#: templatetags/humanize.py:57\n+#: templatetags/humanize.py:69\n+#, python-format\n+msgid \"%(value)s million\"\n+msgid_plural \"%(value)s million\"\n+msgstr[0] \"%(value)s Million\"\n+msgstr[1] \"%(value)s Millionen\"\n+\n+#: templatetags/humanize.py:74\n #, python-format\n msgid \"%(value).1f billion\"\n msgid_plural \"%(value).1f billion\"\n msgstr[0] \"%(value).1f Milliarde\"\n msgstr[1] \"%(value).1f Milliarden\"\n \n-#: templatetags/humanize.py:60\n+#: templatetags/humanize.py:75\n+#, python-format\n+msgid \"%(value)s billion\"\n+msgid_plural \"%(value)s billion\"\n+msgstr[0] \"%(value)s Milliarde\"\n+msgstr[1] \"%(value)s Milliarden\"\n+\n+#: templatetags/humanize.py:80\n #, python-format\n msgid \"%(value).1f trillion\"\n msgid_plural \"%(value).1f trillion\"\n msgstr[0] \"%(value).1f Billion\"\n msgstr[1] \"%(value).1f Billionen\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:81\n+#, python-format\n+msgid \"%(value)s trillion\"\n+msgid_plural \"%(value)s trillion\"\n+msgstr[0] \"%(value)s Billion\"\n+msgstr[1] \"%(value)s Billionen\"\n+\n+#: templatetags/humanize.py:98\n msgid \"one\"\n msgstr \"ein\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"two\"\n msgstr \"zwei\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"three\"\n msgstr \"drei\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"four\"\n msgstr \"vier\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"five\"\n msgstr \"f√ºnf\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"six\"\n msgstr \"sechs\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"seven\"\n msgstr \"sieben\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"eight\"\n msgstr \"acht\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"nine\"\n msgstr \"neun\"\n \n-#: templatetags/humanize.py:96\n+#: templatetags/humanize.py:121\n msgid \"today\"\n msgstr \"heute\"\n \n-#: templatetags/humanize.py:98\n+#: templatetags/humanize.py:123\n msgid \"tomorrow\"\n msgstr \"morgen\"\n \n-#: templatetags/humanize.py:100\n+#: templatetags/humanize.py:125\n msgid \"yesterday\"\n msgstr \"gestern\"\n+\n+#: templatetags/humanize.py:147\n+msgid \"now\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:149\n+#, python-format\n+msgid \"%s seconds ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:151\n+msgid \"a minute ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:153\n+#, python-format\n+msgid \"%s minutes ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:155\n+msgid \"an hour ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:157\n+#, python-format\n+msgid \"%s hours ago\"\n+msgstr \"\""
        },
        {
            "sha": "713f7705202fec987482ffecc6036dda5aa6f411",
            "filename": "django/contrib/humanize/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 68,
            "deletions": 20,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
            "patch": "@@ -4,95 +4,143 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2011-03-15 13:18-0400\\n\"\n+\"POT-Creation-Date: 2011-05-06 14:14+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n \"MIME-Version: 1.0\\n\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"th\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"st\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"nd\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:19\n+#: templatetags/humanize.py:21\n msgid \"rd\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:54\n+#: templatetags/humanize.py:68\n #, python-format\n msgid \"%(value).1f million\"\n msgid_plural \"%(value).1f million\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:57\n+#: templatetags/humanize.py:69\n+#, python-format\n+msgid \"%(value)s million\"\n+msgid_plural \"%(value)s million\"\n+msgstr[0] \"\"\n+msgstr[1] \"\"\n+\n+#: templatetags/humanize.py:74\n #, python-format\n msgid \"%(value).1f billion\"\n msgid_plural \"%(value).1f billion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:60\n+#: templatetags/humanize.py:75\n+#, python-format\n+msgid \"%(value)s billion\"\n+msgid_plural \"%(value)s billion\"\n+msgstr[0] \"\"\n+msgstr[1] \"\"\n+\n+#: templatetags/humanize.py:80\n #, python-format\n msgid \"%(value).1f trillion\"\n msgid_plural \"%(value).1f trillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:81\n+#, python-format\n+msgid \"%(value)s trillion\"\n+msgid_plural \"%(value)s trillion\"\n+msgstr[0] \"\"\n+msgstr[1] \"\"\n+\n+#: templatetags/humanize.py:98\n msgid \"one\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"two\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"three\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"four\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"five\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"six\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"seven\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"eight\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:76\n+#: templatetags/humanize.py:98\n msgid \"nine\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:96\n+#: templatetags/humanize.py:121\n msgid \"today\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:98\n+#: templatetags/humanize.py:123\n msgid \"tomorrow\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:100\n+#: templatetags/humanize.py:125\n msgid \"yesterday\"\n msgstr \"\"\n+\n+#: templatetags/humanize.py:147\n+msgid \"now\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:149\n+#, python-format\n+msgid \"%s seconds ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:151\n+msgid \"a minute ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:153\n+#, python-format\n+msgid \"%s minutes ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:155\n+msgid \"an hour ago\"\n+msgstr \"\"\n+\n+#: templatetags/humanize.py:157\n+#, python-format\n+msgid \"%s hours ago\"\n+msgstr \"\""
        },
        {
            "sha": "a71114506419d352a957679ee2a66a6cc9f08971",
            "filename": "django/contrib/humanize/templatetags/humanize.py",
            "status": "modified",
            "additions": 33,
            "deletions": 5,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
            "patch": "@@ -1,7 +1,9 @@\n from django.utils.translation import ungettext, ugettext as _\n from django.utils.encoding import force_unicode\n+from django.utils.formats import number_format\n from django import template\n from django.template import defaultfilters\n+from django.conf import settings\n from datetime import date, datetime\n import re\n \n@@ -23,17 +25,25 @@ def ordinal(value):\n ordinal.is_safe = True\n register.filter(ordinal)\n \n-def intcomma(value):\n+def intcomma(value, use_l10n=True):\n     \"\"\"\n     Converts an integer to a string containing commas every three digits.\n     For example, 3000 becomes '3,000' and 45000 becomes '45,000'.\n     \"\"\"\n+    if settings.USE_L10N and use_l10n:\n+        try:\n+            if not isinstance(value, float):\n+                value = int(value)\n+        except (TypeError, ValueError):\n+            return intcomma(value, False)\n+        else:\n+            return number_format(value)\n     orig = force_unicode(value)\n     new = re.sub(\"^(-?\\d+)(\\d{3})\", '\\g<1>,\\g<2>', orig)\n     if orig == new:\n         return new\n     else:\n-        return intcomma(new)\n+        return intcomma(new, use_l10n)\n intcomma.is_safe = True\n register.filter(intcomma)\n \n@@ -49,15 +59,33 @@ def intword(value):\n         return value\n     if value < 1000000:\n         return value\n+\n+    def _check_for_i18n(value, float_formatted, string_formatted):\n+        \"\"\"\n+        Use the i18n enabled defaultfilters.floatformat if possible\n+        \"\"\"\n+        if settings.USE_L10N:\n+            return defaultfilters.floatformat(value, 1), string_formatted\n+        return value, float_formatted\n+\n     if value < 1000000000:\n         new_value = value / 1000000.0\n-        return ungettext('%(value).1f million', '%(value).1f million', new_value) % {'value': new_value}\n+        new_value, value_string = _check_for_i18n(new_value,\n+            ungettext('%(value).1f million', '%(value).1f million', new_value),\n+            ungettext('%(value)s million', '%(value)s million', new_value))\n+        return value_string % {'value': new_value}\n     if value < 1000000000000:\n         new_value = value / 1000000000.0\n-        return ungettext('%(value).1f billion', '%(value).1f billion', new_value) % {'value': new_value}\n+        new_value, value_string = _check_for_i18n(new_value,\n+            ungettext('%(value).1f billion', '%(value).1f billion', new_value),\n+            ungettext('%(value)s billion', '%(value)s billion', new_value))\n+        return value_string % {'value': new_value}\n     if value < 1000000000000000:\n         new_value = value / 1000000000000.0\n-        return ungettext('%(value).1f trillion', '%(value).1f trillion', new_value) % {'value': new_value}\n+        new_value, value_string = _check_for_i18n(new_value,\n+            ungettext('%(value).1f trillion', '%(value).1f trillion', new_value),\n+            ungettext('%(value)s trillion', '%(value)s trillion', new_value))\n+        return value_string % {'value': new_value}\n     return value\n intword.is_safe = False\n register.filter(intword)"
        },
        {
            "sha": "aab6ff31b95e02b8fc06f23ec07384939373508a",
            "filename": "docs/ref/contrib/humanize.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/docs%2Fref%2Fcontrib%2Fhumanize.txt",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/docs%2Fref%2Fcontrib%2Fhumanize.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fhumanize.txt?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
            "patch": "@@ -43,6 +43,12 @@ Examples:\n     * ``450000`` becomes ``450,000``.\n     * ``4500000`` becomes ``4,500,000``.\n \n+:ref:`Format localization <format-localization>` will be respected if enabled,\n+e.g. with the ``'de'`` language:\n+\n+    * ``45000`` becomes ``'45.000'``.\n+    * ``450000`` becomes ``'450.000'``.\n+\n You can pass in either an integer or a string representation of an integer.\n \n .. templatefilter:: intword\n@@ -61,6 +67,13 @@ Examples:\n \n Values up to 1000000000000000 (one quadrillion) are supported.\n \n+:ref:`Format localization <format-localization>` will be respected if enabled,\n+e.g. with the ``'de'`` language:\n+\n+    * ``1000000`` becomes ``'1,0 Million'``.\n+    * ``1200000`` becomes ``'1,2 Million'``.\n+    * ``1200000000`` becomes ``'1,2 Milliarden'``.\n+\n You can pass in either an integer or a string representation of an integer.\n \n .. templatefilter:: naturalday"
        },
        {
            "sha": "b1f43bb90b07a7c39b03cdf1560e2e8841737759",
            "filename": "tests/regressiontests/humanize/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 4,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/tests%2Fregressiontests%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/tests%2Fregressiontests%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhumanize%2Ftests.py?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
            "patch": "@@ -1,10 +1,13 @@\n from datetime import timedelta, date, datetime, tzinfo, timedelta\n \n+from django.conf import settings\n from django.template import Template, Context, add_to_builtins\n-from django.utils import unittest\n+from django.test import TestCase\n+from django.utils import translation\n from django.utils.dateformat import DateFormat\n from django.utils.translation import ugettext as _\n from django.utils.html import escape\n+from django.conf import settings\n \n add_to_builtins('django.contrib.humanize.templatetags.humanize')\n \n@@ -26,7 +29,7 @@ def dst(self, dt):\n         return timedelta(0)\n \n \n-class HumanizeTests(unittest.TestCase):\n+class HumanizeTests(TestCase):\n \n     def humanize_tester(self, test_list, result_list, method):\n         # Using max below ensures we go through both lists\n@@ -60,14 +63,31 @@ def test_intcomma(self):\n \n     def test_intword(self):\n         test_list = ('100', '1000000', '1200000', '1290000',\n-                     '1000000000','2000000000','6000000000000',\n+                     '1000000000', '2000000000', '6000000000000',\n                      None)\n         result_list = ('100', '1.0 million', '1.2 million', '1.3 million',\n                        '1.0 billion', '2.0 billion', '6.0 trillion',\n                        None)\n-\n         self.humanize_tester(test_list, result_list, 'intword')\n \n+    def test_i18n_intcomma(self):\n+        test_list = (100, 1000, 10123, 10311, 1000000, 1234567.25,\n+                     '100', '1000', '10123', '10311', '1000000', None)\n+        result_list = ('100', '1.000', '10.123', '10.311', '1.000.000', '1.234.567,25',\n+                       '100', '1.000', '10.123', '10.311', '1.000.000', None)\n+        with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True):\n+            with translation.override('de'):\n+                self.humanize_tester(test_list, result_list, 'intcomma')\n+\n+    def test_i18n_intword(self):\n+        test_list = ('100', '1000000', '1200000', '1290000',\n+                     '1000000000','2000000000','6000000000000')\n+        result_list = ('100', '1,0 Million', '1,2 Millionen', '1,3 Millionen',\n+                       '1,0 Milliarde', '2,0 Milliarden', '6,0 Billionen')\n+        with self.settings(USE_L10N=True, USE_THOUSAND_SEPARATOR=True):\n+            with translation.override('de'):\n+                self.humanize_tester(test_list, result_list, 'intword')\n+\n     def test_apnumber(self):\n         test_list = [str(x) for x in range(1, 11)]\n         test_list.append(None)"
        },
        {
            "sha": "4253b05f2e6434ded286d7c78cab835897999aa1",
            "filename": "tests/runtests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/tests%2Fruntests.py",
            "raw_url": "https://github.com/django/django/raw/8f3e1c1c63d3d3b36715afa9095e04142c4507e2/tests%2Fruntests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fruntests.py?ref=8f3e1c1c63d3d3b36715afa9095e04142c4507e2",
            "patch": "@@ -28,6 +28,7 @@\n     'django.contrib.admin',\n     'django.contrib.admindocs',\n     'django.contrib.staticfiles',\n+    'django.contrib.humanize',\n ]\n \n def geodjango(settings):"
        }
    ],
    "stats": {
        "total": 256,
        "additions": 207,
        "deletions": 49
    }
}