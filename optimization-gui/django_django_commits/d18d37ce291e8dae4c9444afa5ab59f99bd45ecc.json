{
    "author": "jezdez",
    "message": "Added our own rmtree error handler to make sure we can delete correctly delete .svn directories when running the tests on Windows which are read-only for some reason.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15120 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d18d37ce291e8dae4c9444afa5ab59f99bd45ecc",
    "files": [
        {
            "sha": "706268a74d2a8080c140f345b90b74f68444e060",
            "filename": "django/utils/_os.py",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/d18d37ce291e8dae4c9444afa5ab59f99bd45ecc/django%2Futils%2F_os.py",
            "raw_url": "https://github.com/django/django/raw/d18d37ce291e8dae4c9444afa5ab59f99bd45ecc/django%2Futils%2F_os.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2F_os.py?ref=d18d37ce291e8dae4c9444afa5ab59f99bd45ecc",
            "patch": "@@ -44,3 +44,23 @@ def safe_join(base, *paths):\n         raise ValueError('The joined path (%s) is located outside of the base '\n                          'path component (%s)' % (final_path, base_path))\n     return final_path\n+\n+def rmtree_errorhandler(func, path, exc_info):\n+    \"\"\"\n+    On Windows, some files are read-only (e.g. in in .svn dirs), so when\n+    rmtree() tries to remove them, an exception is thrown.\n+    We catch that here, remove the read-only attribute, and hopefully\n+    continue without problems.\n+    \"\"\"\n+    exctype, value = exc_info[:2]\n+    # lookin for a windows error\n+    if exctype is not WindowsError or 'Access is denied' not in str(value):\n+        raise\n+    # file type should currently be read only\n+    if ((os.stat(path).st_mode & stat.S_IREAD) != stat.S_IREAD):\n+        raise\n+    # convert to read/write\n+    os.chmod(path, stat.S_IWRITE)\n+    # use the original function to repeat the operation\n+    func(path)\n+"
        },
        {
            "sha": "cf532bb414d8b072730cac0a4cc22263bafb3a92",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/d18d37ce291e8dae4c9444afa5ab59f99bd45ecc/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d18d37ce291e8dae4c9444afa5ab59f99bd45ecc/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=d18d37ce291e8dae4c9444afa5ab59f99bd45ecc",
            "patch": "@@ -13,6 +13,7 @@\n from django.db.models.loading import load_app\n from django.template import Template, Context\n from django.test import TestCase\n+from django.utils._os import rmtree_errorhandler\n \n \n TEST_ROOT = os.path.normcase(os.path.dirname(__file__))\n@@ -97,7 +98,9 @@ def setUp(self):\n         self.run_collectstatic()\n \n     def tearDown(self):\n-        shutil.rmtree(settings.STATIC_ROOT)\n+        # Use our own error handler that can handle .svn dirs on Windows\n+        shutil.rmtree(settings.STATIC_ROOT, ignore_errors=True,\n+                      onerror=rmtree_errorhandler)\n         settings.STATIC_ROOT = self.old_root\n         super(BuildStaticTestCase, self).tearDown()\n "
        }
    ],
    "stats": {
        "total": 25,
        "additions": 24,
        "deletions": 1
    }
}