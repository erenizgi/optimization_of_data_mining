{
    "author": "freakboy3742",
    "message": "Fixed #15247 -- Ensured that if a SingleObject view defines get_object but not get_queryset, the ModelFormMixin doesn't fail. Thanks to Sergey N. Belinsky for the report and test case.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15540 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "64b042bb3c017e327edc326ce370a16a910ea4a6",
    "files": [
        {
            "sha": "ff87f7bd14b738a6196c5ea75afb72beedc4b9f0",
            "filename": "django/views/generic/edit.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/64b042bb3c017e327edc326ce370a16a910ea4a6/django%2Fviews%2Fgeneric%2Fedit.py",
            "raw_url": "https://github.com/django/django/raw/64b042bb3c017e327edc326ce370a16a910ea4a6/django%2Fviews%2Fgeneric%2Fedit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fedit.py?ref=64b042bb3c017e327edc326ce370a16a910ea4a6",
            "patch": "@@ -75,7 +75,17 @@ def get_form_class(self):\n         if self.form_class:\n             return self.form_class\n         else:\n-            model = self.get_queryset().model\n+            if self.model is not None:\n+                # If a model has been explicitly provided, use it\n+                model = self.model\n+            elif hasattr(self, 'object') and self.object is not None:\n+                # If this view is operating on a single object, use\n+                # the class of that object\n+                model = self.object.__class__\n+            else:\n+                # Try to get a queryset and extract the model class\n+                # from that\n+                model = self.get_queryset().model\n             return model_forms.modelform_factory(model)\n \n     def get_form_kwargs(self):"
        },
        {
            "sha": "923578d9d9e6520f03a4927366bc50acf52c1e8c",
            "filename": "tests/regressiontests/generic_views/edit.py",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/64b042bb3c017e327edc326ce370a16a910ea4a6/tests%2Fregressiontests%2Fgeneric_views%2Fedit.py",
            "raw_url": "https://github.com/django/django/raw/64b042bb3c017e327edc326ce370a16a910ea4a6/tests%2Fregressiontests%2Fgeneric_views%2Fedit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fedit.py?ref=64b042bb3c017e327edc326ce370a16a910ea4a6",
            "patch": "@@ -201,6 +201,25 @@ def test_update_without_redirect(self):\n         except ImproperlyConfigured:\n             pass\n \n+    def test_update_get_object(self):\n+        a = Author.objects.create(\n+            name='Randall Munroe',\n+            slug='randall-munroe',\n+        )\n+        res = self.client.get('/edit/author/update/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertTrue(isinstance(res.context['form'], forms.ModelForm))\n+        self.assertEqual(res.context['object'], Author.objects.get(pk=a.pk))\n+        self.assertEqual(res.context['author'], Author.objects.get(pk=a.pk))\n+        self.assertTemplateUsed(res, 'generic_views/author_form.html')\n+\n+        # Modification with both POST and PUT (browser compatible)\n+        res = self.client.post('/edit/author/update/',\n+                        {'name': 'Randall Munroe (xkcd)', 'slug': 'randall-munroe'})\n+        self.assertEqual(res.status_code, 302)\n+        self.assertRedirects(res, 'http://testserver/list/authors/')\n+        self.assertQuerysetEqual(Author.objects.all(), ['<Author: Randall Munroe (xkcd)>'])\n+\n class DeleteViewTests(TestCase):\n     urls = 'regressiontests.generic_views.urls'\n "
        },
        {
            "sha": "c06b5d8a23c4b4de458d0ae65cf7b0585a062b4c",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/64b042bb3c017e327edc326ce370a16a910ea4a6/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/64b042bb3c017e327edc326ce370a16a910ea4a6/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=64b042bb3c017e327edc326ce370a16a910ea4a6",
            "patch": "@@ -74,6 +74,8 @@\n         views.NaiveAuthorUpdate.as_view(success_url='/edit/author/%(id)d/update/')),\n     (r'^edit/author/(?P<pk>\\d+)/update/$',\n         views.AuthorUpdate.as_view()),\n+    (r'^edit/author/update/$',\n+        views.OneAuthorUpdate.as_view()),\n     (r'^edit/author/(?P<pk>\\d+)/update/special/$',\n         views.SpecializedAuthorUpdate.as_view()),\n     (r'^edit/author/(?P<pk>\\d+)/delete/naive/$',"
        },
        {
            "sha": "9d2770cc5bb09a2890e2c607f84e79d77edfbb49",
            "filename": "tests/regressiontests/generic_views/views.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/64b042bb3c017e327edc326ce370a16a910ea4a6/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/64b042bb3c017e327edc326ce370a16a910ea4a6/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py?ref=64b042bb3c017e327edc326ce370a16a910ea4a6",
            "patch": "@@ -114,6 +114,13 @@ class AuthorUpdate(generic.UpdateView):\n     success_url = '/list/authors/'\n \n \n+class OneAuthorUpdate(generic.UpdateView):\n+    success_url = '/list/authors/'\n+\n+    def get_object(self):\n+        return Author.objects.get(pk=1)\n+\n+\n class SpecializedAuthorUpdate(generic.UpdateView):\n     model = Author\n     form_class = AuthorForm"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 39,
        "deletions": 1
    }
}