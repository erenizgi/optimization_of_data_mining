{
    "author": "spookylukey",
    "message": "Fixed our SimpleCookie overriding and use to be compatible with a (potential) stdlib SimpleCookie that fixes http://bugs.python.org/issue2193\n\nThe previous code tested the stdlib in a way that would always fail. It then\nused an overridden SimpleCookie.load method that wouldn't work for the\nstdlib. And it did some completely unnecessary monkey patching.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16485 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "89e0e8b6bc861bb95e55bd5e255e756fe3be1cf2",
    "files": [
        {
            "sha": "9704eafb19512965ad2e0ecc7f3cab12968fd972",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/89e0e8b6bc861bb95e55bd5e255e756fe3be1cf2/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/89e0e8b6bc861bb95e55bd5e255e756fe3be1cf2/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=89e0e8b6bc861bb95e55bd5e255e756fe3be1cf2",
            "patch": "@@ -28,8 +28,11 @@\n _cookie_encodes_correctly = Cookie.SimpleCookie().value_encode(';') == (';', '\"\\\\073\"')\n # See ticket #13007, http://bugs.python.org/issue2193 and http://trac.edgewall.org/ticket/2256\n _tc = Cookie.SimpleCookie()\n-_tc.load('f:oo')\n-_cookie_allows_colon_in_names = 'Set-Cookie: f:oo=' in _tc.output()\n+try:\n+    _tc.load('foo:bar=1')\n+    _cookie_allows_colon_in_names = True\n+except Cookie.CookieError:\n+    _cookie_allows_colon_in_names = False\n \n if _morsel_supports_httponly and _cookie_encodes_correctly and _cookie_allows_colon_in_names:\n     SimpleCookie = Cookie.SimpleCookie\n@@ -89,19 +92,16 @@ def value_encode(self, val):\n                 return val, encoded\n \n         if not _cookie_allows_colon_in_names:\n-            def load(self, rawdata, ignore_parse_errors=False):\n-                if ignore_parse_errors:\n-                    self.bad_cookies = set()\n-                    self._BaseCookie__set = self._loose_set\n+            def load(self, rawdata):\n+                self.bad_cookies = set()\n                 super(SimpleCookie, self).load(rawdata)\n-                if ignore_parse_errors:\n-                    self._BaseCookie__set = self._strict_set\n-                    for key in self.bad_cookies:\n-                        del self[key]\n+                for key in self.bad_cookies:\n+                    del self[key]\n \n             _strict_set = Cookie.BaseCookie._BaseCookie__set\n \n-            def _loose_set(self, key, real_value, coded_value):\n+            # override private __set() method:\n+            def _BaseCookie__set(self, key, real_value, coded_value):\n                 try:\n                     self._strict_set(key, real_value, coded_value)\n                 except Cookie.CookieError:\n@@ -519,7 +519,7 @@ def parse_cookie(cookie):\n     if not isinstance(cookie, Cookie.BaseCookie):\n         try:\n             c = SimpleCookie()\n-            c.load(cookie, ignore_parse_errors=True)\n+            c.load(cookie)\n         except Cookie.CookieError:\n             # Invalid cookie\n             return {}"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}