{
    "author": "alex",
    "message": "Fixed #14871, #14872 -- ZAIDField didn't handle alll EMPTY_VALUES correctly and ZAPostCodeField didn't respect *args or **kwargs (such as required=False).  Also converted South African localflavor doctests into unittests.  We have always been at war with doctests.  Thanks to Idan Gazit.\n\nFixing ZA localflavor clean() #14872\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14956 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "bc27405fc563acaaef08f47662e6597e9e1751a0",
    "files": [
        {
            "sha": "4fb4203e455a8e022e9119d696fe1e1e70fd8b9c",
            "filename": "django/contrib/localflavor/za/forms.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/bc27405fc563acaaef08f47662e6597e9e1751a0/django%2Fcontrib%2Flocalflavor%2Fza%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/bc27405fc563acaaef08f47662e6597e9e1751a0/django%2Fcontrib%2Flocalflavor%2Fza%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fza%2Fforms.py?ref=bc27405fc563acaaef08f47662e6597e9e1751a0",
            "patch": "@@ -22,14 +22,14 @@ class ZAIDField(Field):\n     }\n \n     def clean(self, value):\n-        # strip spaces and dashes\n-        value = value.strip().replace(' ', '').replace('-', '')\n-\n         super(ZAIDField, self).clean(value)\n \n         if value in EMPTY_VALUES:\n             return u''\n \n+        # strip spaces and dashes\n+        value = value.strip().replace(' ', '').replace('-', '')\n+\n         match = re.match(id_re, value)\n \n         if not match:\n@@ -57,4 +57,4 @@ class ZAPostCodeField(RegexField):\n \n     def __init__(self, *args, **kwargs):\n         super(ZAPostCodeField, self).__init__(r'^\\d{4}$',\n-            max_length=None, min_length=None)\n+            max_length=None, min_length=None, *args, **kwargs)"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/forms/localflavor/__init__.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Flocalflavor%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Flocalflavor%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2F__init__.py?ref=bc27405fc563acaaef08f47662e6597e9e1751a0",
            "patch": "@@ -1 +0,0 @@\n-# -*- coding: utf-8 -*-"
        },
        {
            "sha": "c9124212202fe2fd4c75631f2b93add5edd0721c",
            "filename": "tests/regressiontests/forms/localflavor/za.py",
            "status": "modified",
            "additions": 26,
            "deletions": 37,
            "changes": 63,
            "blob_url": "https://github.com/django/django/blob/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fza.py",
            "raw_url": "https://github.com/django/django/raw/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fza.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fza.py?ref=bc27405fc563acaaef08f47662e6597e9e1751a0",
            "patch": "@@ -1,40 +1,29 @@\n-tests = r\"\"\"\n-# ZAIDField #################################################################\n+from django.contrib.localflavor.za.forms import ZAIDField, ZAPostCodeField\n \n-ZAIDField validates that the date is a valid birthdate and that the value\n-has a valid checksum. It allows spaces and dashes, and returns a plain \n-string of digits.\n->>> from django.contrib.localflavor.za.forms import ZAIDField\n->>> f = ZAIDField()\n->>> f.clean('0002290001003')\n-'0002290001003'\n->>> f.clean('000229 0001 003')\n-'0002290001003'\n->>> f.clean('0102290001001')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid South African ID number']\n->>> f.clean('811208')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid South African ID number']\n->>> f.clean('0002290001004')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid South African ID number']\n+from utils import LocalFlavorTestCase\n \n-# ZAPostCodeField ###########################################################\n->>> from django.contrib.localflavor.za.forms import ZAPostCodeField\n->>> f = ZAPostCodeField()\n->>> f.clean('abcd')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid South African postal code']\n->>> f.clean('0000')\n-u'0000'\n->>> f.clean(' 7530')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid South African postal code']\n \n-\"\"\"\n+class ZALocalFlavorTests(LocalFlavorTestCase):\n+    def test_ZAIDField(self):\n+        error_invalid = [u'Enter a valid South African ID number']\n+        valid = {\n+            '0002290001003': '0002290001003',\n+            '000229 0001 003': '0002290001003',\n+        }\n+        invalid = {\n+            '0102290001001': error_invalid,\n+            '811208': error_invalid,\n+            '0002290001004': error_invalid,\n+        }\n+        self.assertFieldOutput(ZAIDField, valid, invalid)\n+\n+    def test_ZAPostCodeField(self):\n+        error_invalid = [u'Enter a valid South African postal code']\n+        valid = {\n+            '0000': '0000',\n+        }\n+        invalid = {\n+            'abcd': error_invalid,\n+            ' 7530': error_invalid,\n+        }\n+        self.assertFieldOutput(ZAPostCodeField, valid, invalid)"
        },
        {
            "sha": "66059383d399689cd0cabee5ed16494b4963c704",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=bc27405fc563acaaef08f47662e6597e9e1751a0",
            "patch": "@@ -1,7 +1,5 @@\n-# -*- coding: utf-8 -*-\n from localflavor.cz import tests as localflavor_cz_tests\n from localflavor.se import tests as localflavor_se_tests\n-from localflavor.za import tests as localflavor_za_tests\n \n from localflavor.ar import ARLocalFlavorTests\n from localflavor.at import ATLocalFlavorTests\n@@ -32,10 +30,10 @@\n from localflavor.uk import UKLocalFlavorTests\n from localflavor.us import USLocalFlavorTests\n from localflavor.uy import UYLocalFlavorTests\n+from localflavor.za import ZALocalFlavorTests\n \n \n __test__ = {\n     'localflavor_cz_tests': localflavor_cz_tests,\n     'localflavor_se_tests': localflavor_se_tests,\n-    'localflavor_za_tests': localflavor_za_tests,\n }"
        },
        {
            "sha": "ba34c164f3fce761a729a419077124d5c86368a4",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/bc27405fc563acaaef08f47662e6597e9e1751a0/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=bc27405fc563acaaef08f47662e6597e9e1751a0",
            "patch": "@@ -42,4 +42,5 @@\n     UKLocalFlavorTests,\n     USLocalFlavorTests,\n     UYLocalFlavorTests,\n+    ZALocalFlavorTests,\n )"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 32,
        "deletions": 45
    }
}