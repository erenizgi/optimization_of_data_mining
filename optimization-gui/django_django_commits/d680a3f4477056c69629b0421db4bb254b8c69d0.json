{
    "author": "claudep",
    "message": "Added support for serializing BinaryField",
    "sha": "d680a3f4477056c69629b0421db4bb254b8c69d0",
    "files": [
        {
            "sha": "f8ec205611baf39b75780492770efc27c55b18e4",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/d680a3f4477056c69629b0421db4bb254b8c69d0/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/d680a3f4477056c69629b0421db4bb254b8c69d0/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=d680a3f4477056c69629b0421db4bb254b8c69d0",
            "patch": "@@ -6,6 +6,7 @@\n import decimal\n import math\n import warnings\n+from base64 import b64decode, b64encode\n from itertools import tee\n \n from django.db import connection\n@@ -19,7 +20,7 @@\n from django.utils.text import capfirst\n from django.utils import timezone\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_text, force_text\n+from django.utils.encoding import smart_text, force_text, force_bytes\n from django.utils.ipv6 import clean_ipv6_address\n from django.utils import six\n \n@@ -1318,3 +1319,13 @@ def get_db_prep_value(self, value, connection, prepared=False):\n         if value is not None:\n             return connection.Database.Binary(value)\n         return value\n+\n+    def value_to_string(self, obj):\n+        \"\"\"Binary data is serialized as base64\"\"\"\n+        return b64encode(force_bytes(self._get_val_from_obj(obj))).decode('ascii')\n+\n+    def to_python(self, value):\n+        # If it's a string, it should be base64-encoded data\n+        if isinstance(value, six.text_type):\n+            return six.memoryview(b64decode(force_bytes(value)))\n+        return value"
        },
        {
            "sha": "607b48277abc4c478ac10bb55c7d5e0b7735b8fb",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d680a3f4477056c69629b0421db4bb254b8c69d0/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/d680a3f4477056c69629b0421db4bb254b8c69d0/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=d680a3f4477056c69629b0421db4bb254b8c69d0",
            "patch": "@@ -142,6 +142,8 @@ def force_bytes(s, encoding='utf-8', strings_only=False, errors='strict'):\n \n     If strings_only is True, don't convert (some) non-string-like objects.\n     \"\"\"\n+    if isinstance(s, six.memoryview):\n+        s = bytes(s)\n     if isinstance(s, bytes):\n         if encoding == 'utf-8':\n             return s"
        },
        {
            "sha": "21fe073122687486f9a8389babdcc3133c8fe8ca",
            "filename": "tests/serializers_regress/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/d680a3f4477056c69629b0421db4bb254b8c69d0/tests%2Fserializers_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/d680a3f4477056c69629b0421db4bb254b8c69d0/tests%2Fserializers_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fserializers_regress%2Fmodels.py?ref=d680a3f4477056c69629b0421db4bb254b8c69d0",
            "patch": "@@ -12,6 +12,9 @@\n # The following classes are for testing basic data\n # marshalling, including NULL values, where allowed.\n \n+class BinaryData(models.Model):\n+    data = models.BinaryField(null=True)\n+\n class BooleanData(models.Model):\n     data = models.BooleanField()\n "
        },
        {
            "sha": "72e3825d9163dc3d8954c4225f7b3f901b2d660a",
            "filename": "tests/serializers_regress/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 7,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/d680a3f4477056c69629b0421db4bb254b8c69d0/tests%2Fserializers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d680a3f4477056c69629b0421db4bb254b8c69d0/tests%2Fserializers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fserializers_regress%2Ftests.py?ref=d680a3f4477056c69629b0421db4bb254b8c69d0",
            "patch": "@@ -24,10 +24,11 @@\n from django.http import HttpResponse\n from django.test import TestCase\n from django.utils import six\n+from django.utils.encoding import force_text\n from django.utils.functional import curry\n from django.utils.unittest import skipUnless\n \n-from .models import (BooleanData, CharData, DateData, DateTimeData, EmailData,\n+from .models import (BinaryData, BooleanData, CharData, DateData, DateTimeData, EmailData,\n     FileData, FilePathData, DecimalData, FloatData, IntegerData, IPAddressData,\n     GenericIPAddressData, NullBooleanData, PositiveIntegerData,\n     PositiveSmallIntegerData, SlugData, SmallData, TextData, TimeData,\n@@ -116,10 +117,17 @@ def inherited_create(pk, klass, data):\n # test data objects of various kinds\n def data_compare(testcase, pk, klass, data):\n     instance = klass.objects.get(id=pk)\n-    testcase.assertEqual(data, instance.data,\n-         \"Objects with PK=%d not equal; expected '%s' (%s), got '%s' (%s)\" % (\n-            pk, data, type(data), instance.data, type(instance.data))\n-    )\n+    if klass == BinaryData and data is not None:\n+        testcase.assertEqual(bytes(data), bytes(instance.data),\n+             \"Objects with PK=%d not equal; expected '%s' (%s), got '%s' (%s)\" % (\n+                pk, repr(bytes(data)), type(data), repr(bytes(instance.data)),\n+                type(instance.data))\n+        )\n+    else:\n+        testcase.assertEqual(data, instance.data,\n+             \"Objects with PK=%d not equal; expected '%s' (%s), got '%s' (%s)\" % (\n+                pk, data, type(data), instance, type(instance.data))\n+        )\n \n def generic_compare(testcase, pk, klass, data):\n     instance = klass.objects.get(id=pk)\n@@ -175,8 +183,10 @@ def inherited_compare(testcase, pk, klass, data):\n \n test_data = [\n     # Format: (data type, PK value, Model Class, data)\n-    (data_obj, 1, BooleanData, True),\n-    (data_obj, 2, BooleanData, False),\n+    (data_obj, 1, BinaryData, six.memoryview(b\"\\x05\\xFD\\x00\")),\n+    (data_obj, 2, BinaryData, None),\n+    (data_obj, 5, BooleanData, True),\n+    (data_obj, 6, BooleanData, False),\n     (data_obj, 10, CharData, \"Test Char Data\"),\n     (data_obj, 11, CharData, \"\"),\n     (data_obj, 12, CharData, \"None\"),"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 34,
        "deletions": 8
    }
}