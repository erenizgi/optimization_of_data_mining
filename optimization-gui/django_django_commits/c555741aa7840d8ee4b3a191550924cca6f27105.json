{
    "author": "jphalip",
    "message": "Fixed #18530 -- Fixed a small regression in the admin filters where wrongly formatted dates passed as url parameters caused an unhandled ValidationError. Thanks to david for the report.",
    "sha": "c555741aa7840d8ee4b3a191550924cca6f27105",
    "files": [
        {
            "sha": "0a34f807b3f14c84cca2e1f8c072bb111e2f2ba3",
            "filename": "django/contrib/admin/filters.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/c555741aa7840d8ee4b3a191550924cca6f27105/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "raw_url": "https://github.com/django/django/raw/c555741aa7840d8ee4b3a191550924cca6f27105/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ffilters.py?ref=c555741aa7840d8ee4b3a191550924cca6f27105",
            "patch": "@@ -8,13 +8,13 @@\n import datetime\n \n from django.db import models\n-from django.core.exceptions import ImproperlyConfigured\n+from django.core.exceptions import ImproperlyConfigured, ValidationError\n from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n-\n from django.contrib.admin.util import (get_model_from_relation,\n     reverse_field_path, get_limit_choices_to_from_path, prepare_lookup_value)\n+from django.contrib.admin.options import IncorrectLookupParameters\n \n class ListFilter(object):\n     title = None  # Human-readable title to appear in the right sidebar.\n@@ -129,7 +129,10 @@ def has_output(self):\n         return True\n \n     def queryset(self, request, queryset):\n-        return queryset.filter(**self.used_parameters)\n+        try:\n+            return queryset.filter(**self.used_parameters)\n+        except ValidationError as e:\n+            raise IncorrectLookupParameters(e)\n \n     @classmethod\n     def register(cls, test, list_filter_class, take_priority=False):"
        },
        {
            "sha": "a5476e9eb761723ce776238be1bc998ad130b374",
            "filename": "tests/regressiontests/admin_views/admin.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c555741aa7840d8ee4b3a191550924cca6f27105/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/c555741aa7840d8ee4b3a191550924cca6f27105/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py?ref=c555741aa7840d8ee4b3a191550924cca6f27105",
            "patch": "@@ -130,7 +130,7 @@ def changelist_view(self, request):\n \n \n class ThingAdmin(admin.ModelAdmin):\n-    list_filter = ('color__warm', 'color__value')\n+    list_filter = ('color__warm', 'color__value', 'pub_date',)\n \n \n class InquisitionAdmin(admin.ModelAdmin):"
        },
        {
            "sha": "2b143004d93dc06193534d1990ec6d77a159512c",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/c555741aa7840d8ee4b3a191550924cca6f27105/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/c555741aa7840d8ee4b3a191550924cca6f27105/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=c555741aa7840d8ee4b3a191550924cca6f27105",
            "patch": "@@ -128,6 +128,7 @@ class Meta:\n class Thing(models.Model):\n     title = models.CharField(max_length=20)\n     color = models.ForeignKey(Color, limit_choices_to={'warm': True})\n+    pub_date = models.DateField(blank=True, null=True)\n     def __str__(self):\n         return self.title\n "
        },
        {
            "sha": "36fea59f2ec6f48a0833be3ec126b51675c7712d",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/c555741aa7840d8ee4b3a191550924cca6f27105/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c555741aa7840d8ee4b3a191550924cca6f27105/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=c555741aa7840d8ee4b3a191550924cca6f27105",
            "patch": "@@ -436,6 +436,10 @@ def testIncorrectLookupParameters(self):\n         response = self.client.get('/test_admin/%s/admin_views/thing/' % self.urlbit, {'color__id__exact': 'StringNotInteger!'})\n         self.assertRedirects(response, '/test_admin/%s/admin_views/thing/?e=1' % self.urlbit)\n \n+        # Regression test for #18530\n+        response = self.client.get('/test_admin/%s/admin_views/thing/' % self.urlbit, {'pub_date__gte': 'foo'})\n+        self.assertRedirects(response, '/test_admin/%s/admin_views/thing/?e=1' % self.urlbit)\n+\n     def testIsNullLookups(self):\n         \"\"\"Ensure is_null is handled correctly.\"\"\"\n         Article.objects.create(title=\"I Could Go Anywhere\", content=\"Versatile\", date=datetime.datetime.now())"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 12,
        "deletions": 4
    }
}