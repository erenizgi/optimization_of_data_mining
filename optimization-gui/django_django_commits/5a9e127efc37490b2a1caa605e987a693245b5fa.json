{
    "author": "ramiro",
    "message": "Made model instance history admin view link not hard-coded. Refs #15294.",
    "sha": "5a9e127efc37490b2a1caa605e987a693245b5fa",
    "files": [
        {
            "sha": "e27875cdadf650844599aaa687b50a5cd5a207c1",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/5a9e127efc37490b2a1caa605e987a693245b5fa/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/5a9e127efc37490b2a1caa605e987a693245b5fa/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=5a9e127efc37490b2a1caa605e987a693245b5fa",
            "patch": "@@ -29,7 +29,7 @@\n {% if change %}{% if not is_popup %}\n   <ul class=\"object-tools\">\n     {% block object-tools-items %}\n-    <li><a href=\"history/\" class=\"historylink\">{% trans \"History\" %}</a></li>\n+    <li><a href=\"{% url opts|admin_urlname:'history' original.pk %}\" class=\"historylink\">{% trans \"History\" %}</a></li>\n     {% if has_absolute_url %}<li><a href=\"{% url 'admin:view_on_site' content_type_id original.pk %}\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n     {% endblock %}\n   </ul>"
        },
        {
            "sha": "a63cf8135c494d4dd36782e21699e31500f406ef",
            "filename": "tests/regressiontests/admin_custom_urls/fixtures/actions.json",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/5a9e127efc37490b2a1caa605e987a693245b5fa/tests%2Fregressiontests%2Fadmin_custom_urls%2Ffixtures%2Factions.json",
            "raw_url": "https://github.com/django/django/raw/5a9e127efc37490b2a1caa605e987a693245b5fa/tests%2Fregressiontests%2Fadmin_custom_urls%2Ffixtures%2Factions.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Ffixtures%2Factions.json?ref=5a9e127efc37490b2a1caa605e987a693245b5fa",
            "patch": "@@ -40,5 +40,12 @@\n     \"fields\": {\n       \"description\": \"An action with a name suspected of being a XSS attempt\"\n     }\n+  },\n+  {\n+    \"pk\": \"The name of an action\", \n+    \"model\": \"admin_custom_urls.action\", \n+    \"fields\": {\n+      \"description\": \"A generic action\"\n+    }\n   }\n-]\n\\ No newline at end of file\n+]"
        },
        {
            "sha": "64ff9f66928e8addd77eab7748901eca89360ac2",
            "filename": "tests/regressiontests/admin_custom_urls/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 9,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/5a9e127efc37490b2a1caa605e987a693245b5fa/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/5a9e127efc37490b2a1caa605e987a693245b5fa/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py?ref=5a9e127efc37490b2a1caa605e987a693245b5fa",
            "patch": "@@ -10,6 +10,12 @@\n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AdminCustomUrlsTest(TestCase):\n+    \"\"\"\n+    Remember that:\n+    * The Action model has a CharField PK.\n+    * The ModelAdmin for Action customizes the add_view URL, it's\n+      '<app name>/<model name>/!add/'\n+    \"\"\"\n     fixtures = ['users.json', 'actions.json']\n \n     def setUp(self):\n@@ -20,20 +26,24 @@ def tearDown(self):\n \n     def testBasicAddGet(self):\n         \"\"\"\n-        A smoke test to ensure GET on the add_view works.\n+        Ensure GET on the add_view works.\n         \"\"\"\n         response = self.client.get('/custom_urls/admin/admin_custom_urls/action/!add/')\n         self.assertIsInstance(response, TemplateResponse)\n         self.assertEqual(response.status_code, 200)\n \n     def testAddWithGETArgs(self):\n+        \"\"\"\n+        Ensure GET on the add_view plus specifying a field value in the query\n+        string works.\n+        \"\"\"\n         response = self.client.get('/custom_urls/admin/admin_custom_urls/action/!add/', {'name': 'My Action'})\n         self.assertEqual(response.status_code, 200)\n         self.assertContains(response, 'value=\"My Action\"')\n \n     def testBasicAddPost(self):\n         \"\"\"\n-        A smoke test to ensure POST on add_view works.\n+        Ensure POST on add_view works.\n         \"\"\"\n         post_data = {\n             '_popup': '1',\n@@ -47,8 +57,7 @@ def testBasicAddPost(self):\n \n     def testAdminUrlsNoClash(self):\n         \"\"\"\n-        Test that some admin URLs work correctly. The model has a CharField\n-        PK and the add_view URL has been customized.\n+        Test that some admin URLs work correctly.\n         \"\"\"\n         # Should get the change_view for model instance with PK 'add', not show\n         # the add_view\n@@ -57,17 +66,28 @@ def testAdminUrlsNoClash(self):\n         self.assertContains(response, 'Change action')\n \n         # Ditto, but use reverse() to build the URL\n-        path = reverse('admin:%s_action_change' % Action._meta.app_label,\n+        url = reverse('admin:%s_action_change' % Action._meta.app_label,\n                 args=('add',))\n-        response = self.client.get(path)\n+        response = self.client.get(url)\n         self.assertEqual(response.status_code, 200)\n         self.assertContains(response, 'Change action')\n \n         # Should correctly get the change_view for the model instance with the\n-        # funny-looking PK\n-        path = reverse('admin:%s_action_change' % Action._meta.app_label,\n+        # funny-looking PK (the one wth a 'path/to/html/document.html' value)\n+        url = reverse('admin:%s_action_change' % Action._meta.app_label,\n                 args=(\"path/to/html/document.html\",))\n-        response = self.client.get(path)\n+        response = self.client.get(url)\n         self.assertEqual(response.status_code, 200)\n         self.assertContains(response, 'Change action')\n         self.assertContains(response, 'value=\"path/to/html/document.html\"')\n+\n+    def testChangeViewHistoryButton(self):\n+        url = reverse('admin:%s_action_change' % Action._meta.app_label,\n+                args=('The name of an action',))\n+        response = self.client.get(url)\n+        self.assertEqual(response.status_code, 200)\n+        expected_link = reverse('admin:%s_action_history' %\n+                                Action._meta.app_label,\n+                                args=('The name of an action',))\n+        self.assertContains(response, '<a href=\"%s\" class=\"historylink\"' %\n+                            expected_link)"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 38,
        "deletions": 11
    }
}