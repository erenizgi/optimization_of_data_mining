{
    "author": "jezdez",
    "message": "Fixed #17515 -- Added ability to override the template of custom admin FilterSpec classes. Thanks, saxix and Julien Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17483 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
    "files": [
        {
            "sha": "550683bdd994b63500a6481a965c1e20fe1012da",
            "filename": "django/contrib/admin/filters.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ffilters.py?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -17,6 +17,7 @@\n \n class ListFilter(object):\n     title = None  # Human-readable title to appear in the right sidebar.\n+    template = 'admin/filter.html'\n \n     def __init__(self, request, params, model, model_admin):\n         # This dictionary will eventually contain the request's query string"
        },
        {
            "sha": "e778429e90d7011c8e2790a96094945d7d114b2d",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -13,7 +13,8 @@\n from django.utils.translation import ugettext as _\n from django.utils.encoding import smart_unicode, force_unicode\n from django.template import Library\n-\n+from django.template.loader import get_template\n+from django.template.context import Context\n \n register = Library()\n \n@@ -360,9 +361,14 @@ def search_form(cl):\n         'search_var': SEARCH_VAR\n     }\n \n-@register.inclusion_tag('admin/filter.html')\n+@register.simple_tag\n def admin_list_filter(cl, spec):\n-    return {'title': spec.title, 'choices' : list(spec.choices(cl))}\n+    tpl = get_template(spec.template)\n+    return tpl.render(Context({\n+        'title': spec.title,\n+        'choices' : list(spec.choices(cl)),\n+        'spec': spec,\n+    }))\n \n @register.inclusion_tag('admin/actions.html', takes_context=True)\n def admin_actions(context):"
        },
        {
            "sha": "c40ce892040046e0601aa74002ae39c859a7eb3a",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -697,8 +697,18 @@ subclass::\n \n       .. note::\n \n-          The ``FieldListFilter`` API is currently considered internal\n-          and prone to refactoring.\n+        The ``FieldListFilter`` API is currently considered internal and prone\n+        to refactoring.\n+\n+    .. versionadded:: 1.4\n+\n+    It is possible to specify a custom template for rendering a list filter::\n+\n+        class FilterWithCustomTemplate(SimpleListFilter):\n+            template = \"custom_template.html\"\n+\n+    See the default template provided by django (``admin/filter.html``) for\n+    a concrete example.\n \n .. attribute:: ModelAdmin.list_max_show_all\n "
        },
        {
            "sha": "62228663fe4d464d2e4a30caa537d58d8a6c4218",
            "filename": "tests/regressiontests/admin_views/admin.py",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -13,6 +13,7 @@\n from django.db import models\n from django.forms.models import BaseModelFormSet\n from django.http import HttpResponse\n+from django.contrib.admin import BooleanFieldListFilter\n \n from .models import (Article, Chapter, Account, Media, Child, Parent, Picture,\n     Widget, DooHickey, Grommet, Whatsit, FancyDoodad, Category, Link,\n@@ -25,7 +26,7 @@\n     CoverLetter, Story, OtherStory, Book, Promo, ChapterXtra1, Pizza, Topping,\n     Album, Question, Answer, ComplexSortedPerson, PrePopulatedPostLargeSlug,\n     AdminOrderedField, AdminOrderedModelMethod, AdminOrderedAdminMethod,\n-    AdminOrderedCallable, Report)\n+    AdminOrderedCallable, Report, Color2)\n \n \n def callable_year(dt_value):\n@@ -525,6 +526,12 @@ def get_urls(self):\n         )\n \n \n+class CustomTemplateBooleanFieldListFilter(BooleanFieldListFilter):\n+    template = 'custom_filter_template.html'\n+\n+class CustomTemplateFilterColorAdmin(admin.ModelAdmin):\n+    list_filter = (('warm', CustomTemplateBooleanFieldListFilter),)\n+\n site = admin.AdminSite(name=\"admin\")\n site.register(Article, ArticleAdmin)\n site.register(CustomArticle, CustomArticleAdmin)\n@@ -594,6 +601,7 @@ def get_urls(self):\n site.register(AdminOrderedModelMethod, AdminOrderedModelMethodAdmin)\n site.register(AdminOrderedAdminMethod, AdminOrderedAdminMethodAdmin)\n site.register(AdminOrderedCallable, AdminOrderedCallableAdmin)\n+site.register(Color2, CustomTemplateFilterColorAdmin)\n \n # Register core models we need in our tests\n from django.contrib.auth.models import User, Group"
        },
        {
            "sha": "7d58952b87b30a9a87647785183c64d6e8b857be",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -105,6 +105,10 @@ class Color(models.Model):\n     def __unicode__(self):\n         return self.value\n \n+# we replicate Color to register with another ModelAdmin\n+class Color2(Color):\n+    class Meta:\n+        proxy = True\n \n class Thing(models.Model):\n     title = models.CharField(max_length=20)"
        },
        {
            "sha": "e5c9a8e7d8b5ce4db68e772b9548effad5daba69",
            "filename": "tests/regressiontests/admin_views/templates/custom_filter_template.html",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Ftemplates%2Fcustom_filter_template.html",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Ftemplates%2Fcustom_filter_template.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftemplates%2Fcustom_filter_template.html?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -0,0 +1,7 @@\n+<h3>By {{ filter_title }} (custom)</h3>\n+<ul>\n+{% for choice in choices %}\n+    <li{% if choice.selected %} class=\"selected\"{% endif %}>\n+    <a href=\"{{ choice.query_string|iriencode }}\">{{ choice.display }}</a></li>\n+{% endfor %}\n+</ul>"
        },
        {
            "sha": "fa189203a24776f62086fdbd027cb31205c8899c",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4dbeb4bca4638ff851a2f4844d262dbe1652f7b5/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=4dbeb4bca4638ff851a2f4844d262dbe1652f7b5",
            "patch": "@@ -1,6 +1,7 @@\n # coding: utf-8\n from __future__ import with_statement, absolute_import\n \n+import os\n import re\n import datetime\n import urlparse\n@@ -593,6 +594,18 @@ def testChangeFormUrlHasCorrectValue(self):\n         self.assertTrue('form_url' in response.context, msg='form_url not present in response.context')\n         self.assertEqual(response.context['form_url'], 'pony')\n \n+    def test_filter_with_custom_template(self):\n+        \"\"\"\n+        Ensure that one can use a custom template to render an admin filter.\n+        Refs #17515.\n+        \"\"\"\n+        template_dirs = settings.TEMPLATE_DIRS + (\n+            os.path.join(os.path.dirname(__file__), 'templates'),)\n+        with self.settings(TEMPLATE_DIRS=template_dirs):\n+            response = self.client.get(\"/test_admin/admin/admin_views/color2/\")\n+            self.assertTrue('custom_filter_template.html' in [t.name for t in response.templates])\n+\n+\n class AdminJavaScriptTest(AdminViewBasicTest):\n     urls = \"regressiontests.admin_views.urls\"\n "
        }
    ],
    "stats": {
        "total": 61,
        "additions": 55,
        "deletions": 6
    }
}