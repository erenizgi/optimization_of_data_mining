{
    "author": "jezdez",
    "message": "Fixed #12202 -- Removed hardcoded password reset subject and added a subject_template_name parameter to the password_reset view. Thanks, Ramiro Morales, Claude Paroz and agabel.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16438 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "656360c24044e06c881baa648f2aad9d671c3bd8",
    "files": [
        {
            "sha": "ebdc6cf0161ae9317c71a040328f9e759dcde061",
            "filename": "MANIFEST.in",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/MANIFEST.in",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/MANIFEST.in",
            "contents_url": "https://api.github.com/repos/django/django/contents/MANIFEST.in?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -17,6 +17,7 @@ recursive-include django/contrib/admin/templates *\n recursive-include django/contrib/admin/media *\n recursive-include django/contrib/admindocs/templates *\n recursive-include django/contrib/auth/fixtures *\n+recursive-include django/contrib/auth/templates *\n recursive-include django/contrib/auth/tests/templates *\n recursive-include django/contrib/comments/templates *\n recursive-include django/contrib/databrowse/templates *"
        },
        {
            "sha": "c2867430e6e413389386be0fd622f6c673257de1",
            "filename": "django/contrib/auth/fixtures/authtestdata.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ffixtures%2Fauthtestdata.json",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ffixtures%2Fauthtestdata.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ffixtures%2Fauthtestdata.json?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -31,7 +31,7 @@\n             \"groups\": [], \n             \"user_permissions\": [], \n             \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\", \n-            \"email\": \"testclient@example.com\", \n+            \"email\": \"testclient2@example.com\",\n             \"date_joined\": \"2006-12-17 07:03:31\"\n         }\n     },"
        },
        {
            "sha": "99b685c10d51e2fe37c10abce3feeeae7d8c1c8b",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -120,8 +120,11 @@ def clean_email(self):\n             raise forms.ValidationError(_(\"That e-mail address doesn't have an associated user account. Are you sure you've registered?\"))\n         return email\n \n-    def save(self, domain_override=None, email_template_name='registration/password_reset_email.html',\n-             use_https=False, token_generator=default_token_generator, from_email=None, request=None):\n+    def save(self, domain_override=None,\n+             subject_template_name='registration/password_reset_subject.txt',\n+             email_template_name='registration/password_reset_email.html',\n+             use_https=False, token_generator=default_token_generator,\n+             from_email=None, request=None):\n         \"\"\"\n         Generates a one-use only link for resetting password and sends to the user\n         \"\"\"\n@@ -133,7 +136,6 @@ def save(self, domain_override=None, email_template_name='registration/password_\n                 domain = current_site.domain\n             else:\n                 site_name = domain = domain_override\n-            t = loader.get_template(email_template_name)\n             c = {\n                 'email': user.email,\n                 'domain': domain,\n@@ -143,8 +145,11 @@ def save(self, domain_override=None, email_template_name='registration/password_\n                 'token': token_generator.make_token(user),\n                 'protocol': use_https and 'https' or 'http',\n             }\n-            send_mail(_(\"Password reset on %s\") % site_name,\n-                t.render(Context(c)), from_email, [user.email])\n+            subject = loader.render_to_string(subject_template_name, c)\n+            # Email subject *must not* contain newlines\n+            subject = ''.join(subject.splitlines())\n+            email = loader.render_to_string(email_template_name, c)\n+            send_mail(subject, email, from_email, [user.email])\n \n class SetPasswordForm(forms.Form):\n     \"\"\""
        },
        {
            "sha": "61e34747c2cce0a807435cc7669e88964f22c02a",
            "filename": "django/contrib/auth/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 47,
            "deletions": 51,
            "changes": 98,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -4,35 +4,35 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2011-03-15 13:14-0400\\n\"\n+\"POT-Creation-Date: 2011-06-19 13:08+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n \"MIME-Version: 1.0\\n\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: admin.py:28\n+#: admin.py:29\n msgid \"Personal info\"\n msgstr \"\"\n \n-#: admin.py:29\n+#: admin.py:30\n msgid \"Permissions\"\n msgstr \"\"\n \n-#: admin.py:30\n+#: admin.py:31\n msgid \"Important dates\"\n msgstr \"\"\n \n-#: admin.py:31\n+#: admin.py:32\n msgid \"Groups\"\n msgstr \"\"\n \n-#: admin.py:113\n+#: admin.py:116\n msgid \"Password changed successfully.\"\n msgstr \"\"\n \n-#: admin.py:123\n+#: admin.py:126\n #, python-format\n msgid \"Change password: %s\"\n msgstr \"\"\n@@ -49,7 +49,7 @@ msgstr \"\"\n msgid \"This value may contain only letters, numbers and @/./+/-/_ characters.\"\n msgstr \"\"\n \n-#: forms.py:17 forms.py:67 forms.py:193\n+#: forms.py:17 forms.py:67 forms.py:201\n msgid \"Password\"\n msgstr \"\"\n \n@@ -65,7 +65,7 @@ msgstr \"\"\n msgid \"A user with that username already exists.\"\n msgstr \"\"\n \n-#: forms.py:37 forms.py:163 forms.py:205\n+#: forms.py:37 forms.py:171 forms.py:213\n msgid \"The two password fields didn't match.\"\n msgstr \"\"\n \n@@ -89,154 +89,150 @@ msgstr \"\"\n msgid \"E-mail\"\n msgstr \"\"\n \n-#: forms.py:117\n+#: forms.py:120\n msgid \"\"\n \"That e-mail address doesn't have an associated user account. Are you sure \"\n \"you've registered?\"\n msgstr \"\"\n \n-#: forms.py:143\n-#, python-format\n-msgid \"Password reset on %s\"\n-msgstr \"\"\n-\n-#: forms.py:151\n+#: forms.py:159\n msgid \"New password\"\n msgstr \"\"\n \n-#: forms.py:152\n+#: forms.py:160\n msgid \"New password confirmation\"\n msgstr \"\"\n \n-#: forms.py:177\n+#: forms.py:185\n msgid \"Old password\"\n msgstr \"\"\n \n-#: forms.py:185\n+#: forms.py:193\n msgid \"Your old password was entered incorrectly. Please enter it again.\"\n msgstr \"\"\n \n-#: forms.py:194\n+#: forms.py:202\n msgid \"Password (again)\"\n msgstr \"\"\n \n-#: models.py:76 models.py:104\n+#: models.py:77 models.py:105\n msgid \"name\"\n msgstr \"\"\n \n-#: models.py:78\n+#: models.py:79\n msgid \"codename\"\n msgstr \"\"\n \n-#: models.py:82\n+#: models.py:83\n msgid \"permission\"\n msgstr \"\"\n \n-#: models.py:83 models.py:105\n+#: models.py:84 models.py:106\n msgid \"permissions\"\n msgstr \"\"\n \n-#: models.py:108\n+#: models.py:109\n msgid \"group\"\n msgstr \"\"\n \n-#: models.py:109 models.py:216\n+#: models.py:110 models.py:217\n msgid \"groups\"\n msgstr \"\"\n \n-#: models.py:206\n+#: models.py:207\n msgid \"username\"\n msgstr \"\"\n \n-#: models.py:206\n+#: models.py:207\n msgid \"\"\n \"Required. 30 characters or fewer. Letters, numbers and @/./+/-/_ characters\"\n msgstr \"\"\n \n-#: models.py:207\n+#: models.py:208\n msgid \"first name\"\n msgstr \"\"\n \n-#: models.py:208\n+#: models.py:209\n msgid \"last name\"\n msgstr \"\"\n \n-#: models.py:209\n+#: models.py:210\n msgid \"e-mail address\"\n msgstr \"\"\n \n-#: models.py:210\n+#: models.py:211\n msgid \"password\"\n msgstr \"\"\n \n-#: models.py:210\n+#: models.py:211\n msgid \"\"\n \"Use '[algo]$[salt]$[hexdigest]' or use the <a href=\\\"password/\\\">change \"\n \"password form</a>.\"\n msgstr \"\"\n \n-#: models.py:211\n+#: models.py:212\n msgid \"staff status\"\n msgstr \"\"\n \n-#: models.py:211\n+#: models.py:212\n msgid \"Designates whether the user can log into this admin site.\"\n msgstr \"\"\n \n-#: models.py:212\n+#: models.py:213\n msgid \"active\"\n msgstr \"\"\n \n-#: models.py:212\n+#: models.py:213\n msgid \"\"\n \"Designates whether this user should be treated as active. Unselect this \"\n \"instead of deleting accounts.\"\n msgstr \"\"\n \n-#: models.py:213\n+#: models.py:214\n msgid \"superuser status\"\n msgstr \"\"\n \n-#: models.py:213\n+#: models.py:214\n msgid \"\"\n \"Designates that this user has all permissions without explicitly assigning \"\n \"them.\"\n msgstr \"\"\n \n-#: models.py:214\n+#: models.py:215\n msgid \"last login\"\n msgstr \"\"\n \n-#: models.py:215\n+#: models.py:216\n msgid \"date joined\"\n msgstr \"\"\n \n-#: models.py:217\n+#: models.py:218\n msgid \"\"\n \"In addition to the permissions manually assigned, this user will also get \"\n \"all permissions granted to each group he/she is in.\"\n msgstr \"\"\n \n-#: models.py:218\n+#: models.py:219\n msgid \"user permissions\"\n msgstr \"\"\n \n-#: models.py:222\n+#: models.py:223\n msgid \"user\"\n msgstr \"\"\n \n-#: models.py:223\n+#: models.py:224\n msgid \"users\"\n msgstr \"\"\n \n-#: models.py:406\n-msgid \"message\"\n-msgstr \"\"\n-\n-#: views.py:91\n+#: views.py:93\n msgid \"Logged out\"\n msgstr \"\"\n \n-#: management/commands/createsuperuser.py:23\n+#: management/commands/createsuperuser.py:24\n msgid \"Enter a valid e-mail address.\"\n msgstr \"\"\n+\n+#: templates/registration/password_reset_subject.txt:2\n+#, python-format\n+msgid \"Password reset on %(site_name)s\"\n+msgstr \"\""
        },
        {
            "sha": "45a354b9993f73dc0a06648f5f8066db57734df1",
            "filename": "django/contrib/auth/templates/registration/password_reset_subject.txt",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ftemplates%2Fregistration%2Fpassword_reset_subject.txt",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ftemplates%2Fregistration%2Fpassword_reset_subject.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftemplates%2Fregistration%2Fpassword_reset_subject.txt?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -0,0 +1,3 @@\n+{% load i18n %}{% autoescape off %}\n+{% blocktrans %}Password reset on {{ site_name }}{% endblocktrans %}\n+{% endautoescape %}\n\\ No newline at end of file"
        },
        {
            "sha": "1fca20a4979f5a8b2d162345fd0cc06607da8811",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -1,3 +1,7 @@\n+from __future__ import with_statement\n+import os\n+from django.conf import settings\n+from django.core import mail\n from django.contrib.auth.models import User\n from django.contrib.auth.forms import UserCreationForm, AuthenticationForm,  PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm\n from django.test import TestCase\n@@ -251,6 +255,15 @@ def test_cleaned_data(self):\n         self.assertTrue(form.is_valid())\n         self.assertEqual(form.cleaned_data['email'], email)\n \n+    def test_custom_email_subject(self):\n+        template_path = os.path.join(os.path.dirname(__file__), 'templates')\n+        with self.settings(TEMPLATE_DIRS=(template_path,)):\n+            data = {'email': 'testclient@example.com'}\n+            form = PasswordResetForm(data)\n+            self.assertTrue(form.is_valid())\n+            form.save()\n+            self.assertEqual(len(mail.outbox), 1)\n+            self.assertEqual(mail.outbox[0].subject, u'Custom password reset on example.com')\n \n     def test_bug_5605(self):\n         # bug #5605, preserve the case of the user name (before the @ in the"
        },
        {
            "sha": "904b645c6c81a1d2296e388da522204d96362535",
            "filename": "django/contrib/auth/tests/templates/registration/password_reset_subject.txt",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fregistration%2Fpassword_reset_subject.txt",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fregistration%2Fpassword_reset_subject.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fregistration%2Fpassword_reset_subject.txt?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -0,0 +1 @@\n+{% autoescape off %}Custom password reset on {{ site_name }}{% endautoescape %}\n\\ No newline at end of file"
        },
        {
            "sha": "82759e9e4f4d6b32b3da447f984b496477fe5b35",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -135,6 +135,7 @@ def redirect_to_login(next, login_url=None,\n def password_reset(request, is_admin_site=False,\n                    template_name='registration/password_reset_form.html',\n                    email_template_name='registration/password_reset_email.html',\n+                   subject_template_name='registration/password_reset_subject.txt',\n                    password_reset_form=PasswordResetForm,\n                    token_generator=default_token_generator,\n                    post_reset_redirect=None,\n@@ -151,6 +152,7 @@ def password_reset(request, is_admin_site=False,\n                 'token_generator': token_generator,\n                 'from_email': from_email,\n                 'email_template_name': email_template_name,\n+                'subject_template_name': subject_template_name,\n                 'request': request,\n             }\n             if is_admin_site:"
        },
        {
            "sha": "228f53ba2b571534c4e9ad53221961621f861a89",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/656360c24044e06c881baa648f2aad9d671c3bd8/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/656360c24044e06c881baa648f2aad9d671c3bd8/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=656360c24044e06c881baa648f2aad9d671c3bd8",
            "patch": "@@ -964,6 +964,12 @@ includes a few other useful built-in views located in\n           generating the email with the new password. This will default to\n           :file:`registration/password_reset_email.html` if not supplied.\n \n+        * ``subject_template_name``: The full name of a template to use for\n+          the subject of the email with the new password. This will default\n+          to :file:`registration/password_reset_subject.txt` if not supplied.\n+\n+          .. versionadded:: 1.4\n+\n         * ``password_reset_form``: Form that will be used to set the password.\n           Defaults to :class:`~django.contrib.auth.forms.PasswordResetForm`.\n "
        }
    ],
    "stats": {
        "total": 141,
        "additions": 84,
        "deletions": 57
    }
}