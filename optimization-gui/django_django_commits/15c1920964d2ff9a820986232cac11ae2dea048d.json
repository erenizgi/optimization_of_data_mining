{
    "author": "andrewgodwin",
    "message": "Only swallow table-does-not-exist errors in tests",
    "sha": "15c1920964d2ff9a820986232cac11ae2dea048d",
    "files": [
        {
            "sha": "f67962453821db51ce1ed9df5d3cd2861d5d4085",
            "filename": "tests/modeltests/schema/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/15c1920964d2ff9a820986232cac11ae2dea048d/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/15c1920964d2ff9a820986232cac11ae2dea048d/tests%2Fmodeltests%2Fschema%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fschema%2Ftests.py?ref=15c1920964d2ff9a820986232cac11ae2dea048d",
            "patch": "@@ -20,6 +20,7 @@ class SchemaTests(TestCase):\n     \"\"\"\n \n     models = [Author, AuthorWithM2M, Book, BookWithSlug, BookWithM2M, Tag, TagUniqueRename, UniqueTest]\n+    no_table_strings = [\"no such table\", \"unknown table\", \"does not exist\"]\n \n     # Utility functions\n \n@@ -57,17 +58,23 @@ def delete_tables(self):\n                     cursor.execute(connection.schema_editor().sql_delete_table % {\n                         \"table\": connection.ops.quote_name(field.rel.through._meta.db_table),\n                     })\n-                except DatabaseError:\n-                    connection.rollback()\n+                except DatabaseError as e:\n+                    if any([s in str(e).lower() for s in self.no_table_strings]):\n+                        connection.rollback()\n+                    else:\n+                        raise\n                 else:\n                     connection.commit()\n             # Then remove the main tables\n             try:\n                 cursor.execute(connection.schema_editor().sql_delete_table % {\n                     \"table\": connection.ops.quote_name(model._meta.db_table),\n                 })\n-            except DatabaseError:\n-                connection.rollback()\n+            except DatabaseError as e:\n+                if any([s in str(e).lower() for s in self.no_table_strings]):\n+                    connection.rollback()\n+                else:\n+                    raise\n             else:\n                 connection.commit()\n         connection.enable_constraint_checking()"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 11,
        "deletions": 4
    }
}