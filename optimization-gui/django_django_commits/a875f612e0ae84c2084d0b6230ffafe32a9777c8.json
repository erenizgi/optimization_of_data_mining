{
    "author": "mjtamlyn",
    "message": "Fixed #18634 -- Don't escape variables in the context for startproject/startapp.\n\nThe & symbols which can come up in the secret key were\nbeing escaped to &amp;.",
    "sha": "a875f612e0ae84c2084d0b6230ffafe32a9777c8",
    "files": [
        {
            "sha": "52d0e5c89d9f6a4a30f231703be725d1bcfc9255",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/a875f612e0ae84c2084d0b6230ffafe32a9777c8/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/a875f612e0ae84c2084d0b6230ffafe32a9777c8/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=a875f612e0ae84c2084d0b6230ffafe32a9777c8",
            "patch": "@@ -115,7 +115,7 @@ def handle(self, app_or_project, name, target=None, **options):\n         context = Context(dict(options, **{\n             base_name: name,\n             base_directory: top_dir,\n-        }))\n+        }), autoescape=False)\n \n         # Setup a stub settings environment for template rendering\n         from django.conf import settings"
        },
        {
            "sha": "6b553f190f06d78c4b939103a3625872a458eb71",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/additional_dir/extra.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/a875f612e0ae84c2084d0b6230ffafe32a9777c8/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fadditional_dir%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/a875f612e0ae84c2084d0b6230ffafe32a9777c8/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fadditional_dir%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fadditional_dir%2Fextra.py?ref=a875f612e0ae84c2084d0b6230ffafe32a9777c8",
            "patch": "@@ -0,0 +1 @@\n+# this file uses the {{ extra }} variable"
        },
        {
            "sha": "80c6d6b805dae0a56c4ad83c9ee795b3ebe344c9",
            "filename": "tests/regressiontests/admin_scripts/management/commands/custom_startproject.py",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/a875f612e0ae84c2084d0b6230ffafe32a9777c8/tests%2Fregressiontests%2Fadmin_scripts%2Fmanagement%2Fcommands%2Fcustom_startproject.py",
            "raw_url": "https://github.com/django/django/raw/a875f612e0ae84c2084d0b6230ffafe32a9777c8/tests%2Fregressiontests%2Fadmin_scripts%2Fmanagement%2Fcommands%2Fcustom_startproject.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fmanagement%2Fcommands%2Fcustom_startproject.py?ref=a875f612e0ae84c2084d0b6230ffafe32a9777c8",
            "patch": "@@ -0,0 +1,11 @@\n+from optparse import make_option\n+\n+from django.core.management.commands.startproject import Command as BaseCommand\n+\n+\n+class Command(BaseCommand):\n+    option_list = BaseCommand.option_list + (\n+        make_option('--extra',\n+                    action='store', dest='extra',\n+                    help='An arbitrary extra value passed to the context'),\n+        )"
        },
        {
            "sha": "546fa7d79c84e1b121a648a3ad2ca36d674df172",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/a875f612e0ae84c2084d0b6230ffafe32a9777c8/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a875f612e0ae84c2084d0b6230ffafe32a9777c8/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=a875f612e0ae84c2084d0b6230ffafe32a9777c8",
            "patch": "@@ -1541,6 +1541,24 @@ def test_custom_project_template_context_variables(self):\n             self.assertIn(\"project_name = 'another_project'\", content)\n             self.assertIn(\"project_directory = '%s'\" % testproject_dir, content)\n \n+    def test_no_escaping_of_project_variables(self):\n+        \"Make sure template context variables are not html escaped\"\n+        # We're using a custom command so we need the alternate settings\n+        self.write_settings('alternate_settings.py')\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template')\n+        args = ['custom_startproject', '--template', template_path, 'another_project', 'project_dir', '--extra', '<&>', '--settings=alternate_settings']\n+        testproject_dir = os.path.join(test_dir, 'project_dir')\n+        os.mkdir(testproject_dir)\n+        out, err = self.run_manage(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        test_manage_py = os.path.join(testproject_dir, 'additional_dir', 'extra.py')\n+        with open(test_manage_py, 'r') as fp:\n+            content = fp.read()\n+            self.assertIn(\"<&>\", content)\n+        # tidy up alternate settings\n+        self.remove_settings('alternate_settings.py')\n+\n     def test_custom_project_destination_missing(self):\n         \"\"\"\n         Make sure an exception is raised when the provided"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 31,
        "deletions": 1
    }
}