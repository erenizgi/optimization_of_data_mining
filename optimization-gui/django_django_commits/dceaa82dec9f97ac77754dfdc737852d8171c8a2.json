{
    "author": "SmileyChris",
    "message": "Fixed #14809 -- broken login related tests after r14733.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14764 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "dceaa82dec9f97ac77754dfdc737852d8171c8a2",
    "files": [
        {
            "sha": "014c8195fc1416cac1851d512b1b3079f639e417",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/dceaa82dec9f97ac77754dfdc737852d8171c8a2/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/dceaa82dec9f97ac77754dfdc737852d8171c8a2/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=dceaa82dec9f97ac77754dfdc737852d8171c8a2",
            "patch": "@@ -265,31 +265,31 @@ def test_standard_login_url(self):\n         querystring = QueryDict('', mutable=True)\n         querystring['next'] = '/login_required/'\n         self.assertEqual(login_required_url,\n-             'http://testserver%s?%s' % (login_url, querystring.urlencode()))\n+             'http://testserver%s?%s' % (login_url, querystring.urlencode('/')))\n \n     def test_remote_login_url(self):\n         login_url = 'http://remote.example.com/login'\n         login_required_url = self.get_login_required_url(login_url)\n         querystring = QueryDict('', mutable=True)\n         querystring['next'] = 'http://testserver/login_required/'\n         self.assertEqual(login_required_url,\n-                         '%s?%s' % (login_url, querystring.urlencode()))\n+                         '%s?%s' % (login_url, querystring.urlencode('/')))\n \n     def test_https_login_url(self):\n         login_url = 'https:///login/'\n         login_required_url = self.get_login_required_url(login_url)\n         querystring = QueryDict('', mutable=True)\n         querystring['next'] = 'http://testserver/login_required/'\n         self.assertEqual(login_required_url,\n-                         '%s?%s' % (login_url, querystring.urlencode()))\n+                         '%s?%s' % (login_url, querystring.urlencode('/')))\n \n     def test_login_url_with_querystring(self):\n         login_url = '/login/?pretty=1'\n         login_required_url = self.get_login_required_url(login_url)\n         querystring = QueryDict('pretty=1', mutable=True)\n         querystring['next'] = '/login_required/'\n         self.assertEqual(login_required_url, 'http://testserver/login/?%s' %\n-                         querystring.urlencode())\n+                         querystring.urlencode('/'))\n \n     def test_remote_login_url_with_next_querystring(self):\n         login_url = 'http://remote.example.com/login/'\n@@ -298,8 +298,9 @@ def test_remote_login_url_with_next_querystring(self):\n         querystring = QueryDict('', mutable=True)\n         querystring['next'] = 'http://testserver/login_required/'\n         self.assertEqual(login_required_url, '%s?%s' % (login_url,\n-                                                    querystring.urlencode()))\n-        \n+                                                    querystring.urlencode('/')))\n+\n+\n class LogoutTest(AuthViewsTestCase):\n     urls = 'django.contrib.auth.tests.urls'\n "
        },
        {
            "sha": "0325643c11227e51a24e0624414e2f5f8ce8daef",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/dceaa82dec9f97ac77754dfdc737852d8171c8a2/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/dceaa82dec9f97ac77754dfdc737852d8171c8a2/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=dceaa82dec9f97ac77754dfdc737852d8171c8a2",
            "patch": "@@ -99,7 +99,7 @@ def redirect_to_login(next, login_url=None,\n     if redirect_field_name:\n         querystring = QueryDict(login_url_parts[4], mutable=True)\n         querystring[redirect_field_name] = next\n-        login_url_parts[4] = querystring.urlencode()\n+        login_url_parts[4] = querystring.urlencode(safe='/')\n \n     return HttpResponseRedirect(urlparse.urlunparse(login_url_parts))\n "
        },
        {
            "sha": "90c55c63194583fdf87678c50b3b269c4a9eb847",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 22,
            "deletions": 3,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/dceaa82dec9f97ac77754dfdc737852d8171c8a2/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/dceaa82dec9f97ac77754dfdc737852d8171c8a2/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=dceaa82dec9f97ac77754dfdc737852d8171c8a2",
            "patch": "@@ -3,7 +3,7 @@\n import re\n import time\n from pprint import pformat\n-from urllib import urlencode\n+from urllib import urlencode, quote\n from urlparse import urljoin\n try:\n     from cStringIO import StringIO\n@@ -363,11 +363,30 @@ def copy(self):\n         \"\"\"Returns a mutable copy of this object.\"\"\"\n         return self.__deepcopy__({})\n \n-    def urlencode(self):\n+    def urlencode(self, safe=None):\n+        \"\"\"\n+        Returns an encoded string of all query string arguments.\n+\n+        :arg safe: Used to specify characters which do not require quoting, for\n+            example::\n+\n+                >>> q = QueryDict('', mutable=True)\n+                >>> q['next'] = '/a&b/'\n+                >>> q.urlencode()\n+                'next=%2Fa%26b%2F'\n+                >>> q.urlencode(safe='/')\n+                'next=/a%26b/'\n+\n+        \"\"\"\n         output = []\n+        if safe:\n+            encode = lambda k, v: '%s=%s' % ((quote(k, safe), quote(v, safe)))\n+        else:\n+            encode = lambda k, v: urlencode({k: v})\n         for k, list_ in self.lists():\n             k = smart_str(k, self.encoding)\n-            output.extend([urlencode({k: smart_str(v, self.encoding)}) for v in list_])\n+            output.extend([encode(k, smart_str(v, self.encoding))\n+                           for v in list_])\n         return '&'.join(output)\n \n class CompatCookie(SimpleCookie):"
        },
        {
            "sha": "7ea7643c757027a4385a2e90e31558e28b886b55",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 6,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/dceaa82dec9f97ac77754dfdc737852d8171c8a2/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/dceaa82dec9f97ac77754dfdc737852d8171c8a2/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=dceaa82dec9f97ac77754dfdc737852d8171c8a2",
            "patch": "@@ -430,14 +430,28 @@ In addition, ``QueryDict`` has the following methods:\n     Like :meth:`items()`, except it includes all values, as a list, for each\n     member of the dictionary. For example::\n \n-         >>> q = QueryDict('a=1&a=2&a=3')\n-         >>> q.lists()\n-         [(u'a', [u'1', u'2', u'3'])]\n+        >>> q = QueryDict('a=1&a=2&a=3')\n+        >>> q.lists()\n+        [(u'a', [u'1', u'2', u'3'])]\n \n-.. method:: QueryDict.urlencode()\n+.. method:: QueryDict.urlencode([safe])\n \n-    Returns a string of the data in query-string format.\n-    Example: ``\"a=2&b=3&b=5\"``.\n+    Returns a string of the data in query-string format. Example::\n+\n+        >>> q = QueryDict('a=2&b=3&b=5')\n+        >>> q.urlencode()\n+        'a=2&b=3&b=5'\n+\n+    .. versionchanged:: 1.3\n+       The ``safe`` parameter was added.\n+\n+    Optionally, urlencode can be passed characters which\n+    do not require encoding. For example::\n+\n+        >>> q = QueryDict('', mutable=True)\n+        >>> q['next'] = '/a&b/'\n+        >>> q.urlencode(safe='/')\n+        'next=/a%26b/'\n \n HttpResponse objects\n ===================="
        },
        {
            "sha": "65b06a1d77fa31b4a8f23be8ad52861c77904af6",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/dceaa82dec9f97ac77754dfdc737852d8171c8a2/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/dceaa82dec9f97ac77754dfdc737852d8171c8a2/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=dceaa82dec9f97ac77754dfdc737852d8171c8a2",
            "patch": "@@ -71,6 +71,16 @@ def test_single_key_value(self):\n \n         self.assertEqual(q.urlencode(), 'foo=bar')\n \n+    def test_urlencode(self):\n+        q = QueryDict('', mutable=True)\n+        q['next'] = '/a&b/'\n+        self.assertEqual(q.urlencode(), 'next=%2Fa%26b%2F')\n+        self.assertEqual(q.urlencode(safe='/'), 'next=/a%26b/')\n+        q = QueryDict('', mutable=True)\n+        q['next'] = u'/t\\xebst&key/'\n+        self.assertEqual(q.urlencode(), 'next=%2Ft%C3%ABst%26key%2F')\n+        self.assertEqual(q.urlencode(safe='/'), 'next=/t%C3%ABst%26key/')\n+\n     def test_mutable_copy(self):\n         \"\"\"A copy of a QueryDict is mutable.\"\"\"\n         q = QueryDict('').copy()"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 60,
        "deletions": 16
    }
}