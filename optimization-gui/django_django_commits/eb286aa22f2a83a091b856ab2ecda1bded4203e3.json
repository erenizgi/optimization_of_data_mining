{
    "author": "claudep",
    "message": "Delayed encoding of password and salt in password checking.\n\nApplied the rule that string encoding should happen as late as\npossible. This is also a preparation for Python 3 compatibility.",
    "sha": "eb286aa22f2a83a091b856ab2ecda1bded4203e3",
    "files": [
        {
            "sha": "deb6cb9414d59ba24bc334c0021603a07f4c1122",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eb286aa22f2a83a091b856ab2ecda1bded4203e3/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/eb286aa22f2a83a091b856ab2ecda1bded4203e3/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=eb286aa22f2a83a091b856ab2ecda1bded4203e3",
            "patch": "@@ -1,7 +1,6 @@\n from django import forms\n from django.forms.util import flatatt\n from django.template import loader\n-from django.utils.encoding import smart_str\n from django.utils.http import int_to_base36\n from django.utils.safestring import mark_safe\n from django.utils.translation import ugettext, ugettext_lazy as _\n@@ -26,8 +25,6 @@ def render(self, name, value, attrs):\n \n         final_attrs = self.build_attrs(attrs)\n \n-        encoded = smart_str(encoded)\n-\n         if len(encoded) == 32 and '$' not in encoded:\n             algorithm = 'unsalted_md5'\n         else:"
        },
        {
            "sha": "11a6313ed77f1c965c27b7b095a73ba89eb3d8a9",
            "filename": "django/contrib/auth/hashers.py",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eb286aa22f2a83a091b856ab2ecda1bded4203e3/django%2Fcontrib%2Fauth%2Fhashers.py",
            "raw_url": "https://github.com/django/django/raw/eb286aa22f2a83a091b856ab2ecda1bded4203e3/django%2Fcontrib%2Fauth%2Fhashers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fhashers.py?ref=eb286aa22f2a83a091b856ab2ecda1bded4203e3",
            "patch": "@@ -40,9 +40,6 @@ def check_password(password, encoded, setter=None, preferred='default'):\n         return False\n \n     preferred = get_hasher(preferred)\n-    raw_password = password\n-    password = smart_str(password)\n-    encoded = smart_str(encoded)\n \n     if len(encoded) == 32 and '$' not in encoded:\n         hasher = get_hasher('unsalted_md5')\n@@ -53,7 +50,7 @@ def check_password(password, encoded, setter=None, preferred='default'):\n     must_update = hasher.algorithm != preferred.algorithm\n     is_correct = hasher.verify(password, encoded)\n     if setter and is_correct and must_update:\n-        setter(raw_password)\n+        setter(password)\n     return is_correct\n \n \n@@ -69,11 +66,9 @@ def make_password(password, salt=None, hasher='default'):\n         return UNUSABLE_PASSWORD\n \n     hasher = get_hasher(hasher)\n-    password = smart_str(password)\n \n     if not salt:\n         salt = hasher.salt()\n-    salt = smart_str(salt)\n \n     return hasher.encode(password, salt)\n \n@@ -291,7 +286,7 @@ class SHA1PasswordHasher(BasePasswordHasher):\n     def encode(self, password, salt):\n         assert password\n         assert salt and '$' not in salt\n-        hash = hashlib.sha1(salt + password).hexdigest()\n+        hash = hashlib.sha1(smart_str(salt + password)).hexdigest()\n         return \"%s$%s$%s\" % (self.algorithm, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -319,7 +314,7 @@ class MD5PasswordHasher(BasePasswordHasher):\n     def encode(self, password, salt):\n         assert password\n         assert salt and '$' not in salt\n-        hash = hashlib.md5(salt + password).hexdigest()\n+        hash = hashlib.md5(smart_str(salt + password)).hexdigest()\n         return \"%s$%s$%s\" % (self.algorithm, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -353,7 +348,7 @@ def salt(self):\n         return ''\n \n     def encode(self, password, salt):\n-        return hashlib.md5(password).hexdigest()\n+        return hashlib.md5(smart_str(password)).hexdigest()\n \n     def verify(self, password, encoded):\n         encoded_2 = self.encode(password, '')"
        },
        {
            "sha": "0fce06012ba4cc0dc1696cab64a1cec0f9e202df",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eb286aa22f2a83a091b856ab2ecda1bded4203e3/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/eb286aa22f2a83a091b856ab2ecda1bded4203e3/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=eb286aa22f2a83a091b856ab2ecda1bded4203e3",
            "patch": "@@ -22,6 +22,7 @@\n     using_sysrandom = False\n \n from django.conf import settings\n+from django.utils.encoding import smart_str\n \n \n _trans_5c = b\"\".join([chr(x ^ 0x5C) for x in xrange(256)])\n@@ -137,6 +138,8 @@ def pbkdf2(password, salt, iterations, dklen=0, digest=None):\n     assert iterations > 0\n     if not digest:\n         digest = hashlib.sha256\n+    password = smart_str(password)\n+    salt = smart_str(salt)\n     hlen = digest().digest_size\n     if not dklen:\n         dklen = hlen"
        },
        {
            "sha": "696f332285b009b1363506c216f5abfbddf1f02f",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/eb286aa22f2a83a091b856ab2ecda1bded4203e3/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/eb286aa22f2a83a091b856ab2ecda1bded4203e3/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=eb286aa22f2a83a091b856ab2ecda1bded4203e3",
            "patch": "@@ -128,6 +128,15 @@ If you were using the ``data`` parameter in a PUT request without a\n ``content_type``, you must encode your data before passing it to the test\n client and set the ``content_type`` argument.\n \n+String types of hasher method parameters\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If you have written a :ref:`custom password hasher <auth_password_storage>`,\n+your ``encode()``, ``verify()`` or ``safe_summary()`` methods should accept\n+Unicode parameters (``password``, ``salt`` or ``encoded``). If any of the\n+hashing methods need byte strings, you can use the\n+:func:`~django.utils.encoding.smart_str` utility to encode the strings.\n+\n Features deprecated in 1.5\n ==========================\n "
        }
    ],
    "stats": {
        "total": 28,
        "additions": 16,
        "deletions": 12
    }
}