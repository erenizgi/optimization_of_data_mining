{
    "author": "freakboy3742",
    "message": "Fixed #16198 -- Ported the model_forms doctests. Our long national nightmare is over. Oh, and we have always been at war with doctests. Thanks to Peter van Kampen and Gregor Müllegger for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16358 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "aa5506d6f69180820db8f1811b4c8780d39a5733",
    "files": [
        {
            "sha": "8cb71c12803b9f9ea3aa22b132b30b380ac95f22",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/aa5506d6f69180820db8f1811b4c8780d39a5733/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/aa5506d6f69180820db8f1811b4c8780d39a5733/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=aa5506d6f69180820db8f1811b4c8780d39a5733",
            "patch": "@@ -262,6 +262,7 @@ answer newbie questions, and generally made Django that much better:\n     junzhang.jn@gmail.com\n     Xia Kai <http://blog.xiaket.org/>\n     Antti Kaihola <http://djangopeople.net/akaihola/>\n+    Peter van Kampen\n     Bahadır Kandemir <bahadir@pardus.org.tr>\n     Karderio <karderio@gmail.com>\n     Nagy Károly <charlie@rendszergazda.com>"
        },
        {
            "sha": "140e8073e79716a9827b7dac711b25b50a12bfa3",
            "filename": "tests/modeltests/model_forms/mforms.py",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/4dac0883f00ae7eb64c01488c53f50074efb9695/tests%2Fmodeltests%2Fmodel_forms%2Fmforms.py",
            "raw_url": "https://github.com/django/django/raw/4dac0883f00ae7eb64c01488c53f50074efb9695/tests%2Fmodeltests%2Fmodel_forms%2Fmforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Fmforms.py?ref=4dac0883f00ae7eb64c01488c53f50074efb9695",
            "patch": "@@ -1,44 +0,0 @@\n-from django import forms\n-from django.forms import ModelForm\n-\n-from models import (Product, Price, Book, DerivedBook, ExplicitPK, Post,\n-        DerivedPost, Writer, FlexibleDatePost)\n-\n-class ProductForm(ModelForm):\n-    class Meta:\n-        model = Product\n-\n-class PriceForm(ModelForm):\n-    class Meta:\n-        model = Price\n-\n-class BookForm(ModelForm):\n-    class Meta:\n-       model = Book\n-\n-class DerivedBookForm(ModelForm):\n-    class Meta:\n-        model = DerivedBook\n-\n-class ExplicitPKForm(ModelForm):\n-    class Meta:\n-        model = ExplicitPK\n-        fields = ('key', 'desc',)\n-\n-class PostForm(ModelForm):\n-    class Meta:\n-        model = Post\n-\n-class DerivedPostForm(ModelForm):\n-    class Meta:\n-        model = DerivedPost\n-\n-class CustomWriterForm(ModelForm):\n-   name = forms.CharField(required=False)\n-\n-   class Meta:\n-       model = Writer\n-\n-class FlexDatePostForm(ModelForm):\n-    class Meta:\n-        model = FlexibleDatePost"
        },
        {
            "sha": "7204b285b79a23f0c0895c296ad0a512126f1958",
            "filename": "tests/modeltests/model_forms/models.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1364,
            "changes": 1364,
            "blob_url": "https://github.com/django/django/blob/aa5506d6f69180820db8f1811b4c8780d39a5733/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/aa5506d6f69180820db8f1811b4c8780d39a5733/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py?ref=aa5506d6f69180820db8f1811b4c8780d39a5733",
            "patch": "@@ -247,1367 +247,3 @@ class FlexibleDatePost(models.Model):\n     slug = models.CharField(max_length=50, unique_for_year='posted', blank=True)\n     subtitle = models.CharField(max_length=50, unique_for_month='posted', blank=True)\n     posted = models.DateField(blank=True, null=True)\n-\n-__test__ = {'API_TESTS': \"\"\"\n->>> from django import forms\n->>> from django.forms.models import ModelForm, model_to_dict\n->>> from django.core.files.uploadedfile import SimpleUploadedFile\n-\n-The bare bones, absolutely nothing custom, basic case.\n-\n->>> class CategoryForm(ModelForm):\n-...     class Meta:\n-...         model = Category\n->>> CategoryForm.base_fields.keys()\n-['name', 'slug', 'url']\n-\n-\n-Extra fields.\n-\n->>> class CategoryForm(ModelForm):\n-...     some_extra_field = forms.BooleanField()\n-...\n-...     class Meta:\n-...         model = Category\n-\n->>> CategoryForm.base_fields.keys()\n-['name', 'slug', 'url', 'some_extra_field']\n-\n-Extra field that has a name collision with a related object accessor.\n-\n->>> class WriterForm(ModelForm):\n-...     book = forms.CharField(required=False)\n-...\n-...     class Meta:\n-...         model = Writer\n-\n->>> wf = WriterForm({'name': 'Richard Lockridge'})\n->>> wf.is_valid()\n-True\n-\n-Replacing a field.\n-\n->>> class CategoryForm(ModelForm):\n-...     url = forms.BooleanField()\n-...\n-...     class Meta:\n-...         model = Category\n-\n->>> CategoryForm.base_fields['url'].__class__\n-<class 'django.forms.fields.BooleanField'>\n-\n-\n-Using 'fields'.\n-\n->>> class CategoryForm(ModelForm):\n-...\n-...     class Meta:\n-...         model = Category\n-...         fields = ['url']\n-\n->>> CategoryForm.base_fields.keys()\n-['url']\n-\n-\n-Using 'exclude'\n-\n->>> class CategoryForm(ModelForm):\n-...\n-...     class Meta:\n-...         model = Category\n-...         exclude = ['url']\n-\n->>> CategoryForm.base_fields.keys()\n-['name', 'slug']\n-\n-\n-Using 'fields' *and* 'exclude'. Not sure why you'd want to do this, but uh,\n-\"be liberal in what you accept\" and all.\n-\n->>> class CategoryForm(ModelForm):\n-...\n-...     class Meta:\n-...         model = Category\n-...         fields = ['name', 'url']\n-...         exclude = ['url']\n-\n->>> CategoryForm.base_fields.keys()\n-['name']\n-\n-Using 'widgets'\n-\n->>> class CategoryForm(ModelForm):\n-...\n-...     class Meta:\n-...         model = Category\n-...         fields = ['name', 'url', 'slug']\n-...         widgets = {\n-...             'name': forms.Textarea,\n-...             'url': forms.TextInput(attrs={'class': 'url'})\n-...         }\n-\n->>> str(CategoryForm()['name'])\n-'<textarea id=\"id_name\" rows=\"10\" cols=\"40\" name=\"name\"></textarea>'\n-\n->>> str(CategoryForm()['url'])\n-'<input id=\"id_url\" type=\"text\" class=\"url\" name=\"url\" maxlength=\"40\" />'\n-\n->>> str(CategoryForm()['slug'])\n-'<input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" />'\n-\n-Don't allow more than one 'model' definition in the inheritance hierarchy.\n-Technically, it would generate a valid form, but the fact that the resulting\n-save method won't deal with multiple objects is likely to trip up people not\n-familiar with the mechanics.\n-\n->>> class CategoryForm(ModelForm):\n-...     class Meta:\n-...         model = Category\n-\n->>> class OddForm(CategoryForm):\n-...     class Meta:\n-...         model = Article\n-\n-OddForm is now an Article-related thing, because BadForm.Meta overrides\n-CategoryForm.Meta.\n->>> OddForm.base_fields.keys()\n-['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n-\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n-\n-First class with a Meta class wins.\n-\n->>> class BadForm(ArticleForm, CategoryForm):\n-...     pass\n->>> OddForm.base_fields.keys()\n-['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n-\n-Subclassing without specifying a Meta on the class will use the parent's Meta\n-(or the first parent in the MRO if there are multiple parent classes).\n-\n->>> class CategoryForm(ModelForm):\n-...     class Meta:\n-...         model = Category\n->>> class SubCategoryForm(CategoryForm):\n-...     pass\n->>> SubCategoryForm.base_fields.keys()\n-['name', 'slug', 'url']\n-\n-We can also subclass the Meta inner class to change the fields list.\n-\n->>> class CategoryForm(ModelForm):\n-...     checkbox = forms.BooleanField()\n-...\n-...     class Meta:\n-...         model = Category\n->>> class SubCategoryForm(CategoryForm):\n-...     class Meta(CategoryForm.Meta):\n-...         exclude = ['url']\n-\n->>> print SubCategoryForm()\n-<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_checkbox\">Checkbox:</label></th><td><input type=\"checkbox\" name=\"checkbox\" id=\"id_checkbox\" /></td></tr>\n-\n-# test using fields to provide ordering to the fields\n->>> class CategoryForm(ModelForm):\n-...     class Meta:\n-...         model = Category\n-...         fields = ['url', 'name']\n-\n->>> CategoryForm.base_fields.keys()\n-['url', 'name']\n-\n-\n->>> print CategoryForm()\n-<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n-<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n-\n->>> class CategoryForm(ModelForm):\n-...     class Meta:\n-...         model = Category\n-...         fields = ['slug', 'url', 'name']\n-...         exclude = ['url']\n-\n->>> CategoryForm.base_fields.keys()\n-['slug', 'name']\n-\n-# Old form_for_x tests #######################################################\n-\n->>> from django.forms import ModelForm, CharField\n->>> import datetime\n-\n->>> Category.objects.all()\n-[]\n-\n->>> class CategoryForm(ModelForm):\n-...     class Meta:\n-...         model = Category\n->>> f = CategoryForm()\n->>> print f\n-<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n-<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n->>> print f.as_ul()\n-<li><label for=\"id_name\">Name:</label> <input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n-<li><label for=\"id_slug\">Slug:</label> <input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n-<li><label for=\"id_url\">The URL:</label> <input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></li>\n->>> print f['name']\n-<input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" />\n-\n->>> f = CategoryForm(auto_id=False)\n->>> print f.as_ul()\n-<li>Name: <input type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n-<li>The URL: <input type=\"text\" name=\"url\" maxlength=\"40\" /></li>\n-\n->>> f = CategoryForm({'name': 'Entertainment', 'slug': 'entertainment', 'url': 'entertainment'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['url']\n-u'entertainment'\n->>> f.cleaned_data['name']\n-u'Entertainment'\n->>> f.cleaned_data['slug']\n-u'entertainment'\n->>> c1 = f.save()\n->>> c1\n-<Category: Entertainment>\n->>> Category.objects.all()\n-[<Category: Entertainment>]\n-\n->>> f = CategoryForm({'name': \"It's a test\", 'slug': 'its-test', 'url': 'test'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['url']\n-u'test'\n->>> f.cleaned_data['name']\n-u\"It's a test\"\n->>> f.cleaned_data['slug']\n-u'its-test'\n->>> c2 = f.save()\n->>> c2\n-<Category: It's a test>\n->>> Category.objects.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n-\n-If you call save() with commit=False, then it will return an object that\n-hasn't yet been saved to the database. In this case, it's up to you to call\n-save() on the resulting model instance.\n->>> f = CategoryForm({'name': 'Third test', 'slug': 'third-test', 'url': 'third'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['url']\n-u'third'\n->>> f.cleaned_data['name']\n-u'Third test'\n->>> f.cleaned_data['slug']\n-u'third-test'\n->>> c3 = f.save(commit=False)\n->>> c3\n-<Category: Third test>\n->>> Category.objects.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> c3.save()\n->>> Category.objects.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>, <Category: Third test>]\n-\n-If you call save() with invalid data, you'll get a ValueError.\n->>> f = CategoryForm({'name': '', 'slug': 'not a slug!', 'url': 'foo'})\n->>> f.errors['name']\n-[u'This field is required.']\n->>> f.errors['slug']\n-[u\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"]\n->>> f.cleaned_data\n-Traceback (most recent call last):\n-...\n-AttributeError: 'CategoryForm' object has no attribute 'cleaned_data'\n->>> f.save()\n-Traceback (most recent call last):\n-...\n-ValueError: The Category could not be created because the data didn't validate.\n->>> f = CategoryForm({'name': '', 'slug': '', 'url': 'foo'})\n->>> f.save()\n-Traceback (most recent call last):\n-...\n-ValueError: The Category could not be created because the data didn't validate.\n-\n-Create a couple of Writers.\n->>> w_royko = Writer(name='Mike Royko')\n->>> w_royko.save()\n->>> w_woodward = Writer(name='Bob Woodward')\n->>> w_woodward.save()\n-\n-ManyToManyFields are represented by a MultipleChoiceField, ForeignKeys and any\n-fields with the 'choices' attribute are represented by a ChoiceField.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm(auto_id=False)\n->>> print f\n-<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n-<tr><th>Slug:</th><td><input type=\"text\" name=\"slug\" maxlength=\"50\" /></td></tr>\n-<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n-<tr><th>Writer:</th><td><select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Mike Royko</option>\n-</select></td></tr>\n-<tr><th>Article:</th><td><textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></td></tr>\n-<tr><th>Categories:</th><td><select multiple=\"multiple\" name=\"categories\">\n-<option value=\"...\">Entertainment</option>\n-<option value=\"...\">It&#39;s a test</option>\n-<option value=\"...\">Third test</option>\n-</select><br /><span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></td></tr>\n-<tr><th>Status:</th><td><select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></td></tr>\n-\n-You can restrict a form to a subset of the complete list of fields\n-by providing a 'fields' argument. If you try to save a\n-model created with such a form, you need to ensure that the fields\n-that are _not_ on the form have default values, or are allowed to have\n-a value of None. If a field isn't specified on a form, the object created\n-from the form can't provide a value for that field!\n->>> class PartialArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n-...         fields = ('headline','pub_date')\n->>> f = PartialArticleForm(auto_id=False)\n->>> print f\n-<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n-<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n-\n-When the ModelForm is passed an instance, that instance's current values are\n-inserted as 'initial' data in each Field.\n->>> w = Writer.objects.get(name='Mike Royko')\n->>> class RoykoForm(ModelForm):\n-...     class Meta:\n-...         model = Writer\n->>> f = RoykoForm(auto_id=False, instance=w)\n->>> print f\n-<tr><th>Name:</th><td><input type=\"text\" name=\"name\" value=\"Mike Royko\" maxlength=\"50\" /><br /><span class=\"helptext\">Use both first and last names.</span></td></tr>\n-\n->>> art = Article(headline='Test article', slug='test-article', pub_date=datetime.date(1988, 1, 4), writer=w, article='Hello.')\n->>> art.save()\n->>> art_id_1 = art.id\n->>> art_id_1 is not None\n-True\n->>> class TestArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = TestArticleForm(auto_id=False, instance=art)\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" value=\"Test article\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" value=\"test-article\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\" selected=\"selected\">Mike Royko</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"...\">Entertainment</option>\n-<option value=\"...\">It&#39;s a test</option>\n-<option value=\"...\">Third test</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n->>> f = TestArticleForm({'headline': u'Test headline', 'slug': 'test-headline', 'pub_date': u'1984-02-06', 'writer': unicode(w_royko.pk), 'article': 'Hello.'}, instance=art)\n->>> f.errors\n-{}\n->>> f.is_valid()\n-True\n->>> test_art = f.save()\n->>> test_art.id == art_id_1\n-True\n->>> test_art = Article.objects.get(id=art_id_1)\n->>> test_art.headline\n-u'Test headline'\n-\n-You can create a form over a subset of the available fields\n-by specifying a 'fields' argument to form_for_instance.\n->>> class PartialArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n-...         fields=('headline', 'slug', 'pub_date')\n->>> f = PartialArticleForm({'headline': u'New headline', 'slug': 'new-headline', 'pub_date': u'1988-01-04'}, auto_id=False, instance=art)\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n->>> f.is_valid()\n-True\n->>> new_art = f.save()\n->>> new_art.id == art_id_1\n-True\n->>> new_art = Article.objects.get(id=art_id_1)\n->>> new_art.headline\n-u'New headline'\n-\n-Add some categories and test the many-to-many form output.\n->>> new_art.categories.all()\n-[]\n->>> new_art.categories.add(Category.objects.get(name='Entertainment'))\n->>> new_art.categories.all()\n-[<Category: Entertainment>]\n->>> class TestArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = TestArticleForm(auto_id=False, instance=new_art)\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\" selected=\"selected\">Mike Royko</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"...\" selected=\"selected\">Entertainment</option>\n-<option value=\"...\">It&#39;s a test</option>\n-<option value=\"...\">Third test</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-\n-Initial values can be provided for model forms\n->>> f = TestArticleForm(auto_id=False, initial={'headline': 'Your headline here', 'categories': [str(c1.id), str(c2.id)]})\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" value=\"Your headline here\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Mike Royko</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"...\" selected=\"selected\">Entertainment</option>\n-<option value=\"...\" selected=\"selected\">It&#39;s a test</option>\n-<option value=\"...\">Third test</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-\n->>> f = TestArticleForm({'headline': u'New headline', 'slug': u'new-headline', 'pub_date': u'1988-01-04',\n-...     'writer': unicode(w_royko.pk), 'article': u'Hello.', 'categories': [unicode(c1.id), unicode(c2.id)]}, instance=new_art)\n->>> new_art = f.save()\n->>> new_art.id == art_id_1\n-True\n->>> new_art = Article.objects.get(id=art_id_1)\n->>> new_art.categories.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n-\n-Now, submit form data with no categories. This deletes the existing categories.\n->>> f = TestArticleForm({'headline': u'New headline', 'slug': u'new-headline', 'pub_date': u'1988-01-04',\n-...     'writer': unicode(w_royko.pk), 'article': u'Hello.'}, instance=new_art)\n->>> new_art = f.save()\n->>> new_art.id == art_id_1\n-True\n->>> new_art = Article.objects.get(id=art_id_1)\n->>> new_art.categories.all()\n-[]\n-\n-Create a new article, with categories, via the form.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n-...     'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [unicode(c1.id), unicode(c2.id)]})\n->>> new_art = f.save()\n->>> art_id_2 = new_art.id\n->>> art_id_2 not in (None, art_id_1)\n-True\n->>> new_art = Article.objects.get(id=art_id_2)\n->>> new_art.categories.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n-\n-Create a new article, with no categories, via the form.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n-...     'writer': unicode(w_royko.pk), 'article': u'Test.'})\n->>> new_art = f.save()\n->>> art_id_3 = new_art.id\n->>> art_id_3 not in (None, art_id_1, art_id_2)\n-True\n->>> new_art = Article.objects.get(id=art_id_3)\n->>> new_art.categories.all()\n-[]\n-\n-Create a new article, with categories, via the form, but use commit=False.\n-The m2m data won't be saved until save_m2m() is invoked on the form.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm({'headline': u'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': u'1967-11-01',\n-...     'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [unicode(c1.id), unicode(c2.id)]})\n->>> new_art = f.save(commit=False)\n-\n-# Manually save the instance\n->>> new_art.save()\n->>> art_id_4 = new_art.id\n->>> art_id_4 not in (None, art_id_1, art_id_2, art_id_3)\n-True\n-\n-# The instance doesn't have m2m data yet\n->>> new_art = Article.objects.get(id=art_id_4)\n->>> new_art.categories.all()\n-[]\n-\n-# Save the m2m data on the form\n->>> f.save_m2m()\n->>> new_art.categories.order_by('name')\n-[<Category: Entertainment>, <Category: It's a test>]\n-\n-Here, we define a custom ModelForm. Because it happens to have the same fields as\n-the Category model, we can just call the form's save() to apply its changes to an\n-existing Category instance.\n->>> class ShortCategory(ModelForm):\n-...     name = CharField(max_length=5)\n-...     slug = CharField(max_length=5)\n-...     url = CharField(max_length=3)\n->>> cat = Category.objects.get(name='Third test')\n->>> cat\n-<Category: Third test>\n->>> cat.id == c3.id\n-True\n->>> form = ShortCategory({'name': 'Third', 'slug': 'third', 'url': '3rd'}, instance=cat)\n->>> form.save()\n-<Category: Third>\n->>> Category.objects.get(id=c3.id)\n-<Category: Third>\n-\n-Here, we demonstrate that choices for a ForeignKey ChoiceField are determined\n-at runtime, based on the data in the database when the form is displayed, not\n-the data in the database when the form is instantiated.\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm(auto_id=False)\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Mike Royko</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"...\">Entertainment</option>\n-<option value=\"...\">It&#39;s a test</option>\n-<option value=\"...\">Third</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n->>> c4 = Category.objects.create(name='Fourth', url='4th')\n->>> c4\n-<Category: Fourth>\n->>> Writer.objects.create(name='Carl Bernstein')\n-<Writer: Carl Bernstein>\n->>> print f.as_ul()\n-<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n-<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n-<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n-<li>Writer: <select name=\"writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Carl Bernstein</option>\n-<option value=\"...\">Mike Royko</option>\n-</select></li>\n-<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n-<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n-<option value=\"...\">Entertainment</option>\n-<option value=\"...\">It&#39;s a test</option>\n-<option value=\"...\">Third</option>\n-<option value=\"...\">Fourth</option>\n-</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n-<li>Status: <select name=\"status\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"1\">Draft</option>\n-<option value=\"2\">Pending</option>\n-<option value=\"3\">Live</option>\n-</select></li>\n-\n-# ModelChoiceField ############################################################\n-\n->>> from django.forms import ModelChoiceField, ModelMultipleChoiceField\n-\n->>> f = ModelChoiceField(Category.objects.all())\n->>> list(f.choices)\n-[(u'', u'---------'), (..., u'Entertainment'), (..., u\"It's a test\"), (..., u'Third'), (..., u'Fourth')]\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(0)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n->>> f.clean(c3.id)\n-<Category: Third>\n->>> f.clean(c2.id)\n-<Category: It's a test>\n-\n-# Add a Category object *after* the ModelChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> c5 = Category.objects.create(name='Fifth', url='5th')\n->>> c5\n-<Category: Fifth>\n->>> f.clean(c5.id)\n-<Category: Fifth>\n-\n-# Delete a Category object *after* the ModelChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> Category.objects.get(url='5th').delete()\n->>> f.clean(c5.id)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n-\n->>> f = ModelChoiceField(Category.objects.filter(pk=c1.id), required=False)\n->>> print f.clean('')\n-None\n->>> f.clean('')\n->>> f.clean(str(c1.id))\n-<Category: Entertainment>\n->>> f.clean('100')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n-\n-# queryset can be changed after the field is created.\n->>> f.queryset = Category.objects.exclude(name='Fourth')\n->>> list(f.choices)\n-[(u'', u'---------'), (..., u'Entertainment'), (..., u\"It's a test\"), (..., u'Third')]\n->>> f.clean(c3.id)\n-<Category: Third>\n->>> f.clean(c4.id)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. That choice is not one of the available choices.']\n-\n-# check that we can safely iterate choices repeatedly\n->>> gen_one = list(f.choices)\n->>> gen_two = f.choices\n->>> gen_one[2]\n-(..., u\"It's a test\")\n->>> list(gen_two)\n-[(u'', u'---------'), (..., u'Entertainment'), (..., u\"It's a test\"), (..., u'Third')]\n-\n-# check that we can override the label_from_instance method to print custom labels (#4620)\n->>> f.queryset = Category.objects.all()\n->>> f.label_from_instance = lambda obj: \"category \" + str(obj)\n->>> list(f.choices)\n-[(u'', u'---------'), (..., 'category Entertainment'), (..., \"category It's a test\"), (..., 'category Third'), (..., 'category Fourth')]\n-\n-# ModelMultipleChoiceField ####################################################\n-\n->>> f = ModelMultipleChoiceField(Category.objects.all())\n->>> list(f.choices)\n-[(..., u'Entertainment'), (..., u\"It's a test\"), (..., u'Third'), (..., u'Fourth')]\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean([])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean([c1.id])\n-[<Category: Entertainment>]\n->>> f.clean([c2.id])\n-[<Category: It's a test>]\n->>> f.clean([str(c1.id)])\n-[<Category: Entertainment>]\n->>> f.clean([str(c1.id), str(c2.id)])\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> f.clean([c1.id, str(c2.id)])\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> f.clean((c1.id, str(c2.id)))\n-[<Category: Entertainment>, <Category: It's a test>]\n->>> f.clean(['100'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 100 is not one of the available choices.']\n->>> f.clean('hello')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a list of values.']\n->>> f.clean(['fail'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'\"fail\" is not a valid value for a primary key.']\n-\n-# Add a Category object *after* the ModelMultipleChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> c6 = Category.objects.create(id=6, name='Sixth', url='6th')\n->>> c6\n-<Category: Sixth>\n->>> f.clean([c6.id])\n-[<Category: Sixth>]\n-\n-# Delete a Category object *after* the ModelMultipleChoiceField has already been\n-# instantiated. This proves clean() checks the database during clean() rather\n-# than caching it at time of instantiation.\n->>> Category.objects.get(url='6th').delete()\n->>> f.clean([c6.id])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 6 is not one of the available choices.']\n-\n->>> f = ModelMultipleChoiceField(Category.objects.all(), required=False)\n->>> f.clean([])\n-[]\n->>> f.clean(())\n-[]\n->>> f.clean(['10'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n->>> f.clean([str(c3.id), '10'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n->>> f.clean([str(c1.id), '10'])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 10 is not one of the available choices.']\n-\n-# queryset can be changed after the field is created.\n->>> f.queryset = Category.objects.exclude(name='Fourth')\n->>> list(f.choices)\n-[(..., u'Entertainment'), (..., u\"It's a test\"), (..., u'Third')]\n->>> f.clean([c3.id])\n-[<Category: Third>]\n->>> f.clean([c4.id])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. ... is not one of the available choices.']\n->>> f.clean([str(c3.id), str(c4.id)])\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. ... is not one of the available choices.']\n-\n->>> f.queryset = Category.objects.all()\n->>> f.label_from_instance = lambda obj: \"multicategory \" + str(obj)\n->>> list(f.choices)\n-[(..., 'multicategory Entertainment'), (..., \"multicategory It's a test\"), (..., 'multicategory Third'), (..., 'multicategory Fourth')]\n-\n-# OneToOneField ###############################################################\n-\n->>> class ImprovedArticleForm(ModelForm):\n-...     class Meta:\n-...         model = ImprovedArticle\n->>> ImprovedArticleForm.base_fields.keys()\n-['article']\n-\n->>> class ImprovedArticleWithParentLinkForm(ModelForm):\n-...     class Meta:\n-...         model = ImprovedArticleWithParentLink\n->>> ImprovedArticleWithParentLinkForm.base_fields.keys()\n-[]\n-\n->>> bw = BetterWriter(name=u'Joe Better', score=10)\n->>> bw.save()\n->>> sorted(model_to_dict(bw).keys())\n-['id', 'name', 'score', 'writer_ptr']\n-\n->>> class BetterWriterForm(ModelForm):\n-...     class Meta:\n-...         model = BetterWriter\n->>> form = BetterWriterForm({'name': 'Some Name', 'score': 12})\n->>> form.is_valid()\n-True\n->>> bw2 = form.save()\n->>> bw2.delete()\n-\n-\n->>> class WriterProfileForm(ModelForm):\n-...     class Meta:\n-...         model = WriterProfile\n->>> form = WriterProfileForm()\n->>> print form.as_p()\n-<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n-<option value=\"\" selected=\"selected\">---------</option>\n-<option value=\"...\">Bob Woodward</option>\n-<option value=\"...\">Carl Bernstein</option>\n-<option value=\"...\">Joe Better</option>\n-<option value=\"...\">Mike Royko</option>\n-</select></p>\n-<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" id=\"id_age\" /></p>\n-\n->>> data = {\n-...     'writer': unicode(w_woodward.pk),\n-...     'age': u'65',\n-... }\n->>> form = WriterProfileForm(data)\n->>> instance = form.save()\n->>> instance\n-<WriterProfile: Bob Woodward is 65>\n-\n->>> form = WriterProfileForm(instance=instance)\n->>> print form.as_p()\n-<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n-<option value=\"\">---------</option>\n-<option value=\"...\" selected=\"selected\">Bob Woodward</option>\n-<option value=\"...\">Carl Bernstein</option>\n-<option value=\"...\">Joe Better</option>\n-<option value=\"...\">Mike Royko</option>\n-</select></p>\n-<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" value=\"65\" id=\"id_age\" /></p>\n-\n-# PhoneNumberField ############################################################\n-\n->>> class PhoneNumberForm(ModelForm):\n-...     class Meta:\n-...         model = PhoneNumber\n->>> f = PhoneNumberForm({'phone': '(312) 555-1212', 'description': 'Assistance'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['phone']\n-u'312-555-1212'\n->>> f.cleaned_data['description']\n-u'Assistance'\n-\n-# FileField ###################################################################\n-\n-# File forms.\n-\n->>> class TextFileForm(ModelForm):\n-...     class Meta:\n-...         model = TextFile\n-\n-# Test conditions when files is either not given or empty.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'})\n->>> f.is_valid()\n-False\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={})\n->>> f.is_valid()\n-False\n-\n-# Upload a file and ensure it all works as expected.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['file'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test1.txt>\n-\n->>> instance.file.delete()\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['file'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test1.txt>\n-\n-# Check if the max_length attribute has been inherited from the model.\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test-maxlength.txt', 'hello world')})\n->>> f.is_valid()\n-False\n-\n-# Edit an instance that already has the file defined in the model. This will not\n-# save the file again, but leave it exactly as it is.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, instance=instance)\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['file']\n-<FieldFile: tests/test1.txt>\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test1.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n-\n-# Override the file by uploading a new one.\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test2.txt', 'hello world')}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test2.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test2.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test2.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n-\n->>> instance.delete()\n-\n-# Test the non-required FileField\n->>> f = TextFileForm(data={'description': u'Assistance'})\n->>> f.fields['file'].required = False\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: None>\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test3.txt', 'hello world')}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test3.txt>\n-\n-# Instance can be edited w/out re-uploading the file and existing file should be preserved.\n-\n->>> f = TextFileForm(data={'description': u'New Description'}, instance=instance)\n->>> f.fields['file'].required = False\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.description\n-u'New Description'\n->>> instance.file\n-<FieldFile: tests/test3.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n->>> instance.delete()\n-\n->>> f = TextFileForm(data={'description': u'Assistance'}, files={'file': SimpleUploadedFile('test3.txt', 'hello world')})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.file\n-<FieldFile: tests/test3.txt>\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.file.delete()\n->>> instance.delete()\n-\n-# BigIntegerField ################################################################\n->>> class BigIntForm(forms.ModelForm):\n-...     class Meta:\n-...         model = BigInt\n-...\n->>> bif = BigIntForm({'biggie': '-9223372036854775808'})\n->>> bif.is_valid()\n-True\n->>> bif = BigIntForm({'biggie': '-9223372036854775809'})\n->>> bif.is_valid()\n-False\n->>> bif.errors\n-{'biggie': [u'Ensure this value is greater than or equal to -9223372036854775808.']}\n->>> bif = BigIntForm({'biggie': '9223372036854775807'})\n->>> bif.is_valid()\n-True\n->>> bif = BigIntForm({'biggie': '9223372036854775808'})\n->>> bif.is_valid()\n-False\n->>> bif.errors\n-{'biggie': [u'Ensure this value is less than or equal to 9223372036854775807.']}\n-\"\"\"}\n-\n-if test_images:\n-    __test__['API_TESTS'] += \"\"\"\n-# ImageField ###################################################################\n-\n-# ImageField and FileField are nearly identical, but they differ slighty when\n-# it comes to validation. This specifically tests that #6302 is fixed for\n-# both file fields and image fields.\n-\n->>> class ImageFileForm(ModelForm):\n-...     class Meta:\n-...         model = ImageFile\n-\n->>> image_data = open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb').read()\n->>> image_data2 = open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb').read()\n-\n->>> f = ImageFileForm(data={'description': u'An image'}, files={'image': SimpleUploadedFile('test.png', image_data)})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['image'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n-\n->>> f = ImageFileForm(data={'description': u'An image'}, files={'image': SimpleUploadedFile('test.png', image_data)})\n->>> f.is_valid()\n-True\n->>> type(f.cleaned_data['image'])\n-<class 'django.core.files.uploadedfile.SimpleUploadedFile'>\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Edit an instance that already has the (required) image defined in the model. This will not\n-# save the image again, but leave it exactly as it is.\n-\n->>> f = ImageFileForm(data={'description': u'Look, it changed'}, instance=instance)\n->>> f.is_valid()\n-True\n->>> f.cleaned_data['image']\n-<...FieldFile: tests/test.png>\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test.png>\n->>> instance.height\n-16\n->>> instance.width\n-16\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n-\n-# Override the file by uploading a new one.\n-\n->>> f = ImageFileForm(data={'description': u'Changed it'}, files={'image': SimpleUploadedFile('test2.png', image_data2)}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test2.png>\n->>> instance.height\n-32\n->>> instance.width\n-48\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n->>> instance.delete()\n-\n->>> f = ImageFileForm(data={'description': u'Changed it'}, files={'image': SimpleUploadedFile('test2.png', image_data2)})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test2.png>\n->>> instance.height\n-32\n->>> instance.width\n-48\n-\n-# Delete the current file since this is not done by Django, but don't save\n-# because the dimension fields are not null=True.\n->>> instance.image.delete(save=False)\n->>> instance.delete()\n-\n-# Test the non-required ImageField\n-\n->>> class OptionalImageFileForm(ModelForm):\n-...     class Meta:\n-...         model = OptionalImageFile\n-\n->>> f = OptionalImageFileForm(data={'description': u'Test'})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: None>\n->>> instance.width\n->>> instance.height\n-\n->>> f = OptionalImageFileForm(data={'description': u'And a final one'}, files={'image': SimpleUploadedFile('test3.png', image_data)}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test3.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Editing the instance without re-uploading the image should not affect the image or its width/height properties\n->>> f = OptionalImageFileForm(data={'description': u'New Description'}, instance=instance)\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.description\n-u'New Description'\n->>> instance.image\n-<...FieldFile: tests/test3.png>\n->>> instance.width\n-16\n->>> instance.height\n-16\n-\n-# Delete the current file since this is not done by Django.\n->>> instance.image.delete()\n->>> instance.delete()\n-\n->>> f = OptionalImageFileForm(data={'description': u'And a final one'}, files={'image': SimpleUploadedFile('test4.png', image_data2)})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: tests/test4.png>\n->>> instance.width\n-48\n->>> instance.height\n-32\n->>> instance.delete()\n-\n-# Test callable upload_to behavior that's dependent on the value of another field in the model\n->>> f = ImageFileForm(data={'description': u'And a final one', 'path': 'foo'}, files={'image': SimpleUploadedFile('test4.png', image_data)})\n->>> f.is_valid()\n-True\n->>> instance = f.save()\n->>> instance.image\n-<...FieldFile: foo/test4.png>\n->>> instance.delete()\n-\"\"\"\n-\n-__test__['API_TESTS'] += \"\"\"\n-\n-# Media on a ModelForm ########################################################\n-\n-# Similar to a regular Form class you can define custom media to be used on\n-# the ModelForm.\n-\n->>> class ModelFormWithMedia(ModelForm):\n-...     class Media:\n-...         js = ('/some/form/javascript',)\n-...         css = {\n-...             'all': ('/some/form/css',)\n-...         }\n-...     class Meta:\n-...         model = PhoneNumber\n->>> f = ModelFormWithMedia()\n->>> print f.media\n-<link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n-<script type=\"text/javascript\" src=\"/some/form/javascript\"></script>\n-\n->>> class CommaSeparatedIntegerForm(ModelForm):\n-...    class Meta:\n-...        model = CommaSeparatedInteger\n-\n->>> f = CommaSeparatedIntegerForm({'field': '1,2,3'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u'1,2,3'}\n->>> f = CommaSeparatedIntegerForm({'field': '1a,2'})\n->>> f.errors\n-{'field': [u'Enter only digits separated by commas.']}\n->>> f = CommaSeparatedIntegerForm({'field': ',,,,'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u',,,,'}\n->>> f = CommaSeparatedIntegerForm({'field': '1.2'})\n->>> f.errors\n-{'field': [u'Enter only digits separated by commas.']}\n->>> f = CommaSeparatedIntegerForm({'field': '1,a,2'})\n->>> f.errors\n-{'field': [u'Enter only digits separated by commas.']}\n->>> f = CommaSeparatedIntegerForm({'field': '1,,2'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u'1,,2'}\n->>> f = CommaSeparatedIntegerForm({'field': '1'})\n->>> f.is_valid()\n-True\n->>> f.cleaned_data\n-{'field': u'1'}\n-\n-This Price instance generated by this form is not valid because the quantity\n-field is required, but the form is valid because the field is excluded from\n-the form. This is for backwards compatibility.\n-\n->>> class PriceForm(ModelForm):\n-...     class Meta:\n-...         model = Price\n-...         exclude = ('quantity',)\n->>> form = PriceForm({'price': '6.00'})\n->>> form.is_valid()\n-True\n->>> price = form.save(commit=False)\n->>> price.full_clean()\n-Traceback (most recent call last):\n-  ...\n-ValidationError: {'quantity': [u'This field cannot be null.']}\n-\n-The form should not validate fields that it doesn't contain even if they are\n-specified using 'fields', not 'exclude'.\n-...     class Meta:\n-...         model = Price\n-...         fields = ('price',)\n->>> form = PriceForm({'price': '6.00'})\n->>> form.is_valid()\n-True\n-\n-The form should still have an instance of a model that is not complete and\n-not saved into a DB yet.\n-\n->>> form.instance.price\n-Decimal('6.00')\n->>> form.instance.quantity is None\n-True\n->>> form.instance.pk is None\n-True\n-\n-# Choices on CharField and IntegerField\n->>> class ArticleForm(ModelForm):\n-...     class Meta:\n-...         model = Article\n->>> f = ArticleForm()\n->>> f.fields['status'].clean('42')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. 42 is not one of the available choices.']\n-\n->>> class ArticleStatusForm(ModelForm):\n-...     class Meta:\n-...         model = ArticleStatus\n->>> f = ArticleStatusForm()\n->>> f.fields['status'].clean('z')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Select a valid choice. z is not one of the available choices.']\n-\n-# Foreign keys which use to_field #############################################\n-\n->>> apple = Inventory.objects.create(barcode=86, name='Apple')\n->>> pear = Inventory.objects.create(barcode=22, name='Pear')\n->>> core = Inventory.objects.create(barcode=87, name='Core', parent=apple)\n-\n->>> field = ModelChoiceField(Inventory.objects.all(), to_field_name='barcode')\n->>> for choice in field.choices:\n-...     print choice\n-(u'', u'---------')\n-(86, u'Apple')\n-(87, u'Core')\n-(22, u'Pear')\n-\n->>> class InventoryForm(ModelForm):\n-...     class Meta:\n-...         model = Inventory\n->>> form = InventoryForm(instance=core)\n->>> print form['parent']\n-<select name=\"parent\" id=\"id_parent\">\n-<option value=\"\">---------</option>\n-<option value=\"86\" selected=\"selected\">Apple</option>\n-<option value=\"87\">Core</option>\n-<option value=\"22\">Pear</option>\n-</select>\n-\n->>> data = model_to_dict(core)\n->>> data['parent'] = '22'\n->>> form = InventoryForm(data=data, instance=core)\n->>> core = form.save()\n->>> core.parent\n-<Inventory: Pear>\n-\n->>> class CategoryForm(ModelForm):\n-...     description = forms.CharField()\n-...     class Meta:\n-...         model = Category\n-...         fields = ['description', 'url']\n-\n->>> CategoryForm.base_fields.keys()\n-['description', 'url']\n-\n->>> print CategoryForm()\n-<tr><th><label for=\"id_description\">Description:</label></th><td><input type=\"text\" name=\"description\" id=\"id_description\" /></td></tr>\n-<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n-\n-# to_field_name should also work on ModelMultipleChoiceField ##################\n-\n->>> field = ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n->>> for choice in field.choices:\n-...     print choice\n-(86, u'Apple')\n-(87, u'Core')\n-(22, u'Pear')\n->>> field.clean([86])\n-[<Inventory: Apple>]\n-\n->>> class SelectInventoryForm(forms.Form):\n-...     items = ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n->>> form = SelectInventoryForm({'items': [87, 22]})\n->>> form.is_valid()\n-True\n->>> form.cleaned_data\n-{'items': [<Inventory: Core>, <Inventory: Pear>]}\n-\n-# Model field that returns None to exclude itself with explicit fields ########\n-\n->>> class CustomFieldForExclusionForm(ModelForm):\n-...     class Meta:\n-...         model = CustomFieldForExclusionModel\n-...         fields = ['name', 'markup']\n-\n->>> CustomFieldForExclusionForm.base_fields.keys()\n-['name']\n-\n->>> print CustomFieldForExclusionForm()\n-<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"10\" /></td></tr>\n-\n-# Clean up\n->>> import shutil\n->>> shutil.rmtree(temp_storage_dir)\n-\"\"\""
        },
        {
            "sha": "f90812c145fe5d50ee088611ee9c52e634d9d331",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 1282,
            "deletions": 7,
            "changes": 1289,
            "blob_url": "https://github.com/django/django/blob/aa5506d6f69180820db8f1811b4c8780d39a5733/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/aa5506d6f69180820db8f1811b4c8780d39a5733/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=aa5506d6f69180820db8f1811b4c8780d39a5733",
            "patch": "@@ -1,10 +1,359 @@\n import datetime\n-from django.test import TestCase\n+import os\n+from decimal import Decimal\n+\n from django import forms\n-from models import Category, Writer, Book, DerivedBook, Post, FlexibleDatePost\n-from mforms import (ProductForm, PriceForm, BookForm, DerivedBookForm,\n-                   ExplicitPKForm, PostForm, DerivedPostForm, CustomWriterForm,\n-                   FlexDatePostForm)\n+from django.test import TestCase\n+from django.core.files.uploadedfile import SimpleUploadedFile\n+from django.core.validators import ValidationError\n+from django.forms.models import model_to_dict\n+from django.utils.unittest import skipUnless\n+\n+from modeltests.model_forms.models import (Article, ArticleStatus,\n+    BetterWriter, BigInt, Book, Category, CommaSeparatedInteger,\n+    CustomFieldForExclusionModel, DerivedBook, DerivedPost, ExplicitPK,\n+    FlexibleDatePost, ImageFile, ImprovedArticle,\n+    ImprovedArticleWithParentLink, Inventory, OptionalImageFile, PhoneNumber,\n+    Post, Price, Product, TextFile, Writer, WriterProfile,\n+    test_images)\n+\n+\n+class ProductForm(forms.ModelForm):\n+    class Meta:\n+        model = Product\n+\n+\n+class PriceForm(forms.ModelForm):\n+    class Meta:\n+        model = Price\n+\n+\n+class BookForm(forms.ModelForm):\n+    class Meta:\n+       model = Book\n+\n+\n+class DerivedBookForm(forms.ModelForm):\n+    class Meta:\n+        model = DerivedBook\n+\n+\n+class ExplicitPKForm(forms.ModelForm):\n+    class Meta:\n+        model = ExplicitPK\n+        fields = ('key', 'desc',)\n+\n+\n+class PostForm(forms.ModelForm):\n+    class Meta:\n+        model = Post\n+\n+\n+class DerivedPostForm(forms.ModelForm):\n+    class Meta:\n+        model = DerivedPost\n+\n+\n+class CustomWriterForm(forms.ModelForm):\n+   name = forms.CharField(required=False)\n+\n+   class Meta:\n+       model = Writer\n+\n+\n+class FlexDatePostForm(forms.ModelForm):\n+    class Meta:\n+        model = FlexibleDatePost\n+\n+\n+class BaseCategoryForm(forms.ModelForm):\n+    class Meta:\n+        model = Category\n+\n+\n+class ArticleForm(forms.ModelForm):\n+    class Meta:\n+        model = Article\n+\n+\n+class ArticleForm(forms.ModelForm):\n+    class Meta:\n+        model = Article\n+\n+class PartialArticleForm(forms.ModelForm):\n+    class Meta:\n+        model = Article\n+        fields = ('headline','pub_date')\n+\n+class RoykoForm(forms.ModelForm):\n+    class Meta:\n+        model = Writer\n+\n+class TestArticleForm(forms.ModelForm):\n+    class Meta:\n+        model = Article\n+\n+class PartialArticleFormWithSlug(forms.ModelForm):\n+    class Meta:\n+        model = Article\n+        fields=('headline', 'slug', 'pub_date')\n+\n+class ArticleStatusForm(forms.ModelForm):\n+    class Meta:\n+        model = ArticleStatus\n+\n+class InventoryForm(forms.ModelForm):\n+    class Meta:\n+        model = Inventory\n+\n+class SelectInventoryForm(forms.Form):\n+    items = forms.ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n+\n+class CustomFieldForExclusionForm(forms.ModelForm):\n+    class Meta:\n+        model = CustomFieldForExclusionModel\n+        fields = ['name', 'markup']\n+\n+class ShortCategory(forms.ModelForm):\n+    name = forms.CharField(max_length=5)\n+    slug = forms.CharField(max_length=5)\n+    url = forms.CharField(max_length=3)\n+\n+class ImprovedArticleForm(forms.ModelForm):\n+    class Meta:\n+        model = ImprovedArticle\n+\n+class ImprovedArticleWithParentLinkForm(forms.ModelForm):\n+    class Meta:\n+        model = ImprovedArticleWithParentLink\n+\n+class BetterWriterForm(forms.ModelForm):\n+    class Meta:\n+        model = BetterWriter\n+\n+class WriterProfileForm(forms.ModelForm):\n+    class Meta:\n+        model = WriterProfile\n+\n+class PhoneNumberForm(forms.ModelForm):\n+    class Meta:\n+        model = PhoneNumber\n+\n+class TextFileForm(forms.ModelForm):\n+    class Meta:\n+        model = TextFile\n+\n+class BigIntForm(forms.ModelForm):\n+    class Meta:\n+        model = BigInt\n+\n+class ImageFileForm(forms.ModelForm):\n+    class Meta:\n+        model = ImageFile\n+\n+class OptionalImageFileForm(forms.ModelForm):\n+    class Meta:\n+        model = OptionalImageFile\n+\n+class ModelFormWithMedia(forms.ModelForm):\n+    class Media:\n+        js = ('/some/form/javascript',)\n+        css = {\n+            'all': ('/some/form/css',)\n+        }\n+    class Meta:\n+        model = PhoneNumber\n+\n+class CommaSeparatedIntegerForm(forms.ModelForm):\n+   class Meta:\n+       model = CommaSeparatedInteger\n+\n+class PriceFormWithoutQuantity(forms.ModelForm):\n+    class Meta:\n+        model = Price\n+        exclude = ('quantity',)\n+\n+\n+class ModelFormBaseTest(TestCase):\n+    def test_base_form(self):\n+        self.assertEqual(BaseCategoryForm.base_fields.keys(),\n+                         ['name', 'slug', 'url'])\n+\n+    def test_extra_fields(self):\n+        class ExtraFields(BaseCategoryForm):\n+            some_extra_field = forms.BooleanField()\n+\n+        self.assertEqual(ExtraFields.base_fields.keys(),\n+                         ['name', 'slug', 'url', 'some_extra_field'])\n+\n+    def test_replace_field(self):\n+        class ReplaceField(forms.ModelForm):\n+            url = forms.BooleanField()\n+\n+            class Meta:\n+                model = Category\n+\n+        self.assertTrue(isinstance(ReplaceField.base_fields['url'],\n+                                     forms.fields.BooleanField))\n+\n+    def test_override_field(self):\n+        class WriterForm(forms.ModelForm):\n+            book = forms.CharField(required=False)\n+\n+            class Meta:\n+                model = Writer\n+\n+        wf = WriterForm({'name': 'Richard Lockridge'})\n+        self.assertTrue(wf.is_valid())\n+\n+    def test_limit_fields(self):\n+        class LimitFields(forms.ModelForm):\n+            class Meta:\n+                model = Category\n+                fields = ['url']\n+\n+        self.assertEqual(LimitFields.base_fields.keys(),\n+                         ['url'])\n+\n+    def test_exclude_fields(self):\n+        class ExcludeFields(forms.ModelForm):\n+            class Meta:\n+                model = Category\n+                exclude = ['url']\n+\n+        self.assertEqual(ExcludeFields.base_fields.keys(),\n+                         ['name', 'slug'])\n+\n+    def test_confused_form(self):\n+        class ConfusedForm(forms.ModelForm):\n+            \"\"\" Using 'fields' *and* 'exclude'. Not sure why you'd want to do\n+            this, but uh, \"be liberal in what you accept\" and all.\n+            \"\"\"\n+            class Meta:\n+                model = Category\n+                fields = ['name', 'url']\n+                exclude = ['url']\n+\n+        self.assertEqual(ConfusedForm.base_fields.keys(),\n+                         ['name'])\n+\n+    def test_mixmodel_form(self):\n+        class MixModelForm(BaseCategoryForm):\n+            \"\"\" Don't allow more than one 'model' definition in the\n+            inheritance hierarchy.  Technically, it would generate a valid\n+            form, but the fact that the resulting save method won't deal with\n+            multiple objects is likely to trip up people not familiar with the\n+            mechanics.\n+            \"\"\"\n+            class Meta:\n+                model = Article\n+            # MixModelForm is now an Article-related thing, because MixModelForm.Meta\n+            # overrides BaseCategoryForm.Meta.\n+\n+        self.assertEqual(\n+            MixModelForm.base_fields.keys(),\n+            ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n+        )\n+\n+    def test_article_form(self):\n+        self.assertEqual(\n+            ArticleForm.base_fields.keys(),\n+            ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n+        )\n+\n+    def test_bad_form(self):\n+        #First class with a Meta class wins...\n+        class BadForm(ArticleForm, BaseCategoryForm):\n+            pass\n+\n+        self.assertEqual(\n+            BadForm.base_fields.keys(),\n+            ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n+        )\n+\n+    def test_subcategory_form(self):\n+        class SubCategoryForm(BaseCategoryForm):\n+            \"\"\" Subclassing without specifying a Meta on the class will use\n+            the parent's Meta (or the first parent in the MRO if there are\n+            multiple parent classes).\n+            \"\"\"\n+            pass\n+\n+        self.assertEqual(SubCategoryForm.base_fields.keys(),\n+                         ['name', 'slug', 'url'])\n+\n+    def test_subclassmeta_form(self):\n+        class SomeCategoryForm(forms.ModelForm):\n+             checkbox = forms.BooleanField()\n+\n+             class Meta:\n+                 model = Category\n+\n+        class SubclassMeta(SomeCategoryForm):\n+            \"\"\" We can also subclass the Meta inner class to change the fields\n+            list.\n+            \"\"\"\n+            class Meta(SomeCategoryForm.Meta):\n+                exclude = ['url']\n+\n+        self.assertEqual(\n+            str(SubclassMeta()),\n+            \"\"\"<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_checkbox\">Checkbox:</label></th><td><input type=\"checkbox\" name=\"checkbox\" id=\"id_checkbox\" /></td></tr>\"\"\"\n+            )\n+\n+    def test_orderfields_form(self):\n+        class OrderFields(forms.ModelForm):\n+            class Meta:\n+                model = Category\n+                fields = ['url', 'name']\n+\n+        self.assertEqual(OrderFields.base_fields.keys(),\n+                         ['url', 'name'])\n+        self.assertEqual(\n+            str(OrderFields()),\n+            \"\"\"<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\n+<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\"\"\"\n+            )\n+\n+    def test_orderfields2_form(self):\n+        class OrderFields2(forms.ModelForm):\n+            class Meta:\n+                model = Category\n+                fields = ['slug', 'url', 'name']\n+                exclude = ['url']\n+\n+        self.assertEqual(OrderFields2.base_fields.keys(),\n+                         ['slug', 'name'])\n+\n+\n+class TestWidgetForm(forms.ModelForm):\n+    class Meta:\n+        model = Category\n+        fields = ['name', 'url', 'slug']\n+        widgets = {\n+            'name': forms.Textarea,\n+            'url': forms.TextInput(attrs={'class': 'url'})\n+        }\n+\n+\n+\n+class TestWidgets(TestCase):\n+    def test_base_widgets(self):\n+        frm = TestWidgetForm()\n+        self.assertEqual(\n+            str(frm['name']),\n+            '<textarea id=\"id_name\" rows=\"10\" cols=\"40\" name=\"name\"></textarea>'\n+        )\n+        self.assertEqual(\n+            str(frm['url']),\n+            '<input id=\"id_url\" type=\"text\" class=\"url\" name=\"url\" maxlength=\"40\" />'\n+        )\n+        self.assertEqual(\n+            str(frm['slug']),\n+            '<input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" />'\n+        )\n \n \n class IncompleteCategoryFormWithFields(forms.ModelForm):\n@@ -43,6 +392,9 @@ def test_notrequired_overrides_notblank(self):\n         form = CustomWriterForm({})\n         assert form.is_valid()\n \n+\n+\n+\n # unique/unique_together validation\n class UniqueTest(TestCase):\n     def setUp(self):\n@@ -114,10 +466,17 @@ def test_abstract_inherited_unique_together(self):\n         title = 'Boss'\n         isbn = '12345'\n         dbook = DerivedBook.objects.create(title=title, author=self.writer, isbn=isbn)\n-        form = DerivedBookForm({'title': 'Other', 'author': self.writer.pk, 'isbn': '9876', 'suffix1': u'0', 'suffix2': u'0'})\n+        form = DerivedBookForm({\n+                    'title': 'Other',\n+                    'author': self.writer.pk,\n+                    'isbn': '9876',\n+                    'suffix1': u'0',\n+                    'suffix2': u'0'\n+                })\n         self.assertFalse(form.is_valid())\n         self.assertEqual(len(form.errors), 1)\n-        self.assertEqual(form.errors['__all__'], [u'Derived book with this Suffix1 and Suffix2 already exists.'])\n+        self.assertEqual(form.errors['__all__'],\n+                         [u'Derived book with this Suffix1 and Suffix2 already exists.'])\n \n     def test_explicitpk_unspecified(self):\n         \"\"\"Test for primary_key being in the form and failing validation.\"\"\"\n@@ -197,3 +556,919 @@ def test_unique_for_date_with_nullable_date(self):\n         form = FlexDatePostForm({'subtitle': \"Finally\", \"title\": \"Django 1.0 is released\",\n             \"slug\": \"Django 1.0\"}, instance=p)\n         self.assertTrue(form.is_valid())\n+\n+class OldFormForXTests(TestCase):\n+    def test_base_form(self):\n+        self.assertEqual(Category.objects.count(), 0)\n+        f = BaseCategoryForm()\n+        self.assertEqual(\n+            str(f),\n+            \"\"\"<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_slug\">Slug:</label></th><td><input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></td></tr>\n+<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>\"\"\"\n+            )\n+        self.assertEqual(\n+            str(f.as_ul()),\n+            \"\"\"<li><label for=\"id_name\">Name:</label> <input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n+<li><label for=\"id_slug\">Slug:</label> <input id=\"id_slug\" type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n+<li><label for=\"id_url\">The URL:</label> <input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></li>\"\"\"\n+            )\n+        self.assertEqual(\n+            str(f[\"name\"]),\n+            \"\"\"<input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"20\" />\"\"\")\n+\n+    def test_auto_id(self):\n+        f = BaseCategoryForm(auto_id=False)\n+        self.assertEqual(\n+            str(f.as_ul()),\n+            \"\"\"<li>Name: <input type=\"text\" name=\"name\" maxlength=\"20\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"20\" /></li>\n+<li>The URL: <input type=\"text\" name=\"url\" maxlength=\"40\" /></li>\"\"\"\n+            )\n+\n+    def test_with_data(self):\n+        self.assertEqual(Category.objects.count(), 0)\n+        f = BaseCategoryForm({'name': 'Entertainment',\n+                              'slug': 'entertainment',\n+                              'url': 'entertainment'})\n+        self.assertTrue(f.is_valid())\n+        self.assertEqual(f.cleaned_data['name'], 'Entertainment')\n+        self.assertEqual(f.cleaned_data['slug'], 'entertainment')\n+        self.assertEqual(f.cleaned_data['url'], 'entertainment')\n+        c1 = f.save()\n+        # Testing wether the same object is returned from the\n+        # ORM... not the fastest way...\n+\n+        self.assertEqual(c1, Category.objects.all()[0])\n+        self.assertEqual(c1.name, \"Entertainment\")\n+        self.assertEqual(Category.objects.count(), 1)\n+\n+        f = BaseCategoryForm({'name': \"It's a test\",\n+                              'slug': 'its-test',\n+                              'url': 'test'})\n+        self.assertTrue(f.is_valid())\n+        self.assertEqual(f.cleaned_data['name'], \"It's a test\")\n+        self.assertEqual(f.cleaned_data['slug'], 'its-test')\n+        self.assertEqual(f.cleaned_data['url'], 'test')\n+        c2 = f.save()\n+        # Testing wether the same object is returned from the\n+        # ORM... not the fastest way...\n+        self.assertEqual(c2, Category.objects.get(pk=c2.pk))\n+        self.assertEqual(c2.name, \"It's a test\")\n+        self.assertEqual(Category.objects.count(), 2)\n+\n+        # If you call save() with commit=False, then it will return an object that\n+        # hasn't yet been saved to the database. In this case, it's up to you to call\n+        # save() on the resulting model instance.\n+        f = BaseCategoryForm({'name': 'Third test', 'slug': 'third-test', 'url': 'third'})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data['url'], u'third')\n+        self.assertEqual(f.cleaned_data['name'], u'Third test')\n+        self.assertEqual(f.cleaned_data['slug'], u'third-test')\n+        c3 = f.save(commit=False)\n+        self.assertEqual(c3.name, \"Third test\")\n+        self.assertEqual(Category.objects.count(), 2)\n+        c3.save()\n+        self.assertEqual(Category.objects.count(), 3)\n+\n+        # If you call save() with invalid data, you'll get a ValueError.\n+        f = BaseCategoryForm({'name': '', 'slug': 'not a slug!', 'url': 'foo'})\n+        self.assertEqual(f.errors['name'], [u'This field is required.'])\n+        self.assertEqual(f.errors['slug'], [u\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"])\n+        with self.assertRaises(AttributeError):\n+            f.cleaned_data\n+        with self.assertRaises(ValueError):\n+            f.save()\n+        f = BaseCategoryForm({'name': '', 'slug': '', 'url': 'foo'})\n+        with self.assertRaises(ValueError):\n+            f.save()\n+\n+        # Create a couple of Writers.\n+        w_royko = Writer(name='Mike Royko')\n+        w_royko.save()\n+        w_woodward = Writer(name='Bob Woodward')\n+        w_woodward.save()\n+        # ManyToManyFields are represented by a MultipleChoiceField, ForeignKeys and any\n+        # fields with the 'choices' attribute are represented by a ChoiceField.\n+        f = ArticleForm(auto_id=False)\n+        self.assertEqual(unicode(f), '''<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n+<tr><th>Slug:</th><td><input type=\"text\" name=\"slug\" maxlength=\"50\" /></td></tr>\n+<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>\n+<tr><th>Writer:</th><td><select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"1\">Mike Royko</option>\n+</select></td></tr>\n+<tr><th>Article:</th><td><textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></td></tr>\n+<tr><th>Categories:</th><td><select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select><br /><span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></td></tr>\n+<tr><th>Status:</th><td><select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></td></tr>''')\n+\n+        # You can restrict a form to a subset of the complete list of fields\n+        # by providing a 'fields' argument. If you try to save a\n+        # model created with such a form, you need to ensure that the fields\n+        # that are _not_ on the form have default values, or are allowed to have\n+        # a value of None. If a field isn't specified on a form, the object created\n+        # from the form can't provide a value for that field!\n+        f = PartialArticleForm(auto_id=False)\n+        self.assertEqual(unicode(f), '''<tr><th>Headline:</th><td><input type=\"text\" name=\"headline\" maxlength=\"50\" /></td></tr>\n+<tr><th>Pub date:</th><td><input type=\"text\" name=\"pub_date\" /></td></tr>''')\n+\n+        # When the ModelForm is passed an instance, that instance's current values are\n+        # inserted as 'initial' data in each Field.\n+        w = Writer.objects.get(name='Mike Royko')\n+        f = RoykoForm(auto_id=False, instance=w)\n+        self.assertEqual(unicode(f), '''<tr><th>Name:</th><td><input type=\"text\" name=\"name\" value=\"Mike Royko\" maxlength=\"50\" /><br /><span class=\"helptext\">Use both first and last names.</span></td></tr>''')\n+\n+        art = Article(\n+                    headline='Test article',\n+                    slug='test-article',\n+                    pub_date=datetime.date(1988, 1, 4),\n+                    writer=w,\n+                    article='Hello.'\n+                )\n+        art.save()\n+        art_id_1 = art.id\n+        self.assertEqual(art_id_1 is not None, True)\n+        f = TestArticleForm(auto_id=False, instance=art)\n+        self.assertEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" value=\"Test article\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" value=\"test-article\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"1\" selected=\"selected\">Mike Royko</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>''')\n+        f = TestArticleForm({\n+                'headline': u'Test headline',\n+                'slug': 'test-headline',\n+                'pub_date': u'1984-02-06',\n+                'writer': unicode(w_royko.pk),\n+                'article': 'Hello.'\n+            }, instance=art)\n+        self.assertEqual(f.errors, {})\n+        self.assertEqual(f.is_valid(), True)\n+        test_art = f.save()\n+        self.assertEqual(test_art.id == art_id_1, True)\n+        test_art = Article.objects.get(id=art_id_1)\n+        self.assertEqual(test_art.headline, u'Test headline')\n+        # You can create a form over a subset of the available fields\n+        # by specifying a 'fields' argument to form_for_instance.\n+        f = PartialArticleFormWithSlug({\n+                'headline': u'New headline',\n+                'slug': 'new-headline',\n+                'pub_date': u'1988-01-04'\n+            }, auto_id=False, instance=art)\n+        self.assertEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>''')\n+        self.assertEqual(f.is_valid(), True)\n+        new_art = f.save()\n+        self.assertEqual(new_art.id == art_id_1, True)\n+        new_art = Article.objects.get(id=art_id_1)\n+        self.assertEqual(new_art.headline, u'New headline')\n+\n+        # Add some categories and test the many-to-many form output.\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        new_art.categories.add(Category.objects.get(name='Entertainment'))\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [\"Entertainment\"])\n+        f = TestArticleForm(auto_id=False, instance=new_art)\n+        self.assertEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" value=\"1988-01-04\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"1\" selected=\"selected\">Mike Royko</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\">Hello.</textarea></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\" selected=\"selected\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>''')\n+\n+        # Initial values can be provided for model forms\n+        f = TestArticleForm(\n+                auto_id=False,\n+                initial={\n+                    'headline': 'Your headline here',\n+                    'categories': [str(c1.id), str(c2.id)]\n+                })\n+        self.assertEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" value=\"Your headline here\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"1\">Mike Royko</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\" selected=\"selected\">Entertainment</option>\n+<option value=\"2\" selected=\"selected\">It&#39;s a test</option>\n+<option value=\"3\">Third test</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>''')\n+\n+        f = TestArticleForm({\n+                'headline': u'New headline',\n+                'slug': u'new-headline',\n+                'pub_date': u'1988-01-04',\n+                'writer': unicode(w_royko.pk),\n+                'article': u'Hello.',\n+                'categories': [unicode(c1.id), unicode(c2.id)]\n+            }, instance=new_art)\n+        new_art = f.save()\n+        self.assertEqual(new_art.id == art_id_1, True)\n+        new_art = Article.objects.get(id=art_id_1)\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')),\n+                         [\"Entertainment\", \"It's a test\"])\n+\n+        # Now, submit form data with no categories. This deletes the existing categories.\n+        f = TestArticleForm({'headline': u'New headline', 'slug': u'new-headline', 'pub_date': u'1988-01-04',\n+            'writer': unicode(w_royko.pk), 'article': u'Hello.'}, instance=new_art)\n+        new_art = f.save()\n+        self.assertEqual(new_art.id == art_id_1, True)\n+        new_art = Article.objects.get(id=art_id_1)\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+\n+        # Create a new article, with categories, via the form.\n+        f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n+            'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [unicode(c1.id), unicode(c2.id)]})\n+        new_art = f.save()\n+        art_id_2 = new_art.id\n+        self.assertEqual(art_id_2 not in (None, art_id_1), True)\n+        new_art = Article.objects.get(id=art_id_2)\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')), [\"Entertainment\", \"It's a test\"])\n+\n+        # Create a new article, with no categories, via the form.\n+        f = ArticleForm({'headline': u'The walrus was Paul', 'slug': u'walrus-was-paul', 'pub_date': u'1967-11-01',\n+            'writer': unicode(w_royko.pk), 'article': u'Test.'})\n+        new_art = f.save()\n+        art_id_3 = new_art.id\n+        self.assertEqual(art_id_3 not in (None, art_id_1, art_id_2), True)\n+        new_art = Article.objects.get(id=art_id_3)\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+\n+        # Create a new article, with categories, via the form, but use commit=False.\n+        # The m2m data won't be saved until save_m2m() is invoked on the form.\n+        f = ArticleForm({'headline': u'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': u'1967-11-01',\n+            'writer': unicode(w_royko.pk), 'article': u'Test.', 'categories': [unicode(c1.id), unicode(c2.id)]})\n+        new_art = f.save(commit=False)\n+\n+        # Manually save the instance\n+        new_art.save()\n+        art_id_4 = new_art.id\n+        self.assertEqual(art_id_4 not in (None, art_id_1, art_id_2, art_id_3), True)\n+\n+        # The instance doesn't have m2m data yet\n+        new_art = Article.objects.get(id=art_id_4)\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+\n+        # Save the m2m data on the form\n+        f.save_m2m()\n+        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')), [\"Entertainment\", \"It's a test\"])\n+\n+        # Here, we define a custom ModelForm. Because it happens to have the same fields as\n+        # the Category model, we can just call the form's save() to apply its changes to an\n+        # existing Category instance.\n+        cat = Category.objects.get(name='Third test')\n+        self.assertEqual(cat.name, \"Third test\")\n+        self.assertEqual(cat.id == c3.id, True)\n+        form = ShortCategory({'name': 'Third', 'slug': 'third', 'url': '3rd'}, instance=cat)\n+        self.assertEqual(form.save().name, 'Third')\n+        self.assertEqual(Category.objects.get(id=c3.id).name, 'Third')\n+\n+        # Here, we demonstrate that choices for a ForeignKey ChoiceField are determined\n+        # at runtime, based on the data in the database when the form is displayed, not\n+        # the data in the database when the form is instantiated.\n+        f = ArticleForm(auto_id=False)\n+        self.assertEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"1\">Mike Royko</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>''')\n+\n+        c4 = Category.objects.create(name='Fourth', url='4th')\n+        self.assertEqual(c4.name, 'Fourth')\n+        self.assertEqual(Writer.objects.create(name='Carl Bernstein').name, 'Carl Bernstein')\n+        self.assertEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" maxlength=\"50\" /></li>\n+<li>Slug: <input type=\"text\" name=\"slug\" maxlength=\"50\" /></li>\n+<li>Pub date: <input type=\"text\" name=\"pub_date\" /></li>\n+<li>Writer: <select name=\"writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"3\">Carl Bernstein</option>\n+<option value=\"1\">Mike Royko</option>\n+</select></li>\n+<li>Article: <textarea rows=\"10\" cols=\"40\" name=\"article\"></textarea></li>\n+<li>Categories: <select multiple=\"multiple\" name=\"categories\">\n+<option value=\"1\">Entertainment</option>\n+<option value=\"2\">It&#39;s a test</option>\n+<option value=\"3\">Third</option>\n+<option value=\"4\">Fourth</option>\n+</select> <span class=\"helptext\"> Hold down \"Control\", or \"Command\" on a Mac, to select more than one.</span></li>\n+<li>Status: <select name=\"status\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"1\">Draft</option>\n+<option value=\"2\">Pending</option>\n+<option value=\"3\">Live</option>\n+</select></li>''')\n+\n+        # ModelChoiceField ############################################################\n+\n+        f = forms.ModelChoiceField(Category.objects.all())\n+        self.assertEqual(list(f.choices), [\n+            (u'', u'---------'),\n+            (1, u'Entertainment'),\n+            (2, u\"It's a test\"),\n+            (3, u'Third'),\n+            (4, u'Fourth')])\n+        with self.assertRaises(ValidationError):\n+            f.clean('')\n+        with self.assertRaises(ValidationError):\n+            f.clean(None)\n+        with self.assertRaises(ValidationError):\n+            f.clean(0)\n+        self.assertEqual(f.clean(c3.id).name, 'Third')\n+        self.assertEqual(f.clean(c2.id).name, \"It's a test\")\n+\n+        # Add a Category object *after* the ModelChoiceField has already been\n+        # instantiated. This proves clean() checks the database during clean() rather\n+        # than caching it at time of instantiation.\n+        c5 = Category.objects.create(name='Fifth', url='5th')\n+        self.assertEqual(c5.name, 'Fifth')\n+        self.assertEqual(f.clean(c5.id).name, 'Fifth')\n+\n+        # Delete a Category object *after* the ModelChoiceField has already been\n+        # instantiated. This proves clean() checks the database during clean() rather\n+        # than caching it at time of instantiation.\n+        Category.objects.get(url='5th').delete()\n+        with self.assertRaises(ValidationError):\n+            f.clean(c5.id)\n+\n+        f = forms.ModelChoiceField(Category.objects.filter(pk=c1.id), required=False)\n+        self.assertEqual(f.clean(''), None)\n+        f.clean('')\n+        self.assertEqual(f.clean(str(c1.id)).name, \"Entertainment\")\n+        with self.assertRaises(ValidationError):\n+            f.clean('100')\n+\n+        # queryset can be changed after the field is created.\n+        f.queryset = Category.objects.exclude(name='Fourth')\n+        self.assertEqual(list(f.choices), [\n+            (u'', u'---------'),\n+            (1, u'Entertainment'),\n+            (2, u\"It's a test\"),\n+            (3, u'Third')])\n+        self.assertEqual(f.clean(c3.id).name, 'Third')\n+        with self.assertRaises(ValidationError):\n+            f.clean(c4.id)\n+\n+        # check that we can safely iterate choices repeatedly\n+        gen_one = list(f.choices)\n+        gen_two = f.choices\n+        self.assertEqual(gen_one[2], (2, u\"It's a test\"))\n+        self.assertEqual(list(gen_two), [\n+            (u'', u'---------'),\n+            (1, u'Entertainment'),\n+            (2, u\"It's a test\"),\n+            (3, u'Third')])\n+\n+        # check that we can override the label_from_instance method to print custom labels (#4620)\n+        f.queryset = Category.objects.all()\n+        f.label_from_instance = lambda obj: \"category \" + str(obj)\n+        self.assertEqual(list(f.choices), [\n+            (u'', u'---------'),\n+            (1, 'category Entertainment'),\n+            (2, \"category It's a test\"),\n+            (3, 'category Third'),\n+            (4, 'category Fourth')])\n+\n+        # ModelMultipleChoiceField ####################################################\n+\n+        f = forms.ModelMultipleChoiceField(Category.objects.all())\n+        self.assertEqual(list(f.choices), [\n+            (1, u'Entertainment'),\n+            (2, u\"It's a test\"),\n+            (3, u'Third'),\n+            (4, u'Fourth')])\n+        with self.assertRaises(ValidationError):\n+            f.clean(None)\n+        with self.assertRaises(ValidationError):\n+            f.clean([])\n+        self.assertEqual(map(lambda o: o.name, f.clean([c1.id])), [\"Entertainment\"])\n+        self.assertEqual(map(lambda o: o.name, f.clean([c2.id])), [\"It's a test\"])\n+        self.assertEqual(map(lambda o: o.name, f.clean([str(c1.id)])), [\"Entertainment\"])\n+        self.assertEqual(map(lambda o: o.name, f.clean([str(c1.id), str(c2.id)])), [\"Entertainment\", \"It's a test\"])\n+        self.assertEqual(map(lambda o: o.name, f.clean([c1.id, str(c2.id)])), [\"Entertainment\", \"It's a test\"])\n+        self.assertEqual(map(lambda o: o.name, f.clean((c1.id, str(c2.id)))), [\"Entertainment\", \"It's a test\"])\n+        with self.assertRaises(ValidationError):\n+            f.clean(['100'])\n+        with self.assertRaises(ValidationError):\n+            f.clean('hello')\n+        with self.assertRaises(ValidationError):\n+            f.clean(['fail'])\n+\n+        # Add a Category object *after* the ModelMultipleChoiceField has already been\n+        # instantiated. This proves clean() checks the database during clean() rather\n+        # than caching it at time of instantiation.\n+        c6 = Category.objects.create(id=6, name='Sixth', url='6th')\n+        self.assertEqual(c6.name, 'Sixth')\n+        self.assertEqual(map(lambda o: o.name, f.clean([c6.id])), [\"Sixth\"])\n+\n+        # Delete a Category object *after* the ModelMultipleChoiceField has already been\n+        # instantiated. This proves clean() checks the database during clean() rather\n+        # than caching it at time of instantiation.\n+        Category.objects.get(url='6th').delete()\n+        with self.assertRaises(ValidationError):\n+            f.clean([c6.id])\n+\n+        f = forms.ModelMultipleChoiceField(Category.objects.all(), required=False)\n+        self.assertEqual(f.clean([]), [])\n+        self.assertEqual(f.clean(()), [])\n+        with self.assertRaises(ValidationError):\n+            f.clean(['10'])\n+        with self.assertRaises(ValidationError):\n+            f.clean([str(c3.id), '10'])\n+        with self.assertRaises(ValidationError):\n+            f.clean([str(c1.id), '10'])\n+\n+        # queryset can be changed after the field is created.\n+        f.queryset = Category.objects.exclude(name='Fourth')\n+        self.assertEqual(list(f.choices), [\n+            (1, u'Entertainment'),\n+            (2, u\"It's a test\"),\n+            (3, u'Third')])\n+        self.assertEqual(map(lambda o: o.name, f.clean([c3.id])), [\"Third\"])\n+        with self.assertRaises(ValidationError):\n+            f.clean([c4.id])\n+        with self.assertRaises(ValidationError):\n+            f.clean([str(c3.id), str(c4.id)])\n+\n+        f.queryset = Category.objects.all()\n+        f.label_from_instance = lambda obj: \"multicategory \" + str(obj)\n+        self.assertEqual(list(f.choices), [\n+            (1, 'multicategory Entertainment'),\n+            (2, \"multicategory It's a test\"),\n+            (3, 'multicategory Third'),\n+            (4, 'multicategory Fourth')])\n+\n+        # OneToOneField ###############################################################\n+\n+        self.assertEqual(ImprovedArticleForm.base_fields.keys(), ['article'])\n+\n+        self.assertEqual(ImprovedArticleWithParentLinkForm.base_fields.keys(), [])\n+\n+        bw = BetterWriter(name=u'Joe Better', score=10)\n+        bw.save()\n+        self.assertEqual(sorted(model_to_dict(bw).keys()),\n+                         ['id', 'name', 'score', 'writer_ptr'])\n+\n+        form = BetterWriterForm({'name': 'Some Name', 'score': 12})\n+        self.assertEqual(form.is_valid(), True)\n+        bw2 = form.save()\n+        bw2.delete()\n+\n+        form = WriterProfileForm()\n+        self.assertEqual(form.as_p(), '''<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n+<option value=\"\" selected=\"selected\">---------</option>\n+<option value=\"2\">Bob Woodward</option>\n+<option value=\"3\">Carl Bernstein</option>\n+<option value=\"4\">Joe Better</option>\n+<option value=\"1\">Mike Royko</option>\n+</select></p>\n+<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" id=\"id_age\" /></p>''')\n+\n+        data = {\n+            'writer': unicode(w_woodward.pk),\n+            'age': u'65',\n+        }\n+        form = WriterProfileForm(data)\n+        instance = form.save()\n+        self.assertEqual(unicode(instance), 'Bob Woodward is 65')\n+\n+        form = WriterProfileForm(instance=instance)\n+        self.assertEqual(form.as_p(), '''<p><label for=\"id_writer\">Writer:</label> <select name=\"writer\" id=\"id_writer\">\n+<option value=\"\">---------</option>\n+<option value=\"2\" selected=\"selected\">Bob Woodward</option>\n+<option value=\"3\">Carl Bernstein</option>\n+<option value=\"4\">Joe Better</option>\n+<option value=\"1\">Mike Royko</option>\n+</select></p>\n+<p><label for=\"id_age\">Age:</label> <input type=\"text\" name=\"age\" value=\"65\" id=\"id_age\" /></p>''')\n+\n+    def test_phone_number_field(self):\n+        f = PhoneNumberForm({'phone': '(312) 555-1212', 'description': 'Assistance'})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data['phone'], u'312-555-1212')\n+        self.assertEqual(f.cleaned_data['description'], u'Assistance')\n+\n+    def test_file_field(self):\n+        # Test conditions when files is either not given or empty.\n+\n+        f = TextFileForm(data={'description': u'Assistance'})\n+        self.assertEqual(f.is_valid(), False)\n+        f = TextFileForm(data={'description': u'Assistance'}, files={})\n+        self.assertEqual(f.is_valid(), False)\n+\n+        # Upload a file and ensure it all works as expected.\n+\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(type(f.cleaned_data['file']), SimpleUploadedFile)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test1.txt')\n+\n+        instance.file.delete()\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test1.txt', 'hello world')})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(type(f.cleaned_data['file']), SimpleUploadedFile)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test1.txt')\n+\n+        # Check if the max_length attribute has been inherited from the model.\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test-maxlength.txt', 'hello world')})\n+        self.assertEqual(f.is_valid(), False)\n+\n+        # Edit an instance that already has the file defined in the model. This will not\n+        # save the file again, but leave it exactly as it is.\n+\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data['file'].name, 'tests/test1.txt')\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test1.txt')\n+\n+        # Delete the current file since this is not done by Django.\n+        instance.file.delete()\n+\n+        # Override the file by uploading a new one.\n+\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test2.txt', 'hello world')}, instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test2.txt')\n+\n+        # Delete the current file since this is not done by Django.\n+        instance.file.delete()\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test2.txt', 'hello world')})\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test2.txt')\n+\n+        # Delete the current file since this is not done by Django.\n+        instance.file.delete()\n+\n+        instance.delete()\n+\n+        # Test the non-required FileField\n+        f = TextFileForm(data={'description': u'Assistance'})\n+        f.fields['file'].required = False\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, '')\n+\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test3.txt', 'hello world')}, instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test3.txt')\n+\n+        # Instance can be edited w/out re-uploading the file and existing file should be preserved.\n+\n+        f = TextFileForm(\n+                data={'description': u'New Description'},\n+                instance=instance)\n+        f.fields['file'].required = False\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.description, u'New Description')\n+        self.assertEqual(instance.file.name, 'tests/test3.txt')\n+\n+        # Delete the current file since this is not done by Django.\n+        instance.file.delete()\n+        instance.delete()\n+\n+        f = TextFileForm(\n+                data={'description': u'Assistance'},\n+                files={'file': SimpleUploadedFile('test3.txt', 'hello world')})\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.file.name, 'tests/test3.txt')\n+\n+        # Delete the current file since this is not done by Django.\n+        instance.file.delete()\n+        instance.delete()\n+\n+    def test_big_integer_field(self):\n+        bif = BigIntForm({'biggie': '-9223372036854775808'})\n+        self.assertEqual(bif.is_valid(), True)\n+        bif = BigIntForm({'biggie': '-9223372036854775809'})\n+        self.assertEqual(bif.is_valid(), False)\n+        self.assertEqual(bif.errors, {'biggie': [u'Ensure this value is greater than or equal to -9223372036854775808.']})\n+        bif = BigIntForm({'biggie': '9223372036854775807'})\n+        self.assertEqual(bif.is_valid(), True)\n+        bif = BigIntForm({'biggie': '9223372036854775808'})\n+        self.assertEqual(bif.is_valid(), False)\n+        self.assertEqual(bif.errors, {'biggie': [u'Ensure this value is less than or equal to 9223372036854775807.']})\n+\n+    @skipUnless(test_images, \"PIL not installed\")\n+    def test_image_field(self):\n+        # ImageField and FileField are nearly identical, but they differ slighty when\n+        # it comes to validation. This specifically tests that #6302 is fixed for\n+        # both file fields and image fields.\n+\n+        image_data = open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb').read()\n+        image_data2 = open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb').read()\n+\n+        f = ImageFileForm(\n+                data={'description': u'An image'},\n+                files={'image': SimpleUploadedFile('test.png', image_data)})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(type(f.cleaned_data['image']), SimpleUploadedFile)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test.png')\n+        self.assertEqual(instance.width, 16)\n+        self.assertEqual(instance.height, 16)\n+\n+        # Delete the current file since this is not done by Django, but don't save\n+        # because the dimension fields are not null=True.\n+        instance.image.delete(save=False)\n+        f = ImageFileForm(\n+                data={'description': u'An image'},\n+                files={'image': SimpleUploadedFile('test.png', image_data)})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(type(f.cleaned_data['image']), SimpleUploadedFile)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test.png')\n+        self.assertEqual(instance.width, 16)\n+        self.assertEqual(instance.height, 16)\n+\n+        # Edit an instance that already has the (required) image defined in the model. This will not\n+        # save the image again, but leave it exactly as it is.\n+\n+        f = ImageFileForm(data={'description': u'Look, it changed'}, instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data['image'].name, 'tests/test.png')\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test.png')\n+        self.assertEqual(instance.height, 16)\n+        self.assertEqual(instance.width, 16)\n+\n+        # Delete the current file since this is not done by Django, but don't save\n+        # because the dimension fields are not null=True.\n+        instance.image.delete(save=False)\n+        # Override the file by uploading a new one.\n+\n+        f = ImageFileForm(\n+                data={'description': u'Changed it'},\n+                files={'image': SimpleUploadedFile('test2.png', image_data2)}, instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test2.png')\n+        self.assertEqual(instance.height, 32)\n+        self.assertEqual(instance.width, 48)\n+\n+        # Delete the current file since this is not done by Django, but don't save\n+        # because the dimension fields are not null=True.\n+        instance.image.delete(save=False)\n+        instance.delete()\n+\n+        f = ImageFileForm(\n+                data={'description': u'Changed it'},\n+                files={'image': SimpleUploadedFile('test2.png', image_data2)})\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test2.png')\n+        self.assertEqual(instance.height, 32)\n+        self.assertEqual(instance.width, 48)\n+\n+        # Delete the current file since this is not done by Django, but don't save\n+        # because the dimension fields are not null=True.\n+        instance.image.delete(save=False)\n+        instance.delete()\n+\n+        # Test the non-required ImageField\n+\n+        f = OptionalImageFileForm(data={'description': u'Test'})\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, None)\n+        self.assertEqual(instance.width, None)\n+        self.assertEqual(instance.height, None)\n+\n+        f = OptionalImageFileForm(\n+                data={'description': u'And a final one'},\n+                files={'image': SimpleUploadedFile('test3.png', image_data)}, instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test3.png')\n+        self.assertEqual(instance.width, 16)\n+        self.assertEqual(instance.height, 16)\n+\n+        # Editing the instance without re-uploading the image should not affect the image or its width/height properties\n+        f = OptionalImageFileForm(\n+                data={'description': u'New Description'},\n+                instance=instance)\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.description, u'New Description')\n+        self.assertEqual(instance.image.name, 'tests/test3.png')\n+        self.assertEqual(instance.width, 16)\n+        self.assertEqual(instance.height, 16)\n+\n+        # Delete the current file since this is not done by Django.\n+        instance.image.delete()\n+        instance.delete()\n+\n+        f = OptionalImageFileForm(\n+                data={'description': u'And a final one'},\n+                files={'image': SimpleUploadedFile('test4.png', image_data2)}\n+            )\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'tests/test4.png')\n+        self.assertEqual(instance.width, 48)\n+        self.assertEqual(instance.height, 32)\n+        instance.delete()\n+        # Test callable upload_to behavior that's dependent on the value of another field in the model\n+        f = ImageFileForm(\n+                data={'description': u'And a final one', 'path': 'foo'},\n+                files={'image': SimpleUploadedFile('test4.png', image_data)})\n+        self.assertEqual(f.is_valid(), True)\n+        instance = f.save()\n+        self.assertEqual(instance.image.name, 'foo/test4.png')\n+        instance.delete()\n+\n+    def test_media_on_modelform(self):\n+        # Similar to a regular Form class you can define custom media to be used on\n+        # the ModelForm.\n+        f = ModelFormWithMedia()\n+        self.assertEqual(unicode(f.media), '''<link href=\"/some/form/css\" type=\"text/css\" media=\"all\" rel=\"stylesheet\" />\n+<script type=\"text/javascript\" src=\"/some/form/javascript\"></script>''')\n+\n+        f = CommaSeparatedIntegerForm({'field': '1,2,3'})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data, {'field': u'1,2,3'})\n+        f = CommaSeparatedIntegerForm({'field': '1a,2'})\n+        self.assertEqual(f.errors, {'field': [u'Enter only digits separated by commas.']})\n+        f = CommaSeparatedIntegerForm({'field': ',,,,'})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data, {'field': u',,,,'})\n+        f = CommaSeparatedIntegerForm({'field': '1.2'})\n+        self.assertEqual(f.errors, {'field': [u'Enter only digits separated by commas.']})\n+        f = CommaSeparatedIntegerForm({'field': '1,a,2'})\n+        self.assertEqual(f.errors, {'field': [u'Enter only digits separated by commas.']})\n+        f = CommaSeparatedIntegerForm({'field': '1,,2'})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data, {'field': u'1,,2'})\n+        f = CommaSeparatedIntegerForm({'field': '1'})\n+        self.assertEqual(f.is_valid(), True)\n+        self.assertEqual(f.cleaned_data, {'field': u'1'})\n+\n+        # This Price instance generated by this form is not valid because the quantity\n+        # field is required, but the form is valid because the field is excluded from\n+        # the form. This is for backwards compatibility.\n+\n+        form = PriceFormWithoutQuantity({'price': '6.00'})\n+        self.assertEqual(form.is_valid(), True)\n+        price = form.save(commit=False)\n+        with self.assertRaises(ValidationError):\n+            price.full_clean()\n+\n+        # The form should not validate fields that it doesn't contain even if they are\n+        # specified using 'fields', not 'exclude'.\n+            class Meta:\n+                model = Price\n+                fields = ('price',)\n+        form = PriceFormWithoutQuantity({'price': '6.00'})\n+        self.assertEqual(form.is_valid(), True)\n+\n+        # The form should still have an instance of a model that is not complete and\n+        # not saved into a DB yet.\n+\n+        self.assertEqual(form.instance.price, Decimal('6.00'))\n+        self.assertEqual(form.instance.quantity is None, True)\n+        self.assertEqual(form.instance.pk is None, True)\n+\n+        # Choices on CharField and IntegerField\n+        f = ArticleForm()\n+        with self.assertRaises(ValidationError):\n+            f.fields['status'].clean('42')\n+\n+        f = ArticleStatusForm()\n+        with self.assertRaises(ValidationError):\n+            f.fields['status'].clean('z')\n+\n+    def test_foreignkeys_which_use_to_field(self):\n+        apple = Inventory.objects.create(barcode=86, name='Apple')\n+        pear = Inventory.objects.create(barcode=22, name='Pear')\n+        core = Inventory.objects.create(barcode=87, name='Core', parent=apple)\n+\n+        field = forms.ModelChoiceField(Inventory.objects.all(), to_field_name='barcode')\n+        self.assertEqual(tuple(field.choices), (\n+            (u'', u'---------'),\n+            (86, u'Apple'),\n+            (87, u'Core'),\n+            (22, u'Pear')))\n+\n+        form = InventoryForm(instance=core)\n+        self.assertEqual(unicode(form['parent']), '''<select name=\"parent\" id=\"id_parent\">\n+<option value=\"\">---------</option>\n+<option value=\"86\" selected=\"selected\">Apple</option>\n+<option value=\"87\">Core</option>\n+<option value=\"22\">Pear</option>\n+</select>''')\n+        data = model_to_dict(core)\n+        data['parent'] = '22'\n+        form = InventoryForm(data=data, instance=core)\n+        core = form.save()\n+        self.assertEqual(core.parent.name, 'Pear')\n+\n+        class CategoryForm(forms.ModelForm):\n+            description = forms.CharField()\n+            class Meta:\n+                model = Category\n+                fields = ['description', 'url']\n+\n+        self.assertEqual(CategoryForm.base_fields.keys(),\n+                         ['description', 'url'])\n+\n+        self.assertEqual(unicode(CategoryForm()), '''<tr><th><label for=\"id_description\">Description:</label></th><td><input type=\"text\" name=\"description\" id=\"id_description\" /></td></tr>\n+<tr><th><label for=\"id_url\">The URL:</label></th><td><input id=\"id_url\" type=\"text\" name=\"url\" maxlength=\"40\" /></td></tr>''')\n+        # to_field_name should also work on ModelMultipleChoiceField ##################\n+\n+        field = forms.ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n+        self.assertEqual(tuple(field.choices), ((86, u'Apple'), (87, u'Core'), (22, u'Pear')))\n+        self.assertEqual(map(lambda o: o.name, field.clean([86])), ['Apple'])\n+\n+        form = SelectInventoryForm({'items': [87, 22]})\n+        self.assertEqual(form.is_valid(), True)\n+        self.assertEqual(len(form.cleaned_data), 1)\n+        self.assertEqual(map(lambda o: o.name, form.cleaned_data['items']), ['Core', 'Pear'])\n+\n+    def test_model_field_that_returns_none_to_exclude_itself_with_explicit_fields(self):\n+        self.assertEqual(CustomFieldForExclusionForm.base_fields.keys(), ['name'])\n+        self.assertEqual(unicode(CustomFieldForExclusionForm()),\n+                         '''<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"10\" /></td></tr>''')"
        }
    ],
    "stats": {
        "total": 2698,
        "additions": 1283,
        "deletions": 1415
    }
}