{
    "author": "ramiro",
    "message": "Fixed #14305 -- Switched inspectdb to create unmanaged models.\n\nThanks Ian Kelly for the report and initial patch.",
    "sha": "08dc90bccf7c4ffa8b04064d74b54c1150af5ff9",
    "files": [
        {
            "sha": "42cc9c5dfef46a3efdd392df2542bf415a32ec50",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=08dc90bccf7c4ffa8b04064d74b54c1150af5ff9",
            "patch": "@@ -40,8 +40,9 @@ def handle_inspection(self, options):\n         cursor = connection.cursor()\n         yield \"# This is an auto-generated Django model module.\"\n         yield \"# You'll have to do the following manually to clean this up:\"\n-        yield \"#     * Rearrange models' order\"\n-        yield \"#     * Make sure each model has one field with primary_key=True\"\n+        yield \"#   * Rearrange models' order\"\n+        yield \"#   * Make sure each model has one field with primary_key=True\"\n+        yield \"#   * Remove `managed = False` lines for those models you wish to give write DB access\"\n         yield \"# Feel free to rename the models, but don't rename db_table values or field names.\"\n         yield \"#\"\n         yield \"# Also note: You'll have to insert the output of 'django-admin.py sqlcustom [appname]'\"\n@@ -224,5 +225,6 @@ def get_meta(self, table_name):\n         to the given database table name.\n         \"\"\"\n         return [\"    class Meta:\",\n+                \"        managed = False\",\n                 \"        db_table = '%s'\" % table_name,\n                 \"\"]"
        },
        {
            "sha": "67bce7e9764d29ef7166782a59cbd49bec3c6466",
            "filename": "docs/howto/legacy-databases.txt",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/docs%2Fhowto%2Flegacy-databases.txt",
            "raw_url": "https://github.com/django/django/raw/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/docs%2Fhowto%2Flegacy-databases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Flegacy-databases.txt?ref=08dc90bccf7c4ffa8b04064d74b54c1150af5ff9",
            "patch": "@@ -49,6 +49,35 @@ Once you've cleaned up your models, name the file ``models.py`` and put it in\n the Python package that holds your app. Then add the app to your\n :setting:`INSTALLED_APPS` setting.\n \n+If your plan is that your Django application(s) modify data (i.e. edit, remove\n+records and create new ones) in the existing database tables corresponding to\n+any of the introspected models then one of the manual review and edit steps\n+you need to perform on the resulting ``models.py`` file is to change the\n+Python declaration of each one of these models to specify it is a\n+:attr:`managed <django.db.models.Options.managed>` one. For example, consider\n+this generated model definition:\n+\n+.. parsed-literal::\n+\n+      class Person(models.Model):\n+          id = models.IntegerField(primary_key=True)\n+          first_name = models.ChaField(max_length=70)\n+          class Meta:\n+\t       **managed = False**\n+\t       db_table = 'CENSUS_PERSONS'\n+\n+If you wanted to modify existing data on your ``CENSUS_PERSONS`` SQL table\n+with Django you'd need to change the ``managed`` option highlighted above to\n+``True`` (or simply remove it to let it because ``True`` is its default value).\n+\n+This servers as an explicit opt-in to give your nascent Django project write\n+access to your precious data on a model by model basis.\n+\n+.. versionchanged:: 1.6\n+\n+The behavior by which introspected models are created as unmanaged ones is new\n+in Django 1.6.\n+\n Install the core Django tables\n ==============================\n "
        },
        {
            "sha": "4074495b9ae3db7206d55b22716accce25a73c48",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=08dc90bccf7c4ffa8b04064d74b54c1150af5ff9",
            "patch": "@@ -288,9 +288,24 @@ needed.\n ``inspectdb`` works with PostgreSQL, MySQL and SQLite. Foreign-key detection\n only works in PostgreSQL and with certain types of MySQL tables.\n \n+If your plan is that your Django application(s) modify data (i.e. edit, remove\n+records and create new ones) in the existing database tables corresponding to\n+any of the introspected models then one of the manual review and edit steps\n+you need to perform on the resulting ``models.py`` file is to change the\n+Python declaration of each one of these models to specify it is a\n+:attr:`managed <django.db.models.Options.managed>` one.\n+\n+This servers as an explicit opt-in to give your nascent Django project write\n+access to your precious data on a model by model basis.\n+\n The :djadminopt:`--database` option may be used to specify the\n database to introspect.\n \n+.. versionchanged:: 1.6\n+\n+The behavior by which introspected models are created as unmanaged ones is new\n+in Django 1.6.\n+\n loaddata <fixture fixture ...>\n ------------------------------\n "
        },
        {
            "sha": "d77e21bf92be2d66469af280eb7e2701f1e5fa61",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/08dc90bccf7c4ffa8b04064d74b54c1150af5ff9/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=08dc90bccf7c4ffa8b04064d74b54c1150af5ff9",
            "patch": "@@ -140,3 +140,13 @@ def test_special_column_name_introspection(self):\n         self.assertIn(\"field_field_0 = models.IntegerField(db_column='%s__')\" % base_name, output)\n         self.assertIn(\"field_field_1 = models.IntegerField(db_column='__field')\", output)\n         self.assertIn(\"prc_x = models.IntegerField(db_column='prc(%) x')\", output)\n+\n+    def test_managed_models(self):\n+        \"\"\"Test that by default the command generates models with `Meta.managed = False` (#14305)\"\"\"\n+        out = StringIO()\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_columntypes'),\n+                     stdout=out)\n+        output = out.getvalue()\n+        self.longMessage = False\n+        self.assertIn(\"        managed = False\", output, msg='inspectdb should generate unmanaged models.')"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 58,
        "deletions": 2
    }
}