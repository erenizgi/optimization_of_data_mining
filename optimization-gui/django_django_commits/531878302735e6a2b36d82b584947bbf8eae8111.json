{
    "author": "claudep",
    "message": "Fixed #17966 -- Isolated ProfileTestCase from custom AUTH_PROFILE_MODULE\n\nThanks Rob Golding for helping on the patch.",
    "sha": "531878302735e6a2b36d82b584947bbf8eae8111",
    "files": [
        {
            "sha": "b40157bfe2080eb0b2301254e1157fa0adf52d9b",
            "filename": "django/contrib/auth/tests/models.py",
            "status": "modified",
            "additions": 13,
            "deletions": 23,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/531878302735e6a2b36d82b584947bbf8eae8111/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/531878302735e6a2b36d82b584947bbf8eae8111/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py?ref=531878302735e6a2b36d82b584947bbf8eae8111",
            "patch": "@@ -5,39 +5,29 @@\n     SiteProfileNotAvailable, UserManager)\n \n \n-@override_settings(USE_TZ=False)\n+@override_settings(USE_TZ=False, AUTH_PROFILE_MODULE='')\n class ProfileTestCase(TestCase):\n-    fixtures = ['authtestdata.json']\n-\n-    def setUp(self):\n-        \"\"\"Backs up the AUTH_PROFILE_MODULE\"\"\"\n-        self.old_AUTH_PROFILE_MODULE = getattr(settings,\n-                                               'AUTH_PROFILE_MODULE', None)\n-\n-    def tearDown(self):\n-        \"\"\"Restores the AUTH_PROFILE_MODULE -- if it was not set it is deleted,\n-        otherwise the old value is restored\"\"\"\n-        if self.old_AUTH_PROFILE_MODULE is None and \\\n-                hasattr(settings, 'AUTH_PROFILE_MODULE'):\n-            del settings.AUTH_PROFILE_MODULE\n-\n-        if self.old_AUTH_PROFILE_MODULE is not None:\n-            settings.AUTH_PROFILE_MODULE = self.old_AUTH_PROFILE_MODULE\n \n     def test_site_profile_not_available(self):\n+        user = User.objects.create(username='testclient')\n+\n         # calling get_profile without AUTH_PROFILE_MODULE set\n-        if hasattr(settings, 'AUTH_PROFILE_MODULE'):\n-            del settings.AUTH_PROFILE_MODULE\n-        user = User.objects.get(username='testclient')\n-        self.assertRaises(SiteProfileNotAvailable, user.get_profile)\n+        del settings.AUTH_PROFILE_MODULE\n+        with self.assertRaisesRegexp(SiteProfileNotAvailable,\n+                \"You need to set AUTH_PROFILE_MODULE in your project\"):\n+            user.get_profile()\n \n         # Bad syntax in AUTH_PROFILE_MODULE:\n         settings.AUTH_PROFILE_MODULE = 'foobar'\n-        self.assertRaises(SiteProfileNotAvailable, user.get_profile)\n+        with self.assertRaisesRegexp(SiteProfileNotAvailable,\n+                \"app_label and model_name should be separated by a dot\"):\n+            user.get_profile()\n \n         # module that doesn't exist\n         settings.AUTH_PROFILE_MODULE = 'foo.bar'\n-        self.assertRaises(SiteProfileNotAvailable, user.get_profile)\n+        with self.assertRaisesRegexp(SiteProfileNotAvailable,\n+                \"Unable to load the profile model\"):\n+            user.get_profile()\n \n \n @override_settings(USE_TZ=False)"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 13,
        "deletions": 23
    }
}