{
    "author": "spookylukey",
    "message": "Fixed #15025 - template debug fails if there's a callable local var that generates an exception\n\nThanks to Tai Lee for the patch and report, also to Don Spaulding.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15187 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "80f48260630c3db98f6e0af282bc339eba999009",
    "files": [
        {
            "sha": "15109840b1535d06e96028c8afb2b5d5ba6481b6",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/80f48260630c3db98f6e0af282bc339eba999009/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/80f48260630c3db98f6e0af282bc339eba999009/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=80f48260630c3db98f6e0af282bc339eba999009",
            "patch": "@@ -8,11 +8,11 @@\n from django.http import HttpResponse, HttpResponseServerError, HttpResponseNotFound\n from django.template import (Template, Context, TemplateDoesNotExist,\n     TemplateSyntaxError)\n+from django.template.defaultfilters import force_escape, pprint\n from django.utils.html import escape\n from django.utils.importlib import import_module\n from django.utils.encoding import smart_unicode, smart_str\n \n-\n HIDDEN_SETTINGS = re.compile('SECRET|PASSWORD|PROFANITIES_LIST|SIGNATURE')\n \n def linebreak_iter(template_source):\n@@ -109,6 +109,9 @@ def get_traceback_html(self):\n             self.get_template_exception_info()\n \n         frames = self.get_traceback_frames()\n+        for i, frame in enumerate(frames):\n+            frame['vars'] = [(k, force_escape(pprint(v))) for k, v in frame['vars']]\n+            frames[i] = frame\n \n         unicode_hint = ''\n         if issubclass(self.exc_type, UnicodeError):\n@@ -547,7 +550,7 @@ def empty_urlconf(request):\n                 {% for var in frame.vars|dictsort:\"0\" %}\n                   <tr>\n                     <td>{{ var.0|force_escape }}</td>\n-                    <td class=\"code\"><pre>{{ var.1|pprint|force_escape }}</pre></td>\n+                    <td class=\"code\"><pre>{{ var.1 }}</pre></td>\n                   </tr>\n                 {% endfor %}\n               </tbody>"
        },
        {
            "sha": "622e5f6442107e2955b2175eeef3e81def3ce922",
            "filename": "tests/regressiontests/views/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/80f48260630c3db98f6e0af282bc339eba999009/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/80f48260630c3db98f6e0af282bc339eba999009/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fviews.py?ref=80f48260630c3db98f6e0af282bc339eba999009",
            "patch": "@@ -36,6 +36,11 @@ def save(self, *args, **kwargs):\n         form_class=SlugChangingArticleForm)\n \n def raises(request):\n+    # Make sure that a callable that raises an exception in the stack frame's\n+    # local vars won't hijack the technical 500 response. See:\n+    # http://code.djangoproject.com/ticket/15025\n+    def callable():\n+        raise Exception\n     try:\n         raise Exception\n     except Exception:"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}