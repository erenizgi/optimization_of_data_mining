{
    "author": "claudep",
    "message": "Replaced proj4 testing by a regex",
    "sha": "8a92139d8a5c2ecb4a7a55da74d293c71390e9ed",
    "files": [
        {
            "sha": "257e06a3f89216828ec3ce491370678f5a9ddcea",
            "filename": "django/contrib/gis/tests/test_spatialrefsys.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/8a92139d8a5c2ecb4a7a55da74d293c71390e9ed/django%2Fcontrib%2Fgis%2Ftests%2Ftest_spatialrefsys.py",
            "raw_url": "https://github.com/django/django/raw/8a92139d8a5c2ecb4a7a55da74d293c71390e9ed/django%2Fcontrib%2Fgis%2Ftests%2Ftest_spatialrefsys.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Ftest_spatialrefsys.py?ref=8a92139d8a5c2ecb4a7a55da74d293c71390e9ed",
            "patch": "@@ -2,6 +2,7 @@\n from django.contrib.gis.gdal import HAS_GDAL\n from django.contrib.gis.tests.utils import (no_mysql, oracle, postgis,\n     spatialite, HAS_SPATIALREFSYS, SpatialRefSys)\n+from django.utils import six\n from django.utils import unittest\n \n \n@@ -10,9 +11,8 @@\n              'auth_srid' : 4326,\n              # Only the beginning, because there are differences depending on installed libs\n              'srtext' : 'GEOGCS[\"WGS 84\",DATUM[\"WGS_1984\",SPHEROID[\"WGS 84\"',\n-             'proj4' : ['+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs ',\n-                        # +ellps=WGS84 has been removed in the 4326 proj string in proj-4.8\n-                        '+proj=longlat +datum=WGS84 +no_defs '],\n+             # +ellps=WGS84 has been removed in the 4326 proj string in proj-4.8\n+             'proj4_re' : r'\\+proj=longlat (\\+ellps=WGS84 )?\\+datum=WGS84 \\+no_defs ',\n              'spheroid' : 'WGS 84', 'name' : 'WGS 84',\n              'geographic' : True, 'projected' : False, 'spatialite' : True,\n              'ellipsoid' : (6378137.0, 6356752.3, 298.257223563), # From proj's \"cs2cs -le\" and Wikipedia (semi-minor only)\n@@ -22,8 +22,9 @@\n              'auth_name' : ('EPSG', False),\n              'auth_srid' : 32140,\n              'srtext' : 'PROJCS[\"NAD83 / Texas South Central\",GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\"',\n-             'proj4' : ['+proj=lcc +lat_1=30.28333333333333 +lat_2=28.38333333333333 +lat_0=27.83333333333333 +lon_0=-99 +x_0=600000 +y_0=4000000 +ellps=GRS80 +datum=NAD83 +units=m +no_defs ',\n-                        '+proj=lcc +lat_1=30.28333333333333 +lat_2=28.38333333333333 +lat_0=27.83333333333333 +lon_0=-99 +x_0=600000 +y_0=4000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs '],\n+             'proj4_re' : r'\\+proj=lcc \\+lat_1=30.28333333333333 \\+lat_2=28.38333333333333 \\+lat_0=27.83333333333333 '\n+                          r'\\+lon_0=-99 \\+x_0=600000 \\+y_0=4000000 \\+ellps=GRS80 '\n+                          r'(\\+datum=NAD83 |\\+towgs84=0,0,0,0,0,0,0)?\\+units=m \\+no_defs ',\n              'spheroid' : 'GRS 1980', 'name' : 'NAD83 / Texas South Central',\n              'geographic' : False, 'projected' : True, 'spatialite' : False,\n              'ellipsoid' : (6378137.0, 6356752.31414, 298.257222101), # From proj's \"cs2cs -le\" and Wikipedia (semi-minor only)\n@@ -54,7 +55,7 @@ def test01_retrieve(self):\n             # No proj.4 and different srtext on oracle backends :(\n             if postgis:\n                 self.assertTrue(srs.wkt.startswith(sd['srtext']))\n-                self.assertTrue(srs.proj4text in sd['proj4'])\n+                six.assertRegex(self, srs.proj4text, sd['proj4_re'])\n \n     @no_mysql\n     def test02_osr(self):\n@@ -73,7 +74,7 @@ def test02_osr(self):\n             # Testing the SpatialReference object directly.\n             if postgis or spatialite:\n                 srs = sr.srs\n-                self.assertTrue(srs.proj4 in sd['proj4'])\n+                six.assertRegex(self, srs.proj4, sd['proj4_re'])\n                 # No `srtext` field in the `spatial_ref_sys` table in SpatiaLite\n                 if not spatialite:\n                     self.assertTrue(srs.wkt.startswith(sd['srtext']))"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}