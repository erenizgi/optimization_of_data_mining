{
    "author": "malcolmt",
    "message": "Improved error message display during validation errors.\n\nWhen reporting a validation error (during model validation or fixture\nloading, for example), the error messages now report the bad value as\nwell as the expected type. This can make identifying the offending field\nand problem a bit easier.\n\nFixed #11595. Patch from raulcd and wildfire with supervision from\nRussell.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16638 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c471d471bf9cb4f8da1fad78c5037660186ba6fd",
    "files": [
        {
            "sha": "47735a84142bbe4898be9b4b0f39bcb1b1e3fc14",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 18,
            "deletions": 12,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/c471d471bf9cb4f8da1fad78c5037660186ba6fd/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/c471d471bf9cb4f8da1fad78c5037660186ba6fd/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=c471d471bf9cb4f8da1fad78c5037660186ba6fd",
            "patch": "@@ -462,7 +462,7 @@ class AutoField(Field):\n \n     empty_strings_allowed = False\n     default_error_messages = {\n-        'invalid': _(u'This value must be an integer.'),\n+        'invalid': _(u\"'%s' value must be an integer.\"),\n     }\n     def __init__(self, *args, **kwargs):\n         assert kwargs.get('primary_key', False) is True, \"%ss must have primary_key=True.\" % self.__class__.__name__\n@@ -478,7 +478,8 @@ def to_python(self, value):\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n-            raise exceptions.ValidationError(self.error_messages['invalid'])\n+            msg = self.error_messages['invalid'] % str(value)\n+            raise exceptions.ValidationError(msg)\n \n     def validate(self, value, model_instance):\n         pass\n@@ -500,7 +501,7 @@ def formfield(self, **kwargs):\n class BooleanField(Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n-        'invalid': _(u'This value must be either True or False.'),\n+        'invalid': _(u\"'%s' value must be either True or False.\"),\n     }\n     description = _(\"Boolean (Either True or False)\")\n     def __init__(self, *args, **kwargs):\n@@ -521,7 +522,8 @@ def to_python(self, value):\n             return True\n         if value in ('f', 'False', '0'):\n             return False\n-        raise exceptions.ValidationError(self.error_messages['invalid'])\n+        msg = self.error_messages['invalid'] % str(value)\n+        raise exceptions.ValidationError(msg)\n \n     def get_prep_lookup(self, lookup_type, value):\n         # Special-case handling for filters coming from a Web request (e.g. the\n@@ -753,7 +755,7 @@ def formfield(self, **kwargs):\n class DecimalField(Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n-        'invalid': _(u'This value must be a decimal number.'),\n+        'invalid': _(u\"'%s' value must be a decimal number.\"),\n     }\n     description = _(\"Decimal number\")\n \n@@ -770,7 +772,8 @@ def to_python(self, value):\n         try:\n             return decimal.Decimal(value)\n         except decimal.InvalidOperation:\n-            raise exceptions.ValidationError(self.error_messages['invalid'])\n+            msg = self.error_messages['invalid'] % str(value)\n+            raise exceptions.ValidationError(msg)\n \n     def _format(self, value):\n         if isinstance(value, basestring) or value is None:\n@@ -848,7 +851,7 @@ def get_internal_type(self):\n class FloatField(Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n-        'invalid': _(\"This value must be a float.\"),\n+        'invalid': _(\"'%s' value must be a float.\"),\n     }\n     description = _(\"Floating point number\")\n \n@@ -866,7 +869,8 @@ def to_python(self, value):\n         try:\n             return float(value)\n         except (TypeError, ValueError):\n-            raise exceptions.ValidationError(self.error_messages['invalid'])\n+            msg = self.error_messages['invalid'] % str(value)\n+            raise exceptions.ValidationError(msg)\n \n     def formfield(self, **kwargs):\n         defaults = {'form_class': forms.FloatField}\n@@ -876,7 +880,7 @@ def formfield(self, **kwargs):\n class IntegerField(Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n-        'invalid': _(\"This value must be an integer.\"),\n+        'invalid': _(\"'%s' value must be an integer.\"),\n     }\n     description = _(\"Integer\")\n \n@@ -900,7 +904,8 @@ def to_python(self, value):\n         try:\n             return int(value)\n         except (TypeError, ValueError):\n-            raise exceptions.ValidationError(self.error_messages['invalid'])\n+            msg = self.error_messages['invalid'] % str(value)\n+            raise exceptions.ValidationError(msg)\n \n     def formfield(self, **kwargs):\n         defaults = {'form_class': forms.IntegerField}\n@@ -981,7 +986,7 @@ def formfield(self, **kwargs):\n class NullBooleanField(Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n-        'invalid': _(\"This value must be either None, True or False.\"),\n+        'invalid': _(\"'%s' value must be either None, True or False.\"),\n     }\n     description = _(\"Boolean (Either True, False or None)\")\n \n@@ -1004,7 +1009,8 @@ def to_python(self, value):\n             return True\n         if value in ('f', 'False', '0'):\n             return False\n-        raise exceptions.ValidationError(self.error_messages['invalid'])\n+        msg = self.error_messages['invalid'] % str(value)\n+        raise exceptions.ValidationError(msg)\n \n     def get_prep_lookup(self, lookup_type, value):\n         # Special-case handling for filters coming from a Web request (e.g. the"
        },
        {
            "sha": "45d03277f4e25e737c3e29ce4b20e651367a2013",
            "filename": "tests/modeltests/validation/test_error_messages.py",
            "status": "added",
            "additions": 57,
            "deletions": 0,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/c471d471bf9cb4f8da1fad78c5037660186ba6fd/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "raw_url": "https://github.com/django/django/raw/c471d471bf9cb4f8da1fad78c5037660186ba6fd/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py?ref=c471d471bf9cb4f8da1fad78c5037660186ba6fd",
            "patch": "@@ -0,0 +1,57 @@\n+from django.core.exceptions import ValidationError\n+from django.utils.unittest import TestCase\n+from django.db import models\n+\n+\n+class ValidationMessagesTest(TestCase):\n+\n+    def test_autofield_field_raises_error_message(self):\n+        f = models.AutoField(primary_key=True)\n+        self.assertRaises(ValidationError, f.clean, 'foo', None)\n+        try:\n+            f.clean('foo', None)\n+        except ValidationError, e:\n+            self.assertEqual(e.messages, [u\"'foo' value must be an integer.\"])\n+\n+    def test_integer_field_raises_error_message(self):\n+        f = models.IntegerField()\n+        self.assertRaises(ValidationError, f.clean, 'foo', None)\n+        try:\n+            f.clean('foo', None)\n+        except ValidationError, e:\n+            self.assertEqual(e.messages, [u\"'foo' value must be an integer.\"])\n+\n+    def test_boolean_field_raises_error_message(self):\n+        f = models.BooleanField()\n+        self.assertRaises(ValidationError, f.clean, 'foo', None)\n+        try:\n+            f.clean('foo', None)\n+        except ValidationError, e:\n+            self.assertEqual(e.messages,\n+                        [u\"'foo' value must be either True or False.\"])\n+\n+    def test_float_field_raises_error_message(self):\n+        f = models.FloatField()\n+        self.assertRaises(ValidationError, f.clean, 'foo', None)\n+        try:\n+            f.clean('foo', None)\n+        except ValidationError, e:\n+            self.assertEqual(e.messages, [u\"'foo' value must be a float.\"])\n+\n+    def test_decimal_field_raises_error_message(self):\n+        f = models.DecimalField()\n+        self.assertRaises(ValidationError, f.clean, 'foo', None)\n+        try:\n+            f.clean('foo', None)\n+        except ValidationError, e:\n+            self.assertEqual(e.messages,\n+                        [u\"'foo' value must be a decimal number.\"])\n+\n+    def test_null_boolean_field_raises_error_message(self):\n+        f = models.NullBooleanField()\n+        self.assertRaises(ValidationError, f.clean, 'foo', None)\n+        try:\n+            f.clean('foo', None)\n+        except ValidationError, e:\n+            self.assertEqual(e.messages,\n+                        [u\"'foo' value must be either None, True or False.\"])"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 75,
        "deletions": 12
    }
}