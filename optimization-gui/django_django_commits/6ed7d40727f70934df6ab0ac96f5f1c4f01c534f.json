{
    "author": "carljm",
    "message": "Fixed #18115 - added warning about overlaid install.\n\nSetup.py now warns if it detects that Django is being installed over top\nof a previous installation that was never removed. This should only\nhappen when installing with ``python setup.py install``, as pip\nautomatically uninstalls before installing a new version and\neasy_install installs as an egg directory.\n\nAlso generally updated the installation doc.",
    "sha": "6ed7d40727f70934df6ab0ac96f5f1c4f01c534f",
    "files": [
        {
            "sha": "d7f2528fc8b5a60dbbe994e28e855da93eb5e272",
            "filename": "docs/topics/install.txt",
            "status": "modified",
            "additions": 86,
            "deletions": 52,
            "changes": 138,
            "blob_url": "https://github.com/django/django/blob/6ed7d40727f70934df6ab0ac96f5f1c4f01c534f/docs%2Ftopics%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/6ed7d40727f70934df6ab0ac96f5f1c4f01c534f/docs%2Ftopics%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Finstall.txt?ref=6ed7d40727f70934df6ab0ac96f5f1c4f01c534f",
            "patch": "@@ -154,34 +154,19 @@ If you are upgrading your installation of Django from a previous version,\n you will need to uninstall the old Django version before installing the\n new version.\n \n-If you installed Django using ``setup.py install``, uninstalling\n-is as simple as deleting the ``django`` directory from your Python\n-``site-packages``.\n+If you installed Django using pip_ or ``easy_install`` previously, installing\n+with pip_ or ``easy_install`` again will automatically take care of the old\n+version, so you don't need to do it yourself.\n \n-If you installed Django from a Python egg, remove the Django ``.egg`` file,\n-and remove the reference to the egg in the file named ``easy-install.pth``.\n-This file should also be located in your ``site-packages`` directory.\n+If you previously installed Django using ``python setup.py install``,\n+uninstalling is as simple as deleting the ``django`` directory from your Python\n+``site-packages``. To find the directory you need to remove, you can run the\n+following at your shell prompt (not the interactive Python prompt):\n \n-.. _finding-site-packages:\n+.. code-block:: bash\n \n-.. admonition:: Where are my ``site-packages`` stored?\n+    python -c \"import sys; sys.path = sys.path[1:]; import django; print django.__path__\"\n \n-    The location of the ``site-packages`` directory depends on the operating\n-    system, and the location in which Python was installed. To find out your\n-    system's ``site-packages`` location, execute the following:\n-\n-    .. code-block:: bash\n-\n-        python -c \"from distutils.sysconfig import get_python_lib; print(get_python_lib())\"\n-\n-    (Note that this should be run from a shell prompt, not a Python interactive\n-    prompt.)\n-\n-    Some Debian-based Linux distributions have separate ``site-packages``\n-    directories for user-installed packages, such as when installing Django\n-    from a downloaded tarball. The command  listed above will give you the\n-    system's ``site-packages``, the user's directory can be found in\n-    ``/usr/local/lib/`` instead of ``/usr/lib/``.\n \n .. _install-django-code:\n \n@@ -253,6 +238,15 @@ Installing an official release manually\n    run the command ``python setup.py install``. This will install Django in\n    your Python installation's ``site-packages`` directory.\n \n+   .. admonition:: Removing an old version\n+\n+       If you use this installation technique, it is particularly important\n+       that you :ref:`remove any existing\n+       installations<removing-old-versions-of-django>` of Django\n+       first. Otherwise, you can end up with a broken installation that\n+       includes files from previous versions that have since been removed from\n+       Django.\n+\n .. _download page: https://www.djangoproject.com/download/\n .. _bsdtar: http://gnuwin32.sourceforge.net/packages/bsdtar.htm\n .. _7-zip: http://www.7-zip.org/\n@@ -291,48 +285,88 @@ latest bug fixes and improvements, follow these instructions:\n \n    This will create a directory ``django-trunk`` in your current directory.\n \n-3. Next, make sure that the Python interpreter can load Django's code. The most\n-   convenient way to do this is to `modify Python's search path`_. Add a ``.pth``\n-   file containing the full path to the ``django-trunk`` directory to your\n-   system's ``site-packages`` directory. For example, on a Unix-like system:\n+3. Make sure that the Python interpreter can load Django's code. The most\n+   convenient way to do this is via pip_. Run the following command:\n \n    .. code-block:: bash\n \n-       echo WORKING-DIR/django-trunk > SITE-PACKAGES-DIR/django.pth\n+       sudo pip install -e django-trunk/\n \n-   (In the above line, change ``SITE-PACKAGES-DIR`` to match the location of\n-   your system's ``site-packages`` directory, as explained in the\n-   :ref:`Where are my site-packages stored? <finding-site-packages>` section\n-   above. Change ``WORKING-DIR/django-trunk`` to match the full path to your\n-   new ``django-trunk`` directory.)\n+   (If using a virtualenv_ you can omit ``sudo``.)\n \n-4. On Unix-like systems, create a symbolic link to the file\n-   ``django-trunk/django/bin/django-admin.py`` in a directory on your system\n-   path, such as ``/usr/local/bin``. For example:\n-\n-   .. code-block:: bash\n+   This will make Django's code importable, and will also make the\n+   ``django-admin.py`` utility command available. In other words, you're all\n+   set!\n \n-       ln -s WORKING-DIR/django-trunk/django/bin/django-admin.py /usr/local/bin/\n-\n-   (In the above line, change WORKING-DIR to match the full path to your new\n-   ``django-trunk`` directory.)\n-\n-   This simply lets you type ``django-admin.py`` from within any directory,\n-   rather than having to qualify the command with the full path to the file.\n-\n-   On Windows systems, the same result can be achieved by copying the file\n-   ``django-trunk/django/bin/django-admin.py`` to somewhere on your system\n-   path, for example ``C:\\Python27\\Scripts``.\n+   If you don't have pip_ available, see the alternative instructions for\n+   `installing the development version without pip`_.\n \n .. warning::\n \n     Don't run ``sudo python setup.py install``, because you've already\n-    carried out the equivalent actions in steps 3 and 4. Furthermore, this is\n-    known to cause problems when updating to a more recent version of Django.\n+    carried out the equivalent actions in step 3.\n \n When you want to update your copy of the Django source code, just run the\n command ``git pull`` from within the ``django-trunk`` directory. When you do\n this, Git will automatically download any changes.\n \n .. _Git: http://git-scm.com/\n .. _`modify Python's search path`: http://docs.python.org/install/index.html#modifying-python-s-search-path\n+.. _installing-the-development-version-without-pip:\n+\n+Installing the development version without pip\n+----------------------------------------------\n+\n+If you don't have pip_, you can instead manually `modify Python's search\n+path`_.\n+\n+First follow steps 1 and 2 above, so that you have a ``django-trunk`` directory\n+with a checkout of Django's latest code in it. Then add a ``.pth`` file\n+containing the full path to the ``django-trunk`` directory to your system's\n+``site-packages`` directory. For example, on a Unix-like system:\n+\n+.. code-block:: bash\n+\n+    echo WORKING-DIR/django-trunk > SITE-PACKAGES-DIR/django.pth\n+\n+In the above line, change ``WORKING-DIR/django-trunk`` to match the full path\n+to your new ``django-trunk`` directory, and change ``SITE-PACKAGES-DIR`` to\n+match the location of your system's ``site-packages`` directory.\n+\n+The location of the ``site-packages`` directory depends on the operating\n+system, and the location in which Python was installed. To find your system's\n+``site-packages`` location, execute the following:\n+\n+.. code-block:: bash\n+\n+    python -c \"from distutils.sysconfig import get_python_lib; print get_python_lib()\"\n+\n+(Note that this should be run from a shell prompt, not a Python interactive\n+prompt.)\n+\n+Some Debian-based Linux distributions have separate ``site-packages``\n+directories for user-installed packages, such as when installing Django from\n+a downloaded tarball. The command listed above will give you the system's\n+``site-packages``, the user's directory can be found in ``/usr/local/lib/``\n+instead of ``/usr/lib/``.\n+\n+Next you need to make the ``django-admin.py`` utility available in your\n+shell PATH.\n+\n+On Unix-like systems, create a symbolic link to the file\n+``django-trunk/django/bin/django-admin.py`` in a directory on your system\n+path, such as ``/usr/local/bin``. For example:\n+\n+.. code-block:: bash\n+\n+    ln -s WORKING-DIR/django-trunk/django/bin/django-admin.py /usr/local/bin/\n+\n+(In the above line, change WORKING-DIR to match the full path to your new\n+``django-trunk`` directory.)\n+\n+This simply lets you type ``django-admin.py`` from within any directory,\n+rather than having to qualify the command with the full path to the file.\n+\n+On Windows systems, the same result can be achieved by copying the file\n+``django-trunk/django/bin/django-admin.py`` to somewhere on your system\n+path, for example ``C:\\Python27\\Scripts``."
        },
        {
            "sha": "165c5e9f735be959ce6a054a342418fb208d8143",
            "filename": "setup.py",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/6ed7d40727f70934df6ab0ac96f5f1c4f01c534f/setup.py",
            "raw_url": "https://github.com/django/django/raw/6ed7d40727f70934df6ab0ac96f5f1c4f01c534f/setup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/setup.py?ref=6ed7d40727f70934df6ab0ac96f5f1c4f01c534f",
            "patch": "@@ -1,9 +1,25 @@\n from distutils.core import setup\n from distutils.command.install_data import install_data\n from distutils.command.install import INSTALL_SCHEMES\n+from distutils.sysconfig import get_python_lib\n import os\n import sys\n \n+# Warn if we are installing over top of an existing installation. This can\n+# cause issues where files that were deleted from a more recent Django are\n+# still present in site-packages. See #18115.\n+overlay_warning = False\n+if \"install\" in sys.argv:\n+    # We have to try also with an explicit prefix of /usr/local in order to\n+    # catch Debian's custom user site-packages directory.\n+    for lib_path in get_python_lib(), get_python_lib(prefix=\"/usr/local\"):\n+        existing_path = os.path.abspath(os.path.join(lib_path, \"django\"))\n+        if os.path.exists(existing_path):\n+            # We note the need for the warning here, but present it after the\n+            # command is run, so it's more likely to be seen.\n+            overlay_warning = True\n+            break\n+\n class osx_install_data(install_data):\n     # On MacOS, the platform-specific lib dir is /System/Library/Framework/Python/.../\n     # which is wrong. Python 2.5 supplied with MacOS 10.5 has an Apple-specific fix\n@@ -97,3 +113,23 @@ def fullsplit(path, result=None):\n         'Topic :: Software Development :: Libraries :: Python Modules',\n    ],\n )\n+\n+if overlay_warning:\n+    sys.stderr.write(\"\"\"\n+\n+========\n+WARNING!\n+========\n+\n+You have just installed Django over top of an existing\n+installation, without removing it first. Because of this,\n+your install may now include extraneous files from a\n+previous version that have since been removed from\n+Django. This is known to cause a variety of problems. You\n+should manually remove the\n+\n+%(existing_path)s\n+\n+directory and re-install Django.\n+\n+\"\"\" % { \"existing_path\": existing_path })"
        }
    ],
    "stats": {
        "total": 174,
        "additions": 122,
        "deletions": 52
    }
}