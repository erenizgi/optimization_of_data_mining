{
    "author": "SmileyChris",
    "message": "Fixed #17660 -- Standardize extends tag token parsing\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17568 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0e54c23caf21e5680aff68660b5d5b5937b98262",
    "files": [
        {
            "sha": "b63938abb070281df4f34448909b6509021333bc",
            "filename": "django/template/loader_tags.py",
            "status": "modified",
            "additions": 12,
            "deletions": 18,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/0e54c23caf21e5680aff68660b5d5b5937b98262/django%2Ftemplate%2Floader_tags.py",
            "raw_url": "https://github.com/django/django/raw/0e54c23caf21e5680aff68660b5d5b5937b98262/django%2Ftemplate%2Floader_tags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floader_tags.py?ref=0e54c23caf21e5680aff68660b5d5b5937b98262",
            "patch": "@@ -1,5 +1,6 @@\n from django.conf import settings\n-from django.template.base import TemplateSyntaxError, Library, Node, TextNode, token_kwargs\n+from django.template.base import TemplateSyntaxError, Library, Node, TextNode,\\\n+    token_kwargs, Variable\n from django.template.loader import get_template\n from django.utils.safestring import mark_safe\n \n@@ -74,26 +75,23 @@ def super(self):\n class ExtendsNode(Node):\n     must_be_first = True\n \n-    def __init__(self, nodelist, parent_name, parent_name_expr, template_dirs=None):\n+    def __init__(self, nodelist, parent_name, template_dirs=None):\n         self.nodelist = nodelist\n-        self.parent_name, self.parent_name_expr = parent_name, parent_name_expr\n+        self.parent_name = parent_name\n         self.template_dirs = template_dirs\n         self.blocks = dict([(n.name, n) for n in nodelist.get_nodes_by_type(BlockNode)])\n \n     def __repr__(self):\n-        if self.parent_name_expr:\n-            return \"<ExtendsNode: extends %s>\" % self.parent_name_expr.token\n-        return '<ExtendsNode: extends \"%s\">' % self.parent_name\n+        return '<ExtendsNode: extends %s>' % self.parent_name.token\n \n     def get_parent(self, context):\n-        if self.parent_name_expr:\n-            parent = self.parent_name_expr.resolve(context)\n-        else:\n-            parent = self.parent_name\n+        parent = self.parent_name.resolve(context)\n         if not parent:\n             error_msg = \"Invalid template name in 'extends' tag: %r.\" % parent\n-            if self.parent_name_expr:\n-                error_msg += \" Got this from the '%s' variable.\" % self.parent_name_expr.token\n+            if self.parent_name.filters or\\\n+                    isinstance(self.parent_name.var, Variable):\n+                error_msg += \" Got this from the '%s' variable.\" %\\\n+                    self.parent_name.token\n             raise TemplateSyntaxError(error_msg)\n         if hasattr(parent, 'render'):\n             return parent # parent is a Template object\n@@ -212,15 +210,11 @@ def do_extends(parser, token):\n     bits = token.split_contents()\n     if len(bits) != 2:\n         raise TemplateSyntaxError(\"'%s' takes one argument\" % bits[0])\n-    parent_name, parent_name_expr = None, None\n-    if bits[1][0] in ('\"', \"'\") and bits[1][-1] == bits[1][0]:\n-        parent_name = bits[1][1:-1]\n-    else:\n-        parent_name_expr = parser.compile_filter(bits[1])\n+    parent_name = parser.compile_filter(bits[1])\n     nodelist = parser.parse()\n     if nodelist.get_nodes_by_type(ExtendsNode):\n         raise TemplateSyntaxError(\"'%s' cannot appear more than once in the same template\" % bits[0])\n-    return ExtendsNode(nodelist, parent_name, parent_name_expr)\n+    return ExtendsNode(nodelist, parent_name)\n \n @register.tag('include')\n def do_include(parser, token):"
        },
        {
            "sha": "7b45f9e4e206b170c7e2f0fb2e7b4c5e5d21fcbc",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/0e54c23caf21e5680aff68660b5d5b5937b98262/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/0e54c23caf21e5680aff68660b5d5b5937b98262/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=0e54c23caf21e5680aff68660b5d5b5937b98262",
            "patch": "@@ -1031,6 +1031,17 @@ If you depended on the output of this command -- if you parsed it, for example\n management commands in a script, use\n :djadmin:`manage.py help --commands <help>` instead.\n \n+``extends`` template tag\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Previously, the :ttag:`extends` tag used a buggy method of parsing arguments,\n+which could lead to it erroneously considering an argument as a string literal\n+when it wasn't.  It now utilises ``parser.compile_filter`` like other tags.\n+\n+The internals of the tag aren't part of the official stable API, but in the\n+interests of full disclosure, the ``ExtendsNode.__init__`` definition has\n+changed which may break any custom tags that use this node class.\n+\n Features deprecated in 1.4\n ==========================\n "
        },
        {
            "sha": "d5de05ca09ec0826cfb17d2c9f7d54d96b8cb731",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/0e54c23caf21e5680aff68660b5d5b5937b98262/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0e54c23caf21e5680aff68660b5d5b5937b98262/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=0e54c23caf21e5680aff68660b5d5b5937b98262",
            "patch": "@@ -1204,6 +1204,9 @@ def get_template_tests(self):\n             'inheritance40': (\"{% extends 'inheritance33' %}{% block opt %}new{{ block.super }}{% endblock %}\", {'optional': 1}, '1new23'),\n             'inheritance41': (\"{% extends 'inheritance36' %}{% block opt %}new{{ block.super }}{% endblock %}\", {'numbers': '123'}, '_new1_new2_new3_'),\n \n+            # Expression starting and ending with a quote\n+            'inheritance42': (\"{% extends 'inheritance02'|cut:' ' %}\", {}, '1234'),\n+\n             ### LOADING TAG LIBRARIES #################################################\n             'load01': (\"{% load testtags subpackage.echo %}{% echo test %} {% echo2 \\\"test\\\" %}\", {}, \"test test\"),\n             'load02': (\"{% load subpackage.echo %}{% echo2 \\\"test\\\" %}\", {}, \"test\"),"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 26,
        "deletions": 18
    }
}