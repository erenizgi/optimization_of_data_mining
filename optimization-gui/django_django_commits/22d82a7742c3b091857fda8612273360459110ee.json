{
    "author": "ptone",
    "message": "Fixed #15198 -- pass request to AuthenticationForm\n\nThanks to Ciantic for the report, claudep and slurms for initial work",
    "sha": "22d82a7742c3b091857fda8612273360459110ee",
    "files": [
        {
            "sha": "42abde2f19620698338cc74cd560fe58ff5762ec",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=22d82a7742c3b091857fda8612273360459110ee",
            "patch": "@@ -160,10 +160,8 @@ class AuthenticationForm(forms.Form):\n \n     def __init__(self, request=None, *args, **kwargs):\n         \"\"\"\n-        If request is passed in, the form will validate that cookies are\n-        enabled. Note that the request (a HttpRequest object) must have set a\n-        cookie with the key TEST_COOKIE_NAME and value TEST_COOKIE_VALUE before\n-        running this validation.\n+        The 'request' parameter is set for custom auth use by subclasses.\n+        The form data comes in via the standard 'data' kwarg.\n         \"\"\"\n         self.request = request\n         self.user_cache = None"
        },
        {
            "sha": "51b05be648dc573eeba003c636833ac20ebbeae8",
            "filename": "django/contrib/auth/tests/urls.py",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Ftests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Ftests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Furls.py?ref=22d82a7742c3b091857fda8612273360459110ee",
            "patch": "@@ -1,14 +1,20 @@\n from django.conf.urls import patterns, url\n from django.contrib.auth import context_processors\n+from django.contrib.auth.forms import AuthenticationForm\n from django.contrib.auth.urls import urlpatterns\n-from django.contrib.auth.views import password_reset\n+from django.contrib.auth.views import password_reset, login\n from django.contrib.auth.decorators import login_required\n from django.contrib.messages.api import info\n-from django.http import HttpResponse\n+from django.http import HttpResponse, HttpRequest\n from django.shortcuts import render_to_response\n from django.template import Template, RequestContext\n from django.views.decorators.cache import never_cache\n \n+class CustomRequestAuthenticationForm(AuthenticationForm):\n+    def __init__(self, request, *args, **kwargs):\n+        assert isinstance(request, HttpRequest)\n+        super(CustomRequestAuthenticationForm, self).__init__(request, *args, **kwargs)\n+\n @never_cache\n def remote_user_auth_view(request):\n     \"Dummy view for remote user tests\"\n@@ -49,6 +55,9 @@ def auth_processor_messages(request):\n def userpage(request):\n     pass\n \n+def custom_request_auth_login(request):\n+    return login(request, authentication_form=CustomRequestAuthenticationForm)\n+\n # special urls for auth test cases\n urlpatterns = urlpatterns + patterns('',\n     (r'^logout/custom_query/$', 'django.contrib.auth.views.logout', dict(redirect_field_name='follow')),\n@@ -65,6 +74,7 @@ def userpage(request):\n     (r'^auth_processor_perms/$', auth_processor_perms),\n     (r'^auth_processor_perm_in_perms/$', auth_processor_perm_in_perms),\n     (r'^auth_processor_messages/$', auth_processor_messages),\n+    (r'^custom_request_auth_login/$', custom_request_auth_login),\n     url(r'^userpage/(.+)/$', userpage, name=\"userpage\"),\n )\n "
        },
        {
            "sha": "ee1b18d0384a8ed50711f7c1946ec9c34adeab65",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=22d82a7742c3b091857fda8612273360459110ee",
            "patch": "@@ -365,6 +365,14 @@ def test_security_check(self, password='password'):\n             self.assertTrue(good_url in response.url,\n                             \"%s should be allowed\" % good_url)\n \n+    def test_login_form_contains_request(self):\n+        # 15198\n+        response = self.client.post('/custom_requestauth_login/', {\n+            'username': 'testclient',\n+            'password': 'password',\n+        }, follow=True)\n+        # the custom authentication form used by this login asserts\n+        # that a request is passed to the form successfully.\n \n @skipIfCustomUser\n class LoginURLSettings(AuthViewsTestCase):"
        },
        {
            "sha": "8a554b0ad823fe15cf50549c1675a5cff2362506",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/22d82a7742c3b091857fda8612273360459110ee/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=22d82a7742c3b091857fda8612273360459110ee",
            "patch": "@@ -35,7 +35,7 @@ def login(request, template_name='registration/login.html',\n     redirect_to = request.REQUEST.get(redirect_field_name, '')\n \n     if request.method == \"POST\":\n-        form = authentication_form(data=request.POST)\n+        form = authentication_form(request, data=request.POST)\n         if form.is_valid():\n \n             # Ensure the user-originating redirection url is safe."
        }
    ],
    "stats": {
        "total": 30,
        "additions": 23,
        "deletions": 7
    }
}