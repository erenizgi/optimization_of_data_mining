{
    "author": "unknown",
    "message": "Fixed #19810 -- MemcachedCache now uses pickle.HIGHEST_PROTOCOL",
    "sha": "5a9b2bce242bd2f8a9fed6ac735406ce68b10738",
    "files": [
        {
            "sha": "c942acd52feb0db3c16503bd95cb2b59b0524aef",
            "filename": "django/core/cache/backends/memcached.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/5a9b2bce242bd2f8a9fed6ac735406ce68b10738/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "raw_url": "https://github.com/django/django/raw/5a9b2bce242bd2f8a9fed6ac735406ce68b10738/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py?ref=5a9b2bce242bd2f8a9fed6ac735406ce68b10738",
            "patch": "@@ -1,6 +1,7 @@\n \"Memcached cache backend\"\n \n import time\n+import pickle\n from threading import local\n \n from django.core.cache.backends.base import BaseCache, InvalidCacheBackendError\n@@ -146,6 +147,12 @@ def __init__(self, server, params):\n                                              library=memcache,\n                                              value_not_found_exception=ValueError)\n \n+    @property\n+    def _cache(self):\n+        if getattr(self, '_client', None) is None:\n+            self._client = self._lib.Client(self._servers, pickleProtocol=pickle.HIGHEST_PROTOCOL)\n+        return self._client\n+\n class PyLibMCCache(BaseMemcachedCache):\n     \"An implementation of a cache binding using pylibmc\"\n     def __init__(self, server, params):"
        },
        {
            "sha": "c2a3d56c531f82df510632156e28df61d9319f96",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/5a9b2bce242bd2f8a9fed6ac735406ce68b10738/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/5a9b2bce242bd2f8a9fed6ac735406ce68b10738/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=5a9b2bce242bd2f8a9fed6ac735406ce68b10738",
            "patch": "@@ -89,6 +89,9 @@ Minor features\n   :class:`~django.http.HttpResponsePermanentRedirect` now provide an ``url``\n   attribute (equivalent to the URL the response will redirect to).\n \n+* The ``MemcachedCache`` cache backend now uses the latest :mod:`pickle`\n+  protocol available.\n+\n * Added the :attr:`django.db.models.ForeignKey.db_constraint`\n   option.\n "
        },
        {
            "sha": "17d17f7fddc046203e3d5c37ffde0c48812a260f",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/5a9b2bce242bd2f8a9fed6ac735406ce68b10738/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/5a9b2bce242bd2f8a9fed6ac735406ce68b10738/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=5a9b2bce242bd2f8a9fed6ac735406ce68b10738",
            "patch": "@@ -12,6 +12,7 @@\n import tempfile\n import time\n import warnings\n+import pickle\n \n from django.conf import settings\n from django.core import management\n@@ -984,6 +985,18 @@ def test_invalid_keys(self):\n         # memcached limits key length to 250\n         self.assertRaises(Exception, self.cache.set, 'a' * 251, 'value')\n \n+    # Explicitly display a skipped test if no configured cache uses MemcachedCache\n+    @unittest.skipUnless(\n+        any(cache['BACKEND'] == 'django.core.cache.backends.memcached.MemcachedCache'\n+            for cache in settings.CACHES.values()),\n+        \"cache with python-memcached library not available\")\n+    def test_memcached_uses_highest_pickle_version(self):\n+        # Regression test for #19810\n+        for cache_key, cache in settings.CACHES.items():\n+            if cache['BACKEND'] == 'django.core.cache.backends.memcached.MemcachedCache':\n+                self.assertEqual(get_cache(cache_key)._cache.pickleProtocol,\n+                                 pickle.HIGHEST_PROTOCOL)\n+\n \n class FileBasedCacheTests(unittest.TestCase, BaseCacheTests):\n     \"\"\""
        }
    ],
    "stats": {
        "total": 23,
        "additions": 23,
        "deletions": 0
    }
}