{
    "author": "jphalip",
    "message": "Fixed #8291 -- Allowed 'pk' to be used as an ordering option in `Model.Meta`. Thanks to peterd12 for the report and to evan_schulz, gruszczy, frog32 and David Gouldin for their work on the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17445 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d3154d1896c5cc1c046e43c2cf5253415d6429ae",
    "files": [
        {
            "sha": "f0b5b1c7c2816721a348cc73ea58d5f9c93b039e",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/d3154d1896c5cc1c046e43c2cf5253415d6429ae/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/d3154d1896c5cc1c046e43c2cf5253415d6429ae/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=d3154d1896c5cc1c046e43c2cf5253415d6429ae",
            "patch": "@@ -283,6 +283,11 @@ def get_validation_errors(outfile, app=None):\n                 # this format would be nice, but it's a little fiddly).\n                 if '__' in field_name:\n                     continue\n+                # Skip ordering on pk, this is always a valid order_by field\n+                # but is an alias and therefore won't be found by\n+                # opts.get_field.\n+                if field_name == 'pk':\n+                    continue\n                 try:\n                     opts.get_field(field_name, many_to_many=False)\n                 except models.FieldDoesNotExist:"
        },
        {
            "sha": "ed69fb60ee18639c056e88d7ff043799e6bee82e",
            "filename": "tests/modeltests/invalid_models/invalid_models/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/d3154d1896c5cc1c046e43c2cf5253415d6429ae/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/d3154d1896c5cc1c046e43c2cf5253415d6429ae/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py?ref=d3154d1896c5cc1c046e43c2cf5253415d6429ae",
            "patch": "@@ -233,6 +233,15 @@ class UnicodeForeignKeys(models.Model):\n class PrimaryKeyNull(models.Model):\n     my_pk_field = models.IntegerField(primary_key=True, null=True)\n \n+class OrderByPKModel(models.Model):\n+    \"\"\"\n+    Model to test that ordering by pk passes validation.\n+    Refs #8291\n+    \"\"\"\n+    name = models.CharField(max_length=100, blank=True)\n+\n+    class Meta:\n+        ordering = ('pk',)\n \n model_errors = \"\"\"invalid_models.fielderrors: \"charfield\": CharFields require a \"max_length\" attribute that is a positive integer.\n invalid_models.fielderrors: \"charfield2\": CharFields require a \"max_length\" attribute that is a positive integer."
        },
        {
            "sha": "bfb4b97107ea64235660a7b297ff244defdf0bb3",
            "filename": "tests/modeltests/ordering/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/d3154d1896c5cc1c046e43c2cf5253415d6429ae/tests%2Fmodeltests%2Fordering%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/d3154d1896c5cc1c046e43c2cf5253415d6429ae/tests%2Fmodeltests%2Fordering%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fordering%2Fmodels.py?ref=d3154d1896c5cc1c046e43c2cf5253415d6429ae",
            "patch": "@@ -24,3 +24,12 @@ class Meta:\n \n     def __unicode__(self):\n         return self.headline\n+\n+class ArticlePKOrdering(models.Model):\n+    headline = models.CharField(max_length=100)\n+    pub_date = models.DateTimeField()\n+    class Meta:\n+        ordering = ('-pk',)\n+\n+    def __unicode__(self):\n+        return self.headline"
        },
        {
            "sha": "b1b5253682e46b935d0c2f95d71b16d0a26b8e3b",
            "filename": "tests/modeltests/ordering/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 1,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/d3154d1896c5cc1c046e43c2cf5253415d6429ae/tests%2Fmodeltests%2Fordering%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d3154d1896c5cc1c046e43c2cf5253415d6429ae/tests%2Fmodeltests%2Fordering%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fordering%2Ftests.py?ref=d3154d1896c5cc1c046e43c2cf5253415d6429ae",
            "patch": "@@ -5,7 +5,7 @@\n \n from django.test import TestCase\n \n-from .models import Article\n+from .models import Article, ArticlePKOrdering\n \n \n class OrderingTests(TestCase):\n@@ -137,3 +137,31 @@ def test_basic(self):\n             ],\n             attrgetter(\"headline\")\n         )\n+\n+    def test_order_by_pk(self):\n+        \"\"\"\n+        Ensure that 'pk' works as an ordering option in Meta.\n+        Refs #8291.\n+        \"\"\"\n+        a1 = ArticlePKOrdering.objects.create(\n+            pk=1, headline=\"Article 1\", pub_date=datetime(2005, 7, 26)\n+        )\n+        a2 = ArticlePKOrdering.objects.create(\n+            pk=2, headline=\"Article 2\", pub_date=datetime(2005, 7, 27)\n+        )\n+        a3 = ArticlePKOrdering.objects.create(\n+            pk=3, headline=\"Article 3\", pub_date=datetime(2005, 7, 27)\n+        )\n+        a4 = ArticlePKOrdering.objects.create(\n+            pk=4, headline=\"Article 4\", pub_date=datetime(2005, 7, 28)\n+        )\n+\n+        self.assertQuerysetEqual(\n+            ArticlePKOrdering.objects.all(), [\n+                \"Article 4\",\n+                \"Article 3\",\n+                \"Article 2\",\n+                \"Article 1\",\n+            ],\n+            attrgetter(\"headline\")\n+        )"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 52,
        "deletions": 1
    }
}