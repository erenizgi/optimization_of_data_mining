{
    "author": "jezdez",
    "message": "Corrected the behavior of the SimpleFilter.lookups method to also be able to return None. Also modified example in documentation to be a bite more realistic. Refs #5833. Thanks for the hint, Martin Mahner.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16150 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "05b4f2ebc2f547d2413f738551f9933aae0d34dc",
    "files": [
        {
            "sha": "36dcea1ea73a9d085df413d28afd8bd68e684047",
            "filename": "django/contrib/admin/filters.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/05b4f2ebc2f547d2413f738551f9933aae0d34dc/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "raw_url": "https://github.com/django/django/raw/05b4f2ebc2f547d2413f738551f9933aae0d34dc/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ffilters.py?ref=05b4f2ebc2f547d2413f738551f9933aae0d34dc",
            "patch": "@@ -63,7 +63,10 @@ def __init__(self, request, params, model, model_admin):\n             raise ImproperlyConfigured(\n                 \"The list filter '%s' does not specify \"\n                 \"a 'parameter_name'.\" % self.__class__.__name__)\n-        self.lookup_choices = self.lookups(request)\n+        lookup_choices = self.lookups(request)\n+        if lookup_choices is None:\n+            lookup_choices = ()\n+        self.lookup_choices = lookup_choices\n \n     def has_output(self):\n         return len(self.lookup_choices) > 0"
        },
        {
            "sha": "e8bc59724d67edab91473049196c6db6f7d0f1d7",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/05b4f2ebc2f547d2413f738551f9933aae0d34dc/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/05b4f2ebc2f547d2413f738551f9933aae0d34dc/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=05b4f2ebc2f547d2413f738551f9933aae0d34dc",
            "patch": "@@ -607,15 +607,12 @@ subclass::\n                   class AuthDecadeBornListFilter(DecadeBornListFilter):\n \n                       def lookups(self, request):\n-                          if request.user.is_authenticated():\n-                              return (\n-                                  ('80s', 'in the eighties'),\n-                                  ('other', 'other'),\n-                              )\n-                          else:\n-                              return (\n-                                  ('90s', 'in the nineties'),\n-                              )\n+                          if request.user.is_superuser:\n+                              return super(AuthDecadeBornListFilter, self).lookups(request)\n+\n+                      def queryset(self, request, queryset):\n+                          if request.user.is_superuser:\n+                              return super(AuthDecadeBornListFilter, self).queryset(request, queryset)\n \n         * a tuple, where the first element is a field name and the second\n           element is a class inheriting from"
        },
        {
            "sha": "6b32475a6449ea56718440e357968158bb87d158",
            "filename": "tests/regressiontests/admin_filters/tests.py",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/05b4f2ebc2f547d2413f738551f9933aae0d34dc/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/05b4f2ebc2f547d2413f738551f9933aae0d34dc/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py?ref=05b4f2ebc2f547d2413f738551f9933aae0d34dc",
            "patch": "@@ -43,6 +43,11 @@ class DecadeListFilterWithoutTitle(DecadeListFilter):\n class DecadeListFilterWithoutParameter(DecadeListFilter):\n     title = 'publication decade'\n \n+class DecadeListFilterWithNoneReturningLookups(DecadeListFilterWithTitleAndParameter):\n+\n+    def lookups(self, request):\n+        pass\n+\n class CustomUserAdmin(UserAdmin):\n     list_filter = ('books_authored', 'books_contributed')\n \n@@ -60,6 +65,9 @@ class DecadeFilterBookAdminWithoutTitle(ModelAdmin):\n class DecadeFilterBookAdminWithoutParameter(ModelAdmin):\n     list_filter = (DecadeListFilterWithoutParameter,)\n \n+class DecadeFilterBookAdminWithNoneReturningLookups(ModelAdmin):\n+    list_filter = (DecadeListFilterWithNoneReturningLookups,)\n+\n class ListFiltersTests(TestCase):\n \n     def setUp(self):\n@@ -453,3 +461,14 @@ def test_simplelistfilter_without_parameter(self):\n         self.assertRaisesRegexp(ImproperlyConfigured,\n             \"The list filter 'DecadeListFilterWithoutParameter' does not specify a 'parameter_name'.\",\n             self.get_changelist, request, Book, modeladmin)\n+\n+    def test_simplelistfilter_with_none_returning_lookups(self):\n+        \"\"\"\n+        A SimpleListFilter lookups method can return None but disables the\n+        filter completely.\n+        \"\"\"\n+        modeladmin = DecadeFilterBookAdminWithNoneReturningLookups(Book, site)\n+        request = self.request_factory.get('/', {})\n+        changelist = self.get_changelist(request, Book, modeladmin)\n+        filterspec = changelist.get_filters(request)[0]\n+        self.assertEqual(len(filterspec), 0)"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 29,
        "deletions": 10
    }
}