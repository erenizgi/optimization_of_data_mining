{
    "author": "oinopion",
    "message": "Fixed #19872\n\nMade cached_property to behave as property when accessed via class.",
    "sha": "b88abd684041ffa66bfe445e1ac26164e803d488",
    "files": [
        {
            "sha": "51001ea6559c95a9d3b8cfdc0e2edcc5bec2a59c",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b88abd684041ffa66bfe445e1ac26164e803d488/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/b88abd684041ffa66bfe445e1ac26164e803d488/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=b88abd684041ffa66bfe445e1ac26164e803d488",
            "patch": "@@ -39,7 +39,9 @@ class cached_property(object):\n     def __init__(self, func):\n         self.func = func\n \n-    def __get__(self, instance, type):\n+    def __get__(self, instance, type=None):\n+        if instance is None:\n+            return self\n         res = instance.__dict__[self.func.__name__] = self.func(instance)\n         return res\n "
        },
        {
            "sha": "3bb50007c6926bb31bac04d6f4faecb9b861a029",
            "filename": "tests/regressiontests/utils/functional.py",
            "status": "modified",
            "additions": 28,
            "deletions": 1,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/b88abd684041ffa66bfe445e1ac26164e803d488/tests%2Fregressiontests%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/b88abd684041ffa66bfe445e1ac26164e803d488/tests%2Fregressiontests%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ffunctional.py?ref=b88abd684041ffa66bfe445e1ac26164e803d488",
            "patch": "@@ -1,5 +1,5 @@\n from django.utils import unittest\n-from django.utils.functional import lazy, lazy_property\n+from django.utils.functional import lazy, lazy_property, cached_property\n \n \n class FunctionalTestCase(unittest.TestCase):\n@@ -37,3 +37,30 @@ def _get_do(self):\n \n         self.assertRaises(NotImplementedError, lambda: A().do)\n         self.assertEqual(B().do, 'DO IT')\n+\n+    def test_cached_property(self):\n+        \"\"\"\n+        Test that cached_property caches its value,\n+        and that it behaves like a property\n+        \"\"\"\n+\n+        class A(object):\n+\n+            @cached_property\n+            def value(self):\n+                return 1, object()\n+\n+        a = A()\n+\n+        # check that it is cached\n+        self.assertEqual(a.value, a.value)\n+\n+        # check that it returns the right thing\n+        self.assertEqual(a.value[0], 1)\n+\n+        # check that state isn't shared between instances\n+        a2 = A()\n+        self.assertNotEqual(a.value, a2.value)\n+\n+        # check that it behaves like a property when there's no instance\n+        self.assertIsInstance(A.value, cached_property)"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 31,
        "deletions": 2
    }
}