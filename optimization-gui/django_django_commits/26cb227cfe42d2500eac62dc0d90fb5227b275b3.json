{
    "author": "claudep",
    "message": "Fixed #15197 -- Fixed yaml serialization into HttpResponse\n\nThanks fourga38 for the report and hirokiky at gmail.com for the\ninitial patch.",
    "sha": "26cb227cfe42d2500eac62dc0d90fb5227b275b3",
    "files": [
        {
            "sha": "941b9e0ba802e24d50f6f968b13fe2599e86417c",
            "filename": "django/core/serializers/json.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/26cb227cfe42d2500eac62dc0d90fb5227b275b3/django%2Fcore%2Fserializers%2Fjson.py",
            "raw_url": "https://github.com/django/django/raw/26cb227cfe42d2500eac62dc0d90fb5227b275b3/django%2Fcore%2Fserializers%2Fjson.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fjson.py?ref=26cb227cfe42d2500eac62dc0d90fb5227b275b3",
            "patch": "@@ -52,9 +52,8 @@ def end_object(self, obj):\n         self._current = None\n \n     def getvalue(self):\n-        # overwrite PythonSerializer.getvalue() with base Serializer.getvalue()\n-        if callable(getattr(self.stream, 'getvalue', None)):\n-            return self.stream.getvalue()\n+        # Grand-parent super\n+        return super(PythonSerializer, self).getvalue()\n \n \n def Deserializer(stream_or_string, **options):"
        },
        {
            "sha": "73e92d557ff6ec846ea7f6cc955cbf71755f76d5",
            "filename": "django/core/serializers/pyyaml.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/26cb227cfe42d2500eac62dc0d90fb5227b275b3/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "raw_url": "https://github.com/django/django/raw/26cb227cfe42d2500eac62dc0d90fb5227b275b3/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpyyaml.py?ref=26cb227cfe42d2500eac62dc0d90fb5227b275b3",
            "patch": "@@ -44,7 +44,8 @@ def end_serialization(self):\n         yaml.dump(self.objects, self.stream, Dumper=DjangoSafeDumper, **self.options)\n \n     def getvalue(self):\n-        return self.stream.getvalue()\n+        # Grand-parent super\n+        return super(PythonSerializer, self).getvalue()\n \n def Deserializer(stream_or_string, **options):\n     \"\"\""
        },
        {
            "sha": "4e73be015c575e19a55de10577cad4af2e29c3df",
            "filename": "tests/regressiontests/serializers_regress/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 9,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/26cb227cfe42d2500eac62dc0d90fb5227b275b3/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/26cb227cfe42d2500eac62dc0d90fb5227b275b3/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py?ref=26cb227cfe42d2500eac62dc0d90fb5227b275b3",
            "patch": "@@ -21,6 +21,7 @@\n from django.core.serializers import SerializerDoesNotExist\n from django.core.serializers.base import DeserializationError\n from django.db import connection, models\n+from django.http import HttpResponse\n from django.test import TestCase\n from django.utils.functional import curry\n from django.utils.unittest import skipUnless\n@@ -501,15 +502,18 @@ def streamTest(format, self):\n     obj.save_base(raw=True)\n \n     # Serialize the test database to a stream\n-    stream = BytesIO()\n-    serializers.serialize(format, [obj], indent=2, stream=stream)\n-\n-    # Serialize normally for a comparison\n-    string_data = serializers.serialize(format, [obj], indent=2)\n-\n-    # Check that the two are the same\n-    self.assertEqual(string_data, stream.getvalue())\n-    stream.close()\n+    for stream in (BytesIO(), HttpResponse()):\n+        serializers.serialize(format, [obj], indent=2, stream=stream)\n+\n+        # Serialize normally for a comparison\n+        string_data = serializers.serialize(format, [obj], indent=2)\n+\n+        # Check that the two are the same\n+        if isinstance(stream, BytesIO):\n+            self.assertEqual(string_data, stream.getvalue())\n+        else:\n+            self.assertEqual(string_data, stream.content)\n+        stream.close()\n \n for format in serializers.get_serializer_formats():\n     setattr(SerializerTests, 'test_' + format + '_serializer', curry(serializerTest, format))"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 17,
        "deletions": 13
    }
}