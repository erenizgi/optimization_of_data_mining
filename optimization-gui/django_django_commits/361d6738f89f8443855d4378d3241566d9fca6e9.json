{
    "author": "claudep",
    "message": "Fixed #11739 -- Made ContentFile support Unicode input",
    "sha": "361d6738f89f8443855d4378d3241566d9fca6e9",
    "files": [
        {
            "sha": "b81e180292e2fa4193fe31277c5a416c5571a5c6",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/361d6738f89f8443855d4378d3241566d9fca6e9/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/361d6738f89f8443855d4378d3241566d9fca6e9/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=361d6738f89f8443855d4378d3241566d9fca6e9",
            "patch": "@@ -1,10 +1,11 @@\n from __future__ import unicode_literals\n \n import os\n-from io import BytesIO, UnsupportedOperation\n+from io import BytesIO, StringIO, UnsupportedOperation\n \n from django.utils.encoding import smart_text\n from django.core.files.utils import FileProxyMixin\n+from django.utils import six\n from django.utils.encoding import python_2_unicode_compatible\n \n @python_2_unicode_compatible\n@@ -132,7 +133,8 @@ class ContentFile(File):\n     \"\"\"\n     def __init__(self, content, name=None):\n         content = content or b''\n-        super(ContentFile, self).__init__(BytesIO(content), name=name)\n+        stream_class = StringIO if isinstance(content, six.text_type) else BytesIO\n+        super(ContentFile, self).__init__(stream_class(content), name=name)\n         self.size = len(content)\n \n     def __str__(self):"
        },
        {
            "sha": "ada614df45781965af3972627222aea76c49c0f0",
            "filename": "docs/ref/files/file.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/361d6738f89f8443855d4378d3241566d9fca6e9/docs%2Fref%2Ffiles%2Ffile.txt",
            "raw_url": "https://github.com/django/django/raw/361d6738f89f8443855d4378d3241566d9fca6e9/docs%2Fref%2Ffiles%2Ffile.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ffiles%2Ffile.txt?ref=361d6738f89f8443855d4378d3241566d9fca6e9",
            "patch": "@@ -91,14 +91,18 @@ The ``ContentFile`` Class\n .. class:: ContentFile(File)\n \n     The ``ContentFile`` class inherits from :class:`~django.core.files.File`,\n-    but unlike :class:`~django.core.files.File` it operates on string content,\n-    rather than an actual file. For example::\n+    but unlike :class:`~django.core.files.File` it operates on string content\n+    (bytes also supported), rather than an actual file. For example::\n \n         from __future__ import unicode_literals\n         from django.core.files.base import ContentFile\n \n-        f1 = ContentFile(b\"my string content\")\n-        f2 = ContentFile(\"my unicode content encoded as UTF-8\".encode('UTF-8'))\n+        f1 = ContentFile(\"esta sentencia está en español\")\n+        f2 = ContentFile(b\"these are bytes\")\n+\n+    .. versionchanged:: 1.5\n+\n+        ContentFile also accepts Unicode strings.\n \n .. currentmodule:: django.core.files.images\n "
        },
        {
            "sha": "cdd490fe93a18aa4459ad4697c490eec0bf0de70",
            "filename": "tests/regressiontests/file_storage/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/361d6738f89f8443855d4378d3241566d9fca6e9/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/361d6738f89f8443855d4378d3241566d9fca6e9/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_storage%2Ftests.py?ref=361d6738f89f8443855d4378d3241566d9fca6e9",
            "patch": "@@ -21,6 +21,7 @@\n from django.core.files.storage import FileSystemStorage, get_storage_class\n from django.core.files.uploadedfile import UploadedFile\n from django.test import SimpleTestCase\n+from django.utils import six\n from django.utils import unittest\n from ..servers.tests import LiveServerBase\n \n@@ -538,16 +539,25 @@ def test_multiple_calls(self):\n         self.assertEqual(size_1, size_2)\n \n class ContentFileTestCase(unittest.TestCase):\n-    \"\"\"\n-    Test that the constructor of ContentFile accepts 'name' (#16590).\n-    \"\"\"\n+\n     def test_content_file_default_name(self):\n         self.assertEqual(ContentFile(b\"content\").name, None)\n \n     def test_content_file_custom_name(self):\n+        \"\"\"\n+        Test that the constructor of ContentFile accepts 'name' (#16590).\n+        \"\"\"\n         name = \"I can have a name too!\"\n         self.assertEqual(ContentFile(b\"content\", name=name).name, name)\n \n+    def test_content_file_input_type(self):\n+        \"\"\"\n+        Test that ContentFile can accept both bytes and unicode and that the\n+        retrieved content is of the same type.\n+        \"\"\"\n+        self.assertTrue(isinstance(ContentFile(b\"content\").read(), bytes))\n+        self.assertTrue(isinstance(ContentFile(\"español\").read(), six.text_type))\n+\n class NoNameFileTestCase(unittest.TestCase):\n     \"\"\"\n     Other examples of unnamed files may be tempfile.SpooledTemporaryFile or"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 25,
        "deletions": 9
    }
}