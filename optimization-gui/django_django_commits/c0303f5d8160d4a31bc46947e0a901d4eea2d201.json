{
    "author": "ramiro",
    "message": "Workaround particularities of Python under Windows that interfere with expected outputs in `admin_scripts` regression tests.\n\nThye were causing most of them to fail in such platform.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16273 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c0303f5d8160d4a31bc46947e0a901d4eea2d201",
    "files": [
        {
            "sha": "11bd5c687a3a0540a2b717f067358913d00b1ecd",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/c0303f5d8160d4a31bc46947e0a901d4eea2d201/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c0303f5d8160d4a31bc46947e0a901d4eea2d201/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=c0303f5d8160d4a31bc46947e0a901d4eea2d201",
            "patch": "@@ -157,7 +157,18 @@ def run_manage(self, args, settings_file=None):\n \n     def assertNoOutput(self, stream):\n         \"Utility assertion: assert that the given stream is empty\"\n+        # HACK: Under Windows, ignore warnings of the form:\n+        # 'warning: Not loading directory '...\\tests\\regressiontests\\locale': missing __init__.py'\n+        # It has been impossible to filter them out using other means like:\n+        # * Using warning.filterwarnings() (for the Python interpreter running the\n+        #   tests) and/or\n+        # * Using -Wignore:... (for the python interpreter spawned in self.run_test())\n+        # Instead use a strategy copied from Mercurial's setup.py\n+        if sys.platform == 'win32':\n+            stream = [e for e in stream.splitlines()\n+                if not e.startswith('warning: Not importing directory')]\n         self.assertEqual(len(stream), 0, \"Stream should be empty: actually contains '%s'\" % stream)\n+\n     def assertOutput(self, stream, msg):\n         \"Utility assertion: assert that the given message exists in the output\"\n         self.assertTrue(msg in stream, \"'%s' does not match actual output text '%s'\" % (msg, stream))\n@@ -545,10 +556,11 @@ def test_setup_environ(self):\n         \"directory: startapp creates the correct directory\"\n         test_dir = os.path.dirname(os.path.dirname(__file__))\n         args = ['startapp','settings_test']\n+        app_path = os.path.join(test_dir, 'settings_test')\n         out, err = self.run_django_admin(args,'settings')\n+        self.addCleanup(shutil.rmtree, app_path)\n         self.assertNoOutput(err)\n-        self.assertTrue(os.path.exists(os.path.join(test_dir, 'settings_test')))\n-        shutil.rmtree(os.path.join(test_dir, 'settings_test'))\n+        self.assertTrue(os.path.exists(app_path))\n \n     def test_builtin_command(self):\n         \"directory: django-admin builtin commands fail with an import error when no settings provided\""
        }
    ],
    "stats": {
        "total": 16,
        "additions": 14,
        "deletions": 2
    }
}