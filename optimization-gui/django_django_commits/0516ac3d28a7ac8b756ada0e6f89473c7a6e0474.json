{
    "author": "jbronn",
    "message": "Fixed #13670 -- Comparisons with the spatial adapter won't blow up in some corner cases.  Thanks, milosu for the bug report and jpaulett for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16757 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0516ac3d28a7ac8b756ada0e6f89473c7a6e0474",
    "files": [
        {
            "sha": "ca77124351b0cab1a3a4076210901769f1205e63",
            "filename": "django/contrib/gis/db/backends/adapter.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0516ac3d28a7ac8b756ada0e6f89473c7a6e0474/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fadapter.py",
            "raw_url": "https://github.com/django/django/raw/0516ac3d28a7ac8b756ada0e6f89473c7a6e0474/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fadapter.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fadapter.py?ref=0516ac3d28a7ac8b756ada0e6f89473c7a6e0474",
            "patch": "@@ -8,6 +8,8 @@ def __init__(self, geom):\n         self.srid = geom.srid\n \n     def __eq__(self, other):\n+        if not isinstance(other, WKTAdapter):\n+            return False\n         return self.wkt == other.wkt and self.srid == other.srid\n \n     def __str__(self):"
        },
        {
            "sha": "c9b9841d55ab3c434b627f3c7235ffa506f795d7",
            "filename": "django/contrib/gis/db/backends/postgis/adapter.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0516ac3d28a7ac8b756ada0e6f89473c7a6e0474/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fadapter.py",
            "raw_url": "https://github.com/django/django/raw/0516ac3d28a7ac8b756ada0e6f89473c7a6e0474/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fadapter.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fadapter.py?ref=0516ac3d28a7ac8b756ada0e6f89473c7a6e0474",
            "patch": "@@ -21,6 +21,8 @@ def __conform__(self, proto):\n             raise Exception('Error implementing psycopg2 protocol. Is psycopg2 installed?')\n \n     def __eq__(self, other):\n+        if not isinstance(other, PostGISAdapter):\n+            return False\n         return (self.ewkb == other.ewkb) and (self.srid == other.srid)\n \n     def __str__(self):"
        },
        {
            "sha": "45070b0c935b9dfd50f2d0da6e5b88dd3b9790b8",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/0516ac3d28a7ac8b756ada0e6f89473c7a6e0474/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/0516ac3d28a7ac8b756ada0e6f89473c7a6e0474/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=0516ac3d28a7ac8b756ada0e6f89473c7a6e0474",
            "patch": "@@ -2,7 +2,7 @@\n from django.contrib.gis.tests.utils import no_mysql, no_spatialite\n from django.contrib.gis.shortcuts import render_to_kmz\n from django.test import TestCase\n-from models import City, PennsylvaniaCity\n+from models import City, PennsylvaniaCity, State\n \n class GeoRegressionTests(TestCase):\n \n@@ -43,3 +43,13 @@ def test04_unicode_date(self):\n         mansfield = PennsylvaniaCity.objects.create(name='Mansfield', county='Tioga', point='POINT(-77.071445 41.823881)',\n                                                     founded=founded)\n         self.assertEqual(founded, PennsylvaniaCity.objects.dates('founded', 'day')[0])\n+\n+    def test05_empty_count(self):\n+         \"Testing that PostGISAdapter.__eq__ does check empty strings, see #13670\"\n+         # contrived example, but need a geo lookup paired with an id__in lookup\n+         pueblo = City.objects.get(name='Pueblo')\n+         state = State.objects.filter(poly__contains=pueblo.point)\n+         cities_within_state = City.objects.filter(id__in=state)\n+\n+         # .count() should not throw TypeError in __eq__\n+         self.assertEqual(cities_within_state.count(), 1)"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 15,
        "deletions": 1
    }
}