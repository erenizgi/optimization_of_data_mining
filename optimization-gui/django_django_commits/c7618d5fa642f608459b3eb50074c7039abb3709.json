{
    "author": "jbronn",
    "message": "Updated GeoDjango installation docs and spatial database template script for latest Ubuntu/Debian packages.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15520 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c7618d5fa642f608459b3eb50074c7039abb3709",
    "files": [
        {
            "sha": "61bbef40a10cfffa5f43d1c677dd465a52c69c93",
            "filename": "docs/ref/contrib/gis/create_template_postgis-debian.sh",
            "status": "modified",
            "additions": 37,
            "deletions": 8,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/c7618d5fa642f608459b3eb50074c7039abb3709/docs%2Fref%2Fcontrib%2Fgis%2Fcreate_template_postgis-debian.sh",
            "raw_url": "https://github.com/django/django/raw/c7618d5fa642f608459b3eb50074c7039abb3709/docs%2Fref%2Fcontrib%2Fgis%2Fcreate_template_postgis-debian.sh",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fcreate_template_postgis-debian.sh?ref=c7618d5fa642f608459b3eb50074c7039abb3709",
            "patch": "@@ -1,9 +1,38 @@\n-#!/usr/bin/env bash\n-POSTGIS_SQL_PATH=/usr/share/postgresql-8.3-postgis\n-createdb -E UTF8 template_postgis # Create the template spatial database.\n-createlang -d template_postgis plpgsql # Adding PLPGSQL language support.\n-psql -d postgres -c \"UPDATE pg_database SET datistemplate='true' WHERE datname='template_postgis';\"\n-psql -d template_postgis -f $POSTGIS_SQL_PATH/lwpostgis.sql # Loading the PostGIS SQL routines\n-psql -d template_postgis -f $POSTGIS_SQL_PATH/spatial_ref_sys.sql\n-psql -d template_postgis -c \"GRANT ALL ON geometry_columns TO PUBLIC;\" # Enabling users to alter spatial tables.\n+#!/bin/bash\n+\n+# For Ubuntu 8.x and 9.x releases.\n+if [ -d \"/usr/share/postgresql-8.3-postgis\" ]\n+then\n+    POSTGIS_SQL_PATH=/usr/share/postgresql-8.3-postgis\n+    POSTGIS_SQL=lwpostgis.sql\n+fi\n+\n+# For Ubuntu 10.04\n+if [ -d \"/usr/share/postgresql/8.4/contrib\" ]\n+then\n+    POSTGIS_SQL_PATH=/usr/share/postgresql/8.4/contrib\n+    POSTGIS_SQL=postgis.sql\n+fi\n+\n+# For Ubuntu 10.10 (with PostGIS 1.5)\n+if [ -d \"/usr/share/postgresql/8.4/contrib/postgis-1.5\" ]\n+then\n+    POSTGIS_SQL_PATH=/usr/share/postgresql/8.4/contrib/postgis-1.5\n+    POSTGIS_SQL=postgis.sql\n+    GEOGRAPHY=1\n+else\n+    GEOGRAPHY=0\n+fi\n+\n+createdb -E UTF8 template_postgis && \\\n+createlang -d template_postgis plpgsql && \\\n+psql -d postgres -c \"UPDATE pg_database SET datistemplate='true' WHERE datname='template_postgis';\" && \\\n+psql -d template_postgis -f $POSTGIS_SQL_PATH/$POSTGIS_SQL && \\\n+psql -d template_postgis -f $POSTGIS_SQL_PATH/spatial_ref_sys.sql && \\\n+psql -d template_postgis -c \"GRANT ALL ON geometry_columns TO PUBLIC;\" && \\\n psql -d template_postgis -c \"GRANT ALL ON spatial_ref_sys TO PUBLIC;\"\n+\n+if ((GEOGRAPHY))\n+then\n+    psql -d template_postgis -c \"GRANT ALL ON geography_columns TO PUBLIC;\"\n+fi"
        },
        {
            "sha": "ee1247deaf221a3d51ed1ae449fb5f39ba54cf36",
            "filename": "docs/ref/contrib/gis/install.txt",
            "status": "modified",
            "additions": 44,
            "deletions": 37,
            "changes": 81,
            "blob_url": "https://github.com/django/django/blob/c7618d5fa642f608459b3eb50074c7039abb3709/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/c7618d5fa642f608459b3eb50074c7039abb3709/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt?ref=c7618d5fa642f608459b3eb50074c7039abb3709",
            "patch": "@@ -89,7 +89,7 @@ Program                   Description                           Required\n ========================  ====================================  ================================  ==========================\n :ref:`GEOS <ref-geos>`    Geometry Engine Open Source           Yes                               3.2, 3.1, 3.0\n `PROJ.4`_                 Cartographic Projections library      Yes (PostgreSQL and SQLite only)  4.7, 4.6, 4.5, 4.4\n-:ref:`GDAL <ref-gdal>`    Geospatial Data Abstraction Library   No (but, required for SQLite)     1.7, 1.6, 1.5, 1.4\n+:ref:`GDAL <ref-gdal>`    Geospatial Data Abstraction Library   No (but, required for SQLite)     1.8, 1.7, 1.6, 1.5, 1.4\n :ref:`GeoIP <ref-geoip>`  IP-based geolocation library          No                                1.4\n `PostGIS`__               Spatial extensions for PostgreSQL     Yes (PostgreSQL only)             1.5, 1.4, 1.3\n `SpatiaLite`__            Spatial extensions for SQLite         Yes (SQLite only)                 2.4, 2.3\n@@ -176,7 +176,7 @@ When GeoDjango can't find GEOS, this error is raised::\n The most common solution is to properly configure your :ref:`libsettings` *or* set\n :ref:`geoslibrarypath` in your settings.\n \n-If using a binary package of GEOS (e.g., on Ubuntu 8.10), you may need to :ref:`binutils`.\n+If using a binary package of GEOS (e.g., on Ubuntu), you may need to :ref:`binutils`.\n \n .. _geoslibrarypath:\n \n@@ -274,9 +274,9 @@ supports :ref:`GDAL's vector data <ref-gdal>` capabilities [#]_.\n \n First download the latest GDAL release version and untar the archive::\n \n-    $ wget http://download.osgeo.org/gdal/gdal-1.7.3.tar.gz\n-    $ tar xzf gdal-1.7.3.tar.gz\n-    $ cd gdal-1.7.3\n+    $ wget http://download.osgeo.org/gdal/gdal-1.8.0.tar.gz\n+    $ tar xzf gdal-1.8.0.tar.gz\n+    $ cd gdal-1.8.0\n \n Configure, make and install::\n \n@@ -517,14 +517,15 @@ user.  For example, you can use the following to become the ``postgres`` user::\n    whereas version 1.4 uses ``<sharedir>/contrib/postgis.sql`` and\n    version 1.5 uses ``<sharedir>/contrib/postgis-1.5/postgis.sql``.\n \n+   To complicate matters, :ref:`ubuntudebian` distributions have their\n+   own separate directory naming system that changes each release.\n+\n    The example below assumes PostGIS 1.5, thus you may need to modify\n    ``POSTGIS_SQL_PATH`` and the name of the SQL file for the specific\n    version of PostGIS you are using.\n \n Once you're a database super user, then you may execute the following commands\n-to create a PostGIS spatial database template.  If running Ubuntu :ref:`ibex`\n-or Debian :ref:`lenny`, please refer to their specific documentation for\n-modifications to these commands::\n+to create a PostGIS spatial database template::\n \n     $ POSTGIS_SQL_PATH=`pg_config --sharedir`/contrib/postgis-1.5\n     # Creating the template spatial database.\n@@ -549,6 +550,7 @@ PostGIS Version  Shell Script\n 1.3              `create_template_postgis-1.3.sh`_\n 1.4              `create_template_postgis-1.4.sh`_\n 1.5              `create_template_postgis-1.5.sh`_\n+Debian/Ubuntu    `create_template_postgis-debian.sh`_\n ===============  ==========================================\n \n Afterwards, you may create a spatial database by simply specifying\n@@ -919,22 +921,30 @@ __ http://www.macports.org/\n Ubuntu & Debian GNU/Linux\n -------------------------\n \n+.. note::\n+\n+    The PostGIS SQL files are not placed the PostgreSQL share directory in the\n+    Debian and Ubuntu packages, and are located instead special directory\n+    depending on the release.  Thus, when :ref:`spatialdb_template` use the \n+    `create_template_postgis-debian.sh`_ script instead \n+\n .. _ubuntu:\n \n Ubuntu\n ^^^^^^\n \n-.. _heron:\n+.. _ubuntu10:\n \n-8.04 and lower\n-~~~~~~~~~~~~~~\n+10.04 and 10.10\n+~~~~~~~~~~~~~~~\n \n-The 8.04 (and lower) versions of Ubuntu use GEOS v2.2.3 in their binary packages,\n-which is incompatible with GeoDjango.  Thus, do *not* use the binary packages\n-for GEOS or PostGIS and build some prerequisites from source, per the instructions\n-in this document; however, it is okay to use the PostgreSQL binary packages.\n+In Ubuntu 10 PostgreSQL was upgraded to 8.4 and GDAL was upgraded to 1.6.\n+Ubuntu 10.04 uses PostGIS 1.4, while Ubuntu 10.10 uses PostGIS 1.5 (with\n+geography support).  The installation commands are::\n \n-For more details, please see the Debian instructions for :ref:`etch` below.\n+    $ sudo apt-get install binutils gdal-bin postgresql-8.4-postgis \\\n+         postgresql-server-dev-8.4 python-psycopg2 python-setuptools\n+    $ sudo easy_install Django\n \n .. _ibex:\n \n@@ -943,7 +953,7 @@ For more details, please see the Debian instructions for :ref:`etch` below.\n \n Use the synaptic package manager to install the following packages::\n \n-    $ sudo apt-get install binutils libgdal1-1.5.0 postgresql-8.3-postgis \\\n+    $ sudo apt-get install binutils gdal-bin postgresql-8.3-postgis \\\n         postgresql-server-dev-8.3 python-psycopg2 python-setuptools\n \n Afterwards, you may install Django with Python's ``easy_install`` script (the\n@@ -970,24 +980,14 @@ Optional packages to consider:\n * ``gdal-bin``: for GDAL command line programs like ``ogr2ogr``\n * ``python-gdal`` for GDAL's own Python bindings -- includes interfaces for raster manipulation\n \n-10.04\n-~~~~~\n-\n-In Ubuntu 10.04 LTS PostgreSQL was upgraded to 8.4, as was GDAL, which is now\n-at version 1.6.0. Because of that, the package installation mentioned above\n-has to be slightly changed::\n-\n-\t$ sudo apt-get install binutils libgdal1-1.6.0 postgresql-8.4-postgis \\\n-        postgresql-server-dev-8.4 python-psycopg2 python-setuptools\n-\n-\n .. note::\n \n-    The Ubuntu ``proj`` package does not come with the datum shifting files\n-    installed, which will cause problems with the geographic admin because\n-    the ``null`` datum grid is not available for transforming geometries to the\n-    spherical mercator projection. A solution is to download the\n-    datum-shifting files, create the grid file, and install it yourself::\n+    On this version of Ubuntu the ``proj`` package does not come with the\n+    datum shifting files installed, which will cause problems with the\n+    geographic admin because the ``null`` datum grid is not available for\n+    transforming geometries to the spherical mercator projection. A solution\n+    is to download the datum-shifting files, create the grid file, and\n+    install it yourself::\n \n         $ wget http://download.osgeo.org/proj/proj-datumgrid-1.4.tar.gz\n         $ mkdir nad\n@@ -1000,11 +1000,17 @@ has to be slightly changed::\n     do not plan on doing any database transformation of geometries to the\n     Google projection (900913).\n \n-.. note::\n+.. _heron:\n \n-    The PostGIS SQL files are not placed the PostgreSQL share directory in the\n-    Ubuntu packages.  Use the `create_template_postgis-debian.sh`_ script\n-    instead when :ref:`spatialdb_template`.\n+8.04 and lower\n+~~~~~~~~~~~~~~\n+\n+The 8.04 (and lower) versions of Ubuntu use GEOS v2.2.3 in their binary packages,\n+which is incompatible with GeoDjango.  Thus, do *not* use the binary packages\n+for GEOS or PostGIS and build some prerequisites from source, per the instructions\n+in this document; however, it is okay to use the PostgreSQL binary packages.\n+\n+For more details, please see the Debian instructions for :ref:`etch` below.\n \n .. _debian:\n \n@@ -1051,6 +1057,7 @@ directions carefully.\n \n 5.0 (Lenny)\n ^^^^^^^^^^^\n+\n This version is comparable to Ubuntu :ref:`ibex`, so the command\n is very similar::\n "
        }
    ],
    "stats": {
        "total": 126,
        "additions": 81,
        "deletions": 45
    }
}