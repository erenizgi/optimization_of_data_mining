{
    "author": "carljm",
    "message": "Refs #15855 -- Recommended the csrf_protect decorator rather than vary_on_cookie as workaround for cache_page caching the response before it gets to middleware.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16361 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0e03a504bf28c727283bcabbff0f4dc63feaf573",
    "files": [
        {
            "sha": "93a7bb7c659da56500f53f77c024402a32bd15be",
            "filename": "docs/ref/contrib/csrf.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/0e03a504bf28c727283bcabbff0f4dc63feaf573/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "raw_url": "https://github.com/django/django/raw/0e03a504bf28c727283bcabbff0f4dc63feaf573/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcsrf.txt?ref=0e03a504bf28c727283bcabbff0f4dc63feaf573",
            "patch": "@@ -238,15 +238,16 @@ middleware will play well with the cache middleware if it is used as instructed\n (``UpdateCacheMiddleware`` goes before all other middleware).\n \n However, if you use cache decorators on individual views, the CSRF middleware\n-will not yet have been able to set the Vary header.  In this case, on any views\n-that will require a CSRF token to be inserted you should use the\n-:func:`django.views.decorators.vary.vary_on_cookie` decorator first::\n+will not yet have been able to set the Vary header or the CSRF cookie, and the\n+response will be cached without either one. In this case, on any views that\n+will require a CSRF token to be inserted you should use the\n+:func:`django.views.decorators.csrf.csrf_protect` decorator first::\n \n   from django.views.decorators.cache import cache_page\n-  from django.views.decorators.vary import vary_on_cookie\n+  from django.views.decorators.csrf import csrf_protect\n \n   @cache_page(60 * 15)\n-  @vary_on_cookie\n+  @csrf_protect\n   def my_view(request):\n       # ...\n "
        }
    ],
    "stats": {
        "total": 11,
        "additions": 6,
        "deletions": 5
    }
}