{
    "author": "aaugustin",
    "message": "Fixed #12183 -- Made the urlize filter insert the nofollow attribute properly when an http: URL occurs after a mailto: URL. Thanks eronen for the report.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17356 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "aa4e1522968b19499801fe3d73d6b2f3bf3b3acd",
    "files": [
        {
            "sha": "a0ad5f3d00ec86716cd317f5f22fa485d52cba3a",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/aa4e1522968b19499801fe3d73d6b2f3bf3b3acd/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/aa4e1522968b19499801fe3d73d6b2f3bf3b3acd/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=aa4e1522968b19499801fe3d73d6b2f3bf3b3acd",
            "patch": "@@ -141,7 +141,6 @@ def urlize(text, trim_url_limit=None, nofollow=False, autoescape=False):\n     trim_url = lambda x, limit=trim_url_limit: limit is not None and (len(x) > limit and ('%s...' % x[:max(0, limit - 3)])) or x\n     safe_input = isinstance(text, SafeData)\n     words = word_split_re.split(force_unicode(text))\n-    nofollow_attr = nofollow and ' rel=\"nofollow\"' or ''\n     for i, word in enumerate(words):\n         match = None\n         if '.' in word or '@' in word or ':' in word:\n@@ -150,6 +149,7 @@ def urlize(text, trim_url_limit=None, nofollow=False, autoescape=False):\n             lead, middle, trail = match.groups()\n             # Make URL we want to point to.\n             url = None\n+            nofollow_attr = ' rel=\"nofollow\"' if nofollow else ''\n             if middle.startswith('http://') or middle.startswith('https://'):\n                 url = smart_urlquote(middle)\n             elif middle.startswith('www.') or ('@' not in middle and \\"
        },
        {
            "sha": "2c7cdb17a66c36ffc3547332f2f063933e660cf9",
            "filename": "tests/regressiontests/defaultfilters/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/aa4e1522968b19499801fe3d73d6b2f3bf3b3acd/tests%2Fregressiontests%2Fdefaultfilters%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/aa4e1522968b19499801fe3d73d6b2f3bf3b3acd/tests%2Fregressiontests%2Fdefaultfilters%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdefaultfilters%2Ftests.py?ref=aa4e1522968b19499801fe3d73d6b2f3bf3b3acd",
            "patch": "@@ -253,6 +253,11 @@ def test_urlize(self):\n             u'<a href=\"http://en.wikipedia.org/wiki/Caf%C3%A9\" rel=\"nofollow\">'\n             u'http://en.wikipedia.org/wiki/Café</a>')\n \n+        # Check urlize adds nofollow properly - see #12183\n+        self.assertEqual(urlize('foo@bar.com or www.bar.com'),\n+            u'<a href=\"mailto:foo@bar.com\">foo@bar.com</a> or '\n+            u'<a href=\"http://www.bar.com\" rel=\"nofollow\">www.bar.com</a>')\n+\n         # Check urlize handles IDN correctly - see #13704\n         self.assertEqual(urlize('http://c✶.ws'),\n             u'<a href=\"http://xn--c-lgq.ws\" rel=\"nofollow\">http://c✶.ws</a>')"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}