{
    "author": "aaugustin",
    "message": "Fixed #18978 -- Moved cleanup command to sessions.\n\nThis removes a dependency of 'core' on 'contrib'.",
    "sha": "83ba0a9d4b078fd177ac5c06699486d708d62bff",
    "files": [
        {
            "sha": "ac3de00f2c05c47d5a48bc9e33938258cd916086",
            "filename": "django/bin/daily_cleanup.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fbin%2Fdaily_cleanup.py",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fbin%2Fdaily_cleanup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fbin%2Fdaily_cleanup.py?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -7,7 +7,13 @@\n sessions at the moment).\n \"\"\"\n \n+import warnings\n+\n from django.core import management\n \n if __name__ == \"__main__\":\n-    management.call_command('cleanup')\n+    warnings.warn(\n+        \"The `daily_cleanup` script has been deprecated \"\n+        \"in favor of `django-admin.py clearsessions`.\",\n+        PendingDeprecationWarning)\n+    management.call_command('clearsessions')"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/sessions/management/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcontrib%2Fsessions%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcontrib%2Fsessions%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmanagement%2F__init__.py?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/sessions/management/commands/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2F__init__.py?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff"
        },
        {
            "sha": "fb7666f85a22ca813ebd5b6c8c4a9bd7bc6d0db8",
            "filename": "django/contrib/sessions/management/commands/clearsessions.py",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2Fclearsessions.py",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2Fclearsessions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmanagement%2Fcommands%2Fclearsessions.py?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -0,0 +1,11 @@\n+from django.core.management.base import NoArgsCommand\n+from django.utils import timezone\n+\n+class Command(NoArgsCommand):\n+    help = \"Can be run as a cronjob or directly to clean out expired sessions (only with the database backend at the moment).\"\n+\n+    def handle_noargs(self, **options):\n+        from django.db import transaction\n+        from django.contrib.sessions.models import Session\n+        Session.objects.filter(expire_date__lt=timezone.now()).delete()\n+        transaction.commit_unless_managed()"
        },
        {
            "sha": "f83c64be8f07930fe7c729f73c158a2ba1ce36b7",
            "filename": "django/core/management/commands/cleanup.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcore%2Fmanagement%2Fcommands%2Fcleanup.py",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/django%2Fcore%2Fmanagement%2Fcommands%2Fcleanup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcleanup.py?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -1,11 +1,11 @@\n-from django.core.management.base import NoArgsCommand\n-from django.utils import timezone\n+import warnings\n \n-class Command(NoArgsCommand):\n-    help = \"Can be run as a cronjob or directly to clean out old data from the database (only expired sessions at the moment).\"\n+from django.contrib.sessions.management.commands import clearsessions\n \n+\n+class Command(clearsessions.Command):\n     def handle_noargs(self, **options):\n-        from django.db import transaction\n-        from django.contrib.sessions.models import Session\n-        Session.objects.filter(expire_date__lt=timezone.now()).delete()\n-        transaction.commit_unless_managed()\n+        warnings.warn(\n+            \"The `cleanup` command has been deprecated in favor of `clearsessions`.\",\n+            PendingDeprecationWarning)\n+        super(Command, self).handle_noargs(**options)"
        },
        {
            "sha": "77371c8608ef21d14854327594d2848381bbaa41",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -293,6 +293,11 @@ these changes.\n * The ``AUTH_PROFILE_MODULE`` setting, and the ``get_profile()`` method on\n   the User model, will be removed.\n \n+* The ``cleanup`` management command will be removed. It's replaced by\n+  ``clearsessions``.\n+\n+* The ``daily_cleanup.py`` script will be removed.\n+\n 2.0\n ---\n "
        },
        {
            "sha": "833db0839c7df0e6cf1d04ac2ee84dab363846f0",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -96,6 +96,9 @@ cleanup\n Can be run as a cronjob or directly to clean out old data from the database\n (only expired sessions at the moment).\n \n+.. versionchanged:: 1.5\n+    :djadmin:`cleanup` is deprecated. Use :djadmin:`clearsessions` instead.\n+\n compilemessages\n ---------------\n \n@@ -1187,6 +1190,18 @@ This command is only available if :doc:`GeoDjango </ref/contrib/gis/index>`\n Please refer to its :djadmin:`description <ogrinspect>` in the GeoDjango\n documentation.\n \n+``django.contrib.sessions``\n+---------------------------\n+\n+clearsessions\n+~~~~~~~~~~~~~~~\n+\n+.. django-admin:: clearsessions\n+\n+Can be run as a cron job or directly to clean out expired sessions.\n+\n+This is only supported by the database backend at the moment.\n+\n ``django.contrib.sitemaps``\n ---------------------------\n "
        },
        {
            "sha": "ebf88e83b98e27c02aa7543ebb60090be684b9c9",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -613,11 +613,22 @@ Define a ``__str__`` method and apply the\n The :func:`~django.utils.itercompat.product` function has been deprecated. Use\n the built-in :func:`itertools.product` instead.\n \n-\n ``django.utils.markup``\n ~~~~~~~~~~~~~~~~~~~~~~~\n \n The markup contrib module has been deprecated and will follow an accelerated\n deprecation schedule. Direct use of python markup libraries or 3rd party tag\n libraries is preferred to Django maintaining this functionality in the\n framework.\n+\n+``cleanup`` management command\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :djadmin:`cleanup` management command has been deprecated and replaced by\n+:djadmin:`clearsessions`.\n+\n+``daily_cleanup.py`` script\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The undocumented ``daily_cleanup.py`` script has been deprecated. Use the\n+:djadmin:`clearsessions` management command instead."
        },
        {
            "sha": "0082b75db1c6b3944c6a4eb6332bf6a49c2b53fc",
            "filename": "docs/topics/http/sessions.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "raw_url": "https://github.com/django/django/raw/83ba0a9d4b078fd177ac5c06699486d708d62bff/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fsessions.txt?ref=83ba0a9d4b078fd177ac5c06699486d708d62bff",
            "patch": "@@ -460,7 +460,7 @@ table. Django updates this row each time the session data changes. If the user\n logs out manually, Django deletes the row. But if the user does *not* log out,\n the row never gets deleted.\n \n-Django provides a sample clean-up script: ``django-admin.py cleanup``.\n+Django provides a sample clean-up script: ``django-admin.py clearsessions``.\n That script deletes any session in the session table whose ``expire_date`` is\n in the past -- but your application may have different requirements.\n "
        }
    ],
    "stats": {
        "total": 70,
        "additions": 59,
        "deletions": 11
    }
}