{
    "author": "claudep",
    "message": "Prevented flatpage view from directly accessing settings.SITE_ID\n\nRefs #15089",
    "sha": "1ce4aedcefb68086918adc4137d75a6f2c0bd1f2",
    "files": [
        {
            "sha": "497979e497e5bd6ef83859bc9957a61ff11e2bf8",
            "filename": "django/contrib/flatpages/views.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/1ce4aedcefb68086918adc4137d75a6f2c0bd1f2/django%2Fcontrib%2Fflatpages%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/1ce4aedcefb68086918adc4137d75a6f2c0bd1f2/django%2Fcontrib%2Fflatpages%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Fviews.py?ref=1ce4aedcefb68086918adc4137d75a6f2c0bd1f2",
            "patch": "@@ -1,9 +1,10 @@\n-from django.contrib.flatpages.models import FlatPage\n-from django.template import loader, RequestContext\n-from django.shortcuts import get_object_or_404\n-from django.http import Http404, HttpResponse, HttpResponsePermanentRedirect\n from django.conf import settings\n+from django.contrib.flatpages.models import FlatPage\n+from django.contrib.sites.models import get_current_site\n from django.core.xheaders import populate_xheaders\n+from django.http import Http404, HttpResponse, HttpResponsePermanentRedirect\n+from django.shortcuts import get_object_or_404\n+from django.template import loader, RequestContext\n from django.utils.safestring import mark_safe\n from django.views.decorators.csrf import csrf_protect\n \n@@ -30,14 +31,15 @@ def flatpage(request, url):\n     \"\"\"\n     if not url.startswith('/'):\n         url = '/' + url\n+    site_id = get_current_site(request).id\n     try:\n         f = get_object_or_404(FlatPage,\n-            url__exact=url, sites__id__exact=settings.SITE_ID)\n+            url__exact=url, sites__id__exact=site_id)\n     except Http404:\n         if not url.endswith('/') and settings.APPEND_SLASH:\n             url += '/'\n             f = get_object_or_404(FlatPage,\n-                url__exact=url, sites__id__exact=settings.SITE_ID)\n+                url__exact=url, sites__id__exact=site_id)\n             return HttpResponsePermanentRedirect('%s/' % request.path)\n         else:\n             raise"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 8,
        "deletions": 6
    }
}