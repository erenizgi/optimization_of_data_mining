{
    "author": "jphalip",
    "message": "Fixed #18393 -- Prevented blocktrans to crash when a variable name is badly formatted.",
    "sha": "432339a72c20f78abf1999892a39c71b5d853174",
    "files": [
        {
            "sha": "e090781080d8eb0998b10cc3e012ffe6d2006cd9",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/432339a72c20f78abf1999892a39c71b5d853174/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/432339a72c20f78abf1999892a39c71b5d853174/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=432339a72c20f78abf1999892a39c71b5d853174",
            "patch": "@@ -148,7 +148,7 @@ def render(self, context):\n         context.pop()\n         try:\n             result = result % data\n-        except KeyError:\n+        except (KeyError, ValueError):\n             with translation.override(None):\n                 result = self.render(context)\n         return result"
        },
        {
            "sha": "478338bc886a2445f9a1c7004b49f4bac719d5fb",
            "filename": "tests/regressiontests/i18n/other/locale/fr/LC_MESSAGES/django.mo",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/432339a72c20f78abf1999892a39c71b5d853174/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/432339a72c20f78abf1999892a39c71b5d853174/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo?ref=432339a72c20f78abf1999892a39c71b5d853174"
        },
        {
            "sha": "dafb6139ae832d93f556b76f44953db83e496186",
            "filename": "tests/regressiontests/i18n/other/locale/fr/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/432339a72c20f78abf1999892a39c71b5d853174/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/432339a72c20f78abf1999892a39c71b5d853174/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fother%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po?ref=432339a72c20f78abf1999892a39c71b5d853174",
            "patch": "@@ -17,5 +17,11 @@ msgstr \"\"\n \"Plural-Forms: nplurals=2; plural=(n != 1)\\n\"\n \n #: template.html:3\n+# Note: Intentional: variable name is translated.\n msgid \"My name is %(person)s.\"\n msgstr \"Mon nom est %(personne)s.\"\n+\n+#: template.html:3\n+# Note: Intentional: the variable name is badly formatted (missing 's' at the end)\n+msgid \"My other name is %(person)s.\"\n+msgstr \"Mon autre nom est %(person).\"\n\\ No newline at end of file"
        },
        {
            "sha": "78e41321af7e3ee9b4d6effb5f83de692412bc69",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/432339a72c20f78abf1999892a39c71b5d853174/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/432339a72c20f78abf1999892a39c71b5d853174/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=432339a72c20f78abf1999892a39c71b5d853174",
            "patch": "@@ -270,17 +270,31 @@ def test_to_language(self):\n         self.assertEqual(to_language('sr_Lat'), 'sr-lat')\n \n     @override_settings(LOCALE_PATHS=(os.path.join(here, 'other', 'locale'),))\n-    def test_bad_placeholder(self):\n+    def test_bad_placeholder_1(self):\n         \"\"\"\n         Error in translation file should not crash template rendering\n         (%(person)s is translated as %(personne)s in fr.po)\n+        Refs #16516.\n         \"\"\"\n         from django.template import Template, Context\n         with translation.override('fr'):\n             t = Template('{% load i18n %}{% blocktrans %}My name is {{ person }}.{% endblocktrans %}')\n             rendered = t.render(Context({'person': 'James'}))\n             self.assertEqual(rendered, 'My name is James.')\n \n+    @override_settings(LOCALE_PATHS=(os.path.join(here, 'other', 'locale'),))\n+    def test_bad_placeholder_2(self):\n+        \"\"\"\n+        Error in translation file should not crash template rendering\n+        (%(person) misses a 's' in fr.po, causing the string formatting to fail)\n+        Refs #18393.\n+        \"\"\"\n+        from django.template import Template, Context\n+        with translation.override('fr'):\n+            t = Template('{% load i18n %}{% blocktrans %}My other name is {{ person }}.{% endblocktrans %}')\n+            rendered = t.render(Context({'person': 'James'}))\n+            self.assertEqual(rendered, 'My other name is James.')\n+\n \n class FormattingTests(TestCase):\n "
        }
    ],
    "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
    }
}