{
    "author": "claudep",
    "message": "Cleaned up i18n regression tests",
    "sha": "e70170c2cbc8871f3bc1f585601b831eef0be9dc",
    "files": [
        {
            "sha": "1346383f3d06169555a3ee37287ceab8244349bb",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 132,
            "deletions": 154,
            "changes": 286,
            "blob_url": "https://github.com/django/django/blob/e70170c2cbc8871f3bc1f585601b831eef0be9dc/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e70170c2cbc8871f3bc1f585601b831eef0be9dc/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=e70170c2cbc8871f3bc1f585601b831eef0be9dc",
            "patch": "@@ -23,7 +23,7 @@\n from django.utils.six import PY3\n from django.utils.translation import (ugettext, ugettext_lazy, activate,\n     deactivate, gettext_lazy, pgettext, npgettext, to_locale,\n-    get_language_info, get_language, get_language_from_request)\n+    get_language_info, get_language, get_language_from_request, trans_real)\n \n \n from .commands.tests import can_run_extraction_tests, can_run_compilation_tests\n@@ -45,6 +45,9 @@\n \n \n here = os.path.dirname(os.path.abspath(__file__))\n+extended_locale_paths = settings.LOCALE_PATHS + (\n+    os.path.join(here, 'other', 'locale'),\n+)\n \n class TranslationTests(TestCase):\n \n@@ -86,139 +89,129 @@ def test_lazy_pickle(self):\n         s2 = pickle.loads(pickle.dumps(s1))\n         self.assertEqual(six.text_type(s2), \"test\")\n \n+    @override_settings(LOCALE_PATHS=extended_locale_paths)\n     def test_pgettext(self):\n-        # Reset translation catalog to include other/locale/de\n-        extended_locale_paths = settings.LOCALE_PATHS + (\n-            os.path.join(here, 'other', 'locale'),\n-        )\n-        with self.settings(LOCALE_PATHS=extended_locale_paths):\n-            from django.utils.translation import trans_real\n-            trans_real._active = local()\n-            trans_real._translations = {}\n-            with translation.override('de'):\n-                self.assertEqual(pgettext(\"unexisting\", \"May\"), \"May\")\n-                self.assertEqual(pgettext(\"month name\", \"May\"), \"Mai\")\n-                self.assertEqual(pgettext(\"verb\", \"May\"), \"Kann\")\n-                self.assertEqual(npgettext(\"search\", \"%d result\", \"%d results\", 4) % 4, \"4 Resultate\")\n+        trans_real._active = local()\n+        trans_real._translations = {}\n+        with translation.override('de'):\n+            self.assertEqual(pgettext(\"unexisting\", \"May\"), \"May\")\n+            self.assertEqual(pgettext(\"month name\", \"May\"), \"Mai\")\n+            self.assertEqual(pgettext(\"verb\", \"May\"), \"Kann\")\n+            self.assertEqual(npgettext(\"search\", \"%d result\", \"%d results\", 4) % 4, \"4 Resultate\")\n \n+    @override_settings(LOCALE_PATHS=extended_locale_paths)\n     def test_template_tags_pgettext(self):\n         \"\"\"\n         Ensure that message contexts are taken into account the {% trans %} and\n         {% blocktrans %} template tags.\n         Refs #14806.\n         \"\"\"\n-        # Reset translation catalog to include other/locale/de\n-        extended_locale_paths = settings.LOCALE_PATHS + (\n-            os.path.join(here, 'other', 'locale'),\n-        )\n-        with self.settings(LOCALE_PATHS=extended_locale_paths):\n-            from django.utils.translation import trans_real\n-            trans_real._active = local()\n-            trans_real._translations = {}\n-            with translation.override('de'):\n-\n-                # {% trans %} -----------------------------------\n-\n-                # Inexisting context...\n-                t = Template('{% load i18n %}{% trans \"May\" context \"unexisting\" %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'May')\n-\n-                # Existing context...\n-                # Using a literal\n-                t = Template('{% load i18n %}{% trans \"May\" context \"month name\" %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Mai')\n-                t = Template('{% load i18n %}{% trans \"May\" context \"verb\" %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Kann')\n-\n-                # Using a variable\n-                t = Template('{% load i18n %}{% trans \"May\" context message_context %}')\n-                rendered = t.render(Context({'message_context': 'month name'}))\n-                self.assertEqual(rendered, 'Mai')\n-                t = Template('{% load i18n %}{% trans \"May\" context message_context %}')\n-                rendered = t.render(Context({'message_context': 'verb'}))\n-                self.assertEqual(rendered, 'Kann')\n-\n-                # Using a filter\n-                t = Template('{% load i18n %}{% trans \"May\" context message_context|lower %}')\n-                rendered = t.render(Context({'message_context': 'MONTH NAME'}))\n-                self.assertEqual(rendered, 'Mai')\n-                t = Template('{% load i18n %}{% trans \"May\" context message_context|lower %}')\n-                rendered = t.render(Context({'message_context': 'VERB'}))\n-                self.assertEqual(rendered, 'Kann')\n-\n-                # Using 'as'\n-                t = Template('{% load i18n %}{% trans \"May\" context \"month name\" as var %}Value: {{ var }}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Value: Mai')\n-                t = Template('{% load i18n %}{% trans \"May\" as var context \"verb\" %}Value: {{ var }}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Value: Kann')\n-\n-                # Mis-uses\n-                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% trans \"May\" context as var %}{{ var }}')\n-                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% trans \"May\" as var context %}{{ var }}')\n-\n-                # {% blocktrans %} ------------------------------\n-\n-                # Inexisting context...\n-                t = Template('{% load i18n %}{% blocktrans context \"unexisting\" %}May{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'May')\n-\n-                # Existing context...\n-                # Using a literal\n-                t = Template('{% load i18n %}{% blocktrans context \"month name\" %}May{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Mai')\n-                t = Template('{% load i18n %}{% blocktrans context \"verb\" %}May{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Kann')\n-\n-                # Using a variable\n-                t = Template('{% load i18n %}{% blocktrans context message_context %}May{% endblocktrans %}')\n-                rendered = t.render(Context({'message_context': 'month name'}))\n-                self.assertEqual(rendered, 'Mai')\n-                t = Template('{% load i18n %}{% blocktrans context message_context %}May{% endblocktrans %}')\n-                rendered = t.render(Context({'message_context': 'verb'}))\n-                self.assertEqual(rendered, 'Kann')\n-\n-                # Using a filter\n-                t = Template('{% load i18n %}{% blocktrans context message_context|lower %}May{% endblocktrans %}')\n-                rendered = t.render(Context({'message_context': 'MONTH NAME'}))\n-                self.assertEqual(rendered, 'Mai')\n-                t = Template('{% load i18n %}{% blocktrans context message_context|lower %}May{% endblocktrans %}')\n-                rendered = t.render(Context({'message_context': 'VERB'}))\n-                self.assertEqual(rendered, 'Kann')\n-\n-                # Using 'count'\n-                t = Template('{% load i18n %}{% blocktrans count number=1 context \"super search\" %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, '1 Super-Ergebnis')\n-                t = Template('{% load i18n %}{% blocktrans count number=2 context \"super search\" %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, '2 Super-Ergebnisse')\n-                t = Template('{% load i18n %}{% blocktrans context \"other super search\" count number=1 %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, '1 anderen Super-Ergebnis')\n-                t = Template('{% load i18n %}{% blocktrans context \"other super search\" count number=2 %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, '2 andere Super-Ergebnisse')\n-\n-                # Using 'with'\n-                t = Template('{% load i18n %}{% blocktrans with num_comments=5 context \"comment count\" %}There are {{ num_comments }} comments{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Es gibt 5 Kommentare')\n-                t = Template('{% load i18n %}{% blocktrans with num_comments=5 context \"other comment count\" %}There are {{ num_comments }} comments{% endblocktrans %}')\n-                rendered = t.render(Context())\n-                self.assertEqual(rendered, 'Andere: Es gibt 5 Kommentare')\n-\n-                # Mis-uses\n-                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans context with month=\"May\" %}{{ month }}{% endblocktrans %}')\n-                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans context %}{% endblocktrans %}')\n-                self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans count number=2 context %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+        trans_real._active = local()\n+        trans_real._translations = {}\n+        with translation.override('de'):\n+\n+            # {% trans %} -----------------------------------\n+\n+            # Inexisting context...\n+            t = Template('{% load i18n %}{% trans \"May\" context \"unexisting\" %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'May')\n+\n+            # Existing context...\n+            # Using a literal\n+            t = Template('{% load i18n %}{% trans \"May\" context \"month name\" %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Mai')\n+            t = Template('{% load i18n %}{% trans \"May\" context \"verb\" %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Kann')\n+\n+            # Using a variable\n+            t = Template('{% load i18n %}{% trans \"May\" context message_context %}')\n+            rendered = t.render(Context({'message_context': 'month name'}))\n+            self.assertEqual(rendered, 'Mai')\n+            t = Template('{% load i18n %}{% trans \"May\" context message_context %}')\n+            rendered = t.render(Context({'message_context': 'verb'}))\n+            self.assertEqual(rendered, 'Kann')\n+\n+            # Using a filter\n+            t = Template('{% load i18n %}{% trans \"May\" context message_context|lower %}')\n+            rendered = t.render(Context({'message_context': 'MONTH NAME'}))\n+            self.assertEqual(rendered, 'Mai')\n+            t = Template('{% load i18n %}{% trans \"May\" context message_context|lower %}')\n+            rendered = t.render(Context({'message_context': 'VERB'}))\n+            self.assertEqual(rendered, 'Kann')\n+\n+            # Using 'as'\n+            t = Template('{% load i18n %}{% trans \"May\" context \"month name\" as var %}Value: {{ var }}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Value: Mai')\n+            t = Template('{% load i18n %}{% trans \"May\" as var context \"verb\" %}Value: {{ var }}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Value: Kann')\n+\n+            # Mis-uses\n+            self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% trans \"May\" context as var %}{{ var }}')\n+            self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% trans \"May\" as var context %}{{ var }}')\n+\n+            # {% blocktrans %} ------------------------------\n+\n+            # Inexisting context...\n+            t = Template('{% load i18n %}{% blocktrans context \"unexisting\" %}May{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'May')\n+\n+            # Existing context...\n+            # Using a literal\n+            t = Template('{% load i18n %}{% blocktrans context \"month name\" %}May{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Mai')\n+            t = Template('{% load i18n %}{% blocktrans context \"verb\" %}May{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Kann')\n+\n+            # Using a variable\n+            t = Template('{% load i18n %}{% blocktrans context message_context %}May{% endblocktrans %}')\n+            rendered = t.render(Context({'message_context': 'month name'}))\n+            self.assertEqual(rendered, 'Mai')\n+            t = Template('{% load i18n %}{% blocktrans context message_context %}May{% endblocktrans %}')\n+            rendered = t.render(Context({'message_context': 'verb'}))\n+            self.assertEqual(rendered, 'Kann')\n+\n+            # Using a filter\n+            t = Template('{% load i18n %}{% blocktrans context message_context|lower %}May{% endblocktrans %}')\n+            rendered = t.render(Context({'message_context': 'MONTH NAME'}))\n+            self.assertEqual(rendered, 'Mai')\n+            t = Template('{% load i18n %}{% blocktrans context message_context|lower %}May{% endblocktrans %}')\n+            rendered = t.render(Context({'message_context': 'VERB'}))\n+            self.assertEqual(rendered, 'Kann')\n+\n+            # Using 'count'\n+            t = Template('{% load i18n %}{% blocktrans count number=1 context \"super search\" %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, '1 Super-Ergebnis')\n+            t = Template('{% load i18n %}{% blocktrans count number=2 context \"super search\" %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, '2 Super-Ergebnisse')\n+            t = Template('{% load i18n %}{% blocktrans context \"other super search\" count number=1 %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, '1 anderen Super-Ergebnis')\n+            t = Template('{% load i18n %}{% blocktrans context \"other super search\" count number=2 %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, '2 andere Super-Ergebnisse')\n+\n+            # Using 'with'\n+            t = Template('{% load i18n %}{% blocktrans with num_comments=5 context \"comment count\" %}There are {{ num_comments }} comments{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Es gibt 5 Kommentare')\n+            t = Template('{% load i18n %}{% blocktrans with num_comments=5 context \"other comment count\" %}There are {{ num_comments }} comments{% endblocktrans %}')\n+            rendered = t.render(Context())\n+            self.assertEqual(rendered, 'Andere: Es gibt 5 Kommentare')\n+\n+            # Mis-uses\n+            self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans context with month=\"May\" %}{{ month }}{% endblocktrans %}')\n+            self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans context %}{% endblocktrans %}')\n+            self.assertRaises(TemplateSyntaxError, Template, '{% load i18n %}{% blocktrans count number=2 context %}{{ number }} super result{% plural %}{{ number }} super results{% endblocktrans %}')\n \n \n     def test_string_concat(self):\n@@ -247,8 +240,7 @@ def test_maclines(self):\n         Translations on files with mac or dos end of lines will be converted\n         to unix eof in .po catalogs, and they have to match when retrieved\n         \"\"\"\n-        from django.utils.translation.trans_real import translation as Trans\n-        ca_translation = Trans('ca')\n+        ca_translation = trans_real.translation('ca')\n         ca_translation._catalog['Mac\\nEOF\\n'] = 'Catalan Mac\\nEOF\\n'\n         ca_translation._catalog['Win\\nEOF\\n'] = 'Catalan Win\\nEOF\\n'\n         with translation.override('ca', deactivate=True):\n@@ -267,9 +259,8 @@ def test_to_language(self):\n         \"\"\"\n         Test the to_language function\n         \"\"\"\n-        from django.utils.translation.trans_real import to_language\n-        self.assertEqual(to_language('en_US'), 'en-us')\n-        self.assertEqual(to_language('sr_Lat'), 'sr-lat')\n+        self.assertEqual(trans_real.to_language('en_US'), 'en-us')\n+        self.assertEqual(trans_real.to_language('sr_Lat'), 'sr-lat')\n \n     @override_settings(LOCALE_PATHS=(os.path.join(here, 'other', 'locale'),))\n     def test_bad_placeholder_1(self):\n@@ -710,8 +701,7 @@ def test_parse_spec_http_header(self):\n         values according to the spec (and that we extract all the pieces in\n         the right order).\n         \"\"\"\n-        from django.utils.translation.trans_real import parse_accept_lang_header\n-        p = parse_accept_lang_header\n+        p = trans_real.parse_accept_lang_header\n         # Good headers.\n         self.assertEqual([('de', 1.0)], p('de'))\n         self.assertEqual([('en-AU', 1.0)], p('en-AU'))\n@@ -811,7 +801,7 @@ def test_parse_language_cookie(self):\n         self.assertEqual(g(r), 'zh-cn')\n \n     def test_get_language_from_path_real(self):\n-        from django.utils.translation.trans_real import get_language_from_path as g\n+        g = trans_real.get_language_from_path\n         self.assertEqual(g('/pl/'), 'pl')\n         self.assertEqual(g('/pl'), 'pl')\n         self.assertEqual(g('/xyz/'), None)\n@@ -822,23 +812,19 @@ def test_get_language_from_path_null(self):\n         self.assertEqual(g('/pl'), None)\n         self.assertEqual(g('/xyz/'), None)\n \n+    @override_settings(LOCALE_PATHS=extended_locale_paths)\n     def test_percent_in_translatable_block(self):\n-        extended_locale_paths = settings.LOCALE_PATHS + (\n-            os.path.join(here, 'other', 'locale'),\n-        )\n-        with self.settings(LOCALE_PATHS=extended_locale_paths):\n-            t_sing = Template(\"{% load i18n %}{% blocktrans %}The result was {{ percent }}%{% endblocktrans %}\")\n-            t_plur = Template(\"{% load i18n %}{% blocktrans count num as number %}{{ percent }}% represents {{ num }} object{% plural %}{{ percent }}% represents {{ num }} objects{% endblocktrans %}\")\n-            with translation.override('de'):\n-                self.assertEqual(t_sing.render(Context({'percent': 42})), 'Das Ergebnis war 42%')\n-                self.assertEqual(t_plur.render(Context({'percent': 42, 'num': 1})), '42% stellt 1 Objekt dar')\n-                self.assertEqual(t_plur.render(Context({'percent': 42, 'num': 4})), '42% stellt 4 Objekte dar')\n+        t_sing = Template(\"{% load i18n %}{% blocktrans %}The result was {{ percent }}%{% endblocktrans %}\")\n+        t_plur = Template(\"{% load i18n %}{% blocktrans count num as number %}{{ percent }}% represents {{ num }} object{% plural %}{{ percent }}% represents {{ num }} objects{% endblocktrans %}\")\n+        with translation.override('de'):\n+            self.assertEqual(t_sing.render(Context({'percent': 42})), 'Das Ergebnis war 42%')\n+            self.assertEqual(t_plur.render(Context({'percent': 42, 'num': 1})), '42% stellt 1 Objekt dar')\n+            self.assertEqual(t_plur.render(Context({'percent': 42, 'num': 4})), '42% stellt 4 Objekte dar')\n \n \n class ResolutionOrderI18NTests(TestCase):\n \n     def setUp(self):\n-        from django.utils.translation import trans_real\n         # Okay, this is brutal, but we have no other choice to fully reset\n         # the translation framework\n         trans_real._active = local()\n@@ -867,17 +853,9 @@ def tearDown(self):\n     def test_app_translation(self):\n         self.assertUgettext('Date/time', 'APP')\n \n+@override_settings(LOCALE_PATHS=extended_locale_paths)\n class LocalePathsResolutionOrderI18NTests(ResolutionOrderI18NTests):\n \n-    def setUp(self):\n-        self.old_locale_paths = settings.LOCALE_PATHS\n-        settings.LOCALE_PATHS += (os.path.join(here, 'other', 'locale'),)\n-        super(LocalePathsResolutionOrderI18NTests, self).setUp()\n-\n-    def tearDown(self):\n-        settings.LOCALE_PATHS = self.old_locale_paths\n-        super(LocalePathsResolutionOrderI18NTests, self).tearDown()\n-\n     def test_locale_paths_translation(self):\n         self.assertUgettext('Time', 'LOCALE_PATHS')\n "
        }
    ],
    "stats": {
        "total": 286,
        "additions": 132,
        "deletions": 154
    }
}