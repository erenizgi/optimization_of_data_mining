{
    "author": "jezdez",
    "message": "Fixed #14731 -- Respect ordering when creating the default permissions. Thanks, chipx86.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14891 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "674c671cae5119146a302411b3f13e706577f47f",
    "files": [
        {
            "sha": "3e2e290b654994d7e3282cc59c9fdcf65120ea07",
            "filename": "django/contrib/auth/fixtures/permissionstestdata.json",
            "status": "added",
            "additions": 316,
            "deletions": 0,
            "changes": 316,
            "blob_url": "https://github.com/django/django/blob/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Ffixtures%2Fpermissionstestdata.json",
            "raw_url": "https://github.com/django/django/raw/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Ffixtures%2Fpermissionstestdata.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ffixtures%2Fpermissionstestdata.json?ref=674c671cae5119146a302411b3f13e706577f47f",
            "patch": "@@ -0,0 +1,316 @@\n+[\n+    {\n+        \"pk\": 5, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"contenttype\", \n+            \"name\": \"content type\", \n+            \"app_label\": \"contenttypes\"\n+        }\n+    }, \n+    {\n+        \"pk\": 2, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"group\", \n+            \"name\": \"group\", \n+            \"app_label\": \"auth\"\n+        }\n+    }, \n+    {\n+        \"pk\": 8, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"logentry\", \n+            \"name\": \"log entry\", \n+            \"app_label\": \"admin\"\n+        }\n+    }, \n+    {\n+        \"pk\": 4, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"message\", \n+            \"name\": \"message\", \n+            \"app_label\": \"auth\"\n+        }\n+    }, \n+    {\n+        \"pk\": 1, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"permission\", \n+            \"name\": \"permission\", \n+            \"app_label\": \"auth\"\n+        }\n+    }, \n+    {\n+        \"pk\": 6, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"session\", \n+            \"name\": \"session\", \n+            \"app_label\": \"sessions\"\n+        }\n+    }, \n+    {\n+        \"pk\": 7, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"site\", \n+            \"name\": \"site\", \n+            \"app_label\": \"sites\"\n+        }\n+    }, \n+    {\n+        \"pk\": 3, \n+        \"model\": \"contenttypes.contenttype\", \n+        \"fields\": {\n+            \"model\": \"user\", \n+            \"name\": \"user\", \n+            \"app_label\": \"auth\"\n+        }\n+    }, \n+    {\n+        \"pk\": 1, \n+        \"model\": \"sites.site\", \n+        \"fields\": {\n+            \"domain\": \"example.com\", \n+            \"name\": \"example.com\"\n+        }\n+    }, \n+    {\n+        \"pk\": 22, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_logentry\", \n+            \"name\": \"Can add log entry\", \n+            \"content_type\": 8\n+        }\n+    }, \n+    {\n+        \"pk\": 23, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_logentry\", \n+            \"name\": \"Can change log entry\", \n+            \"content_type\": 8\n+        }\n+    }, \n+    {\n+        \"pk\": 24, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_logentry\", \n+            \"name\": \"Can delete log entry\", \n+            \"content_type\": 8\n+        }\n+    }, \n+    {\n+        \"pk\": 4, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_group\", \n+            \"name\": \"Can add group\", \n+            \"content_type\": 2\n+        }\n+    }, \n+    {\n+        \"pk\": 5, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_group\", \n+            \"name\": \"Can change group\", \n+            \"content_type\": 2\n+        }\n+    }, \n+    {\n+        \"pk\": 6, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_group\", \n+            \"name\": \"Can delete group\", \n+            \"content_type\": 2\n+        }\n+    }, \n+    {\n+        \"pk\": 10, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_message\", \n+            \"name\": \"Can add message\", \n+            \"content_type\": 4\n+        }\n+    }, \n+    {\n+        \"pk\": 11, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_message\", \n+            \"name\": \"Can change message\", \n+            \"content_type\": 4\n+        }\n+    }, \n+    {\n+        \"pk\": 12, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_message\", \n+            \"name\": \"Can delete message\", \n+            \"content_type\": 4\n+        }\n+    }, \n+    {\n+        \"pk\": 1, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_permission\", \n+            \"name\": \"Can add permission\", \n+            \"content_type\": 1\n+        }\n+    }, \n+    {\n+        \"pk\": 2, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_permission\", \n+            \"name\": \"Can change permission\", \n+            \"content_type\": 1\n+        }\n+    }, \n+    {\n+        \"pk\": 3, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_permission\", \n+            \"name\": \"Can delete permission\", \n+            \"content_type\": 1\n+        }\n+    }, \n+    {\n+        \"pk\": 7, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_user\", \n+            \"name\": \"Can add user\", \n+            \"content_type\": 3\n+        }\n+    }, \n+    {\n+        \"pk\": 8, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_user\", \n+            \"name\": \"Can change user\", \n+            \"content_type\": 3\n+        }\n+    }, \n+    {\n+        \"pk\": 9, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_user\", \n+            \"name\": \"Can delete user\", \n+            \"content_type\": 3\n+        }\n+    }, \n+    {\n+        \"pk\": 13, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_contenttype\", \n+            \"name\": \"Can add content type\", \n+            \"content_type\": 5\n+        }\n+    }, \n+    {\n+        \"pk\": 14, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_contenttype\", \n+            \"name\": \"Can change content type\", \n+            \"content_type\": 5\n+        }\n+    }, \n+    {\n+        \"pk\": 15, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_contenttype\", \n+            \"name\": \"Can delete content type\", \n+            \"content_type\": 5\n+        }\n+    }, \n+    {\n+        \"pk\": 16, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_session\", \n+            \"name\": \"Can add session\", \n+            \"content_type\": 6\n+        }\n+    }, \n+    {\n+        \"pk\": 17, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_session\", \n+            \"name\": \"Can change session\", \n+            \"content_type\": 6\n+        }\n+    }, \n+    {\n+        \"pk\": 18, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_session\", \n+            \"name\": \"Can delete session\", \n+            \"content_type\": 6\n+        }\n+    }, \n+    {\n+        \"pk\": 19, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"add_site\", \n+            \"name\": \"Can add site\", \n+            \"content_type\": 7\n+        }\n+    }, \n+    {\n+        \"pk\": 20, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"change_site\", \n+            \"name\": \"Can change site\", \n+            \"content_type\": 7\n+        }\n+    }, \n+    {\n+        \"pk\": 21, \n+        \"model\": \"auth.permission\", \n+        \"fields\": {\n+            \"codename\": \"delete_site\", \n+            \"name\": \"Can delete site\", \n+            \"content_type\": 7\n+        }\n+    }, \n+    {\n+        \"pk\": 1, \n+        \"model\": \"auth.user\", \n+        \"fields\": {\n+            \"username\": \"admin\", \n+            \"first_name\": \"\", \n+            \"last_name\": \"\", \n+            \"is_active\": true, \n+            \"is_superuser\": true, \n+            \"is_staff\": true, \n+            \"last_login\": \"2010-11-19 06:26:59\", \n+            \"groups\": [], \n+            \"user_permissions\": [], \n+            \"password\": \"sha1$e72a2$950781326ec9546d172a20681ba3c762f23104b0\", \n+            \"email\": \"admin@example.com\", \n+            \"date_joined\": \"2010-11-19 06:26:59\"\n+        }\n+    }\n+]\n\\ No newline at end of file"
        },
        {
            "sha": "46dbea83f3d897fd204c37fb7fbc0927d33d94d2",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=674c671cae5119146a302411b3f13e706577f47f",
            "patch": "@@ -23,14 +23,14 @@ def create_permissions(app, created_models, verbosity, **kwargs):\n \n     # This will hold the permissions we're looking for as\n     # (content_type, (codename, name))\n-    searched_perms = set()\n+    searched_perms = list()\n     # The codenames and ctypes that should exist.\n     ctypes = set()\n     for klass in app_models:\n         ctype = ContentType.objects.get_for_model(klass)\n         ctypes.add(ctype)\n         for perm in _get_all_permissions(klass._meta):\n-            searched_perms.add((ctype, perm))\n+            searched_perms.append((ctype, perm))\n \n     # Find all the Permissions that have a context_type for a model we're\n     # looking for.  We don't need to check for codenames since we already have"
        },
        {
            "sha": "64d30372b1c703a2b170135a89181aa47cb90fdd",
            "filename": "django/contrib/auth/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py?ref=674c671cae5119146a302411b3f13e706577f47f",
            "patch": "@@ -9,5 +9,6 @@\n from django.contrib.auth.tests.tokens import TokenGeneratorTest\n from django.contrib.auth.tests.views import PasswordResetTest, \\\n     ChangePasswordTest, LoginTest, LogoutTest, LoginURLSettings\n+from django.contrib.auth.tests.permissions import TestAuthPermissions\n \n # The password for the fixture data users is 'password'"
        },
        {
            "sha": "1f84231c62f64b2ad2823c69b6d5f84972bac8ea",
            "filename": "django/contrib/auth/tests/permissions.py",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Ftests%2Fpermissions.py",
            "raw_url": "https://github.com/django/django/raw/674c671cae5119146a302411b3f13e706577f47f/django%2Fcontrib%2Fauth%2Ftests%2Fpermissions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fpermissions.py?ref=674c671cae5119146a302411b3f13e706577f47f",
            "patch": "@@ -0,0 +1,32 @@\n+try:\n+    from cStringIO import StringIO\n+except ImportError:\n+    from StringIO import StringIO\n+\n+from django.contrib.auth.management import create_permissions\n+from django.contrib.auth import models as auth_models\n+from django.contrib.contenttypes import models as contenttypes_models\n+from django.core.management import call_command\n+from django.test import TestCase\n+\n+\n+class TestAuthPermissions(TestCase):\n+    def test_permission_register_order(self):\n+        \"\"\"Test that the order of registered permissions doesn't break\"\"\"\n+        # Changeset 14413 introduced a regression in the ordering of\n+        # newly created permissions for objects. When loading a fixture\n+        # after the initial creation (such as during unit tests), the\n+        # expected IDs for the permissions may not match up, leading to\n+        # SQL errors. This is ticket 14731\n+\n+        # Start with a clean slate and build the permissions as we\n+        # expect to see them in the fixtures.\n+        auth_models.Permission.objects.all().delete()\n+        contenttypes_models.ContentType.objects.all().delete()\n+        create_permissions(auth_models, [], verbosity=0)\n+        create_permissions(contenttypes_models, [], verbosity=0)\n+\n+        stderr = StringIO()\n+        call_command('loaddata', 'test_permissions.json',\n+                     verbosity=0, commit=False, stderr=stderr)\n+        self.assertEqual(stderr.getvalue(), '')"
        }
    ],
    "stats": {
        "total": 353,
        "additions": 351,
        "deletions": 2
    }
}