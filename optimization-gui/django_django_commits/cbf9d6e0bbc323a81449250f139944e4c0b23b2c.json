{
    "author": "unknown",
    "message": "Fixed the Oracle environment variables not getting set correctly under Cygwin.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14781 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "cbf9d6e0bbc323a81449250f139944e4c0b23b2c",
    "files": [
        {
            "sha": "cf8d920989d8618c99e27ae70b1e21281a1c6dd4",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 25,
            "deletions": 6,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/cbf9d6e0bbc323a81449250f139944e4c0b23b2c/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/cbf9d6e0bbc323a81449250f139944e4c0b23b2c/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=cbf9d6e0bbc323a81449250f139944e4c0b23b2c",
            "patch": "@@ -6,16 +6,35 @@\n \n \n import datetime\n-import os\n import sys\n import time\n from decimal import Decimal\n \n-# Oracle takes client-side character set encoding from the environment.\n-os.environ['NLS_LANG'] = '.UTF8'\n-# This prevents unicode from getting mangled by getting encoded into the\n-# potentially non-unicode database character set.\n-os.environ['ORA_NCHAR_LITERAL_REPLACE'] = 'TRUE'\n+\n+def _setup_environment(environ):\n+    import platform\n+    # Cygwin requires some special voodoo to set the environment variables\n+    # properly so that Oracle will see them.\n+    if platform.system().upper().startswith('CYGWIN'):\n+        try:\n+            import ctypes\n+        except ImportError:\n+            raise ImportError(\"ctypes not found. The Oracle backend requires ctypes to operate correctly under Cygwin.\")\n+        kernel32 = ctypes.CDLL('kernel32')\n+        for name, value in environ:\n+            kernel32.SetEnvironmentVariableA(name, value)\n+    else:\n+        import os\n+        os.environ.update(environ)\n+\n+_setup_environment([\n+    # Oracle takes client-side character set encoding from the environment.\n+    ('NLS_LANG', '.UTF8'),\n+    # This prevents unicode from getting mangled by getting encoded into the\n+    # potentially non-unicode database character set.\n+    ('ORA_NCHAR_LITERAL_REPLACE', 'TRUE'),\n+])\n+\n \n try:\n     import cx_Oracle as Database"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 25,
        "deletions": 6
    }
}