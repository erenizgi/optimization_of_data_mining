{
    "author": "aaugustin",
    "message": "Removed backwards-compatibility shim for #16288.\n\nAlso unit-tested django.utils.log.RequireDebugTrue for consistency.",
    "sha": "fb9f1b9bfb7378027adfe916733c701a89f8bb24",
    "files": [
        {
            "sha": "ccf7a94af6a7ca8ae48420b1491498b0a4c0b8ca",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 38,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/fb9f1b9bfb7378027adfe916733c701a89f8bb24/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/fb9f1b9bfb7378027adfe916733c701a89f8bb24/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=fb9f1b9bfb7378027adfe916733c701a89f8bb24",
            "patch": "@@ -74,11 +74,8 @@ def _configure_logging(self):\n \n             logging_config_func(DEFAULT_LOGGING)\n \n+            # ... then invoke it with the logging settings\n             if self.LOGGING:\n-                # Backwards-compatibility shim for #16288 fix\n-                compat_patch_logging_config(self.LOGGING)\n-\n-                # ... then invoke it with the logging settings\n                 logging_config_func(self.LOGGING)\n \n     def configure(self, default_settings=global_settings, **options):\n@@ -195,37 +192,3 @@ def __dir__(self):\n         return list(self.__dict__) + dir(self.default_settings)\n \n settings = LazySettings()\n-\n-\n-\n-def compat_patch_logging_config(logging_config):\n-    \"\"\"\n-    Backwards-compatibility shim for #16288 fix. Takes initial value of\n-    ``LOGGING`` setting and patches it in-place (issuing deprecation warning)\n-    if \"mail_admins\" logging handler is configured but has no filters.\n-\n-    \"\"\"\n-    #  Shim only if LOGGING[\"handlers\"][\"mail_admins\"] exists,\n-    #  but has no \"filters\" key\n-    if \"filters\" not in logging_config.get(\n-        \"handlers\", {}).get(\n-        \"mail_admins\", {\"filters\": []}):\n-\n-        warnings.warn(\n-            \"You have no filters defined on the 'mail_admins' logging \"\n-            \"handler: adding implicit debug-false-only filter. \"\n-            \"See http://docs.djangoproject.com/en/dev/releases/1.4/\"\n-            \"#request-exceptions-are-now-always-logged\",\n-            DeprecationWarning)\n-\n-        filter_name = \"require_debug_false\"\n-\n-        filters = logging_config.setdefault(\"filters\", {})\n-        while filter_name in filters:\n-            filter_name = filter_name + \"_\"\n-\n-        filters[filter_name] = {\n-            \"()\": \"django.utils.log.RequireDebugFalse\",\n-        }\n-\n-        logging_config[\"handlers\"][\"mail_admins\"][\"filters\"] = [filter_name]"
        },
        {
            "sha": "292bd0794cfac3900b609c1e319c5691473e0073",
            "filename": "django/utils/log.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/fb9f1b9bfb7378027adfe916733c701a89f8bb24/django%2Futils%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/fb9f1b9bfb7378027adfe916733c701a89f8bb24/django%2Futils%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Flog.py?ref=fb9f1b9bfb7378027adfe916733c701a89f8bb24",
            "patch": "@@ -152,4 +152,4 @@ def filter(self, record):\n \n class RequireDebugTrue(logging.Filter):\n     def filter(self, record):\n-       return settings.DEBUG\n+        return settings.DEBUG"
        },
        {
            "sha": "f9838949ab5d545a375263497dcc828dec82ea9c",
            "filename": "tests/regressiontests/logging_tests/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 61,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/fb9f1b9bfb7378027adfe916733c701a89f8bb24/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fb9f1b9bfb7378027adfe916733c701a89f8bb24/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flogging_tests%2Ftests.py?ref=fb9f1b9bfb7378027adfe916733c701a89f8bb24",
            "patch": "@@ -5,12 +5,12 @@\n import sys\n import warnings\n \n-from django.conf import compat_patch_logging_config, LazySettings\n+from django.conf import LazySettings\n from django.core import mail\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n from django.utils.encoding import force_text\n-from django.utils.log import CallbackFilter, RequireDebugFalse\n+from django.utils.log import CallbackFilter, RequireDebugFalse, RequireDebugTrue\n from django.utils.six import StringIO\n from django.utils.unittest import skipUnless\n \n@@ -40,46 +40,10 @@\n }\n \n \n-class PatchLoggingConfigTest(TestCase):\n-    \"\"\"\n-    Tests for backward-compat shim for #16288. These tests should be removed in\n-    Django 1.6 when that shim and DeprecationWarning are removed.\n-\n-    \"\"\"\n-    def test_filter_added(self):\n-        \"\"\"\n-        Test that debug-false filter is added to mail_admins handler if it has\n-        no filters.\n-\n-        \"\"\"\n-        config = copy.deepcopy(OLD_LOGGING)\n-\n-        with warnings.catch_warnings(record=True) as w:\n-            warnings.simplefilter(\"always\")\n-            compat_patch_logging_config(config)\n-            self.assertEqual(len(w), 1)\n-\n-        self.assertEqual(\n-            config[\"handlers\"][\"mail_admins\"][\"filters\"],\n-            ['require_debug_false'])\n-\n-    def test_filter_configuration(self):\n-        \"\"\"\n-        Test that the auto-added require_debug_false filter is an instance of\n-        `RequireDebugFalse` filter class.\n-\n-        \"\"\"\n-        config = copy.deepcopy(OLD_LOGGING)\n-        with warnings.catch_warnings(record=True):\n-            compat_patch_logging_config(config)\n-\n-        flt = config[\"filters\"][\"require_debug_false\"]\n-        self.assertEqual(flt[\"()\"], \"django.utils.log.RequireDebugFalse\")\n-\n+class LoggingFiltersTest(TestCase):\n     def test_require_debug_false_filter(self):\n         \"\"\"\n         Test the RequireDebugFalse filter class.\n-\n         \"\"\"\n         filter_ = RequireDebugFalse()\n \n@@ -89,32 +53,17 @@ def test_require_debug_false_filter(self):\n         with self.settings(DEBUG=False):\n             self.assertEqual(filter_.filter(\"record is not used\"), True)\n \n-    def test_no_patch_if_filters_key_exists(self):\n-        \"\"\"\n-        Test that the logging configuration is not modified if the mail_admins\n-        handler already has a \"filters\" key.\n-\n-        \"\"\"\n-        config = copy.deepcopy(OLD_LOGGING)\n-        config[\"handlers\"][\"mail_admins\"][\"filters\"] = []\n-        new_config = copy.deepcopy(config)\n-        compat_patch_logging_config(new_config)\n-\n-        self.assertEqual(config, new_config)\n-\n-    def test_no_patch_if_no_mail_admins_handler(self):\n+    def test_require_debug_true_filter(self):\n         \"\"\"\n-        Test that the logging configuration is not modified if the mail_admins\n-        handler is not present.\n-\n+        Test the RequireDebugTrue filter class.\n         \"\"\"\n-        config = copy.deepcopy(OLD_LOGGING)\n-        config[\"handlers\"].pop(\"mail_admins\")\n-        new_config = copy.deepcopy(config)\n-        compat_patch_logging_config(new_config)\n+        filter_ = RequireDebugTrue()\n \n-        self.assertEqual(config, new_config)\n+        with self.settings(DEBUG=True):\n+            self.assertEqual(filter_.filter(\"record is not used\"), True)\n \n+        with self.settings(DEBUG=False):\n+            self.assertEqual(filter_.filter(\"record is not used\"), False)\n \n class DefaultLoggingTest(TestCase):\n     def setUp(self):"
        }
    ],
    "stats": {
        "total": 112,
        "additions": 12,
        "deletions": 100
    }
}