{
    "author": "jezdez",
    "message": "Fixed #14608 -- Added phone number field to Indian local flavor. Thanks, lawgon and Julien Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16495 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c29e45491ea2e2a689299abda1b722ff814efd80",
    "files": [
        {
            "sha": "50db790143af697b2c828f081f67832b36a4de2f",
            "filename": "django/contrib/localflavor/in_/forms.py",
            "status": "modified",
            "additions": 49,
            "deletions": 1,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/c29e45491ea2e2a689299abda1b722ff814efd80/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/c29e45491ea2e2a689299abda1b722ff814efd80/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py?ref=c29e45491ea2e2a689299abda1b722ff814efd80",
            "patch": "@@ -5,10 +5,31 @@\n \n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n-from django.forms.fields import Field, RegexField, Select\n+from django.forms.fields import Field, RegexField, CharField, Select\n from django.utils.encoding import smart_unicode\n from django.utils.translation import ugettext_lazy as _\n \n+phone_digits_re = re.compile(r\"\"\"\n+(\n+    (?P<std_code>                   # the std-code group\n+        ^0                          # all std-codes start with 0\n+        (\n+            (?P<twodigit>\\d{2})   | # either two, three or four digits\n+            (?P<threedigit>\\d{3}) | # following the 0\n+            (?P<fourdigit>\\d{4})\n+        )\n+    )\n+    [-\\s]                           # space or -\n+    (?P<phone_no>                   # the phone number group\n+        [1-6]                       # first digit of phone number\n+        (\n+            (?(twodigit)\\d{7})   |  # 7 more phone digits for 3 digit stdcode\n+            (?(threedigit)\\d{6}) |  # 6 more phone digits for 4 digit stdcode\n+            (?(fourdigit)\\d{5})     # 5 more phone digits for 5 digit stdcode\n+        )\n+    )\n+)$\"\"\", re.VERBOSE)\n+\n \n class INZipCodeField(RegexField):\n     default_error_messages = {\n@@ -27,6 +48,7 @@ def clean(self, value):\n         value = re.sub(r'^(\\d{3})\\s(\\d{3})$', r'\\1\\2', value)\n         return value\n \n+\n class INStateField(Field):\n     \"\"\"\n     A form field that validates its input is a Indian state name or\n@@ -53,6 +75,7 @@ def clean(self, value):\n                 pass\n         raise ValidationError(self.error_messages['invalid'])\n \n+\n class INStateSelect(Select):\n     \"\"\"\n     A Select widget that uses a list of Indian states/territories as its\n@@ -62,3 +85,28 @@ def __init__(self, attrs=None):\n         from in_states import STATE_CHOICES\n         super(INStateSelect, self).__init__(attrs, choices=STATE_CHOICES)\n \n+\n+class INPhoneNumberField(CharField):\n+    \"\"\"\n+    INPhoneNumberField validates that the data is a valid Indian phone number,\n+    including the STD code. It's normalised to 0XXX-XXXXXXX or 0XXX XXXXXXX\n+    format. The first string is the STD code which is a '0' followed by 2-4\n+    digits. The second string is 8 digits if the STD code is 3 digits, 7\n+    digits if the STD code is 4 digits and 6 digits if the STD code is 5\n+    digits. The second string will start with numbers between 1 and 6. The\n+    separator is either a space or a hyphen.\n+    \"\"\"\n+    default_error_messages = {\n+        'invalid': _('Phone numbers must be in 02X-8X or 03X-7X or 04X-6X format.'),\n+    }\n+\n+    def clean(self, value):\n+        super(INPhoneNumberField, self).clean(value)\n+        if value in EMPTY_VALUES:\n+            return u''\n+        value = smart_unicode(value)\n+        m = phone_digits_re.match(value)\n+        if m:\n+            return u'%s' % (value)\n+        raise ValidationError(self.error_messages['invalid'])\n+"
        },
        {
            "sha": "60539e966307abfca043c34cef2a2dbd2fa79fe4",
            "filename": "docs/ref/contrib/localflavor.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/c29e45491ea2e2a689299abda1b722ff814efd80/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "raw_url": "https://github.com/django/django/raw/c29e45491ea2e2a689299abda1b722ff814efd80/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Flocalflavor.txt?ref=c29e45491ea2e2a689299abda1b722ff814efd80",
            "patch": "@@ -576,22 +576,34 @@ Iceland (``is_``)\n India (``in_``)\n ===============\n \n-.. class:: in.forms.INStateField\n+.. class:: in_.forms.INStateField\n \n     A form field that validates input as an Indian state/territory name or\n     abbreviation. Input is normalized to the standard two-letter vehicle\n     registration abbreviation for the given state or territory.\n \n-.. class:: in.forms.INZipCodeField\n+.. class:: in_.forms.INZipCodeField\n \n     A form field that validates input as an Indian zip code, with the\n     format XXXXXXX.\n \n-.. class:: in.forms.INStateSelect\n+.. class:: in_.forms.INStateSelect\n \n     A ``Select`` widget that uses a list of Indian states/territories as its\n     choices.\n \n+.. versionadded:: 1.4\n+\n+.. class:: in_.forms.INPhoneNumberField\n+\n+    A form field that validates that the data is a valid Indian phone number,\n+    including the STD code. It's normalised to 0XXX-XXXXXXX or 0XXX XXXXXXX\n+    format. The first string is the STD code which is a '0' followed by 2-4\n+    digits. The second string is 8 digits if the STD code is 3 digits, 7\n+    digits if the STD code is 4 digits and 6 digits if the STD code is 5\n+    digits. The second string will start with numbers between 1 and 6. The\n+    separator is either a space or a hyphen.\n+\n Ireland (``ie``)\n ================\n "
        },
        {
            "sha": "5a04fd1cf4bc18228ba0d2480084c6fdf9645dd6",
            "filename": "tests/regressiontests/forms/localflavor/in_.py",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/c29e45491ea2e2a689299abda1b722ff814efd80/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fin_.py",
            "raw_url": "https://github.com/django/django/raw/c29e45491ea2e2a689299abda1b722ff814efd80/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fin_.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fin_.py?ref=c29e45491ea2e2a689299abda1b722ff814efd80",
            "patch": "@@ -1,12 +1,32 @@\n import warnings\n \n from django.contrib.localflavor.in_.forms import (INZipCodeField,\n-                                                  INStateField, INStateSelect)\n+    INStateField, INStateSelect, INPhoneNumberField)\n \n from utils import LocalFlavorTestCase\n \n \n+\n class INLocalFlavorTests(LocalFlavorTestCase):\n+    def test_INPhoneNumberField(self):\n+        error_format = [u'Phone numbers must be in 02X-8X or 03X-7X or 04X-6X format.']\n+        valid = {\n+            '0423-2443667': '0423-2443667',\n+            '0423 2443667': '0423 2443667',\n+            '04236-244366': '04236-244366',\n+            '040-24436678': '040-24436678',\n+        }\n+        invalid = {\n+            '04-2443667': error_format,\n+            '423-2443667': error_format,\n+            '0423-9442667': error_format,\n+            '0423-0443667': error_format,\n+            '0423-244366': error_format,\n+            '04232442667': error_format,\n+            '0423DJANGO': error_format,\n+        }\n+        self.assertFieldOutput(INPhoneNumberField, valid, invalid)\n+\n     def test_INPStateSelect(self):\n         f = INStateSelect()\n         out = u'''<select name=\"state\">"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 85,
        "deletions": 5
    }
}