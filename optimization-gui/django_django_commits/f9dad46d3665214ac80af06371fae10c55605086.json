{
    "author": "carljm",
    "message": "Fixed #16803 -- Use model verbose_name directly as ContentType unicode representation so it can be translated. Thanks to bronger for the report and Ivan Sagalaev for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16839 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f9dad46d3665214ac80af06371fae10c55605086",
    "files": [
        {
            "sha": "2f20797e95d83b1dd26bc7898e7aa10dc737b881",
            "filename": "django/contrib/contenttypes/models.py",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmodels.py?ref=f9dad46d3665214ac80af06371fae10c55605086",
            "patch": "@@ -1,6 +1,6 @@\n from django.db import models\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_unicode, force_unicode\n \n class ContentTypeManager(models.Manager):\n \n@@ -85,7 +85,18 @@ class Meta:\n         unique_together = (('app_label', 'model'),)\n \n     def __unicode__(self):\n-        return self.name\n+        # self.name is deprecated in favor of using model's verbose_name, which\n+        # can be translated. Formal deprecation is delayed until we have DB\n+        # migration to be able to remove the field from the database along with\n+        # the attribute.\n+        #\n+        # We return self.name only when users have changed its value from the\n+        # initial verbose_name_raw and might rely on it.\n+        meta = self.model_class()._meta\n+        if self.name != meta.verbose_name_raw:\n+            return self.name\n+        else:\n+            return force_unicode(meta.verbose_name)\n \n     def model_class(self):\n         \"Returns the Python model class for this type of content.\""
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/i18n/contenttypes/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2F__init__.py?ref=f9dad46d3665214ac80af06371fae10c55605086"
        },
        {
            "sha": "673033ab3055fa5ac0a9ee78359aacb416151ac3",
            "filename": "tests/regressiontests/i18n/contenttypes/locale/en/LC_MESSAGES/django.mo",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.mo?ref=f9dad46d3665214ac80af06371fae10c55605086"
        },
        {
            "sha": "2529ce6dfbcd74dd951611abc5dd289dfb54ffa2",
            "filename": "tests/regressiontests/i18n/contenttypes/locale/en/LC_MESSAGES/django.po",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=f9dad46d3665214ac80af06371fae10c55605086",
            "patch": "@@ -0,0 +1,26 @@\n+# SOME DESCRIPTIVE TITLE.\n+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER\n+# This file is distributed under the same license as the PACKAGE package.\n+# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.\n+#\n+#, fuzzy\n+msgid \"\"\n+msgstr \"\"\n+\"Project-Id-Version: PACKAGE VERSION\\n\"\n+\"Report-Msgid-Bugs-To: \\n\"\n+\"POT-Creation-Date: 2011-09-15 15:41-0700\\n\"\n+\"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\\n\"\n+\"Last-Translator: FULL NAME <EMAIL@ADDRESS>\\n\"\n+\"Language-Team: LANGUAGE <LL@li.org>\\n\"\n+\"Language: \\n\"\n+\"MIME-Version: 1.0\\n\"\n+\"Content-Type: text/plain; charset=UTF-8\\n\"\n+\"Content-Transfer-Encoding: 8bit\\n\"\n+\n+#: models.py:6\n+msgid \"Anything\"\n+msgstr \"\"\n+\n+#: models.py:15\n+msgid \"Company\"\n+msgstr \"Company\"\n\\ No newline at end of file"
        },
        {
            "sha": "c3083c90b5fc1ae2ed62ac6eb9c1e633c9d95bc0",
            "filename": "tests/regressiontests/i18n/contenttypes/locale/fr/LC_MESSAGES/django.mo",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.mo?ref=f9dad46d3665214ac80af06371fae10c55605086"
        },
        {
            "sha": "b4916c2570bfbb7116de62e521886db208d13dbc",
            "filename": "tests/regressiontests/i18n/contenttypes/locale/fr/LC_MESSAGES/django.po",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Flocale%2Ffr%2FLC_MESSAGES%2Fdjango.po?ref=f9dad46d3665214ac80af06371fae10c55605086",
            "patch": "@@ -0,0 +1,27 @@\n+# SOME DESCRIPTIVE TITLE.\n+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER\n+# This file is distributed under the same license as the PACKAGE package.\n+# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.\n+#\n+#, fuzzy\n+msgid \"\"\n+msgstr \"\"\n+\"Project-Id-Version: PACKAGE VERSION\\n\"\n+\"Report-Msgid-Bugs-To: \\n\"\n+\"POT-Creation-Date: 2011-09-15 15:41-0700\\n\"\n+\"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\\n\"\n+\"Last-Translator: FULL NAME <EMAIL@ADDRESS>\\n\"\n+\"Language-Team: LANGUAGE <LL@li.org>\\n\"\n+\"Language: \\n\"\n+\"MIME-Version: 1.0\\n\"\n+\"Content-Type: text/plain; charset=UTF-8\\n\"\n+\"Content-Transfer-Encoding: 8bit\\n\"\n+\"Plural-Forms: nplurals=2; plural=(n > 1)\\n\"\n+\n+#: models.py:6\n+msgid \"Anything\"\n+msgstr \"\"\n+\n+#: models.py:15\n+msgid \"Company\"\n+msgstr \"Société\"\n\\ No newline at end of file"
        },
        {
            "sha": "eb5c1718fc59346183508dbbc687da1e5cae0c34",
            "filename": "tests/regressiontests/i18n/contenttypes/tests.py",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Ftests.py?ref=f9dad46d3665214ac80af06371fae10c55605086",
            "patch": "@@ -0,0 +1,35 @@\n+# coding: utf-8\n+from __future__ import with_statement\n+\n+import os\n+\n+from django.test import TestCase\n+from django.test.utils import override_settings\n+from django.utils import translation\n+from django.contrib.contenttypes.models import ContentType\n+\n+\n+class ContentTypeTests(TestCase):\n+    def test_verbose_name(self):\n+        company_type = ContentType.objects.get(app_label='i18n', model='company')\n+        with translation.override('en'):\n+            self.assertEqual(unicode(company_type), u'Company')\n+        with translation.override('fr'):\n+            self.assertEqual(unicode(company_type), u'Société')\n+\n+    def test_field_override(self):\n+        company_type = ContentType.objects.get(app_label='i18n', model='company')\n+        company_type.name = 'Other'\n+        self.assertEqual(unicode(company_type), 'Other')\n+\n+ContentTypeTests = override_settings(\n+    USE_I18N=True,\n+    LOCALE_PATHS=(\n+        os.path.join(os.path.dirname(__file__), 'locale'),\n+    ),\n+    LANGUAGE_CODE='en',\n+    LANGUAGES=(\n+        ('en', 'English'),\n+        ('fr', 'French'),\n+    ),\n+)(ContentTypeTests)"
        },
        {
            "sha": "a302769fefdc8e877ec882975b13922b0e43aca8",
            "filename": "tests/regressiontests/i18n/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fmodels.py?ref=f9dad46d3665214ac80af06371fae10c55605086",
            "patch": "@@ -10,3 +10,6 @@ class Company(models.Model):\n     date_added = models.DateTimeField(default=datetime(1799,1,31,23,59,59,0))\n     cents_payed = models.DecimalField(max_digits=4, decimal_places=2)\n     products_delivered = models.IntegerField()\n+\n+    class Meta:\n+        verbose_name = _('Company')\n\\ No newline at end of file"
        },
        {
            "sha": "3a75201372d577b33d5ac3c39f96b4c5647d86c4",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f9dad46d3665214ac80af06371fae10c55605086/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=f9dad46d3665214ac80af06371fae10c55605086",
            "patch": "@@ -26,6 +26,7 @@\n \n from commands.tests import *\n from patterns.tests import *\n+from contenttypes.tests import *\n from test_warnings import DeprecationWarningTests\n \n here = os.path.dirname(os.path.abspath(__file__))"
        }
    ],
    "stats": {
        "total": 107,
        "additions": 105,
        "deletions": 2
    }
}