{
    "author": "freakboy3742",
    "message": "Fixed #15502 -- Ensure that nested TemplateDoesNotExist errors are propegated with a meaningful error message when loaded using select_template. Thanks to jaylett for the report, and GDorn for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15717 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "edfed185811821a6d000f32d22fe398dfe3e0fe9",
    "files": [
        {
            "sha": "98eddf24f26090b3fc1b0eb284ab102faf4702af",
            "filename": "django/template/loader.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/edfed185811821a6d000f32d22fe398dfe3e0fe9/django%2Ftemplate%2Floader.py",
            "raw_url": "https://github.com/django/django/raw/edfed185811821a6d000f32d22fe398dfe3e0fe9/django%2Ftemplate%2Floader.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floader.py?ref=edfed185811821a6d000f32d22fe398dfe3e0fe9",
            "patch": "@@ -191,12 +191,15 @@ def render_to_string(template_name, dictionary=None, context_instance=None):\n \n def select_template(template_name_list):\n     \"Given a list of template names, returns the first that can be loaded.\"\n+    not_found = []\n     for template_name in template_name_list:\n         try:\n             return get_template(template_name)\n-        except TemplateDoesNotExist:\n+        except TemplateDoesNotExist, e:\n+            if e.args[0] not in not_found:\n+                not_found.append(e.args[0])\n             continue\n     # If we get here, none of the templates could be loaded\n-    raise TemplateDoesNotExist(', '.join(template_name_list))\n+    raise TemplateDoesNotExist(', '.join(not_found))\n \n add_to_builtins('django.template.loader_tags')"
        },
        {
            "sha": "6db959380e336ad818d582e23d7e27e9ecde028b",
            "filename": "tests/regressiontests/templates/templates/test_include_error.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/edfed185811821a6d000f32d22fe398dfe3e0fe9/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_include_error.html",
            "raw_url": "https://github.com/django/django/raw/edfed185811821a6d000f32d22fe398dfe3e0fe9/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_include_error.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_include_error.html?ref=edfed185811821a6d000f32d22fe398dfe3e0fe9",
            "patch": "@@ -0,0 +1 @@\n+{% include \"missing.html\" %}\n\\ No newline at end of file"
        },
        {
            "sha": "c99081932a51e9ff6a1443c03c8ca90d2ca89e76",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/edfed185811821a6d000f32d22fe398dfe3e0fe9/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/edfed185811821a6d000f32d22fe398dfe3e0fe9/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=edfed185811821a6d000f32d22fe398dfe3e0fe9",
            "patch": "@@ -237,6 +237,38 @@ def test_loader_debug_origin(self):\n             loader.template_source_loaders = old_loaders\n             settings.TEMPLATE_DEBUG = old_td\n \n+\n+    def test_include_missing_template(self):\n+        \"\"\"\n+        Tests that the correct template is identified as not existing\n+        when {% include %} specifies a template that does not exist.\n+        \"\"\"\n+\n+        # TEMPLATE_DEBUG must be true, otherwise the exception raised\n+        # during {% include %} processing will be suppressed.\n+        old_td, settings.TEMPLATE_DEBUG = settings.TEMPLATE_DEBUG, True\n+        old_loaders = loader.template_source_loaders\n+\n+        try:\n+            # Test the base loader class via the app loader. load_template\n+            # from base is used by all shipped loaders excepting cached,\n+            # which has its own test.\n+            loader.template_source_loaders = (app_directories.Loader(),)\n+\n+            load_name = 'test_include_error.html'\n+            r = None\n+            try:\n+                tmpl = loader.select_template([load_name])\n+                r = tmpl.render(template.Context({}))\n+            except template.TemplateDoesNotExist, e:\n+                settings.TEMPLATE_DEBUG = old_td\n+                self.assertEqual(e.args[0], 'missing.html')\n+            self.assertEqual(r, None, 'Template rendering unexpectedly succeeded, produced: ->%r<-' % r)\n+        finally:\n+            loader.template_source_loaders = old_loaders\n+            settings.TEMPLATE_DEBUG = old_td\n+\n+\n     def test_extends_include_missing_baseloader(self):\n         \"\"\"\n         Tests that the correct template is identified as not existing"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 38,
        "deletions": 2
    }
}