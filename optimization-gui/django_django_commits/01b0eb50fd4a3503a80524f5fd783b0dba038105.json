{
    "author": "alex",
    "message": "Make ``Formset.__getitem__`` O(1), rather than O(n).  If you override ``__iter__`` you now need to also override ``__getitem__`` for consistant behavior.  Thanks to Carl and Russ for the review.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16770 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "01b0eb50fd4a3503a80524f5fd783b0dba038105",
    "files": [
        {
            "sha": "ba82978535ddde72a5eb7cd1523aa420dbf42fcb",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/01b0eb50fd4a3503a80524f5fd783b0dba038105/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/01b0eb50fd4a3503a80524f5fd783b0dba038105/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=01b0eb50fd4a3503a80524f5fd783b0dba038105",
            "patch": "@@ -55,7 +55,7 @@ def __iter__(self):\n \n     def __getitem__(self, index):\n         \"\"\"Returns the form at the given index, based on the rendering order\"\"\"\n-        return list(self)[index]\n+        return self.forms[index]\n \n     def __len__(self):\n         return len(self.forms)"
        },
        {
            "sha": "50679a1a31faa6ee0f7b69b102716fc9e2bb8285",
            "filename": "docs/topics/forms/formsets.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/01b0eb50fd4a3503a80524f5fd783b0dba038105/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "raw_url": "https://github.com/django/django/raw/01b0eb50fd4a3503a80524f5fd783b0dba038105/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fformsets.txt?ref=01b0eb50fd4a3503a80524f5fd783b0dba038105",
            "patch": "@@ -49,6 +49,10 @@ they were created. The default formset iterator also renders the forms\n in this order, but you can change this order by providing an alternate\n implementation for the :meth:`__iter__()` method.\n \n+Formsets can also be indexed into, which returns the corresponding form. If you\n+override ``__iter__``, you will need to also override ``__getitem__`` to have\n+matching behavior.\n+\n Using initial data with a formset\n ---------------------------------\n "
        },
        {
            "sha": "4ad7e78e7c635be29b321ebb664222b27e8f41a5",
            "filename": "tests/regressiontests/forms/tests/formsets.py",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/01b0eb50fd4a3503a80524f5fd783b0dba038105/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/01b0eb50fd4a3503a80524f5fd783b0dba038105/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fformsets.py?ref=01b0eb50fd4a3503a80524f5fd783b0dba038105",
            "patch": "@@ -793,8 +793,10 @@ def test_formset_iteration(self):\n         # Formets can override the default iteration order\n         class BaseReverseFormSet(BaseFormSet):\n             def __iter__(self):\n-                for form in reversed(self.forms):\n-                    yield form\n+                return reversed(self.forms)\n+\n+            def __getitem__(self, idx):\n+                return super(BaseReverseFormSet, self).__getitem__(len(self) - idx - 1)\n \n         ReverseChoiceFormset = formset_factory(Choice, BaseReverseFormSet, extra=3)\n         reverse_formset = ReverseChoiceFormset()\n@@ -911,12 +913,12 @@ def test_empty_forms_are_unbound(self):\n         # The empty forms should be equal.\n         self.assertEqual(empty_forms[0].as_p(), empty_forms[1].as_p())\n \n-class TestEmptyFormSet(TestCase): \n+class TestEmptyFormSet(TestCase):\n     \"Test that an empty formset still calls clean()\"\n-    def test_empty_formset_is_valid(self): \n-        EmptyFsetWontValidateFormset = formset_factory(FavoriteDrinkForm, extra=0, formset=EmptyFsetWontValidate) \n-        formset = EmptyFsetWontValidateFormset(data={'form-INITIAL_FORMS':'0', 'form-TOTAL_FORMS':'0'},prefix=\"form\") \n-        formset2 = EmptyFsetWontValidateFormset(data={'form-INITIAL_FORMS':'0', 'form-TOTAL_FORMS':'1', 'form-0-name':'bah' },prefix=\"form\") \n-        self.assertFalse(formset.is_valid()) \n-        self.assertFalse(formset2.is_valid()) \n+    def test_empty_formset_is_valid(self):\n+        EmptyFsetWontValidateFormset = formset_factory(FavoriteDrinkForm, extra=0, formset=EmptyFsetWontValidate)\n+        formset = EmptyFsetWontValidateFormset(data={'form-INITIAL_FORMS':'0', 'form-TOTAL_FORMS':'0'},prefix=\"form\")\n+        formset2 = EmptyFsetWontValidateFormset(data={'form-INITIAL_FORMS':'0', 'form-TOTAL_FORMS':'1', 'form-0-name':'bah' },prefix=\"form\")\n+        self.assertFalse(formset.is_valid())\n+        self.assertFalse(formset2.is_valid())\n "
        }
    ],
    "stats": {
        "total": 26,
        "additions": 16,
        "deletions": 10
    }
}