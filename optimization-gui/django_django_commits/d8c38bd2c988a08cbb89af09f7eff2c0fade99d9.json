{
    "author": "freakboy3742",
    "message": "Fixed #14046 -- Made {% include %} behave the same, regardless of whether the template included is named by variable or constant string. Thanks to defcube for the report, and George Karpenkov for the draft patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15413 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d8c38bd2c988a08cbb89af09f7eff2c0fade99d9",
    "files": [
        {
            "sha": "1e99352d5d8024c5928ffd8f4bc40bd0d353991f",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=d8c38bd2c988a08cbb89af09f7eff2c0fade99d9",
            "patch": "@@ -258,6 +258,7 @@ answer newbie questions, and generally made Django that much better:\n     Bahadır Kandemir <bahadir@pardus.org.tr>\n     Karderio <karderio@gmail.com>\n     Nagy Károly <charlie@rendszergazda.com>\n+    George Karpenkov <george@metaworld.ru>\n     Erik Karulf <erik@karulf.com>\n     Ben Dean Kawamura <ben.dean.kawamura@gmail.com>\n     Ian G. Kelly <ian.g.kelly@gmail.com>"
        },
        {
            "sha": "70096aafee55cae087f020373bb5ff89b18d83af",
            "filename": "django/template/loader_tags.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/django%2Ftemplate%2Floader_tags.py",
            "raw_url": "https://github.com/django/django/raw/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/django%2Ftemplate%2Floader_tags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floader_tags.py?ref=d8c38bd2c988a08cbb89af09f7eff2c0fade99d9",
            "patch": "@@ -168,12 +168,10 @@ def render(self, context):\n             template_name = self.template_name.resolve(context)\n             template = get_template(template_name)\n             return self.render_template(template, context)\n-        except TemplateSyntaxError:\n+        except:\n             if settings.TEMPLATE_DEBUG:\n                 raise\n             return ''\n-        except:\n-            return '' # Fail silently for invalid included templates.\n \n def do_block(parser, token):\n     \"\"\""
        },
        {
            "sha": "86c275bb05eb44a93e1f3aeeeb663607d0924f9b",
            "filename": "tests/regressiontests/templates/templatetags/bad_tag.py",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fbad_tag.py",
            "raw_url": "https://github.com/django/django/raw/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fbad_tag.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fbad_tag.py?ref=d8c38bd2c988a08cbb89af09f7eff2c0fade99d9",
            "patch": "@@ -0,0 +1,7 @@\n+from django import template\n+\n+register = template.Library()\n+\n+@register.tag\n+def badtag(parser, token):\n+    raise RuntimeError(\"I am a bad tag\")"
        },
        {
            "sha": "d69ddaeb2cb286508debb91450184edb471c312b",
            "filename": "tests/regressiontests/templates/templatetags/broken_tag.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fbroken_tag.py",
            "raw_url": "https://github.com/django/django/raw/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fbroken_tag.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fbroken_tag.py?ref=d8c38bd2c988a08cbb89af09f7eff2c0fade99d9",
            "patch": "@@ -1 +1 @@\n-from django import Xtemplate\n+from django import Xtemplate\n\\ No newline at end of file"
        },
        {
            "sha": "54c97ce1171988a172ff1cdadd1997f3ad2f9735",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 45,
            "deletions": 23,
            "changes": 68,
            "blob_url": "https://github.com/django/django/blob/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d8c38bd2c988a08cbb89af09f7eff2c0fade99d9/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=d8c38bd2c988a08cbb89af09f7eff2c0fade99d9",
            "patch": "@@ -389,46 +389,59 @@ def test_template_loader(template_name, template_dirs=None):\n             if isinstance(vals[2], tuple):\n                 normal_string_result = vals[2][0]\n                 invalid_string_result = vals[2][1]\n-                if isinstance(invalid_string_result, basestring) and '%s' in invalid_string_result:\n+\n+                if isinstance(invalid_string_result, tuple):\n                     expected_invalid_str = 'INVALID %s'\n-                    invalid_string_result = invalid_string_result % vals[2][2]\n+                    invalid_string_result = invalid_string_result[0] % invalid_string_result[1]\n                     template_base.invalid_var_format_string = True\n+\n+                try:\n+                    template_debug_result = vals[2][2]\n+                except IndexError:\n+                    template_debug_result = normal_string_result\n+\n             else:\n                 normal_string_result = vals[2]\n                 invalid_string_result = vals[2]\n+                template_debug_result = vals[2]\n \n             if 'LANGUAGE_CODE' in vals[1]:\n                 activate(vals[1]['LANGUAGE_CODE'])\n             else:\n                 activate('en-us')\n \n-            for invalid_str, result in [('', normal_string_result),\n-                                        (expected_invalid_str, invalid_string_result)]:\n+            for invalid_str, template_debug, result in [\n+                    ('', False, normal_string_result),\n+                    (expected_invalid_str, False, invalid_string_result),\n+                    ('', True, template_debug_result)\n+                ]:\n                 settings.TEMPLATE_STRING_IF_INVALID = invalid_str\n+                settings.TEMPLATE_DEBUG = template_debug\n                 for is_cached in (False, True):\n                     try:\n                         start = datetime.now()\n                         test_template = loader.get_template(name)\n                         end = datetime.now()\n                         if end-start > timedelta(seconds=0.2):\n-                            failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s'): %s -- FAILED. Took too long to parse test\" % (is_cached, invalid_str, name))\n+                            failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s', TEMPLATE_DEBUG=%s): %s -- FAILED. Took too long to parse test\" % (is_cached, invalid_str, template_debug, name))\n \n                         start = datetime.now()\n                         output = self.render(test_template, vals)\n                         end = datetime.now()\n                         if end-start > timedelta(seconds=0.2):\n-                            failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s'): %s -- FAILED. Took too long to render test\" % (is_cached, invalid_str, name))\n+                            failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s', TEMPLATE_DEBUG=%s): %s -- FAILED. Took too long to render test\" % (is_cached, invalid_str, template_debug, name))\n                     except ContextStackException:\n-                        failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s'): %s -- FAILED. Context stack was left imbalanced\" % (is_cached, invalid_str, name))\n+                        failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s', TEMPLATE_DEBUG=%s): %s -- FAILED. Context stack was left imbalanced\" % (is_cached, invalid_str, template_debug, name))\n                         continue\n                     except Exception:\n                         exc_type, exc_value, exc_tb = sys.exc_info()\n                         if exc_type != result:\n+                            print \"CHECK\", name, exc_type, result\n                             tb = '\\n'.join(traceback.format_exception(exc_type, exc_value, exc_tb))\n-                            failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s'): %s -- FAILED. Got %s, exception: %s\\n%s\" % (is_cached, invalid_str, name, exc_type, exc_value, tb))\n+                            failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s', TEMPLATE_DEBUG=%s): %s -- FAILED. Got %s, exception: %s\\n%s\" % (is_cached, invalid_str, template_debug, name, exc_type, exc_value, tb))\n                         continue\n                     if output != result:\n-                        failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s'): %s -- FAILED. Expected %r, got %r\" % (is_cached, invalid_str, name, result, output))\n+                        failures.append(\"Template test (Cached='%s', TEMPLATE_STRING_IF_INVALID='%s', TEMPLATE_DEBUG=%s): %s -- FAILED. Expected %r, got %r\" % (is_cached, invalid_str, template_debug, name, result, output))\n                 cache_loader.reset()\n \n             if 'LANGUAGE_CODE' in vals[1]:\n@@ -616,7 +629,7 @@ def get_template_tests(self):\n \n             # In methods that raise an exception without a\n             # \"silent_variable_attribute\" set to True, the exception propagates\n-            'filter-syntax14': (r'1{{ var.method4 }}2', {\"var\": SomeClass()}, SomeOtherException),\n+            'filter-syntax14': (r'1{{ var.method4 }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException, template.TemplateSyntaxError)),\n \n             # Escaped backslash in argument\n             'filter-syntax15': (r'{{ var|default_if_none:\"foo\\bar\" }}', {\"var\": None}, r'foo\\bar'),\n@@ -645,8 +658,8 @@ def get_template_tests(self):\n             # In attribute and dict lookups that raise an unexpected exception\n             # without a \"silent_variable_attribute\" set to True, the exception\n             # propagates\n-            'filter-syntax23': (r'1{{ var.noisy_fail_key }}2', {\"var\": SomeClass()}, SomeOtherException),\n-            'filter-syntax24': (r'1{{ var.noisy_fail_attribute }}2', {\"var\": SomeClass()}, SomeOtherException),\n+            'filter-syntax23': (r'1{{ var.noisy_fail_key }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException, template.TemplateSyntaxError)),\n+            'filter-syntax24': (r'1{{ var.noisy_fail_attribute }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException, template.TemplateSyntaxError)),\n \n             ### COMMENT SYNTAX ########################################################\n             'comment-syntax01': (\"{# this is hidden #}hello\", {}, \"hello\"),\n@@ -699,7 +712,7 @@ def get_template_tests(self):\n             ### EXCEPTIONS ############################################################\n \n             # Raise exception for invalid template name\n-            'exception01': (\"{% extends 'nonexistent' %}\", {}, template.TemplateDoesNotExist),\n+            'exception01': (\"{% extends 'nonexistent' %}\", {}, (template.TemplateDoesNotExist, template.TemplateDoesNotExist, template.TemplateSyntaxError)),\n \n             # Raise exception for invalid template name (in variable)\n             'exception02': (\"{% extends nonexistent %}\", {}, (template.TemplateSyntaxError, template.TemplateDoesNotExist)),\n@@ -968,7 +981,7 @@ def get_template_tests(self):\n             'include01': ('{% include \"basic-syntax01\" %}', {}, \"something cool\"),\n             'include02': ('{% include \"basic-syntax02\" %}', {'headline': 'Included'}, \"Included\"),\n             'include03': ('{% include template_name %}', {'template_name': 'basic-syntax02', 'headline': 'Included'}, \"Included\"),\n-            'include04': ('a{% include \"nonexistent\" %}b', {}, \"ab\"),\n+            'include04': ('a{% include \"nonexistent\" %}b', {}, (\"ab\", \"ab\", template.TemplateDoesNotExist)),\n             'include 05': ('template with a space', {}, 'template with a space'),\n             'include06': ('{% include \"include 05\"%}', {}, 'template with a space'),\n \n@@ -989,6 +1002,15 @@ def get_template_tests(self):\n             'include-error05': ('{% include \"basic-syntax01\" foo=\"duplicate\" foo=\"key\" %}', {}, template.TemplateSyntaxError),\n             'include-error06': ('{% include \"basic-syntax01\" only only %}', {}, template.TemplateSyntaxError),\n \n+            ### INCLUSION ERROR REPORTING #############################################\n+            'include-fail1': ('{% load bad_tag %}{% badtag %}', {}, RuntimeError),\n+            'include-fail2': ('{% load broken_tag %}', {}, template.TemplateSyntaxError),\n+            'include-error07': ('{% include \"include-fail1\" %}', {}, ('', '', RuntimeError)),\n+            'include-error08': ('{% include \"include-fail2\" %}', {}, ('', '', template.TemplateSyntaxError)),\n+            'include-error09': ('{% include failed_include %}', {'failed_include': 'include-fail1'}, ('', '', template.TemplateSyntaxError)),\n+            'include-error10': ('{% include failed_include %}', {'failed_include': 'include-fail2'}, ('', '', template.TemplateSyntaxError)),\n+\n+\n             ### NAMED ENDBLOCKS #######################################################\n \n             # Basic test\n@@ -1230,8 +1252,8 @@ def get_template_tests(self):\n             'invalidstr03': ('{% for v in var %}({{ v }}){% endfor %}', {}, ''),\n             'invalidstr04': ('{% if var %}Yes{% else %}No{% endif %}', {}, 'No'),\n             'invalidstr04': ('{% if var|default:\"Foo\" %}Yes{% else %}No{% endif %}', {}, 'Yes'),\n-            'invalidstr05': ('{{ var }}', {}, ('', 'INVALID %s', 'var')),\n-            'invalidstr06': ('{{ var.prop }}', {'var': {}}, ('', 'INVALID %s', 'var.prop')),\n+            'invalidstr05': ('{{ var }}', {}, ('', ('INVALID %s', 'var'))),\n+            'invalidstr06': ('{{ var.prop }}', {'var': {}}, ('', ('INVALID %s', 'var.prop'))),\n \n             ### MULTILINE #############################################################\n \n@@ -1393,8 +1415,8 @@ def get_template_tests(self):\n \n             # Failures\n             'old-url-fail01': ('{% url %}', {}, template.TemplateSyntaxError),\n-            'old-url-fail02': ('{% url no_such_view %}', {}, urlresolvers.NoReverseMatch),\n-            'old-url-fail03': ('{% url regressiontests.templates.views.client %}', {}, urlresolvers.NoReverseMatch),\n+            'old-url-fail02': ('{% url no_such_view %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'old-url-fail03': ('{% url regressiontests.templates.views.client %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n             'old-url-fail04': ('{% url view id, %}', {}, template.TemplateSyntaxError),\n             'old-url-fail05': ('{% url view id= %}', {}, template.TemplateSyntaxError),\n             'old-url-fail06': ('{% url view a.id=id %}', {}, template.TemplateSyntaxError),\n@@ -1433,18 +1455,18 @@ def get_template_tests(self):\n \n             # Failures\n             'url-fail01': ('{% load url from future %}{% url %}', {}, template.TemplateSyntaxError),\n-            'url-fail02': ('{% load url from future %}{% url \"no_such_view\" %}', {}, urlresolvers.NoReverseMatch),\n-            'url-fail03': ('{% load url from future %}{% url \"regressiontests.templates.views.client\" %}', {}, urlresolvers.NoReverseMatch),\n+            'url-fail02': ('{% load url from future %}{% url \"no_such_view\" %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'url-fail03': ('{% load url from future %}{% url \"regressiontests.templates.views.client\" %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n             'url-fail04': ('{% load url from future %}{% url \"view\" id, %}', {}, template.TemplateSyntaxError),\n             'url-fail05': ('{% load url from future %}{% url \"view\" id= %}', {}, template.TemplateSyntaxError),\n             'url-fail06': ('{% load url from future %}{% url \"view\" a.id=id %}', {}, template.TemplateSyntaxError),\n             'url-fail07': ('{% load url from future %}{% url \"view\" a.id!id %}', {}, template.TemplateSyntaxError),\n             'url-fail08': ('{% load url from future %}{% url \"view\" id=\"unterminatedstring %}', {}, template.TemplateSyntaxError),\n             'url-fail09': ('{% load url from future %}{% url \"view\" id=\", %}', {}, template.TemplateSyntaxError),\n \n-            'url-fail11': ('{% load url from future %}{% url named_url %}', {}, urlresolvers.NoReverseMatch),\n-            'url-fail12': ('{% load url from future %}{% url named_url %}', {'named_url': 'no_such_view'}, urlresolvers.NoReverseMatch),\n-            'url-fail13': ('{% load url from future %}{% url named_url %}', {'named_url': 'regressiontests.templates.views.client'}, urlresolvers.NoReverseMatch),\n+            'url-fail11': ('{% load url from future %}{% url named_url %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'url-fail12': ('{% load url from future %}{% url named_url %}', {'named_url': 'no_such_view'}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'url-fail13': ('{% load url from future %}{% url named_url %}', {'named_url': 'regressiontests.templates.views.client'}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n             'url-fail14': ('{% load url from future %}{% url named_url id, %}', {'named_url': 'view'}, template.TemplateSyntaxError),\n             'url-fail15': ('{% load url from future %}{% url named_url id= %}', {'named_url': 'view'}, template.TemplateSyntaxError),\n             'url-fail16': ('{% load url from future %}{% url named_url a.id=id %}', {'named_url': 'view'}, template.TemplateSyntaxError),"
        }
    ],
    "stats": {
        "total": 82,
        "additions": 55,
        "deletions": 27
    }
}