{
    "author": "ptone",
    "message": "Fixed #9279 -- Added ignorenonexistent option to loaddata\n\nThanks to Roman Gladkov for the initial patch and Simon Charette for review.",
    "sha": "e7723683dc652613df369d5ca412e8b1217012d3",
    "files": [
        {
            "sha": "a2e7f7d4c9b08103b7582cff067ccb138199cb1b",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -23,6 +23,7 @@\n except ImportError:\n     has_bz2 = False\n \n+\n class Command(BaseCommand):\n     help = 'Installs the named fixture(s) in the database.'\n     args = \"fixture [fixture ...]\"\n@@ -31,9 +32,14 @@ class Command(BaseCommand):\n         make_option('--database', action='store', dest='database',\n             default=DEFAULT_DB_ALIAS, help='Nominates a specific database to load '\n                 'fixtures into. Defaults to the \"default\" database.'),\n+        make_option('--ignorenonexistent', '-i', action='store_true', dest='ignore',\n+            default=False, help='Ignores entries in the serialised data for fields'\n+                                ' that have been removed from the database'),\n     )\n \n     def handle(self, *fixture_labels, **options):\n+\n+        ignore = options.get('ignore')\n         using = options.get('database')\n \n         connection = connections[using]\n@@ -175,7 +181,7 @@ def read(self):\n                                         self.stdout.write(\"Installing %s fixture '%s' from %s.\" % \\\n                                             (format, fixture_name, humanize(fixture_dir)))\n \n-                                    objects = serializers.deserialize(format, fixture, using=using)\n+                                    objects = serializers.deserialize(format, fixture, using=using, ignorenonexistent=ignore)\n \n                                     for obj in objects:\n                                         objects_in_fixture += 1"
        },
        {
            "sha": "37fa90628030669dc99f9367d601a11fbe31ae1a",
            "filename": "django/core/serializers/python.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/django%2Fcore%2Fserializers%2Fpython.py",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/django%2Fcore%2Fserializers%2Fpython.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpython.py?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.encoding import smart_text, is_protected_type\n from django.utils import six\n \n+\n class Serializer(base.Serializer):\n     \"\"\"\n     Serializes a QuerySet to basic Python objects.\n@@ -72,6 +73,7 @@ def handle_m2m_field(self, obj, field):\n     def getvalue(self):\n         return self.objects\n \n+\n def Deserializer(object_list, **options):\n     \"\"\"\n     Deserialize simple Python objects back into Django ORM instances.\n@@ -80,15 +82,23 @@ def Deserializer(object_list, **options):\n     stream or a string) to the constructor\n     \"\"\"\n     db = options.pop('using', DEFAULT_DB_ALIAS)\n+    ignore = options.pop('ignorenonexistent', False)\n+\n     models.get_apps()\n     for d in object_list:\n         # Look up the model and starting build a dict of data for it.\n         Model = _get_model(d[\"model\"])\n-        data = {Model._meta.pk.attname : Model._meta.pk.to_python(d[\"pk\"])}\n+        data = {Model._meta.pk.attname: Model._meta.pk.to_python(d[\"pk\"])}\n         m2m_data = {}\n+        model_fields = Model._meta.get_all_field_names()\n \n         # Handle each field\n         for (field_name, field_value) in six.iteritems(d[\"fields\"]):\n+\n+            if ignore and field_name not in model_fields:\n+                # skip fields no longer on model\n+                continue\n+\n             if isinstance(field_value, str):\n                 field_value = smart_text(field_value, options.get(\"encoding\", settings.DEFAULT_CHARSET), strings_only=True)\n "
        },
        {
            "sha": "7fa753998514e0efbc0d83270df51c0e6651e8a9",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -289,6 +289,11 @@ Searches for and loads the contents of the named fixture into the database.\n The :djadminopt:`--database` option can be used to specify the database\n onto which the data will be loaded.\n \n+.. versionadded:: 1.5\n+\n+The :djadminopt:`--ignorenonexistent` option can be used to ignore fields that\n+may have been removed from models since the fixture was originally generated.\n+\n What's a \"fixture\"?\n ~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "11b3488c1136e1aa579d15202f58ab42fbf8513d",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -195,6 +195,9 @@ Django 1.5 also includes several smaller improvements worth noting:\n   whenever a user fails to login successfully. See\n   :data:`~django.contrib.auth.signals.user_login_failed`\n \n+* The loaddata management command now supports an `ignorenonexistent` option to\n+  ignore data for fields that no longer exist.\n+\n Backwards incompatible changes in 1.5\n =====================================\n "
        },
        {
            "sha": "9b44166e42e53210483c0e9f83b5e277f2f09d2e",
            "filename": "docs/topics/serialization.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/docs%2Ftopics%2Fserialization.txt",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/docs%2Ftopics%2Fserialization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fserialization.txt?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -130,6 +130,14 @@ trust your data source you could just save the object and move on.\n \n The Django object itself can be inspected as ``deserialized_object.object``.\n \n+.. versionadded:: 1.5\n+\n+If fields in the serialized data do not exist on a model,\n+a ``DeserializationError`` will be raised unless the ``ignorenonexistent``\n+argument is passed in as True::\n+\n+    serializers.deserialize(\"xml\", data, ignorenonexistent=True)\n+\n .. _serialization-formats:\n \n Serialization formats"
        },
        {
            "sha": "03c0f36696bc2a72742188638975cb1269a7c585",
            "filename": "tests/regressiontests/fixtures_regress/fixtures/sequence_extra.json",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/tests%2Fregressiontests%2Ffixtures_regress%2Ffixtures%2Fsequence_extra.json",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/tests%2Fregressiontests%2Ffixtures_regress%2Ffixtures%2Fsequence_extra.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ffixtures%2Fsequence_extra.json?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -0,0 +1,13 @@\n+[\n+    {\n+        \"pk\": \"1\",\n+        \"model\": \"fixtures_regress.animal\",\n+        \"fields\": {\n+            \"name\": \"Lion\",\n+            \"extra_name\": \"Super Lion\",\n+            \"latin_name\": \"Panthera leo\",\n+            \"count\": 3,\n+            \"weight\": 1.2\n+        }\n+    }\n+]"
        },
        {
            "sha": "c9b9058dffedb2eef2723026f43e80ff2c4726b3",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/e7723683dc652613df369d5ca412e8b1217012d3/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e7723683dc652613df369d5ca412e8b1217012d3/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=e7723683dc652613df369d5ca412e8b1217012d3",
            "patch": "@@ -5,6 +5,7 @@\n import os\n import re\n \n+from django.core.serializers.base import DeserializationError\n from django.core import management\n from django.core.management.base import CommandError\n from django.core.management.commands.dumpdata import sort_dependencies\n@@ -22,6 +23,7 @@\n \n \n class TestFixtures(TestCase):\n+\n     def animal_pre_save_check(self, signal, sender, instance, **kwargs):\n         self.pre_save_checks.append(\n             (\n@@ -54,6 +56,33 @@ def test_duplicate_pk(self):\n         animal.save()\n         self.assertGreater(animal.id, 1)\n \n+    def test_loaddata_not_found_fields_not_ignore(self):\n+        \"\"\"\n+        Test for ticket #9279 -- Error is raised for entries in\n+        the serialised data for fields that have been removed\n+        from the database when not ignored.\n+        \"\"\"\n+        with self.assertRaises(DeserializationError):\n+            management.call_command(\n+                'loaddata',\n+                'sequence_extra',\n+                verbosity=0\n+            )\n+\n+    def test_loaddata_not_found_fields_ignore(self):\n+        \"\"\"\n+        Test for ticket #9279 -- Ignores entries in\n+        the serialised data for fields that have been removed\n+        from the database.\n+        \"\"\"\n+        management.call_command(\n+            'loaddata',\n+            'sequence_extra',\n+            ignore=True,\n+            verbosity=0\n+        )\n+        self.assertEqual(Animal.specimens.all()[0].name, 'Lion')\n+\n     @skipIfDBFeature('interprets_empty_strings_as_nulls')\n     def test_pretty_print_xml(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 78,
        "additions": 76,
        "deletions": 2
    }
}