{
    "author": "freakboy3742",
    "message": "Fixed #10573 -- Corrected autofocus problem in admin when the first widget displayed is a multiwidget. Thanks to rduffield for the report, and to Ramiro and Julien Phalip for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15452 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "74ffca17e2ca6a9f061913797efeebbc578692c5",
    "files": [
        {
            "sha": "fb278b42bedc5a4c7445847bc519c024e78e57b7",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/74ffca17e2ca6a9f061913797efeebbc578692c5/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/74ffca17e2ca6a9f061913797efeebbc578692c5/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=74ffca17e2ca6a9f061913797efeebbc578692c5",
            "patch": "@@ -17,8 +17,8 @@\n {% block breadcrumbs %}{% if not is_popup %}\n <div class=\"breadcrumbs\">\n      <a href=\"../../../\">{% trans \"Home\" %}</a> &rsaquo;\n-     <a href=\"../../\">{{ app_label|capfirst|escape }}</a> &rsaquo; \n-     {% if has_change_permission %}<a href=\"../\">{{ opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %} &rsaquo; \n+     <a href=\"../../\">{{ app_label|capfirst|escape }}</a> &rsaquo;\n+     {% if has_change_permission %}<a href=\"../\">{{ opts.verbose_name_plural|capfirst }}</a>{% else %}{{ opts.verbose_name_plural|capfirst }}{% endif %} &rsaquo;\n      {% if add %}{% trans \"Add\" %} {{ opts.verbose_name }}{% else %}{{ original|truncatewords:\"18\" }}{% endif %}\n </div>\n {% endif %}{% endblock %}\n@@ -60,7 +60,7 @@\n {% submit_row %}\n \n {% if adminform and add %}\n-   <script type=\"text/javascript\">document.getElementById(\"{{ adminform.first_field.auto_id }}\").focus();</script>\n+   <script type=\"text/javascript\">document.getElementById(\"{{ adminform.first_field.id_for_label }}\").focus();</script>\n {% endif %}\n \n {# JavaScript for prepopulated fields #}"
        },
        {
            "sha": "f776861948c75aafa6cee9042b8884583c64d534",
            "filename": "django/forms/forms.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/74ffca17e2ca6a9f061913797efeebbc578692c5/django%2Fforms%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/74ffca17e2ca6a9f061913797efeebbc578692c5/django%2Fforms%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fforms.py?ref=74ffca17e2ca6a9f061913797efeebbc578692c5",
            "patch": "@@ -522,3 +522,14 @@ def _auto_id(self):\n             return self.html_name\n         return ''\n     auto_id = property(_auto_id)\n+\n+    def _id_for_label(self):\n+        \"\"\"\n+        Wrapper around the field widget's `id_for_label` class method.\n+        Useful, for example, for focusing on this field regardless of whether\n+        it has a single widget or a MutiWidget.\n+        \"\"\"\n+        widget = self.field.widget\n+        id_ = widget.attrs.get('id') or self.auto_id\n+        return widget.id_for_label(id_)\n+    id_for_label = property(_id_for_label)"
        },
        {
            "sha": "60319eaf7d12ea9c48fac758d726dd64bdafbed2",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/74ffca17e2ca6a9f061913797efeebbc578692c5/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/74ffca17e2ca6a9f061913797efeebbc578692c5/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=74ffca17e2ca6a9f061913797efeebbc578692c5",
            "patch": "@@ -666,6 +666,10 @@ class Answer(models.Model):\n     def __unicode__(self):\n         return self.answer\n \n+class Reservation(models.Model):\n+    start_date = models.DateTimeField()\n+    price = models.IntegerField()\n+    \n admin.site.register(Article, ArticleAdmin)\n admin.site.register(CustomArticle, CustomArticleAdmin)\n admin.site.register(Section, save_as=True, inlines=[ArticleInline])\n@@ -701,6 +705,7 @@ def __unicode__(self):\n admin.site.register(CyclicOne)\n admin.site.register(CyclicTwo)\n admin.site.register(WorkHour, WorkHourAdmin)\n+admin.site.register(Reservation)\n \n # We intentionally register Promo and ChapterXtra1 but not Chapter nor ChapterXtra2.\n # That way we cover all four cases:"
        },
        {
            "sha": "98a2d41ddcd3d7ed35e6c78fa642232c866ce6d6",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/74ffca17e2ca6a9f061913797efeebbc578692c5/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/74ffca17e2ca6a9f061913797efeebbc578692c5/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=74ffca17e2ca6a9f061913797efeebbc578692c5",
            "patch": "@@ -431,6 +431,29 @@ def test_allowed_filtering_15103(self):\n         except SuspiciousOperation:\n             self.fail(\"Filters should be allowed if they are defined on a ForeignKey pointing to this model\")\n \n+class AdminJavaScriptTest(AdminViewBasicTest):\n+    def testSingleWidgetFirsFieldFocus(self):\n+        \"\"\"\n+        JavaScript-assisted auto-focus on first field.\n+        \"\"\"\n+        response = self.client.get('/test_admin/%s/admin_views/picture/add/' % self.urlbit)\n+        self.assertContains(\n+            response,\n+            '<script type=\"text/javascript\">document.getElementById(\"id_name\").focus();</script>'\n+        )\n+        \n+    def testMultiWidgetFirsFieldFocus(self):\n+        \"\"\"\n+        JavaScript-assisted auto-focus should work if a model/ModelAdmin setup\n+        is such that the first form field has a MultiWidget.\n+        \"\"\"\n+        response = self.client.get('/test_admin/%s/admin_views/reservation/add/' % self.urlbit)\n+        self.assertContains(\n+            response,\n+            '<script type=\"text/javascript\">document.getElementById(\"id_start_date_0\").focus();</script>'\n+        )\n+\n+\n class SaveAsTests(TestCase):\n     fixtures = ['admin-views-users.xml','admin-views-person.xml']\n "
        }
    ],
    "stats": {
        "total": 45,
        "additions": 42,
        "deletions": 3
    }
}