{
    "author": "jezdez",
    "message": "Fixed #16179 -- Extended argument handling of the new WizardView a little to behave the same as the rest of the generic class based views. Also cleaned up the template loading in its tests a bit. Thanks, Harro van der Klauw.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16368 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "703498b1c86678c287de8a44c08724b4e67c4e40",
    "files": [
        {
            "sha": "19ac7d6d7be0d7c1dfb729f090b77788b4f5c9ff",
            "filename": "django/contrib/formtools/wizard/tests/namedwizardtests/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Ftests.py?ref=703498b1c86678c287de8a44c08724b4e67c4e40",
            "patch": "@@ -22,12 +22,6 @@ def setUp(self):\n         self.testuser, created = User.objects.get_or_create(username='testuser1')\n         self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n \n-        wizard_template_dirs = [os.path.join(os.path.dirname(wizard.__file__), 'templates')]\n-        settings.TEMPLATE_DIRS = list(settings.TEMPLATE_DIRS) + wizard_template_dirs\n-\n-    def tearDown(self):\n-        del settings.TEMPLATE_DIRS[-1]\n-\n     def test_initial_call(self):\n         response = self.client.get(reverse('%s_start' % self.wizard_urlname))\n         self.assertEqual(response.status_code, 302)"
        },
        {
            "sha": "45f812cbae593ca65f86680af1346f390eeb1113",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/templates/other_wizard_form.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftemplates%2Fother_wizard_form.html",
            "raw_url": "https://github.com/django/django/raw/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftemplates%2Fother_wizard_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftemplates%2Fother_wizard_form.html?ref=703498b1c86678c287de8a44c08724b4e67c4e40",
            "patch": "@@ -0,0 +1 @@\n+{% extends \"formtools/wizard/wizard_form.html\" %}"
        },
        {
            "sha": "b07f286590fbef317e9cd41e23ce7eb84c04c639",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/tests.py",
            "status": "modified",
            "additions": 40,
            "deletions": 6,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftests.py?ref=703498b1c86678c287de8a44c08724b4e67c4e40",
            "patch": "@@ -13,12 +13,6 @@ def setUp(self):\n         self.testuser, created = User.objects.get_or_create(username='testuser1')\n         self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n \n-        wizard_template_dirs = [os.path.join(os.path.dirname(wizard.__file__), 'templates')]\n-        settings.TEMPLATE_DIRS = list(settings.TEMPLATE_DIRS) + wizard_template_dirs\n-\n-    def tearDown(self):\n-        del settings.TEMPLATE_DIRS[-1]\n-\n     def test_initial_call(self):\n         response = self.client.get(self.wizard_url)\n         wizard = response.context['wizard']\n@@ -245,4 +239,44 @@ class CookieWizardTests(WizardTests, TestCase):\n         }\n     )\n \n+class WizardTestKwargs(TestCase):\n+    wizard_url = '/wiz_other_template/'\n+    wizard_step_1_data = {\n+        'cookie_contact_wizard-current_step': 'form1',\n+    }\n+    wizard_step_data = (\n+        {\n+            'form1-name': 'Pony',\n+            'form1-thirsty': '2',\n+            'cookie_contact_wizard-current_step': 'form1',\n+        },\n+        {\n+            'form2-address1': '123 Main St',\n+            'form2-address2': 'Djangoland',\n+            'cookie_contact_wizard-current_step': 'form2',\n+        },\n+        {\n+            'form3-random_crap': 'blah blah',\n+            'cookie_contact_wizard-current_step': 'form3',\n+        },\n+        {\n+            'form4-INITIAL_FORMS': '0',\n+            'form4-TOTAL_FORMS': '2',\n+            'form4-MAX_NUM_FORMS': '0',\n+            'form4-0-random_crap': 'blah blah',\n+            'form4-1-random_crap': 'blah blah',\n+            'cookie_contact_wizard-current_step': 'form4',\n+        }\n+    )\n+    urls = 'django.contrib.formtools.wizard.tests.wizardtests.urls'\n+\n+    def setUp(self):\n+        self.testuser, created = User.objects.get_or_create(username='testuser1')\n+        self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n \n+    def test_template(self):\n+        templates = os.path.join(os.path.dirname(__file__), 'templates')\n+        with self.settings(\n+                TEMPLATE_DIRS=list(settings.TEMPLATE_DIRS) + [templates]):\n+            response = self.client.get(self.wizard_url)\n+            self.assertTemplateUsed(response, 'other_wizard_form.html')"
        },
        {
            "sha": "7b5e84e23437342099a6a814f08ff7bc89b18062",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/urls.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Furls.py?ref=703498b1c86678c287de8a44c08724b4e67c4e40",
            "patch": "@@ -13,4 +13,10 @@\n          ('form2', Page2),\n          ('form3', Page3),\n          ('form4', Page4)])),\n+     url(r'^wiz_other_template/$', CookieContactWizard.as_view(\n+         [('form1', Page1),\n+          ('form2', Page2),\n+          ('form3', Page3),\n+          ('form4', Page4)],\n+          template_name='other_wizard_form.html')),\n )"
        },
        {
            "sha": "ac9cfbdb103031451a0b999b4ac9b6cc6db34984",
            "filename": "django/contrib/formtools/wizard/views.py",
            "status": "modified",
            "additions": 7,
            "deletions": 12,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/703498b1c86678c287de8a44c08724b4e67c4e40/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py?ref=703498b1c86678c287de8a44c08724b4e67c4e40",
            "patch": "@@ -111,8 +111,8 @@ def as_view(cls, *args, **kwargs):\n         return super(WizardView, cls).as_view(**initkwargs)\n \n     @classmethod\n-    def get_initkwargs(cls, form_list,\n-            initial_dict=None, instance_dict=None, condition_dict=None):\n+    def get_initkwargs(cls, form_list, initial_dict=None,\n+            instance_dict=None, condition_dict=None, *args, **kwargs):\n         \"\"\"\n         Creates a dict with all needed parameters for the form wizard instances.\n \n@@ -134,11 +134,11 @@ def get_initkwargs(cls, form_list,\n           will be called with the formwizard instance as the only argument.\n           If the return value is true, the step's form will be used.\n         \"\"\"\n-        kwargs = {\n+        kwargs.update({\n             'initial_dict': initial_dict or {},\n             'instance_dict': instance_dict or {},\n             'condition_dict': condition_dict or {},\n-        }\n+        })\n         init_form_list = SortedDict()\n \n         assert len(form_list) > 0, 'at least one form is needed'\n@@ -567,21 +567,16 @@ def get_initkwargs(cls, *args, **kwargs):\n         We require a url_name to reverse URLs later. Additionally users can\n         pass a done_step_name to change the URL name of the \"done\" view.\n         \"\"\"\n+        assert 'url_name' in kwargs, 'URL name is needed to resolve correct wizard URLs'\n         extra_kwargs = {\n-            'done_step_name': 'done'\n+            'done_step_name': kwargs.pop('done_step_name', 'done'),\n+            'url_name': kwargs.pop('url_name'),\n         }\n-        assert 'url_name' in kwargs, 'URL name is needed to resolve correct wizard URLs'\n-        extra_kwargs['url_name'] = kwargs.pop('url_name')\n-\n-        if 'done_step_name' in kwargs:\n-            extra_kwargs['done_step_name'] = kwargs.pop('done_step_name')\n-\n         initkwargs = super(NamedUrlWizardView, cls).get_initkwargs(*args, **kwargs)\n         initkwargs.update(extra_kwargs)\n \n         assert initkwargs['done_step_name'] not in initkwargs['form_list'], \\\n             'step name \"%s\" is reserved for \"done\" view' % initkwargs['done_step_name']\n-\n         return initkwargs\n \n     def get(self, *args, **kwargs):"
        },
        {
            "sha": "31bb074e67d35f78d9ae4ec9c6d919668f3b2fe3",
            "filename": "tests/runtests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/703498b1c86678c287de8a44c08724b4e67c4e40/tests%2Fruntests.py",
            "raw_url": "https://github.com/django/django/raw/703498b1c86678c287de8a44c08724b4e67c4e40/tests%2Fruntests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fruntests.py?ref=703498b1c86678c287de8a44c08724b4e67c4e40",
            "patch": "@@ -29,6 +29,7 @@\n     'django.contrib.admindocs',\n     'django.contrib.staticfiles',\n     'django.contrib.humanize',\n+    'django.contrib.formtools.wizard',\n     'regressiontests.staticfiles_tests',\n     'regressiontests.staticfiles_tests.apps.test',\n     'regressiontests.staticfiles_tests.apps.no_label',"
        }
    ],
    "stats": {
        "total": 79,
        "additions": 55,
        "deletions": 24
    }
}