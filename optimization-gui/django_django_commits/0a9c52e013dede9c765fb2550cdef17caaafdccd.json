{
    "author": "carljm",
    "message": "Fixed #16917 -- Don't try to use the model name for a ContentType's unicode representation if the model no longer exists. Thanks Ivan Sagalaev for report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16895 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0a9c52e013dede9c765fb2550cdef17caaafdccd",
    "files": [
        {
            "sha": "9ab059eaec010d59d5c87157e8728467f7cf483e",
            "filename": "django/contrib/contenttypes/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/0a9c52e013dede9c765fb2550cdef17caaafdccd/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/0a9c52e013dede9c765fb2550cdef17caaafdccd/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmodels.py?ref=0a9c52e013dede9c765fb2550cdef17caaafdccd",
            "patch": "@@ -92,11 +92,11 @@ def __unicode__(self):\n         #\n         # We return self.name only when users have changed its value from the\n         # initial verbose_name_raw and might rely on it.\n-        meta = self.model_class()._meta\n-        if self.name != meta.verbose_name_raw:\n+        model = self.model_class()\n+        if not model or self.name != model._meta.verbose_name_raw:\n             return self.name\n         else:\n-            return force_unicode(meta.verbose_name)\n+            return force_unicode(model._meta.verbose_name)\n \n     def model_class(self):\n         \"Returns the Python model class for this type of content.\""
        },
        {
            "sha": "fa3878c5538d250d67c3a793d9b563c673875c3a",
            "filename": "django/contrib/contenttypes/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/0a9c52e013dede9c765fb2550cdef17caaafdccd/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0a9c52e013dede9c765fb2550cdef17caaafdccd/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Ftests.py?ref=0a9c52e013dede9c765fb2550cdef17caaafdccd",
            "patch": "@@ -109,3 +109,16 @@ def test_shortcut_view_without_get_absolute_url(self):\n         obj = FooWithoutUrl.objects.create(name=\"john\")\n \n         self.assertRaises(Http404, shortcut, request, user_ct.id, obj.id)\n+\n+    def test_missing_model(self):\n+        \"\"\"\n+        Ensures that displaying content types in admin (or anywhere) doesn't\n+        break on leftover content type records in the DB for which no model\n+        is defined anymore.\n+        \"\"\"\n+        ct = ContentType.objects.create(\n+            name = 'Old model',\n+            app_label = 'contenttypes',\n+            model = 'OldModel',\n+        )\n+        self.assertEqual(unicode(ct), u'Old model')"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 16,
        "deletions": 3
    }
}