{
    "author": "freakboy3742",
    "message": "Fixed #13686 -- Ensure that memcache handling of unicode values in add() and set_many() is consistent with the handling provided by get() and set(). Thanks to nedbatchelder for the report, and to jbalogh, accuser and Jacob Burch for their work ont the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15880 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "1a6d98dab97df7e4bfc6fd9c82183eb9a1349078",
    "files": [
        {
            "sha": "c456f7f3c3c6d24967af9e2ebe4814bfe6699a9e",
            "filename": "django/core/cache/backends/memcached.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/1a6d98dab97df7e4bfc6fd9c82183eb9a1349078/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "raw_url": "https://github.com/django/django/raw/1a6d98dab97df7e4bfc6fd9c82183eb9a1349078/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py?ref=1a6d98dab97df7e4bfc6fd9c82183eb9a1349078",
            "patch": "@@ -51,8 +51,6 @@ def _get_memcache_timeout(self, timeout):\n \n     def add(self, key, value, timeout=0, version=None):\n         key = self.make_key(key, version=version)\n-        if isinstance(value, unicode):\n-            value = value.encode('utf-8')\n         return self._cache.add(key, value, self._get_memcache_timeout(timeout))\n \n     def get(self, key, default=None, version=None):\n@@ -118,8 +116,6 @@ def set_many(self, data, timeout=0, version=None):\n         safe_data = {}\n         for key, value in data.items():\n             key = self.make_key(key, version=version)\n-            if isinstance(value, unicode):\n-                value = value.encode('utf-8')\n             safe_data[key] = value\n         self._cache.set_multi(safe_data, self._get_memcache_timeout(timeout))\n "
        },
        {
            "sha": "2832bcbdd94fa39271e238f0e5ef12be84b5d152",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/1a6d98dab97df7e4bfc6fd9c82183eb9a1349078/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/1a6d98dab97df7e4bfc6fd9c82183eb9a1349078/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=1a6d98dab97df7e4bfc6fd9c82183eb9a1349078",
            "patch": "@@ -317,20 +317,48 @@ def test_unicode(self):\n             u'Iñtërnâtiônàlizætiøn': u'Iñtërnâtiônàlizætiøn2',\n             u'ascii': {u'x' : 1 }\n             }\n+        # Test `set`\n         for (key, value) in stuff.items():\n             self.cache.set(key, value)\n             self.assertEqual(self.cache.get(key), value)\n \n+        # Test `add`\n+        for (key, value) in stuff.items():\n+            self.cache.delete(key)\n+            self.cache.add(key, value)\n+            self.assertEqual(self.cache.get(key), value)\n+\n+        # Test `set_many`\n+        for (key, value) in stuff.items():\n+            self.cache.delete(key)\n+        self.cache.set_many(stuff)\n+        for (key, value) in stuff.items():\n+            self.assertEqual(self.cache.get(key), value)\n+\n     def test_binary_string(self):\n         # Binary strings should be cachable\n         from zlib import compress, decompress\n         value = 'value_to_be_compressed'\n         compressed_value = compress(value)\n+\n+        # Test set\n         self.cache.set('binary1', compressed_value)\n         compressed_result = self.cache.get('binary1')\n         self.assertEqual(compressed_value, compressed_result)\n         self.assertEqual(value, decompress(compressed_result))\n \n+        # Test add\n+        self.cache.add('binary1-add', compressed_value)\n+        compressed_result = self.cache.get('binary1-add')\n+        self.assertEqual(compressed_value, compressed_result)\n+        self.assertEqual(value, decompress(compressed_result))\n+\n+        # Test set_many\n+        self.cache.set_many({'binary1-set_many': compressed_value})\n+        compressed_result = self.cache.get('binary1-set_many')\n+        self.assertEqual(compressed_value, compressed_result)\n+        self.assertEqual(value, decompress(compressed_result))\n+\n     def test_set_many(self):\n         # Multiple keys can be set using set_many\n         self.cache.set_many({\"key1\": \"spam\", \"key2\": \"eggs\"})"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 28,
        "deletions": 4
    }
}