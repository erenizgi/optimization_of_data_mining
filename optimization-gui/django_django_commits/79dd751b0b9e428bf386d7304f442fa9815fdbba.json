{
    "author": "claudep",
    "message": "Fixed #14315 -- Made memcached backend handle negative incr/decr values\n\nThanks Michael Manfre for the report and initial patch and\nTobias McNulty for the review.",
    "sha": "79dd751b0b9e428bf386d7304f442fa9815fdbba",
    "files": [
        {
            "sha": "2c3f1988472e7ddb620f7be0adc89b3541693a48",
            "filename": "django/core/cache/backends/memcached.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/79dd751b0b9e428bf386d7304f442fa9815fdbba/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "raw_url": "https://github.com/django/django/raw/79dd751b0b9e428bf386d7304f442fa9815fdbba/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py?ref=79dd751b0b9e428bf386d7304f442fa9815fdbba",
            "patch": "@@ -90,6 +90,9 @@ def close(self, **kwargs):\n \n     def incr(self, key, delta=1, version=None):\n         key = self.make_key(key, version=version)\n+        # memcached doesn't support a negative delta\n+        if delta < 0:\n+            return self._cache.decr(key, -delta)\n         try:\n             val = self._cache.incr(key, delta)\n \n@@ -105,6 +108,9 @@ def incr(self, key, delta=1, version=None):\n \n     def decr(self, key, delta=1, version=None):\n         key = self.make_key(key, version=version)\n+        # memcached doesn't support a negative delta\n+        if delta < 0:\n+            return self._cache.incr(key, -delta)\n         try:\n             val = self._cache.decr(key, delta)\n "
        },
        {
            "sha": "9960c01300bbeac0a5cf277b79fe91d3c3547af0",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/79dd751b0b9e428bf386d7304f442fa9815fdbba/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/79dd751b0b9e428bf386d7304f442fa9815fdbba/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=79dd751b0b9e428bf386d7304f442fa9815fdbba",
            "patch": "@@ -257,6 +257,7 @@ def test_incr(self):\n         self.assertEqual(self.cache.get('answer'), 42)\n         self.assertEqual(self.cache.incr('answer', 10), 52)\n         self.assertEqual(self.cache.get('answer'), 52)\n+        self.assertEqual(self.cache.incr('answer', -10), 42)\n         self.assertRaises(ValueError, self.cache.incr, 'does_not_exist')\n \n     def test_decr(self):\n@@ -266,6 +267,7 @@ def test_decr(self):\n         self.assertEqual(self.cache.get('answer'), 42)\n         self.assertEqual(self.cache.decr('answer', 10), 32)\n         self.assertEqual(self.cache.get('answer'), 32)\n+        self.assertEqual(self.cache.decr('answer', -10), 42)\n         self.assertRaises(ValueError, self.cache.decr, 'does_not_exist')\n \n     def test_data_types(self):"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 8,
        "deletions": 0
    }
}