{
    "author": "carljm",
    "message": "Fixed #19164 -- Fixed diffsettings command broken in fix for #18545.\n\nThanks Mario César for the report and draft patch.",
    "sha": "3541a10d492db6d1f509f3a50a024568c16c5229",
    "files": [
        {
            "sha": "1804c851bf29367db20aade2868e78e26a36e7f5",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/3541a10d492db6d1f509f3a50a024568c16c5229/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/3541a10d492db6d1f509f3a50a024568c16c5229/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=3541a10d492db6d1f509f3a50a024568c16c5229",
            "patch": "@@ -25,7 +25,7 @@ class LazySettings(LazyObject):\n     The user can manually configure settings prior to using them. Otherwise,\n     Django uses the settings module pointed to by DJANGO_SETTINGS_MODULE.\n     \"\"\"\n-    def _setup(self, name):\n+    def _setup(self, name=None):\n         \"\"\"\n         Load the settings module pointed to by the environment variable. This\n         is used the first time we need any settings at all, if the user has not\n@@ -36,11 +36,12 @@ def _setup(self, name):\n             if not settings_module: # If it's set but is an empty string.\n                 raise KeyError\n         except KeyError:\n+            desc = (\"setting %s\" % name) if name else \"settings\"\n             raise ImproperlyConfigured(\n-                \"Requested setting %s, but settings are not configured. \"\n+                \"Requested %s, but settings are not configured. \"\n                 \"You must either define the environment variable %s \"\n                 \"or call settings.configure() before accessing settings.\"\n-                % (name, ENVIRONMENT_VARIABLE))\n+                % (desc, ENVIRONMENT_VARIABLE))\n \n         self._wrapped = Settings(settings_module)\n         self._configure_logging()"
        },
        {
            "sha": "a5deba7fe1666314080dca22aeb602f518e6b3af",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/3541a10d492db6d1f509f3a50a024568c16c5229/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3541a10d492db6d1f509f3a50a024568c16c5229/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=3541a10d492db6d1f509f3a50a024568c16c5229",
            "patch": "@@ -1603,3 +1603,15 @@ def test_custom_project_template_with_non_ascii_templates(self):\n         with codecs.open(path, 'r', 'utf-8') as f:\n             self.assertEqual(f.read(),\n                 'Some non-ASCII text for testing ticket #18091:\\nüäö €\\n')\n+\n+\n+class DiffSettings(AdminScriptTestCase):\n+    \"\"\"Tests for diffsettings management command.\"\"\"\n+    def test_basic(self):\n+        \"Runs without error and emits settings diff.\"\n+        self.write_settings('settings_to_diff.py', sdict={'FOO': '\"bar\"'})\n+        args = ['diffsettings', '--settings=settings_to_diff']\n+        out, err = self.run_manage(args)\n+        self.remove_settings('settings_to_diff.py')\n+        self.assertNoOutput(err)\n+        self.assertOutput(out, \"FOO = 'bar'  ###\")"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 16,
        "deletions": 3
    }
}