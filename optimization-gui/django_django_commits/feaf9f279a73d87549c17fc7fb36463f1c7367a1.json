{
    "author": "timgraham",
    "message": "Fixed #15361 - Documented performance considerations for QuerySet.get()\n\nThanks mmcnickle for the patch.",
    "sha": "feaf9f279a73d87549c17fc7fb36463f1c7367a1",
    "files": [
        {
            "sha": "b5cca52e23e4ccaac86ddeaff3573cfc9974ded2",
            "filename": "docs/topics/db/optimization.txt",
            "status": "modified",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/feaf9f279a73d87549c17fc7fb36463f1c7367a1/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "raw_url": "https://github.com/django/django/raw/feaf9f279a73d87549c17fc7fb36463f1c7367a1/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Foptimization.txt?ref=feaf9f279a73d87549c17fc7fb36463f1c7367a1",
            "patch": "@@ -132,6 +132,41 @@ Write your own :doc:`custom SQL to retrieve data or populate models\n </topics/db/sql>`. Use ``django.db.connection.queries`` to find out what Django\n is writing for you and start from there.\n \n+Retrieve individual objects using a unique, indexed column\n+==========================================================\n+\n+There are two reasons to use a column with\n+:attr:`~django.db.models.Field.unique` or\n+:attr:`~django.db.models.Field.db_index` when using\n+:meth:`~django.db.models.query.QuerySet.get` to retrieve individual objects.\n+First, the query will be quicker because of the underlying database index.\n+Also, the query could run much slower if multiple objects match the lookup;\n+having a unique constraint on the column guarantees this will never happen.\n+\n+So using the :ref:`example Weblog models <queryset-model-example>`::\n+\n+  >>> entry = Entry.objects.get(id=10)\n+\n+will be quicker than:\n+\n+  >>> entry = Entry.object.get(headline=\"News Item Title\")\n+\n+because ``id`` is indexed by the database and is guaranteed to be unique.\n+\n+Doing the following is potentially quite slow:\n+\n+  >>> entry = Entry.objects.get(headline__startswith=\"News\")\n+\n+First of all, `headline` is not indexed, which will make the underlying\n+database fetch slower.\n+\n+Second, the lookup doesn't guarantee that only one object will be returned.\n+If the query matches more than one object, it will retrieve and transfer all of\n+them from the database. This penalty could be substantial if hundreds or\n+thousands of records are returned. The penalty will be compounded if the\n+database lives on a separate server, where network overhead and latency also\n+play a factor.\n+\n Retrieve everything at once if you know you will need it\n ========================================================\n "
        },
        {
            "sha": "1c83b980a73e21d3c700ca4f8192d3e5215bef8c",
            "filename": "tests/modeltests/basic/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/feaf9f279a73d87549c17fc7fb36463f1c7367a1/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/feaf9f279a73d87549c17fc7fb36463f1c7367a1/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbasic%2Ftests.py?ref=feaf9f279a73d87549c17fc7fb36463f1c7367a1",
            "patch": "@@ -2,7 +2,7 @@\n \n from datetime import datetime\n \n-from django.core.exceptions import ObjectDoesNotExist\n+from django.core.exceptions import ObjectDoesNotExist, MultipleObjectsReturned\n from django.db.models.fields import Field, FieldDoesNotExist\n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n from django.utils import six\n@@ -128,6 +128,40 @@ def test_lookup(self):\n         b = Article.objects.get(pk=a.id)\n         self.assertEqual(a, b)\n \n+        # Create a very similar object\n+        a = Article(\n+            id=None,\n+            headline='Area man programs in Python',\n+            pub_date=datetime(2005, 7, 28),\n+        )\n+        a.save()\n+\n+        self.assertEqual(Article.objects.count(), 2)\n+\n+        # Django raises an Article.MultipleObjectsReturned exception if the\n+        # lookup matches more than one object\n+        self.assertRaisesRegexp(\n+            MultipleObjectsReturned,\n+            \"get\\(\\) returned more than one Article -- it returned 2!\",\n+            Article.objects.get,\n+            headline__startswith='Area',\n+        )\n+\n+        self.assertRaisesRegexp(\n+            MultipleObjectsReturned,\n+            \"get\\(\\) returned more than one Article -- it returned 2!\",\n+            Article.objects.get,\n+            pub_date__year=2005,\n+        )\n+\n+        self.assertRaisesRegexp(\n+            MultipleObjectsReturned,\n+            \"get\\(\\) returned more than one Article -- it returned 2!\",\n+            Article.objects.get,\n+            pub_date__year=2005,\n+            pub_date__month=7,\n+        )\n+\n     def test_object_creation(self):\n         # Create an Article.\n         a = Article("
        }
    ],
    "stats": {
        "total": 71,
        "additions": 70,
        "deletions": 1
    }
}