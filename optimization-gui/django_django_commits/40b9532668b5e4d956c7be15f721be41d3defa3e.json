{
    "author": "aaugustin",
    "message": "Fixed #16753 -- Supported network-path references in the syndication framework. Thanks cato for the report and patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17108 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "40b9532668b5e4d956c7be15f721be41d3defa3e",
    "files": [
        {
            "sha": "2480ff6caa0575a4da273d669789e884f433e296",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/40b9532668b5e4d956c7be15f721be41d3defa3e/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/40b9532668b5e4d956c7be15f721be41d3defa3e/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=40b9532668b5e4d956c7be15f721be41d3defa3e",
            "patch": "@@ -9,15 +9,15 @@\n from django.utils.timezone import is_naive\n \n def add_domain(domain, url, secure=False):\n-    if not (url.startswith('http://')\n+    protocol = 'https' if secure else 'http'\n+    if url.startswith('//'):\n+        # Support network-path reference (see #16753) - RSS requires a protocol\n+        url = '%s:%s' % (protocol, url)\n+    elif not (url.startswith('http://')\n             or url.startswith('https://')\n             or url.startswith('mailto:')):\n         # 'url' must already be ASCII and URL-quoted, so no need for encoding\n         # conversions here.\n-        if secure:\n-            protocol = 'https'\n-        else:\n-            protocol = 'http'\n         url = iri_to_uri(u'%s://%s%s' % (protocol, domain, url))\n     return url\n "
        },
        {
            "sha": "95b4efb4f46df704f1b4caabce209165dff70f0a",
            "filename": "tests/regressiontests/syndication/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/40b9532668b5e4d956c7be15f721be41d3defa3e/tests%2Fregressiontests%2Fsyndication%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/40b9532668b5e4d956c7be15f721be41d3defa3e/tests%2Fregressiontests%2Fsyndication%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ftests.py?ref=40b9532668b5e4d956c7be15f721be41d3defa3e",
            "patch": "@@ -305,3 +305,7 @@ def test_add_domain(self):\n             views.add_domain('example.com', 'mailto:uhoh@djangoproject.com'),\n             'mailto:uhoh@djangoproject.com'\n         )\n+        self.assertEqual(\n+            views.add_domain('example.com', '//example.com/foo/?arg=value'),\n+            'http://example.com/foo/?arg=value'\n+        )"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 9,
        "deletions": 5
    }
}