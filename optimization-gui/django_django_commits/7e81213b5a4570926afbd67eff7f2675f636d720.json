{
    "author": "andrewgodwin",
    "message": "Add some state management methods to AppCache.",
    "sha": "7e81213b5a4570926afbd67eff7f2675f636d720",
    "files": [
        {
            "sha": "0ed6caffa424dd69483b6169877a7ea044e91d65",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/7e81213b5a4570926afbd67eff7f2675f636d720/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/7e81213b5a4570926afbd67eff7f2675f636d720/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=7e81213b5a4570926afbd67eff7f2675f636d720",
            "patch": "@@ -244,6 +244,37 @@ def register_models(self, app_label, *models):\n             model_dict[model_name] = model\n         self._get_models_cache.clear()\n \n+    def save_state(self):\n+        \"\"\"\n+        Returns an object that contains the current AppCache state.\n+        Can be provided to restore_state to undo actions.\n+        \"\"\"\n+        return {\n+            \"app_store\": SortedDict(self.app_store.items()),\n+            \"app_labels\": dict(self.app_errors.items()),\n+            \"app_models\": SortedDict(self.app_models.items()),\n+            \"app_errors\": dict(self.app_errors.items()),\n+        }\n+\n+    def restore_state(self, state):\n+        \"\"\"\n+        Restores the AppCache to a previous state from save_state.\n+        \"\"\"\n+        self.app_store = state['app_store']\n+        self.app_labels = state['app_labels']\n+        self.app_models = state['app_models']\n+        self.app_errors = state['app_errors']\n+\n+    def unregister_all(self):\n+        \"\"\"\n+        Wipes the AppCache clean of all registered models.\n+        Used for things like migration libraries' fake ORMs.\n+        \"\"\"\n+        self.app_store = SortedDict()\n+        self.app_labels = {}\n+        self.app_models = SortedDict()\n+        self.app_errors = {}\n+\n cache = AppCache()\n \n # These methods were always module level, so are kept that way for backwards"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 31,
        "deletions": 0
    }
}