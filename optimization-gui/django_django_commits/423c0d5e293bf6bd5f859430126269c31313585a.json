{
    "author": "aaugustin",
    "message": "Added a safety net for developers messing with autocommit.",
    "sha": "423c0d5e293bf6bd5f859430126269c31313585a",
    "files": [
        {
            "sha": "cb17e1db61c441e4d353f60b750773dde310b6f5",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/423c0d5e293bf6bd5f859430126269c31313585a/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/423c0d5e293bf6bd5f859430126269c31313585a/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=423c0d5e293bf6bd5f859430126269c31313585a",
            "patch": "@@ -417,12 +417,19 @@ def close_if_unusable_or_obsolete(self):\n         or if it outlived its maximum age.\n         \"\"\"\n         if self.connection is not None:\n+            # If the application didn't restore the original autocommit setting,\n+            # don't take chances, drop the connection.\n+            if self.autocommit != self.settings_dict['AUTOCOMMIT']:\n+                self.close()\n+                return\n+\n             if self.errors_occurred:\n                 if self.is_usable():\n                     self.errors_occurred = False\n                 else:\n                     self.close()\n                     return\n+\n             if self.close_at is not None and time.time() >= self.close_at:\n                 self.close()\n                 return"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}