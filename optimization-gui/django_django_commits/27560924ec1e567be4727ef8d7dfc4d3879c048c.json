{
    "author": "apollo13",
    "message": "Fixed a security issue in get_host.\n\nFull disclosure and new release forthcoming.",
    "sha": "27560924ec1e567be4727ef8d7dfc4d3879c048c",
    "files": [
        {
            "sha": "8f74bddb711e09e34e1042bb3476fefa47e93423",
            "filename": "django/http/request.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/27560924ec1e567be4727ef8d7dfc4d3879c048c/django%2Fhttp%2Frequest.py",
            "raw_url": "https://github.com/django/django/raw/27560924ec1e567be4727ef8d7dfc4d3879c048c/django%2Fhttp%2Frequest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Frequest.py?ref=27560924ec1e567be4727ef8d7dfc4d3879c048c",
            "patch": "@@ -25,6 +25,7 @@\n \n RAISE_ERROR = object()\n absolute_http_url_re = re.compile(r\"^https?://\", re.I)\n+host_validation_re = re.compile(r\"^([a-z0-9.-]+|\\[[a-f0-9]*:[a-f0-9:]+\\])(:\\d+)?$\")\n \n \n class UnreadablePostError(IOError):\n@@ -64,7 +65,7 @@ def get_host(self):\n                 host = '%s:%s' % (host, server_port)\n \n         # Disallow potentially poisoned hostnames.\n-        if set(';/?@&=+$,').intersection(host):\n+        if not host_validation_re.match(host.lower()):\n             raise SuspiciousOperation('Invalid HTTP_HOST header: %s' % host)\n \n         return host"
        },
        {
            "sha": "169f9ac7732508121dc63e3a0de857e07961df56",
            "filename": "docs/topics/security.txt",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/27560924ec1e567be4727ef8d7dfc4d3879c048c/docs%2Ftopics%2Fsecurity.txt",
            "raw_url": "https://github.com/django/django/raw/27560924ec1e567be4727ef8d7dfc4d3879c048c/docs%2Ftopics%2Fsecurity.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fsecurity.txt?ref=27560924ec1e567be4727ef8d7dfc4d3879c048c",
            "patch": "@@ -185,6 +185,31 @@ recommend you ensure your Web server is configured such that:\n Additionally, as of 1.3.1, Django requires you to explicitly enable support for\n the ``X-Forwarded-Host`` header if your configuration requires it.\n \n+Configuration for Apache\n+------------------------\n+\n+The easiest way to get the described behavior in Apache is as follows. Create\n+a `virtual host`_ using the ServerName_ and ServerAlias_ directives to restrict\n+the domains Apache reacts to. Please keep in mind that while the directives do\n+support ports the match is only performed against the hostname. This means that\n+the ``Host`` header could still contain a port pointing to another webserver on\n+the same machine. The next step is to make sure that your newly created virtual\n+host is not also the default virtual host. Apache uses the first virtual host\n+found in the configuration file as default virtual host.  As such you have to\n+ensure that you have another virtual host which will act as catch-all virtual\n+host. Just add one if you do not have one already, there is nothing special\n+about it aside from ensuring it is the first virtual host in the configuration\n+file. Debian/Ubuntu users usually don't have to take any action, since Apache\n+ships with a default virtual host in ``sites-available`` which is linked into\n+``sites-enabled`` as ``000-default`` and included from ``apache2.conf``. Just\n+make sure not to name your site ``000-abc``, since files are included in\n+alphabetical order.\n+\n+.. _virtual host: http://httpd.apache.org/docs/2.2/vhosts/\n+.. _ServerName: http://httpd.apache.org/docs/2.2/mod/core.html#servername\n+.. _ServerAlias: http://httpd.apache.org/docs/2.2/mod/core.html#serveralias\n+\n+\n .. _additional-security-topics:\n \n Additional security topics"
        },
        {
            "sha": "adf824dff7da1be12a824ae4902431f2fb80bb66",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/27560924ec1e567be4727ef8d7dfc4d3879c048c/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/27560924ec1e567be4727ef8d7dfc4d3879c048c/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=27560924ec1e567be4727ef8d7dfc4d3879c048c",
            "patch": "@@ -116,13 +116,15 @@ def test_http_get_host(self):\n             '12.34.56.78:443',\n             '[2001:19f0:feee::dead:beef:cafe]',\n             '[2001:19f0:feee::dead:beef:cafe]:8080',\n+            'xn--4ca9at.com', # Punnycode for öäü.com\n         ]\n \n         poisoned_hosts = [\n             'example.com@evil.tld',\n             'example.com:dr.frankenstein@evil.tld',\n-            'example.com:someone@somestie.com:80',\n-            'example.com:80/badpath'\n+            'example.com:dr.frankenstein@evil.tld:80',\n+            'example.com:80/badpath',\n+            'example.com: recovermypassword.com',\n         ]\n \n         for host in legit_hosts:\n@@ -186,13 +188,15 @@ def test_http_get_host_with_x_forwarded_host(self):\n             '12.34.56.78:443',\n             '[2001:19f0:feee::dead:beef:cafe]',\n             '[2001:19f0:feee::dead:beef:cafe]:8080',\n+            'xn--4ca9at.com', # Punnycode for öäü.com\n         ]\n \n         poisoned_hosts = [\n             'example.com@evil.tld',\n             'example.com:dr.frankenstein@evil.tld',\n             'example.com:dr.frankenstein@evil.tld:80',\n-            'example.com:80/badpath'\n+            'example.com:80/badpath',\n+            'example.com: recovermypassword.com',\n         ]\n \n         for host in legit_hosts:"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 34,
        "deletions": 4
    }
}