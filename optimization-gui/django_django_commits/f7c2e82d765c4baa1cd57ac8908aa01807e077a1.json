{
    "author": "aaugustin",
    "message": "[py3] Fixed middleware tests.\n\nRemoved several inappropriate .encode('utf-8') calls in the process.",
    "sha": "f7c2e82d765c4baa1cd57ac8908aa01807e077a1",
    "files": [
        {
            "sha": "eb66f2bbf3e0a8244e0d42967f81672e9de60239",
            "filename": "tests/regressiontests/middleware/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/f7c2e82d765c4baa1cd57ac8908aa01807e077a1/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f7c2e82d765c4baa1cd57ac8908aa01807e077a1/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmiddleware%2Ftests.py?ref=f7c2e82d765c4baa1cd57ac8908aa01807e077a1",
            "patch": "@@ -15,6 +15,7 @@\n from django.middleware.gzip import GZipMiddleware\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n+from django.utils import six\n from django.utils.six.moves import xrange\n \n \n@@ -507,9 +508,9 @@ class GZipMiddlewareTest(TestCase):\n     \"\"\"\n     Tests the GZip middleware.\n     \"\"\"\n-    short_string = \"This string is too short to be worth compressing.\"\n-    compressible_string = 'a' * 500\n-    uncompressible_string = ''.join(chr(random.randint(0, 255)) for _ in xrange(500))\n+    short_string = b\"This string is too short to be worth compressing.\"\n+    compressible_string = b'a' * 500\n+    uncompressible_string = b''.join(six.int2byte(random.randint(0, 255)) for _ in xrange(500))\n \n     def setUp(self):\n         self.req = HttpRequest()\n@@ -534,7 +535,7 @@ def test_compress_response(self):\n         Tests that compression is performed on responses with compressible content.\n         \"\"\"\n         r = GZipMiddleware().process_response(self.req, self.resp)\n-        self.assertEqual(self.decompress(r.content), self.compressible_string.encode('utf-8'))\n+        self.assertEqual(self.decompress(r.content), self.compressible_string)\n         self.assertEqual(r.get('Content-Encoding'), 'gzip')\n         self.assertEqual(r.get('Content-Length'), str(len(r.content)))\n \n@@ -545,7 +546,7 @@ def test_compress_non_200_response(self):\n         \"\"\"\n         self.resp.status_code = 404\n         r = GZipMiddleware().process_response(self.req, self.resp)\n-        self.assertEqual(self.decompress(r.content), self.compressible_string.encode('utf-8'))\n+        self.assertEqual(self.decompress(r.content), self.compressible_string)\n         self.assertEqual(r.get('Content-Encoding'), 'gzip')\n \n     def test_no_compress_short_response(self):\n@@ -573,7 +574,7 @@ def test_no_compress_ie_js_requests(self):\n         self.req.META['HTTP_USER_AGENT'] = 'Mozilla/4.0 (compatible; MSIE 5.00; Windows 98)'\n         self.resp['Content-Type'] = 'application/javascript; charset=UTF-8'\n         r = GZipMiddleware().process_response(self.req, self.resp)\n-        self.assertEqual(r.content, self.compressible_string.encode('utf-8'))\n+        self.assertEqual(r.content, self.compressible_string)\n         self.assertEqual(r.get('Content-Encoding'), None)\n \n     def test_no_compress_uncompressible_response(self):\n@@ -591,7 +592,7 @@ class ETagGZipMiddlewareTest(TestCase):\n     \"\"\"\n     Tests if the ETag middleware behaves correctly with GZip middleware.\n     \"\"\"\n-    compressible_string = 'a' * 500\n+    compressible_string = b'a' * 500\n \n     def setUp(self):\n         self.rf = RequestFactory()"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}