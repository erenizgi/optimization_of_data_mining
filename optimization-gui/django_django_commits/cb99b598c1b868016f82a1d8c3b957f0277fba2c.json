{
    "author": "jphalip",
    "message": "Fixed #11410 -- Moved the \"Groups\" field to the \"Permissions\" module in the `auth.User` admin form and modified the help texts for the `user_permissions` and `groups` model fields to reflect that change. Also did a little PEP8 cleanup and improved some docstrings while I was in the area. Thanks to benspaulding and Aymeric Augustin for the suggestions.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17325 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "cb99b598c1b868016f82a1d8c3b957f0277fba2c",
    "files": [
        {
            "sha": "5e9ac9d0a962a453d645a63e8b81a770bb3a2e13",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 18,
            "deletions": 9,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/cb99b598c1b868016f82a1d8c3b957f0277fba2c/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/cb99b598c1b868016f82a1d8c3b957f0277fba2c/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=cb99b598c1b868016f82a1d8c3b957f0277fba2c",
            "patch": "@@ -1,7 +1,8 @@\n from django.db import transaction\n from django.conf import settings\n from django.contrib import admin\n-from django.contrib.auth.forms import UserCreationForm, UserChangeForm, AdminPasswordChangeForm\n+from django.contrib.auth.forms import (UserCreationForm, UserChangeForm,\n+    AdminPasswordChangeForm)\n from django.contrib.auth.models import User, Group\n from django.contrib import messages\n from django.core.exceptions import PermissionDenied\n@@ -27,7 +28,8 @@ def formfield_for_manytomany(self, db_field, request=None, **kwargs):\n             # Avoid a major performance hit resolving permission names which\n             # triggers a content_type load:\n             kwargs['queryset'] = qs.select_related('content_type')\n-        return super(GroupAdmin, self).formfield_for_manytomany(db_field, request=request, **kwargs)\n+        return super(GroupAdmin, self).formfield_for_manytomany(\n+            db_field, request=request, **kwargs)\n \n \n class UserAdmin(admin.ModelAdmin):\n@@ -36,9 +38,9 @@ class UserAdmin(admin.ModelAdmin):\n     fieldsets = (\n         (None, {'fields': ('username', 'password')}),\n         (_('Personal info'), {'fields': ('first_name', 'last_name', 'email')}),\n-        (_('Permissions'), {'fields': ('is_active', 'is_staff', 'is_superuser', 'user_permissions')}),\n+        (_('Permissions'), {'fields': ('is_active', 'is_staff', 'is_superuser',\n+                                       'groups', 'user_permissions')}),\n         (_('Important dates'), {'fields': ('last_login', 'date_joined')}),\n-        (_('Groups'), {'fields': ('groups',)}),\n     )\n     add_fieldsets = (\n         (None, {\n@@ -76,7 +78,8 @@ def get_form(self, request, obj=None, **kwargs):\n     def get_urls(self):\n         from django.conf.urls import patterns\n         return patterns('',\n-            (r'^(\\d+)/password/$', self.admin_site.admin_view(self.user_change_password))\n+            (r'^(\\d+)/password/$',\n+             self.admin_site.admin_view(self.user_change_password))\n         ) + super(UserAdmin, self).get_urls()\n \n     @sensitive_post_parameters()\n@@ -93,7 +96,11 @@ def add_view(self, request, form_url='', extra_context=None):\n             if self.has_add_permission(request) and settings.DEBUG:\n                 # Raise Http404 in debug mode so that the user gets a helpful\n                 # error message.\n-                raise Http404('Your user does not have the \"Change user\" permission. In order to add users, Django requires that your user account have both the \"Add user\" and \"Change user\" permissions set.')\n+                raise Http404(\n+                    'Your user does not have the \"Change user\" permission. In '\n+                    'order to add users, Django requires that your user '\n+                    'account have both the \"Add user\" and \"Change user\" '\n+                    'permissions set.')\n             raise PermissionDenied\n         if extra_context is None:\n             extra_context = {}\n@@ -102,7 +109,8 @@ def add_view(self, request, form_url='', extra_context=None):\n             'username_help_text': self.model._meta.get_field('username').help_text,\n         }\n         extra_context.update(defaults)\n-        return super(UserAdmin, self).add_view(request, form_url, extra_context)\n+        return super(UserAdmin, self).add_view(request, form_url,\n+                                               extra_context)\n \n     @sensitive_post_parameters()\n     def user_change_password(self, request, id):\n@@ -112,7 +120,7 @@ def user_change_password(self, request, id):\n         if request.method == 'POST':\n             form = self.change_password_form(user, request.POST)\n             if form.is_valid():\n-                new_user = form.save()\n+                form.save()\n                 msg = ugettext('Password changed successfully.')\n                 messages.success(request, msg)\n                 return HttpResponseRedirect('..')\n@@ -155,7 +163,8 @@ def response_add(self, request, obj, post_url_continue='../%s/'):\n         # * We are adding a user in a popup\n         if '_addanother' not in request.POST and '_popup' not in request.POST:\n             request.POST['_continue'] = 1\n-        return super(UserAdmin, self).response_add(request, obj, post_url_continue)\n+        return super(UserAdmin, self).response_add(request, obj,\n+                                                   post_url_continue)\n \n admin.site.register(Group, GroupAdmin)\n admin.site.register(User, UserAdmin)"
        },
        {
            "sha": "8064a4eb34967e9897a9031e9c647372535549d3",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 95,
            "deletions": 49,
            "changes": 144,
            "blob_url": "https://github.com/django/django/blob/cb99b598c1b868016f82a1d8c3b957f0277fba2c/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/cb99b598c1b868016f82a1d8c3b957f0277fba2c/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=cb99b598c1b868016f82a1d8c3b957f0277fba2c",
            "patch": "@@ -16,6 +16,7 @@\n from django.contrib.auth.signals import user_logged_in\n from django.contrib.contenttypes.models import ContentType\n \n+\n def update_last_login(sender, user, **kwargs):\n     \"\"\"\n     A signal receiver which updates the last_login date for\n@@ -25,28 +26,42 @@ def update_last_login(sender, user, **kwargs):\n     user.save()\n user_logged_in.connect(update_last_login)\n \n+\n class SiteProfileNotAvailable(Exception):\n     pass\n \n+\n class PermissionManager(models.Manager):\n     def get_by_natural_key(self, codename, app_label, model):\n         return self.get(\n             codename=codename,\n-            content_type=ContentType.objects.get_by_natural_key(app_label, model),\n+            content_type=ContentType.objects.get_by_natural_key(app_label,\n+                                                                model),\n         )\n \n+\n class Permission(models.Model):\n-    \"\"\"The permissions system provides a way to assign permissions to specific users and groups of users.\n+    \"\"\"\n+    The permissions system provides a way to assign permissions to specific\n+    users and groups of users.\n \n-    The permission system is used by the Django admin site, but may also be useful in your own code. The Django admin site uses permissions as follows:\n+    The permission system is used by the Django admin site, but may also be\n+    useful in your own code. The Django admin site uses permissions as follows:\n \n-        - The \"add\" permission limits the user's ability to view the \"add\" form and add an object.\n-        - The \"change\" permission limits a user's ability to view the change list, view the \"change\" form and change an object.\n+        - The \"add\" permission limits the user's ability to view the \"add\" form\n+          and add an object.\n+        - The \"change\" permission limits a user's ability to view the change\n+          list, view the \"change\" form and change an object.\n         - The \"delete\" permission limits the ability to delete an object.\n \n-    Permissions are set globally per type of object, not per specific object instance. It is possible to say \"Mary may change news stories,\" but it's not currently possible to say \"Mary may change news stories, but only the ones she created herself\" or \"Mary may only change news stories that have a certain status or publication date.\"\n+    Permissions are set globally per type of object, not per specific object\n+    instance. It is possible to say \"Mary may change news stories,\" but it's\n+    not currently possible to say \"Mary may change news stories, but only the\n+    ones she created herself\" or \"Mary may only change news stories that have a\n+    certain status or publication date.\"\n \n-    Three basic permissions -- add, change and delete -- are automatically created for each Django model.\n+    Three basic permissions -- add, change and delete -- are automatically\n+    created for each Django model.\n     \"\"\"\n     name = models.CharField(_('name'), max_length=50)\n     content_type = models.ForeignKey(ContentType)\n@@ -57,7 +72,8 @@ class Meta:\n         verbose_name = _('permission')\n         verbose_name_plural = _('permissions')\n         unique_together = (('content_type', 'codename'),)\n-        ordering = ('content_type__app_label', 'content_type__model', 'codename')\n+        ordering = ('content_type__app_label', 'content_type__model',\n+                    'codename')\n \n     def __unicode__(self):\n         return u\"%s | %s | %s\" % (\n@@ -69,15 +85,27 @@ def natural_key(self):\n         return (self.codename,) + self.content_type.natural_key()\n     natural_key.dependencies = ['contenttypes.contenttype']\n \n-class Group(models.Model):\n-    \"\"\"Groups are a generic way of categorizing users to apply permissions, or some other label, to those users. A user can belong to any number of groups.\n \n-    A user in a group automatically has all the permissions granted to that group. For example, if the group Site editors has the permission can_edit_home_page, any user in that group will have that permission.\n-\n-    Beyond permissions, groups are a convenient way to categorize users to apply some label, or extended functionality, to them. For example, you could create a group 'Special users', and you could write code that would do special things to those users -- such as giving them access to a members-only portion of your site, or sending them members-only email messages.\n+class Group(models.Model):\n+    \"\"\"\n+    Groups are a generic way of categorizing users to apply permissions, or\n+    some other label, to those users. A user can belong to any number of\n+    groups.\n+\n+    A user in a group automatically has all the permissions granted to that\n+    group. For example, if the group Site editors has the permission\n+    can_edit_home_page, any user in that group will have that permission.\n+\n+    Beyond permissions, groups are a convenient way to categorize users to\n+    apply some label, or extended functionality, to them. For example, you\n+    could create a group 'Special users', and you could write code that would\n+    do special things to those users -- such as giving them access to a\n+    members-only portion of your site, or sending them members-only email\n+    messages.\n     \"\"\"\n     name = models.CharField(_('name'), max_length=80, unique=True)\n-    permissions = models.ManyToManyField(Permission, verbose_name=_('permissions'), blank=True)\n+    permissions = models.ManyToManyField(Permission,\n+        verbose_name=_('permissions'), blank=True)\n \n     class Meta:\n         verbose_name = _('group')\n@@ -86,6 +114,7 @@ class Meta:\n     def __unicode__(self):\n         return self.name\n \n+\n class UserManager(models.Manager):\n     def create_user(self, username, email=None, password=None):\n         \"\"\"\n@@ -119,13 +148,16 @@ def create_superuser(self, username, email, password):\n         u.save(using=self._db)\n         return u\n \n-    def make_random_password(self, length=10, allowed_chars='abcdefghjkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ23456789'):\n+    def make_random_password(self, length=10,\n+                             allowed_chars='abcdefghjkmnpqrstuvwxyz'\n+                                           'ABCDEFGHJKLMNPQRSTUVWXYZ'\n+                                           '23456789'):\n         \"\"\"\n-        Generates a random password with the given length\n-        and given allowed_chars\n+        Generates a random password with the given length and given\n+        allowed_chars. Note that the default value of allowed_chars does not\n+        have \"I\" or \"O\" or letters and digits that look similar -- just to\n+        avoid confusion.\n         \"\"\"\n-        # Note that default value of allowed_chars does not have \"I\" or letters\n-        # that look like it -- just to avoid confusion.\n         return get_random_string(length, allowed_chars)\n \n \n@@ -169,23 +201,36 @@ def _user_has_module_perms(user, app_label):\n \n class User(models.Model):\n     \"\"\"\n-    Users within the Django authentication system are represented by this model.\n+    Users within the Django authentication system are represented by this\n+    model.\n \n     Username and password are required. Other fields are optional.\n     \"\"\"\n-    username = models.CharField(_('username'), max_length=30, unique=True, help_text=_(\"Required. 30 characters or fewer. Letters, numbers and @/./+/-/_ characters\"))\n+    username = models.CharField(_('username'), max_length=30, unique=True,\n+        help_text=_('Required. 30 characters or fewer. Letters, numbers and '\n+                    '@/./+/-/_ characters'))\n     first_name = models.CharField(_('first name'), max_length=30, blank=True)\n     last_name = models.CharField(_('last name'), max_length=30, blank=True)\n     email = models.EmailField(_('e-mail address'), blank=True)\n     password = models.CharField(_('password'), max_length=128)\n-    is_staff = models.BooleanField(_('staff status'), default=False, help_text=_(\"Designates whether the user can log into this admin site.\"))\n-    is_active = models.BooleanField(_('active'), default=True, help_text=_(\"Designates whether this user should be treated as active. Unselect this instead of deleting accounts.\"))\n-    is_superuser = models.BooleanField(_('superuser status'), default=False, help_text=_(\"Designates that this user has all permissions without explicitly assigning them.\"))\n+    is_staff = models.BooleanField(_('staff status'), default=False,\n+        help_text=_('Designates whether the user can log into this admin '\n+                    'site.'))\n+    is_active = models.BooleanField(_('active'), default=True,\n+        help_text=_('Designates whether this user should be treated as '\n+                    'active. Unselect this instead of deleting accounts.'))\n+    is_superuser = models.BooleanField(_('superuser status'), default=False,\n+        help_text=_('Designates that this user has all permissions without '\n+                    'explicitly assigning them.'))\n     last_login = models.DateTimeField(_('last login'), default=timezone.now)\n     date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n-    groups = models.ManyToManyField(Group, verbose_name=_('groups'), blank=True,\n-        help_text=_(\"In addition to the permissions manually assigned, this user will also get all permissions granted to each group he/she is in.\"))\n-    user_permissions = models.ManyToManyField(Permission, verbose_name=_('user permissions'), blank=True)\n+    groups = models.ManyToManyField(Group, verbose_name=_('groups'),\n+        blank=True, help_text=_('The groups this user belongs to. A user will '\n+                                'get all permissions granted to each of '\n+                                'his/her group.'))\n+    user_permissions = models.ManyToManyField(Permission,\n+        verbose_name=_('user permissions'), blank=True,\n+        help_text='Specific permissions for this user.')\n     objects = UserManager()\n \n     class Meta:\n@@ -241,16 +286,16 @@ def has_usable_password(self):\n \n     def get_group_permissions(self, obj=None):\n         \"\"\"\n-        Returns a list of permission strings that this user has through\n-        his/her groups. This method queries all available auth backends.\n-        If an object is passed in, only permissions matching this object\n-        are returned.\n+        Returns a list of permission strings that this user has through his/her\n+        groups. This method queries all available auth backends. If an object\n+        is passed in, only permissions matching this object are returned.\n         \"\"\"\n         permissions = set()\n         for backend in auth.get_backends():\n             if hasattr(backend, \"get_group_permissions\"):\n                 if obj is not None:\n-                    permissions.update(backend.get_group_permissions(self, obj))\n+                    permissions.update(backend.get_group_permissions(self,\n+                                                                     obj))\n                 else:\n                     permissions.update(backend.get_group_permissions(self))\n         return permissions\n@@ -263,8 +308,8 @@ def has_perm(self, perm, obj=None):\n         Returns True if the user has the specified permission. This method\n         queries all available auth backends, but returns immediately if any\n         backend returns True. Thus, a user who has permission from a single\n-        auth backend is assumed to have permission in general. If an object\n-        is provided, permissions for this specific object are checked.\n+        auth backend is assumed to have permission in general. If an object is\n+        provided, permissions for this specific object are checked.\n         \"\"\"\n \n         # Active superusers have all permissions.\n@@ -276,9 +321,9 @@ def has_perm(self, perm, obj=None):\n \n     def has_perms(self, perm_list, obj=None):\n         \"\"\"\n-        Returns True if the user has each of the specified permissions.\n-        If object is passed, it checks if the user has all required perms\n-        for this object.\n+        Returns True if the user has each of the specified permissions. If\n+        object is passed, it checks if the user has all required perms for this\n+        object.\n         \"\"\"\n         for perm in perm_list:\n             if not self.has_perm(perm, obj):\n@@ -287,8 +332,8 @@ def has_perms(self, perm_list, obj=None):\n \n     def has_module_perms(self, app_label):\n         \"\"\"\n-        Returns True if the user has any permissions in the given app\n-        label. Uses pretty much the same logic as has_perm, above.\n+        Returns True if the user has any permissions in the given app label.\n+        Uses pretty much the same logic as has_perm, above.\n         \"\"\"\n         # Active superusers have all permissions.\n         if self.is_active and self.is_superuser:\n@@ -310,22 +355,23 @@ def get_profile(self):\n         if not hasattr(self, '_profile_cache'):\n             from django.conf import settings\n             if not getattr(settings, 'AUTH_PROFILE_MODULE', False):\n-                raise SiteProfileNotAvailable('You need to set AUTH_PROFILE_MO'\n-                                              'DULE in your project settings')\n+                raise SiteProfileNotAvailable(\n+                    'You need to set AUTH_PROFILE_MODULE in your project '\n+                    'settings')\n             try:\n                 app_label, model_name = settings.AUTH_PROFILE_MODULE.split('.')\n             except ValueError:\n-                raise SiteProfileNotAvailable('app_label and model_name should'\n-                        ' be separated by a dot in the AUTH_PROFILE_MODULE set'\n-                        'ting')\n-\n+                raise SiteProfileNotAvailable(\n+                    'app_label and model_name should be separated by a dot in '\n+                    'the AUTH_PROFILE_MODULE setting')\n             try:\n                 model = models.get_model(app_label, model_name)\n                 if model is None:\n-                    raise SiteProfileNotAvailable('Unable to load the profile '\n-                        'model, check AUTH_PROFILE_MODULE in your project sett'\n-                        'ings')\n-                self._profile_cache = model._default_manager.using(self._state.db).get(user__id__exact=self.id)\n+                    raise SiteProfileNotAvailable(\n+                        'Unable to load the profile model, check '\n+                        'AUTH_PROFILE_MODULE in your project settings')\n+                self._profile_cache = model._default_manager.using(\n+                                   self._state.db).get(user__id__exact=self.id)\n                 self._profile_cache.user = self\n             except (ImportError, ImproperlyConfigured):\n                 raise SiteProfileNotAvailable"
        }
    ],
    "stats": {
        "total": 171,
        "additions": 113,
        "deletions": 58
    }
}