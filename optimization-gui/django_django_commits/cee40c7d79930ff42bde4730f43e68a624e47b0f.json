{
    "author": "jphalip",
    "message": "Added further flexibility to ModelAdmin for controlling post-save redirections.\nRefs #19505.",
    "sha": "cee40c7d79930ff42bde4730f43e68a624e47b0f",
    "files": [
        {
            "sha": "8e0aaccc86f6e52c2ee7a2db9713cffc83887a82",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 20,
            "deletions": 7,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/cee40c7d79930ff42bde4730f43e68a624e47b0f/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/cee40c7d79930ff42bde4730f43e68a624e47b0f/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=cee40c7d79930ff42bde4730f43e68a624e47b0f",
            "patch": "@@ -1,6 +1,5 @@\n import copy\n from functools import update_wrapper, partial\n-import warnings\n \n from django import forms\n from django.conf import settings\n@@ -824,7 +823,7 @@ def response_add(self, request, obj, post_url_continue=None):\n         else:\n             msg = _('The %(name)s \"%(obj)s\" was added successfully.') % msg_dict\n             self.message_user(request, msg)\n-            return self.response_post_save(request, obj)\n+            return self.response_post_save_add(request, obj)\n \n     def response_change(self, request, obj):\n         \"\"\"\n@@ -858,13 +857,27 @@ def response_change(self, request, obj):\n         else:\n             msg = _('The %(name)s \"%(obj)s\" was changed successfully.') % msg_dict\n             self.message_user(request, msg)\n-            return self.response_post_save(request, obj)\n+            return self.response_post_save_change(request, obj)\n \n-    def response_post_save(self, request, obj):\n+    def response_post_save_add(self, request, obj):\n         \"\"\"\n-        Figure out where to redirect after the 'Save' button has been pressed.\n-        If the user has change permission, redirect to the change-list page for\n-        this object. Otherwise, redirect to the admin index.\n+        Figure out where to redirect after the 'Save' button has been pressed\n+        when adding a new object.\n+        \"\"\"\n+        opts = self.model._meta\n+        if self.has_change_permission(request, None):\n+            post_url = reverse('admin:%s_%s_changelist' %\n+                               (opts.app_label, opts.module_name),\n+                               current_app=self.admin_site.name)\n+        else:\n+            post_url = reverse('admin:index',\n+                               current_app=self.admin_site.name)\n+        return HttpResponseRedirect(post_url)\n+\n+    def response_post_save_change(self, request, obj):\n+        \"\"\"\n+        Figure out where to redirect after the 'Save' button has been pressed\n+        when editing an existing object.\n         \"\"\"\n         opts = self.model._meta\n         if self.has_change_permission(request, None):"
        },
        {
            "sha": "ef04c2aa09ce1574584d3411190ff6f387cc1ee8",
            "filename": "tests/regressiontests/admin_custom_urls/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/cee40c7d79930ff42bde4730f43e68a624e47b0f/tests%2Fregressiontests%2Fadmin_custom_urls%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/cee40c7d79930ff42bde4730f43e68a624e47b0f/tests%2Fregressiontests%2Fadmin_custom_urls%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Fmodels.py?ref=cee40c7d79930ff42bde4730f43e68a624e47b0f",
            "patch": "@@ -56,10 +56,14 @@ class Person(models.Model):\n \n class PersonAdmin(admin.ModelAdmin):\n \n-    def response_post_save(self, request, obj):\n+    def response_post_save_add(self, request, obj):\n         return HttpResponseRedirect(\n             reverse('admin:admin_custom_urls_person_history', args=[obj.pk]))\n \n+    def response_post_save_change(self, request, obj):\n+        return HttpResponseRedirect(\n+            reverse('admin:admin_custom_urls_person_delete', args=[obj.pk]))\n+\n \n class Car(models.Model):\n     name = models.CharField(max_length=20)"
        },
        {
            "sha": "31c93410f4cf5203502ae9a50ae017a38ca33df7",
            "filename": "tests/regressiontests/admin_custom_urls/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/cee40c7d79930ff42bde4730f43e68a624e47b0f/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/cee40c7d79930ff42bde4730f43e68a624e47b0f/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_custom_urls%2Ftests.py?ref=cee40c7d79930ff42bde4730f43e68a624e47b0f",
            "patch": "@@ -94,10 +94,11 @@ def setUp(self):\n     def tearDown(self):\n         self.client.logout()\n \n-    def test_post_save_redirect(self):\n+    def test_post_save_add_redirect(self):\n         \"\"\"\n-        Ensures that ModelAdmin.response_post_save() controls the redirection\n-        after the 'Save' button has been pressed.\n+        Ensures that ModelAdmin.response_post_save_add() controls the\n+        redirection after the 'Save' button has been pressed when adding a\n+        new object.\n         Refs 8001, 18310, 19505.\n         \"\"\"\n         post_data = { 'name': 'John Doe', }\n@@ -109,6 +110,22 @@ def test_post_save_redirect(self):\n         self.assertRedirects(\n             response, reverse('admin:admin_custom_urls_person_history', args=[persons[0].pk]))\n \n+    def test_post_save_change_redirect(self):\n+        \"\"\"\n+        Ensures that ModelAdmin.response_post_save_change() controls the\n+        redirection after the 'Save' button has been pressed when editing an\n+        existing object.\n+        Refs 8001, 18310, 19505.\n+        \"\"\"\n+        Person.objects.create(name='John Doe')\n+        self.assertEqual(Person.objects.count(), 1)\n+        person = Person.objects.all()[0]\n+        post_data = { 'name': 'Jack Doe', }\n+        response = self.client.post(\n+            reverse('admin:admin_custom_urls_person_change', args=[person.pk]), post_data)\n+        self.assertRedirects(\n+            response, reverse('admin:admin_custom_urls_person_delete', args=[person.pk]))\n+\n     def test_post_url_continue(self):\n         \"\"\"\n         Ensures that the ModelAdmin.response_add()'s parameter `post_url_continue`"
        }
    ],
    "stats": {
        "total": 56,
        "additions": 45,
        "deletions": 11
    }
}