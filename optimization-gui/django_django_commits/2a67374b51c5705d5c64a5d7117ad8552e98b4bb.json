{
    "author": "claudep",
    "message": "Fixed #19036 -- Fixed base64 uploads decoding\n\nThanks anthony at adsorbtion.org for the report, and johannesl for\nbringing the patch up-to-date.",
    "sha": "2a67374b51c5705d5c64a5d7117ad8552e98b4bb",
    "files": [
        {
            "sha": "edf98f6e49490f4859b307708e05c3f9f704ceb1",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/2a67374b51c5705d5c64a5d7117ad8552e98b4bb/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/2a67374b51c5705d5c64a5d7117ad8552e98b4bb/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=2a67374b51c5705d5c64a5d7117ad8552e98b4bb",
            "patch": "@@ -199,6 +199,12 @@ def parse(self):\n                         for chunk in field_stream:\n                             if transfer_encoding == 'base64':\n                                 # We only special-case base64 transfer encoding\n+                                # We should always read base64 streams by multiple of 4\n+                                over_bytes = len(chunk) % 4\n+                                if over_bytes:\n+                                    over_chunk = field_stream.read(4 - over_bytes)\n+                                    chunk += over_chunk\n+\n                                 try:\n                                     chunk = base64.b64decode(chunk)\n                                 except Exception as e:"
        },
        {
            "sha": "45e7342abdad8ce77c8b5b3404d1a4011fc223bb",
            "filename": "tests/regressiontests/file_uploads/tests.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/2a67374b51c5705d5c64a5d7117ad8552e98b4bb/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2a67374b51c5705d5c64a5d7117ad8552e98b4bb/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py?ref=2a67374b51c5705d5c64a5d7117ad8552e98b4bb",
            "patch": "@@ -74,15 +74,14 @@ def test_large_upload(self):\n \n         self.assertEqual(response.status_code, 200)\n \n-    def test_base64_upload(self):\n-        test_string = \"This data will be transmitted base64-encoded.\"\n+    def _test_base64_upload(self, content):\n         payload = client.FakePayload(\"\\r\\n\".join([\n             '--' + client.BOUNDARY,\n             'Content-Disposition: form-data; name=\"file\"; filename=\"test.txt\"',\n             'Content-Type: application/octet-stream',\n             'Content-Transfer-Encoding: base64',\n             '',]))\n-        payload.write(b\"\\r\\n\" + base64.b64encode(force_bytes(test_string)) + b\"\\r\\n\")\n+        payload.write(b\"\\r\\n\" + base64.b64encode(force_bytes(content)) + b\"\\r\\n\")\n         payload.write('--' + client.BOUNDARY + '--\\r\\n')\n         r = {\n             'CONTENT_LENGTH': len(payload),\n@@ -94,7 +93,13 @@ def test_base64_upload(self):\n         response = self.client.request(**r)\n         received = json.loads(response.content.decode('utf-8'))\n \n-        self.assertEqual(received['file'], test_string)\n+        self.assertEqual(received['file'], content)\n+\n+    def test_base64_upload(self):\n+        self._test_base64_upload(\"This data will be transmitted base64-encoded.\")\n+\n+    def test_big_base64_upload(self):\n+        self._test_base64_upload(\"Big data\" * 68000)  # > 512Kb\n \n     def test_unicode_file_name(self):\n         tdir = sys_tempfile.mkdtemp()"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 15,
        "deletions": 4
    }
}