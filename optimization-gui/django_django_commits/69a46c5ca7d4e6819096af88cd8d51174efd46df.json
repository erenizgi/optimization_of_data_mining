{
    "author": "akaariai",
    "message": "Tests for various emptyqs tickets\n\nThe tickets are either about different signature between qs.none() and\nqs or problems with subclass types (either EmptyQS overrided the custom\nqs class, or EmptyQS was overridden by another class - values() did\nthis).\n\nFixed #15959, fixed #17271, fixed #17712, fixed #19426",
    "sha": "69a46c5ca7d4e6819096af88cd8d51174efd46df",
    "files": [
        {
            "sha": "42375ceed90686bb7c9d210b4a535e51116b01cc",
            "filename": "tests/modeltests/basic/tests.py",
            "status": "modified",
            "additions": 41,
            "deletions": 1,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/69a46c5ca7d4e6819096af88cd8d51174efd46df/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/69a46c5ca7d4e6819096af88cd8d51174efd46df/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbasic%2Ftests.py?ref=69a46c5ca7d4e6819096af88cd8d51174efd46df",
            "patch": "@@ -4,7 +4,7 @@\n \n from django.core.exceptions import ObjectDoesNotExist, MultipleObjectsReturned\n from django.db.models.fields import Field, FieldDoesNotExist\n-from django.db.models.query import EmptyQuerySet\n+from django.db.models.query import QuerySet, EmptyQuerySet, ValuesListQuerySet\n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n from django.utils import six\n from django.utils.translation import ugettext_lazy\n@@ -646,3 +646,43 @@ def test_emptyqs(self):\n         with self.assertRaises(TypeError):\n             EmptyQuerySet()\n         self.assertTrue(isinstance(Article.objects.none(), EmptyQuerySet))\n+\n+    def test_emptyqs_values(self):\n+        # test for #15959\n+        Article.objects.create(headline='foo', pub_date=datetime.now())\n+        with self.assertNumQueries(0):\n+            qs = Article.objects.none().values_list('pk')\n+            self.assertTrue(isinstance(qs, EmptyQuerySet))\n+            self.assertTrue(isinstance(qs, ValuesListQuerySet))\n+            self.assertEqual(len(qs), 0)\n+\n+    def test_emptyqs_customqs(self):\n+        # A hacky test for custom QuerySet subclass - refs #17271\n+        Article.objects.create(headline='foo', pub_date=datetime.now())\n+        class CustomQuerySet(QuerySet):\n+            def do_something(self):\n+                return 'did something'\n+\n+        qs = Article.objects.all()\n+        qs.__class__ = CustomQuerySet\n+        qs = qs.none()\n+        with self.assertNumQueries(0):\n+            self.assertEqual(len(qs), 0)\n+            self.assertTrue(isinstance(qs, EmptyQuerySet))\n+            self.assertEqual(qs.do_something(), 'did something')\n+\n+    def test_emptyqs_values_order(self):\n+        # Tests for ticket #17712\n+        Article.objects.create(headline='foo', pub_date=datetime.now())\n+        with self.assertNumQueries(0):\n+            self.assertEqual(len(Article.objects.none().values_list('id').order_by('id')), 0)\n+        with self.assertNumQueries(0):\n+            self.assertEqual(len(Article.objects.none().filter(\n+                id__in=Article.objects.values_list('id', flat=True))), 0)\n+\n+    @skipUnlessDBFeature('can_distinct_on_fields')\n+    def test_emptyqs_distinct(self):\n+        # Tests for #19426\n+        Article.objects.create(headline='foo', pub_date=datetime.now())\n+        with self.assertNumQueries(0):\n+            self.assertEqual(len(Article.objects.none().distinct('headline', 'pub_date')), 0)"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 41,
        "deletions": 1
    }
}