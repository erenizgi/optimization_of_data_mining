{
    "author": "kmtracey",
    "message": "Refs #17876: enhanced new test to actually test underlying function, not just ensure trying to use it does not raise an exception. Thanks Przemek Lewandowski.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17695 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d174216587197dcc6c4c9abcacb8e428a1f078bf",
    "files": [
        {
            "sha": "09138293af647e7626acb32191104ab46436fdb4",
            "filename": "tests/modeltests/defer/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/d174216587197dcc6c4c9abcacb8e428a1f078bf/tests%2Fmodeltests%2Fdefer%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d174216587197dcc6c4c9abcacb8e428a1f078bf/tests%2Fmodeltests%2Fdefer%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdefer%2Ftests.py?ref=d174216587197dcc6c4c9abcacb8e428a1f078bf",
            "patch": "@@ -146,6 +146,15 @@ def test_defer(self):\n         obj.save()\n \n     def test_defer_proxy(self):\n-        # using select related and only should not result in Exception\n-        for obj in ChildProxy.objects.all().select_related().only('id'):\n-            continue\n+        \"\"\"\n+        Ensure select_related together with only on a proxy model behaves\n+        as expected. See #17876.\n+        \"\"\"\n+        related = Secondary.objects.create(first='x1', second='x2')\n+        ChildProxy.objects.create(name='p1', value='xx', related=related)\n+        children = ChildProxy.objects.all().select_related().only('id', 'name')\n+        self.assertEqual(len(children), 1)\n+        child = children[0]\n+        self.assert_delayed(child, 1)\n+        self.assertEqual(child.name, 'p1')\n+        self.assertEqual(child.value, 'xx')"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 12,
        "deletions": 3
    }
}