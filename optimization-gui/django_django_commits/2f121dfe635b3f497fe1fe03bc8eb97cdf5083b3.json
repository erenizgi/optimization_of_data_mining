{
    "author": "claudep",
    "message": "Fixed #17051 -- Removed some 'invalid' field error messages\n\nWhen the 'invalid' error message is set at field level, it masks\nthe error message raised by the validator, if any.",
    "sha": "2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
    "files": [
        {
            "sha": "2c8f6e4faf9085e61d14d7dee2286cf3b51a41fd",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -7,7 +7,7 @@\n     ReadOnlyPasswordHashField, ReadOnlyPasswordHashWidget)\n from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.core import mail\n-from django.forms.fields import Field, EmailField, CharField\n+from django.forms.fields import Field, CharField\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils.encoding import force_text\n@@ -322,8 +322,7 @@ def test_invalid_email(self):\n         data = {'email': 'not valid'}\n         form = PasswordResetForm(data)\n         self.assertFalse(form.is_valid())\n-        self.assertEqual(form['email'].errors,\n-                         [force_text(EmailField.default_error_messages['invalid'])])\n+        self.assertEqual(form['email'].errors, [_('Enter a valid email address.')])\n \n     def test_nonexistant_email(self):\n         # Test nonexistant email address. This should not fail because it would"
        },
        {
            "sha": "d0b713be323ffccacfe341c13edfa09ae87c579e",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -80,7 +80,7 @@ def validate_integer(value):\n \n \n class EmailValidator(object):\n-    message = _('Enter a valid e-mail address.')\n+    message = _('Enter a valid email address.')\n     code = 'invalid'\n     user_regex = re.compile(\n         r\"(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*$\"  # dot-atom"
        },
        {
            "sha": "11b7f44029918e46bd3692f65546f1377d3c9b3b",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 4,
            "deletions": 20,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -49,9 +49,10 @@ class Field(object):\n     widget = TextInput # Default widget to use when rendering this type of Field.\n     hidden_widget = HiddenInput # Default widget to use when rendering this as \"hidden\".\n     default_validators = [] # Default set of validators\n+    # Add an 'invalid' entry to default_error_message if you want a specific\n+    # field error message not raised by the field validators.\n     default_error_messages = {\n         'required': _('This field is required.'),\n-        'invalid': _('Enter a valid value.'),\n     }\n     empty_values = list(validators.EMPTY_VALUES)\n \n@@ -225,8 +226,6 @@ def widget_attrs(self, widget):\n class IntegerField(Field):\n     default_error_messages = {\n         'invalid': _('Enter a whole number.'),\n-        'max_value': _('Ensure this value is less than or equal to %(limit_value)s.'),\n-        'min_value': _('Ensure this value is greater than or equal to %(limit_value)s.'),\n     }\n \n     def __init__(self, max_value=None, min_value=None, *args, **kwargs):\n@@ -504,9 +503,6 @@ def _set_regex(self, regex):\n \n class EmailField(CharField):\n     widget = EmailInput\n-    default_error_messages = {\n-        'invalid': _('Enter a valid email address.'),\n-    }\n     default_validators = [validators.validate_email]\n \n     def clean(self, value):\n@@ -1082,9 +1078,6 @@ def compress(self, data_list):\n \n \n class IPAddressField(CharField):\n-    default_error_messages = {\n-        'invalid': _('Enter a valid IPv4 address.'),\n-    }\n     default_validators = [validators.validate_ipv4_address]\n \n     def to_python(self, value):\n@@ -1094,28 +1087,19 @@ def to_python(self, value):\n \n \n class GenericIPAddressField(CharField):\n-    default_error_messages = {}\n-\n     def __init__(self, protocol='both', unpack_ipv4=False, *args, **kwargs):\n         self.unpack_ipv4 = unpack_ipv4\n-        self.default_validators, invalid_error_message = \\\n-            validators.ip_address_validators(protocol, unpack_ipv4)\n-        self.default_error_messages['invalid'] = invalid_error_message\n+        self.default_validators = validators.ip_address_validators(protocol, unpack_ipv4)[0]\n         super(GenericIPAddressField, self).__init__(*args, **kwargs)\n \n     def to_python(self, value):\n         if value in self.empty_values:\n             return ''\n         value = value.strip()\n         if value and ':' in value:\n-            return clean_ipv6_address(value,\n-                self.unpack_ipv4, self.error_messages['invalid'])\n+            return clean_ipv6_address(value, self.unpack_ipv4)\n         return value\n \n \n class SlugField(CharField):\n-    default_error_messages = {\n-        'invalid': _(\"Enter a valid 'slug' consisting of letters, numbers,\"\n-                     \" underscores or hyphens.\"),\n-    }\n     default_validators = [validators.validate_slug]"
        },
        {
            "sha": "8881574eaa66c690e8f377077c23cc92de069f17",
            "filename": "django/utils/ipv6.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Futils%2Fipv6.py",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/django%2Futils%2Fipv6.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fipv6.py?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -5,7 +5,7 @@\n from django.utils.six.moves import xrange\n \n def clean_ipv6_address(ip_str, unpack_ipv4=False,\n-        error_message=\"This is not a valid IPv6 address\"):\n+        error_message=\"This is not a valid IPv6 address.\"):\n     \"\"\"\n     Cleans a IPv6 address string.\n "
        },
        {
            "sha": "978c985b552ba5a508842f1f29ca42c4fb793b44",
            "filename": "docs/ref/forms/validation.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 12,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/docs%2Fref%2Fforms%2Fvalidation.txt",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/docs%2Fref%2Fforms%2Fvalidation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fvalidation.txt?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -181,24 +181,20 @@ the field's ``validators`` argument, or defined on the Field class itself with\n the ``default_validators`` attribute.\n \n Simple validators can be used to validate values inside the field, let's have\n-a look at Django's ``EmailField``::\n+a look at Django's ``SlugField``::\n \n-    class EmailField(CharField):\n-        default_error_messages = {\n-            'invalid': _('Enter a valid email address.'),\n-        }\n-        default_validators = [validators.validate_email]\n+    class SlugField(CharField):\n+        default_validators = [validators.validate_slug]\n \n-As you can see, ``EmailField`` is just a ``CharField`` with customized error\n-message and a validator that validates email addresses. This can also be done\n-on field definition so::\n+As you can see, ``SlugField`` is just a ``CharField`` with a customized\n+validator that validates that submitted text obeys to some character rules.\n+This can also be done on field definition so::\n \n-    email = forms.EmailField()\n+    slug = forms.SlugField()\n \n is equivalent to::\n \n-    email = forms.CharField(validators=[validators.validate_email],\n-            error_messages={'invalid': _('Enter a valid email address.')})\n+    slug = forms.CharField(validators=[validators.validate_slug])\n \n \n Form field default cleaning"
        },
        {
            "sha": "427d099bb2628b06f3ed7a6f0e31ce2558083c7c",
            "filename": "tests/forms_tests/tests/extra.py",
            "status": "modified",
            "additions": 15,
            "deletions": 15,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/tests%2Fforms_tests%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/tests%2Fforms_tests%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fforms_tests%2Ftests%2Fextra.py?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -506,11 +506,11 @@ def test_generic_ipaddress_as_generic(self):\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '256.125.1.5')\n         self.assertEqual(f.clean(' fe80::223:6cff:fe8a:2e8a '), 'fe80::223:6cff:fe8a:2e8a')\n         self.assertEqual(f.clean(' 2a02::223:6cff:fe8a:2e8a '), '2a02::223:6cff:fe8a:2e8a')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '12345:2:3:4')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1::2:3::4')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1::2:3:4:5:6:7:8')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1:2')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '12345:2:3:4')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1::2:3::4')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1::2:3:4:5:6:7:8')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1:2')\n \n     def test_generic_ipaddress_as_ipv4_only(self):\n         f = GenericIPAddressField(protocol=\"IPv4\")\n@@ -535,11 +535,11 @@ def test_generic_ipaddress_as_ipv6_only(self):\n         self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '256.125.1.5')\n         self.assertEqual(f.clean(' fe80::223:6cff:fe8a:2e8a '), 'fe80::223:6cff:fe8a:2e8a')\n         self.assertEqual(f.clean(' 2a02::223:6cff:fe8a:2e8a '), '2a02::223:6cff:fe8a:2e8a')\n-        self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '12345:2:3:4')\n-        self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '1::2:3::4')\n-        self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n-        self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '1::2:3:4:5:6:7:8')\n-        self.assertFormErrors(['Enter a valid IPv6 address.'], f.clean, '1:2')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '12345:2:3:4')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1::2:3::4')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1::2:3:4:5:6:7:8')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1:2')\n \n     def test_generic_ipaddress_as_generic_not_required(self):\n         f = GenericIPAddressField(required=False)\n@@ -552,11 +552,11 @@ def test_generic_ipaddress_as_generic_not_required(self):\n         self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '256.125.1.5')\n         self.assertEqual(f.clean(' fe80::223:6cff:fe8a:2e8a '), 'fe80::223:6cff:fe8a:2e8a')\n         self.assertEqual(f.clean(' 2a02::223:6cff:fe8a:2e8a '), '2a02::223:6cff:fe8a:2e8a')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '12345:2:3:4')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1::2:3::4')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1::2:3:4:5:6:7:8')\n-        self.assertFormErrors(['Enter a valid IPv4 or IPv6 address.'], f.clean, '1:2')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '12345:2:3:4')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1::2:3::4')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, 'foo::223:6cff:fe8a:2e8a')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1::2:3:4:5:6:7:8')\n+        self.assertFormErrors(['This is not a valid IPv6 address.'], f.clean, '1:2')\n \n     def test_generic_ipaddress_normalization(self):\n         # Test the normalising code"
        },
        {
            "sha": "0598835cffdddb6c10da4b4c88f95726c9c27de0",
            "filename": "tests/forms_tests/tests/validators.py",
            "status": "modified",
            "additions": 28,
            "deletions": 5,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/tests%2Fforms_tests%2Ftests%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3/tests%2Fforms_tests%2Ftests%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fforms_tests%2Ftests%2Fvalidators.py?ref=2f121dfe635b3f497fe1fe03bc8eb97cdf5083b3",
            "patch": "@@ -1,16 +1,39 @@\n+from __future__ import unicode_literals\n+\n from django import forms\n from django.core import validators\n from django.core.exceptions import ValidationError\n from django.utils.unittest import TestCase\n \n \n+class UserForm(forms.Form):\n+    full_name = forms.CharField(\n+        max_length = 50,\n+        validators = [\n+            validators.validate_integer,\n+            validators.validate_email,\n+        ]\n+    )\n+    string = forms.CharField(\n+        max_length = 50,\n+        validators = [\n+            validators.RegexValidator(\n+                regex='^[a-zA-Z]*$',\n+                message=\"Letters only.\",\n+            )\n+        ]\n+    )\n+\n+\n class TestFieldWithValidators(TestCase):\n     def test_all_errors_get_reported(self):\n-        field = forms.CharField(\n-            validators=[validators.validate_integer, validators.validate_email]\n-        )\n-        self.assertRaises(ValidationError, field.clean, 'not int nor mail')\n+        form = UserForm({'full_name': 'not int nor mail', 'string': '2 is not correct'})\n+        self.assertRaises(ValidationError, form.fields['full_name'].clean, 'not int nor mail')\n+\n         try:\n-            field.clean('not int nor mail')\n+            form.fields['full_name'].clean('not int nor mail')\n         except ValidationError as e:\n             self.assertEqual(2, len(e.messages))\n+\n+        self.assertFalse(form.is_valid())\n+        self.assertEqual(form.errors['string'], [\"Letters only.\"])"
        }
    ],
    "stats": {
        "total": 116,
        "additions": 59,
        "deletions": 57
    }
}