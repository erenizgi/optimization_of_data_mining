{
    "author": "claudep",
    "message": "Fixed #18575 -- Empty DATABASES should default to dummy backend\n\nThanks delormemarco@gmail.com for the report.",
    "sha": "f1cc2be0c53858b673afc3b26347d3bb25e424f6",
    "files": [
        {
            "sha": "84296c74936507e0ca258e2ce7facb05b6f61b28",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/f1cc2be0c53858b673afc3b26347d3bb25e424f6/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/f1cc2be0c53858b673afc3b26347d3bb25e424f6/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=f1cc2be0c53858b673afc3b26347d3bb25e424f6",
            "patch": "@@ -150,12 +150,8 @@\n # Whether to send broken-link emails.\n SEND_BROKEN_LINK_EMAILS = False\n \n-# Database connection info.\n-DATABASES = {\n-    'default': {\n-        'ENGINE': 'django.db.backends.dummy',\n-    },\n-}\n+# Database connection info. If left empty, will default to the dummy backend.\n+DATABASES = {}\n \n # Classes used to implement DB routing behavior.\n DATABASE_ROUTERS = []"
        },
        {
            "sha": "b1980488df69ad292cdabea54339a18d8baa9f39",
            "filename": "django/db/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/f1cc2be0c53858b673afc3b26347d3bb25e424f6/django%2Fdb%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/f1cc2be0c53858b673afc3b26347d3bb25e424f6/django%2Fdb%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2F__init__.py?ref=f1cc2be0c53858b673afc3b26347d3bb25e424f6",
            "patch": "@@ -8,7 +8,7 @@\n     'IntegrityError', 'DEFAULT_DB_ALIAS')\n \n \n-if DEFAULT_DB_ALIAS not in settings.DATABASES:\n+if settings.DATABASES and DEFAULT_DB_ALIAS not in settings.DATABASES:\n     raise ImproperlyConfigured(\"You must define a '%s' database\" % DEFAULT_DB_ALIAS)\n \n connections = ConnectionHandler(settings.DATABASES)"
        },
        {
            "sha": "a91298626b5c89634ae4d34493de89a8c3fc5a7c",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/f1cc2be0c53858b673afc3b26347d3bb25e424f6/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/f1cc2be0c53858b673afc3b26347d3bb25e424f6/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=f1cc2be0c53858b673afc3b26347d3bb25e424f6",
            "patch": "@@ -53,7 +53,14 @@ class ConnectionDoesNotExist(Exception):\n \n class ConnectionHandler(object):\n     def __init__(self, databases):\n-        self.databases = databases\n+        if not databases:\n+            self.databases = {\n+                DEFAULT_DB_ALIAS: {\n+                    'ENGINE': 'django.db.backends.dummy',\n+                },\n+            }\n+        else:\n+            self.databases = databases\n         self._connections = local()\n \n     def ensure_defaults(self, alias):"
        },
        {
            "sha": "14b3e0053ca5c1e3ac00cc218a3d594e5b1d0fe5",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/f1cc2be0c53858b673afc3b26347d3bb25e424f6/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f1cc2be0c53858b673afc3b26347d3bb25e424f6/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=f1cc2be0c53858b673afc3b26347d3bb25e424f6",
            "patch": "@@ -23,6 +23,17 @@\n from . import models\n \n \n+class DummyBackendTest(TestCase):\n+    def test_no_databases(self):\n+        \"\"\"\n+        Test that empty DATABASES setting default to the dummy backend.\n+        \"\"\"\n+        DATABASES = {}\n+        conns = ConnectionHandler(DATABASES)\n+        self.assertEqual(conns[DEFAULT_DB_ALIAS].settings_dict['ENGINE'],\n+            'django.db.backends.dummy')\n+\n+\n class OracleChecks(unittest.TestCase):\n \n     @unittest.skipUnless(connection.vendor == 'oracle',"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 22,
        "deletions": 8
    }
}