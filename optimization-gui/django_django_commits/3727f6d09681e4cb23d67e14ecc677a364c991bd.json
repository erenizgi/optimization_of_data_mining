{
    "author": "jezdez",
    "message": "Fixed #18430 -- Use the FILE_CHARSET setting when reading from a file during post processing with the cached staticfiles storage. Thanks to Brant Young for initial debugging.",
    "sha": "3727f6d09681e4cb23d67e14ecc677a364c991bd",
    "files": [
        {
            "sha": "16d33fff4b1e582ee23d5e15cdf4490413202a87",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/3727f6d09681e4cb23d67e14ecc677a364c991bd/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/3727f6d09681e4cb23d67e14ecc677a364c991bd/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=3727f6d09681e4cb23d67e14ecc677a364c991bd",
            "patch": "@@ -228,7 +228,7 @@ def post_process(self, paths, dry_run=False, **options):\n \n                 # ..to apply each replacement pattern to the content\n                 if name in adjustable_paths:\n-                    content = original_file.read()\n+                    content = original_file.read().decode(settings.FILE_CHARSET)\n                     converter = self.url_converter(name)\n                     for patterns in self._patterns.values():\n                         for pattern in patterns:"
        },
        {
            "sha": "a5358f6edeaa3170fe8b90b99462d202dc45ff3e",
            "filename": "tests/regressiontests/staticfiles_tests/apps/test/static/test/nonascii.css",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/3727f6d09681e4cb23d67e14ecc677a364c991bd/tests%2Fregressiontests%2Fstaticfiles_tests%2Fapps%2Ftest%2Fstatic%2Ftest%2Fnonascii.css",
            "raw_url": "https://github.com/django/django/raw/3727f6d09681e4cb23d67e14ecc677a364c991bd/tests%2Fregressiontests%2Fstaticfiles_tests%2Fapps%2Ftest%2Fstatic%2Ftest%2Fnonascii.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Fapps%2Ftest%2Fstatic%2Ftest%2Fnonascii.css?ref=3727f6d09681e4cb23d67e14ecc677a364c991bd",
            "patch": "@@ -0,0 +1,5 @@\n+body {\n+  background: url('window.png');\n+}\n+\n+.snowman:before { content: \"â˜ƒ\"; }"
        },
        {
            "sha": "ba48325c0a580d4480cb9f76713d5ec9b2c3756a",
            "filename": "tests/regressiontests/staticfiles_tests/apps/test/static/test/window.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/3727f6d09681e4cb23d67e14ecc677a364c991bd/tests%2Fregressiontests%2Fstaticfiles_tests%2Fapps%2Ftest%2Fstatic%2Ftest%2Fwindow.png",
            "raw_url": "https://github.com/django/django/raw/3727f6d09681e4cb23d67e14ecc677a364c991bd/tests%2Fregressiontests%2Fstaticfiles_tests%2Fapps%2Ftest%2Fstatic%2Ftest%2Fwindow.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Fapps%2Ftest%2Fstatic%2Ftest%2Fwindow.png?ref=3727f6d09681e4cb23d67e14ecc677a364c991bd"
        },
        {
            "sha": "91435a2c86ec00b78e00ad00c2d7638d1b69454e",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/3727f6d09681e4cb23d67e14ecc677a364c991bd/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3727f6d09681e4cb23d67e14ecc677a364c991bd/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=3727f6d09681e4cb23d67e14ecc677a364c991bd",
            "patch": "@@ -498,8 +498,9 @@ def test_post_processing(self):\n         collectstatic_cmd = CollectstaticCommand()\n         collectstatic_cmd.set_options(**collectstatic_args)\n         stats = collectstatic_cmd.collect()\n-        self.assertTrue(os.path.join('cached', 'css', 'window.css') in stats['post_processed'])\n-        self.assertTrue(os.path.join('cached', 'css', 'img', 'window.png') in stats['unmodified'])\n+        self.assertIn(os.path.join('cached', 'css', 'window.css'), stats['post_processed'])\n+        self.assertIn(os.path.join('cached', 'css', 'img', 'window.png'), stats['unmodified'])\n+        self.assertIn(os.path.join('test', 'nonascii.css'), stats['post_processed'])\n \n     def test_cache_key_memcache_validation(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 12,
        "additions": 9,
        "deletions": 3
    }
}