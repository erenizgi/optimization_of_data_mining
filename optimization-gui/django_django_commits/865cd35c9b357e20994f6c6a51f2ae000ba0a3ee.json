{
    "author": "claudep",
    "message": "Made more extensive usage of context managers with open.",
    "sha": "865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
    "files": [
        {
            "sha": "d89329145f5da17fcabd62fbaae1241cde6f000b",
            "filename": "django/bin/unique-messages.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fbin%2Funique-messages.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fbin%2Funique-messages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fbin%2Funique-messages.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -22,7 +22,8 @@ def unique_messages():\n                 cmd = 'msguniq \"%s.po\"' % pf\n                 stdout = os.popen(cmd)\n                 msg = stdout.read()\n-                open('%s.po' % pf, 'w').write(msg)\n+                with open('%s.po' % pf, 'w') as fp:\n+                    fp.write(msg)\n \n if __name__ == \"__main__\":\n     unique_messages()"
        },
        {
            "sha": "7efab3e073dfd74b97a4c90023f7a92c4914b053",
            "filename": "django/contrib/gis/db/backends/spatialite/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -120,12 +120,9 @@ def load_spatialite_sql(self):\n \n             # Opening up the SpatiaLite SQL initialization file and executing\n             # as a script.\n-            sql_fh = open(spatialite_sql, 'r')\n-            try:\n+            with open(spatialite_sql, 'r') as sql_fh:\n                 cur = self.connection._cursor()\n                 cur.executescript(sql_fh.read())\n-            finally:\n-                sql_fh.close()\n \n     def spatialite_init_file(self):\n         # SPATIALITE_SQL may be placed in settings to tell GeoDjango"
        },
        {
            "sha": "ee33f14d19de988345f7af16a132752366a6527b",
            "filename": "django/contrib/gis/geos/factory.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -7,10 +7,10 @@ def fromfile(file_h):\n     \"\"\"\n     # If given a file name, get a real handle.\n     if isinstance(file_h, basestring): \n-        file_h = open(file_h, 'rb')\n-\n-    # Reading in the file's contents,\n-    buf = file_h.read()\n+        with open(file_h, 'rb') as file_h:\n+            buf = file_h.read()\n+    else:\n+        buf = file_h.read()\n \n     # If we get WKB need to wrap in buffer(), so run through regexes.\n     if wkt_regex.match(buf) or hex_regex.match(buf):"
        },
        {
            "sha": "0f869088ac176005db93fdd9340aff1c4e16ac07",
            "filename": "django/contrib/sessions/backends/file.py",
            "status": "modified",
            "additions": 8,
            "deletions": 11,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -47,18 +47,15 @@ def _key_to_file(self, session_key=None):\n     def load(self):\n         session_data = {}\n         try:\n-            session_file = open(self._key_to_file(), \"rb\")\n-            try:\n+            with open(self._key_to_file(), \"rb\") as session_file:\n                 file_data = session_file.read()\n-                # Don't fail if there is no data in the session file.\n-                # We may have opened the empty placeholder file.\n-                if file_data:\n-                    try:\n-                        session_data = self.decode(file_data)\n-                    except (EOFError, SuspiciousOperation):\n-                        self.create()\n-            finally:\n-                session_file.close()\n+            # Don't fail if there is no data in the session file.\n+            # We may have opened the empty placeholder file.\n+            if file_data:\n+                try:\n+                    session_data = self.decode(file_data)\n+                except (EOFError, SuspiciousOperation):\n+                    self.create()\n         except IOError:\n             self.create()\n         return session_data"
        },
        {
            "sha": "7f9f7175be514ba03bc2b25fb00540d16f379657",
            "filename": "django/core/cache/backends/filebased.py",
            "status": "modified",
            "additions": 9,
            "deletions": 18,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -31,16 +31,13 @@ def get(self, key, default=None, version=None):\n \n         fname = self._key_to_file(key)\n         try:\n-            f = open(fname, 'rb')\n-            try:\n+            with open(fname, 'rb') as f:\n                 exp = pickle.load(f)\n                 now = time.time()\n                 if exp < now:\n                     self._delete(fname)\n                 else:\n                     return pickle.load(f)\n-            finally:\n-                f.close()\n         except (IOError, OSError, EOFError, pickle.PickleError):\n             pass\n         return default\n@@ -61,13 +58,10 @@ def set(self, key, value, timeout=None, version=None):\n             if not os.path.exists(dirname):\n                 os.makedirs(dirname)\n \n-            f = open(fname, 'wb')\n-            try:\n+            with open(fname, 'wb') as f:\n                 now = time.time()\n                 pickle.dump(now + timeout, f, pickle.HIGHEST_PROTOCOL)\n                 pickle.dump(value, f, pickle.HIGHEST_PROTOCOL)\n-            finally:\n-                f.close()\n         except (IOError, OSError):\n             pass\n \n@@ -94,17 +88,14 @@ def has_key(self, key, version=None):\n         self.validate_key(key)\n         fname = self._key_to_file(key)\n         try:\n-            f = open(fname, 'rb')\n-            try:\n+            with open(fname, 'rb') as f:\n                 exp = pickle.load(f)\n-                now = time.time()\n-                if exp < now:\n-                    self._delete(fname)\n-                    return False\n-                else:\n-                    return True\n-            finally:\n-                f.close()\n+            now = time.time()\n+            if exp < now:\n+                self._delete(fname)\n+                return False\n+            else:\n+                return True\n         except (IOError, OSError, EOFError, pickle.PickleError):\n             return False\n "
        },
        {
            "sha": "e6fec4d78abdbdd9c745a43ea302e1287e236b7a",
            "filename": "django/core/files/locks.py",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Ffiles%2Flocks.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Ffiles%2Flocks.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Flocks.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -9,10 +9,9 @@\n Example Usage::\n \n     >>> from django.core.files import locks\n-    >>> f = open('./file', 'wb')\n-    >>> locks.lock(f, locks.LOCK_EX)\n-    >>> f.write('Django')\n-    >>> f.close()\n+    >>> with open('./file', 'wb') as f:\n+    >>>     locks.lock(f, locks.LOCK_EX)\n+    >>>     f.write('Django')\n \"\"\"\n \n __all__ = ('LOCK_EX','LOCK_SH','LOCK_NB','lock','unlock')"
        },
        {
            "sha": "f9060fd3d8959ad6e76067235ce28be96abd4b8e",
            "filename": "django/core/files/move.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Ffiles%2Fmove.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Ffiles%2Fmove.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fmove.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -59,8 +59,7 @@ def file_move_safe(old_file_name, new_file_name, chunk_size = 1024*64, allow_ove\n         pass\n \n     # first open the old file, so that it won't go away\n-    old_file = open(old_file_name, 'rb')\n-    try:\n+    with open(old_file_name, 'rb') as old_file:\n         # now open the new file, not forgetting allow_overwrite\n         fd = os.open(new_file_name, os.O_WRONLY | os.O_CREAT | getattr(os, 'O_BINARY', 0) |\n                                     (not allow_overwrite and os.O_EXCL or 0))\n@@ -73,8 +72,6 @@ def file_move_safe(old_file_name, new_file_name, chunk_size = 1024*64, allow_ove\n         finally:\n             locks.unlock(fd)\n             os.close(fd)\n-    finally:\n-        old_file.close()\n     copystat(old_file_name, new_file_name)\n \n     try:"
        },
        {
            "sha": "a01832cbd38c07bb60ca6ee9bc6200a92367d835",
            "filename": "django/core/mail/message.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmail%2Fmessage.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmail%2Fmessage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fmessage.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -265,7 +265,8 @@ def attach(self, filename=None, content=None, mimetype=None):\n     def attach_file(self, path, mimetype=None):\n         \"\"\"Attaches a file from the filesystem.\"\"\"\n         filename = os.path.basename(path)\n-        content = open(path, 'rb').read()\n+        with open(path, 'rb') as f:\n+            content = f.read()\n         self.attach(filename, content, mimetype)\n \n     def _create_message(self, msg):"
        },
        {
            "sha": "354787eb91dd5e61bc50f864102d18e762e3fe48",
            "filename": "django/core/management/commands/compilemessages.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -5,8 +5,8 @@\n from django.core.management.base import BaseCommand, CommandError\n \n def has_bom(fn):\n-    f = open(fn, 'r')\n-    sample = f.read(4)\n+    with open(fn, 'r') as f:\n+        sample = f.read(4)\n     return sample[:3] == '\\xef\\xbb\\xbf' or \\\n             sample.startswith(codecs.BOM_UTF16_LE) or \\\n             sample.startswith(codecs.BOM_UTF16_BE)"
        },
        {
            "sha": "046ffb48f2a4cd87496ba028e7ecfc58531bdd08",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 16,
            "deletions": 28,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -112,7 +112,8 @@ def copy_plural_forms(msgs, locale, domain, verbosity, stdout=sys.stdout):\n     for domain in domains:\n         django_po = os.path.join(django_dir, 'conf', 'locale', locale, 'LC_MESSAGES', '%s.po' % domain)\n         if os.path.exists(django_po):\n-            m = plural_forms_re.search(open(django_po, 'rU').read())\n+            with open(django_po, 'rU') as fp:\n+                m = plural_forms_re.search(fp.read())\n             if m:\n                 if verbosity > 1:\n                     stdout.write(\"copying plural forms: %s\\n\" % m.group('value'))\n@@ -141,11 +142,8 @@ def write_pot_file(potfile, msgs, file, work_file, is_templatized):\n         msgs = '\\n'.join(dropwhile(len, msgs.split('\\n')))\n     else:\n         msgs = msgs.replace('charset=CHARSET', 'charset=UTF-8')\n-    f = open(potfile, 'ab')\n-    try:\n-        f.write(msgs)\n-    finally:\n-        f.close()\n+    with open(potfile, 'ab') as fp:\n+        fp.write(msgs)\n \n def process_file(file, dirpath, potfile, domain, verbosity,\n                  extensions, wrap, location, stdout=sys.stdout):\n@@ -164,15 +162,13 @@ def process_file(file, dirpath, potfile, domain, verbosity,\n     if domain == 'djangojs' and file_ext in extensions:\n         is_templatized = True\n         orig_file = os.path.join(dirpath, file)\n-        src_data = open(orig_file).read()\n+        with open(orig_file) as fp:\n+            src_data = fp.read()\n         src_data = prepare_js_for_gettext(src_data)\n         thefile = '%s.c' % file\n         work_file = os.path.join(dirpath, thefile)\n-        f = open(work_file, \"w\")\n-        try:\n-            f.write(src_data)\n-        finally:\n-            f.close()\n+        with open(work_file, \"w\") as fp:\n+            fp.write(src_data)\n         cmd = (\n             'xgettext -d %s -L C %s %s --keyword=gettext_noop '\n             '--keyword=gettext_lazy --keyword=ngettext_lazy:1,2 '\n@@ -184,14 +180,12 @@ def process_file(file, dirpath, potfile, domain, verbosity,\n         orig_file = os.path.join(dirpath, file)\n         is_templatized = file_ext in extensions\n         if is_templatized:\n-            src_data = open(orig_file, \"rU\").read()\n+            with open(orig_file, \"rU\") as fp:\n+                src_data = fp.read()\n             thefile = '%s.py' % file\n             content = templatize(src_data, orig_file[2:])\n-            f = open(os.path.join(dirpath, thefile), \"w\")\n-            try:\n-                f.write(content)\n-            finally:\n-                f.close()\n+            with open(os.path.join(dirpath, thefile), \"w\") as fp:\n+                fp.write(content)\n         work_file = os.path.join(dirpath, thefile)\n         cmd = (\n             'xgettext -d %s -L Python %s %s --keyword=gettext_noop '\n@@ -232,11 +226,8 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n         os.unlink(potfile)\n         raise CommandError(\"errors happened while running msguniq\\n%s\" % errors)\n     if os.path.exists(pofile):\n-        f = open(potfile, 'w')\n-        try:\n-            f.write(msgs)\n-        finally:\n-            f.close()\n+        with open(potfile, 'w') as fp:\n+            fp.write(msgs)\n         msgs, errors = _popen('msgmerge %s %s -q \"%s\" \"%s\"' %\n                                 (wrap, location, pofile, potfile))\n         if errors:\n@@ -247,11 +238,8 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n         msgs = copy_plural_forms(msgs, locale, domain, verbosity, stdout)\n     msgs = msgs.replace(\n         \"#. #-#-#-#-#  %s.pot (PACKAGE VERSION)  #-#-#-#-#\\n\" % domain, \"\")\n-    f = open(pofile, 'wb')\n-    try:\n-        f.write(msgs)\n-    finally:\n-        f.close()\n+    with open(pofile, 'wb') as fp:\n+        fp.write(msgs)\n     os.unlink(potfile)\n     if no_obsolete:\n         msgs, errors = _popen('msgattrib %s %s -o \"%s\" --no-obsolete \"%s\"' %"
        },
        {
            "sha": "53d97362934c170cf2fc7d966cf1586696244a42",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -157,13 +157,12 @@ def custom_sql_for_model(model, style, connection):\n                  os.path.join(app_dir, \"%s.sql\" % opts.object_name.lower())]\n     for sql_file in sql_files:\n         if os.path.exists(sql_file):\n-            fp = open(sql_file, 'U')\n-            for statement in statements.split(fp.read().decode(settings.FILE_CHARSET)):\n-                # Remove any comments from the file\n-                statement = re.sub(ur\"--.*([\\n\\Z]|$)\", \"\", statement)\n-                if statement.strip():\n-                    output.append(statement + u\";\")\n-            fp.close()\n+            with open(sql_file, 'U') as fp:\n+                for statement in statements.split(fp.read().decode(settings.FILE_CHARSET)):\n+                    # Remove any comments from the file\n+                    statement = re.sub(ur\"--.*([\\n\\Z]|$)\", \"\", statement)\n+                    if statement.strip():\n+                        output.append(statement + u\";\")\n \n     return output\n "
        },
        {
            "sha": "2ae1fa5ae3dfaa817eeb08bfc3d7f1df0f0b6a20",
            "filename": "django/core/servers/fastcgi.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fservers%2Ffastcgi.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fcore%2Fservers%2Ffastcgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Ffastcgi.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -176,9 +176,8 @@ def runfastcgi(argset=[], **kwargs):\n         become_daemon(our_home_dir=options[\"workdir\"], **daemon_kwargs)\n \n     if options[\"pidfile\"]:\n-        fp = open(options[\"pidfile\"], \"w\")\n-        fp.write(\"%d\\n\" % os.getpid())\n-        fp.close()\n+        with open(options[\"pidfile\"], \"w\") as fp:\n+            fp.write(\"%d\\n\" % os.getpid())\n \n     WSGIServer(get_internal_wsgi_application(), **wsgi_opts).run()\n "
        },
        {
            "sha": "c96238061c58a226f322de44b0fe7676d0c31dc3",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -328,9 +328,8 @@ def render(self, context):\n             else:\n                 return '' # Fail silently for invalid includes.\n         try:\n-            fp = open(filepath, 'r')\n-            output = fp.read()\n-            fp.close()\n+            with open(filepath, 'r') as fp:\n+                output = fp.read()\n         except IOError:\n             output = ''\n         if self.parsed:"
        },
        {
            "sha": "d6b3a17c8cb505bacc4b708f469369ab3379affc",
            "filename": "django/template/loaders/app_directories.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftemplate%2Floaders%2Fapp_directories.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftemplate%2Floaders%2Fapp_directories.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floaders%2Fapp_directories.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -52,11 +52,8 @@ def get_template_sources(self, template_name, template_dirs=None):\n     def load_template_source(self, template_name, template_dirs=None):\n         for filepath in self.get_template_sources(template_name, template_dirs):\n             try:\n-                file = open(filepath)\n-                try:\n-                    return (file.read().decode(settings.FILE_CHARSET), filepath)\n-                finally:\n-                    file.close()\n+                with open(filepath) as fp:\n+                    return (fp.read().decode(settings.FILE_CHARSET), filepath)\n             except IOError:\n                 pass\n         raise TemplateDoesNotExist(template_name)"
        },
        {
            "sha": "8352406424105412f34caa0faa70108d1eeea144",
            "filename": "django/template/loaders/filesystem.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftemplate%2Floaders%2Ffilesystem.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftemplate%2Floaders%2Ffilesystem.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floaders%2Ffilesystem.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -34,11 +34,8 @@ def load_template_source(self, template_name, template_dirs=None):\n         tried = []\n         for filepath in self.get_template_sources(template_name, template_dirs):\n             try:\n-                file = open(filepath)\n-                try:\n-                    return (file.read().decode(settings.FILE_CHARSET), filepath)\n-                finally:\n-                    file.close()\n+                with open(filepath) as fp:\n+                    return (fp.read().decode(settings.FILE_CHARSET), filepath)\n             except IOError:\n                 tried.append(filepath)\n         if tried:"
        },
        {
            "sha": "ab8f034570d251fe94b972e17204931eab219152",
            "filename": "django/test/_doctest.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftest%2F_doctest.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Ftest%2F_doctest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F_doctest.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -226,7 +226,8 @@ def _load_testfile(filename, package, module_relative):\n                 # get_data() opens files as 'rb', so one must do the equivalent\n                 # conversion as universal newlines would do.\n                 return file_contents.replace(os.linesep, '\\n'), filename\n-    return open(filename).read(), filename\n+    with open(filename) as fp:\n+        return fp.read(), filename\n \n def _indent(s, indent=4):\n     \"\"\"\n@@ -2519,9 +2520,8 @@ def debug_script(src, pm=False, globs=None):\n     # docs say, a file so created cannot be opened by name a second time\n     # on modern Windows boxes, and execfile() needs to open it.\n     srcfilename = tempfile.mktemp(\".py\", \"doctestdebug\")\n-    f = open(srcfilename, 'w')\n-    f.write(src)\n-    f.close()\n+    with open(srcfilename, 'w') as fp:\n+        fp.write(src)\n \n     try:\n         if globs:"
        },
        {
            "sha": "f4c7318f10665f03b91af2b89a53118fbc0893cc",
            "filename": "django/utils/feedgenerator.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Futils%2Ffeedgenerator.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Futils%2Ffeedgenerator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffeedgenerator.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -15,9 +15,8 @@\n ...     link=u\"http://www.holovaty.com/test/\",\n ...     description=\"Testing.\"\n ... )\n->>> fp = open('test.rss', 'w')\n->>> feed.write(fp, 'utf-8')\n->>> fp.close()\n+>>> with open('test.rss', 'w') as fp:\n+>>>     feed.write(fp, 'utf-8')\n \n For definitions of the different versions of RSS, see:\n http://diveintomark.org/archives/2004/02/04/incompatible-rss"
        },
        {
            "sha": "418b2bab9fabfd866319f92ad2d997de0b20b2b5",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -333,11 +333,8 @@ def _get_lines_from_file(self, filename, lineno, context_lines, loader=None, mod\n                 source = source.splitlines()\n         if source is None:\n             try:\n-                f = open(filename)\n-                try:\n-                    source = f.readlines()\n-                finally:\n-                    f.close()\n+                with open(filename) as fp:\n+                    source = fp.readlines()\n             except (OSError, IOError):\n                 pass\n         if source is None:"
        },
        {
            "sha": "7181480e0fb0986fb24ea5558aa95217d6c63ec9",
            "filename": "docs/_ext/applyxrefs.py",
            "status": "modified",
            "additions": 6,
            "deletions": 21,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2F_ext%2Fapplyxrefs.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2F_ext%2Fapplyxrefs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2F_ext%2Fapplyxrefs.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -18,33 +18,18 @@ def process_file(fn, lines):\n     lines.insert(0, '\\n')\n     lines.insert(0, '.. %s:\\n' % target_name(fn))\n     try:\n-        f = open(fn, 'w')\n+        with open(fn, 'w') as fp:\n+            fp.writelines(lines)\n     except IOError:\n         print(\"Can't open %s for writing. Not touching it.\" % fn)\n-        return\n-    try:\n-        f.writelines(lines)\n-    except IOError:\n-        print(\"Can't write to %s. Not touching it.\" % fn)\n-    finally:\n-        f.close()\n \n def has_target(fn):\n     try:\n-        f = open(fn, 'r')\n+        with open(fn, 'r') as fp:\n+            lines = fp.readlines()\n     except IOError:\n-        print(\"Can't open %s. Not touching it.\" % fn)\n+        print(\"Can't open or read %s. Not touching it.\" % fn)\n         return (True, None)\n-    readok = True\n-    try:\n-        lines = f.readlines()\n-    except IOError:\n-        print(\"Can't read %s. Not touching it.\" % fn)\n-        readok = False\n-    finally:\n-        f.close()\n-        if not readok:\n-            return (True, None)\n \n     #print fn, len(lines)\n     if len(lines) < 1:\n@@ -82,7 +67,7 @@ def main(argv=None):\n                 print(\"Adding xref to %s\" % fn)\n                 process_file(fn, lines)\n         else:\n-            print \"Skipping %s: already has a xref\" % fn\n+            print(\"Skipping %s: already has a xref\" % fn)\n \n if __name__ == '__main__':\n     sys.exit(main())"
        },
        {
            "sha": "3d85147952668659fbe197e2545df9c3e8063c3b",
            "filename": "docs/_ext/djangodocs.py",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2F_ext%2Fdjangodocs.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2F_ext%2Fdjangodocs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2F_ext%2Fdjangodocs.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -210,8 +210,7 @@ def finish(self):\n                         if t == \"templatefilter\" and l == \"ref/templates/builtins\"],\n         }\n         outfilename = os.path.join(self.outdir, \"templatebuiltins.js\")\n-        f = open(outfilename, 'wb')\n-        f.write('var django_template_builtins = ')\n-        json.dump(templatebuiltins, f)\n-        f.write(';\\n')\n-        f.close();\n+        with open(outfilename, 'wb') as fp:\n+            fp.write('var django_template_builtins = ')\n+            json.dump(templatebuiltins, fp)\n+            fp.write(';\\n')"
        },
        {
            "sha": "d7b3cfc549e7e41a4a3be889fdd8f4d7eaa6aec4",
            "filename": "docs/_ext/literals_to_xrefs.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2F_ext%2Fliterals_to_xrefs.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2F_ext%2Fliterals_to_xrefs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2F_ext%2Fliterals_to_xrefs.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -38,7 +38,8 @@\n ]\n \n def fixliterals(fname):\n-    data = open(fname).read()\n+    with open(fname) as fp:\n+        data = fp.read()\n     \n     last = 0\n     new = []\n@@ -101,7 +102,8 @@ def fixliterals(fname):\n         lastvalues[m.group(1)] = replace_value\n     \n     new.append(data[last:])\n-    open(fname, \"w\").write(\"\".join(new))\n+    with open(fname, \"w\") as fp:\n+        fp.write(\"\".join(new))\n     \n     storage[\"lastvalues\"] = lastvalues\n     storage.close()"
        },
        {
            "sha": "f045f4bf5a5d0e6346974075513028751f40dcb4",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -239,9 +239,8 @@ Sample usage::\n     ...     link=u\"http://www.holovaty.com/test/\",\n     ...     description=\"Testing.\"\n     ... )\n-    >>> fp = open('test.rss', 'w')\n-    >>> feed.write(fp, 'utf-8')\n-    >>> fp.close()\n+    >>> with open('test.rss', 'w') as fp:\n+    >>>     feed.write(fp, 'utf-8')\n \n For simplifying the selection of a generator use ``feedgenerator.DefaultFeed``\n which is currently ``Rss201rev2Feed``"
        },
        {
            "sha": "877d3b4100d9949fcdf22fc2a4fc2403352d3ec6",
            "filename": "docs/topics/http/file-uploads.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Ftopics%2Fhttp%2Ffile-uploads.txt",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Ftopics%2Fhttp%2Ffile-uploads.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Ffile-uploads.txt?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -101,10 +101,9 @@ objects; see `UploadedFile objects`_ for a complete reference.\n Putting it all together, here's a common way you might handle an uploaded file::\n \n     def handle_uploaded_file(f):\n-        destination = open('some/file/name.txt', 'wb+')\n-        for chunk in f.chunks():\n-            destination.write(chunk)\n-        destination.close()\n+        with open('some/file/name.txt', 'wb+') as destination:\n+            for chunk in f.chunks():\n+                destination.write(chunk)\n \n Looping over ``UploadedFile.chunks()`` instead of using ``read()`` ensures that\n large files don't overwhelm your system's memory."
        },
        {
            "sha": "73239cb483aef9e95db112425b100ba52ac14647",
            "filename": "docs/topics/serialization.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Ftopics%2Fserialization.txt",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Ftopics%2Fserialization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fserialization.txt?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -36,8 +36,8 @@ You can also use a serializer object directly::\n This is useful if you want to serialize data directly to a file-like object\n (which includes an :class:`~django.http.HttpResponse`)::\n \n-    out = open(\"file.xml\", \"w\")\n-    xml_serializer.serialize(SomeModel.objects.all(), stream=out)\n+    with open(\"file.xml\", \"w\") as out:\n+        xml_serializer.serialize(SomeModel.objects.all(), stream=out)\n \n .. note::\n "
        },
        {
            "sha": "3971958dc713c6053da5fdbc517c1e8b544621e7",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -770,9 +770,8 @@ arguments at time of construction:\n         wish to upload as a value. For example::\n \n             >>> c = Client()\n-            >>> f = open('wishlist.doc')\n-            >>> c.post('/customers/wishes/', {'name': 'fred', 'attachment': f})\n-            >>> f.close()\n+            >>> with open('wishlist.doc') as fp:\n+            >>>     c.post('/customers/wishes/', {'name': 'fred', 'attachment': fp})\n \n         (The name ``attachment`` here is not relevant; use whatever name your\n         file-processing code expects.)"
        },
        {
            "sha": "62a8fb92afe7c9c30036642935ab80e17980ab01",
            "filename": "extras/csrf_migration_helper.py",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/extras%2Fcsrf_migration_helper.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/extras%2Fcsrf_migration_helper.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/extras%2Fcsrf_migration_helper.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -170,14 +170,13 @@ def content(self):\n         try:\n             return self._content\n         except AttributeError:\n-            fd = open(self.absolute_filename)\n-            try:\n-                content = fd.read().decode(TEMPLATE_ENCODING)\n-            except UnicodeDecodeError as e:\n-                message = '%s in %s' % (\n-                    e[4], self.absolute_filename.encode('UTF-8', 'ignore'))\n-                raise UnicodeDecodeError(*(e.args[:4] + (message,)))\n-            fd.close()\n+            with open(self.absolute_filename) as fd:\n+                try:\n+                    content = fd.read().decode(TEMPLATE_ENCODING)\n+                except UnicodeDecodeError as e:\n+                    message = '%s in %s' % (\n+                        e[4], self.absolute_filename.encode('UTF-8', 'ignore'))\n+                    raise UnicodeDecodeError(*(e.args[:4] + (message,)))\n             self._content = content\n             return content\n     content = property(content)\n@@ -271,9 +270,8 @@ def get_python_code(paths):\n             for f in filenames:\n                 if len([True for e in PYTHON_SOURCE_EXTENSIONS if f.endswith(e)]) > 0:\n                     fn = os.path.join(dirpath, f)\n-                    fd = open(fn)\n-                    content = [l.decode(PYTHON_ENCODING) for l in fd.readlines()]\n-                    fd.close()\n+                    with open(fn) as fd:\n+                        content = [l.decode(PYTHON_ENCODING) for l in fd.readlines()]\n                     retval.append((fn, content))\n     return retval\n "
        },
        {
            "sha": "47902f3a8346e6441ebd5e45cc68a3c77b58814d",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -1242,8 +1242,10 @@ def test_image_field(self):\n         # it comes to validation. This specifically tests that #6302 is fixed for\n         # both file fields and image fields.\n \n-        image_data = open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb').read()\n-        image_data2 = open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb').read()\n+        with open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb') as fp:\n+            image_data = fp.read()\n+        with open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb') as fp:\n+            image_data2 = fp.read()\n \n         f = ImageFileForm(\n                 data={'description': u'An image'},"
        },
        {
            "sha": "98492ffbdd0a213de1448e8177f6cece6650fc8c",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 30,
            "deletions": 31,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -27,32 +27,32 @@ def write_settings(self, filename, apps=None, is_dir=False, sdict=None):\n         if is_dir:\n             settings_dir = os.path.join(test_dir, filename)\n             os.mkdir(settings_dir)\n-            settings_file = open(os.path.join(settings_dir, '__init__.py'), 'w')\n+            settings_file_path = os.path.join(settings_dir, '__init__.py')\n         else:\n-            settings_file = open(os.path.join(test_dir, filename), 'w')\n-        settings_file.write('# Settings file automatically generated by regressiontests.admin_scripts test case\\n')\n-        exports = [\n-            'DATABASES',\n-            'ROOT_URLCONF',\n-            'SECRET_KEY',\n-        ]\n-        for s in exports:\n-            if hasattr(settings, s):\n-                o = getattr(settings, s)\n-                if not isinstance(o, dict):\n-                    o = \"'%s'\" % o\n-                settings_file.write(\"%s = %s\\n\" % (s, o))\n-\n-        if apps is None:\n-            apps = ['django.contrib.auth', 'django.contrib.contenttypes', 'regressiontests.admin_scripts']\n-\n-        settings_file.write(\"INSTALLED_APPS = %s\\n\" % apps)\n-\n-        if sdict:\n-            for k, v in sdict.items():\n-                settings_file.write(\"%s = %s\\n\" % (k, v))\n-\n-        settings_file.close()\n+            settings_file_path = os.path.join(test_dir, filename)\n+\n+        with open(settings_file_path, 'w') as settings_file:\n+            settings_file.write('# Settings file automatically generated by regressiontests.admin_scripts test case\\n')\n+            exports = [\n+                'DATABASES',\n+                'ROOT_URLCONF',\n+                'SECRET_KEY',\n+            ]\n+            for s in exports:\n+                if hasattr(settings, s):\n+                    o = getattr(settings, s)\n+                    if not isinstance(o, dict):\n+                        o = \"'%s'\" % o\n+                    settings_file.write(\"%s = %s\\n\" % (s, o))\n+\n+            if apps is None:\n+                apps = ['django.contrib.auth', 'django.contrib.contenttypes', 'regressiontests.admin_scripts']\n+\n+            settings_file.write(\"INSTALLED_APPS = %s\\n\" % apps)\n+\n+            if sdict:\n+                for k, v in sdict.items():\n+                    settings_file.write(\"%s = %s\\n\" % (k, v))\n \n     def remove_settings(self, filename, is_dir=False):\n         full_name = os.path.join(test_dir, filename)\n@@ -989,13 +989,12 @@ def write_settings_with_import_error(self, filename, apps=None, is_dir=False, sd\n         if is_dir:\n             settings_dir = os.path.join(test_dir, filename)\n             os.mkdir(settings_dir)\n-            settings_file = open(os.path.join(settings_dir, '__init__.py'), 'w')\n+            settings_file_path = os.path.join(settings_dir, '__init__.py')\n         else:\n-            settings_file = open(os.path.join(test_dir, filename), 'w')\n-        settings_file.write('# Settings file automatically generated by regressiontests.admin_scripts test case\\n')\n-        settings_file.write('# The next line will cause an import error:\\nimport foo42bar\\n')\n-\n-        settings_file.close()\n+            settings_file_path = os.path.join(test_dir, filename)\n+        with open(settings_file_path, 'w') as settings_file:\n+            settings_file.write('# Settings file automatically generated by regressiontests.admin_scripts test case\\n')\n+            settings_file.write('# The next line will cause an import error:\\nimport foo42bar\\n')\n \n     def test_builtin_command(self):\n         \"import error: manage.py builtin commands shows useful diagnostic info when settings with import errors is provided\""
        },
        {
            "sha": "b7547696d4aa040ee5268b34801ebe1920e1a045",
            "filename": "tests/regressiontests/bug639/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fbug639%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fbug639%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbug639%2Ftests.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -24,7 +24,8 @@ def testBug639(self):\n         \"\"\"\n         # Grab an image for testing.\n         filename = os.path.join(os.path.dirname(__file__), \"test.jpg\")\n-        img = open(filename, \"rb\").read()\n+        with open(filename, \"rb\") as fp:\n+            img = fp.read()\n \n         # Fake a POST QueryDict and FILES MultiValueDict.\n         data = {'title': 'Testing'}"
        },
        {
            "sha": "de552d88ec2977fa795d87e4b5dda37c32fce114",
            "filename": "tests/regressiontests/file_uploads/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 29,
            "changes": 58,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -24,11 +24,12 @@\n \n class FileUploadTests(TestCase):\n     def test_simple_upload(self):\n-        post_data = {\n-            'name': 'Ringo',\n-            'file_field': open(__file__),\n-        }\n-        response = self.client.post('/file_uploads/upload/', post_data)\n+        with open(__file__) as fp:\n+            post_data = {\n+                'name': 'Ringo',\n+                'file_field': fp,\n+            }\n+            response = self.client.post('/file_uploads/upload/', post_data)\n         self.assertEqual(response.status_code, 200)\n \n     def test_large_upload(self):\n@@ -87,17 +88,16 @@ def test_unicode_file_name(self):\n         tdir = tempfile.gettempdir()\n \n         # This file contains chinese symbols and an accented char in the name.\n-        file1 = open(os.path.join(tdir, UNICODE_FILENAME.encode('utf-8')), 'w+b')\n-        file1.write('b' * (2 ** 10))\n-        file1.seek(0)\n+        with open(os.path.join(tdir, UNICODE_FILENAME.encode('utf-8')), 'w+b') as file1:\n+            file1.write('b' * (2 ** 10))\n+            file1.seek(0)\n \n-        post_data = {\n-            'file_unicode': file1,\n-            }\n+            post_data = {\n+                'file_unicode': file1,\n+                }\n \n-        response = self.client.post('/file_uploads/unicode_name/', post_data)\n+            response = self.client.post('/file_uploads/unicode_name/', post_data)\n \n-        file1.close()\n         try:\n             os.unlink(file1.name)\n         except:\n@@ -294,10 +294,6 @@ def handle_uncaught_exception(self, request, resolver, exc_info):\n                 p = request.POST\n                 return ret\n \n-        post_data = {\n-            'name': 'Ringo',\n-            'file_field': open(__file__),\n-        }\n         # Maybe this is a little more complicated that it needs to be; but if\n         # the django.test.client.FakePayload.read() implementation changes then\n         # this test would fail.  So we need to know exactly what kind of error\n@@ -310,16 +306,21 @@ def handle_uncaught_exception(self, request, resolver, exc_info):\n         # install the custom handler that tries to access request.POST\n         self.client.handler = POSTAccessingHandler()\n \n-        try:\n-            response = self.client.post('/file_uploads/upload_errors/', post_data)\n-        except reference_error.__class__ as err:\n-            self.assertFalse(\n-                str(err) == str(reference_error),\n-                \"Caught a repeated exception that'll cause an infinite loop in file uploads.\"\n-            )\n-        except Exception as err:\n-            # CustomUploadError is the error that should have been raised\n-            self.assertEqual(err.__class__, uploadhandler.CustomUploadError)\n+        with open(__file__) as fp:\n+            post_data = {\n+                'name': 'Ringo',\n+                'file_field': fp,\n+            }\n+            try:\n+                response = self.client.post('/file_uploads/upload_errors/', post_data)\n+            except reference_error.__class__ as err:\n+                self.assertFalse(\n+                    str(err) == str(reference_error),\n+                    \"Caught a repeated exception that'll cause an infinite loop in file uploads.\"\n+                )\n+            except Exception as err:\n+                # CustomUploadError is the error that should have been raised\n+                self.assertEqual(err.__class__, uploadhandler.CustomUploadError)\n \n     def test_filename_case_preservation(self):\n         \"\"\"\n@@ -382,8 +383,7 @@ def test_readonly_root(self):\n     def test_not_a_directory(self):\n         \"\"\"The correct IOError is raised when the upload directory name exists but isn't a directory\"\"\"\n         # Create a file with the upload directory name\n-        fd = open(UPLOAD_TO, 'w')\n-        fd.close()\n+        open(UPLOAD_TO, 'w').close()\n         try:\n             self.obj.testfile.save('foo.txt', SimpleUploadedFile('foo.txt', 'x'))\n         except IOError as err:"
        },
        {
            "sha": "a4cefd8322dbb5a90e21c4be0094669cf2ceee5d",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -517,7 +517,8 @@ def flush_mailbox(self):\n     def get_mailbox_content(self):\n         messages = []\n         for filename in os.listdir(self.tmp_dir):\n-            session = open(os.path.join(self.tmp_dir, filename)).read().split('\\n' + ('-' * 79) + '\\n')\n+            with open(os.path.join(self.tmp_dir, filename)) as fp:\n+                session = fp.read().split('\\n' + ('-' * 79) + '\\n')\n             messages.extend(email.message_from_string(m) for m in session if m)\n         return messages\n \n@@ -528,7 +529,8 @@ def test_file_sessions(self):\n         connection.send_messages([msg])\n \n         self.assertEqual(len(os.listdir(self.tmp_dir)), 1)\n-        message = email.message_from_file(open(os.path.join(self.tmp_dir, os.listdir(self.tmp_dir)[0])))\n+        with open(os.path.join(self.tmp_dir, os.listdir(self.tmp_dir)[0])) as fp:\n+            message = email.message_from_file(fp)\n         self.assertEqual(message.get_content_type(), 'text/plain')\n         self.assertEqual(message.get('subject'), 'Subject')\n         self.assertEqual(message.get('from'), 'from@example.com')"
        },
        {
            "sha": "6cabf6453c0fa966d1f92c29eda0425685de78ec",
            "filename": "tests/regressiontests/views/tests/static.py",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -29,7 +29,8 @@ def test_serve(self):\n         for filename in media_files:\n             response = self.client.get('/views/%s/%s' % (self.prefix, filename))\n             file_path = path.join(media_dir, filename)\n-            self.assertEqual(open(file_path).read(), response.content)\n+            with open(file_path) as fp:\n+                self.assertEqual(fp.read(), response.content)\n             self.assertEqual(len(response.content), int(response['Content-Length']))\n             self.assertEqual(mimetypes.guess_type(file_path)[1], response.get('Content-Encoding', None))\n \n@@ -40,15 +41,15 @@ def test_unknown_mime_type(self):\n     def test_copes_with_empty_path_component(self):\n         file_name = 'file.txt'\n         response = self.client.get('/views/%s//%s' % (self.prefix, file_name))\n-        file = open(path.join(media_dir, file_name))\n-        self.assertEqual(file.read(), response.content)\n+        with open(path.join(media_dir, file_name)) as fp:\n+            self.assertEqual(fp.read(), response.content)\n \n     def test_is_modified_since(self):\n         file_name = 'file.txt'\n         response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n             HTTP_IF_MODIFIED_SINCE='Thu, 1 Jan 1970 00:00:00 GMT')\n-        file = open(path.join(media_dir, file_name))\n-        self.assertEqual(file.read(), response.content)\n+        with open(path.join(media_dir, file_name)) as fp:\n+            self.assertEqual(fp.read(), response.content)\n \n     def test_not_modified_since(self):\n         file_name = 'file.txt'\n@@ -70,8 +71,8 @@ def test_invalid_if_modified_since(self):\n         invalid_date = 'Mon, 28 May 999999999999 28:25:26 GMT'\n         response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n                                    HTTP_IF_MODIFIED_SINCE=invalid_date)\n-        file = open(path.join(media_dir, file_name))\n-        self.assertEqual(file.read(), response.content)\n+        with open(path.join(media_dir, file_name)) as fp:\n+            self.assertEqual(fp.read(), response.content)\n         self.assertEqual(len(response.content),\n                           int(response['Content-Length']))\n \n@@ -85,8 +86,8 @@ def test_invalid_if_modified_since2(self):\n         invalid_date = ': 1291108438, Wed, 20 Oct 2010 14:05:00 GMT'\n         response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n                                    HTTP_IF_MODIFIED_SINCE=invalid_date)\n-        file = open(path.join(media_dir, file_name))\n-        self.assertEqual(file.read(), response.content)\n+        with open(path.join(media_dir, file_name)) as fp:\n+            self.assertEqual(fp.read(), response.content)\n         self.assertEqual(len(response.content),\n                           int(response['Content-Length']))\n "
        },
        {
            "sha": "50744122e9864fb30f0831195f60d6d8c3a5edfe",
            "filename": "tests/runtests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fruntests.py",
            "raw_url": "https://github.com/django/django/raw/865cd35c9b357e20994f6c6a51f2ae000ba0a3ee/tests%2Fruntests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fruntests.py?ref=865cd35c9b357e20994f6c6a51f2ae000ba0a3ee",
            "patch": "@@ -61,6 +61,7 @@ def get_test_modules():\n         for f in os.listdir(dirpath):\n             if (f.startswith('__init__') or\n                 f.startswith('.') or\n+                f == '__pycache__' or\n                 f.startswith('sql') or\n                 os.path.basename(f) in REGRESSION_SUBDIRS_TO_SKIP):\n                 continue"
        }
    ],
    "stats": {
        "total": 419,
        "additions": 182,
        "deletions": 237
    }
}