{
    "author": "ramiro",
    "message": "Fixed 14796 -- Modified order of operations performed on field names by the inspectdb command so it doesn't generates model fields with names equal to Python keywords. Thanks pappjm at gmail dot com for the report and mmcnickle for the fix.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15296 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "bafe879188f3cd268f81e426bcdf4addc2d9a10a",
    "files": [
        {
            "sha": "5f0e278c61ab1f9db85660db77c743a96a331727",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/bafe879188f3cd268f81e426bcdf4addc2d9a10a/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/bafe879188f3cd268f81e426bcdf4addc2d9a10a/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=bafe879188f3cd268f81e426bcdf4addc2d9a10a",
            "patch": "@@ -20,7 +20,7 @@ class Command(NoArgsCommand):\n     def handle_noargs(self, **options):\n         try:\n             for line in self.handle_inspection(options):\n-                print line\n+                self.stdout.write(\"%s\\n\" % line)\n         except NotImplementedError:\n             raise CommandError(\"Database inspection isn't supported for the currently selected database backend.\")\n \n@@ -66,12 +66,11 @@ def handle_inspection(self, options):\n                 if ' ' in att_name:\n                     att_name = att_name.replace(' ', '_')\n                     comment_notes.append('Field renamed to remove spaces.')\n+                    \n                 if '-' in att_name:\n                     att_name = att_name.replace('-', '_')\n                     comment_notes.append('Field renamed to remove dashes.')\n-                if keyword.iskeyword(att_name):\n-                    att_name += '_field'\n-                    comment_notes.append('Field renamed because it was a Python reserved word.')\n+                    \n                 if column_name != att_name:\n                     comment_notes.append('Field name made lowercase.')\n \n@@ -97,6 +96,10 @@ def handle_inspection(self, options):\n                             extra_params['unique'] = True\n \n                     field_type += '('\n+                    \n+                if keyword.iskeyword(att_name):\n+                    att_name += '_field'\n+                    comment_notes.append('Field renamed because it was a Python reserved word.')\n \n                 # Don't output 'id = meta.AutoField(primary_key=True)', because\n                 # that's assumed if it doesn't exist."
        },
        {
            "sha": "8b137891791fe96927ad78e64b0aad7bded08bdc",
            "filename": "tests/regressiontests/inspectdb/__init__.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2F__init__.py?ref=bafe879188f3cd268f81e426bcdf4addc2d9a10a",
            "patch": "@@ -0,0 +1 @@\n+"
        },
        {
            "sha": "8b137891791fe96927ad78e64b0aad7bded08bdc",
            "filename": "tests/regressiontests/inspectdb/bug/__init__.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Fbug%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Fbug%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Fbug%2F__init__.py?ref=bafe879188f3cd268f81e426bcdf4addc2d9a10a",
            "patch": "@@ -0,0 +1 @@\n+"
        },
        {
            "sha": "6fec2273e0be6411c6506d4a0fff1d6208b53186",
            "filename": "tests/regressiontests/inspectdb/bug/models.py",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Fbug%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Fbug%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Fbug%2Fmodels.py?ref=bafe879188f3cd268f81e426bcdf4addc2d9a10a",
            "patch": "@@ -0,0 +1,7 @@\n+from django.db import models\n+\n+class People(models.Model):\n+    name = models.CharField(max_length=255)\n+\n+class Message(models.Model):\n+    from_field = models.ForeignKey(People, db_column='from_id')"
        },
        {
            "sha": "8b137891791fe96927ad78e64b0aad7bded08bdc",
            "filename": "tests/regressiontests/inspectdb/models.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Fmodels.py?ref=bafe879188f3cd268f81e426bcdf4addc2d9a10a",
            "patch": "@@ -0,0 +1 @@\n+"
        },
        {
            "sha": "30c7948b22184d8e57f2229d33303fb8693aac2f",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/bafe879188f3cd268f81e426bcdf4addc2d9a10a/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=bafe879188f3cd268f81e426bcdf4addc2d9a10a",
            "patch": "@@ -0,0 +1,29 @@\n+import os\n+import sys\n+from StringIO import StringIO\n+\n+from django.conf import settings\n+from django.core.management import call_command\n+from django.db.models.loading import load_app\n+from django.test import TestCase\n+\n+class InspectDBTestCase(TestCase):\n+    \n+    def setUp(self):\n+        self.old_sys_path = sys.path[:]\n+        sys.path.append(os.path.dirname(os.path.abspath(__file__)))\n+        self.old_installed_apps = settings.INSTALLED_APPS\n+        settings.INSTALLED_APPS = ('bug',)\n+        map(load_app, settings.INSTALLED_APPS)\n+        call_command('syncdb', verbosity=0)\n+        \n+    def test_attribute_name_not_python_keyword(self):\n+        out = StringIO()\n+        call_command('inspectdb', stdout=out)\n+        error_message = \"inspectdb generated an attribute name which is a python keyword\"\n+        self.assertNotIn(\"from = models.ForeignKey(BugPeople)\", out.getvalue(), msg=error_message)\n+        out.close()\n+        \n+    def tearDown(self):\n+        settings.INSTALLED_APPS = self.old_installed_apps\n+        sys.path = self.old_sys_path"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 46,
        "deletions": 4
    }
}