{
    "author": "jezdez",
    "message": "Fixed #13154 -- Fixed the URL resolver's reverse() to match the behavior of its resolve() with regard to the default kwargs. Many thanks to patrys.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16177 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "fe96214939b76d1e7389b1c569d833e96e3a5074",
    "files": [
        {
            "sha": "424886e68b6f1accf3aaeef8bdfac62c303e5908",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/fe96214939b76d1e7389b1c569d833e96e3a5074/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/fe96214939b76d1e7389b1c569d833e96e3a5074/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=fe96214939b76d1e7389b1c569d833e96e3a5074",
            "patch": "@@ -206,20 +206,20 @@ def _populate(self):\n                 else:\n                     parent = normalize(pattern.regex.pattern)\n                     for name in pattern.reverse_dict:\n-                        for matches, pat in pattern.reverse_dict.getlist(name):\n+                        for matches, pat, defaults in pattern.reverse_dict.getlist(name):\n                             new_matches = []\n                             for piece, p_args in parent:\n                                 new_matches.extend([(piece + suffix, p_args + args) for (suffix, args) in matches])\n-                            lookups.appendlist(name, (new_matches, p_pattern + pat))\n+                            lookups.appendlist(name, (new_matches, p_pattern + pat, dict(defaults, **pattern.default_kwargs)))\n                     for namespace, (prefix, sub_pattern) in pattern.namespace_dict.items():\n                         namespaces[namespace] = (p_pattern + prefix, sub_pattern)\n                     for app_name, namespace_list in pattern.app_dict.items():\n                         apps.setdefault(app_name, []).extend(namespace_list)\n             else:\n                 bits = normalize(p_pattern)\n-                lookups.appendlist(pattern.callback, (bits, p_pattern))\n+                lookups.appendlist(pattern.callback, (bits, p_pattern, pattern.default_args))\n                 if pattern.name is not None:\n-                    lookups.appendlist(pattern.name, (bits, p_pattern))\n+                    lookups.appendlist(pattern.name, (bits, p_pattern, pattern.default_args))\n         self._reverse_dict = lookups\n         self._namespace_dict = namespaces\n         self._app_dict = apps\n@@ -310,15 +310,22 @@ def reverse(self, lookup_view, *args, **kwargs):\n         except (ImportError, AttributeError), e:\n             raise NoReverseMatch(\"Error importing '%s': %s.\" % (lookup_view, e))\n         possibilities = self.reverse_dict.getlist(lookup_view)\n-        for possibility, pattern in possibilities:\n+        for possibility, pattern, defaults in possibilities:\n             for result, params in possibility:\n                 if args:\n                     if len(args) != len(params):\n                         continue\n                     unicode_args = [force_unicode(val) for val in args]\n                     candidate =  result % dict(zip(params, unicode_args))\n                 else:\n-                    if set(kwargs.keys()) != set(params):\n+                    if set(kwargs.keys() + defaults.keys()) != set(params + defaults.keys()):\n+                        continue\n+                    matches = True\n+                    for k, v in defaults.items():\n+                        if kwargs.get(k, v) != v:\n+                            matches = False\n+                            break\n+                    if not matches:\n                         continue\n                     unicode_kwargs = dict([(k, force_unicode(v)) for (k, v) in kwargs.items()])\n                     candidate = result % unicode_kwargs"
        },
        {
            "sha": "31a928caa2f5b75dec994e5de26988f99e03973f",
            "filename": "tests/regressiontests/urlpatterns_reverse/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/fe96214939b76d1e7389b1c569d833e96e3a5074/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fe96214939b76d1e7389b1c569d833e96e3a5074/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py?ref=fe96214939b76d1e7389b1c569d833e96e3a5074",
            "patch": "@@ -127,8 +127,13 @@\n     ('kwargs_view', '/arg_view/10/', [], {'arg1':10}),\n     ('regressiontests.urlpatterns_reverse.views.absolute_kwargs_view', '/absolute_arg_view/', [], {}),\n     ('regressiontests.urlpatterns_reverse.views.absolute_kwargs_view', '/absolute_arg_view/10/', [], {'arg1':10}),\n-    ('non_path_include', '/includes/non_path_include/', [], {})\n+    ('non_path_include', '/includes/non_path_include/', [], {}),\n \n+    # Tests for #13154\n+    ('defaults', '/defaults_view1/3/', [], {'arg1': 3, 'arg2': 1}),\n+    ('defaults', '/defaults_view2/3/', [], {'arg1': 3, 'arg2': 2}),\n+    ('defaults', NoReverseMatch, [], {'arg1': 3, 'arg2': 3}),\n+    ('defaults', NoReverseMatch, [], {'arg2': 1}),\n )\n \n class NoURLPatternsTests(TestCase):"
        },
        {
            "sha": "ba59cf8f9aa20ae202f838fdd72645e2b6c67210",
            "filename": "tests/regressiontests/urlpatterns_reverse/urls.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/fe96214939b76d1e7389b1c569d833e96e3a5074/tests%2Fregressiontests%2Furlpatterns_reverse%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/fe96214939b76d1e7389b1c569d833e96e3a5074/tests%2Fregressiontests%2Furlpatterns_reverse%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Furls.py?ref=fe96214939b76d1e7389b1c569d833e96e3a5074",
            "patch": "@@ -19,7 +19,7 @@\n     url(r'^people/(?:name/)', empty_view, name=\"people2\"),\n     url(r'^people/(?:name/(\\w+)/)?', empty_view, name=\"people2a\"),\n     url(r'^optional/(?P<name>.*)/(?:.+/)?', empty_view, name=\"optional\"),\n-    url(r'^hardcoded/$', 'hardcoded/', empty_view, name=\"hardcoded\"),\n+    url(r'^hardcoded/$', empty_view, name=\"hardcoded\"),\n     url(r'^hardcoded/doc\\.pdf$', empty_view, name=\"hardcoded2\"),\n     url(r'^people/(?P<state>\\w\\w)/(?P<name>\\w+)/$', empty_view, name=\"people3\"),\n     url(r'^people/(?P<state>\\w\\w)/(?P<name>\\d)/$', empty_view, name=\"people4\"),\n@@ -55,7 +55,11 @@\n     url(r'arg_view/(?P<arg1>\\d+)/$', 'kwargs_view'),\n     url(r'absolute_arg_view/(?P<arg1>\\d+)/$', absolute_kwargs_view),\n     url(r'absolute_arg_view/$', absolute_kwargs_view),\n-    \n+\n+    # Tests for #13154. Mixed syntax to test both ways of defining URLs.\n+    url(r'defaults_view1/(?P<arg1>\\d+)/', 'defaults_view', {'arg2': 1}, name='defaults'),\n+    (r'defaults_view2/(?P<arg1>\\d+)/', 'defaults_view', {'arg2': 2}, 'defaults'),\n+\n     url('^includes/', include(other_patterns)),\n \n )"
        },
        {
            "sha": "538c6231a2038445e8ba820064c17293f7ce4036",
            "filename": "tests/regressiontests/urlpatterns_reverse/views.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/fe96214939b76d1e7389b1c569d833e96e3a5074/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/fe96214939b76d1e7389b1c569d833e96e3a5074/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews.py?ref=fe96214939b76d1e7389b1c569d833e96e3a5074",
            "patch": "@@ -13,6 +13,9 @@ def kwargs_view(request, arg1=1, arg2=2):\n def absolute_kwargs_view(request, arg1=1, arg2=2):\n     return HttpResponse('')\n \n+def defaults_view(request, arg1, arg2):\n+    pass\n+\n class ViewClass(object):\n     def __call__(self, request, *args, **kwargs):\n         return HttpResponse('')"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 28,
        "deletions": 9
    }
}