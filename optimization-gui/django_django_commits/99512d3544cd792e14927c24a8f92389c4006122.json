{
    "author": "jphalip",
    "message": "Fixed #16918 -- Ensured that custom querysets are used when provided to `BaseDateDetailView.get_object()`. Thanks to mitar for the report, to koenb for the patch and to Preston Holmes for the review.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16974 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "99512d3544cd792e14927c24a8f92389c4006122",
    "files": [
        {
            "sha": "a8391d956e0902b892695ef30546cdf154fa6dfa",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/99512d3544cd792e14927c24a8f92389c4006122/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/99512d3544cd792e14927c24a8f92389c4006122/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=99512d3544cd792e14927c24a8f92389c4006122",
            "patch": "@@ -459,7 +459,8 @@ def get_object(self, queryset=None):\n                                  month, self.get_month_format(),\n                                  day, self.get_day_format())\n \n-        qs = self.get_queryset()\n+        # Use a custom queryset if provided\n+        qs = queryset or self.get_queryset()\n \n         if not self.get_allow_future() and date > datetime.date.today():\n             raise Http404(_(u\"Future %(verbose_name_plural)s not available because %(class_name)s.allow_future is False.\") % {"
        },
        {
            "sha": "a0dd867e71cb56b143c2485ede7a046ac617b813",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/99512d3544cd792e14927c24a8f92389c4006122/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/99512d3544cd792e14927c24a8f92389c4006122/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=99512d3544cd792e14927c24a8f92389c4006122",
            "patch": "@@ -412,3 +412,19 @@ def test_date_detail_allow_future(self):\n     def test_invalid_url(self):\n         self.assertRaises(AttributeError, self.client.get, \"/dates/books/2008/oct/01/nopk/\")\n \n+    def test_get_object_custom_queryset(self):\n+        \"\"\"\n+        Ensure that custom querysets are used when provided to\n+        BaseDateDetailView.get_object()\n+        Refs #16918.\n+        \"\"\"\n+        res = self.client.get(\n+            '/dates/books/get_object_custom_queryset/2006/may/01/2/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['object'], Book.objects.get(pk=2))\n+        self.assertEqual(res.context['book'], Book.objects.get(pk=2))\n+        self.assertTemplateUsed(res, 'generic_views/book_detail.html')\n+\n+        res = self.client.get(\n+            '/dates/books/get_object_custom_queryset/2008/oct/01/1/')\n+        self.assertEqual(res.status_code, 404)"
        },
        {
            "sha": "c5c63eec25430c60597ff8fdf48c4cc43eadd1d8",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/99512d3544cd792e14927c24a8f92389c4006122/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/99512d3544cd792e14927c24a8f92389c4006122/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=99512d3544cd792e14927c24a8f92389c4006122",
            "patch": "@@ -216,6 +216,9 @@\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/byslug/(?P<slug>[\\w-]+)/$',\n         views.BookDetail.as_view()),\n \n+    (r'^dates/books/get_object_custom_queryset/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/(?P<pk>\\d+)/$',\n+        views.BookDetailGetObjectCustomQueryset.as_view()),\n+\n     # Useful for testing redirects\n     (r'^accounts/login/$',  'django.contrib.auth.views.login')\n )"
        },
        {
            "sha": "00d00219a4251906bd4ac7e5d84c500deb155bd9",
            "filename": "tests/regressiontests/generic_views/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/99512d3544cd792e14927c24a8f92389c4006122/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/99512d3544cd792e14927c24a8f92389c4006122/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py?ref=99512d3544cd792e14927c24a8f92389c4006122",
            "patch": "@@ -177,3 +177,8 @@ class BookDetail(BookConfig, generic.DateDetailView):\n class AuthorGetQuerySetFormView(generic.edit.ModelFormMixin):\n     def get_queryset(self):\n         return Author.objects.all()\n+\n+class BookDetailGetObjectCustomQueryset(BookDetail):\n+    def get_object(self, queryset=None):\n+        return super(BookDetailGetObjectCustomQueryset,self).get_object(\n+            queryset=Book.objects.filter(pk=2))"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 26,
        "deletions": 1
    }
}