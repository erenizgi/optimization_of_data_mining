{
    "author": "aaugustin",
    "message": "Fixed #17444 -- Made it possible to customize the 'To' header in emails.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17293 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "5e75678c8b7d3cc54aa27b7b682561c5fee64c6c",
    "files": [
        {
            "sha": "39f7afc61b885aa29c5f477ed320f031756e8a70",
            "filename": "django/core/mail/message.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/5e75678c8b7d3cc54aa27b7b682561c5fee64c6c/django%2Fcore%2Fmail%2Fmessage.py",
            "raw_url": "https://github.com/django/django/raw/5e75678c8b7d3cc54aa27b7b682561c5fee64c6c/django%2Fcore%2Fmail%2Fmessage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fmessage.py?ref=5e75678c8b7d3cc54aa27b7b682561c5fee64c6c",
            "patch": "@@ -215,7 +215,7 @@ def message(self):\n         msg = self._create_message(msg)\n         msg['Subject'] = self.subject\n         msg['From'] = self.extra_headers.get('From', self.from_email)\n-        msg['To'] = ', '.join(self.to)\n+        msg['To'] = self.extra_headers.get('To', ', '.join(self.to))\n         if self.cc:\n             msg['Cc'] = ', '.join(self.cc)\n \n@@ -227,7 +227,7 @@ def message(self):\n         if 'message-id' not in header_names:\n             msg['Message-ID'] = make_msgid()\n         for name, value in self.extra_headers.items():\n-            if name.lower() == 'from':  # From is already handled\n+            if name.lower() in ('from', 'to'):  # From and To are already handled\n                 continue\n             msg[name] = value\n         return msg"
        },
        {
            "sha": "52e251f3ee08f8a29a13d69115a04a0a2ba9aafa",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/5e75678c8b7d3cc54aa27b7b682561c5fee64c6c/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/5e75678c8b7d3cc54aa27b7b682561c5fee64c6c/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=5e75678c8b7d3cc54aa27b7b682561c5fee64c6c",
            "patch": "@@ -96,6 +96,24 @@ def test_from_header(self):\n         message = email.message()\n         self.assertEqual(message['From'], 'from@example.com')\n \n+    def test_to_header(self):\n+        \"\"\"\n+        Make sure we can manually set the To header (#17444)\n+        \"\"\"\n+        email = EmailMessage('Subject', 'Content', 'bounce@example.com',\n+                             ['list-subscriber@example.com', 'list-subscriber2@example.com'],\n+                             headers={'To': 'mailing-list@example.com'})\n+        message = email.message()\n+        self.assertEqual(message['To'], 'mailing-list@example.com')\n+        self.assertEqual(email.to, ['list-subscriber@example.com', 'list-subscriber2@example.com'])\n+\n+        # If we don't set the To header manually, it should default to the `to` argument to the constructor\n+        email = EmailMessage('Subject', 'Content', 'bounce@example.com',\n+                             ['list-subscriber@example.com', 'list-subscriber2@example.com'])\n+        message = email.message()\n+        self.assertEqual(message['To'], 'list-subscriber@example.com, list-subscriber2@example.com')\n+        self.assertEqual(email.to, ['list-subscriber@example.com', 'list-subscriber2@example.com'])\n+\n     def test_multiple_message_call(self):\n         \"\"\"\n         Regression for #13259 - Make sure that headers are not changed when"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 20,
        "deletions": 2
    }
}