{
    "author": "clelland",
    "message": "Don't rely on dictionary ordering in tests",
    "sha": "b9fc70141abd4c812b03df50452a0d3ed8cd62d2",
    "files": [
        {
            "sha": "61dc4460dfcecb5dd87982250e2ad20c78604763",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=b9fc70141abd4c812b03df50452a0d3ed8cd62d2",
            "patch": "@@ -18,6 +18,7 @@\n from django.utils._os import upath\n from django.utils import six\n from django.utils.six import PY3, StringIO\n+import json\n \n from .models import (Animal, Stuff, Absolute, Parent, Child, Article, Widget,\n     Store, Person, Book, NKChild, RefToNKChild, Circle1, Circle2, Circle3,\n@@ -334,15 +335,17 @@ def test_dumpdata_uses_default_manager(self):\n         # between different Python versions.\n         data = re.sub('0{6,}\\d', '', data)\n \n-        lion_json = '{\"pk\": 1, \"model\": \"fixtures_regress.animal\", \"fields\": {\"count\": 3, \"weight\": 1.2, \"name\": \"Lion\", \"latin_name\": \"Panthera leo\"}}'\n-        emu_json = '{\"pk\": 10, \"model\": \"fixtures_regress.animal\", \"fields\": {\"count\": 42, \"weight\": 1.2, \"name\": \"Emu\", \"latin_name\": \"Dromaius novaehollandiae\"}}'\n-        platypus_json = '{\"pk\": %d, \"model\": \"fixtures_regress.animal\", \"fields\": {\"count\": 2, \"weight\": 2.2, \"name\": \"Platypus\", \"latin_name\": \"Ornithorhynchus anatinus\"}}'\n-        platypus_json = platypus_json % animal.pk\n+        animals_data = sorted([\n+            {\"pk\": 1, \"model\": \"fixtures_regress.animal\", \"fields\": {\"count\": 3, \"weight\": 1.2, \"name\": \"Lion\", \"latin_name\": \"Panthera leo\"}},\n+            {\"pk\": 10, \"model\": \"fixtures_regress.animal\", \"fields\": {\"count\": 42, \"weight\": 1.2, \"name\": \"Emu\", \"latin_name\": \"Dromaius novaehollandiae\"}},\n+            {\"pk\": animal.pk, \"model\": \"fixtures_regress.animal\", \"fields\": {\"count\": 2, \"weight\": 2.2, \"name\": \"Platypus\", \"latin_name\": \"Ornithorhynchus anatinus\"}},\n+        ], key=lambda x: x[\"pk\"])\n+\n+        data = sorted(json.loads(data), key=lambda x: x[\"pk\"])\n+\n+        self.maxDiff = 1024\n+        self.assertEqual(data, animals_data)\n \n-        self.assertEqual(len(data), len('[%s]' % ', '.join([lion_json, emu_json, platypus_json])))\n-        self.assertTrue(lion_json in data)\n-        self.assertTrue(emu_json in data)\n-        self.assertTrue(platypus_json in data)\n \n     def test_proxy_model_included(self):\n         \"\"\""
        },
        {
            "sha": "ade06845f8aefdc4e661241e136314cbcbdd0fad",
            "filename": "tests/regressiontests/forms/tests/forms.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py?ref=b9fc70141abd4c812b03df50452a0d3ed8cd62d2",
            "patch": "@@ -11,6 +11,7 @@\n from django.test.utils import str_prefix\n from django.utils.datastructures import MultiValueDict, MergeDict\n from django.utils.safestring import mark_safe\n+from django.utils import six\n \n \n class Person(Form):\n@@ -136,11 +137,7 @@ def test_unicode_values(self):\n         self.assertEqual(p.errors['first_name'], ['This field is required.'])\n         self.assertEqual(p.errors['birthday'], ['This field is required.'])\n         self.assertFalse(p.is_valid())\n-        self.assertHTMLEqual(p.errors.as_ul(), '<ul class=\"errorlist\"><li>first_name<ul class=\"errorlist\"><li>This field is required.</li></ul></li><li>birthday<ul class=\"errorlist\"><li>This field is required.</li></ul></li></ul>')\n-        self.assertEqual(p.errors.as_text(), \"\"\"* first_name\n-  * This field is required.\n-* birthday\n-  * This field is required.\"\"\")\n+        self.assertDictEqual(p.errors, {'birthday': ['This field is required.'], 'first_name': ['This field is required.']})\n         self.assertEqual(p.cleaned_data, {'last_name': 'Lennon'})\n         self.assertEqual(p['first_name'].errors, ['This field is required.'])\n         self.assertHTMLEqual(p['first_name'].errors.as_ul(), '<ul class=\"errorlist\"><li>This field is required.</li></ul>')\n@@ -1495,7 +1492,7 @@ def my_function(method, post_data):\n                 form = UserRegistration(auto_id=False)\n \n             if form.is_valid():\n-                return 'VALID: %r' % form.cleaned_data\n+                return 'VALID: %r' % sorted(six.iteritems(form.cleaned_data))\n \n             t = Template('<form action=\"\" method=\"post\">\\n<table>\\n{{ form }}\\n</table>\\n<input type=\"submit\" />\\n</form>')\n             return t.render(Context({'form': form}))\n@@ -1520,7 +1517,8 @@ def my_function(method, post_data):\n <input type=\"submit\" />\n </form>\"\"\")\n         # Case 3: POST with valid data (the success message).)\n-        self.assertHTMLEqual(my_function('POST', {'username': 'adrian', 'password1': 'secret', 'password2': 'secret'}), str_prefix(\"VALID: {'username': %(_)s'adrian', 'password1': %(_)s'secret', 'password2': %(_)s'secret'}\"))\n+        self.assertEqual(my_function('POST', {'username': 'adrian', 'password1': 'secret', 'password2': 'secret'}),\n+                    str_prefix(\"VALID: [('password1', %(_)s'secret'), ('password2', %(_)s'secret'), ('username', %(_)s'adrian')]\"))\n \n     def test_templates_with_forms(self):\n         class UserRegistration(Form):"
        },
        {
            "sha": "d26a728e7b40680de3e2bb87dcba350cc7fd6353",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=b9fc70141abd4c812b03df50452a0d3ed8cd62d2",
            "patch": "@@ -130,15 +130,14 @@ def test_basic_mutable_operations(self):\n             self.assertTrue(q.has_key('foo'))\n         self.assertTrue('foo' in q)\n \n-        self.assertEqual(sorted(list(six.iteritems(q))),\n-                         [('foo', 'another'), ('name', 'john')])\n-        self.assertEqual(sorted(list(six.iterlists(q))),\n-                         [('foo', ['bar', 'baz', 'another']), ('name', ['john'])])\n-        self.assertEqual(sorted(list(six.iterkeys(q))),\n-                         ['foo', 'name'])\n-        self.assertEqual(sorted(list(six.itervalues(q))),\n-                         ['another', 'john'])\n-        self.assertEqual(len(q), 2)\n+        self.assertListEqual(sorted(list(six.iteritems(q))),\n+                             [('foo', 'another'), ('name', 'john')])\n+        self.assertListEqual(sorted(list(six.iterlists(q))),\n+                             [('foo', ['bar', 'baz', 'another']), ('name', ['john'])])\n+        self.assertListEqual(sorted(list(six.iterkeys(q))),\n+                             ['foo', 'name'])\n+        self.assertListEqual(sorted(list(six.itervalues(q))),\n+                             ['another', 'john'])\n \n         q.update({'foo': 'hello'})\n         self.assertEqual(q['foo'], 'hello')"
        },
        {
            "sha": "a8fbf20fd60b2a1b313e65442040530659a4dde4",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b9fc70141abd4c812b03df50452a0d3ed8cd62d2/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=b9fc70141abd4c812b03df50452a0d3ed8cd62d2",
            "patch": "@@ -90,7 +90,17 @@ def test_message_header_overrides(self):\n         \"\"\"\n         headers = {\"date\": \"Fri, 09 Nov 2001 01:08:47 -0000\", \"Message-ID\": \"foo\"}\n         email = EmailMessage('subject', 'content', 'from@example.com', ['to@example.com'], headers=headers)\n-        self.assertEqual(email.message().as_string(), 'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: subject\\nFrom: from@example.com\\nTo: to@example.com\\ndate: Fri, 09 Nov 2001 01:08:47 -0000\\nMessage-ID: foo\\n\\ncontent')\n+\n+        self.assertEqual(sorted(email.message().items()), [\n+            ('Content-Transfer-Encoding', '7bit'),\n+            ('Content-Type', 'text/plain; charset=\"utf-8\"'),\n+            ('From', 'from@example.com'),\n+            ('MIME-Version', '1.0'),\n+            ('Message-ID', 'foo'),\n+            ('Subject', 'subject'),\n+            ('To', 'to@example.com'),\n+            ('date', 'Fri, 09 Nov 2001 01:08:47 -0000'),\n+        ])\n \n     def test_from_header(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 60,
        "additions": 35,
        "deletions": 25
    }
}