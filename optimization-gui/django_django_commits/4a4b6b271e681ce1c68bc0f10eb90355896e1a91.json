{
    "author": "jezdez",
    "message": "Fixed #16080 -- Handle admin list filter items with two characters better. Thanks, Ales Zoulek and Julien Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16274 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
    "files": [
        {
            "sha": "58a84904dc33f2735921f2900643bb3ddaf32f52",
            "filename": "django/contrib/admin/validation.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/django%2Fcontrib%2Fadmin%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/django%2Fcontrib%2Fadmin%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fvalidation.py?ref=4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
            "patch": "@@ -73,18 +73,16 @@ def validate(cls, model):\n                             \" associated with a field name.\"\n                             % (cls.__name__, idx, item.__name__))\n             else:\n-                try:\n-                    # Check for option #2 (tuple)\n-                    field, list_filter_class = item\n-                except (TypeError, ValueError):\n-                    # item is option #1\n-                    field = item\n-                else:\n+                if isinstance(item, (tuple, list)):\n                     # item is option #2\n+                    field, list_filter_class = item\n                     if not issubclass(list_filter_class, FieldListFilter):\n                         raise ImproperlyConfigured(\"'%s.list_filter[%d][1]'\"\n                             \" is '%s' which is not of type FieldListFilter.\"\n                             % (cls.__name__, idx, list_filter_class.__name__))\n+                else:\n+                    # item is option #1\n+                    field = item\n                 # Validate the field string\n                 try:\n                     get_fields_from_path(model, field)"
        },
        {
            "sha": "50d576b8836c1f311affa368e1d316930cb141ae",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
            "patch": "@@ -97,10 +97,10 @@ def get_filters(self, request, use_distinct=False):\n                         self.model, self.model_admin)\n                 else:\n                     field_path = None\n-                    try:\n-                        # This is custom FieldListFilter class for a given field.\n+                    if isinstance(list_filer, (tuple, list)):\n+                        # This is a custom FieldListFilter class for a given field.\n                         field, field_list_filter_class = list_filer\n-                    except (TypeError, ValueError):\n+                    else:\n                         # This is simply a field name, so use the default\n                         # FieldListFilter class that has been registered for\n                         # the type of the given field."
        },
        {
            "sha": "fbf14e87c3a6147da39c5e291eadfea3a831a493",
            "filename": "tests/regressiontests/admin_filters/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Fmodels.py?ref=4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
            "patch": "@@ -8,6 +8,7 @@ class Book(models.Model):\n     contributors = models.ManyToManyField(User, related_name='books_contributed', blank=True, null=True)\n     is_best_seller = models.NullBooleanField(default=0)\n     date_registered = models.DateField(null=True)\n+    no = models.IntegerField(verbose_name=u'number', blank=True, null=True) # This field is intentionally 2 characters long. See #16080.\n \n     def __unicode__(self):\n         return self.title"
        },
        {
            "sha": "cccfe3407752481a330734bd2ccefe65e10192b4",
            "filename": "tests/regressiontests/admin_filters/tests.py",
            "status": "modified",
            "additions": 22,
            "deletions": 3,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py?ref=4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
            "patch": "@@ -66,7 +66,7 @@ class CustomUserAdmin(UserAdmin):\n     list_filter = ('books_authored', 'books_contributed')\n \n class BookAdmin(ModelAdmin):\n-    list_filter = ('year', 'author', 'contributors', 'is_best_seller', 'date_registered')\n+    list_filter = ('year', 'author', 'contributors', 'is_best_seller', 'date_registered', 'no')\n     order_by = '-id'\n \n class DecadeFilterBookAdmin(ModelAdmin):\n@@ -100,8 +100,8 @@ def setUp(self):\n \n         # Books\n         self.djangonaut_book = Book.objects.create(title='Djangonaut: an art of living', year=2009, author=self.alfred, is_best_seller=True, date_registered=self.today)\n-        self.bio_book = Book.objects.create(title='Django: a biography', year=1999, author=self.alfred, is_best_seller=False)\n-        self.django_book = Book.objects.create(title='The Django Book', year=None, author=self.bob, is_best_seller=None, date_registered=self.today)\n+        self.bio_book = Book.objects.create(title='Django: a biography', year=1999, author=self.alfred, is_best_seller=False, no=207)\n+        self.django_book = Book.objects.create(title='The Django Book', year=None, author=self.bob, is_best_seller=None, date_registered=self.today, no=103)\n         self.gipsy_book = Book.objects.create(title='Gipsy guitar for dummies', year=2002, is_best_seller=True, date_registered=self.one_week_ago)\n         self.gipsy_book.contributors = [self.bob, self.lisa]\n         self.gipsy_book.save()\n@@ -528,3 +528,22 @@ def test_simplelistfilter_with_queryset_based_lookups(self):\n         self.assertEqual(choices[2]['display'], u'the 2000\\'s')\n         self.assertEqual(choices[2]['selected'], False)\n         self.assertEqual(choices[2]['query_string'], '?publication-decade=the+00s')\n+\n+    def test_two_characters_long_field(self):\n+        \"\"\"\n+        Ensure that list_filter works with two-characters long field names.\n+        Refs #16080.\n+        \"\"\"\n+        modeladmin = BookAdmin(Book, site)\n+        request = self.request_factory.get('/', {'no': '207'})\n+        changelist = self.get_changelist(request, Book, modeladmin)\n+\n+        # Make sure the correct queryset is returned\n+        queryset = changelist.get_query_set(request)\n+        self.assertEqual(list(queryset), [self.bio_book])\n+\n+        filterspec = changelist.get_filters(request)[0][-1]\n+        self.assertEqual(force_unicode(filterspec.title), u'number')\n+        choices = list(filterspec.choices(changelist))\n+        self.assertEqual(choices[2]['selected'], True)\n+        self.assertEqual(choices[2]['query_string'], '?no=207')"
        },
        {
            "sha": "26eaaae07dcd43e33532a59bd24b94e2a6cc6241",
            "filename": "tests/regressiontests/modeladmin/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fmodeladmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fmodeladmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodeladmin%2Fmodels.py?ref=4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
            "patch": "@@ -34,6 +34,7 @@ class ValidationTestModel(models.Model):\n     is_active = models.BooleanField()\n     pub_date = models.DateTimeField()\n     band = models.ForeignKey(Band)\n+    no = models.IntegerField(verbose_name=\"Number\", blank=True, null=True) # This field is intentionally 2 characters long. See #16080.\n \n     def decade_published_in(self):\n         return self.pub_date.strftime('%Y')[:3] + \"0's\""
        },
        {
            "sha": "7387a95258120c0e4a6b89a8cfe3675cbc86d47d",
            "filename": "tests/regressiontests/modeladmin/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a4b6b271e681ce1c68bc0f10eb90355896e1a91/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py?ref=4a4b6b271e681ce1c68bc0f10eb90355896e1a91",
            "patch": "@@ -911,7 +911,7 @@ class ValidationTestModelAdmin(ModelAdmin):\n         # Valid declarations below -----------\n \n         class ValidationTestModelAdmin(ModelAdmin):\n-            list_filter = ('is_active', AwesomeFilter, ('is_active', BooleanFieldListFilter))\n+            list_filter = ('is_active', AwesomeFilter, ('is_active', BooleanFieldListFilter), 'no')\n \n         validate(ValidationTestModelAdmin, ValidationTestModel)\n "
        }
    ],
    "stats": {
        "total": 47,
        "additions": 33,
        "deletions": 14
    }
}