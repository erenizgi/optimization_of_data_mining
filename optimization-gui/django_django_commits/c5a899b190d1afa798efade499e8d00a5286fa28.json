{
    "author": "aaugustin",
    "message": "Fixed #16787 -- Restored the ability to {% load %} template tags libraries within packages. Thanks Ivan Sagalaev for the report and patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17133 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c5a899b190d1afa798efade499e8d00a5286fa28",
    "files": [
        {
            "sha": "e23420b828d2624991263faa822a4addbf00e96e",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 17,
            "deletions": 3,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/c5a899b190d1afa798efade499e8d00a5286fa28/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/c5a899b190d1afa798efade499e8d00a5286fa28/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=c5a899b190d1afa798efade499e8d00a5286fa28",
            "patch": "@@ -1215,23 +1215,37 @@ def render(self, context):\n             return func\n         return dec\n \n+def is_library_missing(name):\n+    \"\"\"Check if library that failed to load cannot be found under any\n+    templatetags directory or does exist but fails to import.\n+\n+    Non-existing condition is checked recursively for each subpackage in cases\n+    like <appdir>/templatetags/subpackage/package/module.py.\n+    \"\"\"\n+    # Don't bother to check if '.' is in name since any name will be prefixed\n+    # with some template root.\n+    path, module = name.rsplit('.', 1)\n+    try:\n+        package = import_module(path)\n+        return not module_has_submodule(package, module)\n+    except ImportError:\n+        return is_library_missing(path)\n+\n def import_library(taglib_module):\n     \"\"\"\n     Load a template tag library module.\n \n     Verifies that the library contains a 'register' attribute, and\n     returns that attribute as the representation of the library\n     \"\"\"\n-    app_path, taglib = taglib_module.rsplit('.', 1)\n-    app_module = import_module(app_path)\n     try:\n         mod = import_module(taglib_module)\n     except ImportError, e:\n         # If the ImportError is because the taglib submodule does not exist,\n         # that's not an error that should be raised. If the submodule exists\n         # and raised an ImportError on the attempt to load it, that we want\n         # to raise.\n-        if not module_has_submodule(app_module, taglib):\n+        if is_library_missing(taglib_module):\n             return None\n         else:\n             raise InvalidTemplateLibrary(\"ImportError raised loading %s: %s\" %"
        },
        {
            "sha": "757629f47e79c95a7521264b4a90aae317aaecb0",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c5a899b190d1afa798efade499e8d00a5286fa28/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/c5a899b190d1afa798efade499e8d00a5286fa28/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=c5a899b190d1afa798efade499e8d00a5286fa28",
            "patch": "@@ -698,9 +698,10 @@ load\n Loads a custom template tag set.\n \n For example, the following template would load all the tags and filters\n-registered in ``somelibrary`` and ``otherlibrary``::\n+registered in ``somelibrary`` and ``otherlibrary`` located in package\n+``package``::\n \n-    {% load somelibrary otherlibrary %}\n+    {% load somelibrary package.otherlibrary %}\n \n .. versionchanged:: 1.3\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/templates/templatetags/subpackage/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2F__init__.py?ref=c5a899b190d1afa798efade499e8d00a5286fa28"
        },
        {
            "sha": "0e4e862887ce8fb4ff7ecc4598740a33cb7e5ef8",
            "filename": "tests/regressiontests/templates/templatetags/subpackage/echo.py",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2Fecho.py",
            "raw_url": "https://github.com/django/django/raw/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2Fecho.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2Fecho.py?ref=c5a899b190d1afa798efade499e8d00a5286fa28",
            "patch": "@@ -0,0 +1,7 @@\n+from django import template\n+\n+register = template.Library()\n+\n+@register.simple_tag\n+def echo2(arg):\n+    return arg"
        },
        {
            "sha": "c12ea65507fc42f64b4c1665ece8b6fdfee5d14a",
            "filename": "tests/regressiontests/templates/templatetags/subpackage/echo_invalid.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2Fecho_invalid.py",
            "raw_url": "https://github.com/django/django/raw/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2Fecho_invalid.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fsubpackage%2Fecho_invalid.py?ref=c5a899b190d1afa798efade499e8d00a5286fa28",
            "patch": "@@ -0,0 +1 @@\n+import nonexistent.module"
        },
        {
            "sha": "e2743581ae7456cdfb1cb40a4db65374d52cd73a",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c5a899b190d1afa798efade499e8d00a5286fa28/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=c5a899b190d1afa798efade499e8d00a5286fa28",
            "patch": "@@ -1193,17 +1193,22 @@ def get_template_tests(self):\n             'inheritance41': (\"{% extends 'inheritance36' %}{% block opt %}new{{ block.super }}{% endblock %}\", {'numbers': '123'}, '_new1_new2_new3_'),\n \n             ### LOADING TAG LIBRARIES #################################################\n+            'load01': (\"{% load testtags subpackage.echo %}{% echo test %} {% echo2 \\\"test\\\" %}\", {}, \"test test\"),\n+            'load02': (\"{% load subpackage.echo %}{% echo2 \\\"test\\\" %}\", {}, \"test\"),\n \n             # {% load %} tag, importing individual tags\n-            'load1': (\"{% load echo from testtags %}{% echo this that theother %}\", {}, 'this that theother'),\n-            'load2': (\"{% load echo other_echo from testtags %}{% echo this that theother %} {% other_echo and another thing %}\", {}, 'this that theother and another thing'),\n-            'load3': (\"{% load echo upper from testtags %}{% echo this that theother %} {{ statement|upper }}\", {'statement': 'not shouting'}, 'this that theother NOT SHOUTING'),\n+            'load03': (\"{% load echo from testtags %}{% echo this that theother %}\", {}, 'this that theother'),\n+            'load04': (\"{% load echo other_echo from testtags %}{% echo this that theother %} {% other_echo and another thing %}\", {}, 'this that theother and another thing'),\n+            'load05': (\"{% load echo upper from testtags %}{% echo this that theother %} {{ statement|upper }}\", {'statement': 'not shouting'}, 'this that theother NOT SHOUTING'),\n+            'load06': (\"{% load echo2 from subpackage.echo %}{% echo2 \\\"test\\\" %}\", {}, \"test\"),\n \n             # {% load %} tag errors\n-            'load4': (\"{% load echo other_echo bad_tag from testtags %}\", {}, template.TemplateSyntaxError),\n-            'load5': (\"{% load echo other_echo bad_tag from %}\", {}, template.TemplateSyntaxError),\n-            'load6': (\"{% load from testtags %}\", {}, template.TemplateSyntaxError),\n-            'load7': (\"{% load echo from bad_library %}\", {}, template.TemplateSyntaxError),\n+            'load07': (\"{% load echo other_echo bad_tag from testtags %}\", {}, template.TemplateSyntaxError),\n+            'load08': (\"{% load echo other_echo bad_tag from %}\", {}, template.TemplateSyntaxError),\n+            'load09': (\"{% load from testtags %}\", {}, template.TemplateSyntaxError),\n+            'load10': (\"{% load echo from bad_library %}\", {}, template.TemplateSyntaxError),\n+            'load11': (\"{% load subpackage.echo_invalid %}\", {}, template.TemplateSyntaxError),\n+            'load12': (\"{% load subpackage.missing %}\", {}, template.TemplateSyntaxError),\n \n             ### I18N ##################################################################\n "
        }
    ],
    "stats": {
        "total": 52,
        "additions": 40,
        "deletions": 12
    }
}