{
    "author": "jezdez",
    "message": "Fixed #16717 -- Added ability to store result of trans template tag in context variable.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16712 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3256862f5f05dac1744b584e232270070ff7c3a8",
    "files": [
        {
            "sha": "8fc312c0664ae0bb92e2235c4d7779d608ada89e",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 21,
            "deletions": 10,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/3256862f5f05dac1744b584e232270070ff7c3a8/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/3256862f5f05dac1744b584e232270070ff7c3a8/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=3256862f5f05dac1744b584e232270070ff7c3a8",
            "patch": "@@ -70,16 +70,22 @@ def render(self, context):\n \n \n class TranslateNode(Node):\n-    def __init__(self, filter_expression, noop):\n+    def __init__(self, filter_expression, noop, asvar=None):\n         self.noop = noop\n+        self.asvar = asvar\n         self.filter_expression = filter_expression\n         if isinstance(self.filter_expression.var, basestring):\n             self.filter_expression.var = Variable(u\"'%s'\" % self.filter_expression.var)\n \n     def render(self, context):\n         self.filter_expression.var.translate = not self.noop\n         output = self.filter_expression.resolve(context)\n-        return _render_value_in_context(output, context)\n+        value = _render_value_in_context(output, context)\n+        if self.asvar:\n+            context[self.asvar] = value\n+            return ''\n+        else:\n+            return value\n \n \n class BlockTranslateNode(Node):\n@@ -296,16 +302,21 @@ def top(self):\n                 elif value[-1] == \"'\":\n                     value = '\"%s\"' % value[1:-1].replace('\"','\\\\\"')\n \n-            if self.more():\n-                if self.tag() == 'noop':\n+            noop = False\n+            asvar = None\n+\n+            while self.more():\n+                tag = self.tag()\n+                if tag == 'noop':\n                     noop = True\n+                elif tag == 'as':\n+                    asvar = self.tag()\n                 else:\n-                    raise TemplateSyntaxError(\"only option for 'trans' is 'noop'\")\n-            else:\n-                noop = False\n-            return (value, noop)\n-    value, noop = TranslateParser(token.contents).top()\n-    return TranslateNode(parser.compile_filter(value), noop)\n+                    raise TemplateSyntaxError(\n+                        \"only options for 'trans' are 'noop' and 'as VAR.\")\n+            return (value, noop, asvar)\n+    value, noop, asvar = TranslateParser(token.contents).top()\n+    return TranslateNode(parser.compile_filter(value), noop, asvar)\n \n @register.tag(\"blocktrans\")\n def do_block_translate(parser, token):"
        },
        {
            "sha": "4e59acff3a41f6e8d5a4f8dc9d8716fb3035e91e",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/3256862f5f05dac1744b584e232270070ff7c3a8/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/3256862f5f05dac1744b584e232270070ff7c3a8/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=3256862f5f05dac1744b584e232270070ff7c3a8",
            "patch": "@@ -283,6 +283,10 @@ Django 1.4 also includes several smaller improvements worth noting:\n   about :ref:`the 403 (HTTP Forbidden) view<http_forbidden_view>` for more\n   information.\n \n+* The :ttag:`trans` template tag now takes an optional ``as`` argument to\n+  be able to retrieve a translation string without displaying it but setting\n+  a template context variable instead.\n+\n .. _backwards-incompatible-changes-1.4:\n \n Backwards incompatible changes in 1.4"
        },
        {
            "sha": "176ad7fb43efa827f67b82a6358ec9d670b77902",
            "filename": "docs/topics/i18n/internationalization.txt",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/3256862f5f05dac1744b584e232270070ff7c3a8/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "raw_url": "https://github.com/django/django/raw/3256862f5f05dac1744b584e232270070ff7c3a8/docs%2Ftopics%2Fi18n%2Finternationalization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Finternationalization.txt?ref=3256862f5f05dac1744b584e232270070ff7c3a8",
            "patch": "@@ -451,6 +451,32 @@ It's not possible to mix a template variable inside a string within ``{% trans\n %}``. If your translations require strings with variables (placeholders), use\n ``{% blocktrans %}`` instead.\n \n+.. versionchanged:: 1.4\n+\n+If you'd like to retrieve a translated string without displaying it, you can\n+use the following syntax::\n+\n+    {% trans \"This is the title\" as the_title %}\n+\n+    <title>{{ the_title }}</title>\n+    <meta name=\"description\" content=\"{{ the_title }}\">\n+\n+In practice you'll use this to get strings that are used in multiple places\n+or should be used as arguments for other template tags or filters::\n+\n+    {% trans \"starting point\" as start %}\n+    {% trans \"end point\" as end %}\n+    {% trans \"La Grande Boucle\" as race %}\n+\n+    <h1>\n+      <a href=\"/\" title=\"{% blocktrans %}Back to '{{ race }}' homepage{% endblocktrans %}\">{{ race }}</a>\n+    </h1>\n+    <p>\n+    {% for stage in tour_stages %}\n+        {% cycle start end %}: {{ stage }}{% if forloop.counter|divisibleby:2 %}<br />{% else %}, {% endif %}\n+    {% endfor %}\n+    </p>\n+\n .. templatetag:: blocktrans\n \n ``blocktrans`` template tag"
        },
        {
            "sha": "2064f1398334ae2367353aa78ebee90ac1155d0e",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/3256862f5f05dac1744b584e232270070ff7c3a8/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/3256862f5f05dac1744b584e232270070ff7c3a8/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=3256862f5f05dac1744b584e232270070ff7c3a8",
            "patch": "@@ -1294,6 +1294,12 @@ def get_template_tests(self):\n             # blocktrans handling of variables which are not in the context.\n             'i18n34': ('{% load i18n %}{% blocktrans %}{{ missing }}{% endblocktrans %}', {}, u''),\n \n+            # trans tag with as var\n+            'i18n35': ('{% load i18n %}{% trans \"Page not found\" as page_not_found %}{{ page_not_found }}', {'LANGUAGE_CODE': 'de'}, \"Seite nicht gefunden\"),\n+            'i18n36': ('{% load i18n %}{% trans \"Page not found\" noop as page_not_found %}{{ page_not_found }}', {'LANGUAGE_CODE': 'de'}, \"Page not found\"),\n+            'i18n36': ('{% load i18n %}{% trans \"Page not found\" as page_not_found noop %}{{ page_not_found }}', {'LANGUAGE_CODE': 'de'}, \"Page not found\"),\n+            'i18n37': ('{% load i18n %}{% trans \"Page not found\" as page_not_found %}{% blocktrans %}Error: {{ page_not_found }}{% endblocktrans %}', {'LANGUAGE_CODE': 'de'}, \"Error: Seite nicht gefunden\"),\n+\n             ### HANDLING OF TEMPLATE_STRING_IF_INVALID ###################################\n \n             'invalidstr01': ('{{ var|default:\"Foo\" }}', {}, ('Foo','INVALID')),"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 57,
        "deletions": 10
    }
}