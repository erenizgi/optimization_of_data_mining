{
    "author": "ramiro",
    "message": "Tweaked tests from r17702 to run only when using sqlite3 DB(s).\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17733 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "eb9eaa6d7182e8156699a692916af4b167cdc363",
    "files": [
        {
            "sha": "22e9fe6af51123de6d038c41fec60dc1f5bf2438",
            "filename": "tests/regressiontests/test_runner/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 12,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/eb9eaa6d7182e8156699a692916af4b167cdc363/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eb9eaa6d7182e8156699a692916af4b167cdc363/tests%2Fregressiontests%2Ftest_runner%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_runner%2Ftests.py?ref=eb9eaa6d7182e8156699a692916af4b167cdc363",
            "patch": "@@ -9,6 +9,7 @@\n \n from django.core.exceptions import ImproperlyConfigured\n from django.core.management import call_command\n+from django import db\n from django.test import simple\n from django.test.simple import DjangoTestSuiteRunner, get_tests\n from django.test.testcases import connections_support_transactions\n@@ -218,7 +219,6 @@ def test_all_options_given(self):\n class Ticket16885RegressionTests(unittest.TestCase):\n     def test_ticket_16885(self):\n         \"\"\"Features are also confirmed on mirrored databases.\"\"\"\n-        from django import db\n         old_db_connections = db.connections\n         try:\n             db.connections = db.ConnectionHandler({\n@@ -266,9 +266,11 @@ def test_import_error(self):\n \n \n class Sqlite3InMemoryTestDbs(unittest.TestCase):\n+\n+    @unittest.skipUnless(all(db.connections[conn].vendor == 'sqlite' for conn in db.connections),\n+                         \"This is a sqlite-specific issue\")\n     def test_transaction_support(self):\n         \"\"\"Ticket #16329: sqlite3 in-memory test databases\"\"\"\n-        from django import db\n         old_db_connections = db.connections\n         for option in ('NAME', 'TEST_NAME'):\n             try:\n@@ -283,18 +285,12 @@ def test_transaction_support(self):\n                     },\n                 })\n                 other = db.connections['other']\n-                self.assertEqual(other.features.supports_transactions, None)\n+                self.assertIsNone(other.features.supports_transactions)\n                 DjangoTestSuiteRunner(verbosity=0).setup_databases()\n+                msg = \"DATABASES setting '%s' option set to sqlite3's ':memory:' value shouldn't interfere with transaction support detection.\" % option\n                 # Transaction support should be properly initialised for the 'other' DB\n-                self.assertNotEqual(\n-                    other.features.supports_transactions,\n-                    None,\n-                    \"DATABASES setting '%s' option set to sqlite3's ':memory:' value causes problems with transaction support detection.\" % option\n-                )\n+                self.assertIsNotNone(other.features.supports_transactions, msg)\n                 # And all the DBs should report that they support transactions\n-                self.assertTrue(\n-                    connections_support_transactions(),\n-                    \"DATABASES setting '%s' option set to sqlite3's ':memory:' value causes problems with transaction support detection.\" % option\n-                )\n+                self.assertTrue(connections_support_transactions(), msg)\n             finally:\n                 db.connections = old_db_connections"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 8,
        "deletions": 12
    }
}