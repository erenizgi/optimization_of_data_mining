{
    "author": "jezdez",
    "message": "Fixed #15813 -- Updated Indian localflavor to use correct state choices and fixed various other bugs. Thanks, jsdalton.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16480 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "940aed10b7bdd8f25aff38b8b923deb94ce4cee4",
    "files": [
        {
            "sha": "afc5534f92c2c44aef059056994ba1aa222a551a",
            "filename": "django/contrib/localflavor/in_/forms.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py?ref=940aed10b7bdd8f25aff38b8b923deb94ce4cee4",
            "patch": "@@ -1,32 +1,40 @@\n \"\"\"\n India-specific Form helpers.\n \"\"\"\n+import re\n \n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select\n from django.utils.encoding import smart_unicode\n-from django.utils.translation import gettext\n-import re\n+from django.utils.translation import ugettext_lazy as _\n \n \n class INZipCodeField(RegexField):\n     default_error_messages = {\n-        'invalid': gettext(u'Enter a zip code in the format XXXXXXX.'),\n+        'invalid': _(u'Enter a zip code in the format XXXXXX or XXX XXX.'),\n     }\n \n     def __init__(self, max_length=None, min_length=None, *args, **kwargs):\n-        super(INZipCodeField, self).__init__(r'^\\d{6}$',\n+        super(INZipCodeField, self).__init__(r'^\\d{3}\\s?\\d{3}$',\n             max_length, min_length, *args, **kwargs)\n \n+    def clean(self, value):\n+        super(INZipCodeField, self).clean(value)\n+        if value in EMPTY_VALUES:\n+            return u''\n+        # Convert to \"NNNNNN\" if \"NNN NNN\" given\n+        value = re.sub(r'^(\\d{3})\\s(\\d{3})$', r'\\1\\2', value)\n+        return value\n+\n class INStateField(Field):\n     \"\"\"\n     A form field that validates its input is a Indian state name or\n     abbreviation. It normalizes the input to the standard two-letter vehicle\n     registration abbreviation for the given state or union territory\n     \"\"\"\n     default_error_messages = {\n-        'invalid': u'Enter a Indian state or territory.',\n+        'invalid': _(u'Enter an Indian state or territory.'),\n     }\n \n     def clean(self, value):"
        },
        {
            "sha": "375b201311fa27f9c6216f6c5bc3019848a3bf52",
            "filename": "django/contrib/localflavor/in_/in_states.py",
            "status": "modified",
            "additions": 72,
            "deletions": 22,
            "changes": 94,
            "blob_url": "https://github.com/django/django/blob/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/django%2Fcontrib%2Flocalflavor%2Fin_%2Fin_states.py",
            "raw_url": "https://github.com/django/django/raw/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/django%2Fcontrib%2Flocalflavor%2Fin_%2Fin_states.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fin_%2Fin_states.py?ref=940aed10b7bdd8f25aff38b8b923deb94ce4cee4",
            "patch": "@@ -47,37 +47,87 @@\n )\n \n STATES_NORMALIZED = {\n-    'ka': 'KA',\n-    'karnatka': 'KA',\n-    'tn': 'TN',\n-    'tamilnad': 'TN',\n-    'tamilnadu': 'TN',\n+    'an': 'AN',\n+    'andaman and nicobar': 'AN',\n     'andra pradesh': 'AP',\n     'andrapradesh': 'AP',\n     'andhrapradesh': 'AP',\n-    'maharastra': 'MH',\n-    'mh': 'MH',\n     'ap': 'AP',\n-    'dl': 'DL',\n-    'dd': 'DD',\n-    'br': 'BR',\n+    'andhra pradesh': 'AP',\n     'ar': 'AR',\n-    'sk': 'SK',\n-    'kl': 'KL',\n+    'arunachal pradesh': 'AR',\n+    'assam': 'AS',\n+    'as': 'AS',\n+    'bihar': 'BR',\n+    'br': 'BR',\n+    'cg': 'CG',\n+    'chattisgarh': 'CG',\n+    'ch': 'CH',\n+    'chandigarh': 'CH',\n+    'daman and diu': 'DD',\n+    'dd': 'DD',\n+    'dl': 'DL',\n+    'delhi': 'DL',\n+    'dn': 'DN',\n+    'dadra and nagar haveli': 'DN',\n     'ga': 'GA',\n-    'rj': 'RJ',\n-    'rajastan': 'RJ',\n-    'rajasthan': 'RJ',\n+    'goa': 'GA',\n+    'gj': 'GJ',\n+    'gujarat': 'GJ',\n+    'himachal pradesh': 'HP',\n     'hp': 'HP',\n-    'ua': 'UA',\n-    'up': 'UP',\n+    'hr': 'HR',\n+    'haryana': 'HR',\n+    'jharkhand': 'JH',\n+    'jh': 'JH',\n+    'jammu and kashmir': 'JK',\n+    'jk': 'JK',\n+    'karnataka': 'KA',\n+    'karnatka': 'KA',\n+    'ka': 'KA',\n+    'kerala': 'KL',\n+    'kl': 'KL',\n+    'ld': 'LD',\n+    'lakshadweep': 'LD',\n+    'maharastra': 'MH',\n+    'mh': 'MH',\n+    'maharashtra': 'MH',\n+    'meghalaya': 'ML',\n+    'ml': 'ML',\n+    'mn': 'MN',\n+    'manipur': 'MN',\n+    'madhya pradesh': 'MP',\n     'mp': 'MP',\n-    'mz': 'MZ',\n-    'bengal': 'WB',\n-    'westbengal': 'WB',\n+    'mizoram': 'MZ',\n     'mizo': 'MZ',\n-    'orisa': 'OR',\n+    'mz': 'MZ',\n+    'nl': 'NL',\n+    'nagaland': 'NL',\n+    'orissa': 'OR',\n     'odisa': 'OR',\n+    'orisa': 'OR',\n     'or': 'OR',\n+    'pb': 'PB',\n+    'punjab': 'PB',\n+    'py': 'PY',\n+    'pondicherry': 'PY',\n+    'rajasthan': 'RJ',\n+    'rajastan': 'RJ',\n+    'rj': 'RJ',\n+    'sikkim': 'SK',\n+    'sk': 'SK',\n+    'tamil nadu': 'TN',\n+    'tn': 'TN',\n+    'tamilnadu': 'TN',\n+    'tamilnad': 'TN',\n+    'tr': 'TR',\n+    'tripura': 'TR',\n+    'ua': 'UA',\n+    'uttarakhand': 'UA',\n+    'up': 'UP',\n+    'uttar pradesh': 'UP',\n+    'westbengal': 'WB',\n+    'bengal': 'WB',\n+    'wb': 'WB',\n+    'west bengal': 'WB'\n }\n-"
        },
        {
            "sha": "17553667a792ac3eacd719d3adaf7f501c49901c",
            "filename": "tests/regressiontests/forms/localflavor/in_.py",
            "status": "added",
            "additions": 158,
            "deletions": 0,
            "changes": 158,
            "blob_url": "https://github.com/django/django/blob/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fin_.py",
            "raw_url": "https://github.com/django/django/raw/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fin_.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fin_.py?ref=940aed10b7bdd8f25aff38b8b923deb94ce4cee4",
            "patch": "@@ -0,0 +1,158 @@\n+import warnings\n+\n+from django.contrib.localflavor.in_.forms import (INZipCodeField,\n+                                                  INStateField, INStateSelect)\n+\n+from utils import LocalFlavorTestCase\n+\n+\n+class INLocalFlavorTests(LocalFlavorTestCase):\n+    def test_INPStateSelect(self):\n+        f = INStateSelect()\n+        out = u'''<select name=\"state\">\n+<option value=\"KA\">Karnataka</option>\n+<option value=\"AP\" selected=\"selected\">Andhra Pradesh</option>\n+<option value=\"KL\">Kerala</option>\n+<option value=\"TN\">Tamil Nadu</option>\n+<option value=\"MH\">Maharashtra</option>\n+<option value=\"UP\">Uttar Pradesh</option>\n+<option value=\"GA\">Goa</option>\n+<option value=\"GJ\">Gujarat</option>\n+<option value=\"RJ\">Rajasthan</option>\n+<option value=\"HP\">Himachal Pradesh</option>\n+<option value=\"JK\">Jammu and Kashmir</option>\n+<option value=\"AR\">Arunachal Pradesh</option>\n+<option value=\"AS\">Assam</option>\n+<option value=\"BR\">Bihar</option>\n+<option value=\"CG\">Chattisgarh</option>\n+<option value=\"HR\">Haryana</option>\n+<option value=\"JH\">Jharkhand</option>\n+<option value=\"MP\">Madhya Pradesh</option>\n+<option value=\"MN\">Manipur</option>\n+<option value=\"ML\">Meghalaya</option>\n+<option value=\"MZ\">Mizoram</option>\n+<option value=\"NL\">Nagaland</option>\n+<option value=\"OR\">Orissa</option>\n+<option value=\"PB\">Punjab</option>\n+<option value=\"SK\">Sikkim</option>\n+<option value=\"TR\">Tripura</option>\n+<option value=\"UA\">Uttarakhand</option>\n+<option value=\"WB\">West Bengal</option>\n+<option value=\"AN\">Andaman and Nicobar</option>\n+<option value=\"CH\">Chandigarh</option>\n+<option value=\"DN\">Dadra and Nagar Haveli</option>\n+<option value=\"DD\">Daman and Diu</option>\n+<option value=\"DL\">Delhi</option>\n+<option value=\"LD\">Lakshadweep</option>\n+<option value=\"PY\">Pondicherry</option>\n+</select>'''\n+        self.assertEqual(f.render('state', 'AP'), out)\n+\n+    def test_INZipCodeField(self):\n+        error_format = [u'Enter a zip code in the format XXXXXX or XXX XXX.']\n+        valid = {\n+            '360311': '360311',\n+            '360 311': '360311',\n+        }\n+        invalid = {\n+            '36 0311': error_format,\n+            '3603111': error_format,\n+            '360 31': error_format,\n+            '36031': error_format,\n+            'O2B 2R3': error_format\n+        }\n+        self.assertFieldOutput(INZipCodeField, valid, invalid)\n+\n+    def test_INStateField(self):\n+        error_format = [u'Enter an Indian state or territory.']\n+        valid = {\n+            'an': 'AN',\n+            'AN': 'AN',\n+            'andaman and nicobar': 'AN',\n+            'andra pradesh': 'AP',\n+            'andrapradesh': 'AP',\n+            'andhrapradesh': 'AP',\n+            'ap': 'AP',\n+            'andhra pradesh': 'AP',\n+            'ar': 'AR',\n+            'arunachal pradesh': 'AR',\n+            'assam': 'AS',\n+            'as': 'AS',\n+            'bihar': 'BR',\n+            'br': 'BR',\n+            'cg': 'CG',\n+            'chattisgarh': 'CG',\n+            'ch': 'CH',\n+            'chandigarh': 'CH',\n+            'daman and diu': 'DD',\n+            'dd': 'DD',\n+            'dl': 'DL',\n+            'delhi': 'DL',\n+            'dn': 'DN',\n+            'dadra and nagar haveli': 'DN',\n+            'ga': 'GA',\n+            'goa': 'GA',\n+            'gj': 'GJ',\n+            'gujarat': 'GJ',\n+            'himachal pradesh': 'HP',\n+            'hp': 'HP',\n+            'hr': 'HR',\n+            'haryana': 'HR',\n+            'jharkhand': 'JH',\n+            'jh': 'JH',\n+            'jammu and kashmir': 'JK',\n+            'jk': 'JK',\n+            'karnataka': 'KA',\n+            'karnatka': 'KA',\n+            'ka': 'KA',\n+            'kerala': 'KL',\n+            'kl': 'KL',\n+            'ld': 'LD',\n+            'lakshadweep': 'LD',\n+            'maharastra': 'MH',\n+            'mh': 'MH',\n+            'maharashtra': 'MH',\n+            'meghalaya': 'ML',\n+            'ml': 'ML',\n+            'mn': 'MN',\n+            'manipur': 'MN',\n+            'madhya pradesh': 'MP',\n+            'mp': 'MP',\n+            'mizoram': 'MZ',\n+            'mizo': 'MZ',\n+            'mz': 'MZ',\n+            'nl': 'NL',\n+            'nagaland': 'NL',\n+            'orissa': 'OR',\n+            'odisa': 'OR',\n+            'orisa': 'OR',\n+            'or': 'OR',\n+            'pb': 'PB',\n+            'punjab': 'PB',\n+            'py': 'PY',\n+            'pondicherry': 'PY',\n+            'rajasthan': 'RJ',\n+            'rajastan': 'RJ',\n+            'rj': 'RJ',\n+            'sikkim': 'SK',\n+            'sk': 'SK',\n+            'tamil nadu': 'TN',\n+            'tn': 'TN',\n+            'tamilnadu': 'TN',\n+            'tamilnad': 'TN',\n+            'tr': 'TR',\n+            'tripura': 'TR',\n+            'ua': 'UA',\n+            'uttarakhand': 'UA',\n+            'up': 'UP',\n+            'uttar pradesh': 'UP',\n+            'westbengal': 'WB',\n+            'bengal': 'WB',\n+            'wb': 'WB',\n+            'west bengal': 'WB'\n+        }\n+        invalid = {\n+            'florida': error_format,\n+            'FL': error_format,\n+        }\n+        self.assertFieldOutput(INStateField, valid, invalid)"
        },
        {
            "sha": "7f29feae3f1de6b16e6ebeb9b00a53945d63839e",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=940aed10b7bdd8f25aff38b8b923deb94ce4cee4",
            "patch": "@@ -20,6 +20,7 @@\n from localflavor.ie import IELocalFlavorTests\n from localflavor.il import ILLocalFlavorTests\n from localflavor.is_ import ISLocalFlavorTests\n+from localflavor.in_ import INLocalFlavorTests\n from localflavor.it import ITLocalFlavorTests\n from localflavor.jp import JPLocalFlavorTests\n from localflavor.kw import KWLocalFlavorTests"
        },
        {
            "sha": "67154514d721b93e134ffbeaa84472f68ac617fd",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/940aed10b7bdd8f25aff38b8b923deb94ce4cee4/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=940aed10b7bdd8f25aff38b8b923deb94ce4cee4",
            "patch": "@@ -33,6 +33,7 @@\n     IELocalFlavorTests,\n     ILLocalFlavorTests,\n     ISLocalFlavorTests,\n+    INLocalFlavorTests,\n     ITLocalFlavorTests,\n     JPLocalFlavorTests,\n     KWLocalFlavorTests,"
        }
    ],
    "stats": {
        "total": 272,
        "additions": 245,
        "deletions": 27
    }
}