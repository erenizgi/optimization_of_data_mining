{
    "author": "spookylukey",
    "message": "Fixed #15805 - assertFieldOutput should not use assertRaisesRegexp\n\nThanks to julien for the report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16303 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
    "files": [
        {
            "sha": "b324e078106540ba68ffa3dddd984d8c20c5f425",
            "filename": "tests/regressiontests/forms/localflavor/__init__.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2F__init__.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -0,0 +1,11 @@\n+from django.forms import EmailField\n+from utils import LocalFlavorTestCase\n+\n+class AssertFieldOutputTests(LocalFlavorTestCase):\n+\n+    def test_assert_field_output(self):\n+        error_invalid = [u'Enter a valid e-mail address.']\n+        self.assertFieldOutput(EmailField, {'a@a.com': 'a@a.com'}, {'aaa': error_invalid})\n+        self.assertRaises(AssertionError, self.assertFieldOutput, EmailField, {'a@a.com': 'a@a.com'}, {'aaa': error_invalid + [u'Another error']})\n+        self.assertRaises(AssertionError, self.assertFieldOutput, EmailField, {'a@a.com': 'Wrong output'}, {'aaa': error_invalid})\n+        self.assertRaises(AssertionError, self.assertFieldOutput, EmailField, {'a@a.com': 'a@a.com'}, {'aaa': [u'Come on, gimme some well formatted data, dude.']})"
        },
        {
            "sha": "ddf2b8eb6d7b907b1e3df6bcfaf3fd347f5ff64d",
            "filename": "tests/regressiontests/forms/localflavor/au.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fau.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fau.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fau.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -20,14 +20,14 @@ def test_AUStateSelect(self):\n         self.assertEqual(f.render('state', 'NSW'), out)\n \n     def test_AUPostCodeField(self):\n-        error_format = [u'Enter a 4 digit post code.']\n+        error_format = [u'Enter a 4 digit postcode.']\n         valid = {\n             '1234': '1234',\n             '2000': '2000',\n         }\n         invalid = {\n             'abcd': error_format,\n-            '20001': error_format,\n+            '20001': [u'Ensure this value has at most 4 characters (it has 5).'] + error_format,\n         }\n         self.assertFieldOutput(AUPostCodeField, valid, invalid)\n "
        },
        {
            "sha": "27d747ccc45cdc97f72eb3fdc65dc6a34d376c36",
            "filename": "tests/regressiontests/forms/localflavor/hr.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fhr.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fhr.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fhr.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -158,7 +158,7 @@ def test_HROIBField(self):\n             '12345678901': '12345678901',\n         }\n         invalid = {\n-            '1234567890': error_invalid,\n+            '1234567890': [u'Ensure this value has at least 11 characters (it has 10).'] + error_invalid,\n             'ABCDEFGHIJK': error_invalid,\n         }\n         self.assertFieldOutput(HROIBField, valid, invalid)"
        },
        {
            "sha": "b8d784af1968fef2fe795358586a78a828a43e07",
            "filename": "tests/regressiontests/forms/localflavor/pt.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fpt.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fpt.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fpt.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -17,7 +17,7 @@ def test_PTZipCodeField(self):\n         self.assertFieldOutput(PTZipCodeField, valid, invalid)\n \n     def test_PTPhoneNumberField(self):\n-        error_format = [u'Phone numbers must have 9 digits, or start by + or 00']\n+        error_format = [u'Phone numbers must have 9 digits, or start by + or 00.']\n         valid = {\n             '917845189': '917845189',\n             '91 784 5189': '917845189',"
        },
        {
            "sha": "94e6652af813316b7550dad3db4fa379a6936e8e",
            "filename": "tests/regressiontests/forms/localflavor/ro.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fro.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fro.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fro.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -66,7 +66,7 @@ def test_ROCIFField(self):\n         invalid = {\n             '21694680': error_invalid,\n             '21694680000': error_atmost,\n-            '0': error_atleast,\n+            '0': error_atleast + error_invalid,\n         }\n         self.assertFieldOutput(ROCIFField, valid, invalid)\n \n@@ -81,7 +81,7 @@ def test_ROCNPField(self):\n             '1981211204487': error_invalid,\n             '1981232204489': error_invalid,\n             '9981211204489': error_invalid,\n-            '9981211209': error_atleast,\n+            '9981211209': error_atleast + error_invalid,\n             '19812112044891': error_atmost,\n         }\n         self.assertFieldOutput(ROCNPField, valid, invalid)\n@@ -109,32 +109,34 @@ def test_ROIBANField(self):\n         invalid = {\n             'RO56RZBR0000060003291176': error_invalid,\n             'AT61 1904 3002 3457 3201': error_invalid,\n-            'RO56RZBR000006000329117': error_atleast,\n+            'RO56RZBR000006000329117': error_atleast + error_invalid,\n         }\n         self.assertFieldOutput(ROIBANField, valid, invalid)\n \n     def test_ROPhoneNumberField(self):\n         error_format = [u'Phone numbers must be in XXXX-XXXXXX format.']\n         error_atleast = [u'Ensure this value has at least 10 characters (it has 9).']\n+        error_invalid = [u'Phone numbers must be in XXXX-XXXXXX format.']\n         valid = {\n             '0264485936': '0264485936',\n             '(0264)-485936': '0264485936',\n         }\n         invalid = {\n             '02644859368': error_format,\n-            '026448593': error_atleast,\n+            '026448593': error_atleast + error_invalid,\n         }\n         self.assertFieldOutput(ROPhoneNumberField, valid, invalid)\n \n     def test_ROPostalCodeField(self):\n         error_atleast = [u'Ensure this value has at least 6 characters (it has 5).']\n         error_atmost = [u'Ensure this value has at most 6 characters (it has 7).']\n+        error_invalid = [u'Enter a valid postal code in the format XXXXXX']\n \n         valid = {\n             '400473': '400473',\n         }\n         invalid = {\n-            '40047': error_atleast,\n-            '4004731': error_atmost,\n+            '40047': error_atleast + error_invalid,\n+            '4004731': error_atmost + error_invalid,\n         }\n         self.assertFieldOutput(ROPostalCodeField, valid, invalid)"
        },
        {
            "sha": "0ba5b806a5c7de8bbf5cae0d6cbe1904fea2cf1b",
            "filename": "tests/regressiontests/forms/localflavor/utils.py",
            "status": "modified",
            "additions": 13,
            "deletions": 9,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Futils.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import with_statement\n+\n from django.core.exceptions import ValidationError\n from django.core.validators import EMPTY_VALUES\n from django.forms.fields import CharField\n@@ -42,17 +44,19 @@ def assertFieldOutput(self, fieldclass, valid, invalid, field_args=None,\n             self.assertEqual(optional.clean(input), output)\n         # test invalid inputs\n         for input, errors in invalid.items():\n-            self.assertRaisesRegexp(ValidationError, unicode(errors),\n-                required.clean, input\n-            )\n-            self.assertRaisesRegexp(ValidationError, unicode(errors),\n-                optional.clean, input\n-            )\n+            with self.assertRaises(ValidationError) as context_manager:\n+                required.clean(input)\n+            self.assertEqual(context_manager.exception.messages, errors)\n+\n+            with self.assertRaises(ValidationError) as context_manager:\n+                optional.clean(input)\n+            self.assertEqual(context_manager.exception.messages, errors)\n         # test required inputs\n-        error_required = u'This field is required'\n+        error_required = [u'This field is required.']\n         for e in EMPTY_VALUES:\n-            self.assertRaisesRegexp(ValidationError, error_required,\n-                required.clean, e)\n+            with self.assertRaises(ValidationError) as context_manager:\n+                required.clean(e)\n+            self.assertEqual(context_manager.exception.messages, error_required)\n             self.assertEqual(optional.clean(e), empty_value)\n         # test that max_length and min_length are always accepted\n         if issubclass(fieldclass, CharField):"
        },
        {
            "sha": "e2d5aa65ffe009cf554e9852cce71893283f4634",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -1,3 +1,4 @@\n+from localflavor import AssertFieldOutputTests\n from localflavor.ar import ARLocalFlavorTests\n from localflavor.at import ATLocalFlavorTests\n from localflavor.au import AULocalFlavorTests"
        },
        {
            "sha": "39db39f0dfdd61d4ee4694fee2fab6f95adfa922",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/93e9d91501914e37ef8dfe7a9e355be9d2e9c538/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=93e9d91501914e37ef8dfe7a9e355be9d2e9c538",
            "patch": "@@ -46,5 +46,6 @@\n     TRLocalFlavorTests,\n     USLocalFlavorTests,\n     UYLocalFlavorTests,\n-    ZALocalFlavorTests\n+    ZALocalFlavorTests,\n+    AssertFieldOutputTests,\n )"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 39,
        "deletions": 20
    }
}