{
    "author": "aaugustin",
    "message": "Stopped flipping the uses_savepoints feature at runtime.",
    "sha": "cd364efa00dba5aa86187aee83e4ed9917e7e93c",
    "files": [
        {
            "sha": "ada0e038b4678f111e290b73bfa754696d585732",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/cd364efa00dba5aa86187aee83e4ed9917e7e93c/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/cd364efa00dba5aa86187aee83e4ed9917e7e93c/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=cd364efa00dba5aa86187aee83e4ed9917e7e93c",
            "patch": "@@ -161,17 +161,17 @@ def close(self):\n     ##### Backend-specific savepoint management methods #####\n \n     def _savepoint(self, sid):\n-        if not self.features.uses_savepoints:\n+        if not self.features.uses_savepoints or self.autocommit:\n             return\n         self.cursor().execute(self.ops.savepoint_create_sql(sid))\n \n     def _savepoint_rollback(self, sid):\n-        if not self.features.uses_savepoints:\n+        if not self.features.uses_savepoints or self.autocommit:\n             return\n         self.cursor().execute(self.ops.savepoint_rollback_sql(sid))\n \n     def _savepoint_commit(self, sid):\n-        if not self.features.uses_savepoints:\n+        if not self.features.uses_savepoints or self.autocommit:\n             return\n         self.cursor().execute(self.ops.savepoint_commit_sql(sid))\n "
        },
        {
            "sha": "385206221d27414629603c31bb26f6feff668544",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/cd364efa00dba5aa86187aee83e4ed9917e7e93c/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/cd364efa00dba5aa86187aee83e4ed9917e7e93c/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=cd364efa00dba5aa86187aee83e4ed9917e7e93c",
            "patch": "@@ -49,6 +49,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     has_select_for_update = True\n     has_select_for_update_nowait = True\n     has_bulk_insert = True\n+    uses_savepoints = True\n     supports_tablespaces = True\n     supports_transactions = True\n     can_distinct_on_fields = True\n@@ -88,8 +89,6 @@ def __init__(self, *args, **kwargs):\n         self.introspection = DatabaseIntrospection(self)\n         self.validation = BaseDatabaseValidation(self)\n \n-        self.features.uses_savepoints = False\n-\n     def get_connection_params(self):\n         settings_dict = self.settings_dict\n         if not settings_dict['NAME']:\n@@ -174,7 +173,6 @@ def _enter_transaction_management(self, managed):\n             self.cursor().close()\n         if managed and self.autocommit:\n             self.set_autocommit(False)\n-            self.features.uses_savepoints = True\n \n     def _leave_transaction_management(self, managed):\n         \"\"\"\n@@ -186,7 +184,6 @@ def _leave_transaction_management(self, managed):\n         if not managed and not self.autocommit:\n             self.rollback()                     # Must terminate transaction first.\n             self.set_autocommit(True)\n-            self.features.uses_savepoints = False\n \n     def _set_isolation_level(self, isolation_level):\n         assert isolation_level in range(1, 5)     # Use set_autocommit for level = 0"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 4,
        "deletions": 7
    }
}