{
    "author": "aaugustin",
    "message": "Fixed #17944 -- Prevented an error in the user change page of the admin when the content of the password field doesn't match the expected format. Thanks saxix for the report and initial patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17775 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a8d0fc10015be745c5d274b990d94dfb7d57c9d5",
    "files": [
        {
            "sha": "931328899bd1c0a5c87fa7fc31b6761b8590a64b",
            "filename": "django/contrib/auth/fixtures/authtestdata.json",
            "status": "modified",
            "additions": 92,
            "deletions": 38,
            "changes": 130,
            "blob_url": "https://github.com/django/django/blob/a8d0fc10015be745c5d274b990d94dfb7d57c9d5/django%2Fcontrib%2Fauth%2Ffixtures%2Fauthtestdata.json",
            "raw_url": "https://github.com/django/django/raw/a8d0fc10015be745c5d274b990d94dfb7d57c9d5/django%2Fcontrib%2Fauth%2Ffixtures%2Fauthtestdata.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ffixtures%2Fauthtestdata.json?ref=a8d0fc10015be745c5d274b990d94dfb7d57c9d5",
            "patch": "@@ -1,55 +1,109 @@\n [\n     {\n-        \"pk\": \"1\", \n-        \"model\": \"auth.user\", \n+        \"pk\": \"1\",\n+        \"model\": \"auth.user\",\n         \"fields\": {\n-            \"username\": \"testclient\", \n-            \"first_name\": \"Test\", \n-            \"last_name\": \"Client\", \n-            \"is_active\": true, \n-            \"is_superuser\": false, \n-            \"is_staff\": false, \n-            \"last_login\": \"2006-12-17 07:03:31\", \n-            \"groups\": [], \n-            \"user_permissions\": [], \n-            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\", \n-            \"email\": \"testclient@example.com\", \n+            \"username\": \"testclient\",\n+            \"first_name\": \"Test\",\n+            \"last_name\": \"Client\",\n+            \"is_active\": true,\n+            \"is_superuser\": false,\n+            \"is_staff\": false,\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"groups\": [],\n+            \"user_permissions\": [],\n+            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\",\n+            \"email\": \"testclient@example.com\",\n             \"date_joined\": \"2006-12-17 07:03:31\"\n         }\n     },\n     {\n-        \"pk\": \"2\", \n-        \"model\": \"auth.user\", \n+        \"pk\": \"2\",\n+        \"model\": \"auth.user\",\n         \"fields\": {\n-            \"username\": \"inactive\", \n-            \"first_name\": \"Inactive\", \n-            \"last_name\": \"User\", \n-            \"is_active\": false, \n-            \"is_superuser\": false, \n-            \"is_staff\": false, \n-            \"last_login\": \"2006-12-17 07:03:31\", \n-            \"groups\": [], \n-            \"user_permissions\": [], \n-            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\", \n+            \"username\": \"inactive\",\n+            \"first_name\": \"Inactive\",\n+            \"last_name\": \"User\",\n+            \"is_active\": false,\n+            \"is_superuser\": false,\n+            \"is_staff\": false,\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"groups\": [],\n+            \"user_permissions\": [],\n+            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\",\n             \"email\": \"testclient2@example.com\",\n             \"date_joined\": \"2006-12-17 07:03:31\"\n         }\n     },\n     {\n-        \"pk\": \"3\", \n-        \"model\": \"auth.user\", \n+        \"pk\": \"3\",\n+        \"model\": \"auth.user\",\n         \"fields\": {\n-            \"username\": \"staff\", \n-            \"first_name\": \"Staff\", \n-            \"last_name\": \"Member\", \n-            \"is_active\": true, \n-            \"is_superuser\": false, \n-            \"is_staff\": true, \n-            \"last_login\": \"2006-12-17 07:03:31\", \n-            \"groups\": [], \n-            \"user_permissions\": [], \n-            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\", \n-            \"email\": \"staffmember@example.com\", \n+            \"username\": \"staff\",\n+            \"first_name\": \"Staff\",\n+            \"last_name\": \"Member\",\n+            \"is_active\": true,\n+            \"is_superuser\": false,\n+            \"is_staff\": true,\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"groups\": [],\n+            \"user_permissions\": [],\n+            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\",\n+            \"email\": \"staffmember@example.com\",\n+            \"date_joined\": \"2006-12-17 07:03:31\"\n+        }\n+    },\n+    {\n+        \"pk\": \"4\",\n+        \"model\": \"auth.user\",\n+        \"fields\": {\n+            \"username\": \"empty_password\",\n+            \"first_name\": \"Empty\",\n+            \"last_name\": \"Password\",\n+            \"is_active\": true,\n+            \"is_superuser\": false,\n+            \"is_staff\": false,\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"groups\": [],\n+            \"user_permissions\": [],\n+            \"password\": \"\",\n+            \"email\": \"empty_password@example.com\",\n+            \"date_joined\": \"2006-12-17 07:03:31\"\n+        }\n+    },\n+    {\n+        \"pk\": \"5\",\n+        \"model\": \"auth.user\",\n+        \"fields\": {\n+            \"username\": \"unmanageable_password\",\n+            \"first_name\": \"Unmanageable\",\n+            \"last_name\": \"Password\",\n+            \"is_active\": true,\n+            \"is_superuser\": false,\n+            \"is_staff\": false,\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"groups\": [],\n+            \"user_permissions\": [],\n+            \"password\": \"$\",\n+            \"email\": \"unmanageable_password@example.com\",\n+            \"date_joined\": \"2006-12-17 07:03:31\"\n+        }\n+    },\n+    {\n+        \"pk\": \"6\",\n+        \"model\": \"auth.user\",\n+        \"fields\": {\n+            \"username\": \"unknown_password\",\n+            \"first_name\": \"Unknown\",\n+            \"last_name\": \"Password\",\n+            \"is_active\": true,\n+            \"is_superuser\": false,\n+            \"is_staff\": false,\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"groups\": [],\n+            \"user_permissions\": [],\n+            \"password\": \"foo$bar\",\n+            \"email\": \"unknown_password@example.com\",\n             \"date_joined\": \"2006-12-17 07:03:31\"\n         }\n     }"
        },
        {
            "sha": "a7278be6eb1d55df1af4b82ee0ef940860ba0043",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/a8d0fc10015be745c5d274b990d94dfb7d57c9d5/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/a8d0fc10015be745c5d274b990d94dfb7d57c9d5/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=a8d0fc10015be745c5d274b990d94dfb7d57c9d5",
            "patch": "@@ -29,14 +29,18 @@ def render(self, name, value, attrs):\n         encoded = smart_str(encoded)\n \n         if len(encoded) == 32 and '$' not in encoded:\n-            hasher = get_hasher('unsalted_md5')\n+            algorithm = 'unsalted_md5'\n         else:\n             algorithm = encoded.split('$', 1)[0]\n-            hasher = get_hasher(algorithm)\n \n-        summary = \"\"\n-        for key, value in hasher.safe_summary(encoded).iteritems():\n-            summary += \"<strong>%(key)s</strong>: %(value)s \" % {\"key\": ugettext(key), \"value\": value}\n+        try:\n+            hasher = get_hasher(algorithm)\n+        except ValueError:\n+            summary = \"<strong>%s</strong>\" % ugettext(\"Invalid password format or unknown hashing algorithm.\")\n+        else:\n+            summary = \"\"\n+            for key, value in hasher.safe_summary(encoded).iteritems():\n+                summary += \"<strong>%(key)s</strong>: %(value)s \" % {\"key\": ugettext(key), \"value\": value}\n \n         return mark_safe(\"<div%(attrs)s>%(summary)s</div>\" % {\"attrs\": flatatt(final_attrs), \"summary\": summary})\n "
        },
        {
            "sha": "2397b52aff529e696a0b1b9f8c29b73cd979b31a",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/a8d0fc10015be745c5d274b990d94dfb7d57c9d5/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/a8d0fc10015be745c5d274b990d94dfb7d57c9d5/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=a8d0fc10015be745c5d274b990d94dfb7d57c9d5",
            "patch": "@@ -65,7 +65,6 @@ def test_both_passwords(self):\n \n     def test_success(self):\n         # The success case.\n-\n         data = {\n             'username': 'jsmith@example.com',\n             'password1': 'test123',\n@@ -236,6 +235,25 @@ class Meta(UserChangeForm.Meta):\n         # Just check we can create it\n         form = MyUserForm({})\n \n+    def test_bug_17944_empty_password(self):\n+        user = User.objects.get(username='empty_password')\n+        form = UserChangeForm(instance=user)\n+        # Just check that no error is raised.\n+        form.as_table()\n+\n+    def test_bug_17944_unmanageable_password(self):\n+        user = User.objects.get(username='unmanageable_password')\n+        form = UserChangeForm(instance=user)\n+        # Just check that no error is raised.\n+        form.as_table()\n+\n+    def test_bug_17944_unknown_password_algorithm(self):\n+        user = User.objects.get(username='unknown_password')\n+        form = UserChangeForm(instance=user)\n+        # Just check that no error is raised.\n+        form.as_table()\n+\n+\n UserChangeFormTest = override_settings(USE_TZ=False)(UserChangeFormTest)\n \n "
        }
    ],
    "stats": {
        "total": 164,
        "additions": 120,
        "deletions": 44
    }
}