{
    "author": "claudep",
    "message": "Fixed #16678 -- Wrote tests for contrib.redirects app\n\nThanks Julien Phalip for the report.",
    "sha": "d9213d09dbb28f687b53d051cddcae03337066c8",
    "files": [
        {
            "sha": "11ffc7b748dd5a42b611de5289069aec5de1ff26",
            "filename": "django/contrib/redirects/tests.py",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/d9213d09dbb28f687b53d051cddcae03337066c8/django%2Fcontrib%2Fredirects%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d9213d09dbb28f687b53d051cddcae03337066c8/django%2Fcontrib%2Fredirects%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fredirects%2Ftests.py?ref=d9213d09dbb28f687b53d051cddcae03337066c8",
            "patch": "@@ -0,0 +1,42 @@\n+from django.conf import settings\n+from django.contrib.sites.models import Site\n+from django.test import TestCase\n+from django.test.utils import override_settings\n+from django.utils import six\n+\n+from .models import Redirect\n+\n+\n+@override_settings(\n+    SITE_ID=1,\n+    APPEND_SLASH=True,\n+    MIDDLEWARE_CLASSES=list(settings.MIDDLEWARE_CLASSES) +\n+        ['django.contrib.redirects.middleware.RedirectFallbackMiddleware'],\n+)\n+class RedirectTests(TestCase):\n+\n+    def setUp(self):\n+        self.site = Site.objects.get(pk=settings.SITE_ID)\n+\n+    def test_model(self):\n+        r1 = Redirect.objects.create(\n+            site=self.site, old_path='/initial', new_path='/new_target')\n+        self.assertEqual(six.text_type(r1), \"/initial ---> /new_target\")\n+\n+    def test_redirect_middleware(self):\n+        r1 = Redirect.objects.create(\n+            site=self.site, old_path='/initial', new_path='/new_target')\n+        response = self.client.get('/initial')\n+        self.assertRedirects(response,\n+            '/new_target', status_code=301, target_status_code=404)\n+        # Works also with trailing slash\n+        response = self.client.get('/initial/')\n+        self.assertRedirects(response,\n+            '/new_target', status_code=301, target_status_code=404)\n+\n+    def test_response_gone(self):\n+        \"\"\"When the redirect target is '', return a 410\"\"\"\n+        r1 = Redirect.objects.create(\n+            site=self.site, old_path='/initial', new_path='')\n+        response = self.client.get('/initial')\n+        self.assertEqual(response.status_code, 410)"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 42,
        "deletions": 0
    }
}