{
    "author": "aaugustin",
    "message": "Fixed #17715 -- Updated the tutorial for time zone support, plus a few other improvements.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17591 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e0d78f898fb4000236881f447c9435f3395f3349",
    "files": [
        {
            "sha": "676f8f18afe0aedc6eb9b5d9be4cd5bd430719d1",
            "filename": "django/utils/timezone.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/django%2Futils%2Ftimezone.py",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/django%2Futils%2Ftimezone.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimezone.py?ref=e0d78f898fb4000236881f447c9435f3395f3349",
            "patch": "@@ -32,6 +32,9 @@ class UTC(tzinfo):\n     Used only when pytz isn't available.\n     \"\"\"\n \n+    def __repr__(self):\n+        return \"<UTC>\"\n+\n     def utcoffset(self, dt):\n         return ZERO\n \n@@ -60,6 +63,9 @@ def __init__(self):\n         self.DSTDIFF = self.DSTOFFSET - self.STDOFFSET\n         tzinfo.__init__(self)\n \n+    def __repr__(self):\n+        return \"<LocalTimezone>\"\n+\n     def utcoffset(self, dt):\n         if self._isdst(dt):\n             return self.DSTOFFSET"
        },
        {
            "sha": "4ae9dad8abb88ff91f8ea9718fb0b12223fbdd7f",
            "filename": "docs/intro/_images/admin13.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin13.png",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin13.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin13.png?ref=e0d78f898fb4000236881f447c9435f3395f3349"
        },
        {
            "sha": "9ebdb500911764533b74ffbeb53df9860645ee4a",
            "filename": "docs/intro/_images/admin13t.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin13t.png",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin13t.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin13t.png?ref=e0d78f898fb4000236881f447c9435f3395f3349"
        },
        {
            "sha": "61a7f44a0ca6dc9957cb021ef3e99eb0a5c59f09",
            "filename": "docs/intro/_images/admin14.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin14.png",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin14.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin14.png?ref=e0d78f898fb4000236881f447c9435f3395f3349"
        },
        {
            "sha": "f62bb4a8c29c2a85a0f99ba17d4356217a2037c5",
            "filename": "docs/intro/_images/admin14t.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin14t.png",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2F_images%2Fadmin14t.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin14t.png?ref=e0d78f898fb4000236881f447c9435f3395f3349"
        },
        {
            "sha": "208d6f3601bb99768fd444bed8d1b5ff89fcc4c3",
            "filename": "docs/intro/tutorial01.txt",
            "status": "modified",
            "additions": 54,
            "deletions": 38,
            "changes": 92,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2Ftutorial01.txt",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2Ftutorial01.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial01.txt?ref=e0d78f898fb4000236881f447c9435f3395f3349",
            "patch": "@@ -70,7 +70,7 @@ This will create a ``mysite`` directory in your current directory.\n \n :doc:`django-admin.py </ref/django-admin>` should be on your system path if you\n installed Django via ``python setup.py``. If it's not on your path, you can find\n-it in ``site-packages/django/bin``, where ```site-packages``` is a directory\n+it in ``site-packages/django/bin``, where ``site-packages`` is a directory\n within your Python installation. Consider symlinking to :doc:`django-admin.py\n </ref/django-admin>` from some place on your path, such as\n :file:`/usr/local/bin`.\n@@ -192,13 +192,13 @@ Database setup\n Now, edit :file:`mysite/settings.py`. It's a normal Python module with\n module-level variables representing Django settings. Change the\n following keys in the :setting:`DATABASES` ``'default'`` item to match\n-your databases connection settings.\n+your database connection settings.\n \n * :setting:`ENGINE <DATABASE-ENGINE>` -- Either\n   ``'django.db.backends.postgresql_psycopg2'``,\n-  ``'django.db.backends.mysql'`` or\n-  ``'django.db.backends.sqlite3'``. Other backends are\n-  :setting:`also available <DATABASE-ENGINE>`.\n+  ``'django.db.backends.mysql'``, ``'django.db.backends.sqlite3'`` or\n+  ``'django.db.backends.oracle'``. Other backends are :setting:`also available\n+  <DATABASE-ENGINE>`.\n \n * :setting:`NAME` -- The name of your database. If you're using\n   SQLite, the database will be a file on your computer; in that\n@@ -219,10 +219,10 @@ your databases connection settings.\n   an empty string if your database server is on the same physical\n   machine (not used for SQLite).\n \n-If you're new to databases, we recommend simply using SQLite (by\n-setting :setting:`ENGINE` to ``'django.db.backends.sqlite3'``). SQLite\n-is included as part of Python 2.5 and later, so you won't need to\n-install anything else.\n+If you're new to databases, we recommend simply using SQLite by setting\n+:setting:`ENGINE` to ``'django.db.backends.sqlite3'`` and :setting:`NAME` to\n+the place where you'd like to store the database. SQLite is included as part\n+of Python 2.5 and later, so you won't need to install anything else.\n \n .. note::\n \n@@ -233,11 +233,14 @@ install anything else.\n     If you're using SQLite, you don't need to create anything beforehand - the\n     database file will be created automatically when it is needed.\n \n-While you're editing :file:`settings.py`, take note of the\n-:setting:`INSTALLED_APPS` setting towards the bottom of the file. That variable\n-holds the names of all Django applications that are activated in this Django\n-instance. Apps can be used in multiple projects, and you can package and\n-distribute them for use by others in their projects.\n+While you're editing :file:`settings.py`, set :setting:`TIME_ZONE` to your\n+time zone. The default value isn't correct for you, unless you happen to live\n+near Chicago.\n+\n+Also, take note of the :setting:`INSTALLED_APPS` setting towards the bottom of\n+the file. That variable holds the names of all Django applications that are\n+activated in this Django instance. Apps can be used in multiple projects, and\n+you can package and distribute them for use by others in their projects.\n \n By default, :setting:`INSTALLED_APPS` contains the following apps, all of which\n come with Django:\n@@ -414,6 +417,12 @@ it'll look like this::\n         'django.contrib.contenttypes',\n         'django.contrib.sessions',\n         'django.contrib.sites',\n+        'django.contrib.messages',\n+        'django.contrib.staticfiles',\n+        # Uncomment the next line to enable the admin:\n+        # 'django.contrib.admin',\n+        # Uncomment the next line to enable admin documentation:\n+        # 'django.contrib.admindocs',\n         'polls',\n     )\n \n@@ -437,7 +446,7 @@ statements for the polls app):\n     );\n     CREATE TABLE \"polls_choice\" (\n         \"id\" serial NOT NULL PRIMARY KEY,\n-        \"poll_id\" integer NOT NULL REFERENCES \"polls_poll\" (\"id\"),\n+        \"poll_id\" integer NOT NULL REFERENCES \"polls_poll\" (\"id\") DEFERRABLE INITIALLY DEFERRED,\n         \"choice\" varchar(200) NOT NULL,\n         \"votes\" integer NOT NULL\n     );\n@@ -454,7 +463,7 @@ Note the following:\n * Primary keys (IDs) are added automatically. (You can override this, too.)\n \n * By convention, Django appends ``\"_id\"`` to the foreign key field name.\n-  Yes, you can override this, as well.\n+  (Yes, you can override this, as well.)\n \n * The foreign key relationship is made explicit by a ``REFERENCES``\n   statement.\n@@ -501,12 +510,12 @@ Now, run :djadmin:`syncdb` again to create those model tables in your database:\n \n     python manage.py syncdb\n \n-The :djadmin:`syncdb` command runs the sql from 'sqlall' on your database for\n-all apps in :setting:`INSTALLED_APPS` that don't already exist in your database.\n-This creates all the tables, initial data and indexes for any apps you have\n-added to your project since the last time you ran syncdb. :djadmin:`syncdb` can\n-be called as often as you like, and it will only ever create the tables that\n-don't exist.\n+The :djadmin:`syncdb` command runs the sql from :djadmin:`sqlall` on your\n+database for all apps in :setting:`INSTALLED_APPS` that don't already exist in\n+your database. This creates all the tables, initial data and indexes for any\n+apps you have added to your project since the last time you ran syncdb.\n+:djadmin:`syncdb` can be called as often as you like, and it will only ever\n+create the tables that don't exist.\n \n Read the :doc:`django-admin.py documentation </ref/django-admin>` for full\n information on what the ``manage.py`` utility can do.\n@@ -537,15 +546,18 @@ the Python import path to your :file:`settings.py` file.\n \n Once you're in the shell, explore the :doc:`database API </topics/db/queries>`::\n \n-    >>> from polls.models import Poll, Choice # Import the model classes we just wrote.\n+    >>> from polls.models import Poll, Choice   # Import the model classes we just wrote.\n \n     # No polls are in the system yet.\n     >>> Poll.objects.all()\n     []\n \n     # Create a new Poll.\n-    >>> import datetime\n-    >>> p = Poll(question=\"What's up?\", pub_date=datetime.datetime.now())\n+    # Support for time zones is enabled in the default settings file, so\n+    # Django expects a datetime with tzinfo for pub_date. Use timezone.now()\n+    # instead of datetime.datetime.now() and it will do the right thing.\n+    >>> from django.utils import timezone\n+    >>> p = Poll(question=\"What's new?\", pub_date=timezone.now())\n \n     # Save the object into the database. You have to call save() explicitly.\n     >>> p.save()\n@@ -559,12 +571,12 @@ Once you're in the shell, explore the :doc:`database API </topics/db/queries>`::\n \n     # Access database columns via Python attributes.\n     >>> p.question\n-    \"What's up?\"\n+    \"What's new?\"\n     >>> p.pub_date\n-    datetime.datetime(2007, 7, 15, 12, 00, 53)\n+    datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=<UTC>)\n \n     # Change values by changing the attributes, then calling save().\n-    >>> p.pub_date = datetime.datetime(2007, 4, 1, 0, 0)\n+    >>> p.question = \"What's up?\"\n     >>> p.save()\n \n     # objects.all() displays all the polls in the database.\n@@ -617,14 +629,18 @@ Note these are normal Python methods. Let's add a custom method, just for\n demonstration::\n \n     import datetime\n+    from django.utils import timezone\n     # ...\n     class Poll(models.Model):\n         # ...\n-        def was_published_today(self):\n-            return self.pub_date.date() == datetime.date.today()\n+        def was_published_recently(self):\n+            return self.pub_date >= timezone.now() - datetime.timedelta(days=1)\n \n-Note the addition of ``import datetime`` to reference Python's standard\n-``datetime`` module.\n+Note the addition of ``import datetime`` and ``from django.utils import\n+timezone``, to reference Python's standard :mod:`datetime` module and Django's\n+time zone-related utilities in :mod:`django.utils.timezone` respectively. If\n+you aren't familiar with time zone handling in Python, you can learn more in\n+the :doc:`time zone support docs </topics/i18n/timezones>`.\n \n Save these changes and start a new Python interactive shell by running\n ``python manage.py shell`` again::\n@@ -642,8 +658,8 @@ Save these changes and start a new Python interactive shell by running\n     >>> Poll.objects.filter(question__startswith='What')\n     [<Poll: What's up?>]\n \n-    # Get the poll whose year is 2007.\n-    >>> Poll.objects.get(pub_date__year=2007)\n+    # Get the poll whose year is 2012.\n+    >>> Poll.objects.get(pub_date__year=2012)\n     <Poll: What's up?>\n \n     >>> Poll.objects.get(id=2)\n@@ -659,8 +675,8 @@ Save these changes and start a new Python interactive shell by running\n \n     # Make sure our custom method worked.\n     >>> p = Poll.objects.get(pk=1)\n-    >>> p.was_published_today()\n-    False\n+    >>> p.was_published_recently()\n+    True\n \n     # Give the Poll a couple of Choices. The create call constructs a new\n     # choice object, does the INSERT statement, adds the choice to the set\n@@ -693,8 +709,8 @@ Save these changes and start a new Python interactive shell by running\n     # The API automatically follows relationships as far as you need.\n     # Use double underscores to separate relationships.\n     # This works as many levels deep as you want; there's no limit.\n-    # Find all Choices for any poll whose pub_date is in 2007.\n-    >>> Choice.objects.filter(poll__pub_date__year=2007)\n+    # Find all Choices for any poll whose pub_date is in 2012.\n+    >>> Choice.objects.filter(poll__pub_date__year=2012)\n     [<Choice: Not much>, <Choice: The sky>, <Choice: Just hacking again>]\n \n     # Let's delete one of the choices. Use delete() for that."
        },
        {
            "sha": "37f82fa6b5308ca104492545746deaa4b043e979",
            "filename": "docs/intro/tutorial02.txt",
            "status": "modified",
            "additions": 28,
            "deletions": 18,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2Ftutorial02.txt",
            "raw_url": "https://github.com/django/django/raw/e0d78f898fb4000236881f447c9435f3395f3349/docs%2Fintro%2Ftutorial02.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial02.txt?ref=e0d78f898fb4000236881f447c9435f3395f3349",
            "patch": "@@ -18,16 +18,16 @@ automatically-generated admin site.\n     displayed on the public site. Django solves the problem of creating a\n     unified interface for site administrators to edit content.\n \n-    The admin isn't necessarily intended to be used by site visitors; it's for\n-    site managers.\n+    The admin isn't intended to be used by site visitors; it's for site\n+    managers.\n \n Activate the admin site\n =======================\n \n The Django admin site is not activated by default -- it's an opt-in thing. To\n activate the admin site for your installation, do these three things:\n \n-* Add ``\"django.contrib.admin\"`` to your :setting:`INSTALLED_APPS` setting.\n+* Uncomment ``\"django.contrib.admin\"`` in the :setting:`INSTALLED_APPS` setting.\n \n * Run ``python manage.py syncdb``. Since you have added a new application\n   to :setting:`INSTALLED_APPS`, the database tables need to be updated.\n@@ -101,7 +101,7 @@ the Django admin index page:\n .. image:: _images/admin02t.png\n    :alt: Django admin index page\n \n-You should see a few other types of editable content, including groups, users\n+You should see a few types of editable content, including groups, users\n and sites. These are core features Django ships with by default.\n \n Make the poll app modifiable in the admin\n@@ -169,6 +169,11 @@ The bottom part of the page gives you a couple of options:\n \n * Delete -- Displays a delete confirmation page.\n \n+If the value of \"Date published\" doesn't match the time when you created the\n+poll in Tutorial 1, it probably means you forgot to set the correct value for\n+the :setting:`TIME_ZONE` setting. Change it, reload the page, and check that\n+the correct value appears.\n+\n Change the \"Date published\" by clicking the \"Today\" and \"Now\" shortcuts. Then\n click \"Save and continue editing.\" Then click \"History\" in the upper right.\n You'll see a page listing all changes made to this object via the Django admin,\n@@ -337,30 +342,35 @@ columns, on the change list page for the object::\n         # ...\n         list_display = ('question', 'pub_date')\n \n-Just for good measure, let's also include the ``was_published_today`` custom\n+Just for good measure, let's also include the ``was_published_recently`` custom\n method from Tutorial 1::\n \n     class PollAdmin(admin.ModelAdmin):\n         # ...\n-        list_display = ('question', 'pub_date', 'was_published_today')\n+        list_display = ('question', 'pub_date', 'was_published_recently')\n \n Now the poll change list page looks like this:\n \n .. image:: _images/admin13t.png\n    :alt: Polls change list page, updated\n \n You can click on the column headers to sort by those values -- except in the\n-case of the ``was_published_today`` header, because sorting by the output of\n-an arbitrary method is not supported. Also note that the column header for\n-``was_published_today`` is, by default, the name of the method (with\n-underscores replaced with spaces). But you can change that by giving that\n-method (in ``models.py``) a ``short_description`` attribute::\n+case of the ``was_published_recently`` header, because sorting by the output\n+of an arbitrary method is not supported. Also note that the column header for\n+``was_published_recently`` is, by default, the name of the method (with\n+underscores replaced with spaces), and that each line contains the string\n+representation of the output.\n+\n+You can improve that by giving that method (in ``models.py``) a few\n+attributes, as follows::\n \n     class Poll(models.Model):\n         # ...\n-        def was_published_today(self):\n-            return self.pub_date.date() == datetime.date.today()\n-        was_published_today.short_description = 'Published today?'\n+        def was_published_recently(self):\n+            return self.pub_date >= timezone.now() - datetime.timedelta(days=1)\n+        was_published_recently.admin_order_field = 'pub_date'\n+        was_published_recently.boolean = True\n+        was_published_recently.short_description = 'Published recently?'\n \n Edit your admin.py file again and add an improvement to the Poll change list page: Filters. Add the\n following line to ``PollAdmin``::\n@@ -374,9 +384,9 @@ That adds a \"Filter\" sidebar that lets people filter the change list by the\n    :alt: Polls change list page, updated\n \n The type of filter displayed depends on the type of field you're filtering on.\n-Because ``pub_date`` is a DateTimeField, Django knows to give the default\n-filter options for DateTimeFields: \"Any date,\" \"Today,\" \"Past 7 days,\"\n-\"This month,\" \"This year.\"\n+Because ``pub_date`` is a :class:`~django.db.models.fields.DateTimeField`,\n+Django knows to give appropriate filter options: \"Any date,\" \"Today,\" \"Past 7\n+days,\" \"This month,\" \"This year.\"\n \n This is shaping up well. Let's add some search capability::\n \n@@ -397,7 +407,7 @@ At top level, it displays all available years. Then it drills down to months\n and, ultimately, days.\n \n Now's also a good time to note that change lists give you free pagination. The\n-default is to display 50 items per page. Change-list pagination, search boxes,\n+default is to display 100 items per page. Change-list pagination, search boxes,\n filters, date-hierarchies and column-header-ordering all work together like you\n think they should.\n "
        }
    ],
    "stats": {
        "total": 144,
        "additions": 88,
        "deletions": 56
    }
}