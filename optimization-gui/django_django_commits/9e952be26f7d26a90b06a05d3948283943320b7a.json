{
    "author": "freakboy3742",
    "message": "Fixed #16201 -- Ensure that requests with Content-Length=0 don't break the multipart parser. Thanks to albsen for the report and patch\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16353 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "9e952be26f7d26a90b06a05d3948283943320b7a",
    "files": [
        {
            "sha": "63203a4581acf872b8d1edec22311b6f3fb5beb7",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/9e952be26f7d26a90b06a05d3948283943320b7a/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/9e952be26f7d26a90b06a05d3948283943320b7a/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=9e952be26f7d26a90b06a05d3948283943320b7a",
            "patch": "@@ -75,7 +75,7 @@ def __init__(self, META, input_data, upload_handlers, encoding=None):\n             # For now set it to 0; we'll try again later on down.\n             content_length = 0\n \n-        if content_length <= 0:\n+        if content_length < 0:\n             # This means we shouldn't continue...raise an error.\n             raise MultiPartParserError(\"Invalid content length: %r\" % content_length)\n \n@@ -105,6 +105,11 @@ def parse(self):\n         encoding = self._encoding\n         handlers = self._upload_handlers\n \n+        # HTTP spec says that Content-Length >= 0 is valid\n+        # handling content-length == 0 before continuing\n+        if self._content_length == 0:\n+            return QueryDict(MultiValueDict(), encoding=self._encoding), MultiValueDict()\n+\n         limited_input_data = LimitBytes(self._input_data, self._content_length)\n \n         # See if the handler will want to take care of the parsing."
        },
        {
            "sha": "91f8b2f80500c6b237baf6e37661501193f47261",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/9e952be26f7d26a90b06a05d3948283943320b7a/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/9e952be26f7d26a90b06a05d3948283943320b7a/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=9e952be26f7d26a90b06a05d3948283943320b7a",
            "patch": "@@ -239,6 +239,27 @@ def test_raw_post_data_after_POST_multipart(self):\n         self.assertEqual(request.POST, {u'name': [u'value']})\n         self.assertRaises(Exception, lambda: request.raw_post_data)\n \n+    def test_POST_multipart_with_content_length_zero(self):\n+        \"\"\"\n+        Multipart POST requests with Content-Length >= 0 are valid and need to be handled.\n+        \"\"\"\n+        # According to:\n+        # http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.13\n+        # Every request.POST with Content-Length >= 0 is a valid request,\n+        # this test ensures that we handle Content-Length == 0.\n+        payload = \"\\r\\n\".join([\n+                '--boundary',\n+                'Content-Disposition: form-data; name=\"name\"',\n+                '',\n+                'value',\n+                '--boundary--'\n+                ''])\n+        request = WSGIRequest({'REQUEST_METHOD': 'POST',\n+                               'CONTENT_TYPE': 'multipart/form-data; boundary=boundary',\n+                               'CONTENT_LENGTH': 0,\n+                               'wsgi.input': StringIO(payload)})\n+        self.assertEqual(request.POST, {})\n+\n     def test_read_by_lines(self):\n         request = WSGIRequest({'REQUEST_METHOD': 'POST', 'wsgi.input': StringIO('name=value')})\n         self.assertEqual(list(request), ['name=value'])"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 27,
        "deletions": 1
    }
}