{
    "author": "jezdez",
    "message": "Fixed #9089 -- Correctly handle list values in MultiValueDict instances when passed to django.utils.http.urlencode. Thanks, kratorius, guettli and obeattie.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16064 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f4be8bd53d13c9ecb7f31998f89a2def11111efb",
    "files": [
        {
            "sha": "4b43e5835eed11853bc4f153ae925ae25ce660a5",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/f4be8bd53d13c9ecb7f31998f89a2def11111efb/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/f4be8bd53d13c9ecb7f31998f89a2def11111efb/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=f4be8bd53d13c9ecb7f31998f89a2def11111efb",
            "patch": "@@ -6,6 +6,7 @@\n import urlparse\n from email.Utils import formatdate\n \n+from django.utils.datastructures import MultiValueDict\n from django.utils.encoding import smart_str, force_unicode\n from django.utils.functional import allow_lazy\n \n@@ -49,7 +50,9 @@ def urlencode(query, doseq=0):\n     unicode strings. The parameters are first case to UTF-8 encoded strings and\n     then encoded as per normal.\n     \"\"\"\n-    if hasattr(query, 'items'):\n+    if isinstance(query, MultiValueDict):\n+        query = query.lists()\n+    elif hasattr(query, 'items'):\n         query = query.items()\n     return urllib.urlencode(\n         [(smart_str(k),"
        },
        {
            "sha": "3f3a36cef7c3613acfdedb70fa59b0fbe3c6a615",
            "filename": "tests/regressiontests/utils/http.py",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/f4be8bd53d13c9ecb7f31998f89a2def11111efb/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/f4be8bd53d13c9ecb7f31998f89a2def11111efb/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fhttp.py?ref=f4be8bd53d13c9ecb7f31998f89a2def11111efb",
            "patch": "@@ -1,5 +1,6 @@\n from django.utils import http\n from django.utils import unittest\n+from django.utils.datastructures import MultiValueDict\n \n class TestUtilsHttp(unittest.TestCase):\n \n@@ -21,3 +22,32 @@ def test_same_origin_false(self):\n         self.assertFalse(http.same_origin('http://foo.com', 'http://foo.com.evil.com'))\n         # Different port\n         self.assertFalse(http.same_origin('http://foo.com:8000', 'http://foo.com:8001'))\n+\n+    def test_urlencode(self):\n+        # 2-tuples (the norm)\n+        result = http.urlencode((('a', 1), ('b', 2), ('c', 3)))\n+        self.assertEqual(result, 'a=1&b=2&c=3')\n+        # A dictionary\n+        result = http.urlencode({ 'a': 1, 'b': 2, 'c': 3})\n+        acceptable_results = [\n+            # Need to allow all of these as dictionaries have to be treated as\n+            # unordered\n+            'a=1&b=2&c=3',\n+            'a=1&c=3&b=2',\n+            'b=2&a=1&c=3',\n+            'b=2&c=3&a=1',\n+            'c=3&a=1&b=2',\n+            'c=3&b=2&a=1'\n+        ]\n+        self.assertTrue(result in acceptable_results)\n+        # A MultiValueDict\n+        result = http.urlencode(MultiValueDict({\n+            'name': ['Adrian', 'Simon'],\n+            'position': ['Developer']\n+        }), doseq=True)\n+        acceptable_results = [\n+            # MultiValueDicts are similarly unordered\n+            'name=Adrian&name=Simon&position=Developer',\n+            'position=Developer&name=Adrian&name=Simon'\n+        ]\n+        self.assertTrue(result in acceptable_results)"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 34,
        "deletions": 1
    }
}