{
    "author": "claudep",
    "message": "Revert \"Fixed 19895 -- Made second iteration over invalid queryset raise an exception too\"\n\nThis reverts commit 2cd0edaa477b327024e4007c8eaf46646dcd0f21.\nThis commit was the cause of a memory leak. See ticket for more details.\nThanks Anssi Kääriäinen for identifying the source of the bug.",
    "sha": "23490a2394bf03e119e4c9a7a09a9ba35edad430",
    "files": [
        {
            "sha": "7ddd933772dcdf256d9a390a225d3efd9e85d973",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 1,
            "deletions": 13,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/23490a2394bf03e119e4c9a7a09a9ba35edad430/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/23490a2394bf03e119e4c9a7a09a9ba35edad430/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=23490a2394bf03e119e4c9a7a09a9ba35edad430",
            "patch": "@@ -104,7 +104,7 @@ def __iter__(self):\n             len(self)\n \n         if self._result_cache is None:\n-            self._iter = self._safe_iterator(self.iterator())\n+            self._iter = self.iterator()\n             self._result_cache = []\n         if self._iter:\n             return self._result_iter()\n@@ -341,18 +341,6 @@ def iterator(self):\n \n             yield obj\n \n-    def _safe_iterator(self, iterator):\n-        # ensure result cache is cleared when iterating over a queryset\n-        # raises an exception\n-        try:\n-            for item in iterator:\n-                yield item\n-        except StopIteration:\n-            raise\n-        except Exception:\n-            self._result_cache = None\n-            raise\n-\n     def aggregate(self, *args, **kwargs):\n         \"\"\"\n         Returns a dictionary containing the calculations (aggregation)"
        },
        {
            "sha": "ccbb9bd42366c1ca4df6ff8166e443bfffa42f03",
            "filename": "tests/basic/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/23490a2394bf03e119e4c9a7a09a9ba35edad430/tests%2Fbasic%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/23490a2394bf03e119e4c9a7a09a9ba35edad430/tests%2Fbasic%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fbasic%2Ftests.py?ref=23490a2394bf03e119e4c9a7a09a9ba35edad430",
            "patch": "@@ -3,7 +3,7 @@\n from datetime import datetime\n import threading\n \n-from django.core.exceptions import ObjectDoesNotExist, MultipleObjectsReturned, FieldError\n+from django.core.exceptions import ObjectDoesNotExist, MultipleObjectsReturned\n from django.db import connections, DEFAULT_DB_ALIAS\n from django.db.models.fields import Field, FieldDoesNotExist\n from django.db.models.query import QuerySet, EmptyQuerySet, ValuesListQuerySet\n@@ -689,11 +689,6 @@ def test_emptyqs_distinct(self):\n         with self.assertNumQueries(0):\n             self.assertEqual(len(Article.objects.none().distinct('headline', 'pub_date')), 0)\n \n-    def test_invalid_qs_list(self):\n-        qs = Article.objects.order_by('invalid_column')\n-        self.assertRaises(FieldError, list, qs)\n-        self.assertRaises(FieldError, list, qs)\n-\n class ConcurrentSaveTests(TransactionTestCase):\n     @skipUnlessDBFeature('test_db_allows_multiple_connections')\n     def test_concurrent_delete_with_save(self):"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 2,
        "deletions": 19
    }
}