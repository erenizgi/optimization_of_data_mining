{
    "author": "claudep",
    "message": "Fixed #19357 -- Allow non-ASCII chars in filesystem paths\n\nThanks kujiu for the report and Aymeric Augustin for the review.",
    "sha": "c91667338a4e774e2819ccf4da852dc7b759bc19",
    "files": [
        {
            "sha": "cb0c1164164fd69ae90087e909b994008578fd71",
            "filename": "django/contrib/admindocs/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Fviews.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -14,6 +14,7 @@\n from django.contrib.admindocs import utils\n from django.contrib.sites.models import Site\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n from django.utils import six\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n@@ -311,7 +312,7 @@ def load_all_installed_template_libraries():\n         try:\n             libraries = [\n                 os.path.splitext(p)[0]\n-                for p in os.listdir(os.path.dirname(mod.__file__))\n+                for p in os.listdir(os.path.dirname(upath(mod.__file__)))\n                 if p.endswith('.py') and p[0].isalpha()\n             ]\n         except OSError:"
        },
        {
            "sha": "f846a828ddff7b73f470401667d70600a7583efe",
            "filename": "django/contrib/auth/tests/context_processors.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -9,6 +9,7 @@\n from django.db.models import Q\n from django.test import TestCase\n from django.test.utils import override_settings\n+from django.utils._os import upath\n \n \n class MockUser(object):\n@@ -63,7 +64,7 @@ def test_permlookupdict_in(self):\n @skipIfCustomUser\n @override_settings(\n     TEMPLATE_DIRS=(\n-            os.path.join(os.path.dirname(__file__), 'templates'),\n+            os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n         ),\n     USE_TZ=False,                           # required for loading the fixture\n     PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',),"
        },
        {
            "sha": "25890683e89c1bfc9f8dd3c3ea08dbc1f220b68a",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -11,6 +11,7 @@\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils.encoding import force_text\n+from django.utils._os import upath\n from django.utils import translation\n from django.utils.translation import ugettext as _\n \n@@ -331,7 +332,7 @@ def test_cleaned_data(self):\n         self.assertEqual(form.cleaned_data['email'], email)\n \n     def test_custom_email_subject(self):\n-        template_path = os.path.join(os.path.dirname(__file__), 'templates')\n+        template_path = os.path.join(os.path.dirname(upath(__file__)), 'templates')\n         with self.settings(TEMPLATE_DIRS=(template_path,)):\n             data = {'email': 'testclient@example.com'}\n             form = PasswordResetForm(data)"
        },
        {
            "sha": "0e83ca40a28cc69e0e344d4697c5330a5d2da70a",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.encoding import force_text\n from django.utils.html import escape\n from django.utils.http import urlquote\n+from django.utils._os import upath\n from django.test import TestCase\n from django.test.utils import override_settings\n \n@@ -27,7 +28,7 @@\n     LANGUAGE_CODE='en',\n     TEMPLATE_LOADERS=global_settings.TEMPLATE_LOADERS,\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n     USE_TZ=False,\n     PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',),"
        },
        {
            "sha": "aa7d5ff7d444df26c21efb43b20be2f39d9b080a",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -14,6 +14,7 @@\n from django.test import TestCase\n from django.test.html import parse_html\n from django.test.utils import override_settings\n+from django.utils._os import upath\n from django.utils import unittest\n \n from django.contrib.formtools.tests.wizard import *\n@@ -36,7 +37,7 @@ def done(self, request, cleaned_data):\n \n @override_settings(\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n )\n class PreviewTests(TestCase):\n@@ -214,7 +215,7 @@ def __init__(self, POST=None):\n @override_settings(\n     SECRET_KEY=\"123\",\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n )\n class WizardTests(TestCase):"
        },
        {
            "sha": "4aaea7d56e61e724c6ecc263697cec1eb9cdc336",
            "filename": "django/contrib/formtools/tests/wizard/wizardtests/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fwizardtests%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -9,6 +9,7 @@\n from django.contrib.auth.models import User\n from django.contrib.formtools.wizard.views import CookieWizardView\n from django.contrib.formtools.tests.wizard.forms import UserForm, UserFormSet\n+from django.utils._os import upath\n \n \n class WizardTests(object):\n@@ -86,7 +87,7 @@ def test_form_finish(self):\n         self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n \n         post_data = self.wizard_step_data[1]\n-        post_data['form2-file1'] = open(__file__, 'rb')\n+        post_data['form2-file1'] = open(upath(__file__), 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n@@ -99,7 +100,7 @@ def test_form_finish(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['form_list']\n-        with open(__file__, 'rb') as f:\n+        with open(upath(__file__), 'rb') as f:\n             self.assertEqual(all_data[1]['file1'].read(), f.read())\n         all_data[1]['file1'].close()\n         del all_data[1]['file1']\n@@ -118,7 +119,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         post_data = self.wizard_step_data[1]\n-        with open(__file__, 'rb') as post_file:\n+        with open(upath(__file__), 'rb') as post_file:\n             post_data['form2-file1'] = post_file\n             response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n@@ -130,7 +131,7 @@ def test_cleaned_data(self):\n         self.assertEqual(response.status_code, 200)\n \n         all_data = response.context['all_cleaned_data']\n-        with open(__file__, 'rb') as f:\n+        with open(upath(__file__), 'rb') as f:\n             self.assertEqual(all_data['file1'].read(), f.read())\n         all_data['file1'].close()\n         del all_data['file1']\n@@ -150,7 +151,7 @@ def test_manipulated_data(self):\n \n         post_data = self.wizard_step_data[1]\n         post_data['form2-file1'].close()\n-        post_data['form2-file1'] = open(__file__, 'rb')\n+        post_data['form2-file1'] = open(upath(__file__), 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n \n@@ -178,7 +179,7 @@ def test_form_refresh(self):\n \n         post_data = self.wizard_step_data[1]\n         post_data['form2-file1'].close()\n-        post_data['form2-file1'] = open(__file__, 'rb')\n+        post_data['form2-file1'] = open(upath(__file__), 'rb')\n         response = self.client.post(self.wizard_url, post_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n@@ -291,7 +292,7 @@ def setUp(self):\n         self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n \n     def test_template(self):\n-        templates = os.path.join(os.path.dirname(__file__), 'templates')\n+        templates = os.path.join(os.path.dirname(upath(__file__)), 'templates')\n         with self.settings(\n                 TEMPLATE_DIRS=list(settings.TEMPLATE_DIRS) + [templates]):\n             response = self.client.get(self.wizard_url)"
        },
        {
            "sha": "e13e8589e692e9e3f4860bc9e3a7db39263159ab",
            "filename": "django/contrib/gis/geometry/test_data.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -7,13 +7,14 @@\n \n from django.contrib import gis\n from django.utils import six\n+from django.utils._os import upath\n \n \n # This global used to store reference geometry data.\n GEOMETRIES = None\n \n # Path where reference test data is located.\n-TEST_DATA = os.path.join(os.path.dirname(gis.__file__), 'tests', 'data')\n+TEST_DATA = os.path.join(os.path.dirname(upath(gis.__file__)), 'tests', 'data')\n \n \n def tuplize(seq):"
        },
        {
            "sha": "6b40164422d5fb39b6e9449febd562aec21260c9",
            "filename": "django/contrib/gis/tests/geo3d/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -7,12 +7,13 @@\n from django.contrib.gis.geos import GEOSGeometry, LineString, Point, Polygon\n from django.contrib.gis.utils import LayerMapping, LayerMapError\n from django.test import TestCase\n+from django.utils._os import upath\n \n from .models import (City3D, Interstate2D, Interstate3D, InterstateProj2D,\n     InterstateProj3D, Point2D, Point3D, MultiPoint3D, Polygon2D, Polygon3D)\n \n \n-data_path = os.path.realpath(os.path.join(os.path.dirname(__file__), '..', 'data'))\n+data_path = os.path.realpath(os.path.join(os.path.dirname(upath(__file__)), '..', 'data'))\n city_file = os.path.join(data_path, 'cities', 'cities.shp')\n vrt_file = os.path.join(data_path, 'test_vrt', 'test_vrt.vrt')\n "
        },
        {
            "sha": "a8c607c502a3118bd35b8ea4c0948b5cf72c5939",
            "filename": "django/contrib/gis/tests/geogapp/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeogapp%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -8,6 +8,7 @@\n from django.contrib.gis import gdal\n from django.contrib.gis.measure import D\n from django.test import TestCase\n+from django.utils._os import upath\n \n from .models import City, County, Zipcode\n \n@@ -61,7 +62,7 @@ def test05_geography_layermapping(self):\n         from django.contrib.gis.utils import LayerMapping\n \n         # Getting the shapefile and mapping dictionary.\n-        shp_path = os.path.realpath(os.path.join(os.path.dirname(__file__), '..', 'data'))\n+        shp_path = os.path.realpath(os.path.join(os.path.dirname(upath(__file__)), '..', 'data'))\n         co_shp = os.path.join(shp_path, 'counties', 'counties.shp')\n         co_mapping = {'name' : 'Name',\n                       'state' : 'State',"
        },
        {
            "sha": "470e5be21631afaace474038346280a60f255d93",
            "filename": "django/contrib/gis/tests/layermap/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -13,13 +13,14 @@\n from django.conf import settings\n from django.test import TestCase\n from django.utils import unittest\n+from django.utils._os import upath\n \n from .models import (\n     City, County, CountyFeat, Interstate, ICity1, ICity2, Invalid, State,\n     city_mapping, co_mapping, cofeat_mapping, inter_mapping)\n \n \n-shp_path = os.path.realpath(os.path.join(os.path.dirname(__file__), os.pardir, 'data'))\n+shp_path = os.path.realpath(os.path.join(os.path.dirname(upath(__file__)), os.pardir, 'data'))\n city_shp = os.path.join(shp_path, 'cities', 'cities.shp')\n co_shp = os.path.join(shp_path, 'counties', 'counties.shp')\n inter_shp = os.path.join(shp_path, 'interstates', 'interstates.shp')"
        },
        {
            "sha": "4a1cf66b17137fb70cd2b0746a4d5237d2066dc9",
            "filename": "django/contrib/sitemaps/tests/http.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -11,6 +11,7 @@\n from django.test.utils import override_settings\n from django.utils.unittest import skipUnless\n from django.utils.formats import localize\n+from django.utils._os import upath\n from django.utils.translation import activate, deactivate\n \n from .base import SitemapTestsBase\n@@ -29,7 +30,7 @@ def test_simple_sitemap_index(self):\n         self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @override_settings(\n-        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'templates'),)\n     )\n     def test_simple_sitemap_custom_index(self):\n         \"A simple sitemap index can be rendered with a custom template\"\n@@ -64,7 +65,7 @@ def test_simple_sitemap(self):\n         self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @override_settings(\n-        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'templates'),)\n     )\n     def test_simple_custom_sitemap(self):\n         \"A simple sitemap can be rendered with a custom template\""
        },
        {
            "sha": "7e87a89f5b9d2cb635e67659f9475032bbd4b7bc",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -19,6 +19,7 @@\n from django.utils.encoding import force_bytes, force_text\n from django.utils.functional import LazyObject\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n \n from django.contrib.staticfiles.utils import check_settings, matches_patterns\n \n@@ -296,7 +297,7 @@ def __init__(self, app, *args, **kwargs):\n         \"\"\"\n         # app is the actual app module\n         mod = import_module(app)\n-        mod_path = os.path.dirname(mod.__file__)\n+        mod_path = os.path.dirname(upath(mod.__file__))\n         location = os.path.join(mod_path, self.source_dir)\n         super(AppStaticStorage, self).__init__(location, *args, **kwargs)\n "
        },
        {
            "sha": "fab50593761e986ec3d2fa949f1d2cbfeaeac65c",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -9,6 +9,7 @@\n from django.core.management.base import BaseCommand, CommandError, handle_default_options\n from django.core.management.color import color_style\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n from django.utils import six\n \n # For backwards compatibility: get_version() used to be in this module.\n@@ -410,10 +411,10 @@ def setup_environ(settings_mod, original_settings_path=None):\n     # Add this project to sys.path so that it's importable in the conventional\n     # way. For example, if this file (manage.py) lives in a directory\n     # \"myproject\", this code would add \"/path/to/myproject\" to sys.path.\n-    if '__init__.py' in settings_mod.__file__:\n-        p = os.path.dirname(settings_mod.__file__)\n+    if '__init__.py' in upath(settings_mod.__file__):\n+        p = os.path.dirname(upath(settings_mod.__file__))\n     else:\n-        p = settings_mod.__file__\n+        p = upath(settings_mod.__file__)\n     project_directory, settings_filename = os.path.split(p)\n     if project_directory == os.curdir or not project_directory:\n         project_directory = os.getcwd()"
        },
        {
            "sha": "e1d8a33332b37ca9e4ca161480b0669efd7297bf",
            "filename": "django/core/management/commands/compilemessages.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -5,6 +5,7 @@\n import sys\n from optparse import make_option\n from django.core.management.base import BaseCommand, CommandError\n+from django.utils._os import npath\n \n def has_bom(fn):\n     with open(fn, 'rb') as f:\n@@ -41,8 +42,8 @@ def compile_messages(stderr, locale=None):\n                     # command, so that we can take advantage of shell quoting, to\n                     # quote any malicious characters/escaping.\n                     # See http://cyberelk.net/tim/articles/cmdline/ar01s02.html\n-                    os.environ['djangocompilemo'] = pf + '.mo'\n-                    os.environ['djangocompilepo'] = pf + '.po'\n+                    os.environ['djangocompilemo'] = npath(pf + '.mo')\n+                    os.environ['djangocompilepo'] = npath(pf + '.po')\n                     if sys.platform == 'win32': # Different shell-variable syntax\n                         cmd = 'msgfmt --check-format -o \"%djangocompilemo%\" \"%djangocompilepo%\"'\n                     else:"
        },
        {
            "sha": "ed47b8fbf11b10eb6e25d4d6487c787c4db10b52",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -13,6 +13,7 @@\n       IntegrityError, DatabaseError)\n from django.db.models import get_apps\n from django.utils.encoding import force_text\n+from django.utils._os import upath\n from itertools import product\n \n try:\n@@ -97,10 +98,10 @@ def read(self):\n             if hasattr(app, '__path__'):\n                 # It's a 'models/' subpackage\n                 for path in app.__path__:\n-                    app_module_paths.append(path)\n+                    app_module_paths.append(upath(path))\n             else:\n                 # It's a models.py module\n-                app_module_paths.append(app.__file__)\n+                app_module_paths.append(upath(app.__file__))\n \n         app_fixtures = [os.path.join(os.path.dirname(path), 'fixtures') for path in app_module_paths]\n "
        },
        {
            "sha": "606cbe0b85e5497579ebebb52c6a0c6581cea887",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -301,7 +301,7 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n \n     locales = []\n     if locale is not None:\n-        locales.append(locale)\n+        locales.append(str(locale))\n     elif all:\n         locale_dirs = filter(os.path.isdir, glob.glob('%s/*' % localedir))\n         locales = [os.path.basename(l) for l in locale_dirs]\n@@ -316,8 +316,8 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n         if not os.path.isdir(basedir):\n             os.makedirs(basedir)\n \n-        pofile = os.path.join(basedir, '%s.po' % domain)\n-        potfile = os.path.join(basedir, '%s.pot' % domain)\n+        pofile = os.path.join(basedir, '%s.po' % str(domain))\n+        potfile = os.path.join(basedir, '%s.pot' % str(domain))\n \n         if os.path.exists(potfile):\n             os.unlink(potfile)"
        },
        {
            "sha": "e46f4ae4f5d19b3b61972e42f65f87ee4bb19a56",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -8,6 +8,7 @@\n from django.core.management.base import CommandError\n from django.db import models\n from django.db.models import get_models\n+from django.utils._os import upath\n \n \n def sql_create(app, style, connection):\n@@ -159,7 +160,7 @@ def _split_statements(content):\n \n def custom_sql_for_model(model, style, connection):\n     opts = model._meta\n-    app_dir = os.path.normpath(os.path.join(os.path.dirname(models.get_app(model._meta.app_label).__file__), 'sql'))\n+    app_dir = os.path.normpath(os.path.join(os.path.dirname(upath(models.get_app(model._meta.app_label).__file__)), 'sql'))\n     output = []\n \n     # Post-creation SQL should come before any initial SQL data is loaded."
        },
        {
            "sha": "c657fd9a54265d1ce40053dccb0dc9ceb7b66423",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -251,9 +251,9 @@ def __repr__(self):\n             urlconf_repr = '<%s list>' % self.urlconf_name[0].__class__.__name__\n         else:\n             urlconf_repr = repr(self.urlconf_name)\n-        return force_str('<%s %s (%s:%s) %s>' % (\n+        return str('<%s %s (%s:%s) %s>') % (\n             self.__class__.__name__, urlconf_repr, self.app_name,\n-            self.namespace, self.regex.pattern))\n+            self.namespace, self.regex.pattern)\n \n     def _populate(self):\n         lookups = MultiValueDict()"
        },
        {
            "sha": "56edc36becfaada1259554da557d5f8e85738a35",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -5,6 +5,7 @@\n from django.utils.datastructures import SortedDict\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n+from django.utils._os import upath\n from django.utils import six\n \n import imp\n@@ -244,8 +245,8 @@ def register_models(self, app_label, *models):\n                 # The same model may be imported via different paths (e.g.\n                 # appname.models and project.appname.models). We use the source\n                 # filename as a means to detect identity.\n-                fname1 = os.path.abspath(sys.modules[model.__module__].__file__)\n-                fname2 = os.path.abspath(sys.modules[model_dict[model_name].__module__].__file__)\n+                fname1 = os.path.abspath(upath(sys.modules[model.__module__].__file__))\n+                fname2 = os.path.abspath(upath(sys.modules[model_dict[model_name].__module__].__file__))\n                 # Since the filename extension could be .py the first time and\n                 # .pyc or .pyo the second time, ignore the extension when\n                 # comparing."
        },
        {
            "sha": "842fd354d62d0de38dcd4af28daa2fde65e90fcf",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -5,6 +5,7 @@\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n+from django.utils._os import upath\n from django.utils import six\n \n \n@@ -27,7 +28,7 @@ def load_backend(backend_name):\n     except ImportError as e_user:\n         # The database backend wasn't found. Display a helpful error message\n         # listing all possible (built-in) database backends.\n-        backend_dir = os.path.join(os.path.dirname(__file__), 'backends')\n+        backend_dir = os.path.join(os.path.dirname(upath(__file__)), 'backends')\n         try:\n             builtin_backends = [\n                 name for _, name, ispkg in pkgutil.iter_modules([backend_dir])"
        },
        {
            "sha": "6c1cd17a83c0204c6000c4195afdd31ee8bed335",
            "filename": "django/utils/_os.py",
            "status": "modified",
            "additions": 22,
            "deletions": 1,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Futils%2F_os.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Futils%2F_os.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2F_os.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -1,6 +1,8 @@\n import os\n import stat\n+import sys\n from os.path import join, normcase, normpath, abspath, isabs, sep, dirname\n+\n from django.utils.encoding import force_text\n from django.utils import six\n \n@@ -10,6 +12,9 @@\n     class WindowsError(Exception):\n         pass\n \n+if not six.PY3:\n+    fs_encoding = sys.getfilesystemencoding() or sys.getdefaultencoding()\n+\n \n # Under Python 2, define our own abspath function that can handle joining\n # unicode paths to a current working directory that has non-ASCII characters\n@@ -29,6 +34,23 @@ def abspathu(path):\n             path = join(os.getcwdu(), path)\n         return normpath(path)\n \n+def upath(path):\n+    \"\"\"\n+    Always return a unicode path.\n+    \"\"\"\n+    if not six.PY3:\n+        return path.decode(fs_encoding)\n+    return path\n+\n+def npath(path):\n+    \"\"\"\n+    Always return a native path, that is unicode on Python 3 and bytestring on\n+    Python 2.\n+    \"\"\"\n+    if not six.PY3 and not isinstance(path, bytes):\n+        return path.encode(fs_encoding)\n+    return path\n+\n def safe_join(base, *paths):\n     \"\"\"\n     Joins one or more path components to the base path component intelligently.\n@@ -74,4 +96,3 @@ def rmtree_errorhandler(func, path, exc_info):\n     os.chmod(path, stat.S_IWRITE)\n     # use the original function to repeat the operation\n     func(path)\n-"
        },
        {
            "sha": "cf6270cc0c6f1d04bff58df3380fdc85caddea28",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -10,6 +10,7 @@\n \n from django.utils.importlib import import_module\n from django.utils.encoding import force_str, force_text\n+from django.utils._os import upath\n from django.utils.safestring import mark_safe, SafeData\n from django.utils import six\n from django.utils.six import StringIO\n@@ -109,7 +110,7 @@ def translation(language):\n \n     from django.conf import settings\n \n-    globalpath = os.path.join(os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n+    globalpath = os.path.join(os.path.dirname(upath(sys.modules[settings.__module__].__file__)), 'locale')\n \n     def _fetch(lang, fallback=None):\n \n@@ -151,7 +152,7 @@ def _merge(path):\n \n         for appname in reversed(settings.INSTALLED_APPS):\n             app = import_module(appname)\n-            apppath = os.path.join(os.path.dirname(app.__file__), 'locale')\n+            apppath = os.path.join(os.path.dirname(upath(app.__file__)), 'locale')\n \n             if os.path.isdir(apppath):\n                 res = _merge(apppath)\n@@ -337,7 +338,7 @@ def all_locale_paths():\n     \"\"\"\n     from django.conf import settings\n     globalpath = os.path.join(\n-        os.path.dirname(sys.modules[settings.__module__].__file__), 'locale')\n+        os.path.dirname(upath(sys.modules[settings.__module__].__file__)), 'locale')\n     return [globalpath] + list(settings.LOCALE_PATHS)\n \n def check_for_language(lang_code):"
        },
        {
            "sha": "c1d456d667114ab1c53456bd58bc89ea5a394b3c",
            "filename": "django/views/i18n.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fviews%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/django%2Fviews%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fi18n.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -8,6 +8,7 @@\n from django.utils.text import javascript_quote\n from django.utils.encoding import smart_text\n from django.utils.formats import get_format_modules, get_format\n+from django.utils._os import upath\n from django.utils import six\n \n def set_language(request):\n@@ -197,7 +198,7 @@ def javascript_catalog(request, domain='djangojs', packages=None):\n     # paths of requested packages\n     for package in packages:\n         p = importlib.import_module(package)\n-        path = os.path.join(os.path.dirname(p.__file__), 'locale')\n+        path = os.path.join(os.path.dirname(upath(p.__file__)), 'locale')\n         paths.append(path)\n     # add the filesystem paths listed in the LOCALE_PATHS setting\n     paths.extend(list(reversed(settings.LOCALE_PATHS)))"
        },
        {
            "sha": "b667c8c6d455cee3892e2881e0e5283cdb4b57fa",
            "filename": "tests/modeltests/fixtures/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -226,9 +226,9 @@ def test_compressed_loading(self):\n \n     def test_ambiguous_compressed_fixture(self):\n         # The name \"fixture5\" is ambigous, so loading it will raise an error\n-        with six.assertRaisesRegex(self, management.CommandError,\n-                \"Multiple fixtures named 'fixture5'\"):\n+        with self.assertRaises(management.CommandError) as cm:\n             management.call_command('loaddata', 'fixture5', verbosity=0, commit=False)\n+            self.assertIn(\"Multiple fixtures named 'fixture5'\", cm.exception.args[0])\n \n     def test_db_loading(self):\n         # Load db fixtures 1 and 2. These will load using the 'default' database identifier implicitly\n@@ -250,9 +250,9 @@ def test_loaddata_error_message(self):\n         # is closed at the end of each test.\n         if connection.vendor == 'mysql':\n             connection.cursor().execute(\"SET sql_mode = 'TRADITIONAL'\")\n-        with six.assertRaisesRegex(self, IntegrityError,\n-                \"Could not load fixtures.Article\\(pk=1\\): .*$\"):\n+        with self.assertRaises(IntegrityError) as cm:\n             management.call_command('loaddata', 'invalid.json', verbosity=0, commit=False)\n+            self.assertIn(\"Could not load fixtures.Article(pk=1):\", cm.exception.args[0])\n \n     def test_loading_using(self):\n         # Load db fixtures 1 and 2. These will load using the 'default' database identifier explicitly\n@@ -308,9 +308,9 @@ def test_format_discovery(self):\n \n         # Try to load fixture 2 using format discovery; this will fail\n         # because there are two fixture2's in the fixtures directory\n-        with six.assertRaisesRegex(self, management.CommandError,\n-                \"Multiple fixtures named 'fixture2'\"):\n+        with self.assertRaises(management.CommandError) as cm:\n             management.call_command('loaddata', 'fixture2', verbosity=0)\n+            self.assertIn(\"Multiple fixtures named 'fixture2'\", cm.exception.args[0])\n \n         # object list is unaffected\n         self.assertQuerysetEqual(Article.objects.all(), ["
        },
        {
            "sha": "c008c00906034a86ea74eaef15f3ca4d134d18a1",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -10,6 +10,7 @@\n from django.db import connection\n from django.db.models.query import EmptyQuerySet\n from django.forms.models import model_to_dict\n+from django.utils._os import upath\n from django.utils.unittest import skipUnless\n from django.test import TestCase\n from django.utils import six\n@@ -1282,9 +1283,9 @@ def test_image_field(self):\n         # it comes to validation. This specifically tests that #6302 is fixed for\n         # both file fields and image fields.\n \n-        with open(os.path.join(os.path.dirname(__file__), \"test.png\"), 'rb') as fp:\n+        with open(os.path.join(os.path.dirname(upath(__file__)), \"test.png\"), 'rb') as fp:\n             image_data = fp.read()\n-        with open(os.path.join(os.path.dirname(__file__), \"test2.png\"), 'rb') as fp:\n+        with open(os.path.join(os.path.dirname(upath(__file__)), \"test2.png\"), 'rb') as fp:\n             image_data2 = fp.read()\n \n         f = ImageFileForm("
        },
        {
            "sha": "239bc6780939a0f4d46d79b9741917c22614fb0f",
            "filename": "tests/modeltests/proxy_model_inheritance/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fmodeltests%2Fproxy_model_inheritance%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fmodeltests%2Fproxy_model_inheritance%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fproxy_model_inheritance%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -8,6 +8,7 @@\n from django.db.models.loading import cache, load_app\n from django.test import TestCase, TransactionTestCase\n from django.test.utils import override_settings\n+from django.utils._os import upath\n \n from .models import (ConcreteModel, ConcreteModelSubclass,\n     ConcreteModelSubclassProxy)\n@@ -23,7 +24,7 @@ class ProxyModelInheritanceTests(TransactionTestCase):\n \n     def setUp(self):\n         self.old_sys_path = sys.path[:]\n-        sys.path.append(os.path.dirname(os.path.abspath(__file__)))\n+        sys.path.append(os.path.dirname(os.path.abspath(upath(__file__))))\n         for app in settings.INSTALLED_APPS:\n             load_app(app)\n "
        },
        {
            "sha": "d0ca9d26dfcdda5d4b33e451deef7855d8f47834",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -19,13 +19,15 @@\n from django.db import connection\n from django.test.simple import DjangoTestSuiteRunner\n from django.utils import unittest\n+from django.utils.encoding import force_str, force_text\n+from django.utils._os import upath\n from django.test import LiveServerTestCase\n \n-test_dir = os.path.dirname(os.path.dirname(__file__))\n+test_dir = os.path.dirname(os.path.dirname(upath(__file__)))\n \n class AdminScriptTestCase(unittest.TestCase):\n     def write_settings(self, filename, apps=None, is_dir=False, sdict=None):\n-        test_dir = os.path.dirname(os.path.dirname(__file__))\n+        test_dir = os.path.dirname(os.path.dirname(upath(__file__)))\n         if is_dir:\n             settings_dir = os.path.join(test_dir, filename)\n             os.mkdir(settings_dir)\n@@ -94,6 +96,7 @@ def _ext_backend_paths(self):\n         return paths\n \n     def run_test(self, script, args, settings_file=None, apps=None):\n+        test_dir = os.path.dirname(os.path.dirname(__file__))\n         project_dir = os.path.dirname(test_dir)\n         base_dir = os.path.dirname(project_dir)\n         ext_backend_base_dirs = self._ext_backend_paths()\n@@ -134,7 +137,7 @@ def run_test(self, script, args, settings_file=None, apps=None):\n         return out, err\n \n     def run_django_admin(self, args, settings_file=None):\n-        bin_dir = os.path.abspath(os.path.dirname(bin.__file__))\n+        bin_dir = os.path.abspath(os.path.dirname(upath(bin.__file__)))\n         return self.run_test(os.path.join(bin_dir, 'django-admin.py'), args, settings_file)\n \n     def run_manage(self, args, settings_file=None):\n@@ -144,7 +147,7 @@ def safe_remove(path):\n             except OSError:\n                 pass\n \n-        conf_dir = os.path.dirname(conf.__file__)\n+        conf_dir = os.path.dirname(upath(conf.__file__))\n         template_manage_py = os.path.join(conf_dir, 'project_template', 'manage.py')\n \n         test_manage_py = os.path.join(test_dir, 'manage.py')\n@@ -166,10 +169,12 @@ def assertNoOutput(self, stream):\n \n     def assertOutput(self, stream, msg):\n         \"Utility assertion: assert that the given message exists in the output\"\n+        stream = force_text(stream)\n         self.assertTrue(msg in stream, \"'%s' does not match actual output text '%s'\" % (msg, stream))\n \n     def assertNotInOutput(self, stream, msg):\n         \"Utility assertion: assert that the given message doesn't exist in the output\"\n+        stream = force_text(stream)\n         self.assertFalse(msg in stream, \"'%s' matches actual output text '%s'\" % (msg, stream))\n \n ##########################################################################\n@@ -1553,7 +1558,7 @@ def test_custom_project_template_context_variables(self):\n         self.assertNoOutput(err)\n         test_manage_py = os.path.join(testproject_dir, 'manage.py')\n         with open(test_manage_py, 'r') as fp:\n-            content = fp.read()\n+            content = force_text(fp.read())\n             self.assertIn(\"project_name = 'another_project'\", content)\n             self.assertIn(\"project_directory = '%s'\" % testproject_dir, content)\n "
        },
        {
            "sha": "a45dc3e9a6abb56691c7f04da789a29444b603b2",
            "filename": "tests/regressiontests/admin_scripts/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fadmin_scripts%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fadmin_scripts%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Furls.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -1,7 +1,8 @@\n import os\n from django.conf.urls import patterns\n+from django.utils._os import upath\n \n-here = os.path.dirname(__file__)\n+here = os.path.dirname(upath(__file__))\n \n urlpatterns = patterns('',\n     (r'^custom_templates/(?P<path>.*)$', 'django.views.static.serve', {"
        },
        {
            "sha": "04394a673b7211a50d83a462c1dfdda59b02f6ac",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -33,6 +33,7 @@\n from django.utils.encoding import iri_to_uri, force_bytes\n from django.utils.html import escape\n from django.utils.http import urlencode\n+from django.utils._os import upath\n from django.utils import six\n from django.test.utils import override_settings\n \n@@ -633,7 +634,7 @@ def test_filter_with_custom_template(self):\n         Refs #17515.\n         \"\"\"\n         template_dirs = settings.TEMPLATE_DIRS + (\n-            os.path.join(os.path.dirname(__file__), 'templates'),)\n+            os.path.join(os.path.dirname(upath(__file__)), 'templates'),)\n         with self.settings(TEMPLATE_DIRS=template_dirs):\n             response = self.client.get(\"/test_admin/admin/admin_views/color2/\")\n             self.assertTrue('custom_filter_template.html' in [t.name for t in response.templates])"
        },
        {
            "sha": "6dd0be2194ad26a34d565ff4913bc76ee352cc95",
            "filename": "tests/regressiontests/app_loading/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fapp_loading%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fapp_loading%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fapp_loading%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -7,13 +7,14 @@\n \n from django.conf import Settings\n from django.db.models.loading import cache, load_app, get_model, get_models\n+from django.utils._os import upath\n from django.utils.unittest import TestCase\n \n class EggLoadingTest(TestCase):\n \n     def setUp(self):\n         self.old_path = sys.path[:]\n-        self.egg_dir = '%s/eggs' % os.path.dirname(__file__)\n+        self.egg_dir = '%s/eggs' % os.path.dirname(upath(__file__))\n \n         # This test adds dummy applications to the app cache. These\n         # need to be removed in order to prevent bad interactions"
        },
        {
            "sha": "fcc1e0f7d11d2966d055b42f387ea4a22a2be91e",
            "filename": "tests/regressiontests/bug639/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fbug639%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fbug639%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbug639%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -11,6 +11,7 @@\n \n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.utils import unittest\n+from django.utils._os import upath\n \n from .models import Photo, PhotoForm, temp_storage_dir\n \n@@ -23,7 +24,7 @@ def testBug639(self):\n         called.\n         \"\"\"\n         # Grab an image for testing.\n-        filename = os.path.join(os.path.dirname(__file__), \"test.jpg\")\n+        filename = os.path.join(os.path.dirname(upath(__file__)), \"test.jpg\")\n         with open(filename, \"rb\") as fp:\n             img = fp.read()\n "
        },
        {
            "sha": "b6d3e1ff0b5b4626257d3e6c8cd3726b2c78ea89",
            "filename": "tests/regressiontests/file_storage/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ffile_storage%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_storage%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -24,6 +24,7 @@\n from django.test import SimpleTestCase\n from django.utils import six\n from django.utils import unittest\n+from django.utils._os import upath\n from django.test.utils import override_settings\n from ..servers.tests import LiveServerBase\n \n@@ -104,7 +105,7 @@ def test_emtpy_location(self):\n         \"\"\"\n         storage = self.storage_class(location='')\n         self.assertEqual(storage.base_location, '')\n-        self.assertEqual(storage.location, os.getcwd())\n+        self.assertEqual(storage.location, upath(os.getcwd()))\n \n     def test_file_access_options(self):\n         \"\"\"\n@@ -534,7 +535,7 @@ def catching_open(*args):\n         from django.core.files import images\n         images.open = catching_open\n         try:\n-            get_image_dimensions(os.path.join(os.path.dirname(__file__), \"test1.png\"))\n+            get_image_dimensions(os.path.join(os.path.dirname(upath(__file__)), \"test1.png\"))\n         finally:\n             del images.open\n         self.assertTrue(FileWrapper._closed)\n@@ -551,7 +552,7 @@ def test_multiple_calls(self):\n         \"\"\"\n         from django.core.files.images import ImageFile\n \n-        img_path = os.path.join(os.path.dirname(__file__), \"test.png\")\n+        img_path = os.path.join(os.path.dirname(upath(__file__)), \"test.png\")\n         image = ImageFile(open(img_path, 'rb'))\n         image_pil = Image.open(img_path)\n         size_1, size_2 = get_image_dimensions(image), get_image_dimensions(image)"
        },
        {
            "sha": "988c5acd0c92d4b514d572672110af07313e0d0d",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -14,6 +14,8 @@\n from django.test import (TestCase, TransactionTestCase, skipIfDBFeature,\n     skipUnlessDBFeature)\n from django.test.utils import override_settings\n+from django.utils.encoding import force_text\n+from django.utils._os import upath\n from django.utils import six\n from django.utils.six import PY3, StringIO\n \n@@ -126,7 +128,7 @@ def test_absolute_path(self):\n         fixture directory.\n         \"\"\"\n         load_absolute_path = os.path.join(\n-            os.path.dirname(__file__),\n+            os.path.dirname(upath(__file__)),\n             'fixtures',\n             'absolute.json'\n         )\n@@ -388,7 +390,7 @@ def test_loaddata_raises_error_when_fixture_has_invalid_foreign_key(self):\n                 commit=False,\n             )\n \n-    _cur_dir = os.path.dirname(os.path.abspath(__file__))\n+    _cur_dir = os.path.dirname(os.path.abspath(upath(__file__)))\n \n     @override_settings(FIXTURE_DIRS=[os.path.join(_cur_dir, 'fixtures_1'),\n                                      os.path.join(_cur_dir, 'fixtures_2')])\n@@ -430,7 +432,7 @@ def test_loaddata_not_existant_fixture_file(self):\n             stdout=stdout_output,\n         )\n         self.assertTrue(\"No xml fixture 'this_fixture_doesnt_exist' in\" in\n-            stdout_output.getvalue())\n+            force_text(stdout_output.getvalue()))\n \n \n class NaturalKeyFixtureTests(TestCase):"
        },
        {
            "sha": "e17d976fcfe58874b887a228eb421fb54dff8b53",
            "filename": "tests/regressiontests/forms/tests/fields.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -36,6 +36,7 @@\n from django.forms import *\n from django.test import SimpleTestCase\n from django.utils import six\n+from django.utils._os import upath\n \n \n def fix_os_paths(x):\n@@ -928,12 +929,12 @@ def test_combofield_2(self):\n     # FilePathField ###############################################################\n \n     def test_filepathfield_1(self):\n-        path = os.path.abspath(forms.__file__)\n+        path = os.path.abspath(upath(forms.__file__))\n         path = os.path.dirname(path) + '/'\n         self.assertTrue(fix_os_paths(path).endswith('/django/forms/'))\n \n     def test_filepathfield_2(self):\n-        path = forms.__file__\n+        path = upath(forms.__file__)\n         path = os.path.dirname(os.path.abspath(path)) + '/'\n         f = FilePathField(path=path)\n         f.choices = [p for p in f.choices if p[0].endswith('.py')]\n@@ -954,7 +955,7 @@ def test_filepathfield_2(self):\n         assert fix_os_paths(f.clean(path + 'fields.py')).endswith('/django/forms/fields.py')\n \n     def test_filepathfield_3(self):\n-        path = forms.__file__\n+        path = upath(forms.__file__)\n         path = os.path.dirname(os.path.abspath(path)) + '/'\n         f = FilePathField(path=path, match='^.*?\\.py$')\n         f.choices.sort()\n@@ -972,7 +973,7 @@ def test_filepathfield_3(self):\n             self.assertTrue(got[0].endswith(exp[0]))\n \n     def test_filepathfield_4(self):\n-        path = os.path.abspath(forms.__file__)\n+        path = os.path.abspath(upath(forms.__file__))\n         path = os.path.dirname(path) + '/'\n         f = FilePathField(path=path, recursive=True, match='^.*?\\.py$')\n         f.choices.sort()\n@@ -992,7 +993,7 @@ def test_filepathfield_4(self):\n             self.assertTrue(got[0].endswith(exp[0]))\n \n     def test_filepathfield_folders(self):\n-        path = os.path.dirname(__file__) + '/filepath_test_files/'\n+        path = os.path.dirname(upath(__file__)) + '/filepath_test_files/'\n         f = FilePathField(path=path, allow_folders=True, allow_files=False)\n         f.choices.sort()\n         expected = ["
        },
        {
            "sha": "a601e541c63daa59174ffc8c787e73f51030940a",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -14,6 +14,7 @@\n                          parse_cookie)\n from django.test import TestCase\n from django.utils.encoding import smart_str\n+from django.utils._os import upath\n from django.utils import six\n from django.utils import unittest\n \n@@ -483,7 +484,7 @@ def test_streaming_response(self):\n \n class FileCloseTests(TestCase):\n     def test_response(self):\n-        filename = os.path.join(os.path.dirname(__file__), 'abc.txt')\n+        filename = os.path.join(os.path.dirname(upath(__file__)), 'abc.txt')\n \n         # file isn't closed until we close the response.\n         file1 = open(filename)\n@@ -516,7 +517,7 @@ def test_response(self):\n         self.assertTrue(file2.closed)\n \n     def test_streaming_response(self):\n-        filename = os.path.join(os.path.dirname(__file__), 'abc.txt')\n+        filename = os.path.join(os.path.dirname(upath(__file__)), 'abc.txt')\n \n         # file isn't closed until we close the response.\n         file1 = open(filename)"
        },
        {
            "sha": "294446911057fde0e9cad6149abef856295087d7",
            "filename": "tests/regressiontests/i18n/commands/compilation.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -4,9 +4,10 @@\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils import translation, six\n+from django.utils._os import upath\n from django.utils.six import StringIO\n \n-test_dir = os.path.abspath(os.path.dirname(__file__))\n+test_dir = os.path.abspath(os.path.dirname(upath(__file__)))\n \n \n class MessageCompilationTests(TestCase):\n@@ -25,9 +26,9 @@ class PoFileTests(MessageCompilationTests):\n \n     def test_bom_rejection(self):\n         os.chdir(test_dir)\n-        with six.assertRaisesRegex(self, CommandError,\n-                \"file has a BOM \\(Byte Order Mark\\)\"):\n+        with self.assertRaises(CommandError) as cm:\n             call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n+        self.assertIn(\"file has a BOM (Byte Order Mark)\", cm.exception.args[0])\n         self.assertFalse(os.path.exists(self.MO_FILE))\n \n "
        },
        {
            "sha": "aa5efe1967ce85ef5ed6bed555f78aaedac723b8",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 17,
            "deletions": 14,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -1,11 +1,14 @@\n # -*- encoding: utf-8 -*-\n+from __future__ import unicode_literals\n \n import os\n import re\n import shutil\n \n from django.core import management\n from django.test import TestCase\n+from django.utils.encoding import force_text\n+from django.utils._os import upath\n from django.utils.six import StringIO\n \n \n@@ -17,7 +20,7 @@ class ExtractorTests(TestCase):\n \n     def setUp(self):\n         self._cwd = os.getcwd()\n-        self.test_dir = os.path.abspath(os.path.dirname(__file__))\n+        self.test_dir = os.path.abspath(os.path.dirname(upath(__file__)))\n \n     def _rmrf(self, dname):\n         if os.path.commonprefix([self.test_dir, os.path.abspath(dname)]) != self.test_dir:\n@@ -55,7 +58,7 @@ def test_comments_extractor(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertTrue('#. Translators: This comment should be extracted' in po_contents)\n             self.assertTrue('This comment should not be extracted' not in po_contents)\n             # Comments in templates\n@@ -83,7 +86,7 @@ def test_templatize_trans_tag(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertMsgId('Literal with a percent symbol at the end %%', po_contents)\n             self.assertMsgId('Literal with a percent %% symbol in the middle', po_contents)\n             self.assertMsgId('Completed 50%% of all the tasks', po_contents)\n@@ -99,7 +102,7 @@ def test_templatize_blocktrans_tag(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertMsgId('I think that 100%% is more that 50%% of anything.', po_contents)\n             self.assertMsgId('I think that 100%% is more that 50%% of %(obj)s.', po_contents)\n             self.assertMsgId(\"Blocktrans extraction shouldn't double escape this: %%, a=%(a)s\", po_contents)\n@@ -123,7 +126,7 @@ def test_extraction_warning(self):\n         stdout = StringIO()\n         management.call_command('makemessages', locale=LOCALE, stdout=stdout)\n         os.remove('./code_sample.py')\n-        self.assertIn(\"code_sample.py:4\", stdout.getvalue())\n+        self.assertIn(\"code_sample.py:4\", force_text(stdout.getvalue()))\n \n     def test_template_message_context_extractor(self):\n         \"\"\"\n@@ -135,7 +138,7 @@ def test_template_message_context_extractor(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             # {% trans %}\n             self.assertTrue('msgctxt \"Special trans context #1\"' in po_contents)\n             self.assertTrue(\"Translatable literal #7a\" in po_contents)\n@@ -161,7 +164,7 @@ def test_context_in_single_quotes(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             # {% trans %}\n             self.assertTrue('msgctxt \"Context wrapped in double quotes\"' in po_contents)\n             self.assertTrue('msgctxt \"Context wrapped in single quotes\"' in po_contents)\n@@ -216,7 +219,7 @@ class SymlinkExtractorTests(ExtractorTests):\n \n     def setUp(self):\n         self._cwd = os.getcwd()\n-        self.test_dir = os.path.abspath(os.path.dirname(__file__))\n+        self.test_dir = os.path.abspath(os.path.dirname(upath(__file__)))\n         self.symlinked_dir = os.path.join(self.test_dir, 'templates_symlinked')\n \n     def tearDown(self):\n@@ -238,7 +241,7 @@ def test_symlink(self):\n             management.call_command('makemessages', locale=LOCALE, verbosity=0, symlinks=True)\n             self.assertTrue(os.path.exists(self.PO_FILE))\n             with open(self.PO_FILE, 'r') as fp:\n-                po_contents = fp.read()\n+                po_contents = force_text(fp.read())\n                 self.assertMsgId('This literal should be included.', po_contents)\n                 self.assertTrue('templates_symlinked/test.html' in po_contents)\n \n@@ -250,7 +253,7 @@ def test_copy_plural_forms(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertTrue('Plural-Forms: nplurals=2; plural=(n != 1)' in po_contents)\n \n \n@@ -261,15 +264,15 @@ def test_no_wrap_enabled(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0, no_wrap=True)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertMsgId('This literal should also be included wrapped or not wrapped depending on the use of the --no-wrap option.', po_contents)\n \n     def test_no_wrap_disabled(self):\n         os.chdir(self.test_dir)\n         management.call_command('makemessages', locale=LOCALE, verbosity=0, no_wrap=False)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertMsgId('\"\"\\n\"This literal should also be included wrapped or not wrapped depending on the \"\\n\"use of the --no-wrap option.\"', po_contents, use_quotes=False)\n \n \n@@ -280,13 +283,13 @@ def test_no_location_enabled(self):\n         management.call_command('makemessages', locale=LOCALE, verbosity=0, no_location=True)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertFalse('#: templates/test.html:55' in po_contents)\n \n     def test_no_location_disabled(self):\n         os.chdir(self.test_dir)\n         management.call_command('makemessages', locale=LOCALE, verbosity=0, no_location=False)\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         with open(self.PO_FILE, 'r') as fp:\n-            po_contents = fp.read()\n+            po_contents = force_text(fp.read())\n             self.assertTrue('#: templates/test.html:55' in po_contents)"
        },
        {
            "sha": "5e8a9823e12384df74913abaa6786b24f54332be",
            "filename": "tests/regressiontests/i18n/contenttypes/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcontenttypes%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -6,14 +6,15 @@\n from django.contrib.contenttypes.models import ContentType\n from django.test import TestCase\n from django.test.utils import override_settings\n+from django.utils._os import upath\n from django.utils import six\n from django.utils import translation\n \n \n @override_settings(\n     USE_I18N=True,\n     LOCALE_PATHS=(\n-        os.path.join(os.path.dirname(__file__), 'locale'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'locale'),\n     ),\n     LANGUAGE_CODE='en',\n     LANGUAGES=("
        },
        {
            "sha": "358cdf65db86e196728475d82292b12127aa44d4",
            "filename": "tests/regressiontests/i18n/patterns/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -7,16 +7,17 @@\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.template import Template, Context\n+from django.utils._os import upath\n from django.utils import translation\n \n \n @override_settings(\n     USE_I18N=True,\n     LOCALE_PATHS=(\n-        os.path.join(os.path.dirname(__file__), 'locale'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'locale'),\n     ),\n     TEMPLATE_DIRS=(\n-        os.path.join(os.path.dirname(__file__), 'templates'),\n+        os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n     ),\n     LANGUAGE_CODE='en',\n     LANGUAGES=("
        },
        {
            "sha": "dcc288e600c950ad427487b66d7c8172b60c10ba",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -18,6 +18,7 @@\n     number_format)\n from django.utils.importlib import import_module\n from django.utils.numberformat import format as nformat\n+from django.utils._os import upath\n from django.utils.safestring import mark_safe, SafeBytes, SafeString, SafeText\n from django.utils import six\n from django.utils.six import PY3\n@@ -44,7 +45,7 @@\n     URLPrefixTests, URLResponseTests, URLRedirectTests, PathUnusedTests)\n \n \n-here = os.path.dirname(os.path.abspath(__file__))\n+here = os.path.dirname(os.path.abspath(upath(__file__)))\n extended_locale_paths = settings.LOCALE_PATHS + (\n     os.path.join(here, 'other', 'locale'),\n )\n@@ -666,8 +667,8 @@ def test_get_format_modules_stability(self):\n         with self.settings(USE_L10N=True,\n                 FORMAT_MODULE_PATH='regressiontests.i18n.other.locale'):\n             with translation.override('de', deactivate=True):\n-                old = \"%r\" % get_format_modules(reverse=True)\n-                new = \"%r\" % get_format_modules(reverse=True) # second try\n+                old = str(\"%r\") % get_format_modules(reverse=True)\n+                new = str(\"%r\") % get_format_modules(reverse=True) # second try\n                 self.assertEqual(new, old, 'Value returned by get_formats_modules() must be preserved between calls.')\n \n     def test_localize_templatetag_and_filter(self):"
        },
        {
            "sha": "07804eb39812b10219f9880da6fd6a07e8bed7f4",
            "filename": "tests/regressiontests/logging_tests/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flogging_tests%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -9,6 +9,7 @@\n from django.core import mail\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n+from django.utils.encoding import force_text\n from django.utils.log import CallbackFilter, RequireDebugFalse\n from django.utils.six import StringIO\n from django.utils.unittest import skipUnless\n@@ -154,13 +155,13 @@ def test_warnings_capture(self):\n         output = StringIO()\n         self.logger.handlers[0].stream = output\n         warnings.warn('Foo Deprecated', DeprecationWarning)\n-        self.assertTrue('Foo Deprecated' in output.getvalue())\n+        self.assertTrue('Foo Deprecated' in force_text(output.getvalue()))\n \n     def test_warnings_capture_debug_false(self):\n         output = StringIO()\n         self.logger.handlers[0].stream = output\n         warnings.warn('Foo Deprecated', DeprecationWarning)\n-        self.assertFalse('Foo Deprecated' in output.getvalue())\n+        self.assertFalse('Foo Deprecated' in force_text(output.getvalue()))\n \n \n class CallbackFilterTest(TestCase):"
        },
        {
            "sha": "df0215db3d747c1b1cca9ae8d28b2f0df37dca40",
            "filename": "tests/regressiontests/model_fields/imagefield.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fmodel_fields%2Fimagefield.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fmodel_fields%2Fimagefield.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_fields%2Fimagefield.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -6,6 +6,7 @@\n from django.core.files import File\n from django.core.files.images import ImageFile\n from django.test import TestCase\n+from django.utils._os import upath\n from django.utils.unittest import skipIf\n \n from .models import Image\n@@ -43,10 +44,10 @@ def setUp(self):\n             shutil.rmtree(temp_storage_dir)\n         os.mkdir(temp_storage_dir)\n \n-        file_path1 = os.path.join(os.path.dirname(__file__), \"4x8.png\")\n+        file_path1 = os.path.join(os.path.dirname(upath(__file__)), \"4x8.png\")\n         self.file1 = self.File(open(file_path1, 'rb'))\n \n-        file_path2 = os.path.join(os.path.dirname(__file__), \"8x4.png\")\n+        file_path2 = os.path.join(os.path.dirname(upath(__file__)), \"8x4.png\")\n         self.file2 = self.File(open(file_path2, 'rb'))\n \n     def tearDown(self):"
        },
        {
            "sha": "2c2fd391587bfb65736098c4509770cb457f851d",
            "filename": "tests/regressiontests/model_forms_regress/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fmodel_forms_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fmodel_forms_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_forms_regress%2Fmodels.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -5,6 +5,7 @@\n from django.core.exceptions import ValidationError\n from django.db import models\n from django.utils.encoding import python_2_unicode_compatible\n+from django.utils._os import upath\n \n \n class Person(models.Model):\n@@ -19,7 +20,7 @@ class Meta:\n         unique_together = (('left', 'middle'), ('middle', 'right'))\n \n class FilePathModel(models.Model):\n-    path = models.FilePathField(path=os.path.dirname(__file__), match=\".*\\.py$\", blank=True)\n+    path = models.FilePathField(path=os.path.dirname(upath(__file__)), match=\".*\\.py$\", blank=True)\n \n @python_2_unicode_compatible\n class Publication(models.Model):"
        },
        {
            "sha": "1a7552ed11cde136e22e2daeb9474d48547202cc",
            "filename": "tests/regressiontests/servers/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fservers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fservers%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -15,11 +15,12 @@\n from django.core.servers.basehttp import WSGIServerException\n from django.test.utils import override_settings\n from django.utils.http import urlencode\n+from django.utils._os import upath\n \n from .models import Person\n \n \n-TEST_ROOT = os.path.dirname(__file__)\n+TEST_ROOT = os.path.dirname(upath(__file__))\n TEST_SETTINGS = {\n     'MEDIA_URL': '/media/',\n     'MEDIA_ROOT': os.path.join(TEST_ROOT, 'media'),"
        },
        {
            "sha": "90c8621d0b58b5367f08826691c364d61fe90f10",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -15,14 +15,14 @@\n from django.core.management import call_command\n from django.test import TestCase\n from django.test.utils import override_settings\n-from django.utils.encoding import smart_text\n+from django.utils.encoding import force_text\n from django.utils.functional import empty\n-from django.utils._os import rmtree_errorhandler\n+from django.utils._os import rmtree_errorhandler, upath\n from django.utils import six\n \n from django.contrib.staticfiles import finders, storage\n \n-TEST_ROOT = os.path.dirname(__file__)\n+TEST_ROOT = os.path.dirname(upath(__file__))\n TEST_SETTINGS = {\n     'DEBUG': True,\n     'MEDIA_URL': '/media/',\n@@ -77,7 +77,7 @@ def tearDown(self):\n         os.unlink(self._backup_filepath)\n \n     def assertFileContains(self, filepath, text):\n-        self.assertIn(text, self._get_file(smart_text(filepath)),\n+        self.assertIn(text, self._get_file(force_text(filepath)),\n                         \"'%s' not in '%s'\" % (text, filepath))\n \n     def assertFileNotFound(self, filepath):\n@@ -195,7 +195,7 @@ def _get_file(self, filepath):\n         call_command('findstatic', filepath, all=False, verbosity=0, stdout=out)\n         out.seek(0)\n         lines = [l.strip() for l in out.readlines()]\n-        with codecs.open(smart_text(lines[1].strip()), \"r\", \"utf-8\") as f:\n+        with codecs.open(force_text(lines[1].strip()), \"r\", \"utf-8\") as f:\n             return f.read()\n \n     def test_all_files(self):\n@@ -207,8 +207,8 @@ def test_all_files(self):\n         out.seek(0)\n         lines = [l.strip() for l in out.readlines()]\n         self.assertEqual(len(lines), 3)  # three because there is also the \"Found <file> here\" line\n-        self.assertIn('project', lines[1])\n-        self.assertIn('apps', lines[2])\n+        self.assertIn('project', force_text(lines[1]))\n+        self.assertIn('apps', force_text(lines[2]))\n \n \n class TestCollection(CollectionTestCase, TestDefaults):"
        },
        {
            "sha": "b77965203fa754d9a4720cffa8d2f70aaa26f6ad",
            "filename": "tests/regressiontests/templates/loaders.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftemplates%2Floaders.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftemplates%2Floaders.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Floaders.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -18,6 +18,7 @@\n from django.template.loaders.eggs import Loader as EggLoader\n from django.template import loader\n from django.utils import unittest, six\n+from django.utils._os import upath\n from django.utils.six import StringIO\n \n \n@@ -111,9 +112,9 @@ def tearDown(self):\n     def test_templatedir_caching(self):\n         \"Check that the template directories form part of the template cache key. Refs #13573\"\n         # Retrive a template specifying a template directory to check\n-        t1, name = loader.find_template('test.html', (os.path.join(os.path.dirname(__file__), 'templates', 'first'),))\n+        t1, name = loader.find_template('test.html', (os.path.join(os.path.dirname(upath(__file__)), 'templates', 'first'),))\n         # Now retrieve the same template name, but from a different directory\n-        t2, name = loader.find_template('test.html', (os.path.join(os.path.dirname(__file__), 'templates', 'second'),))\n+        t2, name = loader.find_template('test.html', (os.path.join(os.path.dirname(upath(__file__)), 'templates', 'second'),))\n \n         # The two templates should not have the same content\n         self.assertNotEqual(t1.render(Context({})), t2.render(Context({})))\n@@ -123,7 +124,7 @@ class RenderToStringTest(unittest.TestCase):\n     def setUp(self):\n         self._old_TEMPLATE_DIRS = settings.TEMPLATE_DIRS\n         settings.TEMPLATE_DIRS = (\n-            os.path.join(os.path.dirname(__file__), 'templates'),\n+            os.path.join(os.path.dirname(upath(__file__)), 'templates'),\n         )\n \n     def tearDown(self):"
        },
        {
            "sha": "c4da50af6b32c624f99d44db29f46546d4047bc5",
            "filename": "tests/regressiontests/templates/response.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftemplates%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftemplates%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Fresponse.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -11,6 +11,7 @@\n from django.template.response import (TemplateResponse, SimpleTemplateResponse,\n                                       ContentNotRenderedError)\n from django.test.utils import override_settings\n+from django.utils._os import upath\n \n def test_processor(request):\n     return {'processors': 'yes'}\n@@ -206,7 +207,7 @@ def test_pickling_cookie(self):\n \n @override_settings(\n     TEMPLATE_CONTEXT_PROCESSORS=[test_processor_name],\n-    TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__),'templates')),\n+    TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'templates')),\n )\n class TemplateResponseTest(TestCase):\n "
        },
        {
            "sha": "9ec487d06c2945dc115b15af070f857f1d2e03c2",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -30,6 +30,7 @@\n from django.utils import unittest\n from django.utils.encoding import python_2_unicode_compatible\n from django.utils.formats import date_format\n+from django.utils._os import upath\n from django.utils.translation import activate, deactivate, ugettext as _\n from django.utils.safestring import mark_safe\n from django.utils import six\n@@ -423,7 +424,7 @@ def test_templates(self):\n         # Set ALLOWED_INCLUDE_ROOTS so that ssi works.\n         old_allowed_include_roots = settings.ALLOWED_INCLUDE_ROOTS\n         settings.ALLOWED_INCLUDE_ROOTS = (\n-            os.path.dirname(os.path.abspath(__file__)),\n+            os.path.dirname(os.path.abspath(upath(__file__))),\n         )\n \n         # Warm the URL reversing cache. This ensures we don't pay the cost\n@@ -514,7 +515,7 @@ def render(self, test_template, vals):\n     def get_template_tests(self):\n         # SYNTAX --\n         # 'template_name': ('template contents', 'context dict', 'expected string output' or Exception class)\n-        basedir = os.path.dirname(os.path.abspath(__file__))\n+        basedir = os.path.dirname(os.path.abspath(upath(__file__)))\n         tests = {\n             ### BASIC SYNTAX ################################################\n \n@@ -1649,7 +1650,7 @@ class TemplateTagLoading(unittest.TestCase):\n     def setUp(self):\n         self.old_path = sys.path[:]\n         self.old_apps = settings.INSTALLED_APPS\n-        self.egg_dir = '%s/eggs' % os.path.dirname(__file__)\n+        self.egg_dir = '%s/eggs' % os.path.dirname(upath(__file__))\n         self.old_tag_modules = template_base.templatetags_modules\n         template_base.templatetags_modules = []\n "
        },
        {
            "sha": "5ba5d3c4b3f385e0b28828f7f319fa4449af7f65",
            "filename": "tests/regressiontests/test_client_regress/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -16,12 +16,13 @@\n from django.test.client import encode_file, RequestFactory\n from django.test.utils import ContextList, override_settings, str_prefix\n from django.template.response import SimpleTemplateResponse\n+from django.utils._os import upath\n from django.utils.translation import ugettext_lazy\n from django.http import HttpResponse\n \n \n @override_settings(\n-    TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n+    TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'templates'),)\n )\n class AssertContainsTests(TestCase):\n     def test_contains(self):\n@@ -629,7 +630,7 @@ def setUp(self):\n                     template_loader.reset()\n \n     @override_settings(\n-        TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'bad_templates'),)\n+        TEMPLATE_DIRS=(os.path.join(os.path.dirname(upath(__file__)), 'bad_templates'),)\n     )\n     def test_bad_404_template(self):\n         \"Errors found when rendering 404 error templates are re-raised\""
        },
        {
            "sha": "eb3afe8201e69eb41079c22453b5b4a6a41a1436",
            "filename": "tests/regressiontests/urlpatterns_reverse/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -237,7 +237,7 @@ def test_404_tried_urls_have_names(self):\n             self.assertEqual(len(e.args[0]['tried']), len(url_types_names), 'Wrong number of tried URLs returned.  Expected %s, got %s.' % (len(url_types_names), len(e.args[0]['tried'])))\n             for tried, expected in zip(e.args[0]['tried'], url_types_names):\n                 for t, e in zip(tried, expected):\n-                    self.assertTrue(isinstance(t, e['type']), '%s is not an instance of %s' % (t, e['type']))\n+                    self.assertTrue(isinstance(t, e['type']), str('%s is not an instance of %s') % (t, e['type']))\n                     if 'name' in e:\n                         if not e['name']:\n                             self.assertTrue(t.name is None, 'Expected no URL name but found %s.' % t.name)"
        },
        {
            "sha": "8861b4a577f9e973246d953a7780fd19013de44d",
            "filename": "tests/regressiontests/utils/archive.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Futils%2Farchive.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Futils%2Farchive.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Farchive.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -4,9 +4,10 @@\n from django.utils import unittest\n \n from django.utils.archive import Archive, extract\n+from django.utils._os import upath\n \n \n-TEST_DIR = os.path.join(os.path.dirname(__file__), 'archives')\n+TEST_DIR = os.path.join(os.path.dirname(upath(__file__)), 'archives')\n \n \n class ArchiveTester(object):"
        },
        {
            "sha": "3fc92b0862c076fe2adb6f146916226f3966cbe1",
            "filename": "tests/regressiontests/utils/module_loading.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Futils%2Fmodule_loading.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Futils%2Fmodule_loading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fmodule_loading.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -6,6 +6,7 @@\n from django.utils import unittest\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n+from django.utils._os import upath\n \n \n class DefaultLoader(unittest.TestCase):\n@@ -50,7 +51,7 @@ def test_loader(self):\n class EggLoader(unittest.TestCase):\n     def setUp(self):\n         self.old_path = sys.path[:]\n-        self.egg_dir = '%s/eggs' % os.path.dirname(__file__)\n+        self.egg_dir = '%s/eggs' % os.path.dirname(upath(__file__))\n \n     def tearDown(self):\n         sys.path = self.old_path"
        },
        {
            "sha": "4fdaad5010d2f311d2a4b9ab1d2a4e4bc82dacbb",
            "filename": "tests/regressiontests/views/tests/debug.py",
            "status": "modified",
            "additions": 25,
            "deletions": 21,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -14,6 +14,7 @@\n from django.test import TestCase, RequestFactory\n from django.test.utils import (override_settings, setup_test_template_loader,\n     restore_template_loaders)\n+from django.utils.encoding import force_text\n from django.views.debug import ExceptionReporter\n \n from .. import BrokenException, except_args\n@@ -306,15 +307,16 @@ def verify_unsafe_email(self, view, check_for_POST_params=True):\n             self.assertEqual(len(mail.outbox), 1)\n             email = mail.outbox[0]\n             # Frames vars are never shown in plain text email reports.\n-            self.assertNotIn('cooked_eggs', email.body)\n-            self.assertNotIn('scrambled', email.body)\n-            self.assertNotIn('sauce', email.body)\n-            self.assertNotIn('worcestershire', email.body)\n+            body = force_text(email.body)\n+            self.assertNotIn('cooked_eggs', body)\n+            self.assertNotIn('scrambled', body)\n+            self.assertNotIn('sauce', body)\n+            self.assertNotIn('worcestershire', body)\n             if check_for_POST_params:\n                 for k, v in self.breakfast_data.items():\n                     # All POST parameters are shown.\n-                    self.assertIn(k, email.body)\n-                    self.assertIn(v, email.body)\n+                    self.assertIn(k, body)\n+                    self.assertIn(v, body)\n \n     def verify_safe_email(self, view, check_for_POST_params=True):\n         \"\"\"\n@@ -327,20 +329,21 @@ def verify_safe_email(self, view, check_for_POST_params=True):\n             self.assertEqual(len(mail.outbox), 1)\n             email = mail.outbox[0]\n             # Frames vars are never shown in plain text email reports.\n-            self.assertNotIn('cooked_eggs', email.body)\n-            self.assertNotIn('scrambled', email.body)\n-            self.assertNotIn('sauce', email.body)\n-            self.assertNotIn('worcestershire', email.body)\n+            body = force_text(email.body)\n+            self.assertNotIn('cooked_eggs', body)\n+            self.assertNotIn('scrambled', body)\n+            self.assertNotIn('sauce', body)\n+            self.assertNotIn('worcestershire', body)\n             if check_for_POST_params:\n                 for k, v in self.breakfast_data.items():\n                     # All POST parameters' names are shown.\n-                    self.assertIn(k, email.body)\n+                    self.assertIn(k, body)\n                 # Non-sensitive POST parameters' values are shown.\n-                self.assertIn('baked-beans-value', email.body)\n-                self.assertIn('hash-brown-value', email.body)\n+                self.assertIn('baked-beans-value', body)\n+                self.assertIn('hash-brown-value', body)\n                 # Sensitive POST parameters' values are not shown.\n-                self.assertNotIn('sausage-value', email.body)\n-                self.assertNotIn('bacon-value', email.body)\n+                self.assertNotIn('sausage-value', body)\n+                self.assertNotIn('bacon-value', body)\n \n     def verify_paranoid_email(self, view):\n         \"\"\"\n@@ -353,15 +356,16 @@ def verify_paranoid_email(self, view):\n             self.assertEqual(len(mail.outbox), 1)\n             email = mail.outbox[0]\n             # Frames vars are never shown in plain text email reports.\n-            self.assertNotIn('cooked_eggs', email.body)\n-            self.assertNotIn('scrambled', email.body)\n-            self.assertNotIn('sauce', email.body)\n-            self.assertNotIn('worcestershire', email.body)\n+            body = force_text(email.body)\n+            self.assertNotIn('cooked_eggs', body)\n+            self.assertNotIn('scrambled', body)\n+            self.assertNotIn('sauce', body)\n+            self.assertNotIn('worcestershire', body)\n             for k, v in self.breakfast_data.items():\n                 # All POST parameters' names are shown.\n-                self.assertIn(k, email.body)\n+                self.assertIn(k, body)\n                 # No POST parameters' values are shown.\n-                self.assertNotIn(v, email.body)\n+                self.assertNotIn(v, body)\n \n \n class ExceptionReporterFilterTests(TestCase, ExceptionReportTestMixin):"
        },
        {
            "sha": "f1f5b175c8ac10d42be397ca8cadc2f7b7d48c73",
            "filename": "tests/regressiontests/views/tests/i18n.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -9,6 +9,7 @@\n from django.test import LiveServerTestCase, TestCase\n from django.test.utils import override_settings\n from django.utils import six, unittest\n+from django.utils._os import upath\n from django.utils.translation import override\n from django.utils.text import javascript_quote\n \n@@ -152,7 +153,7 @@ def testI18NDifferentNonEnLangs(self):\n     def testI18NWithLocalePaths(self):\n         extended_locale_paths = settings.LOCALE_PATHS + (\n             path.join(path.dirname(\n-                path.dirname(path.abspath(__file__))), 'app3', 'locale'),)\n+                path.dirname(path.abspath(upath(__file__)))), 'app3', 'locale'),)\n         with self.settings(LANGUAGE_CODE='es-ar', LOCALE_PATHS=extended_locale_paths):\n             with override('es-ar'):\n                 response = self.client.get('/views/jsi18n/')"
        },
        {
            "sha": "2c06557ae95db112818604c30b4c018dad7b2232",
            "filename": "tests/regressiontests/views/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fviews%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fregressiontests%2Fviews%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Furls.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -4,11 +4,12 @@\n from os import path\n \n from django.conf.urls import patterns, url, include\n+from django.utils._os import upath\n \n from . import views\n \n \n-base_dir = path.dirname(path.abspath(__file__))\n+base_dir = path.dirname(path.abspath(upath(__file__)))\n media_dir = path.join(base_dir, 'media')\n locale_dir = path.join(base_dir, 'locale')\n "
        },
        {
            "sha": "8c56e273b5728112a7afb2990b8e81ce0dc744b7",
            "filename": "tests/runtests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fruntests.py",
            "raw_url": "https://github.com/django/django/raw/c91667338a4e774e2819ccf4da852dc7b759bc19/tests%2Fruntests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fruntests.py?ref=c91667338a4e774e2819ccf4da852dc7b759bc19",
            "patch": "@@ -7,6 +7,7 @@\n import warnings\n \n from django import contrib\n+from django.utils._os import upath\n from django.utils import six\n \n # databrowse is deprecated, but we still want to run its tests\n@@ -19,8 +20,8 @@\n \n TEST_TEMPLATE_DIR = 'templates'\n \n-RUNTESTS_DIR = os.path.dirname(__file__)\n-CONTRIB_DIR = os.path.dirname(contrib.__file__)\n+RUNTESTS_DIR = os.path.dirname(upath(__file__))\n+CONTRIB_DIR = os.path.dirname(upath(contrib.__file__))\n MODEL_TEST_DIR = os.path.join(RUNTESTS_DIR, MODEL_TESTS_DIR_NAME)\n REGRESSION_TEST_DIR = os.path.join(RUNTESTS_DIR, REGRESSION_TESTS_DIR_NAME)\n TEMP_DIR = tempfile.mkdtemp(prefix='django_')\n@@ -192,7 +193,7 @@ def bisect_tests(bisection_label, options, test_labels):\n             pass\n \n     subprocess_args = [\n-        sys.executable, __file__, '--settings=%s' % options.settings]\n+        sys.executable, upath(__file__), '--settings=%s' % options.settings]\n     if options.failfast:\n         subprocess_args.append('--failfast')\n     if options.verbosity:\n@@ -253,7 +254,7 @@ def paired_tests(paired_test, options, test_labels):\n             pass\n \n     subprocess_args = [\n-        sys.executable, __file__, '--settings=%s' % options.settings]\n+        sys.executable, upath(__file__), '--settings=%s' % options.settings]\n     if options.failfast:\n         subprocess_args.append('--failfast')\n     if options.verbosity:"
        }
    ],
    "stats": {
        "total": 375,
        "additions": 228,
        "deletions": 147
    }
}