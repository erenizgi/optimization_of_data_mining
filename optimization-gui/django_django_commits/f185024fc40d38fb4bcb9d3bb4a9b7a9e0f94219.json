{
    "author": "ramiro",
    "message": "Made sure the new project template functionality works when the template\npath specified has a trailing path separator.\n\nThanks Alex for the report.\n\nFixes #17475.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17287 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219",
    "files": [
        {
            "sha": "307841522ecff886e49907087395fc82fbdba11b",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 12,
            "deletions": 11,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219",
            "patch": "@@ -160,7 +160,7 @@ def handle(self, app_or_project, name, target=None, **options):\n             if self.verbosity >= 2:\n                 self.stdout.write(\"Cleaning up temporary files.\\n\")\n             for path_to_remove in self.paths_to_remove:\n-                if os.path.isfile(path_to_remove):\n+                if path.isfile(path_to_remove):\n                     os.remove(path_to_remove)\n                 else:\n                     shutil.rmtree(path_to_remove,\n@@ -178,14 +178,15 @@ def handle_template(self, template, subdir):\n             if template.startswith('file://'):\n                 template = template[7:]\n             expanded_template = path.expanduser(template)\n-            if os.path.isdir(expanded_template):\n+            expanded_template = path.normpath(expanded_template)\n+            if path.isdir(expanded_template):\n                 return expanded_template\n             if self.is_url(template):\n                 # downloads the file and returns the path\n                 absolute_path = self.download(template)\n             else:\n                 absolute_path = path.abspath(expanded_template)\n-            if os.path.exists(absolute_path):\n+            if path.exists(absolute_path):\n                 return self.extract(absolute_path)\n \n         raise CommandError(\"couldn't handle %s template %s.\" %\n@@ -203,13 +204,13 @@ def download(self, url):\n         if self.verbosity >= 2:\n             self.stdout.write(\"Downloading %s\\n\" % url)\n         try:\n-            path, info = urllib.urlretrieve(url,\n-                                            os.path.join(tempdir, filename))\n+            the_path, info = urllib.urlretrieve(url,\n+                                                path.join(tempdir, filename))\n         except IOError, e:\n             raise CommandError(\"couldn't download URL %s to %s: %s\" %\n                                (url, filename, e))\n \n-        used_name = path.split('/')[-1]\n+        used_name = the_path.split('/')[-1]\n \n         # Trying to get better name from response headers\n         content_disposition = info.get('content-disposition')\n@@ -230,18 +231,18 @@ def download(self, url):\n         # Move the temporary file to a filename that has better\n         # chances of being recognnized by the archive utils\n         if used_name != guessed_filename:\n-            guessed_path = os.path.join(tempdir, guessed_filename)\n-            shutil.move(path, guessed_path)\n+            guessed_path = path.join(tempdir, guessed_filename)\n+            shutil.move(the_path, guessed_path)\n             return guessed_path\n \n         # Giving up\n-        return path\n+        return the_path\n \n-    def splitext(self, path):\n+    def splitext(self, the_path):\n         \"\"\"\n         Like os.path.splitext, but takes off .tar, too\n         \"\"\"\n-        base, ext = posixpath.splitext(path)\n+        base, ext = posixpath.splitext(the_path)\n         if base.lower().endswith('.tar'):\n             ext = base[-4:] + ext\n             base = base[:-4]"
        },
        {
            "sha": "d33cfee83b84d874a1122d9c74b9d4172c242854",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219",
            "patch": "@@ -1414,6 +1414,18 @@ def test_custom_project_template(self):\n         self.assertTrue(os.path.isdir(testproject_dir))\n         self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'additional_dir')))\n \n+    def test_template_dir_with_trailing_slash(self):\n+        \"Ticket 17475: Template dir passed has a trailing path separator\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template' + os.sep)\n+        args = ['startproject', '--template', template_path, 'customtestproject']\n+        testproject_dir = os.path.join(test_dir, 'customtestproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'additional_dir')))\n+\n     def test_custom_project_template_from_tarball_by_path(self):\n         \"Make sure the startproject management command is able to use a different project template from a tarball\"\n         template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template.tgz')"
        },
        {
            "sha": "4f37ab5f52b7b91f1852e9cc64d1306a3fbb0f3e",
            "filename": "tests/urls.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219/tests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219/tests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Furls.py?ref=f185024fc40d38fb4bcb9d3bb4a9b7a9e0f94219",
            "patch": "@@ -27,7 +27,7 @@\n     # admin custom URL tests\n     (r'^custom_urls/', include('regressiontests.admin_custom_urls.urls')),\n \n-    # admin custom URL tests\n+    # admin scripts tests\n     (r'^admin_scripts/', include('regressiontests.admin_scripts.urls')),\n \n )"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 25,
        "deletions": 12
    }
}