{
    "author": "carljm",
    "message": "Fixed #17503 -- A destination directory passed to startproject or startapp as optional second argument is now reused as the project/app directory, rather than a new project/app directory created within it. Refs #17042.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17340 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "bc63ba700a0ae3ba435c267789d8c2e3931016df",
    "files": [
        {
            "sha": "f768cc6999f28e65be9b5bbca2fc1bc218a5bc48",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/bc63ba700a0ae3ba435c267789d8c2e3931016df/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/bc63ba700a0ae3ba435c267789d8c2e3931016df/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=bc63ba700a0ae3ba435c267789d8c2e3931016df",
            "patch": "@@ -73,15 +73,14 @@ def handle(self, app_or_project, name, target=None, **options):\n \n         # if some directory is given, make sure it's nicely expanded\n         if target is None:\n-            target = os.getcwd()\n+            top_dir = path.join(os.getcwd(), name)\n+            try:\n+                os.makedirs(top_dir)\n+            except OSError, e:\n+                raise CommandError(e)\n         else:\n-            target = path.expanduser(target)\n+            top_dir = path.expanduser(target)\n \n-        top_dir = path.join(target, name)\n-        try:\n-            os.makedirs(top_dir)\n-        except OSError, e:\n-            raise CommandError(e)\n \n         extensions = tuple(\n             handle_extensions(options.get('extensions'), ignored=()))"
        },
        {
            "sha": "4bde86ce4ade6540deab835537ebcd21efedd485",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/bc63ba700a0ae3ba435c267789d8c2e3931016df/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/bc63ba700a0ae3ba435c267789d8c2e3931016df/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=bc63ba700a0ae3ba435c267789d8c2e3931016df",
            "patch": "@@ -922,13 +922,13 @@ template files. (See the `source`_ for more details.) If only the app\n name is given, the app directory will be created in the current working\n directory.\n \n-If the optional destination is provided, Django will create the new project\n-directory in that directory. You can use '.' to denote the current working\n-directory.\n+If the optional destination is provided, Django will use that existing\n+directory rather than creating a new one. You can use '.' to denote the current\n+working directory.\n \n For example::\n \n-    django-admin.py startapp myapp /Users/jezdez/Code\n+    django-admin.py startapp myapp /Users/jezdez/Code/myapp\n \n .. versionadded:: 1.4\n .. django-admin-option:: --template\n@@ -984,20 +984,20 @@ the current directory or the given destination.\n .. versionchanged:: 1.4\n \n By default, the new directory contains ``manage.py`` and a project package\n-(containing ``settings.py`` file and other project template files).\n-See the `template source`_ for details.\n+(containing a ``settings.py`` and other files).  See the `template source`_ for\n+details.\n \n If only the project name is given, both the project directory and project\n package will be named ``<projectname>`` and the project directory\n will be created in the current working directory.\n \n-If the optional destination is provided, Django will create the new project\n-directory in that directory. You can use '.' to denote the current working\n-directory.\n+If the optional destination is provided, Django will use that existing\n+directory as the project directory, and create ``manage.py`` and the project\n+package within it. You can use '.' to denote the current working directory.\n \n For example::\n \n-    django-admin.py startproject myproject /Users/jezdez/Code\n+    django-admin.py startproject myproject /Users/jezdez/Code/myproject_repo\n \n .. versionadded:: 1.4\n "
        },
        {
            "sha": "948eb3a659285f40b1447e6bca211a1f3cb4b37a",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/bc63ba700a0ae3ba435c267789d8c2e3931016df/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/bc63ba700a0ae3ba435c267789d8c2e3931016df/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=bc63ba700a0ae3ba435c267789d8c2e3931016df",
            "patch": "@@ -1404,17 +1404,17 @@ def test_simple_project_different_directory(self):\n         \"Make sure the startproject management command creates a project in a specific directory\"\n         args = ['startproject', 'testproject', 'othertestproject']\n         testproject_dir = os.path.join(test_dir, 'othertestproject')\n+        os.mkdir(testproject_dir)\n \n         out, err = self.run_django_admin(args)\n         self.addCleanup(shutil.rmtree, testproject_dir)\n         self.assertNoOutput(err)\n-        self.assertTrue(os.path.isdir(os.path.join(testproject_dir, 'testproject')))\n-        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'testproject', 'manage.py')))\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'manage.py')))\n \n         # running again..\n         out, err = self.run_django_admin(args)\n         self.assertNoOutput(out)\n-        self.assertOutput(err, \"File exists\")\n+        self.assertOutput(err, \"already exists\")\n \n     def test_custom_project_template(self):\n         \"Make sure the startproject management command is able to use a different project template\"\n@@ -1452,6 +1452,19 @@ def test_custom_project_template_from_tarball_by_path(self):\n         self.assertTrue(os.path.isdir(testproject_dir))\n         self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'run.py')))\n \n+    def test_custom_project_template_from_tarball_to_alternative_location(self):\n+        \"Startproject can use a project template from a tarball and create it in a specified location\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template.tgz')\n+        args = ['startproject', '--template', template_path, 'tarballtestproject', 'altlocation']\n+        testproject_dir = os.path.join(test_dir, 'altlocation')\n+        os.mkdir(testproject_dir)\n+\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        self.assertTrue(os.path.isdir(testproject_dir))\n+        self.assertTrue(os.path.exists(os.path.join(testproject_dir, 'run.py')))\n+\n     def test_custom_project_template_from_tarball_by_url(self):\n         \"Make sure the startproject management command is able to use a different project template from a tarball via a url\"\n         template_url = '%s/admin_scripts/custom_templates/project_template.tgz' % self.live_server_url"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 32,
        "deletions": 20
    }
}