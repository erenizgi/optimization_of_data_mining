{
    "author": "aaugustin",
    "message": "Fixed #17856 -- Passed obj to get_inline_instances\n\nThanks ybon, quinode and sjaensch for the patch, and Tim Graham\nfor the review.",
    "sha": "c2e19e26bc33d34eff57079bd1a6838ff64d9e81",
    "files": [
        {
            "sha": "19c212db9ab7045f27f974742ad52df58c343ea2",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/c2e19e26bc33d34eff57079bd1a6838ff64d9e81/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/c2e19e26bc33d34eff57079bd1a6838ff64d9e81/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=c2e19e26bc33d34eff57079bd1a6838ff64d9e81",
            "patch": "@@ -346,14 +346,14 @@ def __init__(self, model, admin_site):\n         self.admin_site = admin_site\n         super(ModelAdmin, self).__init__()\n \n-    def get_inline_instances(self, request):\n+    def get_inline_instances(self, request, obj=None):\n         inline_instances = []\n         for inline_class in self.inlines:\n             inline = inline_class(self.model, self.admin_site)\n             if request:\n                 if not (inline.has_add_permission(request) or\n-                        inline.has_change_permission(request) or\n-                        inline.has_delete_permission(request)):\n+                        inline.has_change_permission(request, obj) or\n+                        inline.has_delete_permission(request, obj)):\n                     continue\n                 if not inline.has_add_permission(request):\n                     inline.max_num = 0\n@@ -506,7 +506,7 @@ def get_changelist_formset(self, request, **kwargs):\n             fields=self.list_editable, **defaults)\n \n     def get_formsets(self, request, obj=None):\n-        for inline in self.get_inline_instances(request):\n+        for inline in self.get_inline_instances(request, obj):\n             yield inline.get_formset(request, obj)\n \n     def get_paginator(self, request, queryset, per_page, orphans=0, allow_empty_first_page=True):\n@@ -994,7 +994,7 @@ def add_view(self, request, form_url='', extra_context=None):\n \n         ModelForm = self.get_form(request)\n         formsets = []\n-        inline_instances = self.get_inline_instances(request)\n+        inline_instances = self.get_inline_instances(request, None)\n         if request.method == 'POST':\n             form = ModelForm(request.POST, request.FILES)\n             if form.is_valid():\n@@ -1091,7 +1091,7 @@ def change_view(self, request, object_id, form_url='', extra_context=None):\n \n         ModelForm = self.get_form(request, obj)\n         formsets = []\n-        inline_instances = self.get_inline_instances(request)\n+        inline_instances = self.get_inline_instances(request, obj)\n         if request.method == 'POST':\n             form = ModelForm(request.POST, request.FILES, instance=obj)\n             if form.is_valid():"
        },
        {
            "sha": "72066ca799ec05414a3efdf1b7a624117fb62551",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/c2e19e26bc33d34eff57079bd1a6838ff64d9e81/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/c2e19e26bc33d34eff57079bd1a6838ff64d9e81/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=c2e19e26bc33d34eff57079bd1a6838ff64d9e81",
            "patch": "@@ -1046,6 +1046,16 @@ templates used by the :class:`ModelAdmin` views:\n     changelist that will be linked to the change view, as described in the\n     :attr:`ModelAdmin.list_display_links` section.\n \n+.. method:: ModelAdmin.get_inline_instances(self, request, obj=None)\n+\n+    .. versionadded:: 1.5\n+\n+    The ``get_inline_instances`` method is given the ``HttpRequest`` and the\n+    ``obj`` being edited (or ``None`` on an add form) and is expected to return\n+    a ``list`` or ``tuple`` of :class:`~django.contrib.admin.InlineModelAdmin`\n+    objects, as described below in the :class:`~django.contrib.admin.InlineModelAdmin`\n+    section.\n+\n .. method:: ModelAdmin.get_urls(self)\n \n     The ``get_urls`` method on a ``ModelAdmin`` returns the URLs to be used for"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 16,
        "deletions": 6
    }
}