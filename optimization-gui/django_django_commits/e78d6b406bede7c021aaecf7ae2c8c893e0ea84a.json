{
    "author": "aaugustin",
    "message": "Reverted parts of r16963 to fix a regression on the creation of permissions on proxy models. Refs #17904. Thanks koenb for the report and claudep for the patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17776 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e78d6b406bede7c021aaecf7ae2c8c893e0ea84a",
    "files": [
        {
            "sha": "b516507277a0209bae83f302c7675802521c13b8",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e78d6b406bede7c021aaecf7ae2c8c893e0ea84a/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/e78d6b406bede7c021aaecf7ae2c8c893e0ea84a/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=e78d6b406bede7c021aaecf7ae2c8c893e0ea84a",
            "patch": "@@ -31,8 +31,8 @@ def create_permissions(app, created_models, verbosity, **kwargs):\n     searched_perms = list()\n     # The codenames and ctypes that should exist.\n     ctypes = set()\n-    ctypes_for_models = ContentType.objects.get_for_models(*app_models)\n-    for klass, ctype in ctypes_for_models.iteritems():\n+    for klass in app_models:\n+        ctype = ContentType.objects.get_for_model(klass)\n         ctypes.add(ctype)\n         for perm in _get_all_permissions(klass._meta):\n             searched_perms.append((ctype, perm))"
        },
        {
            "sha": "49fd87deff0656f23397ffbec5a2d4b6c18d8e25",
            "filename": "tests/modeltests/proxy_models/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/e78d6b406bede7c021aaecf7ae2c8c893e0ea84a/tests%2Fmodeltests%2Fproxy_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/e78d6b406bede7c021aaecf7ae2c8c893e0ea84a/tests%2Fmodeltests%2Fproxy_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fproxy_models%2Fmodels.py?ref=e78d6b406bede7c021aaecf7ae2c8c893e0ea84a",
            "patch": "@@ -44,6 +44,9 @@ class MyPerson(Person):\n     class Meta:\n         proxy = True\n         ordering = [\"name\"]\n+        permissions = (\n+            (\"display_users\", \"May display users information\"),\n+        )\n \n     objects = SubManager()\n     other = PersonManager()\n@@ -158,4 +161,4 @@ class Improvement(Issue):\n \n class ProxyImprovement(Improvement):\n     class Meta:\n-        proxy = True\n\\ No newline at end of file\n+        proxy = True"
        },
        {
            "sha": "738e0dbce2913136b890ac3246ee90ffc50e07f5",
            "filename": "tests/modeltests/proxy_models/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/e78d6b406bede7c021aaecf7ae2c8c893e0ea84a/tests%2Fmodeltests%2Fproxy_models%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e78d6b406bede7c021aaecf7ae2c8c893e0ea84a/tests%2Fmodeltests%2Fproxy_models%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fproxy_models%2Ftests.py?ref=e78d6b406bede7c021aaecf7ae2c8c893e0ea84a",
            "patch": "@@ -167,6 +167,13 @@ def test_otherperson_manager(self):\n         resp = [p.name for p in OtherPerson._default_manager.all()]\n         self.assertEqual(resp, ['barney', 'wilma'])\n \n+    def test_permissions_created(self):\n+        from django.contrib.auth.models import Permission\n+        try:\n+            Permission.objects.get(name=\"May display users information\")\n+        except Permission.DoesNotExist:\n+            self.fail(\"The permission 'May display users information' has not been created\")\n+\n     def test_proxy_model_signals(self):\n         \"\"\"\n         Test save signals for proxy models"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
    }
}