{
    "author": "jezdez",
    "message": "Fixed #17857 -- Stopped CachedStaticFilesStorage from creating absolute URLs unnecessarily. Thanks, tgecho.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17697 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0ee801e3603218a3c3a8c0adbc94f69e40523ee2",
    "files": [
        {
            "sha": "c000f97d0548d7ef18172a41496d529d7d416edb",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/0ee801e3603218a3c3a8c0adbc94f69e40523ee2/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/0ee801e3603218a3c3a8c0adbc94f69e40523ee2/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=0ee801e3603218a3c3a8c0adbc94f69e40523ee2",
            "patch": "@@ -165,9 +165,11 @@ def converter(matchobj):\n                     start, end = 1, sub_level - 1\n             joined_result = '/'.join(name_parts[:-start] + url_parts[end:])\n             hashed_url = self.url(unquote(joined_result), force=True)\n+            file_name = hashed_url.split('/')[-1:]\n+            relative_url = '/'.join(url.split('/')[:-1] + file_name)\n \n-            # Return the hashed and normalized version to the file\n-            return 'url(\"%s\")' % unquote(hashed_url)\n+            # Return the hashed version to the file\n+            return 'url(\"%s\")' % unquote(relative_url)\n         return converter\n \n     def post_process(self, paths, dry_run=False, **options):"
        },
        {
            "sha": "1dbd00b2996364836196bc5f4dfbb0a7b7d2e4fc",
            "filename": "docs/ref/contrib/staticfiles.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0ee801e3603218a3c3a8c0adbc94f69e40523ee2/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "raw_url": "https://github.com/django/django/raw/0ee801e3603218a3c3a8c0adbc94f69e40523ee2/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fstaticfiles.txt?ref=0ee801e3603218a3c3a8c0adbc94f69e40523ee2",
            "patch": "@@ -327,7 +327,7 @@ CachedStaticFilesStorage\n \n     .. code-block:: css+django\n \n-        @import url(\"/static/admin/css/base.27e20196a850.css\");\n+        @import url(\"../admin/css/base.27e20196a850.css\");\n \n     To enable the ``CachedStaticFilesStorage`` you have to make sure the\n     following requirements are met:"
        },
        {
            "sha": "4d141ca8858b47ff62174640ffc7f3658f11fd59",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 11,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/0ee801e3603218a3c3a8c0adbc94f69e40523ee2/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0ee801e3603218a3c3a8c0adbc94f69e40523ee2/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=0ee801e3603218a3c3a8c0adbc94f69e40523ee2",
            "patch": "@@ -385,7 +385,7 @@ def test_template_tag_simple_content(self):\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n             self.assertNotIn(\"cached/other.css\", content)\n-            self.assertIn(\"/static/cached/other.d41d8cd98f00.css\", content)\n+            self.assertIn(\"other.d41d8cd98f00.css\", content)\n \n     def test_path_with_querystring(self):\n         relpath = self.cached_file_path(\"cached/styles.css?spam=eggs\")\n@@ -395,7 +395,7 @@ def test_path_with_querystring(self):\n                 \"cached/styles.93b1147e8552.css\") as relfile:\n             content = relfile.read()\n             self.assertNotIn(\"cached/other.css\", content)\n-            self.assertIn(\"/static/cached/other.d41d8cd98f00.css\", content)\n+            self.assertIn(\"other.d41d8cd98f00.css\", content)\n \n     def test_path_with_fragment(self):\n         relpath = self.cached_file_path(\"cached/styles.css#eggs\")\n@@ -404,15 +404,15 @@ def test_path_with_fragment(self):\n                 \"cached/styles.93b1147e8552.css\") as relfile:\n             content = relfile.read()\n             self.assertNotIn(\"cached/other.css\", content)\n-            self.assertIn(\"/static/cached/other.d41d8cd98f00.css\", content)\n+            self.assertIn(\"other.d41d8cd98f00.css\", content)\n \n     def test_path_with_querystring_and_fragment(self):\n         relpath = self.cached_file_path(\"cached/css/fragments.css\")\n         self.assertEqual(relpath, \"cached/css/fragments.75433540b096.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertIn('/static/cached/css/fonts/font.a4b0478549d0.eot?#iefix', content)\n-            self.assertIn('/static/cached/css/fonts/font.b8d603e42714.svg#webfontIyfZbseF', content)\n+            self.assertIn('fonts/font.a4b0478549d0.eot?#iefix', content)\n+            self.assertIn('fonts/font.b8d603e42714.svg#webfontIyfZbseF', content)\n             self.assertIn('data:font/woff;charset=utf-8;base64,d09GRgABAAAAADJoAA0AAAAAR2QAAQAAAAAAAAAAAAA', content)\n             self.assertIn('#default#VML', content)\n \n@@ -431,29 +431,28 @@ def test_template_tag_denorm(self):\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n             self.assertNotIn(\"..//cached///styles.css\", content)\n-            self.assertIn(\"/static/cached/styles.93b1147e8552.css\", content)\n+            self.assertIn(\"../cached/styles.93b1147e8552.css\", content)\n             self.assertNotIn(\"url(img/relative.png )\", content)\n-            self.assertIn(\"/static/cached/img/relative.acae32e4532b.png\", content)\n+            self.assertIn('url(\"img/relative.acae32e4532b.png', content)\n \n     def test_template_tag_relative(self):\n         relpath = self.cached_file_path(\"cached/relative.css\")\n         self.assertEqual(relpath, \"cached/relative.2217ea7273c2.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n-            self.assertIn(\"/static/cached/styles.93b1147e8552.css\", content)\n             self.assertNotIn(\"../cached/styles.css\", content)\n             self.assertNotIn('@import \"styles.css\"', content)\n             self.assertNotIn('url(img/relative.png)', content)\n-            self.assertIn('url(\"/static/cached/img/relative.acae32e4532b.png\")', content)\n-            self.assertIn(\"/static/cached/styles.93b1147e8552.css\", content)\n+            self.assertIn('url(\"img/relative.acae32e4532b.png\")', content)\n+            self.assertIn(\"../cached/styles.93b1147e8552.css\", content)\n \n     def test_template_tag_deep_relative(self):\n         relpath = self.cached_file_path(\"cached/css/window.css\")\n         self.assertEqual(relpath, \"cached/css/window.9db38d5169f3.css\")\n         with storage.staticfiles_storage.open(relpath) as relfile:\n             content = relfile.read()\n             self.assertNotIn('url(img/window.png)', content)\n-            self.assertIn('url(\"/static/cached/css/img/window.acae32e4532b.png\")', content)\n+            self.assertIn('url(\"img/window.acae32e4532b.png\")', content)\n \n     def test_template_tag_url(self):\n         relpath = self.cached_file_path(\"cached/url.css\")"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 15,
        "deletions": 14
    }
}