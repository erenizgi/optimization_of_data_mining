{
    "author": "alex",
    "message": "Removed deprecated legacy connection handling for `Field.get_db_*`.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15958 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e57cc90c164ca9e078882158d830c5d9f717e13b",
    "files": [
        {
            "sha": "628c8cd8830a26e8e7d656d9ffe7a404859eb13f",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e57cc90c164ca9e078882158d830c5d9f717e13b/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/e57cc90c164ca9e078882158d830c5d9f717e13b/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=e57cc90c164ca9e078882158d830c5d9f717e13b",
            "patch": "@@ -7,7 +7,6 @@\n from itertools import tee\n \n from django.db import connection\n-from django.db.models.fields.subclassing import LegacyConnection\n from django.db.models.query_utils import QueryWrapper\n from django.conf import settings\n from django import forms\n@@ -46,7 +45,6 @@ class FieldDoesNotExist(Exception):\n \n class Field(object):\n     \"\"\"Base class for all field types\"\"\"\n-    __metaclass__ = LegacyConnection\n \n     # Designates whether empty strings fundamentally are allowed at the\n     # database level."
        },
        {
            "sha": "d4d7d7522226a4c47d8823b7bb8dcb64c09a2965",
            "filename": "django/db/models/fields/subclassing.py",
            "status": "modified",
            "additions": 1,
            "deletions": 66,
            "changes": 67,
            "blob_url": "https://github.com/django/django/blob/e57cc90c164ca9e078882158d830c5d9f717e13b/django%2Fdb%2Fmodels%2Ffields%2Fsubclassing.py",
            "raw_url": "https://github.com/django/django/raw/e57cc90c164ca9e078882158d830c5d9f717e13b/django%2Fdb%2Fmodels%2Ffields%2Fsubclassing.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Fsubclassing.py?ref=e57cc90c164ca9e078882158d830c5d9f717e13b",
            "patch": "@@ -6,72 +6,7 @@\n to_python() and the other necessary methods and everything will work seamlessly.\n \"\"\"\n \n-from inspect import getargspec\n-from warnings import warn\n-\n-def call_with_connection(func):\n-    arg_names, varargs, varkwargs, defaults = getargspec(func)\n-    updated = ('connection' in arg_names or varkwargs)\n-    if not updated:\n-        warn(\"A Field class whose %s method hasn't been updated to take a \"\n-            \"`connection` argument.\" % func.__name__,\n-            DeprecationWarning, stacklevel=3)\n-\n-    def inner(*args, **kwargs):\n-        if 'connection' not in kwargs:\n-            from django.db import connection\n-            kwargs['connection'] = connection\n-            warn(\"%s has been called without providing a connection argument. \" %\n-                func.__name__, DeprecationWarning,\n-                stacklevel=2)\n-        if updated:\n-            return func(*args, **kwargs)\n-        if 'connection' in kwargs:\n-            del kwargs['connection']\n-        return func(*args, **kwargs)\n-    return inner\n-\n-def call_with_connection_and_prepared(func):\n-    arg_names, varargs, varkwargs, defaults = getargspec(func)\n-    updated = (\n-        ('connection' in arg_names or varkwargs) and\n-        ('prepared' in arg_names or varkwargs)\n-    )\n-    if not updated:\n-        warn(\"A Field class whose %s method hasn't been updated to take \"\n-            \"`connection` and `prepared` arguments.\" % func.__name__,\n-            DeprecationWarning, stacklevel=3)\n-\n-    def inner(*args, **kwargs):\n-        if 'connection' not in kwargs:\n-            from django.db import connection\n-            kwargs['connection'] = connection\n-            warn(\"%s has been called without providing a connection argument. \" %\n-                func.__name__, DeprecationWarning,\n-                stacklevel=2)\n-        if updated:\n-            return func(*args, **kwargs)\n-        if 'connection' in kwargs:\n-            del kwargs['connection']\n-        if 'prepared' in kwargs:\n-            del kwargs['prepared']\n-        return func(*args, **kwargs)\n-    return inner\n-\n-class LegacyConnection(type):\n-    \"\"\"\n-    A metaclass to normalize arguments give to the get_db_prep_* and db_type\n-    methods on fields.\n-    \"\"\"\n-    def __new__(cls, name, bases, attrs):\n-        new_cls = super(LegacyConnection, cls).__new__(cls, name, bases, attrs)\n-        for attr in ('db_type', 'get_db_prep_save'):\n-            setattr(new_cls, attr, call_with_connection(getattr(new_cls, attr)))\n-        for attr in ('get_db_prep_lookup', 'get_db_prep_value'):\n-            setattr(new_cls, attr, call_with_connection_and_prepared(getattr(new_cls, attr)))\n-        return new_cls\n-\n-class SubfieldBase(LegacyConnection):\n+class SubfieldBase(type):\n     \"\"\"\n     A metaclass for custom Field subclasses. This ensures the model's attribute\n     has the descriptor protocol attached to it."
        },
        {
            "sha": "efe01d661b934ab9d8fc64cf13b741714b90d2be",
            "filename": "tests/modeltests/field_subclassing/fields.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e57cc90c164ca9e078882158d830c5d9f717e13b/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/e57cc90c164ca9e078882158d830c5d9f717e13b/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py?ref=e57cc90c164ca9e078882158d830c5d9f717e13b",
            "patch": "@@ -40,7 +40,7 @@ def to_python(self, value):\n             return value\n         return Small(value[0], value[1])\n \n-    def get_db_prep_save(self, value):\n+    def get_db_prep_save(self, value, connection):\n         return unicode(value)\n \n     def get_prep_lookup(self, lookup_type, value):\n@@ -70,7 +70,7 @@ def to_python(self, value):\n             value = json.loads(value)\n         return value\n \n-    def get_db_prep_save(self, value):\n+    def get_db_prep_save(self, value, connection):\n         if value is None:\n             return None\n         return json.dumps(value)"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 3,
        "deletions": 70
    }
}