{
    "author": "claudep",
    "message": "Fixed #16074 -- Added ContextMixin to class-based generic views to handle get_context_data. Thanks emyller, Luke Plant, Preston Holmes for working on the ticket and patch.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17875 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "8663bc110305844b2f8b0829ee2ddfc5be61b758",
    "files": [
        {
            "sha": "c32a58a34928ed4a43340b44878cd0b985043e0e",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 14,
            "deletions": 8,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -8,6 +8,16 @@\n logger = getLogger('django.request')\n \n \n+class ContextMixin(object):\n+    \"\"\"\n+    A default context mixin that passes the keyword arguments received by\n+    get_context_data as the template context.\n+    \"\"\"\n+\n+    def get_context_data(self, **kwargs):\n+        return kwargs\n+\n+\n class View(object):\n     \"\"\"\n     Intentionally simple parent class for all views. Only implements\n@@ -110,17 +120,13 @@ def get_template_names(self):\n             return [self.template_name]\n \n \n-class TemplateView(TemplateResponseMixin, View):\n+class TemplateView(TemplateResponseMixin, ContextMixin, View):\n     \"\"\"\n-    A view that renders a template.\n+    A view that renders a template.  This view is different from all the others\n+    insofar as it also passes ``kwargs`` as ``params`` to the template context.\n     \"\"\"\n-    def get_context_data(self, **kwargs):\n-        return {\n-            'params': kwargs\n-        }\n-\n     def get(self, request, *args, **kwargs):\n-        context = self.get_context_data(**kwargs)\n+        context = self.get_context_data(params=kwargs)\n         return self.render_to_response(context)\n \n "
        },
        {
            "sha": "e5c3e5bbe3e3951a545e70e6a6f732c6ffc77574",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -217,16 +217,6 @@ def get_date_list(self, queryset, date_type):\n \n         return date_list\n \n-    def get_context_data(self, **kwargs):\n-        \"\"\"\n-        Get the context. Must return a Context (or subclass) instance.\n-        \"\"\"\n-        items = kwargs.pop('object_list')\n-        context = super(BaseDateListView, self).get_context_data(object_list=items)\n-        context.update(kwargs)\n-        return context\n-\n-\n class BaseArchiveIndexView(BaseDateListView):\n     \"\"\"\n     Base class for archives of date-based items."
        },
        {
            "sha": "a2adb15d478a26beddb3aa751b56ab7f21893239",
            "filename": "django/views/generic/detail.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fdetail.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fdetail.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdetail.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -2,10 +2,10 @@\n from django.http import Http404\n from django.utils.encoding import smart_str\n from django.utils.translation import ugettext as _\n-from django.views.generic.base import TemplateResponseMixin, View\n+from django.views.generic.base import TemplateResponseMixin, ContextMixin, View\n \n \n-class SingleObjectMixin(object):\n+class SingleObjectMixin(ContextMixin):\n     \"\"\"\n     Provides the ability to retrieve a single object for further manipulation.\n     \"\"\"\n@@ -86,11 +86,12 @@ def get_context_object_name(self, obj):\n             return None\n \n     def get_context_data(self, **kwargs):\n-        context = kwargs\n+        context = {}\n         context_object_name = self.get_context_object_name(self.object)\n         if context_object_name:\n             context[context_object_name] = self.object\n-        return context\n+        context.update(kwargs)\n+        return super(SingleObjectMixin, self).get_context_data(**context)\n \n \n class BaseDetailView(SingleObjectMixin, View):"
        },
        {
            "sha": "1f488cb8801d61c8daa9e908ddb9739fa07a1b20",
            "filename": "django/views/generic/edit.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fedit.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Fedit.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fedit.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -1,12 +1,12 @@\n from django.forms import models as model_forms\n from django.core.exceptions import ImproperlyConfigured\n from django.http import HttpResponseRedirect\n-from django.views.generic.base import TemplateResponseMixin, View\n+from django.views.generic.base import TemplateResponseMixin, ContextMixin, View\n from django.views.generic.detail import (SingleObjectMixin,\n                         SingleObjectTemplateResponseMixin, BaseDetailView)\n \n \n-class FormMixin(object):\n+class FormMixin(ContextMixin):\n     \"\"\"\n     A mixin that provides a way to show and handle a form in a request.\n     \"\"\"\n@@ -45,9 +45,6 @@ def get_form_kwargs(self):\n             })\n         return kwargs\n \n-    def get_context_data(self, **kwargs):\n-        return kwargs\n-\n     def get_success_url(self):\n         if self.success_url:\n             url = self.success_url\n@@ -113,13 +110,14 @@ def form_valid(self, form):\n         return super(ModelFormMixin, self).form_valid(form)\n \n     def get_context_data(self, **kwargs):\n-        context = kwargs\n+        context = {}\n         if self.object:\n             context['object'] = self.object\n             context_object_name = self.get_context_object_name(self.object)\n             if context_object_name:\n                 context[context_object_name] = self.object\n-        return context\n+        context.update(kwargs)\n+        return super(ModelFormMixin, self).get_context_data(**context)\n \n \n class ProcessFormView(View):"
        },
        {
            "sha": "d4664c34ef8c45abfe56953cd9d19ea74be2cf18",
            "filename": "django/views/generic/list.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/django%2Fviews%2Fgeneric%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Flist.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -3,10 +3,10 @@\n from django.http import Http404\n from django.utils.encoding import smart_str\n from django.utils.translation import ugettext as _\n-from django.views.generic.base import TemplateResponseMixin, View\n+from django.views.generic.base import TemplateResponseMixin, ContextMixin, View\n \n \n-class MultipleObjectMixin(object):\n+class MultipleObjectMixin(ContextMixin):\n     allow_empty = True\n     queryset = None\n     model = None\n@@ -103,10 +103,10 @@ def get_context_data(self, **kwargs):\n                 'is_paginated': False,\n                 'object_list': queryset\n             }\n-        context.update(kwargs)\n         if context_object_name is not None:\n             context[context_object_name] = queryset\n-        return context\n+        context.update(kwargs)\n+        return super(MultipleObjectMixin, self).get_context_data(**context)\n \n \n class BaseListView(MultipleObjectMixin, View):"
        },
        {
            "sha": "e1e2618478b1e04de96e5c2892010e2f80ea2a19",
            "filename": "docs/topics/class-based-views.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/docs%2Ftopics%2Fclass-based-views.txt",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/docs%2Ftopics%2Fclass-based-views.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views.txt?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -270,6 +270,16 @@ more::\n             context['book_list'] = Book.objects.all()\n             return context\n \n+.. note::\n+\n+    Generally, get_context_data will merge the context data of all parent classes\n+    with those of the current class.  To preserve this behavior in your own classes\n+    where you want to alter the context, you should be sure to call\n+    get_context_data on the super class. When no two classes try to define the same\n+    key, this will give the expected results. However if any class attempts to\n+    override a key after parent classes have set it (after the call to super), any\n+    children of that class will also need to explictly set it after super if they\n+    want to be sure to override all parents.\n \n Viewing subsets of objects\n --------------------------"
        },
        {
            "sha": "e18ed2a2a7b9a0546d7ebd4356a075344cb2655b",
            "filename": "tests/regressiontests/generic_views/base.py",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fbase.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import absolute_import\n+\n import time\n \n from django.core.exceptions import ImproperlyConfigured\n@@ -6,6 +8,7 @@\n from django.utils import unittest\n from django.views.generic import View, TemplateView, RedirectView\n \n+from . import views\n \n class SimpleView(View):\n     \"\"\"\n@@ -331,3 +334,19 @@ def test_redirect_when_meta_contains_no_query_string(self):\n         # we can't use self.rf.get because it always sets QUERY_STRING\n         response = RedirectView.as_view(url='/bar/')(self.rf.request(PATH_INFO='/foo/'))\n         self.assertEqual(response.status_code, 301)\n+\n+\n+class GetContextDataTest(unittest.TestCase):\n+\n+    def test_get_context_data_super(self):\n+        test_view = views.CustomContextView()\n+        context = test_view.get_context_data(kwarg_test='kwarg_value')\n+\n+        # the test_name key is inserted by the test classes parent\n+        self.assertTrue('test_name' in context)\n+        self.assertEqual(context['kwarg_test'], 'kwarg_value')\n+        self.assertEqual(context['custom_key'], 'custom_value')\n+\n+        # test that kwarg overrides values assigned higher up\n+        context = test_view.get_context_data(test_name='test_value')\n+        self.assertEqual(context['test_name'], 'test_value')"
        },
        {
            "sha": "c985ad33098b0bb88d431ede599fb493e002938b",
            "filename": "tests/regressiontests/generic_views/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/tests%2Fregressiontests%2Fgeneric_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/tests%2Fregressiontests%2Fgeneric_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Ftests.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -1,6 +1,7 @@\n from __future__ import absolute_import\n \n-from .base import ViewTest, TemplateViewTest, RedirectViewTest\n+from .base import (ViewTest, TemplateViewTest, RedirectViewTest,\n+    GetContextDataTest)\n from .dates import (ArchiveIndexViewTests, YearArchiveViewTests,\n     MonthArchiveViewTests, WeekArchiveViewTests, DayArchiveViewTests,\n     DateDetailViewTests)"
        },
        {
            "sha": "1e70ba4b464035fb100549a666d977a4546eeb76",
            "filename": "tests/regressiontests/generic_views/views.py",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/8663bc110305844b2f8b0829ee2ddfc5be61b758/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/8663bc110305844b2f8b0829ee2ddfc5be61b758/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py?ref=8663bc110305844b2f8b0829ee2ddfc5be61b758",
            "patch": "@@ -14,10 +14,9 @@ class CustomTemplateView(generic.TemplateView):\n     template_name = 'generic_views/about.html'\n \n     def get_context_data(self, **kwargs):\n-        return {\n-            'params': kwargs,\n-            'key': 'value'\n-        }\n+        context = super(CustomTemplateView, self).get_context_data(**kwargs)\n+        context.update({'key': 'value'})\n+        return context\n \n \n class ObjectDetail(generic.DetailView):\n@@ -184,3 +183,18 @@ class BookDetailGetObjectCustomQueryset(BookDetail):\n     def get_object(self, queryset=None):\n         return super(BookDetailGetObjectCustomQueryset,self).get_object(\n             queryset=Book.objects.filter(pk=2))\n+\n+class CustomContextView(generic.detail.SingleObjectMixin, generic.View):\n+    model = Book\n+    object = Book(name='dummy')\n+\n+    def get_object(self):\n+        return Book(name=\"dummy\")\n+\n+    def get_context_data(self, **kwargs):\n+        context = {'custom_key': 'custom_value'}\n+        context.update(kwargs)\n+        return super(CustomContextView, self).get_context_data(**context)\n+\n+    def get_context_object_name(self, obj):\n+        return \"test_name\""
        }
    ],
    "stats": {
        "total": 115,
        "additions": 77,
        "deletions": 38
    }
}