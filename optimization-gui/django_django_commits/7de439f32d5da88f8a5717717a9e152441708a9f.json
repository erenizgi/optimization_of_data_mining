{
    "author": "akaariai",
    "message": "Fixed #19187 -- Raise consistent error from qs.values().delete()",
    "sha": "7de439f32d5da88f8a5717717a9e152441708a9f",
    "files": [
        {
            "sha": "dc1ddf16061102bc7d0f6faa7e2d2bc3f257d1f8",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/7de439f32d5da88f8a5717717a9e152441708a9f/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/7de439f32d5da88f8a5717717a9e152441708a9f/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=7de439f32d5da88f8a5717717a9e152441708a9f",
            "patch": "@@ -983,6 +983,12 @@ def iterator(self):\n         for row in self.query.get_compiler(self.db).results_iter():\n             yield dict(zip(names, row))\n \n+    def delete(self):\n+        # values().delete() doesn't work currently - make sure it raises an\n+        # user friendly error.\n+        raise TypeError(\"Queries with .values() or .values_list() applied \"\n+                        \"can't be deleted\")\n+\n     def _setup_query(self):\n         \"\"\"\n         Constructs the field_names list that the values query will be"
        },
        {
            "sha": "f94bb2f20cae91a8983729b239dfc4c355f83808",
            "filename": "tests/regressiontests/delete_regress/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/7de439f32d5da88f8a5717717a9e152441708a9f/tests%2Fregressiontests%2Fdelete_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7de439f32d5da88f8a5717717a9e152441708a9f/tests%2Fregressiontests%2Fdelete_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdelete_regress%2Ftests.py?ref=7de439f32d5da88f8a5717717a9e152441708a9f",
            "patch": "@@ -267,6 +267,12 @@ def test_delete_proxy_pair(self):\n \n         self.assertEqual(len(FooFileProxy.objects.all()), 0)\n \n+    def test_19187_values(self):\n+        with self.assertRaises(TypeError):\n+            Image.objects.values().delete()\n+        with self.assertRaises(TypeError):\n+            Image.objects.values_list().delete()\n+\n class Ticket19102Tests(TestCase):\n     \"\"\"\n     Test different queries which alter the SELECT clause of the query. We"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 12,
        "deletions": 0
    }
}