{
    "author": "akaariai",
    "message": "Fixed #17497 -- Corrected FieldError message in add_fields()\n\nThe erroneous message was user visible in values_list() calls.\n\nThanks to ojii for report and review, and to antoviaque for the patch.",
    "sha": "fcad6c48f07bdc6346c065849a87f0f02afb6f94",
    "files": [
        {
            "sha": "118bc1e14f533c4df6f3efdf772664a4d501f1b8",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/fcad6c48f07bdc6346c065849a87f0f02afb6f94/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/fcad6c48f07bdc6346c065849a87f0f02afb6f94/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=fcad6c48f07bdc6346c065849a87f0f02afb6f94",
            "patch": "@@ -1655,10 +1655,15 @@ def add_fields(self, field_names, allow_m2m=True):\n         except MultiJoin:\n             raise FieldError(\"Invalid field name: '%s'\" % name)\n         except FieldError:\n-            names = opts.get_all_field_names() + self.extra.keys() + self.aggregate_select.keys()\n-            names.sort()\n-            raise FieldError(\"Cannot resolve keyword %r into field. \"\n-                    \"Choices are: %s\" % (name, \", \".join(names)))\n+            if name.find(LOOKUP_SEP) != -1:\n+                # For lookups spanning over relationships, show the error\n+                # from the model on which the lookup failed.\n+                raise\n+            else:\n+                names = sorted(opts.get_all_field_names() + self.extra.keys()\n+                               + self.aggregate_select.keys())\n+                raise FieldError(\"Cannot resolve keyword %r into field. \"\n+                                 \"Choices are: %s\" % (name, \", \".join(names)))\n         self.remove_inherited_models()\n \n     def add_ordering(self, *ordering):"
        },
        {
            "sha": "fd849df0513de4922cb1928be0503deba84d5bf4",
            "filename": "tests/modeltests/many_to_one/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/fcad6c48f07bdc6346c065849a87f0f02afb6f94/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fcad6c48f07bdc6346c065849a87f0f02afb6f94/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py?ref=fcad6c48f07bdc6346c065849a87f0f02afb6f94",
            "patch": "@@ -3,7 +3,7 @@\n from copy import deepcopy\n from datetime import datetime\n \n-from django.core.exceptions import MultipleObjectsReturned\n+from django.core.exceptions import MultipleObjectsReturned, FieldError\n from django.test import TestCase\n from django.utils.translation import ugettext_lazy\n \n@@ -424,3 +424,15 @@ def test_create_relation_with_ugettext_lazy(self):\n         notlazy = unicode(lazy)\n         article = reporter.article_set.get()\n         self.assertEqual(article.headline, notlazy)\n+\n+    def test_values_list_exception(self):\n+        expected_message = \"Cannot resolve keyword 'notafield' into field. Choices are: %s\"\n+\n+        self.assertRaisesMessage(FieldError,\n+                                 expected_message % ', '.join(Reporter._meta.get_all_field_names()),\n+                                 Article.objects.values_list,\n+                                 'reporter__notafield')\n+        self.assertRaisesMessage(FieldError,\n+                                 expected_message % ', '.join(['EXTRA',] + Article._meta.get_all_field_names()),\n+                                 Article.objects.extra(select={'EXTRA': 'EXTRA_SELECT'}).values_list,\n+                                 'notafield')"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 22,
        "deletions": 5
    }
}