{
    "author": "ptone",
    "message": "Fixed #18985 -- made DeprecationWarnings loud\n\nCapture warnings in Python >= 2.7 and route through\nconsole handler, which is subject to DEBUG==True\n\nThanks to dstufft for the idea, and claudep for initial patch",
    "sha": "44046e8a38225067d4d0feac35367eeae133446a",
    "files": [
        {
            "sha": "dec4cf94181f6d1126baf907fbb51f8094ec7d35",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/44046e8a38225067d4d0feac35367eeae133446a/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/44046e8a38225067d4d0feac35367eeae133446a/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=44046e8a38225067d4d0feac35367eeae133446a",
            "patch": "@@ -6,6 +6,7 @@\n a list of all possible variables.\n \"\"\"\n \n+import logging\n import os\n import time     # Needed for Windows\n import warnings\n@@ -55,6 +56,15 @@ def _configure_logging(self):\n         \"\"\"\n         Setup logging from LOGGING_CONFIG and LOGGING settings.\n         \"\"\"\n+        try:\n+            # Route warnings through python logging\n+            logging.captureWarnings(True)\n+            # Allow DeprecationWarnings through the warnings filters\n+            warnings.simplefilter(\"default\", DeprecationWarning)\n+        except AttributeError:\n+            # No captureWarnings on Python 2.6, DeprecationWarnings are on anyway\n+            pass\n+\n         if self.LOGGING_CONFIG:\n             from django.utils.log import DEFAULT_LOGGING\n             # First find the logging configuration function ..."
        },
        {
            "sha": "4806527e8404b2b2941da21117b462871cc11972",
            "filename": "django/utils/log.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/44046e8a38225067d4d0feac35367eeae133446a/django%2Futils%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/44046e8a38225067d4d0feac35367eeae133446a/django%2Futils%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Flog.py?ref=44046e8a38225067d4d0feac35367eeae133446a",
            "patch": "@@ -62,6 +62,9 @@ def emit(self, record):\n             'level': 'ERROR',\n             'propagate': False,\n         },\n+        'py.warnings': {\n+            'handlers': ['console'],\n+        },\n     }\n }\n "
        },
        {
            "sha": "c53518feaa234474ba8163d9f5ec2a5b90dda628",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/44046e8a38225067d4d0feac35367eeae133446a/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/44046e8a38225067d4d0feac35367eeae133446a/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=44046e8a38225067d4d0feac35367eeae133446a",
            "patch": "@@ -306,6 +306,13 @@ Django 1.5 also includes several smaller improvements worth noting:\n   :attr:`~django.db.models.Options.index_together` documentation for more\n   information.\n \n+* During Django's logging configuration verbose Deprecation warnings are\n+  enabled and warnings are captured into the logging system. Logged warnings\n+  are routed through the ``console`` logging handler, which by default requires\n+  :setting:`DEBUG` to be True for output to be generated. The result is that\n+  DeprecationWarnings should be printed to the console in development\n+  environments the way they have been in Python versions < 2.7.\n+\n Backwards incompatible changes in 1.5\n =====================================\n "
        },
        {
            "sha": "0e56195c41c186ef0a263e64e37b5d3ebf383999",
            "filename": "tests/regressiontests/logging_tests/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/44046e8a38225067d4d0feac35367eeae133446a/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/44046e8a38225067d4d0feac35367eeae133446a/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flogging_tests%2Ftests.py?ref=44046e8a38225067d4d0feac35367eeae133446a",
            "patch": "@@ -2,6 +2,7 @@\n \n import copy\n import logging\n+import sys\n import warnings\n \n from django.conf import compat_patch_logging_config, LazySettings\n@@ -10,9 +11,11 @@\n from django.test.utils import override_settings\n from django.utils.log import CallbackFilter, RequireDebugFalse\n from django.utils.six import StringIO\n+from django.utils.unittest import skipUnless\n \n from ..admin_scripts.tests import AdminScriptTestCase\n \n+PYVERS = sys.version_info[:2]\n \n # logging config prior to using filter with mail_admins\n OLD_LOGGING = {\n@@ -131,6 +134,32 @@ def test_django_logger(self):\n             self.logger.error(\"Hey, this is an error.\")\n             self.assertEqual(output.getvalue(), 'Hey, this is an error.\\n')\n \n+@skipUnless(PYVERS > (2,6), \"warnings captured only in Python >= 2.7\")\n+class WarningLoggerTests(TestCase):\n+    \"\"\"\n+    Tests that warnings output for DeprecationWarnings is enabled\n+    and captured to the logging system\n+    \"\"\"\n+    def setUp(self):\n+        self.logger = logging.getLogger('py.warnings')\n+        self.old_stream = self.logger.handlers[0].stream\n+\n+    def tearDown(self):\n+        self.logger.handlers[0].stream = self.old_stream\n+\n+    @override_settings(DEBUG=True)\n+    def test_warnings_capture(self):\n+        output = StringIO()\n+        self.logger.handlers[0].stream = output\n+        warnings.warn('Foo Deprecated', DeprecationWarning)\n+        self.assertTrue('Foo Deprecated' in output.getvalue())\n+\n+    def test_warnings_capture_debug_false(self):\n+        output = StringIO()\n+        self.logger.handlers[0].stream = output\n+        warnings.warn('Foo Deprecated', DeprecationWarning)\n+        self.assertFalse('Foo Deprecated' in output.getvalue())\n+\n \n class CallbackFilterTest(TestCase):\n     def test_sense(self):"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 49,
        "deletions": 0
    }
}