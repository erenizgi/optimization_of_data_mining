{
    "author": "jphalip",
    "message": "Fixed #16677 -- Fixed the future version of the ssi template tag to work with template file names that contain spaces. Note that this fix cannot be applied to the currently deprecated version of the ssi tag since it requires an unquoted literal as parameter. Many thanks to Aymeric Augustin for the report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16687 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "bf9ba45f6b5da97154f317ba0b8349b2822a00ba",
    "files": [
        {
            "sha": "9fb2d1138ffe93869c8a5e5b9997ffc560056bcc",
            "filename": "django/templatetags/future.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/bf9ba45f6b5da97154f317ba0b8349b2822a00ba/django%2Ftemplatetags%2Ffuture.py",
            "raw_url": "https://github.com/django/django/raw/bf9ba45f6b5da97154f317ba0b8349b2822a00ba/django%2Ftemplatetags%2Ffuture.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Ffuture.py?ref=bf9ba45f6b5da97154f317ba0b8349b2822a00ba",
            "patch": "@@ -19,7 +19,7 @@ def ssi(parser, token):\n \n         {% ssi \"/home/html/ljworld.com/includes/right_generic.html\" parsed %}\n     \"\"\"\n-    bits = token.contents.split()\n+    bits = token.split_contents()\n     parsed = False\n     if len(bits) not in (2, 3):\n         raise TemplateSyntaxError(\"'ssi' tag takes one argument: the path to\""
        },
        {
            "sha": "1c856488610c45a9bd7aa6f8bf5c66857006802d",
            "filename": "tests/regressiontests/templates/templates/ssi include with spaces.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/bf9ba45f6b5da97154f317ba0b8349b2822a00ba/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Fssi%20include%20with%20spaces.html",
            "raw_url": "https://github.com/django/django/raw/bf9ba45f6b5da97154f317ba0b8349b2822a00ba/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Fssi%20include%20with%20spaces.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Fssi%20include%20with%20spaces.html?ref=bf9ba45f6b5da97154f317ba0b8349b2822a00ba",
            "patch": "@@ -0,0 +1 @@\n+This is for testing an ssi include with spaces in its name. {{ test }}"
        },
        {
            "sha": "8c722b8bae65541010741f4d2a933a6442cd0479",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 11,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/bf9ba45f6b5da97154f317ba0b8349b2822a00ba/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/bf9ba45f6b5da97154f317ba0b8349b2822a00ba/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=bf9ba45f6b5da97154f317ba0b8349b2822a00ba",
            "patch": "@@ -508,7 +508,8 @@ def render(self, test_template, vals):\n     def get_template_tests(self):\n         # SYNTAX --\n         # 'template_name': ('template contents', 'context dict', 'expected string output' or Exception class)\n-        return {\n+        basedir = os.path.dirname(os.path.abspath(__file__))\n+        tests = {\n             ### BASIC SYNTAX ################################################\n \n             # Plain text should go through the template parser untouched\n@@ -1350,27 +1351,34 @@ def get_template_tests(self):\n             ### SSI TAG ########################################################\n \n             # Test normal behavior\n-            'old-ssi01': ('{%% ssi %s %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'templates', 'ssi_include.html'), {}, 'This is for testing an ssi include. {{ test }}\\n'),\n-            'old-ssi02': ('{%% ssi %s %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'not_here'), {}, ''),\n+            'old-ssi01': ('{%% ssi %s %%}' % os.path.join(basedir, 'templates', 'ssi_include.html'), {}, 'This is for testing an ssi include. {{ test }}\\n'),\n+            'old-ssi02': ('{%% ssi %s %%}' % os.path.join(basedir, 'not_here'), {}, ''),\n \n             # Test parsed output\n-            'old-ssi06': ('{%% ssi %s parsed %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'templates', 'ssi_include.html'), {'test': 'Look ma! It parsed!'}, 'This is for testing an ssi include. Look ma! It parsed!\\n'),\n-            'old-ssi07': ('{%% ssi %s parsed %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'not_here'), {'test': 'Look ma! It parsed!'}, ''),\n+            'old-ssi06': ('{%% ssi %s parsed %%}' % os.path.join(basedir, 'templates', 'ssi_include.html'), {'test': 'Look ma! It parsed!'}, 'This is for testing an ssi include. Look ma! It parsed!\\n'),\n+            'old-ssi07': ('{%% ssi %s parsed %%}' % os.path.join(basedir, 'not_here'), {'test': 'Look ma! It parsed!'}, ''),\n+\n+            # Test space in file name\n+            'old-ssi08': ('{%% ssi %s %%}' % os.path.join(basedir, 'templates', 'ssi include with spaces.html'), {}, template.TemplateSyntaxError),\n+            'old-ssi09': ('{%% ssi %s parsed %%}' % os.path.join(basedir, 'templates', 'ssi include with spaces.html'), {'test': 'Look ma! It parsed!'}, template.TemplateSyntaxError),\n \n             # Future compatibility\n             # Test normal behavior\n-            'ssi01': ('{%% load ssi from future %%}{%% ssi \"%s\" %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'templates', 'ssi_include.html'), {}, 'This is for testing an ssi include. {{ test }}\\n'),\n-            'ssi02': ('{%% load ssi from future %%}{%% ssi \"%s\" %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'not_here'), {}, ''),\n-            'ssi03': (\"{%% load ssi from future %%}{%% ssi '%s' %%}\" % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'not_here'), {}, ''),\n+            'ssi01': ('{%% load ssi from future %%}{%% ssi \"%s\" %%}' % os.path.join(basedir, 'templates', 'ssi_include.html'), {}, 'This is for testing an ssi include. {{ test }}\\n'),\n+            'ssi02': ('{%% load ssi from future %%}{%% ssi \"%s\" %%}' % os.path.join(basedir, 'not_here'), {}, ''),\n+            'ssi03': (\"{%% load ssi from future %%}{%% ssi '%s' %%}\" % os.path.join(basedir, 'not_here'), {}, ''),\n \n             # Test passing as a variable\n-            'ssi04': ('{% load ssi from future %}{% ssi ssi_file %}', {'ssi_file': os.path.join(os.path.dirname(os.path.abspath(__file__)), 'templates', 'ssi_include.html')}, 'This is for testing an ssi include. {{ test }}\\n'),\n+            'ssi04': ('{% load ssi from future %}{% ssi ssi_file %}', {'ssi_file': os.path.join(basedir, 'templates', 'ssi_include.html')}, 'This is for testing an ssi include. {{ test }}\\n'),\n             'ssi05': ('{% load ssi from future %}{% ssi ssi_file %}', {'ssi_file': 'no_file'}, ''),\n \n             # Test parsed output\n-            'ssi06': ('{%% load ssi from future %%}{%% ssi \"%s\" parsed %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'templates', 'ssi_include.html'), {'test': 'Look ma! It parsed!'}, 'This is for testing an ssi include. Look ma! It parsed!\\n'),\n-            'ssi07': ('{%% load ssi from future %%}{%% ssi \"%s\" parsed %%}' % os.path.join(os.path.dirname(os.path.abspath(__file__)), 'not_here'), {'test': 'Look ma! It parsed!'}, ''),\n+            'ssi06': ('{%% load ssi from future %%}{%% ssi \"%s\" parsed %%}' % os.path.join(basedir, 'templates', 'ssi_include.html'), {'test': 'Look ma! It parsed!'}, 'This is for testing an ssi include. Look ma! It parsed!\\n'),\n+            'ssi07': ('{%% load ssi from future %%}{%% ssi \"%s\" parsed %%}' % os.path.join(basedir, 'not_here'), {'test': 'Look ma! It parsed!'}, ''),\n \n+            # Test space in file name\n+            'ssi08': ('{%% load ssi from future %%}{%% ssi \"%s\" %%}' % os.path.join(basedir, 'templates', 'ssi include with spaces.html'), {}, 'This is for testing an ssi include with spaces in its name. {{ test }}\\n'),\n+            'ssi09': ('{%% load ssi from future %%}{%% ssi \"%s\" parsed %%}' % os.path.join(basedir, 'templates', 'ssi include with spaces.html'), {'test': 'Look ma! It parsed!'}, 'This is for testing an ssi include with spaces in its name. Look ma! It parsed!\\n'),\n \n             ### TEMPLATETAG TAG #######################################################\n             'templatetag01': ('{% templatetag openblock %}', {}, '{%'),\n@@ -1612,6 +1620,16 @@ def get_template_tests(self):\n             'static-statictag01': ('{% load static %}{% static \"admin/base.css\" %}', {}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n             'static-statictag02': ('{% load static %}{% static base_css %}', {'base_css': 'admin/base.css'}, urljoin(settings.STATIC_URL, 'admin/base.css')),\n         }\n+        # Until Django 1.5, the ssi tag takes an unquoted constant in argument,\n+        # and there's no way to escape spaces. As a consequence it's impossible\n+        # to include a file if its absolute path contains a space, as\n+        # demonstrated by tests old-ssi08 and old-ssi09.\n+        # If the patch to the Django chekout contains a space, the following\n+        # tests will raise an exception too.\n+        if ' ' in basedir:\n+            for test_name in 'old-ssi01', 'old-ssi02', 'old-ssi06', 'old-ssi07':\n+                tests[test_name] = tests[test_name][:-1] + (template.TemplateSyntaxError,)\n+        return tests\n \n class TemplateTagLoading(unittest.TestCase):\n "
        }
    ],
    "stats": {
        "total": 43,
        "additions": 31,
        "deletions": 12
    }
}