{
    "author": "alex",
    "message": "Removed the deprecated-since-1.2 \"supports_object_permissions\" and \"supports_anonymous_user\" flags on authentication backends.  If you have an authenication backend it now *must* suport these.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16789 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e130dc327548d143c3ee27af8c7e069ba772f3e7",
    "files": [
        {
            "sha": "56cdb423f130085670aa1bd1550ea8780cc0f617",
            "filename": "django/contrib/auth/backends.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Fbackends.py",
            "raw_url": "https://github.com/django/django/raw/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Fbackends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fbackends.py?ref=e130dc327548d143c3ee27af8c7e069ba772f3e7",
            "patch": "@@ -5,8 +5,6 @@ class ModelBackend(object):\n     \"\"\"\n     Authenticates against django.contrib.auth.models.User.\n     \"\"\"\n-    supports_object_permissions = False\n-    supports_anonymous_user = True\n     supports_inactive_user = True\n \n     # TODO: Model, login attribute name and password attribute name should be\n@@ -19,11 +17,13 @@ def authenticate(self, username=None, password=None):\n         except User.DoesNotExist:\n             return None\n \n-    def get_group_permissions(self, user_obj):\n+    def get_group_permissions(self, user_obj, obj=None):\n         \"\"\"\n         Returns a set of permission strings that this user has through his/her\n         groups.\n         \"\"\"\n+        if user_obj.is_anonymous() or obj is not None:\n+            return set()\n         if not hasattr(user_obj, '_group_perm_cache'):\n             if user_obj.is_superuser:\n                 perms = Permission.objects.all()\n@@ -33,18 +33,18 @@ def get_group_permissions(self, user_obj):\n             user_obj._group_perm_cache = set([\"%s.%s\" % (ct, name) for ct, name in perms])\n         return user_obj._group_perm_cache\n \n-    def get_all_permissions(self, user_obj):\n-        if user_obj.is_anonymous():\n+    def get_all_permissions(self, user_obj, obj=None):\n+        if user_obj.is_anonymous() or obj is not None:\n             return set()\n         if not hasattr(user_obj, '_perm_cache'):\n             user_obj._perm_cache = set([u\"%s.%s\" % (p.content_type.app_label, p.codename) for p in user_obj.user_permissions.select_related()])\n             user_obj._perm_cache.update(self.get_group_permissions(user_obj))\n         return user_obj._perm_cache\n \n-    def has_perm(self, user_obj, perm):\n+    def has_perm(self, user_obj, perm, obj=None):\n         if not user_obj.is_active:\n             return False\n-        return perm in self.get_all_permissions(user_obj)\n+        return perm in self.get_all_permissions(user_obj, obj)\n \n     def has_module_perms(self, user_obj, app_label):\n         \"\"\""
        },
        {
            "sha": "04e68aa48d23fb9923039cf40775c99617424107",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 15,
            "deletions": 31,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=e130dc327548d143c3ee27af8c7e069ba772f3e7",
            "patch": "@@ -132,46 +132,33 @@ def make_random_password(self, length=10, allowed_chars='abcdefghjkmnpqrstuvwxyz\n # A few helper functions for common logic between User and AnonymousUser.\n def _user_get_all_permissions(user, obj):\n     permissions = set()\n-    anon = user.is_anonymous()\n     for backend in auth.get_backends():\n-        if not anon or backend.supports_anonymous_user:\n-            if hasattr(backend, \"get_all_permissions\"):\n-                if obj is not None:\n-                    if backend.supports_object_permissions:\n-                        permissions.update(\n-                            backend.get_all_permissions(user, obj)\n-                        )\n-                else:\n-                    permissions.update(backend.get_all_permissions(user))\n+        if hasattr(backend, \"get_all_permissions\"):\n+            if obj is not None:\n+                permissions.update(backend.get_all_permissions(user, obj))\n+            else:\n+                permissions.update(backend.get_all_permissions(user))\n     return permissions\n \n \n def _user_has_perm(user, perm, obj):\n-    anon = user.is_anonymous()\n-    active = user.is_active\n     for backend in auth.get_backends():\n-        if (not active and not anon and backend.supports_inactive_user) or \\\n-                    (not anon or backend.supports_anonymous_user):\n-            if hasattr(backend, \"has_perm\"):\n-                if obj is not None:\n-                    if (backend.supports_object_permissions and\n-                        backend.has_perm(user, perm, obj)):\n-                            return True\n-                else:\n-                    if backend.has_perm(user, perm):\n+        if hasattr(backend, \"has_perm\"):\n+            if obj is not None:\n+                if backend.has_perm(user, perm, obj):\n                         return True\n+            else:\n+                if backend.has_perm(user, perm):\n+                    return True\n     return False\n \n \n def _user_has_module_perms(user, app_label):\n-    anon = user.is_anonymous()\n     active = user.is_active\n     for backend in auth.get_backends():\n-        if (not active and not anon and backend.supports_inactive_user) or \\\n-                    (not anon or backend.supports_anonymous_user):\n-            if hasattr(backend, \"has_module_perms\"):\n-                if backend.has_module_perms(user, app_label):\n-                    return True\n+        if hasattr(backend, \"has_module_perms\"):\n+            if backend.has_module_perms(user, app_label):\n+                return True\n     return False\n \n \n@@ -264,10 +251,7 @@ def get_group_permissions(self, obj=None):\n         for backend in auth.get_backends():\n             if hasattr(backend, \"get_group_permissions\"):\n                 if obj is not None:\n-                    if backend.supports_object_permissions:\n-                        permissions.update(\n-                            backend.get_group_permissions(self, obj)\n-                        )\n+                    permissions.update(backend.get_group_permissions(self, obj))\n                 else:\n                     permissions.update(backend.get_group_permissions(self))\n         return permissions"
        },
        {
            "sha": "b416890d20b47098375299cc235415bc17fedc7a",
            "filename": "django/contrib/auth/tests/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py?ref=e130dc327548d143c3ee27af8c7e069ba772f3e7",
            "patch": "@@ -1,6 +1,6 @@\n from django.contrib.auth.tests.auth_backends import (BackendTest,\n-    RowlevelBackendTest, AnonymousUserBackendTest, NoAnonymousUserBackendTest,\n-    NoBackendsTest, InActiveUserBackendTest, NoInActiveUserBackendTest)\n+    RowlevelBackendTest, AnonymousUserBackendTest, NoBackendsTest,\n+    InActiveUserBackendTest, NoInActiveUserBackendTest)\n from django.contrib.auth.tests.basic import BasicTestCase, PasswordUtilsTestCase\n from django.contrib.auth.tests.context_processors import AuthContextProcessorTests\n from django.contrib.auth.tests.decorators import LoginRequiredTestCase"
        },
        {
            "sha": "afef0e72862716b2623523483aa490ef205e33ea",
            "filename": "django/contrib/auth/tests/auth_backends.py",
            "status": "modified",
            "additions": 1,
            "deletions": 43,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "raw_url": "https://github.com/django/django/raw/e130dc327548d143c3ee27af8c7e069ba772f3e7/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py?ref=e130dc327548d143c3ee27af8c7e069ba772f3e7",
            "patch": "@@ -103,14 +103,12 @@ class TestObj(object):\n \n \n class SimpleRowlevelBackend(object):\n-    supports_object_permissions = True\n     supports_inactive_user = False\n \n     # This class also supports tests for anonymous user permissions, and\n     # inactive user permissions via subclasses which just set the\n     # 'supports_anonymous_user' or 'supports_inactive_user' attribute.\n \n-\n     def has_perm(self, user, perm, obj=None):\n         if not obj:\n             return # We only support row level perms\n@@ -119,7 +117,6 @@ def has_perm(self, user, perm, obj=None):\n             if user.username == 'test2':\n                 return True\n             elif user.is_anonymous() and perm == 'anon':\n-                # not reached due to supports_anonymous_user = False\n                 return True\n             elif not user.is_active and perm == 'inactive':\n                 return True\n@@ -199,20 +196,12 @@ def test_get_group_permissions(self):\n \n \n class AnonymousUserBackend(SimpleRowlevelBackend):\n-\n-    supports_anonymous_user = True\n-    supports_inactive_user = False\n-\n-\n-class NoAnonymousUserBackend(SimpleRowlevelBackend):\n-\n-    supports_anonymous_user = False\n     supports_inactive_user = False\n \n \n class AnonymousUserBackendTest(TestCase):\n     \"\"\"\n-    Tests for AnonymousUser delegating to backend if it has 'supports_anonymous_user' = True\n+    Tests for AnonymousUser delegating to backend.\n     \"\"\"\n \n     backend = 'django.contrib.auth.tests.auth_backends.AnonymousUserBackend'\n@@ -241,33 +230,6 @@ def test_get_all_permissions(self):\n         self.assertEqual(self.user1.get_all_permissions(TestObj()), set(['anon']))\n \n \n-class NoAnonymousUserBackendTest(TestCase):\n-    \"\"\"\n-    Tests that AnonymousUser does not delegate to backend if it has 'supports_anonymous_user' = False\n-    \"\"\"\n-    backend = 'django.contrib.auth.tests.auth_backends.NoAnonymousUserBackend'\n-\n-    def setUp(self):\n-        self.curr_auth = settings.AUTHENTICATION_BACKENDS\n-        settings.AUTHENTICATION_BACKENDS = tuple(self.curr_auth) + (self.backend,)\n-        self.user1 = AnonymousUser()\n-\n-    def tearDown(self):\n-        settings.AUTHENTICATION_BACKENDS = self.curr_auth\n-\n-    def test_has_perm(self):\n-        self.assertEqual(self.user1.has_perm('perm', TestObj()), False)\n-        self.assertEqual(self.user1.has_perm('anon', TestObj()), False)\n-\n-    def test_has_perms(self):\n-        self.assertEqual(self.user1.has_perms(['anon'], TestObj()), False)\n-\n-    def test_has_module_perms(self):\n-        self.assertEqual(self.user1.has_module_perms(\"app1\"), False)\n-        self.assertEqual(self.user1.has_module_perms(\"app2\"), False)\n-\n-    def test_get_all_permissions(self):\n-        self.assertEqual(self.user1.get_all_permissions(TestObj()), set())\n \n \n class NoBackendsTest(TestCase):\n@@ -287,14 +249,10 @@ def test_raises_exception(self):\n \n \n class InActiveUserBackend(SimpleRowlevelBackend):\n-\n-    supports_anonymous_user = False\n     supports_inactive_user = True\n \n \n class NoInActiveUserBackend(SimpleRowlevelBackend):\n-\n-    supports_anonymous_user = False\n     supports_inactive_user = False\n \n "
        },
        {
            "sha": "cac22e636ebfcf705cd3577b3ea529689023cdf8",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 30,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/e130dc327548d143c3ee27af8c7e069ba772f3e7/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/e130dc327548d143c3ee27af8c7e069ba772f3e7/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=e130dc327548d143c3ee27af8c7e069ba772f3e7",
            "patch": "@@ -1633,8 +1633,6 @@ object the first time a user authenticates::\n         ADMIN_PASSWORD = 'sha1$4e987$afbcf42e21bd417fb71db8c66b321e9fc33051de'\n         \"\"\"\n \n-        supports_object_permissions = False\n-        supports_anonymous_user = False\n         supports_inactive_user = False\n \n         def authenticate(self, username=None, password=None):\n@@ -1683,7 +1681,7 @@ fairly simply::\n \n         # ...\n \n-        def has_perm(self, user_obj, perm):\n+        def has_perm(self, user_obj, perm, obj=None):\n             if user_obj.username == settings.ADMIN_LOGIN:\n                 return True\n             else:\n@@ -1720,19 +1718,6 @@ for the authors of re-usable apps, who can delegate all questions of authorizati\n to the auth backend, rather than needing settings, for example, to control\n anonymous access.\n \n-To enable this in your own backend, you must set the class attribute\n-``supports_anonymous_user`` to ``True``. (This precaution is to maintain\n-compatibility with backends that assume that all user objects are actual\n-instances of the :class:`django.contrib.auth.models.User` class). With this\n-in place, :class:`django.contrib.auth.models.AnonymousUser` will delegate all\n-the relevant permission methods to the authentication backends.\n-\n-A nonexistent ``supports_anonymous_user`` attribute will raise a hidden\n-``PendingDeprecationWarning`` if used in Django 1.2. In Django 1.3, this\n-warning will be upgraded to a ``DeprecationWarning``, which will be displayed\n-loudly. Additionally ``supports_anonymous_user`` will be set to ``False``.\n-Django 1.4 will assume that every backend supports anonymous users being\n-passed to the authorization methods.\n \n Authorization for inactive users\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n@@ -1765,17 +1750,4 @@ Handling object permissions\n Django's permission framework has a foundation for object permissions, though\n there is no implementation for it in the core. That means that checking for\n object permissions will always return ``False`` or an empty list (depending on\n-the check performed).\n-\n-To enable object permissions in your own\n-:doc:`authentication backend </ref/authbackends>` you'll just have\n-to allow passing an ``obj`` parameter to the permission methods and set the\n-``supports_object_permissions`` class attribute to ``True``.\n-\n-A nonexistent ``supports_object_permissions`` will raise a hidden\n-``PendingDeprecationWarning`` if used in Django 1.2. In Django 1.3, this\n-warning will be upgraded to a ``DeprecationWarning``, which will be displayed\n-loudly. Additionally ``supports_object_permissions`` will be set to ``False``.\n-Django 1.4 will assume that every backend supports object permissions and\n-won't check for the existence of ``supports_object_permissions``, which\n-means not supporting ``obj`` as a parameter will raise a ``TypeError``.\n+the check performed).\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 140,
        "additions": 27,
        "deletions": 113
    }
}