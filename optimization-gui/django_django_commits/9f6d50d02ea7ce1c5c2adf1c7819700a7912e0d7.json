{
    "author": "carljm",
    "message": "Fixed #15182 - Fixed a security issue with ClearableFileInput. Disclosure and new release forthcoming.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15470 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7",
    "files": [
        {
            "sha": "dd5868f4799386105ca598c4f2e8a4c9cc9b00b1",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7",
            "patch": "@@ -330,12 +330,13 @@ def render(self, name, value, attrs=None):\n         if value and hasattr(value, \"url\"):\n             template = self.template_with_initial\n             substitutions['initial'] = (u'<a href=\"%s\">%s</a>'\n-                                        % (value.url, value))\n+                                        % (escape(value.url),\n+                                           escape(force_unicode(value))))\n             if not self.is_required:\n                 checkbox_name = self.clear_checkbox_name(name)\n                 checkbox_id = self.clear_checkbox_id(checkbox_name)\n-                substitutions['clear_checkbox_name'] = checkbox_name\n-                substitutions['clear_checkbox_id'] = checkbox_id\n+                substitutions['clear_checkbox_name'] = conditional_escape(checkbox_name)\n+                substitutions['clear_checkbox_id'] = conditional_escape(checkbox_id)\n                 substitutions['clear'] = CheckboxInput().render(checkbox_name, False, attrs={'id': checkbox_id})\n                 substitutions['clear_template'] = self.template_with_clear % substitutions\n "
        },
        {
            "sha": "4c5aeb0147997bf4365be8d2942fa4b6de70a3c5",
            "filename": "tests/regressiontests/forms/tests/widgets.py",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py?ref=9f6d50d02ea7ce1c5c2adf1c7819700a7912e0d7",
            "patch": "@@ -1086,6 +1086,28 @@ def test_clear_input_renders(self):\n         self.assertEqual(widget.render('myfile', FakeFieldFile()),\n                          u'Currently: <a href=\"something\">something</a> <input type=\"checkbox\" name=\"myfile-clear\" id=\"myfile-clear_id\" /> <label for=\"myfile-clear_id\">Clear</label><br />Change: <input type=\"file\" name=\"myfile\" />')\n \n+    def test_html_escaped(self):\n+        \"\"\"\n+        A ClearableFileInput should escape name, filename and URL when\n+        rendering HTML. Refs #15182.\n+        \"\"\"\n+\n+        class StrangeFieldFile(object):\n+            url = \"something?chapter=1&sect=2&copy=3&lang=en\"\n+\n+            def __unicode__(self):\n+                return u'''something<div onclick=\"alert('oops')\">.jpg'''\n+\n+        widget = ClearableFileInput()\n+        field = StrangeFieldFile()\n+        output = widget.render('my<div>file', field)\n+        self.assertFalse(field.url in output)\n+        self.assertTrue(u'href=\"something?chapter=1&amp;sect=2&amp;copy=3&amp;lang=en\"' in output)\n+        self.assertFalse(unicode(field) in output)\n+        self.assertTrue(u'something&lt;div onclick=&quot;alert(&#39;oops&#39;)&quot;&gt;.jpg' in output)\n+        self.assertTrue(u'my&lt;div&gt;file' in output)\n+        self.assertFalse(u'my<div>file' in output)\n+\n     def test_clear_input_renders_only_if_not_required(self):\n         \"\"\"\n         A ClearableFileInput with is_required=False does not render a clear"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 26,
        "deletions": 3
    }
}