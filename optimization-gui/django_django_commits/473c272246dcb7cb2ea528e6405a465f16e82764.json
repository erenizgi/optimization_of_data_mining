{
    "author": "claudep",
    "message": "Rewrote test_error_messages with helper test utility.",
    "sha": "473c272246dcb7cb2ea528e6405a465f16e82764",
    "files": [
        {
            "sha": "214fa2c4d5243d06dcb171354a737244287a3245",
            "filename": "tests/modeltests/validation/test_error_messages.py",
            "status": "modified",
            "additions": 51,
            "deletions": 104,
            "changes": 155,
            "blob_url": "https://github.com/django/django/blob/473c272246dcb7cb2ea528e6405a465f16e82764/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "raw_url": "https://github.com/django/django/raw/473c272246dcb7cb2ea528e6405a465f16e82764/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Ftest_error_messages.py?ref=473c272246dcb7cb2ea528e6405a465f16e82764",
            "patch": "@@ -5,142 +5,89 @@\n \n class ValidationMessagesTest(TestCase):\n \n+    def _test_validation_messages(self, field, value, expected):\n+        with self.assertRaises(ValidationError) as cm:\n+            field.clean(value, None)\n+        self.assertEqual(cm.exception.messages, expected)\n+\n     def test_autofield_field_raises_error_message(self):\n         f = models.AutoField(primary_key=True)\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [u\"'foo' value must be an integer.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value must be an integer.\"])\n         # primary_key must be True. Refs #12467.\n-        self.assertRaises(AssertionError, models.AutoField, 'primary_key', False)\n-        try:\n+        with self.assertRaisesRegexp(AssertionError,\n+                \"AutoFields must have primary_key=True.\"):\n             models.AutoField(primary_key=False)\n-        except AssertionError as e:\n-            self.assertEqual(str(e), \"AutoFields must have primary_key=True.\")\n \n     def test_integer_field_raises_error_message(self):\n         f = models.IntegerField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [u\"'foo' value must be an integer.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value must be an integer.\"])\n \n     def test_boolean_field_raises_error_message(self):\n         f = models.BooleanField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages,\n-                        [u\"'foo' value must be either True or False.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value must be either True or False.\"])\n \n     def test_float_field_raises_error_message(self):\n         f = models.FloatField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [u\"'foo' value must be a float.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value must be a float.\"])\n \n     def test_decimal_field_raises_error_message(self):\n         f = models.DecimalField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages,\n-                        [u\"'foo' value must be a decimal number.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value must be a decimal number.\"])\n \n     def test_null_boolean_field_raises_error_message(self):\n         f = models.NullBooleanField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages,\n-                        [u\"'foo' value must be either None, True or False.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value must be either None, True or False.\"])\n \n     def test_date_field_raises_error_message(self):\n         f = models.DateField()\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'foo' value has an invalid date format. \"\n-                u\"It must be in YYYY-MM-DD format.\"])\n-\n-        self.assertRaises(ValidationError, f.clean, 'aaaa-10-10', None)\n-        try:\n-            f.clean('aaaa-10-10', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'aaaa-10-10' value has an invalid date format. \"\n-                u\"It must be in YYYY-MM-DD format.\"])\n-\n-        self.assertRaises(ValidationError, f.clean, '2011-13-10', None)\n-        try:\n-            f.clean('2011-13-10', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-13-10' value has the correct format (YYYY-MM-DD) \"\n-                u\"but it is an invalid date.\"])\n-\n-        self.assertRaises(ValidationError, f.clean, '2011-10-32', None)\n-        try:\n-            f.clean('2011-10-32', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-10-32' value has the correct format (YYYY-MM-DD) \"\n-                u\"but it is an invalid date.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value has an invalid date format. \"\n+             u\"It must be in YYYY-MM-DD format.\"])\n+\n+        self._test_validation_messages(f, 'aaaa-10-10',\n+            [u\"'aaaa-10-10' value has an invalid date format. \"\n+             u\"It must be in YYYY-MM-DD format.\"])\n+\n+        self._test_validation_messages(f, '2011-13-10',\n+            [u\"'2011-13-10' value has the correct format (YYYY-MM-DD) \"\n+             u\"but it is an invalid date.\"])\n+\n+        self._test_validation_messages(f, '2011-10-32',\n+            [u\"'2011-10-32' value has the correct format (YYYY-MM-DD) \"\n+             u\"but it is an invalid date.\"])\n \n     def test_datetime_field_raises_error_message(self):\n         f = models.DateTimeField()\n         # Wrong format\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'foo' value has an invalid format. It must be \"\n-                u\"in YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ] format.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value has an invalid format. It must be \"\n+             u\"in YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ] format.\"])\n \n         # Correct format but invalid date\n-        self.assertRaises(ValidationError, f.clean, '2011-10-32', None)\n-        try:\n-            f.clean('2011-10-32', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-10-32' value has the correct format \"\n-                u\"(YYYY-MM-DD) but it is an invalid date.\"])\n+        self._test_validation_messages(f, '2011-10-32',\n+            [u\"'2011-10-32' value has the correct format \"\n+             u\"(YYYY-MM-DD) but it is an invalid date.\"])\n \n         # Correct format but invalid date/time\n-        self.assertRaises(ValidationError, f.clean, '2011-10-32 10:10', None)\n-        try:\n-            f.clean('2011-10-32 10:10', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'2011-10-32 10:10' value has the correct format \"\n-                u\"(YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]) \"\n-                u\"but it is an invalid date/time.\"])\n+        self._test_validation_messages(f, '2011-10-32 10:10',\n+            [u\"'2011-10-32 10:10' value has the correct format \"\n+             u\"(YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]) \"\n+             u\"but it is an invalid date/time.\"])\n \n     def test_time_field_raises_error_message(self):\n         f = models.TimeField()\n         # Wrong format\n-        self.assertRaises(ValidationError, f.clean, 'foo', None)\n-        try:\n-            f.clean('foo', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'foo' value has an invalid format. It must be in \"\n-                u\"HH:MM[:ss[.uuuuuu]] format.\"])\n+        self._test_validation_messages(f, 'foo',\n+            [u\"'foo' value has an invalid format. It must be in \"\n+             u\"HH:MM[:ss[.uuuuuu]] format.\"])\n+\n         # Correct format but invalid time\n-        self.assertRaises(ValidationError, f.clean, '25:50', None)\n-        try:\n-            f.clean('25:50', None)\n-        except ValidationError as e:\n-            self.assertEqual(e.messages, [\n-                u\"'25:50' value has the correct format \"\n-                u\"(HH:MM[:ss[.uuuuuu]]) but it is an invalid time.\"])\n+        self._test_validation_messages(f, '25:50',\n+            [u\"'25:50' value has the correct format \"\n+             u\"(HH:MM[:ss[.uuuuuu]]) but it is an invalid time.\"])"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 51,
        "deletions": 104
    }
}