{
    "author": "aaugustin",
    "message": "Modernized middleware tests.\n\n* Used override_settings consistently -- changes to DEBUG could leak.\n* Took advantage of assertRaisesRegexp.\n* Fixed indentation -- some code was indented at 2 spaces.",
    "sha": "feb41c32468b6a17ac8e0f0b5c9575ffd3f08798",
    "files": [
        {
            "sha": "e3d8350da6fd08764c28c19df980d5f28777d9c9",
            "filename": "tests/regressiontests/middleware/tests.py",
            "status": "modified",
            "additions": 163,
            "deletions": 200,
            "changes": 363,
            "blob_url": "https://github.com/django/django/blob/feb41c32468b6a17ac8e0f0b5c9575ffd3f08798/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/feb41c32468b6a17ac8e0f0b5c9575ffd3f08798/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmiddleware%2Ftests.py?ref=feb41c32468b6a17ac8e0f0b5c9575ffd3f08798",
            "patch": "@@ -20,17 +20,6 @@\n \n \n class CommonMiddlewareTest(TestCase):\n-    def setUp(self):\n-        self.append_slash = settings.APPEND_SLASH\n-        self.prepend_www = settings.PREPEND_WWW\n-        self.ignorable_404_urls = settings.IGNORABLE_404_URLS\n-        self.send_broken_email_links = settings.SEND_BROKEN_LINK_EMAILS\n-\n-    def tearDown(self):\n-        settings.APPEND_SLASH = self.append_slash\n-        settings.PREPEND_WWW = self.prepend_www\n-        settings.IGNORABLE_404_URLS = self.ignorable_404_urls\n-        settings.SEND_BROKEN_LINK_EMAILS = self.send_broken_email_links\n \n     def _get_request(self, path):\n         request = HttpRequest()\n@@ -41,103 +30,92 @@ def _get_request(self, path):\n         request.path = request.path_info = \"/middleware/%s\" % path\n         return request\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_have_slash(self):\n         \"\"\"\n         Tests that URLs with slashes go unmolested.\n         \"\"\"\n-        settings.APPEND_SLASH = True\n         request = self._get_request('slash/')\n         self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_slashless_resource(self):\n         \"\"\"\n         Tests that matches to explicit slashless URLs go unmolested.\n         \"\"\"\n-        settings.APPEND_SLASH = True\n         request = self._get_request('noslash')\n         self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_slashless_unknown(self):\n         \"\"\"\n         Tests that APPEND_SLASH doesn't redirect to unknown resources.\n         \"\"\"\n-        settings.APPEND_SLASH = True\n         request = self._get_request('unknown')\n         self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_redirect(self):\n         \"\"\"\n         Tests that APPEND_SLASH redirects slashless URLs to a valid pattern.\n         \"\"\"\n-        settings.APPEND_SLASH = True\n         request = self._get_request('slash')\n         r = CommonMiddleware().process_request(request)\n         self.assertEqual(r.status_code, 301)\n         self.assertEqual(r['Location'], 'http://testserver/middleware/slash/')\n \n+    @override_settings(APPEND_SLASH=True, DEBUG=True)\n     def test_append_slash_no_redirect_on_POST_in_DEBUG(self):\n         \"\"\"\n         Tests that while in debug mode, an exception is raised with a warning\n         when a failed attempt is made to POST to an URL which would normally be\n         redirected to a slashed version.\n         \"\"\"\n-        settings.APPEND_SLASH = True\n-        settings.DEBUG = True\n         request = self._get_request('slash')\n         request.method = 'POST'\n-        self.assertRaises(\n-            RuntimeError,\n-            CommonMiddleware().process_request,\n-            request)\n-        try:\n+        with six.assertRaisesRegex(self, RuntimeError, 'end in a slash'):\n             CommonMiddleware().process_request(request)\n-        except RuntimeError as e:\n-            self.assertTrue('end in a slash' in str(e))\n-        settings.DEBUG = False\n \n+    @override_settings(APPEND_SLASH=False)\n     def test_append_slash_disabled(self):\n         \"\"\"\n         Tests disabling append slash functionality.\n         \"\"\"\n-        settings.APPEND_SLASH = False\n         request = self._get_request('slash')\n         self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_quoted(self):\n         \"\"\"\n         Tests that URLs which require quoting are redirected to their slash\n         version ok.\n         \"\"\"\n-        settings.APPEND_SLASH = True\n         request = self._get_request('needsquoting#')\n         r = CommonMiddleware().process_request(request)\n         self.assertEqual(r.status_code, 301)\n         self.assertEqual(\n             r['Location'],\n             'http://testserver/middleware/needsquoting%23/')\n \n+    @override_settings(APPEND_SLASH=False, PREPEND_WWW=True)\n     def test_prepend_www(self):\n-        settings.PREPEND_WWW = True\n-        settings.APPEND_SLASH = False\n         request = self._get_request('path/')\n         r = CommonMiddleware().process_request(request)\n         self.assertEqual(r.status_code, 301)\n         self.assertEqual(\n             r['Location'],\n             'http://www.testserver/middleware/path/')\n \n+    @override_settings(APPEND_SLASH=True, PREPEND_WWW=True)\n     def test_prepend_www_append_slash_have_slash(self):\n-        settings.PREPEND_WWW = True\n-        settings.APPEND_SLASH = True\n         request = self._get_request('slash/')\n         r = CommonMiddleware().process_request(request)\n         self.assertEqual(r.status_code, 301)\n         self.assertEqual(r['Location'],\n                           'http://www.testserver/middleware/slash/')\n \n+    @override_settings(APPEND_SLASH=True, PREPEND_WWW=True)\n     def test_prepend_www_append_slash_slashless(self):\n-        settings.PREPEND_WWW = True\n-        settings.APPEND_SLASH = True\n         request = self._get_request('slash')\n         r = CommonMiddleware().process_request(request)\n         self.assertEqual(r.status_code, 301)\n@@ -148,146 +126,135 @@ def test_prepend_www_append_slash_slashless(self):\n     # The following tests examine expected behavior given a custom urlconf that\n     # overrides the default one through the request object.\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_have_slash_custom_urlconf(self):\n-      \"\"\"\n-      Tests that URLs with slashes go unmolested.\n-      \"\"\"\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/slash/')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      self.assertEqual(CommonMiddleware().process_request(request), None)\n+        \"\"\"\n+        Tests that URLs with slashes go unmolested.\n+        \"\"\"\n+        request = self._get_request('customurlconf/slash/')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_slashless_resource_custom_urlconf(self):\n-      \"\"\"\n-      Tests that matches to explicit slashless URLs go unmolested.\n-      \"\"\"\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/noslash')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      self.assertEqual(CommonMiddleware().process_request(request), None)\n+        \"\"\"\n+        Tests that matches to explicit slashless URLs go unmolested.\n+        \"\"\"\n+        request = self._get_request('customurlconf/noslash')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_slashless_unknown_custom_urlconf(self):\n-      \"\"\"\n-      Tests that APPEND_SLASH doesn't redirect to unknown resources.\n-      \"\"\"\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/unknown')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      self.assertEqual(CommonMiddleware().process_request(request), None)\n+        \"\"\"\n+        Tests that APPEND_SLASH doesn't redirect to unknown resources.\n+        \"\"\"\n+        request = self._get_request('customurlconf/unknown')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_redirect_custom_urlconf(self):\n-      \"\"\"\n-      Tests that APPEND_SLASH redirects slashless URLs to a valid pattern.\n-      \"\"\"\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/slash')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      r = CommonMiddleware().process_request(request)\n-      self.assertFalse(r is None,\n-          \"CommonMiddlware failed to return APPEND_SLASH redirect using request.urlconf\")\n-      self.assertEqual(r.status_code, 301)\n-      self.assertEqual(r['Location'], 'http://testserver/middleware/customurlconf/slash/')\n+        \"\"\"\n+        Tests that APPEND_SLASH redirects slashless URLs to a valid pattern.\n+        \"\"\"\n+        request = self._get_request('customurlconf/slash')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        r = CommonMiddleware().process_request(request)\n+        self.assertFalse(r is None,\n+            \"CommonMiddlware failed to return APPEND_SLASH redirect using request.urlconf\")\n+        self.assertEqual(r.status_code, 301)\n+        self.assertEqual(r['Location'], 'http://testserver/middleware/customurlconf/slash/')\n \n+    @override_settings(APPEND_SLASH=True, DEBUG=True)\n     def test_append_slash_no_redirect_on_POST_in_DEBUG_custom_urlconf(self):\n-      \"\"\"\n-      Tests that while in debug mode, an exception is raised with a warning\n-      when a failed attempt is made to POST to an URL which would normally be\n-      redirected to a slashed version.\n-      \"\"\"\n-      settings.APPEND_SLASH = True\n-      settings.DEBUG = True\n-      request = self._get_request('customurlconf/slash')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      request.method = 'POST'\n-      self.assertRaises(\n-          RuntimeError,\n-          CommonMiddleware().process_request,\n-          request)\n-      try:\n-          CommonMiddleware().process_request(request)\n-      except RuntimeError as e:\n-          self.assertTrue('end in a slash' in str(e))\n-      settings.DEBUG = False\n+        \"\"\"\n+        Tests that while in debug mode, an exception is raised with a warning\n+        when a failed attempt is made to POST to an URL which would normally be\n+        redirected to a slashed version.\n+        \"\"\"\n+        request = self._get_request('customurlconf/slash')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        request.method = 'POST'\n+        with six.assertRaisesRegex(self, RuntimeError, 'end in a slash'):\n+            CommonMiddleware().process_request(request)\n \n+    @override_settings(APPEND_SLASH=False)\n     def test_append_slash_disabled_custom_urlconf(self):\n-      \"\"\"\n-      Tests disabling append slash functionality.\n-      \"\"\"\n-      settings.APPEND_SLASH = False\n-      request = self._get_request('customurlconf/slash')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      self.assertEqual(CommonMiddleware().process_request(request), None)\n+        \"\"\"\n+        Tests disabling append slash functionality.\n+        \"\"\"\n+        request = self._get_request('customurlconf/slash')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        self.assertEqual(CommonMiddleware().process_request(request), None)\n \n+    @override_settings(APPEND_SLASH=True)\n     def test_append_slash_quoted_custom_urlconf(self):\n-      \"\"\"\n-      Tests that URLs which require quoting are redirected to their slash\n-      version ok.\n-      \"\"\"\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/needsquoting#')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      r = CommonMiddleware().process_request(request)\n-      self.assertFalse(r is None,\n-          \"CommonMiddlware failed to return APPEND_SLASH redirect using request.urlconf\")\n-      self.assertEqual(r.status_code, 301)\n-      self.assertEqual(\n-          r['Location'],\n-          'http://testserver/middleware/customurlconf/needsquoting%23/')\n+        \"\"\"\n+        Tests that URLs which require quoting are redirected to their slash\n+        version ok.\n+        \"\"\"\n+        request = self._get_request('customurlconf/needsquoting#')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        r = CommonMiddleware().process_request(request)\n+        self.assertFalse(r is None,\n+            \"CommonMiddlware failed to return APPEND_SLASH redirect using request.urlconf\")\n+        self.assertEqual(r.status_code, 301)\n+        self.assertEqual(\n+            r['Location'],\n+            'http://testserver/middleware/customurlconf/needsquoting%23/')\n \n+    @override_settings(APPEND_SLASH=False, PREPEND_WWW=True)\n     def test_prepend_www_custom_urlconf(self):\n-      settings.PREPEND_WWW = True\n-      settings.APPEND_SLASH = False\n-      request = self._get_request('customurlconf/path/')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      r = CommonMiddleware().process_request(request)\n-      self.assertEqual(r.status_code, 301)\n-      self.assertEqual(\n-          r['Location'],\n-          'http://www.testserver/middleware/customurlconf/path/')\n+        request = self._get_request('customurlconf/path/')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        r = CommonMiddleware().process_request(request)\n+        self.assertEqual(r.status_code, 301)\n+        self.assertEqual(\n+            r['Location'],\n+            'http://www.testserver/middleware/customurlconf/path/')\n \n+    @override_settings(APPEND_SLASH=True, PREPEND_WWW=True)\n     def test_prepend_www_append_slash_have_slash_custom_urlconf(self):\n-      settings.PREPEND_WWW = True\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/slash/')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      r = CommonMiddleware().process_request(request)\n-      self.assertEqual(r.status_code, 301)\n-      self.assertEqual(r['Location'],\n-                        'http://www.testserver/middleware/customurlconf/slash/')\n+        request = self._get_request('customurlconf/slash/')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        r = CommonMiddleware().process_request(request)\n+        self.assertEqual(r.status_code, 301)\n+        self.assertEqual(r['Location'],\n+                          'http://www.testserver/middleware/customurlconf/slash/')\n \n+    @override_settings(APPEND_SLASH=True, PREPEND_WWW=True)\n     def test_prepend_www_append_slash_slashless_custom_urlconf(self):\n-      settings.PREPEND_WWW = True\n-      settings.APPEND_SLASH = True\n-      request = self._get_request('customurlconf/slash')\n-      request.urlconf = 'regressiontests.middleware.extra_urls'\n-      r = CommonMiddleware().process_request(request)\n-      self.assertEqual(r.status_code, 301)\n-      self.assertEqual(r['Location'],\n-                        'http://www.testserver/middleware/customurlconf/slash/')\n+        request = self._get_request('customurlconf/slash')\n+        request.urlconf = 'regressiontests.middleware.extra_urls'\n+        r = CommonMiddleware().process_request(request)\n+        self.assertEqual(r.status_code, 301)\n+        self.assertEqual(r['Location'],\n+                          'http://www.testserver/middleware/customurlconf/slash/')\n \n     # Tests for the 404 error reporting via email\n \n+    @override_settings(IGNORABLE_404_URLS=(re.compile(r'foo'),),\n+                       SEND_BROKEN_LINK_EMAILS = True)\n     def test_404_error_reporting(self):\n-        settings.IGNORABLE_404_URLS = (re.compile(r'foo'),)\n-        settings.SEND_BROKEN_LINK_EMAILS = True\n         request = self._get_request('regular_url/that/does/not/exist')\n         request.META['HTTP_REFERER'] = '/another/url/'\n         response = self.client.get(request.path)\n         CommonMiddleware().process_response(request, response)\n         self.assertEqual(len(mail.outbox), 1)\n         self.assertIn('Broken', mail.outbox[0].subject)\n \n+    @override_settings(IGNORABLE_404_URLS=(re.compile(r'foo'),),\n+                       SEND_BROKEN_LINK_EMAILS = True)\n     def test_404_error_reporting_no_referer(self):\n-        settings.IGNORABLE_404_URLS = (re.compile(r'foo'),)\n-        settings.SEND_BROKEN_LINK_EMAILS = True\n         request = self._get_request('regular_url/that/does/not/exist')\n         response = self.client.get(request.path)\n         CommonMiddleware().process_response(request, response)\n         self.assertEqual(len(mail.outbox), 0)\n \n+    @override_settings(IGNORABLE_404_URLS=(re.compile(r'foo'),),\n+                       SEND_BROKEN_LINK_EMAILS = True)\n     def test_404_error_reporting_ignored_url(self):\n-        settings.IGNORABLE_404_URLS = (re.compile(r'foo'),)\n-        settings.SEND_BROKEN_LINK_EMAILS = True\n         request = self._get_request('foo_url/that/does/not/exist/either')\n         request.META['HTTP_REFERER'] = '/another/url/'\n         response = self.client.get(request.path)\n@@ -424,89 +391,85 @@ class XFrameOptionsMiddlewareTest(TestCase):\n     \"\"\"\n     Tests for the X-Frame-Options clickjacking prevention middleware.\n     \"\"\"\n-    def setUp(self):\n-        self.x_frame_options = settings.X_FRAME_OPTIONS\n-\n-    def tearDown(self):\n-        settings.X_FRAME_OPTIONS = self.x_frame_options\n \n     def test_same_origin(self):\n         \"\"\"\n         Tests that the X_FRAME_OPTIONS setting can be set to SAMEORIGIN to\n         have the middleware use that value for the HTTP header.\n         \"\"\"\n-        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+        with override_settings(X_FRAME_OPTIONS='SAMEORIGIN'):\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           HttpResponse())\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n \n-        settings.X_FRAME_OPTIONS = 'sameorigin'\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+        with override_settings(X_FRAME_OPTIONS='sameorigin'):\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n                                                        HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n \n     def test_deny(self):\n         \"\"\"\n         Tests that the X_FRAME_OPTIONS setting can be set to DENY to\n         have the middleware use that value for the HTTP header.\n         \"\"\"\n-        settings.X_FRAME_OPTIONS = 'DENY'\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+        with override_settings(X_FRAME_OPTIONS='DENY'):\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           HttpResponse())\n+            self.assertEqual(r['X-Frame-Options'], 'DENY')\n \n-        settings.X_FRAME_OPTIONS = 'deny'\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+        with override_settings(X_FRAME_OPTIONS='deny'):\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           HttpResponse())\n+            self.assertEqual(r['X-Frame-Options'], 'DENY')\n \n     def test_defaults_sameorigin(self):\n         \"\"\"\n         Tests that if the X_FRAME_OPTIONS setting is not set then it defaults\n         to SAMEORIGIN.\n         \"\"\"\n-        del settings.X_FRAME_OPTIONS\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+        with override_settings(X_FRAME_OPTIONS=None):\n+            del settings.X_FRAME_OPTIONS    # restored by override_settings\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           HttpResponse())\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n \n     def test_dont_set_if_set(self):\n         \"\"\"\n         Tests that if the X-Frame-Options header is already set then the\n         middleware does not attempt to override it.\n         \"\"\"\n-        settings.X_FRAME_OPTIONS = 'DENY'\n-        response = HttpResponse()\n-        response['X-Frame-Options'] = 'SAMEORIGIN'\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       response)\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+        with override_settings(X_FRAME_OPTIONS='DENY'):\n+            response = HttpResponse()\n+            response['X-Frame-Options'] = 'SAMEORIGIN'\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           response)\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n \n-        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n-        response = HttpResponse()\n-        response['X-Frame-Options'] = 'DENY'\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       response)\n-        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+        with override_settings(X_FRAME_OPTIONS='SAMEORIGIN'):\n+            response = HttpResponse()\n+            response['X-Frame-Options'] = 'DENY'\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           response)\n+            self.assertEqual(r['X-Frame-Options'], 'DENY')\n \n     def test_response_exempt(self):\n         \"\"\"\n         Tests that if the response has a xframe_options_exempt attribute set\n         to False then it still sets the header, but if it's set to True then\n         it does not.\n         \"\"\"\n-        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n-        response = HttpResponse()\n-        response.xframe_options_exempt = False\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       response)\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+        with override_settings(X_FRAME_OPTIONS='SAMEORIGIN'):\n+            response = HttpResponse()\n+            response.xframe_options_exempt = False\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           response)\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n \n-        response = HttpResponse()\n-        response.xframe_options_exempt = True\n-        r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       response)\n-        self.assertEqual(r.get('X-Frame-Options', None), None)\n+            response = HttpResponse()\n+            response.xframe_options_exempt = True\n+            r = XFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                           response)\n+            self.assertEqual(r.get('X-Frame-Options', None), None)\n \n     def test_is_extendable(self):\n         \"\"\"\n@@ -523,23 +486,23 @@ def get_xframe_options_value(self, request, response):\n                     return 'SAMEORIGIN'\n                 return 'DENY'\n \n-        settings.X_FRAME_OPTIONS = 'DENY'\n-        response = HttpResponse()\n-        response.sameorigin = True\n-        r = OtherXFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                            response)\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n-\n-        request = HttpRequest()\n-        request.sameorigin = True\n-        r = OtherXFrameOptionsMiddleware().process_response(request,\n-                                                            HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n-\n-        settings.X_FRAME_OPTIONS = 'SAMEORIGIN'\n-        r = OtherXFrameOptionsMiddleware().process_response(HttpRequest(),\n-                                                       HttpResponse())\n-        self.assertEqual(r['X-Frame-Options'], 'DENY')\n+        with override_settings(X_FRAME_OPTIONS='DENY'):\n+            response = HttpResponse()\n+            response.sameorigin = True\n+            r = OtherXFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                                response)\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+            request = HttpRequest()\n+            request.sameorigin = True\n+            r = OtherXFrameOptionsMiddleware().process_response(request,\n+                                                                HttpResponse())\n+            self.assertEqual(r['X-Frame-Options'], 'SAMEORIGIN')\n+\n+        with override_settings(X_FRAME_OPTIONS='SAMEORIGIN'):\n+            r = OtherXFrameOptionsMiddleware().process_response(HttpRequest(),\n+                                                                HttpResponse())\n+            self.assertEqual(r['X-Frame-Options'], 'DENY')\n \n \n class GZipMiddlewareTest(TestCase):"
        }
    ],
    "stats": {
        "total": 363,
        "additions": 163,
        "deletions": 200
    }
}