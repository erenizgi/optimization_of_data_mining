{
    "author": "freakboy3742",
    "message": "Fixed #15253, #15259 -- Added 1.1.4 release notes, added a section on CSRF changes to the 1.3 release notes, and corrected the example in the 1.2.5 release notes. Thanks to Gary Wilson and Mark Hellewell for the reports.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15482 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f913fab6be3bb4af48092d29c02e9bd5377261d4",
    "files": [
        {
            "sha": "dbe91fb3e45e2c137cce0ee6eac683c10500a9df",
            "filename": "docs/releases/1.1.4.txt",
            "status": "added",
            "additions": 78,
            "deletions": 0,
            "changes": 78,
            "blob_url": "https://github.com/django/django/blob/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2F1.1.4.txt",
            "raw_url": "https://github.com/django/django/raw/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2F1.1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.1.4.txt?ref=f913fab6be3bb4af48092d29c02e9bd5377261d4",
            "patch": "@@ -0,0 +1,78 @@\n+==========================\n+Django 1.1.4 release notes\n+==========================\n+\n+Welcome to Django 1.1.4!\n+\n+This is the fourth \"bugfix\" release in the Django 1.1 series,\n+improving the stability and performance of the Django 1.1 codebase.\n+\n+With one exception, Django 1.1.4 maintains backwards compatibility\n+with Django 1.1.3, but contain a number of fixes and other\n+improvements. Django 1.1.4 is a recommended upgrade for any\n+development or deployment currently using or targeting Django 1.1.\n+\n+For full details on the new features, backwards incompatibilities, and\n+deprecated features in the 1.1 branch, see the :doc:`/releases/1.1`.\n+\n+Backwards-incompatible changes in 1.1.4\n+=======================================\n+\n+CSRF exception for AJAX requests\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django includes a CSRF-protection mechanism, which makes use of a\n+token inserted into outgoing forms. Middleware then checks for the\n+token's presence on form submission, and validates it.\n+\n+Prior to Django 1.2.5, our CSRF protection made an exception for AJAX\n+requests, on the following basis:\n+\n+    * Many AJAX toolkits add an X-Requested-With header when using\n+      XMLHttpRequest.\n+\n+    * Browsers have strict same-origin policies regarding\n+      XMLHttpRequest.\n+\n+    * In the context of a browser, the only way that a custom header\n+      of this nature can be added is with XMLHttpRequest.\n+\n+Therefore, for ease of use, we did not apply CSRF checks to requests\n+that appeared to be AJAX on the basis of the X-Requested-With header.\n+The Ruby on Rails web framework had a similar exemption.\n+\n+Recently, engineers at Google made members of the Ruby on Rails\n+development team aware of a combination of browser plugins and\n+redirects which can allow an attacker to provide custom HTTP headers\n+on a request to any website. This can allow a forged request to appear\n+to be an AJAX request, thereby defeating CSRF protection which trusts\n+the same-origin nature of AJAX requests.\n+\n+Michael Koziarski of the Rails team brought this to our attention, and\n+we were able to produce a proof-of-concept demonstrating the same\n+vulnerability in Django's CSRF handling.\n+\n+To remedy this, Django will now apply full CSRF validation to all\n+requests, regardless of apparent AJAX origin. This is technically\n+backwards-incompatible, but the security risks have been judged to\n+outweigh the compatibility concerns in this case.\n+\n+Additionally, Django will now accept the CSRF token in the custom HTTP\n+header X-CSRFTOKEN, as well as in the form submission itself, for ease\n+of use with popular JavaScript toolkits which allow insertion of\n+custom headers into all AJAX requests.\n+\n+The following example using the jQuery JavaScript toolkit demonstrates\n+this; the call to jQuery's ajaxSetup will cause all AJAX requests to\n+send back the CSRF token in the custom X-CSRFTOKEN header::\n+\n+    $.ajaxSetup({\n+        beforeSend: function(xhr, settings) {\n+            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n+                // Only send the token to relative URLs i.e. locally.\n+                xhr.setRequestHeader(\"X-CSRFToken\",\n+                                     $(\"#csrfmiddlewaretoken\").val());\n+            }\n+        }\n+    });\n+"
        },
        {
            "sha": "68c301a9453f2b92d1f7bbbff69b2bb4339e86e4",
            "filename": "docs/releases/1.2.5.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 7,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2F1.2.5.txt",
            "raw_url": "https://github.com/django/django/raw/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2F1.2.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.2.5.txt?ref=f913fab6be3bb4af48092d29c02e9bd5377261d4",
            "patch": "@@ -7,7 +7,7 @@ Welcome to Django 1.2.5!\n This is the fifth \"bugfix\" release in the Django 1.2 series,\n improving the stability and performance of the Django 1.2 codebase.\n \n-With three exceptions, Django 1.2.5 maintains backwards compatibility\n+With four exceptions, Django 1.2.5 maintains backwards compatibility\n with Django 1.2.4, but contain a number of fixes and other\n improvements. Django 1.2.5 is a recommended upgrade for any\n development or deployment currently using or targeting Django 1.2.\n@@ -67,14 +67,28 @@ this; the call to jQuery's ajaxSetup will cause all AJAX requests to\n send back the CSRF token in the custom X-CSRFTOKEN header::\n \n     $.ajaxSetup({\n-            beforeSend: function(xhr, settings) {\n-                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n-                    // Only send the token to relative URLs i.e. locally.\n-                    xhr.setRequestHeader(\"X-CSRFToken\",\n-                                         $(\"#csrfmiddlewaretoken\").val());\n+        beforeSend: function(xhr, settings) {\n+            function getCookie(name) {\n+                var cookieValue = null;\n+                if (document.cookie && document.cookie != '') {\n+                    var cookies = document.cookie.split(';');\n+                    for (var i = 0; i < cookies.length; i++) {\n+                        var cookie = jQuery.trim(cookies[i]);\n+                        // Does this cookie string begin with the name we want?\n+                        if (cookie.substring(0, name.length + 1) == (name + '=')) {\n+                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n+                            break;\n+                        }\n+                    }\n                 }\n+                return cookieValue;\n             }\n-        });\n+            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n+                // Only send the token to relative URLs i.e. locally.\n+                xhr.setRequestHeader(\"X-CSRFToken\", getCookie('csrftoken'));\n+            }\n+        }\n+    });\n \n \n FileField no longer deletes files"
        },
        {
            "sha": "5b33a3c88e491c888f0b5a8bf8176d7fa06080de",
            "filename": "docs/releases/1.3.txt",
            "status": "modified",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2F1.3.txt",
            "raw_url": "https://github.com/django/django/raw/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2F1.3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3.txt?ref=f913fab6be3bb4af48092d29c02e9bd5377261d4",
            "patch": "@@ -261,6 +261,80 @@ requests. These include:\n Backwards-incompatible changes in 1.3\n =====================================\n \n+CSRF exception for AJAX requests\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django includes a CSRF-protection mechanism, which makes use of a\n+token inserted into outgoing forms. Middleware then checks for the\n+token's presence on form submission, and validates it.\n+\n+Prior to Django 1.2.5, our CSRF protection made an exception for AJAX\n+requests, on the following basis:\n+\n+    * Many AJAX toolkits add an X-Requested-With header when using\n+      XMLHttpRequest.\n+\n+    * Browsers have strict same-origin policies regarding\n+      XMLHttpRequest.\n+\n+    * In the context of a browser, the only way that a custom header\n+      of this nature can be added is with XMLHttpRequest.\n+\n+Therefore, for ease of use, we did not apply CSRF checks to requests\n+that appeared to be AJAX on the basis of the X-Requested-With header.\n+The Ruby on Rails web framework had a similar exemption.\n+\n+Recently, engineers at Google made members of the Ruby on Rails\n+development team aware of a combination of browser plugins and\n+redirects which can allow an attacker to provide custom HTTP headers\n+on a request to any website. This can allow a forged request to appear\n+to be an AJAX request, thereby defeating CSRF protection which trusts\n+the same-origin nature of AJAX requests.\n+\n+Michael Koziarski of the Rails team brought this to our attention, and\n+we were able to produce a proof-of-concept demonstrating the same\n+vulnerability in Django's CSRF handling.\n+\n+To remedy this, Django will now apply full CSRF validation to all\n+requests, regardless of apparent AJAX origin. This is technically\n+backwards-incompatible, but the security risks have been judged to\n+outweigh the compatibility concerns in this case.\n+\n+Additionally, Django will now accept the CSRF token in the custom HTTP\n+header X-CSRFTOKEN, as well as in the form submission itself, for ease\n+of use with popular JavaScript toolkits which allow insertion of\n+custom headers into all AJAX requests.\n+\n+The following example using the jQuery JavaScript toolkit demonstrates\n+this; the call to jQuery's ajaxSetup will cause all AJAX requests to\n+send back the CSRF token in the custom X-CSRFTOKEN header::\n+\n+    $.ajaxSetup({\n+        beforeSend: function(xhr, settings) {\n+            function getCookie(name) {\n+                var cookieValue = null;\n+                if (document.cookie && document.cookie != '') {\n+                    var cookies = document.cookie.split(';');\n+                    for (var i = 0; i < cookies.length; i++) {\n+                        var cookie = jQuery.trim(cookies[i]);\n+                        // Does this cookie string begin with the name we want?\n+                        if (cookie.substring(0, name.length + 1) == (name + '=')) {\n+                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n+                            break;\n+                        }\n+                    }\n+                }\n+                return cookieValue;\n+            }\n+            if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {\n+                // Only send the token to relative URLs i.e. locally.\n+                xhr.setRequestHeader(\"X-CSRFToken\", getCookie('csrftoken'));\n+            }\n+        }\n+    });\n+\n+\n+\n FileField no longer deletes files\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "b687e44dcac7270e2cf86c92f59ed0283b7fae00",
            "filename": "docs/releases/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/f913fab6be3bb4af48092d29c02e9bd5377261d4/docs%2Freleases%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2Findex.txt?ref=f913fab6be3bb4af48092d29c02e9bd5377261d4",
            "patch": "@@ -36,6 +36,7 @@ Final releases\n .. toctree::\n    :maxdepth: 1\n \n+   1.1.4\n    1.1.2\n    1.1\n "
        }
    ],
    "stats": {
        "total": 181,
        "additions": 174,
        "deletions": 7
    }
}