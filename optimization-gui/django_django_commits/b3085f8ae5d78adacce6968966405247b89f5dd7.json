{
    "author": "freakboy3742",
    "message": "Fixed #15167 -- Ensure that non-form errors are always part of an ErrorList. Thanks to Harm Geerts for the report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15424 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b3085f8ae5d78adacce6968966405247b89f5dd7",
    "files": [
        {
            "sha": "2a3f8bdff23c915b78fdc0b3a1460a8c78f4163f",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b3085f8ae5d78adacce6968966405247b89f5dd7/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b3085f8ae5d78adacce6968966405247b89f5dd7/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=b3085f8ae5d78adacce6968966405247b89f5dd7",
            "patch": "@@ -511,7 +511,7 @@ def validate_unique(self):\n                         # poke error messages into the right places and mark\n                         # the form as invalid\n                         errors.append(self.get_unique_error_message(unique_check))\n-                        form._errors[NON_FIELD_ERRORS] = self.get_form_error()\n+                        form._errors[NON_FIELD_ERRORS] = self.error_class([self.get_form_error()])\n                         del form.cleaned_data\n                         break\n                     # mark the data as seen\n@@ -542,7 +542,7 @@ def validate_unique(self):\n                         # poke error messages into the right places and mark\n                         # the form as invalid\n                         errors.append(self.get_date_error_message(date_check))\n-                        form._errors[NON_FIELD_ERRORS] = self.get_form_error()\n+                        form._errors[NON_FIELD_ERRORS] = self.error_class([self.get_form_error()])\n                         del form.cleaned_data\n                         break\n                     seen_data.add(data)"
        },
        {
            "sha": "3354fc5b7fa21de20e3983197e6f2563920dd9ba",
            "filename": "tests/regressiontests/model_formsets_regress/tests.py",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/b3085f8ae5d78adacce6968966405247b89f5dd7/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b3085f8ae5d78adacce6968966405247b89f5dd7/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py?ref=b3085f8ae5d78adacce6968966405247b89f5dd7",
            "patch": "@@ -1,4 +1,5 @@\n from django import forms\n+from django.forms.util import ErrorDict, ErrorList\n from django.forms.models import modelform_factory, inlineformset_factory, modelformset_factory\n from django.test import TestCase\n \n@@ -200,6 +201,31 @@ def test_save_as_new_with_new_inlines(self):\n             [\"<Host: matrix.de.eu.dal.net>\", \"<Host: tranquility.hub.dal.net>\"]\n             )\n \n+class FormsetTests(TestCase):\n+    def test_error_class(self):\n+        '''\n+        Test the type of Formset and Form error attributes\n+        '''\n+        Formset = modelformset_factory(User)\n+        data = {\n+            'form-TOTAL_FORMS': u'2',\n+            'form-INITIAL_FORMS': u'0',\n+            'form-MAX_NUM_FORMS': u'0',\n+            'form-0-id': '',\n+            'form-0-username': u'apollo13',\n+            'form-0-serial': u'1',\n+            'form-1-id': '',\n+            'form-1-username': u'apollo13',\n+            'form-1-serial': u'2',\n+        }\n+        formset = Formset(data)\n+        # check if the returned error classes are correct\n+        # note: formset.errors returns a list as documented\n+        self.assertTrue(isinstance(formset.errors, list))\n+        self.assertTrue(isinstance(formset.non_form_errors(), ErrorList))\n+        for form in formset.forms:\n+            self.assertTrue(isinstance(form.errors, ErrorDict))\n+            self.assertTrue(isinstance(form.non_field_errors(), ErrorList))\n \n class CustomWidget(forms.CharField):\n     pass"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 28,
        "deletions": 2
    }
}