{
    "author": "jphalip",
    "message": "Slightly improved the help text for the \"Password\" field in the `auth.User` admin form, and PEP8-cleaned up the area while I was there.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17326 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "991d3d6c12296b381959ae86e74fd505604daeac",
    "files": [
        {
            "sha": "badd7602f6bb27e38695fd532b283ac50c68b9b2",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 58,
            "deletions": 30,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/991d3d6c12296b381959ae86e74fd505604daeac/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/991d3d6c12296b381959ae86e74fd505604daeac/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=991d3d6c12296b381959ae86e74fd505604daeac",
            "patch": "@@ -51,17 +51,24 @@ def __init__(self, *args, **kwargs):\n \n class UserCreationForm(forms.ModelForm):\n     \"\"\"\n-    A form that creates a user, with no privileges, from the given username and password.\n+    A form that creates a user, with no privileges, from the given username and\n+    password.\n     \"\"\"\n     error_messages = {\n         'duplicate_username': _(\"A user with that username already exists.\"),\n         'password_mismatch': _(\"The two password fields didn't match.\"),\n     }\n-    username = forms.RegexField(label=_(\"Username\"), max_length=30, regex=r'^[\\w.@+-]+$',\n-        help_text = _(\"Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.\"),\n-        error_messages = {'invalid': _(\"This value may contain only letters, numbers and @/./+/-/_ characters.\")})\n-    password1 = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n-    password2 = forms.CharField(label=_(\"Password confirmation\"), widget=forms.PasswordInput,\n+    username = forms.RegexField(label=_(\"Username\"), max_length=30,\n+        regex=r'^[\\w.@+-]+$',\n+        help_text = _(\"Required. 30 characters or fewer. Letters, digits and \"\n+                      \"@/./+/-/_ only.\"),\n+        error_messages = {\n+            'invalid': _(\"This value may contain only letters, numbers and \"\n+                         \"@/./+/-/_ characters.\")})\n+    password1 = forms.CharField(label=_(\"Password\"),\n+        widget=forms.PasswordInput)\n+    password2 = forms.CharField(label=_(\"Password confirmation\"),\n+        widget=forms.PasswordInput,\n         help_text = _(\"Enter the same password as above, for verification.\"))\n \n     class Meta:\n@@ -82,7 +89,8 @@ def clean_password2(self):\n         password1 = self.cleaned_data.get(\"password1\", \"\")\n         password2 = self.cleaned_data[\"password2\"]\n         if password1 != password2:\n-            raise forms.ValidationError(self.error_messages['password_mismatch'])\n+            raise forms.ValidationError(\n+                self.error_messages['password_mismatch'])\n         return password2\n \n     def save(self, commit=True):\n@@ -94,10 +102,17 @@ def save(self, commit=True):\n \n \n class UserChangeForm(forms.ModelForm):\n-    username = forms.RegexField(label=_(\"Username\"), max_length=30, regex=r'^[\\w.@+-]+$',\n-        help_text = _(\"Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.\"),\n-        error_messages = {'invalid': _(\"This value may contain only letters, numbers and @/./+/-/_ characters.\")})\n-    password = ReadOnlyPasswordHashField(label=_(\"Password\"), help_text=_(\"We don't store raw passwords, so there's no way to see this user's password, but you can change the password using <a href=\\\"password/\\\">this form</a>.\"))\n+    username = forms.RegexField(\n+        label=_(\"Username\"), max_length=30, regex=r\"^[\\w.@+-]+$\",\n+        help_text = _(\"Required. 30 characters or fewer. Letters, digits and \"\n+                      \"@/./+/-/_ only.\"),\n+        error_messages = {\n+            'invalid': _(\"This value may contain only letters, numbers and \"\n+                         \"@/./+/-/_ characters.\")})\n+    password = ReadOnlyPasswordHashField(label=_(\"Password\"),\n+        help_text=_(\"Raw passwords are not stored, so there is no way to see \"\n+                    \"this user's password, but you can change the password \"\n+                    \"using <a href=\\\"password/\\\">this form</a>.\"))\n \n     def clean_password(self):\n         return self.initial[\"password\"]\n@@ -144,9 +159,11 @@ def clean(self):\n         password = self.cleaned_data.get('password')\n \n         if username and password:\n-            self.user_cache = authenticate(username=username, password=password)\n+            self.user_cache = authenticate(username=username,\n+                                           password=password)\n             if self.user_cache is None:\n-                raise forms.ValidationError(self.error_messages['invalid_login'])\n+                raise forms.ValidationError(\n+                    self.error_messages['invalid_login'])\n             elif not self.user_cache.is_active:\n                 raise forms.ValidationError(self.error_messages['inactive'])\n         self.check_for_test_cookie()\n@@ -179,12 +196,12 @@ def clean_email(self):\n         Validates that an active user exists with the given email address.\n         \"\"\"\n         email = self.cleaned_data[\"email\"]\n-        self.users_cache = User.objects.filter(\n-                                email__iexact=email,\n-                                is_active=True)\n+        self.users_cache = User.objects.filter(email__iexact=email,\n+                                               is_active=True)\n         if not len(self.users_cache):\n             raise forms.ValidationError(self.error_messages['unknown'])\n-        if any((user.password == UNUSABLE_PASSWORD) for user in self.users_cache):\n+        if any((user.password == UNUSABLE_PASSWORD)\n+               for user in self.users_cache):\n             raise forms.ValidationError(self.error_messages['unusable'])\n         return email\n \n@@ -194,7 +211,8 @@ def save(self, domain_override=None,\n              use_https=False, token_generator=default_token_generator,\n              from_email=None, request=None):\n         \"\"\"\n-        Generates a one-use only link for resetting password and sends to the user\n+        Generates a one-use only link for resetting password and sends to the\n+        user.\n         \"\"\"\n         from django.core.mail import send_mail\n         for user in self.users_cache:\n@@ -222,14 +240,16 @@ def save(self, domain_override=None,\n \n class SetPasswordForm(forms.Form):\n     \"\"\"\n-    A form that lets a user change set his/her password without\n-    entering the old password\n+    A form that lets a user change set his/her password without entering the\n+    old password\n     \"\"\"\n     error_messages = {\n         'password_mismatch': _(\"The two password fields didn't match.\"),\n     }\n-    new_password1 = forms.CharField(label=_(\"New password\"), widget=forms.PasswordInput)\n-    new_password2 = forms.CharField(label=_(\"New password confirmation\"), widget=forms.PasswordInput)\n+    new_password1 = forms.CharField(label=_(\"New password\"),\n+                                    widget=forms.PasswordInput)\n+    new_password2 = forms.CharField(label=_(\"New password confirmation\"),\n+                                    widget=forms.PasswordInput)\n \n     def __init__(self, user, *args, **kwargs):\n         self.user = user\n@@ -240,7 +260,8 @@ def clean_new_password2(self):\n         password2 = self.cleaned_data.get('new_password2')\n         if password1 and password2:\n             if password1 != password2:\n-                raise forms.ValidationError(self.error_messages['password_mismatch'])\n+                raise forms.ValidationError(\n+                    self.error_messages['password_mismatch'])\n         return password2\n \n     def save(self, commit=True):\n@@ -256,19 +277,23 @@ class PasswordChangeForm(SetPasswordForm):\n     their old password.\n     \"\"\"\n     error_messages = dict(SetPasswordForm.error_messages, **{\n-        'password_incorrect': _(\"Your old password was entered incorrectly. Please enter it again.\"),\n+        'password_incorrect': _(\"Your old password was entered incorrectly. \"\n+                                \"Please enter it again.\"),\n     })\n-    old_password = forms.CharField(label=_(\"Old password\"), widget=forms.PasswordInput)\n+    old_password = forms.CharField(label=_(\"Old password\"),\n+                                   widget=forms.PasswordInput)\n \n     def clean_old_password(self):\n         \"\"\"\n         Validates that the old_password field is correct.\n         \"\"\"\n         old_password = self.cleaned_data[\"old_password\"]\n         if not self.user.check_password(old_password):\n-            raise forms.ValidationError(self.error_messages['password_incorrect'])\n+            raise forms.ValidationError(\n+                self.error_messages['password_incorrect'])\n         return old_password\n-PasswordChangeForm.base_fields.keyOrder = ['old_password', 'new_password1', 'new_password2']\n+PasswordChangeForm.base_fields.keyOrder = ['old_password', 'new_password1',\n+                                           'new_password2']\n \n \n class AdminPasswordChangeForm(forms.Form):\n@@ -278,8 +303,10 @@ class AdminPasswordChangeForm(forms.Form):\n     error_messages = {\n         'password_mismatch': _(\"The two password fields didn't match.\"),\n     }\n-    password1 = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n-    password2 = forms.CharField(label=_(\"Password (again)\"), widget=forms.PasswordInput)\n+    password1 = forms.CharField(label=_(\"Password\"),\n+                                widget=forms.PasswordInput)\n+    password2 = forms.CharField(label=_(\"Password (again)\"),\n+                                widget=forms.PasswordInput)\n \n     def __init__(self, user, *args, **kwargs):\n         self.user = user\n@@ -290,7 +317,8 @@ def clean_password2(self):\n         password2 = self.cleaned_data.get('password2')\n         if password1 and password2:\n             if password1 != password2:\n-                raise forms.ValidationError(self.error_messages['password_mismatch'])\n+                raise forms.ValidationError(\n+                    self.error_messages['password_mismatch'])\n         return password2\n \n     def save(self, commit=True):"
        }
    ],
    "stats": {
        "total": 88,
        "additions": 58,
        "deletions": 30
    }
}