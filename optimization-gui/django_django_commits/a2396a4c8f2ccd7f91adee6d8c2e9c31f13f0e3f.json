{
    "author": "akaariai",
    "message": "Fixed #19173 -- Made EmptyQuerySet a marker class only\n\nThe guarantee that no queries will be made when accessing results is\ndone by new EmptyWhere class which is used for query.where and having.\n\nThanks to Simon Charette for reviewing and valuable suggestions.",
    "sha": "a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
    "files": [
        {
            "sha": "1b638336880c56d17e6944b52236fc6fcd018a5f",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -473,8 +473,8 @@ class AnonymousUser(object):\n     is_staff = False\n     is_active = False\n     is_superuser = False\n-    _groups = EmptyManager()\n-    _user_permissions = EmptyManager()\n+    _groups = EmptyManager(Group)\n+    _user_permissions = EmptyManager(Permission)\n \n     def __init__(self):\n         pass"
        },
        {
            "sha": "da6523c89ad2e194f6f1667e4ae29c4bc0f4795d",
            "filename": "django/db/models/manager.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fmanager.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fmanager.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fmanager.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -1,6 +1,6 @@\n import copy\n from django.db import router\n-from django.db.models.query import QuerySet, EmptyQuerySet, insert_query, RawQuerySet\n+from django.db.models.query import QuerySet, insert_query, RawQuerySet\n from django.db.models import signals\n from django.db.models.fields import FieldDoesNotExist\n \n@@ -113,7 +113,7 @@ def db(self):\n     #######################\n \n     def get_empty_query_set(self):\n-        return EmptyQuerySet(self.model, using=self._db)\n+        return QuerySet(self.model, using=self._db).none()\n \n     def get_query_set(self):\n         \"\"\"Returns a new QuerySet object.  Subclasses can override this method\n@@ -258,5 +258,9 @@ def __get__(self, instance, type=None):\n \n \n class EmptyManager(Manager):\n+    def __init__(self, model):\n+        super(EmptyManager, self).__init__()\n+        self.model = model\n+\n     def get_query_set(self):\n         return self.get_empty_query_set()"
        },
        {
            "sha": "edc8cc9776e6486ab340cf8ef554d9db34d6070c",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 22,
            "deletions": 137,
            "changes": 159,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -35,7 +35,6 @@ class QuerySet(object):\n     \"\"\"\n     def __init__(self, model=None, query=None, using=None):\n         self.model = model\n-        # EmptyQuerySet instantiates QuerySet with model as None\n         self._db = using\n         self.query = query or sql.Query(self.model)\n         self._result_cache = None\n@@ -217,17 +216,21 @@ def __getitem__(self, k):\n     def __and__(self, other):\n         self._merge_sanity_check(other)\n         if isinstance(other, EmptyQuerySet):\n-            return other._clone()\n+            return other\n+        if isinstance(self, EmptyQuerySet):\n+            return self\n         combined = self._clone()\n         combined._merge_known_related_objects(other)\n         combined.query.combine(other.query, sql.AND)\n         return combined\n \n     def __or__(self, other):\n         self._merge_sanity_check(other)\n-        combined = self._clone()\n+        if isinstance(self, EmptyQuerySet):\n+            return other\n         if isinstance(other, EmptyQuerySet):\n-            return combined\n+            return self\n+        combined = self._clone()\n         combined._merge_known_related_objects(other)\n         combined.query.combine(other.query, sql.OR)\n         return combined\n@@ -632,7 +635,9 @@ def none(self):\n         \"\"\"\n         Returns an empty QuerySet.\n         \"\"\"\n-        return self._clone(klass=EmptyQuerySet)\n+        clone = self._clone()\n+        clone.query.set_empty()\n+        return clone\n \n     ##################################################################\n     # PUBLIC METHODS THAT ALTER ATTRIBUTES AND RETURN A NEW QUERYSET #\n@@ -981,6 +986,18 @@ def _as_sql(self, connection):\n     # empty\" result.\n     value_annotation = True\n \n+class InstanceCheckMeta(type):\n+    def __instancecheck__(self, instance):\n+        return instance.query.is_empty()\n+\n+class EmptyQuerySet(six.with_metaclass(InstanceCheckMeta), object):\n+    \"\"\"\n+    Marker class usable for checking if a queryset is empty by .none():\n+        isinstance(qs.none(), EmptyQuerySet) -> True\n+    \"\"\"\n+\n+    def __init__(self, *args, **kwargs):\n+        raise TypeError(\"EmptyQuerySet can't be instantiated\")\n \n class ValuesQuerySet(QuerySet):\n     def __init__(self, *args, **kwargs):\n@@ -1180,138 +1197,6 @@ def _clone(self, klass=None, setup=False, **kwargs):\n         return c\n \n \n-class EmptyQuerySet(QuerySet):\n-    def __init__(self, model=None, query=None, using=None):\n-        super(EmptyQuerySet, self).__init__(model, query, using)\n-        self._result_cache = []\n-\n-    def __and__(self, other):\n-        return self._clone()\n-\n-    def __or__(self, other):\n-        return other._clone()\n-\n-    def count(self):\n-        return 0\n-\n-    def delete(self):\n-        pass\n-\n-    def _clone(self, klass=None, setup=False, **kwargs):\n-        c = super(EmptyQuerySet, self)._clone(klass, setup=setup, **kwargs)\n-        c._result_cache = []\n-        return c\n-\n-    def iterator(self):\n-        # This slightly odd construction is because we need an empty generator\n-        # (it raises StopIteration immediately).\n-        yield next(iter([]))\n-\n-    def all(self):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def filter(self, *args, **kwargs):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def exclude(self, *args, **kwargs):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def complex_filter(self, filter_obj):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def select_related(self, *fields, **kwargs):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def annotate(self, *args, **kwargs):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def order_by(self, *field_names):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def distinct(self, fields=None):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def extra(self, select=None, where=None, params=None, tables=None,\n-              order_by=None, select_params=None):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        assert self.query.can_filter(), \\\n-                \"Cannot change a query once a slice has been taken\"\n-        return self\n-\n-    def reverse(self):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def defer(self, *fields):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def only(self, *fields):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def update(self, **kwargs):\n-        \"\"\"\n-        Don't update anything.\n-        \"\"\"\n-        return 0\n-\n-    def aggregate(self, *args, **kwargs):\n-        \"\"\"\n-        Return a dict mapping the aggregate names to None\n-        \"\"\"\n-        for arg in args:\n-            kwargs[arg.default_alias] = arg\n-        return dict([(key, None) for key in kwargs])\n-\n-    def values(self, *fields):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    def values_list(self, *fields, **kwargs):\n-        \"\"\"\n-        Always returns EmptyQuerySet.\n-        \"\"\"\n-        return self\n-\n-    # EmptyQuerySet is always an empty result in where-clauses (and similar\n-    # situations).\n-    value_annotation = False\n-\n def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n                    only_load=None, from_parent=None):\n     \"\"\""
        },
        {
            "sha": "f021d571e9b3bb166c4b952b9db3578e48750d69",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -25,7 +25,7 @@\n from django.db.models.sql.datastructures import EmptyResultSet, Empty, MultiJoin\n from django.db.models.sql.expressions import SQLEvaluator\n from django.db.models.sql.where import (WhereNode, Constraint, EverythingNode,\n-    ExtraWhere, AND, OR)\n+    ExtraWhere, AND, OR, EmptyWhere)\n from django.core.exceptions import FieldError\n \n __all__ = ['Query', 'RawQuery']\n@@ -1511,6 +1511,13 @@ def split_exclude(self, filter_expr, prefix, can_reuse):\n             self.add_filter(('%s__isnull' % trimmed_prefix, False), negate=True,\n                     can_reuse=can_reuse)\n \n+    def set_empty(self):\n+        self.where = EmptyWhere()\n+        self.having = EmptyWhere()\n+\n+    def is_empty(self):\n+        return isinstance(self.where, EmptyWhere) or isinstance(self.having, EmptyWhere)\n+\n     def set_limits(self, low=None, high=None):\n         \"\"\"\n         Adjusts the limits on the rows retrieved. We use low/high to set these,"
        },
        {
            "sha": "02847b1f547948aa06a8f9529dbc15b08e9aa9a9",
            "filename": "django/db/models/sql/where.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -272,6 +272,14 @@ def relabel_aliases(self, change_map, node=None):\n                 if hasattr(child[3], 'relabel_aliases'):\n                     child[3].relabel_aliases(change_map)\n \n+class EmptyWhere(WhereNode):\n+\n+    def add(self, data, connector):\n+        return\n+\n+    def as_sql(self, qn=None, connection=None):\n+        raise EmptyResultSet\n+\n class EverythingNode(object):\n     \"\"\"\n     A node that matches everything."
        },
        {
            "sha": "2bbd895fd49995ff5689d98902dab333c2e268de",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -593,15 +593,17 @@ none\n \n .. method:: none()\n \n-Returns an ``EmptyQuerySet`` â€” a ``QuerySet`` subclass that always evaluates to\n-an empty list. This can be used in cases where you know that you should return\n-an empty result set and your caller is expecting a ``QuerySet`` object (instead\n-of returning an empty list, for example.)\n+Calling none() will create a queryset that never returns any objects and no\n+query will be executed when accessing the results. A qs.none() queryset\n+is an instance of ``EmptyQuerySet``.\n \n Examples::\n \n     >>> Entry.objects.none()\n     []\n+    >>> from django.db.models.query import EmptyQuerySet\n+    >>> isinstance(Entry.objects.none(), EmptyQuerySet)\n+    True\n \n all\n ~~~"
        },
        {
            "sha": "e425036839ed24de763f94baf8c4f6f0e6aa00a6",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -31,6 +31,11 @@ Minor features\n Backwards incompatible changes in 1.6\n =====================================\n \n+* The ``django.db.models.query.EmptyQuerySet`` can't be instantiated any more -\n+  it is only usable as a marker class for checking if\n+  :meth:`~django.db.models.query.QuerySet.none` has been called:\n+  ``isinstance(qs.none(), EmptyQuerySet)``\n+\n .. warning::\n \n     In addition to the changes outlined in this section, be sure to review the"
        },
        {
            "sha": "dba9a686d9e1d9b34f4c65448e93534b6307083d",
            "filename": "tests/modeltests/basic/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbasic%2Ftests.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -4,6 +4,7 @@\n \n from django.core.exceptions import ObjectDoesNotExist, MultipleObjectsReturned\n from django.db.models.fields import Field, FieldDoesNotExist\n+from django.db.models.query import EmptyQuerySet\n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n from django.utils import six\n from django.utils.translation import ugettext_lazy\n@@ -639,3 +640,9 @@ def test_create_relation_with_ugettext_lazy(self):\n         Article.objects.bulk_create([Article(headline=lazy, pub_date=datetime.now())])\n         article = Article.objects.get()\n         self.assertEqual(article.headline, notlazy)\n+\n+    def test_emptyqs(self):\n+        # Can't be instantiated\n+        with self.assertRaises(TypeError):\n+            EmptyQuerySet()\n+        self.assertTrue(isinstance(Article.objects.none(), EmptyQuerySet))"
        },
        {
            "sha": "38ebeb4f8c2e789782d35cf64650452dc97b2799",
            "filename": "tests/modeltests/get_object_or_404/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fmodeltests%2Fget_object_or_404%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fmodeltests%2Fget_object_or_404%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_object_or_404%2Ftests.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -53,7 +53,7 @@ def test_get_object_or_404(self):\n             get_object_or_404, Author.objects.all()\n         )\n \n-        # Using an EmptyQuerySet raises a Http404 error.\n+        # Using an empty QuerySet raises a Http404 error.\n         self.assertRaises(Http404,\n             get_object_or_404, Article.objects.none(), title__contains=\"Run\"\n         )"
        },
        {
            "sha": "de7105f92d7875a01e63fc39aeee5b7e24b20e17",
            "filename": "tests/modeltests/lookup/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fmodeltests%2Flookup%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fmodeltests%2Flookup%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Flookup%2Ftests.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -436,7 +436,7 @@ def test_exclude(self):\n             ])\n \n     def test_none(self):\n-       # none() returns an EmptyQuerySet that behaves like any other QuerySet object\n+       # none() returns a QuerySet that behaves like any other QuerySet object\n         self.assertQuerysetEqual(Article.objects.none(), [])\n         self.assertQuerysetEqual(\n             Article.objects.none().filter(headline__startswith='Article'), [])"
        },
        {
            "sha": "7d01c16255d7f8d1f9c70bc0753d816012c347c1",
            "filename": "tests/regressiontests/queries/tests.py",
            "status": "modified",
            "additions": 30,
            "deletions": 29,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fqueries%2Ftests.py?ref=a2396a4c8f2ccd7f91adee6d8c2e9c31f13f0e3f",
            "patch": "@@ -9,7 +9,7 @@\n from django.core.exceptions import FieldError\n from django.db import DatabaseError, connection, connections, DEFAULT_DB_ALIAS\n from django.db.models import Count, F, Q\n-from django.db.models.query import ITER_CHUNK_SIZE, EmptyQuerySet\n+from django.db.models.query import ITER_CHUNK_SIZE\n from django.db.models.sql.where import WhereNode, EverythingNode, NothingNode\n from django.db.models.sql.datastructures import EmptyResultSet\n from django.test import TestCase, skipUnlessDBFeature\n@@ -663,31 +663,32 @@ def test_tickets_7448_7707(self):\n             Item.objects.filter(created__in=[self.time1, self.time2]),\n             ['<Item: one>', '<Item: two>']\n         )\n-\n     def test_ticket7235(self):\n         # An EmptyQuerySet should not raise exceptions if it is filtered.\n-        q = EmptyQuerySet()\n-        self.assertQuerysetEqual(q.all(), [])\n-        self.assertQuerysetEqual(q.filter(x=10), [])\n-        self.assertQuerysetEqual(q.exclude(y=3), [])\n-        self.assertQuerysetEqual(q.complex_filter({'pk': 1}), [])\n-        self.assertQuerysetEqual(q.select_related('spam', 'eggs'), [])\n-        self.assertQuerysetEqual(q.annotate(Count('eggs')), [])\n-        self.assertQuerysetEqual(q.order_by('-pub_date', 'headline'), [])\n-        self.assertQuerysetEqual(q.distinct(), [])\n-        self.assertQuerysetEqual(\n-            q.extra(select={'is_recent': \"pub_date > '2006-01-01'\"}),\n-            []\n-        )\n-        q.query.low_mark = 1\n-        self.assertRaisesMessage(\n-            AssertionError,\n-            'Cannot change a query once a slice has been taken',\n-            q.extra, select={'is_recent': \"pub_date > '2006-01-01'\"}\n-        )\n-        self.assertQuerysetEqual(q.reverse(), [])\n-        self.assertQuerysetEqual(q.defer('spam', 'eggs'), [])\n-        self.assertQuerysetEqual(q.only('spam', 'eggs'), [])\n+        Eaten.objects.create(meal='m')\n+        q = Eaten.objects.none()\n+        with self.assertNumQueries(0):\n+            self.assertQuerysetEqual(q.all(), [])\n+            self.assertQuerysetEqual(q.filter(meal='m'), [])\n+            self.assertQuerysetEqual(q.exclude(meal='m'), [])\n+            self.assertQuerysetEqual(q.complex_filter({'pk': 1}), [])\n+            self.assertQuerysetEqual(q.select_related('food'), [])\n+            self.assertQuerysetEqual(q.annotate(Count('food')), [])\n+            self.assertQuerysetEqual(q.order_by('meal', 'food'), [])\n+            self.assertQuerysetEqual(q.distinct(), [])\n+            self.assertQuerysetEqual(\n+                q.extra(select={'foo': \"1\"}),\n+                []\n+            )\n+            q.query.low_mark = 1\n+            self.assertRaisesMessage(\n+                AssertionError,\n+                'Cannot change a query once a slice has been taken',\n+                q.extra, select={'foo': \"1\"}\n+            )\n+            self.assertQuerysetEqual(q.reverse(), [])\n+            self.assertQuerysetEqual(q.defer('meal'), [])\n+            self.assertQuerysetEqual(q.only('meal'), [])\n \n     def test_ticket7791(self):\n         # There were \"issues\" when ordering and distinct-ing on fields related\n@@ -1935,8 +1936,8 @@ def test_evaluated_queryset_as_argument(self):\n \n class EmptyQuerySetTests(TestCase):\n     def test_emptyqueryset_values(self):\n-        # #14366 -- Calling .values() on an EmptyQuerySet and then cloning that\n-        # should not cause an error\"\n+        # #14366 -- Calling .values() on an empty QuerySet and then cloning\n+        # that should not cause an error\n         self.assertQuerysetEqual(\n             Number.objects.none().values('num').order_by('num'), []\n         )\n@@ -1952,9 +1953,9 @@ def test_values_subquery(self):\n         )\n \n     def test_ticket_19151(self):\n-        # #19151 -- Calling .values() or .values_list() on an EmptyQuerySet\n-        # should return EmptyQuerySet and not cause an error.\n-        q = EmptyQuerySet()\n+        # #19151 -- Calling .values() or .values_list() on an empty QuerySet\n+        # should return an empty QuerySet and not cause an error.\n+        q = Author.objects.none()\n         self.assertQuerysetEqual(q.values(), [])\n         self.assertQuerysetEqual(q.values_list(), [])\n "
        }
    ],
    "stats": {
        "total": 273,
        "additions": 96,
        "deletions": 177
    }
}