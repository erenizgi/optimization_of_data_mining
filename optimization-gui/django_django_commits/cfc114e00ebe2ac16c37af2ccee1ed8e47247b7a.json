{
    "author": "aaugustin",
    "message": "Removed _enter/_leave_transaction_management.\n\nThe goal is to make all databases share a common, autocommit-based,\nimplementation.",
    "sha": "cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a",
    "files": [
        {
            "sha": "26a84e6e601ba34e446f1ce158dde06756aa9884",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 15,
            "deletions": 23,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a",
            "patch": "@@ -231,21 +231,6 @@ def clean_savepoints(self):\n \n     ##### Backend-specific transaction management methods #####\n \n-    def _enter_transaction_management(self, managed):\n-        \"\"\"\n-        A hook for backend-specific changes required when entering manual\n-        transaction handling.\n-        \"\"\"\n-        pass\n-\n-    def _leave_transaction_management(self, managed):\n-        \"\"\"\n-        A hook for backend-specific changes required when leaving manual\n-        transaction handling. Will usually be implemented only when\n-        _enter_transaction_management() is also required.\n-        \"\"\"\n-        pass\n-\n     def _set_autocommit(self, autocommit):\n         \"\"\"\n         Backend-specific implementation to enable or disable autocommit.\n@@ -268,7 +253,10 @@ def enter_transaction_management(self, managed=True, forced=False):\n         commit/rollback, the data will be commited, unless \"forced\" is True.\n         \"\"\"\n         self.transaction_state.append(managed)\n-        self._enter_transaction_management(managed)\n+\n+        if managed and self.autocommit:\n+            self.set_autocommit(False)\n+\n         if not managed and self.is_dirty() and not forced:\n             self.commit()\n \n@@ -283,17 +271,21 @@ def leave_transaction_management(self):\n         else:\n             raise TransactionManagementError(\n                 \"This code isn't under transaction management\")\n-        # The _leave_transaction_management hook can change the dirty flag,\n-        # so memoize it.\n-        dirty = self._dirty\n-        # We will pass the next status (after leaving the previous state\n-        # behind) to subclass hook.\n-        self._leave_transaction_management(self.is_managed())\n-        if dirty:\n+\n+        # That's the next state -- we already left the previous state behind.\n+        managed = self.is_managed()\n+\n+        if self._dirty:\n             self.rollback()\n+            if not managed and not self.autocommit:\n+                self.set_autocommit(True)\n             raise TransactionManagementError(\n                 \"Transaction managed block ended with pending COMMIT/ROLLBACK\")\n \n+        if not managed and not self.autocommit:\n+            self.set_autocommit(True)\n+\n+\n     def set_autocommit(self, autocommit=True):\n         \"\"\"\n         Enable or disable autocommit."
        },
        {
            "sha": "02f0b6462d13b8ae5ef2665ce67165f6af5a2f5c",
            "filename": "django/db/backends/dummy/base.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a/django%2Fdb%2Fbackends%2Fdummy%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a/django%2Fdb%2Fbackends%2Fdummy%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fdummy%2Fbase.py?ref=cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a",
            "patch": "@@ -55,8 +55,6 @@ class DatabaseWrapper(BaseDatabaseWrapper):\n     _savepoint = ignore\n     _savepoint_commit = complain\n     _savepoint_rollback = ignore\n-    _enter_transaction_management = complain\n-    _leave_transaction_management = ignore\n     _set_autocommit = complain\n     set_dirty = complain\n     set_clean = complain"
        },
        {
            "sha": "6ea2dd30995a92f3892f4e32671dcc3dc1a38846",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=cfc114e00ebe2ac16c37af2ccee1ed8e47247b7a",
            "patch": "@@ -164,23 +164,6 @@ def close(self):\n         finally:\n             self.set_clean()\n \n-    def _enter_transaction_management(self, managed):\n-        \"\"\"\n-        Switch the isolation level when needing transaction support, so that\n-        the same transaction is visible across all the queries.\n-        \"\"\"\n-        if managed and self.autocommit:\n-            self.set_autocommit(False)\n-\n-    def _leave_transaction_management(self, managed):\n-        \"\"\"\n-        If the normal operating mode is \"autocommit\", switch back to that when\n-        leaving transaction management.\n-        \"\"\"\n-        if not managed and not self.autocommit:\n-            self.rollback()                     # Must terminate transaction first.\n-            self.set_autocommit(True)\n-\n     def _set_isolation_level(self, isolation_level):\n         assert isolation_level in range(1, 5)     # Use set_autocommit for level = 0\n         if self.psycopg2_version >= (2, 4, 2):"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 15,
        "deletions": 42
    }
}