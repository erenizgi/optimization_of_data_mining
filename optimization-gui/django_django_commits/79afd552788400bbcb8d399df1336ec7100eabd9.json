{
    "author": "jezdez",
    "message": "Fixed #5925 -- Added new lazily evaluated version of django.core.urlresolvers.reverse. Thanks, SmileyChris, Preston Timmons and Julien Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16121 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "79afd552788400bbcb8d399df1336ec7100eabd9",
    "files": [
        {
            "sha": "52d90904a208927d1ddebe73e718155d1c5014ea",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/79afd552788400bbcb8d399df1336ec7100eabd9/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/79afd552788400bbcb8d399df1336ec7100eabd9/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=79afd552788400bbcb8d399df1336ec7100eabd9",
            "patch": "@@ -15,7 +15,7 @@\n from django.core.exceptions import ImproperlyConfigured, ViewDoesNotExist\n from django.utils.datastructures import MultiValueDict\n from django.utils.encoding import iri_to_uri, force_unicode, smart_str\n-from django.utils.functional import memoize\n+from django.utils.functional import memoize, lazy\n from django.utils.importlib import import_module\n from django.utils.regex_helper import normalize\n \n@@ -390,6 +390,8 @@ def reverse(viewname, urlconf=None, args=None, kwargs=None, prefix=None, current\n     return iri_to_uri(u'%s%s' % (prefix, resolver.reverse(view,\n             *args, **kwargs)))\n \n+reverse_lazy = lazy(reverse, str)\n+\n def clear_url_caches():\n     global _resolver_cache\n     global _callable_cache"
        },
        {
            "sha": "e86e07031ac8384efe57aea675a4da3c1a44f424",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/79afd552788400bbcb8d399df1336ec7100eabd9/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/79afd552788400bbcb8d399df1336ec7100eabd9/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=79afd552788400bbcb8d399df1336ec7100eabd9",
            "patch": "@@ -37,6 +37,12 @@ compatibility with old browsers, this change means that you can use any HTML5\n features you need in admin pages without having to lose HTML validity or\n override the provided templates to change the doctype.\n \n+``reverse_lazy``\n+~~~~~~~~~~~~~~~~\n+\n+A lazily evaluated version of :func:`django.core.urlresolvers.reverse` was\n+added to allow using URL reversals before the project's URLConf gets loaded.\n+\n .. _backwards-incompatible-changes-1.4:\n \n Backwards incompatible changes in 1.4"
        },
        {
            "sha": "ae1ca3f25445c0391215050078e4fc5321b309c3",
            "filename": "docs/topics/http/urls.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/79afd552788400bbcb8d399df1336ec7100eabd9/docs%2Ftopics%2Fhttp%2Furls.txt",
            "raw_url": "https://github.com/django/django/raw/79afd552788400bbcb8d399df1336ec7100eabd9/docs%2Ftopics%2Fhttp%2Furls.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Furls.txt?ref=79afd552788400bbcb8d399df1336ec7100eabd9",
            "patch": "@@ -827,6 +827,26 @@ namespaces into URLs on specific application instances, according to the\n     ``urllib.quote``) to the ouput of :meth:`~django.core.urlresolvers.reverse`\n     may produce undesirable results.\n \n+reverse_lazy()\n+--------------\n+\n+.. versionadded:: 1.4\n+\n+A lazily evaluated version of `reverse()`_.\n+\n+It is useful for when you need to use a URL reversal before your project's\n+URLConf is loaded. Some common cases where this method is necessary are::\n+\n+* providing a reversed URL as the ``url`` attribute of a generic class-based\n+  view.\n+\n+* providing a reversed URL to a decorator (such as the ``login_url`` argument\n+  for the :func:`django.contrib.auth.decorators.permission_required`\n+  decorator).\n+\n+* providing a reversed URL as a default value for a parameter in a function's\n+  signature.\n+\n resolve()\n ---------\n "
        },
        {
            "sha": "4f391d9653c19c34cecd4451ffa3ad39705b583e",
            "filename": "tests/regressiontests/urlpatterns_reverse/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/79afd552788400bbcb8d399df1336ec7100eabd9/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/79afd552788400bbcb8d399df1336ec7100eabd9/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py?ref=79afd552788400bbcb8d399df1336ec7100eabd9",
            "patch": "@@ -10,6 +10,7 @@\n from django.shortcuts import redirect\n from django.test import TestCase\n from django.utils import unittest\n+from django.contrib.auth.models import User\n \n import urlconf_outer\n import urlconf_inner\n@@ -218,6 +219,21 @@ def test_404_tried_urls_have_names(self):\n                         else:\n                             self.assertEqual(t.name, e['name'], 'Wrong URL name.  Expected \"%s\", got \"%s\".' % (e['name'], t.name))\n \n+class ReverseLazyTest(TestCase):\n+    urls = 'regressiontests.urlpatterns_reverse.reverse_lazy_urls'\n+\n+    def test_redirect_with_lazy_reverse(self):\n+        response = self.client.get('/redirect/')\n+        self.assertRedirects(response, \"/redirected_to/\", status_code=301)\n+\n+    def test_user_permission_with_lazy_reverse(self):\n+        user = User.objects.create_user('alfred', 'alfred@example.com', password='testpw')\n+        response = self.client.get('/login_required_view/')\n+        self.assertRedirects(response, \"/login/?next=/login_required_view/\", status_code=302)\n+        self.client.login(username='alfred', password='testpw')\n+        response = self.client.get('/login_required_view/')\n+        self.assertEqual(response.status_code, 200)\n+\n class ReverseShortcutTests(TestCase):\n     urls = 'regressiontests.urlpatterns_reverse.urls'\n "
        },
        {
            "sha": "b04bf33ff158b8e7fa5dd4bc2ef547da2b1d7f71",
            "filename": "tests/regressiontests/urlpatterns_reverse/views.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/79afd552788400bbcb8d399df1336ec7100eabd9/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/79afd552788400bbcb8d399df1336ec7100eabd9/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews.py?ref=79afd552788400bbcb8d399df1336ec7100eabd9",
            "patch": "@@ -1,4 +1,8 @@\n from django.http import HttpResponse\n+from django.views.generic import RedirectView\n+from django.core.urlresolvers import reverse_lazy\n+\n+from django.contrib.auth.decorators import user_passes_test\n \n def empty_view(request, *args, **kwargs):\n     return HttpResponse('')\n@@ -15,5 +19,12 @@ def __call__(self, request, *args, **kwargs):\n \n view_class_instance = ViewClass()\n \n+class LazyRedictView(RedirectView):\n+    url = reverse_lazy('named-lazy-url-redirected-to')\n+\n+@user_passes_test(lambda u: u.is_authenticated(), login_url=reverse_lazy('some-login-page'))\n+def login_required_view(request):\n+    return HttpResponse('Hello you')\n+\n def bad_view(request, *args, **kwargs):\n     raise ValueError(\"I don't think I'm getting good value for this view\")"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 56,
        "deletions": 1
    }
}