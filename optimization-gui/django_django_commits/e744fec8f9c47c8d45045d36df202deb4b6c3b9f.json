{
    "author": "jezdez",
    "message": "Fixed #11321 -- Handle timezones correctly in conjunction with naturalday filter. Thanks, aarond10 and seocam.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16072 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e744fec8f9c47c8d45045d36df202deb4b6c3b9f",
    "files": [
        {
            "sha": "5f3e2a7aed480a062b607b4dcdaca47937333560",
            "filename": "django/contrib/humanize/templatetags/humanize.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/e744fec8f9c47c8d45045d36df202deb4b6c3b9f/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "raw_url": "https://github.com/django/django/raw/e744fec8f9c47c8d45045d36df202deb4b6c3b9f/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py?ref=e744fec8f9c47c8d45045d36df202deb4b6c3b9f",
            "patch": "@@ -84,14 +84,16 @@ def naturalday(value, arg=None):\n     formatted according to settings.DATE_FORMAT.\n     \"\"\"\n     try:\n+        tzinfo = getattr(value, 'tzinfo', None)\n         value = date(value.year, value.month, value.day)\n     except AttributeError:\n         # Passed value wasn't a date object\n         return value\n     except ValueError:\n         # Date arguments out of range\n         return value\n-    delta = value - date.today()\n+    today = datetime.now(tzinfo).replace(microsecond=0, second=0, minute=0, hour=0)\n+    delta = value - today.date()\n     if delta.days == 0:\n         return _(u'today')\n     elif delta.days == 1:"
        },
        {
            "sha": "ade0d1a4d4a32bed6d23f70fab7e53a86a075ccf",
            "filename": "tests/regressiontests/humanize/tests.py",
            "status": "modified",
            "additions": 34,
            "deletions": 4,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/e744fec8f9c47c8d45045d36df202deb4b6c3b9f/tests%2Fregressiontests%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e744fec8f9c47c8d45045d36df202deb4b6c3b9f/tests%2Fregressiontests%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhumanize%2Ftests.py?ref=e744fec8f9c47c8d45045d36df202deb4b6c3b9f",
            "patch": "@@ -1,4 +1,4 @@\n-from datetime import timedelta, date, datetime\n+from datetime import timedelta, date, datetime, tzinfo, timedelta\n \n from django.template import Template, Context, add_to_builtins\n from django.utils import unittest\n@@ -8,6 +8,24 @@\n \n add_to_builtins('django.contrib.humanize.templatetags.humanize')\n \n+\n+class FixedOffset(tzinfo):\n+    \"\"\"Fixed offset in hours east from UTC.\"\"\"\n+\n+    def __init__(self, offset, name):\n+        self.__offset = timedelta(hours=offset)\n+        self.__name = name\n+\n+    def utcoffset(self, dt):\n+        return self.__offset\n+\n+    def tzname(self, dt):\n+        return self.__name\n+\n+    def dst(self, dt):\n+        return timedelta(0)\n+\n+\n class HumanizeTests(unittest.TestCase):\n \n     def humanize_tester(self, test_list, result_list, method):\n@@ -97,7 +115,19 @@ def test_naturaltime(self):\n         rendered = t.render(Context(locals())).strip()\n         self.assertTrue(u' hours ago' in rendered)\n \n+    def test_naturalday_tz(self):\n+        from django.contrib.humanize.templatetags.humanize import naturalday\n \n-if __name__ == '__main__':\n-    unittest.main()\n-\n+        today = date.today()\n+        tz_one = FixedOffset(-12, 'TzOne')\n+        tz_two = FixedOffset(12, 'TzTwo')\n+\n+        # Can be today or yesterday\n+        date_one = datetime(today.year, today.month, today.day, tzinfo=tz_one)\n+        naturalday_one = naturalday(date_one)\n+        # Can be today or tomorrow\n+        date_two = datetime(today.year, today.month, today.day, tzinfo=tz_two)\n+        naturalday_two = naturalday(date_two)\n+\n+        # As 24h of difference they will never be the same\n+        self.assertNotEqual(naturalday_one, naturalday_two)"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 37,
        "deletions": 5
    }
}