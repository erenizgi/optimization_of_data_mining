{
    "author": "jezdez",
    "message": "Fixed #15070 -- Also pass current_app and use_l10n in inclusion_tags. Thanks, raony, mk and goodtune.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16117 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2ac4f175ec7ec5f6122d079e7f1dbac4800e7657",
    "files": [
        {
            "sha": "b6470f3e91b234fe4eaacfcc08858a6a9363a282",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=2ac4f175ec7ec5f6122d079e7f1dbac4800e7657",
            "patch": "@@ -930,7 +930,11 @@ def render(self, context):\n                         else:\n                             t = get_template(file_name)\n                         self.nodelist = t.nodelist\n-                    new_context = context_class(dict, autoescape=context.autoescape)\n+                    new_context = context_class(dict, **{\n+                        'autoescape': context.autoescape,\n+                        'current_app': context.current_app,\n+                        'use_l10n': context.use_l10n,\n+                    })\n                     # Copy across the CSRF token, if present, because inclusion\n                     # tags are often used for forms, and we need instructions\n                     # for using CSRF protection to be as simple as possible."
        },
        {
            "sha": "7ca359d97637861d586db44f2ddeb5837679c4e6",
            "filename": "tests/regressiontests/templates/custom.py",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Fcustom.py",
            "raw_url": "https://github.com/django/django/raw/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Fcustom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Fcustom.py?ref=2ac4f175ec7ec5f6122d079e7f1dbac4800e7657",
            "patch": "@@ -78,3 +78,27 @@ def test_inclusion_tag_registration(self):\n         self.verify_tag(custom.inclusion_explicit_no_context, 'inclusion_explicit_no_context')\n         self.verify_tag(custom.inclusion_no_params_with_context, 'inclusion_no_params_with_context')\n         self.verify_tag(custom.inclusion_params_and_context, 'inclusion_params_and_context')\n+\n+    def test_15070_current_app(self):\n+        \"\"\"\n+        Test that inclusion tag passes down `current_app` of context to the\n+        Context of the included/rendered template as well.\n+        \"\"\"\n+        c = template.Context({})\n+        t = template.Template('{% load custom %}{% inclusion_tag_current_app %}')\n+        self.assertEquals(t.render(c).strip(), u'None')\n+\n+        c.current_app = 'advanced'\n+        self.assertEquals(t.render(c).strip(), u'advanced')\n+\n+    def test_15070_use_l10n(self):\n+        \"\"\"\n+        Test that inclusion tag passes down `use_l10n` of context to the\n+        Context of the included/rendered template as well.\n+        \"\"\"\n+        c = template.Context({})\n+        t = template.Template('{% load custom %}{% inclusion_tag_use_l10n %}')\n+        self.assertEquals(t.render(c).strip(), u'None')\n+\n+        c.use_l10n = True\n+        self.assertEquals(t.render(c).strip(), u'True')"
        },
        {
            "sha": "ab2fe63b6fedfce93121ce3c2ac667d25aa3443a",
            "filename": "tests/regressiontests/templates/templates/test_incl_tag_current_app.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_incl_tag_current_app.html",
            "raw_url": "https://github.com/django/django/raw/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_incl_tag_current_app.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_incl_tag_current_app.html?ref=2ac4f175ec7ec5f6122d079e7f1dbac4800e7657",
            "patch": "@@ -0,0 +1 @@\n+{% load custom %}{% current_app %}"
        },
        {
            "sha": "3054960d1629122277a431920264becaed6b12f4",
            "filename": "tests/regressiontests/templates/templates/test_incl_tag_use_l10n.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_incl_tag_use_l10n.html",
            "raw_url": "https://github.com/django/django/raw/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_incl_tag_use_l10n.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplates%2Ftest_incl_tag_use_l10n.html?ref=2ac4f175ec7ec5f6122d079e7f1dbac4800e7657",
            "patch": "@@ -0,0 +1 @@\n+{% load custom %}{% use_l10n %}"
        },
        {
            "sha": "8db113a6f1cc9d1a14217db0b239ccf0236a79bc",
            "filename": "tests/regressiontests/templates/templatetags/custom.py",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fcustom.py",
            "raw_url": "https://github.com/django/django/raw/2ac4f175ec7ec5f6122d079e7f1dbac4800e7657/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fcustom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fcustom.py?ref=2ac4f175ec7ec5f6122d079e7f1dbac4800e7657",
            "patch": "@@ -69,3 +69,18 @@ def inclusion_params_and_context(context, arg):\n     return {\"result\" : \"inclusion_params_and_context - Expected result (context value: %s): %s\" % (context['value'], arg)}\n inclusion_params_and_context.anything = \"Expected inclusion_params_and_context __dict__\"\n \n+@register.simple_tag(takes_context=True)\n+def current_app(context):\n+    return \"%s\" % context.current_app\n+\n+@register.inclusion_tag('test_incl_tag_current_app.html', takes_context=True)\n+def inclusion_tag_current_app(context):\n+    return {}\n+\n+@register.simple_tag(takes_context=True)\n+def use_l10n(context):\n+    return \"%s\" % context.use_l10n\n+\n+@register.inclusion_tag('test_incl_tag_use_l10n.html', takes_context=True)\n+def inclusion_tag_use_l10n(context):\n+    return {}"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 46,
        "deletions": 1
    }
}