{
    "author": "claudep",
    "message": "Fixed #18790 -- Encoded database password on Python 2\n\nThanks thcourbon@gmail.com for the report.",
    "sha": "859aa2a6c4496a0feafebef7c7ea8fc57d9913f4",
    "files": [
        {
            "sha": "4043014b8ecfc88b7e5ba5a15fe2ccbbbf8c37c7",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/859aa2a6c4496a0feafebef7c7ea8fc57d9913f4/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/859aa2a6c4496a0feafebef7c7ea8fc57d9913f4/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=859aa2a6c4496a0feafebef7c7ea8fc57d9913f4",
            "patch": "@@ -37,6 +37,7 @@\n from django.db.backends.mysql.creation import DatabaseCreation\n from django.db.backends.mysql.introspection import DatabaseIntrospection\n from django.db.backends.mysql.validation import DatabaseValidation\n+from django.utils.encoding import force_str\n from django.utils.functional import cached_property\n from django.utils.safestring import SafeBytes, SafeText\n from django.utils import six\n@@ -390,7 +391,7 @@ def _cursor(self):\n             if settings_dict['NAME']:\n                 kwargs['db'] = settings_dict['NAME']\n             if settings_dict['PASSWORD']:\n-                kwargs['passwd'] = settings_dict['PASSWORD']\n+                kwargs['passwd'] = force_str(settings_dict['PASSWORD'])\n             if settings_dict['HOST'].startswith('/'):\n                 kwargs['unix_socket'] = settings_dict['HOST']\n             elif settings_dict['HOST']:"
        },
        {
            "sha": "c8b88d5619c8f7f1001eac33397c0bef1b5e2673",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/859aa2a6c4496a0feafebef7c7ea8fc57d9913f4/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/859aa2a6c4496a0feafebef7c7ea8fc57d9913f4/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=859aa2a6c4496a0feafebef7c7ea8fc57d9913f4",
            "patch": "@@ -13,6 +13,7 @@\n from django.db.backends.postgresql_psycopg2.creation import DatabaseCreation\n from django.db.backends.postgresql_psycopg2.version import get_version\n from django.db.backends.postgresql_psycopg2.introspection import DatabaseIntrospection\n+from django.utils.encoding import force_str\n from django.utils.log import getLogger\n from django.utils.safestring import SafeText, SafeBytes\n from django.utils import six\n@@ -172,7 +173,7 @@ def _cursor(self):\n             if settings_dict['USER']:\n                 conn_params['user'] = settings_dict['USER']\n             if settings_dict['PASSWORD']:\n-                conn_params['password'] = settings_dict['PASSWORD']\n+                conn_params['password'] = force_str(settings_dict['PASSWORD'])\n             if settings_dict['HOST']:\n                 conn_params['host'] = settings_dict['HOST']\n             if settings_dict['PORT']:"
        },
        {
            "sha": "cfa298253c65d5f70108e2e759883cca43b1da15",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/859aa2a6c4496a0feafebef7c7ea8fc57d9913f4/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/859aa2a6c4496a0feafebef7c7ea8fc57d9913f4/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=859aa2a6c4496a0feafebef7c7ea8fc57d9913f4",
            "patch": "@@ -401,6 +401,19 @@ def test_unicode_fetches(self):\n         self.assertEqual(list(cursor.fetchmany(2)), [('Jane', 'Doe'), ('John', 'Doe')])\n         self.assertEqual(list(cursor.fetchall()), [('Mary', 'Agnelline'), ('Peter', 'Parker')])\n \n+    def test_unicode_password(self):\n+        old_password = connection.settings_dict['PASSWORD']\n+        connection.settings_dict['PASSWORD'] = \"fran√ßois\"\n+        try:\n+            cursor = connection.cursor()\n+        except backend.Database.DatabaseError:\n+            # As password is probably wrong, a database exception is expected\n+            pass\n+        except Exception as e:\n+            self.fail(\"Unexpected error raised with unicode password: %s\" % e)\n+        finally:\n+            connection.settings_dict['PASSWORD'] = old_password\n+\n     def test_database_operations_helper_class(self):\n         # Ticket #13630\n         self.assertTrue(hasattr(connection, 'ops'))"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 17,
        "deletions": 2
    }
}