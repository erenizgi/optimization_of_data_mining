{
    "author": "jezdez",
    "message": "Fixed #9200 -- Added new form wizard to formtools based on class based views. Many thanks to Stephan JÃ¤kel, ddurham and ElliottM for their work.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16307 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "632dfa233839f8c76bd6b065b8420fe0ab96175a",
    "files": [
        {
            "sha": "70843865010cfc831cfab5a816e2b6697e9c2598",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 76,
            "deletions": 50,
            "changes": 126,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -1,13 +1,19 @@\n import os\n+import re\n import warnings\n \n-from django import forms, http\n+from django import http\n from django.conf import settings\n from django.contrib.formtools import preview, wizard, utils\n from django.test import TestCase\n from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils import unittest\n \n+from django.contrib.formtools.wizard.tests import *\n+from django.contrib.formtools.tests.forms import *\n+\n+warnings.filterwarnings('ignore', category=PendingDeprecationWarning,\n+                        module='django.contrib.formtools.wizard')\n \n success_string = \"Done was called!\"\n \n@@ -24,12 +30,6 @@ def done(self, request, cleaned_data):\n         return http.HttpResponse(success_string)\n \n \n-class TestForm(forms.Form):\n-    field1 = forms.CharField()\n-    field1_ = forms.CharField()\n-    bool1 = forms.BooleanField(required=False)\n-\n-\n class PreviewTests(TestCase):\n     urls = 'django.contrib.formtools.tests.urls'\n \n@@ -63,7 +63,7 @@ def test_form_get(self):\n         is created to manage the stage.\n \n         \"\"\"\n-        response = self.client.get('/test1/')\n+        response = self.client.get('/preview/')\n         stage = self.input % 1\n         self.assertContains(response, stage, 1)\n         self.assertEqual(response.context['custom_context'], True)\n@@ -81,7 +81,7 @@ def test_form_preview(self):\n         # Pass strings for form submittal and add stage variable to\n         # show we previously saw first stage of the form.\n         self.test_data.update({'stage': 1})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         # Check to confirm stage is set to 2 in output form.\n         stage = self.input % 2\n         self.assertContains(response, stage, 1)\n@@ -99,11 +99,11 @@ def test_form_submit(self):\n         # Pass strings for form submittal and add stage variable to\n         # show we previously saw first stage of the form.\n         self.test_data.update({'stage':2})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         self.assertNotEqual(response.content, success_string)\n         hash = self.preview.security_hash(None, TestForm(self.test_data))\n         self.test_data.update({'hash': hash})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         self.assertEqual(response.content, success_string)\n \n     def test_bool_submit(self):\n@@ -122,7 +122,7 @@ def test_bool_submit(self):\n         self.test_data.update({'stage':2})\n         hash = self.preview.security_hash(None, TestForm(self.test_data))\n         self.test_data.update({'hash':hash, 'bool1':u'False'})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         self.assertEqual(response.content, success_string)\n \n     def test_form_submit_good_hash(self):\n@@ -133,11 +133,11 @@ def test_form_submit_good_hash(self):\n         # Pass strings for form submittal and add stage variable to\n         # show we previously saw first stage of the form.\n         self.test_data.update({'stage':2})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         self.assertNotEqual(response.content, success_string)\n         hash = utils.form_hmac(TestForm(self.test_data))\n         self.test_data.update({'hash': hash})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         self.assertEqual(response.content, success_string)\n \n \n@@ -149,12 +149,12 @@ def test_form_submit_bad_hash(self):\n         # Pass strings for form submittal and add stage variable to\n         # show we previously saw first stage of the form.\n         self.test_data.update({'stage':2})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/preview/', self.test_data)\n         self.assertEqual(response.status_code, 200)\n         self.assertNotEqual(response.content, success_string)\n         hash = utils.form_hmac(TestForm(self.test_data)) + \"bad\"\n         self.test_data.update({'hash': hash})\n-        response = self.client.post('/test1/', self.test_data)\n+        response = self.client.post('/previewpreview/', self.test_data)\n         self.assertNotEqual(response.content, success_string)\n \n \n@@ -220,38 +220,14 @@ def test_empty_permitted(self):\n         self.assertEqual(hash1, hash2)\n \n \n-class HashTestForm(forms.Form):\n-    name = forms.CharField()\n-    bio = forms.CharField()\n-\n-\n-class HashTestBlankForm(forms.Form):\n-    name = forms.CharField(required=False)\n-    bio = forms.CharField(required=False)\n-\n #\n # FormWizard tests\n #\n \n-\n-class WizardPageOneForm(forms.Form):\n-    field = forms.CharField()\n-\n-\n-class WizardPageTwoForm(forms.Form):\n-    field = forms.CharField()\n-\n-class WizardPageTwoAlternativeForm(forms.Form):\n-    field = forms.CharField()\n-\n-class WizardPageThreeForm(forms.Form):\n-    field = forms.CharField()\n-\n-\n-class WizardClass(wizard.FormWizard):\n+class TestWizardClass(wizard.FormWizard):\n \n     def get_template(self, step):\n-        return 'formwizard/wizard.html'\n+        return 'forms/wizard.html'\n \n     def done(self, request, cleaned_data):\n         return http.HttpResponse(success_string)\n@@ -269,6 +245,20 @@ def __init__(self, POST=None):\n \n class WizardTests(TestCase):\n     urls = 'django.contrib.formtools.tests.urls'\n+    input_re = re.compile('name=\"([^\"]+)\" value=\"([^\"]+)\"')\n+    wizard_step_data = (\n+        {\n+            '0-name': 'Pony',\n+            '0-thirsty': '2',\n+        },\n+        {\n+            '1-address1': '123 Main St',\n+            '1-address2': 'Djangoland',\n+        },\n+        {\n+            '2-random_crap': 'blah blah',\n+        }\n+    )\n \n     def setUp(self):\n         self.old_TEMPLATE_DIRS = settings.TEMPLATE_DIRS\n@@ -290,21 +280,21 @@ def test_step_starts_at_zero(self):\n         \"\"\"\n         step should be zero for the first form\n         \"\"\"\n-        response = self.client.get('/wizard/')\n+        response = self.client.get('/wizard1/')\n         self.assertEqual(0, response.context['step0'])\n \n     def test_step_increments(self):\n         \"\"\"\n         step should be incremented when we go to the next page\n         \"\"\"\n-        response = self.client.post('/wizard/', {\"0-field\":\"test\", \"wizard_step\":\"0\"})\n+        response = self.client.post('/wizard1/', {\"0-field\":\"test\", \"wizard_step\":\"0\"})\n         self.assertEqual(1, response.context['step0'])\n \n     def test_bad_hash(self):\n         \"\"\"\n         Form should not advance if the hash is missing or bad\n         \"\"\"\n-        response = self.client.post('/wizard/',\n+        response = self.client.post('/wizard1/',\n                                     {\"0-field\":\"test\",\n                                      \"1-field\":\"test2\",\n                                      \"wizard_step\": \"1\"})\n@@ -319,7 +309,7 @@ def test_good_hash(self):\n                 \"1-field\": \"test2\",\n                 \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n                 \"wizard_step\": \"1\"}\n-        response = self.client.post('/wizard/', data)\n+        response = self.client.post('/wizard1/', data)\n         self.assertEqual(2, response.context['step0'])\n \n     def test_11726(self):\n@@ -330,7 +320,7 @@ def test_11726(self):\n         reached = [False]\n         that = self\n \n-        class WizardWithProcessStep(WizardClass):\n+        class WizardWithProcessStep(TestWizardClass):\n             def process_step(self, request, form, step):\n                 if step == 0:\n                     if self.num_steps() < 2:\n@@ -362,7 +352,7 @@ def test_14498(self):\n         reached = [False]\n         that = self\n \n-        class WizardWithProcessStep(WizardClass):\n+        class WizardWithProcessStep(TestWizardClass):\n             def process_step(self, request, form, step):\n                 that.assertTrue(hasattr(form, 'cleaned_data'))\n                 reached[0] = True\n@@ -386,7 +376,7 @@ def test_14576(self):\n         reached = [False]\n         that = self\n \n-        class Wizard(WizardClass):\n+        class Wizard(TestWizardClass):\n             def done(self, request, form_list):\n                 reached[0] = True\n                 that.assertTrue(len(form_list) == 2)\n@@ -409,7 +399,7 @@ def test_15075(self):\n         reached = [False]\n         that = self\n \n-        class WizardWithProcessStep(WizardClass):\n+        class WizardWithProcessStep(TestWizardClass):\n             def process_step(self, request, form, step):\n                 if step == 0:\n                     self.form_list[1] = WizardPageTwoAlternativeForm\n@@ -426,3 +416,39 @@ def process_step(self, request, form, step):\n                 \"wizard_step\": \"1\"}\n         wizard(DummyRequest(POST=data))\n         self.assertTrue(reached[0])\n+\n+    def grab_field_data(self, response):\n+        \"\"\"\n+        Pull the appropriate field data from the context to pass to the next wizard step\n+        \"\"\"\n+        previous_fields = response.context['previous_fields']\n+        fields = {'wizard_step': response.context['step0']}\n+\n+        def grab(m):\n+            fields[m.group(1)] = m.group(2)\n+            return ''\n+\n+        self.input_re.sub(grab, previous_fields)\n+        return fields\n+\n+    def check_wizard_step(self, response, step_no):\n+        \"\"\"\n+        Helper function to test each step of the wizard\n+        - Make sure the call succeeded\n+        - Make sure response is the proper step number\n+        - return the result from the post for the next step\n+        \"\"\"\n+        step_count = len(self.wizard_step_data)\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertContains(response, 'Step %d of %d' % (step_no, step_count))\n+\n+        data = self.grab_field_data(response)\n+        data.update(self.wizard_step_data[step_no - 1])\n+\n+        return self.client.post('/wizard2/', data)\n+\n+    def test_9473(self):\n+        response = self.client.get('/wizard2/')\n+        for step_no in range(1, len(self.wizard_step_data) + 1):\n+            response = self.check_wizard_step(response, step_no)"
        },
        {
            "sha": "93bad924b89e99c93420eb8ac20606e760ca9af7",
            "filename": "django/contrib/formtools/tests/forms.py",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fforms.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,43 @@\n+from django import forms\n+from django.contrib.formtools.wizard import FormWizard\n+from django.http import HttpResponse\n+\n+class Page1(forms.Form):\n+    name = forms.CharField(max_length=100)\n+    thirsty = forms.NullBooleanField()\n+\n+class Page2(forms.Form):\n+    address1 = forms.CharField(max_length=100)\n+    address2 = forms.CharField(max_length=100)\n+    \n+class Page3(forms.Form):\n+    random_crap = forms.CharField(max_length=100)\n+    \n+class ContactWizard(FormWizard):\n+    def done(self, request, form_list):\n+        return HttpResponse(\"\")\n+\n+class TestForm(forms.Form):\n+    field1 = forms.CharField()\n+    field1_ = forms.CharField()\n+    bool1 = forms.BooleanField(required=False)\n+\n+class HashTestForm(forms.Form):\n+    name = forms.CharField()\n+    bio = forms.CharField()\n+\n+class HashTestBlankForm(forms.Form):\n+    name = forms.CharField(required=False)\n+    bio = forms.CharField(required=False)\n+\n+class WizardPageOneForm(forms.Form):\n+    field = forms.CharField()\n+\n+class WizardPageTwoForm(forms.Form):\n+    field = forms.CharField()\n+\n+class WizardPageTwoAlternativeForm(forms.Form):\n+    field = forms.CharField()\n+\n+class WizardPageThreeForm(forms.Form):\n+    field = forms.CharField()"
        },
        {
            "sha": "c911c3cbf88fb798d371b49c59b9e46177505554",
            "filename": "django/contrib/formtools/tests/templates/forms/wizard.html",
            "status": "renamed",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2Ftemplates%2Fforms%2Fwizard.html",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2Ftemplates%2Fforms%2Fwizard.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Ftemplates%2Fforms%2Fwizard.html?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -1,13 +1,13 @@\n-<html>\r\n-  <body>\r\n-    <p>Step {{ step }} of {{ step_count }}</p>\r\n-    <form action=\".\" method=\"post\">\r\n-    <table>\r\n-    {{ form }}\r\n-    </table>\r\n-    <input type=\"hidden\" name=\"{{ step_field }}\" value=\"{{ step0 }}\" />\r\n-    {{ previous_fields|safe }}\r\n-    <input type=\"submit\">\r\n-    </form>\r\n-  </body>\r\n-</html>\r\n\\ No newline at end of file\n+<html>\n+  <body>\n+    <p>Step {{ step }} of {{ step_count }}</p>\n+    <form action=\".\" method=\"post\">\n+    <table>\n+    {{ form }}\n+    </table>\n+    <input type=\"hidden\" name=\"{{ step_field }}\" value=\"{{ step0 }}\" />\n+    {{ previous_fields|safe }}\n+    <input type=\"submit\">\n+    </form>\n+  </body>\n+</html>",
            "previous_filename": "tests/regressiontests/formwizard/templates/forms/wizard.html"
        },
        {
            "sha": "42b6e78be851163b617f2ec1706ca9eaacd9cb9f",
            "filename": "django/contrib/formtools/tests/templates/formwizard/wizard.html",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/django%2Fcontrib%2Fformtools%2Ftests%2Ftemplates%2Fformwizard%2Fwizard.html",
            "raw_url": "https://github.com/django/django/raw/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/django%2Fcontrib%2Fformtools%2Ftests%2Ftemplates%2Fformwizard%2Fwizard.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Ftemplates%2Fformwizard%2Fwizard.html?ref=1a951fa8d474fc9e6114cf63b8ba012233c9afcd",
            "patch": "@@ -1,9 +0,0 @@\n-<p>Step {{ step }} of {{ step_count }}</p>\n-<form action=\".\" method=\"post\">{% csrf_token %}\n-<table>\n-{{ form }}\n-</table>\n-<input type=\"hidden\" name=\"{{ step_field }}\" value=\"{{ step0 }}\" />\n-{{ previous_fields|safe }}\n-<input type=\"submit\">\n-</form>"
        },
        {
            "sha": "f058335b07925b56e73535c79929c34b7094b99c",
            "filename": "django/contrib/formtools/tests/urls.py",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Ftests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Furls.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -3,11 +3,14 @@\n \"\"\"\n \n from django.conf.urls.defaults import *\n-from django.contrib.formtools.tests import *\n+from django.contrib.formtools.tests import TestFormPreview, TestWizardClass\n+\n+from forms import (ContactWizard, Page1, Page2, Page3, TestForm,\n+    WizardPageOneForm, WizardPageTwoForm, WizardPageThreeForm)\n \n urlpatterns = patterns('',\n-                       (r'^test1/', TestFormPreview(TestForm)),\n-                       (r'^wizard/$', WizardClass([WizardPageOneForm,\n-                                                   WizardPageTwoForm,\n-                                                   WizardPageThreeForm])),\n-                      )\n+    url(r'^preview/', TestFormPreview(TestForm)),\n+    url(r'^wizard1/$', TestWizardClass(\n+        [WizardPageOneForm, WizardPageTwoForm, WizardPageThreeForm])),\n+    url(r'^wizard2/$', ContactWizard([Page1, Page2, Page3])),\n+)"
        },
        {
            "sha": "8e51a3170d8cda7b7b1beee3f35ee238a133682e",
            "filename": "django/contrib/formtools/wizard/__init__.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2F__init__.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1 @@\n+from django.contrib.formtools.wizard.legacy import FormWizard"
        },
        {
            "sha": "bf46c5c992fdc8f524cf1983e8e702146fedcd03",
            "filename": "django/contrib/formtools/wizard/forms.py",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fforms.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,7 @@\n+from django import forms\n+\n+class ManagementForm(forms.Form):\n+    \"\"\"\n+    ``ManagementForm`` is used to keep track of the current wizard step.\n+    \"\"\"\n+    current_step = forms.CharField(widget=forms.HiddenInput)"
        },
        {
            "sha": "532635a3d9b136a248613642fade36511c5c109f",
            "filename": "django/contrib/formtools/wizard/legacy.py",
            "status": "renamed",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Flegacy.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Flegacy.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Flegacy.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -3,15 +3,7 @@\n step and storing the form's state as HTML hidden fields so that no state is\n stored on the server side.\n \"\"\"\n-\n-try:\n-    import cPickle as pickle\n-except ImportError:\n-    import pickle\n-\n-from django import forms\n-from django.conf import settings\n-from django.contrib.formtools.utils import form_hmac\n+from django.forms import HiddenInput\n from django.http import Http404\n from django.shortcuts import render_to_response\n from django.template.context import RequestContext\n@@ -20,6 +12,7 @@\n from django.utils.decorators import method_decorator\n from django.views.decorators.csrf import csrf_protect\n \n+from django.contrib.formtools.utils import form_hmac\n \n class FormWizard(object):\n     # The HTML (and POST data) field name for the \"step\" variable.\n@@ -42,6 +35,12 @@ def __init__(self, form_list, initial=None):\n         # A zero-based counter keeping track of which step we're in.\n         self.step = 0\n \n+        import warnings\n+        warnings.warn(\n+            'Old-style form wizards have been deprecated; use the class-based '\n+            'views in django.contrib.formtools.wizard.views instead.',\n+            PendingDeprecationWarning)\n+\n     def __repr__(self):\n         return \"step: %d\\nform_list: %s\\ninitial_data: %s\" % (self.step, self.form_list, self.initial)\n \n@@ -71,7 +70,7 @@ def __call__(self, request, *args, **kwargs):\n         \"\"\"\n         if 'extra_context' in kwargs:\n             self.extra_context.update(kwargs['extra_context'])\n-        current_step = self.determine_step(request, *args, **kwargs)\n+        current_step = self.get_current_or_first_step(request, *args, **kwargs)\n         self.parse_params(request, *args, **kwargs)\n \n         # Validate and process all the previous forms before instantiating the\n@@ -132,7 +131,7 @@ def render(self, form, request, step, context=None):\n         old_data = request.POST\n         prev_fields = []\n         if old_data:\n-            hidden = forms.HiddenInput()\n+            hidden = HiddenInput()\n             # Collect all data from previous steps and render it as HTML hidden fields.\n             for i in range(step):\n                 old_form = self.get_form(i, old_data)\n@@ -177,7 +176,7 @@ def security_hash(self, request, form):\n         \"\"\"\n         return form_hmac(form)\n \n-    def determine_step(self, request, *args, **kwargs):\n+    def get_current_or_first_step(self, request, *args, **kwargs):\n         \"\"\"\n         Given the request object and whatever *args and **kwargs were passed to\n         __call__(), returns the current step (which is zero-based).",
            "previous_filename": "django/contrib/formtools/wizard.py"
        },
        {
            "sha": "b88ccc79ef7986d147b311940c96d8d9324e4695",
            "filename": "django/contrib/formtools/wizard/storage/__init__.py",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2F__init__.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,22 @@\n+from django.utils.importlib import import_module\n+\n+from django.contrib.formtools.wizard.storage.base import BaseStorage\n+from django.contrib.formtools.wizard.storage.exceptions import (\n+    MissingStorageModule, MissingStorageClass, NoFileStorageConfigured)\n+\n+\n+def get_storage(path, *args, **kwargs):\n+    i = path.rfind('.')\n+    module, attr = path[:i], path[i+1:]\n+    try:\n+        mod = import_module(module)\n+    except ImportError, e:\n+        raise MissingStorageModule(\n+            'Error loading storage %s: \"%s\"' % (module, e))\n+    try:\n+        storage_class = getattr(mod, attr)\n+    except AttributeError:\n+        raise MissingStorageClass(\n+            'Module \"%s\" does not define a storage named \"%s\"' % (module, attr))\n+    return storage_class(*args, **kwargs)\n+"
        },
        {
            "sha": "475b39dc75f20eca20733eedde546e528d606c00",
            "filename": "django/contrib/formtools/wizard/storage/base.py",
            "status": "added",
            "additions": 93,
            "deletions": 0,
            "changes": 93,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,93 @@\n+from django.core.files.uploadedfile import UploadedFile\n+from django.utils.functional import lazy_property\n+from django.utils.encoding import smart_str\n+\n+from django.contrib.formtools.wizard.storage.exceptions import NoFileStorageConfigured\n+\n+class BaseStorage(object):\n+    step_key = 'step'\n+    step_data_key = 'step_data'\n+    step_files_key = 'step_files'\n+    extra_data_key = 'extra_data'\n+\n+    def __init__(self, prefix, request=None, file_storage=None):\n+        self.prefix = 'wizard_%s' % prefix\n+        self.request = request\n+        self.file_storage = file_storage\n+\n+    def init_data(self):\n+        self.data = {\n+            self.step_key: None,\n+            self.step_data_key: {},\n+            self.step_files_key: {},\n+            self.extra_data_key: {},\n+        }\n+\n+    def reset(self):\n+        self.init_data()\n+\n+    def _get_current_step(self):\n+        return self.data[self.step_key]\n+\n+    def _set_current_step(self, step):\n+        self.data[self.step_key] = step\n+\n+    current_step = lazy_property(_get_current_step, _set_current_step)\n+\n+    def _get_extra_data(self):\n+        return self.data[self.extra_data_key] or {}\n+\n+    def _set_extra_data(self, extra_data):\n+        self.data[self.extra_data_key] = extra_data\n+\n+    extra_data = lazy_property(_get_extra_data, _set_extra_data)\n+\n+    def get_step_data(self, step):\n+        return self.data[self.step_data_key].get(step, None)\n+\n+    def set_step_data(self, step, cleaned_data):\n+        self.data[self.step_data_key][step] = cleaned_data\n+\n+    @property\n+    def current_step_data(self):\n+        return self.get_step_data(self.current_step)\n+\n+    def get_step_files(self, step):\n+        wizard_files = self.data[self.step_files_key].get(step, {})\n+\n+        if wizard_files and not self.file_storage:\n+            raise NoFileStorageConfigured\n+\n+        files = {}\n+        for field, field_dict in wizard_files.iteritems():\n+            field_dict = dict((smart_str(k), v)\n+                              for k, v in field_dict.iteritems())\n+            tmp_name = field_dict.pop('tmp_name')\n+            files[field] = UploadedFile(\n+                file=self.file_storage.open(tmp_name), **field_dict)\n+        return files or None\n+\n+    def set_step_files(self, step, files):\n+        if files and not self.file_storage:\n+            raise NoFileStorageConfigured\n+\n+        if step not in self.data[self.step_files_key]:\n+            self.data[self.step_files_key][step] = {}\n+\n+        for field, field_file in (files or {}).iteritems():\n+            tmp_filename = self.file_storage.save(field_file.name, field_file)\n+            file_dict = {\n+                'tmp_name': tmp_filename,\n+                'name': field_file.name,\n+                'content_type': field_file.content_type,\n+                'size': field_file.size,\n+                'charset': field_file.charset\n+            }\n+            self.data[self.step_files_key][step][field] = file_dict\n+\n+    @property\n+    def current_step_files(self):\n+        return self.get_step_files(self.current_step)\n+\n+    def update_response(self, response):\n+        pass"
        },
        {
            "sha": "af26e01337f5a752987aeabac0a99e9511c37457",
            "filename": "django/contrib/formtools/wizard/storage/cookie.py",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fcookie.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fcookie.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fcookie.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,32 @@\n+from django.core.exceptions import SuspiciousOperation\n+from django.core.signing import BadSignature\n+from django.utils import simplejson as json\n+\n+from django.contrib.formtools.wizard import storage\n+\n+\n+class CookieStorage(storage.BaseStorage):\n+    encoder = json.JSONEncoder(separators=(',', ':'))\n+\n+    def __init__(self, *args, **kwargs):\n+        super(CookieStorage, self).__init__(*args, **kwargs)\n+        self.data = self.load_data()\n+        if self.data is None:\n+            self.init_data()\n+\n+    def load_data(self):\n+        try:\n+            data = self.request.get_signed_cookie(self.prefix)\n+        except KeyError:\n+            data = None\n+        except BadSignature:\n+            raise SuspiciousOperation('FormWizard cookie manipulated')\n+        if data is None:\n+            return None\n+        return json.loads(data, cls=json.JSONDecoder)\n+\n+    def update_response(self, response):\n+        if self.data:\n+            response.set_signed_cookie(self.prefix, self.encoder.encode(self.data))\n+        else:\n+            response.delete_cookie(self.prefix)"
        },
        {
            "sha": "eab9030cf1fab191145e75d9906a836f56f9d9c8",
            "filename": "django/contrib/formtools/wizard/storage/exceptions.py",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fexceptions.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fexceptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fexceptions.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,10 @@\n+from django.core.exceptions import ImproperlyConfigured\n+\n+class MissingStorageModule(ImproperlyConfigured):\n+    pass\n+\n+class MissingStorageClass(ImproperlyConfigured):\n+    pass\n+\n+class NoFileStorageConfigured(ImproperlyConfigured):\n+    pass"
        },
        {
            "sha": "84a3848ab7ebc2ad998c066238bedf0774a66e6d",
            "filename": "django/contrib/formtools/wizard/storage/session.py",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fsession.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fsession.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fsession.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,20 @@\n+from django.core.files.uploadedfile import UploadedFile\n+from django.contrib.formtools.wizard import storage\n+\n+\n+class SessionStorage(storage.BaseStorage):\n+\n+    def __init__(self, *args, **kwargs):\n+        super(SessionStorage, self).__init__(*args, **kwargs)\n+        if self.prefix not in self.request.session:\n+            self.init_data()\n+\n+    def _get_data(self):\n+        self.request.session.modified = True\n+        return self.request.session[self.prefix]\n+\n+    def _set_data(self, value):\n+        self.request.session[self.prefix] = value\n+        self.request.session.modified = True\n+\n+    data = property(_get_data, _set_data)"
        },
        {
            "sha": "b98e58d1c7eace0b5db048c9c2bf33a3ef18a4fd",
            "filename": "django/contrib/formtools/wizard/templates/formtools/wizard/wizard_form.html",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftemplates%2Fformtools%2Fwizard%2Fwizard_form.html",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftemplates%2Fformtools%2Fwizard%2Fwizard_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftemplates%2Fformtools%2Fwizard%2Fwizard_form.html?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,17 @@\n+{% load i18n %}\n+{% csrf_token %}\n+{{ wizard.management_form }}\n+{% if wizard.form.forms %}\n+    {{ wizard.form.management_form }}\n+    {% for form in wizard.form.forms %}\n+        {{ form.as_p }}\n+    {% endfor %}\n+{% else %}\n+    {{ wizard.form.as_p }}\n+{% endif %}\n+\n+{% if wizard.steps.prev %}\n+<button name=\"wizard_prev_step\" value=\"{{ wizard.steps.first }}\">{% trans \"first step\" %}</button>\n+<button name=\"wizard_prev_step\" value=\"{{ wizard.steps.prev }}\">{% trans \"prev step\" %}</button>\n+{% endif %}\n+<input type=\"submit\" name=\"submit\" value=\"{% trans \"submit\" %}\" />"
        },
        {
            "sha": "7c66c82efc9300741bb183e39acb724e1ab77a37",
            "filename": "django/contrib/formtools/wizard/tests/__init__.py",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2F__init__.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,6 @@\n+from django.contrib.formtools.wizard.tests.formtests import *\n+from django.contrib.formtools.wizard.tests.sessionstoragetests import *\n+from django.contrib.formtools.wizard.tests.cookiestoragetests import *\n+from django.contrib.formtools.wizard.tests.loadstoragetests import *\n+from django.contrib.formtools.wizard.tests.wizardtests import *\n+from django.contrib.formtools.wizard.tests.namedwizardtests import *"
        },
        {
            "sha": "74c7e822b4aba38e11235464b289cdb9258f56c9",
            "filename": "django/contrib/formtools/wizard/tests/cookiestoragetests.py",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fcookiestoragetests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fcookiestoragetests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fcookiestoragetests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,43 @@\n+from django.test import TestCase\n+from django.core import signing\n+from django.core.exceptions import SuspiciousOperation\n+from django.http import HttpResponse\n+\n+from django.contrib.formtools.wizard.storage.cookie import CookieStorage\n+from django.contrib.formtools.wizard.tests.storagetests import get_request, TestStorage\n+\n+class TestCookieStorage(TestStorage, TestCase):\n+    def get_storage(self):\n+        return CookieStorage\n+\n+    def test_manipulated_cookie(self):\n+        request = get_request()\n+        storage = self.get_storage()('wizard1', request, None)\n+\n+        cookie_signer = signing.get_cookie_signer(storage.prefix)\n+\n+        storage.request.COOKIES[storage.prefix] = cookie_signer.sign(\n+            storage.encoder.encode({'key1': 'value1'}))\n+\n+        self.assertEqual(storage.load_data(), {'key1': 'value1'})\n+\n+        storage.request.COOKIES[storage.prefix] = 'i_am_manipulated'\n+        self.assertRaises(SuspiciousOperation, storage.load_data)\n+\n+    def test_reset_cookie(self):\n+        request = get_request()\n+        storage = self.get_storage()('wizard1', request, None)\n+\n+        storage.data = {'key1': 'value1'}\n+\n+        response = HttpResponse()\n+        storage.update_response(response)\n+\n+        cookie_signer = signing.get_cookie_signer(storage.prefix)\n+        signed_cookie_data = cookie_signer.sign(storage.encoder.encode(storage.data))\n+        self.assertEqual(response.cookies[storage.prefix].value, signed_cookie_data)\n+\n+        storage.init_data()\n+        storage.update_response(response)\n+        unsigned_cookie_data = cookie_signer.unsign(response.cookies[storage.prefix].value)\n+        self.assertEqual(unsigned_cookie_data, '{\"step_files\":{},\"step\":null,\"extra_data\":{},\"step_data\":{}}')"
        },
        {
            "sha": "111981fea2849ec9cc4bcadd7d3651056f16a8c5",
            "filename": "django/contrib/formtools/wizard/tests/formtests.py",
            "status": "added",
            "additions": 182,
            "deletions": 0,
            "changes": 182,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fformtests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fformtests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fformtests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,182 @@\n+from django import forms, http\n+from django.conf import settings\n+from django.test import TestCase\n+from django.template.response import TemplateResponse\n+from django.utils.importlib import import_module\n+\n+from django.contrib.auth.models import User\n+\n+from django.contrib.formtools.wizard.views import (WizardView,\n+                                                   SessionWizardView,\n+                                                   CookieWizardView)\n+\n+\n+class DummyRequest(http.HttpRequest):\n+    def __init__(self, POST=None):\n+        super(DummyRequest, self).__init__()\n+        self.method = POST and \"POST\" or \"GET\"\n+        if POST is not None:\n+            self.POST.update(POST)\n+        self.session = {}\n+        self._dont_enforce_csrf_checks = True\n+\n+def get_request(*args, **kwargs):\n+    request = DummyRequest(*args, **kwargs)\n+    engine = import_module(settings.SESSION_ENGINE)\n+    request.session = engine.SessionStore(None)\n+    return request\n+\n+class Step1(forms.Form):\n+    name = forms.CharField()\n+\n+class Step2(forms.Form):\n+    name = forms.CharField()\n+\n+class Step3(forms.Form):\n+    data = forms.CharField()\n+\n+class UserForm(forms.ModelForm):\n+    class Meta:\n+        model = User\n+\n+UserFormSet = forms.models.modelformset_factory(User, form=UserForm, extra=2)\n+\n+class TestWizard(WizardView):\n+    storage_name = 'django.contrib.formtools.wizard.storage.session.SessionStorage'\n+\n+    def dispatch(self, request, *args, **kwargs):\n+        response = super(TestWizard, self).dispatch(request, *args, **kwargs)\n+        return response, self\n+\n+class FormTests(TestCase):\n+    def test_form_init(self):\n+        testform = TestWizard.get_initkwargs([Step1, Step2])\n+        self.assertEquals(testform['form_list'], {u'0': Step1, u'1': Step2})\n+\n+        testform = TestWizard.get_initkwargs([('start', Step1), ('step2', Step2)])\n+        self.assertEquals(\n+            testform['form_list'], {u'start': Step1, u'step2': Step2})\n+\n+        testform = TestWizard.get_initkwargs([Step1, Step2, ('finish', Step3)])\n+        self.assertEquals(\n+            testform['form_list'], {u'0': Step1, u'1': Step2, u'finish': Step3})\n+\n+    def test_first_step(self):\n+        request = get_request()\n+\n+        testform = TestWizard.as_view([Step1, Step2])\n+        response, instance = testform(request)\n+        self.assertEquals(instance.steps.current, u'0')\n+\n+        testform = TestWizard.as_view([('start', Step1), ('step2', Step2)])\n+        response, instance = testform(request)\n+\n+        self.assertEquals(instance.steps.current, 'start')\n+\n+    def test_persistence(self):\n+        testform = TestWizard.as_view([('start', Step1), ('step2', Step2)])\n+        request = get_request({'test_wizard-current_step': 'start',\n+                               'name': 'data1'})\n+        response, instance = testform(request)\n+        self.assertEquals(instance.steps.current, 'start')\n+\n+        instance.storage.current_step = 'step2'\n+\n+        testform2 = TestWizard.as_view([('start', Step1), ('step2', Step2)])\n+        request.POST = {'test_wizard-current_step': 'step2'}\n+        response, instance = testform2(request)\n+        self.assertEquals(instance.steps.current, 'step2')\n+\n+    def test_form_condition(self):\n+        request = get_request()\n+\n+        testform = TestWizard.as_view(\n+            [('start', Step1), ('step2', Step2), ('step3', Step3)],\n+            condition_dict={'step2': True})\n+        response, instance = testform(request)\n+        self.assertEquals(instance.get_next_step(), 'step2')\n+\n+        testform = TestWizard.as_view(\n+            [('start', Step1), ('step2', Step2), ('step3', Step3)],\n+            condition_dict={'step2': False})\n+        response, instance = testform(request)\n+        self.assertEquals(instance.get_next_step(), 'step3')\n+\n+    def test_form_prefix(self):\n+        request = get_request()\n+\n+        testform = TestWizard.as_view([('start', Step1), ('step2', Step2)])\n+        response, instance = testform(request)\n+\n+        self.assertEqual(instance.get_form_prefix(), 'start')\n+        self.assertEqual(instance.get_form_prefix('another'), 'another')\n+\n+    def test_form_initial(self):\n+        request = get_request()\n+\n+        testform = TestWizard.as_view([('start', Step1), ('step2', Step2)],\n+            initial_dict={'start': {'name': 'value1'}})\n+        response, instance = testform(request)\n+\n+        self.assertEqual(instance.get_form_initial('start'), {'name': 'value1'})\n+        self.assertEqual(instance.get_form_initial('step2'), {})\n+\n+    def test_form_instance(self):\n+        request = get_request()\n+        the_instance = User()\n+        testform = TestWizard.as_view([('start', UserForm), ('step2', Step2)],\n+            instance_dict={'start': the_instance})\n+        response, instance = testform(request)\n+\n+        self.assertEqual(\n+            instance.get_form_instance('start'),\n+            the_instance)\n+        self.assertEqual(\n+            instance.get_form_instance('non_exist_instance'),\n+            None)\n+\n+    def test_formset_instance(self):\n+        request = get_request()\n+        the_instance1, created = User.objects.get_or_create(\n+            username='testuser1')\n+        the_instance2, created = User.objects.get_or_create(\n+            username='testuser2')\n+        testform = TestWizard.as_view([('start', UserFormSet), ('step2', Step2)],\n+            instance_dict={'start': User.objects.filter(username='testuser1')})\n+        response, instance = testform(request)\n+\n+        self.assertEqual(list(instance.get_form_instance('start')), [the_instance1])\n+        self.assertEqual(instance.get_form_instance('non_exist_instance'), None)\n+\n+        self.assertEqual(instance.get_form().initial_form_count(), 1)\n+\n+    def test_done(self):\n+        request = get_request()\n+\n+        testform = TestWizard.as_view([('start', Step1), ('step2', Step2)])\n+        response, instance = testform(request)\n+\n+        self.assertRaises(NotImplementedError, instance.done, None)\n+\n+    def test_revalidation(self):\n+        request = get_request()\n+\n+        testform = TestWizard.as_view([('start', Step1), ('step2', Step2)])\n+        response, instance = testform(request)\n+        instance.render_done(None)\n+        self.assertEqual(instance.storage.current_step, 'start')\n+\n+\n+class SessionFormTests(TestCase):\n+    def test_init(self):\n+        request = get_request()\n+        testform = SessionWizardView.as_view([('start', Step1)])\n+        self.assertTrue(isinstance(testform(request), TemplateResponse))\n+\n+\n+class CookieFormTests(TestCase):\n+    def test_init(self):\n+        request = get_request()\n+        testform = CookieWizardView.as_view([('start', Step1)])\n+        self.assertTrue(isinstance(testform(request), TemplateResponse))\n+"
        },
        {
            "sha": "267dee0379ec128234d0100f296c314205dc08b1",
            "filename": "django/contrib/formtools/wizard/tests/loadstoragetests.py",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Floadstoragetests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Floadstoragetests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Floadstoragetests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,22 @@\n+from django.test import TestCase\n+\n+from django.contrib.formtools.wizard.storage import (get_storage,\n+                                                     MissingStorageModule,\n+                                                     MissingStorageClass)\n+from django.contrib.formtools.wizard.storage.base import BaseStorage\n+\n+\n+class TestLoadStorage(TestCase):\n+    def test_load_storage(self):\n+        self.assertEqual(\n+            type(get_storage('django.contrib.formtools.wizard.storage.base.BaseStorage', 'wizard1')),\n+            BaseStorage)\n+\n+    def test_missing_module(self):\n+        self.assertRaises(MissingStorageModule, get_storage,\n+            'django.contrib.formtools.wizard.storage.idontexist.IDontExistStorage', 'wizard1')\n+\n+    def test_missing_class(self):\n+        self.assertRaises(MissingStorageClass, get_storage,\n+            'django.contrib.formtools.wizard.storage.base.IDontExistStorage', 'wizard1')\n+"
        },
        {
            "sha": "4387356730dcd5b99833269426a367c83e74556c",
            "filename": "django/contrib/formtools/wizard/tests/namedwizardtests/__init__.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2F__init__.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1 @@\n+from django.contrib.formtools.wizard.tests.namedwizardtests.tests import *\r\n\\ No newline at end of file"
        },
        {
            "sha": "ae981269f8959bbbc6ce3a82f93a5303d77a9319",
            "filename": "django/contrib/formtools/wizard/tests/namedwizardtests/forms.py",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Fforms.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,42 @@\n+from django import forms\n+from django.forms.formsets import formset_factory\n+from django.http import HttpResponse\n+from django.template import Template, Context\n+\n+from django.contrib.auth.models import User\n+\n+from django.contrib.formtools.wizard.views import NamedUrlWizardView\n+\n+class Page1(forms.Form):\n+    name = forms.CharField(max_length=100)\n+    user = forms.ModelChoiceField(queryset=User.objects.all())\n+    thirsty = forms.NullBooleanField()\n+\n+class Page2(forms.Form):\n+    address1 = forms.CharField(max_length=100)\n+    address2 = forms.CharField(max_length=100)\n+\n+class Page3(forms.Form):\n+    random_crap = forms.CharField(max_length=100)\n+\n+Page4 = formset_factory(Page3, extra=2)\n+\n+class ContactWizard(NamedUrlWizardView):\n+    def done(self, form_list, **kwargs):\n+        c = Context({\n+            'form_list': [x.cleaned_data for x in form_list],\n+            'all_cleaned_data': self.get_all_cleaned_data()\n+        })\n+\n+        for form in self.form_list.keys():\n+            c[form] = self.get_cleaned_data_for_step(form)\n+\n+        c['this_will_fail'] = self.get_cleaned_data_for_step('this_will_fail')\n+        return HttpResponse(Template('').render(c))\n+\n+class SessionContactWizard(ContactWizard):\n+    storage_name = 'django.contrib.formtools.wizard.storage.session.SessionStorage'\n+\n+class CookieContactWizard(ContactWizard):\n+    storage_name = 'django.contrib.formtools.wizard.storage.cookie.CookieStorage'\n+"
        },
        {
            "sha": "cc442d7294bf88566833adfe575602391152737a",
            "filename": "django/contrib/formtools/wizard/tests/namedwizardtests/tests.py",
            "status": "added",
            "additions": 355,
            "deletions": 0,
            "changes": 355,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Ftests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,355 @@\n+import os\n+\n+from django.core.urlresolvers import reverse\n+from django.http import QueryDict\n+from django.test import TestCase\n+from django.conf import settings\n+\n+from django.contrib.auth.models import User\n+\n+from django.contrib.formtools import wizard\n+\n+from django.contrib.formtools.wizard.views import (NamedUrlSessionWizardView,\n+                                                   NamedUrlCookieWizardView)\n+from django.contrib.formtools.wizard.tests.formtests import (get_request,\n+                                                             Step1,\n+                                                             Step2)\n+\n+class NamedWizardTests(object):\n+    urls = 'django.contrib.formtools.wizard.tests.namedwizardtests.urls'\n+\n+    def setUp(self):\n+        self.testuser, created = User.objects.get_or_create(username='testuser1')\n+        self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n+\n+        wizard_template_dirs = [os.path.join(os.path.dirname(wizard.__file__), 'templates')]\n+        settings.TEMPLATE_DIRS = list(settings.TEMPLATE_DIRS) + wizard_template_dirs\n+\n+    def tearDown(self):\n+        del settings.TEMPLATE_DIRS[-1]\n+\n+    def test_initial_call(self):\n+        response = self.client.get(reverse('%s_start' % self.wizard_urlname))\n+        self.assertEqual(response.status_code, 302)\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+        wizard = response.context['wizard']\n+        self.assertEqual(wizard['steps'].current, 'form1')\n+        self.assertEqual(wizard['steps'].step0, 0)\n+        self.assertEqual(wizard['steps'].step1, 1)\n+        self.assertEqual(wizard['steps'].last, 'form4')\n+        self.assertEqual(wizard['steps'].prev, None)\n+        self.assertEqual(wizard['steps'].next, 'form2')\n+        self.assertEqual(wizard['steps'].count, 4)\n+\n+    def test_initial_call_with_params(self):\n+        get_params = {'getvar1': 'getval1', 'getvar2': 'getval2'}\n+        response = self.client.get(reverse('%s_start' % self.wizard_urlname),\n+                                   get_params)\n+        self.assertEqual(response.status_code, 302)\n+\n+        # Test for proper redirect GET parameters\n+        location = response['Location']\n+        self.assertNotEqual(location.find('?'), -1)\n+        querydict = QueryDict(location[location.find('?') + 1:])\n+        self.assertEqual(dict(querydict.items()), get_params)\n+\n+    def test_form_post_error(self):\n+        response = self.client.post(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}),\n+            self.wizard_step_1_data)\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+        self.assertEqual(response.context['wizard']['form'].errors,\n+                         {'name': [u'This field is required.'],\n+                          'user': [u'This field is required.']})\n+\n+    def test_form_post_success(self):\n+        response = self.client.post(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}),\n+            self.wizard_step_data[0])\n+        response = self.client.get(response['Location'])\n+\n+        self.assertEqual(response.status_code, 200)\n+        wizard = response.context['wizard']\n+        self.assertEqual(wizard['steps'].current, 'form2')\n+        self.assertEqual(wizard['steps'].step0, 1)\n+        self.assertEqual(wizard['steps'].prev, 'form1')\n+        self.assertEqual(wizard['steps'].next, 'form3')\n+\n+    def test_form_stepback(self):\n+        response = self.client.get(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}))\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}),\n+            self.wizard_step_data[0])\n+        response = self.client.get(response['Location'])\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname, kwargs={\n+                'step': response.context['wizard']['steps'].current\n+            }), {'wizard_prev_step': response.context['wizard']['steps'].prev})\n+        response = self.client.get(response['Location'])\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+    def test_form_jump(self):\n+        response = self.client.get(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}))\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+        response = self.client.get(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form3'}))\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n+\n+    def test_form_finish(self):\n+        response = self.client.get(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}))\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[0])\n+        response = self.client.get(response['Location'])\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[1])\n+        response = self.client.get(response['Location'])\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[2])\n+        response = self.client.get(response['Location'])\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form4')\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[3])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        self.assertEqual(response.context['form_list'], [\n+            {'name': u'Pony', 'thirsty': True, 'user': self.testuser},\n+            {'address1': u'123 Main St', 'address2': u'Djangoland'},\n+            {'random_crap': u'blah blah'},\n+            [{'random_crap': u'blah blah'}, {'random_crap': u'blah blah'}]])\n+\n+    def test_cleaned_data(self):\n+        response = self.client.get(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}))\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[0])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[1])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[2])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[3])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        self.assertEqual(\n+            response.context['all_cleaned_data'],\n+            {'name': u'Pony', 'thirsty': True, 'user': self.testuser,\n+             'address1': u'123 Main St', 'address2': u'Djangoland',\n+             'random_crap': u'blah blah', 'formset-form4': [\n+                 {'random_crap': u'blah blah'},\n+                 {'random_crap': u'blah blah'}\n+             ]})\n+\n+    def test_manipulated_data(self):\n+        response = self.client.get(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}))\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[0])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[1])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[2])\n+        loc = response['Location']\n+        response = self.client.get(loc)\n+        self.assertEqual(response.status_code, 200, loc)\n+\n+        self.client.cookies.pop('sessionid', None)\n+        self.client.cookies.pop('wizard_cookie_contact_wizard', None)\n+\n+        response = self.client.post(\n+            reverse(self.wizard_urlname,\n+                    kwargs={'step': response.context['wizard']['steps'].current}),\n+            self.wizard_step_data[3])\n+\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+    def test_form_reset(self):\n+        response = self.client.post(\n+            reverse(self.wizard_urlname, kwargs={'step': 'form1'}),\n+            self.wizard_step_data[0])\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        response = self.client.get(\n+            '%s?reset=1' % reverse('%s_start' % self.wizard_urlname))\n+        self.assertEqual(response.status_code, 302)\n+\n+        response = self.client.get(response['Location'])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+class NamedSessionWizardTests(NamedWizardTests, TestCase):\n+    wizard_urlname = 'nwiz_session'\n+    wizard_step_1_data = {\n+        'session_contact_wizard-current_step': 'form1',\n+    }\n+    wizard_step_data = (\n+        {\n+            'form1-name': 'Pony',\n+            'form1-thirsty': '2',\n+            'session_contact_wizard-current_step': 'form1',\n+        },\n+        {\n+            'form2-address1': '123 Main St',\n+            'form2-address2': 'Djangoland',\n+            'session_contact_wizard-current_step': 'form2',\n+        },\n+        {\n+            'form3-random_crap': 'blah blah',\n+            'session_contact_wizard-current_step': 'form3',\n+        },\n+        {\n+            'form4-INITIAL_FORMS': '0',\n+            'form4-TOTAL_FORMS': '2',\n+            'form4-MAX_NUM_FORMS': '0',\n+            'form4-0-random_crap': 'blah blah',\n+            'form4-1-random_crap': 'blah blah',\n+            'session_contact_wizard-current_step': 'form4',\n+        }\n+    )\n+\n+class NamedCookieWizardTests(NamedWizardTests, TestCase):\n+    wizard_urlname = 'nwiz_cookie'\n+    wizard_step_1_data = {\n+        'cookie_contact_wizard-current_step': 'form1',\n+    }\n+    wizard_step_data = (\n+        {\n+            'form1-name': 'Pony',\n+            'form1-thirsty': '2',\n+            'cookie_contact_wizard-current_step': 'form1',\n+        },\n+        {\n+            'form2-address1': '123 Main St',\n+            'form2-address2': 'Djangoland',\n+            'cookie_contact_wizard-current_step': 'form2',\n+        },\n+        {\n+            'form3-random_crap': 'blah blah',\n+            'cookie_contact_wizard-current_step': 'form3',\n+        },\n+        {\n+            'form4-INITIAL_FORMS': '0',\n+            'form4-TOTAL_FORMS': '2',\n+            'form4-MAX_NUM_FORMS': '0',\n+            'form4-0-random_crap': 'blah blah',\n+            'form4-1-random_crap': 'blah blah',\n+            'cookie_contact_wizard-current_step': 'form4',\n+        }\n+    )\n+\n+\n+class NamedFormTests(object):\n+    urls = 'django.contrib.formtools.wizard.tests.namedwizardtests.urls'\n+\n+    def test_revalidation(self):\n+        request = get_request()\n+\n+        testform = self.formwizard_class.as_view(\n+            [('start', Step1), ('step2', Step2)],\n+            url_name=self.wizard_urlname)\n+        response, instance = testform(request, step='done')\n+\n+        instance.render_done(None)\n+        self.assertEqual(instance.storage.current_step, 'start')\n+\n+class TestNamedUrlSessionFormWizard(NamedUrlSessionWizardView):\n+\n+    def dispatch(self, request, *args, **kwargs):\n+        response = super(TestNamedUrlSessionFormWizard, self).dispatch(request, *args, **kwargs)\n+        return response, self\n+\n+class TestNamedUrlCookieFormWizard(NamedUrlCookieWizardView):\n+\n+    def dispatch(self, request, *args, **kwargs):\n+        response = super(TestNamedUrlCookieFormWizard, self).dispatch(request, *args, **kwargs)\n+        return response, self\n+\n+\n+class NamedSessionFormTests(NamedFormTests, TestCase):\n+    formwizard_class = TestNamedUrlSessionFormWizard\n+    wizard_urlname = 'nwiz_session'\n+\n+\n+class NamedCookieFormTests(NamedFormTests, TestCase):\n+    formwizard_class = TestNamedUrlCookieFormWizard\n+    wizard_urlname = 'nwiz_cookie'"
        },
        {
            "sha": "a97ca98c1bcd5d4dd81ee199e955e2deda97feb5",
            "filename": "django/contrib/formtools/wizard/tests/namedwizardtests/urls.py",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fnamedwizardtests%2Furls.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,24 @@\n+from django.conf.urls.defaults import *\n+from django.contrib.formtools.wizard.tests.namedwizardtests.forms import (\n+    SessionContactWizard, CookieContactWizard, Page1, Page2, Page3, Page4)\n+\n+def get_named_session_wizard():\n+    return SessionContactWizard.as_view(\n+        [('form1', Page1), ('form2', Page2), ('form3', Page3), ('form4', Page4)],\n+        url_name='nwiz_session',\n+        done_step_name='nwiz_session_done'\n+    )\n+\n+def get_named_cookie_wizard():\n+    return CookieContactWizard.as_view(\n+        [('form1', Page1), ('form2', Page2), ('form3', Page3), ('form4', Page4)],\n+        url_name='nwiz_cookie',\n+        done_step_name='nwiz_cookie_done'\n+    )\n+\n+urlpatterns = patterns('',\n+    url(r'^nwiz_session/(?P<step>.+)/$', get_named_session_wizard(), name='nwiz_session'),\n+    url(r'^nwiz_session/$', get_named_session_wizard(), name='nwiz_session_start'),\n+    url(r'^nwiz_cookie/(?P<step>.+)/$', get_named_cookie_wizard(), name='nwiz_cookie'),\n+    url(r'^nwiz_cookie/$', get_named_cookie_wizard(), name='nwiz_cookie_start'),\n+)"
        },
        {
            "sha": "c643921a40ebbcd00fa84dcc42206b3de019ba93",
            "filename": "django/contrib/formtools/wizard/tests/sessionstoragetests.py",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fsessionstoragetests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fsessionstoragetests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fsessionstoragetests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,8 @@\n+from django.test import TestCase\n+\n+from django.contrib.formtools.wizard.tests.storagetests import TestStorage\n+from django.contrib.formtools.wizard.storage.session import SessionStorage\n+\n+class TestSessionStorage(TestStorage, TestCase):\n+    def get_storage(self):\n+        return SessionStorage"
        },
        {
            "sha": "fec4fae0eff8e985212ed85e8cc0a5ffc270def3",
            "filename": "django/contrib/formtools/wizard/tests/storagetests.py",
            "status": "added",
            "additions": 76,
            "deletions": 0,
            "changes": 76,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fstoragetests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fstoragetests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fstoragetests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,76 @@\n+from datetime import datetime\n+\n+from django.http import HttpRequest\n+from django.conf import settings\n+from django.utils.importlib import import_module\n+\n+from django.contrib.auth.models import User\n+\n+def get_request():\n+    request = HttpRequest()\n+    engine = import_module(settings.SESSION_ENGINE)\n+    request.session = engine.SessionStore(None)\n+    return request\n+\n+class TestStorage(object):\n+    def setUp(self):\n+        self.testuser, created = User.objects.get_or_create(username='testuser1')\n+\n+    def test_current_step(self):\n+        request = get_request()\n+        storage = self.get_storage()('wizard1', request, None)\n+        my_step = 2\n+\n+        self.assertEqual(storage.current_step, None)\n+\n+        storage.current_step = my_step\n+        self.assertEqual(storage.current_step, my_step)\n+\n+        storage.reset()\n+        self.assertEqual(storage.current_step, None)\n+\n+        storage.current_step = my_step\n+        storage2 = self.get_storage()('wizard2', request, None)\n+        self.assertEqual(storage2.current_step, None)\n+\n+    def test_step_data(self):\n+        request = get_request()\n+        storage = self.get_storage()('wizard1', request, None)\n+        step1 = 'start'\n+        step_data1 = {'field1': 'data1',\n+                      'field2': 'data2',\n+                      'field3': datetime.now(),\n+                      'field4': self.testuser}\n+\n+        self.assertEqual(storage.get_step_data(step1), None)\n+\n+        storage.set_step_data(step1, step_data1)\n+        self.assertEqual(storage.get_step_data(step1), step_data1)\n+\n+        storage.reset()\n+        self.assertEqual(storage.get_step_data(step1), None)\n+\n+        storage.set_step_data(step1, step_data1)\n+        storage2 = self.get_storage()('wizard2', request, None)\n+        self.assertEqual(storage2.get_step_data(step1), None)\n+\n+    def test_extra_context(self):\n+        request = get_request()\n+        storage = self.get_storage()('wizard1', request, None)\n+        extra_context = {'key1': 'data1',\n+                         'key2': 'data2',\n+                         'key3': datetime.now(),\n+                         'key4': self.testuser}\n+\n+        self.assertEqual(storage.extra_data, {})\n+\n+        storage.extra_data = extra_context\n+        self.assertEqual(storage.extra_data, extra_context)\n+\n+        storage.reset()\n+        self.assertEqual(storage.extra_data, {})\n+\n+        storage.extra_data = extra_context\n+        storage2 = self.get_storage()('wizard2', request, None)\n+        self.assertEqual(storage2.extra_data, {})\n+"
        },
        {
            "sha": "9173cd86d962b7b60523a9b9fccb9a65e9be0b9a",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/__init__.py",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2F__init__.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1 @@\n+from django.contrib.formtools.wizard.tests.wizardtests.tests import *\r\n\\ No newline at end of file"
        },
        {
            "sha": "726d74abee9360fa30e6746891d2c5eacc7c32e5",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/forms.py",
            "status": "added",
            "additions": 57,
            "deletions": 0,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Fforms.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,57 @@\n+import tempfile\n+\n+from django import forms\n+from django.core.files.storage import FileSystemStorage\n+from django.forms.formsets import formset_factory\n+from django.http import HttpResponse\n+from django.template import Template, Context\n+\n+from django.contrib.auth.models import User\n+\n+from django.contrib.formtools.wizard.views import WizardView\n+\n+temp_storage_location = tempfile.mkdtemp()\n+temp_storage = FileSystemStorage(location=temp_storage_location)\n+\n+class Page1(forms.Form):\n+    name = forms.CharField(max_length=100)\n+    user = forms.ModelChoiceField(queryset=User.objects.all())\n+    thirsty = forms.NullBooleanField()\n+\n+class Page2(forms.Form):\n+    address1 = forms.CharField(max_length=100)\n+    address2 = forms.CharField(max_length=100)\n+    file1 = forms.FileField()\n+\n+class Page3(forms.Form):\n+    random_crap = forms.CharField(max_length=100)\n+\n+Page4 = formset_factory(Page3, extra=2)\n+\n+class ContactWizard(WizardView):\n+    file_storage = temp_storage\n+\n+    def done(self, form_list, **kwargs):\n+        c = Context({\n+            'form_list': [x.cleaned_data for x in form_list],\n+            'all_cleaned_data': self.get_all_cleaned_data()\n+        })\n+\n+        for form in self.form_list.keys():\n+            c[form] = self.get_cleaned_data_for_step(form)\n+\n+        c['this_will_fail'] = self.get_cleaned_data_for_step('this_will_fail')\n+        return HttpResponse(Template('').render(c))\n+\n+    def get_context_data(self, form, **kwargs):\n+        context = super(ContactWizard, self).get_context_data(form, **kwargs)\n+        if self.storage.current_step == 'form2':\n+            context.update({'another_var': True})\n+        return context\n+\n+class SessionContactWizard(ContactWizard):\n+    storage_name = 'django.contrib.formtools.wizard.storage.session.SessionStorage'\n+\n+class CookieContactWizard(ContactWizard):\n+    storage_name = 'django.contrib.formtools.wizard.storage.cookie.CookieStorage'\n+"
        },
        {
            "sha": "f64b2ba3033ca4a809ee49cfc8c4e43a8dffabbb",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/tests.py",
            "status": "added",
            "additions": 248,
            "deletions": 0,
            "changes": 248,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Ftests.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,248 @@\n+import os\n+\n+from django.test import TestCase\n+from django.conf import settings\n+from django.contrib.auth.models import User\n+\n+from django.contrib.formtools import wizard\n+\n+class WizardTests(object):\n+    urls = 'django.contrib.formtools.wizard.tests.wizardtests.urls'\n+\n+    def setUp(self):\n+        self.testuser, created = User.objects.get_or_create(username='testuser1')\n+        self.wizard_step_data[0]['form1-user'] = self.testuser.pk\n+\n+        wizard_template_dirs = [os.path.join(os.path.dirname(wizard.__file__), 'templates')]\n+        settings.TEMPLATE_DIRS = list(settings.TEMPLATE_DIRS) + wizard_template_dirs\n+\n+    def tearDown(self):\n+        del settings.TEMPLATE_DIRS[-1]\n+\n+    def test_initial_call(self):\n+        response = self.client.get(self.wizard_url)\n+        wizard = response.context['wizard']\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(wizard['steps'].current, 'form1')\n+        self.assertEqual(wizard['steps'].step0, 0)\n+        self.assertEqual(wizard['steps'].step1, 1)\n+        self.assertEqual(wizard['steps'].last, 'form4')\n+        self.assertEqual(wizard['steps'].prev, None)\n+        self.assertEqual(wizard['steps'].next, 'form2')\n+        self.assertEqual(wizard['steps'].count, 4)\n+\n+    def test_form_post_error(self):\n+        response = self.client.post(self.wizard_url, self.wizard_step_1_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+        self.assertEqual(response.context['wizard']['form'].errors,\n+                         {'name': [u'This field is required.'],\n+                          'user': [u'This field is required.']})\n+\n+    def test_form_post_success(self):\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        wizard = response.context['wizard']\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(wizard['steps'].current, 'form2')\n+        self.assertEqual(wizard['steps'].step0, 1)\n+        self.assertEqual(wizard['steps'].prev, 'form1')\n+        self.assertEqual(wizard['steps'].next, 'form3')\n+\n+    def test_form_stepback(self):\n+        response = self.client.get(self.wizard_url)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        response = self.client.post(self.wizard_url, {\n+            'wizard_prev_step': response.context['wizard']['steps'].prev})\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+    def test_template_context(self):\n+        response = self.client.get(self.wizard_url)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+        self.assertEqual(response.context.get('another_var', None), None)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+        self.assertEqual(response.context.get('another_var', None), True)\n+\n+    def test_form_finish(self):\n+        response = self.client.get(self.wizard_url)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'] = open(__file__)\n+        response = self.client.post(self.wizard_url, post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[2])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form4')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[3])\n+        self.assertEqual(response.status_code, 200)\n+\n+        all_data = response.context['form_list']\n+        self.assertEqual(all_data[1]['file1'].read(), open(__file__).read())\n+        del all_data[1]['file1']\n+        self.assertEqual(all_data, [\n+            {'name': u'Pony', 'thirsty': True, 'user': self.testuser},\n+            {'address1': u'123 Main St', 'address2': u'Djangoland'},\n+            {'random_crap': u'blah blah'},\n+            [{'random_crap': u'blah blah'},\n+             {'random_crap': u'blah blah'}]])\n+\n+    def test_cleaned_data(self):\n+        response = self.client.get(self.wizard_url)\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+\n+        post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'] = open(__file__)\n+        response = self.client.post(self.wizard_url, post_data)\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[2])\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[3])\n+        self.assertEqual(response.status_code, 200)\n+\n+        all_data = response.context['all_cleaned_data']\n+        self.assertEqual(all_data['file1'].read(), open(__file__).read())\n+        del all_data['file1']\n+        self.assertEqual(all_data, {\n+            'name': u'Pony', 'thirsty': True, 'user': self.testuser,\n+            'address1': u'123 Main St', 'address2': u'Djangoland',\n+            'random_crap': u'blah blah', 'formset-form4': [\n+                {'random_crap': u'blah blah'},\n+                {'random_crap': u'blah blah'}]})\n+\n+    def test_manipulated_data(self):\n+        response = self.client.get(self.wizard_url)\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+\n+        post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'] = open(__file__)\n+        response = self.client.post(self.wizard_url, post_data)\n+        self.assertEqual(response.status_code, 200)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[2])\n+        self.assertEqual(response.status_code, 200)\n+        self.client.cookies.pop('sessionid', None)\n+        self.client.cookies.pop('wizard_cookie_contact_wizard', None)\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[3])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+    def test_form_refresh(self):\n+        response = self.client.get(self.wizard_url)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form1')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        post_data = self.wizard_step_data[1]\n+        post_data['form2-file1'] = open(__file__)\n+        response = self.client.post(self.wizard_url, post_data)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form3')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[2])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form4')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[0])\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(response.context['wizard']['steps'].current, 'form2')\n+\n+        response = self.client.post(self.wizard_url, self.wizard_step_data[3])\n+        self.assertEqual(response.status_code, 200)\n+\n+\n+class SessionWizardTests(WizardTests, TestCase):\n+    wizard_url = '/wiz_session/'\n+    wizard_step_1_data = {\n+        'session_contact_wizard-current_step': 'form1',\n+    }\n+    wizard_step_data = (\n+        {\n+            'form1-name': 'Pony',\n+            'form1-thirsty': '2',\n+            'session_contact_wizard-current_step': 'form1',\n+        },\n+        {\n+            'form2-address1': '123 Main St',\n+            'form2-address2': 'Djangoland',\n+            'session_contact_wizard-current_step': 'form2',\n+        },\n+        {\n+            'form3-random_crap': 'blah blah',\n+            'session_contact_wizard-current_step': 'form3',\n+        },\n+        {\n+            'form4-INITIAL_FORMS': '0',\n+            'form4-TOTAL_FORMS': '2',\n+            'form4-MAX_NUM_FORMS': '0',\n+            'form4-0-random_crap': 'blah blah',\n+            'form4-1-random_crap': 'blah blah',\n+            'session_contact_wizard-current_step': 'form4',\n+        }\n+    )\n+\n+class CookieWizardTests(WizardTests, TestCase):\n+    wizard_url = '/wiz_cookie/'\n+    wizard_step_1_data = {\n+        'cookie_contact_wizard-current_step': 'form1',\n+    }\n+    wizard_step_data = (\n+        {\n+            'form1-name': 'Pony',\n+            'form1-thirsty': '2',\n+            'cookie_contact_wizard-current_step': 'form1',\n+        },\n+        {\n+            'form2-address1': '123 Main St',\n+            'form2-address2': 'Djangoland',\n+            'cookie_contact_wizard-current_step': 'form2',\n+        },\n+        {\n+            'form3-random_crap': 'blah blah',\n+            'cookie_contact_wizard-current_step': 'form3',\n+        },\n+        {\n+            'form4-INITIAL_FORMS': '0',\n+            'form4-TOTAL_FORMS': '2',\n+            'form4-MAX_NUM_FORMS': '0',\n+            'form4-0-random_crap': 'blah blah',\n+            'form4-1-random_crap': 'blah blah',\n+            'cookie_contact_wizard-current_step': 'form4',\n+        }\n+    )\n+\n+"
        },
        {
            "sha": "e305397a3780ed4ca659c5ce49d0a355b7797553",
            "filename": "django/contrib/formtools/wizard/tests/wizardtests/urls.py",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Ftests%2Fwizardtests%2Furls.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,16 @@\n+from django.conf.urls.defaults import *\n+from django.contrib.formtools.wizard.tests.wizardtests.forms import (\n+    SessionContactWizard, CookieContactWizard, Page1, Page2, Page3, Page4)\n+\n+urlpatterns = patterns('',\n+    url(r'^wiz_session/$', SessionContactWizard.as_view(\n+        [('form1', Page1),\n+         ('form2', Page2),\n+         ('form3', Page3),\n+         ('form4', Page4)])),\n+    url(r'^wiz_cookie/$', CookieContactWizard.as_view(\n+        [('form1', Page1),\n+         ('form2', Page2),\n+         ('form3', Page3),\n+         ('form4', Page4)])),\n+)"
        },
        {
            "sha": "c0f8b3b832448007d1b420a2480be7a2a7dfe39c",
            "filename": "django/contrib/formtools/wizard/views.py",
            "status": "added",
            "additions": 684,
            "deletions": 0,
            "changes": 684,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -0,0 +1,684 @@\n+import copy\n+import re\n+\n+from django import forms\n+from django.shortcuts import redirect\n+from django.core.urlresolvers import reverse\n+from django.forms import formsets, ValidationError\n+from django.views.generic import TemplateView\n+from django.utils.datastructures import SortedDict\n+from django.utils.decorators import classonlymethod\n+\n+from django.contrib.formtools.wizard.storage import get_storage\n+from django.contrib.formtools.wizard.storage.exceptions import NoFileStorageConfigured\n+from django.contrib.formtools.wizard.forms import ManagementForm\n+\n+\n+def normalize_name(name):\n+    new = re.sub('(((?<=[a-z])[A-Z])|([A-Z](?![A-Z]|$)))', '_\\\\1', name)\n+    return new.lower().strip('_')\n+\n+class StepsHelper(object):\n+\n+    def __init__(self, wizard):\n+        self._wizard = wizard\n+\n+    def __dir__(self):\n+        return self.all\n+\n+    def __len__(self):\n+        return self.count\n+\n+    def __repr__(self):\n+        return '<StepsHelper for %s (steps: %s)>' % (self._wizard, self.all)\n+\n+    @property\n+    def all(self):\n+        \"Returns the names of all steps/forms.\"\n+        return self._wizard.get_form_list().keys()\n+\n+    @property\n+    def count(self):\n+        \"Returns the total number of steps/forms in this the wizard.\"\n+        return len(self.all)\n+\n+    @property\n+    def current(self):\n+        \"\"\"\n+        Returns the current step. If no current step is stored in the\n+        storage backend, the first step will be returned.\n+        \"\"\"\n+        return self._wizard.storage.current_step or self.first\n+\n+    @property\n+    def first(self):\n+        \"Returns the name of the first step.\"\n+        return self.all[0]\n+\n+    @property\n+    def last(self):\n+        \"Returns the name of the last step.\"\n+        return self.all[-1]\n+\n+    @property\n+    def next(self):\n+        \"Returns the next step.\"\n+        return self._wizard.get_next_step()\n+\n+    @property\n+    def prev(self):\n+        \"Returns the previous step.\"\n+        return self._wizard.get_prev_step()\n+\n+    @property\n+    def index(self):\n+        \"Returns the index for the current step.\"\n+        return self._wizard.get_step_index()\n+\n+    @property\n+    def step0(self):\n+        return int(self.index)\n+\n+    @property\n+    def step1(self):\n+        return int(self.index) + 1\n+\n+\n+class WizardView(TemplateView):\n+    \"\"\"\n+    The WizardView is used to create multi-page forms and handles all the\n+    storage and validation stuff. The wizard is based on Django's generic\n+    class based views.\n+    \"\"\"\n+    storage_name = None\n+    form_list = None\n+    initial_dict = None\n+    instance_dict = None\n+    condition_dict = None\n+    template_name = 'formtools/wizard/wizard_form.html'\n+\n+    def __repr__(self):\n+        return '<%s: forms: %s>' % (self.__class__.__name__, self.form_list)\n+\n+    @classonlymethod\n+    def as_view(cls, *args, **kwargs):\n+        \"\"\"\n+        This method is used within urls.py to create unique formwizard\n+        instances for every request. We need to override this method because\n+        we add some kwargs which are needed to make the formwizard usable.\n+        \"\"\"\n+        initkwargs = cls.get_initkwargs(*args, **kwargs)\n+        return super(WizardView, cls).as_view(**initkwargs)\n+\n+    @classmethod\n+    def get_initkwargs(cls, form_list,\n+            initial_dict=None, instance_dict=None, condition_dict=None):\n+        \"\"\"\n+        Creates a dict with all needed parameters for the form wizard instances.\n+\n+        * `form_list` - is a list of forms. The list entries can be single form\n+          classes or tuples of (`step_name`, `form_class`). If you pass a list\n+          of forms, the formwizard will convert the class list to\n+          (`zero_based_counter`, `form_class`). This is needed to access the\n+          form for a specific step.\n+        * `initial_dict` - contains a dictionary of initial data dictionaries.\n+          The key should be equal to the `step_name` in the `form_list` (or\n+          the str of the zero based counter - if no step_names added in the\n+          `form_list`)\n+        * `instance_dict` - contains a dictionary of instance objects. This list\n+          is only used when `ModelForm`s are used. The key should be equal to\n+          the `step_name` in the `form_list`. Same rules as for `initial_dict`\n+          apply.\n+        * `condition_dict` - contains a dictionary of boolean values or\n+          callables. If the value of for a specific `step_name` is callable it\n+          will be called with the formwizard instance as the only argument.\n+          If the return value is true, the step's form will be used.\n+        \"\"\"\n+        kwargs = {\n+            'initial_dict': initial_dict or {},\n+            'instance_dict': instance_dict or {},\n+            'condition_dict': condition_dict or {},\n+        }\n+        init_form_list = SortedDict()\n+\n+        assert len(form_list) > 0, 'at least one form is needed'\n+\n+        # walk through the passed form list\n+        for i, form in enumerate(form_list):\n+            if isinstance(form, (list, tuple)):\n+                # if the element is a tuple, add the tuple to the new created\n+                # sorted dictionary.\n+                init_form_list[unicode(form[0])] = form[1]\n+            else:\n+                # if not, add the form with a zero based counter as unicode\n+                init_form_list[unicode(i)] = form\n+\n+        # walk through the ne created list of forms\n+        for form in init_form_list.itervalues():\n+            if issubclass(form, formsets.BaseFormSet):\n+                # if the element is based on BaseFormSet (FormSet/ModelFormSet)\n+                # we need to override the form variable.\n+                form = form.form\n+            # check if any form contains a FileField, if yes, we need a\n+            # file_storage added to the formwizard (by subclassing).\n+            for field in form.base_fields.itervalues():\n+                if (isinstance(field, forms.FileField) and\n+                        not hasattr(cls, 'file_storage')):\n+                    raise NoFileStorageConfigured\n+\n+        # build the kwargs for the formwizard instances\n+        kwargs['form_list'] = init_form_list\n+        return kwargs\n+\n+    def get_wizard_name(self):\n+        return normalize_name(self.__class__.__name__)\n+\n+    def get_prefix(self):\n+        # TODO: Add some kind of unique id to prefix\n+        return self.wizard_name\n+\n+    def get_form_list(self):\n+        \"\"\"\n+        This method returns a form_list based on the initial form list but\n+        checks if there is a condition method/value in the condition_list.\n+        If an entry exists in the condition list, it will call/read the value\n+        and respect the result. (True means add the form, False means ignore\n+        the form)\n+\n+        The form_list is always generated on the fly because condition methods\n+        could use data from other (maybe previous forms).\n+        \"\"\"\n+        form_list = SortedDict()\n+        for form_key, form_class in self.form_list.iteritems():\n+            # try to fetch the value from condition list, by default, the form\n+            # gets passed to the new list.\n+            condition = self.condition_dict.get(form_key, True)\n+            if callable(condition):\n+                # call the value if needed, passes the current instance.\n+                condition = condition(self)\n+            if condition:\n+                form_list[form_key] = form_class\n+        return form_list\n+\n+    def dispatch(self, request, *args, **kwargs):\n+        \"\"\"\n+        This method gets called by the routing engine. The first argument is\n+        `request` which contains a `HttpRequest` instance.\n+        The request is stored in `self.request` for later use. The storage\n+        instance is stored in `self.storage`.\n+\n+        After processing the request using the `dispatch` method, the\n+        response gets updated by the storage engine (for example add cookies).\n+        \"\"\"\n+        # add the storage engine to the current formwizard instance\n+        self.wizard_name = self.get_wizard_name()\n+        self.prefix = self.get_prefix()\n+        self.storage = get_storage(self.storage_name, self.prefix, request,\n+            getattr(self, 'file_storage', None))\n+        self.steps = StepsHelper(self)\n+        response = super(WizardView, self).dispatch(request, *args, **kwargs)\n+\n+        # update the response (e.g. adding cookies)\n+        self.storage.update_response(response)\n+        return response\n+\n+    def get(self, request, *args, **kwargs):\n+        \"\"\"\n+        This method handles GET requests.\n+\n+        If a GET request reaches this point, the wizard assumes that the user\n+        just starts at the first step or wants to restart the process.\n+        The data of the wizard will be resetted before rendering the first step.\n+        \"\"\"\n+        self.storage.reset()\n+\n+        # reset the current step to the first step.\n+        self.storage.current_step = self.steps.first\n+        return self.render(self.get_form())\n+\n+    def post(self, *args, **kwargs):\n+        \"\"\"\n+        This method handles POST requests.\n+\n+        The wizard will render either the current step (if form validation\n+        wasn't successful), the next step (if the current step was stored\n+        successful) or the done view (if no more steps are available)\n+        \"\"\"\n+        # Look for a wizard_prev_step element in the posted data which\n+        # contains a valid step name. If one was found, render the requested\n+        # form. (This makes stepping back a lot easier).\n+        wizard_prev_step = self.request.POST.get('wizard_prev_step', None)\n+        if wizard_prev_step and wizard_prev_step in self.get_form_list():\n+            self.storage.current_step = wizard_prev_step\n+            form = self.get_form(\n+                data=self.storage.get_step_data(self.steps.current),\n+                files=self.storage.get_step_files(self.steps.current))\n+            return self.render(form)\n+\n+        # Check if form was refreshed\n+        management_form = ManagementForm(self.request.POST, prefix=self.prefix)\n+        if not management_form.is_valid():\n+            raise ValidationError(\n+                'ManagementForm data is missing or has been tampered.')\n+\n+        form_current_step = management_form.cleaned_data['current_step']\n+        if (form_current_step != self.steps.current and\n+                self.storage.current_step is not None):\n+            # form refreshed, change current step\n+            self.storage.current_step = form_current_step\n+\n+        # get the form for the current step\n+        form = self.get_form(data=self.request.POST, files=self.request.FILES)\n+\n+        # and try to validate\n+        if form.is_valid():\n+            # if the form is valid, store the cleaned data and files.\n+            self.storage.set_step_data(self.steps.current, self.process_step(form))\n+            self.storage.set_step_files(self.steps.current, self.process_step_files(form))\n+\n+            # check if the current step is the last step\n+            if self.steps.current == self.steps.last:\n+                # no more steps, render done view\n+                return self.render_done(form, **kwargs)\n+            else:\n+                # proceed to the next step\n+                return self.render_next_step(form)\n+        return self.render(form)\n+\n+    def render_next_step(self, form, **kwargs):\n+        \"\"\"\n+        THis method gets called when the next step/form should be rendered.\n+        `form` contains the last/current form.\n+        \"\"\"\n+        # get the form instance based on the data from the storage backend\n+        # (if available).\n+        next_step = self.steps.next\n+        new_form = self.get_form(next_step,\n+            data=self.storage.get_step_data(next_step),\n+            files=self.storage.get_step_files(next_step))\n+\n+        # change the stored current step\n+        self.storage.current_step = next_step\n+        return self.render(new_form, **kwargs)\n+\n+    def render_done(self, form, **kwargs):\n+        \"\"\"\n+        This method gets called when all forms passed. The method should also\n+        re-validate all steps to prevent manipulation. If any form don't\n+        validate, `render_revalidation_failure` should get called.\n+        If everything is fine call `done`.\n+        \"\"\"\n+        final_form_list = []\n+        # walk through the form list and try to validate the data again.\n+        for form_key in self.get_form_list():\n+            form_obj = self.get_form(step=form_key,\n+                data=self.storage.get_step_data(form_key),\n+                files=self.storage.get_step_files(form_key))\n+            if not form_obj.is_valid():\n+                return self.render_revalidation_failure(form_key, form_obj, **kwargs)\n+            final_form_list.append(form_obj)\n+\n+        # render the done view and reset the wizard before returning the\n+        # response. This is needed to prevent from rendering done with the\n+        # same data twice.\n+        done_response = self.done(final_form_list, **kwargs)\n+        self.storage.reset()\n+        return done_response\n+\n+    def get_form_prefix(self, step=None, form=None):\n+        \"\"\"\n+        Returns the prefix which will be used when calling the actual form for\n+        the given step. `step` contains the step-name, `form` the form which\n+        will be called with the returned prefix.\n+\n+        If no step is given, the form_prefix will determine the current step\n+        automatically.\n+        \"\"\"\n+        if step is None:\n+            step = self.steps.current\n+        return str(step)\n+\n+    def get_form_initial(self, step):\n+        \"\"\"\n+        Returns a dictionary which will be passed to the form for `step`\n+        as `initial`. If no initial data was provied while initializing the\n+        form wizard, a empty dictionary will be returned.\n+        \"\"\"\n+        return self.initial_dict.get(step, {})\n+\n+    def get_form_instance(self, step):\n+        \"\"\"\n+        Returns a object which will be passed to the form for `step`\n+        as `instance`. If no instance object was provied while initializing\n+        the form wizard, None be returned.\n+        \"\"\"\n+        return self.instance_dict.get(step, None)\n+\n+    def get_form(self, step=None, data=None, files=None):\n+        \"\"\"\n+        Constructs the form for a given `step`. If no `step` is defined, the\n+        current step will be determined automatically.\n+\n+        The form will be initialized using the `data` argument to prefill the\n+        new form. If needed, instance or queryset (for `ModelForm` or\n+        `ModelFormSet`) will be added too.\n+        \"\"\"\n+        if step is None:\n+            step = self.steps.current\n+        # prepare the kwargs for the form instance.\n+        kwargs = {\n+            'data': data,\n+            'files': files,\n+            'prefix': self.get_form_prefix(step, self.form_list[step]),\n+            'initial': self.get_form_initial(step),\n+        }\n+        if issubclass(self.form_list[step], forms.ModelForm):\n+            # If the form is based on ModelForm, add instance if available.\n+            kwargs.update({'instance': self.get_form_instance(step)})\n+        elif issubclass(self.form_list[step], forms.models.BaseModelFormSet):\n+            # If the form is based on ModelFormSet, add queryset if available.\n+            kwargs.update({'queryset': self.get_form_instance(step)})\n+        return self.form_list[step](**kwargs)\n+\n+    def process_step(self, form):\n+        \"\"\"\n+        This method is used to postprocess the form data. By default, it\n+        returns the raw `form.data` dictionary.\n+        \"\"\"\n+        return self.get_form_step_data(form)\n+\n+    def process_step_files(self, form):\n+        \"\"\"\n+        This method is used to postprocess the form files. By default, it\n+        returns the raw `form.files` dictionary.\n+        \"\"\"\n+        return self.get_form_step_files(form)\n+\n+    def render_revalidation_failure(self, step, form, **kwargs):\n+        \"\"\"\n+        Gets called when a form doesn't validate when rendering the done\n+        view. By default, it changed the current step to failing forms step\n+        and renders the form.\n+        \"\"\"\n+        self.storage.current_step = step\n+        return self.render(form, **kwargs)\n+\n+    def get_form_step_data(self, form):\n+        \"\"\"\n+        Is used to return the raw form data. You may use this method to\n+        manipulate the data.\n+        \"\"\"\n+        return form.data\n+\n+    def get_form_step_files(self, form):\n+        \"\"\"\n+        Is used to return the raw form files. You may use this method to\n+        manipulate the data.\n+        \"\"\"\n+        return form.files\n+\n+    def get_all_cleaned_data(self):\n+        \"\"\"\n+        Returns a merged dictionary of all step cleaned_data dictionaries.\n+        If a step contains a `FormSet`, the key will be prefixed with formset\n+        and contain a list of the formset' cleaned_data dictionaries.\n+        \"\"\"\n+        cleaned_data = {}\n+        for form_key in self.get_form_list():\n+            form_obj = self.get_form(\n+                step=form_key,\n+                data=self.storage.get_step_data(form_key),\n+                files=self.storage.get_step_files(form_key)\n+            )\n+            if form_obj.is_valid():\n+                if isinstance(form_obj.cleaned_data, (tuple, list)):\n+                    cleaned_data.update({\n+                        'formset-%s' % form_key: form_obj.cleaned_data\n+                    })\n+                else:\n+                    cleaned_data.update(form_obj.cleaned_data)\n+        return cleaned_data\n+\n+    def get_cleaned_data_for_step(self, step):\n+        \"\"\"\n+        Returns the cleaned data for a given `step`. Before returning the\n+        cleaned data, the stored values are being revalidated through the\n+        form. If the data doesn't validate, None will be returned.\n+        \"\"\"\n+        if step in self.form_list:\n+            form_obj = self.get_form(step=step,\n+                data=self.storage.get_step_data(step),\n+                files=self.storage.get_step_files(step))\n+            if form_obj.is_valid():\n+                return form_obj.cleaned_data\n+        return None\n+\n+    def get_next_step(self, step=None):\n+        \"\"\"\n+        Returns the next step after the given `step`. If no more steps are\n+        available, None will be returned. If the `step` argument is None, the\n+        current step will be determined automatically.\n+        \"\"\"\n+        if step is None:\n+            step = self.steps.current\n+        form_list = self.get_form_list()\n+        key = form_list.keyOrder.index(step) + 1\n+        if len(form_list.keyOrder) > key:\n+            return form_list.keyOrder[key]\n+        return None\n+\n+    def get_prev_step(self, step=None):\n+        \"\"\"\n+        Returns the previous step before the given `step`. If there are no\n+        steps available, None will be returned. If the `step` argument is\n+        None, the current step will be determined automatically.\n+        \"\"\"\n+        if step is None:\n+            step = self.steps.current\n+        form_list = self.get_form_list()\n+        key = form_list.keyOrder.index(step) - 1\n+        if key >= 0:\n+            return form_list.keyOrder[key]\n+        return None\n+\n+    def get_step_index(self, step=None):\n+        \"\"\"\n+        Returns the index for the given `step` name. If no step is given,\n+        the current step will be used to get the index.\n+        \"\"\"\n+        if step is None:\n+            step = self.steps.current\n+        return self.get_form_list().keyOrder.index(step)\n+\n+    def get_context_data(self, form, *args, **kwargs):\n+        \"\"\"\n+        Returns the template context for a step. You can overwrite this method\n+        to add more data for all or some steps. This method returns a\n+        dictionary containing the rendered form step. Available template\n+        context variables are:\n+\n+         * all extra data stored in the storage backend\n+         * `form` - form instance of the current step\n+         * `wizard` - the wizard instance itself\n+\n+        Example:\n+\n+        .. code-block:: python\n+\n+            class MyWizard(FormWizard):\n+                def get_context_data(self, form, **kwargs):\n+                    context = super(MyWizard, self).get_context_data(form, **kwargs)\n+                    if self.steps.current == 'my_step_name':\n+                        context.update({'another_var': True})\n+                    return context\n+        \"\"\"\n+        context = super(WizardView, self).get_context_data(*args, **kwargs)\n+        context.update(self.storage.extra_data)\n+        context['wizard'] = {\n+            'form': form,\n+            'steps': self.steps,\n+            'managenent_form': ManagementForm(prefix=self.prefix, initial={\n+                'current_step': self.steps.current,\n+            }),\n+        }\n+        return context\n+\n+    def render(self, form=None, **kwargs):\n+        \"\"\"\n+        Returns a ``HttpResponse`` containing a all needed context data.\n+        \"\"\"\n+        form = form or self.get_form()\n+        context = self.get_context_data(form, **kwargs)\n+        return self.render_to_response(context)\n+\n+    def done(self, form_list, **kwargs):\n+        \"\"\"\n+        This method muss be overrided by a subclass to process to form data\n+        after processing all steps.\n+        \"\"\"\n+        raise NotImplementedError(\"Your %s class has not defined a done() \"\n+            \"method, which is required.\" % self.__class__.__name__)\n+\n+\n+class SessionWizardView(WizardView):\n+    \"\"\"\n+    A WizardView with pre-configured SessionStorage backend.\n+    \"\"\"\n+    storage_name = 'django.contrib.formtools.wizard.storage.session.SessionStorage'\n+\n+\n+class CookieWizardView(WizardView):\n+    \"\"\"\n+    A WizardView with pre-configured CookieStorage backend.\n+    \"\"\"\n+    storage_name = 'django.contrib.formtools.wizard.storage.cookie.CookieStorage'\n+\n+\n+class NamedUrlWizardView(WizardView):\n+    \"\"\"\n+    A WizardView with URL named steps support.\n+    \"\"\"\n+    url_name = None\n+    done_step_name = None\n+\n+    @classmethod\n+    def get_initkwargs(cls, *args, **kwargs):\n+        \"\"\"\n+        We require a url_name to reverse URLs later. Additionally users can\n+        pass a done_step_name to change the URL name of the \"done\" view.\n+        \"\"\"\n+        extra_kwargs = {\n+            'done_step_name': 'done'\n+        }\n+        assert 'url_name' in kwargs, 'URL name is needed to resolve correct wizard URLs'\n+        extra_kwargs['url_name'] = kwargs.pop('url_name')\n+\n+        if 'done_step_name' in kwargs:\n+            extra_kwargs['done_step_name'] = kwargs.pop('done_step_name')\n+\n+        initkwargs = super(NamedUrlWizardView, cls).get_initkwargs(*args, **kwargs)\n+        initkwargs.update(extra_kwargs)\n+\n+        assert initkwargs['done_step_name'] not in initkwargs['form_list'], \\\n+            'step name \"%s\" is reserved for \"done\" view' % initkwargs['done_step_name']\n+\n+        return initkwargs\n+\n+    def get(self, *args, **kwargs):\n+        \"\"\"\n+        This renders the form or, if needed, does the http redirects.\n+        \"\"\"\n+        step_url = kwargs.get('step', None)\n+        if step_url is None:\n+            if 'reset' in self.request.GET:\n+                self.storage.reset()\n+                self.storage.current_step = self.steps.first\n+            if self.request.GET:\n+                query_string = \"?%s\" % self.request.GET.urlencode()\n+            else:\n+                query_string = \"\"\n+            next_step_url = reverse(self.url_name, kwargs={\n+                'step': self.steps.current,\n+            }) + query_string\n+            return redirect(next_step_url)\n+\n+        # is the current step the \"done\" name/view?\n+        elif step_url == self.done_step_name:\n+            last_step = self.steps.last\n+            return self.render_done(self.get_form(step=last_step,\n+                data=self.storage.get_step_data(last_step),\n+                files=self.storage.get_step_files(last_step)\n+            ), **kwargs)\n+\n+        # is the url step name not equal to the step in the storage?\n+        # if yes, change the step in the storage (if name exists)\n+        elif step_url == self.steps.current:\n+            # URL step name and storage step name are equal, render!\n+            return self.render(self.get_form(\n+                data=self.storage.current_step_data,\n+                files=self.storage.current_step_data,\n+            ), **kwargs)\n+\n+        elif step_url in self.get_form_list():\n+            self.storage.current_step = step_url\n+            return self.render(self.get_form(\n+                data=self.storage.current_step_data,\n+                files=self.storage.current_step_data,\n+            ), **kwargs)\n+\n+        # invalid step name, reset to first and redirect.\n+        else:\n+            self.storage.current_step = self.steps.first\n+            return redirect(self.url_name, step=self.steps.first)\n+\n+    def post(self, *args, **kwargs):\n+        \"\"\"\n+        Do a redirect if user presses the prev. step button. The rest of this\n+        is super'd from FormWizard.\n+        \"\"\"\n+        prev_step = self.request.POST.get('wizard_prev_step', None)\n+        if prev_step and prev_step in self.get_form_list():\n+            self.storage.current_step = prev_step\n+            return redirect(self.url_name, step=prev_step)\n+        return super(NamedUrlWizardView, self).post(*args, **kwargs)\n+\n+    def render_next_step(self, form, **kwargs):\n+        \"\"\"\n+        When using the NamedUrlFormWizard, we have to redirect to update the\n+        browser's URL to match the shown step.\n+        \"\"\"\n+        next_step = self.get_next_step()\n+        self.storage.current_step = next_step\n+        return redirect(self.url_name, step=next_step)\n+\n+    def render_revalidation_failure(self, failed_step, form, **kwargs):\n+        \"\"\"\n+        When a step fails, we have to redirect the user to the first failing\n+        step.\n+        \"\"\"\n+        self.storage.current_step = failed_step\n+        return redirect(self.url_name, step=failed_step)\n+\n+    def render_done(self, form, **kwargs):\n+        \"\"\"\n+        When rendering the done view, we have to redirect first (if the URL\n+        name doesn't fit).\n+        \"\"\"\n+        if kwargs.get('step', None) != self.done_step_name:\n+            return redirect(self.url_name, step=self.done_step_name)\n+        return super(NamedUrlWizardView, self).render_done(form, **kwargs)\n+\n+\n+class NamedUrlSessionWizardView(NamedUrlWizardView):\n+    \"\"\"\n+    A NamedUrlWizardView with pre-configured SessionStorage backend.\n+    \"\"\"\n+    storage_name = 'django.contrib.formtools.wizard.storage.session.SessionStorage'\n+\n+\n+class NamedUrlCookieWizardView(NamedUrlWizardView):\n+    \"\"\"\n+    A NamedUrlFormWizard with pre-configured CookieStorageBackend.\n+    \"\"\"\n+    storage_name = 'django.contrib.formtools.wizard.storage.cookie.CookieStorage'\n+"
        },
        {
            "sha": "76f3639b5844d6a3e10f72665d2cd7a24228e17d",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -265,3 +265,24 @@ def __hash__(self):\n \n     def _setup(self):\n         self._wrapped = self._setupfunc()\n+\n+\n+class lazy_property(property):\n+    \"\"\"\n+    A property that works with subclasses by wrapping the decorated\n+    functions of the base class.\n+    \"\"\"\n+    def __new__(cls, fget=None, fset=None, fdel=None, doc=None):\n+        if fget is not None:\n+            @wraps(fget)\n+            def fget(instance, instance_type=None, name=fget.__name__):\n+                return getattr(instance, name)()\n+        if fset is not None:\n+            @wraps(fset)\n+            def fset(instance, value, name=fset.__name__):\n+                return getattr(instance, name)(value)\n+        if fdel is not None:\n+            @wraps(fdel)\n+            def fdel(instance, name=fdel.__name__):\n+                return getattr(instance, name)()\n+        return property(fget, fset, fdel, doc)"
        },
        {
            "sha": "4d81cb7ba36d58bc6f5a05cbc15fd0d0aac8171f",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -203,6 +203,10 @@ their deprecation, as per the :ref:`Django deprecation policy\n           settings have been superseded by :setting:`IGNORABLE_404_URLS` in\n           the 1.4 release. They will be removed.\n \n+        * The :doc:`form wizard </ref/contrib/formtools/form-wizard>` has been\n+          refactored to use class based views with pluggable backends in 1.4.\n+          The previous implementation will be deprecated.\n+\n     * 2.0\n         * ``django.views.defaults.shortcut()``. This function has been moved\n           to ``django.contrib.contenttypes.views.shortcut()`` as part of the"
        },
        {
            "sha": "2434c8b2b787993c82ac027b6f72337ae5ba12cd",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 416,
            "deletions": 170,
            "changes": 586,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -2,23 +2,22 @@\n Form wizard\n ===========\n \n-.. module:: django.contrib.formtools.wizard\n+.. module:: django.contrib.formtools.wizard.views\n     :synopsis: Splits forms across multiple Web pages.\n \n Django comes with an optional \"form wizard\" application that splits\n :doc:`forms </topics/forms/index>` across multiple Web pages. It maintains\n-state in hashed HTML :samp:`<input type=\"hidden\">` fields so that the full\n-server-side processing can be delayed until the submission of the final form.\n+state in one of the backends so that the full server-side processing can be\n+delayed until the submission of the final form.\n \n You might want to use this if you have a lengthy form that would be too\n unwieldy for display on a single page. The first page might ask the user for\n core information, the second page might ask for less important information,\n etc.\n \n-The term \"wizard,\" in this context, is `explained on Wikipedia`_.\n+The term \"wizard\", in this context, is `explained on Wikipedia`_.\n \n .. _explained on Wikipedia: http://en.wikipedia.org/wiki/Wizard_%28software%29\n-.. _forms: ../forms/\n \n How it works\n ============\n@@ -28,10 +27,8 @@ Here's the basic workflow for how a user would use a wizard:\n     1. The user visits the first page of the wizard, fills in the form and\n        submits it.\n     2. The server validates the data. If it's invalid, the form is displayed\n-       again, with error messages. If it's valid, the server calculates a\n-       secure hash of the data and presents the user with the next form,\n-       saving the validated data and hash in :samp:`<input type=\"hidden\">`\n-       fields.\n+       again, with error messages. If it's valid, the server saves the current\n+       state of the wizard in the backend and redirects to the next step.\n     3. Step 1 and 2 repeat, for every subsequent form in the wizard.\n     4. Once the user has submitted all the forms and all the data has been\n        validated, the wizard processes the data -- saving it to the database,\n@@ -40,30 +37,33 @@ Here's the basic workflow for how a user would use a wizard:\n Usage\n =====\n \n-This application handles as much machinery for you as possible. Generally, you\n-just have to do these things:\n+This application handles as much machinery for you as possible. Generally,\n+you just have to do these things:\n \n-    1. Define a number of :class:`~django.forms.Form` classes -- one per wizard\n-       page.\n+    1. Define a number of :class:`~django.forms.Form` classes -- one per\n+       wizard page.\n \n-    2. Create a :class:`FormWizard` class that specifies what to do once all of\n-       your forms have been submitted and validated. This also lets you\n-       override some of the wizard's behavior.\n+    2. Create a :class:`WizardView` subclass that specifies what to do once\n+       all of your forms have been submitted and validated. This also lets\n+       you override some of the wizard's behavior.\n \n     3. Create some templates that render the forms. You can define a single,\n        generic template to handle every one of the forms, or you can define a\n        specific template for each form.\n \n-    4. Point your URLconf at your :class:`FormWizard` class.\n+    4. Add ``django.contrib.formtools.wizard`` to your\n+       :setting:`INSTALLED_APPS` list in your settings file.\n+\n+    5. Point your URLconf at your :class:`WizardView` :meth:`~WizardView.as_view` method.\n \n Defining ``Form`` classes\n-=========================\n+-------------------------\n \n The first step in creating a form wizard is to create the\n :class:`~django.forms.Form` classes.  These should be standard\n :class:`django.forms.Form` classes, covered in the :doc:`forms documentation\n-</topics/forms/index>`.  These classes can live anywhere in your codebase, but\n-convention is to put them in a file called :file:`forms.py` in your\n+</topics/forms/index>`.  These classes can live anywhere in your codebase,\n+but convention is to put them in a file called :file:`forms.py` in your\n application.\n \n For example, let's write a \"contact form\" wizard, where the first page's form\n@@ -79,85 +79,100 @@ the message itself. Here's what the :file:`forms.py` might look like::\n     class ContactForm2(forms.Form):\n         message = forms.CharField(widget=forms.Textarea)\n \n-**Important limitation:** Because the wizard uses HTML hidden fields to store\n-data between pages, you may not include a :class:`~django.forms.FileField`\n-in any form except the last one.\n-\n-Creating a ``FormWizard`` class\n-===============================\n \n-The next step is to create a\n-:class:`django.contrib.formtools.wizard.FormWizard` subclass.  As with your\n-:class:`~django.forms.Form` classes, this :class:`FormWizard` class can live\n-anywhere in your codebase, but convention is to put it in :file:`forms.py`.\n+.. note::\n \n-The only requirement on this subclass is that it implement a\n-:meth:`~FormWizard.done()` method.\n+    In order to use :class:`~django.forms.FileField` in any form, see the\n+    section :ref:`Handling files <wizard-files>` below to learn more about\n+    what to do.\n \n-.. method:: FormWizard.done\n+Creating a ``WizardView`` class\n+-------------------------------\n \n-    This method specifies what should happen when the data for *every* form is\n-    submitted and validated.  This method is passed two arguments:\n+The next step is to create a\n+:class:`django.contrib.formtools.wizard.view.WizardView` subclass. You can\n+also use the :class:`SessionWizardView` or :class:`CookieWizardView` class\n+which preselects the wizard storage backend.\n \n-        * ``request`` -- an :class:`~django.http.HttpRequest` object\n-        * ``form_list`` -- a list of :class:`~django.forms.Form` classes\n+.. note::\n \n-In this simplistic example, rather than perform any database operation, the\n-method simply renders a template of the validated data::\n+    To use the :class:`SessionWizardView` follow the instructions\n+    in the :doc:`sessions documentation </topics/http/sessions>` on\n+    how to enable sessions.\n \n-    from django.shortcuts import render_to_response\n-    from django.contrib.formtools.wizard import FormWizard\n+We will use the :class:`SessionWizardView` in all examples but is is completly\n+fine to use the :class:`CookieWizardView` instead. As with your\n+:class:`~django.forms.Form` classes, this :class:`WizardView` class can live\n+anywhere in your codebase, but convention is to put it in :file:`views.py`.\n \n-    class ContactWizard(FormWizard):\n-        def done(self, request, form_list):\n-            return render_to_response('done.html', {\n-                'form_data': [form.cleaned_data for form in form_list],\n-            })\n+The only requirement on this subclass is that it implement a\n+:meth:`~WizardView.done()` method.\n \n-Note that this method will be called via ``POST``, so it really ought to be a\n-good Web citizen and redirect after processing the data. Here's another\n-example::\n+.. method:: WizardView.done(form_list)\n \n-    from django.http import HttpResponseRedirect\n-    from django.contrib.formtools.wizard import FormWizard\n+    This method specifies what should happen when the data for *every* form is\n+    submitted and validated. This method is passed a list of validated\n+    :class:`~django.forms.Form` instances.\n \n-    class ContactWizard(FormWizard):\n-        def done(self, request, form_list):\n-            do_something_with_the_form_data(form_list)\n-            return HttpResponseRedirect('/page-to-redirect-to-when-done/')\n+    In this simplistic example, rather than performing any database operation,\n+    the method simply renders a template of the validated data::\n \n-See the section `Advanced FormWizard methods`_ below to learn about more\n-:class:`FormWizard` hooks.\n+        from django.shortcuts import render_to_response\n+        from django.contrib.formtools.wizard.views import SessionWizardView\n \n-Creating templates for the forms\n-================================\n+        class ContactWizard(SessionWizardView):\n+            def done(self, form_list, **kwargs):\n+                return render_to_response('done.html', {\n+                    'form_data': [form.cleaned_data for form in form_list],\n+                })\n \n-Next, you'll need to create a template that renders the wizard's forms. By\n-default, every form uses a template called :file:`forms/wizard.html`. (You can\n-change this template name by overriding :meth:`~FormWizard.get_template()`,\n-which is documented below. This hook also allows you to use a different\n-template for each form.)\n+    Note that this method will be called via ``POST``, so it really ought to be a\n+    good Web citizen and redirect after processing the data. Here's another\n+    example::\n \n-This template expects the following context:\n+        from django.http import HttpResponseRedirect\n+        from django.contrib.formtools.wizard.views import SessionWizardView\n \n-    * ``step_field`` -- The name of the hidden field containing the step.\n-    * ``step0`` -- The current step (zero-based).\n-    * ``step`` -- The current step (one-based).\n-    * ``step_count`` -- The total number of steps.\n-    * ``form`` -- The :class:`~django.forms.Form` instance for the current step\n-      (either empty or with errors).\n-    * ``previous_fields`` -- A string representing every previous data field,\n-      plus hashes for completed forms, all in the form of hidden fields. Note\n-      that you'll need to run this through the :tfilter:`safe` template filter,\n-      to prevent auto-escaping, because it's raw HTML.\n+        class ContactWizard(SessionWizardView):\n+            def done(self, form_list, **kwargs):\n+                do_something_with_the_form_data(form_list)\n+                return HttpResponseRedirect('/page-to-redirect-to-when-done/')\n \n-You can supply extra context to this template in two ways:\n+See the section :ref:`Advanced WizardView methods <wizardview-advanced-methods>`\n+below to learn about more :class:`WizardView` hooks.\n \n-    * Set the :attr:`~FormWizard.extra_context` attribute on your\n-      :class:`FormWizard` subclass to a dictionary.\n+Creating templates for the forms\n+--------------------------------\n \n-    * Pass a dictionary as a parameter named ``extra_context`` to your wizard's\n-      URL pattern in your URLconf.  See :ref:`hooking-wizard-into-urlconf`.\n+Next, you'll need to create a template that renders the wizard's forms. By\n+default, every form uses a template called\n+:file:`formtools/wizard/wizard_form.html`. You can change this template name\n+by overriding either the :attr:`~WizardView.template_name` attribute or the\n+:meth:`~WizardView.get_template_names()` method, which is documented below.\n+This hook also allows you to use a different template for each form.\n+\n+This template expects a ``wizard`` object that has various items attached to\n+it:\n+\n+    * ``form`` -- The :class:`~django.forms.Form` instance for the current\n+      step (either empty or with errors).\n+\n+    * ``steps`` -- A helper object to access the various steps related data:\n+\n+        * ``step0`` -- The current step (zero-based).\n+        * ``step1`` -- The current step (one-based).\n+        * ``count`` -- The total number of steps.\n+        * ``first`` -- The first step.\n+        * ``last`` -- The last step.\n+        * ``current`` -- The current (or first) step.\n+        * ``next`` -- The next step.\n+        * ``prev`` -- The previous step.\n+        * ``index`` -- The index of the current step.\n+        * ``all`` -- A list of all steps of the wizard.\n+\n+You can supply additional context variables by using the\n+:meth:`~FormWizard.get_context_data` method of your :class:`FormWizard`\n+subclass.\n \n Here's a full example template:\n \n@@ -166,170 +181,401 @@ Here's a full example template:\n     {% extends \"base.html\" %}\n \n     {% block content %}\n-    <p>Step {{ step }} of {{ step_count }}</p>\n+    <p>Step {{ wizard.steps.current }} of {{ wizard.steps.count }}</p>\n     <form action=\".\" method=\"post\">{% csrf_token %}\n     <table>\n-    {{ form }}\n+    {{ wizard.management_form }}\n+    {% if wizard.form.forms %}\n+        {{ wizard.form.management_form }}\n+        {% for form in wizard.form.forms %}\n+            {{ form }}\n+        {% endfor %}\n+    {% else %}\n+        {{ wizard.form }}\n+    {% endif %}\n+    {% if wizard.steps.prev %}\n+    <button name=\"wizard_prev_step\" value=\"{{ wizard.steps.first }}\">{% trans \"first step\" %}</button>\n+    <button name=\"wizard_prev_step\" value=\"{{ wizard.steps.prev }}\">{% trans \"prev step\" %}</button>\n+    {% endif %}\n     </table>\n-    <input type=\"hidden\" name=\"{{ step_field }}\" value=\"{{ step0 }}\" />\n-    {{ previous_fields|safe }}\n     <input type=\"submit\">\n     </form>\n     {% endblock %}\n \n-Note that ``previous_fields``, ``step_field`` and ``step0`` are all required\n-for the wizard to work properly.\n+.. note::\n \n-.. _hooking-wizard-into-urlconf:\n+    Note that ``{{ wizard.management_form }}`` **must be used** for\n+    the wizard to work properly.\n+\n+.. _wizard-urlconf:\n \n Hooking the wizard into a URLconf\n-=================================\n+---------------------------------\n \n Finally, we need to specify which forms to use in the wizard, and then\n-deploy the new :class:`FormWizard` object a URL in ``urls.py``. The\n-wizard takes a list of your :class:`~django.forms.Form` objects as\n-arguments when you instantiate the Wizard::\n+deploy the new :class:`WizardView` object a URL in the ``urls.py``. The\n+wizard's :meth:`as_view` method takes a list of your\n+:class:`~django.forms.Form` classes as an argument during instantiation::\n+\n+    from django.conf.urls.defaults import patterns\n \n-    from django.conf.urls.defaults import *\n-    from testapp.forms import ContactForm1, ContactForm2, ContactWizard\n+    from myapp.forms import ContactForm1, ContactForm2\n+    from myapp.views import ContactWizard\n \n     urlpatterns = patterns('',\n-        (r'^contact/$', ContactWizard([ContactForm1, ContactForm2])),\n+        (r'^contact/$', ContactWizard.as_view([ContactForm1, ContactForm2])),\n     )\n \n-Advanced ``FormWizard`` methods\n+.. _wizardview-advanced-methods:\n+\n+Advanced ``WizardView`` methods\n ===============================\n \n-.. class:: FormWizard\n+.. class:: WizardView\n \n-    Aside from the :meth:`~done()` method, :class:`FormWizard` offers a few\n+    Aside from the :meth:`~done()` method, :class:`WizardView` offers a few\n     advanced method hooks that let you customize how your wizard works.\n \n     Some of these methods take an argument ``step``, which is a zero-based\n-    counter representing the current step of the wizard. (E.g., the first form\n-    is ``0`` and the second form is ``1``.)\n+    counter as string representing the current step of the wizard. (E.g., the\n+    first form is ``'0'`` and the second form is ``'1'``)\n \n-.. method:: FormWizard.prefix_for_step\n+.. method:: WizardView.get_form_prefix(step)\n \n-    Given the step, returns a form prefix to use.  By default, this simply uses\n+    Given the step, returns a form prefix to use. By default, this simply uses\n     the step itself. For more, see the :ref:`form prefix documentation\n     <form-prefix>`.\n \n+.. method:: WizardView.process_step(form)\n+\n+    Hook for modifying the wizard's internal state, given a fully validated\n+    :class:`~django.forms.Form` object. The Form is guaranteed to have clean,\n+    valid data.\n+\n+    Note that this method is called every time a page is rendered for *all*\n+    submitted steps.\n+\n+    The default implementation::\n+\n+        def process_step(self, form):\n+            return self.get_form_step_data(form)\n+\n+.. method:: WizardView.get_form_initial(step)\n+\n+    Returns a dictionary which will be passed to the form for ``step`` as\n+    ``initial``. If no initial data was provied while initializing the\n+    form wizard, a empty dictionary should be returned.\n+\n+    The default implementation::\n+\n+        def get_form_initial(self, step):\n+            return self.initial_dict.get(step, {})\n+\n+.. method:: WizardView.get_form_instance(step)\n+\n+    Returns a object which will be passed to the form for ``step`` as\n+    ``instance``. If no instance object was provied while initializing\n+    the form wizard, None be returned.\n+\n+    The default implementation::\n+\n+        def get_form_instance(self, step):\n+            return self.instance_dict.get(step, None)\n+\n+.. method:: WizardView.get_context_data(form, **kwargs)\n+\n+    Returns the template context for a step. You can overwrite this method\n+    to add more data for all or some steps. This method returns a dictionary\n+    containing the rendered form step.\n+\n+    The default template context variables are:\n+\n+    * Any extra data the storage backend has stored\n+    * ``form`` -- form instance of the current step\n+    * ``wizard`` -- the wizard instance itself\n+\n+    Example to add extra variables for a specific step::\n+\n+        def get_context_data(self, form, **kwargs):\n+            context = super(MyWizard, self).get_context_data(form, **kwargs)\n+            if self.steps.current == 'my_step_name':\n+                context.update({'another_var': True})\n+            return context\n+\n+.. method:: WizardView.get_wizard_name()\n+\n+    This method can be used to change the wizard's internal name.\n+\n     Default implementation::\n \n-        def prefix_for_step(self, step):\n-            return str(step)\n+        def get_wizard_name(self):\n+            return normalize_name(self.__class__.__name__)\n+\n+.. method:: WizardView.get_prefix()\n \n-.. method:: FormWizard.render_hash_failure\n+    This method returns a prefix for the storage backends. These backends use\n+    the prefix to fetch the correct data for the wizard. (Multiple wizards\n+    could save their data in one session)\n \n-    Renders a template if the hash check fails. It's rare that you'd need to\n-    override this.\n+    You can change this method to make the wizard data prefix more unique to,\n+    e.g. have multiple instances of one wizard in one session.\n \n     Default implementation::\n \n-        def render_hash_failure(self, request, step):\n-            return self.render(self.get_form(step), request, step,\n-                context={'wizard_error':\n-                             'We apologize, but your form has expired. Please'\n-                             ' continue filling out the form from this page.'})\n+        def get_prefix(self):\n+            return self.wizard_name\n \n-.. method:: FormWizard.security_hash\n+.. method:: WizardView.get_form(step=None, data=None, files=None)\n \n-    Calculates the security hash for the given request object and\n-    :class:`~django.forms.Form` instance.\n+    This method constructs the form for a given ``step``. If no ``step`` is\n+    defined, the current step will be determined automatically.\n+    The method gets three arguments:\n \n-    By default, this generates a SHA1 HMAC using your form data and your\n-    :setting:`SECRET_KEY` setting. It's rare that somebody would need to\n-    override this.\n+    * ``step`` -- The step for which the form instance should be generated.\n+    * ``data`` -- Gets passed to the form's data argument\n+    * ``files`` -- Gets passed to the form's files argument\n \n-    Example::\n+    You can override this method to add extra arguments to the form instance.\n \n-        def security_hash(self, request, form):\n-            return my_hash_function(request, form)\n+    Example code to add a user attribute to the form on step 2::\n \n-.. method:: FormWizard.parse_params\n+        def get_form(self, step=None, data=None, files=None):\n+            form = super(MyWizard, self).get_form(step, data, files)\n+            if step == '1':\n+                form.user = self.request.user\n+            return form\n \n-    A hook for saving state from the request object and ``args`` / ``kwargs``\n-    that were captured from the URL by your URLconf.\n+.. method:: WizardView.process_step(form)\n \n-    By default, this does nothing.\n+    This method gives you a way to post-process the form data before the data\n+    gets stored within the storage backend. By default it just passed the\n+    form.data dictionary. You should not manipulate the data here but you can\n+    use the data to do some extra work if needed (e.g. set storage extra data).\n \n-    Example::\n+    Default implementation::\n \n-        def parse_params(self, request, *args, **kwargs):\n-            self.my_state = args[0]\n+        def process_step(self, form):\n+            return self.get_form_step_data(form)\n \n-.. method:: FormWizard.get_template\n+.. method:: WizardView.process_step_files(form)\n \n-    Returns the name of the template that should be used for the given step.\n+    This method gives you a way to post-process the form files before the\n+    files gets stored within the storage backend. By default it just passed\n+    the ``form.files`` dictionary. You should not manipulate the data here\n+    but you can use the data to do some extra work if needed (e.g. set storage\n+    extra data).\n \n-    By default, this returns :file:`'forms/wizard.html'`, regardless of step.\n+    Default implementation::\n \n-    Example::\n+        def process_step_files(self, form):\n+            return self.get_form_step_files(form)\n \n-        def get_template(self, step):\n-            return 'myapp/wizard_%s.html' % step\n+.. method:: WizardView.render_revalidation_failure(step, form, **kwargs)\n \n-    If :meth:`~FormWizard.get_template` returns a list of strings, then the\n-    wizard will use the template system's\n-    :func:`~django.template.loader.select_template` function.\n-    This means the system will use the first template that exists on the\n-    filesystem. For example::\n+    When the wizard thinks, all steps passed it revalidates all forms with the\n+    data from the backend storage.\n \n-        def get_template(self, step):\n-            return ['myapp/wizard_%s.html' % step, 'myapp/wizard.html']\n+    If any of the forms don't validate correctly, this method gets called.\n+    This method expects two arguments, ``step`` and ``form``.\n \n-.. method:: FormWizard.render_template\n+    The default implementation resets the current step to the first failing\n+    form and redirects the user to the invalid form.\n \n-    Renders the template for the given step, returning an\n-    :class:`~django.http.HttpResponse` object.\n+    Default implementation::\n \n-    Override this method if you want to add a custom context, return a\n-    different MIME type, etc. If you only need to override the template name,\n-    use :meth:`~FormWizard.get_template` instead.\n+        def render_revalidation_failure(self, step, form, **kwargs):\n+            self.storage.current_step = step\n+            return self.render(form, **kwargs)\n \n-    The template will be rendered with the context documented in the\n-    \"Creating templates for the forms\" section above.\n+.. method:: WizardView.get_form_step_data(form)\n \n-.. method:: FormWizard.process_step\n+    This method fetches the form data from and returns the dictionary. You\n+    can use this method to manipulate the values before the data gets stored\n+    in the storage backend.\n \n-    Hook for modifying the wizard's internal state, given a fully validated\n-    :class:`~django.forms.Form` object. The Form is guaranteed to have clean,\n-    valid data.\n+    Default implementation::\n \n-    This method should *not* modify any of that data. Rather, it might want to\n-    set ``self.extra_context`` or dynamically alter ``self.form_list``, based\n-    on previously submitted forms.\n+        def get_form_step_data(self, form):\n+            return form.data\n \n-    Note that this method is called every time a page is rendered for *all*\n-    submitted steps.\n+.. method:: WizardView.get_form_step_files(form)\n+\n+    This method returns the form files. You can use this method to manipulate\n+    the files before the data gets stored in the storage backend.\n+\n+    Default implementation::\n+\n+        def get_form_step_files(self, form):\n+            return form.files\n \n-    The function signature::\n+.. method:: WizardView.render(form, **kwargs)\n \n-        def process_step(self, request, form, step):\n-            # ...\n+    This method gets called after the get or post request was handled. You can\n+    hook in this method to, e.g. change the type of http response.\n+\n+    Default implementation::\n+\n+        def render(self, form=None, **kwargs):\n+            form = form or self.get_form()\n+            context = self.get_context_data(form, **kwargs)\n+            return self.render_to_response(context)\n \n Providing initial data for the forms\n ====================================\n \n-.. attribute:: FormWizard.initial\n+.. attribute:: WizardView.initial_dict\n \n     Initial data for a wizard's :class:`~django.forms.Form` objects can be\n-    provided using the optional :attr:`~FormWizard.initial` keyword argument.\n-    This argument should be a dictionary mapping a step to a dictionary\n-    containing the initial data for that step. The dictionary of initial data\n+    provided using the optional :attr:`~Wizard.initial_dict` keyword argument.\n+    This argument should be a dictionary mapping the steps to dictionaries\n+    containing the initial data for each step. The dictionary of initial data\n     will be passed along to the constructor of the step's\n     :class:`~django.forms.Form`::\n \n-        >>> from testapp.forms import ContactForm1, ContactForm2, ContactWizard\n+        >>> from myapp.forms import ContactForm1, ContactForm2\n+        >>> from myapp.views import ContactWizard\n         >>> initial = {\n-        ...     0: {'subject': 'Hello', 'sender': 'user@example.com'},\n-        ...     1: {'message': 'Hi there!'}\n+        ...     '0': {'subject': 'Hello', 'sender': 'user@example.com'},\n+        ...     '1': {'message': 'Hi there!'}\n         ... }\n-        >>> wiz = ContactWizard([ContactForm1, ContactForm2], initial=initial)\n-        >>> form1 = wiz.get_form(0)\n-        >>> form2 = wiz.get_form(1)\n+        >>> wiz = ContactWizard.as_view([ContactForm1, ContactForm2], initial_dict=initial)\n+        >>> form1 = wiz.get_form('0')\n+        >>> form2 = wiz.get_form('1')\n         >>> form1.initial\n         {'sender': 'user@example.com', 'subject': 'Hello'}\n         >>> form2.initial\n         {'message': 'Hi there!'}\n+\n+    The ``initial_dict`` can also take a list of dictionaries for a specific\n+    step if the step is a ``FormSet``.\n+\n+.. _wizard-files:\n+\n+Handling files\n+==============\n+\n+To handle :class:`~django.forms.FileField` within any step form of the wizard,\n+you have to add a :attr:`file_storage` to your :class:`WizardView` subclass.\n+\n+This storage will temporarilyy store the uploaded files for the wizard. The\n+:attr:`file_storage` attribute should be a\n+:class:`~django.core.files.storage.Storage` subclass.\n+\n+.. warning::\n+\n+    Please remember to take care of removing old files as the\n+    :class:`WizardView` won't remove any files, whether the wizard gets\n+    finished corretly or not.\n+\n+Conditionally view/skip specific steps\n+======================================\n+\n+.. attribute:: WizardView.condition_dict\n+\n+The :meth:`~WizardView.as_view` accepts a ``condition_dict`` argument. You can pass a\n+dictionary of boolean values or callables. The key should match the steps\n+name (e.g. '0', '1').\n+\n+If the value of a specific step is callable it will be called with the\n+:class:`WizardView` instance as the only argument. If the return value is true,\n+the step's form will be used.\n+\n+This example provides a contact form including a condition. The condition is\n+used to show a message from only if a checkbox in the first step was checked.\n+\n+The steps are defined in a ``forms.py``::\n+\n+    from django import forms\n+\n+    class ContactForm1(forms.Form):\n+        subject = forms.CharField(max_length=100)\n+        sender = forms.EmailField()\n+        leave_message = forms.BooleanField(required=False)\n+\n+    class ContactForm2(forms.Form):\n+        message = forms.CharField(widget=forms.Textarea)\n+\n+We define our wizard in a ``views.py``::\n+\n+    from django.shortcuts import render_to_response\n+    from django.contrib.formtools.wizard.views import SessionWizardView\n+\n+    def show_message_form_condition(wizard):\n+        # try to get the cleaned data of step 1\n+        cleaned_data = wizard.get_cleaned_data_for_step('0') or {}\n+        # check if the field ``leave_message`` was checked.\n+        return cleaned_data.get('leave_message', True)\n+\n+    class ContactWizard(SessionWizardView):\n+\n+        def done(self, form_list, **kwargs):\n+            return render_to_response('done.html', {\n+                'form_data': [form.cleaned_data for form in form_list],\n+            })\n+\n+We need to add the ``ContactWizard`` to our ``urls.py`` file::\n+\n+    from django.conf.urls.defaults import pattern\n+\n+    from myapp.forms import ContactForm1, ContactForm2\n+    from myapp.views import ContactWizard, show_message_form_condition\n+\n+    contact_forms = [ContactForm1, ContactForm2]\n+\n+    urlpatterns = patterns('',\n+        (r'^contact/$', ContactWizard.as_view(contact_forms,\n+            condition_dict={'1': show_message_form_condition}\n+        )),\n+    )\n+\n+As you can see, we defined a ``show_message_form_condition`` next to our\n+:class:`WizardView` subclass and added a ``condition_dict`` argument to the\n+:meth:`~WizardView.as_view` method. The key refers to the second wizard step\n+(because of the zero based step index).\n+\n+How to work with ModelForm and ModelFormSet\n+===========================================\n+\n+The WizardView supports :class:`~django.forms.ModelForm` and\n+:class:`~django.forms.ModelFormSet`. Additionally to the ``initial_dict``,\n+the :meth:`~WizardView.as_view` method takes a ``instance_dict`` argument\n+with a list of instances for the ``ModelForm`` and ``ModelFormSet``.\n+\n+Usage of NamedUrlWizardView\n+===========================\n+\n+.. class:: NamedUrlWizardView\n+\n+There is a :class:`WizardView` subclass which adds named-urls support to the wizard.\n+By doing this, you can have single urls for every step.\n+\n+To use the named urls, you have to change the ``urls.py``.\n+\n+Below you will see an example of a contact wizard with two steps, step 1 with\n+\"contactdata\" as its name and step 2 with \"leavemessage\" as its name.\n+\n+Additionally you have to pass two more arguments to the\n+:meth:`~WizardView.as_view` method:\n+\n+   * ``url_name`` -- the name of the url (as provided in the urls.py)\n+   * ``done_step_name`` -- the name in the url for the done step\n+\n+Example code for the changed ``urls.py`` file::\n+\n+    from django.conf.urls.defaults import url, patterns\n+\n+    from myapp.forms import ContactForm1, ContactForm2\n+    from myapp.views import ContactWizard\n+\n+    named_contact_forms = (\n+        ('contactdata', ContactForm1),\n+        ('leavemessage', ContactForm2),\n+    )\n+\n+    contact_wizard = ContactWizard.as_view(named_contact_forms,\n+        url_name='contact_step', done_step_name='finished')\n+\n+    urlpatterns = patterns('',\n+        url(r'^contact/(?P<step>.+)/$', contact_wizard, name='contact_step'),\n+        url(r'^contact/$', contact_wizard, name='contact'),\n+    )"
        },
        {
            "sha": "2a2090a9b13f029a53adaef8b54a8478551fde22",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -55,6 +55,22 @@ signing in Web applications.\n \n See :doc:`cryptographic signing </topics/signing>` docs for more information.\n \n+New form wizard\n+~~~~~~~~~~~~~~~\n+\n+The previously shipped ``FormWizard`` of the formtools contrib app has been\n+replaced with a new implementation that is based on the class based views\n+introduced in Django 1.3. It features a pluggable storage API and doesn't\n+require the wizard to pass around hidden fields for every previous step.\n+\n+Django 1.4 ships with a session based storage backend and a cookie based\n+storage backend. The latter uses the tools for\n+:doc:`cryptographic signing </topics/signing>` also introduced in\n+Django 1.4 to store the wizard state in the user's cookies.\n+\n+See the :doc:`form wizard </ref/contrib/formtools/form-wizard>` docs for\n+more information.\n+\n Simple clickjacking protection\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/formwizard/__init__.py",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fformwizard%2F__init__.py?ref=1a951fa8d474fc9e6114cf63b8ba012233c9afcd"
        },
        {
            "sha": "f458eda4ac38c78963328842b7c01db4f21c67ac",
            "filename": "tests/regressiontests/formwizard/forms.py",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fformwizard%2Fforms.py?ref=1a951fa8d474fc9e6114cf63b8ba012233c9afcd",
            "patch": "@@ -1,18 +0,0 @@\n-from django import forms\n-from django.contrib.formtools.wizard import FormWizard\n-from django.http import HttpResponse\n-\n-class Page1(forms.Form):\n-    name = forms.CharField(max_length=100)\n-    thirsty = forms.NullBooleanField()\n-\n-class Page2(forms.Form):\n-    address1 = forms.CharField(max_length=100)\n-    address2 = forms.CharField(max_length=100)\n-    \n-class Page3(forms.Form):\n-    random_crap = forms.CharField(max_length=100)\n-    \n-class ContactWizard(FormWizard):\n-    def done(self, request, form_list):\n-        return HttpResponse(\"\")"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/formwizard/models.py",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fformwizard%2Fmodels.py?ref=1a951fa8d474fc9e6114cf63b8ba012233c9afcd"
        },
        {
            "sha": "0c94d2e27646126a5b6f037584edd81c3aa410c2",
            "filename": "tests/regressiontests/formwizard/tests.py",
            "status": "removed",
            "additions": 0,
            "deletions": 59,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fformwizard%2Ftests.py?ref=1a951fa8d474fc9e6114cf63b8ba012233c9afcd",
            "patch": "@@ -1,59 +0,0 @@\n-import re\n-from django import forms\n-from django.test import TestCase\n-\n-class FormWizardWithNullBooleanField(TestCase):\n-    urls = 'regressiontests.formwizard.urls'\n-\n-    input_re = re.compile('name=\"([^\"]+)\" value=\"([^\"]+)\"')\n-\n-    wizard_url = '/wiz/'\n-    wizard_step_data = (\n-        {\n-            '0-name': 'Pony',\n-            '0-thirsty': '2',\n-        },\n-        {\n-            '1-address1': '123 Main St',\n-            '1-address2': 'Djangoland',\n-        },\n-        {\n-            '2-random_crap': 'blah blah',\n-        }\n-    )\n-\n-    def grabFieldData(self, response):\n-        \"\"\"\n-        Pull the appropriate field data from the context to pass to the next wizard step\n-        \"\"\"\n-        previous_fields = response.context['previous_fields']\n-        fields = {'wizard_step': response.context['step0']}\n-        \n-        def grab(m):\n-            fields[m.group(1)] = m.group(2)\n-            return ''\n-        \n-        self.input_re.sub(grab, previous_fields)\n-        return fields\n-\n-    def checkWizardStep(self, response, step_no):\n-        \"\"\"\n-        Helper function to test each step of the wizard\n-        - Make sure the call succeeded\n-        - Make sure response is the proper step number\n-        - return the result from the post for the next step\n-        \"\"\"\n-        step_count = len(self.wizard_step_data)\n-\n-        self.assertEqual(response.status_code, 200)\n-        self.assertContains(response, 'Step %d of %d' % (step_no, step_count))\n-\n-        data = self.grabFieldData(response)\n-        data.update(self.wizard_step_data[step_no - 1])\n-\n-        return self.client.post(self.wizard_url, data)\n-        \n-    def testWizard(self):\n-        response = self.client.get(self.wizard_url)\n-        for step_no in range(1, len(self.wizard_step_data) + 1):\n-            response = self.checkWizardStep(response, step_no)"
        },
        {
            "sha": "d964bc6505f66488c8ce182adad8624fd86a898a",
            "filename": "tests/regressiontests/formwizard/urls.py",
            "status": "removed",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/1a951fa8d474fc9e6114cf63b8ba012233c9afcd/tests%2Fregressiontests%2Fformwizard%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fformwizard%2Furls.py?ref=1a951fa8d474fc9e6114cf63b8ba012233c9afcd",
            "patch": "@@ -1,6 +0,0 @@\n-from django.conf.urls.defaults import *\n-from forms import ContactWizard, Page1, Page2, Page3\n-\n-urlpatterns = patterns('',\n-    url(r'^wiz/$', ContactWizard([Page1, Page2, Page3])),\n-    )"
        },
        {
            "sha": "90a6f08630b31a58adc88212232977f7c4e451ec",
            "filename": "tests/regressiontests/utils/functional.py",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/632dfa233839f8c76bd6b065b8420fe0ab96175a/tests%2Fregressiontests%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/632dfa233839f8c76bd6b065b8420fe0ab96175a/tests%2Fregressiontests%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ffunctional.py?ref=632dfa233839f8c76bd6b065b8420fe0ab96175a",
            "patch": "@@ -1,5 +1,5 @@\n from django.utils import unittest\n-from django.utils.functional import lazy\n+from django.utils.functional import lazy, lazy_property\n \n \n class FunctionalTestCase(unittest.TestCase):\n@@ -20,3 +20,20 @@ class Klazz(Base):\n \n         t = lazy(lambda: Klazz(), Klazz)()\n         self.assertTrue('base_method' in dir(t))\n+\n+    def test_lazy_property(self):\n+\n+        class A(object):\n+\n+            def _get_do(self):\n+                raise NotImplementedError\n+            def _set_do(self, value):\n+                raise NotImplementedError\n+            do = lazy_property(_get_do, _set_do)\n+\n+        class B(A):\n+            def _get_do(self):\n+                return \"DO IT\"\n+\n+        self.assertRaises(NotImplementedError, lambda: A().do)\n+        self.assertEqual(B().do, 'DO IT')"
        }
    ],
    "stats": {
        "total": 2938,
        "additions": 2594,
        "deletions": 344
    }
}