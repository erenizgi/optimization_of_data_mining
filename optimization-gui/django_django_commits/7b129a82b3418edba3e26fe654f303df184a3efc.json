{
    "author": "spookylukey",
    "message": "Fixed #11726 - FormWizard does sanity check on step number performed before dynamic steps can be inserted\n\nThanks to Eric Friesen for the report and michalm/esper256 for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16119 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "7b129a82b3418edba3e26fe654f303df184a3efc",
    "files": [
        {
            "sha": "be0372ac2f95a31505c6b16d65a0302c61a2c87e",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/7b129a82b3418edba3e26fe654f303df184a3efc/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/7b129a82b3418edba3e26fe654f303df184a3efc/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=7b129a82b3418edba3e26fe654f303df184a3efc",
            "patch": "@@ -322,6 +322,38 @@ def test_good_hash(self):\n         response = self.client.post('/wizard/', data)\n         self.assertEqual(2, response.context['step0'])\n \n+    def test_11726(self):\n+        \"\"\"\n+        Regression test for ticket #11726.\n+        Wizard should not raise Http404 when steps are added dynamically.\n+        \"\"\"\n+        reached = [False]\n+        that = self\n+\n+        class WizardWithProcessStep(WizardClass):\n+            def process_step(self, request, form, step):\n+                if step == 0:\n+                    if self.num_steps() < 2:\n+                        self.form_list.append(WizardPageTwoForm)\n+                if step == 1:\n+                    that.assertTrue(isinstance(form, WizardPageTwoForm))\n+                    reached[0] = True\n+\n+        wizard = WizardWithProcessStep([WizardPageOneForm])\n+        data = {\"0-field\": \"test\",\n+                \"1-field\": \"test2\",\n+                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n+                \"wizard_step\": \"1\"}\n+        wizard(DummyRequest(POST=data))\n+        self.assertTrue(reached[0])\n+\n+        data = {\"0-field\": \"test\",\n+                \"1-field\": \"test2\",\n+                \"hash_0\": \"7e9cea465f6a10a6fb47fcea65cb9a76350c9a5c\",\n+                \"hash_1\": \"d5b434e3934cc92fee4bd2964c4ebc06f81d362d\",\n+                \"wizard_step\": \"2\"}\n+        self.assertRaises(http.Http404, wizard, DummyRequest(POST=data))\n+\n     def test_14498(self):\n         \"\"\"\n         Regression test for ticket #14498.  All previous steps' forms should be"
        },
        {
            "sha": "c19578c3907dcad1c8cbe109def9e4544daadbd5",
            "filename": "django/contrib/formtools/wizard.py",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/7b129a82b3418edba3e26fe654f303df184a3efc/django%2Fcontrib%2Fformtools%2Fwizard.py",
            "raw_url": "https://github.com/django/django/raw/7b129a82b3418edba3e26fe654f303df184a3efc/django%2Fcontrib%2Fformtools%2Fwizard.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard.py?ref=7b129a82b3418edba3e26fe654f303df184a3efc",
            "patch": "@@ -47,6 +47,9 @@ def __repr__(self):\n \n     def get_form(self, step, data=None):\n         \"Helper method that returns the Form instance for the given step.\"\n+        # Sanity check.\n+        if step >= self.num_steps():\n+            raise Http404('Step %s does not exist' % step)\n         return self.form_list[step](data, prefix=self.prefix_for_step(step), initial=self.initial.get(step, None))\n \n     def num_steps(self):\n@@ -71,10 +74,6 @@ def __call__(self, request, *args, **kwargs):\n         current_step = self.determine_step(request, *args, **kwargs)\n         self.parse_params(request, *args, **kwargs)\n \n-        # Sanity check.\n-        if current_step >= self.num_steps():\n-            raise Http404('Step %s does not exist' % current_step)\n-\n         # Validate and process all the previous forms before instantiating the\n         # current step's form in case self.process_step makes changes to\n         # self.form_list."
        }
    ],
    "stats": {
        "total": 39,
        "additions": 35,
        "deletions": 4
    }
}