{
    "author": "aaugustin",
    "message": "Fixed #18217 -- Time zone support in generic views\n\nIntroduced a distinct implementation depending on the type of the\ndate field (DateField or DateTimeField), and applied appropriate\nconversions is the latter case, when time zone support is enabled.",
    "sha": "78ba9670af373f5261f95d6560bfd08425adcaad",
    "files": [
        {
            "sha": "32238bb8e95736274dfdd59dc83e78b17c769ad9",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 83,
            "deletions": 47,
            "changes": 130,
            "blob_url": "https://github.com/django/django/blob/78ba9670af373f5261f95d6560bfd08425adcaad/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/78ba9670af373f5261f95d6560bfd08425adcaad/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=78ba9670af373f5261f95d6560bfd08425adcaad",
            "patch": "@@ -1,8 +1,10 @@\n import datetime\n+from django.conf import settings\n from django.db import models\n from django.core.exceptions import ImproperlyConfigured\n from django.http import Http404\n from django.utils.encoding import force_unicode\n+from django.utils.functional import cached_property\n from django.utils.translation import ugettext as _\n from django.utils import timezone\n from django.views.generic.base import View\n@@ -164,6 +166,51 @@ def get_allow_future(self):\n         \"\"\"\n         return self.allow_future\n \n+    # Note: the following three methods only work in subclasses that also\n+    # inherit SingleObjectMixin or MultipleObjectMixin.\n+\n+    @cached_property\n+    def uses_datetime_field(self):\n+        \"\"\"\n+        Return `True` if the date field is a `DateTimeField` and `False`\n+        if it's a `DateField`.\n+        \"\"\"\n+        model = self.get_queryset().model if self.model is None else self.model\n+        field = model._meta.get_field(self.get_date_field())\n+        return isinstance(field, models.DateTimeField)\n+\n+    def _make_date_lookup_arg(self, value):\n+        \"\"\"\n+        Convert a date into a datetime when the date field is a DateTimeField.\n+\n+        When time zone support is enabled, `date` is assumed to be in the\n+        current time zone, so that displayed items are consistent with the URL.\n+        \"\"\"\n+        if self.uses_datetime_field:\n+            value = datetime.datetime.combine(value, datetime.time.min)\n+            if settings.USE_TZ:\n+                value = timezone.make_aware(value, timezone.get_current_timezone())\n+        return value\n+\n+    def _make_single_date_lookup(self, date):\n+        \"\"\"\n+        Get the lookup kwargs for filtering on a single date.\n+\n+        If the date field is a DateTimeField, we can't just filter on\n+        date_field=date because that doesn't take the time into account.\n+        \"\"\"\n+        date_field = self.get_date_field()\n+        if self.uses_datetime_field:\n+            since = self._make_date_lookup_arg(date)\n+            until = self._make_date_lookup_arg(date + datetime.timedelta(days=1))\n+            return {\n+                '%s__gte' % date_field: since,\n+                '%s__lt' % date_field: until,\n+            }\n+        else:\n+            # Skip self._make_date_lookup_arg, it's a no-op in this branch.\n+            return {date_field: date}\n+\n \n class BaseDateListView(MultipleObjectMixin, DateMixin, View):\n     \"\"\"\n@@ -180,7 +227,7 @@ def get(self, request, *args, **kwargs):\n \n     def get_dated_items(self):\n         \"\"\"\n-        Obtain the list of dates and itesm\n+        Obtain the list of dates and items.\n         \"\"\"\n         raise NotImplementedError('A DateView must provide an implementation of get_dated_items()')\n \n@@ -196,7 +243,8 @@ def get_dated_queryset(self, **lookup):\n         paginate_by = self.get_paginate_by(qs)\n \n         if not allow_future:\n-            qs = qs.filter(**{'%s__lte' % date_field: timezone.now()})\n+            now = timezone.now() if self.uses_datetime_field else datetime.date.today()\n+            qs = qs.filter(**{'%s__lte' % date_field: now})\n \n         if not allow_empty:\n             # When pagination is enabled, it's better to do a cheap query\n@@ -225,6 +273,7 @@ def get_date_list(self, queryset, date_type):\n \n         return date_list\n \n+\n class BaseArchiveIndexView(BaseDateListView):\n     \"\"\"\n     Base class for archives of date-based items.\n@@ -265,15 +314,23 @@ def get_dated_items(self):\n         \"\"\"\n         Return (date_list, items, extra_context) for this request.\n         \"\"\"\n-        # Yes, no error checking: the URLpattern ought to validate this; it's\n-        # an error if it doesn't.\n         year = self.get_year()\n+\n         date_field = self.get_date_field()\n-        qs = self.get_dated_queryset(**{date_field+'__year': year})\n+        date = _date_from_string(year, self.get_year_format())\n+\n+        since = self._make_date_lookup_arg(date)\n+        until = self._make_date_lookup_arg(datetime.date(date.year + 1, 1, 1))\n+        lookup_kwargs = {\n+            '%s__gte' % date_field: since,\n+            '%s__lt' % date_field: until,\n+        }\n+\n+        qs = self.get_dated_queryset(**lookup_kwargs)\n         date_list = self.get_date_list(qs, 'month')\n \n         if self.get_make_object_list():\n-            object_list = qs.order_by('-'+date_field)\n+            object_list = qs.order_by('-' + date_field)\n         else:\n             # We need this to be a queryset since parent classes introspect it\n             # to find information about the model.\n@@ -312,14 +369,14 @@ def get_dated_items(self):\n                                  month, self.get_month_format())\n \n         # Construct a date-range lookup.\n-        first_day = date.replace(day=1)\n-        if first_day.month == 12:\n-            last_day = first_day.replace(year=first_day.year + 1, month=1)\n+        since = self._make_date_lookup_arg(date)\n+        if date.month == 12:\n+            until = self._make_date_lookup_arg(datetime.date(date.year + 1, 1, 1))\n         else:\n-            last_day = first_day.replace(month=first_day.month + 1)\n+            until = self._make_date_lookup_arg(datetime.date(date.year, date.month + 1, 1))\n         lookup_kwargs = {\n-            '%s__gte' % date_field: first_day,\n-            '%s__lt' % date_field: last_day,\n+            '%s__gte' % date_field: since,\n+            '%s__lt' % date_field: until,\n         }\n \n         qs = self.get_dated_queryset(**lookup_kwargs)\n@@ -362,11 +419,11 @@ def get_dated_items(self):\n                                  week, week_format)\n \n         # Construct a date-range lookup.\n-        first_day = date\n-        last_day = date + datetime.timedelta(days=7)\n+        since = self._make_date_lookup_arg(date)\n+        until = self._make_date_lookup_arg(date + datetime.timedelta(days=7))\n         lookup_kwargs = {\n-            '%s__gte' % date_field: first_day,\n-            '%s__lt' % date_field: last_day,\n+            '%s__gte' % date_field: since,\n+            '%s__lt' % date_field: until,\n         }\n \n         qs = self.get_dated_queryset(**lookup_kwargs)\n@@ -404,11 +461,7 @@ def _get_dated_items(self, date):\n         Do the actual heavy lifting of getting the dated items; this accepts a\n         date object so that TodayArchiveView can be trivial.\n         \"\"\"\n-        date_field = self.get_date_field()\n-\n-        field = self.get_queryset().model._meta.get_field(date_field)\n-        lookup_kwargs = _date_lookup_for_field(field, date)\n-\n+        lookup_kwargs = self._make_single_date_lookup(date)\n         qs = self.get_dated_queryset(**lookup_kwargs)\n \n         return (None, qs, {\n@@ -474,10 +527,8 @@ def get_object(self, queryset=None):\n         # Filter down a queryset from self.queryset using the date from the\n         # URL. This'll get passed as the queryset to DetailView.get_object,\n         # which'll handle the 404\n-        date_field = self.get_date_field()\n-        field = qs.model._meta.get_field(date_field)\n-        lookup = _date_lookup_for_field(field, date)\n-        qs = qs.filter(**lookup)\n+        lookup_kwargs = self._make_single_date_lookup(date)\n+        qs = qs.filter(**lookup_kwargs)\n \n         return super(BaseDetailView, self).get_object(queryset=qs)\n \n@@ -490,10 +541,10 @@ class DateDetailView(SingleObjectTemplateResponseMixin, BaseDateDetailView):\n     template_name_suffix = '_detail'\n \n \n-def _date_from_string(year, year_format, month, month_format, day='', day_format='', delim='__'):\n+def _date_from_string(year, year_format, month='', month_format='', day='', day_format='', delim='__'):\n     \"\"\"\n     Helper: get a datetime.date object given a format string and a year,\n-    month, and possibly day; raise a 404 for an invalid date.\n+    month, and day (only year is mandatory). Raise a 404 for an invalid date.\n     \"\"\"\n     format = delim.join((year_format, month_format, day_format))\n     datestr = delim.join((year, month, day))\n@@ -548,10 +599,10 @@ def _get_next_prev_month(generic_view, naive_result, is_previous, use_first_day)\n         # Construct a lookup and an ordering depending on whether we're doing\n         # a previous date or a next date lookup.\n         if is_previous:\n-            lookup = {'%s__lte' % date_field: naive_result}\n+            lookup = {'%s__lte' % date_field: generic_view._make_date_lookup_arg(naive_result)}\n             ordering = '-%s' % date_field\n         else:\n-            lookup = {'%s__gte' % date_field: naive_result}\n+            lookup = {'%s__gte' % date_field: generic_view._make_date_lookup_arg(naive_result)}\n             ordering = date_field\n \n         qs = generic_view.get_queryset().filter(**lookup).order_by(ordering)\n@@ -564,7 +615,9 @@ def _get_next_prev_month(generic_view, naive_result, is_previous, use_first_day)\n             result = None\n \n     # Convert datetimes to a dates\n-    if hasattr(result, 'date'):\n+    if result and generic_view.uses_datetime_field:\n+        if settings.USE_TZ:\n+            result = timezone.localtime(result)\n         result = result.date()\n \n     # For month views, we always want to have a date that's the first of the\n@@ -577,20 +630,3 @@ def _get_next_prev_month(generic_view, naive_result, is_previous, use_first_day)\n         return result\n     else:\n         return None\n-\n-\n-def _date_lookup_for_field(field, date):\n-    \"\"\"\n-    Get the lookup kwargs for looking up a date against a given Field. If the\n-    date field is a DateTimeField, we can't just do filter(df=date) because\n-    that doesn't take the time into account. So we need to make a range lookup\n-    in those cases.\n-    \"\"\"\n-    if isinstance(field, models.DateTimeField):\n-        date_range = (\n-            datetime.datetime.combine(date, datetime.time.min),\n-            datetime.datetime.combine(date, datetime.time.max)\n-        )\n-        return {'%s__range' % field.name: date_range}\n-    else:\n-        return {field.name: date}"
        },
        {
            "sha": "5d308694e574d01b6bad15511d7dc115c1ba16aa",
            "filename": "docs/ref/class-based-views.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/78ba9670af373f5261f95d6560bfd08425adcaad/docs%2Fref%2Fclass-based-views.txt",
            "raw_url": "https://github.com/django/django/raw/78ba9670af373f5261f95d6560bfd08425adcaad/docs%2Fref%2Fclass-based-views.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views.txt?ref=78ba9670af373f5261f95d6560bfd08425adcaad",
            "patch": "@@ -748,6 +748,12 @@ DateMixin\n         ``QuerySet``'s model that the date-based archive should use to\n         determine the objects on the page.\n \n+        When :doc:`time zone support </topics/i18n/timezones>` is enabled and\n+        ``date_field`` is a ``DateTimeField``, dates are assumed to be in the\n+        current time zone. As a consequence, if you have implemented per-user\n+        time zone selection, users living in different time zones may view a\n+        different set of objects at the same URL.\n+\n     .. attribute:: allow_future\n \n         A boolean specifying whether to include \"future\" objects on this page,"
        },
        {
            "sha": "f3984c6c0e46913dff30f8d84c4aa4a66cd818a6",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 101,
            "deletions": 1,
            "changes": 102,
            "blob_url": "https://github.com/django/django/blob/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=78ba9670af373f5261f95d6560bfd08425adcaad",
            "patch": "@@ -4,8 +4,18 @@\n \n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase\n+from django.test.utils import override_settings\n+from django.utils import timezone\n+\n+from .models import Book, BookSigning\n+\n+\n+import warnings\n+warnings.filterwarnings(\n+        'error', r\"DateTimeField received a naive datetime\",\n+        RuntimeWarning, r'django\\.db\\.models\\.fields')\n+\n \n-from .models import Book\n \n \n class ArchiveIndexViewTests(TestCase):\n@@ -88,6 +98,18 @@ def test_paginated_archive_view_does_not_load_entire_table(self):\n         with self.assertNumQueries(3):\n             self.client.get('/dates/books/paginated/')\n \n+    def test_datetime_archive_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n+        res = self.client.get('/dates/booksignings/')\n+        self.assertEqual(res.status_code, 200)\n+\n+    @override_settings(USE_TZ=True, TIME_ZONE='Africa/Nairobi')\n+    def test_aware_datetime_archive_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/')\n+        self.assertEqual(res.status_code, 200)\n+\n+\n class YearArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'\n@@ -141,6 +163,18 @@ def test_year_view_invalid_pattern(self):\n         res = self.client.get('/dates/books/no_year/')\n         self.assertEqual(res.status_code, 404)\n \n+    def test_datetime_year_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n+        res = self.client.get('/dates/booksignings/2008/')\n+        self.assertEqual(res.status_code, 200)\n+\n+    @override_settings(USE_TZ=True, TIME_ZONE='Africa/Nairobi')\n+    def test_aware_datetime_year_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/')\n+        self.assertEqual(res.status_code, 200)\n+\n+\n class MonthArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'\n@@ -245,6 +279,21 @@ def test_previous_month_without_content(self):\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(res.context['previous_month'], datetime.date(2010,9,1))\n \n+    def test_datetime_month_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 2, 1, 12, 0))\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 6, 3, 12, 0))\n+        res = self.client.get('/dates/booksignings/2008/apr/')\n+        self.assertEqual(res.status_code, 200)\n+\n+    @override_settings(USE_TZ=True, TIME_ZONE='Africa/Nairobi')\n+    def test_aware_datetime_month_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 2, 1, 12, 0, tzinfo=timezone.utc))\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0, tzinfo=timezone.utc))\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 6, 3, 12, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/')\n+        self.assertEqual(res.status_code, 200)\n+\n \n class WeekArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n@@ -300,6 +349,18 @@ def test_week_start_Monday(self):\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(res.context['week'], datetime.date(2008, 9, 29))\n \n+    def test_datetime_week_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n+        res = self.client.get('/dates/booksignings/2008/week/13/')\n+        self.assertEqual(res.status_code, 200)\n+\n+    @override_settings(USE_TZ=True, TIME_ZONE='Africa/Nairobi')\n+    def test_aware_datetime_week_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/week/13/')\n+        self.assertEqual(res.status_code, 200)\n+\n+\n class DayArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'\n@@ -388,6 +449,26 @@ def test_today_view(self):\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(res.context['day'], datetime.date.today())\n \n+    def test_datetime_day_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/')\n+        self.assertEqual(res.status_code, 200)\n+\n+    @override_settings(USE_TZ=True, TIME_ZONE='Africa/Nairobi')\n+    def test_aware_datetime_day_view(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/')\n+        self.assertEqual(res.status_code, 200)\n+        # 2008-04-02T00:00:00+03:00 (beginning of day) > 2008-04-01T22:00:00+00:00 (book signing event date)\n+        BookSigning.objects.filter(pk=1).update(event_date=datetime.datetime(2008, 4, 1, 22, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/')\n+        self.assertEqual(res.status_code, 200)\n+        # 2008-04-03T00:00:00+03:00 (end of day) > 2008-04-02T22:00:00+00:00 (book signing event date)\n+        BookSigning.objects.filter(pk=1).update(event_date=datetime.datetime(2008, 4, 2, 22, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/')\n+        self.assertEqual(res.status_code, 404)\n+\n+\n class DateDetailViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'\n@@ -441,3 +522,22 @@ def test_get_object_custom_queryset(self):\n         res = self.client.get(\n             '/dates/books/get_object_custom_queryset/2008/oct/01/1/')\n         self.assertEqual(res.status_code, 404)\n+\n+    def test_datetime_date_detail(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/1/')\n+        self.assertEqual(res.status_code, 200)\n+\n+    @override_settings(USE_TZ=True, TIME_ZONE='Africa/Nairobi')\n+    def test_aware_datetime_date_detail(self):\n+        BookSigning.objects.create(event_date=datetime.datetime(2008, 4, 2, 12, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/1/')\n+        self.assertEqual(res.status_code, 200)\n+        # 2008-04-02T00:00:00+03:00 (beginning of day) > 2008-04-01T22:00:00+00:00 (book signing event date)\n+        BookSigning.objects.filter(pk=1).update(event_date=datetime.datetime(2008, 4, 1, 22, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/1/')\n+        self.assertEqual(res.status_code, 200)\n+        # 2008-04-03T00:00:00+03:00 (end of day) > 2008-04-02T22:00:00+00:00 (book signing event date)\n+        BookSigning.objects.filter(pk=1).update(event_date=datetime.datetime(2008, 4, 2, 22, 0, tzinfo=timezone.utc))\n+        res = self.client.get('/dates/booksignings/2008/apr/2/1/')\n+        self.assertEqual(res.status_code, 404)"
        },
        {
            "sha": "2355769d582e8e148cd55b38a102d1c52fb394e3",
            "filename": "tests/regressiontests/generic_views/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fmodels.py?ref=78ba9670af373f5261f95d6560bfd08425adcaad",
            "patch": "@@ -42,3 +42,6 @@ def __unicode__(self):\n class Page(models.Model):\n     content = models.TextField()\n     template = models.CharField(max_length=300)\n+\n+class BookSigning(models.Model):\n+    event_date = models.DateTimeField()"
        },
        {
            "sha": "9c47ab8d82209230f01403f5482c1f01292cde36",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=78ba9670af373f5261f95d6560bfd08425adcaad",
            "patch": "@@ -108,6 +108,8 @@\n         views.BookArchive.as_view(queryset=None)),\n     (r'^dates/books/paginated/$',\n         views.BookArchive.as_view(paginate_by=10)),\n+    (r'^dates/booksignings/$',\n+        views.BookSigningArchive.as_view()),\n \n     # ListView\n     (r'^list/dict/$',\n@@ -156,6 +158,8 @@\n         views.BookYearArchive.as_view(make_object_list=True, paginate_by=30)),\n     (r'^dates/books/no_year/$',\n         views.BookYearArchive.as_view()),\n+    (r'^dates/booksignings/(?P<year>\\d{4})/$',\n+        views.BookSigningYearArchive.as_view()),\n \n     # MonthArchiveView\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/$',\n@@ -170,6 +174,8 @@\n         views.BookMonthArchive.as_view(paginate_by=30)),\n     (r'^dates/books/(?P<year>\\d{4})/no_month/$',\n         views.BookMonthArchive.as_view()),\n+    (r'^dates/booksignings/(?P<year>\\d{4})/(?P<month>[a-z]{3})/$',\n+        views.BookSigningMonthArchive.as_view()),\n \n     # WeekArchiveView\n     (r'^dates/books/(?P<year>\\d{4})/week/(?P<week>\\d{1,2})/$',\n@@ -184,6 +190,8 @@\n         views.BookWeekArchive.as_view()),\n     (r'^dates/books/(?P<year>\\d{4})/week/(?P<week>\\d{1,2})/monday/$',\n         views.BookWeekArchive.as_view(week_format='%W')),\n+    (r'^dates/booksignings/(?P<year>\\d{4})/week/(?P<week>\\d{1,2})/$',\n+        views.BookSigningWeekArchive.as_view()),\n \n     # DayArchiveView\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/$',\n@@ -198,12 +206,16 @@\n         views.BookDayArchive.as_view(paginate_by=True)),\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/no_day/$',\n         views.BookDayArchive.as_view()),\n+    (r'^dates/booksignings/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/$',\n+        views.BookSigningDayArchive.as_view()),\n \n     # TodayArchiveView\n-    (r'dates/books/today/$',\n+    (r'^dates/books/today/$',\n         views.BookTodayArchive.as_view()),\n-    (r'dates/books/today/allow_empty/$',\n+    (r'^dates/books/today/allow_empty/$',\n         views.BookTodayArchive.as_view(allow_empty=True)),\n+    (r'^dates/booksignings/today/$',\n+        views.BookSigningTodayArchive.as_view()),\n \n     # DateDetailView\n     (r'^dates/books/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/(?P<pk>\\d+)/$',\n@@ -221,6 +233,9 @@\n     (r'^dates/books/get_object_custom_queryset/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/(?P<pk>\\d+)/$',\n         views.BookDetailGetObjectCustomQueryset.as_view()),\n \n+    (r'^dates/booksignings/(?P<year>\\d{4})/(?P<month>[a-z]{3})/(?P<day>\\d{1,2})/(?P<pk>\\d+)/$',\n+        views.BookSigningDetail.as_view()),\n+\n     # Useful for testing redirects\n     (r'^accounts/login/$',  'django.contrib.auth.views.login')\n )"
        },
        {
            "sha": "d11d810f3d35c0fa8134f7e95854a6b088cda7f6",
            "filename": "tests/regressiontests/generic_views/views.py",
            "status": "modified",
            "additions": 29,
            "deletions": 1,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/78ba9670af373f5261f95d6560bfd08425adcaad/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fviews.py?ref=78ba9670af373f5261f95d6560bfd08425adcaad",
            "patch": "@@ -7,7 +7,7 @@\n from django.views import generic\n \n from .forms import AuthorForm\n-from .models import Artist, Author, Book, Page\n+from .models import Artist, Author, Book, Page, BookSigning\n \n \n class CustomTemplateView(generic.TemplateView):\n@@ -198,3 +198,31 @@ def get_context_data(self, **kwargs):\n \n     def get_context_object_name(self, obj):\n         return \"test_name\"\n+\n+class BookSigningConfig(object):\n+    model = BookSigning\n+    date_field = 'event_date'\n+    # use the same templates as for books\n+    def get_template_names(self):\n+        return ['generic_views/book%s.html' % self.template_name_suffix]\n+\n+class BookSigningArchive(BookSigningConfig, generic.ArchiveIndexView):\n+    pass\n+\n+class BookSigningYearArchive(BookSigningConfig, generic.YearArchiveView):\n+    pass\n+\n+class BookSigningMonthArchive(BookSigningConfig, generic.MonthArchiveView):\n+    pass\n+\n+class BookSigningWeekArchive(BookSigningConfig, generic.WeekArchiveView):\n+    pass\n+\n+class BookSigningDayArchive(BookSigningConfig, generic.DayArchiveView):\n+    pass\n+\n+class BookSigningTodayArchive(BookSigningConfig, generic.TodayArchiveView):\n+    pass\n+\n+class BookSigningDetail(BookSigningConfig, generic.DateDetailView):\n+    context_object_name = 'book'"
        }
    ],
    "stats": {
        "total": 290,
        "additions": 239,
        "deletions": 51
    }
}