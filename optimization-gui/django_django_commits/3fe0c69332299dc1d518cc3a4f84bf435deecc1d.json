{
    "author": "jezdez",
    "message": "Fixed #10907, #14190 and #15829 -- Pass item to sitemaps template to allow further customization like Google News enabled sitemaps. Thanks, manfre and lakinwecker.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16474 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "3fe0c69332299dc1d518cc3a4f84bf435deecc1d",
    "files": [
        {
            "sha": "98ab35360614b6f9b15344bd1f6fafcc57e71ff2",
            "filename": "django/contrib/sitemaps/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/django%2Fcontrib%2Fsitemaps%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/django%2Fcontrib%2Fsitemaps%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2F__init__.py?ref=3fe0c69332299dc1d518cc3a4f84bf435deecc1d",
            "patch": "@@ -76,10 +76,11 @@ def get_urls(self, page=1, site=None):\n             loc = \"http://%s%s\" % (site.domain, self.__get('location', item))\n             priority = self.__get('priority', item, None)\n             url_info = {\n+                'item':       item,\n                 'location':   loc,\n                 'lastmod':    self.__get('lastmod', item, None),\n                 'changefreq': self.__get('changefreq', item, None),\n-                'priority':   str(priority is not None and priority or '')\n+                'priority':   str(priority is not None and priority or ''),\n             }\n             urls.append(url_info)\n         return urls"
        },
        {
            "sha": "2b02b78741affffa7291ec6f63577f63942ef6fd",
            "filename": "django/contrib/sitemaps/tests/basic.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbasic.py?ref=3fe0c69332299dc1d518cc3a4f84bf435deecc1d",
            "patch": "@@ -2,7 +2,7 @@\n from datetime import date\n from django.conf import settings\n from django.contrib.auth.models import User\n-from django.contrib.sitemaps import Sitemap\n+from django.contrib.sitemaps import Sitemap, GenericSitemap\n from django.contrib.sites.models import Site\n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase\n@@ -171,3 +171,14 @@ def test_sitemap_get_urls_no_site_2(self):\n         \"\"\"\n         Site._meta.installed = False\n         self.assertRaises(ImproperlyConfigured, Sitemap().get_urls)\n+\n+    def test_sitemap_item(self):\n+        \"\"\"\n+        Check to make sure that the raw item is included with each\n+        Sitemap.get_url() url result.\n+        \"\"\"\n+        user_sitemap = GenericSitemap({'queryset': User.objects.all()})\n+        def is_user(url):\n+            return isinstance(url['item'], User)\n+        item_in_url_info = all(map(is_user, user_sitemap.get_urls()))\n+        self.assertTrue(item_in_url_info)"
        },
        {
            "sha": "454db404205d6496404f10e077d9f323622056d4",
            "filename": "django/contrib/sitemaps/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/django%2Fcontrib%2Fsitemaps%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/django%2Fcontrib%2Fsitemaps%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Fviews.py?ref=3fe0c69332299dc1d518cc3a4f84bf435deecc1d",
            "patch": "@@ -36,9 +36,8 @@ def sitemap(request, sitemaps, section=None, template_name='sitemap.xml'):\n     for site in maps:\n         try:\n             if callable(site):\n-                urls.extend(site().get_urls(page=page, site=current_site))\n-            else:\n-                urls.extend(site.get_urls(page=page, site=current_site))\n+                site = site()\n+            urls.extend(site.get_urls(page=page, site=current_site))\n         except EmptyPage:\n             raise Http404(\"Page %s empty\" % page)\n         except PageNotAnInteger:"
        },
        {
            "sha": "6d8fe61f35f4fe876f869d84825ccbe02bb55977",
            "filename": "docs/ref/contrib/sitemaps.txt",
            "status": "modified",
            "additions": 64,
            "deletions": 7,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "raw_url": "https://github.com/django/django/raw/3fe0c69332299dc1d518cc3a4f84bf435deecc1d/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsitemaps.txt?ref=3fe0c69332299dc1d518cc3a4f84bf435deecc1d",
            "patch": "@@ -284,10 +284,10 @@ Here's what the relevant URLconf lines would look like for the example above::\n         (r'^sitemap-(?P<section>.+)\\.xml$', 'sitemap', {'sitemaps': sitemaps}),\n     )\n \n-This will automatically generate a :file:`sitemap.xml` file that references both\n-:file:`sitemap-flatpages.xml` and :file:`sitemap-blog.xml`. The\n-:class:`~django.contrib.sitemaps.Sitemap` classes and the :data:`sitemaps` dict\n-don't change at all.\n+This will automatically generate a :file:`sitemap.xml` file that references\n+both :file:`sitemap-flatpages.xml` and :file:`sitemap-blog.xml`. The\n+:class:`~django.contrib.sitemaps.Sitemap` classes and the :data:`sitemaps`\n+dict don't change at all.\n \n You should create an index file if one of your sitemaps has more than 50,000\n URLs. In this case, Django will automatically paginate the sitemap, and the\n@@ -298,9 +298,9 @@ index will reflect that.\n Template customization\n ======================\n \n-If you wish to use a different template for each sitemap or sitemap index available on your site,\n-you may specify it by passing a `template_name` parameter to the `sitemap` and `index` views via\n-the URLconf::\n+If you wish to use a different template for each sitemap or sitemap index\n+available on your site, you may specify it by passing a ``template_name``\n+parameter to the ``sitemap`` and ``index`` views via the URLconf::\n \n     urlpatterns = patterns('django.contrib.sitemaps.views',\n         (r'^custom-sitemap\\.xml$', 'index', {\n@@ -313,6 +313,63 @@ the URLconf::\n         }),\n     )\n \n+Context variables\n+------------------\n+\n+When customizing the templates for the :func:`~django.contrib.sitemaps.views.index`\n+and ~:func:`django.contrib.sitemaps.views.sitemaps` views, you can rely on the\n+following context variables.\n+\n+Index\n+-----\n+\n+The variable :data:`sitemaps` is a list of absolute URLs to each of the sitemaps.\n+\n+Sitemap\n+-------\n+\n+The variable :data:`urlset` is a list of URLs that should appear in the\n+sitemap. Each URL exposes attributes as defined in the\n+:class:`~django.contrib.sitemaps.Sitemap` class:\n+\n+    - ``changefreq``\n+    - ``item``\n+    - ``lastmod``\n+    - ``location``\n+    - ``priority``\n+\n+.. versionadded:: 1.4\n+\n+The ``item`` attribute has been added for each URL to allow more flexible\n+customization of the templates, such as `Google news sitemaps`_. Assuming\n+Sitemap's :attr:`~Sitemap.items()` would return a list of items with\n+``publication_data`` and a ``tags`` field something like this would\n+generate a Google News compatible sitemap:\n+\n+.. code-block:: xml+django\n+\n+    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+    <urlset\n+      xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\"\n+      xmlns:news=\"http://www.google.com/schemas/sitemap-news/0.9\">\n+    {% spaceless %}\n+    {% for url in urlset %}\n+      <url>\n+        <loc>{{ url.location }}</loc>\n+        {% if url.lastmod %}<lastmod>{{ url.lastmod|date:\"Y-m-d\" }}</lastmod>{% endif %}\n+        {% if url.changefreq %}<changefreq>{{ url.changefreq }}</changefreq>{% endif %}\n+        {% if url.priority %}<priority>{{ url.priority }}</priority>{% endif %}\n+        <news:news>\n+          {% if url.item.publication_date %}<news:publication_date>{{ url.item.publication_date|date:\"Y-m-d\" }}</news:publication_date>{% endif %}\n+          {% if url.item.tags %}<news:keywords>{{ url.item.tags }}</news:keywords>{% endif %}\n+        </news:news>\n+       </url>\n+    {% endfor %}\n+    {% endspaceless %}\n+    </urlset>\n+\n+.. _`Google news sitemaps`: http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=74288\n+\n Pinging Google\n ==============\n "
        }
    ],
    "stats": {
        "total": 92,
        "additions": 80,
        "deletions": 12
    }
}