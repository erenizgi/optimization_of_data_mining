{
    "author": "aaugustin",
    "message": "Upgraded the date based generic views to avoid warnings when time zone support is enabled.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17127 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "98b08bd4d449f5e32c53e498f6ba3f019b6b5191",
    "files": [
        {
            "sha": "75094aa775bbfa532f0e9f9bd8412d62375f1efc",
            "filename": "django/views/generic/date_based.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/98b08bd4d449f5e32c53e498f6ba3f019b6b5191/django%2Fviews%2Fgeneric%2Fdate_based.py",
            "raw_url": "https://github.com/django/django/raw/98b08bd4d449f5e32c53e498f6ba3f019b6b5191/django%2Fviews%2Fgeneric%2Fdate_based.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdate_based.py?ref=98b08bd4d449f5e32c53e498f6ba3f019b6b5191",
            "patch": "@@ -6,6 +6,7 @@\n from django.core.xheaders import populate_xheaders\n from django.db.models.fields import DateTimeField\n from django.http import Http404, HttpResponse\n+from django.utils import timezone\n \n import warnings\n warnings.warn(\n@@ -31,7 +32,7 @@ def archive_index(request, queryset, date_field, num_latest=15,\n     if extra_context is None: extra_context = {}\n     model = queryset.model\n     if not allow_future:\n-        queryset = queryset.filter(**{'%s__lte' % date_field: datetime.datetime.now()})\n+        queryset = queryset.filter(**{'%s__lte' % date_field: timezone.now()})\n     date_list = queryset.dates(date_field, 'year')[::-1]\n     if not date_list and not allow_empty:\n         raise Http404(\"No %s available\" % model._meta.verbose_name)\n@@ -74,7 +75,7 @@ def archive_year(request, year, queryset, date_field, template_name=None,\n     \"\"\"\n     if extra_context is None: extra_context = {}\n     model = queryset.model\n-    now = datetime.datetime.now()\n+    now = timezone.now()\n \n     lookup_kwargs = {'%s__year' % date_field: year}\n \n@@ -131,7 +132,7 @@ def archive_month(request, year, month, queryset, date_field,\n         raise Http404\n \n     model = queryset.model\n-    now = datetime.datetime.now()\n+    now = timezone.now()\n \n     # Calculate first and last day of month, for use in a date-range lookup.\n     first_day = date.replace(day=1)\n@@ -205,7 +206,7 @@ def archive_week(request, year, week, queryset, date_field,\n         raise Http404\n \n     model = queryset.model\n-    now = datetime.datetime.now()\n+    now = timezone.now()\n \n     # Calculate first and last day of week, for use in a date-range lookup.\n     first_day = date\n@@ -263,7 +264,7 @@ def archive_day(request, year, month, day, queryset, date_field,\n         raise Http404\n \n     model = queryset.model\n-    now = datetime.datetime.now()\n+    now = timezone.now()\n \n     if isinstance(model._meta.get_field(date_field), DateTimeField):\n         lookup_kwargs = {'%s__range' % date_field: (datetime.datetime.combine(date, datetime.time.min), datetime.datetime.combine(date, datetime.time.max))}\n@@ -335,7 +336,7 @@ def object_detail(request, year, month, day, queryset, date_field,\n         raise Http404\n \n     model = queryset.model\n-    now = datetime.datetime.now()\n+    now = timezone.now()\n \n     if isinstance(model._meta.get_field(date_field), DateTimeField):\n         lookup_kwargs = {'%s__range' % date_field: (datetime.datetime.combine(date, datetime.time.min), datetime.datetime.combine(date, datetime.time.max))}"
        },
        {
            "sha": "5f5f9591e90ed19058615aecea02211f8c427e21",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/98b08bd4d449f5e32c53e498f6ba3f019b6b5191/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/98b08bd4d449f5e32c53e498f6ba3f019b6b5191/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=98b08bd4d449f5e32c53e498f6ba3f019b6b5191",
            "patch": "@@ -4,6 +4,7 @@\n from django.http import Http404\n from django.utils.encoding import force_unicode\n from django.utils.translation import ugettext as _\n+from django.utils import timezone\n from django.views.generic.base import View\n from django.views.generic.detail import BaseDetailView, SingleObjectTemplateResponseMixin\n from django.views.generic.list import MultipleObjectMixin, MultipleObjectTemplateResponseMixin\n@@ -191,7 +192,7 @@ def get_dated_queryset(self, **lookup):\n         allow_empty = self.get_allow_empty()\n \n         if not allow_future:\n-            qs = qs.filter(**{'%s__lte' % date_field: datetime.datetime.now()})\n+            qs = qs.filter(**{'%s__lte' % date_field: timezone.now()})\n \n         if not allow_empty and not qs:\n             raise Http404(_(u\"No %(verbose_name_plural)s available\") % {"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 9,
        "deletions": 7
    }
}