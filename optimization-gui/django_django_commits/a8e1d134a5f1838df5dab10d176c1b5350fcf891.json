{
    "author": "aaugustin",
    "message": "Fixed a test failure introduced at r16987. Refs #12308.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16988 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a8e1d134a5f1838df5dab10d176c1b5350fcf891",
    "files": [
        {
            "sha": "7d7b96380c0f4307886fe43806f0f0faba3a1dac",
            "filename": "tests/modeltests/tablespaces/models.py",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/a8e1d134a5f1838df5dab10d176c1b5350fcf891/tests%2Fmodeltests%2Ftablespaces%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/a8e1d134a5f1838df5dab10d176c1b5350fcf891/tests%2Fmodeltests%2Ftablespaces%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftablespaces%2Fmodels.py?ref=a8e1d134a5f1838df5dab10d176c1b5350fcf891",
            "patch": "@@ -3,9 +3,9 @@\n # Since the test database doesn't have tablespaces, it's impossible for Django\n # to create the tables for models where db_tablespace is set. To avoid this\n # problem, we mark the models as unmanaged, and temporarily revert them to\n-# managed during each tes. See setUp and tearDown -- it isn't possible to use\n-# setUpClass and tearDownClass because they're called before Django flushes the\n-# tables, so Django attempts to flush a non-existing table.\n+# managed during each test. We also set them to use the same tables as the\n+# \"reference\" models to avoid errors when other tests run 'syncdb'\n+# (proxy_models_inheritance does).\n \n class ScientistRef(models.Model):\n     name = models.CharField(max_length=50)\n@@ -19,6 +19,7 @@ class ArticleRef(models.Model):\n class Scientist(models.Model):\n     name = models.CharField(max_length=50)\n     class Meta:\n+        db_table = 'tablespaces_scientistref'\n         db_tablespace = 'tbl_tbsp'\n         managed = False\n \n@@ -28,5 +29,14 @@ class Article(models.Model):\n     authors = models.ManyToManyField(Scientist, related_name='articles_written_set')\n     reviewers = models.ManyToManyField(Scientist, related_name='articles_reviewed_set', db_tablespace='idx_tbsp')\n     class Meta:\n+        db_table = 'tablespaces_articleref'\n         db_tablespace = 'tbl_tbsp'\n         managed = False\n+\n+# Also set the tables for automatically created models\n+\n+Authors = Article._meta.get_field('authors').rel.through\n+Authors._meta.db_table = 'tablespaces_articleref_authors'\n+\n+Reviewers = Article._meta.get_field('reviewers').rel.through\n+Reviewers._meta.db_table = 'tablespaces_articleref_reviewers'"
        },
        {
            "sha": "e8c16717173de0b37458b69f9311ac6e7b0f4503",
            "filename": "tests/modeltests/tablespaces/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/a8e1d134a5f1838df5dab10d176c1b5350fcf891/tests%2Fmodeltests%2Ftablespaces%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a8e1d134a5f1838df5dab10d176c1b5350fcf891/tests%2Fmodeltests%2Ftablespaces%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftablespaces%2Ftests.py?ref=a8e1d134a5f1838df5dab10d176c1b5350fcf891",
            "patch": "@@ -6,11 +6,7 @@\n from django.core.management.color import no_style \n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n \n-from models import Article, ArticleRef, Scientist, ScientistRef\n-\n-# Automatically created models\n-Authors = Article._meta.get_field('authors').rel.through\n-Reviewers = Article._meta.get_field('reviewers').rel.through\n+from models import Article, ArticleRef, Authors, Reviewers, Scientist, ScientistRef\n \n # We can't test the DEFAULT_TABLESPACE and DEFAULT_INDEX_TABLESPACE settings\n # because they're evaluated when the model class is defined. As a consequence,\n@@ -27,7 +23,7 @@ class TablespacesTests(TestCase):\n \n     def setUp(self):\n         # The unmanaged models need to be removed after the test in order to\n-        # prevent bad interactions with other tests (proxy_models_inheritance).\n+        # prevent bad interactions with the flush operation in other tests.\n         self.old_app_models = copy.deepcopy(cache.app_models)\n         self.old_app_store = copy.deepcopy(cache.app_store)\n \n@@ -56,7 +52,7 @@ def test_tablespace_for_model(self):\n     def test_tablespace_ignored_for_model(self):\n         # No tablespace-related SQL\n         self.assertEqual(sql_for_table(Scientist),\n-                         sql_for_table(ScientistRef).replace('ref', ''))\n+                         sql_for_table(ScientistRef))\n \n     @skipUnlessDBFeature('supports_tablespaces')\n     def test_tablespace_for_indexed_field(self):\n@@ -69,7 +65,7 @@ def test_tablespace_for_indexed_field(self):\n     def test_tablespace_ignored_for_indexed_field(self):\n         # No tablespace-related SQL\n         self.assertEqual(sql_for_table(Article),\n-                         sql_for_table(ArticleRef).replace('ref', ''))\n+                         sql_for_table(ArticleRef))\n \n     @skipUnlessDBFeature('supports_tablespaces')\n     def test_tablespace_for_many_to_many_field(self):"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 17,
        "deletions": 11
    }
}