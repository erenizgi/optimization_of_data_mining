{
    "author": "apollo13",
    "message": "Don't escape object ids when passing to the contenttypes.shortcut view.\n\nThis commit also changes the string pk to string_pk instead of id, to test\nif the admin uses .pk throughout the codebase.",
    "sha": "e1643e3535c4160c1a56c80f4d4db9848dc65e7a",
    "files": [
        {
            "sha": "ead37b187fd0305931062341cbfd4aec06c39cf4",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=e1643e3535c4160c1a56c80f4d4db9848dc65e7a",
            "patch": "@@ -31,7 +31,7 @@\n   <ul class=\"object-tools\">\n     {% block object-tools-items %}\n     <li><a href=\"history/\" class=\"historylink\">{% trans \"History\" %}</a></li>\n-    {% if has_absolute_url %}<li><a href=\"../../../r/{{ content_type_id }}/{{ object_id }}/\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n+    {% if has_absolute_url %}<li><a href=\"../../../r/{{ content_type_id }}/{{ original.pk }}/\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n     {% endblock %}\n   </ul>\n {% endif %}{% endif %}"
        },
        {
            "sha": "1792cb2d7e5deaf96095048251f9174b3bb28217",
            "filename": "tests/regressiontests/admin_views/fixtures/string-primary-key.xml",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/tests%2Fregressiontests%2Fadmin_views%2Ffixtures%2Fstring-primary-key.xml",
            "raw_url": "https://github.com/django/django/raw/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/tests%2Fregressiontests%2Fadmin_views%2Ffixtures%2Fstring-primary-key.xml",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ffixtures%2Fstring-primary-key.xml?ref=e1643e3535c4160c1a56c80f4d4db9848dc65e7a",
            "patch": "@@ -1,6 +1,6 @@\n <?xml version=\"1.0\" encoding=\"utf-8\"?>\n <django-objects version=\"1.0\">\n     <object pk=\"1\" model=\"admin_views.modelwithstringprimarykey\">\n-        <field type=\"CharField\" name=\"id\"><![CDATA[abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890 -_.!~*'() ;/?:@&=+$, <>#%\" {}|\\^[]`]]></field>\n-    </object>    \n-</django-objects>\n\\ No newline at end of file\n+        <field type=\"CharField\" name=\"string_pk\"><![CDATA[abcdefghijklmnopqrstuvwxyz ABCDEFGHIJKLMNOPQRSTUVWXYZ 1234567890 -_.!~*'() ;/?:@&=+$, <>#%\" {}|\\^[]`]]></field>\n+    </object>\n+</django-objects>"
        },
        {
            "sha": "2da86e20999dde52eee47aae75b81fe53f9ea840",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=e1643e3535c4160c1a56c80f4d4db9848dc65e7a",
            "patch": "@@ -93,10 +93,13 @@ class CustomArticle(models.Model):\n \n \n class ModelWithStringPrimaryKey(models.Model):\n-    id = models.CharField(max_length=255, primary_key=True)\n+    string_pk = models.CharField(max_length=255, primary_key=True)\n \n     def __unicode__(self):\n-        return self.id\n+        return self.string_pk\n+\n+    def get_absolute_url(self):\n+        return u'/dummy/%s/' % self.string_pk\n \n \n class Color(models.Model):"
        },
        {
            "sha": "e8d05f78ff40dfe3a2d5dfd41e4b1d160ea69186",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e1643e3535c4160c1a56c80f4d4db9848dc65e7a/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=e1643e3535c4160c1a56c80f4d4db9848dc65e7a",
            "patch": "@@ -1403,28 +1403,36 @@ def test_deleteconfirmation_link(self):\n \n     def test_url_conflicts_with_add(self):\n         \"A model with a primary key that ends with add should be visible\"\n-        add_model = ModelWithStringPrimaryKey(id=\"i have something to add\")\n+        add_model = ModelWithStringPrimaryKey(pk=\"i have something to add\")\n         add_model.save()\n         response = self.client.get('/test_admin/admin/admin_views/modelwithstringprimarykey/%s/' % quote(add_model.pk))\n         should_contain = \"\"\"<h1>Change model with string primary key</h1>\"\"\"\n         self.assertContains(response, should_contain)\n \n     def test_url_conflicts_with_delete(self):\n         \"A model with a primary key that ends with delete should be visible\"\n-        delete_model = ModelWithStringPrimaryKey(id=\"delete\")\n+        delete_model = ModelWithStringPrimaryKey(pk=\"delete\")\n         delete_model.save()\n         response = self.client.get('/test_admin/admin/admin_views/modelwithstringprimarykey/%s/' % quote(delete_model.pk))\n         should_contain = \"\"\"<h1>Change model with string primary key</h1>\"\"\"\n         self.assertContains(response, should_contain)\n \n     def test_url_conflicts_with_history(self):\n         \"A model with a primary key that ends with history should be visible\"\n-        history_model = ModelWithStringPrimaryKey(id=\"history\")\n+        history_model = ModelWithStringPrimaryKey(pk=\"history\")\n         history_model.save()\n         response = self.client.get('/test_admin/admin/admin_views/modelwithstringprimarykey/%s/' % quote(history_model.pk))\n         should_contain = \"\"\"<h1>Change model with string primary key</h1>\"\"\"\n         self.assertContains(response, should_contain)\n \n+    def test_shortcut_view_with_escaping(self):\n+        \"'View on site should' work properly with char fields\"\n+        model = ModelWithStringPrimaryKey(pk='abc_123')\n+        model.save()\n+        response = self.client.get('/test_admin/admin/admin_views/modelwithstringprimarykey/%s/' % quote(model.pk))\n+        should_contain = '/%s/\" class=\"viewsitelink\">' % model.pk\n+        self.assertContains(response, should_contain)\n+\n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class SecureViewTests(TestCase):"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 20,
        "deletions": 9
    }
}