{
    "author": "slurms",
    "message": "Fixed #17813 -- Added a .earliest() method to QuerySet\n\nThanks a lot to everybody participating in developing this feature.\nThe patch was developed by multiple people, at least Trac aliases\ntonnzor, jimmysong, Fandekasp and slurms.\n\nStylistic changes added by committer.",
    "sha": "fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
    "files": [
        {
            "sha": "816f6194e3228cd8a4775e1f51fe84faf932925c",
            "filename": "django/db/models/manager.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/django%2Fdb%2Fmodels%2Fmanager.py",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/django%2Fdb%2Fmodels%2Fmanager.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fmanager.py?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -172,6 +172,9 @@ def in_bulk(self, *args, **kwargs):\n     def iterator(self, *args, **kwargs):\n         return self.get_query_set().iterator(*args, **kwargs)\n \n+    def earliest(self, *args, **kwargs):\n+        return self.get_query_set().earliest(*args, **kwargs)\n+\n     def latest(self, *args, **kwargs):\n         return self.get_query_set().latest(*args, **kwargs)\n "
        },
        {
            "sha": "1c9a68a6772f23aa427659e3072c696d95883d1a",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 15,
            "deletions": 7,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -29,6 +29,7 @@\n # Pull into this namespace for backwards compatibility.\n EmptyResultSet = sql.EmptyResultSet\n \n+\n class QuerySet(object):\n     \"\"\"\n     Represents a lazy database lookup for a set of objects.\n@@ -487,21 +488,28 @@ def get_or_create(self, **kwargs):\n                     # Re-raise the IntegrityError with its original traceback.\n                     six.reraise(*exc_info)\n \n-    def latest(self, field_name=None):\n+    def _earliest_or_latest(self, field_name=None, direction=\"-\"):\n         \"\"\"\n-        Returns the latest object, according to the model's 'get_latest_by'\n-        option or optional given field_name.\n+        Returns the latest object, according to the model's\n+        'get_latest_by' option or optional given field_name.\n         \"\"\"\n-        latest_by = field_name or self.model._meta.get_latest_by\n-        assert bool(latest_by), \"latest() requires either a field_name parameter or 'get_latest_by' in the model\"\n+        order_by = field_name or getattr(self.model._meta, 'get_latest_by')\n+        assert bool(order_by), \"earliest() and latest() require either a \"\\\n+            \"field_name parameter or 'get_latest_by' in the model\"\n         assert self.query.can_filter(), \\\n-                \"Cannot change a query once a slice has been taken.\"\n+            \"Cannot change a query once a slice has been taken.\"\n         obj = self._clone()\n         obj.query.set_limits(high=1)\n         obj.query.clear_ordering()\n-        obj.query.add_ordering('-%s' % latest_by)\n+        obj.query.add_ordering('%s%s' % (direction, order_by))\n         return obj.get()\n \n+    def earliest(self, field_name=None):\n+        return self._earliest_or_latest(field_name=field_name, direction=\"\")\n+\n+    def latest(self, field_name=None):\n+        return self._earliest_or_latest(field_name=field_name, direction=\"-\")\n+\n     def in_bulk(self, id_list):\n         \"\"\"\n         Returns a dictionary mapping each of the given IDs to the object with"
        },
        {
            "sha": "21265d63133d267715ac9a540ba6346ef880a11b",
            "filename": "docs/ref/models/options.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/docs%2Fref%2Fmodels%2Foptions.txt",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/docs%2Fref%2Fmodels%2Foptions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Foptions.txt?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -86,7 +86,8 @@ Django quotes column and table names behind the scenes.\n     The name of an orderable field in the model, typically a :class:`DateField`,\n     :class:`DateTimeField`, or :class:`IntegerField`. This specifies the default\n     field to use in your model :class:`Manager`'s\n-    :meth:`~django.db.models.query.QuerySet.latest` method.\n+    :meth:`~django.db.models.query.QuerySet.latest` and\n+    :meth:`~django.db.models.query.QuerySet.earliest` methods.\n \n     Example::\n "
        },
        {
            "sha": "1f59ecb4f4055081af2d8d1ce55e22368246cd4f",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 6,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -1477,14 +1477,23 @@ This example returns the latest ``Entry`` in the table, according to the\n \n If your model's :ref:`Meta <meta-options>` specifies\n :attr:`~django.db.models.Options.get_latest_by`, you can leave off the\n-``field_name`` argument to ``latest()``. Django will use the field specified\n-in :attr:`~django.db.models.Options.get_latest_by` by default.\n+``field_name`` argument to ``earliest()`` or ``latest()``. Django will use the\n+field specified in :attr:`~django.db.models.Options.get_latest_by` by default.\n \n-Like :meth:`get()`, ``latest()`` raises\n-:exc:`~django.core.exceptions.DoesNotExist` if there is no object with the given\n-parameters.\n+Like :meth:`get()`, ``earliest()`` and ``latest()`` raise\n+:exc:`~django.core.exceptions.DoesNotExist` if there is no object with the\n+given parameters.\n+\n+Note that ``earliest()`` and ``latest()`` exist purely for convenience and\n+readability.\n+\n+earliest\n+~~~~~~~~\n+\n+.. method:: earliest(field_name=None)\n \n-Note ``latest()`` exists purely for convenience and readability.\n+Works otherwise like :meth:`~django.db.models.query.QuerySet.latest` except\n+the direction is changed.\n \n aggregate\n ~~~~~~~~~"
        },
        {
            "sha": "89d7bb3c056ce54a07e481ed6f1e09165e5fc2c1",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -28,6 +28,9 @@ Minor features\n   undefined if the given ``QuerySet`` isn't ordered and there are more than\n   one ordered values to compare against.\n \n+* Added :meth:`~django.db.models.query.QuerySet.earliest` for symmetry with\n+  :meth:`~django.db.models.query.QuerySet.latest`.\n+\n Backwards incompatible changes in 1.6\n =====================================\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/modeltests/get_earliest_or_latest/__init__.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/tests%2Fmodeltests%2Fget_earliest_or_latest%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/tests%2Fmodeltests%2Fget_earliest_or_latest%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_earliest_or_latest%2F__init__.py?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "previous_filename": "tests/modeltests/get_latest/__init__.py"
        },
        {
            "sha": "2453eaaccd2ee0454ded73001ff32b36a334338f",
            "filename": "tests/modeltests/get_earliest_or_latest/models.py",
            "status": "renamed",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/tests%2Fmodeltests%2Fget_earliest_or_latest%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/tests%2Fmodeltests%2Fget_earliest_or_latest%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_earliest_or_latest%2Fmodels.py?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -9,26 +9,24 @@\n \"\"\"\n \n from django.db import models\n-from django.utils.encoding import python_2_unicode_compatible\n \n \n-@python_2_unicode_compatible\n class Article(models.Model):\n     headline = models.CharField(max_length=100)\n     pub_date = models.DateField()\n     expire_date = models.DateField()\n     class Meta:\n         get_latest_by = 'pub_date'\n \n-    def __str__(self):\n+    def __unicode__(self):\n         return self.headline\n \n-@python_2_unicode_compatible\n+\n class Person(models.Model):\n     name = models.CharField(max_length=30)\n     birthday = models.DateField()\n \n     # Note that this model doesn't have \"get_latest_by\" set.\n \n-    def __str__(self):\n+    def __unicode__(self):\n         return self.name",
            "previous_filename": "tests/modeltests/get_latest/models.py"
        },
        {
            "sha": "6317a0974ce0e9bf9b2c29844e33c904f5a27750",
            "filename": "tests/modeltests/get_earliest_or_latest/tests.py",
            "status": "added",
            "additions": 123,
            "deletions": 0,
            "changes": 123,
            "blob_url": "https://github.com/django/django/blob/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/tests%2Fmodeltests%2Fget_earliest_or_latest%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fe54377dae1357a7f102d72614a13f0ef8b2dbdf/tests%2Fmodeltests%2Fget_earliest_or_latest%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_earliest_or_latest%2Ftests.py?ref=fe54377dae1357a7f102d72614a13f0ef8b2dbdf",
            "patch": "@@ -0,0 +1,123 @@\n+from __future__ import absolute_import\n+\n+from datetime import datetime\n+\n+from django.test import TestCase\n+\n+from .models import Article, Person\n+\n+\n+class EarliestOrLatestTests(TestCase):\n+    \"\"\"Tests for the earliest() and latest() objects methods\"\"\"\n+\n+    def tearDown(self):\n+        \"\"\"Makes sure Article has a get_latest_by\"\"\"\n+        if not Article._meta.get_latest_by:\n+            Article._meta.get_latest_by = 'pub_date'\n+\n+    def test_earliest(self):\n+        # Because no Articles exist yet, earliest() raises ArticleDoesNotExist.\n+        self.assertRaises(Article.DoesNotExist, Article.objects.earliest)\n+\n+        a1 = Article.objects.create(\n+            headline=\"Article 1\", pub_date=datetime(2005, 7, 26),\n+            expire_date=datetime(2005, 9, 1)\n+        )\n+        a2 = Article.objects.create(\n+            headline=\"Article 2\", pub_date=datetime(2005, 7, 27),\n+            expire_date=datetime(2005, 7, 28)\n+        )\n+        a3 = Article.objects.create(\n+            headline=\"Article 3\", pub_date=datetime(2005, 7, 28),\n+            expire_date=datetime(2005, 8, 27)\n+        )\n+        a4 = Article.objects.create(\n+            headline=\"Article 4\", pub_date=datetime(2005, 7, 28),\n+            expire_date=datetime(2005, 7, 30)\n+        )\n+\n+        # Get the earliest Article.\n+        self.assertEqual(Article.objects.earliest(), a1)\n+        # Get the earliest Article that matches certain filters.\n+        self.assertEqual(\n+            Article.objects.filter(pub_date__gt=datetime(2005, 7, 26)).earliest(),\n+            a2\n+        )\n+\n+        # Pass a custom field name to earliest() to change the field that's used\n+        # to determine the earliest object.\n+        self.assertEqual(Article.objects.earliest('expire_date'), a2)\n+        self.assertEqual(Article.objects.filter(\n+            pub_date__gt=datetime(2005, 7, 26)).earliest('expire_date'), a2)\n+\n+        # Ensure that earliest() overrides any other ordering specified on the\n+        # query. Refs #11283.\n+        self.assertEqual(Article.objects.order_by('id').earliest(), a1)\n+\n+        # Ensure that error is raised if the user forgot to add a get_latest_by\n+        # in the Model.Meta\n+        Article.objects.model._meta.get_latest_by = None\n+        self.assertRaisesMessage(\n+            AssertionError,\n+            \"earliest() and latest() require either a field_name parameter or \"\n+            \"'get_latest_by' in the model\",\n+            lambda: Article.objects.earliest(),\n+        )\n+\n+    def test_latest(self):\n+        # Because no Articles exist yet, latest() raises ArticleDoesNotExist.\n+        self.assertRaises(Article.DoesNotExist, Article.objects.latest)\n+\n+        a1 = Article.objects.create(\n+            headline=\"Article 1\", pub_date=datetime(2005, 7, 26),\n+            expire_date=datetime(2005, 9, 1)\n+        )\n+        a2 = Article.objects.create(\n+            headline=\"Article 2\", pub_date=datetime(2005, 7, 27),\n+            expire_date=datetime(2005, 7, 28)\n+        )\n+        a3 = Article.objects.create(\n+            headline=\"Article 3\", pub_date=datetime(2005, 7, 27),\n+            expire_date=datetime(2005, 8, 27)\n+        )\n+        a4 = Article.objects.create(\n+            headline=\"Article 4\", pub_date=datetime(2005, 7, 28),\n+            expire_date=datetime(2005, 7, 30)\n+        )\n+\n+        # Get the latest Article.\n+        self.assertEqual(Article.objects.latest(), a4)\n+        # Get the latest Article that matches certain filters.\n+        self.assertEqual(\n+            Article.objects.filter(pub_date__lt=datetime(2005, 7, 27)).latest(),\n+            a1\n+        )\n+\n+        # Pass a custom field name to latest() to change the field that's used\n+        # to determine the latest object.\n+        self.assertEqual(Article.objects.latest('expire_date'), a1)\n+        self.assertEqual(\n+            Article.objects.filter(pub_date__gt=datetime(2005, 7, 26)).latest('expire_date'),\n+            a3,\n+        )\n+\n+        # Ensure that latest() overrides any other ordering specified on the query. Refs #11283.\n+        self.assertEqual(Article.objects.order_by('id').latest(), a4)\n+\n+        # Ensure that error is raised if the user forgot to add a get_latest_by\n+        # in the Model.Meta\n+        Article.objects.model._meta.get_latest_by = None\n+        self.assertRaisesMessage(\n+            AssertionError,\n+            \"earliest() and latest() require either a field_name parameter or \"\n+            \"'get_latest_by' in the model\",\n+            lambda: Article.objects.latest(),\n+        )\n+\n+    def test_latest_manual(self):\n+        # You can still use latest() with a model that doesn't have\n+        # \"get_latest_by\" set -- just pass in the field name manually.\n+        p1 = Person.objects.create(name=\"Ralph\", birthday=datetime(1950, 1, 1))\n+        p2 = Person.objects.create(name=\"Stephanie\", birthday=datetime(1960, 2, 3))\n+        self.assertRaises(AssertionError, Person.objects.latest)\n+        self.assertEqual(Person.objects.latest(\"birthday\"), p2)"
        },
        {
            "sha": "948af6045a2b14dc35995ff03564f28d214049d7",
            "filename": "tests/modeltests/get_latest/tests.py",
            "status": "removed",
            "additions": 0,
            "deletions": 58,
            "changes": 58,
            "blob_url": "https://github.com/django/django/blob/37718eb50b60f44462a64f735072e43a9d60b9a6/tests%2Fmodeltests%2Fget_latest%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/37718eb50b60f44462a64f735072e43a9d60b9a6/tests%2Fmodeltests%2Fget_latest%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_latest%2Ftests.py?ref=37718eb50b60f44462a64f735072e43a9d60b9a6",
            "patch": "@@ -1,58 +0,0 @@\n-from __future__ import absolute_import\n-\n-from datetime import datetime\n-\n-from django.test import TestCase\n-\n-from .models import Article, Person\n-\n-\n-class LatestTests(TestCase):\n-    def test_latest(self):\n-        # Because no Articles exist yet, latest() raises ArticleDoesNotExist.\n-        self.assertRaises(Article.DoesNotExist, Article.objects.latest)\n-\n-        a1 = Article.objects.create(\n-            headline=\"Article 1\", pub_date=datetime(2005, 7, 26),\n-            expire_date=datetime(2005, 9, 1)\n-        )\n-        a2 = Article.objects.create(\n-            headline=\"Article 2\", pub_date=datetime(2005, 7, 27),\n-            expire_date=datetime(2005, 7, 28)\n-        )\n-        a3 = Article.objects.create(\n-            headline=\"Article 3\", pub_date=datetime(2005, 7, 27),\n-            expire_date=datetime(2005, 8, 27)\n-        )\n-        a4 = Article.objects.create(\n-            headline=\"Article 4\", pub_date=datetime(2005, 7, 28),\n-            expire_date=datetime(2005, 7, 30)\n-        )\n-\n-        # Get the latest Article.\n-        self.assertEqual(Article.objects.latest(), a4)\n-        # Get the latest Article that matches certain filters.\n-        self.assertEqual(\n-            Article.objects.filter(pub_date__lt=datetime(2005, 7, 27)).latest(),\n-            a1\n-        )\n-\n-        # Pass a custom field name to latest() to change the field that's used\n-        # to determine the latest object.\n-        self.assertEqual(Article.objects.latest('expire_date'), a1)\n-        self.assertEqual(\n-            Article.objects.filter(pub_date__gt=datetime(2005, 7, 26)).latest('expire_date'),\n-            a3,\n-        )\n-\n-        # Ensure that latest() overrides any other ordering specified on the query. Refs #11283.\n-        self.assertEqual(Article.objects.order_by('id').latest(), a4)\n-\n-    def test_latest_manual(self):\n-        # You can still use latest() with a model that doesn't have\n-        # \"get_latest_by\" set -- just pass in the field name manually.\n-        p1 = Person.objects.create(name=\"Ralph\", birthday=datetime(1950, 1, 1))\n-        p2 = Person.objects.create(name=\"Stephanie\", birthday=datetime(1960, 2, 3))\n-        self.assertRaises(AssertionError, Person.objects.latest)\n-\n-        self.assertEqual(Person.objects.latest(\"birthday\"), p2)"
        }
    ],
    "stats": {
        "total": 241,
        "additions": 164,
        "deletions": 77
    }
}