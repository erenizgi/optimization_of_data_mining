{
    "author": "aaugustin",
    "message": "Fixed #12308 -- Added tablespace support to the PostgreSQL backend.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16987 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "246580573d7f1226aca39615dbf39956c520e6d7",
    "files": [
        {
            "sha": "d6bd38088606b3335e131d1918e20615f3cfe7d2",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -365,6 +365,10 @@ class BaseDatabaseFeatures(object):\n     # date_interval_sql can properly handle mixed Date/DateTime fields and timedeltas\n     supports_mixed_date_datetime_comparisons = True\n \n+    # Does the backend support tablespaces? Default to False because it isn't\n+    # in the SQL standard.\n+    supports_tablespaces = False\n+\n     # Features that need to be confirmed at runtime\n     # Cache whether the confirmation has been performed.\n     _confirmed = False\n@@ -696,8 +700,12 @@ def end_transaction_sql(self, success=True):\n \n     def tablespace_sql(self, tablespace, inline=False):\n         \"\"\"\n-        Returns the SQL that will be appended to tables or rows to define\n-        a tablespace. Returns '' if the backend doesn't use tablespaces.\n+        Returns the SQL that will be used in a query to define the tablespace.\n+\n+        Returns '' if the backend doesn't support tablespaces.\n+\n+        If inline is True, the SQL is appended to a row; otherwise it's appended\n+        to the entire CREATE TABLE or CREATE INDEX statement.\n         \"\"\"\n         return ''\n "
        },
        {
            "sha": "f03df5d380b8f60922474f33f82f640617a97b79",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -57,7 +57,9 @@ def sql_create_model(self, model, style, known_models=set()):\n             if tablespace and f.unique:\n                 # We must specify the index tablespace inline, because we\n                 # won't be generating a CREATE INDEX statement for this field.\n-                field_output.append(self.connection.ops.tablespace_sql(tablespace, inline=True))\n+                tablespace_sql = self.connection.ops.tablespace_sql(tablespace, inline=True)\n+                if tablespace_sql:\n+                    field_output.append(tablespace_sql)\n             if f.rel:\n                 ref_output, pending = self.sql_for_inline_foreign_key_references(f, known_models, style)\n                 if pending:\n@@ -74,7 +76,9 @@ def sql_create_model(self, model, style, known_models=set()):\n             full_statement.append('    %s%s' % (line, i < len(table_output)-1 and ',' or ''))\n         full_statement.append(')')\n         if opts.db_tablespace:\n-            full_statement.append(self.connection.ops.tablespace_sql(opts.db_tablespace))\n+            tablespace_sql = self.connection.ops.tablespace_sql(opts.db_tablespace)\n+            if tablespace_sql:\n+                full_statement.append(tablespace_sql)\n         full_statement.append(';')\n         final_output.append('\\n'.join(full_statement))\n \n@@ -149,11 +153,9 @@ def sql_indexes_for_field(self, model, f, style):\n             qn = self.connection.ops.quote_name\n             tablespace = f.db_tablespace or model._meta.db_tablespace\n             if tablespace:\n-                sql = self.connection.ops.tablespace_sql(tablespace)\n-                if sql:\n-                    tablespace_sql = ' ' + sql\n-                else:\n-                    tablespace_sql = ''\n+                tablespace_sql = self.connection.ops.tablespace_sql(tablespace)\n+                if tablespace_sql:\n+                    tablespace_sql = ' ' + tablespace_sql\n             else:\n                 tablespace_sql = ''\n             i_name = '%s_%s' % (model._meta.db_table, self._digest(f.column))"
        },
        {
            "sha": "c9830f5a7cd3257dc7ea5a6735e1a0db923f1348",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -79,6 +79,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     can_defer_constraint_checks = True\n     ignores_nulls_in_unique_constraints = False\n     has_bulk_insert = True\n+    supports_tablespaces = True\n \n class DatabaseOperations(BaseDatabaseOperations):\n     compiler_module = \"django.db.backends.oracle.compiler\"\n@@ -326,8 +327,10 @@ def start_transaction_sql(self):\n         return ''\n \n     def tablespace_sql(self, tablespace, inline=False):\n-        return \"%sTABLESPACE %s\" % ((inline and \"USING INDEX \" or \"\"),\n-            self.quote_name(tablespace))\n+        if inline:\n+            return \"USING INDEX TABLESPACE %s\" % self.quote_name(tablespace)\n+        else:\n+            return \"TABLESPACE %s\" % self.quote_name(tablespace)\n \n     def value_to_db_datetime(self, value):\n         # Oracle doesn't support tz-aware datetimes"
        },
        {
            "sha": "74342e9ac646166384a26e174974de9cbb998b1c",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -75,7 +75,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     has_select_for_update = True\n     has_select_for_update_nowait = True\n     has_bulk_insert = True\n-\n+    supports_tablespaces = True\n \n class DatabaseWrapper(BaseDatabaseWrapper):\n     vendor = 'postgresql'"
        },
        {
            "sha": "e4e7428ea7ed9dce12c58698d03388bddd56c198",
            "filename": "django/db/backends/postgresql_psycopg2/creation.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -44,11 +44,9 @@ def sql_indexes_for_field(self, model, f, style):\n             db_table = model._meta.db_table\n             tablespace = f.db_tablespace or model._meta.db_tablespace\n             if tablespace:\n-                sql = self.connection.ops.tablespace_sql(tablespace)\n-                if sql:\n-                    tablespace_sql = ' ' + sql\n-                else:\n-                    tablespace_sql = ''\n+                tablespace_sql = self.connection.ops.tablespace_sql(tablespace)\n+                if tablespace_sql:\n+                    tablespace_sql = ' ' + tablespace_sql\n             else:\n                 tablespace_sql = ''\n "
        },
        {
            "sha": "acfeeaf7ac308bbe453b24bcf9bee001b256b85e",
            "filename": "django/db/backends/postgresql_psycopg2/operations.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -99,6 +99,12 @@ def sql_flush(self, style, tables, sequences):\n         else:\n             return []\n \n+    def tablespace_sql(self, tablespace, inline=False):\n+        if inline:\n+            return \"USING INDEX TABLESPACE %s\" % self.quote_name(tablespace)\n+        else:\n+            return \"TABLESPACE %s\" % self.quote_name(tablespace)\n+\n     def sequence_reset_sql(self, style, model_list):\n         from django.db import models\n         output = []"
        },
        {
            "sha": "848fd6ed740683abb2368373d4ef75dabaff22c3",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -1078,6 +1078,7 @@ def set_managed(field, model, cls):\n         'managed': managed,\n         'auto_created': klass,\n         'app_label': klass._meta.app_label,\n+        'db_tablespace': klass._meta.db_tablespace,\n         'unique_together': (from_, to),\n         'verbose_name': '%(from)s-%(to)s relationship' % {'from': from_, 'to': to},\n         'verbose_name_plural': '%(from)s-%(to)s relationships' % {'from': from_, 'to': to},\n@@ -1086,8 +1087,8 @@ def set_managed(field, model, cls):\n     return type(name, (models.Model,), {\n         'Meta': meta,\n         '__module__': klass.__module__,\n-        from_: models.ForeignKey(klass, related_name='%s+' % name),\n-        to: models.ForeignKey(to_model, related_name='%s+' % name)\n+        from_: models.ForeignKey(klass, related_name='%s+' % name, db_tablespace=field.db_tablespace),\n+        to: models.ForeignKey(to_model, related_name='%s+' % name, db_tablespace=field.db_tablespace)\n     })\n \n class ManyToManyField(RelatedField, Field):"
        },
        {
            "sha": "7f0ea3799d453638dd593225435b546715e12b70",
            "filename": "docs/howto/custom-model-fields.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fhowto%2Fcustom-model-fields.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fhowto%2Fcustom-model-fields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-model-fields.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -219,9 +219,9 @@ parameters:\n * :attr:`~django.db.models.Field.choices`\n * :attr:`~django.db.models.Field.help_text`\n * :attr:`~django.db.models.Field.db_column`\n-* :attr:`~django.db.models.Field.db_tablespace`: Currently only used with\n-  the Oracle backend and only for index creation. You can usually ignore\n-  this option.\n+* :attr:`~django.db.models.Field.db_tablespace`: Only for index creation, if the\n+  backend supports :doc:`tablespaces </topics/db/tablespaces>`. You can usually\n+  ignore this option.\n * :attr:`~django.db.models.Field.auto_created`: True if the field was\n   automatically created, as for the `OneToOneField` used by model\n   inheritance. For advanced use only."
        },
        {
            "sha": "9ea0fe72ccc9827774401dc1402d53a40f3cf213",
            "filename": "docs/ref/databases.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fdatabases.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fdatabases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdatabases.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -646,49 +646,6 @@ The ``RETURNING INTO`` clause can be disabled by setting the\n In this case, the Oracle backend will use a separate ``SELECT`` query to\n retrieve AutoField values.\n \n-Tablespace options\n-------------------\n-\n-A common paradigm for optimizing performance in Oracle-based systems is the\n-use of `tablespaces`_ to organize disk layout. The Oracle backend supports\n-this use case by adding ``db_tablespace`` options to the ``Meta`` and\n-``Field`` classes.  (When you use a backend that lacks support for tablespaces,\n-Django ignores these options.)\n-\n-.. _`tablespaces`: http://en.wikipedia.org/wiki/Tablespace\n-\n-A tablespace can be specified for the table(s) generated by a model by\n-supplying the ``db_tablespace`` option inside the model's ``class Meta``.\n-Additionally, you can pass the ``db_tablespace`` option to a ``Field``\n-constructor to specify an alternate tablespace for the ``Field``'s column\n-index. If no index would be created for the column, the ``db_tablespace``\n-option is ignored::\n-\n-    class TablespaceExample(models.Model):\n-        name = models.CharField(max_length=30, db_index=True, db_tablespace=\"indexes\")\n-        data = models.CharField(max_length=255, db_index=True)\n-        edges = models.ManyToManyField(to=\"self\", db_tablespace=\"indexes\")\n-\n-        class Meta:\n-            db_tablespace = \"tables\"\n-\n-In this example, the tables generated by the ``TablespaceExample`` model\n-(i.e., the model table and the many-to-many table) would be stored in the\n-``tables`` tablespace. The index for the name field and the indexes on the\n-many-to-many table would be stored in the ``indexes`` tablespace. The ``data``\n-field would also generate an index, but no tablespace for it is specified, so\n-it would be stored in the model tablespace ``tables`` by default.\n-\n-Use the :setting:`DEFAULT_TABLESPACE` and :setting:`DEFAULT_INDEX_TABLESPACE`\n-settings to specify default values for the db_tablespace options.\n-These are useful for setting a tablespace for the built-in Django apps and\n-other applications whose code you cannot control.\n-\n-Django does not create the tablespaces for you. Please refer to `Oracle's\n-documentation`_ for details on creating and managing tablespaces.\n-\n-.. _`Oracle's documentation`: http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_7003.htm#SQLRF01403\n-\n Naming issues\n -------------\n "
        },
        {
            "sha": "f3a4ef4f773a5a2856e46c5a33e4a465a865cc2f",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -178,10 +178,11 @@ If ``True``, djadmin:`django-admin.py sqlindexes <sqlindexes>` will output a\n \n .. attribute:: Field.db_tablespace\n \n-The name of the database tablespace to use for this field's index, if this field\n-is indexed. The default is the project's :setting:`DEFAULT_INDEX_TABLESPACE`\n-setting, if set, or the :attr:`~Field.db_tablespace` of the model, if any. If\n-the backend doesn't support tablespaces, this option is ignored.\n+The name of the :doc:`database tablespace </topics/db/tablespaces>` to use for\n+this field's index, if this field is indexed. The default is the project's\n+:setting:`DEFAULT_INDEX_TABLESPACE` setting, if set, or the\n+:attr:`~Options.db_tablespace` of the model, if any. If the backend doesn't\n+support tablespaces for indexes, this option is ignored.\n \n ``default``\n -----------"
        },
        {
            "sha": "4ae105af927c08ac8f084b123fc9bf5cd7f91623",
            "filename": "docs/ref/models/options.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fmodels%2Foptions.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fmodels%2Foptions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Foptions.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -73,8 +73,10 @@ Django quotes column and table names behind the scenes.\n \n .. attribute:: Options.db_tablespace\n \n-    The name of the database tablespace to use for the model. If the backend\n-    doesn't support tablespaces, this option is ignored.\n+    The name of the :doc:`database tablespace </topics/db/tablespaces>` to use\n+    for this model. The default is the project's :setting:`DEFAULT_TABLESPACE`\n+    setting, if set. If the backend doesn't support tablespaces, this option is\n+    ignored.\n \n ``get_latest_by``\n -----------------"
        },
        {
            "sha": "4ff5d4d06871e888f68a6aa3746f96511d67b74e",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -864,7 +864,7 @@ DEFAULT_INDEX_TABLESPACE\n Default: ``''`` (Empty string)\n \n Default tablespace to use for indexes on fields that don't specify\n-one, if the backend supports it.\n+one, if the backend supports it (see :doc:`/topics/db/tablespaces`).\n \n .. setting:: DEFAULT_TABLESPACE\n \n@@ -874,7 +874,7 @@ DEFAULT_TABLESPACE\n Default: ``''`` (Empty string)\n \n Default tablespace to use for models that don't specify one, if the\n-backend supports it.\n+backend supports it (see :doc:`/topics/db/tablespaces`).\n \n .. setting:: DISALLOWED_USER_AGENTS\n "
        },
        {
            "sha": "3e364fbe23720d25889bfea799b9de66e9c61e96",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -405,6 +405,8 @@ Django 1.4 also includes several smaller improvements worth noting:\n   code are slightly emphasized. This change makes it easier to scan a stacktrace\n   for issues in user code.\n \n+* :doc:`Tablespace support </topics/db/tablespaces>` in PostgreSQL.\n+\n * Customizable names for :meth:`~django.template.Library.simple_tag`.\n \n * In the documentation, a helpful :doc:`security overview </topics/security>`"
        },
        {
            "sha": "0e0fc8adb6007d354f3d2dc130dd2d072d7dd1e5",
            "filename": "docs/topics/db/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Ftopics%2Fdb%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Ftopics%2Fdb%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Findex.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -17,4 +17,5 @@ model maps to a single database table.\n    sql\n    transactions\n    multi-db\n+   tablespaces\n    optimization"
        },
        {
            "sha": "7fcd5588e77b1862c2e454f424ec9a4c56242603",
            "filename": "docs/topics/db/tablespaces.txt",
            "status": "added",
            "additions": 73,
            "deletions": 0,
            "changes": 73,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Ftopics%2Fdb%2Ftablespaces.txt",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/docs%2Ftopics%2Fdb%2Ftablespaces.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Ftablespaces.txt?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -0,0 +1,73 @@\n+===========\n+Tablespaces\n+===========\n+\n+A common paradigm for optimizing performance in database systems is the use of\n+`tablespaces`_ to organize disk layout.\n+\n+.. _`tablespaces`: http://en.wikipedia.org/wiki/Tablespace\n+\n+.. warning::\n+    Django does not create the tablespaces for you. Please refer to your\n+    database engine's documentation for details on creating and managing\n+    tablespaces.\n+\n+\n+Declaring tablespaces for tables\n+--------------------------------\n+\n+A tablespace can be specified for the table generated by a model by supplying\n+the :attr:`~django.db.models.Options.db_tablespace` option inside the model's\n+``class Meta``. This option also affects tables automatically created for\n+:class:`~django.db.models.ManyToManyField`\\ s in the model.\n+\n+You can use the :setting:`DEFAULT_TABLESPACE` setting to specify a default value\n+for :attr:`~django.db.models.Options.db_tablespace`. This is useful for setting\n+a tablespace for the built-in Django apps and other applications whose code you\n+cannot control.\n+\n+Declaring tablespaces for indexes\n+---------------------------------\n+\n+You can pass the :attr:`~django.db.models.Field.db_tablespace` option to a\n+``Field`` constructor to specify an alternate tablespace for the ``Field``'s\n+column index. If no index would be created for the column, the option is\n+ignored.\n+\n+You can use the :setting:`DEFAULT_INDEX_TABLESPACE` setting to specify\n+a default value for :attr:`~django.db.models.Field.db_tablespace`.\n+\n+If :attr:`~django.db.models.Field.db_tablespace` isn't specified and you didn't\n+set :setting:`DEFAULT_INDEX_TABLESPACE`, the index is created in the same\n+tablespace as the tables.\n+\n+An example\n+----------\n+\n+.. code-block:: python\n+\n+    class TablespaceExample(models.Model):\n+        name = models.CharField(max_length=30, db_index=True, db_tablespace=\"indexes\")\n+        data = models.CharField(max_length=255, db_index=True)\n+        edges = models.ManyToManyField(to=\"self\", db_tablespace=\"indexes\")\n+\n+        class Meta:\n+            db_tablespace = \"tables\"\n+\n+In this example, the tables generated by the ``TablespaceExample`` model (i.e.\n+the model table and the many-to-many table) would be stored in the ``tables``\n+tablespace. The index for the name field and the indexes on the many-to-many\n+table would be stored in the ``indexes`` tablespace. The ``data`` field would\n+also generate an index, but no tablespace for it is specified, so it would be\n+stored in the model tablespace ``tables`` by default.\n+\n+Database support\n+----------------\n+\n+PostgreSQL and Oracle support tablespaces. SQLite and MySQL don't.\n+\n+When you use a backend that lacks support for tablespaces, Django ignores all\n+tablespace-related options.\n+\n+.. versionchanged:: 1.4\n+    Since Django 1.4, the PostgreSQL backend supports tablespaces."
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/modeltests/tablespaces/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/tests%2Fmodeltests%2Ftablespaces%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/tests%2Fmodeltests%2Ftablespaces%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftablespaces%2F__init__.py?ref=246580573d7f1226aca39615dbf39956c520e6d7"
        },
        {
            "sha": "afc376c931f478c65a322430298981493264446c",
            "filename": "tests/modeltests/tablespaces/models.py",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/tests%2Fmodeltests%2Ftablespaces%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/tests%2Fmodeltests%2Ftablespaces%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftablespaces%2Fmodels.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -0,0 +1,32 @@\n+from django.db import models\n+\n+# Since the test database doesn't have tablespaces, it's impossible for Django\n+# to create the tables for models where db_tablespace is set. To avoid this\n+# problem, we mark the models as unmanaged, and temporarily revert them to\n+# managed during each tes. See setUp and tearDown -- it isn't possible to use\n+# setUpClass and tearDownClass because they're called before Django flushes the\n+# tables, so Django attempts to flush a non-existing table.\n+\n+class ScientistRef(models.Model):\n+    name = models.CharField(max_length=50)\n+\n+class ArticleRef(models.Model):\n+    title = models.CharField(max_length=50, unique=True)\n+    code = models.CharField(max_length=50, unique=True)\n+    authors = models.ManyToManyField(ScientistRef, related_name='articles_written_set')\n+    reviewers = models.ManyToManyField(ScientistRef, related_name='articles_reviewed_set')\n+\n+class Scientist(models.Model):\n+    name = models.CharField(max_length=50)\n+    class Meta:\n+        db_tablespace = 'tbl_tbsp'\n+        managed = False\n+\n+class Article(models.Model):\n+    title = models.CharField(max_length=50, unique=True)\n+    code = models.CharField(max_length=50, unique=True, db_tablespace='idx_tbsp')\n+    authors = models.ManyToManyField(Scientist, related_name='articles_written_set')\n+    reviewers = models.ManyToManyField(Scientist, related_name='articles_reviewed_set', db_tablespace='idx_tbsp')\n+    class Meta:\n+        db_tablespace = 'tbl_tbsp'\n+        managed = False"
        },
        {
            "sha": "763c8a7fdbec58d68ac03857714eaf629dfaad3c",
            "filename": "tests/modeltests/tablespaces/tests.py",
            "status": "added",
            "additions": 92,
            "deletions": 0,
            "changes": 92,
            "blob_url": "https://github.com/django/django/blob/246580573d7f1226aca39615dbf39956c520e6d7/tests%2Fmodeltests%2Ftablespaces%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/246580573d7f1226aca39615dbf39956c520e6d7/tests%2Fmodeltests%2Ftablespaces%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftablespaces%2Ftests.py?ref=246580573d7f1226aca39615dbf39956c520e6d7",
            "patch": "@@ -0,0 +1,92 @@\n+import copy\n+\n+from django.db import connection\n+from django.db import models\n+from django.db.models.loading import cache\n+from django.core.management.color import no_style \n+from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n+\n+from models import Article, ArticleRef, Scientist, ScientistRef\n+\n+# Automatically created models\n+Authors = Article._meta.get_field('authors').rel.through\n+Reviewers = Article._meta.get_field('reviewers').rel.through\n+\n+# We can't test the DEFAULT_TABLESPACE and DEFAULT_INDEX_TABLESPACE settings\n+# because they're evaluated when the model class is defined. As a consequence,\n+# @override_settings doesn't work.\n+\n+def sql_for_table(model):\n+    return '\\n'.join(connection.creation.sql_create_model(model, no_style())[0])\n+\n+def sql_for_index(model):\n+    return '\\n'.join(connection.creation.sql_indexes_for_model(model, no_style()))\n+\n+\n+class TablespacesTests(TestCase):\n+\n+    def setUp(self):\n+        # The unmanaged models need to be removed after the test in order to\n+        # prevent bad interactions with other tests (proxy_models_inheritance).\n+        self.old_app_models = copy.deepcopy(cache.app_models)\n+        self.old_app_store = copy.deepcopy(cache.app_store)\n+\n+        for model in Article, Authors, Reviewers, Scientist:\n+            model._meta.managed = True\n+\n+    def tearDown(self):\n+        for model in Article, Authors, Reviewers, Scientist:\n+            model._meta.managed = False\n+\n+        cache.app_models = self.old_app_models\n+        cache.app_store = self.old_app_store\n+        cache._get_models_cache = {}\n+\n+    def assertNumContains(self, haystack, needle, count):\n+        real_count = haystack.count(needle)\n+        self.assertEqual(real_count, count, \"Found %d instances of '%s', \"\n+                \"expected %d\" % (real_count, needle, count))\n+\n+    @skipUnlessDBFeature('supports_tablespaces')\n+    def test_tablespace_for_model(self):\n+        # 1 for the table + 1 for the index on the primary key\n+        self.assertNumContains(sql_for_table(Scientist).lower(), 'tbl_tbsp', 2)\n+\n+    @skipIfDBFeature('supports_tablespaces')\n+    def test_tablespace_ignored_for_model(self):\n+        # No tablespace-related SQL\n+        self.assertEqual(sql_for_table(Scientist),\n+                         sql_for_table(ScientistRef).replace('ref', ''))\n+\n+    @skipUnlessDBFeature('supports_tablespaces')\n+    def test_tablespace_for_indexed_field(self):\n+        # 1 for the table + 1 for the primary key + 1 for the index on name\n+        self.assertNumContains(sql_for_table(Article).lower(), 'tbl_tbsp', 3)\n+        # 1 for the index on reference\n+        self.assertNumContains(sql_for_table(Article).lower(), 'idx_tbsp', 1)\n+\n+    @skipIfDBFeature('supports_tablespaces')\n+    def test_tablespace_ignored_for_indexed_field(self):\n+        # No tablespace-related SQL\n+        self.assertEqual(sql_for_table(Article),\n+                         sql_for_table(ArticleRef).replace('ref', ''))\n+\n+    @skipUnlessDBFeature('supports_tablespaces')\n+    def test_tablespace_for_many_to_many_field(self):\n+        # The join table of the ManyToManyField always goes to the tablespace\n+        # of the model.\n+        self.assertNumContains(sql_for_table(Authors).lower(), 'tbl_tbsp', 2)\n+        self.assertNumContains(sql_for_table(Authors).lower(), 'idx_tbsp', 0)\n+        # The ManyToManyField declares no db_tablespace, indexes for the two\n+        # foreign keys in the join table go to the tablespace of the model.\n+        self.assertNumContains(sql_for_index(Authors).lower(), 'tbl_tbsp', 2)\n+        self.assertNumContains(sql_for_index(Authors).lower(), 'idx_tbsp', 0)\n+\n+        # The join table of the ManyToManyField always goes to the tablespace\n+        # of the model.\n+        self.assertNumContains(sql_for_table(Reviewers).lower(), 'tbl_tbsp', 2)\n+        self.assertNumContains(sql_for_table(Reviewers).lower(), 'idx_tbsp', 0)\n+        # The ManyToManyField declares db_tablespace, indexes for the two\n+        # foreign keys in the join table go to this tablespace.\n+        self.assertNumContains(sql_for_index(Reviewers).lower(), 'tbl_tbsp', 0)\n+        self.assertNumContains(sql_for_index(Reviewers).lower(), 'idx_tbsp', 2)"
        }
    ],
    "stats": {
        "total": 324,
        "additions": 251,
        "deletions": 73
    }
}