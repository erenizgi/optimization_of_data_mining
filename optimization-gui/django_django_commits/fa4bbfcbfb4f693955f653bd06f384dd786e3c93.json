{
    "author": "spookylukey",
    "message": "Removed Django 1.2 compatibility fallback for form wizard hash\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15951 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "fa4bbfcbfb4f693955f653bd06f384dd786e3c93",
    "files": [
        {
            "sha": "a4324903bce95ec2b03099c1ac8c8410b681c99d",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 38,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/fa4bbfcbfb4f693955f653bd06f384dd786e3c93/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/fa4bbfcbfb4f693955f653bd06f384dd786e3c93/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=fa4bbfcbfb4f693955f653bd06f384dd786e3c93",
            "patch": "@@ -249,14 +249,6 @@ def done(self, request, cleaned_data):\n         return http.HttpResponse(success_string)\n \n \n-class UserSecuredWizardClass(WizardClass):\n-    \"\"\"\n-    Wizard with a custum security_hash method\n-    \"\"\"\n-    def security_hash(self, request, form):\n-        return \"123\"\n-\n-\n class DummyRequest(http.HttpRequest):\n \n     def __init__(self, POST=None):\n@@ -310,36 +302,7 @@ def test_bad_hash(self):\n                                      \"wizard_step\": \"1\"})\n         self.assertEqual(0, response.context['step0'])\n \n-    def test_good_hash_django12(self):\n-        \"\"\"\n-        Form should advance if the hash is present and good, as calculated using\n-        django 1.2 method.\n-        \"\"\"\n-        # We are hard-coding a hash value here, but that is OK, since we want to\n-        # ensure that we don't accidentally change the algorithm.\n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"2fdbefd4c0cad51509478fbacddf8b13\",\n-                \"wizard_step\": \"1\"}\n-        response = self.client.post('/wizard/', data)\n-        self.assertEqual(2, response.context['step0'])\n-\n-    def test_good_hash_django12_subclass(self):\n-        \"\"\"\n-        The Django 1.2 method of calulating hashes should *not* be used as a\n-        fallback if the FormWizard subclass has provided their own method\n-        of calculating a hash.\n-        \"\"\"\n-        # We are hard-coding a hash value here, but that is OK, since we want to\n-        # ensure that we don't accidentally change the algorithm.\n-        data = {\"0-field\": \"test\",\n-                \"1-field\": \"test2\",\n-                \"hash_0\": \"2fdbefd4c0cad51509478fbacddf8b13\",\n-                \"wizard_step\": \"1\"}\n-        response = self.client.post('/wizard2/', data)\n-        self.assertEqual(0, response.context['step0'])\n-\n-    def test_good_hash_current(self):\n+    def test_good_hash(self):\n         \"\"\"\n         Form should advance if the hash is present and good, as calculated using\n         current method."
        },
        {
            "sha": "45888f99b611f52673eece52176b6af0dc31b37f",
            "filename": "django/contrib/formtools/tests/urls.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/fa4bbfcbfb4f693955f653bd06f384dd786e3c93/django%2Fcontrib%2Fformtools%2Ftests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/fa4bbfcbfb4f693955f653bd06f384dd786e3c93/django%2Fcontrib%2Fformtools%2Ftests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Furls.py?ref=fa4bbfcbfb4f693955f653bd06f384dd786e3c93",
            "patch": "@@ -11,7 +11,4 @@\n                        (r'^wizard/$', WizardClass([WizardPageOneForm,\n                                                    WizardPageTwoForm,\n                                                    WizardPageThreeForm])),\n-                       (r'^wizard2/$', UserSecuredWizardClass([WizardPageOneForm,\n-                                                               WizardPageTwoForm,\n-                                                               WizardPageThreeForm]))\n                       )"
        },
        {
            "sha": "af6f97bf4514e012c2731fd58f66340c70d43afe",
            "filename": "django/contrib/formtools/wizard.py",
            "status": "modified",
            "additions": 2,
            "deletions": 19,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/fa4bbfcbfb4f693955f653bd06f384dd786e3c93/django%2Fcontrib%2Fformtools%2Fwizard.py",
            "raw_url": "https://github.com/django/django/raw/fa4bbfcbfb4f693955f653bd06f384dd786e3c93/django%2Fcontrib%2Fformtools%2Fwizard.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard.py?ref=fa4bbfcbfb4f693955f653bd06f384dd786e3c93",
            "patch": "@@ -11,7 +11,7 @@\n \n from django import forms\n from django.conf import settings\n-from django.contrib.formtools.utils import security_hash, form_hmac\n+from django.contrib.formtools.utils import form_hmac\n from django.http import Http404\n from django.shortcuts import render_to_response\n from django.template.context import RequestContext\n@@ -58,24 +58,7 @@ def num_steps(self):\n \n     def _check_security_hash(self, token, request, form):\n         expected = self.security_hash(request, form)\n-        if constant_time_compare(token, expected):\n-            return True\n-        else:\n-            # Fall back to Django 1.2 method, for compatibility with forms that\n-            # are in the middle of being used when the upgrade occurs. However,\n-            # we don't want to do this fallback if a subclass has provided their\n-            # own security_hash method - because they might have implemented a\n-            # more secure method, and this would punch a hole in that.\n-\n-            # PendingDeprecationWarning <- left here to remind us that this\n-            # compatibility fallback should be removed in Django 1.5\n-            FormWizard_expected = FormWizard.security_hash(self, request, form)\n-            if expected == FormWizard_expected:\n-                # They didn't override security_hash, do the fallback:\n-                old_expected = security_hash(request, form)\n-                return constant_time_compare(token, old_expected)\n-            else:\n-                return False\n+        return constant_time_compare(token, expected)\n \n     @method_decorator(csrf_protect)\n     def __call__(self, request, *args, **kwargs):"
        }
    ],
    "stats": {
        "total": 63,
        "additions": 3,
        "deletions": 60
    }
}