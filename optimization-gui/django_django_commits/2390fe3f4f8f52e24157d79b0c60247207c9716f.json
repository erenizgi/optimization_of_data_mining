{
    "author": "claudep",
    "message": "Fixed #19745 -- Forced resolution of verbose names in createsupersuser\n\nThanks Baptiste Mispelon for the report and Preston Holmes for the review.",
    "sha": "2390fe3f4f8f52e24157d79b0c60247207c9716f",
    "files": [
        {
            "sha": "b3cd6f9653d911a159c0e6324c5bd631bc23dc49",
            "filename": "django/contrib/auth/management/commands/createsuperuser.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/2390fe3f4f8f52e24157d79b0c60247207c9716f/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "raw_url": "https://github.com/django/django/raw/2390fe3f4f8f52e24157d79b0c60247207c9716f/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py?ref=2390fe3f4f8f52e24157d79b0c60247207c9716f",
            "patch": "@@ -11,7 +11,7 @@\n from django.core import exceptions\n from django.core.management.base import BaseCommand, CommandError\n from django.db import DEFAULT_DB_ALIAS\n-from django.utils.encoding import force_str\n+from django.utils.encoding import force_str, force_text\n from django.utils.six.moves import input\n from django.utils.text import capfirst\n \n@@ -80,9 +80,10 @@ def handle(self, *args, **options):\n             try:\n \n                 # Get a username\n+                verbose_field_name = force_text(self.username_field.verbose_name)\n                 while username is None:\n                     if not username:\n-                        input_msg = capfirst(self.username_field.verbose_name)\n+                        input_msg = capfirst(verbose_field_name)\n                         if default_username:\n                             input_msg = \"%s (leave blank to use '%s')\" % (\n                                 input_msg, default_username)\n@@ -102,14 +103,14 @@ def handle(self, *args, **options):\n                         pass\n                     else:\n                         self.stderr.write(\"Error: That %s is already taken.\" %\n-                                self.username_field.verbose_name)\n+                                verbose_field_name)\n                         username = None\n \n                 for field_name in self.UserModel.REQUIRED_FIELDS:\n                     field = self.UserModel._meta.get_field(field_name)\n                     user_data[field_name] = options.get(field_name)\n                     while user_data[field_name] is None:\n-                        raw_value = input(force_str('%s: ' % capfirst(field.verbose_name)))\n+                        raw_value = input(force_str('%s: ' % capfirst(force_text(field.verbose_name))))\n                         try:\n                             user_data[field_name] = field.clean(raw_value, None)\n                         except exceptions.ValidationError as e:"
        },
        {
            "sha": "03af1fd7bb1fc92f28acbb245b5781ce0dc5bcf0",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 15,
            "deletions": 5,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/2390fe3f4f8f52e24157d79b0c60247207c9716f/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/2390fe3f4f8f52e24157d79b0c60247207c9716f/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=2390fe3f4f8f52e24157d79b0c60247207c9716f",
            "patch": "@@ -12,6 +12,7 @@\n from django.core.management import call_command\n from django.test import TestCase\n from django.test.utils import override_settings\n+from django.utils.encoding import force_str\n from django.utils.six import StringIO\n \n \n@@ -30,8 +31,13 @@ def mock_input(prompt):\n                 # prompt should be encoded in Python 2. This line will raise an\n                 # Exception if prompt contains unencoded non-ascii on Python 2.\n                 prompt = str(prompt)\n-                if str('leave blank to use') in prompt:\n-                    return inputs['username']\n+                assert str('__proxy__') not in prompt\n+                response = ''\n+                for key, val in inputs.items():\n+                    if force_str(key) in prompt.lower():\n+                        response = val\n+                        break\n+                return response\n \n             old_getpass = createsuperuser.getpass\n             old_input = createsuperuser.input\n@@ -178,16 +184,20 @@ def test_createsuperuser_nolocale(self):\n         u = User.objects.get(username=\"nolocale@somewhere.org\")\n         self.assertEqual(u.email, 'nolocale@somewhere.org')\n \n-    @mock_inputs({'password': \"nopasswd\", 'username': 'foo'})\n+    @mock_inputs({\n+        'password': \"nopasswd\",\n+        'uživatel': 'foo',  # username (cz)\n+        'email': 'nolocale@somewhere.org'})\n     def test_createsuperuser_non_ascii_verbose_name(self):\n+        # Aliased so the string doesn't get extracted\n+        from django.utils.translation import ugettext_lazy as ulazy\n         username_field = User._meta.get_field('username')\n         old_verbose_name = username_field.verbose_name\n-        username_field.verbose_name = 'uživatel'\n+        username_field.verbose_name = ulazy('uživatel')\n         new_io = StringIO()\n         try:\n             call_command(\"createsuperuser\",\n                 interactive=True,\n-                email=\"nolocale@somewhere.org\",\n                 stdout=new_io\n             )\n         finally:"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 20,
        "deletions": 9
    }
}