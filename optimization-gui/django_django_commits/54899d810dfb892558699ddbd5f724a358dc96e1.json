{
    "author": "aaugustin",
    "message": "[py3] Fixed #18805 -- ported createsuperuser.\n\nThanks sunsesh at gmail.com for the report.",
    "sha": "54899d810dfb892558699ddbd5f724a358dc96e1",
    "files": [
        {
            "sha": "23a053d985c6e9e9bfdda4c8fac66e5f49f5e443",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 16,
            "deletions": 9,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/54899d810dfb892558699ddbd5f724a358dc96e1/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/54899d810dfb892558699ddbd5f724a358dc96e1/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=54899d810dfb892558699ddbd5f724a358dc96e1",
            "patch": "@@ -9,6 +9,7 @@\n from django.contrib.auth import models as auth_app\n from django.db.models import get_models, signals\n from django.contrib.auth.models import User\n+from django.utils import six\n from django.utils.six.moves import input\n \n \n@@ -84,17 +85,23 @@ def get_system_username():\n     :returns: The username as a unicode string, or an empty string if the\n         username could not be determined.\n     \"\"\"\n-    default_locale = locale.getdefaultlocale()[1]\n-    if default_locale:\n+    try:\n+        result = getpass.getuser()\n+    except (ImportError, KeyError):\n+        # KeyError will be raised by os.getpwuid() (called by getuser())\n+        # if there is no corresponding entry in the /etc/passwd file\n+        # (a very restricted chroot environment, for example).\n+        return ''\n+    if not six.PY3:\n+        default_locale = locale.getdefaultlocale()[1]\n+        if not default_locale:\n+            return ''\n         try:\n-            return getpass.getuser().decode(default_locale)\n-        except (ImportError, KeyError, UnicodeDecodeError):\n-            # KeyError will be raised by os.getpwuid() (called by getuser())\n-            # if there is no corresponding entry in the /etc/passwd file\n-            # (a very restricted chroot environment, for example).\n+            result = result.decode(default_locale)\n+        except UnicodeDecodeError:\n             # UnicodeDecodeError - preventive treatment for non-latin Windows.\n-            pass\n-    return ''\n+            return ''\n+    return result\n \n \n def get_default_username(check_db=True):"
        },
        {
            "sha": "ac83086dc3ea00d05b448d4ced2bb70cc2235bc1",
            "filename": "django/contrib/auth/tests/management.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/54899d810dfb892558699ddbd5f724a358dc96e1/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/54899d810dfb892558699ddbd5f724a358dc96e1/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py?ref=54899d810dfb892558699ddbd5f724a358dc96e1",
            "patch": "@@ -4,16 +4,20 @@\n from django.contrib.auth.management.commands import changepassword\n from django.core.management.base import CommandError\n from django.test import TestCase\n+from django.utils import six\n from django.utils.six import StringIO\n \n \n class GetDefaultUsernameTestCase(TestCase):\n \n     def setUp(self):\n-        self._getpass_getuser = management.get_system_username\n+        self.old_get_system_username = management.get_system_username\n \n     def tearDown(self):\n-        management.get_system_username = self._getpass_getuser\n+        management.get_system_username = self.old_get_system_username\n+\n+    def test_actual_implementation(self):\n+        self.assertIsInstance(management.get_system_username(), six.text_type)\n \n     def test_simple(self):\n         management.get_system_username = lambda: 'joe'"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 22,
        "deletions": 11
    }
}