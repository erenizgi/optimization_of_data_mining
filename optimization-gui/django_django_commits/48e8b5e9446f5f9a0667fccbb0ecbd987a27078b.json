{
    "author": "SmileyChris",
    "message": "Add orphans support to MultipleObjectMixin\n\nFixes #7005",
    "sha": "48e8b5e9446f5f9a0667fccbb0ecbd987a27078b",
    "files": [
        {
            "sha": "1f286168f6ded2b21789ae270d3c2306d9accea5",
            "filename": "django/views/generic/list.py",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/django%2Fviews%2Fgeneric%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/django%2Fviews%2Fgeneric%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Flist.py?ref=48e8b5e9446f5f9a0667fccbb0ecbd987a27078b",
            "patch": "@@ -15,6 +15,7 @@ class MultipleObjectMixin(ContextMixin):\n     queryset = None\n     model = None\n     paginate_by = None\n+    paginate_orphans = 0\n     context_object_name = None\n     paginator_class = Paginator\n     page_kwarg = 'page'\n@@ -39,7 +40,9 @@ def paginate_queryset(self, queryset, page_size):\n         \"\"\"\n         Paginate the queryset, if needed.\n         \"\"\"\n-        paginator = self.get_paginator(queryset, page_size, allow_empty_first_page=self.get_allow_empty())\n+        paginator = self.get_paginator(\n+            queryset, page_size, orphans=self.get_paginate_orphans(),\n+            allow_empty_first_page=self.get_allow_empty())\n         page_kwarg = self.page_kwarg\n         page = self.kwargs.get(page_kwarg) or self.request.GET.get(page_kwarg) or 1\n         try:\n@@ -64,11 +67,21 @@ def get_paginate_by(self, queryset):\n         \"\"\"\n         return self.paginate_by\n \n-    def get_paginator(self, queryset, per_page, orphans=0, allow_empty_first_page=True):\n+    def get_paginator(self, queryset, per_page, orphans=0,\n+                      allow_empty_first_page=True, **kwargs):\n         \"\"\"\n         Return an instance of the paginator for this view.\n         \"\"\"\n-        return self.paginator_class(queryset, per_page, orphans=orphans, allow_empty_first_page=allow_empty_first_page)\n+        return self.paginator_class(\n+            queryset, per_page, orphans=orphans,\n+            allow_empty_first_page=allow_empty_first_page, **kwargs)\n+\n+    def get_paginate_orphans(self):\n+        \"\"\"\n+        Returns the maximum number of orphans extend the last page by when\n+        paginating.\n+        \"\"\"\n+        return self.paginate_orphans\n \n     def get_allow_empty(self):\n         \"\"\""
        },
        {
            "sha": "aa2f51f15662e83964dfe95057eee9bf09fee8e2",
            "filename": "docs/ref/class-based-views/flattened-index.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt",
            "raw_url": "https://github.com/django/django/raw/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fflattened-index.txt?ref=48e8b5e9446f5f9a0667fccbb0ecbd987a27078b",
            "patch": "@@ -116,6 +116,7 @@ ListView\n * :attr:`~django.views.generic.base.View.http_method_names`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -290,6 +291,7 @@ ArchiveIndexView\n * :attr:`~django.views.generic.base.View.http_method_names`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -325,6 +327,7 @@ YearArchiveView\n * :attr:`~django.views.generic.dates.BaseYearArchiveView.make_object_list` [:meth:`~django.views.generic.dates.BaseYearArchiveView.get_make_object_list`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -363,6 +366,7 @@ MonthArchiveView\n * :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n * :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -401,6 +405,7 @@ WeekArchiveView\n * :attr:`~django.views.generic.base.View.http_method_names`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.model`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -443,6 +448,7 @@ DayArchiveView\n * :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n * :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`\n@@ -487,6 +493,7 @@ TodayArchiveView\n * :attr:`~django.views.generic.dates.MonthMixin.month` [:meth:`~django.views.generic.dates.MonthMixin.get_month`]\n * :attr:`~django.views.generic.dates.MonthMixin.month_format` [:meth:`~django.views.generic.dates.MonthMixin.get_month_format`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_by` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_by`]\n+* :attr:`~django.views.generic.list.MultipleObjectMixin.paginate_orphans` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_paginate_orphans`]\n * :attr:`~django.views.generic.list.MultipleObjectMixin.paginator_class`\n * :attr:`~django.views.generic.list.MultipleObjectMixin.queryset` [:meth:`~django.views.generic.list.MultipleObjectMixin.get_queryset`]\n * :attr:`~django.views.generic.base.TemplateResponseMixin.response_class`"
        },
        {
            "sha": "c85c962bce6f337a199e5587c5385fd8a188b8a9",
            "filename": "docs/ref/class-based-views/mixins-multiple-object.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt",
            "raw_url": "https://github.com/django/django/raw/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-multiple-object.txt?ref=48e8b5e9446f5f9a0667fccbb0ecbd987a27078b",
            "patch": "@@ -72,6 +72,16 @@ MultipleObjectMixin\n         expect either a ``page`` query string parameter (via ``request.GET``)\n         or a ``page`` variable specified in the URLconf.\n \n+    .. attribute:: paginate_orphans\n+\n+        .. versionadded:: 1.6\n+\n+        An integer specifying the number of \"overflow\" objects the last page\n+        can contain. This extends the :attr:`MultipleObjectMixin.paginate_by`\n+        limit on the last page by up to\n+        :attr:`MultipleObjectMixin.paginate_orphans`, in order to keep the last\n+        page from having a very small number of objects.\n+\n     .. attribute:: page_kwarg\n \n         .. versionadded:: 1.5\n@@ -119,6 +129,14 @@ MultipleObjectMixin\n         Returns an instance of the paginator to use for this view. By default,\n         instantiates an instance of :attr:`paginator_class`.\n \n+    .. method:: get_paginate_by()\n+\n+        .. versionadded:: 1.6\n+\n+        An integer specifying the number of \"overflow\" objects the last page\n+        can contain. By default this simply returns the value of\n+        :attr:`MultipleObjectMixin.paginate_orphans`.\n+\n     .. method:: get_allow_empty()\n \n         Return a boolean specifying whether to display the page if no objects"
        },
        {
            "sha": "be2721d775871c113136433cede2546c8d3f3ba9",
            "filename": "tests/regressiontests/generic_views/list.py",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Flist.py?ref=48e8b5e9446f5f9a0667fccbb0ecbd987a27078b",
            "patch": "@@ -118,8 +118,26 @@ def test_paginated_custom_paginator_constructor(self):\n         # Custom pagination allows for 2 orphans on a page size of 5\n         self.assertEqual(len(res.context['object_list']), 7)\n \n+    def test_paginated_orphaned_queryset(self):\n+        self._make_authors(92)\n+        res = self.client.get('/list/authors/paginated-orphaned/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['page_obj'].number, 1)\n+        res = self.client.get(\n+            '/list/authors/paginated-orphaned/', {'page': 'last'})\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['page_obj'].number, 3)\n+        res = self.client.get(\n+            '/list/authors/paginated-orphaned/', {'page': '3'})\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['page_obj'].number, 3)\n+        res = self.client.get(\n+            '/list/authors/paginated-orphaned/', {'page': '4'})\n+        self.assertEqual(res.status_code, 404)\n+\n     def test_paginated_non_queryset(self):\n         res = self.client.get('/list/dict/paginated/')\n+\n         self.assertEqual(res.status_code, 200)\n         self.assertEqual(len(res.context['object_list']), 1)\n "
        },
        {
            "sha": "4daf53dbafcc361e6660a9eb8757ea95c4295388",
            "filename": "tests/regressiontests/generic_views/urls.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/48e8b5e9446f5f9a0667fccbb0ecbd987a27078b/tests%2Fregressiontests%2Fgeneric_views%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Furls.py?ref=48e8b5e9446f5f9a0667fccbb0ecbd987a27078b",
            "patch": "@@ -133,6 +133,8 @@\n         views.AuthorList.as_view(paginate_by=30)),\n     (r'^list/authors/paginated/(?P<page>\\d+)/$',\n         views.AuthorList.as_view(paginate_by=30)),\n+    (r'^list/authors/paginated-orphaned/$',\n+        views.AuthorList.as_view(paginate_by=30, paginate_orphans=2)),\n     (r'^list/authors/notempty/$',\n         views.AuthorList.as_view(allow_empty=False)),\n     (r'^list/authors/notempty/paginated/$',"
        }
    ],
    "stats": {
        "total": 64,
        "additions": 61,
        "deletions": 3
    }
}