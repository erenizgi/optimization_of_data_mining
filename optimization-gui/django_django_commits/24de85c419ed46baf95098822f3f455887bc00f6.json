{
    "author": "claudep",
    "message": "[py3] Fixed more encoding issues in cache tests",
    "sha": "24de85c419ed46baf95098822f3f455887bc00f6",
    "files": [
        {
            "sha": "0e25941e876320331a1606388ec55afb61ea152e",
            "filename": "django/core/cache/backends/db.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/24de85c419ed46baf95098822f3f455887bc00f6/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/24de85c419ed46baf95098822f3f455887bc00f6/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fdb.py?ref=24de85c419ed46baf95098822f3f455887bc00f6",
            "patch": "@@ -12,6 +12,7 @@\n from django.core.cache.backends.base import BaseCache\n from django.db import connections, router, transaction, DatabaseError\n from django.utils import timezone\n+from django.utils.encoding import smart_bytes\n \n \n class Options(object):\n@@ -72,7 +73,7 @@ def get(self, key, default=None, version=None):\n             transaction.commit_unless_managed(using=db)\n             return default\n         value = connections[db].ops.process_clob(row[1])\n-        return pickle.loads(base64.b64decode(value))\n+        return pickle.loads(base64.b64decode(smart_bytes(value)))\n \n     def set(self, key, value, timeout=None, version=None):\n         key = self.make_key(key, version=version)"
        },
        {
            "sha": "a6534c5f544fec47dd39d53982a0218df155f36b",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/24de85c419ed46baf95098822f3f455887bc00f6/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/24de85c419ed46baf95098822f3f455887bc00f6/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=24de85c419ed46baf95098822f3f455887bc00f6",
            "patch": "@@ -372,19 +372,19 @@ def test_binary_string(self):\n         self.cache.set('binary1', compressed_value)\n         compressed_result = self.cache.get('binary1')\n         self.assertEqual(compressed_value, compressed_result)\n-        self.assertEqual(value, decompress(compressed_result))\n+        self.assertEqual(value, decompress(compressed_result).decode())\n \n         # Test add\n         self.cache.add('binary1-add', compressed_value)\n         compressed_result = self.cache.get('binary1-add')\n         self.assertEqual(compressed_value, compressed_result)\n-        self.assertEqual(value, decompress(compressed_result))\n+        self.assertEqual(value, decompress(compressed_result).decode())\n \n         # Test set_many\n         self.cache.set_many({'binary1-set_many': compressed_value})\n         compressed_result = self.cache.get('binary1-set_many')\n         self.assertEqual(compressed_value, compressed_result)\n-        self.assertEqual(value, decompress(compressed_result))\n+        self.assertEqual(value, decompress(compressed_result).decode())\n \n     def test_set_many(self):\n         # Multiple keys can be set using set_many\n@@ -1227,7 +1227,7 @@ def test_head_caches_correctly(self):\n         request = self._get_request('HEAD')\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n         self.assertNotEqual(get_cache_data, None)\n-        self.assertEqual(test_content, get_cache_data.content)\n+        self.assertEqual(test_content.encode(), get_cache_data.content)\n \n     def test_head_with_cached_get(self):\n         test_content = 'test content'\n@@ -1238,7 +1238,7 @@ def test_head_with_cached_get(self):\n         request = self._get_request('HEAD')\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n         self.assertNotEqual(get_cache_data, None)\n-        self.assertEqual(test_content, get_cache_data.content)\n+        self.assertEqual(test_content.encode(), get_cache_data.content)\n \n \n @override_settings(\n@@ -1378,7 +1378,7 @@ def set_cache(request, lang, msg):\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n         # cache must return content\n         self.assertNotEqual(get_cache_data, None)\n-        self.assertEqual(get_cache_data.content, content)\n+        self.assertEqual(get_cache_data.content, content.encode())\n         # different QUERY_STRING, cache must be empty\n         request = self._get_request_cache(query_string='foo=bar&somethingelse=true')\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n@@ -1393,7 +1393,7 @@ def set_cache(request, lang, msg):\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n         # Check that we can recover the cache\n         self.assertNotEqual(get_cache_data, None)\n-        self.assertEqual(get_cache_data.content, en_message)\n+        self.assertEqual(get_cache_data.content, en_message.encode())\n         # Check that we use etags\n         self.assertTrue(get_cache_data.has_header('ETag'))\n         # Check that we can disable etags\n@@ -1409,11 +1409,11 @@ def set_cache(request, lang, msg):\n         translation.activate('en')\n         # retrieve the content from cache\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n-        self.assertEqual(get_cache_data.content, en_message)\n+        self.assertEqual(get_cache_data.content, en_message.encode())\n         # change again the language\n         translation.activate('es')\n         get_cache_data = FetchFromCacheMiddleware().process_request(request)\n-        self.assertEqual(get_cache_data.content, es_message)\n+        self.assertEqual(get_cache_data.content, es_message.encode())\n         # reset the language\n         translation.deactivate()\n \n@@ -1519,7 +1519,7 @@ def test_middleware(self):\n         # Repeating the request should result in a cache hit\n         result = middleware.process_request(request)\n         self.assertNotEqual(result, None)\n-        self.assertEqual(result.content, 'Hello World 1')\n+        self.assertEqual(result.content, b'Hello World 1')\n \n         # The same request through a different middleware won't hit\n         result = prefix_middleware.process_request(request)\n@@ -1528,7 +1528,7 @@ def test_middleware(self):\n         # The same request with a timeout _will_ hit\n         result = timeout_middleware.process_request(request)\n         self.assertNotEqual(result, None)\n-        self.assertEqual(result.content, 'Hello World 1')\n+        self.assertEqual(result.content, b'Hello World 1')\n \n     @override_settings(CACHE_MIDDLEWARE_ANONYMOUS_ONLY=True)\n     def test_cache_middleware_anonymous_only_wont_cause_session_access(self):\n@@ -1670,7 +1670,7 @@ def test_view_decorator(self):\n         # And if we wait a few more seconds\n         time.sleep(2)\n \n-        # the custom timeouot cache will miss\n+        # the custom timeout cache will miss\n         response = other_with_timeout_view(request, '18')\n         self.assertEqual(response.content, b'Hello World 18')\n "
        }
    ],
    "stats": {
        "total": 27,
        "additions": 14,
        "deletions": 13
    }
}