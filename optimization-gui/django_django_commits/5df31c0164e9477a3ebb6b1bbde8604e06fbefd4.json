{
    "author": "jezdez",
    "message": "Fixed #17194 -- Made sure the auth form tests work if a language other than English is activated by moving the error message translation strings into class level dictionaries. Many thanks to Claude Paroz, rabio and Bas Peschier for their initial work on this.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17204 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "5df31c0164e9477a3ebb6b1bbde8604e06fbefd4",
    "files": [
        {
            "sha": "23185a0ece350c49f7e29ad1c8eec1c04fdeecb5",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 46,
            "deletions": 12,
            "changes": 58,
            "blob_url": "https://github.com/django/django/blob/5df31c0164e9477a3ebb6b1bbde8604e06fbefd4/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/5df31c0164e9477a3ebb6b1bbde8604e06fbefd4/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=5df31c0164e9477a3ebb6b1bbde8604e06fbefd4",
            "patch": "@@ -15,6 +15,7 @@\n \n mask_password = lambda p: \"%s%s\" % (p[:UNMASKED_DIGITS_TO_SHOW], \"*\" * max(len(p) - UNMASKED_DIGITS_TO_SHOW, 0))\n \n+\n class ReadOnlyPasswordHashWidget(forms.Widget):\n     def render(self, name, value, attrs):\n         if not value:\n@@ -39,17 +40,23 @@ def render(self, name, value, attrs):\n                     \"masked\": masked,\n                 })\n \n+\n class ReadOnlyPasswordHashField(forms.Field):\n     widget = ReadOnlyPasswordHashWidget\n \n     def __init__(self, *args, **kwargs):\n         kwargs.setdefault(\"required\", False)\n         super(ReadOnlyPasswordHashField, self).__init__(*args, **kwargs)\n \n+\n class UserCreationForm(forms.ModelForm):\n     \"\"\"\n     A form that creates a user, with no privileges, from the given username and password.\n     \"\"\"\n+    error_messages = {\n+        'duplicate_username': _(\"A user with that username already exists.\"),\n+        'password_mismatch': _(\"The two password fields didn't match.\"),\n+    }\n     username = forms.RegexField(label=_(\"Username\"), max_length=30, regex=r'^[\\w.@+-]+$',\n         help_text = _(\"Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.\"),\n         error_messages = {'invalid': _(\"This value may contain only letters, numbers and @/./+/-/_ characters.\")})\n@@ -67,13 +74,13 @@ def clean_username(self):\n             User.objects.get(username=username)\n         except User.DoesNotExist:\n             return username\n-        raise forms.ValidationError(_(\"A user with that username already exists.\"))\n+        raise forms.ValidationError(self.error_messages['duplicate_username'])\n \n     def clean_password2(self):\n         password1 = self.cleaned_data.get(\"password1\", \"\")\n         password2 = self.cleaned_data[\"password2\"]\n         if password1 != password2:\n-            raise forms.ValidationError(_(\"The two password fields didn't match.\"))\n+            raise forms.ValidationError(self.error_messages['password_mismatch'])\n         return password2\n \n     def save(self, commit=True):\n@@ -83,6 +90,7 @@ def save(self, commit=True):\n             user.save()\n         return user\n \n+\n class UserChangeForm(forms.ModelForm):\n     username = forms.RegexField(label=_(\"Username\"), max_length=30, regex=r'^[\\w.@+-]+$',\n         help_text = _(\"Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.\"),\n@@ -101,6 +109,7 @@ def __init__(self, *args, **kwargs):\n         if f is not None:\n             f.queryset = f.queryset.select_related('content_type')\n \n+\n class AuthenticationForm(forms.Form):\n     \"\"\"\n     Base class for authenticating users. Extend this to get a form that accepts\n@@ -109,6 +118,14 @@ class AuthenticationForm(forms.Form):\n     username = forms.CharField(label=_(\"Username\"), max_length=30)\n     password = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n \n+    error_messages = {\n+        'invalid_login': _(\"Please enter a correct username and password. \"\n+                           \"Note that both fields are case-sensitive.\"),\n+        'no_cookies': _(\"Your Web browser doesn't appear to have cookies \"\n+                        \"enabled. Cookies are required for logging in.\"),\n+        'inactive': _(\"This account is inactive.\"),\n+    }\n+\n     def __init__(self, request=None, *args, **kwargs):\n         \"\"\"\n         If request is passed in, the form will validate that cookies are\n@@ -127,17 +144,15 @@ def clean(self):\n         if username and password:\n             self.user_cache = authenticate(username=username, password=password)\n             if self.user_cache is None:\n-                raise forms.ValidationError(_(\"Please enter a correct username and password. Note that both fields are case-sensitive.\"))\n+                raise forms.ValidationError(self.error_messages['invalid_login'])\n             elif not self.user_cache.is_active:\n-                raise forms.ValidationError(_(\"This account is inactive.\"))\n+                raise forms.ValidationError(self.error_messages['inactive'])\n         self.check_for_test_cookie()\n         return self.cleaned_data\n \n     def check_for_test_cookie(self):\n         if self.request and not self.request.session.test_cookie_worked():\n-            raise forms.ValidationError(\n-                _(\"Your Web browser doesn't appear to have cookies enabled. \"\n-                  \"Cookies are required for logging in.\"))\n+            raise forms.ValidationError(self.error_messages['no_cookies'])\n \n     def get_user_id(self):\n         if self.user_cache:\n@@ -147,7 +162,14 @@ def get_user_id(self):\n     def get_user(self):\n         return self.user_cache\n \n+\n class PasswordResetForm(forms.Form):\n+    error_messages = {\n+        'unknown': _(\"That e-mail address doesn't have an associated \"\n+                     \"user account. Are you sure you've registered?\"),\n+        'unusable': _(\"The user account associated with this e-mail \"\n+                      \"address cannot reset the password.\"),\n+    }\n     email = forms.EmailField(label=_(\"E-mail\"), max_length=75)\n \n     def clean_email(self):\n@@ -159,9 +181,9 @@ def clean_email(self):\n                                 email__iexact=email,\n                                 is_active=True)\n         if not len(self.users_cache):\n-            raise forms.ValidationError(_(\"That e-mail address doesn't have an associated user account. Are you sure you've registered?\"))\n+            raise forms.ValidationError(self.error_messages['unknown'])\n         if any((user.password == UNUSABLE_PASSWORD) for user in self.users_cache):\n-            raise forms.ValidationError(_(\"The user account associated with this e-mail address cannot reset the password.\"))\n+            raise forms.ValidationError(self.error_messages['unusable'])\n         return email\n \n     def save(self, domain_override=None,\n@@ -195,11 +217,15 @@ def save(self, domain_override=None,\n             email = loader.render_to_string(email_template_name, c)\n             send_mail(subject, email, from_email, [user.email])\n \n+\n class SetPasswordForm(forms.Form):\n     \"\"\"\n     A form that lets a user change set his/her password without\n     entering the old password\n     \"\"\"\n+    error_messages = {\n+        'password_mismatch': _(\"The two password fields didn't match.\"),\n+    }\n     new_password1 = forms.CharField(label=_(\"New password\"), widget=forms.PasswordInput)\n     new_password2 = forms.CharField(label=_(\"New password confirmation\"), widget=forms.PasswordInput)\n \n@@ -212,7 +238,7 @@ def clean_new_password2(self):\n         password2 = self.cleaned_data.get('new_password2')\n         if password1 and password2:\n             if password1 != password2:\n-                raise forms.ValidationError(_(\"The two password fields didn't match.\"))\n+                raise forms.ValidationError(self.error_messages['password_mismatch'])\n         return password2\n \n     def save(self, commit=True):\n@@ -221,11 +247,15 @@ def save(self, commit=True):\n             self.user.save()\n         return self.user\n \n+\n class PasswordChangeForm(SetPasswordForm):\n     \"\"\"\n     A form that lets a user change his/her password by entering\n     their old password.\n     \"\"\"\n+    error_messages = dict(SetPasswordForm.error_messages, **{\n+        'password_incorrect': _(\"Your old password was entered incorrectly. Please enter it again.\"),\n+    })\n     old_password = forms.CharField(label=_(\"Old password\"), widget=forms.PasswordInput)\n \n     def clean_old_password(self):\n@@ -234,14 +264,18 @@ def clean_old_password(self):\n         \"\"\"\n         old_password = self.cleaned_data[\"old_password\"]\n         if not self.user.check_password(old_password):\n-            raise forms.ValidationError(_(\"Your old password was entered incorrectly. Please enter it again.\"))\n+            raise forms.ValidationError(self.error_messages['password_incorrect'])\n         return old_password\n PasswordChangeForm.base_fields.keyOrder = ['old_password', 'new_password1', 'new_password2']\n \n+\n class AdminPasswordChangeForm(forms.Form):\n     \"\"\"\n     A form used to change the password of a user in the admin interface.\n     \"\"\"\n+    error_messages = {\n+        'password_mismatch': _(\"The two password fields didn't match.\"),\n+    }\n     password1 = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n     password2 = forms.CharField(label=_(\"Password (again)\"), widget=forms.PasswordInput)\n \n@@ -254,7 +288,7 @@ def clean_password2(self):\n         password2 = self.cleaned_data.get('password2')\n         if password1 and password2:\n             if password1 != password2:\n-                raise forms.ValidationError(_(\"The two password fields didn't match.\"))\n+                raise forms.ValidationError(self.error_messages['password_mismatch'])\n         return password2\n \n     def save(self, commit=True):"
        },
        {
            "sha": "2bacc8e61199f91514cbaafbecb8416804d90555",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 34,
            "deletions": 26,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/5df31c0164e9477a3ebb6b1bbde8604e06fbefd4/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/5df31c0164e9477a3ebb6b1bbde8604e06fbefd4/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=5df31c0164e9477a3ebb6b1bbde8604e06fbefd4",
            "patch": "@@ -1,9 +1,12 @@\n from __future__ import with_statement\n import os\n from django.core import mail\n+from django.forms.fields import Field, EmailField\n from django.contrib.auth.models import User\n from django.contrib.auth.forms import UserCreationForm, AuthenticationForm,  PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm\n from django.test import TestCase\n+from django.utils.encoding import force_unicode\n+from django.utils import translation\n \n \n class UserCreationFormTest(TestCase):\n@@ -19,7 +22,7 @@ def test_user_already_exists(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"username\"].errors,\n-                         [u'A user with that username already exists.'])\n+                         [force_unicode(form.error_messages['duplicate_username'])])\n \n     def test_invalid_data(self):\n         data = {\n@@ -30,8 +33,7 @@ def test_invalid_data(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"username\"].errors,\n-                         [u'This value may contain only letters, numbers and @/./+/-/_ characters.'])\n-\n+                         [force_unicode(form.fields['username'].error_messages['invalid'])])\n \n     def test_password_verification(self):\n         # The verification password is incorrect.\n@@ -43,25 +45,21 @@ def test_password_verification(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"password2\"].errors,\n-                         [u\"The two password fields didn't match.\"])\n-\n+                         [force_unicode(form.error_messages['password_mismatch'])])\n \n     def test_both_passwords(self):\n         # One (or both) passwords weren't given\n         data = {'username': 'jsmith'}\n         form = UserCreationForm(data)\n+        required_error = [force_unicode(Field.default_error_messages['required'])]\n         self.assertFalse(form.is_valid())\n-        self.assertEqual(form['password1'].errors,\n-                         [u'This field is required.'])\n-        self.assertEqual(form['password2'].errors,\n-                         [u'This field is required.'])\n-\n+        self.assertEqual(form['password1'].errors, required_error)\n+        self.assertEqual(form['password2'].errors, required_error)\n \n         data['password2'] = 'test123'\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n-        self.assertEqual(form['password1'].errors,\n-                         [u'This field is required.'])\n+        self.assertEqual(form['password1'].errors, required_error)\n \n     def test_success(self):\n         # The success case.\n@@ -91,7 +89,7 @@ def test_invalid_username(self):\n         form = AuthenticationForm(None, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.non_field_errors(),\n-                         [u'Please enter a correct username and password. Note that both fields are case-sensitive.'])\n+                         [force_unicode(form.error_messages['invalid_login'])])\n \n     def test_inactive_user(self):\n         # The user is inactive.\n@@ -102,8 +100,20 @@ def test_inactive_user(self):\n         form = AuthenticationForm(None, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.non_field_errors(),\n-                         [u'This account is inactive.'])\n-\n+                         [force_unicode(form.error_messages['inactive'])])\n+\n+    def test_inactive_user_i18n(self):\n+        with self.settings(USE_I18N=True):\n+            with translation.override('pt-br', deactivate=True):\n+                # The user is inactive.\n+                data = {\n+                    'username': 'inactive',\n+                    'password': 'password',\n+                    }\n+                form = AuthenticationForm(None, data)\n+                self.assertFalse(form.is_valid())\n+                self.assertEqual(form.non_field_errors(),\n+                                 [force_unicode(form.error_messages['inactive'])])\n \n     def test_success(self):\n         # The success case\n@@ -130,7 +140,7 @@ def test_password_verification(self):\n         form = SetPasswordForm(user, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"new_password2\"].errors,\n-                         [u\"The two password fields didn't match.\"])\n+                         [force_unicode(form.error_messages['password_mismatch'])])\n \n     def test_success(self):\n         user = User.objects.get(username='testclient')\n@@ -156,8 +166,7 @@ def test_incorrect_password(self):\n         form = PasswordChangeForm(user, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"old_password\"].errors,\n-                         [u'Your old password was entered incorrectly. Please enter it again.'])\n-\n+                         [force_unicode(form.error_messages['password_incorrect'])])\n \n     def test_password_verification(self):\n         # The two new passwords do not match.\n@@ -170,8 +179,7 @@ def test_password_verification(self):\n         form = PasswordChangeForm(user, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"new_password2\"].errors,\n-                         [u\"The two password fields didn't match.\"])\n-\n+                         [force_unicode(form.error_messages['password_mismatch'])])\n \n     def test_success(self):\n         # The success case.\n@@ -190,6 +198,7 @@ def test_field_order(self):\n         self.assertEqual(PasswordChangeForm(user, {}).fields.keys(),\n                          ['old_password', 'new_password1', 'new_password2'])\n \n+\n class UserChangeFormTest(TestCase):\n \n     fixtures = ['authtestdata.json']\n@@ -200,7 +209,7 @@ def test_username_validity(self):\n         form = UserChangeForm(data, instance=user)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form['username'].errors,\n-                         [u'This value may contain only letters, numbers and @/./+/-/_ characters.'])\n+                         [force_unicode(form.fields['username'].error_messages['invalid'])])\n \n     def test_bug_14242(self):\n         # A regression test, introduce by adding an optimization for the\n@@ -232,19 +241,19 @@ def create_dummy_user(self):\n         return (user, username, email)\n \n     def test_invalid_email(self):\n-        data = {'email':'not valid'}\n+        data = {'email': 'not valid'}\n         form = PasswordResetForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form['email'].errors,\n-                         [u'Enter a valid e-mail address.'])\n+                         [force_unicode(EmailField.default_error_messages['invalid'])])\n \n     def test_nonexistant_email(self):\n         # Test nonexistant email address\n-        data = {'email':'foo@bar.com'}\n+        data = {'email': 'foo@bar.com'}\n         form = PasswordResetForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.errors,\n-                         {'email': [u\"That e-mail address doesn't have an associated user account. Are you sure you've registered?\"]})\n+                         {'email': [force_unicode(form.error_messages['unknown'])]})\n \n     def test_cleaned_data(self):\n         # Regression test\n@@ -284,7 +293,6 @@ def test_inactive_user(self):\n         form = PasswordResetForm({'email': email})\n         self.assertFalse(form.is_valid())\n \n-\n     def test_unusable_password(self):\n         user = User.objects.create_user('testuser', 'test@example.com', 'test')\n         data = {\"email\": \"test@example.com\"}"
        },
        {
            "sha": "1975266f4fd6e4af208b792489a2755c756f7b46",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 43,
            "deletions": 45,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/5df31c0164e9477a3ebb6b1bbde8604e06fbefd4/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/5df31c0164e9477a3ebb6b1bbde8604e06fbefd4/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=5df31c0164e9477a3ebb6b1bbde8604e06fbefd4",
            "patch": "@@ -4,15 +4,18 @@\n import urllib\n \n from django.conf import settings\n-from django.contrib.auth import SESSION_KEY, REDIRECT_FIELD_NAME\n-from django.contrib.auth.forms import AuthenticationForm\n from django.contrib.sites.models import Site, RequestSite\n from django.contrib.auth.models import User\n-from django.core.urlresolvers import NoReverseMatch\n-from django.test import TestCase\n from django.core import mail\n-from django.core.urlresolvers import reverse\n+from django.core.urlresolvers import reverse, NoReverseMatch\n from django.http import QueryDict\n+from django.utils.encoding import force_unicode\n+from django.utils.html import escape\n+from django.test import TestCase\n+\n+from django.contrib.auth import SESSION_KEY, REDIRECT_FIELD_NAME\n+from django.contrib.auth.forms import (AuthenticationForm, PasswordChangeForm,\n+                SetPasswordForm, PasswordResetForm)\n \n \n class AuthViewsTestCase(TestCase):\n@@ -40,13 +43,15 @@ def tearDown(self):\n     def login(self, password='password'):\n         response = self.client.post('/login/', {\n             'username': 'testclient',\n-            'password': password\n-            }\n-        )\n+            'password': password,\n+            })\n         self.assertEqual(response.status_code, 302)\n         self.assertTrue(response['Location'].endswith(settings.LOGIN_REDIRECT_URL))\n         self.assertTrue(SESSION_KEY in self.client.session)\n \n+    def assertContainsEscaped(self, response, text, **kwargs):\n+        return self.assertContains(response, escape(force_unicode(text)), **kwargs)\n+\n \n class AuthViewNamedURLTests(AuthViewsTestCase):\n     urls = 'django.contrib.auth.urls'\n@@ -80,7 +85,7 @@ def test_email_not_found(self):\n         response = self.client.get('/password_reset/')\n         self.assertEqual(response.status_code, 200)\n         response = self.client.post('/password_reset/', {'email': 'not_a_real_email@email.com'})\n-        self.assertContains(response, \"That e-mail address doesn&#39;t have an associated user account\")\n+        self.assertContainsEscaped(response, PasswordResetForm.error_messages['unknown'])\n         self.assertEqual(len(mail.outbox), 0)\n \n     def test_email_found(self):\n@@ -121,7 +126,7 @@ def test_confirm_invalid(self):\n         url, path = self._test_confirm_start()\n         # Let's munge the token in the path, but keep the same length,\n         # in case the URLconf will reject a different length.\n-        path = path[:-5] + (\"0\"*4) + path[-1]\n+        path = path[:-5] + (\"0\" * 4) + path[-1]\n \n         response = self.client.get(path)\n         self.assertEqual(response.status_code, 200)\n@@ -143,10 +148,12 @@ def test_confirm_invalid_post(self):\n         # Same as test_confirm_invalid, but trying\n         # to do a POST instead.\n         url, path = self._test_confirm_start()\n-        path = path[:-5] + (\"0\"*4) + path[-1]\n+        path = path[:-5] + (\"0\" * 4) + path[-1]\n \n-        response = self.client.post(path, {'new_password1': 'anewpassword',\n-                                           'new_password2':' anewpassword'})\n+        self.client.post(path, {\n+            'new_password1': 'anewpassword',\n+            'new_password2': ' anewpassword',\n+        })\n         # Check the password has not been changed\n         u = User.objects.get(email='staffmember@example.com')\n         self.assertTrue(not u.check_password(\"anewpassword\"))\n@@ -169,20 +176,20 @@ def test_confirm_complete(self):\n     def test_confirm_different_passwords(self):\n         url, path = self._test_confirm_start()\n         response = self.client.post(path, {'new_password1': 'anewpassword',\n-                                           'new_password2':' x'})\n+                                           'new_password2': 'x'})\n         self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\"The two password fields didn&#39;t match\" in response.content)\n+        self.assertContainsEscaped(response, SetPasswordForm.error_messages['password_mismatch'])\n+\n \n class ChangePasswordTest(AuthViewsTestCase):\n \n     def fail_login(self, password='password'):\n         response = self.client.post('/login/', {\n             'username': 'testclient',\n-            'password': password\n-            }\n-        )\n+            'password': password,\n+        })\n         self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\"Please enter a correct username and password. Note that both fields are case-sensitive.\" in response.content)\n+        self.assertContainsEscaped(response, AuthenticationForm.error_messages['invalid_login'])\n \n     def logout(self):\n         response = self.client.get('/logout/')\n@@ -193,30 +200,27 @@ def test_password_change_fails_with_invalid_old_password(self):\n             'old_password': 'donuts',\n             'new_password1': 'password1',\n             'new_password2': 'password1',\n-            }\n-        )\n+        })\n         self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\"Your old password was entered incorrectly. Please enter it again.\" in response.content)\n+        self.assertContainsEscaped(response, PasswordChangeForm.error_messages['password_incorrect'])\n \n     def test_password_change_fails_with_mismatched_passwords(self):\n         self.login()\n         response = self.client.post('/password_change/', {\n             'old_password': 'password',\n             'new_password1': 'password1',\n             'new_password2': 'donuts',\n-            }\n-        )\n+        })\n         self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\"The two password fields didn&#39;t match.\" in response.content)\n+        self.assertContainsEscaped(response, SetPasswordForm.error_messages['password_mismatch'])\n \n     def test_password_change_succeeds(self):\n         self.login()\n         response = self.client.post('/password_change/', {\n             'old_password': 'password',\n             'new_password1': 'password1',\n             'new_password2': 'password1',\n-            }\n-        )\n+        })\n         self.assertEqual(response.status_code, 302)\n         self.assertTrue(response['Location'].endswith('/password_change/done/'))\n         self.fail_login()\n@@ -228,8 +232,7 @@ def test_password_change_done_succeeds(self):\n             'old_password': 'password',\n             'new_password1': 'password1',\n             'new_password2': 'password1',\n-            }\n-        )\n+        })\n         self.assertEqual(response.status_code, 302)\n         self.assertTrue(response['Location'].endswith('/password_change/done/'))\n \n@@ -266,13 +269,12 @@ def test_security_check(self, password='password'):\n             nasty_url = '%(url)s?%(next)s=%(bad_url)s' % {\n                 'url': login_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'bad_url': urllib.quote(bad_url)\n+                'bad_url': urllib.quote(bad_url),\n             }\n             response = self.client.post(nasty_url, {\n                 'username': 'testclient',\n                 'password': password,\n-                }\n-            )\n+            })\n             self.assertEqual(response.status_code, 302)\n             self.assertFalse(bad_url in response['Location'],\n                              \"%s should be blocked\" % bad_url)\n@@ -284,18 +286,16 @@ def test_security_check(self, password='password'):\n                          'view/?param=//example.com',\n                          'https:///',\n                          '//testserver/',\n-                         '/url%20with%20spaces/', # see ticket #12534\n-                         ):\n+                         '/url%20with%20spaces/'):  # see ticket #12534\n             safe_url = '%(url)s?%(next)s=%(good_url)s' % {\n                 'url': login_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'good_url': urllib.quote(good_url)\n+                'good_url': urllib.quote(good_url),\n             }\n             response = self.client.post(safe_url, {\n                     'username': 'testclient',\n                     'password': password,\n-                }\n-            )\n+            })\n             self.assertEqual(response.status_code, 302)\n             self.assertTrue(good_url in response['Location'],\n                             \"%s should be allowed\" % good_url)\n@@ -322,8 +322,8 @@ def test_standard_login_url(self):\n         login_required_url = self.get_login_required_url(login_url)\n         querystring = QueryDict('', mutable=True)\n         querystring['next'] = '/login_required/'\n-        self.assertEqual(login_required_url,\n-             'http://testserver%s?%s' % (login_url, querystring.urlencode('/')))\n+        self.assertEqual(login_required_url, 'http://testserver%s?%s' %\n+                         (login_url, querystring.urlencode('/')))\n \n     def test_remote_login_url(self):\n         login_url = 'http://remote.example.com/login'\n@@ -422,12 +422,11 @@ def test_security_check(self, password='password'):\n         for bad_url in ('http://example.com',\n                         'https://example.com',\n                         'ftp://exampel.com',\n-                        '//example.com'\n-                        ):\n+                        '//example.com'):\n             nasty_url = '%(url)s?%(next)s=%(bad_url)s' % {\n                 'url': logout_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'bad_url': urllib.quote(bad_url)\n+                'bad_url': urllib.quote(bad_url),\n             }\n             self.login()\n             response = self.client.get(nasty_url)\n@@ -443,12 +442,11 @@ def test_security_check(self, password='password'):\n                          'view/?param=//example.com',\n                          'https:///',\n                          '//testserver/',\n-                         '/url%20with%20spaces/', # see ticket #12534\n-                         ):\n+                         '/url%20with%20spaces/'):  # see ticket #12534\n             safe_url = '%(url)s?%(next)s=%(good_url)s' % {\n                 'url': logout_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'good_url': urllib.quote(good_url)\n+                'good_url': urllib.quote(good_url),\n             }\n             self.login()\n             response = self.client.get(safe_url)"
        }
    ],
    "stats": {
        "total": 206,
        "additions": 123,
        "deletions": 83
    }
}