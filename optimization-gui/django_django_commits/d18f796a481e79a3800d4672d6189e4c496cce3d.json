{
    "author": "uruz",
    "message": "Fixed #19704 -- Make use of new ungettext_lazy function at appropriate places",
    "sha": "d18f796a481e79a3800d4672d6189e4c496cce3d",
    "files": [
        {
            "sha": "bca638182c2bac89e98aaaad5cfc4f836ee016b7",
            "filename": "django/contrib/comments/admin.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/d18f796a481e79a3800d4672d6189e4c496cce3d/django%2Fcontrib%2Fcomments%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/d18f796a481e79a3800d4672d6189e4c496cce3d/django%2Fcontrib%2Fcomments%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fadmin.py?ref=d18f796a481e79a3800d4672d6189e4c496cce3d",
            "patch": "@@ -3,7 +3,7 @@\n from django.contrib import admin\n from django.contrib.auth import get_user_model\n from django.contrib.comments.models import Comment\n-from django.utils.translation import ugettext_lazy as _, ungettext\n+from django.utils.translation import ugettext_lazy as _, ungettext, ungettext_lazy\n from django.contrib.comments import get_model\n from django.contrib.comments.views.moderation import perform_flag, perform_approve, perform_delete\n \n@@ -52,17 +52,20 @@ def get_actions(self, request):\n \n     def flag_comments(self, request, queryset):\n         self._bulk_flag(request, queryset, perform_flag,\n-                        lambda n: ungettext('flagged', 'flagged', n))\n+                        ungettext_lazy('%d comment was successfully flagged',\n+                                       '%d comments were successfully flagged'))\n     flag_comments.short_description = _(\"Flag selected comments\")\n \n     def approve_comments(self, request, queryset):\n         self._bulk_flag(request, queryset, perform_approve,\n-                        lambda n: ungettext('approved', 'approved', n))\n+                        ungettext_lazy('%d comment was successfully approved',\n+                                       '%d comments were successfully approved'))\n     approve_comments.short_description = _(\"Approve selected comments\")\n \n     def remove_comments(self, request, queryset):\n         self._bulk_flag(request, queryset, perform_delete,\n-                        lambda n: ungettext('removed', 'removed', n))\n+                        ungettext_lazy('%d comment was successfully removed',\n+                                       '%d comments were successfully removed'))\n     remove_comments.short_description = _(\"Remove selected comments\")\n \n     def _bulk_flag(self, request, queryset, action, done_message):\n@@ -75,10 +78,7 @@ def _bulk_flag(self, request, queryset, action, done_message):\n             action(request, comment)\n             n_comments += 1\n \n-        msg = ungettext('1 comment was successfully %(action)s.',\n-                        '%(count)s comments were successfully %(action)s.',\n-                        n_comments)\n-        self.message_user(request, msg % {'count': n_comments, 'action': done_message(n_comments)})\n+        self.message_user(request, done_message % n_comments)\n \n # Only register the default admin if the model is the built-in comment model\n # (this won't be true if there's a custom comment app)."
        },
        {
            "sha": "d70ab2ffe15bc74f9ce628de95ee4cc5e4e27a87",
            "filename": "django/utils/timesince.py",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/d18f796a481e79a3800d4672d6189e4c496cce3d/django%2Futils%2Ftimesince.py",
            "raw_url": "https://github.com/django/django/raw/d18f796a481e79a3800d4672d6189e4c496cce3d/django%2Futils%2Ftimesince.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimesince.py?ref=d18f796a481e79a3800d4672d6189e4c496cce3d",
            "patch": "@@ -3,7 +3,7 @@\n import datetime\n \n from django.utils.timezone import is_aware, utc\n-from django.utils.translation import ungettext, ugettext\n+from django.utils.translation import ugettext, ungettext_lazy\n \n def timesince(d, now=None, reversed=False):\n     \"\"\"\n@@ -19,12 +19,12 @@ def timesince(d, now=None, reversed=False):\n     Adapted from http://blog.natbat.co.uk/archive/2003/Jun/14/time_since\n     \"\"\"\n     chunks = (\n-      (60 * 60 * 24 * 365, lambda n: ungettext('year', 'years', n)),\n-      (60 * 60 * 24 * 30, lambda n: ungettext('month', 'months', n)),\n-      (60 * 60 * 24 * 7, lambda n : ungettext('week', 'weeks', n)),\n-      (60 * 60 * 24, lambda n : ungettext('day', 'days', n)),\n-      (60 * 60, lambda n: ungettext('hour', 'hours', n)),\n-      (60, lambda n: ungettext('minute', 'minutes', n))\n+        (60 * 60 * 24 * 365, ungettext_lazy('%d year', '%d years')),\n+        (60 * 60 * 24 * 30, ungettext_lazy('%d month', '%d months')),\n+        (60 * 60 * 24 * 7, ungettext_lazy('%d week', '%d weeks')),\n+        (60 * 60 * 24, ungettext_lazy('%d day', '%d days')),\n+        (60 * 60, ungettext_lazy('%d hour', '%d hours')),\n+        (60, ungettext_lazy('%d minute', '%d minutes'))\n     )\n     # Convert datetime.date to datetime.datetime for comparison.\n     if not isinstance(d, datetime.datetime):\n@@ -40,19 +40,19 @@ def timesince(d, now=None, reversed=False):\n     since = delta.days * 24 * 60 * 60 + delta.seconds\n     if since <= 0:\n         # d is in the future compared to now, stop processing.\n-        return '0 ' + ugettext('minutes')\n+        return ugettext('0 minutes')\n     for i, (seconds, name) in enumerate(chunks):\n         count = since // seconds\n         if count != 0:\n             break\n-    s = ugettext('%(number)d %(type)s') % {'number': count, 'type': name(count)}\n+    result = name % count\n     if i + 1 < len(chunks):\n         # Now get the second item\n         seconds2, name2 = chunks[i + 1]\n         count2 = (since - (seconds * count)) // seconds2\n         if count2 != 0:\n-            s += ugettext(', %(number)d %(type)s') % {'number': count2, 'type': name2(count2)}\n-    return s\n+            result += ugettext(', ') + name2 % count2\n+    return result\n \n def timeuntil(d, now=None):\n     \"\"\""
        },
        {
            "sha": "0abeff9687307ea837b255000e612fe92116e3a3",
            "filename": "tests/regressiontests/comment_tests/tests/moderation_view_tests.py",
            "status": "modified",
            "additions": 27,
            "deletions": 1,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/d18f796a481e79a3800d4672d6189e4c496cce3d/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fmoderation_view_tests.py",
            "raw_url": "https://github.com/django/django/raw/d18f796a481e79a3800d4672d6189e4c496cce3d/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fmoderation_view_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fmoderation_view_tests.py?ref=d18f796a481e79a3800d4672d6189e4c496cce3d",
            "patch": "@@ -1,9 +1,10 @@\n-from __future__ import absolute_import\n+from __future__ import absolute_import, unicode_literals\n \n from django.contrib.auth.models import User, Permission\n from django.contrib.comments import signals\n from django.contrib.comments.models import Comment, CommentFlag\n from django.contrib.contenttypes.models import ContentType\n+from django.utils import translation\n \n from . import CommentTestCase\n \n@@ -281,3 +282,28 @@ def testActionsDisabledDelete(self):\n         response = self.client.get('/admin2/comments/comment/')\n         self.assertEqual(response.status_code, 200)\n         self.assertNotContains(response, '<option value=\"delete_selected\">')\n+\n+    def performActionAndCheckMessage(self, action, action_params, expected_message):\n+        response = self.client.post('/admin/comments/comment/',\n+                                    data={'_selected_action': action_params,\n+                                          'action': action,\n+                                          'index': 0},\n+                                    follow=True)\n+        self.assertContains(response, expected_message)\n+\n+    def testActionsMessageTranslations(self):\n+        c1, c2, c3, c4 = self.createSomeComments()\n+        one_comment = c1.pk\n+        many_comments = [c2.pk, c3.pk, c4.pk]\n+        makeModerator(\"normaluser\")\n+        self.client.login(username=\"normaluser\", password=\"normaluser\")\n+        with translation.override('en'):\n+            #Test approving\n+            self.performActionAndCheckMessage('approve_comments', one_comment, '1 comment was successfully approved')\n+            self.performActionAndCheckMessage('approve_comments', many_comments, '3 comments were successfully approved')\n+            #Test flagging\n+            self.performActionAndCheckMessage('flag_comments', one_comment, '1 comment was successfully flagged')\n+            self.performActionAndCheckMessage('flag_comments', many_comments, '3 comments were successfully flagged')\n+            #Test removing\n+            self.performActionAndCheckMessage('remove_comments', one_comment, '1 comment was successfully removed')\n+            self.performActionAndCheckMessage('remove_comments', many_comments, '3 comments were successfully removed')"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 46,
        "deletions": 20
    }
}