{
    "author": "jezdez",
    "message": "Fixed #11700 -- Stopped admin actions and list_editable fields to show up in popups. Thanks to Simon Meers for the initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15129 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "7a89d3d503cad96689fee3028a218ff5456f73f1",
    "files": [
        {
            "sha": "d1f02be843bea614c7194fd680adb8f1b8fc2a0d",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/7a89d3d503cad96689fee3028a218ff5456f73f1/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/7a89d3d503cad96689fee3028a218ff5456f73f1/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=7a89d3d503cad96689fee3028a218ff5456f73f1",
            "patch": "@@ -535,7 +535,8 @@ def get_actions(self, request):\n         \"\"\"\n         # If self.actions is explicitally set to None that means that we don't\n         # want *any* actions enabled on this page.\n-        if self.actions is None:\n+        from django.contrib.admin.views.main import IS_POPUP_VAR\n+        if self.actions is None or IS_POPUP_VAR in request.GET:\n             return []\n \n         actions = []\n@@ -1081,7 +1082,7 @@ def changelist_view(self, request, extra_context=None):\n         formset = cl.formset = None\n \n         # Handle POSTed bulk-edit data.\n-        if (request.method == \"POST\" and self.list_editable and\n+        if (request.method == \"POST\" and cl.list_editable and\n                 '_save' in request.POST and not action_failed):\n             FormSet = self.get_changelist_formset(request)\n             formset = cl.formset = FormSet(request.POST, request.FILES, queryset=cl.result_list)\n@@ -1111,7 +1112,7 @@ def changelist_view(self, request, extra_context=None):\n                 return HttpResponseRedirect(request.get_full_path())\n \n         # Handle GET -- construct a formset for display.\n-        elif self.list_editable:\n+        elif cl.list_editable:\n             FormSet = self.get_changelist_formset(request)\n             formset = cl.formset = FormSet(queryset=cl.result_list)\n "
        },
        {
            "sha": "886ccd9be755343b47443faedeb46e77236b5b36",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/7a89d3d503cad96689fee3028a218ff5456f73f1/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/7a89d3d503cad96689fee3028a218ff5456f73f1/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=7a89d3d503cad96689fee3028a218ff5456f73f1",
            "patch": "@@ -39,7 +39,6 @@ def __init__(self, request, model, list_display, list_display_links, list_filter\n         self.search_fields = search_fields\n         self.list_select_related = list_select_related\n         self.list_per_page = list_per_page\n-        self.list_editable = list_editable\n         self.model_admin = model_admin\n \n         # Get search parameters from the query string.\n@@ -58,6 +57,10 @@ def __init__(self, request, model, list_display, list_display_links, list_filter\n         if ERROR_FLAG in self.params:\n             del self.params[ERROR_FLAG]\n \n+        if self.is_popup:\n+            self.list_editable = ()\n+        else:\n+            self.list_editable = list_editable\n         self.order_field, self.order_type = self.get_ordering()\n         self.query = request.GET.get(SEARCH_VAR, '')\n         self.query_set = self.get_query_set()"
        },
        {
            "sha": "eb35b4186094cbc27db10ec8195589dc58255579",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/7a89d3d503cad96689fee3028a218ff5456f73f1/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7a89d3d503cad96689fee3028a218ff5456f73f1/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=7a89d3d503cad96689fee3028a218ff5456f73f1",
            "patch": "@@ -16,6 +16,7 @@\n from django.contrib.admin.sites import LOGIN_FORM_KEY\n from django.contrib.admin.util import quote\n from django.contrib.admin.helpers import ACTION_CHECKBOX_NAME\n+from django.contrib.admin.views.main import IS_POPUP_VAR\n from django.forms.util import ErrorList\n import django.template.context\n from django.test import TestCase\n@@ -1450,7 +1451,14 @@ def test_list_editable_action_choices(self):\n         self.assertEqual(Person.objects.get(name=\"John Mauchly\").alive, False)\n         self.assertEqual(Person.objects.get(name=\"Grace Hopper\").gender, 2)\n \n-\n+    def test_list_editable_popup(self):\n+        \"\"\"\n+        Fields should not be list-editable in popups.\n+        \"\"\"\n+        response = self.client.get('/test_admin/admin/admin_views/person/')\n+        self.assertNotEqual(response.context['cl'].list_editable, ())\n+        response = self.client.get('/test_admin/admin/admin_views/person/?%s' % IS_POPUP_VAR)\n+        self.assertEqual(response.context['cl'].list_editable, ())\n \n \n class AdminSearchTest(TestCase):\n@@ -1701,6 +1709,14 @@ def test_selection_counter(self):\n         response = self.client.get('/test_admin/admin/admin_views/subscriber/')\n         self.assertContains(response, '0 of 2 selected')\n \n+    def test_popup_actions(self):\n+        \"\"\" Actions should not be shown in popups. \"\"\"\n+        response = self.client.get('/test_admin/admin/admin_views/subscriber/')\n+        self.assertNotEquals(response.context[\"action_form\"], None)\n+        response = self.client.get(\n+            '/test_admin/admin/admin_views/subscriber/?%s' % IS_POPUP_VAR)\n+        self.assertEquals(response.context[\"action_form\"], None)\n+\n \n class TestCustomChangeList(TestCase):\n     fixtures = ['admin-views-users.xml']"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 25,
        "deletions": 5
    }
}