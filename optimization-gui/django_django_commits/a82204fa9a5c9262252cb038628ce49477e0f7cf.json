{
    "author": "ramiro",
    "message": "Moved validation of project names to an earlier spot so no directory with invalid name is created.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17288 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a82204fa9a5c9262252cb038628ce49477e0f7cf",
    "files": [
        {
            "sha": "cfef06b81341d39142c4b52b424ed7c4ef48871e",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/a82204fa9a5c9262252cb038628ce49477e0f7cf/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/a82204fa9a5c9262252cb038628ce49477e0f7cf/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=a82204fa9a5c9262252cb038628ce49477e0f7cf",
            "patch": "@@ -60,6 +60,17 @@ def handle(self, app_or_project, name, target=None, **options):\n         self.paths_to_remove = []\n         self.verbosity = int(options.get('verbosity'))\n \n+        # If it's not a valid directory name.\n+        if not re.search(r'^[_a-zA-Z]\\w*$', name):\n+            # Provide a smart error message, depending on the error.\n+            if not re.search(r'^[_a-zA-Z]', name):\n+                message = ('make sure the name begins '\n+                           'with a letter or underscore')\n+            else:\n+                message = 'use only numbers, letters and underscores'\n+            raise CommandError(\"%r is not a valid %s name. Please %s.\" %\n+                               (name, app_or_project, message))\n+\n         # if some directory is given, make sure it's nicely expanded\n         if target is None:\n             target = os.getcwd()\n@@ -88,17 +99,6 @@ def handle(self, app_or_project, name, target=None, **options):\n             base_directory: top_dir,\n         }))\n \n-        # If it's not a valid directory name.\n-        if not re.search(r'^[_a-zA-Z]\\w*$', name):\n-            # Provide a smart error message, depending on the error.\n-            if not re.search(r'^[_a-zA-Z]', name):\n-                message = ('make sure the name begins '\n-                           'with a letter or underscore')\n-            else:\n-                message = 'use only numbers, letters and underscores'\n-            raise CommandError(\"%r is not a valid %s name. Please %s.\" %\n-                               (name, app_or_project, message))\n-\n         # Setup a stub settings environment for template rendering\n         from django.conf import settings\n         if not settings.configured:"
        },
        {
            "sha": "8d820f6dca19cf1b0e6d5fb35541e96bcca3cccc",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/a82204fa9a5c9262252cb038628ce49477e0f7cf/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/a82204fa9a5c9262252cb038628ce49477e0f7cf/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=a82204fa9a5c9262252cb038628ce49477e0f7cf",
            "patch": "@@ -1386,6 +1386,20 @@ def test_simple_project(self):\n         self.assertNoOutput(out)\n         self.assertOutput(err, \"File exists\")\n \n+    def test_invalid_project_name(self):\n+        def cleanup(p):\n+            if os.path.exists(p):\n+                shutil.rmtree(p)\n+\n+        \"Make sure the startproject management command validates a project name\"\n+        args = ['startproject', '7testproject']\n+        testproject_dir = os.path.join(test_dir, '7testproject')\n+\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(cleanup, testproject_dir)\n+        self.assertOutput(err, \"Error: '7testproject' is not a valid project name. Please make sure the name begins with a letter or underscore.\")\n+        self.assertFalse(os.path.exists(testproject_dir))\n+\n     def test_simple_project_different_directory(self):\n         \"Make sure the startproject management command creates a project in a specific directory\"\n         args = ['startproject', 'testproject', 'othertestproject']"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 25,
        "deletions": 11
    }
}