{
    "author": "mrj0",
    "message": "model_split: Fixed #19236 - fixed error for abstract models with a split method",
    "sha": "fcd3d4c68f06748c754c08eada526b678741e8c5",
    "files": [
        {
            "sha": "5d82c5cbb13b96501a6f52e7771d087cb281b617",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/fcd3d4c68f06748c754c08eada526b678741e8c5/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/fcd3d4c68f06748c754c08eada526b678741e8c5/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=fcd3d4c68f06748c754c08eada526b678741e8c5",
            "patch": "@@ -54,14 +54,16 @@ class MyModel(Model):\n \n     else:\n         # Look for an \"app.Model\" relation\n-        try:\n-            app_label, model_name = relation.split(\".\")\n-        except ValueError:\n-            # If we can't split, assume a model in current app\n-            app_label = cls._meta.app_label\n-            model_name = relation\n-        except AttributeError:\n-            # If it doesn't have a split it's actually a model class\n+\n+        if isinstance(relation, basestring):\n+            try:\n+                app_label, model_name = relation.split(\".\")\n+            except ValueError:\n+                # If we can't split, assume a model in current app\n+                app_label = cls._meta.app_label\n+                model_name = relation\n+        else:\n+            # it's actually a model class\n             app_label = relation._meta.app_label\n             model_name = relation._meta.object_name\n "
        },
        {
            "sha": "1a4a6df35461289f7ac4df3ceff125c3eb3a3e52",
            "filename": "tests/regressiontests/m2m_regress/models.py",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/fcd3d4c68f06748c754c08eada526b678741e8c5/tests%2Fregressiontests%2Fm2m_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/fcd3d4c68f06748c754c08eada526b678741e8c5/tests%2Fregressiontests%2Fm2m_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fm2m_regress%2Fmodels.py?ref=fcd3d4c68f06748c754c08eada526b678741e8c5",
            "patch": "@@ -61,3 +61,20 @@ class Worksheet(models.Model):\n class User(models.Model):\n     name = models.CharField(max_length=30)\n     friends = models.ManyToManyField(auth.User)\n+\n+\n+class BadModelWithSplit(models.Model):\n+    name = models.CharField(max_length=1)\n+\n+    def split(self):\n+        raise RuntimeError('split should not be called')\n+\n+    class Meta:\n+        abstract = True\n+\n+\n+class RegressionModelSplit(BadModelWithSplit):\n+    \"\"\"\n+    Model with a split method should not cause an error in add_lazy_relation\n+    \"\"\"\n+    others = models.ManyToManyField('self')"
        },
        {
            "sha": "c39d883de4359f19345497b4ecc998c2c0880ea5",
            "filename": "tests/regressiontests/m2m_regress/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/fcd3d4c68f06748c754c08eada526b678741e8c5/tests%2Fregressiontests%2Fm2m_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fcd3d4c68f06748c754c08eada526b678741e8c5/tests%2Fregressiontests%2Fm2m_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fm2m_regress%2Ftests.py?ref=fcd3d4c68f06748c754c08eada526b678741e8c5",
            "patch": "@@ -5,7 +5,7 @@\n from django.utils import six\n \n from .models import (SelfRefer, Tag, TagCollection, Entry, SelfReferChild,\n-    SelfReferChildSibling, Worksheet)\n+    SelfReferChildSibling, Worksheet, RegressionModelSplit)\n \n \n class M2MRegressionTests(TestCase):\n@@ -90,3 +90,9 @@ def test_manager_class_caching(self):\n         # Get same manager for different instances\n         self.assertTrue(e1.topics.__class__ is e2.topics.__class__)\n         self.assertTrue(t1.entry_set.__class__ is t2.entry_set.__class__)\n+\n+    def test_m2m_abstract_split(self):\n+        # Regression for #19236 - an abstract class with a 'split' method\n+        # causes a TypeError in add_lazy_relation\n+        m1 = RegressionModelSplit(name='1')\n+        m1.save()"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 34,
        "deletions": 9
    }
}