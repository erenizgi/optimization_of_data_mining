{
    "author": "aaugustin",
    "message": "Made transaction.managed a no-op and deprecated it.\n\nenter_transaction_management() was nearly always followed by managed().\n\nIn three places it wasn't, but they will all be refactored eventually.\nThe \"forced\" keyword argument avoids introducing behavior changes until\nthen.\n\nThis is mostly backwards-compatible, except, of course, for managed\nitself. There's a minor difference in _enter_transaction_management:\nthe top self.transaction_state now contains the new 'managed' state\nrather than the previous one. Django doesn't access\nself.transaction_state in _enter_transaction_management.",
    "sha": "7aacde84f2b499d9c35741cbfccb621af6b48903",
    "files": [
        {
            "sha": "77b9a44a438c1c9f8baab92459ef22cb6d261a8a",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -75,7 +75,6 @@ def handle(self, *fixture_labels, **options):\n         if commit:\n             transaction.commit_unless_managed(using=self.using)\n             transaction.enter_transaction_management(using=self.using)\n-            transaction.managed(True, using=self.using)\n \n         class SingleZipReader(zipfile.ZipFile):\n             def __init__(self, *args, **kwargs):"
        },
        {
            "sha": "f11ee35260d4508de9f35d96d531316c4de8212d",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 22,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -234,7 +234,7 @@ def _leave_transaction_management(self, managed):\n \n     ##### Generic transaction management methods #####\n \n-    def enter_transaction_management(self, managed=True):\n+    def enter_transaction_management(self, managed=True, forced=False):\n         \"\"\"\n         Enters transaction management for a running thread. It must be balanced with\n         the appropriate leave_transaction_management call, since the actual state is\n@@ -243,12 +243,14 @@ def enter_transaction_management(self, managed=True):\n         The state and dirty flag are carried over from the surrounding block or\n         from the settings, if there is no surrounding block (dirty is always false\n         when no current block is running).\n+\n+        If you switch off transaction management and there is a pending\n+        commit/rollback, the data will be commited, unless \"forced\" is True.\n         \"\"\"\n-        if self.transaction_state:\n-            self.transaction_state.append(self.transaction_state[-1])\n-        else:\n-            self.transaction_state.append(settings.TRANSACTIONS_MANAGED)\n+        self.transaction_state.append(managed)\n         self._enter_transaction_management(managed)\n+        if not managed and self.is_dirty() and not forced:\n+            self.commit()\n \n     def leave_transaction_management(self):\n         \"\"\"\n@@ -314,22 +316,6 @@ def is_managed(self):\n             return self.transaction_state[-1]\n         return settings.TRANSACTIONS_MANAGED\n \n-    def managed(self, flag=True):\n-        \"\"\"\n-        Puts the transaction manager into a manual state: managed transactions have\n-        to be committed explicitly by the user. If you switch off transaction\n-        management and there is a pending commit/rollback, the data will be\n-        commited.\n-        \"\"\"\n-        top = self.transaction_state\n-        if top:\n-            top[-1] = flag\n-            if not flag and self.is_dirty():\n-                self.commit()\n-        else:\n-            raise TransactionManagementError(\"This code isn't under transaction \"\n-                \"management\")\n-\n     def commit_unless_managed(self):\n         \"\"\"\n         Commits changes if the system is not in managed transaction mode.\n@@ -574,7 +560,6 @@ def supports_transactions(self):\n             # otherwise autocommit will cause the confimation to\n             # fail.\n             self.connection.enter_transaction_management()\n-            self.connection.managed(True)\n             cursor = self.connection.cursor()\n             cursor.execute('CREATE TABLE ROLLBACK_TEST (X INT)')\n             self.connection.commit()"
        },
        {
            "sha": "93ef0006cb7cb9e97b83c7106b06262ba526836a",
            "filename": "django/db/models/deletion.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Fmodels%2Fdeletion.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Fmodels%2Fdeletion.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fdeletion.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -54,7 +54,7 @@ def force_managed(func):\n     @wraps(func)\n     def decorated(self, *args, **kwargs):\n         if not transaction.is_managed(using=self.using):\n-            transaction.enter_transaction_management(using=self.using)\n+            transaction.enter_transaction_management(using=self.using, forced=True)\n             forced_managed = True\n         else:\n             forced_managed = False"
        },
        {
            "sha": "b41007ee4f9e667d2f1d6906f735ac8e8c977f77",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -443,7 +443,7 @@ def bulk_create(self, objs, batch_size=None):\n         connection = connections[self.db]\n         fields = self.model._meta.local_fields\n         if not transaction.is_managed(using=self.db):\n-            transaction.enter_transaction_management(using=self.db)\n+            transaction.enter_transaction_management(using=self.db, forced=True)\n             forced_managed = True\n         else:\n             forced_managed = False\n@@ -582,7 +582,7 @@ def update(self, **kwargs):\n         query = self.query.clone(sql.UpdateQuery)\n         query.add_update_values(kwargs)\n         if not transaction.is_managed(using=self.db):\n-            transaction.enter_transaction_management(using=self.db)\n+            transaction.enter_transaction_management(using=self.db, forced=True)\n             forced_managed = True\n         else:\n             forced_managed = False"
        },
        {
            "sha": "09ce2abbd201b2233beeba3e4b2532e960c08194",
            "filename": "django/db/transaction.py",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Ftransaction.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fdb%2Ftransaction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Ftransaction.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -12,6 +12,8 @@\n or implicit commits or rollbacks.\n \"\"\"\n \n+import warnings\n+\n from functools import wraps\n \n from django.db import connections, DEFAULT_DB_ALIAS\n@@ -49,7 +51,7 @@ def abort(using=None):\n     \"\"\"\n     get_connection(using).abort()\n \n-def enter_transaction_management(managed=True, using=None):\n+def enter_transaction_management(managed=True, using=None, forced=False):\n     \"\"\"\n     Enters transaction management for a running thread. It must be balanced with\n     the appropriate leave_transaction_management call, since the actual state is\n@@ -59,7 +61,7 @@ def enter_transaction_management(managed=True, using=None):\n     from the settings, if there is no surrounding block (dirty is always false\n     when no current block is running).\n     \"\"\"\n-    get_connection(using).enter_transaction_management(managed)\n+    get_connection(using).enter_transaction_management(managed, forced)\n \n def leave_transaction_management(using=None):\n     \"\"\"\n@@ -105,13 +107,8 @@ def is_managed(using=None):\n     return get_connection(using).is_managed()\n \n def managed(flag=True, using=None):\n-    \"\"\"\n-    Puts the transaction manager into a manual state: managed transactions have\n-    to be committed explicitly by the user. If you switch off transaction\n-    management and there is a pending commit/rollback, the data will be\n-    commited.\n-    \"\"\"\n-    get_connection(using).managed(flag)\n+    warnings.warn(\"'managed' no longer serves a purpose.\",\n+        PendingDeprecationWarning, stacklevel=2)\n \n def commit_unless_managed(using=None):\n     \"\"\"\n@@ -224,7 +221,6 @@ def autocommit(using=None):\n     \"\"\"\n     def entering(using):\n         enter_transaction_management(managed=False, using=using)\n-        managed(False, using=using)\n \n     def exiting(exc_value, using):\n         leave_transaction_management(using=using)\n@@ -240,7 +236,6 @@ def commit_on_success(using=None):\n     \"\"\"\n     def entering(using):\n         enter_transaction_management(using=using)\n-        managed(True, using=using)\n \n     def exiting(exc_value, using):\n         try:\n@@ -268,7 +263,6 @@ def commit_manually(using=None):\n     \"\"\"\n     def entering(using):\n         enter_transaction_management(using=using)\n-        managed(True, using=using)\n \n     def exiting(exc_value, using):\n         leave_transaction_management(using=using)"
        },
        {
            "sha": "b5a07a02b7b1eefe95d90e669c7742b1f448afa5",
            "filename": "django/middleware/transaction.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fmiddleware%2Ftransaction.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Fmiddleware%2Ftransaction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Ftransaction.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -10,7 +10,6 @@ class TransactionMiddleware(object):\n     def process_request(self, request):\n         \"\"\"Enters transaction management\"\"\"\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n \n     def process_exception(self, request, exception):\n         \"\"\"Rolls back the database and leaves transaction management\"\"\""
        },
        {
            "sha": "7f6b1a49ba77f5ab27403afc7518cb6721cbac05",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -67,7 +67,6 @@ def to_list(value):\n real_rollback = transaction.rollback\n real_enter_transaction_management = transaction.enter_transaction_management\n real_leave_transaction_management = transaction.leave_transaction_management\n-real_managed = transaction.managed\n real_abort = transaction.abort\n \n def nop(*args, **kwargs):\n@@ -78,15 +77,13 @@ def disable_transaction_methods():\n     transaction.rollback = nop\n     transaction.enter_transaction_management = nop\n     transaction.leave_transaction_management = nop\n-    transaction.managed = nop\n     transaction.abort = nop\n \n def restore_transaction_methods():\n     transaction.commit = real_commit\n     transaction.rollback = real_rollback\n     transaction.enter_transaction_management = real_enter_transaction_management\n     transaction.leave_transaction_management = real_leave_transaction_management\n-    transaction.managed = real_managed\n     transaction.abort = real_abort\n \n \n@@ -833,7 +830,6 @@ def _fixture_setup(self):\n \n         for db_name in self._databases_names():\n             transaction.enter_transaction_management(using=db_name)\n-            transaction.managed(True, using=db_name)\n         disable_transaction_methods()\n \n         from django.contrib.sites.models import Site"
        },
        {
            "sha": "296f908a5ba3860ae7c9f85339c348005f4a57ed",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -339,8 +339,6 @@ these changes.\n \n * ``Model._meta.module_name`` was renamed to ``model_name``.\n \n-* The private API ``django.db.close_connection`` will be removed.\n-\n * Remove the backward compatible shims introduced to rename ``get_query_set``\n   and similar queryset methods. This affects the following classes:\n   ``BaseModelAdmin``, ``ChangeList``, ``BaseCommentNode``,\n@@ -350,6 +348,10 @@ these changes.\n * Remove the backward compatible shims introduced to rename the attributes\n   ``ChangeList.root_query_set`` and ``ChangeList.query_set``.\n \n+* The private API ``django.db.close_connection`` will be removed.\n+\n+* The private API ``django.transaction.managed`` will be removed.\n+\n 2.0\n ---\n "
        },
        {
            "sha": "e88c95e22963dadd66e9caa267679539151f0648",
            "filename": "tests/delete_regress/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fdelete_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fdelete_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fdelete_regress%2Ftests.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -22,9 +22,7 @@ def setUp(self):\n         self.conn2 = new_connections[DEFAULT_DB_ALIAS]\n         # Put both DB connections into managed transaction mode\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         self.conn2.enter_transaction_management()\n-        self.conn2.managed(True)\n \n     def tearDown(self):\n         # Close down the second connection.\n@@ -335,7 +333,7 @@ def test_ticket_19102_select_related(self):\n             ).select_related('orgunit').delete()\n         self.assertFalse(Login.objects.filter(pk=self.l1.pk).exists())\n         self.assertTrue(Login.objects.filter(pk=self.l2.pk).exists())\n-    \n+\n     @skipUnlessDBFeature(\"update_can_self_select\")\n     def test_ticket_19102_defer(self):\n         with self.assertNumQueries(1):"
        },
        {
            "sha": "122371c02cae3131d9967a006a92a8da85f5626c",
            "filename": "tests/middleware/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fmiddleware%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fmiddleware%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmiddleware%2Ftests.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -692,16 +692,14 @@ def test_request(self):\n \n     def test_managed_response(self):\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         Band.objects.create(name='The Beatles')\n         self.assertTrue(transaction.is_dirty())\n         TransactionMiddleware().process_response(self.request, self.response)\n         self.assertFalse(transaction.is_dirty())\n         self.assertEqual(Band.objects.count(), 1)\n \n     def test_unmanaged_response(self):\n-        transaction.enter_transaction_management()\n-        transaction.managed(False)\n+        transaction.enter_transaction_management(False)\n         self.assertEqual(Band.objects.count(), 0)\n         TransactionMiddleware().process_response(self.request, self.response)\n         self.assertFalse(transaction.is_managed())\n@@ -711,7 +709,6 @@ def test_unmanaged_response(self):\n \n     def test_exception(self):\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         Band.objects.create(name='The Beatles')\n         self.assertTrue(transaction.is_dirty())\n         TransactionMiddleware().process_exception(self.request, None)\n@@ -726,7 +723,6 @@ def raise_exception():\n                 raise IntegrityError()\n             connections[DEFAULT_DB_ALIAS].commit = raise_exception\n             transaction.enter_transaction_management()\n-            transaction.managed(True)\n             Band.objects.create(name='The Beatles')\n             self.assertTrue(transaction.is_dirty())\n             with self.assertRaises(IntegrityError):"
        },
        {
            "sha": "2803d7995b6710017e0e23e6205079eeb2c79579",
            "filename": "tests/requests/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Frequests%2Ftests.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -576,7 +576,6 @@ def test_request_finished_db_state(self):\n         # Make sure there is an open connection\n         connection.cursor()\n         connection.enter_transaction_management()\n-        connection.managed(True)\n         signals.request_finished.send(sender=response._handler_class)\n         self.assertEqual(len(connection.transaction_state), 0)\n \n@@ -585,7 +584,6 @@ def test_request_finished_failed_connection(self):\n         connection.settings_dict['CONN_MAX_AGE'] = 0\n \n         connection.enter_transaction_management()\n-        connection.managed(True)\n         connection.set_dirty()\n         # Test that the rollback doesn't succeed (for example network failure\n         # could cause this)."
        },
        {
            "sha": "c2fa22705aa8dec834fc1dce16a6ed791d8893e4",
            "filename": "tests/select_for_update/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fselect_for_update%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fselect_for_update%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fselect_for_update%2Ftests.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -25,7 +25,6 @@ class SelectForUpdateTests(TransactionTestCase):\n \n     def setUp(self):\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         self.person = Person.objects.create(name='Reinhardt')\n \n         # We have to commit here so that code in run_select_for_update can\n@@ -37,7 +36,6 @@ def setUp(self):\n         new_connections = ConnectionHandler(settings.DATABASES)\n         self.new_connection = new_connections[DEFAULT_DB_ALIAS]\n         self.new_connection.enter_transaction_management()\n-        self.new_connection.managed(True)\n \n         # We need to set settings.DEBUG to True so we can capture\n         # the output SQL to examine.\n@@ -162,7 +160,6 @@ def run_select_for_update(self, status, nowait=False):\n             # We need to enter transaction management again, as this is done on\n             # per-thread basis\n             transaction.enter_transaction_management()\n-            transaction.managed(True)\n             people = list(\n                 Person.objects.all().select_for_update(nowait=nowait)\n             )"
        },
        {
            "sha": "a96a1af748b4be70d73ac810a32f25c49ff971e8",
            "filename": "tests/serializers/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fserializers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Fserializers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fserializers%2Ftests.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -268,7 +268,6 @@ def test_forward_refs(self):\n         # within a transaction in order to test forward reference\n         # handling.\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         objs = serializers.deserialize(self.serializer_name, self.fwd_ref_str)\n         with connection.constraint_checks_disabled():\n             for obj in objs:"
        },
        {
            "sha": "0af760533943985eb71fabea1993b7b6ee981937",
            "filename": "tests/transactions_regress/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Ftransactions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7aacde84f2b499d9c35741cbfccb621af6b48903/tests%2Ftransactions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Ftransactions_regress%2Ftests.py?ref=7aacde84f2b499d9c35741cbfccb621af6b48903",
            "patch": "@@ -223,7 +223,6 @@ def test_commit_unless_managed(self):\n     def test_commit_unless_managed_in_managed(self):\n         cursor = connection.cursor()\n         connection.enter_transaction_management()\n-        transaction.managed(True)\n         cursor.execute(\"INSERT into transactions_regress_mod (fld) values (2)\")\n         connection.commit_unless_managed()\n         self.assertTrue(connection.is_dirty())\n@@ -280,15 +279,13 @@ def test_initial_autocommit_state(self):\n \n     def test_transaction_management(self):\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         self.assertEqual(connection.isolation_level, self._serializable)\n \n         transaction.leave_transaction_management()\n         self.assertEqual(connection.isolation_level, self._autocommit)\n \n     def test_transaction_stacking(self):\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         self.assertEqual(connection.isolation_level, self._serializable)\n \n         transaction.enter_transaction_management()\n@@ -302,13 +299,11 @@ def test_transaction_stacking(self):\n \n     def test_enter_autocommit(self):\n         transaction.enter_transaction_management()\n-        transaction.managed(True)\n         self.assertEqual(connection.isolation_level, self._serializable)\n         list(Mod.objects.all())\n         self.assertTrue(transaction.is_dirty())\n         # Enter autocommit mode again.\n         transaction.enter_transaction_management(False)\n-        transaction.managed(False)\n         self.assertFalse(transaction.is_dirty())\n         self.assertEqual(\n             connection.connection.get_transaction_status(),"
        }
    ],
    "stats": {
        "total": 86,
        "additions": 22,
        "deletions": 64
    }
}