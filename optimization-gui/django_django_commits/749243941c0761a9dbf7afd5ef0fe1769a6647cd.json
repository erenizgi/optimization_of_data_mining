{
    "author": "claudep",
    "message": "Fixed #18041 -- Removed support for Markdown versions < 2.1, following the 1.5 deprecation timeline. Thanks Ramiro Morales for the review.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17909 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "749243941c0761a9dbf7afd5ef0fe1769a6647cd",
    "files": [
        {
            "sha": "84251cf30aff8e9bf14517d0e025ba1932fa0a29",
            "filename": "django/contrib/markup/templatetags/markup.py",
            "status": "modified",
            "additions": 12,
            "deletions": 28,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/749243941c0761a9dbf7afd5ef0fe1769a6647cd/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py",
            "raw_url": "https://github.com/django/django/raw/749243941c0761a9dbf7afd5ef0fe1769a6647cd/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py?ref=749243941c0761a9dbf7afd5ef0fe1769a6647cd",
            "patch": "@@ -11,8 +11,6 @@\n     * reStructuredText, which requires docutils from http://docutils.sf.net/\n \"\"\"\n \n-import warnings\n-\n from django import template\n from django.conf import settings\n from django.utils.encoding import smart_str, force_unicode\n@@ -56,35 +54,21 @@ def markdown(value, arg=''):\n             raise template.TemplateSyntaxError(\"Error in 'markdown' filter: The Python markdown library isn't installed.\")\n         return force_unicode(value)\n     else:\n-        # markdown.version was first added in 1.6b. The only version of markdown\n-        # to fully support extensions before 1.6b was the shortlived 1.6a.\n-        if hasattr(markdown, 'version'):\n+        markdown_vers = getattr(markdown, \"version_info\", 0)\n+        if markdown_vers < (2, 1):\n+            if settings.DEBUG:\n+                raise template.TemplateSyntaxError(\n+                    \"Error in 'markdown' filter: Django does not support versions of the Python markdown library < 2.1.\")\n+            return force_unicode(value)\n+        else:\n             extensions = [e for e in arg.split(\",\") if e]\n-            if len(extensions) > 0 and extensions[0] == \"safe\":\n+            if extensions and extensions[0] == \"safe\":\n                 extensions = extensions[1:]\n-                safe_mode = True\n+                return mark_safe(markdown.markdown(\n+                    force_unicode(value), extensions, safe_mode=True, enable_attributes=False))\n             else:\n-                safe_mode = False\n-            python_markdown_deprecation = \"The use of Python-Markdown \"\n-            \"< 2.1 in Django is deprecated; please update to the current version\"\n-            # Unicode support only in markdown v1.7 or above. Version_info\n-            # exist only in markdown v1.6.2rc-2 or above.\n-            markdown_vers = getattr(markdown, \"version_info\", None)\n-            if markdown_vers < (1,7):\n-                warnings.warn(python_markdown_deprecation, DeprecationWarning)\n-                return mark_safe(force_unicode(markdown.markdown(smart_str(value), extensions, safe_mode=safe_mode)))\n-            else:\n-                if markdown_vers >= (2,1):\n-                    if safe_mode:\n-                        return mark_safe(markdown.markdown(force_unicode(value), extensions, safe_mode=safe_mode, enable_attributes=False))\n-                    else:\n-                        return mark_safe(markdown.markdown(force_unicode(value), extensions, safe_mode=safe_mode))\n-                else:\n-                    warnings.warn(python_markdown_deprecation, DeprecationWarning)\n-                    return mark_safe(markdown.markdown(force_unicode(value), extensions, safe_mode=safe_mode))\n-        else:\n-            warnings.warn(python_markdown_deprecation, DeprecationWarning)\n-            return mark_safe(force_unicode(markdown.markdown(smart_str(value))))\n+                return mark_safe(markdown.markdown(\n+                    force_unicode(value), extensions, safe_mode=False))\n \n @register.filter(is_safe=True)\n def restructuredtext(value):"
        },
        {
            "sha": "d3e4e1db1db05291a403230abe7a8cb72187e845",
            "filename": "django/contrib/markup/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/749243941c0761a9dbf7afd5ef0fe1769a6647cd/django%2Fcontrib%2Fmarkup%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/749243941c0761a9dbf7afd5ef0fe1769a6647cd/django%2Fcontrib%2Fmarkup%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmarkup%2Ftests.py?ref=749243941c0761a9dbf7afd5ef0fe1769a6647cd",
            "patch": "@@ -37,21 +37,21 @@ class Templates(unittest.TestCase):\n \n .. _link: http://www.example.com/\"\"\"\n \n-    @unittest.skipUnless(textile, 'texttile not installed')\n+    @unittest.skipUnless(textile, 'textile not installed')\n     def test_textile(self):\n         t = Template(\"{% load markup %}{{ textile_content|textile }}\")\n         rendered = t.render(Context({'textile_content':self.textile_content})).strip()\n         self.assertEqual(rendered.replace('\\t', ''), \"\"\"<p>Paragraph 1</p>\n \n <p>Paragraph 2 with &#8220;quotes&#8221; and <code>code</code></p>\"\"\")\n \n-    @unittest.skipIf(textile, 'texttile is installed')\n+    @unittest.skipIf(textile, 'textile is installed')\n     def test_no_textile(self):\n         t = Template(\"{% load markup %}{{ textile_content|textile }}\")\n         rendered = t.render(Context({'textile_content':self.textile_content})).strip()\n         self.assertEqual(rendered, escape(self.textile_content))\n \n-    @unittest.skipUnless(markdown, 'markdown not installed')\n+    @unittest.skipUnless(markdown and markdown_version >= (2,1), 'markdown >= 2.1 not installed')\n     def test_markdown(self):\n         t = Template(\"{% load markup %}{{ markdown_content|markdown }}\")\n         rendered = t.render(Context({'markdown_content':self.markdown_content})).strip()"
        },
        {
            "sha": "4ee2f941281997e25b68ba7ae40f3e94ed2002e2",
            "filename": "docs/ref/contrib/markup.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/749243941c0761a9dbf7afd5ef0fe1769a6647cd/docs%2Fref%2Fcontrib%2Fmarkup.txt",
            "raw_url": "https://github.com/django/django/raw/749243941c0761a9dbf7afd5ef0fe1769a6647cd/docs%2Fref%2Fcontrib%2Fmarkup.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fmarkup.txt?ref=749243941c0761a9dbf7afd5ef0fe1769a6647cd",
            "patch": "@@ -9,7 +9,7 @@ Django provides template filters that implement the following markup\n languages:\n \n * ``textile`` -- implements `Textile`_ -- requires `PyTextile`_\n-* ``markdown`` -- implements `Markdown`_ -- requires `Python-markdown`_\n+* ``markdown`` -- implements `Markdown`_ -- requires `Python-markdown`_ (>=2.1)\n * ``restructuredtext`` -- implements `reST (reStructured Text)`_\n   -- requires `doc-utils`_\n \n@@ -53,13 +53,13 @@ Markdown\n \n The Python Markdown library supports options named \"safe_mode\" and\n \"enable_attributes\". Both relate to the security of the output. To enable both\n-options in tandem, the markdown filter supports the \"safe\" argument.\n+options in tandem, the markdown filter supports the \"safe\" argument::\n \n     {{ markdown_content_var|markdown:\"safe\" }}\n \n .. warning::\n \n     Versions of the Python-Markdown library prior to 2.1 do not support the\n-    optional disabling of attributes and by default they will be included in\n-    any output from the markdown filter - a warning is issued if this is the\n-    case.\n+    optional disabling of attributes. This is a security flaw. Therefore,\n+    ``django.contrib.markup`` has dropped support for versions of\n+    Python-Markdown < 2.1 in Django 1.5."
        }
    ],
    "stats": {
        "total": 56,
        "additions": 20,
        "deletions": 36
    }
}