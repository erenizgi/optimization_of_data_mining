{
    "author": "claudep",
    "message": "[py3] Fixed admin_views tests\n\nAlso changed several occurrences of 'request' to 'response'.",
    "sha": "c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
    "files": [
        {
            "sha": "463e0792f0f2d3436a00c3f960139b633a93fbb9",
            "filename": "django/contrib/admin/templatetags/log.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Flog.py?ref=c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
            "patch": "@@ -17,7 +17,7 @@ def render(self, context):\n             user_id = self.user\n             if not user_id.isdigit():\n                 user_id = context[self.user].id\n-            context[self.varname] = LogEntry.objects.filter(user__id__exact=user_id).select_related('content_type', 'user')[:self.limit]\n+            context[self.varname] = LogEntry.objects.filter(user__id__exact=user_id).select_related('content_type', 'user')[:int(self.limit)]\n         return ''\n \n @register.tag"
        },
        {
            "sha": "4ff1a9cce5b9f6ee0e2a5b9082ebb315a13bb15c",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
            "patch": "@@ -148,7 +148,7 @@ def get_query_string(self, new_params=None, remove=None):\n         if remove is None: remove = []\n         p = self.params.copy()\n         for r in remove:\n-            for k in p.keys():\n+            for k in list(p.keys()):\n                 if k.startswith(r):\n                     del p[k]\n         for k, v in new_params.items():"
        },
        {
            "sha": "1beb6f9e3058257ac637730aae2f80f92524dd4e",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
            "patch": "@@ -855,7 +855,7 @@ def unique_error_message(self, model_class, unique_check):\n             }\n         # unique_together\n         else:\n-            field_labels = map(lambda f: capfirst(opts.get_field(f).verbose_name), unique_check)\n+            field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]\n             field_labels = get_text_list(field_labels, _('and'))\n             return _(\"%(model_name)s with this %(field_label)s already exists.\") %  {\n                 'model_name': six.text_type(model_name),"
        },
        {
            "sha": "3e99833aa669c544ded8f0383c9bdc517afd9d7d",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
            "patch": "@@ -66,7 +66,7 @@ def dictvalue(t):\n     # max-age, use the minimum of the two ages. In practice this happens when\n     # a decorator and a piece of middleware both operate on a given view.\n     if 'max-age' in cc and 'max_age' in kwargs:\n-        kwargs['max_age'] = min(cc['max-age'], kwargs['max_age'])\n+        kwargs['max_age'] = min(int(cc['max-age']), kwargs['max_age'])\n \n     # Allow overriding private caching and vice versa\n     if 'private' in cc and 'public' in kwargs:"
        },
        {
            "sha": "d7f3a03174608e0a214feeb5b55829e0e667bcf6",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
            "patch": "@@ -287,7 +287,7 @@ def compress_string(s):\n def javascript_quote(s, quote_double_quotes=False):\n \n     def fix(match):\n-        return b\"\\u%04x\" % ord(match.group(1))\n+        return \"\\\\u%04x\" % ord(match.group(1))\n \n     if type(s) == bytes:\n         s = s.decode('utf-8')"
        },
        {
            "sha": "e43ebe471e970a66b80fb59964b4900cf44090d9",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 158,
            "deletions": 187,
            "changes": 345,
            "blob_url": "https://github.com/django/django/blob/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c2d59e556499ecee3d8a1fc684f49a21463ab1c1/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=c2d59e556499ecee3d8a1fc684f49a21463ab1c1",
            "patch": "@@ -30,7 +30,7 @@\n from django.test import TestCase\n from django.utils import formats, translation, unittest\n from django.utils.cache import get_max_age\n-from django.utils.encoding import iri_to_uri\n+from django.utils.encoding import iri_to_uri, smart_bytes\n from django.utils.html import escape\n from django.utils.http import urlencode\n from django.utils import six\n@@ -78,12 +78,22 @@ def tearDown(self):\n         self.client.logout()\n         formats.reset_format_cache()\n \n+    def assertContentBefore(self, response, text1, text2, failing_msg=None):\n+        \"\"\"\n+        Testing utility asserting that text1 appears before text2 in response\n+        content.\n+        \"\"\"\n+        self.assertEqual(response.status_code, 200)\n+        self.assertTrue(response.content.index(smart_bytes(text1)) < response.content.index(smart_bytes(text2)),\n+            failing_msg\n+        )\n+\n     def testTrailingSlashRequired(self):\n         \"\"\"\n         If you leave off the trailing slash, app should redirect and add it.\n         \"\"\"\n-        request = self.client.get('/test_admin/%s/admin_views/article/add' % self.urlbit)\n-        self.assertRedirects(request,\n+        response = self.client.get('/test_admin/%s/admin_views/article/add' % self.urlbit)\n+        self.assertRedirects(response,\n             '/test_admin/%s/admin_views/article/add/' % self.urlbit, status_code=301\n         )\n \n@@ -219,38 +229,32 @@ def testChangeListSortingCallable(self):\n         (column 2 is callable_year in ArticleAdmin)\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/article/' % self.urlbit, {'o': 2})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index('Oldest content') < response.content.index('Middle content') and\n-            response.content.index('Middle content') < response.content.index('Newest content'),\n-            \"Results of sorting on callable are out of order.\"\n-        )\n+        self.assertContentBefore(response, 'Oldest content', 'Middle content',\n+            \"Results of sorting on callable are out of order.\")\n+        self.assertContentBefore(response, 'Middle content', 'Newest content',\n+            \"Results of sorting on callable are out of order.\")\n \n     def testChangeListSortingModel(self):\n         \"\"\"\n         Ensure we can sort on a list_display field that is a Model method\n         (colunn 3 is 'model_year' in ArticleAdmin)\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/article/' % self.urlbit, {'o': '-3'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index('Newest content') < response.content.index('Middle content') and\n-            response.content.index('Middle content') < response.content.index('Oldest content'),\n-            \"Results of sorting on Model method are out of order.\"\n-        )\n+        self.assertContentBefore(response, 'Newest content', 'Middle content',\n+            \"Results of sorting on Model method are out of order.\")\n+        self.assertContentBefore(response, 'Middle content', 'Oldest content',\n+            \"Results of sorting on Model method are out of order.\")\n \n     def testChangeListSortingModelAdmin(self):\n         \"\"\"\n         Ensure we can sort on a list_display field that is a ModelAdmin method\n         (colunn 4 is 'modeladmin_year' in ArticleAdmin)\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/article/' % self.urlbit, {'o': '4'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index('Oldest content') < response.content.index('Middle content') and\n-            response.content.index('Middle content') < response.content.index('Newest content'),\n-            \"Results of sorting on ModelAdmin method are out of order.\"\n-        )\n+        self.assertContentBefore(response, 'Oldest content', 'Middle content',\n+            \"Results of sorting on ModelAdmin method are out of order.\")\n+        self.assertContentBefore(response, 'Middle content', 'Newest content',\n+            \"Results of sorting on ModelAdmin method are out of order.\")\n \n     def testChangeListSortingMultiple(self):\n         p1 = Person.objects.create(name=\"Chris\", gender=1, alive=True)\n@@ -262,19 +266,13 @@ def testChangeListSortingMultiple(self):\n         # This hard-codes the URL because it'll fail if it runs against the\n         # 'admin2' custom admin (which doesn't have the Person model).\n         response = self.client.get('/test_admin/admin/admin_views/person/', {'o': '1.2'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p3.id) < response.content.index(link % p1.id) and\n-            response.content.index(link % p1.id) < response.content.index(link % p2.id)\n-        )\n+        self.assertContentBefore(response, link % p3.id, link % p1.id)\n+        self.assertContentBefore(response, link % p1.id, link % p2.id)\n \n         # Sort by gender descending, name\n         response = self.client.get('/test_admin/admin/admin_views/person/', {'o': '-2.1'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p2.id) < response.content.index(link % p3.id) and\n-            response.content.index(link % p3.id) < response.content.index(link % p1.id)\n-        )\n+        self.assertContentBefore(response, link % p2.id, link % p3.id)\n+        self.assertContentBefore(response, link % p3.id, link % p1.id)\n \n     def testChangeListSortingPreserveQuerySetOrdering(self):\n         \"\"\"\n@@ -291,11 +289,8 @@ def testChangeListSortingPreserveQuerySetOrdering(self):\n         # This hard-codes the URL because it'll fail if it runs against the\n         # 'admin2' custom admin (which doesn't have the Person model).\n         response = self.client.get('/test_admin/admin/admin_views/person/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p3.id) < response.content.index(link % p2.id) and\n-            response.content.index(link % p2.id) < response.content.index(link % p1.id)\n-        )\n+        self.assertContentBefore(response, link % p3.id, link % p2.id)\n+        self.assertContentBefore(response, link % p2.id, link % p1.id)\n \n     def testChangeListSortingModelMeta(self):\n         # Test ordering on Model Meta is respected\n@@ -305,17 +300,11 @@ def testChangeListSortingModelMeta(self):\n         link = '<a href=\"%s/'\n \n         response = self.client.get('/test_admin/admin/admin_views/language/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % l2.pk) < response.content.index(link % l1.pk)\n-        )\n+        self.assertContentBefore(response, link % l2.pk, link % l1.pk)\n \n         # Test we can override with query string\n         response = self.client.get('/test_admin/admin/admin_views/language/', {'o':'-1'})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % l1.pk) < response.content.index(link % l2.pk)\n-        )\n+        self.assertContentBefore(response, link % l1.pk, link % l2.pk)\n \n     def testChangeListSortingOverrideModelAdmin(self):\n         # Test ordering on Model Admin is respected, and overrides Model Meta\n@@ -325,10 +314,7 @@ def testChangeListSortingOverrideModelAdmin(self):\n \n         link = '<a href=\"%s/'\n         response = self.client.get('/test_admin/admin/admin_views/podcast/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p1.pk) < response.content.index(link % p2.pk)\n-        )\n+        self.assertContentBefore(response, link % p1.pk, link % p2.pk)\n \n     def testMultipleSortSameField(self):\n         # Check that we get the columns we expect if we have two columns\n@@ -339,32 +325,24 @@ def testMultipleSortSameField(self):\n \n         link = '<a href=\"%s/'\n         response = self.client.get('/test_admin/admin/admin_views/podcast/', {})\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            response.content.index(link % p1.pk) < response.content.index(link % p2.pk)\n-        )\n+        self.assertContentBefore(response, link % p1.pk, link % p2.pk)\n \n         p1 = ComplexSortedPerson.objects.create(name=\"Bob\", age=10)\n         p2 = ComplexSortedPerson.objects.create(name=\"Amy\", age=20)\n         link = '<a href=\"%s/'\n \n         response = self.client.get('/test_admin/admin/admin_views/complexsortedperson/', {})\n-        self.assertEqual(response.status_code, 200)\n         # Should have 5 columns (including action checkbox col)\n         self.assertContains(response, '<th scope=\"col\"', count=5)\n \n         self.assertContains(response, 'Name')\n         self.assertContains(response, 'Colored name')\n \n         # Check order\n-        self.assertTrue(\n-            response.content.index('Name') < response.content.index('Colored name')\n-        )\n+        self.assertContentBefore(response, 'Name', 'Colored name')\n \n         # Check sorting - should be by name\n-        self.assertTrue(\n-            response.content.index(link % p2.id) < response.content.index(link % p1.id)\n-        )\n+        self.assertContentBefore(response, link % p2.id, link % p1.id)\n \n     def testSortIndicatorsAdminOrder(self):\n         \"\"\"\n@@ -389,8 +367,8 @@ def testSortIndicatorsAdminOrder(self):\n             # the implicit 'action_checkbox' and 1 being the column 'stuff'.\n             self.assertEqual(response.context['cl'].get_ordering_field_columns(), {2: 'asc'})\n             # Check order of records.\n-            self.assertTrue(response.content.index('The First Item') <\n-                response.content.index('The Middle Item') < response.content.index('The Last Item'))\n+            self.assertContentBefore(response, 'The First Item', 'The Middle Item')\n+            self.assertContentBefore(response, 'The Middle Item', 'The Last Item')\n \n     def testLimitedFilter(self):\n         \"\"\"Ensure admin changelist filters do not contain objects excluded via limit_choices_to.\n@@ -480,26 +458,22 @@ def testNamedGroupFieldChoicesChangeList(self):\n         has been used in the choices option of a field.\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/fabric/' % self.urlbit)\n-        self.assertEqual(response.status_code, 200)\n-        self.assertTrue(\n-            '<a href=\"1/\">Horizontal</a>' in response.content and\n-            '<a href=\"2/\">Vertical</a>' in response.content,\n-            \"Changelist table isn't showing the right human-readable values set by a model field 'choices' option named group.\"\n-        )\n+        fail_msg = \"Changelist table isn't showing the right human-readable values set by a model field 'choices' option named group.\"\n+        self.assertContains(response, '<a href=\"1/\">Horizontal</a>', msg_prefix=fail_msg, html=True)\n+        self.assertContains(response, '<a href=\"2/\">Vertical</a>', msg_prefix=fail_msg, html=True)\n \n     def testNamedGroupFieldChoicesFilter(self):\n         \"\"\"\n         Ensures the filter UI shows correctly when at least one named group has\n         been used in the choices option of a model field.\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/fabric/' % self.urlbit)\n-        self.assertEqual(response.status_code, 200)\n+        fail_msg = \"Changelist filter isn't showing options contained inside a model field 'choices' option named group.\"\n         self.assertContains(response, '<div id=\"changelist-filter\">')\n-        self.assertTrue(\n-            '<a href=\"?surface__exact=x\">Horizontal</a>' in response.content and\n-            '<a href=\"?surface__exact=y\">Vertical</a>' in response.content,\n-            \"Changelist filter isn't showing options contained inside a model field 'choices' option named group.\"\n-        )\n+        self.assertContains(response,\n+            '<a href=\"?surface__exact=x\">Horizontal</a>', msg_prefix=fail_msg, html=True)\n+        self.assertContains(response,\n+            '<a href=\"?surface__exact=y\">Vertical</a>', msg_prefix=fail_msg, html=True)\n \n     def testChangeListNullBooleanDisplay(self):\n         Post.objects.create(public=None)\n@@ -590,8 +564,8 @@ def test_hide_change_password(self):\n         user.save()\n \n         response = self.client.get('/test_admin/admin/')\n-        self.assertFalse(reverse('admin:password_change') in response.content,\n-            msg='The \"change password\" link should not be displayed if a user does not have a usable password.')\n+        self.assertNotContains(response, reverse('admin:password_change'),\n+            msg_prefix='The \"change password\" link should not be displayed if a user does not have a usable password.')\n \n     def test_change_view_with_show_delete_extra_context(self):\n         \"\"\"\n@@ -618,7 +592,7 @@ def tearDown(self):\n \n     def testChangeFormUrlHasCorrectValue(self):\n         \"\"\"\n-        Tests whether change_view has form_url in request.context\n+        Tests whether change_view has form_url in response.context\n         \"\"\"\n         response = self.client.get('/test_admin/%s/admin_views/section/1/' % self.urlbit)\n         self.assertTrue('form_url' in response.context, msg='form_url not present in response.context')\n@@ -755,34 +729,34 @@ def testCustomAdminSiteLoginForm(self):\n \n     def testCustomAdminSiteLoginTemplate(self):\n         self.client.logout()\n-        request = self.client.get('/test_admin/admin2/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/login.html')\n-        self.assertTrue('Hello from a custom login template' in request.content)\n+        response = self.client.get('/test_admin/admin2/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/login.html')\n+        self.assertContains(response, 'Hello from a custom login template')\n \n     def testCustomAdminSiteLogoutTemplate(self):\n-        request = self.client.get('/test_admin/admin2/logout/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/logout.html')\n-        self.assertTrue('Hello from a custom logout template' in request.content)\n+        response = self.client.get('/test_admin/admin2/logout/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/logout.html')\n+        self.assertContains(response, 'Hello from a custom logout template')\n \n     def testCustomAdminSiteIndexViewAndTemplate(self):\n-        request = self.client.get('/test_admin/admin2/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/index.html')\n-        self.assertTrue('Hello from a custom index template *bar*' in request.content)\n+        response = self.client.get('/test_admin/admin2/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/index.html')\n+        self.assertContains(response, 'Hello from a custom index template *bar*')\n \n     def testCustomAdminSitePasswordChangeTemplate(self):\n-        request = self.client.get('/test_admin/admin2/password_change/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/password_change_form.html')\n-        self.assertTrue('Hello from a custom password change form template' in request.content)\n+        response = self.client.get('/test_admin/admin2/password_change/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/password_change_form.html')\n+        self.assertContains(response, 'Hello from a custom password change form template')\n \n     def testCustomAdminSitePasswordChangeDoneTemplate(self):\n-        request = self.client.get('/test_admin/admin2/password_change/done/')\n-        self.assertIsInstance(request, TemplateResponse)\n-        self.assertTemplateUsed(request, 'custom_admin/password_change_done.html')\n-        self.assertTrue('Hello from a custom password change done template' in request.content)\n+        response = self.client.get('/test_admin/admin2/password_change/done/')\n+        self.assertIsInstance(response, TemplateResponse)\n+        self.assertTemplateUsed(response, 'custom_admin/password_change_done.html')\n+        self.assertContains(response, 'Hello from a custom password change done template')\n \n     def testCustomAdminSiteView(self):\n         self.client.login(username='super', password='secret')\n@@ -885,16 +859,16 @@ def testLogin(self):\n         a 200 status code.\n         \"\"\"\n         # Super User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.super_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Test if user enters e-mail address\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.super_email_login)\n         self.assertContains(login, \"Your e-mail address is not your username\")\n         # only correct passwords get a username hint\n@@ -907,47 +881,47 @@ def testLogin(self):\n         self.assertContains(login, ERROR_MESSAGE)\n \n         # Add User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.adduser_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Change User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.changeuser_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Delete User\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.deleteuser_login)\n         self.assertRedirects(login, '/test_admin/admin/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Regular User should not be able to login.\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.joepublic_login)\n         self.assertEqual(login.status_code, 200)\n         self.assertContains(login, ERROR_MESSAGE)\n \n         # Requests without username should not return 500 errors.\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/', self.no_username_login)\n         self.assertEqual(login.status_code, 200)\n         form = login.context[0].get('form')\n         self.assertEqual(form.errors['username'][0], 'This field is required.')\n \n     def testLoginSuccessfullyRedirectsToOriginalUrl(self):\n-        request = self.client.get('/test_admin/admin/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/')\n+        self.assertEqual(response.status_code, 200)\n         query_string = 'the-answer=42'\n         redirect_url = '/test_admin/admin/?%s' % query_string\n         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n@@ -967,8 +941,8 @@ def testAddView(self):\n         self.client.post('/test_admin/admin/', self.changeuser_login)\n         # make sure the view removes test cookie\n         self.assertEqual(self.client.session.test_cookie_worked(), False)\n-        request = self.client.get('/test_admin/admin/admin_views/article/add/')\n-        self.assertEqual(request.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/add/')\n+        self.assertEqual(response.status_code, 403)\n         # Try POST just to make sure\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertEqual(post.status_code, 403)\n@@ -979,10 +953,9 @@ def testAddView(self):\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.adduser_login)\n         addpage = self.client.get('/test_admin/admin/admin_views/article/add/')\n-        self.assertEqual(addpage.status_code, 200)\n         change_list_link = '&rsaquo; <a href=\"/test_admin/admin/admin_views/article/\">Articles</a>'\n-        self.assertFalse(change_list_link in addpage.content,\n-                    'User restricted to add permission is given link to change list view in breadcrumbs.')\n+        self.assertNotContains(addpage, change_list_link,\n+            msg_prefix='User restricted to add permission is given link to change list view in breadcrumbs.')\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertRedirects(post, '/test_admin/admin/')\n         self.assertEqual(Article.objects.all().count(), 4)\n@@ -994,9 +967,8 @@ def testAddView(self):\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.super_login)\n         addpage = self.client.get('/test_admin/admin/admin_views/article/add/')\n-        self.assertEqual(addpage.status_code, 200)\n-        self.assertFalse(change_list_link not in addpage.content,\n-                    'Unrestricted user is not given link to change list view in breadcrumbs.')\n+        self.assertContains(addpage, change_list_link,\n+            msg_prefix='Unrestricted user is not given link to change list view in breadcrumbs.')\n         post = self.client.post('/test_admin/admin/admin_views/article/add/', add_dict)\n         self.assertRedirects(post, '/test_admin/admin/admin_views/article/')\n         self.assertEqual(Article.objects.all().count(), 5)\n@@ -1022,21 +994,21 @@ def testChangeView(self):\n         # add user shoud not be able to view the list of article or change any of them\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.adduser_login)\n-        request = self.client.get('/test_admin/admin/admin_views/article/')\n-        self.assertEqual(request.status_code, 403)\n-        request = self.client.get('/test_admin/admin/admin_views/article/1/')\n-        self.assertEqual(request.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/')\n+        self.assertEqual(response.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/1/')\n+        self.assertEqual(response.status_code, 403)\n         post = self.client.post('/test_admin/admin/admin_views/article/1/', change_dict)\n         self.assertEqual(post.status_code, 403)\n         self.client.get('/test_admin/admin/logout/')\n \n         # change user can view all items and edit them\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.changeuser_login)\n-        request = self.client.get('/test_admin/admin/admin_views/article/')\n-        self.assertEqual(request.status_code, 200)\n-        request = self.client.get('/test_admin/admin/admin_views/article/1/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/admin_views/article/')\n+        self.assertEqual(response.status_code, 200)\n+        response = self.client.get('/test_admin/admin/admin_views/article/1/')\n+        self.assertEqual(response.status_code, 200)\n         post = self.client.post('/test_admin/admin/admin_views/article/1/', change_dict)\n         self.assertRedirects(post, '/test_admin/admin/admin_views/article/')\n         self.assertEqual(Article.objects.get(pk=1).content, '<p>edited article</p>')\n@@ -1058,33 +1030,33 @@ def testChangeView(self):\n         RowLevelChangePermissionModel.objects.create(id=2, name=\"even id\")\n         for login_dict in [self.super_login, self.changeuser_login, self.adduser_login, self.deleteuser_login]:\n             self.client.post('/test_admin/admin/', login_dict)\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n-            self.assertEqual(request.status_code, 403)\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n+            self.assertEqual(response.status_code, 403)\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')\n-            self.assertEqual(request.status_code, 403)\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n-            self.assertEqual(request.status_code, 200)\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed'})\n+            self.assertEqual(response.status_code, 403)\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n+            self.assertEqual(response.status_code, 200)\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')\n-            self.assertRedirects(request, '/test_admin/admin/')\n+            self.assertRedirects(response, '/test_admin/admin/')\n             self.client.get('/test_admin/admin/logout/')\n         for login_dict in [self.joepublic_login, self.no_username_login]:\n             self.client.post('/test_admin/admin/', login_dict)\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/')\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/', {'name': 'changed'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=1).name, 'odd id')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n-            request = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n-            request = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed again'})\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n+            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/')\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n+            response = self.client.post('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/', {'name': 'changed again'})\n             self.assertEqual(RowLevelChangePermissionModel.objects.get(id=2).name, 'changed')\n-            self.assertEqual(request.status_code, 200)\n-            self.assertContains(request, 'login-form')\n+            self.assertEqual(response.status_code, 200)\n+            self.assertContains(response, 'login-form')\n             self.client.get('/test_admin/admin/logout/')\n \n     def testConditionallyShowAddSectionLink(self):\n@@ -1114,14 +1086,13 @@ def testCustomModelAdminTemplates(self):\n         self.client.post('/test_admin/admin/', self.super_login)\n \n         # Test custom change list template with custom extra context\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/')\n-        self.assertEqual(request.status_code, 200)\n-        self.assertTrue(\"var hello = 'Hello!';\" in request.content)\n-        self.assertTemplateUsed(request, 'custom_admin/change_list.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/')\n+        self.assertContains(response, \"var hello = 'Hello!';\")\n+        self.assertTemplateUsed(response, 'custom_admin/change_list.html')\n \n         # Test custom add form template\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/add/')\n-        self.assertTemplateUsed(request, 'custom_admin/add_form.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/add/')\n+        self.assertTemplateUsed(response, 'custom_admin/add_form.html')\n \n         # Add an article so we can test delete, change, and history views\n         post = self.client.post('/test_admin/admin/admin_views/customarticle/add/', {\n@@ -1135,18 +1106,18 @@ def testCustomModelAdminTemplates(self):\n \n         # Test custom delete, change, and object history templates\n         # Test custom change form template\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/%d/' % article_pk)\n-        self.assertTemplateUsed(request, 'custom_admin/change_form.html')\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/%d/delete/' % article_pk)\n-        self.assertTemplateUsed(request, 'custom_admin/delete_confirmation.html')\n-        request = self.client.post('/test_admin/admin/admin_views/customarticle/', data={\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/%d/' % article_pk)\n+        self.assertTemplateUsed(response, 'custom_admin/change_form.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/%d/delete/' % article_pk)\n+        self.assertTemplateUsed(response, 'custom_admin/delete_confirmation.html')\n+        response = self.client.post('/test_admin/admin/admin_views/customarticle/', data={\n                 'index': 0,\n                 'action': ['delete_selected'],\n                 '_selected_action': ['1'],\n             })\n-        self.assertTemplateUsed(request, 'custom_admin/delete_selected_confirmation.html')\n-        request = self.client.get('/test_admin/admin/admin_views/customarticle/%d/history/' % article_pk)\n-        self.assertTemplateUsed(request, 'custom_admin/object_history.html')\n+        self.assertTemplateUsed(response, 'custom_admin/delete_selected_confirmation.html')\n+        response = self.client.get('/test_admin/admin/admin_views/customarticle/%d/history/' % article_pk)\n+        self.assertTemplateUsed(response, 'custom_admin/object_history.html')\n \n         self.client.get('/test_admin/admin/logout/')\n \n@@ -1158,8 +1129,8 @@ def testDeleteView(self):\n         # add user shoud not be able to delete articles\n         self.client.get('/test_admin/admin/')\n         self.client.post('/test_admin/admin/', self.adduser_login)\n-        request = self.client.get('/test_admin/admin/admin_views/article/1/delete/')\n-        self.assertEqual(request.status_code, 403)\n+        response = self.client.get('/test_admin/admin/admin_views/article/1/delete/')\n+        self.assertEqual(response.status_code, 403)\n         post = self.client.post('/test_admin/admin/admin_views/article/1/delete/', delete_dict)\n         self.assertEqual(post.status_code, 403)\n         self.assertEqual(Article.objects.all().count(), 3)\n@@ -1246,9 +1217,9 @@ def test_nesting(self):\n         Objects should be nested to display the relationships that\n         cause them to be scheduled for deletion.\n         \"\"\"\n-        pattern = re.compile(r\"\"\"<li>Plot: <a href=\".+/admin_views/plot/1/\">World Domination</a>\\s*<ul>\\s*<li>Plot details: <a href=\".+/admin_views/plotdetails/1/\">almost finished</a>\"\"\")\n+        pattern = re.compile(br\"\"\"<li>Plot: <a href=\".+/admin_views/plot/1/\">World Domination</a>\\s*<ul>\\s*<li>Plot details: <a href=\".+/admin_views/plotdetails/1/\">almost finished</a>\"\"\")\n         response = self.client.get('/test_admin/admin/admin_views/villain/%s/delete/' % quote(1))\n-        self.assertTrue(pattern.search(response.content))\n+        self.assertRegexpMatches(response.content, pattern)\n \n     def test_cyclic(self):\n         \"\"\"\n@@ -1407,9 +1378,9 @@ def test_recentactions_without_content_type(self):\n         logentry.content_type = None\n         logentry.save()\n \n-        counted_presence_before = response.content.count(should_contain)\n+        counted_presence_before = response.content.count(smart_bytes(should_contain))\n         response = self.client.get('/test_admin/admin/')\n-        counted_presence_after = response.content.count(should_contain)\n+        counted_presence_after = response.content.count(smart_bytes(should_contain))\n         self.assertEqual(counted_presence_before - 1,\n                           counted_presence_after)\n \n@@ -1512,8 +1483,8 @@ def test_secure_view_shows_login_if_not_logged_in(self):\n         self.assertTemplateUsed(response, 'admin/login.html')\n \n     def test_secure_view_login_successfully_redirects_to_original_url(self):\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         query_string = 'the-answer=42'\n         redirect_url = '/test_admin/admin/secure-view/?%s' % query_string\n         new_next = {REDIRECT_FIELD_NAME: redirect_url}\n@@ -1529,8 +1500,8 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         a 200 status code.\n         \"\"\"\n         # Super User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.super_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n@@ -1539,8 +1510,8 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         self.assertEqual(self.client.session.test_cookie_worked(), False)\n \n         # Test if user enters e-mail address\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.super_email_login)\n         self.assertContains(login, \"Your e-mail address is not your username\")\n         # only correct passwords get a username hint\n@@ -1553,32 +1524,32 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         self.assertContains(login, ERROR_MESSAGE)\n \n         # Add User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.adduser_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Change User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.changeuser_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Delete User\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.deleteuser_login)\n         self.assertRedirects(login, '/test_admin/admin/secure-view/')\n         self.assertFalse(login.context)\n         self.client.get('/test_admin/admin/logout/')\n \n         # Regular User should not be able to login.\n-        request = self.client.get('/test_admin/admin/secure-view/')\n-        self.assertEqual(request.status_code, 200)\n+        response = self.client.get('/test_admin/admin/secure-view/')\n+        self.assertEqual(response.status_code, 200)\n         login = self.client.post('/test_admin/admin/secure-view/', self.joepublic_login)\n         self.assertEqual(login.status_code, 200)\n         # Login.context is a list of context dicts we just need to check the first one.\n@@ -2107,7 +2078,7 @@ def testInline(self):\n         foo_user = \"foo username\"\n         bar_user = \"bar username\"\n \n-        name_re = re.compile('name=\"(.*?)\"')\n+        name_re = re.compile(b'name=\"(.*?)\"')\n \n         # test the add case\n         response = self.client.get('/test_admin/admin/admin_views/persona/add/')\n@@ -2214,7 +2185,7 @@ def test_model_admin_default_delete_action(self):\n         confirmation = self.client.post('/test_admin/admin/admin_views/subscriber/', action_data)\n         self.assertIsInstance(confirmation, TemplateResponse)\n         self.assertContains(confirmation, \"Are you sure you want to delete the selected subscribers?\")\n-        self.assertTrue(confirmation.content.count(ACTION_CHECKBOX_NAME) == 2)\n+        self.assertContains(confirmation, ACTION_CHECKBOX_NAME, count=2)\n         response = self.client.post('/test_admin/admin/admin_views/subscriber/', delete_confirmation_data)\n         self.assertEqual(Subscriber.objects.count(), 0)\n \n@@ -2514,7 +2485,7 @@ def setUp(self):\n         # to use a NamedTemporaryFile.\n         tdir = tempfile.gettempdir()\n         file1 = tempfile.NamedTemporaryFile(suffix=\".file1\", dir=tdir)\n-        file1.write('a' * (2 ** 21))\n+        file1.write(b'a' * (2 ** 21))\n         filename = file1.name\n         file1.close()\n         self.gallery = Gallery(name=\"Test Gallery\")\n@@ -3197,9 +3168,9 @@ def test_limit_choices_to(self):\n                                                   country=\"Spain\")\n         response = self.client.get('/test_admin/admin/admin_views/sketch/add/')\n         # Find the link\n-        m = re.search(r'<a href=\"([^\"]*)\"[^>]* id=\"lookup_id_inquisition\"', response.content)\n+        m = re.search(br'<a href=\"([^\"]*)\"[^>]* id=\"lookup_id_inquisition\"', response.content)\n         self.assertTrue(m) # Got a match\n-        popup_url = m.groups()[0].replace(\"&amp;\", \"&\")\n+        popup_url = m.groups()[0].decode().replace(\"&amp;\", \"&\")\n \n         # Handle relative links\n         popup_url = urljoin(response.request['PATH_INFO'], popup_url)"
        }
    ],
    "stats": {
        "total": 355,
        "additions": 163,
        "deletions": 192
    }
}