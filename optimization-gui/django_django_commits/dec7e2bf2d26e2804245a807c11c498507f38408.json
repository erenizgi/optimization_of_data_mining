{
    "author": "alex",
    "message": "Converted United States localflavor doctests into unittests.  We have always been at war with doctests.  Thanks to Idan Gazit.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14954 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "dec7e2bf2d26e2804245a807c11c498507f38408",
    "files": [
        {
            "sha": "65dd1bb0848917e7fdd9dfdfa0bec82475cff915",
            "filename": "tests/regressiontests/forms/localflavor/us.py",
            "status": "modified",
            "additions": 66,
            "deletions": 197,
            "changes": 263,
            "blob_url": "https://github.com/django/django/blob/dec7e2bf2d26e2804245a807c11c498507f38408/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fus.py",
            "raw_url": "https://github.com/django/django/raw/dec7e2bf2d26e2804245a807c11c498507f38408/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fus.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fus.py?ref=dec7e2bf2d26e2804245a807c11c498507f38408",
            "patch": "@@ -1,190 +1,13 @@\n-# -*- coding: utf-8 -*-\n-# Tests for the contrib/localflavor/ US form fields.\n+from django.contrib.localflavor.us.forms import (USZipCodeField,\n+    USPhoneNumberField, USStateField, USStateSelect, USSocialSecurityNumberField)\n \n-tests = r\"\"\"\n-# USZipCodeField ##############################################################\n+from utils import LocalFlavorTestCase\n \n-USZipCodeField validates that the data is either a five-digit U.S. zip code or\n-a zip+4.\n->>> from django.contrib.localflavor.us.forms import USZipCodeField\n->>> f = USZipCodeField()\n->>> f.clean('60606')\n-u'60606'\n->>> f.clean(60606)\n-u'60606'\n->>> f.clean('04000')\n-u'04000'\n->>> f.clean('4000')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n->>> f.clean('60606-1234')\n-u'60606-1234'\n->>> f.clean('6060-1234')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n->>> f.clean('60606-')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n \n->>> f = USZipCodeField(required=False)\n->>> f.clean('60606')\n-u'60606'\n->>> f.clean(60606)\n-u'60606'\n->>> f.clean('04000')\n-u'04000'\n->>> f.clean('4000')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n->>> f.clean('60606-1234')\n-u'60606-1234'\n->>> f.clean('6060-1234')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n->>> f.clean('60606-')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n->>> f.clean(None)\n-u''\n->>> f.clean('')\n-u''\n-\n-# USPhoneNumberField ##########################################################\n-\n-USPhoneNumberField validates that the data is a valid U.S. phone number,\n-including the area code. It's normalized to XXX-XXX-XXXX format.\n->>> from django.contrib.localflavor.us.forms import USPhoneNumberField\n->>> f = USPhoneNumberField()\n->>> f.clean('312-555-1212')\n-u'312-555-1212'\n->>> f.clean('3125551212')\n-u'312-555-1212'\n->>> f.clean('312 555-1212')\n-u'312-555-1212'\n->>> f.clean('(312) 555-1212')\n-u'312-555-1212'\n->>> f.clean('312 555 1212')\n-u'312-555-1212'\n->>> f.clean('312.555.1212')\n-u'312-555-1212'\n->>> f.clean('312.555-1212')\n-u'312-555-1212'\n->>> f.clean(' (312) 555.1212 ')\n-u'312-555-1212'\n->>> f.clean('555-1212')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Phone numbers must be in XXX-XXX-XXXX format.']\n->>> f.clean('312-55-1212')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Phone numbers must be in XXX-XXX-XXXX format.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n-\n->>> f = USPhoneNumberField(required=False)\n->>> f.clean('312-555-1212')\n-u'312-555-1212'\n->>> f.clean('3125551212')\n-u'312-555-1212'\n->>> f.clean('312 555-1212')\n-u'312-555-1212'\n->>> f.clean('(312) 555-1212')\n-u'312-555-1212'\n->>> f.clean('312 555 1212')\n-u'312-555-1212'\n->>> f.clean('312.555.1212')\n-u'312-555-1212'\n->>> f.clean('312.555-1212')\n-u'312-555-1212'\n->>> f.clean(' (312) 555.1212 ')\n-u'312-555-1212'\n->>> f.clean('555-1212')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Phone numbers must be in XXX-XXX-XXXX format.']\n->>> f.clean('312-55-1212')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Phone numbers must be in XXX-XXX-XXXX format.']\n->>> f.clean(None)\n-u''\n->>> f.clean('')\n-u''\n-\n-# USStateField ################################################################\n-\n-USStateField validates that the data is either an abbreviation or name of a\n-U.S. state.\n->>> from django.contrib.localflavor.us.forms import USStateField\n->>> f = USStateField()\n->>> f.clean('il')\n-u'IL'\n->>> f.clean('IL')\n-u'IL'\n->>> f.clean('illinois')\n-u'IL'\n->>> f.clean('  illinois ')\n-u'IL'\n->>> f.clean(60606)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a U.S. state or territory.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n-\n->>> f = USStateField(required=False)\n->>> f.clean('il')\n-u'IL'\n->>> f.clean('IL')\n-u'IL'\n->>> f.clean('illinois')\n-u'IL'\n->>> f.clean('  illinois ')\n-u'IL'\n->>> f.clean(60606)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a U.S. state or territory.']\n->>> f.clean(None)\n-u''\n->>> f.clean('')\n-u''\n-\n-# USStateSelect ###############################################################\n-\n-USStateSelect is a Select widget that uses a list of U.S. states/territories\n-as its choices.\n->>> from django.contrib.localflavor.us.forms import USStateSelect\n->>> w = USStateSelect()\n->>> print w.render('state', 'IL')\n-<select name=\"state\">\n+class USLocalFlavorTests(LocalFlavorTestCase):\n+    def test_USStateSelect(self):\n+        f = USStateSelect()\n+        out = u'''<select name=\"state\">\n <option value=\"AL\">Alabama</option>\n <option value=\"AK\">Alaska</option>\n <option value=\"AS\">American Samoa</option>\n@@ -241,17 +64,63 @@\n <option value=\"WV\">West Virginia</option>\n <option value=\"WI\">Wisconsin</option>\n <option value=\"WY\">Wyoming</option>\n-</select>\n+</select>'''\n+        self.assertEquals(f.render('state', 'IL'), out)\n+\n+    def test_USZipCodeField(self):\n+        error_format = [u'Enter a zip code in the format XXXXX or XXXXX-XXXX.']\n+        valid = {\n+            '60606': '60606',\n+            60606: '60606',\n+            '04000': '04000',\n+            '60606-1234': '60606-1234',\n+        }\n+        invalid = {\n+            '4000': error_format,\n+            '6060-1234': error_format,\n+            '60606-': error_format,\n+        }\n+        self.assertFieldOutput(USZipCodeField, valid, invalid)\n+\n+    def test_USPhoneNumberField(self):\n+        error_format = [u'Phone numbers must be in XXX-XXX-XXXX format.']\n+        valid = {\n+            '312-555-1212': '312-555-1212',\n+            '3125551212': '312-555-1212',\n+            '312 555-1212': '312-555-1212',\n+            '(312) 555-1212': '312-555-1212',\n+            '312 555 1212': '312-555-1212',\n+            '312.555.1212': '312-555-1212',\n+            '312.555-1212': '312-555-1212',\n+            ' (312) 555.1212 ': '312-555-1212',\n+        }\n+        invalid = {\n+            '555-1212': error_format,\n+            '312-55-1212': error_format,\n+        }\n+        self.assertFieldOutput(USPhoneNumberField, valid, invalid)\n+\n+    def test_USStateField(self):\n+        error_invalid = [u'Enter a U.S. state or territory.']\n+        valid = {\n+            'il': 'IL',\n+            'IL': 'IL',\n+            'illinois': 'IL',\n+            '  illinois ': 'IL',\n+        }\n+        invalid = {\n+            60606: error_invalid,\n+        }\n+        self.assertFieldOutput(USStateField, valid, invalid)\n+\n+    def test_USSocialSecurityNumberField(self):\n+        error_invalid = [u'Enter a valid U.S. Social Security number in XXX-XX-XXXX format.']\n \n-# USSocialSecurityNumberField #################################################\n->>> from django.contrib.localflavor.us.forms import USSocialSecurityNumberField\n->>> f = USSocialSecurityNumberField()\n->>> f.clean('987-65-4330')\n-u'987-65-4330'\n->>> f.clean('987654330')\n-u'987-65-4330'\n->>> f.clean('078-05-1120')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid U.S. Social Security number in XXX-XX-XXXX format.']\n-\"\"\"\n+        valid = {\n+            '987-65-4330': '987-65-4330',\n+            '987654330': '987-65-4330',\n+        }\n+        invalid = {\n+            '078-05-1120': error_invalid,\n+        }\n+        self.assertFieldOutput(USSocialSecurityNumberField, valid, invalid)"
        },
        {
            "sha": "02ec55f3d4c548ba0773b8cf709313f9c54486c3",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/dec7e2bf2d26e2804245a807c11c498507f38408/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/dec7e2bf2d26e2804245a807c11c498507f38408/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=dec7e2bf2d26e2804245a807c11c498507f38408",
            "patch": "@@ -1,7 +1,6 @@\n # -*- coding: utf-8 -*-\n from localflavor.cz import tests as localflavor_cz_tests\n from localflavor.se import tests as localflavor_se_tests\n-from localflavor.us import tests as localflavor_us_tests\n from localflavor.uy import tests as localflavor_uy_tests\n from localflavor.za import tests as localflavor_za_tests\n \n@@ -32,12 +31,12 @@\n from localflavor.sk import SKLocalFlavorTests\n from localflavor.tr import TRLocalFlavorTests\n from localflavor.uk import UKLocalFlavorTests\n+from localflavor.us import USLocalFlavorTests\n \n \n __test__ = {\n     'localflavor_cz_tests': localflavor_cz_tests,\n     'localflavor_se_tests': localflavor_se_tests,\n-    'localflavor_us_tests': localflavor_us_tests,\n     'localflavor_uy_tests': localflavor_uy_tests,\n     'localflavor_za_tests': localflavor_za_tests,\n }"
        },
        {
            "sha": "c301ffe25ec60d35132c9c2660e3be8b1c30c1eb",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/dec7e2bf2d26e2804245a807c11c498507f38408/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/dec7e2bf2d26e2804245a807c11c498507f38408/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=dec7e2bf2d26e2804245a807c11c498507f38408",
            "patch": "@@ -40,4 +40,5 @@\n     SKLocalFlavorTests,\n     TRLocalFlavorTests,\n     UKLocalFlavorTests,\n+    USLocalFlavorTests,\n )"
        }
    ],
    "stats": {
        "total": 267,
        "additions": 68,
        "deletions": 199
    }
}