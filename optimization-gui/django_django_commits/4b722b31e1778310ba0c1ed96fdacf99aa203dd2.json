{
    "author": "claudep",
    "message": "Fixed #16317 -- Fixed dumpdata for self-referencing models and natural keys\n\nThanks aldaran for the patch.",
    "sha": "4b722b31e1778310ba0c1ed96fdacf99aa203dd2",
    "files": [
        {
            "sha": "d3650b1eb8a51d4dba4919ec98a11582785b0c7c",
            "filename": "django/core/management/commands/dumpdata.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py",
            "raw_url": "https://github.com/django/django/raw/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py?ref=4b722b31e1778310ba0c1ed96fdacf99aa203dd2",
            "patch": "@@ -150,11 +150,11 @@ def sort_dependencies(app_list):\n             for field in model._meta.fields:\n                 if hasattr(field.rel, 'to'):\n                     rel_model = field.rel.to\n-                    if hasattr(rel_model, 'natural_key'):\n+                    if hasattr(rel_model, 'natural_key') and rel_model != model:\n                         deps.append(rel_model)\n             for field in model._meta.many_to_many:\n                 rel_model = field.rel.to\n-                if hasattr(rel_model, 'natural_key'):\n+                if hasattr(rel_model, 'natural_key') and rel_model != model:\n                     deps.append(rel_model)\n             model_dependencies.append((model, deps))\n "
        },
        {
            "sha": "42e8ec0877aa547b6eab9012f4cdca9a642c4474",
            "filename": "tests/regressiontests/fixtures_regress/fixtures/forward_ref_lookup.json",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/tests%2Fregressiontests%2Ffixtures_regress%2Ffixtures%2Fforward_ref_lookup.json",
            "raw_url": "https://github.com/django/django/raw/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/tests%2Fregressiontests%2Ffixtures_regress%2Ffixtures%2Fforward_ref_lookup.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ffixtures%2Fforward_ref_lookup.json?ref=4b722b31e1778310ba0c1ed96fdacf99aa203dd2",
            "patch": "@@ -10,13 +10,15 @@\n         \"pk\": \"2\",\n         \"model\": \"fixtures_regress.store\",\n         \"fields\": {\n+            \"main\": null,\n             \"name\": \"Amazon\"\n         }\n     },\n     {\n         \"pk\": \"3\",\n         \"model\": \"fixtures_regress.store\",\n         \"fields\": {\n+            \"main\": null,\n             \"name\": \"Borders\"\n         }\n     },\n@@ -29,4 +31,4 @@\n             \"stores\": [[\"Amazon\"], [\"Borders\"]]\n         }\n     }\n-]\n\\ No newline at end of file\n+]"
        },
        {
            "sha": "14cf8800035649b91beaecc02589aa251d9896f1",
            "filename": "tests/regressiontests/fixtures_regress/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/tests%2Fregressiontests%2Ffixtures_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/tests%2Fregressiontests%2Ffixtures_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Fmodels.py?ref=4b722b31e1778310ba0c1ed96fdacf99aa203dd2",
            "patch": "@@ -91,6 +91,7 @@ def get_by_natural_key(self, key):\n class Store(models.Model):\n     objects = TestManager()\n     name = models.CharField(max_length=255)\n+    main = models.ForeignKey('self', null=True)\n \n     class Meta:\n         ordering = ('name',)"
        },
        {
            "sha": "ab93341699200bd8363980254b819471afb37435",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4b722b31e1778310ba0c1ed96fdacf99aa203dd2/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=4b722b31e1778310ba0c1ed96fdacf99aa203dd2",
            "patch": "@@ -478,7 +478,7 @@ def test_nk_on_serialize(self):\n         )\n         self.assertEqual(\n             stdout.getvalue(),\n-            \"\"\"[{\"pk\": 2, \"model\": \"fixtures_regress.store\", \"fields\": {\"name\": \"Amazon\"}}, {\"pk\": 3, \"model\": \"fixtures_regress.store\", \"fields\": {\"name\": \"Borders\"}}, {\"pk\": 4, \"model\": \"fixtures_regress.person\", \"fields\": {\"name\": \"Neal Stephenson\"}}, {\"pk\": 1, \"model\": \"fixtures_regress.book\", \"fields\": {\"stores\": [[\"Amazon\"], [\"Borders\"]], \"name\": \"Cryptonomicon\", \"author\": [\"Neal Stephenson\"]}}]\"\"\"\n+            \"\"\"[{\"pk\": 2, \"model\": \"fixtures_regress.store\", \"fields\": {\"main\": null, \"name\": \"Amazon\"}}, {\"pk\": 3, \"model\": \"fixtures_regress.store\", \"fields\": {\"main\": null, \"name\": \"Borders\"}}, {\"pk\": 4, \"model\": \"fixtures_regress.person\", \"fields\": {\"name\": \"Neal Stephenson\"}}, {\"pk\": 1, \"model\": \"fixtures_regress.book\", \"fields\": {\"stores\": [[\"Amazon\"], [\"Borders\"]], \"name\": \"Cryptonomicon\", \"author\": [\"Neal Stephenson\"]}}]\"\"\"\n         )\n \n     def test_dependency_sorting(self):"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 7,
        "deletions": 4
    }
}