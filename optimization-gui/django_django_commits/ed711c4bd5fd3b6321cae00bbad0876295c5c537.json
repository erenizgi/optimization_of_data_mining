{
    "author": "claudep",
    "message": "Fixed #19483 -- Improved import error message in contrib.comments\n\nThanks Valentin Lorentz for the report and the suggested fix.",
    "sha": "ed711c4bd5fd3b6321cae00bbad0876295c5c537",
    "files": [
        {
            "sha": "1798c1adb5dcc3e85b863fa2ad959dc1d67c7e64",
            "filename": "django/contrib/comments/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/ed711c4bd5fd3b6321cae00bbad0876295c5c537/django%2Fcontrib%2Fcomments%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/ed711c4bd5fd3b6321cae00bbad0876295c5c537/django%2Fcontrib%2Fcomments%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2F__init__.py?ref=ed711c4bd5fd3b6321cae00bbad0876295c5c537",
            "patch": "@@ -20,9 +20,9 @@ def get_comment_app():\n     # Try to import the package\n     try:\n         package = import_module(comments_app)\n-    except ImportError:\n+    except ImportError as e:\n         raise ImproperlyConfigured(\"The COMMENTS_APP setting refers to \"\\\n-                                   \"a non-existing package.\")\n+                                   \"a non-existing package. (%s)\" % e)\n \n     return package\n "
        },
        {
            "sha": "a756068790b1b78cc52cb315ebdaa7fd6fe27f33",
            "filename": "tests/regressiontests/comment_tests/tests/app_api_tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 11,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/ed711c4bd5fd3b6321cae00bbad0876295c5c537/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fapp_api_tests.py",
            "raw_url": "https://github.com/django/django/raw/ed711c4bd5fd3b6321cae00bbad0876295c5c537/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fapp_api_tests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcomment_tests%2Ftests%2Fapp_api_tests.py?ref=ed711c4bd5fd3b6321cae00bbad0876295c5c537",
            "patch": "@@ -4,6 +4,9 @@\n from django.contrib import comments\n from django.contrib.comments.models import Comment\n from django.contrib.comments.forms import CommentForm\n+from django.core.exceptions import ImproperlyConfigured\n+from django.test.utils import override_settings\n+from django.utils import six\n \n from . import CommentTestCase\n \n@@ -14,6 +17,14 @@ class CommentAppAPITests(CommentTestCase):\n     def testGetCommentApp(self):\n         self.assertEqual(comments.get_comment_app(), comments)\n \n+    @override_settings(\n+        COMMENTS_APP='missing_app',\n+        INSTALLED_APPS=list(settings.INSTALLED_APPS) + ['missing_app'],\n+    )\n+    def testGetMissingCommentApp(self):\n+        with six.assertRaisesRegex(self, ImproperlyConfigured, 'missing_app'):\n+            _ = comments.get_comment_app()\n+\n     def testGetForm(self):\n         self.assertEqual(comments.get_form(), CommentForm)\n \n@@ -33,20 +44,14 @@ def getGetApproveURL(self):\n         self.assertEqual(comments.get_approve_url(c), \"/approve/12345/\")\n \n \n+@override_settings(\n+    COMMENTS_APP='regressiontests.comment_tests.custom_comments',\n+    INSTALLED_APPS=list(settings.INSTALLED_APPS) + [\n+        'regressiontests.comment_tests.custom_comments'],\n+)\n class CustomCommentTest(CommentTestCase):\n     urls = 'regressiontests.comment_tests.urls'\n \n-    def setUp(self):\n-        self.old_comments_app = getattr(settings, 'COMMENTS_APP', None)\n-        settings.COMMENTS_APP = 'regressiontests.comment_tests.custom_comments'\n-        settings.INSTALLED_APPS = list(settings.INSTALLED_APPS) + [settings.COMMENTS_APP,]\n-\n-    def tearDown(self):\n-        del settings.INSTALLED_APPS[-1]\n-        settings.COMMENTS_APP = self.old_comments_app\n-        if settings.COMMENTS_APP is None:\n-            del settings._wrapped.COMMENTS_APP\n-\n     def testGetCommentApp(self):\n         from regressiontests.comment_tests import custom_comments\n         self.assertEqual(comments.get_comment_app(), custom_comments)"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 18,
        "deletions": 13
    }
}