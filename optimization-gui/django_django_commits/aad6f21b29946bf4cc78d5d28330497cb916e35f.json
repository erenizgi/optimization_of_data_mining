{
    "author": "jezdez",
    "message": "Fixed #16057 -- Extended deployment documentation with instructions for uWSGI. Thanks, jpic and aaugustin.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16413 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "aad6f21b29946bf4cc78d5d28330497cb916e35f",
    "files": [
        {
            "sha": "a2fd31257c234099a5da7606ab658ff5e173b917",
            "filename": "docs/howto/deployment/index.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Fhowto%2Fdeployment%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Fhowto%2Fdeployment%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Findex.txt?ref=aad6f21b29946bf4cc78d5d28330497cb916e35f",
            "patch": "@@ -10,16 +10,18 @@ ways to easily deploy Django:\n    :maxdepth: 1\n \n    modwsgi\n+   uwsgi\n    fastcgi\n    mod_python (deprecated) <modpython>\n \n If you're new to deploying Django and/or Python, we'd recommend you try\n-:doc:`mod_wsgi </howto/deployment/modwsgi>` first. In most cases it'll be the easiest,\n-fastest, and most stable deployment choice.\n+:doc:`mod_wsgi </howto/deployment/modwsgi>` first. In most cases it'll be\n+the easiest, fastest, and most stable deployment choice.\n \n .. seealso::\n \n-    * `Chapter 12 of The Django Book`_ discusses deployment and especially\n-      scaling in more detail.\n+    * `Chapter 12 of the Django Book`_ discusses deployment and especially\n+      scaling in more detail. However, it hasn't been updated since mod_python\n+      was deprecated.\n \n .. _chapter 12 of the django book: http://djangobook.com/en/2.0/chapter12/"
        },
        {
            "sha": "11cb51c544807f51553429c3afd1765b41dce165",
            "filename": "docs/howto/deployment/uwsgi.txt",
            "status": "added",
            "additions": 255,
            "deletions": 0,
            "changes": 255,
            "blob_url": "https://github.com/django/django/blob/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Fhowto%2Fdeployment%2Fuwsgi.txt",
            "raw_url": "https://github.com/django/django/raw/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Fhowto%2Fdeployment%2Fuwsgi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fuwsgi.txt?ref=aad6f21b29946bf4cc78d5d28330497cb916e35f",
            "patch": "@@ -0,0 +1,255 @@\n+============================\n+How to use Django with uWSGI\n+============================\n+\n+.. highlight:: bash\n+\n+uWSGI_ is a fast, self-healing and developer/sysadmin-friendly application\n+container server coded in pure C.\n+\n+It also provides a fast `caching framework`_ but its documentation is not the\n+purpose of this document.\n+\n+.. _uWSGI: http://projects.unbit.it/uwsgi/\n+.. _caching framework: http://projects.unbit.it/uwsgi/wiki/CachingFramework\n+\n+\n+Prerequisite: uWSGI\n+===================\n+\n+The wiki describes several `installation procedures`_. Using pip, the python\n+package manager, installing any uWSGI version can be done with one command\n+line. For example::\n+\n+    # install current stable version\n+    pip install uwsgi\n+\n+    # or install LTS (long term support)\n+    pip install http://projects.unbit.it/downloads/uwsgi-lts.tar.gz\n+\n+.. _installation procedures: http://projects0.unbit.it/uwsgi/wiki/Install\n+\n+Prerequisite: general concept\n+=============================\n+\n+uWSGI model\n+-----------\n+\n+uWSGI operates on a client-server model. Your Web server (ie. nginx, Apache)\n+communicates with a django-uwsgi \"worker\" process to serve dynamic contents.\n+The Web server can communicate with the uWSGI process either:\n+\n+* directly by the uWSGI protocol through a socket created by uWSGI,\n+* or by proxying HTTP requests to the minimalist HTTP server built in uWSGI.\n+\n+In the first case: the Web server can do uWSGI protocol (often with a\n+module). It can then use either a Unix domain socket (a \"named pipe\" on Win32\n+systems), or it can use a TCP socket. What you choose is a matterr of\n+preference. Usually, a TCP socket is easier because connecting to a port\n+doesn't require special permissions.\n+\n+In the second case, the Web server doesn't need to do uWSGI protocol. It just\n+needs to be able to proxy HTTP requests to the HTTP server built-in uWSGI.\n+The procedure is the same than proxying any HTTP server. Note that the Web\n+server is a \"reverse proxy\" in this case.\n+\n+Configuring the uWSGI server\n+----------------------------\n+\n+In any case, when you set up your Web server, you'll just need to point its\n+uwsgi or proxy module to the host/port or socket you specified when starting\n+the uWSGI server.\n+\n+.. admonition:: Choosing the socket\n+\n+    The easiest is to set the socket to a high level (>49152) local port like\n+    127.0.0.1:49152. If the socket is a file, the system administrator must\n+    ensure that the Web server process has read, write and execute privileges\n+    on that file.\n+\n+uWSGI is highly configurable and thus there are many ways to start the\n+process. For example, uwsgi version 0.9.6.8 provides a hundred switches.\n+This guide demonstrates the most important of them, but does not intent to\n+substitute the official manual and online documentation.\n+\n+uWSGI supports configuration through:\n+\n+* environment variables\n+* command line switches\n+* ldap\n+* ini files\n+* xml files\n+* yaml files\n+\n+Managing the uWSGI server\n+-------------------------\n+\n+The system administrator controls the worker process pool by sending signals\n+to the master process. For example, the unix kill command sends such signals.\n+uWSGI can write the master process id to a \"pidfile\". A \"pidfile\" is a plain\n+text file containing just a process id.\n+\n+Starting the server\n+-------------------\n+\n+Starting an uWSGI server is the role of the system administrator, like\n+starting the Web server. It is *not* the role of the Web server to start the\n+uWSGI server. This means:\n+\n+* the uWSGI server can be restarted or reloaded independently from the Web\n+  server,\n+* (except with Cheerokee), it is the role of the system administrator to make\n+  uWSGI to start on boot or reboot: either through tools like supervisor or\n+  daemontools, either directly at init level in a file like /etc/rc.local or\n+  /etc/conf.d/local\n+\n+Managing uWSGI\n+==============\n+\n+Starting the server\n+-------------------\n+\n+Example command line for a Web server that understand the uWSGI protocol::\n+\n+    uwsgi --chdir=/path/to/your/project\n+        --module='django.core.handlers.wsgi:WSGIHandler()' \\\n+        --env DJANGO_SETTINGS_MODULE=settings \\\n+        --master --pidfile=/tmp/project-master.pid \\\n+        --socket=127.0.0.1:49152 \\      # can also be a file\n+        --processes=5 \\                 # number of worker processes\n+        --uid=1000 --gid=2000 \\         # if root, uwsgi can drop privileges\n+        --harakiri=20 \\                 # respawn processes taking more than 20 seconds\n+        --limit-as=128 \\                # limit the project to 128 Megabytes\n+        --max-requests=5000 \\           # respawn processes after serving 5000 requests\n+        --vacuum \\                      # clear environment on exit\n+        --home=/path/to/virtual/env \\   # optionnal path to a virtualenv\n+        --daemonize=/var/log/uwsgi/yourproject.log      # background the process\n+\n+Django specific options are:\n+\n+* ``chdir``: should be the path to your project\n+* ``module``: uwsgi module to use\n+* ``pythonpath``: optional path to your project virtualenv\n+* ``env``: should contain at least ``DJANGO_SETTINGS_MODULE``\n+\n+Example ini configuration file::\n+\n+    [uwsgi]\n+    chdir=/path/to/your/project\n+    master=True\n+    pidfile=/tmp/project-master.pid\n+    vacuum=True\n+    max-requests=5000\n+    deamonize=/var/log/uwsgi/yourproject.log\n+\n+Example ini configuration file usage::\n+\n+    uwsgi --ini uwsgi.ini\n+\n+Read more `uWSGI configuration examples\n+<http://projects.unbit.it/uwsgi/wiki/Example>`_.\n+\n+.. admonition:: Massive application hosting\n+\n+    `uWSGI emperor <http://projects.unbit.it/uwsgi/wiki/Emperor>`_ is a special\n+    uWSGI process that can manage many master processes at once.\n+\n+Reloading the daemon\n+--------------------\n+\n+As mentioned above, the uWSGI master process is one of the core component of\n+the uWSGI stack. The signal to brutally reload all the workers and the master\n+process is SIGTERM. Example command to brutally reload the uWSGI processes::\n+\n+    kill -TERM `cat /tmp/project-master.pid`\n+\n+Patching the daemon\n+-------------------\n+\n+One of the great advantages of uWSGI is its ability to gradually restart each\n+worker without loosing any request.\n+\n+For example, uWSGI can be signaled that worker should reload the code after\n+handling their current request (if any) from bash::\n+\n+    # using kill to send the signal\n+    kill -HUP `cat /tmp/project-master.pid`\n+\n+    # if uwsgi was started with --touch-reload=/tmp/somefile\n+    touch /tmp/somefile\n+\n+Or from Python::\n+\n+    uwsgi.reload()\n+\n+Stopping the daemon\n+-------------------\n+\n+If you have the process running in the foreground, it's easy enough to stop it:\n+Simply hitting ``Ctrl-C`` will stop and quit the uWSGI server. However, when\n+you're dealing with background processes, you'll need to resort to the Unix\n+``kill`` command.\n+\n+The ``kill`` is used to send a signal to the uWSGI master process. The\n+`uWSGI signals are documented online\n+<http://projects.unbit.it/uwsgi/wiki/uWSGISignals>`_. Example command to\n+completely stop the uWSGI stack::\n+\n+    kill -INT `cat /tmp/project-master.pid`\n+\n+HTTP server configuration\n+=========================\n+\n+Nginx setup\n+-----------\n+\n+Nginx provides the `uwsgi module <http://wiki.nginx.org/HttpUwsgiModule>`_ by\n+default since nginx 0.8.40. Configuring Nginx to use an uWSGI server is as\n+simple as setting it up to proxy requests::\n+\n+    location / {\n+        uwsgi_pass 127.0.0.1:49152;\n+        # in case of a socket file:\n+        # uwsgi_pass unix:/tmp/yourproject.sock;\n+    }\n+\n+Note that default uwsgi parameters should be included somewhere in your Nginx\n+configuration. For example::\n+\n+    http {\n+        include       uwsgi_params;\n+        # [...] normal nginx configuration here\n+    }\n+\n+Cherokee setup\n+--------------\n+\n+Cherokee setup is documented in the `official Cherokee uWSGI documentation\n+<http://www.cherokee-project.com/doc/cookbook_uwsgi.html>`_.\n+\n+Lighttpd setup\n+--------------\n+\n+`Lighttpd uwsgi module <http://projects.unbit.it/uwsgi/wiki/RunOnLighttpd>`_ is\n+still experimental.\n+\n+Troubleshooting\n+===============\n+\n+As usual, the first things to do is to check the logs. This implies:\n+\n+* the web server log, which will indicate if it couldn't connect to the uWSGI\n+  process,\n+* the uWSGI log, which will indicate if an exception was thrown.\n+\n+Typical gotchas:\n+\n+* If the socket is a file, the Web server process should have read, write and\n+  execute permissions on the socket file. The ``--chmod-socket`` option can do\n+  it.\n+* In some cases, for instance if uWSGI was started without ``--vacuum`` or\n+  killed with ``SIGKILL``, it won't remove the socket and pidfile when it is\n+  interrupted. It is safe to remove them manually and to start uWSGI again in\n+  that case.\n+* uWSGI can start the process on the foreground, this will make errors easily\n+  visible to the system administrator."
        },
        {
            "sha": "0425da438e06a43b1342380bf56019053f15b07a",
            "filename": "docs/index.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Findex.txt?ref=aad6f21b29946bf4cc78d5d28330497cb916e35f",
            "patch": "@@ -155,7 +155,8 @@ The development process\n     * **Deployment:**\n       :doc:`Overview <howto/deployment/index>` |\n       :doc:`Apache/mod_wsgi <howto/deployment/modwsgi>` |\n-      :doc:`Apache/mod_python <howto/deployment/modpython>` |\n+      :doc:`uWSGI <howto/deployment/uwsgi>` |\n+      :doc:`Apache/mod_python (deprecated) <howto/deployment/modpython>` |\n       :doc:`FastCGI/SCGI/AJP <howto/deployment/fastcgi>` |\n       :doc:`Apache authentication <howto/apache-auth>` |\n       :doc:`Handling static files <howto/static-files>` |"
        },
        {
            "sha": "1058eb25698b40c00d5b88679144f1bb45eb1500",
            "filename": "docs/topics/install.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Ftopics%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/aad6f21b29946bf4cc78d5d28330497cb916e35f/docs%2Ftopics%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Finstall.txt?ref=aad6f21b29946bf4cc78d5d28330497cb916e35f",
            "patch": "@@ -28,11 +28,11 @@ Install Apache and mod_wsgi\n =============================\n \n If you just want to experiment with Django, skip ahead to the next\n-section; Django includes a lightweight Web server you can use for\n+section; Django includes a lightweight web server you can use for\n testing, so you won't need to set up Apache until you're ready to\n deploy Django in production.\n \n-If you want to use Django on a production site, use Apache with\n+If you want to use Django on a production site, use `Apache`_ with\n `mod_wsgi`_. mod_wsgi can operate in one of two modes: an embedded\n mode and a daemon mode. In embedded mode, mod_wsgi is similar to\n mod_perl -- it embeds Python within Apache and loads Python code into\n@@ -53,14 +53,16 @@ for information on how to configure mod_wsgi once you have it\n installed.\n \n If you can't use mod_wsgi for some reason, fear not: Django supports\n-many other deployment options. Another option is :doc:`FastCGI\n+many other deployment options. One is :doc:`uWSGI </howto/deployment/fastcgi>`;\n+it works very well with `nginx`_. Another is :doc:`FastCGI\n </howto/deployment/fastcgi>`, perfect for using Django with servers\n other than Apache. Additionally, Django follows the WSGI_ spec, which\n allows it to run on a variety of server platforms. See the\n `server-arrangements wiki page`_ for specific installation\n instructions for each platform.\n \n .. _Apache: http://httpd.apache.org/\n+.. _nginx: http://nginx.net/\n .. _mod_wsgi: http://code.google.com/p/modwsgi/\n .. _WSGI: http://www.python.org/dev/peps/pep-0333/\n .. _server-arrangements wiki page: http://code.djangoproject.com/wiki/ServerArrangements"
        }
    ],
    "stats": {
        "total": 276,
        "additions": 268,
        "deletions": 8
    }
}