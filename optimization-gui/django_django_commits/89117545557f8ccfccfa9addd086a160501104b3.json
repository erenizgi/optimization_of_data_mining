{
    "author": "freakboy3742",
    "message": "Deprecated the psycopg-based postgresql database backend.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15980 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "89117545557f8ccfccfa9addd086a160501104b3",
    "files": [
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/db/backends/postgresql/__init__.py",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fpostgresql%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fpostgresql%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql%2F__init__.py?ref=f9972bcf8675d26291f09c7acbc9da2f5f1a2327"
        },
        {
            "sha": "f3ac451a15f6277efeadca9b199fae8be97b3bf8",
            "filename": "django/db/backends/postgresql/base.py",
            "status": "removed",
            "additions": 0,
            "deletions": 183,
            "changes": 183,
            "blob_url": "https://github.com/django/django/blob/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fpostgresql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fpostgresql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql%2Fbase.py?ref=f9972bcf8675d26291f09c7acbc9da2f5f1a2327",
            "patch": "@@ -1,183 +0,0 @@\n-\"\"\"\n-PostgreSQL database backend for Django.\n-\n-Requires psycopg 1: http://initd.org/projects/psycopg1\n-\"\"\"\n-\n-import sys\n-\n-from django.db import utils\n-from django.db.backends import *\n-from django.db.backends.signals import connection_created\n-from django.db.backends.postgresql.client import DatabaseClient\n-from django.db.backends.postgresql.creation import DatabaseCreation\n-from django.db.backends.postgresql.introspection import DatabaseIntrospection\n-from django.db.backends.postgresql.operations import DatabaseOperations\n-from django.db.backends.postgresql.version import get_version\n-from django.utils.encoding import smart_str, smart_unicode\n-\n-try:\n-    import psycopg as Database\n-except ImportError, e:\n-    from django.core.exceptions import ImproperlyConfigured\n-    raise ImproperlyConfigured(\"Error loading psycopg module: %s\" % e)\n-\n-DatabaseError = Database.DatabaseError\n-IntegrityError = Database.IntegrityError\n-\n-class UnicodeCursorWrapper(object):\n-    \"\"\"\n-    A thin wrapper around psycopg cursors that allows them to accept Unicode\n-    strings as params.\n-\n-    This is necessary because psycopg doesn't apply any DB quoting to\n-    parameters that are Unicode strings. If a param is Unicode, this will\n-    convert it to a bytestring using database client's encoding before passing\n-    it to psycopg.\n-\n-    All results retrieved from the database are converted into Unicode strings\n-    before being returned to the caller.\n-    \"\"\"\n-    def __init__(self, cursor, charset):\n-        self.cursor = cursor\n-        self.charset = charset\n-\n-    def format_params(self, params):\n-        if isinstance(params, dict):\n-            result = {}\n-            charset = self.charset\n-            for key, value in params.items():\n-                result[smart_str(key, charset)] = smart_str(value, charset)\n-            return result\n-        else:\n-            return tuple([smart_str(p, self.charset, True) for p in params])\n-\n-    def execute(self, sql, params=()):\n-        try:\n-            return self.cursor.execute(smart_str(sql, self.charset), self.format_params(params))\n-        except Database.IntegrityError, e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-        except Database.DatabaseError, e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n-\n-    def executemany(self, sql, param_list):\n-        try:\n-            new_param_list = [self.format_params(params) for params in param_list]\n-            return self.cursor.executemany(sql, new_param_list)\n-        except Database.IntegrityError, e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-        except Database.DatabaseError, e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n-\n-    def __getattr__(self, attr):\n-        if attr in self.__dict__:\n-            return self.__dict__[attr]\n-        else:\n-            return getattr(self.cursor, attr)\n-\n-    def __iter__(self):\n-        return iter(self.cursor.fetchall())\n-\n-class DatabaseFeatures(BaseDatabaseFeatures):\n-    uses_savepoints = True\n-    requires_rollback_on_dirty_transaction = True\n-    has_real_datatype = True\n-    can_defer_constraint_checks = True\n-\n-class DatabaseWrapper(BaseDatabaseWrapper):\n-    vendor = 'postgresql'\n-    operators = {\n-        'exact': '= %s',\n-        'iexact': '= UPPER(%s)',\n-        'contains': 'LIKE %s',\n-        'icontains': 'LIKE UPPER(%s)',\n-        'regex': '~ %s',\n-        'iregex': '~* %s',\n-        'gt': '> %s',\n-        'gte': '>= %s',\n-        'lt': '< %s',\n-        'lte': '<= %s',\n-        'startswith': 'LIKE %s',\n-        'endswith': 'LIKE %s',\n-        'istartswith': 'LIKE UPPER(%s)',\n-        'iendswith': 'LIKE UPPER(%s)',\n-    }\n-\n-    def __init__(self, *args, **kwargs):\n-        super(DatabaseWrapper, self).__init__(*args, **kwargs)\n-\n-        import warnings\n-        warnings.warn(\n-            'The \"postgresql\" backend has been deprecated. Use \"postgresql_psycopg2\" instead.',\n-            DeprecationWarning\n-        )\n-\n-        self.features = DatabaseFeatures(self)\n-        self.ops = DatabaseOperations(self)\n-        self.client = DatabaseClient(self)\n-        self.creation = DatabaseCreation(self)\n-        self.introspection = DatabaseIntrospection(self)\n-        self.validation = BaseDatabaseValidation(self)\n-\n-    def _cursor(self):\n-        new_connection = False\n-        set_tz = False\n-        settings_dict = self.settings_dict\n-        if self.connection is None:\n-            new_connection = True\n-            set_tz = settings_dict.get('TIME_ZONE')\n-            if settings_dict['NAME'] == '':\n-                from django.core.exceptions import ImproperlyConfigured\n-                raise ImproperlyConfigured(\"You need to specify NAME in your Django settings file.\")\n-            conn_string = \"dbname=%s\" % settings_dict['NAME']\n-            if settings_dict['USER']:\n-                conn_string = \"user=%s %s\" % (settings_dict['USER'], conn_string)\n-            if settings_dict['PASSWORD']:\n-                conn_string += \" password='%s'\" % settings_dict['PASSWORD']\n-            if settings_dict['HOST']:\n-                conn_string += \" host=%s\" % settings_dict['HOST']\n-            if settings_dict['PORT']:\n-                conn_string += \" port=%s\" % settings_dict['PORT']\n-            self.connection = Database.connect(conn_string, **settings_dict['OPTIONS'])\n-            # make transactions transparent to all cursors\n-            self.connection.set_isolation_level(1)\n-            connection_created.send(sender=self.__class__, connection=self)\n-        cursor = self.connection.cursor()\n-        if new_connection:\n-            if set_tz:\n-                cursor.execute(\"SET TIME ZONE %s\", [settings_dict['TIME_ZONE']])\n-            if not hasattr(self, '_version'):\n-                self.__class__._version = get_version(cursor)\n-            if self._version[0:2] < (8, 0):\n-                # No savepoint support for earlier version of PostgreSQL.\n-                self.features.uses_savepoints = False\n-            cursor.execute(\"SET client_encoding to 'UNICODE'\")\n-        return UnicodeCursorWrapper(cursor, 'utf-8')\n-\n-    def _commit(self):\n-        if self.connection is not None:\n-            try:\n-                return self.connection.commit()\n-            except Database.IntegrityError, e:\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-\n-def typecast_string(s):\n-    \"\"\"\n-    Cast all returned strings to unicode strings.\n-    \"\"\"\n-    if not s and not isinstance(s, str):\n-        return s\n-    return smart_unicode(s)\n-\n-# Register these custom typecasts, because Django expects dates/times to be\n-# in Python's native (standard-library) datetime/time format, whereas psycopg\n-# use mx.DateTime by default.\n-try:\n-    Database.register_type(Database.new_type((1082,), \"DATE\", util.typecast_date))\n-except AttributeError:\n-    raise Exception(\"You appear to be using psycopg version 2. Set your DATABASES.ENGINE to 'postgresql_psycopg2' instead of 'postgresql'.\")\n-Database.register_type(Database.new_type((1083,1266), \"TIME\", util.typecast_time))\n-Database.register_type(Database.new_type((1114,1184), \"TIMESTAMP\", util.typecast_timestamp))\n-Database.register_type(Database.new_type((16,), \"BOOLEAN\", util.typecast_boolean))\n-Database.register_type(Database.new_type((1700,), \"NUMERIC\", util.typecast_decimal))\n-Database.register_type(Database.new_type(Database.types[1043].values, 'STRING', typecast_string))"
        },
        {
            "sha": "534bf41d4616a70471de35b31443078b3c631c18",
            "filename": "django/db/backends/postgresql/introspection.py",
            "status": "removed",
            "additions": 0,
            "deletions": 88,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fpostgresql%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/f9972bcf8675d26291f09c7acbc9da2f5f1a2327/django%2Fdb%2Fbackends%2Fpostgresql%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql%2Fintrospection.py?ref=f9972bcf8675d26291f09c7acbc9da2f5f1a2327",
            "patch": "@@ -1,88 +0,0 @@\n-from django.db.backends import BaseDatabaseIntrospection\n-\n-class DatabaseIntrospection(BaseDatabaseIntrospection):\n-    # Maps type codes to Django Field types.\n-    data_types_reverse = {\n-        16: 'BooleanField',\n-        20: 'BigIntegerField',\n-        21: 'SmallIntegerField',\n-        23: 'IntegerField',\n-        25: 'TextField',\n-        700: 'FloatField',\n-        701: 'FloatField',\n-        869: 'IPAddressField',\n-        1043: 'CharField',\n-        1082: 'DateField',\n-        1083: 'TimeField',\n-        1114: 'DateTimeField',\n-        1184: 'DateTimeField',\n-        1266: 'TimeField',\n-        1700: 'DecimalField',\n-    }\n-        \n-    def get_table_list(self, cursor):\n-        \"Returns a list of table names in the current database.\"\n-        cursor.execute(\"\"\"\n-            SELECT c.relname\n-            FROM pg_catalog.pg_class c\n-            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n-            WHERE c.relkind IN ('r', 'v', '')\n-                AND n.nspname NOT IN ('pg_catalog', 'pg_toast')\n-                AND pg_catalog.pg_table_is_visible(c.oid)\"\"\")\n-        return [row[0] for row in cursor.fetchall()]\n-\n-    def get_table_description(self, cursor, table_name):\n-        \"Returns a description of the table, with the DB-API cursor.description interface.\"\n-        cursor.execute(\"SELECT * FROM %s LIMIT 1\" % self.connection.ops.quote_name(table_name))\n-        return cursor.description\n-\n-    def get_relations(self, cursor, table_name):\n-        \"\"\"\n-        Returns a dictionary of {field_index: (field_index_other_table, other_table)}\n-        representing all relationships to the given table. Indexes are 0-based.\n-        \"\"\"\n-        cursor.execute(\"\"\"\n-            SELECT con.conkey, con.confkey, c2.relname\n-            FROM pg_constraint con, pg_class c1, pg_class c2\n-            WHERE c1.oid = con.conrelid\n-                AND c2.oid = con.confrelid\n-                AND c1.relname = %s\n-                AND con.contype = 'f'\"\"\", [table_name])\n-        relations = {}\n-        for row in cursor.fetchall():\n-            try:\n-                # row[0] and row[1] are like \"{2}\", so strip the curly braces.\n-                relations[int(row[0][1:-1]) - 1] = (int(row[1][1:-1]) - 1, row[2])\n-            except ValueError:\n-                continue\n-        return relations\n-\n-    def get_indexes(self, cursor, table_name):\n-        \"\"\"\n-        Returns a dictionary of fieldname -> infodict for the given table,\n-        where each infodict is in the format:\n-            {'primary_key': boolean representing whether it's the primary key,\n-             'unique': boolean representing whether it's a unique index}\n-        \"\"\"\n-        # This query retrieves each index on the given table, including the\n-        # first associated field name\n-        cursor.execute(\"\"\"\n-            SELECT attr.attname, idx.indkey, idx.indisunique, idx.indisprimary\n-            FROM pg_catalog.pg_class c, pg_catalog.pg_class c2,\n-                pg_catalog.pg_index idx, pg_catalog.pg_attribute attr\n-            WHERE c.oid = idx.indrelid\n-                AND idx.indexrelid = c2.oid\n-                AND attr.attrelid = c.oid\n-                AND attr.attnum = idx.indkey[0]\n-                AND c.relname = %s\"\"\", [table_name])\n-        indexes = {}\n-        for row in cursor.fetchall():\n-            # row[1] (idx.indkey) is stored in the DB as an array. It comes out as\n-            # a string of space-separated integers. This designates the field\n-            # indexes (1-based) of the fields that have indexes on the table.\n-            # Here, we skip any indexes across multiple fields.\n-            if ' ' in row[1]:\n-                continue\n-            indexes[row[0]] = {'primary_key': row[3], 'unique': row[2]}\n-        return indexes\n-"
        },
        {
            "sha": "e0990a1089a2bcba94af99d1845533451bac8027",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 14,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=89117545557f8ccfccfa9addd086a160501104b3",
            "patch": "@@ -9,10 +9,10 @@\n from django.db import utils\n from django.db.backends import *\n from django.db.backends.signals import connection_created\n-from django.db.backends.postgresql.operations import DatabaseOperations as PostgresqlDatabaseOperations\n-from django.db.backends.postgresql.client import DatabaseClient\n-from django.db.backends.postgresql.creation import DatabaseCreation\n-from django.db.backends.postgresql.version import get_version\n+from django.db.backends.postgresql_psycopg2.operations import DatabaseOperations\n+from django.db.backends.postgresql_psycopg2.client import DatabaseClient\n+from django.db.backends.postgresql_psycopg2.creation import DatabaseCreation\n+from django.db.backends.postgresql_psycopg2.version import get_version\n from django.db.backends.postgresql_psycopg2.introspection import DatabaseIntrospection\n from django.utils.safestring import SafeUnicode, SafeString\n \n@@ -71,16 +71,6 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     has_real_datatype = True\n     can_defer_constraint_checks = True\n \n-class DatabaseOperations(PostgresqlDatabaseOperations):\n-    def last_executed_query(self, cursor, sql, params):\n-        # With psycopg2, cursor objects have a \"query\" attribute that is the\n-        # exact query sent to the database. See docs here:\n-        # http://www.initd.org/tracker/psycopg/wiki/psycopg2_documentation#postgresql-status-message-and-executed-query\n-        return cursor.query\n-\n-    def return_insert_id(self):\n-        return \"RETURNING %s\", ()\n-\n class DatabaseWrapper(BaseDatabaseWrapper):\n     vendor = 'postgresql'\n     operators = {"
        },
        {
            "sha": "a5c02969ea8b33af49d351e879b4625ab0a75285",
            "filename": "django/db/backends/postgresql_psycopg2/client.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fclient.py?ref=89117545557f8ccfccfa9addd086a160501104b3",
            "previous_filename": "django/db/backends/postgresql/client.py"
        },
        {
            "sha": "5d4d50b5cf6cf032728b6fda75bcc8f2465c2ace",
            "filename": "django/db/backends/postgresql_psycopg2/creation.py",
            "status": "renamed",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fcreation.py?ref=89117545557f8ccfccfa9addd086a160501104b3",
            "patch": "@@ -1,6 +1,7 @@\n from django.db.backends.creation import BaseDatabaseCreation\n from django.db.backends.util import truncate_name\n \n+\n class DatabaseCreation(BaseDatabaseCreation):\n     # This dictionary maps Field objects to their associated PostgreSQL column\n     # types, as strings. Column-type strings can contain format strings; they'll",
            "previous_filename": "django/db/backends/postgresql/creation.py"
        },
        {
            "sha": "9f2c81dee5a4a2244bf004bf4e63c055e8344dbb",
            "filename": "django/db/backends/postgresql_psycopg2/introspection.py",
            "status": "modified",
            "additions": 66,
            "deletions": 2,
            "changes": 68,
            "blob_url": "https://github.com/django/django/blob/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fintrospection.py?ref=89117545557f8ccfccfa9addd086a160501104b3",
            "patch": "@@ -1,6 +1,41 @@\n-from django.db.backends.postgresql.introspection import DatabaseIntrospection as PostgresDatabaseIntrospection\n+from django.db.backends import BaseDatabaseIntrospection\n \n-class DatabaseIntrospection(PostgresDatabaseIntrospection):\n+\n+class DatabaseIntrospection(BaseDatabaseIntrospection):\n+    # Maps type codes to Django Field types.\n+    data_types_reverse = {\n+        16: 'BooleanField',\n+        20: 'BigIntegerField',\n+        21: 'SmallIntegerField',\n+        23: 'IntegerField',\n+        25: 'TextField',\n+        700: 'FloatField',\n+        701: 'FloatField',\n+        869: 'IPAddressField',\n+        1043: 'CharField',\n+        1082: 'DateField',\n+        1083: 'TimeField',\n+        1114: 'DateTimeField',\n+        1184: 'DateTimeField',\n+        1266: 'TimeField',\n+        1700: 'DecimalField',\n+    }\n+        \n+    def get_table_list(self, cursor):\n+        \"Returns a list of table names in the current database.\"\n+        cursor.execute(\"\"\"\n+            SELECT c.relname\n+            FROM pg_catalog.pg_class c\n+            LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace\n+            WHERE c.relkind IN ('r', 'v', '')\n+                AND n.nspname NOT IN ('pg_catalog', 'pg_toast')\n+                AND pg_catalog.pg_table_is_visible(c.oid)\"\"\")\n+        return [row[0] for row in cursor.fetchall()]\n+\n+    def get_table_description(self, cursor, table_name):\n+        \"Returns a description of the table, with the DB-API cursor.description interface.\"\n+        cursor.execute(\"SELECT * FROM %s LIMIT 1\" % self.connection.ops.quote_name(table_name))\n+        return cursor.description\n \n     def get_relations(self, cursor, table_name):\n         \"\"\"\n@@ -19,3 +54,32 @@ def get_relations(self, cursor, table_name):\n             # row[0] and row[1] are single-item lists, so grab the single item.\n             relations[row[0][0] - 1] = (row[1][0] - 1, row[2])\n         return relations\n+\n+    def get_indexes(self, cursor, table_name):\n+        \"\"\"\n+        Returns a dictionary of fieldname -> infodict for the given table,\n+        where each infodict is in the format:\n+            {'primary_key': boolean representing whether it's the primary key,\n+             'unique': boolean representing whether it's a unique index}\n+        \"\"\"\n+        # This query retrieves each index on the given table, including the\n+        # first associated field name\n+        cursor.execute(\"\"\"\n+            SELECT attr.attname, idx.indkey, idx.indisunique, idx.indisprimary\n+            FROM pg_catalog.pg_class c, pg_catalog.pg_class c2,\n+                pg_catalog.pg_index idx, pg_catalog.pg_attribute attr\n+            WHERE c.oid = idx.indrelid\n+                AND idx.indexrelid = c2.oid\n+                AND attr.attrelid = c.oid\n+                AND attr.attnum = idx.indkey[0]\n+                AND c.relname = %s\"\"\", [table_name])\n+        indexes = {}\n+        for row in cursor.fetchall():\n+            # row[1] (idx.indkey) is stored in the DB as an array. It comes out as\n+            # a string of space-separated integers. This designates the field\n+            # indexes (1-based) of the fields that have indexes on the table.\n+            # Here, we skip any indexes across multiple fields.\n+            if ' ' in row[1]:\n+                continue\n+            indexes[row[0]] = {'primary_key': row[3], 'unique': row[2]}\n+        return indexes"
        },
        {
            "sha": "537fa4598163ca9a401f0dc3e7a8003a748c3c6b",
            "filename": "django/db/backends/postgresql_psycopg2/operations.py",
            "status": "renamed",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py?ref=89117545557f8ccfccfa9addd086a160501104b3",
            "patch": "@@ -2,8 +2,6 @@\n \n from django.db.backends import BaseDatabaseOperations\n \n-# This DatabaseOperations class lives in here instead of base.py because it's\n-# used by both the 'postgresql' and 'postgresql_psycopg2' backends.\n \n class DatabaseOperations(BaseDatabaseOperations):\n     def __init__(self, connection):\n@@ -13,7 +11,7 @@ def __init__(self, connection):\n \n     def _get_postgres_version(self):\n         if self._postgres_version is None:\n-            from django.db.backends.postgresql.version import get_version\n+            from django.db.backends.postgresql_psycopg2.version import get_version\n             cursor = self.connection.cursor()\n             self._postgres_version = get_version(cursor)\n         return self._postgres_version\n@@ -203,3 +201,12 @@ def max_name_length(self):\n         \"\"\"\n \n         return 63\n+\n+    def last_executed_query(self, cursor, sql, params):\n+        # With psycopg2, cursor objects have a \"query\" attribute that is the\n+        # exact query sent to the database. See docs here:\n+        # http://www.initd.org/tracker/psycopg/wiki/psycopg2_documentation#postgresql-status-message-and-executed-query\n+        return cursor.query\n+\n+    def return_insert_id(self):\n+        return \"RETURNING %s\", ()",
            "previous_filename": "django/db/backends/postgresql/operations.py"
        },
        {
            "sha": "b9298296eab92dca116b43eee836220e7a220f23",
            "filename": "django/db/backends/postgresql_psycopg2/version.py",
            "status": "renamed",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fversion.py",
            "raw_url": "https://github.com/django/django/raw/89117545557f8ccfccfa9addd086a160501104b3/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fversion.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fversion.py?ref=89117545557f8ccfccfa9addd086a160501104b3",
            "patch": "@@ -12,6 +12,7 @@\n #   PostgreSQL 8.4beta1\n VERSION_RE = re.compile(r'\\S+ (\\d+)\\.(\\d+)\\.?(\\d+)?')\n \n+\n def _parse_version(text):\n     \"Internal parsing method. Factored out for testing purposes.\"\n     major, major2, minor = VERSION_RE.search(text).groups()",
            "previous_filename": "django/db/backends/postgresql/version.py"
        }
    ],
    "stats": {
        "total": 372,
        "additions": 82,
        "deletions": 290
    }
}