{
    "author": "alex",
    "message": "Fixed #14870 -- don't catch AttributeErrors in database router methods, instead check that the method itself exists.  Thanks to jonash for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14857 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2a463231248df5eacaf0d88af45d7bc4f462a88e",
    "files": [
        {
            "sha": "4377f3cdbe0b5b22d8cc2d4eac0026f238d241c5",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/2a463231248df5eacaf0d88af45d7bc4f462a88e/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/2a463231248df5eacaf0d88af45d7bc4f462a88e/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=2a463231248df5eacaf0d88af45d7bc4f462a88e",
            "patch": "@@ -5,6 +5,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n \n+\n DEFAULT_DB_ALIAS = 'default'\n \n # Define some exceptions that mirror the PEP249 interface.\n@@ -125,12 +126,15 @@ def _route_db(self, model, **hints):\n             chosen_db = None\n             for router in self.routers:\n                 try:\n-                    chosen_db = getattr(router, action)(model, **hints)\n-                    if chosen_db:\n-                        return chosen_db\n+                    method = getattr(router, action)\n                 except AttributeError:\n                     # If the router doesn't have a method, skip to the next one.\n                     pass\n+                else:\n+                    chosen_db = method(model, **hints\n+                    )\n+                    if chosen_db:\n+                        return chosen_db\n             try:\n                 return hints['instance']._state.db or DEFAULT_DB_ALIAS\n             except KeyError:\n@@ -143,21 +147,25 @@ def _route_db(self, model, **hints):\n     def allow_relation(self, obj1, obj2, **hints):\n         for router in self.routers:\n             try:\n-                allow = router.allow_relation(obj1, obj2, **hints)\n-                if allow is not None:\n-                    return allow\n+                method = router.allow_relation\n             except AttributeError:\n                 # If the router doesn't have a method, skip to the next one.\n                 pass\n+            else:\n+                allow = method(obj1, obj2, **hints)\n+                if allow is not None:\n+                    return allow\n         return obj1._state.db == obj2._state.db\n \n     def allow_syncdb(self, db, model):\n         for router in self.routers:\n             try:\n-                allow = router.allow_syncdb(db, model)\n-                if allow is not None:\n-                    return allow\n+                method = router.allow_syncdb\n             except AttributeError:\n                 # If the router doesn't have a method, skip to the next one.\n                 pass\n+            else:\n+                allow = method(db, model)\n+                if allow is not None:\n+                    return allow\n         return True"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 17,
        "deletions": 9
    }
}