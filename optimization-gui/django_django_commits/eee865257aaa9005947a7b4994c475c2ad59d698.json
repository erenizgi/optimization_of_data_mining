{
    "author": "ramiro",
    "message": "Fixed #17008 -- Added makemessages option to not remove .pot files.\n\nThanks airstrike for the report and initial patch, Julien for an\nenhanced patch and Jannis for reviewing.",
    "sha": "eee865257aaa9005947a7b4994c475c2ad59d698",
    "files": [
        {
            "sha": "449d3d7c5a6e563d269bd99301dd1fb6106511a7",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 21,
            "deletions": 12,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/eee865257aaa9005947a7b4994c475c2ad59d698/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/eee865257aaa9005947a7b4994c475c2ad59d698/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=eee865257aaa9005947a7b4994c475c2ad59d698",
            "patch": "@@ -126,7 +126,7 @@ def write_pot_file(potfile, msgs, file, work_file, is_templatized):\n         fp.write(msgs)\n \n def process_file(file, dirpath, potfile, domain, verbosity,\n-                 extensions, wrap, location, stdout=sys.stdout):\n+                 extensions, wrap, location, keep_pot, stdout=sys.stdout):\n     \"\"\"\n     Extract translatable literals from :param file: for :param domain:\n     creating or updating the :param potfile: POT file.\n@@ -183,7 +183,7 @@ def process_file(file, dirpath, potfile, domain, verbosity,\n         if status != STATUS_OK:\n             if is_templatized:\n                 os.unlink(work_file)\n-            if os.path.exists(potfile):\n+            if not keep_pot and os.path.exists(potfile):\n                 os.unlink(potfile)\n             raise CommandError(\n                 \"errors happened while running xgettext on %s\\n%s\" %\n@@ -197,7 +197,7 @@ def process_file(file, dirpath, potfile, domain, verbosity,\n         os.unlink(work_file)\n \n def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n-                  copy_pforms, wrap, location, no_obsolete):\n+                  copy_pforms, wrap, location, no_obsolete, keep_pot):\n     \"\"\"\n     Creates of updates the :param pofile: PO file for :param domain: and :param\n     locale:.  Uses contents of the existing :param potfile:.\n@@ -208,7 +208,8 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n                                     (wrap, location, potfile))\n     if errors:\n         if status != STATUS_OK:\n-            os.unlink(potfile)\n+            if not keep_pot:\n+                os.unlink(potfile)\n             raise CommandError(\n                 \"errors happened while running msguniq\\n%s\" % errors)\n         elif verbosity > 0:\n@@ -221,7 +222,8 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n                                         (wrap, location, pofile, potfile))\n         if errors:\n             if status != STATUS_OK:\n-                os.unlink(potfile)\n+                if not keep_pot:\n+                    os.unlink(potfile)\n                 raise CommandError(\n                     \"errors happened while running msgmerge\\n%s\" % errors)\n             elif verbosity > 0:\n@@ -232,7 +234,8 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n         \"#. #-#-#-#-#  %s.pot (PACKAGE VERSION)  #-#-#-#-#\\n\" % domain, \"\")\n     with open(pofile, 'w') as fp:\n         fp.write(msgs)\n-    os.unlink(potfile)\n+    if not keep_pot:\n+        os.unlink(potfile)\n     if no_obsolete:\n         msgs, errors, status = _popen(\n             'msgattrib %s %s -o \"%s\" --no-obsolete \"%s\"' %\n@@ -246,7 +249,7 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n \n def make_messages(locale=None, domain='django', verbosity=1, all=False,\n         extensions=None, symlinks=False, ignore_patterns=None, no_wrap=False,\n-        no_location=False, no_obsolete=False, stdout=sys.stdout):\n+        no_location=False, no_obsolete=False, stdout=sys.stdout, keep_pot=False):\n     \"\"\"\n     Uses the ``locale/`` directory from the Django Git tree or an\n     application/project to process all files with translatable literals for\n@@ -280,10 +283,12 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n                 \"if you want to enable i18n for your project or application.\")\n \n     if domain not in ('django', 'djangojs'):\n-        raise CommandError(\"currently makemessages only supports domains 'django' and 'djangojs'\")\n+        raise CommandError(\"currently makemessages only supports domains \"\n+                           \"'django' and 'djangojs'\")\n \n     if (locale is None and not all) or domain is None:\n-        message = \"Type '%s help %s' for usage information.\" % (os.path.basename(sys.argv[0]), sys.argv[1])\n+        message = \"Type '%s help %s' for usage information.\" % (\n+                  os.path.basename(sys.argv[0]), sys.argv[1])\n         raise CommandError(message)\n \n     # We require gettext version 0.15 or newer.\n@@ -325,11 +330,11 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n         for dirpath, file in find_files(\".\", ignore_patterns, verbosity,\n                 stdout, symlinks=symlinks):\n             process_file(file, dirpath, potfile, domain, verbosity, extensions,\n-                    wrap, location, stdout)\n+                    wrap, location, keep_pot, stdout)\n \n         if os.path.exists(potfile):\n             write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n-                    not invoked_for_django, wrap, location, no_obsolete)\n+                    not invoked_for_django, wrap, location, no_obsolete, keep_pot)\n \n \n class Command(NoArgsCommand):\n@@ -355,6 +360,8 @@ class Command(NoArgsCommand):\n             default=False, help=\"Don't write '#: filename:line' lines\"),\n         make_option('--no-obsolete', action='store_true', dest='no_obsolete',\n             default=False, help=\"Remove obsolete message strings\"),\n+        make_option('--keep-pot', action='store_true', dest='keep_pot',\n+            default=False, help=\"Keep .pot file after making messages. Useful when debugging.\"),\n     )\n     help = (\"Runs over the entire source tree of the current directory and \"\n \"pulls out all strings marked for translation. It creates (or updates) a message \"\n@@ -379,6 +386,7 @@ def handle_noargs(self, *args, **options):\n         no_wrap = options.get('no_wrap')\n         no_location = options.get('no_location')\n         no_obsolete = options.get('no_obsolete')\n+        keep_pot = options.get('keep_pot')\n         if domain == 'djangojs':\n             exts = extensions if extensions else ['js']\n         else:\n@@ -390,4 +398,5 @@ def handle_noargs(self, *args, **options):\n                              % get_text_list(list(extensions), 'and'))\n \n         make_messages(locale, domain, verbosity, process_all, extensions,\n-            symlinks, ignore_patterns, no_wrap, no_location, no_obsolete, self.stdout)\n+                      symlinks, ignore_patterns, no_wrap, no_location,\n+                      no_obsolete, self.stdout, keep_pot)"
        },
        {
            "sha": "3c73e268e2d8507d08021f8b6963f45f5f490371",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/eee865257aaa9005947a7b4994c475c2ad59d698/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/eee865257aaa9005947a7b4994c475c2ad59d698/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=eee865257aaa9005947a7b4994c475c2ad59d698",
            "patch": "@@ -472,6 +472,14 @@ Use the ``--no-location`` option to not write '``#: filename:line``'\n comment lines in language files. Note that using this option makes it harder\n for technically skilled translators to understand each message's context.\n \n+.. django-admin-option:: --keep-pot\n+\n+.. versionadded:: 1.6\n+\n+Use the ``--keep-pot`` option to prevent django from deleting the temporary\n+.pot file it generates before creating the .po file. This is useful for\n+debugging errors which may prevent the final language files from being created.\n+\n runfcgi [options]\n -----------------\n "
        },
        {
            "sha": "bd2b84a95209c378e1fd6556858c2a1c595665a8",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/eee865257aaa9005947a7b4994c475c2ad59d698/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/eee865257aaa9005947a7b4994c475c2ad59d698/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=eee865257aaa9005947a7b4994c475c2ad59d698",
            "patch": "@@ -293,3 +293,36 @@ def test_no_location_disabled(self):\n         with open(self.PO_FILE, 'r') as fp:\n             po_contents = force_text(fp.read())\n             self.assertTrue('#: templates/test.html:55' in po_contents)\n+\n+\n+class KeepPotFileExtractorTests(ExtractorTests):\n+\n+    def setUp(self):\n+        self.POT_FILE = self.PO_FILE + 't'\n+        super(KeepPotFileExtractorTests, self).setUp()\n+\n+    def tearDown(self):\n+        super(KeepPotFileExtractorTests, self).tearDown()\n+        os.chdir(self.test_dir)\n+        try:\n+            os.unlink(self.POT_FILE)\n+        except OSError:\n+            pass\n+        os.chdir(self._cwd)\n+\n+    def test_keep_pot_disabled_by_default(self):\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0)\n+        self.assertFalse(os.path.exists(self.POT_FILE))\n+\n+    def test_keep_pot_explicitly_disabled(self):\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0,\n+                                keep_pot=False)\n+        self.assertFalse(os.path.exists(self.POT_FILE))\n+\n+    def test_keep_pot_enabled(self):\n+        os.chdir(self.test_dir)\n+        management.call_command('makemessages', locale=LOCALE, verbosity=0,\n+                                keep_pot=True)\n+        self.assertTrue(os.path.exists(self.POT_FILE))"
        },
        {
            "sha": "5d789b4acb3fa71de3e602be7a31d6733500b1bb",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/eee865257aaa9005947a7b4994c475c2ad59d698/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eee865257aaa9005947a7b4994c475c2ad59d698/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=eee865257aaa9005947a7b4994c475c2ad59d698",
            "patch": "@@ -32,7 +32,7 @@\n     from .commands.extraction import (ExtractorTests, BasicExtractorTests,\n         JavascriptExtractorTests, IgnoredExtractorTests, SymlinkExtractorTests,\n         CopyPluralFormsExtractorTests, NoWrapExtractorTests,\n-        NoLocationExtractorTests)\n+        NoLocationExtractorTests, KeepPotFileExtractorTests)\n if can_run_compilation_tests:\n     from .commands.compilation import (PoFileTests, PoFileContentsTests,\n         PercentRenderingTests)"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 63,
        "deletions": 13
    }
}