{
    "author": "jezdez",
    "message": "Fixed #17286 -- Made sure all cache backends are set up to connect to the signal handler that closes the cache connection when the request has been processed. Thanks, gnosek.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17479 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c609b792f74948bc4e485ebfcb456ef1b6f8ce0a",
    "files": [
        {
            "sha": "346deae916215f8ac6fa26ae9e8daa35aa7583c7",
            "filename": "django/core/cache/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/c609b792f74948bc4e485ebfcb456ef1b6f8ce0a/django%2Fcore%2Fcache%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/c609b792f74948bc4e485ebfcb456ef1b6f8ce0a/django%2Fcore%2Fcache%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2F__init__.py?ref=c609b792f74948bc4e485ebfcb456ef1b6f8ce0a",
            "patch": "@@ -176,12 +176,13 @@ def get_cache(backend, **kwargs):\n     except (AttributeError, ImportError), e:\n         raise InvalidCacheBackendError(\n             \"Could not find backend '%s': %s\" % (backend, e))\n-    return backend_cls(location, params)\n+    cache = backend_cls(location, params)\n+    # Some caches -- python-memcached in particular -- need to do a cleanup at the\n+    # end of a request cycle. If the cache provides a close() method, wire it up\n+    # here.\n+    if hasattr(cache, 'close'):\n+        signals.request_finished.connect(cache.close)\n+    return cache\n \n cache = get_cache(DEFAULT_CACHE_ALIAS)\n \n-# Some caches -- python-memcached in particular -- need to do a cleanup at the\n-# end of a request cycle. If the cache provides a close() method, wire it up\n-# here.\n-if hasattr(cache, 'close'):\n-    signals.request_finished.connect(cache.close)"
        },
        {
            "sha": "bd29cde5330065cfaa945b56a5ea96c3c3467c10",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/c609b792f74948bc4e485ebfcb456ef1b6f8ce0a/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c609b792f74948bc4e485ebfcb456ef1b6f8ce0a/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=c609b792f74948bc4e485ebfcb456ef1b6f8ce0a",
            "patch": "@@ -1040,6 +1040,13 @@ def test_simple(self):\n \n         self.assertRaises(InvalidCacheBackendError, get_cache, 'does_not_exist')\n \n+    def test_close(self):\n+        from django.core import signals\n+        cache = get_cache('regressiontests.cache.closeable_cache.CacheClass')\n+        self.assertFalse(cache.closed)\n+        signals.request_finished.send(self.__class__)\n+        self.assertTrue(cache.closed)\n+\n \n class CacheUtils(TestCase):\n     \"\"\"TestCase for django.utils.cache functions.\"\"\""
        }
    ],
    "stats": {
        "total": 20,
        "additions": 14,
        "deletions": 6
    }
}