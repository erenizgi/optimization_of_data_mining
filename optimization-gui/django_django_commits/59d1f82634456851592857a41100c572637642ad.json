{
    "author": "jezdez",
    "message": "Fixed #11251 -- Extended Australian localflavor to ship a few model fields additionally. Thanks, Simon Meers and Julien Phalip.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16066 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "59d1f82634456851592857a41100c572637642ad",
    "files": [
        {
            "sha": "12911ea8a38b7be8cb815b59f05dba4a398875c8",
            "filename": "django/contrib/localflavor/au/forms.py",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/django%2Fcontrib%2Flocalflavor%2Fau%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/django%2Fcontrib%2Flocalflavor%2Fau%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fau%2Fforms.py?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -1,25 +1,32 @@\n \"\"\"\n Australian-specific Form helpers\n \"\"\"\n+import re\n \n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select\n from django.utils.encoding import smart_unicode\n from django.utils.translation import ugettext_lazy as _\n-import re\n \n PHONE_DIGITS_RE = re.compile(r'^(\\d{10})$')\n \n class AUPostCodeField(RegexField):\n-    \"\"\"Australian post code field.\"\"\"\n+    \"\"\" Australian post code field.\n+\n+    Assumed to be 4 digits.\n+    Northern Territory 3-digit postcodes should have leading zero.\n+    \"\"\"\n     default_error_messages = {\n-        'invalid': _('Enter a 4 digit post code.'),\n+        'invalid': _('Enter a 4 digit postcode.'),\n     }\n \n     def __init__(self, *args, **kwargs):\n+        if 'max_length' in kwargs:\n+            kwargs.pop('max_length')\n         super(AUPostCodeField, self).__init__(r'^\\d{4}$',\n-            max_length=None, min_length=None, *args, **kwargs)\n+            max_length=4, min_length=None, *args, **kwargs)\n+\n \n class AUPhoneNumberField(Field):\n     \"\"\"Australian phone number field.\"\"\"\n@@ -40,6 +47,7 @@ def clean(self, value):\n             return u'%s' % phone_match.group(1)\n         raise ValidationError(self.error_messages['invalid'])\n \n+\n class AUStateSelect(Select):\n     \"\"\"\n     A Select widget that uses a list of Australian states/territories as its"
        },
        {
            "sha": "e2b897e4df61998d38cf1ee65a2158f00daef7cd",
            "filename": "django/contrib/localflavor/au/models.py",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/django%2Fcontrib%2Flocalflavor%2Fau%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/django%2Fcontrib%2Flocalflavor%2Fau%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fau%2Fmodels.py?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -0,0 +1,44 @@\n+from django.conf import settings\n+from django.utils.translation import ugettext_lazy as _\n+from django.db.models.fields import CharField\n+\n+from django.contrib.localflavor.au.au_states import STATE_CHOICES\n+from django.contrib.localflavor.au import forms\n+\n+class AUStateField(CharField):\n+\n+    description = _(\"Australian State\")\n+\n+    def __init__(self, *args, **kwargs):\n+        kwargs['choices'] = STATE_CHOICES\n+        kwargs['max_length'] = 3\n+        super(AUStateField, self).__init__(*args, **kwargs)\n+\n+\n+class AUPostCodeField(CharField):\n+\n+    description = _(\"Australian Postcode\")\n+\n+    def __init__(self, *args, **kwargs):\n+        kwargs['max_length'] = 4\n+        super(AUPostCodeField, self).__init__(*args, **kwargs)\n+\n+    def formfield(self, **kwargs):\n+        defaults = {'form_class': forms.AUPostCodeField}\n+        defaults.update(kwargs)\n+        return super(AUPostCodeField, self).formfield(**defaults)\n+\n+\n+class AUPhoneNumberField(CharField):\n+\n+    description = _(\"Australian Phone number\")\n+\n+    def __init__(self, *args, **kwargs):\n+        kwargs['max_length'] = 20\n+        super(AUPhoneNumberField, self).__init__(*args, **kwargs)\n+\n+    def formfield(self, **kwargs):\n+        defaults = {'form_class': forms.AUPhoneNumberField}\n+        defaults.update(kwargs)\n+        return super(AUPhoneNumberField, self).formfield(**defaults)\n+"
        },
        {
            "sha": "e2515e3e0823af72d7f22367135a47a435effd43",
            "filename": "docs/ref/contrib/localflavor.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Flocalflavor.txt?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -202,6 +202,21 @@ Australia (``au``)\n     A ``Select`` widget that uses a list of Australian states/territories as its\n     choices.\n \n+.. class:: au.models.AUPhoneNumberField\n+\n+    A model field that checks that the value is a valid Australian phone\n+    number (ten digits).\n+\n+.. class:: au.models.AUStateField\n+\n+    A model field that forms represent as a ``forms.AUStateField`` field and\n+    stores the three-letter Australian state abbreviation in the database.\n+\n+.. class:: au.models.AUPostCodeField\n+\n+    A model field that forms represent as a ``forms.AUPostCodeField`` field\n+    and stores the four-digit Australian postcode in the database.\n+\n Austria (``at``)\n ================\n "
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "tests/regressiontests/localflavor/au/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fau%2F__init__.py?ref=59d1f82634456851592857a41100c572637642ad"
        },
        {
            "sha": "e65b92438ebf54f641a39b1571793d48c4127789",
            "filename": "tests/regressiontests/localflavor/au/forms.py",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fau%2Fforms.py?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -0,0 +1,7 @@\n+from django.forms import ModelForm\n+from models import AustralianPlace\n+\n+class AustralianPlaceForm(ModelForm):\n+    \"\"\" Form for storing an Australian place. \"\"\"\n+    class Meta:\n+        model = AustralianPlace"
        },
        {
            "sha": "8adfa1f6f5c4db45b1e3a3a1033c3c135303cacd",
            "filename": "tests/regressiontests/localflavor/au/models.py",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fau%2Fmodels.py?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -0,0 +1,14 @@\n+from django.db import models\n+from django.contrib.localflavor.au.models import AUStateField, AUPostCodeField\n+\n+class AustralianPlace(models.Model):\n+    state = AUStateField(blank=True)\n+    state_required = AUStateField()\n+    state_default = AUStateField(default=\"NSW\", blank=True)\n+    postcode = AUPostCodeField(blank=True)\n+    postcode_required = AUPostCodeField()\n+    postcode_default = AUPostCodeField(default=\"2500\", blank=True)\n+    name = models.CharField(max_length=20)\n+\n+    class Meta:\n+        app_label = 'localflavor'"
        },
        {
            "sha": "1f462d579feeb240ab3bf63532854cbc20bc8900",
            "filename": "tests/regressiontests/localflavor/au/tests.py",
            "status": "added",
            "additions": 58,
            "deletions": 0,
            "changes": 58,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Fau%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Fau%2Ftests.py?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -0,0 +1,58 @@\n+import re\n+\n+from django.test import TestCase\n+from forms import AustralianPlaceForm\n+\n+SELECTED_OPTION_PATTERN = r'<option value=\"%s\" selected=\"selected\">'\n+BLANK_OPTION_PATTERN = r'<option value=\"\">'\n+INPUT_VALUE_PATTERN = r'<input[^>]*value=\"%s\"[^>]*>'\n+\n+\n+class AULocalflavorTests(TestCase):\n+    def setUp(self):\n+        self.form = AustralianPlaceForm(\n+            {'state':'WA',\n+             'state_required':'QLD',\n+             'name':'dummy',\n+             'postcode':'1234',\n+             'postcode_required':'4321',\n+             })\n+\n+    def test_get_display_methods(self):\n+        \"\"\" Ensure get_*_display() methods are added to model instances. \"\"\"\n+        place = self.form.save()\n+        self.assertEqual(place.get_state_display(), 'Western Australia')\n+        self.assertEqual(place.get_state_required_display(), 'Queensland')\n+\n+    def test_default_values(self):\n+        \"\"\" Ensure that default values are selected in forms. \"\"\"\n+        form = AustralianPlaceForm()\n+        self.assertTrue(re.search(SELECTED_OPTION_PATTERN % 'NSW',\n+                                  str(form['state_default'])))\n+        self.assertTrue(re.search(INPUT_VALUE_PATTERN % '2500',\n+                                  str(form['postcode_default'])))\n+\n+    def test_required(self):\n+        \"\"\" Test that required AUStateFields throw appropriate errors. \"\"\"\n+        form = AustralianPlaceForm({'state':'NSW', 'name':'Wollongong'})\n+        self.assertFalse(form.is_valid())\n+        self.assertEqual(\n+            form.errors['state_required'], [u'This field is required.'])\n+        self.assertEqual(\n+            form.errors['postcode_required'], [u'This field is required.'])\n+\n+    def test_field_blank_option(self):\n+        \"\"\" Test that the empty option is there. \"\"\"\n+        self.assertTrue(re.search(BLANK_OPTION_PATTERN,\n+                                  str(self.form['state'])))\n+\n+    def test_selected_values(self):\n+        \"\"\" Ensure selected states match the initial values provided. \"\"\"\n+        self.assertTrue(re.search(SELECTED_OPTION_PATTERN % 'WA',\n+                                  str(self.form['state'])))\n+        self.assertTrue(re.search(SELECTED_OPTION_PATTERN % 'QLD',\n+                                  str(self.form['state_required'])))\n+        self.assertTrue(re.search(INPUT_VALUE_PATTERN % '1234',\n+                                  str(self.form['postcode'])))\n+        self.assertTrue(re.search(INPUT_VALUE_PATTERN % '4321',\n+                                  str(self.form['postcode_required'])))"
        },
        {
            "sha": "e22fc0f5bee40221271d427da5df130db14bef22",
            "filename": "tests/regressiontests/localflavor/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/59d1f82634456851592857a41100c572637642ad/tests%2Fregressiontests%2Flocalflavor%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flocalflavor%2Ftests.py?ref=59d1f82634456851592857a41100c572637642ad",
            "patch": "@@ -3,3 +3,4 @@\n \n # just import your tests here\n from us.tests import *\n+from au.tests import *"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 151,
        "deletions": 4
    }
}