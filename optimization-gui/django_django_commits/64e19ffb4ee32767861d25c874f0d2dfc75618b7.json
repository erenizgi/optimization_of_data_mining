{
    "author": "jezdez",
    "message": "Fixed #7704, #14045 and #15495 -- Introduce a lexer for Javascript to fix multiple problems of the translation of Javascript files with xgettext. Many thanks to Ned Batchelder for his contribution of the JsLex library.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16333 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "64e19ffb4ee32767861d25c874f0d2dfc75618b7",
    "files": [
        {
            "sha": "899775d0208524d36161e4eaee4f68d55e35ce1d",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/64e19ffb4ee32767861d25c874f0d2dfc75618b7/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/64e19ffb4ee32767861d25c874f0d2dfc75618b7/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=64e19ffb4ee32767861d25c874f0d2dfc75618b7",
            "patch": "@@ -9,8 +9,8 @@\n \n from django.core.management.base import CommandError, NoArgsCommand\n from django.utils.text import get_text_list\n+from django.utils.jslex import prepare_js_for_gettext\n \n-pythonize_re = re.compile(r'(?:^|\\n)\\s*//')\n plural_forms_re = re.compile(r'^(?P<value>\"Plural-Forms.+?\\\\n\")\\s*$', re.MULTILINE | re.DOTALL)\n \n def handle_extensions(extensions=('html',)):\n@@ -184,15 +184,15 @@ def make_messages(locale=None, domain='django', verbosity='1', all=False,\n                 if verbosity > 1:\n                     sys.stdout.write('processing file %s in %s\\n' % (file, dirpath))\n                 src = open(os.path.join(dirpath, file), \"rU\").read()\n-                src = pythonize_re.sub('\\n#', src)\n-                thefile = '%s.py' % file\n+                src = prepare_js_for_gettext(src)\n+                thefile = '%s.c' % file\n                 f = open(os.path.join(dirpath, thefile), \"w\")\n                 try:\n                     f.write(src)\n                 finally:\n                     f.close()\n                 cmd = (\n-                    'xgettext -d %s -L Perl %s --keyword=gettext_noop '\n+                    'xgettext -d %s -L C %s --keyword=gettext_noop '\n                     '--keyword=gettext_lazy --keyword=ngettext_lazy:1,2 '\n                     '--keyword=pgettext:1c,2 --keyword=npgettext:1c,2,3 '\n                     '--from-code UTF-8 --add-comments=Translators -o - \"%s\"' % ("
        },
        {
            "sha": "88a22ec67d854cfb7894a3d8124e1ff682fdf1cf",
            "filename": "django/utils/jslex.py",
            "status": "added",
            "additions": 213,
            "deletions": 0,
            "changes": 213,
            "blob_url": "https://github.com/django/django/blob/64e19ffb4ee32767861d25c874f0d2dfc75618b7/django%2Futils%2Fjslex.py",
            "raw_url": "https://github.com/django/django/raw/64e19ffb4ee32767861d25c874f0d2dfc75618b7/django%2Futils%2Fjslex.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fjslex.py?ref=64e19ffb4ee32767861d25c874f0d2dfc75618b7",
            "patch": "@@ -0,0 +1,213 @@\n+\"\"\"JsLex: a lexer for Javascript\"\"\"\n+# Originally from https://bitbucket.org/ned/jslex\n+import re\n+\n+class Tok(object):\n+    \"\"\"\n+    A specification for a token class.\n+    \"\"\"\n+    num = 0\n+\n+    def __init__(self, name, regex, next=None):\n+        self.id = Tok.num\n+        Tok.num += 1\n+        self.name = name\n+        self.regex = regex\n+        self.next = next\n+\n+def literals(choices, prefix=\"\", suffix=\"\"):\n+    \"\"\"\n+    Create a regex from a space-separated list of literal `choices`.\n+\n+    If provided, `prefix` and `suffix` will be attached to each choice\n+    individually.\n+\n+    \"\"\"\n+    return \"|\".join(prefix+re.escape(c)+suffix for c in choices.split())\n+\n+\n+class Lexer(object):\n+    \"\"\"\n+    A generic multi-state regex-based lexer.\n+    \"\"\"\n+\n+    def __init__(self, states, first):\n+        self.regexes = {}\n+        self.toks = {}\n+\n+        for state, rules in states.items():\n+            parts = []\n+            for tok in rules:\n+                groupid = \"t%d\" % tok.id\n+                self.toks[groupid] = tok\n+                parts.append(\"(?P<%s>%s)\" % (groupid, tok.regex))\n+            self.regexes[state] = re.compile(\"|\".join(parts), re.MULTILINE|re.VERBOSE)\n+\n+        self.state = first\n+\n+    def lex(self, text):\n+        \"\"\"\n+        Lexically analyze `text`.\n+\n+        Yields pairs (`name`, `tokentext`).\n+        \"\"\"\n+        while text:\n+            eaten = 0\n+            for match in self.regexes[self.state].finditer(text):\n+                for name, toktext in match.groupdict().iteritems():\n+                    if toktext is not None:\n+                        tok = self.toks[name]\n+                        new_state = tok.next\n+                        eaten += len(toktext)\n+                        yield (tok.name, toktext)\n+                if new_state:\n+                    self.state = new_state\n+                    break\n+            text = text[eaten:]\n+\n+\n+class JsLexer(Lexer):\n+    \"\"\"\n+    A Javascript lexer\n+\n+    >>> lexer = JsLexer()\n+    >>> list(lexer.lex(\"a = 1\"))\n+    [('id', 'a'), ('ws', ' '), ('punct', '='), ('ws', ' '), ('dnum', '1')]\n+\n+    This doesn't properly handle non-Ascii characters in the Javascript source.\n+    \"\"\"\n+\n+    # Because these tokens are matched as alternatives in a regex, longer\n+    # possibilities must appear in the list before shorter ones, for example,\n+    # '>>' before '>'.\n+    #\n+    # Note that we don't have to detect malformed Javascript, only properly\n+    # lex correct Javascript, so much of this is simplified.\n+\n+    # Details of Javascript lexical structure are taken from\n+    # http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-262.pdf\n+\n+    # A useful explanation of automatic semicolon insertion is at\n+    # http://inimino.org/~inimino/blog/javascript_semicolons\n+\n+    both_before = [\n+        Tok(\"comment\",      r\"/\\*(.|\\n)*?\\*/\"),\n+        Tok(\"linecomment\",  r\"//.*?$\"),\n+        Tok(\"ws\",           r\"\\s+\"),\n+        Tok(\"keyword\",      literals(\"\"\"\n+                                break case catch class const continue debugger\n+                                default delete do else enum export extends\n+                                finally for function if import in instanceof\n+                                new return super switch this throw try typeof\n+                                var void while with\n+                                \"\"\", suffix=r\"\\b\"), next='reg'),\n+        Tok(\"reserved\",     literals(\"null true false\", suffix=r\"\\b\"), next='div'),\n+        Tok(\"id\",           r\"\"\"\n+                            ([a-zA-Z_$   ]|\\\\u[0-9a-fA-Z]{4})   # first char\n+                            ([a-zA-Z_$0-9]|\\\\u[0-9a-fA-F]{4})*  # rest chars\n+                            \"\"\", next='div'),\n+        Tok(\"hnum\",         r\"0[xX][0-9a-fA-F]+\", next='div'),\n+        Tok(\"onum\",         r\"0[0-7]+\"),\n+        Tok(\"dnum\",         r\"\"\"\n+                            (   (0|[1-9][0-9]*)     # DecimalIntegerLiteral\n+                                \\.                  # dot\n+                                [0-9]*              # DecimalDigits-opt\n+                                ([eE][-+]?[0-9]+)?  # ExponentPart-opt\n+                            |\n+                                \\.                  # dot\n+                                [0-9]+              # DecimalDigits\n+                                ([eE][-+]?[0-9]+)?  # ExponentPart-opt\n+                            |\n+                                (0|[1-9][0-9]*)     # DecimalIntegerLiteral\n+                                ([eE][-+]?[0-9]+)?  # ExponentPart-opt\n+                            )\n+                            \"\"\", next='div'),\n+        Tok(\"punct\",        literals(\"\"\"\n+                                >>>= === !== >>> <<= >>= <= >= == != << >> &&\n+                                || += -= *= %= &= |= ^=\n+                                \"\"\"), next=\"reg\"),\n+        Tok(\"punct\",        literals(\"++ -- ) ]\"), next='div'),\n+        Tok(\"punct\",        literals(\"{ } ( [ . ; , < > + - * % & | ^ ! ~ ? : =\"), next='reg'),\n+        Tok(\"string\",       r'\"([^\"\\\\]|(\\\\(.|\\n)))*?\"', next='div'),\n+        Tok(\"string\",       r\"'([^'\\\\]|(\\\\(.|\\n)))*?'\", next='div'),\n+        ]\n+\n+    both_after = [\n+        Tok(\"other\",        r\".\"),\n+    ]\n+\n+    states = {\n+        'div': # slash will mean division\n+            both_before + [\n+            Tok(\"punct\", literals(\"/= /\"), next='reg'),\n+            ] + both_after,\n+\n+        'reg':  # slash will mean regex\n+            both_before + [\n+            Tok(\"regex\",\n+                r\"\"\"\n+                    /                       # opening slash\n+                    # First character is..\n+                    (   [^*\\\\/[]            # anything but * \\ / or [\n+                    |   \\\\.                 # or an escape sequence\n+                    |   \\[                  # or a class, which has\n+                            (   [^\\]\\\\]     #   anything but \\ or ]\n+                            |   \\\\.         #   or an escape sequence\n+                            )*              #   many times\n+                        \\]\n+                    )\n+                    # Following characters are same, except for excluding a star\n+                    (   [^\\\\/[]             # anything but \\ / or [\n+                    |   \\\\.                 # or an escape sequence\n+                    |   \\[                  # or a class, which has\n+                            (   [^\\]\\\\]     #   anything but \\ or ]\n+                            |   \\\\.         #   or an escape sequence\n+                            )*              #   many times\n+                        \\]\n+                    )*                      # many times\n+                    /                       # closing slash\n+                    [a-zA-Z0-9]*            # trailing flags\n+                \"\"\", next='div'),\n+            ] + both_after,\n+        }\n+\n+    def __init__(self):\n+        super(JsLexer, self).__init__(self.states, 'reg')\n+\n+\n+def prepare_js_for_gettext(js):\n+    \"\"\"\n+    Convert the Javascript source `js` into something resembling C for\n+    xgettext.\n+\n+    What actually happens is that all the regex literals are replaced with\n+    \"REGEX\".\n+    \"\"\"\n+    def escape_quotes(m):\n+        \"\"\"Used in a regex to properly escape double quotes.\"\"\"\n+        s = m.group(0)\n+        if s == '\"':\n+            return r'\\\"'\n+        else:\n+            return s\n+\n+    lexer = JsLexer()\n+    c = []\n+    for name, tok in lexer.lex(js):\n+        if name == 'regex':\n+            # C doesn't grok regexes, and they aren't needed for gettext,\n+            # so just output a string instead.\n+            tok = '\"REGEX\"';\n+        elif name == 'string':\n+            # C doesn't have single-quoted strings, so make all strings\n+            # double-quoted.\n+            if tok.startswith(\"'\"):\n+                guts = re.sub(r\"\\\\.|.\", escape_quotes, tok[1:-1])\n+                tok = '\"' + guts + '\"'\n+        elif name == 'id':\n+            # C can't deal with Unicode escapes in identifiers.  We don't\n+            # need them for gettext anyway, so replace them with something\n+            # innocuous\n+            tok = tok.replace(\"\\\\\", \"U\");\n+        c.append(tok)\n+    return ''.join(c)"
        },
        {
            "sha": "7341c4f7cbdf2d4c96c1c7090519177419d8d403",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=64e19ffb4ee32767861d25c874f0d2dfc75618b7",
            "patch": "@@ -31,11 +31,13 @@ def tearDown(self):\n     def assertMsgId(self, msgid, s, use_quotes=True):\n         if use_quotes:\n             msgid = '\"%s\"' % msgid\n+        msgid = re.escape(msgid)\n         return self.assertTrue(re.search('^msgid %s' % msgid, s, re.MULTILINE))\n \n     def assertNotMsgId(self, msgid, s, use_quotes=True):\n         if use_quotes:\n             msgid = '\"%s\"' % msgid\n+        msgid = re.escape(msgid)\n         return self.assertTrue(not re.search('^msgid %s' % msgid, s, re.MULTILINE))\n \n \n@@ -73,7 +75,7 @@ def test_templatize(self):\n         self.assertTrue(os.path.exists(self.PO_FILE))\n         po_contents = open(self.PO_FILE, 'r').read()\n         self.assertMsgId('I think that 100%% is more that 50%% of anything.', po_contents)\n-        self.assertMsgId('I think that 100%% is more that 50%% of %\\(obj\\)s.', po_contents)\n+        self.assertMsgId('I think that 100%% is more that 50%% of %(obj)s.', po_contents)\n \n     def test_extraction_error(self):\n         os.chdir(self.test_dir)\n@@ -102,7 +104,17 @@ def test_javascript_literals(self):\n         po_contents = open(self.PO_FILE, 'r').read()\n         self.assertMsgId('This literal should be included.', po_contents)\n         self.assertMsgId('This one as well.', po_contents)\n-\n+        self.assertMsgId(r'He said, \\\"hello\\\".', po_contents)\n+        self.assertMsgId(\"okkkk\", po_contents)\n+        self.assertMsgId(\"TEXT\", po_contents)\n+        self.assertMsgId(\"It's at http://example.com\", po_contents)\n+        self.assertMsgId(\"String\", po_contents)\n+        self.assertMsgId(\"/* but this one will be too */ 'cause there is no way of telling...\", po_contents)\n+        self.assertMsgId(\"foo\", po_contents)\n+        self.assertMsgId(\"bar\", po_contents)\n+        self.assertMsgId(\"baz\", po_contents)\n+        self.assertMsgId(\"quz\", po_contents)\n+        self.assertMsgId(\"foobar\", po_contents)\n \n class IgnoredExtractorTests(ExtractorTests):\n "
        },
        {
            "sha": "fa059d70f4dbcf793fc89bd656a7f51c7f5692e8",
            "filename": "tests/regressiontests/i18n/commands/javascript.js",
            "status": "modified",
            "additions": 45,
            "deletions": 2,
            "changes": 47,
            "blob_url": "https://github.com/django/django/blob/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fjavascript.js",
            "raw_url": "https://github.com/django/django/raw/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fjavascript.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fjavascript.js?ref=64e19ffb4ee32767861d25c874f0d2dfc75618b7",
            "patch": "@@ -1,4 +1,47 @@\n // '\n gettext('This literal should be included.')\n-// '\n-gettext('This one as well.')\n+x = y; // '\n+gettext(\"This one as well.\")\n+\n+/** (from ticket 7704)\n+ * *****************************\n+ * AddModule main / window\n+ * @constructor\n+ * @class MyDesktop.AddModule\n+ * *****************************\n+ */\n+\n+gettext('He said, \\\"hello\".')\n+\n+// from ticket 14045\n+function mfunc() {\n+    var val = 0;\n+    return val ? 1 : 0;\n+}\n+gettext('okkkk');\n+print mysub();\n+\n+// from ticket 15495\n+/* / ' */ gettext(\"TEXT\");\n+\n+gettext(\"It's at http://example.com\")\n+\n+// also from ticket 15495\n+gettext(\"String\"); // This comment won't be caught by pythonize_re and it contains \"'\" which is a string start in Perl\n+/*\n+ * This one will be removed by the patch\n+ */\n+gettext(\"/* but this one will be too */ 'cause there is no way of telling...\");\n+f(/* ... if it's different from this one */);\n+\n+// from ticket 15331\n+gettext(\"foo\");\n+true ? true : false;\n+gettext(\"bar\");\n+true ? true : false;\n+gettext(\"baz\");\n+true ? true : false; // ?\n+gettext(\"quz\");\n+\"?\";\n+gettext(\"foobar\");\n+"
        },
        {
            "sha": "08e83868319f01006439fc645726788ba888b74e",
            "filename": "tests/regressiontests/utils/jslex.py",
            "status": "added",
            "additions": 217,
            "deletions": 0,
            "changes": 217,
            "blob_url": "https://github.com/django/django/blob/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Futils%2Fjslex.py",
            "raw_url": "https://github.com/django/django/raw/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Futils%2Fjslex.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fjslex.py?ref=64e19ffb4ee32767861d25c874f0d2dfc75618b7",
            "patch": "@@ -0,0 +1,217 @@\n+\"\"\"Tests for jslex.\"\"\"\n+# encoding: utf-8\n+# originally from https://bitbucket.org/ned/jslex\n+\n+import difflib\n+from django.test import TestCase\n+from django.utils.jslex import JsLexer, prepare_js_for_gettext\n+\n+class JsTokensTest(TestCase):\n+    LEX_CASES = [\n+        # ids\n+        (\"a ABC $ _ a123\", [\"id a\", \"id ABC\", \"id $\", \"id _\", \"id a123\"]),\n+        (r\"\\u1234 abc\\u0020 \\u0065_\\u0067\", [r\"id \\u1234\", r\"id abc\\u0020\", r\"id \\u0065_\\u0067\"]),\n+        # numbers\n+        (\"123 1.234 0.123e-3 0 1E+40 1e1 .123\", [\"dnum 123\", \"dnum 1.234\", \"dnum 0.123e-3\", \"dnum 0\", \"dnum 1E+40\", \"dnum 1e1\", \"dnum .123\"]),\n+        (\"0x1 0xabCD 0XABcd\", [\"hnum 0x1\", \"hnum 0xabCD\", \"hnum 0XABcd\"]),\n+        (\"010 0377 090\", [\"onum 010\", \"onum 0377\", \"dnum 0\", \"dnum 90\"]),\n+        (\"0xa123ghi\", [\"hnum 0xa123\", \"id ghi\"]),\n+        # keywords\n+        (\"function Function FUNCTION\", [\"keyword function\", \"id Function\", \"id FUNCTION\"]),\n+        (\"const constructor in inherits\", [\"keyword const\", \"id constructor\", \"keyword in\", \"id inherits\"]),\n+        (\"true true_enough\", [\"reserved true\", \"id true_enough\"]),\n+        # strings\n+        (''' 'hello' \"hello\" ''', [\"string 'hello'\", 'string \"hello\"']),\n+        (r\"\"\" 'don\\'t' \"don\\\"t\" '\"' \"'\" '\\'' \"\\\"\" \"\"\",\n+         [r\"\"\"string 'don\\'t'\"\"\", r'''string \"don\\\"t\"''', r\"\"\"string '\"'\"\"\", r'''string \"'\"''', r\"\"\"string '\\''\"\"\", r'''string \"\\\"\"''']),\n+        (ur'\"ƃuıxǝ⅂ ʇdıɹɔsɐʌɐſ\\\"\"', [ur'string \"ƃuıxǝ⅂ ʇdıɹɔsɐʌɐſ\\\"\"']),\n+        # comments\n+        (\"a//b\", [\"id a\", \"linecomment //b\"]),\n+        (\"/****/a/=2//hello\", [\"comment /****/\", \"id a\", \"punct /=\", \"dnum 2\", \"linecomment //hello\"]),\n+        (\"/*\\n * Header\\n */\\na=1;\", [\"comment /*\\n * Header\\n */\", \"id a\", \"punct =\", \"dnum 1\", \"punct ;\"]),\n+        # punctuation\n+        (\"a+++b\", [\"id a\", \"punct ++\", \"punct +\", \"id b\"]),\n+        # regex\n+        (r\"a=/a*/,1\", [\"id a\", \"punct =\", \"regex /a*/\", \"punct ,\", \"dnum 1\"]),\n+        (r\"a=/a*[^/]+/,1\", [\"id a\", \"punct =\", \"regex /a*[^/]+/\", \"punct ,\", \"dnum 1\"]),\n+        (r\"a=/a*\\[^/,1\", [\"id a\", \"punct =\", r\"regex /a*\\[^/\", \"punct ,\", \"dnum 1\"]),\n+        (r\"a=/\\//,1\", [\"id a\", \"punct =\", r\"regex /\\//\", \"punct ,\", \"dnum 1\"]),\n+\n+        # next two are from http://www.mozilla.org/js/language/js20-2002-04/rationale/syntax.html#regular-expressions\n+        (\"\"\"for (var x = a in foo && \"</x>\" || mot ? z:/x:3;x<5;y</g/i) {xyz(x++);}\"\"\",\n+            [\"keyword for\", \"punct (\", \"keyword var\", \"id x\", \"punct =\", \"id a\", \"keyword in\",\n+            \"id foo\", \"punct &&\", 'string \"</x>\"', \"punct ||\", \"id mot\", \"punct ?\", \"id z\",\n+            \"punct :\", \"regex /x:3;x<5;y</g\", \"punct /\", \"id i\", \"punct )\", \"punct {\",\n+            \"id xyz\", \"punct (\", \"id x\", \"punct ++\", \"punct )\", \"punct ;\", \"punct }\"]),\n+        (\"\"\"for (var x = a in foo && \"</x>\" || mot ? z/x:3;x<5;y</g/i) {xyz(x++);}\"\"\",\n+            [\"keyword for\", \"punct (\", \"keyword var\", \"id x\", \"punct =\", \"id a\", \"keyword in\",\n+            \"id foo\", \"punct &&\", 'string \"</x>\"', \"punct ||\", \"id mot\", \"punct ?\", \"id z\",\n+            \"punct /\", \"id x\", \"punct :\", \"dnum 3\", \"punct ;\", \"id x\", \"punct <\", \"dnum 5\",\n+            \"punct ;\", \"id y\", \"punct <\", \"regex /g/i\", \"punct )\", \"punct {\",\n+            \"id xyz\", \"punct (\", \"id x\", \"punct ++\", \"punct )\", \"punct ;\", \"punct }\"]),\n+\n+        # Various \"illegal\" regexes that are valid according to the std.\n+        (r\"\"\"/????/, /++++/, /[----]/ \"\"\", [\"regex /????/\", \"punct ,\", \"regex /++++/\", \"punct ,\", \"regex /[----]/\"]),\n+\n+        # Stress cases from http://stackoverflow.com/questions/5533925/what-javascript-constructs-does-jslex-incorrectly-lex/5573409#5573409\n+        (r\"\"\"/\\[/\"\"\", [r\"\"\"regex /\\[/\"\"\"]),\n+        (r\"\"\"/[i]/\"\"\", [r\"\"\"regex /[i]/\"\"\"]),\n+        (r\"\"\"/[\\]]/\"\"\", [r\"\"\"regex /[\\]]/\"\"\"]),\n+        (r\"\"\"/a[\\]]/\"\"\", [r\"\"\"regex /a[\\]]/\"\"\"]),\n+        (r\"\"\"/a[\\]]b/\"\"\", [r\"\"\"regex /a[\\]]b/\"\"\"]),\n+        (r\"\"\"/[\\]/]/gi\"\"\", [r\"\"\"regex /[\\]/]/gi\"\"\"]),\n+        (r\"\"\"/\\[[^\\]]+\\]/gi\"\"\", [r\"\"\"regex /\\[[^\\]]+\\]/gi\"\"\"]),\n+        (\"\"\"\n+            rexl.re = {\n+            NAME: /^(?!\\d)(?:\\w)+|^\"(?:[^\"]|\"\")+\"/,\n+            UNQUOTED_LITERAL: /^@(?:(?!\\d)(?:\\w|\\:)+|^\"(?:[^\"]|\"\")+\")\\[[^\\]]+\\]/,\n+            QUOTED_LITERAL: /^'(?:[^']|'')*'/,\n+            NUMERIC_LITERAL: /^[0-9]+(?:\\.[0-9]*(?:[eE][-+][0-9]+)?)?/,\n+            SYMBOL: /^(?:==|=|<>|<=|<|>=|>|!~~|!~|~~|~|!==|!=|!~=|!~|!|&|\\||\\.|\\:|,|\\(|\\)|\\[|\\]|\\{|\\}|\\?|\\:|;|@|\\^|\\/\\+|\\/|\\*|\\+|-)/\n+            };\n+        \"\"\",\n+        [\"id rexl\", \"punct .\", \"id re\", \"punct =\", \"punct {\",\n+         \"id NAME\", \"punct :\", r\"\"\"regex /^(?!\\d)(?:\\w)+|^\"(?:[^\"]|\"\")+\"/\"\"\", \"punct ,\",\n+         \"id UNQUOTED_LITERAL\", \"punct :\", r\"\"\"regex /^@(?:(?!\\d)(?:\\w|\\:)+|^\"(?:[^\"]|\"\")+\")\\[[^\\]]+\\]/\"\"\", \"punct ,\",\n+         \"id QUOTED_LITERAL\", \"punct :\", r\"\"\"regex /^'(?:[^']|'')*'/\"\"\", \"punct ,\",\n+         \"id NUMERIC_LITERAL\", \"punct :\", r\"\"\"regex /^[0-9]+(?:\\.[0-9]*(?:[eE][-+][0-9]+)?)?/\"\"\", \"punct ,\",\n+         \"id SYMBOL\", \"punct :\", r\"\"\"regex /^(?:==|=|<>|<=|<|>=|>|!~~|!~|~~|~|!==|!=|!~=|!~|!|&|\\||\\.|\\:|,|\\(|\\)|\\[|\\]|\\{|\\}|\\?|\\:|;|@|\\^|\\/\\+|\\/|\\*|\\+|-)/\"\"\",\n+         \"punct }\", \"punct ;\"\n+         ]),\n+\n+        (\"\"\"\n+            rexl.re = {\n+            NAME: /^(?!\\d)(?:\\w)+|^\"(?:[^\"]|\"\")+\"/,\n+            UNQUOTED_LITERAL: /^@(?:(?!\\d)(?:\\w|\\:)+|^\"(?:[^\"]|\"\")+\")\\[[^\\]]+\\]/,\n+            QUOTED_LITERAL: /^'(?:[^']|'')*'/,\n+            NUMERIC_LITERAL: /^[0-9]+(?:\\.[0-9]*(?:[eE][-+][0-9]+)?)?/,\n+            SYMBOL: /^(?:==|=|<>|<=|<|>=|>|!~~|!~|~~|~|!==|!=|!~=|!~|!|&|\\||\\.|\\:|,|\\(|\\)|\\[|\\]|\\{|\\}|\\?|\\:|;|@|\\^|\\/\\+|\\/|\\*|\\+|-)/\n+            };\n+            str = '\"';\n+        \"\"\",\n+        [\"id rexl\", \"punct .\", \"id re\", \"punct =\", \"punct {\",\n+         \"id NAME\", \"punct :\", r\"\"\"regex /^(?!\\d)(?:\\w)+|^\"(?:[^\"]|\"\")+\"/\"\"\", \"punct ,\",\n+         \"id UNQUOTED_LITERAL\", \"punct :\", r\"\"\"regex /^@(?:(?!\\d)(?:\\w|\\:)+|^\"(?:[^\"]|\"\")+\")\\[[^\\]]+\\]/\"\"\", \"punct ,\",\n+         \"id QUOTED_LITERAL\", \"punct :\", r\"\"\"regex /^'(?:[^']|'')*'/\"\"\", \"punct ,\",\n+         \"id NUMERIC_LITERAL\", \"punct :\", r\"\"\"regex /^[0-9]+(?:\\.[0-9]*(?:[eE][-+][0-9]+)?)?/\"\"\", \"punct ,\",\n+         \"id SYMBOL\", \"punct :\", r\"\"\"regex /^(?:==|=|<>|<=|<|>=|>|!~~|!~|~~|~|!==|!=|!~=|!~|!|&|\\||\\.|\\:|,|\\(|\\)|\\[|\\]|\\{|\\}|\\?|\\:|;|@|\\^|\\/\\+|\\/|\\*|\\+|-)/\"\"\",\n+         \"punct }\", \"punct ;\",\n+         \"id str\", \"punct =\", \"\"\"string '\"'\"\"\", \"punct ;\",\n+         ]),\n+\n+        (r\"\"\" this._js = \"e.str(\\\"\" + this.value.replace(/\\\\/g, \"\\\\\\\\\").replace(/\"/g, \"\\\\\\\"\") + \"\\\")\"; \"\"\",\n+         [\"keyword this\", \"punct .\", \"id _js\", \"punct =\", r'''string \"e.str(\\\"\"''', \"punct +\", \"keyword this\", \"punct .\",\n+          \"id value\", \"punct .\", \"id replace\", \"punct (\", r\"regex /\\\\/g\", \"punct ,\", r'string \"\\\\\\\\\"', \"punct )\",\n+          \"punct .\", \"id replace\", \"punct (\", r'regex /\"/g', \"punct ,\", r'string \"\\\\\\\"\"', \"punct )\", \"punct +\",\n+          r'string \"\\\")\"', \"punct ;\"]),\n+        ]\n+\n+def make_function(input, toks):\n+    def test_func(self):\n+        lexer = JsLexer()\n+        result = [\"%s %s\" % (name, tok) for name, tok in lexer.lex(input) if name != 'ws']\n+        self.assertListEqual(result, toks)\n+    return test_func\n+\n+for i, (input, toks) in enumerate(JsTokensTest.LEX_CASES):\n+    setattr(JsTokensTest, \"test_case_%d\" % i, make_function(input, toks))\n+\n+\n+GETTEXT_CASES = (\n+    (\n+        r\"\"\"\n+            a = 1; /* /[0-9]+/ */\n+            b = 0x2a0b / 1; // /[0-9]+/\n+            c = 3;\n+        \"\"\",\n+        r\"\"\"\n+            a = 1; /* /[0-9]+/ */\n+            b = 0x2a0b / 1; // /[0-9]+/\n+            c = 3;\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            a = 1.234e-5;\n+            /*\n+             * /[0-9+/\n+             */\n+            b = .0123;\n+        \"\"\",\n+        r\"\"\"\n+            a = 1.234e-5;\n+            /*\n+             * /[0-9+/\n+             */\n+            b = .0123;\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            x = y / z;\n+            alert(gettext(\"hello\"));\n+            x /= 3;\n+        \"\"\",\n+        r\"\"\"\n+            x = y / z;\n+            alert(gettext(\"hello\"));\n+            x /= 3;\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            s = \"Hello \\\"th/foo/ere\\\"\";\n+            s = 'He\\x23llo \\'th/foo/ere\\'';\n+            s = 'slash quote \\\", just quote \"';\n+        \"\"\",\n+        r\"\"\"\n+            s = \"Hello \\\"th/foo/ere\\\"\";\n+            s = \"He\\x23llo \\'th/foo/ere\\'\";\n+            s = \"slash quote \\\", just quote \\\"\";\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            s = \"Line continuation\\\n+            continued /hello/ still the string\";/hello/;\n+        \"\"\",\n+        r\"\"\"\n+            s = \"Line continuation\\\n+            continued /hello/ still the string\";\"REGEX\";\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            var regex = /pattern/;\n+            var regex2 = /matter/gm;\n+            var regex3 = /[*/]+/gm.foo(\"hey\");\n+        \"\"\",\n+        r\"\"\"\n+            var regex = \"REGEX\";\n+            var regex2 = \"REGEX\";\n+            var regex3 = \"REGEX\".foo(\"hey\");\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            for (var x = a in foo && \"</x>\" || mot ? z:/x:3;x<5;y</g/i) {xyz(x++);}\n+            for (var x = a in foo && \"</x>\" || mot ? z/x:3;x<5;y</g/i) {xyz(x++);}\n+        \"\"\",\n+        r\"\"\"\n+            for (var x = a in foo && \"</x>\" || mot ? z:\"REGEX\"/i) {xyz(x++);}\n+            for (var x = a in foo && \"</x>\" || mot ? z/x:3;x<5;y<\"REGEX\") {xyz(x++);}\n+        \"\"\"\n+    ), (\n+        r\"\"\"\n+            \\u1234xyz = gettext('Hello there');\n+        \"\"\", r\"\"\"\n+            Uu1234xyz = gettext(\"Hello there\");\n+        \"\"\"\n+    )\n+)\n+\n+\n+class JsToCForGettextTest(TestCase):\n+    pass\n+\n+def make_function(js, c):\n+    def test_func(self):\n+        self.assertMultiLineEqual(prepare_js_for_gettext(js), c)\n+    return test_func\n+\n+for i, pair in enumerate(GETTEXT_CASES):\n+    setattr(JsToCForGettextTest, \"test_case_%d\" % i, make_function(*pair))"
        },
        {
            "sha": "384d3948796ba122c42902abc38f6ad08f0208c4",
            "filename": "tests/regressiontests/utils/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Futils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/64e19ffb4ee32767861d25c874f0d2dfc75618b7/tests%2Fregressiontests%2Futils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftests.py?ref=64e19ffb4ee32767861d25c874f0d2dfc75618b7",
            "patch": "@@ -18,3 +18,4 @@\n from tzinfo import *\n from datetime_safe import *\n from baseconv import *\n+from jslex import *"
        }
    ],
    "stats": {
        "total": 502,
        "additions": 494,
        "deletions": 8
    }
}