{
    "author": "andrewgodwin",
    "message": "Merge branch 'master' into schema-alteration\n\nConflicts:\n\tdjango/db/backends/__init__.py\n\tdjango/db/models/fields/related.py\n\tdjango/db/models/options.py",
    "sha": "6a632e04578776e877adc5e2dc53f008c890a0d4",
    "files": [
        {
            "sha": "2d028c7287d686580f727f0a082642e6ff2f1de3",
            "filename": ".gitignore",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/.gitignore",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/.gitignore",
            "contents_url": "https://api.github.com/repos/django/django/contents/.gitignore?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,8 @@\n *.egg-info\n *.pot\n *.py[co]\n+MANIFEST\n+dist/\n docs/_build/\n+tests/coverage_html/\n+tests/.coverage\n\\ No newline at end of file"
        },
        {
            "sha": "3dc253a3c10c2dff0105ad619a080c27952dd89e",
            "filename": ".hgignore",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/.hgignore",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/.hgignore",
            "contents_url": "https://api.github.com/repos/django/django/contents/.hgignore?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,3 +4,5 @@ syntax:glob\n *.pot\n *.py[co]\n docs/_build/\n+tests/coverage_html/\n+tests/.coverage\n\\ No newline at end of file"
        },
        {
            "sha": "d3ded2878a1e9afac92a7d595c0fd10b70b315aa",
            "filename": ".tx/config",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/.tx%2Fconfig",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/.tx%2Fconfig",
            "contents_url": "https://api.github.com/repos/django/django/contents/.tx%2Fconfig?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,5 +1,5 @@\n [main]\n-host = https://www.transifex.net\n+host = https://www.transifex.com\n lang_map = sr@latin:sr_Latn\n \n [django.core]"
        },
        {
            "sha": "5799b941ff0f3332ed2c18a5d9b8ab96d8df2690",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -33,6 +33,7 @@ The PRIMARY AUTHORS are (and/or have been):\n     * Florian Apolloner\n     * Jeremy Dunck\n     * Bryan Veloso\n+    * Preston Holmes\n \n More information on the main contributors to Django can be found in\n docs/internals/committers.txt.\n@@ -424,6 +425,7 @@ answer newbie questions, and generally made Django that much better:\n     phil@produxion.net\n     phil.h.smith@gmail.com\n     Gustavo Picon\n+    Travis Pinney\n     Michael Placentra II <someone@michaelplacentra2.net>\n     plisk\n     Daniel Poelzleithner <http://poelzi.org/>\n@@ -499,6 +501,7 @@ answer newbie questions, and generally made Django that much better:\n     Wiliam Alves de Souza <wiliamsouza83@gmail.com>\n     Don Spaulding <donspauldingii@gmail.com>\n     Calvin Spealman <ironfroggy@gmail.com>\n+    Dane Springmeyer\n     Bj√∏rn Stabell <bjorn@exoweb.net>\n     Georgi Stanojevski <glisha@gmail.com>\n     starrynight <cmorgh@gmail.com>"
        },
        {
            "sha": "3b1734157d9c1e2bca79323a2c713146580b51d0",
            "filename": "CONTRIBUTING.rst",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/CONTRIBUTING.rst",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/CONTRIBUTING.rst",
            "contents_url": "https://api.github.com/repos/django/django/contents/CONTRIBUTING.rst?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,16 @@\n+======================\n+Contributing to Django\n+======================\n+\n+As an open source project, Django welcomes contributions of many forms.\n+\n+Examples of contributions include:\n+\n+* Code patches\n+* Documentation improvements\n+* Bug reports and patch reviews\n+\n+Extensive contribution guidelines are available in the repository at\n+``docs/internals/contributing/``, or online at:\n+\n+https://docs.djangoproject.com/en/dev/internals/contributing/"
        },
        {
            "sha": "fbda541d22cf0a2d6e9b3b1549e27c29f1d18409",
            "filename": "MANIFEST.in",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/MANIFEST.in",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/MANIFEST.in",
            "contents_url": "https://api.github.com/repos/django/django/contents/MANIFEST.in?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -32,3 +32,5 @@ recursive-include django/contrib/gis/tests/geogapp/fixtures *\n recursive-include django/contrib/gis/tests/relatedapp/fixtures *\n recursive-include django/contrib/sitemaps/templates *\n recursive-include django/contrib/sitemaps/tests/templates *\n+recursive-exclude * __pycache__\n+recursive-exclude * *.py[co]"
        },
        {
            "sha": "1804c851bf29367db20aade2868e78e26a36e7f5",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 24,
            "deletions": 17,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -25,7 +25,7 @@ class LazySettings(LazyObject):\n     The user can manually configure settings prior to using them. Otherwise,\n     Django uses the settings module pointed to by DJANGO_SETTINGS_MODULE.\n     \"\"\"\n-    def _setup(self, name):\n+    def _setup(self, name=None):\n         \"\"\"\n         Load the settings module pointed to by the environment variable. This\n         is used the first time we need any settings at all, if the user has not\n@@ -36,20 +36,40 @@ def _setup(self, name):\n             if not settings_module: # If it's set but is an empty string.\n                 raise KeyError\n         except KeyError:\n+            desc = (\"setting %s\" % name) if name else \"settings\"\n             raise ImproperlyConfigured(\n-                \"Requested setting %s, but settings are not configured. \"\n+                \"Requested %s, but settings are not configured. \"\n                 \"You must either define the environment variable %s \"\n                 \"or call settings.configure() before accessing settings.\"\n-                % (name, ENVIRONMENT_VARIABLE))\n+                % (desc, ENVIRONMENT_VARIABLE))\n \n         self._wrapped = Settings(settings_module)\n-\n+        self._configure_logging()\n \n     def __getattr__(self, name):\n         if self._wrapped is empty:\n             self._setup(name)\n         return getattr(self._wrapped, name)\n \n+    def _configure_logging(self):\n+        \"\"\"\n+        Setup logging from LOGGING_CONFIG and LOGGING settings.\n+        \"\"\"\n+        if self.LOGGING_CONFIG:\n+            from django.utils.log import DEFAULT_LOGGING\n+            # First find the logging configuration function ...\n+            logging_config_path, logging_config_func_name = self.LOGGING_CONFIG.rsplit('.', 1)\n+            logging_config_module = importlib.import_module(logging_config_path)\n+            logging_config_func = getattr(logging_config_module, logging_config_func_name)\n+\n+            logging_config_func(DEFAULT_LOGGING)\n+\n+            if self.LOGGING:\n+                # Backwards-compatibility shim for #16288 fix\n+                compat_patch_logging_config(self.LOGGING)\n+\n+                # ... then invoke it with the logging settings\n+                logging_config_func(self.LOGGING)\n \n     def configure(self, default_settings=global_settings, **options):\n         \"\"\"\n@@ -133,19 +153,6 @@ def __init__(self, settings_module):\n             os.environ['TZ'] = self.TIME_ZONE\n             time.tzset()\n \n-        # Settings are configured, so we can set up the logger if required\n-        if self.LOGGING_CONFIG:\n-            # First find the logging configuration function ...\n-            logging_config_path, logging_config_func_name = self.LOGGING_CONFIG.rsplit('.', 1)\n-            logging_config_module = importlib.import_module(logging_config_path)\n-            logging_config_func = getattr(logging_config_module, logging_config_func_name)\n-\n-            # Backwards-compatibility shim for #16288 fix\n-            compat_patch_logging_config(self.LOGGING)\n-\n-            # ... then invoke it with the logging settings\n-            logging_config_func(self.LOGGING)\n-\n \n class UserSettingsHolder(BaseSettings):\n     \"\"\""
        },
        {
            "sha": "f1cbb22880f98bdb8f65d6d27f35a0b16664222a",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 5,
            "deletions": 28,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -144,7 +144,7 @@\n # Encoding of files read from disk (template and initial SQL files).\n FILE_CHARSET = 'utf-8'\n \n-# E-mail address that error messages come from.\n+# Email address that error messages come from.\n SERVER_EMAIL = 'root@localhost'\n \n # Whether to send broken-link emails.\n@@ -488,6 +488,8 @@\n # AUTHENTICATION #\n ##################\n \n+AUTH_USER_MODEL = 'auth.User'\n+\n AUTHENTICATION_BACKENDS = ('django.contrib.auth.backends.ModelBackend',)\n \n LOGIN_URL = '/accounts/login/'\n@@ -549,33 +551,8 @@\n # The callable to use to configure logging\n LOGGING_CONFIG = 'django.utils.log.dictConfig'\n \n-# The default logging configuration. This sends an email to\n-# the site admins on every HTTP 500 error. All other log\n-# records are sent to the bit bucket.\n-\n-LOGGING = {\n-    'version': 1,\n-    'disable_existing_loggers': False,\n-    'filters': {\n-        'require_debug_false': {\n-            '()': 'django.utils.log.RequireDebugFalse',\n-        }\n-    },\n-    'handlers': {\n-        'mail_admins': {\n-            'level': 'ERROR',\n-            'filters': ['require_debug_false'],\n-            'class': 'django.utils.log.AdminEmailHandler'\n-        }\n-    },\n-    'loggers': {\n-        'django.request': {\n-            'handlers': ['mail_admins'],\n-            'level': 'ERROR',\n-            'propagate': True,\n-        },\n-    }\n-}\n+# Custom logging configuration.\n+LOGGING = {}\n \n # Default exception reporter filter class used in case none has been\n # specifically assigned to the HttpRequest instance."
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/conf/locale/de_CH/__init__.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Flocale%2Fde_CH%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Flocale%2Fde_CH%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fde_CH%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "previous_filename": "tests/regressiontests/localflavor/ar/__init__.py"
        },
        {
            "sha": "7cbf76e7dbd320b75f23473ce2a9b5210588a3c5",
            "filename": "django/conf/locale/de_CH/formats.py",
            "status": "renamed",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Flocale%2Fde_CH%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Flocale%2Fde_CH%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fde_CH%2Fformats.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -35,7 +35,7 @@\n     '%Y-%m-%d',             # '2006-10-25'\n )\n \n-# these are the separators for non-monetary numbers. For monetary numbers, \n+# these are the separators for non-monetary numbers. For monetary numbers,\n # the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a\n # ' (single quote).\n # For details, please refer to http://www.bk.admin.ch/dokumentation/sprachen/04915/05016/index.html?lang=de",
            "previous_filename": "django/contrib/localflavor/de_CH/formats.py"
        },
        {
            "sha": "1e301665c6e7e5347d6c22e459e27209e8f83409",
            "filename": "django/conf/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 139,
            "deletions": 153,
            "changes": 292,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:29+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:55+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -297,385 +297,386 @@ msgstr \"\"\n msgid \"Traditional Chinese\"\n msgstr \"\"\n \n-#: core/validators.py:24 forms/fields.py:51\n+#: core/validators.py:21 forms/fields.py:52\n msgid \"Enter a valid value.\"\n msgstr \"\"\n \n-#: core/validators.py:99 forms/fields.py:601\n-msgid \"This URL appears to be a broken link.\"\n+#: core/validators.py:104 forms/fields.py:464\n+msgid \"Enter a valid email address.\"\n msgstr \"\"\n \n-#: core/validators.py:131 forms/fields.py:600\n-msgid \"Enter a valid URL.\"\n-msgstr \"\"\n-\n-#: core/validators.py:165 forms/fields.py:474\n-msgid \"Enter a valid e-mail address.\"\n-msgstr \"\"\n-\n-#: core/validators.py:168 forms/fields.py:1023\n+#: core/validators.py:107 forms/fields.py:1013\n msgid \"\"\n \"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"\n msgstr \"\"\n \n-#: core/validators.py:171 core/validators.py:188 forms/fields.py:997\n+#: core/validators.py:110 core/validators.py:129 forms/fields.py:987\n msgid \"Enter a valid IPv4 address.\"\n msgstr \"\"\n \n-#: core/validators.py:175 core/validators.py:189\n+#: core/validators.py:115 core/validators.py:130\n msgid \"Enter a valid IPv6 address.\"\n msgstr \"\"\n \n-#: core/validators.py:184 core/validators.py:187\n+#: core/validators.py:125 core/validators.py:128\n msgid \"Enter a valid IPv4 or IPv6 address.\"\n msgstr \"\"\n \n-#: core/validators.py:209 db/models/fields/__init__.py:638\n+#: core/validators.py:151 db/models/fields/__init__.py:655\n msgid \"Enter only digits separated by commas.\"\n msgstr \"\"\n \n-#: core/validators.py:215\n+#: core/validators.py:157\n #, python-format\n msgid \"Ensure this value is %(limit_value)s (it is %(show_value)s).\"\n msgstr \"\"\n \n-#: core/validators.py:233 forms/fields.py:209 forms/fields.py:262\n+#: core/validators.py:176 forms/fields.py:210 forms/fields.py:263\n #, python-format\n msgid \"Ensure this value is less than or equal to %(limit_value)s.\"\n msgstr \"\"\n \n-#: core/validators.py:238 forms/fields.py:210 forms/fields.py:263\n+#: core/validators.py:182 forms/fields.py:211 forms/fields.py:264\n #, python-format\n msgid \"Ensure this value is greater than or equal to %(limit_value)s.\"\n msgstr \"\"\n \n-#: core/validators.py:244\n+#: core/validators.py:189\n #, python-format\n msgid \"\"\n \"Ensure this value has at least %(limit_value)d characters (it has \"\n \"%(show_value)d).\"\n msgstr \"\"\n \n-#: core/validators.py:250\n+#: core/validators.py:196\n #, python-format\n msgid \"\"\n \"Ensure this value has at most %(limit_value)d characters (it has \"\n \"%(show_value)d).\"\n msgstr \"\"\n \n-#: db/models/base.py:764\n+#: db/models/base.py:843\n #, python-format\n msgid \"%(field_name)s must be unique for %(date_field)s %(lookup)s.\"\n msgstr \"\"\n \n-#: db/models/base.py:787 forms/models.py:577\n+#: db/models/base.py:866 forms/models.py:573\n msgid \"and\"\n msgstr \"\"\n \n-#: db/models/base.py:788 db/models/fields/__init__.py:65\n+#: db/models/base.py:867 db/models/fields/__init__.py:70\n #, python-format\n msgid \"%(model_name)s with this %(field_label)s already exists.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:62\n+#: db/models/fields/__init__.py:67\n #, python-format\n msgid \"Value %r is not a valid choice.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:63\n+#: db/models/fields/__init__.py:68\n msgid \"This field cannot be null.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:64\n+#: db/models/fields/__init__.py:69\n msgid \"This field cannot be blank.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:71\n+#: db/models/fields/__init__.py:76\n #, python-format\n msgid \"Field of type: %(field_type)s\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:506 db/models/fields/__init__.py:961\n+#: db/models/fields/__init__.py:517 db/models/fields/__init__.py:985\n msgid \"Integer\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:510 db/models/fields/__init__.py:959\n+#: db/models/fields/__init__.py:521 db/models/fields/__init__.py:983\n #, python-format\n msgid \"'%s' value must be an integer.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:552\n+#: db/models/fields/__init__.py:569\n #, python-format\n msgid \"'%s' value must be either True or False.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:554\n+#: db/models/fields/__init__.py:571\n msgid \"Boolean (Either True or False)\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:605\n+#: db/models/fields/__init__.py:622\n #, python-format\n msgid \"String (up to %(max_length)s)\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:633\n+#: db/models/fields/__init__.py:650\n msgid \"Comma-separated integers\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:647\n+#: db/models/fields/__init__.py:664\n #, python-format\n msgid \"'%s' value has an invalid date format. It must be in YYYY-MM-DD format.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:649 db/models/fields/__init__.py:734\n+#: db/models/fields/__init__.py:666 db/models/fields/__init__.py:754\n #, python-format\n msgid \"\"\n \"'%s' value has the correct format (YYYY-MM-DD) but it is an invalid date.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:652\n+#: db/models/fields/__init__.py:669\n msgid \"Date (without time)\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:732\n+#: db/models/fields/__init__.py:752\n #, python-format\n msgid \"\"\n \"'%s' value has an invalid format. It must be in YYYY-MM-DD HH:MM[:ss[.\"\n \"uuuuuu]][TZ] format.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:736\n+#: db/models/fields/__init__.py:756\n #, python-format\n msgid \"\"\n \"'%s' value has the correct format (YYYY-MM-DD HH:MM[:ss[.uuuuuu]][TZ]) but \"\n \"it is an invalid date/time.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:740\n+#: db/models/fields/__init__.py:760\n msgid \"Date (with time)\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:831\n+#: db/models/fields/__init__.py:849\n #, python-format\n msgid \"'%s' value must be a decimal number.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:833\n+#: db/models/fields/__init__.py:851\n msgid \"Decimal number\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:890\n-msgid \"E-mail address\"\n+#: db/models/fields/__init__.py:908\n+msgid \"Email address\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:906\n+#: db/models/fields/__init__.py:927\n msgid \"File path\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:930\n+#: db/models/fields/__init__.py:954\n #, python-format\n msgid \"'%s' value must be a float.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:932\n+#: db/models/fields/__init__.py:956\n msgid \"Floating point number\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:993\n+#: db/models/fields/__init__.py:1017\n msgid \"Big (8 byte) integer\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1007\n+#: db/models/fields/__init__.py:1031\n msgid \"IPv4 address\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1023\n+#: db/models/fields/__init__.py:1047\n msgid \"IP address\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1065\n+#: db/models/fields/__init__.py:1090\n #, python-format\n msgid \"'%s' value must be either None, True or False.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1067\n+#: db/models/fields/__init__.py:1092\n msgid \"Boolean (Either True, False or None)\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1116\n+#: db/models/fields/__init__.py:1141\n msgid \"Positive integer\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1127\n+#: db/models/fields/__init__.py:1152\n msgid \"Positive small integer\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1138\n+#: db/models/fields/__init__.py:1163\n #, python-format\n msgid \"Slug (up to %(max_length)s)\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1156\n+#: db/models/fields/__init__.py:1181\n msgid \"Small integer\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1162\n+#: db/models/fields/__init__.py:1187\n msgid \"Text\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1180\n+#: db/models/fields/__init__.py:1205\n #, python-format\n msgid \"\"\n \"'%s' value has an invalid format. It must be in HH:MM[:ss[.uuuuuu]] format.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1182\n+#: db/models/fields/__init__.py:1207\n #, python-format\n msgid \"\"\n \"'%s' value has the correct format (HH:MM[:ss[.uuuuuu]]) but it is an invalid \"\n \"time.\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1185\n+#: db/models/fields/__init__.py:1210\n msgid \"Time\"\n msgstr \"\"\n \n-#: db/models/fields/__init__.py:1249\n+#: db/models/fields/__init__.py:1272\n msgid \"URL\"\n msgstr \"\"\n \n-#: db/models/fields/files.py:214\n+#: db/models/fields/files.py:211\n+#, python-format\n+msgid \"Filename is %(extra)d characters too long.\"\n+msgstr \"\"\n+\n+#: db/models/fields/files.py:221\n msgid \"File\"\n msgstr \"\"\n \n-#: db/models/fields/files.py:321\n+#: db/models/fields/files.py:347\n msgid \"Image\"\n msgstr \"\"\n \n-#: db/models/fields/related.py:903\n+#: db/models/fields/related.py:950\n #, python-format\n msgid \"Model %(model)s with pk %(pk)r does not exist.\"\n msgstr \"\"\n \n-#: db/models/fields/related.py:905\n+#: db/models/fields/related.py:952\n msgid \"Foreign Key (type determined by related field)\"\n msgstr \"\"\n \n-#: db/models/fields/related.py:1033\n+#: db/models/fields/related.py:1082\n msgid \"One-to-one relationship\"\n msgstr \"\"\n \n-#: db/models/fields/related.py:1096\n+#: db/models/fields/related.py:1149\n msgid \"Many-to-many relationship\"\n msgstr \"\"\n \n-#: db/models/fields/related.py:1120\n+#: db/models/fields/related.py:1174\n msgid \"\"\n \"Hold down \\\"Control\\\", or \\\"Command\\\" on a Mac, to select more than one.\"\n msgstr \"\"\n \n-#: forms/fields.py:50\n+#: forms/fields.py:51\n msgid \"This field is required.\"\n msgstr \"\"\n \n-#: forms/fields.py:208\n+#: forms/fields.py:209\n msgid \"Enter a whole number.\"\n msgstr \"\"\n \n-#: forms/fields.py:240 forms/fields.py:261\n+#: forms/fields.py:241 forms/fields.py:262\n msgid \"Enter a number.\"\n msgstr \"\"\n \n-#: forms/fields.py:264\n+#: forms/fields.py:265\n #, python-format\n msgid \"Ensure that there are no more than %s digits in total.\"\n msgstr \"\"\n \n-#: forms/fields.py:265\n+#: forms/fields.py:266\n #, python-format\n msgid \"Ensure that there are no more than %s decimal places.\"\n msgstr \"\"\n \n-#: forms/fields.py:266\n+#: forms/fields.py:267\n #, python-format\n msgid \"Ensure that there are no more than %s digits before the decimal point.\"\n msgstr \"\"\n \n-#: forms/fields.py:365 forms/fields.py:963\n+#: forms/fields.py:355 forms/fields.py:953\n msgid \"Enter a valid date.\"\n msgstr \"\"\n \n-#: forms/fields.py:388 forms/fields.py:964\n+#: forms/fields.py:378 forms/fields.py:954\n msgid \"Enter a valid time.\"\n msgstr \"\"\n \n-#: forms/fields.py:409\n+#: forms/fields.py:399\n msgid \"Enter a valid date/time.\"\n msgstr \"\"\n \n-#: forms/fields.py:485\n+#: forms/fields.py:475\n msgid \"No file was submitted. Check the encoding type on the form.\"\n msgstr \"\"\n \n-#: forms/fields.py:486\n+#: forms/fields.py:476\n msgid \"No file was submitted.\"\n msgstr \"\"\n \n-#: forms/fields.py:487\n+#: forms/fields.py:477\n msgid \"The submitted file is empty.\"\n msgstr \"\"\n \n-#: forms/fields.py:488\n+#: forms/fields.py:478\n #, python-format\n msgid \"\"\n \"Ensure this filename has at most %(max)d characters (it has %(length)d).\"\n msgstr \"\"\n \n-#: forms/fields.py:489\n+#: forms/fields.py:479\n msgid \"Please either submit a file or check the clear checkbox, not both.\"\n msgstr \"\"\n \n-#: forms/fields.py:544\n+#: forms/fields.py:534\n msgid \"\"\n \"Upload a valid image. The file you uploaded was either not an image or a \"\n \"corrupted image.\"\n msgstr \"\"\n \n-#: forms/fields.py:689 forms/fields.py:769\n+#: forms/fields.py:580\n+msgid \"Enter a valid URL.\"\n+msgstr \"\"\n+\n+#: forms/fields.py:666 forms/fields.py:746\n #, python-format\n msgid \"Select a valid choice. %(value)s is not one of the available choices.\"\n msgstr \"\"\n \n-#: forms/fields.py:770 forms/fields.py:858 forms/models.py:999\n+#: forms/fields.py:747 forms/fields.py:835 forms/models.py:999\n msgid \"Enter a list of values.\"\n msgstr \"\"\n \n-#: forms/formsets.py:317 forms/formsets.py:319\n+#: forms/formsets.py:323 forms/formsets.py:325\n msgid \"Order\"\n msgstr \"\"\n \n-#: forms/formsets.py:321\n+#: forms/formsets.py:327\n msgid \"Delete\"\n msgstr \"\"\n \n-#: forms/models.py:571\n+#: forms/models.py:567\n #, python-format\n msgid \"Please correct the duplicate data for %(field)s.\"\n msgstr \"\"\n \n-#: forms/models.py:575\n+#: forms/models.py:571\n #, python-format\n msgid \"Please correct the duplicate data for %(field)s, which must be unique.\"\n msgstr \"\"\n \n-#: forms/models.py:581\n+#: forms/models.py:577\n #, python-format\n msgid \"\"\n \"Please correct the duplicate data for %(field_name)s which must be unique \"\n \"for the %(lookup)s in %(date_field)s.\"\n msgstr \"\"\n \n-#: forms/models.py:589\n+#: forms/models.py:585\n msgid \"Please correct the duplicate values below.\"\n msgstr \"\"\n \n@@ -697,94 +698,94 @@ msgstr \"\"\n msgid \"\\\"%s\\\" is not a valid value for a primary key.\"\n msgstr \"\"\n \n-#: forms/util.py:70\n+#: forms/util.py:81\n #, python-format\n msgid \"\"\n \"%(datetime)s couldn't be interpreted in time zone %(current_timezone)s; it \"\n \"may be ambiguous or it may not exist.\"\n msgstr \"\"\n \n-#: forms/widgets.py:325\n+#: forms/widgets.py:336\n msgid \"Currently\"\n msgstr \"\"\n \n-#: forms/widgets.py:326\n+#: forms/widgets.py:337\n msgid \"Change\"\n msgstr \"\"\n \n-#: forms/widgets.py:327\n+#: forms/widgets.py:338\n msgid \"Clear\"\n msgstr \"\"\n \n-#: forms/widgets.py:582\n+#: forms/widgets.py:591\n msgid \"Unknown\"\n msgstr \"\"\n \n-#: forms/widgets.py:583\n+#: forms/widgets.py:592\n msgid \"Yes\"\n msgstr \"\"\n \n-#: forms/widgets.py:584\n+#: forms/widgets.py:593\n msgid \"No\"\n msgstr \"\"\n \n-#: template/defaultfilters.py:797\n+#: template/defaultfilters.py:794\n msgid \"yes,no,maybe\"\n msgstr \"\"\n \n-#: template/defaultfilters.py:825 template/defaultfilters.py:830\n+#: template/defaultfilters.py:822 template/defaultfilters.py:833\n #, python-format\n msgid \"%(size)d byte\"\n msgid_plural \"%(size)d bytes\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: template/defaultfilters.py:832\n+#: template/defaultfilters.py:835\n #, python-format\n msgid \"%s KB\"\n msgstr \"\"\n \n-#: template/defaultfilters.py:834\n+#: template/defaultfilters.py:837\n #, python-format\n msgid \"%s MB\"\n msgstr \"\"\n \n-#: template/defaultfilters.py:836\n+#: template/defaultfilters.py:839\n #, python-format\n msgid \"%s GB\"\n msgstr \"\"\n \n-#: template/defaultfilters.py:838\n+#: template/defaultfilters.py:841\n #, python-format\n msgid \"%s TB\"\n msgstr \"\"\n \n-#: template/defaultfilters.py:839\n+#: template/defaultfilters.py:842\n #, python-format\n msgid \"%s PB\"\n msgstr \"\"\n \n-#: utils/dateformat.py:45\n+#: utils/dateformat.py:47\n msgid \"p.m.\"\n msgstr \"\"\n \n-#: utils/dateformat.py:46\n+#: utils/dateformat.py:48\n msgid \"a.m.\"\n msgstr \"\"\n \n-#: utils/dateformat.py:51\n+#: utils/dateformat.py:53\n msgid \"PM\"\n msgstr \"\"\n \n-#: utils/dateformat.py:52\n+#: utils/dateformat.py:54\n msgid \"AM\"\n msgstr \"\"\n \n-#: utils/dateformat.py:101\n+#: utils/dateformat.py:103\n msgid \"midnight\"\n msgstr \"\"\n \n-#: utils/dateformat.py:103\n+#: utils/dateformat.py:105\n msgid \"noon\"\n msgstr \"\"\n \n@@ -1060,148 +1061,133 @@ msgctxt \"alt. month\"\n msgid \"December\"\n msgstr \"\"\n \n-#: utils/text.py:65\n+#: utils/text.py:70\n #, python-format\n msgctxt \"String to return when truncating text\"\n msgid \"%(truncated_text)s...\"\n msgstr \"\"\n \n-#: utils/text.py:234\n+#: utils/text.py:239\n msgid \"or\"\n msgstr \"\"\n \n #. Translators: This string is used as a separator between list elements\n-#: utils/text.py:251\n+#: utils/text.py:256\n msgid \", \"\n msgstr \"\"\n \n-#: utils/timesince.py:20\n+#: utils/timesince.py:22\n msgid \"year\"\n msgid_plural \"years\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: utils/timesince.py:21\n+#: utils/timesince.py:23\n msgid \"month\"\n msgid_plural \"months\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: utils/timesince.py:22\n+#: utils/timesince.py:24\n msgid \"week\"\n msgid_plural \"weeks\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: utils/timesince.py:23\n+#: utils/timesince.py:25\n msgid \"day\"\n msgid_plural \"days\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: utils/timesince.py:24\n+#: utils/timesince.py:26\n msgid \"hour\"\n msgid_plural \"hours\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: utils/timesince.py:25\n+#: utils/timesince.py:27\n msgid \"minute\"\n msgid_plural \"minutes\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: utils/timesince.py:41\n+#: utils/timesince.py:43\n msgid \"minutes\"\n msgstr \"\"\n \n-#: utils/timesince.py:46\n+#: utils/timesince.py:48\n #, python-format\n msgid \"%(number)d %(type)s\"\n msgstr \"\"\n \n-#: utils/timesince.py:52\n+#: utils/timesince.py:54\n #, python-format\n msgid \", %(number)d %(type)s\"\n msgstr \"\"\n \n-#: views/static.py:52\n+#: views/static.py:55\n msgid \"Directory indexes are not allowed here.\"\n msgstr \"\"\n \n-#: views/static.py:54\n+#: views/static.py:57\n #, python-format\n msgid \"\\\"%(path)s\\\" does not exist\"\n msgstr \"\"\n \n-#: views/static.py:95\n+#: views/static.py:98\n #, python-format\n msgid \"Index of %(directory)s\"\n msgstr \"\"\n \n-#: views/generic/create_update.py:121\n-#, python-format\n-msgid \"The %(verbose_name)s was created successfully.\"\n-msgstr \"\"\n-\n-#: views/generic/create_update.py:164\n-#, python-format\n-msgid \"The %(verbose_name)s was updated successfully.\"\n-msgstr \"\"\n-\n-#: views/generic/create_update.py:207\n-#, python-format\n-msgid \"The %(verbose_name)s was deleted.\"\n-msgstr \"\"\n-\n-#: views/generic/dates.py:33\n+#: views/generic/dates.py:42\n msgid \"No year specified\"\n msgstr \"\"\n \n-#: views/generic/dates.py:58\n+#: views/generic/dates.py:98\n msgid \"No month specified\"\n msgstr \"\"\n \n-#: views/generic/dates.py:99\n+#: views/generic/dates.py:157\n msgid \"No day specified\"\n msgstr \"\"\n \n-#: views/generic/dates.py:138\n+#: views/generic/dates.py:213\n msgid \"No week specified\"\n msgstr \"\"\n \n-#: views/generic/dates.py:198 views/generic/dates.py:215\n+#: views/generic/dates.py:368 views/generic/dates.py:393\n #, python-format\n msgid \"No %(verbose_name_plural)s available\"\n msgstr \"\"\n \n-#: views/generic/dates.py:467\n+#: views/generic/dates.py:646\n #, python-format\n msgid \"\"\n \"Future %(verbose_name_plural)s not available because %(class_name)s.\"\n \"allow_future is False.\"\n msgstr \"\"\n \n-#: views/generic/dates.py:501\n+#: views/generic/dates.py:678\n #, python-format\n msgid \"Invalid date string '%(datestr)s' given format '%(format)s'\"\n msgstr \"\"\n \n-#: views/generic/detail.py:51\n+#: views/generic/detail.py:54\n #, python-format\n msgid \"No %(verbose_name)s found matching the query\"\n msgstr \"\"\n \n-#: views/generic/list.py:45\n+#: views/generic/list.py:49\n msgid \"Page is not 'last', nor can it be converted to an int.\"\n msgstr \"\"\n \n-#: views/generic/list.py:50\n+#: views/generic/list.py:54\n #, python-format\n msgid \"Invalid page (%(page_number)s)\"\n msgstr \"\"\n \n-#: views/generic/list.py:117\n+#: views/generic/list.py:134\n #, python-format\n msgid \"Empty list and '%(class_name)s.allow_empty' is False.\"\n msgstr \"\""
        },
        {
            "sha": "f768265b23bb3b838fd2e21a9414dbd4fb187325",
            "filename": "django/conf/project_template/project_name/wsgi.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Fproject_template%2Fproject_name%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fconf%2Fproject_template%2Fproject_name%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fproject_name%2Fwsgi.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -15,6 +15,10 @@\n \"\"\"\n import os\n \n+# We defer to a DJANGO_SETTINGS_MODULE already in the environment. This breaks\n+# if running multiple sites in the same mod_wsgi process. To fix this, use\n+# mod_wsgi daemon mode with each site in its own daemon process, or use\n+# os.environ[\"DJANGO_SETTINGS_MODULE\"] = \"{{ project_name }}.settings\"\n os.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"{{ project_name }}.settings\")\n \n # This application object is used by any WSGI server configured to use this"
        },
        {
            "sha": "f1e7076ece03362a6071f34c984b84d35e5800c2",
            "filename": "django/contrib/admin/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 13,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fforms.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,12 +4,12 @@\n \n from django.contrib.auth import authenticate\n from django.contrib.auth.forms import AuthenticationForm\n-from django.contrib.auth.models import User\n-from django.utils.translation import ugettext_lazy, ugettext as _\n+from django.utils.translation import ugettext_lazy\n \n ERROR_MESSAGE = ugettext_lazy(\"Please enter the correct username and password \"\n         \"for a staff account. Note that both fields are case-sensitive.\")\n \n+\n class AdminAuthenticationForm(AuthenticationForm):\n     \"\"\"\n     A custom authentication form used in the admin app.\n@@ -26,17 +26,6 @@ def clean(self):\n         if username and password:\n             self.user_cache = authenticate(username=username, password=password)\n             if self.user_cache is None:\n-                if '@' in username:\n-                    # Mistakenly entered e-mail address instead of username? Look it up.\n-                    try:\n-                        user = User.objects.get(email=username)\n-                    except (User.DoesNotExist, User.MultipleObjectsReturned):\n-                        # Nothing to do here, moving along.\n-                        pass\n-                    else:\n-                        if user.check_password(password):\n-                            message = _(\"Your e-mail address is not your username.\"\n-                                        \" Try '%s' instead.\") % user.username\n                 raise forms.ValidationError(message)\n             elif not self.user_cache.is_active or not self.user_cache.is_staff:\n                 raise forms.ValidationError(message)"
        },
        {
            "sha": "497c7463c27b79a28fc9227c8e16c01128bdca4d",
            "filename": "django/contrib/admin/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 168,
            "deletions": 177,
            "changes": 345,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:34+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -32,39 +32,39 @@ msgstr \"\"\n msgid \"Delete selected %(verbose_name_plural)s\"\n msgstr \"\"\n \n-#: filters.py:101 filters.py:191 filters.py:231 filters.py:268 filters.py:378\n+#: filters.py:101 filters.py:197 filters.py:237 filters.py:274 filters.py:380\n msgid \"All\"\n msgstr \"\"\n \n-#: filters.py:232\n+#: filters.py:238\n msgid \"Yes\"\n msgstr \"\"\n \n-#: filters.py:233\n+#: filters.py:239\n msgid \"No\"\n msgstr \"\"\n \n-#: filters.py:247\n+#: filters.py:253\n msgid \"Unknown\"\n msgstr \"\"\n \n-#: filters.py:306\n+#: filters.py:308\n msgid \"Any date\"\n msgstr \"\"\n \n-#: filters.py:307\n+#: filters.py:309\n msgid \"Today\"\n msgstr \"\"\n \n-#: filters.py:311\n+#: filters.py:313\n msgid \"Past 7 days\"\n msgstr \"\"\n \n-#: filters.py:315\n+#: filters.py:317\n msgid \"This month\"\n msgstr \"\"\n \n-#: filters.py:319\n+#: filters.py:321\n msgid \"This year\"\n msgstr \"\"\n \n@@ -74,134 +74,129 @@ msgid \"\"\n \"that both fields are case-sensitive.\"\n msgstr \"\"\n \n-#: forms.py:18\n+#: forms.py:19\n msgid \"Please log in again, because your session has expired.\"\n msgstr \"\"\n \n-#: forms.py:37\n-#, python-format\n-msgid \"Your e-mail address is not your username. Try '%s' instead.\"\n-msgstr \"\"\n-\n-#: helpers.py:20\n+#: helpers.py:23\n msgid \"Action:\"\n msgstr \"\"\n \n-#: models.py:19\n+#: models.py:24\n msgid \"action time\"\n msgstr \"\"\n \n-#: models.py:22\n+#: models.py:27\n msgid \"object id\"\n msgstr \"\"\n \n-#: models.py:23\n+#: models.py:28\n msgid \"object repr\"\n msgstr \"\"\n \n-#: models.py:24\n+#: models.py:29\n msgid \"action flag\"\n msgstr \"\"\n \n-#: models.py:25\n+#: models.py:30\n msgid \"change message\"\n msgstr \"\"\n \n-#: models.py:30\n+#: models.py:35\n msgid \"log entry\"\n msgstr \"\"\n \n-#: models.py:31\n+#: models.py:36\n msgid \"log entries\"\n msgstr \"\"\n \n-#: models.py:40\n+#: models.py:45\n #, python-format\n msgid \"Added \\\"%(object)s\\\".\"\n msgstr \"\"\n \n-#: models.py:42\n+#: models.py:47\n #, python-format\n msgid \"Changed \\\"%(object)s\\\" - %(changes)s\"\n msgstr \"\"\n \n-#: models.py:44\n+#: models.py:49\n #, python-format\n msgid \"Deleted \\\"%(object)s.\\\"\"\n msgstr \"\"\n \n-#: models.py:46\n+#: models.py:51\n msgid \"LogEntry Object\"\n msgstr \"\"\n \n-#: options.py:150 options.py:166\n+#: options.py:151 options.py:167\n msgid \"None\"\n msgstr \"\"\n \n-#: options.py:671\n+#: options.py:672\n #, python-format\n msgid \"Changed %s.\"\n msgstr \"\"\n \n-#: options.py:671 options.py:681\n+#: options.py:672 options.py:682\n msgid \"and\"\n msgstr \"\"\n \n-#: options.py:676\n+#: options.py:677\n #, python-format\n msgid \"Added %(name)s \\\"%(object)s\\\".\"\n msgstr \"\"\n \n-#: options.py:680\n+#: options.py:681\n #, python-format\n msgid \"Changed %(list)s for %(name)s \\\"%(object)s\\\".\"\n msgstr \"\"\n \n-#: options.py:685\n+#: options.py:686\n #, python-format\n msgid \"Deleted %(name)s \\\"%(object)s\\\".\"\n msgstr \"\"\n \n-#: options.py:689\n+#: options.py:690\n msgid \"No fields changed.\"\n msgstr \"\"\n \n-#: options.py:772\n+#: options.py:773\n #, python-format\n msgid \"The %(name)s \\\"%(obj)s\\\" was added successfully.\"\n msgstr \"\"\n \n-#: options.py:776 options.py:824\n+#: options.py:777 options.py:825\n msgid \"You may edit it again below.\"\n msgstr \"\"\n \n-#: options.py:788 options.py:837\n+#: options.py:789 options.py:838\n #, python-format\n msgid \"You may add another %s below.\"\n msgstr \"\"\n \n-#: options.py:822\n+#: options.py:823\n #, python-format\n msgid \"The %(name)s \\\"%(obj)s\\\" was changed successfully.\"\n msgstr \"\"\n \n-#: options.py:830\n+#: options.py:831\n #, python-format\n msgid \"\"\n \"The %(name)s \\\"%(obj)s\\\" was added successfully. You may edit it again below.\"\n msgstr \"\"\n \n-#: options.py:899 options.py:1159\n+#: options.py:900 options.py:1159\n msgid \"\"\n \"Items must be selected in order to perform actions on them. No items have \"\n \"been changed.\"\n msgstr \"\"\n \n-#: options.py:918\n+#: options.py:919\n msgid \"No action selected.\"\n msgstr \"\"\n \n-#: options.py:998\n+#: options.py:999\n #, python-format\n msgid \"Add %s\"\n msgstr \"\"\n@@ -249,34 +244,34 @@ msgstr \"\"\n msgid \"Change history: %s\"\n msgstr \"\"\n \n-#: sites.py:315 tests.py:61 templates/admin/login.html:49\n-#: templates/registration/password_reset_complete.html:20\n-#: views/decorators.py:23\n+#: sites.py:322 tests.py:57 templates/admin/login.html:48\n+#: templates/registration/password_reset_complete.html:19\n+#: views/decorators.py:24\n msgid \"Log in\"\n msgstr \"\"\n \n-#: sites.py:380\n+#: sites.py:388\n msgid \"Site administration\"\n msgstr \"\"\n \n-#: sites.py:432\n+#: sites.py:440\n #, python-format\n msgid \"%s administration\"\n msgstr \"\"\n \n-#: widgets.py:87\n+#: widgets.py:90\n msgid \"Date:\"\n msgstr \"\"\n \n-#: widgets.py:87\n+#: widgets.py:91\n msgid \"Time:\"\n msgstr \"\"\n \n-#: widgets.py:161\n+#: widgets.py:165\n msgid \"Lookup\"\n msgstr \"\"\n \n-#: widgets.py:267\n+#: widgets.py:271\n msgid \"Add Another\"\n msgstr \"\"\n \n@@ -288,39 +283,39 @@ msgstr \"\"\n msgid \"We're sorry, but the requested page could not be found.\"\n msgstr \"\"\n \n-#: templates/admin/500.html:7 templates/admin/app_index.html:8\n-#: templates/admin/base.html:45 templates/admin/change_form.html:21\n-#: templates/admin/change_list.html:43\n-#: templates/admin/delete_confirmation.html:8\n-#: templates/admin/delete_selected_confirmation.html:8\n-#: templates/admin/invalid_setup.html:7 templates/admin/object_history.html:8\n-#: templates/admin/auth/user/change_password.html:15\n-#: templates/registration/logged_out.html:5\n-#: templates/registration/password_change_done.html:7\n-#: templates/registration/password_change_form.html:8\n-#: templates/registration/password_reset_complete.html:7\n-#: templates/registration/password_reset_confirm.html:7\n-#: templates/registration/password_reset_done.html:7\n-#: templates/registration/password_reset_form.html:7\n+#: templates/admin/500.html:6 templates/admin/app_index.html:7\n+#: templates/admin/base.html:47 templates/admin/change_form.html:19\n+#: templates/admin/change_list.html:41\n+#: templates/admin/delete_confirmation.html:7\n+#: templates/admin/delete_selected_confirmation.html:7\n+#: templates/admin/invalid_setup.html:6 templates/admin/object_history.html:7\n+#: templates/admin/auth/user/change_password.html:13\n+#: templates/registration/logged_out.html:4\n+#: templates/registration/password_change_done.html:6\n+#: templates/registration/password_change_form.html:7\n+#: templates/registration/password_reset_complete.html:6\n+#: templates/registration/password_reset_confirm.html:6\n+#: templates/registration/password_reset_done.html:6\n+#: templates/registration/password_reset_form.html:6\n msgid \"Home\"\n msgstr \"\"\n \n-#: templates/admin/500.html:8\n+#: templates/admin/500.html:7\n msgid \"Server error\"\n msgstr \"\"\n \n-#: templates/admin/500.html:12\n+#: templates/admin/500.html:11\n msgid \"Server error (500)\"\n msgstr \"\"\n \n-#: templates/admin/500.html:15\n+#: templates/admin/500.html:14\n msgid \"Server Error <em>(500)</em>\"\n msgstr \"\"\n \n-#: templates/admin/500.html:16\n+#: templates/admin/500.html:15\n msgid \"\"\n-\"There's been an error. It's been reported to the site administrators via e-\"\n-\"mail and should be fixed shortly. Thanks for your patience.\"\n+\"There's been an error. It's been reported to the site administrators via \"\n+\"email and should be fixed shortly. Thanks for your patience.\"\n msgstr \"\"\n \n #: templates/admin/actions.html:4\n@@ -344,7 +339,7 @@ msgstr \"\"\n msgid \"Clear selection\"\n msgstr \"\"\n \n-#: templates/admin/app_index.html:11 templates/admin/index.html:19\n+#: templates/admin/app_index.html:10 templates/admin/index.html:21\n #, python-format\n msgid \"%(name)s\"\n msgstr \"\"\n@@ -354,22 +349,22 @@ msgid \"Welcome,\"\n msgstr \"\"\n \n #: templates/admin/base.html:33\n-#: templates/registration/password_change_done.html:4\n-#: templates/registration/password_change_form.html:5\n+#: templates/registration/password_change_done.html:3\n+#: templates/registration/password_change_form.html:4\n msgid \"Documentation\"\n msgstr \"\"\n \n-#: templates/admin/base.html:35\n-#: templates/admin/auth/user/change_password.html:19\n-#: templates/admin/auth/user/change_password.html:53\n-#: templates/registration/password_change_done.html:4\n-#: templates/registration/password_change_form.html:5\n+#: templates/admin/base.html:36\n+#: templates/admin/auth/user/change_password.html:17\n+#: templates/admin/auth/user/change_password.html:51\n+#: templates/registration/password_change_done.html:3\n+#: templates/registration/password_change_form.html:4\n msgid \"Change password\"\n msgstr \"\"\n \n-#: templates/admin/base.html:36\n-#: templates/registration/password_change_done.html:4\n-#: templates/registration/password_change_form.html:5\n+#: templates/admin/base.html:38\n+#: templates/registration/password_change_done.html:3\n+#: templates/registration/password_change_form.html:4\n msgid \"Log out\"\n msgstr \"\"\n \n@@ -381,35 +376,35 @@ msgstr \"\"\n msgid \"Django administration\"\n msgstr \"\"\n \n-#: templates/admin/change_form.html:24 templates/admin/index.html:29\n+#: templates/admin/change_form.html:22 templates/admin/index.html:33\n msgid \"Add\"\n msgstr \"\"\n \n-#: templates/admin/change_form.html:34 templates/admin/object_history.html:12\n+#: templates/admin/change_form.html:32 templates/admin/object_history.html:11\n msgid \"History\"\n msgstr \"\"\n \n-#: templates/admin/change_form.html:35\n+#: templates/admin/change_form.html:33\n #: templates/admin/edit_inline/stacked.html:9\n #: templates/admin/edit_inline/tabular.html:30\n msgid \"View on site\"\n msgstr \"\"\n \n-#: templates/admin/change_form.html:46 templates/admin/change_list.html:69\n-#: templates/admin/login.html:18\n-#: templates/admin/auth/user/change_password.html:29\n-#: templates/registration/password_change_form.html:21\n+#: templates/admin/change_form.html:44 templates/admin/change_list.html:67\n+#: templates/admin/login.html:17\n+#: templates/admin/auth/user/change_password.html:27\n+#: templates/registration/password_change_form.html:20\n msgid \"Please correct the error below.\"\n msgid_plural \"Please correct the errors below.\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templates/admin/change_list.html:60\n+#: templates/admin/change_list.html:58\n #, python-format\n msgid \"Add %(name)s\"\n msgstr \"\"\n \n-#: templates/admin/change_list.html:80\n+#: templates/admin/change_list.html:78\n msgid \"Filter\"\n msgstr \"\"\n \n@@ -426,58 +421,58 @@ msgstr \"\"\n msgid \"Toggle sorting\"\n msgstr \"\"\n \n-#: templates/admin/delete_confirmation.html:12\n+#: templates/admin/delete_confirmation.html:11\n #: templates/admin/submit_line.html:4\n msgid \"Delete\"\n msgstr \"\"\n \n-#: templates/admin/delete_confirmation.html:19\n+#: templates/admin/delete_confirmation.html:18\n #, python-format\n msgid \"\"\n \"Deleting the %(object_name)s '%(escaped_object)s' would result in deleting \"\n \"related objects, but your account doesn't have permission to delete the \"\n \"following types of objects:\"\n msgstr \"\"\n \n-#: templates/admin/delete_confirmation.html:27\n+#: templates/admin/delete_confirmation.html:26\n #, python-format\n msgid \"\"\n \"Deleting the %(object_name)s '%(escaped_object)s' would require deleting the \"\n \"following protected related objects:\"\n msgstr \"\"\n \n-#: templates/admin/delete_confirmation.html:35\n+#: templates/admin/delete_confirmation.html:34\n #, python-format\n msgid \"\"\n \"Are you sure you want to delete the %(object_name)s \\\"%(escaped_object)s\\\"? \"\n \"All of the following related items will be deleted:\"\n msgstr \"\"\n \n-#: templates/admin/delete_confirmation.html:40\n-#: templates/admin/delete_selected_confirmation.html:45\n+#: templates/admin/delete_confirmation.html:39\n+#: templates/admin/delete_selected_confirmation.html:44\n msgid \"Yes, I'm sure\"\n msgstr \"\"\n \n-#: templates/admin/delete_selected_confirmation.html:11\n+#: templates/admin/delete_selected_confirmation.html:10\n msgid \"Delete multiple objects\"\n msgstr \"\"\n \n-#: templates/admin/delete_selected_confirmation.html:18\n+#: templates/admin/delete_selected_confirmation.html:17\n #, python-format\n msgid \"\"\n \"Deleting the selected %(objects_name)s would result in deleting related \"\n \"objects, but your account doesn't have permission to delete the following \"\n \"types of objects:\"\n msgstr \"\"\n \n-#: templates/admin/delete_selected_confirmation.html:26\n+#: templates/admin/delete_selected_confirmation.html:25\n #, python-format\n msgid \"\"\n \"Deleting the selected %(objects_name)s would require deleting the following \"\n \"protected related objects:\"\n msgstr \"\"\n \n-#: templates/admin/delete_selected_confirmation.html:34\n+#: templates/admin/delete_selected_confirmation.html:33\n #, python-format\n msgid \"\"\n \"Are you sure you want to delete the selected %(objects_name)s? All of the \"\n@@ -489,67 +484,63 @@ msgstr \"\"\n msgid \" By %(filter_title)s \"\n msgstr \"\"\n \n-#: templates/admin/index.html:18\n+#: templates/admin/index.html:20\n #, python-format\n-msgid \"Models available in the %(name)s application.\"\n+msgid \"Models in the %(name)s application\"\n msgstr \"\"\n \n-#: templates/admin/index.html:35\n+#: templates/admin/index.html:39\n msgid \"Change\"\n msgstr \"\"\n \n-#: templates/admin/index.html:45\n+#: templates/admin/index.html:49\n msgid \"You don't have permission to edit anything.\"\n msgstr \"\"\n \n-#: templates/admin/index.html:53\n+#: templates/admin/index.html:57\n msgid \"Recent Actions\"\n msgstr \"\"\n \n-#: templates/admin/index.html:54\n+#: templates/admin/index.html:58\n msgid \"My Actions\"\n msgstr \"\"\n \n-#: templates/admin/index.html:58\n+#: templates/admin/index.html:62\n msgid \"None available\"\n msgstr \"\"\n \n-#: templates/admin/index.html:72\n+#: templates/admin/index.html:76\n msgid \"Unknown content\"\n msgstr \"\"\n \n-#: templates/admin/invalid_setup.html:13\n+#: templates/admin/invalid_setup.html:12\n msgid \"\"\n \"Something's wrong with your database installation. Make sure the appropriate \"\n \"database tables have been created, and make sure the database is readable by \"\n \"the appropriate user.\"\n msgstr \"\"\n \n-#: templates/admin/login.html:34\n-msgid \"Username:\"\n-msgstr \"\"\n-\n-#: templates/admin/login.html:38\n+#: templates/admin/login.html:37\n msgid \"Password:\"\n msgstr \"\"\n \n-#: templates/admin/login.html:45\n+#: templates/admin/login.html:44\n msgid \"Forgotten your password or username?\"\n msgstr \"\"\n \n-#: templates/admin/object_history.html:24\n+#: templates/admin/object_history.html:23\n msgid \"Date/time\"\n msgstr \"\"\n \n-#: templates/admin/object_history.html:25\n+#: templates/admin/object_history.html:24\n msgid \"User\"\n msgstr \"\"\n \n-#: templates/admin/object_history.html:26\n+#: templates/admin/object_history.html:25\n msgid \"Action\"\n msgstr \"\"\n \n-#: templates/admin/object_history.html:40\n+#: templates/admin/object_history.html:39\n msgid \"\"\n \"This object doesn't have a change history. It probably wasn't added via this \"\n \"admin site.\"\n@@ -601,147 +592,147 @@ msgstr \"\"\n msgid \"Enter a username and password.\"\n msgstr \"\"\n \n-#: templates/admin/auth/user/change_password.html:33\n+#: templates/admin/auth/user/change_password.html:31\n #, python-format\n msgid \"Enter a new password for the user <strong>%(username)s</strong>.\"\n msgstr \"\"\n \n-#: templates/admin/auth/user/change_password.html:40\n+#: templates/admin/auth/user/change_password.html:38\n msgid \"Password\"\n msgstr \"\"\n \n-#: templates/admin/auth/user/change_password.html:46\n-#: templates/registration/password_change_form.html:43\n+#: templates/admin/auth/user/change_password.html:44\n+#: templates/registration/password_change_form.html:42\n msgid \"Password (again)\"\n msgstr \"\"\n \n-#: templates/admin/auth/user/change_password.html:47\n+#: templates/admin/auth/user/change_password.html:45\n msgid \"Enter the same password as above, for verification.\"\n msgstr \"\"\n \n-#: templates/admin/edit_inline/stacked.html:67\n-#: templates/admin/edit_inline/tabular.html:115\n-#, python-format\n-msgid \"Add another %(verbose_name)s\"\n+#: templates/admin/edit_inline/stacked.html:26\n+#: templates/admin/edit_inline/tabular.html:76\n+msgid \"Remove\"\n msgstr \"\"\n \n-#: templates/admin/edit_inline/stacked.html:70\n-#: templates/admin/edit_inline/tabular.html:118\n-msgid \"Remove\"\n+#: templates/admin/edit_inline/stacked.html:27\n+#: templates/admin/edit_inline/tabular.html:75\n+#, python-format\n+msgid \"Add another %(verbose_name)s\"\n msgstr \"\"\n \n #: templates/admin/edit_inline/tabular.html:17\n msgid \"Delete?\"\n msgstr \"\"\n \n-#: templates/registration/logged_out.html:9\n+#: templates/registration/logged_out.html:8\n msgid \"Thanks for spending some quality time with the Web site today.\"\n msgstr \"\"\n \n-#: templates/registration/logged_out.html:11\n+#: templates/registration/logged_out.html:10\n msgid \"Log in again\"\n msgstr \"\"\n \n-#: templates/registration/password_change_done.html:8\n-#: templates/registration/password_change_form.html:9\n-#: templates/registration/password_change_form.html:13\n-#: templates/registration/password_change_form.html:25\n+#: templates/registration/password_change_done.html:7\n+#: templates/registration/password_change_form.html:8\n+#: templates/registration/password_change_form.html:12\n+#: templates/registration/password_change_form.html:24\n msgid \"Password change\"\n msgstr \"\"\n \n-#: templates/registration/password_change_done.html:12\n-#: templates/registration/password_change_done.html:16\n+#: templates/registration/password_change_done.html:11\n+#: templates/registration/password_change_done.html:15\n msgid \"Password change successful\"\n msgstr \"\"\n \n-#: templates/registration/password_change_done.html:18\n+#: templates/registration/password_change_done.html:17\n msgid \"Your password was changed.\"\n msgstr \"\"\n \n-#: templates/registration/password_change_form.html:27\n+#: templates/registration/password_change_form.html:26\n msgid \"\"\n \"Please enter your old password, for security's sake, and then enter your new \"\n \"password twice so we can verify you typed it in correctly.\"\n msgstr \"\"\n \n-#: templates/registration/password_change_form.html:33\n+#: templates/registration/password_change_form.html:32\n msgid \"Old password\"\n msgstr \"\"\n \n-#: templates/registration/password_change_form.html:38\n+#: templates/registration/password_change_form.html:37\n msgid \"New password\"\n msgstr \"\"\n \n-#: templates/registration/password_change_form.html:49\n-#: templates/registration/password_reset_confirm.html:27\n+#: templates/registration/password_change_form.html:48\n+#: templates/registration/password_reset_confirm.html:26\n msgid \"Change my password\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_complete.html:8\n-#: templates/registration/password_reset_confirm.html:12\n-#: templates/registration/password_reset_done.html:8\n-#: templates/registration/password_reset_form.html:8\n-#: templates/registration/password_reset_form.html:12\n-#: templates/registration/password_reset_form.html:16\n+#: templates/registration/password_reset_complete.html:7\n+#: templates/registration/password_reset_confirm.html:11\n+#: templates/registration/password_reset_done.html:7\n+#: templates/registration/password_reset_form.html:7\n+#: templates/registration/password_reset_form.html:11\n+#: templates/registration/password_reset_form.html:15\n msgid \"Password reset\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_complete.html:12\n-#: templates/registration/password_reset_complete.html:16\n+#: templates/registration/password_reset_complete.html:11\n+#: templates/registration/password_reset_complete.html:15\n msgid \"Password reset complete\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_complete.html:18\n+#: templates/registration/password_reset_complete.html:17\n msgid \"Your password has been set.  You may go ahead and log in now.\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:8\n+#: templates/registration/password_reset_confirm.html:7\n msgid \"Password reset confirmation\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:18\n+#: templates/registration/password_reset_confirm.html:17\n msgid \"Enter new password\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:20\n+#: templates/registration/password_reset_confirm.html:19\n msgid \"\"\n \"Please enter your new password twice so we can verify you typed it in \"\n \"correctly.\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:24\n+#: templates/registration/password_reset_confirm.html:23\n msgid \"New password:\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:26\n+#: templates/registration/password_reset_confirm.html:25\n msgid \"Confirm password:\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:32\n+#: templates/registration/password_reset_confirm.html:31\n msgid \"Password reset unsuccessful\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_confirm.html:34\n+#: templates/registration/password_reset_confirm.html:33\n msgid \"\"\n \"The password reset link was invalid, possibly because it has already been \"\n \"used.  Please request a new password reset.\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_done.html:12\n-#: templates/registration/password_reset_done.html:16\n+#: templates/registration/password_reset_done.html:11\n+#: templates/registration/password_reset_done.html:15\n msgid \"Password reset successful\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_done.html:18\n+#: templates/registration/password_reset_done.html:17\n msgid \"\"\n-\"We've e-mailed you instructions for setting your password to the e-mail \"\n+\"We've emailed you instructions for setting your password to the email \"\n \"address you submitted. You should be receiving it shortly.\"\n msgstr \"\"\n \n #: templates/registration/password_reset_email.html:2\n #, python-format\n msgid \"\"\n-\"You're receiving this e-mail because you requested a password reset for your \"\n+\"You're receiving this email because you requested a password reset for your \"\n \"user account at %(site_name)s.\"\n msgstr \"\"\n \n@@ -762,34 +753,34 @@ msgstr \"\"\n msgid \"The %(site_name)s team\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_form.html:18\n+#: templates/registration/password_reset_form.html:17\n msgid \"\"\n-\"Forgotten your password? Enter your e-mail address below, and we'll e-mail \"\n+\"Forgotten your password? Enter your email address below, and we'll email \"\n \"instructions for setting a new one.\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_form.html:22\n-msgid \"E-mail address:\"\n+#: templates/registration/password_reset_form.html:21\n+msgid \"Email address:\"\n msgstr \"\"\n \n-#: templates/registration/password_reset_form.html:22\n+#: templates/registration/password_reset_form.html:21\n msgid \"Reset my password\"\n msgstr \"\"\n \n-#: templatetags/admin_list.py:336\n+#: templatetags/admin_list.py:344\n msgid \"All dates\"\n msgstr \"\"\n \n-#: views/main.py:31\n+#: views/main.py:33\n msgid \"(None)\"\n msgstr \"\"\n \n-#: views/main.py:74\n+#: views/main.py:76\n #, python-format\n msgid \"Select %s\"\n msgstr \"\"\n \n-#: views/main.py:76\n+#: views/main.py:78\n #, python-format\n msgid \"Select %s to change\"\n msgstr \"\""
        },
        {
            "sha": "e1d3b40d01f142af49b33630860c194da448ca60",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,8 +1,8 @@\n from __future__ import unicode_literals\n \n from django.db import models\n+from django.conf import settings\n from django.contrib.contenttypes.models import ContentType\n-from django.contrib.auth.models import User\n from django.contrib.admin.util import quote\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_text\n@@ -12,15 +12,17 @@\n CHANGE = 2\n DELETION = 3\n \n+\n class LogEntryManager(models.Manager):\n     def log_action(self, user_id, content_type_id, object_id, object_repr, action_flag, change_message=''):\n         e = self.model(None, None, user_id, content_type_id, smart_text(object_id), object_repr[:200], action_flag, change_message)\n         e.save()\n \n+\n @python_2_unicode_compatible\n class LogEntry(models.Model):\n     action_time = models.DateTimeField(_('action time'), auto_now=True)\n-    user = models.ForeignKey(User)\n+    user = models.ForeignKey(settings.AUTH_USER_MODEL)\n     content_type = models.ForeignKey(ContentType, blank=True, null=True)\n     object_id = models.TextField(_('object id'), blank=True, null=True)\n     object_repr = models.CharField(_('object repr'), max_length=200)"
        },
        {
            "sha": "19c212db9ab7045f27f974742ad52df58c343ea2",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 110,
            "deletions": 48,
            "changes": 158,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,12 +1,14 @@\n from functools import update_wrapper, partial\n+import warnings\n+\n from django import forms\n from django.conf import settings\n from django.forms.formsets import all_valid\n from django.forms.models import (modelform_factory, modelformset_factory,\n     inlineformset_factory, BaseInlineFormSet)\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.admin import widgets, helpers\n-from django.contrib.admin.util import unquote, flatten_fieldsets, get_deleted_objects, model_format_dict\n+from django.contrib.admin.util import quote, unquote, flatten_fieldsets, get_deleted_objects, model_format_dict\n from django.contrib.admin.templatetags.admin_static import static\n from django.contrib import messages\n from django.views.decorators.csrf import csrf_protect\n@@ -344,14 +346,14 @@ def __init__(self, model, admin_site):\n         self.admin_site = admin_site\n         super(ModelAdmin, self).__init__()\n \n-    def get_inline_instances(self, request):\n+    def get_inline_instances(self, request, obj=None):\n         inline_instances = []\n         for inline_class in self.inlines:\n             inline = inline_class(self.model, self.admin_site)\n             if request:\n                 if not (inline.has_add_permission(request) or\n-                        inline.has_change_permission(request) or\n-                        inline.has_delete_permission(request)):\n+                        inline.has_change_permission(request, obj) or\n+                        inline.has_delete_permission(request, obj)):\n                     continue\n                 if not inline.has_add_permission(request):\n                     inline.max_num = 0\n@@ -504,7 +506,7 @@ def get_changelist_formset(self, request, **kwargs):\n             fields=self.list_editable, **defaults)\n \n     def get_formsets(self, request, obj=None):\n-        for inline in self.get_inline_instances(request):\n+        for inline in self.get_inline_instances(request, obj):\n             yield inline.get_formset(request, obj)\n \n     def get_paginator(self, request, queryset, per_page, orphans=0, allow_empty_first_page=True):\n@@ -763,21 +765,49 @@ def render_change_form(self, request, context, add=False, change=False, form_url\n             \"admin/change_form.html\"\n         ], context, current_app=self.admin_site.name)\n \n-    def response_add(self, request, obj, post_url_continue='../%s/'):\n+    def response_add(self, request, obj, post_url_continue='../%s/',\n+                     continue_editing_url=None, add_another_url=None,\n+                     hasperm_url=None, noperm_url=None):\n         \"\"\"\n         Determines the HttpResponse for the add_view stage.\n-        \"\"\"\n+\n+        :param request: HttpRequest instance.\n+        :param obj: Object just added.\n+        :param post_url_continue: Deprecated/undocumented.\n+        :param continue_editing_url: URL where user will be redirected after\n+                                     pressing 'Save and continue editing'.\n+        :param add_another_url: URL where user will be redirected after\n+                                pressing 'Save and add another'.\n+        :param hasperm_url: URL to redirect after a successful object creation\n+                            when the user has change permissions.\n+        :param noperm_url: URL to redirect after a successful object creation\n+                           when the user has no change permissions.\n+        \"\"\"\n+        if post_url_continue != '../%s/':\n+            warnings.warn(\"The undocumented 'post_url_continue' argument to \"\n+                          \"ModelAdmin.response_add() is deprecated, use the new \"\n+                          \"*_url arguments instead.\", DeprecationWarning,\n+                          stacklevel=2)\n         opts = obj._meta\n-        pk_value = obj._get_pk_val()\n+        pk_value = obj.pk\n+        app_label = opts.app_label\n+        model_name = opts.module_name\n+        site_name = self.admin_site.name\n+\n+        msg_dict = {'name': force_text(opts.verbose_name), 'obj': force_text(obj)}\n \n-        msg = _('The %(name)s \"%(obj)s\" was added successfully.') % {'name': force_text(opts.verbose_name), 'obj': force_text(obj)}\n         # Here, we distinguish between different save types by checking for\n         # the presence of keys in request.POST.\n         if \"_continue\" in request.POST:\n-            self.message_user(request, msg + ' ' + _(\"You may edit it again below.\"))\n+            msg = _('The %(name)s \"%(obj)s\" was added successfully. You may edit it again below.') % msg_dict\n+            self.message_user(request, msg)\n+            if continue_editing_url is None:\n+                continue_editing_url = 'admin:%s_%s_change' % (app_label, model_name)\n+            url = reverse(continue_editing_url, args=(quote(pk_value),),\n+                          current_app=site_name)\n             if \"_popup\" in request.POST:\n-                post_url_continue += \"?_popup=1\"\n-            return HttpResponseRedirect(post_url_continue % pk_value)\n+                url += \"?_popup=1\"\n+            return HttpResponseRedirect(url)\n \n         if \"_popup\" in request.POST:\n             return HttpResponse(\n@@ -786,72 +816,104 @@ def response_add(self, request, obj, post_url_continue='../%s/'):\n                 # escape() calls force_text.\n                 (escape(pk_value), escapejs(obj)))\n         elif \"_addanother\" in request.POST:\n-            self.message_user(request, msg + ' ' + (_(\"You may add another %s below.\") % force_text(opts.verbose_name)))\n-            return HttpResponseRedirect(request.path)\n+            msg = _('The %(name)s \"%(obj)s\" was added successfully. You may add another %(name)s below.') % msg_dict\n+            self.message_user(request, msg)\n+            if add_another_url is None:\n+                add_another_url = 'admin:%s_%s_add' % (app_label, model_name)\n+            url = reverse(add_another_url, current_app=site_name)\n+            return HttpResponseRedirect(url)\n         else:\n+            msg = _('The %(name)s \"%(obj)s\" was added successfully.') % msg_dict\n             self.message_user(request, msg)\n \n             # Figure out where to redirect. If the user has change permission,\n             # redirect to the change-list page for this object. Otherwise,\n             # redirect to the admin index.\n             if self.has_change_permission(request, None):\n-                post_url = reverse('admin:%s_%s_changelist' %\n-                                   (opts.app_label, opts.module_name),\n-                                   current_app=self.admin_site.name)\n+                if hasperm_url is None:\n+                    hasperm_url = 'admin:%s_%s_changelist' % (app_label, model_name)\n+                url = reverse(hasperm_url, current_app=site_name)\n             else:\n-                post_url = reverse('admin:index',\n-                                   current_app=self.admin_site.name)\n-            return HttpResponseRedirect(post_url)\n+                if noperm_url is None:\n+                    noperm_url = 'admin:index'\n+                url = reverse(noperm_url, current_app=site_name)\n+            return HttpResponseRedirect(url)\n \n-    def response_change(self, request, obj):\n+    def response_change(self, request, obj, continue_editing_url=None,\n+                        save_as_new_url=None, add_another_url=None,\n+                        hasperm_url=None, noperm_url=None):\n         \"\"\"\n         Determines the HttpResponse for the change_view stage.\n+\n+        :param request: HttpRequest instance.\n+        :param obj: Object just modified.\n+        :param continue_editing_url: URL where user will be redirected after\n+                                     pressing 'Save and continue editing'.\n+        :param save_as_new_url: URL where user will be redirected after pressing\n+                                'Save as new' (when applicable).\n+        :param add_another_url: URL where user will be redirected after pressing\n+                                'Save and add another'.\n+        :param hasperm_url: URL to redirect after a successful object edition when\n+                            the user has change permissions.\n+        :param noperm_url: URL to redirect after a successful object edition when\n+                           the user has no change permissions.\n         \"\"\"\n         opts = obj._meta\n \n+        app_label = opts.app_label\n+        model_name = opts.module_name\n+        site_name = self.admin_site.name\n+        verbose_name = opts.verbose_name\n         # Handle proxy models automatically created by .only() or .defer().\n         # Refs #14529\n-        verbose_name = opts.verbose_name\n-        module_name = opts.module_name\n         if obj._deferred:\n             opts_ = opts.proxy_for_model._meta\n             verbose_name = opts_.verbose_name\n-            module_name = opts_.module_name\n+            model_name = opts_.module_name\n \n-        pk_value = obj._get_pk_val()\n+        msg_dict = {'name': force_text(verbose_name), 'obj': force_text(obj)}\n \n-        msg = _('The %(name)s \"%(obj)s\" was changed successfully.') % {'name': force_text(verbose_name), 'obj': force_text(obj)}\n         if \"_continue\" in request.POST:\n-            self.message_user(request, msg + ' ' + _(\"You may edit it again below.\"))\n-            if \"_popup\" in request.REQUEST:\n-                return HttpResponseRedirect(request.path + \"?_popup=1\")\n-            else:\n-                return HttpResponseRedirect(request.path)\n+            msg = _('The %(name)s \"%(obj)s\" was changed successfully. You may edit it again below.') % msg_dict\n+            self.message_user(request, msg)\n+            if continue_editing_url is None:\n+                continue_editing_url = 'admin:%s_%s_change' % (app_label, model_name)\n+            url = reverse(continue_editing_url, args=(quote(obj.pk),),\n+                          current_app=site_name)\n+            if \"_popup\" in request.POST:\n+                url += \"?_popup=1\"\n+            return HttpResponseRedirect(url)\n         elif \"_saveasnew\" in request.POST:\n-            msg = _('The %(name)s \"%(obj)s\" was added successfully. You may edit it again below.') % {'name': force_text(verbose_name), 'obj': obj}\n+            msg = _('The %(name)s \"%(obj)s\" was added successfully. You may edit it again below.') % msg_dict\n             self.message_user(request, msg)\n-            return HttpResponseRedirect(reverse('admin:%s_%s_change' %\n-                                        (opts.app_label, module_name),\n-                                        args=(pk_value,),\n-                                        current_app=self.admin_site.name))\n+            if save_as_new_url is None:\n+                save_as_new_url = 'admin:%s_%s_change' % (app_label, model_name)\n+            url = reverse(save_as_new_url, args=(quote(obj.pk),),\n+                          current_app=site_name)\n+            return HttpResponseRedirect(url)\n         elif \"_addanother\" in request.POST:\n-            self.message_user(request, msg + ' ' + (_(\"You may add another %s below.\") % force_text(verbose_name)))\n-            return HttpResponseRedirect(reverse('admin:%s_%s_add' %\n-                                        (opts.app_label, module_name),\n-                                        current_app=self.admin_site.name))\n+            msg = _('The %(name)s \"%(obj)s\" was changed successfully. You may add another %(name)s below.') % msg_dict\n+            self.message_user(request, msg)\n+            if add_another_url is None:\n+                add_another_url = 'admin:%s_%s_add' % (app_label, model_name)\n+            url = reverse(add_another_url, current_app=site_name)\n+            return HttpResponseRedirect(url)\n         else:\n+            msg = _('The %(name)s \"%(obj)s\" was changed successfully.') % msg_dict\n             self.message_user(request, msg)\n             # Figure out where to redirect. If the user has change permission,\n             # redirect to the change-list page for this object. Otherwise,\n             # redirect to the admin index.\n             if self.has_change_permission(request, None):\n-                post_url = reverse('admin:%s_%s_changelist' %\n-                                   (opts.app_label, module_name),\n-                                   current_app=self.admin_site.name)\n+                if hasperm_url is None:\n+                    hasperm_url = 'admin:%s_%s_changelist' % (app_label,\n+                                                              model_name)\n+                url = reverse(hasperm_url, current_app=site_name)\n             else:\n-                post_url = reverse('admin:index',\n-                                   current_app=self.admin_site.name)\n-            return HttpResponseRedirect(post_url)\n+                if noperm_url is None:\n+                    noperm_url = 'admin:index'\n+                url = reverse(noperm_url, current_app=site_name)\n+            return HttpResponseRedirect(url)\n \n     def response_action(self, request, queryset):\n         \"\"\"\n@@ -932,7 +994,7 @@ def add_view(self, request, form_url='', extra_context=None):\n \n         ModelForm = self.get_form(request)\n         formsets = []\n-        inline_instances = self.get_inline_instances(request)\n+        inline_instances = self.get_inline_instances(request, None)\n         if request.method == 'POST':\n             form = ModelForm(request.POST, request.FILES)\n             if form.is_valid():\n@@ -1029,7 +1091,7 @@ def change_view(self, request, object_id, form_url='', extra_context=None):\n \n         ModelForm = self.get_form(request, obj)\n         formsets = []\n-        inline_instances = self.get_inline_instances(request)\n+        inline_instances = self.get_inline_instances(request, obj)\n         if request.method == 'POST':\n             form = ModelForm(request.POST, request.FILES, instance=obj)\n             if form.is_valid():"
        },
        {
            "sha": "e375bc608fafd268084b3cfed47573e5858b099a",
            "filename": "django/contrib/admin/sites.py",
            "status": "modified",
            "additions": 20,
            "deletions": 14,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fsites.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fsites.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fsites.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -9,7 +9,6 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.core.urlresolvers import reverse, NoReverseMatch\n from django.template.response import TemplateResponse\n-from django.utils.safestring import mark_safe\n from django.utils import six\n from django.utils.text import capfirst\n from django.utils.translation import ugettext as _\n@@ -18,12 +17,15 @@\n \n LOGIN_FORM_KEY = 'this_is_the_login_form'\n \n+\n class AlreadyRegistered(Exception):\n     pass\n \n+\n class NotRegistered(Exception):\n     pass\n \n+\n class AdminSite(object):\n     \"\"\"\n     An AdminSite object encapsulates an instance of the Django admin application, ready\n@@ -41,7 +43,7 @@ class AdminSite(object):\n     password_change_done_template = None\n \n     def __init__(self, name='admin', app_name='admin'):\n-        self._registry = {} # model_class class -> admin_class instance\n+        self._registry = {}  # model_class class -> admin_class instance\n         self.name = name\n         self.app_name = app_name\n         self._actions = {'delete_selected': actions.delete_selected}\n@@ -80,20 +82,23 @@ def register(self, model_or_iterable, admin_class=None, **options):\n             if model in self._registry:\n                 raise AlreadyRegistered('The model %s is already registered' % model.__name__)\n \n-            # If we got **options then dynamically construct a subclass of\n-            # admin_class with those **options.\n-            if options:\n-                # For reasons I don't quite understand, without a __module__\n-                # the created class appears to \"live\" in the wrong place,\n-                # which causes issues later on.\n-                options['__module__'] = __name__\n-                admin_class = type(\"%sAdmin\" % model.__name__, (admin_class,), options)\n+            # Ignore the registration if the model has been\n+            # swapped out.\n+            if not model._meta.swapped:\n+                # If we got **options then dynamically construct a subclass of\n+                # admin_class with those **options.\n+                if options:\n+                    # For reasons I don't quite understand, without a __module__\n+                    # the created class appears to \"live\" in the wrong place,\n+                    # which causes issues later on.\n+                    options['__module__'] = __name__\n+                    admin_class = type(\"%sAdmin\" % model.__name__, (admin_class,), options)\n \n-            # Validate (which might be a no-op)\n-            validate(admin_class, model)\n+                # Validate (which might be a no-op)\n+                validate(admin_class, model)\n \n-            # Instantiate the admin class to save in the registry\n-            self._registry[model] = admin_class(model, self)\n+                # Instantiate the admin class to save in the registry\n+                self._registry[model] = admin_class(model, self)\n \n     def unregister(self, model_or_iterable):\n         \"\"\"\n@@ -319,6 +324,7 @@ def login(self, request, extra_context=None):\n             REDIRECT_FIELD_NAME: request.get_full_path(),\n         }\n         context.update(extra_context or {})\n+\n         defaults = {\n             'extra_context': context,\n             'current_app': self.name,"
        },
        {
            "sha": "4842faa656f06663247eab766926302748f349d8",
            "filename": "django/contrib/admin/templates/admin/500.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2F500.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2F500.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2F500.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -12,6 +12,6 @@\n \n {% block content %}\n <h1>{% trans 'Server Error <em>(500)</em>' %}</h1>\n-<p>{% trans \"There's been an error. It's been reported to the site administrators via e-mail and should be fixed shortly. Thanks for your patience.\" %}</p>\n+<p>{% trans \"There's been an error. It's been reported to the site administrators via email and should be fixed shortly. Thanks for your patience.\" %}</p>\n \n {% endblock %}"
        },
        {
            "sha": "b5a771584439e1e5c3ca81713743289197209529",
            "filename": "django/contrib/admin/templates/admin/auth/user/change_password.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -28,7 +28,7 @@\n     </p>\n {% endif %}\n \n-<p>{% blocktrans with username=original.username %}Enter a new password for the user <strong>{{ username }}</strong>.{% endblocktrans %}</p>\n+<p>{% blocktrans with username=original %}Enter a new password for the user <strong>{{ username }}</strong>.{% endblocktrans %}</p>\n \n <fieldset class=\"module aligned\">\n "
        },
        {
            "sha": "7bbd73a4644f18dbe3ee909e566084a18f40c222",
            "filename": "django/contrib/admin/templates/admin/base.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fbase.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fbase.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fbase.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -26,7 +26,7 @@\n         {% if user.is_active and user.is_staff %}\n         <div id=\"user-tools\">\n             {% trans 'Welcome,' %}\n-            <strong>{% filter force_escape %}{% firstof user.first_name user.username %}{% endfilter %}</strong>.\n+            <strong>{% filter force_escape %}{% firstof user.get_short_name user.get_username %}{% endfilter %}</strong>.\n             {% block userlinks %}\n                 {% url 'django-admindocs-docroot' as docsroot %}\n                 {% if docsroot %}"
        },
        {
            "sha": "4962e732a29c6320371f4c2e581a7f7702e4b24e",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -29,7 +29,7 @@\n {% if change %}{% if not is_popup %}\n   <ul class=\"object-tools\">\n     {% block object-tools-items %}\n-    <li><a href=\"{% url opts|admin_urlname:'history' original.pk %}\" class=\"historylink\">{% trans \"History\" %}</a></li>\n+    <li><a href=\"{% url opts|admin_urlname:'history' original.pk|admin_urlquote %}\" class=\"historylink\">{% trans \"History\" %}</a></li>\n     {% if has_absolute_url %}<li><a href=\"{% url 'admin:view_on_site' content_type_id original.pk %}\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n     {% endblock %}\n   </ul>"
        },
        {
            "sha": "46903638919df42087dcd86f3e298132f26a8b8c",
            "filename": "django/contrib/admin/templates/admin/login.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Flogin.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Flogin.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Flogin.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -30,7 +30,7 @@\n <form action=\"{{ app_path }}\" method=\"post\" id=\"login-form\">{% csrf_token %}\n   <div class=\"form-row\">\n     {% if not form.this_is_the_login_form.errors %}{{ form.username.errors }}{% endif %}\n-    <label for=\"id_username\" class=\"required\">{% trans 'Username:' %}</label> {{ form.username }}\n+    <label for=\"id_username\" class=\"required\">{{ form.username.label }}:</label> {{ form.username }}\n   </div>\n   <div class=\"form-row\">\n     {% if not form.this_is_the_login_form.errors %}{{ form.password.errors }}{% endif %}"
        },
        {
            "sha": "870c4648a60af068ee8043a6df5f8fb52c85479a",
            "filename": "django/contrib/admin/templates/admin/object_history.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fobject_history.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fobject_history.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fobject_history.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -29,7 +29,7 @@\n         {% for action in action_list %}\n         <tr>\n             <th scope=\"row\">{{ action.action_time|date:\"DATETIME_FORMAT\" }}</th>\n-            <td>{{ action.user.username }}{% if action.user.get_full_name %} ({{ action.user.get_full_name }}){% endif %}</td>\n+            <td>{{ action.user.get_username }}{% if action.user.get_full_name %} ({{ action.user.get_full_name }}){% endif %}</td>\n             <td>{{ action.change_message }}</td>\n         </tr>\n         {% endfor %}"
        },
        {
            "sha": "8c9d22752dbf9a82e36848c02970ed67c283eeea",
            "filename": "django/contrib/admin/templates/admin/submit_line.html",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fsubmit_line.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,8 +1,8 @@\n-{% load i18n %}\n+{% load i18n admin_urls %}\n <div class=\"submit-row\">\n {% if show_save %}<input type=\"submit\" value=\"{% trans 'Save' %}\" class=\"default\" name=\"_save\" {{ onclick_attrib }}/>{% endif %}\n-{% if show_delete_link %}<p class=\"deletelink-box\"><a href=\"delete/\" class=\"deletelink\">{% trans \"Delete\" %}</a></p>{% endif %}\n+{% if show_delete_link %}<p class=\"deletelink-box\"><a href=\"{% url opts|admin_urlname:'delete' original.pk|admin_urlquote %}\" class=\"deletelink\">{% trans \"Delete\" %}</a></p>{% endif %}\n {% if show_save_as_new %}<input type=\"submit\" value=\"{% trans 'Save as new' %}\" name=\"_saveasnew\" {{ onclick_attrib }}/>{%endif%}\n-{% if show_save_and_add_another %}<input type=\"submit\" value=\"{% trans 'Save and add another' %}\" name=\"_addanother\" {{ onclick_attrib }} />{% endif %}\n+{% if show_save_and_add_another %}<input type=\"submit\" value=\"{% trans 'Save and add another' %}\" name=\"_addanother\" {{ onclick_attrib }}/>{% endif %}\n {% if show_save_and_continue %}<input type=\"submit\" value=\"{% trans 'Save and continue editing' %}\" name=\"_continue\" {{ onclick_attrib }}/>{% endif %}\n </div>"
        },
        {
            "sha": "7584c8393a4a6f3df790fa6aa1d78c19d6578586",
            "filename": "django/contrib/admin/templates/registration/password_reset_done.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_done.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_done.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_done.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,6 +14,6 @@\n \n <h1>{% trans 'Password reset successful' %}</h1>\n \n-<p>{% trans \"We've e-mailed you instructions for setting your password to the e-mail address you submitted. You should be receiving it shortly.\" %}</p>\n+<p>{% trans \"We've emailed you instructions for setting your password to the email address you submitted. You should be receiving it shortly.\" %}</p>\n \n {% endblock %}"
        },
        {
            "sha": "a220f12033596b378a6bbaaecbcb1f3ff64f3875",
            "filename": "django/contrib/admin/templates/registration/password_reset_email.html",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_email.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_email.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_email.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,11 +1,11 @@\n {% load i18n %}{% autoescape off %}\n-{% blocktrans %}You're receiving this e-mail because you requested a password reset for your user account at {{ site_name }}.{% endblocktrans %}\n+{% blocktrans %}You're receiving this email because you requested a password reset for your user account at {{ site_name }}.{% endblocktrans %}\n \n {% trans \"Please go to the following page and choose a new password:\" %}\n {% block reset_link %}\n {{ protocol }}://{{ domain }}{% url 'django.contrib.auth.views.password_reset_confirm' uidb36=uid token=token %}\n {% endblock %}\n-{% trans \"Your username, in case you've forgotten:\" %} {{ user.username }}\n+{% trans \"Your username, in case you've forgotten:\" %} {{ user.get_username }}\n \n {% trans \"Thanks for using our site!\" %}\n "
        },
        {
            "sha": "c9998a1a3b37a7d3a3c8a69c2531d5ea341f3f36",
            "filename": "django/contrib/admin/templates/registration/password_reset_form.html",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_form.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fregistration%2Fpassword_reset_form.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,11 +14,11 @@\n \n <h1>{% trans \"Password reset\" %}</h1>\n \n-<p>{% trans \"Forgotten your password? Enter your e-mail address below, and we'll e-mail instructions for setting a new one.\" %}</p>\n+<p>{% trans \"Forgotten your password? Enter your email address below, and we'll email instructions for setting a new one.\" %}</p>\n \n <form action=\"\" method=\"post\">{% csrf_token %}\n {{ form.email.errors }}\n-<p><label for=\"id_email\">{% trans 'E-mail address:' %}</label> {{ form.email }} <input type=\"submit\" value=\"{% trans 'Reset my password' %}\" /></p>\n+<p><label for=\"id_email\">{% trans 'Email address:' %}</label> {{ form.email }} <input type=\"submit\" value=\"{% trans 'Reset my password' %}\" /></p>\n </form>\n \n {% endblock %}"
        },
        {
            "sha": "f6ac59635a6311d537590e2856940d6f8eb967f3",
            "filename": "django/contrib/admin/templatetags/admin_modify.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -28,7 +28,8 @@ def submit_row(context):\n     change = context['change']\n     is_popup = context['is_popup']\n     save_as = context['save_as']\n-    return {\n+    ctx = {\n+        'opts': opts,\n         'onclick_attrib': (opts.get_ordered_objects() and change\n                             and 'onclick=\"submitOrderForm();\"' or ''),\n         'show_delete_link': (not is_popup and context['has_delete_permission']\n@@ -40,6 +41,9 @@ def submit_row(context):\n         'is_popup': is_popup,\n         'show_save': True\n     }\n+    if context.get('original') is not None:\n+        ctx['original'] = context['original']\n+    return ctx\n \n @register.filter\n def cell_count(inline_admin_form):"
        },
        {
            "sha": "7c62c1a22fda726e6fb6a20e02b71458774ad0f9",
            "filename": "django/contrib/admin/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -21,9 +21,9 @@ def setUpClass(cls):\n \n     @classmethod\n     def tearDownClass(cls):\n-        super(AdminSeleniumWebDriverTestCase, cls).tearDownClass()\n         if hasattr(cls, 'selenium'):\n             cls.selenium.quit()\n+        super(AdminSeleniumWebDriverTestCase, cls).tearDownClass()\n \n     def wait_until(self, callback, timeout=10):\n         \"\"\"\n@@ -98,4 +98,4 @@ def has_css_class(self, selector, klass):\n         `klass`.\n         \"\"\"\n         return (self.selenium.find_element_by_css_selector(selector)\n-                .get_attribute('class').find(klass) != -1)\n\\ No newline at end of file\n+                .get_attribute('class').find(klass) != -1)"
        },
        {
            "sha": "a85045c515fca2596640d973552897ecab2d0083",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -48,9 +48,9 @@ def prepare_lookup_value(key, value):\n def quote(s):\n     \"\"\"\n     Ensure that primary key values do not confuse the admin URLs by escaping\n-    any '/', '_' and ':' characters. Similar to urllib.quote, except that the\n-    quoting is slightly different so that it doesn't get automatically\n-    unquoted by the Web browser.\n+    any '/', '_' and ':' and similarly problematic characters.\n+    Similar to urllib.quote, except that the quoting is slightly different so\n+    that it doesn't get automatically unquoted by the Web browser.\n     \"\"\"\n     if not isinstance(s, six.string_types):\n         return s\n@@ -191,6 +191,13 @@ def nested(self, format_callback=None):\n             roots.extend(self._nested(root, seen, format_callback))\n         return roots\n \n+    def can_fast_delete(self, *args, **kwargs):\n+        \"\"\"\n+        We always want to load the objects into memory so that we can display\n+        them to the user in confirm page.\n+        \"\"\"\n+        return False\n+\n \n def model_format_dict(obj):\n     \"\"\""
        },
        {
            "sha": "e19265fc83c872f791f2b1daf4dbeb30c35f8106",
            "filename": "django/contrib/admin/views/decorators.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fviews%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fviews%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fdecorators.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,6 +4,7 @@\n from django.contrib.auth.views import login\n from django.contrib.auth import REDIRECT_FIELD_NAME\n \n+\n def staff_member_required(view_func):\n     \"\"\"\n     Decorator for views that checks that the user is logged in and is a staff"
        },
        {
            "sha": "5033ba98bc8c81922e5665f5ddf14e3aba6f32ee",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,6 +3,7 @@\n \n from django.core.exceptions import SuspiciousOperation, ImproperlyConfigured\n from django.core.paginator import InvalidPage\n+from django.core.urlresolvers import reverse\n from django.db import models\n from django.db.models.fields import FieldDoesNotExist\n from django.utils.datastructures import SortedDict\n@@ -376,4 +377,8 @@ def construct_search(field_name):\n             return qs\n \n     def url_for_result(self, result):\n-        return \"%s/\" % quote(getattr(result, self.pk_attname))\n+        pk = getattr(result, self.pk_attname)\n+        return reverse('admin:%s_%s_change' % (self.opts.app_label,\n+                                               self.opts.module_name),\n+                       args=(quote(pk),),\n+                       current_app=self.model_admin.admin_site.name)"
        },
        {
            "sha": "f58586f414d250fa38b38e81204de7702193f868",
            "filename": "django/contrib/admindocs/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 53,
            "deletions": 44,
            "changes": 97,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmindocs%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmindocs%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:36+0100\\n\"\n+\"POT-Creation-Date: 2012-10-22 09:28+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,63 +13,75 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: views.py:57 views.py:59 views.py:61\n+#: views.py:58 views.py:60 views.py:62\n msgid \"tag:\"\n msgstr \"\"\n \n-#: views.py:92 views.py:94 views.py:96\n+#: views.py:93 views.py:95 views.py:97\n msgid \"filter:\"\n msgstr \"\"\n \n-#: views.py:155 views.py:157 views.py:159\n+#: views.py:156 views.py:158 views.py:160\n msgid \"view:\"\n msgstr \"\"\n \n-#: views.py:187\n+#: views.py:188\n #, python-format\n msgid \"App %r not found\"\n msgstr \"\"\n \n-#: views.py:194\n+#: views.py:195\n #, python-format\n msgid \"Model %(model_name)r not found in app %(app_label)r\"\n msgstr \"\"\n \n-#: views.py:206\n+#: views.py:207\n #, python-format\n msgid \"the related `%(app_label)s.%(data_type)s` object\"\n msgstr \"\"\n \n-#: views.py:206 views.py:225 views.py:230 views.py:244 views.py:258\n-#: views.py:263\n+#: views.py:207 views.py:226 views.py:231 views.py:245 views.py:259\n+#: views.py:264\n msgid \"model:\"\n msgstr \"\"\n \n-#: views.py:221 views.py:253\n+#: views.py:222 views.py:254\n #, python-format\n msgid \"related `%(app_label)s.%(object_name)s` objects\"\n msgstr \"\"\n \n-#: views.py:225 views.py:258\n+#: views.py:226 views.py:259\n #, python-format\n msgid \"all %s\"\n msgstr \"\"\n \n-#: views.py:230 views.py:263\n+#: views.py:231 views.py:264\n #, python-format\n msgid \"number of %s\"\n msgstr \"\"\n \n-#: views.py:268\n+#: views.py:269\n #, python-format\n msgid \"Fields on %s objects\"\n msgstr \"\"\n \n-#: views.py:360\n+#: views.py:361\n #, python-format\n msgid \"%s does not appear to be a urlpattern object\"\n msgstr \"\"\n \n+#: templates/admin_doc/bookmarklets.html:6 templates/admin_doc/index.html:6\n+#: templates/admin_doc/missing_docutils.html:6\n+#: templates/admin_doc/model_detail.html:14\n+#: templates/admin_doc/model_index.html:8\n+#: templates/admin_doc/template_detail.html:6\n+#: templates/admin_doc/template_filter_index.html:7\n+#: templates/admin_doc/template_tag_index.html:7\n+#: templates/admin_doc/view_detail.html:6\n+#: templates/admin_doc/view_index.html:7\n+msgid \"Home\"\n+msgstr \"\"\n+\n #: templates/admin_doc/bookmarklets.html:7 templates/admin_doc/index.html:7\n #: templates/admin_doc/missing_docutils.html:7\n #: templates/admin_doc/model_detail.html:15\n@@ -79,30 +91,18 @@ msgstr \"\"\n #: templates/admin_doc/template_tag_index.html:8\n #: templates/admin_doc/view_detail.html:7\n #: templates/admin_doc/view_index.html:8\n-msgid \"Home\"\n-msgstr \"\"\n-\n-#: templates/admin_doc/bookmarklets.html:8 templates/admin_doc/index.html:8\n-#: templates/admin_doc/missing_docutils.html:8\n-#: templates/admin_doc/model_detail.html:16\n-#: templates/admin_doc/model_index.html:10\n-#: templates/admin_doc/template_detail.html:8\n-#: templates/admin_doc/template_filter_index.html:9\n-#: templates/admin_doc/template_tag_index.html:9\n-#: templates/admin_doc/view_detail.html:8\n-#: templates/admin_doc/view_index.html:9\n msgid \"Documentation\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:9\n+#: templates/admin_doc/bookmarklets.html:8\n msgid \"Bookmarklets\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:12\n+#: templates/admin_doc/bookmarklets.html:11\n msgid \"Documentation bookmarklets\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:16\n+#: templates/admin_doc/bookmarklets.html:15\n msgid \"\"\n \"\\n\"\n \"<p class=\\\"help\\\">To install bookmarklets, drag the link to your bookmarks\\n\"\n@@ -113,60 +113,69 @@ msgid \"\"\n \"your computer is \\\"internal\\\").</p>\\n\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:26\n+#: templates/admin_doc/bookmarklets.html:25\n msgid \"Documentation for this page\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:27\n+#: templates/admin_doc/bookmarklets.html:26\n msgid \"\"\n \"Jumps you from any page to the documentation for the view that generates \"\n \"that page.\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:29\n+#: templates/admin_doc/bookmarklets.html:28\n msgid \"Show object ID\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:30\n+#: templates/admin_doc/bookmarklets.html:29\n msgid \"\"\n \"Shows the content-type and unique ID for pages that represent a single \"\n \"object.\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:32\n+#: templates/admin_doc/bookmarklets.html:31\n msgid \"Edit this object (current window)\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:33\n+#: templates/admin_doc/bookmarklets.html:32\n msgid \"Jumps to the admin page for pages that represent a single object.\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:35\n+#: templates/admin_doc/bookmarklets.html:34\n msgid \"Edit this object (new window)\"\n msgstr \"\"\n \n-#: templates/admin_doc/bookmarklets.html:36\n+#: templates/admin_doc/bookmarklets.html:35\n msgid \"As above, but opens the admin page in a new window.\"\n msgstr \"\"\n \n-#: templates/admin_doc/model_detail.html:17\n-#: templates/admin_doc/model_index.html:11\n+#: templates/admin_doc/model_detail.html:16\n+#: templates/admin_doc/model_index.html:10\n msgid \"Models\"\n msgstr \"\"\n \n-#: templates/admin_doc/template_detail.html:9\n+#: templates/admin_doc/template_detail.html:8\n msgid \"Templates\"\n msgstr \"\"\n \n-#: templates/admin_doc/template_filter_index.html:10\n+#: templates/admin_doc/template_filter_index.html:9\n msgid \"Filters\"\n msgstr \"\"\n \n-#: templates/admin_doc/template_tag_index.html:10\n+#: templates/admin_doc/template_tag_index.html:9\n msgid \"Tags\"\n msgstr \"\"\n \n-#: templates/admin_doc/view_detail.html:9\n-#: templates/admin_doc/view_index.html:10\n+#: templates/admin_doc/view_detail.html:8\n+#: templates/admin_doc/view_index.html:9\n msgid \"Views\"\n msgstr \"\"\n+\n+#: tests/__init__.py:23\n+msgid \"Boolean (Either True or False)\"\n+msgstr \"\"\n+\n+#: tests/__init__.py:33\n+#, python-format\n+msgid \"Field of type: %(field_type)s\"\n+msgstr \"\""
        },
        {
            "sha": "aa5bd6a8dc112be61be33d13b1c74c75a3fcc931",
            "filename": "django/contrib/admindocs/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmindocs%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fadmindocs%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Ftests%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -26,7 +26,7 @@ def test_builtin_fields(self):\n     def test_custom_fields(self):\n         self.assertEqual(\n             views.get_readable_field_data_type(fields.CustomField()),\n-            _('A custom field type')\n+            'A custom field type'\n         )\n         self.assertEqual(\n             views.get_readable_field_data_type(fields.DescriptionLackingField()),"
        },
        {
            "sha": "dd4a8484f56820707544520bfd0b685fa9f0463c",
            "filename": "django/contrib/auth/__init__.py",
            "status": "modified",
            "additions": 44,
            "deletions": 2,
            "changes": 46,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,14 +1,17 @@\n+import re\n+\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n-from django.contrib.auth.signals import user_logged_in, user_logged_out\n+from django.contrib.auth.signals import user_logged_in, user_logged_out, user_login_failed\n \n SESSION_KEY = '_auth_user_id'\n BACKEND_SESSION_KEY = '_auth_user_backend'\n REDIRECT_FIELD_NAME = 'next'\n \n+\n def load_backend(path):\n     i = path.rfind('.')\n-    module, attr = path[:i], path[i+1:]\n+    module, attr = path[:i], path[i + 1:]\n     try:\n         mod = import_module(module)\n     except ImportError as e:\n@@ -21,6 +24,7 @@ def load_backend(path):\n         raise ImproperlyConfigured('Module \"%s\" does not define a \"%s\" authentication backend' % (module, attr))\n     return cls()\n \n+\n def get_backends():\n     from django.conf import settings\n     backends = []\n@@ -30,6 +34,22 @@ def get_backends():\n         raise ImproperlyConfigured('No authentication backends have been defined. Does AUTHENTICATION_BACKENDS contain anything?')\n     return backends\n \n+\n+def _clean_credentials(credentials):\n+    \"\"\"\n+    Cleans a dictionary of credentials of potentially sensitive info before\n+    sending to less secure functions.\n+\n+    Not comprehensive - intended for user_login_failed signal\n+    \"\"\"\n+    SENSITIVE_CREDENTIALS = re.compile('api|token|key|secret|password|signature', re.I)\n+    CLEANSED_SUBSTITUTE = '********************'\n+    for key in credentials:\n+        if SENSITIVE_CREDENTIALS.search(key):\n+            credentials[key] = CLEANSED_SUBSTITUTE\n+    return credentials\n+\n+\n def authenticate(**credentials):\n     \"\"\"\n     If the given credentials are valid, return a User object.\n@@ -46,6 +66,11 @@ def authenticate(**credentials):\n         user.backend = \"%s.%s\" % (backend.__module__, backend.__class__.__name__)\n         return user\n \n+    # The credentials supplied are invalid to all backends, fire signal\n+    user_login_failed.send(sender=__name__,\n+            credentials=_clean_credentials(credentials))\n+\n+\n def login(request, user):\n     \"\"\"\n     Persist a user id and a backend in the request. This way a user doesn't\n@@ -69,6 +94,7 @@ def login(request, user):\n         request.user = user\n     user_logged_in.send(sender=user.__class__, request=request, user=user)\n \n+\n def logout(request):\n     \"\"\"\n     Removes the authenticated user's ID from the request and flushes their\n@@ -86,6 +112,22 @@ def logout(request):\n         from django.contrib.auth.models import AnonymousUser\n         request.user = AnonymousUser()\n \n+\n+def get_user_model():\n+    \"Return the User model that is active in this project\"\n+    from django.conf import settings\n+    from django.db.models import get_model\n+\n+    try:\n+        app_label, model_name = settings.AUTH_USER_MODEL.split('.')\n+    except ValueError:\n+        raise ImproperlyConfigured(\"AUTH_USER_MODEL must be of the form 'app_label.model_name'\")\n+    user_model = get_model(app_label, model_name)\n+    if user_model is None:\n+        raise ImproperlyConfigured(\"AUTH_USER_MODEL refers to model '%s' that has not been installed\" % settings.AUTH_USER_MODEL)\n+    return user_model\n+\n+\n def get_user(request):\n     from django.contrib.auth.models import AnonymousUser\n     try:"
        },
        {
            "sha": "5f476f91c219d2f0e7358e55507d61a365d3801c",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -11,14 +11,13 @@\n from django.template.response import TemplateResponse\n from django.utils.html import escape\n from django.utils.decorators import method_decorator\n-from django.utils.safestring import mark_safe\n-from django.utils import six\n from django.utils.translation import ugettext, ugettext_lazy as _\n from django.views.decorators.csrf import csrf_protect\n from django.views.decorators.debug import sensitive_post_parameters\n \n csrf_protect_m = method_decorator(csrf_protect)\n \n+\n class GroupAdmin(admin.ModelAdmin):\n     search_fields = ('name',)\n     ordering = ('name',)\n@@ -54,10 +53,10 @@ class UserAdmin(admin.ModelAdmin):\n     add_form = UserCreationForm\n     change_password_form = AdminPasswordChangeForm\n     list_display = ('username', 'email', 'first_name', 'last_name', 'is_staff')\n-    list_filter = ('is_staff', 'is_superuser', 'is_active')\n+    list_filter = ('is_staff', 'is_superuser', 'is_active', 'groups')\n     search_fields = ('username', 'first_name', 'last_name', 'email')\n     ordering = ('username',)\n-    filter_horizontal = ('user_permissions',)\n+    filter_horizontal = ('groups', 'user_permissions',)\n \n     def get_fieldsets(self, request, obj=None):\n         if not obj:\n@@ -106,9 +105,10 @@ def add_view(self, request, form_url='', extra_context=None):\n             raise PermissionDenied\n         if extra_context is None:\n             extra_context = {}\n+        username_field = self.model._meta.get_field(self.model.USERNAME_FIELD)\n         defaults = {\n             'auto_populated_fields': (),\n-            'username_help_text': self.model._meta.get_field('username').help_text,\n+            'username_help_text': username_field.help_text,\n         }\n         extra_context.update(defaults)\n         return super(UserAdmin, self).add_view(request, form_url,\n@@ -153,7 +153,7 @@ def user_change_password(self, request, id, form_url=''):\n             'admin/auth/user/change_password.html'\n         ], context, current_app=self.admin_site.name)\n \n-    def response_add(self, request, obj, post_url_continue='../%s/'):\n+    def response_add(self, request, obj, **kwargs):\n         \"\"\"\n         Determines the HttpResponse for the add_view stage. It mostly defers to\n         its superclass implementation but is customized because the User model\n@@ -166,9 +166,7 @@ def response_add(self, request, obj, post_url_continue='../%s/'):\n         # * We are adding a user in a popup\n         if '_addanother' not in request.POST and '_popup' not in request.POST:\n             request.POST['_continue'] = 1\n-        return super(UserAdmin, self).response_add(request, obj,\n-                                                   post_url_continue)\n+        return super(UserAdmin, self).response_add(request, obj, **kwargs)\n \n admin.site.register(Group, GroupAdmin)\n admin.site.register(User, UserAdmin)\n-"
        },
        {
            "sha": "db99c948385be260fcbee182b9d1044392ee9f6e",
            "filename": "django/contrib/auth/backends.py",
            "status": "modified",
            "additions": 18,
            "deletions": 10,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fbackends.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fbackends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fbackends.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,6 +1,6 @@\n from __future__ import unicode_literals\n-\n-from django.contrib.auth.models import User, Permission\n+from django.contrib.auth import get_user_model\n+from django.contrib.auth.models import Permission\n \n \n class ModelBackend(object):\n@@ -12,10 +12,11 @@ class ModelBackend(object):\n     # configurable.\n     def authenticate(self, username=None, password=None):\n         try:\n-            user = User.objects.get(username=username)\n+            UserModel = get_user_model()\n+            user = UserModel.objects.get_by_natural_key(username)\n             if user.check_password(password):\n                 return user\n-        except User.DoesNotExist:\n+        except UserModel.DoesNotExist:\n             return None\n \n     def get_group_permissions(self, user_obj, obj=None):\n@@ -29,7 +30,9 @@ def get_group_permissions(self, user_obj, obj=None):\n             if user_obj.is_superuser:\n                 perms = Permission.objects.all()\n             else:\n-                perms = Permission.objects.filter(group__user=user_obj)\n+                user_groups_field = get_user_model()._meta.get_field('groups')\n+                user_groups_query = 'group__%s' % user_groups_field.related_query_name()\n+                perms = Permission.objects.filter(**{user_groups_query: user_obj})\n             perms = perms.values_list('content_type__app_label', 'codename').order_by()\n             user_obj._group_perm_cache = set([\"%s.%s\" % (ct, name) for ct, name in perms])\n         return user_obj._group_perm_cache\n@@ -60,8 +63,9 @@ def has_module_perms(self, user_obj, app_label):\n \n     def get_user(self, user_id):\n         try:\n-            return User.objects.get(pk=user_id)\n-        except User.DoesNotExist:\n+            UserModel = get_user_model()\n+            return UserModel.objects.get(pk=user_id)\n+        except UserModel.DoesNotExist:\n             return None\n \n \n@@ -94,17 +98,21 @@ def authenticate(self, remote_user):\n         user = None\n         username = self.clean_username(remote_user)\n \n+        UserModel = get_user_model()\n+\n         # Note that this could be accomplished in one try-except clause, but\n         # instead we use get_or_create when creating unknown users since it has\n         # built-in safeguards for multiple threads.\n         if self.create_unknown_user:\n-            user, created = User.objects.get_or_create(username=username)\n+            user, created = UserModel.objects.get_or_create(**{\n+                UserModel.USERNAME_FIELD: username\n+            })\n             if created:\n                 user = self.configure_user(user)\n         else:\n             try:\n-                user = User.objects.get(username=username)\n-            except User.DoesNotExist:\n+                user = UserModel.objects.get_by_natural_key(username)\n+            except UserModel.DoesNotExist:\n                 pass\n         return user\n "
        },
        {
            "sha": "5929505359c1053e0f971e39bbe3f3001caf1d7b",
            "filename": "django/contrib/auth/context_processors.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fcontext_processors.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -11,6 +11,11 @@ def __repr__(self):\n     def __getitem__(self, perm_name):\n         return self.user.has_perm(\"%s.%s\" % (self.module_name, perm_name))\n \n+    def __iter__(self):\n+        # To fix 'item in perms.someapp' and __getitem__ iteraction we need to\n+        # define __iter__. See #18979 for details.\n+        raise TypeError(\"PermLookupDict is not iterable.\")\n+\n     def __bool__(self):\n         return self.user.has_module_perms(self.module_name)\n     __nonzero__ = __bool__ # Python 2\n@@ -27,6 +32,17 @@ def __iter__(self):\n         # I am large, I contain multitudes.\n         raise TypeError(\"PermWrapper is not iterable.\")\n \n+    def __contains__(self, perm_name):\n+        \"\"\"\n+        Lookup by \"someapp\" or \"someapp.someperm\" in perms.\n+        \"\"\"\n+        if '.' not in perm_name:\n+            # The name refers to module.\n+            return bool(self[perm_name])\n+        module_name, perm_name = perm_name.split('.', 1)\n+        return self[module_name][perm_name]\n+\n+\n def auth(request):\n     \"\"\"\n     Returns context variables required by apps that use Django's authentication"
        },
        {
            "sha": "770bea6541dd5e54f78f7f251a33196d08111061",
            "filename": "django/contrib/auth/fixtures/custom_user.json",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ffixtures%2Fcustom_user.json",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ffixtures%2Fcustom_user.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ffixtures%2Fcustom_user.json?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,14 @@\n+[\n+    {\n+        \"pk\": \"1\",\n+        \"model\": \"auth.customuser\",\n+        \"fields\": {\n+            \"password\": \"sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161\",\n+            \"last_login\": \"2006-12-17 07:03:31\",\n+            \"email\": \"staffmember@example.com\",\n+            \"is_active\": true,\n+            \"is_admin\": false,\n+            \"date_of_birth\": \"1976-11-08\"\n+       }\n+    }\n+]\n\\ No newline at end of file"
        },
        {
            "sha": "423e3429e6a6cb6e8a7657d692054bc5be62e6a9",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 20,
            "deletions": 10,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -7,9 +7,10 @@\n from django.utils.html import format_html, format_html_join\n from django.utils.http import int_to_base36\n from django.utils.safestring import mark_safe\n+from django.utils.text import capfirst\n from django.utils.translation import ugettext, ugettext_lazy as _\n \n-from django.contrib.auth import authenticate\n+from django.contrib.auth import authenticate, get_user_model\n from django.contrib.auth.models import User\n from django.contrib.auth.hashers import UNUSABLE_PASSWORD, identify_hasher\n from django.contrib.auth.tokens import default_token_generator\n@@ -117,9 +118,6 @@ class UserChangeForm(forms.ModelForm):\n                     \"this user's password, but you can change the password \"\n                     \"using <a href=\\\"password/\\\">this form</a>.\"))\n \n-    def clean_password(self):\n-        return self.initial[\"password\"]\n-\n     class Meta:\n         model = User\n \n@@ -129,13 +127,19 @@ def __init__(self, *args, **kwargs):\n         if f is not None:\n             f.queryset = f.queryset.select_related('content_type')\n \n+    def clean_password(self):\n+        # Regardless of what the user provides, return the initial value.\n+        # This is done here, rather than on the field, because the\n+        # field does not have access to the initial value\n+        return self.initial[\"password\"]\n+\n \n class AuthenticationForm(forms.Form):\n     \"\"\"\n     Base class for authenticating users. Extend this to get a form that accepts\n     username/password logins.\n     \"\"\"\n-    username = forms.CharField(label=_(\"Username\"), max_length=30)\n+    username = forms.CharField(max_length=254)\n     password = forms.CharField(label=_(\"Password\"), widget=forms.PasswordInput)\n \n     error_messages = {\n@@ -157,6 +161,11 @@ def __init__(self, request=None, *args, **kwargs):\n         self.user_cache = None\n         super(AuthenticationForm, self).__init__(*args, **kwargs)\n \n+        # Set the label for the \"username\" field.\n+        UserModel = get_user_model()\n+        username_field = UserModel._meta.get_field(UserModel.USERNAME_FIELD)\n+        self.fields['username'].label = capfirst(username_field.verbose_name)\n+\n     def clean(self):\n         username = self.cleaned_data.get('username')\n         password = self.cleaned_data.get('password')\n@@ -187,20 +196,21 @@ def get_user(self):\n \n class PasswordResetForm(forms.Form):\n     error_messages = {\n-        'unknown': _(\"That e-mail address doesn't have an associated \"\n+        'unknown': _(\"That email address doesn't have an associated \"\n                      \"user account. Are you sure you've registered?\"),\n-        'unusable': _(\"The user account associated with this e-mail \"\n+        'unusable': _(\"The user account associated with this email \"\n                       \"address cannot reset the password.\"),\n     }\n-    email = forms.EmailField(label=_(\"E-mail\"), max_length=75)\n+    email = forms.EmailField(label=_(\"Email\"), max_length=254)\n \n     def clean_email(self):\n         \"\"\"\n         Validates that an active user exists with the given email address.\n         \"\"\"\n+        UserModel = get_user_model()\n         email = self.cleaned_data[\"email\"]\n-        self.users_cache = User.objects.filter(email__iexact=email,\n-                                               is_active=True)\n+        self.users_cache = UserModel.objects.filter(email__iexact=email,\n+                                                    is_active=True)\n         if not len(self.users_cache):\n             raise forms.ValidationError(self.error_messages['unknown'])\n         if any((user.password == UNUSABLE_PASSWORD)"
        },
        {
            "sha": "3229c6714b6176547689747cc12c0a8f6ccee15d",
            "filename": "django/contrib/auth/handlers/modwsgi.py",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,56 @@\n+from django.contrib import auth\n+from django import db\n+from django.utils.encoding import force_bytes\n+\n+\n+def check_password(environ, username, password):\n+    \"\"\"\n+    Authenticates against Django's auth database\n+\n+    mod_wsgi docs specify None, True, False as return value depending\n+    on whether the user exists and authenticates.\n+    \"\"\"\n+\n+    UserModel = auth.get_user_model()\n+    # db connection state is managed similarly to the wsgi handler\n+    # as mod_wsgi may call these functions outside of a request/response cycle\n+    db.reset_queries()\n+\n+    try:\n+        try:\n+            user = UserModel.objects.get_by_natural_key(username)\n+        except UserModel.DoesNotExist:\n+            return None\n+        try:\n+            if not user.is_active:\n+                return None\n+        except AttributeError as e:\n+            # a custom user may not support is_active\n+            return None\n+        return user.check_password(password)\n+    finally:\n+        db.close_connection()\n+\n+\n+def groups_for_user(environ, username):\n+    \"\"\"\n+    Authorizes a user based on groups\n+    \"\"\"\n+\n+    UserModel = auth.get_user_model()\n+    db.reset_queries()\n+\n+    try:\n+        try:\n+            user = UserModel.objects.get_by_natural_key(username)\n+        except UserModel.DoesNotExist:\n+            return []\n+        try:\n+            if not user.is_active:\n+                return []\n+        except AttributeError as e:\n+            # a custom user may not support is_active\n+            return []\n+        return [force_bytes(group.name) for group in user.groups.all()]\n+    finally:\n+        db.close_connection()"
        },
        {
            "sha": "9b0cab8372abd97e3c537829ff9b85c0374488cd",
            "filename": "django/contrib/auth/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 73,
            "deletions": 65,
            "changes": 138,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:36+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -25,48 +25,56 @@ msgstr \"\"\n msgid \"Important dates\"\n msgstr \"\"\n \n-#: admin.py:125\n+#: admin.py:126\n msgid \"Password changed successfully.\"\n msgstr \"\"\n \n-#: admin.py:135\n+#: admin.py:136\n #, python-format\n msgid \"Change password: %s\"\n msgstr \"\"\n \n-#: forms.py:62\n+#: forms.py:31 tests/forms.py:249 tests/forms.py:254\n+msgid \"No password set.\"\n+msgstr \"\"\n+\n+#: forms.py:37 tests/forms.py:259 tests/forms.py:265\n+msgid \"Invalid password format or unknown hashing algorithm.\"\n+msgstr \"\"\n+\n+#: forms.py:65\n msgid \"A user with that username already exists.\"\n msgstr \"\"\n \n-#: forms.py:63 forms.py:251 forms.py:308\n+#: forms.py:66 forms.py:257 forms.py:317\n msgid \"The two password fields didn't match.\"\n msgstr \"\"\n \n-#: forms.py:65 forms.py:110 forms.py:139\n+#: forms.py:68 forms.py:113\n msgid \"Username\"\n msgstr \"\"\n \n-#: forms.py:67 forms.py:111\n+#: forms.py:70 forms.py:114\n msgid \"Required. 30 characters or fewer. Letters, digits and @/./+/-/_ only.\"\n msgstr \"\"\n \n-#: forms.py:70 forms.py:114\n+#: forms.py:73 forms.py:117\n msgid \"This value may contain only letters, numbers and @/./+/-/_ characters.\"\n msgstr \"\"\n \n-#: forms.py:72 forms.py:116 forms.py:140 forms.py:310\n+#: forms.py:75 forms.py:119 forms.py:140 forms.py:319\n msgid \"Password\"\n msgstr \"\"\n \n-#: forms.py:74\n+#: forms.py:77\n msgid \"Password confirmation\"\n msgstr \"\"\n \n-#: forms.py:76\n+#: forms.py:79\n msgid \"Enter the same password as above, for verification.\"\n msgstr \"\"\n \n-#: forms.py:117\n+#: forms.py:120\n msgid \"\"\n \"Raw passwords are not stored, so there is no way to see this user's \"\n \"password, but you can change the password using <a href=\\\"password/\\\">this \"\n@@ -89,178 +97,178 @@ msgstr \"\"\n msgid \"This account is inactive.\"\n msgstr \"\"\n \n-#: forms.py:191\n+#: forms.py:196\n msgid \"\"\n-\"That e-mail address doesn't have an associated user account. Are you sure \"\n+\"That email address doesn't have an associated user account. Are you sure \"\n \"you've registered?\"\n msgstr \"\"\n \n-#: forms.py:193\n+#: forms.py:198 tests/forms.py:347\n msgid \"\"\n-\"The user account associated with this e-mail address cannot reset the \"\n+\"The user account associated with this email address cannot reset the \"\n \"password.\"\n msgstr \"\"\n \n-#: forms.py:196\n-msgid \"E-mail\"\n+#: forms.py:201\n+msgid \"Email\"\n msgstr \"\"\n \n-#: forms.py:253\n+#: forms.py:259\n msgid \"New password\"\n msgstr \"\"\n \n-#: forms.py:255\n+#: forms.py:261\n msgid \"New password confirmation\"\n msgstr \"\"\n \n-#: forms.py:284\n+#: forms.py:290\n msgid \"Your old password was entered incorrectly. Please enter it again.\"\n msgstr \"\"\n \n-#: forms.py:287\n+#: forms.py:293\n msgid \"Old password\"\n msgstr \"\"\n \n-#: forms.py:312\n+#: forms.py:321\n msgid \"Password (again)\"\n msgstr \"\"\n \n-#: hashers.py:218 hashers.py:269 hashers.py:298 hashers.py:326 hashers.py:355\n-#: hashers.py:389\n+#: hashers.py:241 hashers.py:292 hashers.py:321 hashers.py:349 hashers.py:378\n+#: hashers.py:412\n msgid \"algorithm\"\n msgstr \"\"\n \n-#: hashers.py:219\n+#: hashers.py:242\n msgid \"iterations\"\n msgstr \"\"\n \n-#: hashers.py:220 hashers.py:271 hashers.py:299 hashers.py:327 hashers.py:390\n+#: hashers.py:243 hashers.py:294 hashers.py:322 hashers.py:350 hashers.py:413\n msgid \"salt\"\n msgstr \"\"\n \n-#: hashers.py:221 hashers.py:300 hashers.py:328 hashers.py:356 hashers.py:391\n+#: hashers.py:244 hashers.py:323 hashers.py:351 hashers.py:379 hashers.py:414\n msgid \"hash\"\n msgstr \"\"\n \n-#: hashers.py:270\n+#: hashers.py:293\n msgid \"work factor\"\n msgstr \"\"\n \n-#: hashers.py:272\n+#: hashers.py:295\n msgid \"checksum\"\n msgstr \"\"\n \n-#: models.py:66 models.py:113\n+#: models.py:72 models.py:121\n msgid \"name\"\n msgstr \"\"\n \n-#: models.py:68\n+#: models.py:74\n msgid \"codename\"\n msgstr \"\"\n \n-#: models.py:72\n+#: models.py:78\n msgid \"permission\"\n msgstr \"\"\n \n-#: models.py:73 models.py:115\n+#: models.py:79 models.py:123\n msgid \"permissions\"\n msgstr \"\"\n \n-#: models.py:120\n+#: models.py:128\n msgid \"group\"\n msgstr \"\"\n \n-#: models.py:121 models.py:250\n+#: models.py:129 models.py:317\n msgid \"groups\"\n msgstr \"\"\n \n #: models.py:232\n-msgid \"username\"\n+msgid \"password\"\n msgstr \"\"\n \n #: models.py:233\n+msgid \"last login\"\n+msgstr \"\"\n+\n+#: models.py:298\n+msgid \"username\"\n+msgstr \"\"\n+\n+#: models.py:299\n msgid \"\"\n \"Required. 30 characters or fewer. Letters, numbers and @/./+/-/_ characters\"\n msgstr \"\"\n \n-#: models.py:235\n+#: models.py:302\n+msgid \"Enter a valid username.\"\n+msgstr \"\"\n+\n+#: models.py:304\n msgid \"first name\"\n msgstr \"\"\n \n-#: models.py:236\n+#: models.py:305\n msgid \"last name\"\n msgstr \"\"\n \n-#: models.py:237\n-msgid \"e-mail address\"\n+#: models.py:306\n+msgid \"email address\"\n msgstr \"\"\n \n-#: models.py:238\n-msgid \"password\"\n-msgstr \"\"\n-\n-#: models.py:239\n+#: models.py:307\n msgid \"staff status\"\n msgstr \"\"\n \n-#: models.py:240\n+#: models.py:308\n msgid \"Designates whether the user can log into this admin site.\"\n msgstr \"\"\n \n-#: models.py:242\n+#: models.py:310\n msgid \"active\"\n msgstr \"\"\n \n-#: models.py:243\n+#: models.py:311\n msgid \"\"\n \"Designates whether this user should be treated as active. Unselect this \"\n \"instead of deleting accounts.\"\n msgstr \"\"\n \n-#: models.py:245\n+#: models.py:313\n msgid \"superuser status\"\n msgstr \"\"\n \n-#: models.py:246\n+#: models.py:314\n msgid \"\"\n \"Designates that this user has all permissions without explicitly assigning \"\n \"them.\"\n msgstr \"\"\n \n-#: models.py:248\n-msgid \"last login\"\n-msgstr \"\"\n-\n-#: models.py:249\n+#: models.py:316\n msgid \"date joined\"\n msgstr \"\"\n \n-#: models.py:251\n+#: models.py:318\n msgid \"\"\n \"The groups this user belongs to. A user will get all permissions granted to \"\n \"each of his/her group.\"\n msgstr \"\"\n \n-#: models.py:255\n+#: models.py:322\n msgid \"user permissions\"\n msgstr \"\"\n \n-#: models.py:260\n+#: models.py:331\n msgid \"user\"\n msgstr \"\"\n \n-#: models.py:261\n+#: models.py:332\n msgid \"users\"\n msgstr \"\"\n \n-#: views.py:93\n+#: views.py:97\n msgid \"Logged out\"\n msgstr \"\"\n \n-#: management/commands/createsuperuser.py:27\n-msgid \"Enter a valid e-mail address.\"\n-msgstr \"\"\n-\n #: templates/registration/password_reset_subject.txt:2\n #, python-format\n msgid \"Password reset on %(site_name)s\""
        },
        {
            "sha": "b5fd29a1c216ab5318d9fc168d28aa35fa1d0d56",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 57,
            "deletions": 16,
            "changes": 73,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -6,9 +6,11 @@\n import getpass\n import locale\n import unicodedata\n-from django.contrib.auth import models as auth_app\n+\n+from django.contrib.auth import models as auth_app, get_user_model\n+from django.core import exceptions\n+from django.core.management.base import CommandError\n from django.db.models import get_models, signals\n-from django.contrib.auth.models import User\n from django.utils import six\n from django.utils.six.moves import input\n \n@@ -17,13 +19,43 @@ def _get_permission_codename(action, opts):\n     return '%s_%s' % (action, opts.object_name.lower())\n \n \n-def _get_all_permissions(opts):\n-    \"Returns (codename, name) for all permissions in the given opts.\"\n+def _get_all_permissions(opts, ctype):\n+    \"\"\"\n+    Returns (codename, name) for all permissions in the given opts.\n+    \"\"\"\n+    builtin = _get_builtin_permissions(opts)\n+    custom = list(opts.permissions)\n+    _check_permission_clashing(custom, builtin, ctype)\n+    return builtin + custom\n+\n+def _get_builtin_permissions(opts):\n+    \"\"\"\n+    Returns (codename, name) for all autogenerated permissions.\n+    \"\"\"\n     perms = []\n     for action in ('add', 'change', 'delete'):\n-        perms.append((_get_permission_codename(action, opts), 'Can %s %s' % (action, opts.verbose_name_raw)))\n-    return perms + list(opts.permissions)\n+        perms.append((_get_permission_codename(action, opts),\n+            'Can %s %s' % (action, opts.verbose_name_raw)))\n+    return perms\n \n+def _check_permission_clashing(custom, builtin, ctype):\n+    \"\"\"\n+    Check that permissions for a model do not clash. Raises CommandError if\n+    there are duplicate permissions.\n+    \"\"\"\n+    pool = set()\n+    builtin_codenames = set(p[0] for p in builtin)\n+    for codename, _name in custom:\n+        if codename in pool:\n+            raise CommandError(\n+                \"The permission codename '%s' is duplicated for model '%s.%s'.\" %\n+                (codename, ctype.app_label, ctype.model_class().__name__))\n+        elif codename in builtin_codenames:\n+            raise CommandError(\n+                \"The permission codename '%s' clashes with a builtin permission \"\n+                \"for model '%s.%s'.\" %\n+                (codename, ctype.app_label, ctype.model_class().__name__))\n+        pool.add(codename)\n \n def create_permissions(app, created_models, verbosity, **kwargs):\n     from django.contrib.contenttypes.models import ContentType\n@@ -38,7 +70,7 @@ def create_permissions(app, created_models, verbosity, **kwargs):\n     for klass in app_models:\n         ctype = ContentType.objects.get_for_model(klass)\n         ctypes.add(ctype)\n-        for perm in _get_all_permissions(klass._meta):\n+        for perm in _get_all_permissions(klass._meta, ctype):\n             searched_perms.append((ctype, perm))\n \n     # Find all the Permissions that have a context_type for a model we're\n@@ -64,7 +96,9 @@ def create_permissions(app, created_models, verbosity, **kwargs):\n def create_superuser(app, created_models, verbosity, db, **kwargs):\n     from django.core.management import call_command\n \n-    if auth_app.User in created_models and kwargs.get('interactive', True):\n+    UserModel = get_user_model()\n+\n+    if UserModel in created_models and kwargs.get('interactive', True):\n         msg = (\"\\nYou just installed Django's auth system, which means you \"\n             \"don't have any superusers defined.\\nWould you like to create one \"\n             \"now? (yes/no): \")\n@@ -113,28 +147,35 @@ def get_default_username(check_db=True):\n     :returns: The username, or an empty string if no username can be\n         determined.\n     \"\"\"\n-    from django.contrib.auth.management.commands.createsuperuser import (\n-        RE_VALID_USERNAME)\n+    # If the User model has been swapped out, we can't make any assumptions\n+    # about the default user name.\n+    if auth_app.User._meta.swapped:\n+        return ''\n+\n     default_username = get_system_username()\n     try:\n         default_username = unicodedata.normalize('NFKD', default_username)\\\n             .encode('ascii', 'ignore').decode('ascii').replace(' ', '').lower()\n     except UnicodeDecodeError:\n         return ''\n-    if not RE_VALID_USERNAME.match(default_username):\n+\n+    # Run the username validator\n+    try:\n+        auth_app.User._meta.get_field('username').run_validators(default_username)\n+    except exceptions.ValidationError:\n         return ''\n+\n     # Don't return the default username if it is already taken.\n     if check_db and default_username:\n         try:\n-            User.objects.get(username=default_username)\n-        except User.DoesNotExist:\n+            auth_app.User.objects.get(username=default_username)\n+        except auth_app.User.DoesNotExist:\n             pass\n         else:\n             return ''\n     return default_username\n \n-\n signals.post_syncdb.connect(create_permissions,\n-    dispatch_uid = \"django.contrib.auth.management.create_permissions\")\n+    dispatch_uid=\"django.contrib.auth.management.create_permissions\")\n signals.post_syncdb.connect(create_superuser,\n-    sender=auth_app, dispatch_uid = \"django.contrib.auth.management.create_superuser\")\n+    sender=auth_app, dispatch_uid=\"django.contrib.auth.management.create_superuser\")"
        },
        {
            "sha": "ff38836a95f3360e0983ad39a8f81d63c4dab4f6",
            "filename": "django/contrib/auth/management/commands/changepassword.py",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fchangepassword.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fchangepassword.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fchangepassword.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,8 +1,8 @@\n import getpass\n from optparse import make_option\n \n+from django.contrib.auth import get_user_model\n from django.core.management.base import BaseCommand, CommandError\n-from django.contrib.auth.models import User\n from django.db import DEFAULT_DB_ALIAS\n \n \n@@ -30,12 +30,16 @@ def handle(self, *args, **options):\n         else:\n             username = getpass.getuser()\n \n+        UserModel = get_user_model()\n+\n         try:\n-            u = User.objects.using(options.get('database')).get(username=username)\n-        except User.DoesNotExist:\n+            u = UserModel.objects.using(options.get('database')).get(**{\n+                    UserModel.USERNAME_FIELD: username\n+                })\n+        except UserModel.DoesNotExist:\n             raise CommandError(\"user '%s' does not exist\" % username)\n \n-        self.stdout.write(\"Changing password for user '%s'\\n\" % u.username)\n+        self.stdout.write(\"Changing password for user '%s'\\n\" % u)\n \n         MAX_TRIES = 3\n         count = 0\n@@ -48,9 +52,9 @@ def handle(self, *args, **options):\n                 count = count + 1\n \n         if count == MAX_TRIES:\n-            raise CommandError(\"Aborting password change for user '%s' after %s attempts\" % (username, count))\n+            raise CommandError(\"Aborting password change for user '%s' after %s attempts\" % (u, count))\n \n         u.set_password(p1)\n         u.save()\n \n-        return \"Password changed successfully for user '%s'\" % u.username\n+        return \"Password changed successfully for user '%s'\" % u"
        },
        {
            "sha": "216d56d7305431b050eb499bf1f9514ed5e9fc97",
            "filename": "django/contrib/auth/management/commands/createsuperuser.py",
            "status": "modified",
            "additions": 83,
            "deletions": 72,
            "changes": 155,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,109 +3,119 @@\n \"\"\"\n \n import getpass\n-import re\n import sys\n from optparse import make_option\n \n-from django.contrib.auth.models import User\n+from django.contrib.auth import get_user_model\n from django.contrib.auth.management import get_default_username\n from django.core import exceptions\n from django.core.management.base import BaseCommand, CommandError\n from django.db import DEFAULT_DB_ALIAS\n from django.utils.six.moves import input\n-from django.utils.translation import ugettext as _\n-\n-RE_VALID_USERNAME = re.compile('[\\w.@+-]+$')\n-\n-EMAIL_RE = re.compile(\n-    r\"(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*\"  # dot-atom\n-    r'|^\"([\\001-\\010\\013\\014\\016-\\037!#-\\[\\]-\\177]|\\\\[\\001-\\011\\013\\014\\016-\\177])*\"' # quoted-string\n-    r')@(?:[A-Z0-9-]+\\.)+[A-Z]{2,6}$', re.IGNORECASE)  # domain\n-\n-\n-def is_valid_email(value):\n-    if not EMAIL_RE.search(value):\n-        raise exceptions.ValidationError(_('Enter a valid e-mail address.'))\n+from django.utils.text import capfirst\n \n \n class Command(BaseCommand):\n-    option_list = BaseCommand.option_list + (\n-        make_option('--username', dest='username', default=None,\n-            help='Specifies the username for the superuser.'),\n-        make_option('--email', dest='email', default=None,\n-            help='Specifies the email address for the superuser.'),\n-        make_option('--noinput', action='store_false', dest='interactive', default=True,\n-            help=('Tells Django to NOT prompt the user for input of any kind. '\n-                  'You must use --username and --email with --noinput, and '\n-                  'superusers created with --noinput will not be able to log '\n-                  'in until they\\'re given a valid password.')),\n-        make_option('--database', action='store', dest='database',\n-            default=DEFAULT_DB_ALIAS, help='Specifies the database to use. Default is \"default\".'),\n-    )\n+\n+    def __init__(self, *args, **kwargs):\n+        # Options are defined in an __init__ method to support swapping out\n+        # custom user models in tests.\n+        super(Command, self).__init__(*args, **kwargs)\n+        self.UserModel = get_user_model()\n+        self.username_field = self.UserModel._meta.get_field(self.UserModel.USERNAME_FIELD)\n+\n+        self.option_list = BaseCommand.option_list + (\n+            make_option('--%s' % self.UserModel.USERNAME_FIELD, dest=self.UserModel.USERNAME_FIELD, default=None,\n+                help='Specifies the login for the superuser.'),\n+            make_option('--noinput', action='store_false', dest='interactive', default=True,\n+                help=('Tells Django to NOT prompt the user for input of any kind. '\n+                    'You must use --%s with --noinput, along with an option for '\n+                    'any other required field. Superusers created with --noinput will '\n+                    ' not be able to log in until they\\'re given a valid password.' %\n+                    self.UserModel.USERNAME_FIELD)),\n+            make_option('--database', action='store', dest='database',\n+                default=DEFAULT_DB_ALIAS, help='Specifies the database to use. Default is \"default\".'),\n+        ) + tuple(\n+            make_option('--%s' % field, dest=field, default=None,\n+                help='Specifies the %s for the superuser.' % field)\n+            for field in self.UserModel.REQUIRED_FIELDS\n+        )\n+\n+    option_list = BaseCommand.option_list\n     help = 'Used to create a superuser.'\n \n     def handle(self, *args, **options):\n-        username = options.get('username', None)\n-        email = options.get('email', None)\n+        username = options.get(self.UserModel.USERNAME_FIELD, None)\n         interactive = options.get('interactive')\n         verbosity = int(options.get('verbosity', 1))\n         database = options.get('database')\n \n-        # Do quick and dirty validation if --noinput\n-        if not interactive:\n-            if not username or not email:\n-                raise CommandError(\"You must use --username and --email with --noinput.\")\n-            if not RE_VALID_USERNAME.match(username):\n-                raise CommandError(\"Invalid username. Use only letters, digits, and underscores\")\n-            try:\n-                is_valid_email(email)\n-            except exceptions.ValidationError:\n-                raise CommandError(\"Invalid email address.\")\n-\n         # If not provided, create the user with an unusable password\n         password = None\n+        user_data = {}\n \n-        # Prompt for username/email/password. Enclose this whole thing in a\n-        # try/except to trap for a keyboard interrupt and exit gracefully.\n-        if interactive:\n+        # Do quick and dirty validation if --noinput\n+        if not interactive:\n+            try:\n+                if not username:\n+                    raise CommandError(\"You must use --%s with --noinput.\" %\n+                            self.UserModel.USERNAME_FIELD)\n+                username = self.username_field.clean(username, None)\n+\n+                for field_name in self.UserModel.REQUIRED_FIELDS:\n+                    if options.get(field_name):\n+                        field = self.UserModel._meta.get_field(field_name)\n+                        user_data[field_name] = field.clean(options[field_name], None)\n+                    else:\n+                        raise CommandError(\"You must use --%s with --noinput.\" % field_name)\n+            except exceptions.ValidationError as e:\n+                raise CommandError('; '.join(e.messages))\n+\n+        else:\n+            # Prompt for username/password, and any other required fields.\n+            # Enclose this whole thing in a try/except to trap for a\n+            # keyboard interrupt and exit gracefully.\n             default_username = get_default_username()\n             try:\n \n                 # Get a username\n-                while 1:\n+                while username is None:\n                     if not username:\n-                        input_msg = 'Username'\n+                        input_msg = capfirst(self.username_field.verbose_name)\n                         if default_username:\n-                            input_msg += ' (leave blank to use %r)' % default_username\n-                        username = input(input_msg + ': ')\n-                    if default_username and username == '':\n-                        username = default_username\n-                    if not RE_VALID_USERNAME.match(username):\n-                        self.stderr.write(\"Error: That username is invalid. Use only letters, digits and underscores.\")\n+                            input_msg += \" (leave blank to use '%s')\" % default_username\n+                        raw_value = input(input_msg + ': ')\n+\n+                    if default_username and raw_value == '':\n+                        raw_value = default_username\n+                    try:\n+                        username = self.username_field.clean(raw_value, None)\n+                    except exceptions.ValidationError as e:\n+                        self.stderr.write(\"Error: %s\" % '; '.join(e.messages))\n                         username = None\n                         continue\n                     try:\n-                        User.objects.using(database).get(username=username)\n-                    except User.DoesNotExist:\n-                        break\n+                        self.UserModel.objects.db_manager(database).get_by_natural_key(username)\n+                    except self.UserModel.DoesNotExist:\n+                        pass\n                     else:\n-                        self.stderr.write(\"Error: That username is already taken.\")\n+                        self.stderr.write(\"Error: That %s is already taken.\" %\n+                                self.username_field.verbose_name)\n                         username = None\n \n-                # Get an email\n-                while 1:\n-                    if not email:\n-                        email = input('E-mail address: ')\n-                    try:\n-                        is_valid_email(email)\n-                    except exceptions.ValidationError:\n-                        self.stderr.write(\"Error: That e-mail address is invalid.\")\n-                        email = None\n-                    else:\n-                        break\n+                for field_name in self.UserModel.REQUIRED_FIELDS:\n+                    field = self.UserModel._meta.get_field(field_name)\n+                    user_data[field_name] = options.get(field_name)\n+                    while user_data[field_name] is None:\n+                        raw_value = input(capfirst(field.verbose_name + ': '))\n+                        try:\n+                            user_data[field_name] = field.clean(raw_value, None)\n+                        except exceptions.ValidationError as e:\n+                            self.stderr.write(\"Error: %s\" % '; '.join(e.messages))\n+                            user_data[field_name] = None\n \n                 # Get a password\n-                while 1:\n+                while password is None:\n                     if not password:\n                         password = getpass.getpass()\n                         password2 = getpass.getpass('Password (again): ')\n@@ -117,12 +127,13 @@ def handle(self, *args, **options):\n                         self.stderr.write(\"Error: Blank passwords aren't allowed.\")\n                         password = None\n                         continue\n-                    break\n+\n             except KeyboardInterrupt:\n                 self.stderr.write(\"\\nOperation cancelled.\")\n                 sys.exit(1)\n \n-        User.objects.db_manager(database).create_superuser(username, email, password)\n+        user_data[self.UserModel.USERNAME_FIELD] = username\n+        user_data['password'] = password\n+        self.UserModel.objects.db_manager(database).create_superuser(**user_data)\n         if verbosity >= 1:\n-          self.stdout.write(\"Superuser created successfully.\")\n-\n+            self.stdout.write(\"Superuser created successfully.\")"
        },
        {
            "sha": "0398cfaf1e403975f22b92d3bf0b80ba1406a9ba",
            "filename": "django/contrib/auth/middleware.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmiddleware.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmiddleware.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmiddleware.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -55,7 +55,7 @@ def process_request(self, request):\n         # getting passed in the headers, then the correct user is already\n         # persisted in the session and we don't need to continue.\n         if request.user.is_authenticated():\n-            if request.user.username == self.clean_username(username, request):\n+            if request.user.get_username() == self.clean_username(username, request):\n                 return\n         # We are seeing this user for the first time in this session, attempt\n         # to authenticate the user.\n@@ -75,6 +75,6 @@ def clean_username(self, username, request):\n         backend = auth.load_backend(backend_str)\n         try:\n             username = backend.clean_username(username)\n-        except AttributeError: # Backend has no clean_username method.\n+        except AttributeError:  # Backend has no clean_username method.\n             pass\n         return username"
        },
        {
            "sha": "bd7bf4a162a7857b3560cccd948b777a7302f4fd",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 116,
            "deletions": 70,
            "changes": 186,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,7 +1,10 @@\n from __future__ import unicode_literals\n+import re\n+import warnings\n \n from django.core.exceptions import ImproperlyConfigured\n from django.core.mail import send_mail\n+from django.core import validators\n from django.db import models\n from django.db.models.manager import EmptyManager\n from django.utils.crypto import get_random_string\n@@ -96,6 +99,7 @@ class GroupManager(models.Manager):\n     def get_by_natural_key(self, name):\n         return self.get(name=name)\n \n+\n @python_2_unicode_compatible\n class Group(models.Model):\n     \"\"\"\n@@ -131,7 +135,7 @@ def natural_key(self):\n         return (self.name,)\n \n \n-class UserManager(models.Manager):\n+class BaseUserManager(models.Manager):\n \n     @classmethod\n     def normalize_email(cls, email):\n@@ -148,7 +152,25 @@ def normalize_email(cls, email):\n             email = '@'.join([email_name, domain_part.lower()])\n         return email\n \n-    def create_user(self, username, email=None, password=None):\n+    def make_random_password(self, length=10,\n+                             allowed_chars='abcdefghjkmnpqrstuvwxyz'\n+                                           'ABCDEFGHJKLMNPQRSTUVWXYZ'\n+                                           '23456789'):\n+        \"\"\"\n+        Generates a random password with the given length and given\n+        allowed_chars. Note that the default value of allowed_chars does not\n+        have \"I\" or \"O\" or letters and digits that look similar -- just to\n+        avoid confusion.\n+        \"\"\"\n+        return get_random_string(length, allowed_chars)\n+\n+    def get_by_natural_key(self, username):\n+        return self.get(**{self.model.USERNAME_FIELD: username})\n+\n+\n+class UserManager(BaseUserManager):\n+\n+    def create_user(self, username, email=None, password=None, **extra_fields):\n         \"\"\"\n         Creates and saves a User with the given username, email and password.\n         \"\"\"\n@@ -158,35 +180,20 @@ def create_user(self, username, email=None, password=None):\n         email = UserManager.normalize_email(email)\n         user = self.model(username=username, email=email,\n                           is_staff=False, is_active=True, is_superuser=False,\n-                          last_login=now, date_joined=now)\n+                          last_login=now, date_joined=now, **extra_fields)\n \n         user.set_password(password)\n         user.save(using=self._db)\n         return user\n \n-    def create_superuser(self, username, email, password):\n-        u = self.create_user(username, email, password)\n+    def create_superuser(self, username, email, password, **extra_fields):\n+        u = self.create_user(username, email, password, **extra_fields)\n         u.is_staff = True\n         u.is_active = True\n         u.is_superuser = True\n         u.save(using=self._db)\n         return u\n \n-    def make_random_password(self, length=10,\n-                             allowed_chars='abcdefghjkmnpqrstuvwxyz'\n-                                           'ABCDEFGHJKLMNPQRSTUVWXYZ'\n-                                           '23456789'):\n-        \"\"\"\n-        Generates a random password with the given length and given\n-        allowed_chars. Note that the default value of allowed_chars does not\n-        have \"I\" or \"O\" or letters and digits that look similar -- just to\n-        avoid confusion.\n-        \"\"\"\n-        return get_random_string(length, allowed_chars)\n-\n-    def get_by_natural_key(self, username):\n-        return self.get(username=username)\n-\n \n # A few helper functions for common logic between User and AnonymousUser.\n def _user_get_all_permissions(user, obj):\n@@ -201,8 +208,6 @@ def _user_get_all_permissions(user, obj):\n \n \n def _user_has_perm(user, perm, obj):\n-    anon = user.is_anonymous()\n-    active = user.is_active\n     for backend in auth.get_backends():\n         if hasattr(backend, \"has_perm\"):\n             if obj is not None:\n@@ -215,8 +220,6 @@ def _user_has_perm(user, perm, obj):\n \n \n def _user_has_module_perms(user, app_label):\n-    anon = user.is_anonymous()\n-    active = user.is_active\n     for backend in auth.get_backends():\n         if hasattr(backend, \"has_module_perms\"):\n             if backend.has_module_perms(user, app_label):\n@@ -225,52 +228,24 @@ def _user_has_module_perms(user, app_label):\n \n \n @python_2_unicode_compatible\n-class User(models.Model):\n-    \"\"\"\n-    Users within the Django authentication system are represented by this\n-    model.\n-\n-    Username and password are required. Other fields are optional.\n-    \"\"\"\n-    username = models.CharField(_('username'), max_length=30, unique=True,\n-        help_text=_('Required. 30 characters or fewer. Letters, numbers and '\n-                    '@/./+/-/_ characters'))\n-    first_name = models.CharField(_('first name'), max_length=30, blank=True)\n-    last_name = models.CharField(_('last name'), max_length=30, blank=True)\n-    email = models.EmailField(_('e-mail address'), blank=True)\n+class AbstractBaseUser(models.Model):\n     password = models.CharField(_('password'), max_length=128)\n-    is_staff = models.BooleanField(_('staff status'), default=False,\n-        help_text=_('Designates whether the user can log into this admin '\n-                    'site.'))\n-    is_active = models.BooleanField(_('active'), default=True,\n-        help_text=_('Designates whether this user should be treated as '\n-                    'active. Unselect this instead of deleting accounts.'))\n-    is_superuser = models.BooleanField(_('superuser status'), default=False,\n-        help_text=_('Designates that this user has all permissions without '\n-                    'explicitly assigning them.'))\n     last_login = models.DateTimeField(_('last login'), default=timezone.now)\n-    date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n-    groups = models.ManyToManyField(Group, verbose_name=_('groups'),\n-        blank=True, help_text=_('The groups this user belongs to. A user will '\n-                                'get all permissions granted to each of '\n-                                'his/her group.'))\n-    user_permissions = models.ManyToManyField(Permission,\n-        verbose_name=_('user permissions'), blank=True,\n-        help_text='Specific permissions for this user.')\n-    objects = UserManager()\n+\n+    REQUIRED_FIELDS = []\n \n     class Meta:\n-        verbose_name = _('user')\n-        verbose_name_plural = _('users')\n+        abstract = True\n+\n+    def get_username(self):\n+        \"Return the identifying username for this User\"\n+        return getattr(self, self.USERNAME_FIELD)\n \n     def __str__(self):\n-        return self.username\n+        return self.get_username()\n \n     def natural_key(self):\n-        return (self.username,)\n-\n-    def get_absolute_url(self):\n-        return \"/users/%s/\" % urlquote(self.username)\n+        return (self.get_username(),)\n \n     def is_anonymous(self):\n         \"\"\"\n@@ -286,13 +261,6 @@ def is_authenticated(self):\n         \"\"\"\n         return True\n \n-    def get_full_name(self):\n-        \"\"\"\n-        Returns the first_name plus the last_name, with a space in between.\n-        \"\"\"\n-        full_name = '%s %s' % (self.first_name, self.last_name)\n-        return full_name.strip()\n-\n     def set_password(self, raw_password):\n         self.password = make_password(raw_password)\n \n@@ -313,6 +281,71 @@ def set_unusable_password(self):\n     def has_usable_password(self):\n         return is_password_usable(self.password)\n \n+    def get_full_name(self):\n+        raise NotImplementedError()\n+\n+    def get_short_name(self):\n+        raise NotImplementedError()\n+\n+\n+class AbstractUser(AbstractBaseUser):\n+    \"\"\"\n+    An abstract base class implementing a fully featured User model with\n+    admin-compliant permissions.\n+\n+    Username, password and email are required. Other fields are optional.\n+    \"\"\"\n+    username = models.CharField(_('username'), max_length=30, unique=True,\n+        help_text=_('Required. 30 characters or fewer. Letters, numbers and '\n+                    '@/./+/-/_ characters'),\n+        validators=[\n+            validators.RegexValidator(re.compile('^[\\w.@+-]+$'), _('Enter a valid username.'), 'invalid')\n+        ])\n+    first_name = models.CharField(_('first name'), max_length=30, blank=True)\n+    last_name = models.CharField(_('last name'), max_length=30, blank=True)\n+    email = models.EmailField(_('email address'), blank=True)\n+    is_staff = models.BooleanField(_('staff status'), default=False,\n+        help_text=_('Designates whether the user can log into this admin '\n+                    'site.'))\n+    is_active = models.BooleanField(_('active'), default=True,\n+        help_text=_('Designates whether this user should be treated as '\n+                    'active. Unselect this instead of deleting accounts.'))\n+    is_superuser = models.BooleanField(_('superuser status'), default=False,\n+        help_text=_('Designates that this user has all permissions without '\n+                    'explicitly assigning them.'))\n+    date_joined = models.DateTimeField(_('date joined'), default=timezone.now)\n+    groups = models.ManyToManyField(Group, verbose_name=_('groups'),\n+        blank=True, help_text=_('The groups this user belongs to. A user will '\n+                                'get all permissions granted to each of '\n+                                'his/her group.'))\n+    user_permissions = models.ManyToManyField(Permission,\n+        verbose_name=_('user permissions'), blank=True,\n+        help_text='Specific permissions for this user.')\n+\n+    objects = UserManager()\n+\n+    USERNAME_FIELD = 'username'\n+    REQUIRED_FIELDS = ['email']\n+\n+    class Meta:\n+        verbose_name = _('user')\n+        verbose_name_plural = _('users')\n+        abstract = True\n+\n+    def get_absolute_url(self):\n+        return \"/users/%s/\" % urlquote(self.username)\n+\n+    def get_full_name(self):\n+        \"\"\"\n+        Returns the first_name plus the last_name, with a space in between.\n+        \"\"\"\n+        full_name = '%s %s' % (self.first_name, self.last_name)\n+        return full_name.strip()\n+\n+    def get_short_name(self):\n+        \"Returns the short name for the user.\"\n+        return self.first_name\n+\n     def get_group_permissions(self, obj=None):\n         \"\"\"\n         Returns a list of permission strings that this user has through his/her\n@@ -381,6 +414,8 @@ def get_profile(self):\n         Returns site-specific profile for this user. Raises\n         SiteProfileNotAvailable if this site does not allow profiles.\n         \"\"\"\n+        warnings.warn(\"The use of AUTH_PROFILE_MODULE to define user profiles has been deprecated.\",\n+            PendingDeprecationWarning)\n         if not hasattr(self, '_profile_cache'):\n             from django.conf import settings\n             if not getattr(settings, 'AUTH_PROFILE_MODULE', False):\n@@ -407,6 +442,17 @@ def get_profile(self):\n         return self._profile_cache\n \n \n+class User(AbstractUser):\n+    \"\"\"\n+    Users within the Django authentication system are represented by this\n+    model.\n+\n+    Username, password and email are required. Other fields are optional.\n+    \"\"\"\n+    class Meta:\n+        swappable = 'AUTH_USER_MODEL'\n+\n+\n @python_2_unicode_compatible\n class AnonymousUser(object):\n     id = None\n@@ -431,7 +477,7 @@ def __ne__(self, other):\n         return not self.__eq__(other)\n \n     def __hash__(self):\n-        return 1 # instances always return the same hash value\n+        return 1  # instances always return the same hash value\n \n     def save(self):\n         raise NotImplementedError"
        },
        {
            "sha": "71ab6a11d184b7a0230b3d472603d654508a34a3",
            "filename": "django/contrib/auth/signals.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fsignals.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,5 @@\n from django.dispatch import Signal\n \n user_logged_in = Signal(providing_args=['request', 'user'])\n+user_login_failed = Signal(providing_args=['credentials'])\n user_logged_out = Signal(providing_args=['request', 'user'])"
        },
        {
            "sha": "b3007ea484b99c68333a0c591b0ae9a36be05b19",
            "filename": "django/contrib/auth/tests/__init__.py",
            "status": "modified",
            "additions": 14,
            "deletions": 24,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,26 +1,16 @@\n-from django.contrib.auth.tests.auth_backends import (BackendTest,\n-    RowlevelBackendTest, AnonymousUserBackendTest, NoBackendsTest,\n-    InActiveUserBackendTest)\n-from django.contrib.auth.tests.basic import BasicTestCase\n-from django.contrib.auth.tests.context_processors import AuthContextProcessorTests\n-from django.contrib.auth.tests.decorators import LoginRequiredTestCase\n-from django.contrib.auth.tests.forms import (UserCreationFormTest,\n-    AuthenticationFormTest, SetPasswordFormTest, PasswordChangeFormTest,\n-    UserChangeFormTest, PasswordResetFormTest)\n-from django.contrib.auth.tests.remote_user import (RemoteUserTest,\n-    RemoteUserNoCreateTest, RemoteUserCustomTest)\n-from django.contrib.auth.tests.management import (\n-    GetDefaultUsernameTestCase,\n-    ChangepasswordManagementCommandTestCase,\n-)\n-from django.contrib.auth.tests.models import (ProfileTestCase, NaturalKeysTestCase,\n-    LoadDataWithoutNaturalKeysTestCase, LoadDataWithNaturalKeysTestCase,\n-    UserManagerTestCase)\n-from django.contrib.auth.tests.hashers import TestUtilsHashPass\n-from django.contrib.auth.tests.signals import SignalTestCase\n-from django.contrib.auth.tests.tokens import TokenGeneratorTest\n-from django.contrib.auth.tests.views import (AuthViewNamedURLTests,\n-    PasswordResetTest, ChangePasswordTest, LoginTest, LogoutTest,\n-    LoginURLSettings)\n+from django.contrib.auth.tests.custom_user import *\n+from django.contrib.auth.tests.auth_backends import *\n+from django.contrib.auth.tests.basic import *\n+from django.contrib.auth.tests.context_processors import *\n+from django.contrib.auth.tests.decorators import *\n+from django.contrib.auth.tests.forms import *\n+from django.contrib.auth.tests.remote_user import *\n+from django.contrib.auth.tests.management import *\n+from django.contrib.auth.tests.models import *\n+from django.contrib.auth.tests.handlers import *\n+from django.contrib.auth.tests.hashers import *\n+from django.contrib.auth.tests.signals import *\n+from django.contrib.auth.tests.tokens import *\n+from django.contrib.auth.tests.views import *\n \n # The password for the fixture data users is 'password'"
        },
        {
            "sha": "e92f159ff91070eac9b273b1b7003e52d2076d2d",
            "filename": "django/contrib/auth/tests/auth_backends.py",
            "status": "modified",
            "additions": 82,
            "deletions": 17,
            "changes": 99,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fauth_backends.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,22 +1,29 @@\n from __future__ import unicode_literals\n+from datetime import date\n \n from django.conf import settings\n from django.contrib.auth.models import User, Group, Permission, AnonymousUser\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.contrib.auth.tests.custom_user import ExtensionUser\n from django.contrib.contenttypes.models import ContentType\n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase\n from django.test.utils import override_settings\n \n \n-class BackendTest(TestCase):\n-\n+class BaseModelBackendTest(object):\n+    \"\"\"\n+    A base class for tests that need to validate the ModelBackend\n+    with different User models. Subclasses should define a class\n+    level UserModel attribute, and a create_users() method to\n+    construct two users for test purposes.\n+    \"\"\"\n     backend = 'django.contrib.auth.backends.ModelBackend'\n \n     def setUp(self):\n         self.curr_auth = settings.AUTHENTICATION_BACKENDS\n         settings.AUTHENTICATION_BACKENDS = (self.backend,)\n-        User.objects.create_user('test', 'test@example.com', 'test')\n-        User.objects.create_superuser('test2', 'test2@example.com', 'test')\n+        self.create_users()\n \n     def tearDown(self):\n         settings.AUTHENTICATION_BACKENDS = self.curr_auth\n@@ -26,7 +33,7 @@ def tearDown(self):\n         ContentType.objects.clear_cache()\n \n     def test_has_perm(self):\n-        user = User.objects.get(username='test')\n+        user = self.UserModel.objects.get(username='test')\n         self.assertEqual(user.has_perm('auth.test'), False)\n         user.is_staff = True\n         user.save()\n@@ -45,14 +52,14 @@ def test_has_perm(self):\n         self.assertEqual(user.has_perm('auth.test'), False)\n \n     def test_custom_perms(self):\n-        user = User.objects.get(username='test')\n-        content_type=ContentType.objects.get_for_model(Group)\n+        user = self.UserModel.objects.get(username='test')\n+        content_type = ContentType.objects.get_for_model(Group)\n         perm = Permission.objects.create(name='test', content_type=content_type, codename='test')\n         user.user_permissions.add(perm)\n         user.save()\n \n         # reloading user to purge the _perm_cache\n-        user = User.objects.get(username='test')\n+        user = self.UserModel.objects.get(username='test')\n         self.assertEqual(user.get_all_permissions() == set(['auth.test']), True)\n         self.assertEqual(user.get_group_permissions(), set([]))\n         self.assertEqual(user.has_module_perms('Group'), False)\n@@ -63,7 +70,7 @@ def test_custom_perms(self):\n         perm = Permission.objects.create(name='test3', content_type=content_type, codename='test3')\n         user.user_permissions.add(perm)\n         user.save()\n-        user = User.objects.get(username='test')\n+        user = self.UserModel.objects.get(username='test')\n         self.assertEqual(user.get_all_permissions(), set(['auth.test2', 'auth.test', 'auth.test3']))\n         self.assertEqual(user.has_perm('test'), False)\n         self.assertEqual(user.has_perm('auth.test'), True)\n@@ -73,7 +80,7 @@ def test_custom_perms(self):\n         group.permissions.add(perm)\n         group.save()\n         user.groups.add(group)\n-        user = User.objects.get(username='test')\n+        user = self.UserModel.objects.get(username='test')\n         exp = set(['auth.test2', 'auth.test', 'auth.test3', 'auth.test_group'])\n         self.assertEqual(user.get_all_permissions(), exp)\n         self.assertEqual(user.get_group_permissions(), set(['auth.test_group']))\n@@ -85,8 +92,8 @@ def test_custom_perms(self):\n \n     def test_has_no_object_perm(self):\n         \"\"\"Regressiontest for #12462\"\"\"\n-        user = User.objects.get(username='test')\n-        content_type=ContentType.objects.get_for_model(Group)\n+        user = self.UserModel.objects.get(username='test')\n+        content_type = ContentType.objects.get_for_model(Group)\n         perm = Permission.objects.create(name='test', content_type=content_type, codename='test')\n         user.user_permissions.add(perm)\n         user.save()\n@@ -98,17 +105,73 @@ def test_has_no_object_perm(self):\n \n     def test_get_all_superuser_permissions(self):\n         \"A superuser has all permissions. Refs #14795\"\n-        user = User.objects.get(username='test2')\n+        user = self.UserModel.objects.get(username='test2')\n         self.assertEqual(len(user.get_all_permissions()), len(Permission.objects.all()))\n \n+\n+@skipIfCustomUser\n+class ModelBackendTest(BaseModelBackendTest, TestCase):\n+    \"\"\"\n+    Tests for the ModelBackend using the default User model.\n+    \"\"\"\n+    UserModel = User\n+\n+    def create_users(self):\n+        User.objects.create_user(\n+            username='test',\n+            email='test@example.com',\n+            password='test',\n+        )\n+        User.objects.create_superuser(\n+            username='test2',\n+            email='test2@example.com',\n+            password='test',\n+        )\n+\n+\n+@override_settings(AUTH_USER_MODEL='auth.ExtensionUser')\n+class ExtensionUserModelBackendTest(BaseModelBackendTest, TestCase):\n+    \"\"\"\n+    Tests for the ModelBackend using the custom ExtensionUser model.\n+\n+    This isn't a perfect test, because both the User and ExtensionUser are\n+    synchronized to the database, which wouldn't ordinary happen in\n+    production. As a result, it doesn't catch errors caused by the non-\n+    existence of the User table.\n+\n+    The specific problem is queries on .filter(groups__user) et al, which\n+    makes an implicit assumption that the user model is called 'User'. In\n+    production, the auth.User table won't exist, so the requested join\n+    won't exist either; in testing, the auth.User *does* exist, and\n+    so does the join. However, the join table won't contain any useful\n+    data; for testing, we check that the data we expect actually does exist.\n+    \"\"\"\n+\n+    UserModel = ExtensionUser\n+\n+    def create_users(self):\n+        ExtensionUser.objects.create_user(\n+            username='test',\n+            email='test@example.com',\n+            password='test',\n+            date_of_birth=date(2006, 4, 25)\n+        )\n+        ExtensionUser.objects.create_superuser(\n+            username='test2',\n+            email='test2@example.com',\n+            password='test',\n+            date_of_birth=date(1976, 11, 8)\n+        )\n+\n+\n class TestObj(object):\n     pass\n \n \n class SimpleRowlevelBackend(object):\n     def has_perm(self, user, perm, obj=None):\n         if not obj:\n-            return # We only support row level perms\n+            return  # We only support row level perms\n \n         if isinstance(obj, TestObj):\n             if user.username == 'test2':\n@@ -126,7 +189,7 @@ def has_module_perms(self, user, app_label):\n \n     def get_all_permissions(self, user, obj=None):\n         if not obj:\n-            return [] # We only support row level perms\n+            return []  # We only support row level perms\n \n         if not isinstance(obj, TestObj):\n             return ['none']\n@@ -140,7 +203,7 @@ def get_all_permissions(self, user, obj=None):\n \n     def get_group_permissions(self, user, obj=None):\n         if not obj:\n-            return # We only support row level perms\n+            return  # We only support row level perms\n \n         if not isinstance(obj, TestObj):\n             return ['none']\n@@ -151,6 +214,7 @@ def get_group_permissions(self, user, obj=None):\n             return ['none']\n \n \n+@skipIfCustomUser\n class RowlevelBackendTest(TestCase):\n     \"\"\"\n     Tests for auth backend that supports object level permissions\n@@ -186,7 +250,6 @@ def test_get_all_permissions(self):\n         self.assertEqual(self.user2.get_all_permissions(), set([]))\n \n     def test_get_group_permissions(self):\n-        content_type=ContentType.objects.get_for_model(Group)\n         group = Group.objects.create(name='test_group')\n         self.user3.groups.add(group)\n         self.assertEqual(self.user3.get_group_permissions(TestObj()), set(['group_perm']))\n@@ -223,6 +286,7 @@ def test_get_all_permissions(self):\n         self.assertEqual(self.user1.get_all_permissions(TestObj()), set(['anon']))\n \n \n+@skipIfCustomUser\n @override_settings(AUTHENTICATION_BACKENDS=[])\n class NoBackendsTest(TestCase):\n     \"\"\"\n@@ -235,6 +299,7 @@ def test_raises_exception(self):\n         self.assertRaises(ImproperlyConfigured, self.user.has_perm, ('perm', TestObj(),))\n \n \n+@skipIfCustomUser\n class InActiveUserBackendTest(TestCase):\n     \"\"\"\n     Tests for a inactive user"
        },
        {
            "sha": "bc7344f753e74db20ad8b9a0db0bc0213143fa52",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 38,
            "deletions": 7,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,13 +1,18 @@\n import locale\n-import traceback\n \n+from django.contrib.auth import get_user_model\n from django.contrib.auth.management.commands import createsuperuser\n from django.contrib.auth.models import User, AnonymousUser\n+from django.contrib.auth.tests.custom_user import CustomUser\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.core.exceptions import ImproperlyConfigured\n from django.core.management import call_command\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils.six import StringIO\n \n \n+@skipIfCustomUser\n class BasicTestCase(TestCase):\n     def test_user(self):\n         \"Check that users can be created and can set their password\"\n@@ -34,7 +39,7 @@ def test_user(self):\n \n         # Check API-based user creation with no password\n         u2 = User.objects.create_user('testuser2', 'test2@example.com')\n-        self.assertFalse(u.has_usable_password())\n+        self.assertFalse(u2.has_usable_password())\n \n     def test_user_no_email(self):\n         \"Check that users can be created without an email\"\n@@ -98,7 +103,6 @@ def test_createsuperuser_management_command(self):\n         self.assertEqual(u.email, 'joe2@somewhere.org')\n         self.assertFalse(u.has_usable_password())\n \n-\n         new_io = StringIO()\n         call_command(\"createsuperuser\",\n             interactive=False,\n@@ -124,15 +128,21 @@ def test_createsuperuser_nolocale(self):\n \n             # Temporarily replace getpass to allow interactive code to be used\n             # non-interactively\n-            class mock_getpass: pass\n+            class mock_getpass:\n+                pass\n             mock_getpass.getpass = staticmethod(lambda p=None: \"nopasswd\")\n             createsuperuser.getpass = mock_getpass\n \n             # Call the command in this new environment\n             new_io = StringIO()\n-            call_command(\"createsuperuser\", interactive=True, username=\"nolocale@somewhere.org\", email=\"nolocale@somewhere.org\", stdout=new_io)\n-\n-        except TypeError as e:\n+            call_command(\"createsuperuser\",\n+                interactive=True,\n+                username=\"nolocale@somewhere.org\",\n+                email=\"nolocale@somewhere.org\",\n+                stdout=new_io\n+            )\n+\n+        except TypeError:\n             self.fail(\"createsuperuser fails if the OS provides no information about the current locale\")\n \n         finally:\n@@ -143,3 +153,24 @@ class mock_getpass: pass\n         # If we were successful, a user should have been created\n         u = User.objects.get(username=\"nolocale@somewhere.org\")\n         self.assertEqual(u.email, 'nolocale@somewhere.org')\n+\n+    def test_get_user_model(self):\n+        \"The current user model can be retrieved\"\n+        self.assertEqual(get_user_model(), User)\n+\n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_swappable_user(self):\n+        \"The current user model can be swapped out for another\"\n+        self.assertEqual(get_user_model(), CustomUser)\n+\n+    @override_settings(AUTH_USER_MODEL='badsetting')\n+    def test_swappable_user_bad_setting(self):\n+        \"The alternate user setting must point to something in the format app.model\"\n+        with self.assertRaises(ImproperlyConfigured):\n+            get_user_model()\n+\n+    @override_settings(AUTH_USER_MODEL='thismodel.doesntexist')\n+    def test_swappable_user_nonexistent_model(self):\n+        \"The current user model must point to an installed model\"\n+        with self.assertRaises(ImproperlyConfigured):\n+            get_user_model()"
        },
        {
            "sha": "32fea8ac80fae73d9ceda897ee8568c429fff22d",
            "filename": "django/contrib/auth/tests/context_processors.py",
            "status": "modified",
            "additions": 74,
            "deletions": 2,
            "changes": 76,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcontext_processors.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -2,12 +2,65 @@\n \n from django.conf import global_settings\n from django.contrib.auth import authenticate\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.contrib.auth.models import User, Permission\n+from django.contrib.contenttypes.models import ContentType\n+from django.contrib.auth.context_processors import PermWrapper, PermLookupDict\n from django.db.models import Q\n-from django.template import context\n from django.test import TestCase\n from django.test.utils import override_settings\n \n \n+class MockUser(object):\n+    def has_module_perms(self, perm):\n+        if perm == 'mockapp':\n+            return True\n+        return False\n+\n+    def has_perm(self, perm):\n+        if perm == 'mockapp.someperm':\n+            return True\n+        return False\n+\n+\n+class PermWrapperTests(TestCase):\n+    \"\"\"\n+    Test some details of the PermWrapper implementation.\n+    \"\"\"\n+    class EQLimiterObject(object):\n+        \"\"\"\n+        This object makes sure __eq__ will not be called endlessly.\n+        \"\"\"\n+        def __init__(self):\n+            self.eq_calls = 0\n+\n+        def __eq__(self, other):\n+            if self.eq_calls > 0:\n+                return True\n+            self.eq_calls += 1\n+            return False\n+\n+    def test_permwrapper_in(self):\n+        \"\"\"\n+        Test that 'something' in PermWrapper works as expected.\n+        \"\"\"\n+        perms = PermWrapper(MockUser())\n+        # Works for modules and full permissions.\n+        self.assertTrue('mockapp' in perms)\n+        self.assertFalse('nonexisting' in perms)\n+        self.assertTrue('mockapp.someperm' in perms)\n+        self.assertFalse('mockapp.nonexisting' in perms)\n+\n+    def test_permlookupdict_in(self):\n+        \"\"\"\n+        No endless loops if accessed with 'in' - refs #18979.\n+        \"\"\"\n+        pldict = PermLookupDict(MockUser(), 'mockapp')\n+        with self.assertRaises(TypeError):\n+            self.EQLimiterObject() in pldict\n+\n+\n+@skipIfCustomUser\n @override_settings(\n     TEMPLATE_DIRS=(\n             os.path.join(os.path.dirname(__file__), 'templates'),\n@@ -47,9 +100,28 @@ def test_session_is_accessed(self):\n         self.assertContains(response, \"Session accessed\")\n \n     def test_perms_attrs(self):\n-        self.client.login(username='super', password='secret')\n+        u = User.objects.create_user(username='normal', password='secret')\n+        u.user_permissions.add(\n+            Permission.objects.get(\n+                content_type=ContentType.objects.get_for_model(Permission),\n+                codename='add_permission'))\n+        self.client.login(username='normal', password='secret')\n         response = self.client.get('/auth_processor_perms/')\n         self.assertContains(response, \"Has auth permissions\")\n+        self.assertContains(response, \"Has auth.add_permission permissions\")\n+        self.assertNotContains(response, \"nonexisting\")\n+    \n+    def test_perm_in_perms_attrs(self):\n+        u = User.objects.create_user(username='normal', password='secret')\n+        u.user_permissions.add(\n+            Permission.objects.get(\n+                content_type=ContentType.objects.get_for_model(Permission),\n+                codename='add_permission'))\n+        self.client.login(username='normal', password='secret')\n+        response = self.client.get('/auth_processor_perm_in_perms/')\n+        self.assertContains(response, \"Has auth permissions\")\n+        self.assertContains(response, \"Has auth.add_permission permissions\")\n+        self.assertNotContains(response, \"nonexisting\")\n \n     def test_message_attrs(self):\n         self.client.login(username='super', password='secret')"
        },
        {
            "sha": "a29ed6a104f34f1d27d51d54ebce0ff3bc41517c",
            "filename": "django/contrib/auth/tests/custom_user.py",
            "status": "added",
            "additions": 90,
            "deletions": 0,
            "changes": 90,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,90 @@\n+from django.db import models\n+from django.contrib.auth.models import BaseUserManager, AbstractBaseUser, AbstractUser, UserManager\n+\n+\n+# The custom User uses email as the unique identifier, and requires\n+# that every user provide a date of birth. This lets us test\n+# changes in username datatype, and non-text required fields.\n+\n+class CustomUserManager(BaseUserManager):\n+    def create_user(self, email, date_of_birth, password=None):\n+        \"\"\"\n+        Creates and saves a User with the given email and password.\n+        \"\"\"\n+        if not email:\n+            raise ValueError('Users must have an email address')\n+\n+        user = self.model(\n+            email=CustomUserManager.normalize_email(email),\n+            date_of_birth=date_of_birth,\n+        )\n+\n+        user.set_password(password)\n+        user.save(using=self._db)\n+        return user\n+\n+    def create_superuser(self, email, password, date_of_birth):\n+        u = self.create_user(email, password=password, date_of_birth=date_of_birth)\n+        u.is_admin = True\n+        u.save(using=self._db)\n+        return u\n+\n+\n+class CustomUser(AbstractBaseUser):\n+    email = models.EmailField(verbose_name='email address', max_length=255, unique=True)\n+    is_active = models.BooleanField(default=True)\n+    is_admin = models.BooleanField(default=False)\n+    date_of_birth = models.DateField()\n+\n+    objects = CustomUserManager()\n+\n+    USERNAME_FIELD = 'email'\n+    REQUIRED_FIELDS = ['date_of_birth']\n+\n+    class Meta:\n+        app_label = 'auth'\n+\n+    def get_full_name(self):\n+        return self.email\n+\n+    def get_short_name(self):\n+        return self.email\n+\n+    def __unicode__(self):\n+        return self.email\n+\n+    # Maybe required?\n+    def get_group_permissions(self, obj=None):\n+        return set()\n+\n+    def get_all_permissions(self, obj=None):\n+        return set()\n+\n+    def has_perm(self, perm, obj=None):\n+        return True\n+\n+    def has_perms(self, perm_list, obj=None):\n+        return True\n+\n+    def has_module_perms(self, app_label):\n+        return True\n+\n+    # Admin required fields\n+    @property\n+    def is_staff(self):\n+        return self.is_admin\n+\n+\n+# The extension user is a simple extension of the built-in user class,\n+# adding a required date_of_birth field. This allows us to check for\n+# any hard references to the name \"User\" in forms/handlers etc.\n+\n+class ExtensionUser(AbstractUser):\n+    date_of_birth = models.DateField()\n+\n+    objects = UserManager()\n+\n+    REQUIRED_FIELDS = AbstractUser.REQUIRED_FIELDS + ['date_of_birth']\n+\n+    class Meta:\n+        app_label = 'auth'"
        },
        {
            "sha": "be99e7abb6cd6277a65c15e1d22556ffb62670ac",
            "filename": "django/contrib/auth/tests/decorators.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fdecorators.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,7 +1,9 @@\n-from django.conf import settings\n from django.contrib.auth.decorators import login_required\n from django.contrib.auth.tests.views import AuthViewsTestCase\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n \n+\n+@skipIfCustomUser\n class LoginRequiredTestCase(AuthViewsTestCase):\n     \"\"\"\n     Tests the login_required decorators"
        },
        {
            "sha": "f3eb24287e822999a7d693268213eb1c35bc4c8d",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 25,
            "deletions": 2,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,16 +4,17 @@\n from django.contrib.auth.models import User\n from django.contrib.auth.forms import (UserCreationForm, AuthenticationForm,\n     PasswordChangeForm, SetPasswordForm, UserChangeForm, PasswordResetForm)\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.core import mail\n from django.forms.fields import Field, EmailField\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils.encoding import force_text\n-from django.utils import six\n from django.utils import translation\n from django.utils.translation import ugettext as _\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class UserCreationFormTest(TestCase):\n \n@@ -81,6 +82,7 @@ def test_success(self):\n         self.assertEqual(repr(u), '<User: jsmith@example.com>')\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class AuthenticationFormTest(TestCase):\n \n@@ -133,6 +135,7 @@ def test_success(self):\n         self.assertEqual(form.non_field_errors(), [])\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class SetPasswordFormTest(TestCase):\n \n@@ -160,6 +163,7 @@ def test_success(self):\n         self.assertTrue(form.is_valid())\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class PasswordChangeFormTest(TestCase):\n \n@@ -208,6 +212,7 @@ def test_field_order(self):\n                          ['old_password', 'new_password1', 'new_password2'])\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class UserChangeFormTest(TestCase):\n \n@@ -260,7 +265,25 @@ def test_bug_17944_unknown_password_algorithm(self):\n         self.assertIn(_(\"Invalid password format or unknown hashing algorithm.\"),\n             form.as_table())\n \n+    def test_bug_19133(self):\n+        \"The change form does not return the password value\"\n+        # Use the form to construct the POST data\n+        user = User.objects.get(username='testclient')\n+        form_for_data = UserChangeForm(instance=user)\n+        post_data = form_for_data.initial\n+\n+        # The password field should be readonly, so anything\n+        # posted here should be ignored; the form will be\n+        # valid, and give back the 'initial' value for the\n+        # password field.\n+        post_data['password'] = 'new password'\n+        form = UserChangeForm(instance=user, data=post_data)\n+\n+        self.assertTrue(form.is_valid())\n+        self.assertEqual(form.cleaned_data['password'], 'sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161')\n+\n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class PasswordResetFormTest(TestCase):\n \n@@ -338,4 +361,4 @@ def test_unusable_password(self):\n         form = PasswordResetForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"email\"].errors,\n-                         [_(\"The user account associated with this e-mail address cannot reset the password.\")])\n+                         [_(\"The user account associated with this email address cannot reset the password.\")])"
        },
        {
            "sha": "a867aae47adf1895ed49dfff324d5697fe62eeea",
            "filename": "django/contrib/auth/tests/handlers.py",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,50 @@\n+from __future__ import unicode_literals\n+\n+from django.contrib.auth.handlers.modwsgi import check_password, groups_for_user\n+from django.contrib.auth.models import User, Group\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.test import TransactionTestCase\n+\n+\n+class ModWsgiHandlerTestCase(TransactionTestCase):\n+    \"\"\"\n+    Tests for the mod_wsgi authentication handler\n+    \"\"\"\n+\n+    def setUp(self):\n+        user1 = User.objects.create_user('test', 'test@example.com', 'test')\n+        User.objects.create_user('test1', 'test1@example.com', 'test1')\n+        group = Group.objects.create(name='test_group')\n+        user1.groups.add(group)\n+\n+    def test_check_password(self):\n+        \"\"\"\n+        Verify that check_password returns the correct values as per\n+        http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Authentication_Provider\n+\n+        because the custom user available in the test framework does not\n+        support the is_active attribute, we can't test this with a custom\n+        user.\n+        \"\"\"\n+\n+        # User not in database\n+        self.assertTrue(check_password({}, 'unknown', '') is None)\n+\n+        # Valid user with correct password\n+        self.assertTrue(check_password({}, 'test', 'test'))\n+\n+        # Valid user with incorrect password\n+        self.assertFalse(check_password({}, 'test', 'incorrect'))\n+\n+    @skipIfCustomUser\n+    def test_groups_for_user(self):\n+        \"\"\"\n+        Check that groups_for_user returns correct values as per\n+        http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Group_Authorisation\n+        \"\"\"\n+\n+        # User not in database\n+        self.assertEqual(groups_for_user({}, 'unknown'), [])\n+\n+        self.assertEqual(groups_for_user({}, 'test'), [b'test_group'])\n+        self.assertEqual(groups_for_user({}, 'test1'), [])"
        },
        {
            "sha": "976c0c4972122739a4037884ba6b3e9eaf567784",
            "filename": "django/contrib/auth/tests/management.py",
            "status": "modified",
            "additions": 140,
            "deletions": 1,
            "changes": 141,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,13 +1,21 @@\n from __future__ import unicode_literals\n+from datetime import date\n \n from django.contrib.auth import models, management\n+from django.contrib.auth.management import create_permissions\n from django.contrib.auth.management.commands import changepassword\n+from django.contrib.auth.models import User\n+from django.contrib.auth.tests import CustomUser\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n+from django.core.management import call_command\n from django.core.management.base import CommandError\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils import six\n from django.utils.six import StringIO\n \n \n+@skipIfCustomUser\n class GetDefaultUsernameTestCase(TestCase):\n \n     def setUp(self):\n@@ -36,6 +44,7 @@ def test_i18n(self):\n         self.assertEqual(management.get_default_username(), 'julia')\n \n \n+@skipIfCustomUser\n class ChangepasswordManagementCommandTestCase(TestCase):\n \n     def setUp(self):\n@@ -48,7 +57,7 @@ def tearDown(self):\n         self.stderr.close()\n \n     def test_that_changepassword_command_changes_joes_password(self):\n-        \" Executing the changepassword management command should change joe's password \"\n+        \"Executing the changepassword management command should change joe's password\"\n         self.assertTrue(self.user.check_password('qwerty'))\n         command = changepassword.Command()\n         command._get_pass = lambda *args: 'not qwerty'\n@@ -69,3 +78,133 @@ def test_that_max_tries_exits_1(self):\n \n         with self.assertRaises(CommandError):\n             command.execute(\"joe\", stdout=self.stdout, stderr=self.stderr)\n+\n+\n+@skipIfCustomUser\n+class CreatesuperuserManagementCommandTestCase(TestCase):\n+\n+    def test_createsuperuser(self):\n+        \"Check the operation of the createsuperuser management command\"\n+        # We can use the management command to create a superuser\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe\",\n+            email=\"joe@somewhere.org\",\n+            stdout=new_io\n+        )\n+        command_output = new_io.getvalue().strip()\n+        self.assertEqual(command_output, 'Superuser created successfully.')\n+        u = User.objects.get(username=\"joe\")\n+        self.assertEqual(u.email, 'joe@somewhere.org')\n+\n+        # created password should be unusable\n+        self.assertFalse(u.has_usable_password())\n+\n+    def test_verbosity_zero(self):\n+        # We can supress output on the management command\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe2\",\n+            email=\"joe2@somewhere.org\",\n+            verbosity=0,\n+            stdout=new_io\n+        )\n+        command_output = new_io.getvalue().strip()\n+        self.assertEqual(command_output, '')\n+        u = User.objects.get(username=\"joe2\")\n+        self.assertEqual(u.email, 'joe2@somewhere.org')\n+        self.assertFalse(u.has_usable_password())\n+\n+    def test_email_in_username(self):\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            username=\"joe+admin@somewhere.org\",\n+            email=\"joe@somewhere.org\",\n+            stdout=new_io\n+        )\n+        u = User.objects.get(username=\"joe+admin@somewhere.org\")\n+        self.assertEqual(u.email, 'joe@somewhere.org')\n+        self.assertFalse(u.has_usable_password())\n+\n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_swappable_user(self):\n+        \"A superuser can be created when a custom User model is in use\"\n+        # We can use the management command to create a superuser\n+        # We skip validation because the temporary substitution of the\n+        # swappable User model messes with validation.\n+        new_io = StringIO()\n+        call_command(\"createsuperuser\",\n+            interactive=False,\n+            email=\"joe@somewhere.org\",\n+            date_of_birth=\"1976-04-01\",\n+            stdout=new_io,\n+            skip_validation=True\n+        )\n+        command_output = new_io.getvalue().strip()\n+        self.assertEqual(command_output, 'Superuser created successfully.')\n+        u = CustomUser.objects.get(email=\"joe@somewhere.org\")\n+        self.assertEqual(u.date_of_birth, date(1976, 4, 1))\n+\n+        # created password should be unusable\n+        self.assertFalse(u.has_usable_password())\n+\n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_swappable_user_missing_required_field(self):\n+        \"A Custom superuser won't be created when a required field isn't provided\"\n+        # We can use the management command to create a superuser\n+        # We skip validation because the temporary substitution of the\n+        # swappable User model messes with validation.\n+        new_io = StringIO()\n+        with self.assertRaises(CommandError):\n+            call_command(\"createsuperuser\",\n+                interactive=False,\n+                username=\"joe@somewhere.org\",\n+                stdout=new_io,\n+                stderr=new_io,\n+                skip_validation=True\n+            )\n+\n+        self.assertEqual(CustomUser.objects.count(), 0)\n+\n+\n+class PermissionDuplicationTestCase(TestCase):\n+\n+    def setUp(self):\n+        self._original_permissions = models.Permission._meta.permissions[:]\n+\n+    def tearDown(self):\n+        models.Permission._meta.permissions = self._original_permissions\n+\n+    def test_duplicated_permissions(self):\n+        \"\"\"\n+        Test that we show proper error message if we are trying to create\n+        duplicate permissions.\n+        \"\"\"\n+        # check duplicated default permission\n+        models.Permission._meta.permissions = [\n+           ('change_permission', 'Can edit permission (duplicate)')]\n+        self.assertRaisesRegexp(CommandError,\n+            \"The permission codename 'change_permission' clashes with a \"\n+            \"builtin permission for model 'auth.Permission'.\",\n+            create_permissions, models, [], verbosity=0)\n+\n+        # check duplicated custom permissions\n+        models.Permission._meta.permissions = [\n+            ('my_custom_permission', 'Some permission'),\n+            ('other_one', 'Some other permission'),\n+            ('my_custom_permission', 'Some permission with duplicate permission code'),\n+        ]\n+        self.assertRaisesRegexp(CommandError,\n+            \"The permission codename 'my_custom_permission' is duplicated for model \"\n+            \"'auth.Permission'.\",\n+            create_permissions, models, [], verbosity=0)\n+\n+        # should not raise anything\n+        models.Permission._meta.permissions = [\n+            ('my_custom_permission', 'Some permission'),\n+            ('other_one', 'Some other permission'),\n+        ]\n+        create_permissions(models, [], verbosity=0)"
        },
        {
            "sha": "252a0887c884f989cfd24a644305c5882edea511",
            "filename": "django/contrib/auth/tests/models.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,11 +1,13 @@\n from django.conf import settings\n from django.contrib.auth.models import (Group, User, SiteProfileNotAvailable,\n     UserManager)\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils import six\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, AUTH_PROFILE_MODULE='')\n class ProfileTestCase(TestCase):\n \n@@ -31,6 +33,7 @@ def test_site_profile_not_available(self):\n             user.get_profile()\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False)\n class NaturalKeysTestCase(TestCase):\n     fixtures = ['authtestdata.json']\n@@ -45,6 +48,7 @@ def test_group_natural_key(self):\n         self.assertEqual(Group.objects.get_by_natural_key('users'), users_group)\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False)\n class LoadDataWithoutNaturalKeysTestCase(TestCase):\n     fixtures = ['regular.json']\n@@ -55,6 +59,7 @@ def test_user_is_created_and_added_to_group(self):\n         self.assertEqual(group, user.groups.get())\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False)\n class LoadDataWithNaturalKeysTestCase(TestCase):\n     fixtures = ['natural.json']\n@@ -65,6 +70,7 @@ def test_user_is_created_and_added_to_group(self):\n         self.assertEqual(group, user.groups.get())\n \n \n+@skipIfCustomUser\n class UserManagerTestCase(TestCase):\n \n     def test_create_user(self):"
        },
        {
            "sha": "9b0f6f8be3b12489bc4dee5cfac65eb5d1947465",
            "filename": "django/contrib/auth/tests/remote_user.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fremote_user.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,10 +3,12 @@\n from django.conf import settings\n from django.contrib.auth.backends import RemoteUserBackend\n from django.contrib.auth.models import User\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.utils import timezone\n \n \n+@skipIfCustomUser\n class RemoteUserTest(TestCase):\n \n     urls = 'django.contrib.auth.tests.urls'\n@@ -106,6 +108,7 @@ class RemoteUserNoCreateBackend(RemoteUserBackend):\n     create_unknown_user = False\n \n \n+@skipIfCustomUser\n class RemoteUserNoCreateTest(RemoteUserTest):\n     \"\"\"\n     Contains the same tests as RemoteUserTest, but using a custom auth backend\n@@ -142,6 +145,7 @@ def configure_user(self, user):\n         return user\n \n \n+@skipIfCustomUser\n class RemoteUserCustomTest(RemoteUserTest):\n     \"\"\"\n     Tests a custom RemoteUserBackend subclass that overrides the clean_username"
        },
        {
            "sha": "024f44f547d5ea478cb2ff70434dc27af8998733",
            "filename": "django/contrib/auth/tests/signals.py",
            "status": "modified",
            "additions": 33,
            "deletions": 2,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,8 +1,12 @@\n+from django.contrib.auth import signals\n+from django.contrib.auth.models import User\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n+from django.test.client import RequestFactory\n from django.test.utils import override_settings\n-from django.contrib.auth import signals\n \n \n+@skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class SignalTestCase(TestCase):\n     urls = 'django.contrib.auth.tests.urls'\n@@ -14,27 +18,41 @@ def listener_login(self, user, **kwargs):\n     def listener_logout(self, user, **kwargs):\n         self.logged_out.append(user)\n \n+    def listener_login_failed(self, sender, credentials, **kwargs):\n+        self.login_failed.append(credentials)\n+\n     def setUp(self):\n         \"\"\"Set up the listeners and reset the logged in/logged out counters\"\"\"\n         self.logged_in = []\n         self.logged_out = []\n+        self.login_failed = []\n         signals.user_logged_in.connect(self.listener_login)\n         signals.user_logged_out.connect(self.listener_logout)\n+        signals.user_login_failed.connect(self.listener_login_failed)\n \n     def tearDown(self):\n         \"\"\"Disconnect the listeners\"\"\"\n         signals.user_logged_in.disconnect(self.listener_login)\n         signals.user_logged_out.disconnect(self.listener_logout)\n+        signals.user_login_failed.disconnect(self.listener_login_failed)\n \n     def test_login(self):\n-        # Only a successful login will trigger the signal.\n+        # Only a successful login will trigger the success signal.\n         self.client.login(username='testclient', password='bad')\n         self.assertEqual(len(self.logged_in), 0)\n+        self.assertEqual(len(self.login_failed), 1)\n+        self.assertEqual(self.login_failed[0]['username'], 'testclient')\n+        # verify the password is cleansed\n+        self.assertTrue('***' in self.login_failed[0]['password'])\n+\n         # Like this:\n         self.client.login(username='testclient', password='password')\n         self.assertEqual(len(self.logged_in), 1)\n         self.assertEqual(self.logged_in[0].username, 'testclient')\n \n+        # Ensure there were no more failures.\n+        self.assertEqual(len(self.login_failed), 1)\n+\n     def test_logout_anonymous(self):\n         # The log_out function will still trigger the signal for anonymous\n         # users.\n@@ -47,3 +65,16 @@ def test_logout(self):\n         self.client.get('/logout/next_page/')\n         self.assertEqual(len(self.logged_out), 1)\n         self.assertEqual(self.logged_out[0].username, 'testclient')\n+\n+    def test_update_last_login(self):\n+        \"\"\"Ensure that only `last_login` is updated in `update_last_login`\"\"\"\n+        user = User.objects.get(pk=3)\n+        old_last_login = user.last_login\n+\n+        user.username = \"This username shouldn't get saved\"\n+        request = RequestFactory().get('/login')\n+        signals.user_logged_in.send(sender=user.__class__, request=request,\n+            user=user)\n+        user = User.objects.get(pk=3)\n+        self.assertEqual(user.username, 'staff')\n+        self.assertNotEqual(user.last_login, old_last_login)"
        },
        {
            "sha": "3a18cd7405f329bad7edbe680698c3d87da04075",
            "filename": "django/contrib/auth/tests/templates/context_processors/auth_attrs_perm_in_perms.html",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_perm_in_perms.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_perm_in_perms.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_perm_in_perms.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,4 @@\n+{% if 'auth' in perms %}Has auth permissions{% endif %}\n+{% if 'auth.add_permission' in perms %}Has auth.add_permission permissions{% endif %}\n+{% if 'nonexisting' in perms %}nonexisting perm found{% endif %}\n+{% if 'auth.nonexisting' in perms %}auth.nonexisting perm found{% endif %}"
        },
        {
            "sha": "6f441afc10b855d2ecec252abf7a485679e2c9ce",
            "filename": "django/contrib/auth/tests/templates/context_processors/auth_attrs_perms.html",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_perms.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_perms.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_perms.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1 +1,4 @@\n {% if perms.auth %}Has auth permissions{% endif %}\n+{% if perms.auth.add_permission %}Has auth.add_permission permissions{% endif %}\n+{% if perms.nonexisting %}nonexisting perm found{% endif %}\n+{% if perms.auth.nonexisting in perms %}auth.nonexisting perm found{% endif %}"
        },
        {
            "sha": "c3d1d0c7b0685da3dcdf6c2fd4fe627f058be7fe",
            "filename": "django/contrib/auth/tests/templates/registration/password_reset_done.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fregistration%2Fpassword_reset_done.html",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fregistration%2Fpassword_reset_done.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fregistration%2Fpassword_reset_done.html?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1 +1 @@\n-E-mail sent\n\\ No newline at end of file\n+Email sent\n\\ No newline at end of file"
        },
        {
            "sha": "e8aeb463263008ff8b2f954f107d4e30984cb8ce",
            "filename": "django/contrib/auth/tests/tokens.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftokens.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,10 +4,12 @@\n from django.conf import settings\n from django.contrib.auth.models import User\n from django.contrib.auth.tokens import PasswordResetTokenGenerator\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TestCase\n from django.utils import unittest\n \n \n+@skipIfCustomUser\n class TokenGeneratorTest(TestCase):\n \n     def test_make_token(self):"
        },
        {
            "sha": "4b498ceaf0a778845607e301c0ace5753568fe3f",
            "filename": "django/contrib/auth/tests/urls.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Furls.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -37,6 +37,10 @@ def auth_processor_perms(request):\n     return render_to_response('context_processors/auth_attrs_perms.html',\n         RequestContext(request, {}, processors=[context_processors.auth]))\n \n+def auth_processor_perm_in_perms(request):\n+    return render_to_response('context_processors/auth_attrs_perm_in_perms.html',\n+        RequestContext(request, {}, processors=[context_processors.auth]))\n+\n def auth_processor_messages(request):\n     info(request, \"Message 1\")\n     return render_to_response('context_processors/auth_attrs_messages.html',\n@@ -51,13 +55,15 @@ def userpage(request):\n     (r'^logout/next_page/$', 'django.contrib.auth.views.logout', dict(next_page='/somewhere/')),\n     (r'^remote_user/$', remote_user_auth_view),\n     (r'^password_reset_from_email/$', 'django.contrib.auth.views.password_reset', dict(from_email='staffmember@example.com')),\n+    (r'^admin_password_reset/$', 'django.contrib.auth.views.password_reset', dict(is_admin_site=True)),\n     (r'^login_required/$', login_required(password_reset)),\n     (r'^login_required_login_url/$', login_required(password_reset, login_url='/somewhere/')),\n \n     (r'^auth_processor_no_attr_access/$', auth_processor_no_attr_access),\n     (r'^auth_processor_attr_access/$', auth_processor_attr_access),\n     (r'^auth_processor_user/$', auth_processor_user),\n     (r'^auth_processor_perms/$', auth_processor_perms),\n+    (r'^auth_processor_perm_in_perms/$', auth_processor_perm_in_perms),\n     (r'^auth_processor_messages/$', auth_processor_messages),\n     url(r'^userpage/(.+)/$', userpage, name=\"userpage\"),\n )"
        },
        {
            "sha": "6bb3d9994f06886b0bc838a58e392dea3a8b5644",
            "filename": "django/contrib/auth/tests/utils.py",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Futils.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,9 @@\n+from django.conf import settings\n+from django.utils.unittest import skipIf\n+\n+\n+def skipIfCustomUser(test_func):\n+    \"\"\"\n+    Skip a test if a custom user model is in use.\n+    \"\"\"\n+    return skipIf(settings.AUTH_USER_MODEL != 'auth.User', 'Custom user model in use')(test_func)"
        },
        {
            "sha": "bb17576d3146e56f898190986cf07d05bab14abd",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 67,
            "deletions": 0,
            "changes": 67,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -5,6 +5,7 @@\n from django.contrib.sites.models import Site, RequestSite\n from django.contrib.auth.models import User\n from django.core import mail\n+from django.core.exceptions import SuspiciousOperation\n from django.core.urlresolvers import reverse, NoReverseMatch\n from django.http import QueryDict\n from django.utils.encoding import force_text\n@@ -16,6 +17,7 @@\n from django.contrib.auth import SESSION_KEY, REDIRECT_FIELD_NAME\n from django.contrib.auth.forms import (AuthenticationForm, PasswordChangeForm,\n                 SetPasswordForm, PasswordResetForm)\n+from django.contrib.auth.tests.utils import skipIfCustomUser\n \n \n @override_settings(\n@@ -50,6 +52,7 @@ def assertContainsEscaped(self, response, text, **kwargs):\n         return self.assertContains(response, escape(force_text(text)), **kwargs)\n \n \n+@skipIfCustomUser\n class AuthViewNamedURLTests(AuthViewsTestCase):\n     urls = 'django.contrib.auth.urls'\n \n@@ -75,6 +78,7 @@ def test_named_urls(self):\n                 self.fail(\"Reversal of url named '%s' failed with NoReverseMatch\" % name)\n \n \n+@skipIfCustomUser\n class PasswordResetTest(AuthViewsTestCase):\n \n     def test_email_not_found(self):\n@@ -100,6 +104,42 @@ def test_email_found_custom_from(self):\n         self.assertEqual(len(mail.outbox), 1)\n         self.assertEqual(\"staffmember@example.com\", mail.outbox[0].from_email)\n \n+    def test_admin_reset(self):\n+        \"If the reset view is marked as being for admin, the HTTP_HOST header is used for a domain override.\"\n+        response = self.client.post('/admin_password_reset/',\n+            {'email': 'staffmember@example.com'},\n+            HTTP_HOST='adminsite.com'\n+        )\n+        self.assertEqual(response.status_code, 302)\n+        self.assertEqual(len(mail.outbox), 1)\n+        self.assertTrue(\"http://adminsite.com\" in mail.outbox[0].body)\n+        self.assertEqual(settings.DEFAULT_FROM_EMAIL, mail.outbox[0].from_email)\n+\n+    def test_poisoned_http_host(self):\n+        \"Poisoned HTTP_HOST headers can't be used for reset emails\"\n+        # This attack is based on the way browsers handle URLs. The colon\n+        # should be used to separate the port, but if the URL contains an @,\n+        # the colon is interpreted as part of a username for login purposes,\n+        # making 'evil.com' the request domain. Since HTTP_HOST is used to\n+        # produce a meaningful reset URL, we need to be certain that the\n+        # HTTP_HOST header isn't poisoned. This is done as a check when get_host()\n+        # is invoked, but we check here as a practical consequence.\n+        with self.assertRaises(SuspiciousOperation):\n+            self.client.post('/password_reset/',\n+                {'email': 'staffmember@example.com'},\n+                HTTP_HOST='www.example:dr.frankenstein@evil.tld'\n+            )\n+        self.assertEqual(len(mail.outbox), 0)\n+\n+    def test_poisoned_http_host_admin_site(self):\n+        \"Poisoned HTTP_HOST headers can't be used for reset emails on admin views\"\n+        with self.assertRaises(SuspiciousOperation):\n+            self.client.post('/admin_password_reset/',\n+                {'email': 'staffmember@example.com'},\n+                HTTP_HOST='www.example:dr.frankenstein@evil.tld'\n+            )\n+        self.assertEqual(len(mail.outbox), 0)\n+\n     def _test_confirm_start(self):\n         # Start by creating the email\n         response = self.client.post('/password_reset/', {'email': 'staffmember@example.com'})\n@@ -172,6 +212,30 @@ def test_confirm_different_passwords(self):\n         self.assertContainsEscaped(response, SetPasswordForm.error_messages['password_mismatch'])\n \n \n+@override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+class CustomUserPasswordResetTest(AuthViewsTestCase):\n+    fixtures = ['custom_user.json']\n+\n+    def _test_confirm_start(self):\n+        # Start by creating the email\n+        response = self.client.post('/password_reset/', {'email': 'staffmember@example.com'})\n+        self.assertEqual(response.status_code, 302)\n+        self.assertEqual(len(mail.outbox), 1)\n+        return self._read_signup_email(mail.outbox[0])\n+\n+    def _read_signup_email(self, email):\n+        urlmatch = re.search(r\"https?://[^/]*(/.*reset/\\S*)\", email.body)\n+        self.assertTrue(urlmatch is not None, \"No URL found in sent email\")\n+        return urlmatch.group(), urlmatch.groups()[0]\n+\n+    def test_confirm_valid_custom_user(self):\n+        url, path = self._test_confirm_start()\n+        response = self.client.get(path)\n+        # redirect to a 'complete' page:\n+        self.assertContains(response, \"Please enter your new password\")\n+\n+\n+@skipIfCustomUser\n class ChangePasswordTest(AuthViewsTestCase):\n \n     def fail_login(self, password='password'):\n@@ -231,6 +295,7 @@ def test_password_change_done_fails(self):\n             self.assertTrue(response['Location'].endswith('/login/?next=/password_change/done/'))\n \n \n+@skipIfCustomUser\n class LoginTest(AuthViewsTestCase):\n \n     def test_current_site_in_context_after_login(self):\n@@ -289,6 +354,7 @@ def test_security_check(self, password='password'):\n                             \"%s should be allowed\" % good_url)\n \n \n+@skipIfCustomUser\n class LoginURLSettings(AuthViewsTestCase):\n \n     def setUp(self):\n@@ -347,6 +413,7 @@ def test_remote_login_url_with_next_querystring(self):\n                                                     querystring.urlencode('/')))\n \n \n+@skipIfCustomUser\n class LogoutTest(AuthViewsTestCase):\n \n     def confirm_logged_out(self):"
        },
        {
            "sha": "930c70012b60d518c5648984cc74780165784591",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,6 +4,7 @@\n from django.utils.crypto import constant_time_compare, salted_hmac\n from django.utils import six\n \n+\n class PasswordResetTokenGenerator(object):\n     \"\"\"\n     Strategy object used to generate and check tokens for the password"
        },
        {
            "sha": "d27e2f5aba51e46e3567b7f71f101163e417db8d",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 15,
            "deletions": 6,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -15,10 +15,9 @@\n from django.views.decorators.csrf import csrf_protect\n \n # Avoid shadowing the login() and logout() views below.\n-from django.contrib.auth import REDIRECT_FIELD_NAME, login as auth_login, logout as auth_logout\n+from django.contrib.auth import REDIRECT_FIELD_NAME, login as auth_login, logout as auth_logout, get_user_model\n from django.contrib.auth.decorators import login_required\n from django.contrib.auth.forms import AuthenticationForm, PasswordResetForm, SetPasswordForm, PasswordChangeForm\n-from django.contrib.auth.models import User\n from django.contrib.auth.tokens import default_token_generator\n from django.contrib.sites.models import get_current_site\n \n@@ -74,6 +73,7 @@ def login(request, template_name='registration/login.html',\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n def logout(request, next_page=None,\n            template_name='registration/logged_out.html',\n            redirect_field_name=REDIRECT_FIELD_NAME,\n@@ -104,6 +104,7 @@ def logout(request, next_page=None,\n         # Redirect to this page until the session has been cleared.\n         return HttpResponseRedirect(next_page or request.path)\n \n+\n def logout_then_login(request, login_url=None, current_app=None, extra_context=None):\n     \"\"\"\n     Logs out the user if he is logged in. Then redirects to the log-in page.\n@@ -113,6 +114,7 @@ def logout_then_login(request, login_url=None, current_app=None, extra_context=N\n     login_url = resolve_url(login_url)\n     return logout(request, login_url, current_app=current_app, extra_context=extra_context)\n \n+\n def redirect_to_login(next, login_url=None,\n                       redirect_field_name=REDIRECT_FIELD_NAME):\n     \"\"\"\n@@ -128,6 +130,7 @@ def redirect_to_login(next, login_url=None,\n \n     return HttpResponseRedirect(urlunparse(login_url_parts))\n \n+\n # 4 views for password reset:\n # - password_reset sends the mail\n # - password_reset_done shows a success message for the above\n@@ -160,7 +163,7 @@ def password_reset(request, is_admin_site=False,\n                 'request': request,\n             }\n             if is_admin_site:\n-                opts = dict(opts, domain_override=request.META['HTTP_HOST'])\n+                opts = dict(opts, domain_override=request.get_host())\n             form.save(**opts)\n             return HttpResponseRedirect(post_reset_redirect)\n     else:\n@@ -173,6 +176,7 @@ def password_reset(request, is_admin_site=False,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n def password_reset_done(request,\n                         template_name='registration/password_reset_done.html',\n                         current_app=None, extra_context=None):\n@@ -182,6 +186,7 @@ def password_reset_done(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n # Doesn't need csrf_protect since no-one can guess the URL\n @sensitive_post_parameters()\n @never_cache\n@@ -195,13 +200,14 @@ def password_reset_confirm(request, uidb36=None, token=None,\n     View that checks the hash in a password reset link and presents a\n     form for entering a new password.\n     \"\"\"\n-    assert uidb36 is not None and token is not None # checked by URLconf\n+    UserModel = get_user_model()\n+    assert uidb36 is not None and token is not None  # checked by URLconf\n     if post_reset_redirect is None:\n         post_reset_redirect = reverse('django.contrib.auth.views.password_reset_complete')\n     try:\n         uid_int = base36_to_int(uidb36)\n-        user = User.objects.get(id=uid_int)\n-    except (ValueError, OverflowError, User.DoesNotExist):\n+        user = UserModel.objects.get(id=uid_int)\n+    except (ValueError, OverflowError, UserModel.DoesNotExist):\n         user = None\n \n     if user is not None and token_generator.check_token(user, token):\n@@ -225,6 +231,7 @@ def password_reset_confirm(request, uidb36=None, token=None,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n def password_reset_complete(request,\n                             template_name='registration/password_reset_complete.html',\n                             current_app=None, extra_context=None):\n@@ -236,6 +243,7 @@ def password_reset_complete(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n @sensitive_post_parameters()\n @csrf_protect\n @login_required\n@@ -261,6 +269,7 @@ def password_change(request,\n     return TemplateResponse(request, template_name, context,\n                             current_app=current_app)\n \n+\n @login_required\n def password_change_done(request,\n                          template_name='registration/password_change_done.html',"
        },
        {
            "sha": "a651baaadf2b3e3bf92c08094478a6ea99ca2cc4",
            "filename": "django/contrib/comments/admin.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fadmin.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,11 +1,22 @@\n from __future__ import unicode_literals\n \n from django.contrib import admin\n+from django.contrib.auth import get_user_model\n from django.contrib.comments.models import Comment\n from django.utils.translation import ugettext_lazy as _, ungettext\n from django.contrib.comments import get_model\n from django.contrib.comments.views.moderation import perform_flag, perform_approve, perform_delete\n \n+\n+class UsernameSearch(object):\n+    \"\"\"The User object may not be auth.User, so we need to provide\n+    a mechanism for issuing the equivalent of a .filter(user__username=...)\n+    search in CommentAdmin.\n+    \"\"\"\n+    def __str__(self):\n+        return 'user__%s' % get_user_model().USERNAME_FIELD\n+\n+\n class CommentsAdmin(admin.ModelAdmin):\n     fieldsets = (\n         (None,\n@@ -24,7 +35,7 @@ class CommentsAdmin(admin.ModelAdmin):\n     date_hierarchy = 'submit_date'\n     ordering = ('-submit_date',)\n     raw_id_fields = ('user',)\n-    search_fields = ('comment', 'user__username', 'user_name', 'user_email', 'user_url', 'ip_address')\n+    search_fields = ('comment', UsernameSearch(), 'user_name', 'user_email', 'user_url', 'ip_address')\n     actions = [\"flag_comments\", \"approve_comments\", \"remove_comments\"]\n \n     def get_actions(self, request):"
        },
        {
            "sha": "2e0d4c3dc56d6af1db0030c18dae3ebec5576a79",
            "filename": "django/contrib/comments/feeds.py",
            "status": "modified",
            "additions": 9,
            "deletions": 12,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Ffeeds.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Ffeeds.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Ffeeds.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,30 +1,27 @@\n-from django.conf import settings\n from django.contrib.syndication.views import Feed\n-from django.contrib.sites.models import Site\n+from django.contrib.sites.models import get_current_site\n from django.contrib import comments\n from django.utils.translation import ugettext as _\n \n class LatestCommentFeed(Feed):\n     \"\"\"Feed of latest comments on the current site.\"\"\"\n \n+    def __call__(self, request, *args, **kwargs):\n+        self.site = get_current_site(request)\n+        return super(LatestCommentFeed, self).__call__(request, *args, **kwargs)\n+\n     def title(self):\n-        if not hasattr(self, '_site'):\n-            self._site = Site.objects.get_current()\n-        return _(\"%(site_name)s comments\") % dict(site_name=self._site.name)\n+        return _(\"%(site_name)s comments\") % dict(site_name=self.site.name)\n \n     def link(self):\n-        if not hasattr(self, '_site'):\n-            self._site = Site.objects.get_current()\n-        return \"http://%s/\" % (self._site.domain)\n+        return \"http://%s/\" % (self.site.domain)\n \n     def description(self):\n-        if not hasattr(self, '_site'):\n-            self._site = Site.objects.get_current()\n-        return _(\"Latest comments on %(site_name)s\") % dict(site_name=self._site.name)\n+        return _(\"Latest comments on %(site_name)s\") % dict(site_name=self.site.name)\n \n     def items(self):\n         qs = comments.get_model().objects.filter(\n-            site__pk = settings.SITE_ID,\n+            site__pk = self.site.pk,\n             is_public = True,\n             is_removed = False,\n         )"
        },
        {
            "sha": "b41b89011a32142883d5817d23dff90d25c3e501",
            "filename": "django/contrib/comments/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 33,
            "deletions": 33,
            "changes": 66,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:37+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,57 +13,57 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: admin.py:12\n+#: admin.py:25\n msgid \"Content\"\n msgstr \"\"\n \n-#: admin.py:15\n+#: admin.py:28\n msgid \"Metadata\"\n msgstr \"\"\n \n-#: admin.py:42\n+#: admin.py:55\n msgid \"flagged\"\n msgid_plural \"flagged\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: admin.py:43\n+#: admin.py:56\n msgid \"Flag selected comments\"\n msgstr \"\"\n \n-#: admin.py:47\n+#: admin.py:60\n msgid \"approved\"\n msgid_plural \"approved\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: admin.py:48\n+#: admin.py:61\n msgid \"Approve selected comments\"\n msgstr \"\"\n \n-#: admin.py:52\n+#: admin.py:65\n msgid \"removed\"\n msgid_plural \"removed\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: admin.py:53\n+#: admin.py:66\n msgid \"Remove selected comments\"\n msgstr \"\"\n \n-#: admin.py:65\n+#: admin.py:78\n #, python-format\n msgid \"1 comment was successfully %(action)s.\"\n msgid_plural \"%(count)s comments were successfully %(action)s.\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: feeds.py:13\n+#: feeds.py:14\n #, python-format\n msgid \"%(site_name)s comments\"\n msgstr \"\"\n \n-#: feeds.py:23\n+#: feeds.py:20\n #, python-format\n msgid \"Latest comments on %(site_name)s\"\n msgstr \"\"\n@@ -100,78 +100,78 @@ msgid \"\"\n \"If you enter anything in this field your comment will be treated as spam\"\n msgstr \"\"\n \n-#: models.py:22\n+#: models.py:23\n msgid \"content type\"\n msgstr \"\"\n \n-#: models.py:24\n+#: models.py:25\n msgid \"object ID\"\n msgstr \"\"\n \n-#: models.py:50 models.py:168\n+#: models.py:53 models.py:177\n msgid \"user\"\n msgstr \"\"\n \n-#: models.py:52\n+#: models.py:55\n msgid \"user's name\"\n msgstr \"\"\n \n-#: models.py:53\n+#: models.py:56\n msgid \"user's email address\"\n msgstr \"\"\n \n-#: models.py:54\n+#: models.py:57\n msgid \"user's URL\"\n msgstr \"\"\n \n-#: models.py:56 models.py:76 models.py:169\n+#: models.py:59 models.py:79 models.py:178\n msgid \"comment\"\n msgstr \"\"\n \n-#: models.py:59\n+#: models.py:62\n msgid \"date/time submitted\"\n msgstr \"\"\n \n-#: models.py:60\n+#: models.py:63\n msgid \"IP address\"\n msgstr \"\"\n \n-#: models.py:61\n+#: models.py:64\n msgid \"is public\"\n msgstr \"\"\n \n-#: models.py:62\n+#: models.py:65\n msgid \"\"\n \"Uncheck this box to make the comment effectively disappear from the site.\"\n msgstr \"\"\n \n-#: models.py:64\n+#: models.py:67\n msgid \"is removed\"\n msgstr \"\"\n \n-#: models.py:65\n+#: models.py:68\n msgid \"\"\n \"Check this box if the comment is inappropriate. A \\\"This comment has been \"\n \"removed\\\" message will be displayed instead.\"\n msgstr \"\"\n \n-#: models.py:77\n+#: models.py:80\n msgid \"comments\"\n msgstr \"\"\n \n-#: models.py:119\n+#: models.py:124\n msgid \"\"\n \"This comment was posted by an authenticated user and thus the name is read-\"\n \"only.\"\n msgstr \"\"\n \n-#: models.py:128\n+#: models.py:134\n msgid \"\"\n \"This comment was posted by an authenticated user and thus the email is read-\"\n \"only.\"\n msgstr \"\"\n \n-#: models.py:153\n+#: models.py:160\n #, python-format\n msgid \"\"\n \"Posted by %(user)s at %(date)s\\n\"\n@@ -181,19 +181,19 @@ msgid \"\"\n \"http://%(domain)s%(url)s\"\n msgstr \"\"\n \n-#: models.py:170\n+#: models.py:179\n msgid \"flag\"\n msgstr \"\"\n \n-#: models.py:171\n+#: models.py:180\n msgid \"date\"\n msgstr \"\"\n \n-#: models.py:181\n+#: models.py:190\n msgid \"comment flag\"\n msgstr \"\"\n \n-#: models.py:182\n+#: models.py:191\n msgid \"comment flags\"\n msgstr \"\"\n "
        },
        {
            "sha": "c263ea7d10cd36427233ccafe70e5e6da2fc752c",
            "filename": "django/contrib/comments/models.py",
            "status": "modified",
            "additions": 27,
            "deletions": 22,
            "changes": 49,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmodels.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,16 +1,16 @@\n-from django.contrib.auth.models import User\n+from django.conf import settings\n from django.contrib.comments.managers import CommentManager\n from django.contrib.contenttypes import generic\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.sites.models import Site\n-from django.db import models\n from django.core import urlresolvers\n+from django.db import models\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n-from django.conf import settings\n from django.utils.encoding import python_2_unicode_compatible\n \n-COMMENT_MAX_LENGTH = getattr(settings,'COMMENT_MAX_LENGTH',3000)\n+COMMENT_MAX_LENGTH = getattr(settings, 'COMMENT_MAX_LENGTH', 3000)\n+\n \n class BaseCommentAbstractModel(models.Model):\n     \"\"\"\n@@ -19,14 +19,14 @@ class BaseCommentAbstractModel(models.Model):\n     \"\"\"\n \n     # Content-object field\n-    content_type   = models.ForeignKey(ContentType,\n+    content_type = models.ForeignKey(ContentType,\n             verbose_name=_('content type'),\n             related_name=\"content_type_set_for_%(class)s\")\n-    object_pk      = models.TextField(_('object ID'))\n+    object_pk = models.TextField(_('object ID'))\n     content_object = generic.GenericForeignKey(ct_field=\"content_type\", fk_field=\"object_pk\")\n \n     # Metadata about the comment\n-    site        = models.ForeignKey(Site)\n+    site = models.ForeignKey(Site)\n \n     class Meta:\n         abstract = True\n@@ -40,6 +40,7 @@ def get_content_object_url(self):\n             args=(self.content_type_id, self.object_pk)\n         )\n \n+\n @python_2_unicode_compatible\n class Comment(BaseCommentAbstractModel):\n     \"\"\"\n@@ -49,21 +50,21 @@ class Comment(BaseCommentAbstractModel):\n     # Who posted this comment? If ``user`` is set then it was an authenticated\n     # user; otherwise at least user_name should have been set and the comment\n     # was posted by a non-authenticated user.\n-    user        = models.ForeignKey(User, verbose_name=_('user'),\n+    user = models.ForeignKey(settings.AUTH_USER_MODEL, verbose_name=_('user'),\n                     blank=True, null=True, related_name=\"%(class)s_comments\")\n-    user_name   = models.CharField(_(\"user's name\"), max_length=50, blank=True)\n-    user_email  = models.EmailField(_(\"user's email address\"), blank=True)\n-    user_url    = models.URLField(_(\"user's URL\"), blank=True)\n+    user_name = models.CharField(_(\"user's name\"), max_length=50, blank=True)\n+    user_email = models.EmailField(_(\"user's email address\"), blank=True)\n+    user_url = models.URLField(_(\"user's URL\"), blank=True)\n \n     comment = models.TextField(_('comment'), max_length=COMMENT_MAX_LENGTH)\n \n     # Metadata about the comment\n     submit_date = models.DateTimeField(_('date/time submitted'), default=None)\n-    ip_address  = models.IPAddressField(_('IP address'), blank=True, null=True)\n-    is_public   = models.BooleanField(_('is public'), default=True,\n+    ip_address = models.IPAddressField(_('IP address'), blank=True, null=True)\n+    is_public = models.BooleanField(_('is public'), default=True,\n                     help_text=_('Uncheck this box to make the comment effectively ' \\\n                                 'disappear from the site.'))\n-    is_removed  = models.BooleanField(_('is removed'), default=False,\n+    is_removed = models.BooleanField(_('is removed'), default=False,\n                     help_text=_('Check this box if the comment is inappropriate. ' \\\n                                 'A \"This comment has been removed\" message will ' \\\n                                 'be displayed instead.'))\n@@ -95,9 +96,9 @@ def _get_userinfo(self):\n         \"\"\"\n         if not hasattr(self, \"_userinfo\"):\n             userinfo = {\n-                \"name\"  : self.user_name,\n-                \"email\" : self.user_email,\n-                \"url\"   : self.user_url\n+                \"name\": self.user_name,\n+                \"email\": self.user_email,\n+                \"url\": self.user_url\n             }\n             if self.user_id:\n                 u = self.user\n@@ -110,13 +111,14 @@ def _get_userinfo(self):\n                 if u.get_full_name():\n                     userinfo[\"name\"] = self.user.get_full_name()\n                 elif not self.user_name:\n-                    userinfo[\"name\"] = u.username\n+                    userinfo[\"name\"] = u.get_username()\n             self._userinfo = userinfo\n         return self._userinfo\n     userinfo = property(_get_userinfo, doc=_get_userinfo.__doc__)\n \n     def _get_name(self):\n         return self.userinfo[\"name\"]\n+\n     def _set_name(self, val):\n         if self.user_id:\n             raise AttributeError(_(\"This comment was posted by an authenticated \"\\\n@@ -126,6 +128,7 @@ def _set_name(self, val):\n \n     def _get_email(self):\n         return self.userinfo[\"email\"]\n+\n     def _set_email(self, val):\n         if self.user_id:\n             raise AttributeError(_(\"This comment was posted by an authenticated \"\\\n@@ -135,6 +138,7 @@ def _set_email(self, val):\n \n     def _get_url(self):\n         return self.userinfo[\"url\"]\n+\n     def _set_url(self, val):\n         self.user_url = val\n     url = property(_get_url, _set_url, doc=\"The URL given by the user who posted this comment\")\n@@ -155,6 +159,7 @@ def get_as_text(self):\n         }\n         return _('Posted by %(user)s at %(date)s\\n\\n%(comment)s\\n\\nhttp://%(domain)s%(url)s') % d\n \n+\n @python_2_unicode_compatible\n class CommentFlag(models.Model):\n     \"\"\"\n@@ -169,9 +174,9 @@ class CommentFlag(models.Model):\n     design users are only allowed to flag a comment with a given flag once;\n     if you want rating look elsewhere.\n     \"\"\"\n-    user      = models.ForeignKey(User, verbose_name=_('user'), related_name=\"comment_flags\")\n-    comment   = models.ForeignKey(Comment, verbose_name=_('comment'), related_name=\"flags\")\n-    flag      = models.CharField(_('flag'), max_length=30, db_index=True)\n+    user = models.ForeignKey(settings.AUTH_USER_MODEL, verbose_name=_('user'), related_name=\"comment_flags\")\n+    comment = models.ForeignKey(Comment, verbose_name=_('comment'), related_name=\"flags\")\n+    flag = models.CharField(_('flag'), max_length=30, db_index=True)\n     flag_date = models.DateTimeField(_('date'), default=None)\n \n     # Constants for flag types\n@@ -187,7 +192,7 @@ class Meta:\n \n     def __str__(self):\n         return \"%s flag of comment ID %s by %s\" % \\\n-            (self.flag, self.comment_id, self.user.username)\n+            (self.flag, self.comment_id, self.user.get_username())\n \n     def save(self, *args, **kwargs):\n         if self.flag_date is None:"
        },
        {
            "sha": "6c56d7a8a54e07be64c73d6adf02ced6724917a9",
            "filename": "django/contrib/comments/moderation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fmoderation.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fmoderation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmoderation.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -62,7 +62,7 @@ class EntryModerator(CommentModerator):\n from django.db.models.base import ModelBase\n from django.template import Context, loader\n from django.contrib import comments\n-from django.contrib.sites.models import Site\n+from django.contrib.sites.models import get_current_site\n from django.utils import timezone\n \n class AlreadyModerated(Exception):\n@@ -240,7 +240,7 @@ def email(self, comment, content_object, request):\n         t = loader.get_template('comments/comment_notification_email.txt')\n         c = Context({ 'comment': comment,\n                       'content_object': content_object })\n-        subject = '[%s] New comment posted on \"%s\"' % (Site.objects.get_current().name,\n+        subject = '[%s] New comment posted on \"%s\"' % (get_current_site(request).name,\n                                                           content_object)\n         message = t.render(c)\n         send_mail(subject, message, settings.DEFAULT_FROM_EMAIL, recipient_list, fail_silently=True)"
        },
        {
            "sha": "27d5a48ac6016df353a247f3429a56118f3af4a6",
            "filename": "django/contrib/comments/views/comments.py",
            "status": "modified",
            "additions": 12,
            "deletions": 13,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Fcomments.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -15,7 +15,6 @@\n from django.views.decorators.http import require_POST\n \n \n-\n class CommentPostBadRequest(http.HttpResponseBadRequest):\n     \"\"\"\n     Response returned when a comment post is invalid. If ``DEBUG`` is on a\n@@ -27,6 +26,7 @@ def __init__(self, why):\n         if settings.DEBUG:\n             self.content = render_to_string(\"comments/400-debug.html\", {\"why\": why})\n \n+\n @csrf_protect\n @require_POST\n def post_comment(request, next=None, using=None):\n@@ -40,7 +40,7 @@ def post_comment(request, next=None, using=None):\n     data = request.POST.copy()\n     if request.user.is_authenticated():\n         if not data.get('name', ''):\n-            data[\"name\"] = request.user.get_full_name() or request.user.username\n+            data[\"name\"] = request.user.get_full_name() or request.user.get_username()\n         if not data.get('email', ''):\n             data[\"email\"] = request.user.email\n \n@@ -98,8 +98,8 @@ def post_comment(request, next=None, using=None):\n         ]\n         return render_to_response(\n             template_list, {\n-                \"comment\" : form.data.get(\"comment\", \"\"),\n-                \"form\" : form,\n+                \"comment\": form.data.get(\"comment\", \"\"),\n+                \"form\": form,\n                 \"next\": next,\n             },\n             RequestContext(request, {})\n@@ -113,9 +113,9 @@ def post_comment(request, next=None, using=None):\n \n     # Signal that the comment is about to be saved\n     responses = signals.comment_will_be_posted.send(\n-        sender  = comment.__class__,\n-        comment = comment,\n-        request = request\n+        sender=comment.__class__,\n+        comment=comment,\n+        request=request\n     )\n \n     for (receiver, response) in responses:\n@@ -126,15 +126,14 @@ def post_comment(request, next=None, using=None):\n     # Save the comment and signal that it was saved\n     comment.save()\n     signals.comment_was_posted.send(\n-        sender  = comment.__class__,\n-        comment = comment,\n-        request = request\n+        sender=comment.__class__,\n+        comment=comment,\n+        request=request\n     )\n \n     return next_redirect(data, next, comment_done, c=comment._get_pk_val())\n \n comment_done = confirmation_view(\n-    template = \"comments/posted.html\",\n-    doc = \"\"\"Display a \"comment was posted\" success page.\"\"\"\n+    template=\"comments/posted.html\",\n+    doc=\"\"\"Display a \"comment was posted\" success page.\"\"\"\n )\n-"
        },
        {
            "sha": "c45c2aff9c4bb3d3b39d7be5d45164267053128f",
            "filename": "django/contrib/contenttypes/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:37+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,29 +13,29 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: models.py:123\n+#: models.py:130\n msgid \"python model class name\"\n msgstr \"\"\n \n-#: models.py:127\n+#: models.py:134\n msgid \"content type\"\n msgstr \"\"\n \n-#: models.py:128\n+#: models.py:135\n msgid \"content types\"\n msgstr \"\"\n \n-#: views.py:15\n+#: views.py:17\n #, python-format\n msgid \"Content type %(ct_id)s object has no associated model\"\n msgstr \"\"\n \n-#: views.py:19\n+#: views.py:21\n #, python-format\n msgid \"Content type %(ct_id)s object %(obj_id)s doesn't exist\"\n msgstr \"\"\n \n-#: views.py:25\n+#: views.py:27\n #, python-format\n msgid \"%(ct_name)s objects don't have a get_absolute_url() method\"\n msgstr \"\""
        },
        {
            "sha": "10311fae923f640e7b4adac2c61f455b50c8a7d1",
            "filename": "django/contrib/contenttypes/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,7 +3,7 @@\n from django.db import models\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.contenttypes.views import shortcut\n-from django.contrib.sites.models import Site\n+from django.contrib.sites.models import Site, get_current_site\n from django.http import HttpRequest, Http404\n from django.test import TestCase\n from django.utils.http import urlquote\n@@ -219,9 +219,8 @@ def test_shortcut_view(self):\n         obj = FooWithUrl.objects.create(name=\"john\")\n \n         if Site._meta.installed:\n-            current_site = Site.objects.get_current()\n             response = shortcut(request, user_ct.id, obj.id)\n-            self.assertEqual(\"http://%s/users/john/\" % current_site.domain,\n+            self.assertEqual(\"http://%s/users/john/\" % get_current_site(request).domain,\n                              response._headers.get(\"location\")[1])\n \n         Site._meta.installed = False"
        },
        {
            "sha": "ded87e5420186896f0a60a3967c9a8e076f159a1",
            "filename": "django/contrib/flatpages/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 15,
            "deletions": 11,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fflatpages%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fflatpages%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:37+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -17,7 +17,7 @@ msgstr \"\"\n msgid \"Advanced options\"\n msgstr \"\"\n \n-#: forms.py:7 models.py:7\n+#: forms.py:7 models.py:11\n msgid \"URL\"\n msgstr \"\"\n \n@@ -45,40 +45,44 @@ msgstr \"\"\n msgid \"Flatpage with url %(url)s already exists for site %(site)s\"\n msgstr \"\"\n \n-#: models.py:8\n+#: models.py:12\n msgid \"title\"\n msgstr \"\"\n \n-#: models.py:9\n+#: models.py:13\n msgid \"content\"\n msgstr \"\"\n \n-#: models.py:10\n+#: models.py:14\n msgid \"enable comments\"\n msgstr \"\"\n \n-#: models.py:11\n+#: models.py:15\n msgid \"template name\"\n msgstr \"\"\n \n-#: models.py:12\n+#: models.py:16\n msgid \"\"\n \"Example: 'flatpages/contact_page.html'. If this isn't provided, the system \"\n \"will use 'flatpages/default.html'.\"\n msgstr \"\"\n \n-#: models.py:13\n+#: models.py:17\n msgid \"registration required\"\n msgstr \"\"\n \n-#: models.py:13\n+#: models.py:17\n msgid \"If this is checked, only logged-in users will be able to view the page.\"\n msgstr \"\"\n \n-#: models.py:18\n+#: models.py:22\n msgid \"flat page\"\n msgstr \"\"\n \n-#: models.py:19\n+#: models.py:23\n msgid \"flat pages\"\n msgstr \"\"\n+\n+#: tests/forms.py:97\n+msgid \"This field is required.\"\n+msgstr \"\""
        },
        {
            "sha": "a32ac7f4905da8049d6c9f17670f0f89f380efe6",
            "filename": "django/contrib/flatpages/templatetags/flatpages.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fflatpages%2Ftemplatetags%2Fflatpages.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fflatpages%2Ftemplatetags%2Fflatpages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Ftemplatetags%2Fflatpages.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,6 +1,7 @@\n from django import template\n from django.conf import settings\n from django.contrib.flatpages.models import FlatPage\n+from django.contrib.sites.models import get_current_site\n \n \n register = template.Library()\n@@ -19,7 +20,11 @@ def __init__(self, context_name, starts_with=None, user=None):\n             self.user = None\n \n     def render(self, context):\n-        flatpages = FlatPage.objects.filter(sites__id=settings.SITE_ID)\n+        if 'request' in context:\n+            site_pk = get_current_site(context['request']).pk\n+        else:\n+            site_pk = settings.SITE_ID\n+        flatpages = FlatPage.objects.filter(sites__id=site_pk)\n         # If a prefix was specified, add a filter\n         if self.starts_with:\n             flatpages = flatpages.filter("
        },
        {
            "sha": "497979e497e5bd6ef83859bc9957a61ff11e2bf8",
            "filename": "django/contrib/flatpages/views.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fflatpages%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fflatpages%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Fviews.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,9 +1,10 @@\n-from django.contrib.flatpages.models import FlatPage\n-from django.template import loader, RequestContext\n-from django.shortcuts import get_object_or_404\n-from django.http import Http404, HttpResponse, HttpResponsePermanentRedirect\n from django.conf import settings\n+from django.contrib.flatpages.models import FlatPage\n+from django.contrib.sites.models import get_current_site\n from django.core.xheaders import populate_xheaders\n+from django.http import Http404, HttpResponse, HttpResponsePermanentRedirect\n+from django.shortcuts import get_object_or_404\n+from django.template import loader, RequestContext\n from django.utils.safestring import mark_safe\n from django.views.decorators.csrf import csrf_protect\n \n@@ -30,14 +31,15 @@ def flatpage(request, url):\n     \"\"\"\n     if not url.startswith('/'):\n         url = '/' + url\n+    site_id = get_current_site(request).id\n     try:\n         f = get_object_or_404(FlatPage,\n-            url__exact=url, sites__id__exact=settings.SITE_ID)\n+            url__exact=url, sites__id__exact=site_id)\n     except Http404:\n         if not url.endswith('/') and settings.APPEND_SLASH:\n             url += '/'\n             f = get_object_or_404(FlatPage,\n-                url__exact=url, sites__id__exact=settings.SITE_ID)\n+                url__exact=url, sites__id__exact=site_id)\n             return HttpResponsePermanentRedirect('%s/' % request.path)\n         else:\n             raise"
        },
        {
            "sha": "04fa380ffa83c36f62db7069cdcc4bd472255fa9",
            "filename": "django/contrib/formtools/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fformtools%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fformtools%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:38+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\""
        },
        {
            "sha": "a21ffde533a58b94aa630420674442b4bc49c467",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -12,6 +12,7 @@\n from django.contrib.formtools import preview, utils\n from django.contrib.formtools.wizard import FormWizard\n from django.test import TestCase\n+from django.test.html import parse_html\n from django.test.utils import override_settings\n from django.utils import unittest\n \n@@ -218,7 +219,6 @@ def __init__(self, POST=None):\n )\n class WizardTests(TestCase):\n     urls = 'django.contrib.formtools.tests.urls'\n-    input_re = re.compile('name=\"([^\"]+)\" value=\"([^\"]+)\"')\n     wizard_step_data = (\n         {\n             '0-name': 'Pony',\n@@ -409,14 +409,13 @@ def grab_field_data(self, response):\n         \"\"\"\n         Pull the appropriate field data from the context to pass to the next wizard step\n         \"\"\"\n-        previous_fields = response.context['previous_fields']\n+        previous_fields = parse_html(response.context['previous_fields'])\n         fields = {'wizard_step': response.context['step0']}\n \n-        def grab(m):\n-            fields[m.group(1)] = m.group(2)\n-            return ''\n+        for input_field in previous_fields:\n+            input_attrs = dict(input_field.attributes)\n+            fields[input_attrs[\"name\"]] = input_attrs[\"value\"]\n \n-        self.input_re.sub(grab, previous_fields)\n         return fields\n \n     def check_wizard_step(self, response, step_no):\n@@ -428,7 +427,6 @@ def check_wizard_step(self, response, step_no):\n         \"\"\"\n         step_count = len(self.wizard_step_data)\n \n-        self.assertEqual(response.status_code, 200)\n         self.assertContains(response, 'Step %d of %d' % (step_no, step_count))\n \n         data = self.grab_field_data(response)"
        },
        {
            "sha": "d450f478614c29567e750592f23fbb2b40c3bad0",
            "filename": "django/contrib/formtools/tests/wizard/cookiestorage.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fcookiestorage.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fcookiestorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2Fwizard%2Fcookiestorage.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,3 +1,5 @@\n+import json\n+\n from django.test import TestCase\n from django.core import signing\n from django.core.exceptions import SuspiciousOperation\n@@ -41,4 +43,5 @@ def test_reset_cookie(self):\n         storage.init_data()\n         storage.update_response(response)\n         unsigned_cookie_data = cookie_signer.unsign(response.cookies[storage.prefix].value)\n-        self.assertEqual(unsigned_cookie_data, '{\"step_files\":{},\"step\":null,\"extra_data\":{},\"step_data\":{}}')\n+        self.assertEqual(json.loads(unsigned_cookie_data),\n+            {\"step_files\": {}, \"step\": None, \"extra_data\": {}, \"step_data\": {}})"
        },
        {
            "sha": "c996fdfdc21bd717519ff78a92283a1d97d051d9",
            "filename": "django/contrib/gis/__init__.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,6 @@\n+from django.utils import six\n+\n+if six.PY3:\n+    memoryview = memoryview\n+else:\n+    memoryview = buffer"
        },
        {
            "sha": "f4379be7f317599e0cc5cc038ab72f330dbb802f",
            "filename": "django/contrib/gis/admin/widgets.py",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,3 +1,5 @@\n+import logging\n+\n from django.forms.widgets import Textarea\n from django.template import loader, Context\n from django.templatetags.static import static\n@@ -10,6 +12,8 @@\n # Creating a template context that contains Django settings\n # values needed by admin map templates.\n geo_context = Context({'LANGUAGE_BIDI' : translation.get_language_bidi()})\n+logger = logging.getLogger('django.contrib.gis')\n+\n \n class OpenLayersWidget(Textarea):\n     \"\"\"\n@@ -29,7 +33,11 @@ def render(self, name, value, attrs=None):\n         if isinstance(value, six.string_types):\n             try:\n                 value = GEOSGeometry(value)\n-            except (GEOSException, ValueError):\n+            except (GEOSException, ValueError) as err:\n+                logger.error(\n+                    \"Error creating geometry from value '%s' (%s)\" % (\n+                    value, err)\n+                )\n                 value = None\n \n         if value and value.geom_type.upper() != self.geom_type:\n@@ -56,7 +64,11 @@ def render(self, name, value, attrs=None):\n                     ogr = value.ogr\n                     ogr.transform(srid)\n                     wkt = ogr.wkt\n-                except OGRException:\n+                except OGRException as err:\n+                    logger.error(\n+                        \"Error transforming geometry from srid '%s' to srid '%s' (%s)\" % (\n+                        value.srid, srid, err)\n+                    )\n                     wkt = ''\n             else:\n                 wkt = value.wkt"
        },
        {
            "sha": "171a304439c7a8c3ffb1523f37532adf9324bc65",
            "filename": "django/contrib/gis/db/backends/base.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -32,8 +32,9 @@ class BaseSpatialOperations(object):\n     # How the geometry column should be selected.\n     select = None\n \n-    # Does the spatial database have a geography type?\n+    # Does the spatial database have a geometry or geography type?\n     geography = False\n+    geometry = False\n \n     area = False\n     centroid = False\n@@ -116,6 +117,16 @@ def get_geom_placeholder(self, f, value):\n         \"\"\"\n         raise NotImplementedError\n \n+    def get_expression_column(self, evaluator):\n+        \"\"\"\n+        Helper method to return the quoted column string from the evaluator\n+        for its expression.\n+        \"\"\"\n+        for expr, col_tup in evaluator.cols:\n+            if expr is evaluator.expression:\n+                return '%s.%s' % tuple(map(self.quote_name, col_tup))\n+        raise Exception(\"Could not find the column for the expression.\")\n+\n     # Spatial SQL Construction\n     def spatial_aggregate_sql(self, agg):\n         raise NotImplementedError('Aggregate support not implemented for this spatial backend.')"
        },
        {
            "sha": "fa20ca07f4498c299edc9a03282172b393b7e4c0",
            "filename": "django/contrib/gis/db/backends/mysql/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -44,7 +44,7 @@ def get_geom_placeholder(self, value, srid):\n         modify the placeholder based on the contents of the given value.\n         \"\"\"\n         if hasattr(value, 'expression'):\n-            placeholder = '%s.%s' % tuple(map(self.quote_name, value.cols[value.expression]))\n+            placeholder = self.get_expression_column(value)\n         else:\n             placeholder = '%s(%%s)' % self.from_text\n         return placeholder"
        },
        {
            "sha": "35a4d9491d1e82968ae5499f90c0b88b1da19d1e",
            "filename": "django/contrib/gis/db/backends/oracle/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -213,7 +213,7 @@ def transform_value(val, srid):\n                 placeholder = '%s'\n             # No geometry value used for F expression, substitue in\n             # the column name instead.\n-            return placeholder % '%s.%s' % tuple(map(self.quote_name, value.cols[value.expression]))\n+            return placeholder % self.get_expression_column(value)\n         else:\n             if transform_value(value, f.srid):\n                 return '%s(SDO_GEOMETRY(%%s, %s), %s)' % (self.transform, value.srid, f.srid)"
        },
        {
            "sha": "8bb514d760b6dc2af38723ef32be4259aec9dd39",
            "filename": "django/contrib/gis/db/backends/postgis/adapter.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fadapter.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fadapter.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fadapter.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,6 +1,7 @@\n \"\"\"\n  This object provides quoting for GEOS geometries into PostgreSQL/PostGIS.\n \"\"\"\n+from __future__ import unicode_literals\n \n from psycopg2 import Binary\n from psycopg2.extensions import ISQLQuote\n@@ -10,7 +11,7 @@ def __init__(self, geom):\n         \"Initializes on the geometry.\"\n         # Getting the WKB (in string form, to allow easy pickling of\n         # the adaptor) and the SRID from the geometry.\n-        self.ewkb = str(geom.ewkb)\n+        self.ewkb = bytes(geom.ewkb)\n         self.srid = geom.srid\n         self._adapter = Binary(self.ewkb)\n \n@@ -39,7 +40,7 @@ def prepare(self, conn):\n     def getquoted(self):\n         \"Returns a properly quoted string for use in PostgreSQL/PostGIS.\"\n         # psycopg will figure out whether to use E'\\\\000' or '\\000'\n-        return 'ST_GeomFromEWKB(%s)' % self._adapter.getquoted()\n+        return str('ST_GeomFromEWKB(%s)' % self._adapter.getquoted().decode())\n \n     def prepare_database_save(self, unused):\n         return self"
        },
        {
            "sha": "406dc4e487b1fd0b96df58a110e90fa5c6f8cf8c",
            "filename": "django/contrib/gis/db/backends/postgis/creation.py",
            "status": "modified",
            "additions": 21,
            "deletions": 10,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Fcreation.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,9 +1,11 @@\n from django.conf import settings\n+from django.core.exceptions import ImproperlyConfigured\n from django.db.backends.postgresql_psycopg2.creation import DatabaseCreation\n \n class PostGISCreation(DatabaseCreation):\n     geom_index_type = 'GIST'\n-    geom_index_opts = 'GIST_GEOMETRY_OPS'\n+    geom_index_ops = 'GIST_GEOMETRY_OPS'\n+    geom_index_ops_nd = 'GIST_GEOMETRY_OPS_ND'\n \n     def sql_indexes_for_field(self, model, f, style):\n         \"Return any spatial index creation SQL for the field.\"\n@@ -16,8 +18,9 @@ def sql_indexes_for_field(self, model, f, style):\n             qn = self.connection.ops.quote_name\n             db_table = model._meta.db_table\n \n-            if f.geography:\n-                # Geogrophy columns are created normally.\n+            if f.geography or self.connection.ops.geometry:\n+                # Geography and Geometry (PostGIS 2.0+) columns are\n+                # created normally.\n                 pass\n             else:\n                 # Geometry columns are created by `AddGeometryColumn`\n@@ -38,23 +41,31 @@ def sql_indexes_for_field(self, model, f, style):\n                                   style.SQL_FIELD(qn(f.column)) +\n                                   style.SQL_KEYWORD(' SET NOT NULL') + ';')\n \n-\n             if f.spatial_index:\n                 # Spatial indexes created the same way for both Geometry and\n-                # Geography columns\n+                # Geography columns.\n+                # PostGIS 2.0 does not support GIST_GEOMETRY_OPS. So, on 1.5\n+                # we use GIST_GEOMETRY_OPS, on 2.0 we use either \"nd\" ops\n+                # which are fast on multidimensional cases, or just plain\n+                # gist index for the 2d case.\n                 if f.geography:\n-                    index_opts = ''\n+                    index_ops = ''\n+                elif self.connection.ops.geometry:\n+                    if f.dim > 2:\n+                        index_ops = ' ' + style.SQL_KEYWORD(self.geom_index_ops_nd)\n+                    else:\n+                        index_ops = ''\n                 else:\n-                    index_opts = ' ' + style.SQL_KEYWORD(self.geom_index_opts)\n+                    index_ops = ' ' + style.SQL_KEYWORD(self.geom_index_ops)\n                 output.append(style.SQL_KEYWORD('CREATE INDEX ') +\n                               style.SQL_TABLE(qn('%s_%s_id' % (db_table, f.column))) +\n                               style.SQL_KEYWORD(' ON ') +\n                               style.SQL_TABLE(qn(db_table)) +\n                               style.SQL_KEYWORD(' USING ') +\n                               style.SQL_COLTYPE(self.geom_index_type) + ' ( ' +\n-                              style.SQL_FIELD(qn(f.column)) + index_opts + ' );')\n+                              style.SQL_FIELD(qn(f.column)) + index_ops + ' );')\n         return output\n \n     def sql_table_creation_suffix(self):\n-        qn = self.connection.ops.quote_name\n-        return ' TEMPLATE %s' % qn(getattr(settings, 'POSTGIS_TEMPLATE', 'template_postgis'))\n+        postgis_template = getattr(settings, 'POSTGIS_TEMPLATE', 'template_postgis')\n+        return ' TEMPLATE %s' % self.connection.ops.quote_name(postgis_template)"
        },
        {
            "sha": "aa23b974dbbfc7903bee7feb761d4c8bddade616",
            "filename": "django/contrib/gis/db/backends/postgis/operations.py",
            "status": "modified",
            "additions": 28,
            "deletions": 9,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -103,11 +103,12 @@ def __init__(self, connection):\n             self.geom_func_prefix = prefix\n             self.spatial_version = version\n         except DatabaseError:\n-            raise ImproperlyConfigured('Cannot determine PostGIS version for database \"%s\". '\n-                                       'GeoDjango requires at least PostGIS version 1.3. '\n-                                       'Was the database created from a spatial database '\n-                                       'template?' % self.connection.settings_dict['NAME']\n-                                       )\n+            raise ImproperlyConfigured(\n+                'Cannot determine PostGIS version for database \"%s\". '\n+                'GeoDjango requires at least PostGIS version 1.3. '\n+                'Was the database created from a spatial database '\n+                'template?' % self.connection.settings_dict['NAME']\n+                )\n         # TODO: Raise helpful exceptions as they become known.\n \n         # PostGIS-specific operators. The commented descriptions of these\n@@ -215,6 +216,10 @@ def get_dist_ops(operator):\n                 'bboverlaps' : PostGISOperator('&&'),\n                 }\n \n+        # Native geometry type support added in PostGIS 2.0.\n+        if version >= (2, 0, 0):\n+            self.geometry = True\n+\n         # Creating a dictionary lookup of all GIS terms for PostGIS.\n         gis_terms = ['isnull']\n         gis_terms += list(self.geometry_operators)\n@@ -231,22 +236,19 @@ def get_dist_ops(operator):\n         self.distance_spheroid = prefix + 'distance_spheroid'\n         self.envelope = prefix + 'Envelope'\n         self.extent = prefix + 'Extent'\n-        self.extent3d = prefix + 'Extent3D'\n         self.force_rhr = prefix + 'ForceRHR'\n         self.geohash = GEOHASH\n         self.geojson = GEOJSON\n         self.gml = prefix + 'AsGML'\n         self.intersection = prefix + 'Intersection'\n         self.kml = prefix + 'AsKML'\n         self.length = prefix + 'Length'\n-        self.length3d = prefix + 'Length3D'\n         self.length_spheroid = prefix + 'length_spheroid'\n         self.makeline = prefix + 'MakeLine'\n         self.mem_size = prefix + 'mem_size'\n         self.num_geom = prefix + 'NumGeometries'\n         self.num_points =prefix + 'npoints'\n         self.perimeter = prefix + 'Perimeter'\n-        self.perimeter3d = prefix + 'Perimeter3D'\n         self.point_on_surface = prefix + 'PointOnSurface'\n         self.polygonize = prefix + 'Polygonize'\n         self.reverse = prefix + 'Reverse'\n@@ -259,6 +261,15 @@ def get_dist_ops(operator):\n         self.union = prefix + 'Union'\n         self.unionagg = prefix + 'Union'\n \n+        if version >= (2, 0, 0):\n+            self.extent3d = prefix + '3DExtent'\n+            self.length3d = prefix + '3DLength'\n+            self.perimeter3d = prefix + '3DPerimeter'\n+        else:\n+            self.extent3d = prefix + 'Extent3D'\n+            self.length3d = prefix + 'Length3D'\n+            self.perimeter3d = prefix + 'Perimeter3D'\n+\n     def check_aggregate_support(self, aggregate):\n         \"\"\"\n         Checks if the given aggregate name is supported (that is, if it's\n@@ -314,6 +325,14 @@ def geo_db_type(self, f):\n                                           'only with an SRID of 4326.')\n \n             return 'geography(%s,%d)'% (f.geom_type, f.srid)\n+        elif self.geometry:\n+            # Postgis 2.0 supports type-based geometries.\n+            # TODO: Support 'M' extension.\n+            if f.dim == 3:\n+                geom_type = f.geom_type + 'Z'\n+            else:\n+                geom_type = f.geom_type\n+            return 'geometry(%s,%d)' % (geom_type, f.srid)\n         else:\n             return None\n \n@@ -375,7 +394,7 @@ def get_geom_placeholder(self, f, value):\n             # If this is an F expression, then we don't really want\n             # a placeholder and instead substitute in the column\n             # of the expression.\n-            placeholder = placeholder % '%s.%s' % tuple(map(self.quote_name, value.cols[value.expression]))\n+            placeholder = placeholder % self.get_expression_column(value)\n \n         return placeholder\n "
        },
        {
            "sha": "5eaa77843c93cfb217f86b23c8af32561a4cfe5b",
            "filename": "django/contrib/gis/db/backends/spatialite/operations.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -146,6 +146,8 @@ def confirm_spatial_components_versions(self):\n             except DatabaseError:\n                 # we are using < 2.4.0-RC4\n                 pass\n+        if version >= (3, 0, 0):\n+            self.geojson = 'AsGeoJSON'\n \n     def check_aggregate_support(self, aggregate):\n         \"\"\"\n@@ -208,7 +210,7 @@ def transform_value(value, srid):\n                 placeholder = '%s'\n             # No geometry value used for F expression, substitue in\n             # the column name instead.\n-            return placeholder % '%s.%s' % tuple(map(self.quote_name, value.cols[value.expression]))\n+            return placeholder % self.get_expression_column(value)\n         else:\n             if transform_value(value, f.srid):\n                 # Adding Transform() to the SQL placeholder."
        },
        {
            "sha": "d90ce309d461280b773128a382048496e17d6b31",
            "filename": "django/contrib/gis/db/models/fields.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Ffields.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -95,7 +95,7 @@ def __init__(self, verbose_name=None, srid=4326, spatial_index=True, dim=2,\n         # Is this a geography rather than a geometry column?\n         self.geography = geography\n \n-        # Oracle-specific private attributes for creating the entrie in\n+        # Oracle-specific private attributes for creating the entry in\n         # `USER_SDO_GEOM_METADATA`\n         self._extent = kwargs.pop('extent', (-180.0, -90.0, 180.0, 90.0))\n         self._tolerance = kwargs.pop('tolerance', 0.05)\n@@ -160,7 +160,7 @@ def get_prep_value(self, value):\n         # from the given string input.\n         if isinstance(geom, Geometry):\n             pass\n-        elif isinstance(geom, six.string_types) or hasattr(geom, '__geo_interface__'):\n+        elif isinstance(geom, (bytes, six.string_types)) or hasattr(geom, '__geo_interface__'):\n             try:\n                 geom = Geometry(geom)\n             except GeometryException:"
        },
        {
            "sha": "1fdc5036bac404bc6ea666d07229db291add9058",
            "filename": "django/contrib/gis/db/models/proxy.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fproxy.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fproxy.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fproxy.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -5,6 +5,7 @@\n \n Thanks to Robert Coup for providing this functionality (see #4322).\n \"\"\"\n+from django.contrib.gis import memoryview\n from django.utils import six\n \n class GeometryProxy(object):\n@@ -54,7 +55,7 @@ def __set__(self, obj, value):\n         if isinstance(value, self._klass) and (str(value.geom_type).upper() == gtype or gtype == 'GEOMETRY'):\n             # Assigning the SRID to the geometry.\n             if value.srid is None: value.srid = self._field.srid\n-        elif value is None or isinstance(value, six.string_types + (buffer,)):\n+        elif value is None or isinstance(value, six.string_types + (memoryview,)):\n             # Set with None, WKT, HEX, or WKB\n             pass\n         else:"
        },
        {
            "sha": "2ffbd2021b32487151188a0c5c0c7579a9f85af5",
            "filename": "django/contrib/gis/db/models/query.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,6 +1,7 @@\n from django.db import connections\n from django.db.models.query import QuerySet, ValuesQuerySet, ValuesListQuerySet\n \n+from django.contrib.gis import memoryview\n from django.contrib.gis.db.models import aggregates\n from django.contrib.gis.db.models.fields import get_srid_info, PointField, LineStringField\n from django.contrib.gis.db.models.sql import AreaField, DistanceField, GeomField, GeoQuery\n@@ -145,13 +146,14 @@ def geojson(self, precision=8, crs=False, bbox=False, **kwargs):\n         \"\"\"\n         backend = connections[self.db].ops\n         if not backend.geojson:\n-            raise NotImplementedError('Only PostGIS 1.3.4+ supports GeoJSON serialization.')\n+            raise NotImplementedError('Only PostGIS 1.3.4+ and SpatiaLite 3.0+ '\n+                                      'support GeoJSON serialization.')\n \n         if not isinstance(precision, six.integer_types):\n             raise TypeError('Precision keyword must be set with an integer.')\n \n         # Setting the options flag -- which depends on which version of\n-        # PostGIS we're using.\n+        # PostGIS we're using. SpatiaLite only uses the first group of options.\n         if backend.spatial_version >= (1, 4, 0):\n             options = 0\n             if crs and bbox: options = 3\n@@ -193,9 +195,9 @@ def gml(self, precision=8, version=2, **kwargs):\n             # PostGIS AsGML() aggregate function parameter order depends on the\n             # version -- uggh.\n             if backend.spatial_version > (1, 3, 1):\n-                procedure_fmt = '%(version)s,%(geo_col)s,%(precision)s'\n+                s['procedure_fmt'] = '%(version)s,%(geo_col)s,%(precision)s'\n             else:\n-                procedure_fmt = '%(geo_col)s,%(precision)s,%(version)s'\n+                s['procedure_fmt'] = '%(geo_col)s,%(precision)s,%(version)s'\n             s['procedure_args'] = {'precision' : precision, 'version' : version}\n \n         return self._spatial_attribute('gml', s, **kwargs)\n@@ -676,7 +678,7 @@ def _distance_attribute(self, func, geom=None, tolerance=0.05, spheroid=False, *\n                     if not backend.geography:\n                         if not isinstance(geo_field, PointField):\n                             raise ValueError('Spherical distance calculation only supported on PointFields.')\n-                        if not str(Geometry(buffer(params[0].ewkb)).geom_type) == 'Point':\n+                        if not str(Geometry(memoryview(params[0].ewkb)).geom_type) == 'Point':\n                             raise ValueError('Spherical distance calculation only supported with Point Geometry parameters')\n                     # The `function` procedure argument needs to be set differently for\n                     # geodetic distance calculations."
        },
        {
            "sha": "cf6a8ad0476a966c97176e456e9aa537cd286782",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,3 +1,8 @@\n+try:\n+    from itertools import zip_longest\n+except ImportError:\n+    from itertools import izip_longest as zip_longest\n+\n from django.utils.six.moves import zip\n \n from django.db.backends.util import truncate_name, typecast_timestamp\n@@ -114,10 +119,10 @@ def get_default_columns(self, with_aliases=False, col_aliases=None,\n         result = []\n         if opts is None:\n             opts = self.query.model._meta\n+        # Skip all proxy to the root proxied model\n+        opts = opts.concrete_model._meta\n         aliases = set()\n         only_load = self.deferred_to_columns()\n-        # Skip all proxy to the root proxied model\n-        proxied_model = opts.concrete_model\n \n         if start_alias:\n             seen = {None: start_alias}\n@@ -128,12 +133,9 @@ def get_default_columns(self, with_aliases=False, col_aliases=None,\n                 try:\n                     alias = seen[model]\n                 except KeyError:\n-                    if model is proxied_model:\n-                        alias = start_alias\n-                    else:\n-                        link_field = opts.get_ancestor_link(model)\n-                        alias = self.query.join((start_alias, model._meta.db_table,\n-                                link_field.column, model._meta.pk.column))\n+                    link_field = opts.get_ancestor_link(model)\n+                    alias = self.query.join((start_alias, model._meta.db_table,\n+                            link_field.column, model._meta.pk.column))\n                     seen[model] = alias\n             else:\n                 # If we're starting from the base model of the queryset, the\n@@ -190,7 +192,7 @@ def resolve_columns(self, row, fields=()):\n         if self.connection.ops.oracle or getattr(self.query, 'geo_values', False):\n             # We resolve the rest of the columns if we're on Oracle or if\n             # the `geo_values` attribute is defined.\n-            for value, field in map(None, row[index_start:], fields):\n+            for value, field in zip_longest(row[index_start:], fields):\n                 values.append(self.query.convert_values(value, field, self.connection))\n         else:\n             values.extend(row[index_start:])"
        },
        {
            "sha": "c33fbcb97af1d92e950b002fe856a52e75ae3dc4",
            "filename": "django/contrib/gis/gdal/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -37,11 +37,11 @@\n try:\n     from django.contrib.gis.gdal.driver import Driver\n     from django.contrib.gis.gdal.datasource import DataSource\n-    from django.contrib.gis.gdal.libgdal import gdal_version, gdal_full_version, gdal_release_date, GDAL_VERSION\n+    from django.contrib.gis.gdal.libgdal import gdal_version, gdal_full_version, GDAL_VERSION\n     from django.contrib.gis.gdal.srs import SpatialReference, CoordTransform\n     from django.contrib.gis.gdal.geometries import OGRGeometry\n     HAS_GDAL = True\n-except:\n+except Exception:\n     HAS_GDAL = False\n \n try:"
        },
        {
            "sha": "c92b2e170b88ff69f906d0e277f5fbb6a50af344",
            "filename": "django/contrib/gis/gdal/datasource.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fdatasource.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fdatasource.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fdatasource.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -45,6 +45,7 @@\n # Getting the ctypes prototypes for the DataSource.\n from django.contrib.gis.gdal.prototypes import ds as capi\n \n+from django.utils.encoding import force_bytes, force_text\n from django.utils import six\n from django.utils.six.moves import xrange\n \n@@ -56,12 +57,14 @@ class DataSource(GDALBase):\n     \"Wraps an OGR Data Source object.\"\n \n     #### Python 'magic' routines ####\n-    def __init__(self, ds_input, ds_driver=False, write=False):\n+    def __init__(self, ds_input, ds_driver=False, write=False, encoding='utf-8'):\n         # The write flag.\n         if write:\n             self._write = 1\n         else:\n             self._write = 0\n+        # See also http://trac.osgeo.org/gdal/wiki/rfc23_ogr_unicode\n+        self.encoding = encoding\n \n         # Registering all the drivers, this needs to be done\n         #  _before_ we try to open up a data source.\n@@ -73,7 +76,7 @@ def __init__(self, ds_input, ds_driver=False, write=False):\n             ds_driver = Driver.ptr_type()\n             try:\n                 # OGROpen will auto-detect the data source type.\n-                ds = capi.open_ds(ds_input, self._write, byref(ds_driver))\n+                ds = capi.open_ds(force_bytes(ds_input), self._write, byref(ds_driver))\n             except OGRException:\n                 # Making the error message more clear rather than something\n                 # like \"Invalid pointer returned from OGROpen\".\n@@ -102,7 +105,7 @@ def __iter__(self):\n     def __getitem__(self, index):\n         \"Allows use of the index [] operator to get a layer at the index.\"\n         if isinstance(index, six.string_types):\n-            l = capi.get_layer_by_name(self.ptr, index)\n+            l = capi.get_layer_by_name(self.ptr, force_bytes(index))\n             if not l: raise OGRIndexError('invalid OGR Layer name given: \"%s\"' % index)\n         elif isinstance(index, int):\n             if index < 0 or index >= self.layer_count:\n@@ -128,4 +131,5 @@ def layer_count(self):\n     @property\n     def name(self):\n         \"Returns the name of the data source.\"\n-        return capi.get_ds_name(self._ptr)\n+        name = capi.get_ds_name(self._ptr)\n+        return force_text(name, self.encoding, strings_only=True)"
        },
        {
            "sha": "55a5d77d661f642bccf3285dcb8280b4dcbf7818",
            "filename": "django/contrib/gis/gdal/driver.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fdriver.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fdriver.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fdriver.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -5,6 +5,7 @@\n from django.contrib.gis.gdal.prototypes import ds as capi\n \n from django.utils import six\n+from django.utils.encoding import force_bytes\n \n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n@@ -36,7 +37,7 @@ def __init__(self, dr_input):\n                 name = dr_input\n \n             # Attempting to get the OGR driver by the string name.\n-            dr = capi.get_driver_by_name(name)\n+            dr = capi.get_driver_by_name(force_bytes(name))\n         elif isinstance(dr_input, int):\n             self._register()\n             dr = capi.get_driver(dr_input)"
        },
        {
            "sha": "f145526af0f9dbba9bd762447c34dbcd9f1ea8f9",
            "filename": "django/contrib/gis/gdal/envelope.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fenvelope.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fenvelope.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fenvelope.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -52,7 +52,7 @@ def __init__(self, *args):\n         elif len(args) == 4:\n             # Individual parameters passed in.\n             #  Thanks to ww for the help\n-            self._from_sequence(map(float, args))\n+            self._from_sequence([float(a) for a in args])\n         else:\n             raise OGRException('Incorrect number (%d) of arguments.' % len(args))\n "
        },
        {
            "sha": "a11a6873c5f97dfba2f7adcb81221c505721d9a4",
            "filename": "django/contrib/gis/gdal/feature.py",
            "status": "modified",
            "additions": 23,
            "deletions": 11,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ffeature.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ffeature.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ffeature.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -7,6 +7,7 @@\n # ctypes function prototypes\n from django.contrib.gis.gdal.prototypes import ds as capi, geom as geom_api\n \n+from django.utils.encoding import force_bytes, force_text\n from django.utils import six\n from django.utils.six.moves import xrange\n \n@@ -15,15 +16,20 @@\n #\n # The OGR_F_* routines are relevant here.\n class Feature(GDALBase):\n-    \"A class that wraps an OGR Feature, needs to be instantiated from a Layer object.\"\n+    \"\"\"\n+    This class that wraps an OGR Feature, needs to be instantiated\n+    from a Layer object.\n+    \"\"\"\n \n     #### Python 'magic' routines ####\n-    def __init__(self, feat, fdefn):\n-        \"Initializes on the pointers for the feature and the layer definition.\"\n-        if not feat or not fdefn:\n+    def __init__(self, feat, layer):\n+        \"\"\"\n+        Initializes Feature from a pointer and its Layer object.\n+        \"\"\"\n+        if not feat:\n             raise OGRException('Cannot create OGR Feature, invalid pointer given.')\n         self.ptr = feat\n-        self._fdefn = fdefn\n+        self._layer = layer\n \n     def __del__(self):\n         \"Releases a reference to this object.\"\n@@ -42,7 +48,7 @@ def __getitem__(self, index):\n             if index < 0 or index > self.num_fields:\n                 raise OGRIndexError('index out of range')\n             i = index\n-        return Field(self.ptr, i)\n+        return Field(self, i)\n \n     def __iter__(self):\n         \"Iterates over each field in the Feature.\"\n@@ -62,6 +68,10 @@ def __eq__(self, other):\n         return bool(capi.feature_equal(self.ptr, other._ptr))\n \n     #### Feature Properties ####\n+    @property\n+    def encoding(self):\n+        return self._layer._ds.encoding\n+\n     @property\n     def fid(self):\n         \"Returns the feature identifier.\"\n@@ -70,7 +80,8 @@ def fid(self):\n     @property\n     def layer_name(self):\n         \"Returns the name of the layer for the feature.\"\n-        return capi.get_feat_name(self._fdefn)\n+        name = capi.get_feat_name(self._layer._ldefn)\n+        return force_text(name, self.encoding, strings_only=True)\n \n     @property\n     def num_fields(self):\n@@ -80,7 +91,7 @@ def num_fields(self):\n     @property\n     def fields(self):\n         \"Returns a list of fields in the Feature.\"\n-        return [capi.get_field_name(capi.get_field_defn(self._fdefn, i))\n+        return [capi.get_field_name(capi.get_field_defn(self._layer._ldefn, i))\n                 for i in xrange(self.num_fields)]\n \n     @property\n@@ -93,7 +104,7 @@ def geom(self):\n     @property\n     def geom_type(self):\n         \"Returns the OGR Geometry Type for this Feture.\"\n-        return OGRGeomType(capi.get_fd_geom_type(self._fdefn))\n+        return OGRGeomType(capi.get_fd_geom_type(self._layer._ldefn))\n \n     #### Feature Methods ####\n     def get(self, field):\n@@ -107,6 +118,7 @@ def get(self, field):\n \n     def index(self, field_name):\n         \"Returns the index of the given field name.\"\n-        i = capi.get_field_index(self.ptr, field_name)\n-        if i < 0: raise OGRIndexError('invalid OFT field name given: \"%s\"' % field_name)\n+        i = capi.get_field_index(self.ptr, force_bytes(field_name))\n+        if i < 0:\n+            raise OGRIndexError('invalid OFT field name given: \"%s\"' % field_name)\n         return i"
        },
        {
            "sha": "2415f32b26b911aa9673dd38bd707d9e71efbf68",
            "filename": "django/contrib/gis/gdal/field.py",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ffield.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ffield.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ffield.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,26 +3,31 @@\n from django.contrib.gis.gdal.base import GDALBase\n from django.contrib.gis.gdal.error import OGRException\n from django.contrib.gis.gdal.prototypes import ds as capi\n+from django.utils.encoding import force_text\n+\n \n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n #\n # The OGR_Fld_* routines are relevant here.\n class Field(GDALBase):\n-    \"A class that wraps an OGR Field, needs to be instantiated from a Feature object.\"\n+    \"\"\"\n+    This class wraps an OGR Field, and needs to be instantiated\n+    from a Feature object.\n+    \"\"\"\n \n     #### Python 'magic' routines ####\n     def __init__(self, feat, index):\n         \"\"\"\n-        Initializes on the feature pointer and the integer index of\n+        Initializes on the feature object and the integer index of\n         the field within the feature.\n         \"\"\"\n         # Setting the feature pointer and index.\n         self._feat = feat\n         self._index = index\n \n         # Getting the pointer for this field.\n-        fld_ptr = capi.get_feat_field_defn(feat, index)\n+        fld_ptr = capi.get_feat_field_defn(feat.ptr, index)\n         if not fld_ptr:\n             raise OGRException('Cannot create OGR Field, invalid pointer given.')\n         self.ptr = fld_ptr\n@@ -42,21 +47,23 @@ def __str__(self):\n     #### Field Methods ####\n     def as_double(self):\n         \"Retrieves the Field's value as a double (float).\"\n-        return capi.get_field_as_double(self._feat, self._index)\n+        return capi.get_field_as_double(self._feat.ptr, self._index)\n \n     def as_int(self):\n         \"Retrieves the Field's value as an integer.\"\n-        return capi.get_field_as_integer(self._feat, self._index)\n+        return capi.get_field_as_integer(self._feat.ptr, self._index)\n \n     def as_string(self):\n         \"Retrieves the Field's value as a string.\"\n-        return capi.get_field_as_string(self._feat, self._index)\n+        string = capi.get_field_as_string(self._feat.ptr, self._index)\n+        return force_text(string, encoding=self._feat.encoding, strings_only=True)\n \n     def as_datetime(self):\n         \"Retrieves the Field's value as a tuple of date & time components.\"\n         yy, mm, dd, hh, mn, ss, tz = [c_int() for i in range(7)]\n-        status = capi.get_field_as_datetime(self._feat, self._index, byref(yy), byref(mm), byref(dd),\n-                                            byref(hh), byref(mn), byref(ss), byref(tz))\n+        status = capi.get_field_as_datetime(\n+            self._feat.ptr, self._index, byref(yy), byref(mm), byref(dd),\n+            byref(hh), byref(mn), byref(ss), byref(tz))\n         if status:\n             return (yy, mm, dd, hh, mn, ss, tz)\n         else:\n@@ -66,7 +73,8 @@ def as_datetime(self):\n     @property\n     def name(self):\n         \"Returns the name of this Field.\"\n-        return capi.get_field_name(self.ptr)\n+        name = capi.get_field_name(self.ptr)\n+        return force_text(name, encoding=self._feat.encoding, strings_only=True)\n \n     @property\n     def precision(self):"
        },
        {
            "sha": "eb670592458aa05e30f4049dea688ab02faae8d1",
            "filename": "django/contrib/gis/gdal/geometries.py",
            "status": "modified",
            "additions": 10,
            "deletions": 13,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -43,6 +43,8 @@\n from binascii import a2b_hex, b2a_hex\n from ctypes import byref, string_at, c_char_p, c_double, c_ubyte, c_void_p\n \n+from django.contrib.gis import memoryview\n+\n # Getting GDAL prerequisites\n from django.contrib.gis.gdal.base import GDALBase\n from django.contrib.gis.gdal.envelope import Envelope, OGREnvelope\n@@ -76,16 +78,11 @@ def __init__(self, geom_input, srs=None):\n \n         # If HEX, unpack input to to a binary buffer.\n         if str_instance and hex_regex.match(geom_input):\n-            geom_input = buffer(a2b_hex(geom_input.upper()))\n+            geom_input = memoryview(a2b_hex(geom_input.upper().encode()))\n             str_instance = False\n \n         # Constructing the geometry,\n         if str_instance:\n-            # Checking if unicode\n-            if isinstance(geom_input, six.text_type):\n-                # Encoding to ASCII, WKT or HEX doesn't need any more.\n-                geom_input = geom_input.encode('ascii')\n-\n             wkt_m = wkt_regex.match(geom_input)\n             json_m = json_regex.match(geom_input)\n             if wkt_m:\n@@ -96,19 +93,19 @@ def __init__(self, geom_input, srs=None):\n                     # OGR_G_CreateFromWkt doesn't work with LINEARRING WKT.\n                     #  See http://trac.osgeo.org/gdal/ticket/1992.\n                     g = capi.create_geom(OGRGeomType(wkt_m.group('type')).num)\n-                    capi.import_wkt(g, byref(c_char_p(wkt_m.group('wkt'))))\n+                    capi.import_wkt(g, byref(c_char_p(wkt_m.group('wkt').encode())))\n                 else:\n-                    g = capi.from_wkt(byref(c_char_p(wkt_m.group('wkt'))), None, byref(c_void_p()))\n+                    g = capi.from_wkt(byref(c_char_p(wkt_m.group('wkt').encode())), None, byref(c_void_p()))\n             elif json_m:\n-                g = capi.from_json(geom_input)\n+                g = capi.from_json(geom_input.encode())\n             else:\n                 # Seeing if the input is a valid short-hand string\n                 # (e.g., 'Point', 'POLYGON').\n                 ogr_t = OGRGeomType(geom_input)\n                 g = capi.create_geom(OGRGeomType(geom_input).num)\n-        elif isinstance(geom_input, buffer):\n+        elif isinstance(geom_input, memoryview):\n             # WKB was passed in\n-            g = capi.from_wkb(str(geom_input), None, byref(c_void_p()), len(geom_input))\n+            g = capi.from_wkb(bytes(geom_input), None, byref(c_void_p()), len(geom_input))\n         elif isinstance(geom_input, OGRGeomType):\n             # OGRGeomType was passed in, an empty geometry will be created.\n             g = capi.create_geom(geom_input.num)\n@@ -141,7 +138,7 @@ def __getstate__(self):\n             srs = srs.wkt\n         else:\n             srs = None\n-        return str(self.wkb), srs\n+        return bytes(self.wkb), srs\n \n     def __setstate__(self, state):\n         wkb, srs = state\n@@ -354,7 +351,7 @@ def wkb(self):\n         buf = (c_ubyte * sz)()\n         wkb = capi.to_wkb(self.ptr, byteorder, byref(buf))\n         # Returning a buffer of the string at the pointer.\n-        return buffer(string_at(buf, sz))\n+        return memoryview(string_at(buf, sz))\n \n     @property\n     def wkt(self):"
        },
        {
            "sha": "7f935cd114455ba500d2c8cbfbb7c7b941a709d9",
            "filename": "django/contrib/gis/gdal/layer.py",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Flayer.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Flayer.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Flayer.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,6 +14,7 @@\n # GDAL ctypes function prototypes.\n from django.contrib.gis.gdal.prototypes import ds as capi, geom as geom_api, srs as srs_api\n \n+from django.utils.encoding import force_bytes, force_text\n from django.utils import six\n from django.utils.six.moves import xrange\n \n@@ -38,7 +39,7 @@ def __init__(self, layer_ptr, ds):\n         self._ds = ds\n         self._ldefn = capi.get_layer_defn(self._ptr)\n         # Does the Layer support random reading?\n-        self._random_read = self.test_capability('RandomRead')\n+        self._random_read = self.test_capability(b'RandomRead')\n \n     def __getitem__(self, index):\n         \"Gets the Feature at the specified index.\"\n@@ -60,7 +61,7 @@ def __iter__(self):\n         # ResetReading() must be called before iteration is to begin.\n         capi.reset_reading(self._ptr)\n         for i in xrange(self.num_feat):\n-            yield Feature(capi.get_next_feature(self._ptr), self._ldefn)\n+            yield Feature(capi.get_next_feature(self._ptr), self)\n \n     def __len__(self):\n         \"The length is the number of features.\"\n@@ -80,7 +81,7 @@ def _make_feature(self, feat_id):\n         if self._random_read:\n             # If the Layer supports random reading, return.\n             try:\n-                return Feature(capi.get_feature(self.ptr, feat_id), self._ldefn)\n+                return Feature(capi.get_feature(self.ptr, feat_id), self)\n             except OGRException:\n                 pass\n         else:\n@@ -102,7 +103,8 @@ def extent(self):\n     @property\n     def name(self):\n         \"Returns the name of this layer in the Data Source.\"\n-        return capi.get_fd_name(self._ldefn)\n+        name = capi.get_fd_name(self._ldefn)\n+        return force_text(name, self._ds.encoding, strings_only=True)\n \n     @property\n     def num_feat(self, force=1):\n@@ -134,8 +136,9 @@ def fields(self):\n         Returns a list of string names corresponding to each of the Fields\n         available in this Layer.\n         \"\"\"\n-        return [capi.get_field_name(capi.get_field_defn(self._ldefn, i))\n-                for i in xrange(self.num_fields) ]\n+        return [force_text(capi.get_field_name(capi.get_field_defn(self._ldefn, i)),\n+                           self._ds.encoding, strings_only=True)\n+                for i in xrange(self.num_fields)]\n \n     @property\n     def field_types(self):\n@@ -212,4 +215,4 @@ def test_capability(self, capability):\n           'FastFeatureCount', 'FastGetExtent', 'CreateField', 'Transactions',\n           'DeleteFeature', and 'FastSetNextByIndex'.\n         \"\"\"\n-        return bool(capi.test_capability(self.ptr, capability))\n+        return bool(capi.test_capability(self.ptr, force_bytes(capability)))"
        },
        {
            "sha": "91f8d618fc2e570a11afe7b84adf7833e2c2a63f",
            "filename": "django/contrib/gis/gdal/libgdal.py",
            "status": "modified",
            "additions": 27,
            "deletions": 17,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Flibgdal.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Flibgdal.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Flibgdal.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,14 +1,22 @@\n+from __future__ import unicode_literals\n+\n+import logging\n import os\n import re\n-from ctypes import c_char_p, CDLL\n+from ctypes import c_char_p, c_int, CDLL, CFUNCTYPE\n from ctypes.util import find_library\n+\n from django.contrib.gis.gdal.error import OGRException\n+from django.core.exceptions import ImproperlyConfigured\n+\n+logger = logging.getLogger('django.contrib.gis')\n \n # Custom library path set?\n try:\n     from django.conf import settings\n     lib_path = settings.GDAL_LIBRARY_PATH\n-except (AttributeError, EnvironmentError, ImportError):\n+except (AttributeError, EnvironmentError,\n+        ImportError, ImproperlyConfigured):\n     lib_path = None\n \n if lib_path:\n@@ -65,28 +73,15 @@ def std_call(func):\n \n def gdal_version():\n     \"Returns only the GDAL version number information.\"\n-    return _version_info('RELEASE_NAME')\n+    return _version_info(b'RELEASE_NAME')\n \n def gdal_full_version():\n     \"Returns the full GDAL version information.\"\n     return _version_info('')\n \n-def gdal_release_date(date=False):\n-    \"\"\"\n-    Returns the release date in a string format, e.g, \"2007/06/27\".\n-    If the date keyword argument is set to True, a Python datetime object\n-    will be returned instead.\n-    \"\"\"\n-    from datetime import date as date_type\n-    rel = _version_info('RELEASE_DATE')\n-    yy, mm, dd = map(int, (rel[0:4], rel[4:6], rel[6:8]))\n-    d = date_type(yy, mm, dd)\n-    if date: return d\n-    else: return d.strftime('%Y/%m/%d')\n-\n version_regex = re.compile(r'^(?P<major>\\d+)\\.(?P<minor>\\d+)(\\.(?P<subminor>\\d+))?')\n def gdal_version_info():\n-    ver = gdal_version()\n+    ver = gdal_version().decode()\n     m = version_regex.match(ver)\n     if not m: raise OGRException('Could not parse GDAL version string \"%s\"' % ver)\n     return dict([(key, m.group(key)) for key in ('major', 'minor', 'subminor')])\n@@ -97,3 +92,18 @@ def gdal_version_info():\n GDAL_SUBMINOR_VERSION = _verinfo['subminor'] and int(_verinfo['subminor'])\n GDAL_VERSION = (GDAL_MAJOR_VERSION, GDAL_MINOR_VERSION, GDAL_SUBMINOR_VERSION)\n del _verinfo\n+\n+# Set library error handling so as errors are logged\n+CPLErrorHandler = CFUNCTYPE(None, c_int, c_int, c_char_p)\n+def err_handler(error_class, error_number, message):\n+    logger.error('GDAL_ERROR %d: %s' % (error_number, message))\n+err_handler = CPLErrorHandler(err_handler)\n+\n+def function(name, args, restype):\n+    func = std_call(name)\n+    func.argtypes = args\n+    func.restype = restype\n+    return func\n+\n+set_error_handler = function('CPLSetErrorHandler', [CPLErrorHandler], CPLErrorHandler)\n+set_error_handler(err_handler)"
        },
        {
            "sha": "f798069fd02ba12184a3845e5ee974931500972b",
            "filename": "django/contrib/gis/gdal/prototypes/ds.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fds.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fds.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fds.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -17,7 +17,7 @@\n get_driver = voidptr_output(lgdal.OGRGetDriver, [c_int])\n get_driver_by_name = voidptr_output(lgdal.OGRGetDriverByName, [c_char_p])\n get_driver_count = int_output(lgdal.OGRGetDriverCount, [])\n-get_driver_name = const_string_output(lgdal.OGR_Dr_GetName, [c_void_p])\n+get_driver_name = const_string_output(lgdal.OGR_Dr_GetName, [c_void_p], decoding='ascii')\n \n ### DataSource ###\n open_ds = voidptr_output(lgdal.OGROpen, [c_char_p, c_int, POINTER(c_void_p)])"
        },
        {
            "sha": "2d2791124cb8f1074bf54a4f58c4e22bd0dafd80",
            "filename": "django/contrib/gis/gdal/prototypes/errcheck.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Ferrcheck.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Ferrcheck.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Ferrcheck.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -125,4 +125,4 @@ def check_str_arg(result, func, cargs):\n     \"\"\"\n     dbl = result\n     ptr = cargs[-1]._obj\n-    return dbl, ptr.value\n+    return dbl, ptr.value.decode()"
        },
        {
            "sha": "577d29bbaa009a2c225e6635be64172fc76d2e72",
            "filename": "django/contrib/gis/gdal/prototypes/generation.py",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeneration.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeneration.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeneration.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -57,20 +57,23 @@ def srs_output(func, argtypes):\n     func.errcheck = check_srs\n     return func\n \n-def const_string_output(func, argtypes, offset=None):\n+def const_string_output(func, argtypes, offset=None, decoding=None):\n     func.argtypes = argtypes\n     if offset:\n         func.restype = c_int\n     else:\n         func.restype = c_char_p\n \n     def _check_const(result, func, cargs):\n-        return check_const_string(result, func, cargs, offset=offset)\n+        res = check_const_string(result, func, cargs, offset=offset)\n+        if res and decoding:\n+            res = res.decode(decoding)\n+        return res\n     func.errcheck = _check_const\n \n     return func\n \n-def string_output(func, argtypes, offset=-1, str_result=False):\n+def string_output(func, argtypes, offset=-1, str_result=False, decoding=None):\n     \"\"\"\n     Generates a ctypes prototype for the given function with the\n     given argument types that returns a string from a GDAL pointer.\n@@ -90,8 +93,11 @@ def string_output(func, argtypes, offset=-1, str_result=False):\n     # Dynamically defining our error-checking function with the\n     # given offset.\n     def _check_str(result, func, cargs):\n-        return check_string(result, func, cargs,\n+        res = check_string(result, func, cargs,\n                             offset=offset, str_result=str_result)\n+        if res and decoding:\n+            res = res.decode(decoding)\n+        return res\n     func.errcheck = _check_str\n     return func\n "
        },
        {
            "sha": "fa0b503c65509303087a6858ce12cc6ddc13c5c8",
            "filename": "django/contrib/gis/gdal/prototypes/geom.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeom.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeom.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -27,8 +27,8 @@ def topology_func(f):\n \n # GeoJSON routines.\n from_json = geom_output(lgdal.OGR_G_CreateGeometryFromJson, [c_char_p])\n-to_json = string_output(lgdal.OGR_G_ExportToJson, [c_void_p], str_result=True)\n-to_kml = string_output(lgdal.OGR_G_ExportToKML, [c_void_p, c_char_p], str_result=True)\n+to_json = string_output(lgdal.OGR_G_ExportToJson, [c_void_p], str_result=True, decoding='ascii')\n+to_kml = string_output(lgdal.OGR_G_ExportToKML, [c_void_p, c_char_p], str_result=True, decoding='ascii')\n \n # GetX, GetY, GetZ all return doubles.\n getx = pnt_func(lgdal.OGR_G_GetX)\n@@ -57,8 +57,8 @@ def topology_func(f):\n \n # Geometry export routines.\n to_wkb = void_output(lgdal.OGR_G_ExportToWkb, None, errcheck=True) # special handling for WKB.\n-to_wkt = string_output(lgdal.OGR_G_ExportToWkt, [c_void_p, POINTER(c_char_p)])\n-to_gml = string_output(lgdal.OGR_G_ExportToGML, [c_void_p], str_result=True)\n+to_wkt = string_output(lgdal.OGR_G_ExportToWkt, [c_void_p, POINTER(c_char_p)], decoding='ascii')\n+to_gml = string_output(lgdal.OGR_G_ExportToGML, [c_void_p], str_result=True, decoding='ascii')\n get_wkbsize = int_output(lgdal.OGR_G_WkbSize, [c_void_p])\n \n # Geometry spatial-reference related routines.\n@@ -73,7 +73,7 @@ def topology_func(f):\n set_coord_dim = void_output(lgdal.OGR_G_SetCoordinateDimension, [c_void_p, c_int], errcheck=False)\n \n get_geom_count = int_output(lgdal.OGR_G_GetGeometryCount, [c_void_p])\n-get_geom_name = const_string_output(lgdal.OGR_G_GetGeometryName, [c_void_p])\n+get_geom_name = const_string_output(lgdal.OGR_G_GetGeometryName, [c_void_p], decoding='ascii')\n get_geom_type = int_output(lgdal.OGR_G_GetGeometryType, [c_void_p])\n get_point_count = int_output(lgdal.OGR_G_GetPointCount, [c_void_p])\n get_point = void_output(lgdal.OGR_G_GetPoint, [c_void_p, c_int, POINTER(c_double), POINTER(c_double), POINTER(c_double)], errcheck=False)"
        },
        {
            "sha": "58ceb754562b29697ed3c9ef9708fa0269f132a4",
            "filename": "django/contrib/gis/gdal/prototypes/srs.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fsrs.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fsrs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fsrs.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -49,17 +49,17 @@ def units_func(f):\n angular_units = units_func(lgdal.OSRGetAngularUnits)\n \n # For exporting to WKT, PROJ.4, \"Pretty\" WKT, and XML.\n-to_wkt = string_output(std_call('OSRExportToWkt'), [c_void_p, POINTER(c_char_p)])\n-to_proj = string_output(std_call('OSRExportToProj4'), [c_void_p, POINTER(c_char_p)])\n-to_pretty_wkt = string_output(std_call('OSRExportToPrettyWkt'), [c_void_p, POINTER(c_char_p), c_int], offset=-2)\n+to_wkt = string_output(std_call('OSRExportToWkt'), [c_void_p, POINTER(c_char_p)], decoding='ascii')\n+to_proj = string_output(std_call('OSRExportToProj4'), [c_void_p, POINTER(c_char_p)], decoding='ascii')\n+to_pretty_wkt = string_output(std_call('OSRExportToPrettyWkt'), [c_void_p, POINTER(c_char_p), c_int], offset=-2, decoding='ascii')\n \n # Memory leak fixed in GDAL 1.5; still exists in 1.4.\n-to_xml = string_output(lgdal.OSRExportToXML, [c_void_p, POINTER(c_char_p), c_char_p], offset=-2)\n+to_xml = string_output(lgdal.OSRExportToXML, [c_void_p, POINTER(c_char_p), c_char_p], offset=-2, decoding='ascii')\n \n # String attribute retrival routines.\n-get_attr_value = const_string_output(std_call('OSRGetAttrValue'), [c_void_p, c_char_p, c_int])\n-get_auth_name = const_string_output(lgdal.OSRGetAuthorityName, [c_void_p, c_char_p])\n-get_auth_code = const_string_output(lgdal.OSRGetAuthorityCode, [c_void_p, c_char_p])\n+get_attr_value = const_string_output(std_call('OSRGetAttrValue'), [c_void_p, c_char_p, c_int], decoding='ascii')\n+get_auth_name = const_string_output(lgdal.OSRGetAuthorityName, [c_void_p, c_char_p], decoding='ascii')\n+get_auth_code = const_string_output(lgdal.OSRGetAuthorityCode, [c_void_p, c_char_p], decoding='ascii')\n \n # SRS Properties\n isgeographic = int_output(lgdal.OSRIsGeographic, [c_void_p])"
        },
        {
            "sha": "66a8d4ec932a3fde1a0a739f9bd762e83dcd7b4d",
            "filename": "django/contrib/gis/gdal/srs.py",
            "status": "modified",
            "additions": 13,
            "deletions": 9,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fsrs.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Fsrs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fsrs.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -34,6 +34,8 @@\n from django.contrib.gis.gdal.prototypes import srs as capi\n \n from django.utils import six\n+from django.utils.encoding import force_bytes\n+\n \n #### Spatial Reference class. ####\n class SpatialReference(GDALBase):\n@@ -51,7 +53,6 @@ def __init__(self, srs_input=''):\n         EPSG code, a PROJ.4 string, and/or a projection \"well known\" shorthand\n         string (one of 'WGS84', 'WGS72', 'NAD27', 'NAD83').\n         \"\"\"\n-        buf = c_char_p('')\n         srs_type = 'user'\n \n         if isinstance(srs_input, six.string_types):\n@@ -79,6 +80,7 @@ def __init__(self, srs_input=''):\n             srs = srs_input\n         else:\n             # Creating a new SRS pointer, using the string buffer.\n+            buf = c_char_p(b'')\n             srs = capi.new_srs(buf)\n \n         # If the pointer is NULL, throw an exception.\n@@ -137,15 +139,15 @@ def attr_value(self, target, index=0):\n         \"\"\"\n         if not isinstance(target, six.string_types) or not isinstance(index, int):\n             raise TypeError\n-        return capi.get_attr_value(self.ptr, target, index)\n+        return capi.get_attr_value(self.ptr, force_bytes(target), index)\n \n     def auth_name(self, target):\n         \"Returns the authority name for the given string target node.\"\n-        return capi.get_auth_name(self.ptr, target)\n+        return capi.get_auth_name(self.ptr, force_bytes(target))\n \n     def auth_code(self, target):\n         \"Returns the authority code for the given string target node.\"\n-        return capi.get_auth_code(self.ptr, target)\n+        return capi.get_auth_code(self.ptr, force_bytes(target))\n \n     def clone(self):\n         \"Returns a clone of this SpatialReference object.\"\n@@ -219,12 +221,14 @@ def units(self):\n         and will automatically determines whether to return the linear\n         or angular units.\n         \"\"\"\n+        units, name = None, None\n         if self.projected or self.local:\n-            return capi.linear_units(self.ptr, byref(c_char_p()))\n+            units, name = capi.linear_units(self.ptr, byref(c_char_p()))\n         elif self.geographic:\n-            return capi.angular_units(self.ptr, byref(c_char_p()))\n-        else:\n-            return (None, None)\n+            units, name = capi.angular_units(self.ptr, byref(c_char_p()))\n+        if name is not None:\n+            name.decode()\n+        return (units, name)\n \n     #### Spheroid/Ellipsoid Properties ####\n     @property\n@@ -283,7 +287,7 @@ def import_proj(self, proj):\n \n     def import_user_input(self, user_input):\n         \"Imports the Spatial Reference from the given user input string.\"\n-        capi.from_user_input(self.ptr, user_input)\n+        capi.from_user_input(self.ptr, force_bytes(user_input))\n \n     def import_wkt(self, wkt):\n         \"Imports the Spatial Reference from OGC WKT (string)\""
        },
        {
            "sha": "a87a1c6c353b350ccd9e3ad9acc339b998991539",
            "filename": "django/contrib/gis/gdal/tests/test_ds.py",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_ds.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_ds.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_ds.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,12 +4,13 @@\n from django.contrib.gis.gdal.field import OFTReal, OFTInteger, OFTString\n from django.contrib.gis.geometry.test_data import get_ds_file, TestDS, TEST_DATA\n \n+\n # List of acceptable data sources.\n ds_list = (TestDS('test_point', nfeat=5, nfld=3, geom='POINT', gtype=1, driver='ESRI Shapefile',\n                   fields={'dbl' : OFTReal, 'int' : OFTInteger, 'str' : OFTString,},\n                   extent=(-1.35011,0.166623,-0.524093,0.824508), # Got extent from QGIS\n                   srs_wkt='GEOGCS[\"GCS_WGS_1984\",DATUM[\"WGS_1984\",SPHEROID[\"WGS_1984\",6378137,298.257223563]],PRIMEM[\"Greenwich\",0],UNIT[\"Degree\",0.017453292519943295]]',\n-                  field_values={'dbl' : [float(i) for i in range(1, 6)], 'int' : range(1, 6), 'str' : [str(i) for i in range(1, 6)]},\n+                  field_values={'dbl' : [float(i) for i in range(1, 6)], 'int' : list(range(1, 6)), 'str' : [str(i) for i in range(1, 6)]},\n                   fids=range(5)),\n            TestDS('test_vrt', ext='vrt', nfeat=3, nfld=3, geom='POINT', gtype='Point25D', driver='VRT',\n                   fields={'POINT_X' : OFTString, 'POINT_Y' : OFTString, 'NUM' : OFTString}, # VRT uses CSV, which all types are OFTString.\n@@ -59,7 +60,6 @@ def test02_invalid_shp(self):\n \n     def test03a_layers(self):\n         \"Testing Data Source Layers.\"\n-        print(\"\\nBEGIN - expecting out of range feature id error; safe to ignore.\\n\")\n         for source in ds_list:\n             ds = DataSource(source.ds)\n \n@@ -108,7 +108,6 @@ def test03a_layers(self):\n                         # the feature values here while in this loop.\n                         for fld_name in fld_names:\n                             self.assertEqual(source.field_values[fld_name][i], feat.get(fld_name))\n-        print(\"\\nEND - expecting out of range feature id error; safe to ignore.\")\n \n     def test03b_layer_slice(self):\n         \"Test indexing and slicing on Layers.\"\n@@ -126,7 +125,9 @@ def test03b_layer_slice(self):\n             self.assertEqual(control_vals, test_vals)\n \n     def test03c_layer_references(self):\n-        \"Test to make sure Layer access is still available without the DataSource.\"\n+        \"\"\"\n+        Ensure OGR objects keep references to the objects they belong to.\n+        \"\"\"\n         source = ds_list[0]\n \n         # See ticket #9448.\n@@ -142,6 +143,9 @@ def get_layer():\n         self.assertEqual(source.nfeat, len(lyr))\n         self.assertEqual(source.gtype, lyr.geom_type.num)\n \n+        # Same issue for Feature/Field objects, see #18640\n+        self.assertEqual(str(lyr[0]['str']), \"1\")\n+\n     def test04_features(self):\n         \"Testing Data Source Features.\"\n         for source in ds_list:\n@@ -163,7 +167,8 @@ def test04_features(self):\n                         self.assertEqual(True, isinstance(feat[k], v))\n \n                     # Testing Feature.__iter__\n-                    for fld in feat: self.assertEqual(True, fld.name in source.fields.keys())\n+                    for fld in feat:\n+                        self.assertEqual(True, fld.name in source.fields.keys())\n \n     def test05_geometries(self):\n         \"Testing Geometries from Data Source Features.\"\n@@ -200,7 +205,7 @@ def test06_spatial_filter(self):\n \n         # Setting the spatial filter with a tuple/list with the extent of\n         # a buffer centering around Pueblo.\n-        self.assertRaises(ValueError, lyr._set_spatial_filter, range(5))\n+        self.assertRaises(ValueError, lyr._set_spatial_filter, list(range(5)))\n         filter_extent = (-105.609252, 37.255001, -103.609252, 39.255001)\n         lyr.spatial_filter = (-105.609252, 37.255001, -103.609252, 39.255001)\n         self.assertEqual(OGRGeometry.from_bbox(filter_extent), lyr.spatial_filter)"
        },
        {
            "sha": "9b8ae6a26ba439b649fd7548c7cba07aa90458b0",
            "filename": "django/contrib/gis/gdal/tests/test_geom.py",
            "status": "modified",
            "additions": 4,
            "deletions": 11,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -92,7 +92,7 @@ def test01c_hex(self):\n         \"Testing HEX input/output.\"\n         for g in self.geometries.hex_wkt:\n             geom1 = OGRGeometry(g.wkt)\n-            self.assertEqual(g.hex, geom1.hex)\n+            self.assertEqual(g.hex.encode(), geom1.hex)\n             # Constructing w/HEX\n             geom2 = OGRGeometry(g.hex)\n             self.assertEqual(geom1, geom2)\n@@ -102,7 +102,7 @@ def test01d_wkb(self):\n         for g in self.geometries.hex_wkt:\n             geom1 = OGRGeometry(g.wkt)\n             wkb = geom1.wkb\n-            self.assertEqual(b2a_hex(wkb).upper(), g.hex)\n+            self.assertEqual(b2a_hex(wkb).upper(), g.hex.encode())\n             # Constructing w/WKB.\n             geom2 = OGRGeometry(wkb)\n             self.assertEqual(geom1, geom2)\n@@ -235,15 +235,8 @@ def test07b_closepolygons(self):\n         # Both rings in this geometry are not closed.\n         poly = OGRGeometry('POLYGON((0 0, 5 0, 5 5, 0 5), (1 1, 2 1, 2 2, 2 1))')\n         self.assertEqual(8, poly.point_count)\n-        print(\"\\nBEGIN - expecting IllegalArgumentException; safe to ignore.\\n\")\n-        try:\n-            c = poly.centroid\n-        except OGRException:\n-            # Should raise an OGR exception, rings are not closed\n-            pass\n-        else:\n-            self.fail('Should have raised an OGRException!')\n-        print(\"\\nEND - expecting IllegalArgumentException; safe to ignore.\\n\")\n+        with self.assertRaises(OGRException):\n+            _ = poly.centroid\n \n         poly.close_rings()\n         self.assertEqual(10, poly.point_count) # Two closing points should've been added"
        },
        {
            "sha": "b0f6e1ad5761ddaa7f1e0c914365599bc640067c",
            "filename": "django/contrib/gis/geometry/test_data.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -2,7 +2,6 @@\n This module has the mock object definitions used to hold reference geometry\n for the GEOS and GDAL tests.\n \"\"\"\n-import gzip\n import json\n import os\n \n@@ -100,7 +99,7 @@ def geometries(self):\n         global GEOMETRIES\n         if GEOMETRIES is None:\n             # Load up the test geometry data from fixture into global.\n-            gzf = gzip.GzipFile(os.path.join(TEST_DATA, 'geometries.json.gz'))\n-            geometries = json.loads(gzf.read())\n+            with open(os.path.join(TEST_DATA, 'geometries.json')) as f:\n+                geometries = json.load(f)\n             GEOMETRIES = TestGeomSet(**strconvert(geometries))\n         return GEOMETRIES"
        },
        {
            "sha": "2e5fa4f331adc27dc94a46392f08c6a7f6ab2001",
            "filename": "django/contrib/gis/geos/factory.py",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,7 +1,9 @@\n+from django.contrib.gis import memoryview\n from django.contrib.gis.geos.geometry import GEOSGeometry, wkt_regex, hex_regex\n \n from django.utils import six\n \n+\n def fromfile(file_h):\n     \"\"\"\n     Given a string file name, returns a GEOSGeometry. The file may contain WKB,\n@@ -14,11 +16,19 @@ def fromfile(file_h):\n     else:\n         buf = file_h.read()\n \n-    # If we get WKB need to wrap in buffer(), so run through regexes.\n-    if wkt_regex.match(buf) or hex_regex.match(buf):\n-        return GEOSGeometry(buf)\n+    # If we get WKB need to wrap in memoryview(), so run through regexes.\n+    if isinstance(buf, bytes):\n+        try:\n+            decoded = buf.decode()\n+            if wkt_regex.match(decoded) or hex_regex.match(decoded):\n+                return GEOSGeometry(decoded)\n+        except UnicodeDecodeError:\n+            pass\n     else:\n-        return GEOSGeometry(buffer(buf))\n+        return GEOSGeometry(buf)\n+\n+    return GEOSGeometry(memoryview(buf))\n+\n \n def fromstr(string, **kwargs):\n     \"Given a string value, returns a GEOSGeometry object.\""
        },
        {
            "sha": "df396bdbd3a70d2560e62d3b0c98555636e11059",
            "filename": "django/contrib/gis/geos/geometry.py",
            "status": "modified",
            "additions": 67,
            "deletions": 39,
            "changes": 106,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Fgeometry.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Fgeometry.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fgeometry.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -2,9 +2,12 @@\n  This module contains the 'base' GEOSGeometry object -- all GEOS Geometries\n  inherit from this object.\n \"\"\"\n+from __future__ import unicode_literals\n+\n # Python, ctypes and types dependencies.\n from ctypes import addressof, byref, c_double\n \n+from django.contrib.gis import memoryview\n # super-class for mutable list behavior\n from django.contrib.gis.geos.mutable_list import ListMixin\n \n@@ -22,12 +25,14 @@\n \n # These functions provide access to a thread-local instance\n # of their corresponding GEOS I/O class.\n-from django.contrib.gis.geos.prototypes.io import wkt_r, wkt_w, wkb_r, wkb_w, ewkb_w, ewkb_w3d\n+from django.contrib.gis.geos.prototypes.io import wkt_r, wkt_w, wkb_r, wkb_w, ewkb_w\n \n # For recognizing geometry input.\n from django.contrib.gis.geometry.regex import hex_regex, wkt_regex, json_regex\n \n from django.utils import six\n+from django.utils.encoding import force_bytes, force_text\n+\n \n class GEOSGeometry(GEOSBase, ListMixin):\n     \"A class that, generally, encapsulates a GEOS geometry.\"\n@@ -54,19 +59,17 @@ def __init__(self, geo_input, srid=None):\n         The `srid` keyword is used to specify the Source Reference Identifier\n         (SRID) number for this Geometry.  If not set, the SRID will be None.\n         \"\"\"\n+        if isinstance(geo_input, bytes):\n+            geo_input = force_text(geo_input)\n         if isinstance(geo_input, six.string_types):\n-            if isinstance(geo_input, six.text_type):\n-                # Encoding to ASCII, WKT or HEXEWKB doesn't need any more.\n-                geo_input = geo_input.encode('ascii')\n-\n             wkt_m = wkt_regex.match(geo_input)\n             if wkt_m:\n                 # Handling WKT input.\n                 if wkt_m.group('srid'): srid = int(wkt_m.group('srid'))\n-                g = wkt_r().read(wkt_m.group('wkt'))\n+                g = wkt_r().read(force_bytes(wkt_m.group('wkt')))\n             elif hex_regex.match(geo_input):\n                 # Handling HEXEWKB input.\n-                g = wkb_r().read(geo_input)\n+                g = wkb_r().read(force_bytes(geo_input))\n             elif gdal.HAS_GDAL and json_regex.match(geo_input):\n                 # Handling GeoJSON input.\n                 g = wkb_r().read(gdal.OGRGeometry(geo_input).wkb)\n@@ -75,7 +78,7 @@ def __init__(self, geo_input, srid=None):\n         elif isinstance(geo_input, GEOM_PTR):\n             # When the input is a pointer to a geomtry (GEOM_PTR).\n             g = geo_input\n-        elif isinstance(geo_input, buffer):\n+        elif isinstance(geo_input, memoryview):\n             # When the input is a buffer (WKB).\n             g = wkb_r().read(geo_input)\n         elif isinstance(geo_input, GEOSGeometry):\n@@ -139,12 +142,12 @@ def __repr__(self):\n     def __getstate__(self):\n         # The pickled state is simply a tuple of the WKB (in string form)\n         # and the SRID.\n-        return str(self.wkb), self.srid\n+        return bytes(self.wkb), self.srid\n \n     def __setstate__(self, state):\n         # Instantiating from the tuple state that was pickled.\n         wkb, srid = state\n-        ptr = wkb_r().read(buffer(wkb))\n+        ptr = wkb_r().read(memoryview(wkb))\n         if not ptr: raise GEOSException('Invalid Geometry loaded from pickled state.')\n         self.ptr = ptr\n         self._post_init(srid)\n@@ -216,7 +219,7 @@ def coord_seq(self):\n     @property\n     def geom_type(self):\n         \"Returns a string representing the Geometry type, e.g. 'Polygon'\"\n-        return capi.geos_type(self.ptr)\n+        return capi.geos_type(self.ptr).decode()\n \n     @property\n     def geom_typeid(self):\n@@ -283,7 +286,7 @@ def valid_reason(self):\n         \"\"\"\n         if not GEOS_PREPARE:\n             raise GEOSException('Upgrade GEOS to 3.1 to get validity reason.')\n-        return capi.geos_isvalidreason(self.ptr)\n+        return capi.geos_isvalidreason(self.ptr).decode()\n \n     #### Binary predicates. ####\n     def contains(self, other):\n@@ -337,7 +340,7 @@ def relate_pattern(self, other, pattern):\n         \"\"\"\n         if not isinstance(pattern, six.string_types) or len(pattern) > 9:\n             raise GEOSException('invalid intersection matrix pattern')\n-        return capi.geos_relatepattern(self.ptr, other.ptr, pattern)\n+        return capi.geos_relatepattern(self.ptr, other.ptr, force_bytes(pattern))\n \n     def touches(self, other):\n         \"\"\"\n@@ -379,34 +382,30 @@ def ewkt(self):\n     @property\n     def wkt(self):\n         \"Returns the WKT (Well-Known Text) representation of this Geometry.\"\n-        return wkt_w().write(self)\n+        return wkt_w().write(self).decode()\n \n     @property\n     def hex(self):\n         \"\"\"\n         Returns the WKB of this Geometry in hexadecimal form.  Please note\n-        that the SRID and Z values are not included in this representation\n-        because it is not a part of the OGC specification (use the `hexewkb`\n-        property instead).\n+        that the SRID is not included in this representation because it is not\n+        a part of the OGC specification (use the `hexewkb` property instead).\n         \"\"\"\n         # A possible faster, all-python, implementation:\n         #  str(self.wkb).encode('hex')\n-        return wkb_w().write_hex(self)\n+        return wkb_w(self.hasz and 3 or 2).write_hex(self)\n \n     @property\n     def hexewkb(self):\n         \"\"\"\n         Returns the EWKB of this Geometry in hexadecimal form.  This is an\n-        extension of the WKB specification that includes SRID and Z values\n-        that are a part of this geometry.\n-        \"\"\"\n-        if self.hasz:\n-            if not GEOS_PREPARE:\n-                # See: http://trac.osgeo.org/geos/ticket/216\n-                raise GEOSException('Upgrade GEOS to 3.1 to get valid 3D HEXEWKB.')\n-            return ewkb_w3d().write_hex(self)\n-        else:\n-            return ewkb_w().write_hex(self)\n+        extension of the WKB specification that includes SRID value that are\n+        a part of this geometry.\n+        \"\"\"\n+        if self.hasz and not GEOS_PREPARE:\n+            # See: http://trac.osgeo.org/geos/ticket/216\n+            raise GEOSException('Upgrade GEOS to 3.1 to get valid 3D HEXEWKB.')\n+        return ewkb_w(self.hasz and 3 or 2).write_hex(self)\n \n     @property\n     def json(self):\n@@ -426,22 +425,19 @@ def wkb(self):\n         as a Python buffer.  SRID and Z values are not included, use the\n         `ewkb` property instead.\n         \"\"\"\n-        return wkb_w().write(self)\n+        return wkb_w(self.hasz and 3 or 2).write(self)\n \n     @property\n     def ewkb(self):\n         \"\"\"\n         Return the EWKB representation of this Geometry as a Python buffer.\n         This is an extension of the WKB specification that includes any SRID\n-        and Z values that are a part of this geometry.\n+        value that are a part of this geometry.\n         \"\"\"\n-        if self.hasz:\n-            if not GEOS_PREPARE:\n-                # See: http://trac.osgeo.org/geos/ticket/216\n-                raise GEOSException('Upgrade GEOS to 3.1 to get valid 3D EWKB.')\n-            return ewkb_w3d().write(self)\n-        else:\n-            return ewkb_w().write(self)\n+        if self.hasz and not GEOS_PREPARE:\n+            # See: http://trac.osgeo.org/geos/ticket/216\n+            raise GEOSException('Upgrade GEOS to 3.1 to get valid 3D EWKB.')\n+        return ewkb_w(self.hasz and 3 or 2).write(self)\n \n     @property\n     def kml(self):\n@@ -513,7 +509,7 @@ def transform(self, ct, clone=False):\n             raise GEOSException(\"GDAL library is not available to transform() geometry.\")\n \n         # Creating an OGR Geometry, which is then transformed.\n-        g = gdal.OGRGeometry(self.wkb, srid)\n+        g = self.ogr\n         g.transform(ct)\n         # Getting a new GEOS pointer\n         ptr = wkb_r().read(g.wkb)\n@@ -578,6 +574,20 @@ def envelope(self):\n         \"Return the envelope for this geometry (a polygon).\"\n         return self._topology(capi.geos_envelope(self.ptr))\n \n+    def interpolate(self, distance):\n+        if not isinstance(self, (LineString, MultiLineString)):\n+            raise TypeError('interpolate only works on LineString and MultiLineString geometries')\n+        if not hasattr(capi, 'geos_interpolate'):\n+            raise NotImplementedError('interpolate requires GEOS 3.2+')\n+        return self._topology(capi.geos_interpolate(self.ptr, distance))\n+\n+    def interpolate_normalized(self, distance):\n+        if not isinstance(self, (LineString, MultiLineString)):\n+            raise TypeError('interpolate only works on LineString and MultiLineString geometries')\n+        if not hasattr(capi, 'geos_interpolate_normalized'):\n+            raise NotImplementedError('interpolate_normalized requires GEOS 3.2+')\n+        return self._topology(capi.geos_interpolate_normalized(self.ptr, distance))\n+\n     def intersection(self, other):\n         \"Returns a Geometry representing the points shared by this Geometry and other.\"\n         return self._topology(capi.geos_intersection(self.ptr, other.ptr))\n@@ -587,9 +597,27 @@ def point_on_surface(self):\n         \"Computes an interior point of this Geometry.\"\n         return self._topology(capi.geos_pointonsurface(self.ptr))\n \n+    def project(self, point):\n+        if not isinstance(point, Point):\n+            raise TypeError('locate_point argument must be a Point')\n+        if not isinstance(self, (LineString, MultiLineString)):\n+            raise TypeError('locate_point only works on LineString and MultiLineString geometries')\n+        if not hasattr(capi, 'geos_project'):\n+            raise NotImplementedError('geos_project requires GEOS 3.2+')\n+        return capi.geos_project(self.ptr, point.ptr)\n+\n+    def project_normalized(self, point):\n+        if not isinstance(point, Point):\n+            raise TypeError('locate_point argument must be a Point')\n+        if not isinstance(self, (LineString, MultiLineString)):\n+            raise TypeError('locate_point only works on LineString and MultiLineString geometries')\n+        if not hasattr(capi, 'geos_project_normalized'):\n+            raise NotImplementedError('project_normalized requires GEOS 3.2+')\n+        return capi.geos_project_normalized(self.ptr, point.ptr)\n+\n     def relate(self, other):\n         \"Returns the DE-9IM intersection matrix for this Geometry and the other.\"\n-        return capi.geos_relate(self.ptr, other.ptr)\n+        return capi.geos_relate(self.ptr, other.ptr).decode()\n \n     def simplify(self, tolerance=0.0, preserve_topology=False):\n         \"\"\""
        },
        {
            "sha": "f011208ea06d7fdfeee920e88874c04390f738d4",
            "filename": "django/contrib/gis/geos/libgeos.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -6,18 +6,23 @@\n  This module also houses GEOS Pointer utilities, including\n  get_pointer_arr(), and GEOM_PTR.\n \"\"\"\n+import logging\n import os\n import re\n-import sys\n from ctypes import c_char_p, Structure, CDLL, CFUNCTYPE, POINTER\n from ctypes.util import find_library\n+\n from django.contrib.gis.geos.error import GEOSException\n+from django.core.exceptions import ImproperlyConfigured\n+\n+logger = logging.getLogger('django.contrib.gis')\n \n # Custom library path set?\n try:\n     from django.conf import settings\n     lib_path = settings.GEOS_LIBRARY_PATH\n-except (AttributeError, EnvironmentError, ImportError):\n+except (AttributeError, EnvironmentError,\n+        ImportError, ImproperlyConfigured):\n     lib_path = None\n \n # Setting the appropriate names for the GEOS-C library.\n@@ -56,21 +61,23 @@\n # Supposed to mimic the GEOS message handler (C below):\n #  typedef void (*GEOSMessageHandler)(const char *fmt, ...);\n NOTICEFUNC = CFUNCTYPE(None, c_char_p, c_char_p)\n-def notice_h(fmt, lst, output_h=sys.stdout):\n+def notice_h(fmt, lst):\n+    fmt, lst = fmt.decode(), lst.decode()\n     try:\n         warn_msg = fmt % lst\n     except:\n         warn_msg = fmt\n-    output_h.write('GEOS_NOTICE: %s\\n' % warn_msg)\n+    logger.warn('GEOS_NOTICE: %s\\n' % warn_msg)\n notice_h = NOTICEFUNC(notice_h)\n \n ERRORFUNC = CFUNCTYPE(None, c_char_p, c_char_p)\n-def error_h(fmt, lst, output_h=sys.stderr):\n+def error_h(fmt, lst):\n+    fmt, lst = fmt.decode(), lst.decode()\n     try:\n         err_msg = fmt % lst\n     except:\n         err_msg = fmt\n-    output_h.write('GEOS_ERROR: %s\\n' % err_msg)\n+    logger.error('GEOS_ERROR: %s\\n' % err_msg)\n error_h = ERRORFUNC(error_h)\n \n #### GEOS Geometry C data structures, and utility functions. ####"
        },
        {
            "sha": "1be7da88451e9532beeec19908470da4f948ed29",
            "filename": "django/contrib/gis/geos/prototypes/io.py",
            "status": "modified",
            "additions": 15,
            "deletions": 18,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fio.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fio.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fio.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,12 +1,14 @@\n import threading\n from ctypes import byref, c_char_p, c_int, c_char, c_size_t, Structure, POINTER\n+from django.contrib.gis import memoryview\n from django.contrib.gis.geos.base import GEOSBase\n from django.contrib.gis.geos.libgeos import GEOM_PTR\n from django.contrib.gis.geos.prototypes.errcheck import check_geom, check_string, check_sized_string\n from django.contrib.gis.geos.prototypes.geom import c_uchar_p, geos_char_p\n from django.contrib.gis.geos.prototypes.threadsafe import GEOSFunc\n \n from django.utils import six\n+from django.utils.encoding import force_bytes\n \n ### The WKB/WKT Reader/Writer structures and pointers ###\n class WKTReader_st(Structure): pass\n@@ -120,8 +122,9 @@ class _WKTReader(IOBase):\n     ptr_type = WKT_READ_PTR\n \n     def read(self, wkt):\n-        if not isinstance(wkt, six.string_types): raise TypeError\n-        return wkt_reader_read(self.ptr, wkt)\n+        if not isinstance(wkt, (bytes, six.string_types)):\n+            raise TypeError\n+        return wkt_reader_read(self.ptr, force_bytes(wkt))\n \n class _WKBReader(IOBase):\n     _constructor = wkb_reader_create\n@@ -130,10 +133,10 @@ class _WKBReader(IOBase):\n \n     def read(self, wkb):\n         \"Returns a _pointer_ to C GEOS Geometry object from the given WKB.\"\n-        if isinstance(wkb, buffer):\n-            wkb_s = str(wkb)\n+        if isinstance(wkb, memoryview):\n+            wkb_s = bytes(wkb)\n             return wkb_reader_read(self.ptr, wkb_s, len(wkb_s))\n-        elif isinstance(wkb, six.string_types):\n+        elif isinstance(wkb, (bytes, six.string_types)):\n             return wkb_reader_read_hex(self.ptr, wkb, len(wkb))\n         else:\n             raise TypeError\n@@ -155,7 +158,7 @@ class WKBWriter(IOBase):\n \n     def write(self, geom):\n         \"Returns the WKB representation of the given geometry.\"\n-        return buffer(wkb_writer_write(self.ptr, geom.ptr, byref(c_size_t())))\n+        return memoryview(wkb_writer_write(self.ptr, geom.ptr, byref(c_size_t())))\n \n     def write_hex(self, geom):\n         \"Returns the HEXEWKB representation of the given geometry.\"\n@@ -188,8 +191,8 @@ def _get_include_srid(self):\n         return bool(ord(wkb_writer_get_include_srid(self.ptr)))\n \n     def _set_include_srid(self, include):\n-        if bool(include): flag = chr(1)\n-        else: flag = chr(0)\n+        if bool(include): flag = b'\\x01'\n+        else: flag = b'\\x00'\n         wkb_writer_set_include_srid(self.ptr, flag)\n \n     srid = property(_get_include_srid, _set_include_srid)\n@@ -204,7 +207,6 @@ class ThreadLocalIO(threading.local):\n     wkb_r = None\n     wkb_w = None\n     ewkb_w = None\n-    ewkb_w3d = None\n \n thread_context = ThreadLocalIO()\n \n@@ -225,20 +227,15 @@ def wkb_r():\n         thread_context.wkb_r = _WKBReader()\n     return thread_context.wkb_r\n \n-def wkb_w():\n+def wkb_w(dim=2):\n    if not thread_context.wkb_w:\n        thread_context.wkb_w = WKBWriter()\n+   thread_context.wkb_w.outdim = dim\n    return thread_context.wkb_w\n \n-def ewkb_w():\n+def ewkb_w(dim=2):\n     if not thread_context.ewkb_w:\n         thread_context.ewkb_w = WKBWriter()\n         thread_context.ewkb_w.srid = True\n+    thread_context.ewkb_w.outdim = dim\n     return thread_context.ewkb_w\n-\n-def ewkb_w3d():\n-    if not thread_context.ewkb_w3d:\n-        thread_context.ewkb_w3d = WKBWriter()\n-        thread_context.ewkb_w3d.srid = True\n-        thread_context.ewkb_w3d.outdim = 3\n-    return thread_context.ewkb_w3d"
        },
        {
            "sha": "dfea3e98b628fffa664630a5eb94b212af4e19ca",
            "filename": "django/contrib/gis/geos/prototypes/topology.py",
            "status": "modified",
            "additions": 18,
            "deletions": 5,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Ftopology.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Ftopology.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Ftopology.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -8,18 +8,18 @@\n            'geos_simplify', 'geos_symdifference', 'geos_union', 'geos_relate']\n \n from ctypes import c_double, c_int\n-from django.contrib.gis.geos.libgeos import GEOM_PTR, GEOS_PREPARE\n-from django.contrib.gis.geos.prototypes.errcheck import check_geom, check_string\n+from django.contrib.gis.geos.libgeos import geos_version_info, GEOM_PTR, GEOS_PREPARE\n+from django.contrib.gis.geos.prototypes.errcheck import check_geom, check_minus_one, check_string\n from django.contrib.gis.geos.prototypes.geom import geos_char_p\n from django.contrib.gis.geos.prototypes.threadsafe import GEOSFunc\n \n-def topology(func, *args):\n+def topology(func, *args, **kwargs):\n     \"For GEOS unary topology functions.\"\n     argtypes = [GEOM_PTR]\n     if args: argtypes += args\n     func.argtypes = argtypes\n-    func.restype = GEOM_PTR\n-    func.errcheck = check_geom\n+    func.restype = kwargs.get('restype', GEOM_PTR)\n+    func.errcheck = kwargs.get('errcheck', check_geom)\n     return func\n \n ### Topology Routines ###\n@@ -49,3 +49,16 @@ def topology(func, *args):\n     geos_cascaded_union.argtypes = [GEOM_PTR]\n     geos_cascaded_union.restype = GEOM_PTR\n     __all__.append('geos_cascaded_union')\n+\n+# Linear referencing routines\n+info = geos_version_info()\n+if info['version'] >= '3.2.0':\n+    geos_project = topology(GEOSFunc('GEOSProject'), GEOM_PTR,\n+        restype=c_double, errcheck=check_minus_one)\n+    geos_interpolate = topology(GEOSFunc('GEOSInterpolate'), c_double)\n+\n+    geos_project_normalized = topology(GEOSFunc('GEOSProjectNormalized'),\n+        GEOM_PTR, restype=c_double, errcheck=check_minus_one)\n+    geos_interpolate_normalized = topology(GEOSFunc('GEOSInterpolateNormalized'), c_double)\n+    __all__.extend(['geos_project', 'geos_interpolate',\n+        'geos_project_normalized', 'geos_interpolate_normalized'])"
        },
        {
            "sha": "283daa47c0e4f755f082215b98fe4c3f719278e6",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 67,
            "deletions": 42,
            "changes": 109,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,14 +1,20 @@\n+from __future__ import unicode_literals\n+\n import ctypes\n import json\n import random\n+from binascii import a2b_hex, b2a_hex\n+from io import BytesIO\n \n+from django.contrib.gis import memoryview\n from django.contrib.gis.geos import (GEOSException, GEOSIndexError, GEOSGeometry,\n     GeometryCollection, Point, MultiPoint, Polygon, MultiPolygon, LinearRing,\n     LineString, MultiLineString, fromfile, fromstr, geos_version_info)\n from django.contrib.gis.geos.base import gdal, numpy, GEOSBase\n from django.contrib.gis.geos.libgeos import GEOS_PREPARE\n from django.contrib.gis.geometry.test_data import TestDataMixin\n \n+from django.utils.encoding import force_bytes\n from django.utils import six\n from django.utils.six.moves import xrange\n from django.utils import unittest\n@@ -64,7 +70,7 @@ class FakeGeom2(GEOSBase):\n         # result in a TypeError when trying to assign it to the `ptr` property.\n         # Thus, memmory addresses (integers) and pointers of the incorrect type\n         # (in `bad_ptrs`) will not be allowed.\n-        bad_ptrs = (5, ctypes.c_char_p('foobar'))\n+        bad_ptrs = (5, ctypes.c_char_p(b'foobar'))\n         for bad_ptr in bad_ptrs:\n             # Equivalent to `fg.ptr = bad_ptr`\n             self.assertRaises(TypeError, fg1._set_ptr, bad_ptr)\n@@ -80,25 +86,24 @@ def test_hex(self):\n         \"Testing HEX output.\"\n         for g in self.geometries.hex_wkt:\n             geom = fromstr(g.wkt)\n-            self.assertEqual(g.hex, geom.hex)\n+            self.assertEqual(g.hex, geom.hex.decode())\n \n     def test_hexewkb(self):\n         \"Testing (HEX)EWKB output.\"\n-        from binascii import a2b_hex\n-\n         # For testing HEX(EWKB).\n-        ogc_hex = '01010000000000000000000000000000000000F03F'\n+        ogc_hex = b'01010000000000000000000000000000000000F03F'\n+        ogc_hex_3d = b'01010000800000000000000000000000000000F03F0000000000000040'\n         # `SELECT ST_AsHEXEWKB(ST_GeomFromText('POINT(0 1)', 4326));`\n-        hexewkb_2d = '0101000020E61000000000000000000000000000000000F03F'\n+        hexewkb_2d = b'0101000020E61000000000000000000000000000000000F03F'\n         # `SELECT ST_AsHEXEWKB(ST_GeomFromEWKT('SRID=4326;POINT(0 1 2)'));`\n-        hexewkb_3d = '01010000A0E61000000000000000000000000000000000F03F0000000000000040'\n+        hexewkb_3d = b'01010000A0E61000000000000000000000000000000000F03F0000000000000040'\n \n         pnt_2d = Point(0, 1, srid=4326)\n         pnt_3d = Point(0, 1, 2, srid=4326)\n \n-        # OGC-compliant HEX will not have SRID nor Z value.\n+        # OGC-compliant HEX will not have SRID value.\n         self.assertEqual(ogc_hex, pnt_2d.hex)\n-        self.assertEqual(ogc_hex, pnt_3d.hex)\n+        self.assertEqual(ogc_hex_3d, pnt_3d.hex)\n \n         # HEXEWKB should be appropriate for its dimension -- have to use an\n         # a WKBWriter w/dimension set accordingly, else GEOS will insert\n@@ -118,9 +123,9 @@ def test_hexewkb(self):\n                 self.fail('Should have raised GEOSException.')\n \n         # Same for EWKB.\n-        self.assertEqual(buffer(a2b_hex(hexewkb_2d)), pnt_2d.ewkb)\n+        self.assertEqual(memoryview(a2b_hex(hexewkb_2d)), pnt_2d.ewkb)\n         if GEOS_PREPARE:\n-            self.assertEqual(buffer(a2b_hex(hexewkb_3d)), pnt_3d.ewkb)\n+            self.assertEqual(memoryview(a2b_hex(hexewkb_3d)), pnt_3d.ewkb)\n         else:\n             try:\n                 ewkb = pnt_3d.ewkb\n@@ -142,17 +147,12 @@ def test_kml(self):\n     def test_errors(self):\n         \"Testing the Error handlers.\"\n         # string-based\n-        print(\"\\nBEGIN - expecting GEOS_ERROR; safe to ignore.\\n\")\n         for err in self.geometries.errors:\n-            try:\n-                g = fromstr(err.wkt)\n-            except (GEOSException, ValueError):\n-                pass\n+            with self.assertRaises((GEOSException, ValueError)):\n+                _ = fromstr(err.wkt)\n \n         # Bad WKB\n-        self.assertRaises(GEOSException, GEOSGeometry, buffer('0'))\n-\n-        print(\"\\nEND - expecting GEOS_ERROR; safe to ignore.\\n\")\n+        self.assertRaises(GEOSException, GEOSGeometry, memoryview(b'0'))\n \n         class NotAGeometry(object):\n             pass\n@@ -164,11 +164,10 @@ class NotAGeometry(object):\n \n     def test_wkb(self):\n         \"Testing WKB output.\"\n-        from binascii import b2a_hex\n         for g in self.geometries.hex_wkt:\n             geom = fromstr(g.wkt)\n             wkb = geom.wkb\n-            self.assertEqual(b2a_hex(wkb).upper(), g.hex)\n+            self.assertEqual(b2a_hex(wkb).decode().upper(), g.hex)\n \n     def test_create_hex(self):\n         \"Testing creation from HEX.\"\n@@ -180,9 +179,8 @@ def test_create_hex(self):\n \n     def test_create_wkb(self):\n         \"Testing creation from WKB.\"\n-        from binascii import a2b_hex\n         for g in self.geometries.hex_wkt:\n-            wkb = buffer(a2b_hex(g.hex))\n+            wkb = memoryview(a2b_hex(g.hex.encode()))\n             geom_h = GEOSGeometry(wkb)\n             # we need to do this so decimal places get normalised\n             geom_t = fromstr(g.wkt)\n@@ -212,13 +210,12 @@ def test_json(self):\n \n     def test_fromfile(self):\n         \"Testing the fromfile() factory.\"\n-        from io import BytesIO\n         ref_pnt = GEOSGeometry('POINT(5 23)')\n \n         wkt_f = BytesIO()\n-        wkt_f.write(ref_pnt.wkt)\n+        wkt_f.write(force_bytes(ref_pnt.wkt))\n         wkb_f = BytesIO()\n-        wkb_f.write(str(ref_pnt.wkb))\n+        wkb_f.write(bytes(ref_pnt.wkb))\n \n         # Other tests use `fromfile()` on string filenames so those\n         # aren't tested here.\n@@ -439,8 +436,8 @@ def test_polygons(self):\n                 self.assertEqual(r.geom_typeid, 2)\n \n             # Testing polygon construction.\n-            self.assertRaises(TypeError, Polygon.__init__, 0, [1, 2, 3])\n-            self.assertRaises(TypeError, Polygon.__init__, 'foo')\n+            self.assertRaises(TypeError, Polygon, 0, [1, 2, 3])\n+            self.assertRaises(TypeError, Polygon, 'foo')\n \n             # Polygon(shell, (hole1, ... holeN))\n             rings = tuple(r for r in poly)\n@@ -456,7 +453,6 @@ def test_polygons(self):\n \n     def test_multipolygons(self):\n         \"Testing MultiPolygon objects.\"\n-        print(\"\\nBEGIN - expecting GEOS_NOTICE; safe to ignore.\\n\")\n         prev = fromstr('POINT (0 0)')\n         for mp in self.geometries.multipolygons:\n             mpoly = fromstr(mp.wkt)\n@@ -475,8 +471,6 @@ def test_multipolygons(self):\n                     self.assertEqual(p.valid, True)\n                 self.assertEqual(mpoly.wkt, MultiPolygon(*tuple(poly.clone() for poly in mpoly)).wkt)\n \n-        print(\"\\nEND - expecting GEOS_NOTICE; safe to ignore.\\n\")\n-\n     def test_memory_hijinks(self):\n         \"Testing Geometry __del__() on rings and polygons.\"\n         #### Memory issues with rings and polygons\n@@ -829,12 +823,17 @@ def test_collections_of_collections(self):\n     def test_gdal(self):\n         \"Testing `ogr` and `srs` properties.\"\n         g1 = fromstr('POINT(5 23)')\n-        self.assertEqual(True, isinstance(g1.ogr, gdal.OGRGeometry))\n-        self.assertEqual(g1.srs, None)\n+        self.assertIsInstance(g1.ogr, gdal.OGRGeometry)\n+        self.assertIsNone(g1.srs)\n+\n+        if GEOS_PREPARE:\n+            g1_3d = fromstr('POINT(5 23 8)')\n+            self.assertIsInstance(g1_3d.ogr, gdal.OGRGeometry)\n+            self.assertEqual(g1_3d.ogr.z, 8)\n \n         g2 = fromstr('LINESTRING(0 0, 5 5, 23 23)', srid=4326)\n-        self.assertEqual(True, isinstance(g2.ogr, gdal.OGRGeometry))\n-        self.assertEqual(True, isinstance(g2.srs, gdal.SpatialReference))\n+        self.assertIsInstance(g2.ogr, gdal.OGRGeometry)\n+        self.assertIsInstance(g2.srs, gdal.SpatialReference)\n         self.assertEqual(g2.hex, g2.ogr.hex)\n         self.assertEqual('WGS 84', g2.srs.name)\n \n@@ -847,7 +846,7 @@ def test_copy(self):\n         self.assertNotEqual(poly._ptr, cpy1._ptr)\n         self.assertNotEqual(poly._ptr, cpy2._ptr)\n \n-    @unittest.skipUnless(gdal.HAS_GDAL, \"gdal is required\")\n+    @unittest.skipUnless(gdal.HAS_GDAL, \"gdal is required to transform geometries\")\n     def test_transform(self):\n         \"Testing `transform` method.\"\n         orig = GEOSGeometry('POINT (-104.609 38.255)', 4326)\n@@ -872,6 +871,15 @@ def test_transform(self):\n             self.assertAlmostEqual(trans.x, p.x, prec)\n             self.assertAlmostEqual(trans.y, p.y, prec)\n \n+    @unittest.skipUnless(gdal.HAS_GDAL, \"gdal is required to transform geometries\")\n+    def test_transform_3d(self):\n+        p3d = GEOSGeometry('POINT (5 23 100)', 4326)\n+        p3d.transform(2774)\n+        if GEOS_PREPARE:\n+            self.assertEqual(p3d.z, 100)\n+        else:\n+            self.assertIsNone(p3d.z)\n+\n     def test_transform_noop(self):\n         \"\"\" Testing `transform` method (SRID match) \"\"\"\n         # transform() should no-op if source & dest SRIDs match,\n@@ -1009,18 +1017,35 @@ def test_valid_reason(self):\n \n         g = GEOSGeometry(\"POINT(0 0)\")\n         self.assertTrue(g.valid)\n-        self.assertTrue(isinstance(g.valid_reason, six.string_types))\n+        self.assertIsInstance(g.valid_reason, six.string_types)\n         self.assertEqual(g.valid_reason, \"Valid Geometry\")\n \n-        print(\"\\nBEGIN - expecting GEOS_NOTICE; safe to ignore.\\n\")\n-\n         g = GEOSGeometry(\"LINESTRING(0 0, 0 0)\")\n \n-        self.assertTrue(not g.valid)\n-        self.assertTrue(isinstance(g.valid_reason, six.string_types))\n+        self.assertFalse(g.valid)\n+        self.assertIsInstance(g.valid_reason, six.string_types)\n         self.assertTrue(g.valid_reason.startswith(\"Too few points in geometry component\"))\n \n-        print(\"\\nEND - expecting GEOS_NOTICE; safe to ignore.\\n\")\n+    @unittest.skipUnless(geos_version_info()['version'] >= '3.2.0', \"geos >= 3.2.0 is required\")\n+    def test_linearref(self):\n+        \"Testing linear referencing\"\n+\n+        ls = fromstr('LINESTRING(0 0, 0 10, 10 10, 10 0)')\n+        mls = fromstr('MULTILINESTRING((0 0, 0 10), (10 0, 10 10))')\n+\n+        self.assertEqual(ls.project(Point(0, 20)), 10.0)\n+        self.assertEqual(ls.project(Point(7, 6)), 24)\n+        self.assertEqual(ls.project_normalized(Point(0, 20)), 1.0/3)\n+\n+        self.assertEqual(ls.interpolate(10), Point(0, 10))\n+        self.assertEqual(ls.interpolate(24), Point(10, 6))\n+        self.assertEqual(ls.interpolate_normalized(1.0/3), Point(0, 10))\n+\n+        self.assertEqual(mls.project(Point(0, 20)), 10)\n+        self.assertEqual(mls.project(Point(7, 6)), 16)\n+\n+        self.assertEqual(mls.interpolate(9), Point(0, 9))\n+        self.assertEqual(mls.interpolate(17), Point(10, 7))\n \n     def test_geos_version(self):\n         \"Testing the GEOS version regular expression.\""
        },
        {
            "sha": "45a9a220b1f399375e18b58df7196848583287f5",
            "filename": "django/contrib/gis/geos/tests/test_io.py",
            "status": "modified",
            "additions": 20,
            "deletions": 15,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_io.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_io.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_io.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,8 +1,13 @@\n+from __future__ import unicode_literals\n+\n import binascii\n import unittest\n+\n+from django.contrib.gis import memoryview\n from django.contrib.gis.geos import GEOSGeometry, WKTReader, WKTWriter, WKBReader, WKBWriter, geos_version_info\n from django.utils import six\n \n+\n class GEOSIOTest(unittest.TestCase):\n \n     def test01_wktreader(self):\n@@ -12,15 +17,15 @@ def test01_wktreader(self):\n \n         # read() should return a GEOSGeometry\n         ref = GEOSGeometry(wkt)\n-        g1 = wkt_r.read(wkt)\n-        g2 = wkt_r.read(six.text_type(wkt))\n+        g1 = wkt_r.read(wkt.encode())\n+        g2 = wkt_r.read(wkt)\n \n         for geom in (g1, g2):\n             self.assertEqual(ref, geom)\n \n         # Should only accept six.string_types objects.\n         self.assertRaises(TypeError, wkt_r.read, 1)\n-        self.assertRaises(TypeError, wkt_r.read, buffer('foo'))\n+        self.assertRaises(TypeError, wkt_r.read, memoryview(b'foo'))\n \n     def test02_wktwriter(self):\n         # Creating a WKTWriter instance, testing its ptr property.\n@@ -29,14 +34,14 @@ def test02_wktwriter(self):\n \n         ref = GEOSGeometry('POINT (5 23)')\n         ref_wkt = 'POINT (5.0000000000000000 23.0000000000000000)'\n-        self.assertEqual(ref_wkt, wkt_w.write(ref))\n+        self.assertEqual(ref_wkt, wkt_w.write(ref).decode())\n \n     def test03_wkbreader(self):\n         # Creating a WKBReader instance\n         wkb_r = WKBReader()\n \n-        hex = '000000000140140000000000004037000000000000'\n-        wkb = buffer(binascii.a2b_hex(hex))\n+        hex = b'000000000140140000000000004037000000000000'\n+        wkb = memoryview(binascii.a2b_hex(hex))\n         ref = GEOSGeometry(hex)\n \n         # read() should return a GEOSGeometry on either a hex string or\n@@ -56,10 +61,10 @@ def test04_wkbwriter(self):\n         # Representations of 'POINT (5 23)' in hex -- one normal and\n         # the other with the byte order changed.\n         g = GEOSGeometry('POINT (5 23)')\n-        hex1 = '010100000000000000000014400000000000003740'\n-        wkb1 = buffer(binascii.a2b_hex(hex1))\n-        hex2 = '000000000140140000000000004037000000000000'\n-        wkb2 = buffer(binascii.a2b_hex(hex2))\n+        hex1 = b'010100000000000000000014400000000000003740'\n+        wkb1 = memoryview(binascii.a2b_hex(hex1))\n+        hex2 = b'000000000140140000000000004037000000000000'\n+        wkb2 = memoryview(binascii.a2b_hex(hex2))\n \n         self.assertEqual(hex1, wkb_w.write_hex(g))\n         self.assertEqual(wkb1, wkb_w.write(g))\n@@ -81,10 +86,10 @@ def test04_wkbwriter(self):\n         g = GEOSGeometry('POINT (5 23 17)')\n         g.srid = 4326\n \n-        hex3d = '0101000080000000000000144000000000000037400000000000003140'\n-        wkb3d = buffer(binascii.a2b_hex(hex3d))\n-        hex3d_srid = '01010000A0E6100000000000000000144000000000000037400000000000003140'\n-        wkb3d_srid = buffer(binascii.a2b_hex(hex3d_srid))\n+        hex3d = b'0101000080000000000000144000000000000037400000000000003140'\n+        wkb3d = memoryview(binascii.a2b_hex(hex3d))\n+        hex3d_srid = b'01010000A0E6100000000000000000144000000000000037400000000000003140'\n+        wkb3d_srid = memoryview(binascii.a2b_hex(hex3d_srid))\n \n         # Ensuring bad output dimensions are not accepted\n         for bad_outdim in (-1, 0, 1, 4, 423, 'foo', None):\n@@ -100,7 +105,7 @@ def test04_wkbwriter(self):\n             self.assertEqual(hex3d, wkb_w.write_hex(g))\n             self.assertEqual(wkb3d, wkb_w.write(g))\n \n-            # Telling the WKBWriter to inlcude the srid in the representation.\n+            # Telling the WKBWriter to include the srid in the representation.\n             wkb_w.srid = True\n             self.assertEqual(hex3d_srid, wkb_w.write_hex(g))\n             self.assertEqual(wkb3d_srid, wkb_w.write(g))"
        },
        {
            "sha": "6ce301287e33df2ff841a7f9dd527adeb3207aa3",
            "filename": "django/contrib/gis/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 18,
            "deletions": 18,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:38+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:56+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,76 +13,76 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: views.py:7\n+#: views.py:9\n msgid \"No feeds are registered.\"\n msgstr \"\"\n \n-#: views.py:17\n+#: views.py:19\n #, python-format\n msgid \"Slug %r isn't registered.\"\n msgstr \"\"\n \n-#: db/models/fields.py:50\n+#: db/models/fields.py:51\n msgid \"The base GIS field -- maps to the OpenGIS Specification Geometry type.\"\n msgstr \"\"\n \n-#: db/models/fields.py:270\n+#: db/models/fields.py:271\n msgid \"Point\"\n msgstr \"\"\n \n-#: db/models/fields.py:274\n+#: db/models/fields.py:275\n msgid \"Line string\"\n msgstr \"\"\n \n-#: db/models/fields.py:278\n+#: db/models/fields.py:279\n msgid \"Polygon\"\n msgstr \"\"\n \n-#: db/models/fields.py:282\n+#: db/models/fields.py:283\n msgid \"Multi-point\"\n msgstr \"\"\n \n-#: db/models/fields.py:286\n+#: db/models/fields.py:287\n msgid \"Multi-line string\"\n msgstr \"\"\n \n-#: db/models/fields.py:290\n+#: db/models/fields.py:291\n msgid \"Multi polygon\"\n msgstr \"\"\n \n-#: db/models/fields.py:294\n+#: db/models/fields.py:295\n msgid \"Geometry collection\"\n msgstr \"\"\n \n-#: forms/fields.py:17\n+#: forms/fields.py:19\n msgid \"No geometry value provided.\"\n msgstr \"\"\n \n-#: forms/fields.py:18\n+#: forms/fields.py:20\n msgid \"Invalid geometry value.\"\n msgstr \"\"\n \n-#: forms/fields.py:19\n+#: forms/fields.py:21\n msgid \"Invalid geometry type.\"\n msgstr \"\"\n \n-#: forms/fields.py:20\n+#: forms/fields.py:22\n msgid \"\"\n \"An error occurred when transforming the geometry to the SRID of the geometry \"\n \"form field.\"\n msgstr \"\"\n \n-#: sitemaps/views.py:44\n+#: sitemaps/views.py:46\n #, python-format\n msgid \"No sitemap available for section: %r\"\n msgstr \"\"\n \n-#: sitemaps/views.py:58\n+#: sitemaps/views.py:60\n #, python-format\n msgid \"Page %s empty\"\n msgstr \"\"\n \n-#: sitemaps/views.py:60\n+#: sitemaps/views.py:62\n #, python-format\n msgid \"No page '%s'\"\n msgstr \"\""
        },
        {
            "sha": "eb40edae8fa6312ecd64b57f6f0900054face592",
            "filename": "django/contrib/gis/templates/gis/admin/openlayers.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftemplates%2Fgis%2Fadmin%2Fopenlayers.js?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,4 @@\n-{% load l10n %}{# Author: Justin Bronn, Travis Pinney & Dane Springmeyer #}\n+{% load l10n %}\n OpenLayers.Projection.addTransform(\"EPSG:4326\", \"EPSG:3857\", OpenLayers.Layer.SphericalMercator.projectForward);\n {% block vars %}var {{ module }} = {};\n {{ module }}.map = null; {{ module }}.controls = null; {{ module }}.panel = null; {{ module }}.re = new RegExp(\"^SRID=\\\\d+;(.+)\", \"i\"); {{ module }}.layers = {};\n@@ -109,10 +109,12 @@ OpenLayers.Projection.addTransform(\"EPSG:4326\", \"EPSG:3857\", OpenLayers.Layer.Sp\n {% autoescape off %}{% for item in map_options.items %}      '{{ item.0 }}' : {{ item.1 }}{% if not forloop.last %},{% endif %}\n {% endfor %}{% endautoescape %}    };{% endblock %}\n     // The admin map for this geometry field.\n+    {% block map_creation %}\n     {{ module }}.map = new OpenLayers.Map('{{ id }}_map', options);\n     // Base Layer\n     {{ module }}.layers.base = {% block base_layer %}new OpenLayers.Layer.WMS(\"{{ wms_name }}\", \"{{ wms_url }}\", {layers: '{{ wms_layer }}'{{ wms_options|safe }}});{% endblock %}\n     {{ module }}.map.addLayer({{ module }}.layers.base);\n+    {% endblock %}\n     {% block extra_layers %}{% endblock %}\n     {% if is_linestring %}OpenLayers.Feature.Vector.style[\"default\"][\"strokeWidth\"] = 3; // Default too thin for linestrings. {% endif %}\n     {{ module }}.layers.vector = new OpenLayers.Layer.Vector(\" {{ field_name }}\");"
        },
        {
            "sha": "6ba9d698f71d22173e926533d44b0bbcf43b3122",
            "filename": "django/contrib/gis/tests/data/ch-city/ch-city.dbf",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.dbf",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.dbf",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.dbf?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "a30c00a55de19be195abf9e942f6cff93bf0a825",
            "filename": "django/contrib/gis/tests/data/ch-city/ch-city.prj",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.prj",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.prj",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.prj?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1 @@\n+GEOGCS[\"GCS_WGS_1984\",DATUM[\"D_WGS_1984\",SPHEROID[\"WGS_1984\",6378137,298.257223563]],PRIMEM[\"Greenwich\",0],UNIT[\"Degree\",0.017453292519943295]]\n\\ No newline at end of file"
        },
        {
            "sha": "e430020de09066c7bff31e952196cf556b5156c7",
            "filename": "django/contrib/gis/tests/data/ch-city/ch-city.shp",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.shp",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.shp",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.shp?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "a1487ad82911e9af570d3a04af7163aa8976d89b",
            "filename": "django/contrib/gis/tests/data/ch-city/ch-city.shx",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.shx",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.shx",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fch-city%2Fch-city.shx?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "46de4d61829cac0a583b06a52066cfd1bb1a7b6c",
            "filename": "django/contrib/gis/tests/data/geometries.json",
            "status": "added",
            "additions": 121,
            "deletions": 0,
            "changes": 121,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fgeometries.json",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fgeometries.json",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fgeometries.json?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,121 @@\n+{\n+  \"polygons\": [\n+    {\"wkt\": \"POLYGON ((0 0, 0 100, 100 100, 100 0, 0 0), (10 10, 10 90, 90 90, 90 10, 10 10))\", \"n_i\": 1, \"ext_ring_cs\": [[0, 0], [0, 100], [100, 100], [100, 0], [0, 0]], \"n_p\": 10, \"area\": 3600.0, \"centroid\": [50.0, 50.0]},\n+    {\"wkt\": \"POLYGON ((0 0, 0 100, 100 100, 100 0, 0 0), (10 10, 10 20, 20 20, 20 10, 10 10), (80 80, 80 90, 90 90, 90 80, 80 80))\", \"n_i\": 2, \"ext_ring_cs\": [[0, 0], [0, 100], [100, 100], [100, 0], [0, 0]], \"n_p\": 15, \"area\": 9800.0, \"centroid\": [50.0, 50.0]},\n+    {\"wkt\": \"POLYGON ((0 0, 0 100, 100 100, 100 0, 0 0))\", \"n_i\": 0, \"ext_ring_cs\": [[0, 0], [0, 100], [100, 100], [100, 0], [0, 0]], \"n_p\": 5, \"area\": 10000.0, \"centroid\": [50.0, 50.0]},\n+    {\"wkt\": \"POLYGON ((-95.3848703124799471 29.7056021479768511, -95.3851905195191847 29.7046588196500281, -95.3859356966379011 29.7025053545605502, -95.3860723000647539 29.7020963367038391, -95.3871517697222089 29.6989779021280995, -95.3865578518265522 29.6990856888057202, -95.3862634205175226 29.6999471753441782, -95.3861991779541967 29.6999591988978615, -95.3856773799358137 29.6998323107113578, -95.3856209915427229 29.6998005235473741, -95.3855833545501639 29.6996619391729801, -95.3855776331865002 29.6996232659570047, -95.3850162731712885 29.6997236706530536, -95.3831047357410284 29.7000847603095082, -95.3829800724914776 29.7000676365023502, -95.3828084594470909 29.6999969684031200, -95.3828131504821499 29.6999090511531065, -95.3828022942979601 29.6998152117366025, -95.3827893930918833 29.6997790953076759, -95.3825174668099862 29.6998267772748825, -95.3823521544804862 29.7000451723151606, -95.3820491918785223 29.6999682034582335, -95.3817932841505893 29.6999640407204772, -95.3815438924600443 29.7005983712500630, -95.3807812390843424 29.7007538492921590, -95.3778578936435935 29.7012966201172048, -95.3770817300034679 29.7010555145969093, -95.3772763716395957 29.7004995005932031, -95.3769891024414420 29.7005797730360186, -95.3759855007185990 29.7007754783987821, -95.3759516423090474 29.7007305400669388, -95.3765252155960042 29.6989549173240874, -95.3766842746727832 29.6985134987163164, -95.3768510987262914 29.6980530300744938, -95.3769198676258014 29.6977137204527573, -95.3769616670751930 29.6973351617272172, -95.3770309229297766 29.6969821084304186, -95.3772352596880637 29.6959751305871613, -95.3776232419333354 29.6945439060847463, -95.3776849628727064 29.6943364710766069, -95.3779699491714723 29.6926548349458947, -95.3781945479573494 29.6920088336742545, -95.3785807118394189 29.6908279316076005, -95.3787441368896651 29.6908846275832197, -95.3787903214163890 29.6907152912461640, -95.3791765069353659 29.6893335376821526, -95.3794935959513026 29.6884781789101595, -95.3796592071232112 29.6880066681407619, -95.3799788182090111 29.6873687353035081, -95.3801545516183893 29.6868782380716993, -95.3801258908302145 29.6867756621337762, -95.3801104284899566 29.6867229678809572, -95.3803803523746154 29.6863753372986459, -95.3821028558287622 29.6837392961470421, -95.3827289584682205 29.6828097375216160, -95.3827494698109035 29.6790739156259278, -95.3826022014838486 29.6776502228345507, -95.3825047356438063 29.6765773006280753, -95.3823473035336917 29.6750405250369127, -95.3824540163482055 29.6750076408228587, -95.3838984230304305 29.6745679207378679, -95.3916547074937426 29.6722459226508377, -95.3926154662749468 29.6719609085105489, -95.3967246645118081 29.6707316485589736, -95.3974588054406780 29.6705065336410989, -95.3978523748756828 29.6703795547846845, -95.3988598162279970 29.6700874981900853, -95.3995628600665952 29.6698505300412414, -95.4134721665944170 29.6656841279906232, -95.4143262068232616 29.6654291174019278, -95.4159685142480214 29.6649750989232288, -95.4180067396277565 29.6643253024318021, -95.4185886692196590 29.6641482768691063, -95.4234155309609662 29.6626925393704788, -95.4287785503196346 29.6611023620959706, -95.4310287312749352 29.6604222580752648, -95.4320295629628959 29.6603361318136720, -95.4332899683975739 29.6600560661713608, -95.4342675748811047 29.6598454934599900, -95.4343110414310871 29.6598411486215490, -95.4345576779282538 29.6598147020668499, -95.4348823041721630 29.6597875803673112, -95.4352827715209457 29.6597762346946681, -95.4355290431309982 29.6597827926562374, -95.4359197997999331 29.6598014511782715, -95.4361907884752156 29.6598444333523368, -95.4364608955807228 29.6598901433108217, -95.4367250147512323 29.6599494499910712, -95.4364898759758091 29.6601880616540186, -95.4354501111810691 29.6616378572201107, -95.4381459623171224 29.6631265631655126, -95.4367852490863129 29.6642266600024023, -95.4370040894557263 29.6643425389568769, -95.4367078350812648 29.6645492592343238, -95.4366081749871285 29.6646291473027297, -95.4358539359938192 29.6652308742342932, -95.4350327668927889 29.6658995989314462, -95.4350580905272921 29.6678812477895271, -95.4349710541447536 29.6680054925936965, -95.4349500440473548 29.6671410080890006, -95.4341492724148850 29.6678790545191688, -95.4340248868274728 29.6680353198492135, -95.4333227845797438 29.6689245624945990, -95.4331325652123326 29.6691616138940901, -95.4321314741096955 29.6704473333237253, -95.4320435792664341 29.6702578985411982, -95.4320147929883547 29.6701800936425109, -95.4319764538662980 29.6683246590817085, -95.4317490976340679 29.6684974372577166, -95.4305958185342718 29.6694049049170374, -95.4296600735653016 29.6701723430938493, -95.4284928989940937 29.6710931793380972, -95.4274630532378580 29.6719378813640091, -95.4273056811974811 29.6720684984625791, -95.4260554084574864 29.6730668861566969, -95.4253558063699643 29.6736342467365724, -95.4249278826026028 29.6739557343648919, -95.4248648873821423 29.6745400910786152, -95.4260016131471929 29.6750987014005858, -95.4258567183010911 29.6753452063069929, -95.4260238081486847 29.6754322077221353, -95.4258707374502393 29.6756647377294307, -95.4257951755816691 29.6756407098663360, -95.4257701599566985 29.6761077719536068, -95.4257726684792260 29.6761711204603955, -95.4257980187195614 29.6770219651929423, -95.4252712669032519 29.6770161558853758, -95.4249234392992065 29.6770068683962300, -95.4249574272905789 29.6779707498635759, -95.4244725881033702 29.6779825646764159, -95.4222269476429545 29.6780711474441716, -95.4223032371999267 29.6796029391538809, -95.4239133706588945 29.6795331493690355, -95.4224579084327331 29.6813706893847780, -95.4224290108823965 29.6821953228763924, -95.4230916478977349 29.6822130268724109, -95.4222928279595521 29.6832041816675343, -95.4228763710016352 29.6832087677714505, -95.4223401691637179 29.6838987872753748, -95.4211655906087088 29.6838784024852984, -95.4201984153205558 29.6851319258758082, -95.4206156387716362 29.6851623398125319, -95.4213438084897660 29.6851763011334739, -95.4212071118618752 29.6853679931624974, -95.4202651399651245 29.6865313962980508, -95.4172061157659783 29.6865816431043932, -95.4182217951255183 29.6872251197301544, -95.4178664826439160 29.6876750901471631, -95.4180678442928780 29.6877960336377207, -95.4188763472917572 29.6882826379510938, -95.4185374500596311 29.6887137897831934, -95.4182121713132290 29.6885097429738813, -95.4179857231741551 29.6888118367840086, -95.4183106010563620 29.6890048676118212, -95.4179489865331334 29.6894546700979056, -95.4175581746284820 29.6892323606815438, -95.4173439957341571 29.6894990139807007, -95.4177411199311081 29.6897435034738422, -95.4175789200209721 29.6899207529979208, -95.4170598559864800 29.6896042165807508, -95.4166733682539814 29.6900891174451367, -95.4165941362704331 29.6900347214235047, -95.4163537218065301 29.6903529467753238, -95.4126843270708775 29.6881086357212780, -95.4126604121378392 29.6880942378803496, -95.4126672298953338 29.6885951670109982, -95.4126680884821923 29.6887052446594275, -95.4158080137241882 29.6906382377959339, -95.4152061403821961 29.6910871045531586, -95.4155842583188161 29.6917382915894308, -95.4157426793520358 29.6920726941677096, -95.4154520563662203 29.6922052332446427, -95.4151389936167078 29.6923261661269571, -95.4148649784384872 29.6924343866430256, -95.4144051352401590 29.6925623927348106, -95.4146792019416665 29.6926770338507744, -95.4148824479948985 29.6928117893696388, -95.4149851734360226 29.6929823719519774, -95.4140436551925291 29.6929626643100946, -95.4140465993023241 29.6926545917254892, -95.4137269186733334 29.6927395764256090, -95.4137372859685513 29.6935432485666624, -95.4135702836218655 29.6933186678088283, -95.4133925235973237 29.6930415229852152, -95.4133017035615580 29.6928685062036166, -95.4129588921634593 29.6929391128977862, -95.4125107395559695 29.6930481664661485, -95.4102647423187307 29.6935850183258019, -95.4081931340840157 29.6940907430947760, -95.4078783596459772 29.6941703429951609, -95.4049213975000043 29.6948723732981961, -95.4045944244127071 29.6949626434239207, -95.4045865139788134 29.6954109019001358, -95.4045953345484037 29.6956972800496963, -95.4038879332535146 29.6958296089365490, -95.4040366394459340 29.6964389004769842, -95.4032774779020798 29.6965643341263892, -95.4026066501239853 29.6966646227683881, -95.4024991226393837 29.6961389766619703, -95.4011781398631911 29.6963566063186377, -95.4011524097636112 29.6962596176762190, -95.4018184046368276 29.6961399466727336, -95.4016995838361908 29.6956442609415099, -95.4007100753964608 29.6958900524002978, -95.4008032469935188 29.6962639900781404, -95.3995660267125487 29.6965636449370329, -95.3996140564775601 29.6967877962763644, -95.3996364430014410 29.6968901984825280, -95.3984003269631842 29.6968679634805746, -95.3981442026887265 29.6983660679730335, -95.3980178461957706 29.6990890276252415, -95.3977097967130163 29.7008526152273049, -95.3962347157626027 29.7009697553607630, -95.3951949050136250 29.7004740386619019, -95.3957564950617183 29.6990281830553187, -95.3965927101519924 29.6968771129030706, -95.3957496517238184 29.6970800358387095, -95.3957720559467361 29.6972264611230727, -95.3957391586571788 29.6973548894558732, -95.3956286413405365 29.6974949857280883, -95.3955111053256957 29.6975661086270186, -95.3953215342724121 29.6976022763384790, -95.3951795558443365 29.6975846977491038, -95.3950369632041060 29.6975175779330200, -95.3949401089966500 29.6974269267953304, -95.3948740281415581 29.6972903308506346, -95.3946650813866910 29.6973397326847923, -95.3947654059391112 29.6974882560192022, -95.3949627316619768 29.6980355864961858, -95.3933200807862249 29.6984590863712796, -95.3932606497523494 29.6984464798710839, -95.3932983699113350 29.6983154306484352, -95.3933058014696655 29.6982165816983610, -95.3932946347785133 29.6981089778195759, -95.3931780601756287 29.6977068906794841, -95.3929928222970602 29.6977541771878180, -95.3930873169846478 29.6980676264932946, -95.3932743746374570 29.6981249406449663, -95.3929512584706316 29.6989526513922222, -95.3919850280655197 29.7014358632108646, -95.3918950918929056 29.7014169320765724, -95.3916928317890296 29.7019232352846423, -95.3915424614970959 29.7022988712928289, -95.3901530441668939 29.7058519502930061, -95.3899656322116698 29.7059156823562418, -95.3897628748670883 29.7059900058266777, -95.3896062677805787 29.7060738276384946, -95.3893941800512266 29.7061891695242046, -95.3892150365492455 29.7062641292949436, -95.3890502563035199 29.7063339729630940, -95.3888717930715586 29.7063896908080736, -95.3886925428988945 29.7064453871994978, -95.3885376849411983 29.7064797304524149, -95.3883284158984139 29.7065153575050189, -95.3881046767627794 29.7065368368267357, -95.3878809284696132 29.7065363048447537, -95.3876046356120924 29.7065288525102424, -95.3873060894974714 29.7064822806001452, -95.3869851943158409 29.7063993367575350, -95.3865967896568065 29.7062870572919202, -95.3861785624983156 29.7061492099008184, -95.3857375009733488 29.7059887337478798, -95.3854573290902152 29.7058683664514618, -95.3848703124799471 29.7056021479768511))\", \"n_i\": 0, \"ext_ring_cs\": false, \"n_p\": 264, \"area\": 0.00129917360654, \"centroid\": [-95.403569179437341, 29.681772571690402]}\n+  ],\n+  \"multipolygons\": [ \n+    {\"wkt\": \"MULTIPOLYGON (((100 20, 180 20, 180 100, 100 100, 100 20)), ((20 100, 100 100, 100 180, 20 180, 20 100)), ((100 180, 180 180, 180 260, 100 260, 100 180)), ((180 100, 260 100, 260 180, 180 180, 180 100)))\",\"valid\": true, \"num_geom\":4, \"n_p\":20},\n+    {\"wkt\": \"MULTIPOLYGON (((60 300, 320 220, 260 60, 60 100, 60 300)), ((60 300, 320 220, 260 60, 60 100, 60 300)))\", \"valid\": false},\n+    {\"wkt\": \"MULTIPOLYGON (((180 60, 240 160, 300 60, 180 60)), ((80 80, 180 60, 160 140, 240 160, 360 140, 300 60, 420 100, 320 280, 120 260, 80 80)))\", \"valid\": true, \"num_geom\": 2, \"n_p\": 14}\n+  ],\n+  \"errors\": [\n+    {\"wkt\": \"GEOMETR##!@#%#............a32515\", \"bad\": true, \"hex\": false},\n+    {\"wkt\": \"Foo.Bar\", \"bad\": true, \"hex\": false},\n+    {\"wkt\": \"POINT (5, 23)\", \"bad\": true, \"hex\": false},\n+    {\"wkt\": \"AAABBBDDDAAD##@#1113511111-098111111111111111533333333333333\", \"bad\": true, \"hex\": true},\n+    {\"wkt\": \"FFFFFFFFFFFFFFFFF1355555555555555555565111\", \"bad\": true, \"hex\": true},\n+    {\"wkt\": \"\", \"bad\": true, \"hex\": false}\n+  ],\n+  \"wkt_out\": [\n+    {\"wkt\": \"POINT (110 130)\", \"ewkt\": \"POINT (110.0000000000000000 130.0000000000000000)\", \"kml\": \"<Point><coordinates>110.0,130.0,0</coordinates></Point>\", \"gml\": \"<gml:Point><gml:coordinates>110,130</gml:coordinates></gml:Point>\"},\n+    {\"wkt\": \"LINESTRING (40 40,50 130,130 130)\", \"ewkt\": \"LINESTRING (40.0000000000000000 40.0000000000000000, 50.0000000000000000 130.0000000000000000, 130.0000000000000000 130.0000000000000000)\", \"kml\": \"<LineString><coordinates>40.0,40.0,0 50.0,130.0,0 130.0,130.0,0</coordinates></LineString>\", \"gml\": \"<gml:LineString><gml:coordinates>40,40 50,130 130,130</gml:coordinates></gml:LineString>\"},\n+    {\"wkt\": \"POLYGON ((150 150,410 150,280 20,20 20,150 150),(170 120,330 120,260 50,100 50,170 120))\", \"ewkt\": \"POLYGON ((150.0000000000000000 150.0000000000000000, 410.0000000000000000 150.0000000000000000, 280.0000000000000000 20.0000000000000000, 20.0000000000000000 20.0000000000000000, 150.0000000000000000 150.0000000000000000), (170.0000000000000000 120.0000000000000000, 330.0000000000000000 120.0000000000000000, 260.0000000000000000 50.0000000000000000, 100.0000000000000000 50.0000000000000000, 170.0000000000000000 120.0000000000000000))\", \"kml\": \"<Polygon><outerBoundaryIs><LinearRing><coordinates>150.0,150.0,0 410.0,150.0,0 280.0,20.0,0 20.0,20.0,0 150.0,150.0,0</coordinates></LinearRing></outerBoundaryIs><innerBoundaryIs><LinearRing><coordinates>170.0,120.0,0 330.0,120.0,0 260.0,50.0,0 100.0,50.0,0 170.0,120.0,0</coordinates></LinearRing></innerBoundaryIs></Polygon>\", \"gml\": \"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>150,150 410,150 280,20 20,20 150,150</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs><gml:innerBoundaryIs><gml:LinearRing><gml:coordinates>170,120 330,120 260,50 100,50 170,120</gml:coordinates></gml:LinearRing></gml:innerBoundaryIs></gml:Polygon>\"},\n+    {\"wkt\": \"MULTIPOINT (10 80,110 170,110 120)\", \"ewkt\": \"MULTIPOINT (10.0000000000000000 80.0000000000000000, 110.0000000000000000 170.0000000000000000, 110.0000000000000000 120.0000000000000000)\", \"kml\": \"<MultiGeometry><Point><coordinates>10.0,80.0,0</coordinates></Point><Point><coordinates>110.0,170.0,0</coordinates></Point><Point><coordinates>110.0,120.0,0</coordinates></Point></MultiGeometry>\", \"gml\": \"<gml:MultiPoint><gml:pointMember><gml:Point><gml:coordinates>10,80</gml:coordinates></gml:Point></gml:pointMember><gml:pointMember><gml:Point><gml:coordinates>110,170</gml:coordinates></gml:Point></gml:pointMember><gml:pointMember><gml:Point><gml:coordinates>110,120</gml:coordinates></gml:Point></gml:pointMember></gml:MultiPoint>\"},\n+    {\"wkt\": \"MULTILINESTRING ((110 100,40 30,180 30),(170 30,110 90,50 30))\", \"ewkt\": \"MULTILINESTRING ((110.0000000000000000 100.0000000000000000, 40.0000000000000000 30.0000000000000000, 180.0000000000000000 30.0000000000000000), (170.0000000000000000 30.0000000000000000, 110.0000000000000000 90.0000000000000000, 50.0000000000000000 30.0000000000000000))\", \"kml\": \"<MultiGeometry><LineString><coordinates>110.0,100.0,0 40.0,30.0,0 180.0,30.0,0</coordinates></LineString><LineString><coordinates>170.0,30.0,0 110.0,90.0,0 50.0,30.0,0</coordinates></LineString></MultiGeometry>\", \"gml\": \"<gml:MultiLineString><gml:lineStringMember><gml:LineString><gml:coordinates>110,100 40,30 180,30</gml:coordinates></gml:LineString></gml:lineStringMember><gml:lineStringMember><gml:LineString><gml:coordinates>170,30 110,90 50,30</gml:coordinates></gml:LineString></gml:lineStringMember></gml:MultiLineString>\"},\n+    {\"wkt\": \"MULTIPOLYGON (((110 110,70 200,150 200,110 110),(110 110,100 180,120 180,110 110)),((110 110,150 20,70 20,110 110),(110 110,120 40,100 40,110 110)))\", \"ewkt\": \"MULTIPOLYGON (((110.0000000000000000 110.0000000000000000, 70.0000000000000000 200.0000000000000000, 150.0000000000000000 200.0000000000000000, 110.0000000000000000 110.0000000000000000), (110.0000000000000000 110.0000000000000000, 100.0000000000000000 180.0000000000000000, 120.0000000000000000 180.0000000000000000, 110.0000000000000000 110.0000000000000000)), ((110.0000000000000000 110.0000000000000000, 150.0000000000000000 20.0000000000000000, 70.0000000000000000 20.0000000000000000, 110.0000000000000000 110.0000000000000000), (110.0000000000000000 110.0000000000000000, 120.0000000000000000 40.0000000000000000, 100.0000000000000000 40.0000000000000000, 110.0000000000000000 110.0000000000000000)))\", \"kml\": \"<MultiGeometry><Polygon><outerBoundaryIs><LinearRing><coordinates>110.0,110.0,0 70.0,200.0,0 150.0,200.0,0 110.0,110.0,0</coordinates></LinearRing></outerBoundaryIs><innerBoundaryIs><LinearRing><coordinates>110.0,110.0,0 100.0,180.0,0 120.0,180.0,0 110.0,110.0,0</coordinates></LinearRing></innerBoundaryIs></Polygon><Polygon><outerBoundaryIs><LinearRing><coordinates>110.0,110.0,0 150.0,20.0,0 70.0,20.0,0 110.0,110.0,0</coordinates></LinearRing></outerBoundaryIs><innerBoundaryIs><LinearRing><coordinates>110.0,110.0,0 120.0,40.0,0 100.0,40.0,0 110.0,110.0,0</coordinates></LinearRing></innerBoundaryIs></Polygon></MultiGeometry>\", \"gml\": \"<gml:MultiPolygon><gml:polygonMember><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>110,110 70,200 150,200 110,110</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs><gml:innerBoundaryIs><gml:LinearRing><gml:coordinates>110,110 100,180 120,180 110,110</gml:coordinates></gml:LinearRing></gml:innerBoundaryIs></gml:Polygon></gml:polygonMember><gml:polygonMember><gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>110,110 150,20 70,20 110,110</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs><gml:innerBoundaryIs><gml:LinearRing><gml:coordinates>110,110 120,40 100,40 110,110</gml:coordinates></gml:LinearRing></gml:innerBoundaryIs></gml:Polygon></gml:polygonMember></gml:MultiPolygon>\"},\n+    {\"wkt\": \"GEOMETRYCOLLECTION (POINT (110 260),LINESTRING (110 0,110 60))\", \"ewkt\": \"GEOMETRYCOLLECTION (POINT (110.0000000000000000 260.0000000000000000), LINESTRING (110.0000000000000000 0.0000000000000000, 110.0000000000000000 60.0000000000000000))\", \"kml\": \"<MultiGeometry><Point><coordinates>110.0,260.0,0</coordinates></Point><LineString><coordinates>110.0,0.0,0 110.0,60.0,0</coordinates></LineString></MultiGeometry>\", \"gml\": \"<gml:GeometryCollection><gml:geometryMember><gml:Point><gml:coordinates>110,260</gml:coordinates></gml:Point></gml:geometryMember><gml:geometryMember><gml:LineString><gml:coordinates>110,0 110,60</gml:coordinates></gml:LineString></gml:geometryMember></gml:GeometryCollection>\"}\n+  ],\n+  \"hex_wkt\": [\n+    {\"wkt\": \"POINT(0 1)\", \"hex\": \"01010000000000000000000000000000000000F03F\"},\n+    {\"wkt\": \"LINESTRING(0 1, 2 3, 4 5)\", \"hex\": \"0102000000030000000000000000000000000000000000F03F0000000000000040000000000000084000000000000010400000000000001440\"},\n+    {\"wkt\": \"POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))\", \"hex\": \"010300000001000000050000000000000000000000000000000000000000000000000024400000000000000000000000000000244000000000000024400000000000000000000000000000244000000000000000000000000000000000\"},\n+    {\"wkt\": \"MULTIPOINT(0 0, 10 0, 10 10, 0 10, 0 0)\", \"hex\": \"010400000005000000010100000000000000000000000000000000000000010100000000000000000024400000000000000000010100000000000000000024400000000000002440010100000000000000000000000000000000002440010100000000000000000000000000000000000000\"},\n+    {\"wkt\": \"MULTILINESTRING((0 0, 10 0, 10 10, 0 10),(20 20, 30 20))\", \"hex\": \"01050000000200000001020000000400000000000000000000000000000000000000000000000000244000000000000000000000000000002440000000000000244000000000000000000000000000002440010200000002000000000000000000344000000000000034400000000000003E400000000000003440\"},\n+    {\"wkt\": \"MULTIPOLYGON(((0 0, 10 0, 10 10, 0 10, 0 0)),((20 20, 20 30, 30 30, 30 20, 20 20),(25 25, 25 26, 26 26, 26 25, 25 25)))\", \"hex\": \"010600000002000000010300000001000000050000000000000000000000000000000000000000000000000024400000000000000000000000000000244000000000000024400000000000000000000000000000244000000000000000000000000000000000010300000002000000050000000000000000003440000000000000344000000000000034400000000000003E400000000000003E400000000000003E400000000000003E40000000000000344000000000000034400000000000003440050000000000000000003940000000000000394000000000000039400000000000003A400000000000003A400000000000003A400000000000003A40000000000000394000000000000039400000000000003940\"},\n+    {\"wkt\": \"GEOMETRYCOLLECTION(MULTIPOLYGON(((0 0, 10 0, 10 10, 0 10, 0 0)),((20 20, 20 30, 30 30, 30 20, 20 20),(25 25, 25 26, 26 26, 26 25, 25 25))),MULTILINESTRING((0 0, 10 0, 10 10, 0 10),(20 20, 30 20)),MULTIPOINT(0 0, 10 0, 10 10, 0 10, 0 0))\", \"hex\": \"010700000003000000010600000002000000010300000001000000050000000000000000000000000000000000000000000000000024400000000000000000000000000000244000000000000024400000000000000000000000000000244000000000000000000000000000000000010300000002000000050000000000000000003440000000000000344000000000000034400000000000003E400000000000003E400000000000003E400000000000003E40000000000000344000000000000034400000000000003440050000000000000000003940000000000000394000000000000039400000000000003A400000000000003A400000000000003A400000000000003A4000000000000039400000000000003940000000000000394001050000000200000001020000000400000000000000000000000000000000000000000000000000244000000000000000000000000000002440000000000000244000000000000000000000000000002440010200000002000000000000000000344000000000000034400000000000003E400000000000003440010400000005000000010100000000000000000000000000000000000000010100000000000000000024400000000000000000010100000000000000000024400000000000002440010100000000000000000000000000000000002440010100000000000000000000000000000000000000\"}\n+  ],\n+  \"json_geoms\": [\n+    {\"wkt\": \"POINT(100 0)\", \"json\": \"{ \\\"type\\\": \\\"Point\\\", \\\"coordinates\\\": [ 100.000000, 0.000000 ] }\"},\n+    {\"wkt\": \"POLYGON((0 0, -10 0, -10 -10, 0 -10, 0 0))\", \"json\": \"{ \\\"type\\\": \\\"Polygon\\\", \\\"coordinates\\\": [ [ [ 0.000000, 0.000000 ], [ -10.000000, 0.000000 ], [ -10.000000, -10.000000 ], [ 0.000000, -10.000000 ], [ 0.000000, 0.000000 ] ] ] }\"},\n+    {\"wkt\": \"MULTIPOLYGON(((102 2, 103 2, 103 3, 102 3, 102 2)), ((100.0 0.0, 101.0 0.0, 101.0 1.0, 100.0 1.0, 100.0 0.0), (100.2 0.2, 100.8 0.2, 100.8 0.8, 100.2 0.8, 100.2 0.2)))\", \"json\": \"{ \\\"type\\\": \\\"MultiPolygon\\\", \\\"coordinates\\\": [ [ [ [ 102.000000, 2.000000 ], [ 103.000000, 2.000000 ], [ 103.000000, 3.000000 ], [ 102.000000, 3.000000 ], [ 102.000000, 2.000000 ] ] ], [ [ [ 100.000000, 0.000000 ], [ 101.000000, 0.000000 ], [ 101.000000, 1.000000 ], [ 100.000000, 1.000000 ], [ 100.000000, 0.000000 ] ], [ [ 100.200000, 0.200000 ], [ 100.800000, 0.200000 ], [ 100.800000, 0.800000 ], [ 100.200000, 0.800000 ], [ 100.200000, 0.200000 ] ] ] ] }\"},\n+    {\"wkt\": \"GEOMETRYCOLLECTION(POINT(100 0),LINESTRING(101.0 0.0, 102.0 1.0))\", \"json\": \"{ \\\"type\\\": \\\"GeometryCollection\\\", \\\"geometries\\\": [ { \\\"type\\\": \\\"Point\\\", \\\"coordinates\\\": [ 100.000000, 0.000000 ] }, { \\\"type\\\": \\\"LineString\\\", \\\"coordinates\\\": [ [ 101.000000, 0.000000 ], [ 102.000000, 1.000000 ] ] } ] }\"},\n+    {\"wkt\": \"MULTILINESTRING((100.0 0.0, 101.0 1.0),(102.0 2.0, 103.0 3.0))\", \"json\": \"\\\\n\\\\n{ \\\"type\\\": \\\"MultiLineString\\\",\\\\n  \\\"coordinates\\\": [\\\\n      [ [100.0, 0.0], [101.0, 1.0] ],\\\\n      [ [102.0, 2.0], [103.0, 3.0] ]\\\\n    ]\\\\n  }\\\\n\\\\n\", \"not_equal\": true}\n+  ],\n+  \"points\": [\n+    {\"wkt\": \"POINT (5 23)\", \"x\": 5.0, \"y\": 23.0, \"centroid\": [5.0, 23.0]},\n+    {\"wkt\": \"POINT (-95.338492 29.723893)\", \"x\": -95.338492, \"y\": 29.723893, \"centroid\": [-95.338492, 29.723893]},\n+    {\"wkt\": \"POINT(1.234 5.678)\", \"x\": 1.234, \"y\": 5.678, \"centroid\": [1.234, 5.678]},\n+    {\"wkt\": \"POINT(4.321 8.765)\", \"x\": 4.321, \"y\": 8.765, \"centroid\": [4.321, 8.765]},\n+    {\"wkt\": \"POINT(10 10)\", \"x\": 10, \"y\": 10, \"centroid\": [10.0, 10.0]},\n+    {\"wkt\": \"POINT (5 23 8)\", \"x\": 5.0, \"y\": 23.0, \"z\": 8.0, \"centroid\": [5.0, 23.0]}\n+  ],\n+  \"multipoints\":[\n+    {\"wkt\": \"MULTIPOINT(10 10, 20 20 )\", \"n_p\": 2, \"coords\": [[10.0, 10.0], [20.0, 20.0]], \"centroid\": [15.0, 15.0]},\n+    {\"wkt\": \"MULTIPOINT(10 10, 20 20, 10 20, 20 10)\", \"n_p\": 4, \"coords\": [[10.0, 10.0], [20.0, 20.0], [10.0, 20.0], [20.0, 10.0]], \"centroid\": [15.0, 15.0]}\n+  ],\n+  \"linestrings\": [\n+    {\"wkt\": \"LINESTRING (60 180, 120 100, 180 180)\", \"n_p\": 3, \"centroid\": [120.0, 140.0], \"coords\": [[60.0, 180.0], [120.0, 100.0], [180.0, 180.0]]},\n+    {\"wkt\": \"LINESTRING (0 0, 5 5, 10 5, 10 10)\", \"n_p\": 4, \"centroid\": [6.1611652351681556, 4.6966991411008934], \"coords\": [[0.0, 0.0], [5.0, 5.0], [10.0, 5.0], [10.0, 10.0]]}\n+  ],\n+  \"linearrings\": [\n+    {\"wkt\": \"LINEARRING (649899.3065171393100172 4176512.3807915160432458, 649902.7294133581453934 4176512.7834989596158266, 649906.5550170192727819 4176514.3942507002502680, 649910.5820134161040187 4176516.0050024418160319, 649914.4076170771149918 4176518.0184616246260703, 649917.2264131171396002 4176519.4278986593708396, 649920.0452871860470623 4176521.6427505780011415, 649922.0587463703704998 4176522.8507948759943247, 649924.2735982896992937 4176524.4616246484220028, 649926.2870574744883925 4176525.4683542405255139, 649927.8978092158213258 4176526.8777912775985897, 649929.3072462501004338 4176528.0858355751261115, 649930.1126611357321963 4176529.4952726080082357, 649927.4951798024121672 4176506.9444361114874482, 649899.3065171393100172 4176512.3807915160432458)\", \"n_p\": 15}\n+  ],\n+  \"multilinestrings\": [\n+    {\"wkt\": \"MULTILINESTRING ((0 0, 0 100), (100 0, 100 100))\", \"n_p\": 4, \"centroid\": [50.0, 50.0], \"coords\": [[[0, 0], [0, 100]], [[100, 0], [100, 100]]]},\n+    {\"wkt\": \"MULTILINESTRING ((20 20, 60 60), (20 -20, 60 -60), (-20 -20, -60 -60), (-20 20, -60 60), (-80 0, 0 80, 80 0, 0 -80, -80 0), (-40 20, -40 -20), (-20 40, 20 40), (40 20, 40 -20), (20 -40, -20 -40))\", \"n_p\": 21, \"centroid\": [0.0, 0.0], \"coords\": [[[20.0, 20.0], [60.0, 60.0]], [[20.0, -20.0], [60.0, -60.0]], [[-20.0, -20.0], [-60.0, -60.0]], [[-20.0, 20.0], [-60.0, 60.0]], [[-80.0, 0.0], [0.0, 80.0], [80.0, 0.0], [0.0, -80.0], [-80.0, 0.0]], [[-40.0, 20.0], [-40.0, -20.0]], [[-20.0, 40.0], [20.0, 40.0]], [[40.0, 20.0], [40.0, -20.0]], [[20.0, -40.0], [-20.0, -40.0]]]}\n+  ],\n+  \"buffer_geoms\": [\n+      {\"wkt\": \"POINT(0 0)\",\n+       \"buffer_wkt\": \"POLYGON ((5 0,4.903926402016153 -0.97545161008064,4.619397662556435 -1.913417161825447,4.157348061512728 -2.777851165098009,3.53553390593274 -3.535533905932735,2.777851165098015 -4.157348061512724,1.913417161825454 -4.619397662556431,0.975451610080648 -4.903926402016151,0.000000000000008 -5.0,-0.975451610080632 -4.903926402016154,-1.913417161825439 -4.619397662556437,-2.777851165098002 -4.157348061512732,-3.53553390593273 -3.535533905932746,-4.157348061512719 -2.777851165098022,-4.619397662556429 -1.913417161825462,-4.903926402016149 -0.975451610080656,-5.0 -0.000000000000016,-4.903926402016156 0.975451610080624,-4.619397662556441 1.913417161825432,-4.157348061512737 2.777851165097995,-3.535533905932752 3.535533905932723,-2.777851165098029 4.157348061512714,-1.913417161825468 4.619397662556426,-0.975451610080661 4.903926402016149,-0.000000000000019 5.0,0.975451610080624 4.903926402016156,1.913417161825434 4.61939766255644,2.777851165097998 4.157348061512735,3.535533905932727 3.535533905932748,4.157348061512719 2.777851165098022,4.619397662556429 1.91341716182546,4.90392640201615 0.975451610080652,5 0))\",\n+       \"width\": 5.0, \"quadsegs\": 8\n+      },\n+      {\"wkt\": \"POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))\",\n+       \"buffer_wkt\": \"POLYGON ((-2 0,-2 10,-1.961570560806461 10.390180644032258,-1.847759065022573 10.765366864730179,-1.662939224605091 11.111140466039204,-1.414213562373095 11.414213562373096,-1.111140466039204 11.662939224605092,-0.765366864730179 11.847759065022574,-0.390180644032256 11.961570560806461,0 12,10 12,10.390180644032256 11.961570560806461,10.765366864730179 11.847759065022574,11.111140466039204 11.66293922460509,11.414213562373096 11.414213562373096,11.66293922460509 11.111140466039204,11.847759065022574 10.765366864730179,11.961570560806461 10.390180644032256,12 10,12 0,11.961570560806461 -0.390180644032256,11.847759065022574 -0.76536686473018,11.66293922460509 -1.111140466039204,11.414213562373096 -1.414213562373095,11.111140466039204 -1.66293922460509,10.765366864730179 -1.847759065022573,10.390180644032256 -1.961570560806461,10 -2,0.0 -2.0,-0.390180644032255 -1.961570560806461,-0.765366864730177 -1.847759065022575,-1.1111404660392 -1.662939224605093,-1.41421356237309 -1.4142135623731,-1.662939224605086 -1.111140466039211,-1.84775906502257 -0.765366864730189,-1.961570560806459 -0.390180644032268,-2 0))\",\n+       \"width\": 2.0, \"quadsegs\": 8\n+      }\n+  ],\n+  \"relate_geoms\": [\n+      {\"wkt_a\": \"MULTIPOINT(80 70, 20 20, 200 170, 140 120)\",\n+       \"wkt_b\": \"MULTIPOINT(80 170, 140 120, 200 80, 80 70)\",\n+       \"pattern\": \"0F0FFF0F2\", \"result\": true\n+      },\n+      {\"wkt_a\": \"POINT(20 20)\",\n+       \"wkt_b\": \"POINT(40 60)\",\n+       \"pattern\": \"FF0FFF0F2\", \"result\": true\n+      },\n+      {\"wkt_a\": \"POINT(110 110)\",\n+       \"wkt_b\": \"LINESTRING(200 200, 110 110, 200 20, 20 20, 110 110, 20 200, 200 200)\",\n+       \"pattern\": \"0FFFFF1F2\", \"result\": true\n+      },\n+      {\"wkt_a\": \"MULTILINESTRING((20 20, 90 20, 170 20), (90 20, 90 80, 90 140))\",\n+       \"wkt_b\": \"MULTILINESTRING((90 20, 170 100, 170 140), (130 140, 130 60, 90 20, 20 90, 90 20))\",\n+       \"pattern\": \"FF10F0102\", \"result\": true\n+      }\n+  ],\n+  \"topology_geoms\": [\n+      {\"wkt_a\": \"POLYGON ((-5.0 0.0, -5.0 10.0, 5.0 10.0, 5.0 0.0, -5.0 0.0))\",\n+       \"wkt_b\": \"POLYGON ((0.0 -5.0, 0.0 5.0, 10.0 5.0, 10.0 -5.0, 0.0 -5.0))\"\n+      },\n+      {\"wkt_a\": \"POLYGON ((2 0, 18 0, 18 15, 2 15, 2 0))\",\n+       \"wkt_b\": \"POLYGON ((10 1, 11 3, 13 4, 15 6, 16 8, 16 10, 15 12, 13 13, 11 12, 10 10, 9 12, 7 13, 5 12, 4 10, 4 8, 5 6, 7 4, 9 3, 10 1))\"\n+      }\n+  ],\n+  \"diff_geoms\": [\n+      {\"wkt\": \"POLYGON ((-5 0,-5 10,5 10,5 5,0 5,0 0,-5 0))\"},\n+      {\"wkt\": \"POLYGON ((2 0, 2 15, 18 15, 18 0, 2 0), (10 1, 11 3, 13 4, 15 6, 16 8, 16 10, 15 12, 13 13, 11 12, 10 10, 9 12, 7 13, 5 12, 4 10, 4 8, 5 6, 7 4, 9 3, 10 1))\"}\n+  ],\n+  \"sdiff_geoms\": [\n+      {\"wkt\": \"MULTIPOLYGON (((-5 0,-5 10,5 10,5 5,0 5,0 0,-5 0)),((0 0,5 0,5 5,10 5,10 -5,0 -5,0 0)))\"},\n+      {\"wkt\": \"POLYGON ((2 0, 2 15, 18 15, 18 0, 2 0), (10 1, 11 3, 13 4, 15 6, 16 8, 16 10, 15 12, 13 13, 11 12, 10 10, 9 12, 7 13, 5 12, 4 10, 4 8, 5 6, 7 4, 9 3, 10 1))\"}\n+  ],\n+  \"intersect_geoms\": [\n+      {\"wkt\": \"POLYGON ((5 5,5 0,0 0,0 5,5 5))\"},\n+      {\"wkt\": \"POLYGON ((10 1, 9 3, 7 4, 5 6, 4 8, 4 10, 5 12, 7 13, 9 12, 10 10, 11 12, 13 13, 15 12, 16 10, 16 8, 15 6, 13 4, 11 3, 10 1))\"}\n+  ],\n+  \"union_geoms\": [\n+      {\"wkt\": \"POLYGON ((-5 0,-5 10,5 10,5 5,10 5,10 -5,0 -5,0 0,-5 0))\"},\n+      {\"wkt\": \"POLYGON ((2 0, 2 15, 18 15, 18 0, 2 0))\"}\n+  ]\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "683dc83e4d7b8d3805c9836026299ff1c1113d29",
            "filename": "django/contrib/gis/tests/data/geometries.json.gz",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/a589fdff81ab36c57ff0a1003e60ee0dd55f3a88/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fgeometries.json.gz",
            "raw_url": "https://github.com/django/django/raw/a589fdff81ab36c57ff0a1003e60ee0dd55f3a88/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fgeometries.json.gz",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdata%2Fgeometries.json.gz?ref=a589fdff81ab36c57ff0a1003e60ee0dd55f3a88"
        },
        {
            "sha": "5574b427385b89d1f41f2dd88e652fbf2a02e7c4",
            "filename": "django/contrib/gis/tests/distapp/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdistapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fdistapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fdistapp%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -324,7 +324,7 @@ def test07_length(self):\n         else:\n             qs = Interstate.objects.length()\n             if oracle: tol = 2\n-            else: tol = 5\n+            else: tol = 3\n             self.assertAlmostEqual(len_m1, qs[0].length.m, tol)\n \n         # Now doing length on a projected coordinate system."
        },
        {
            "sha": "f7590fe84aab60176d57630fe73cf260fd4c709d",
            "filename": "django/contrib/gis/tests/geo3d/tests.py",
            "status": "modified",
            "additions": 87,
            "deletions": 52,
            "changes": 139,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeo3d%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,16 +1,17 @@\n-from __future__ import absolute_import\n+from __future__ import absolute_import, unicode_literals\n \n import os\n import re\n \n-from django.utils.unittest import TestCase\n from django.contrib.gis.db.models import Union, Extent3D\n-from django.contrib.gis.geos import GEOSGeometry, Point, Polygon\n+from django.contrib.gis.geos import GEOSGeometry, LineString, Point, Polygon\n from django.contrib.gis.utils import LayerMapping, LayerMapError\n+from django.test import TestCase\n \n from .models import (City3D, Interstate2D, Interstate3D, InterstateProj2D,\n     InterstateProj3D, Point2D, Point3D, MultiPoint3D, Polygon2D, Polygon3D)\n \n+\n data_path = os.path.realpath(os.path.join(os.path.dirname(__file__), '..', 'data'))\n city_file = os.path.join(data_path, 'cities', 'cities.shp')\n vrt_file = os.path.join(data_path, 'test_vrt', 'test_vrt.vrt')\n@@ -46,12 +47,11 @@\n # Bounding box polygon for inner-loop of Houston (in projected coordinate\n # system 32140), with elevation values from the National Elevation Dataset\n # (see above).\n-bbox_wkt = 'POLYGON((941527.97 4225693.20,962596.48 4226349.75,963152.57 4209023.95,942051.75 4208366.38,941527.97 4225693.20))'\n-bbox_z = (21.71, 13.21, 9.12, 16.40, 21.71)\n-def gen_bbox():\n-    bbox_2d = GEOSGeometry(bbox_wkt, srid=32140)\n-    bbox_3d = Polygon(tuple((x, y, z) for (x, y), z in zip(bbox_2d[0].coords, bbox_z)), srid=32140)\n-    return bbox_2d, bbox_3d\n+bbox_data = (\n+    'POLYGON((941527.97 4225693.20,962596.48 4226349.75,963152.57 4209023.95,942051.75 4208366.38,941527.97 4225693.20))',\n+    (21.71, 13.21, 9.12, 16.40, 21.71)\n+)\n+\n \n class Geo3DTest(TestCase):\n     \"\"\"\n@@ -63,25 +63,11 @@ class Geo3DTest(TestCase):\n     http://postgis.refractions.net/documentation/manual-1.4/ch08.html#PostGIS_3D_Functions\n     \"\"\"\n \n-    def test01_3d(self):\n-        \"Test the creation of 3D models.\"\n-        # 3D models for the rest of the tests will be populated in here.\n-        # For each 3D data set create model (and 2D version if necessary),\n-        # retrieve, and assert geometry is in 3D and contains the expected\n-        # 3D values.\n-        for name, pnt_data in city_data:\n-            x, y, z = pnt_data\n-            pnt = Point(x, y, z, srid=4326)\n-            City3D.objects.create(name=name, point=pnt)\n-            city = City3D.objects.get(name=name)\n-            self.assertTrue(city.point.hasz)\n-            self.assertEqual(z, city.point.z)\n-\n+    def _load_interstate_data(self):\n         # Interstate (2D / 3D and Geographic/Projected variants)\n         for name, line, exp_z in interstate_data:\n             line_3d = GEOSGeometry(line, srid=4269)\n-            # Using `hex` attribute because it omits 3D.\n-            line_2d = GEOSGeometry(line_3d.hex, srid=4269)\n+            line_2d = LineString([l[:2] for l in line_3d.coords], srid=4269)\n \n             # Creating a geographic and projected version of the\n             # interstate in both 2D and 3D.\n@@ -90,26 +76,51 @@ def test01_3d(self):\n             Interstate2D.objects.create(name=name, line=line_2d)\n             InterstateProj2D.objects.create(name=name, line=line_2d)\n \n-            # Retrieving and making sure it's 3D and has expected\n-            # Z values -- shouldn't change because of coordinate system.\n+    def _load_city_data(self):\n+        for name, pnt_data in city_data:\n+            City3D.objects.create(name=name, point=Point(*pnt_data, srid=4326))\n+\n+    def _load_polygon_data(self):\n+        bbox_wkt, bbox_z = bbox_data\n+        bbox_2d = GEOSGeometry(bbox_wkt, srid=32140)\n+        bbox_3d = Polygon(tuple((x, y, z) for (x, y), z in zip(bbox_2d[0].coords, bbox_z)), srid=32140)\n+        Polygon2D.objects.create(name='2D BBox', poly=bbox_2d)\n+        Polygon3D.objects.create(name='3D BBox', poly=bbox_3d)\n+\n+    def test_3d_hasz(self):\n+        \"\"\"\n+        Make sure data is 3D and has expected Z values -- shouldn't change\n+        because of coordinate system.\n+        \"\"\"\n+        self._load_interstate_data()\n+        for name, line, exp_z in interstate_data:\n             interstate = Interstate3D.objects.get(name=name)\n             interstate_proj = InterstateProj3D.objects.get(name=name)\n             for i in [interstate, interstate_proj]:\n                 self.assertTrue(i.line.hasz)\n                 self.assertEqual(exp_z, tuple(i.line.z))\n \n-        # Creating 3D Polygon.\n-        bbox2d, bbox3d = gen_bbox()\n-        Polygon2D.objects.create(name='2D BBox', poly=bbox2d)\n-        Polygon3D.objects.create(name='3D BBox', poly=bbox3d)\n+        self._load_city_data()\n+        for name, pnt_data in city_data:\n+            city = City3D.objects.get(name=name)\n+            z = pnt_data[2]\n+            self.assertTrue(city.point.hasz)\n+            self.assertEqual(z, city.point.z)\n+\n+    def test_3d_polygons(self):\n+        \"\"\"\n+        Test the creation of polygon 3D models.\n+        \"\"\"\n+        self._load_polygon_data()\n         p3d = Polygon3D.objects.get(name='3D BBox')\n         self.assertTrue(p3d.poly.hasz)\n-        self.assertEqual(bbox3d, p3d.poly)\n-\n-    def test01a_3d_layermapping(self):\n-        \"Testing LayerMapping on 3D models.\"\n-        from .models import Point2D, Point3D\n+        self.assertIsInstance(p3d.poly, Polygon)\n+        self.assertEqual(p3d.poly.srid, 32140)\n \n+    def test_3d_layermapping(self):\n+        \"\"\"\n+        Testing LayerMapping on 3D models.\n+        \"\"\"\n         point_mapping = {'point' : 'POINT'}\n         mpoint_mapping = {'mpoint' : 'MULTIPOINT'}\n \n@@ -134,34 +145,46 @@ def test01a_3d_layermapping(self):\n         lm.save()\n         self.assertEqual(3, MultiPoint3D.objects.count())\n \n-    def test02a_kml(self):\n-        \"Test GeoQuerySet.kml() with Z values.\"\n+    def test_kml(self):\n+        \"\"\"\n+        Test GeoQuerySet.kml() with Z values.\n+        \"\"\"\n+        self._load_city_data()\n         h = City3D.objects.kml(precision=6).get(name='Houston')\n         # KML should be 3D.\n         # `SELECT ST_AsKML(point, 6) FROM geo3d_city3d WHERE name = 'Houston';`\n         ref_kml_regex = re.compile(r'^<Point><coordinates>-95.363\\d+,29.763\\d+,18</coordinates></Point>$')\n         self.assertTrue(ref_kml_regex.match(h.kml))\n \n-    def test02b_geojson(self):\n-        \"Test GeoQuerySet.geojson() with Z values.\"\n+    def test_geojson(self):\n+        \"\"\"\n+        Test GeoQuerySet.geojson() with Z values.\n+        \"\"\"\n+        self._load_city_data()\n         h = City3D.objects.geojson(precision=6).get(name='Houston')\n         # GeoJSON should be 3D\n         # `SELECT ST_AsGeoJSON(point, 6) FROM geo3d_city3d WHERE name='Houston';`\n         ref_json_regex = re.compile(r'^{\"type\":\"Point\",\"coordinates\":\\[-95.363151,29.763374,18(\\.0+)?\\]}$')\n         self.assertTrue(ref_json_regex.match(h.geojson))\n \n-    def test03a_union(self):\n-        \"Testing the Union aggregate of 3D models.\"\n+    def test_union(self):\n+        \"\"\"\n+        Testing the Union aggregate of 3D models.\n+        \"\"\"\n         # PostGIS query that returned the reference EWKT for this test:\n         #  `SELECT ST_AsText(ST_Union(point)) FROM geo3d_city3d;`\n+        self._load_city_data()\n         ref_ewkt = 'SRID=4326;MULTIPOINT(-123.305196 48.462611 15,-104.609252 38.255001 1433,-97.521157 34.464642 380,-96.801611 32.782057 147,-95.363151 29.763374 18,-95.23506 38.971823 251,-87.650175 41.850385 181,174.783117 -41.315268 14)'\n         ref_union = GEOSGeometry(ref_ewkt)\n         union = City3D.objects.aggregate(Union('point'))['point__union']\n         self.assertTrue(union.hasz)\n         self.assertEqual(ref_union, union)\n \n-    def test03b_extent(self):\n-        \"Testing the Extent3D aggregate for 3D models.\"\n+    def test_extent(self):\n+        \"\"\"\n+        Testing the Extent3D aggregate for 3D models.\n+        \"\"\"\n+        self._load_city_data()\n         # `SELECT ST_Extent3D(point) FROM geo3d_city3d;`\n         ref_extent3d = (-123.305196, -41.315268, 14,174.783117, 48.462611, 1433)\n         extent1 = City3D.objects.aggregate(Extent3D('point'))['point__extent3d']\n@@ -174,8 +197,11 @@ def check_extent3d(extent3d, tol=6):\n         for e3d in [extent1, extent2]:\n             check_extent3d(e3d)\n \n-    def test04_perimeter(self):\n-        \"Testing GeoQuerySet.perimeter() on 3D fields.\"\n+    def test_perimeter(self):\n+        \"\"\"\n+        Testing GeoQuerySet.perimeter() on 3D fields.\n+        \"\"\"\n+        self._load_polygon_data()\n         # Reference query for values below:\n         #  `SELECT ST_Perimeter3D(poly), ST_Perimeter2D(poly) FROM geo3d_polygon3d;`\n         ref_perim_3d = 76859.2620451\n@@ -188,12 +214,15 @@ def test04_perimeter(self):\n                                Polygon3D.objects.perimeter().get(name='3D BBox').perimeter.m,\n                                tol)\n \n-    def test05_length(self):\n-        \"Testing GeoQuerySet.length() on 3D fields.\"\n+    def test_length(self):\n+        \"\"\"\n+        Testing GeoQuerySet.length() on 3D fields.\n+        \"\"\"\n         # ST_Length_Spheroid Z-aware, and thus does not need to use\n         # a separate function internally.\n         # `SELECT ST_Length_Spheroid(line, 'SPHEROID[\"GRS 1980\",6378137,298.257222101]')\n         #    FROM geo3d_interstate[2d|3d];`\n+        self._load_interstate_data()\n         tol = 3\n         ref_length_2d = 4368.1721949481\n         ref_length_3d = 4368.62547052088\n@@ -217,16 +246,22 @@ def test05_length(self):\n                                InterstateProj3D.objects.length().get(name='I-45').length.m,\n                                tol)\n \n-    def test06_scale(self):\n-        \"Testing GeoQuerySet.scale() on Z values.\"\n+    def test_scale(self):\n+        \"\"\"\n+        Testing GeoQuerySet.scale() on Z values.\n+        \"\"\"\n+        self._load_city_data()\n         # Mapping of City name to reference Z values.\n         zscales = (-3, 4, 23)\n         for zscale in zscales:\n             for city in City3D.objects.scale(1.0, 1.0, zscale):\n                 self.assertEqual(city_dict[city.name][2] * zscale, city.scale.z)\n \n-    def test07_translate(self):\n-        \"Testing GeoQuerySet.translate() on Z values.\"\n+    def test_translate(self):\n+        \"\"\"\n+        Testing GeoQuerySet.translate() on Z values.\n+        \"\"\"\n+        self._load_city_data()\n         ztranslations = (5.23, 23, -17)\n         for ztrans in ztranslations:\n             for city in City3D.objects.translate(0, 0, ztrans):"
        },
        {
            "sha": "0e9c5c44a3997776d857e9309cbad8db65e7a87e",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,5 @@\n-from __future__ import absolute_import\n+# -*- encoding: utf-8 -*-\n+from __future__ import absolute_import, unicode_literals\n \n from datetime import datetime\n \n@@ -26,7 +27,7 @@ def test_update(self):\n \n     def test_kmz(self):\n         \"Testing `render_to_kmz` with non-ASCII data. See #11624.\"\n-        name = '\\xc3\\x85land Islands'.decode('iso-8859-1')\n+        name = \"√Öland Islands\"\n         places = [{'name' : name,\n                   'description' : name,\n                   'kml' : '<Point><coordinates>5.0,23.0</coordinates></Point>'"
        },
        {
            "sha": "8f2c22e841b33842285a0f2a3b7758fe3f4593a5",
            "filename": "django/contrib/gis/tests/geoapp/tests.py",
            "status": "modified",
            "additions": 31,
            "deletions": 16,
            "changes": 47,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -11,7 +11,7 @@\n     no_mysql, no_oracle, no_spatialite,\n     mysql, oracle, postgis, spatialite)\n from django.test import TestCase\n-from django.utils import six\n+from django.utils import six, unittest\n \n from .models import Country, City, PennsylvaniaCity, State, Track\n \n@@ -295,6 +295,13 @@ def test_left_right_lookups(self):\n         self.assertEqual(2, len(qs))\n         for c in qs: self.assertEqual(True, c.name in cities)\n \n+    # The left/right lookup tests are known failures on PostGIS 2.0+\n+    # until the following bug is fixed:\n+    #  http://trac.osgeo.org/postgis/ticket/2035\n+    # TODO: Ensure fixed in 2.0.2, else modify upper bound for version here.\n+    if (2, 0, 0) <= connection.ops.spatial_version <= (2, 0, 1):\n+        test_left_right_lookups = unittest.expectedFailure(test_left_right_lookups)\n+\n     def test_equals_lookups(self):\n         \"Testing the 'same_as' and 'equals' lookup types.\"\n         pnt = fromstr('POINT (-95.363151 29.763374)', srid=4326)\n@@ -467,21 +474,21 @@ def test_geohash(self):\n \n     def test_geojson(self):\n         \"Testing GeoJSON output from the database using GeoQuerySet.geojson().\"\n-        # Only PostGIS 1.3.4+ supports GeoJSON.\n+        # Only PostGIS 1.3.4+ and SpatiaLite 3.0+ support GeoJSON.\n         if not connection.ops.geojson:\n             self.assertRaises(NotImplementedError, Country.objects.all().geojson, field_name='mpoly')\n             return\n \n-        if connection.ops.spatial_version >= (1, 4, 0):\n-            pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.609252,38.255001]}'\n-            houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"coordinates\":[-95.363151,29.763374]}'\n-            victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.305196,48.462611]}'\n-            chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n-        else:\n+        pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.609252,38.255001]}'\n+        houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"coordinates\":[-95.363151,29.763374]}'\n+        victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.305196,48.462611]}'\n+        chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n+        if postgis and connection.ops.spatial_version < (1, 4, 0):\n             pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.60925200,38.25500100]}'\n             houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"EPSG\",\"properties\":{\"EPSG\":4326}},\"coordinates\":[-95.36315100,29.76337400]}'\n             victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.30519600,48.46261100]}'\n-            chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"EPSG\",\"properties\":{\"EPSG\":4326}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n+        elif spatialite:\n+            victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.305196,48.462611,-123.305196,48.462611],\"coordinates\":[-123.305196,48.462611]}'\n \n         # Precision argument should only be an integer\n         self.assertRaises(TypeError, City.objects.geojson, precision='foo')\n@@ -520,15 +527,20 @@ def test_gml(self):\n         if oracle:\n             # No precision parameter for Oracle :-/\n             gml_regex = re.compile(r'^<gml:Point srsName=\"SDO:4326\" xmlns:gml=\"http://www.opengis.net/gml\"><gml:coordinates decimal=\"\\.\" cs=\",\" ts=\" \">-104.60925\\d+,38.25500\\d+ </gml:coordinates></gml:Point>')\n-        elif spatialite:\n-            # Spatialite has extra colon in SrsName\n+        elif spatialite and connection.ops.spatial_version < (3, 0, 0):\n+            # Spatialite before 3.0 has extra colon in SrsName\n             gml_regex = re.compile(r'^<gml:Point SrsName=\"EPSG::4326\"><gml:coordinates decimal=\"\\.\" cs=\",\" ts=\" \">-104.609251\\d+,38.255001</gml:coordinates></gml:Point>')\n         else:\n             gml_regex = re.compile(r'^<gml:Point srsName=\"EPSG:4326\"><gml:coordinates>-104\\.60925\\d+,38\\.255001</gml:coordinates></gml:Point>')\n \n         for ptown in [ptown1, ptown2]:\n             self.assertTrue(gml_regex.match(ptown.gml))\n \n+        # PostGIS < 1.5 doesn't include dimension im GMLv3 output.\n+        if postgis and connection.ops.spatial_version >= (1, 5, 0):\n+            self.assertIn('<gml:pos srsDimension=\"2\">',\n+                          City.objects.gml(version=3).get(name='Pueblo').gml)\n+\n     def test_kml(self):\n         \"Testing KML output from the database using GeoQuerySet.kml().\"\n         # Only PostGIS and Spatialite (>=2.4.0-RC4) support KML serialization\n@@ -572,12 +584,15 @@ def test_make_line(self):\n     def test_num_geom(self):\n         \"Testing the `num_geom` GeoQuerySet method.\"\n         # Both 'countries' only have two geometries.\n-        for c in Country.objects.num_geom(): self.assertEqual(2, c.num_geom)\n+        for c in Country.objects.num_geom():\n+            self.assertEqual(2, c.num_geom)\n+\n         for c in City.objects.filter(point__isnull=False).num_geom():\n-            # Oracle will return 1 for the number of geometries on non-collections,\n-            # whereas PostGIS will return None.\n-            if postgis:\n-                self.assertEqual(None, c.num_geom)\n+            # Oracle and PostGIS 2.0+ will return 1 for the number of\n+            # geometries on non-collections, whereas PostGIS < 2.0.0\n+            # will return None.\n+            if postgis and connection.ops.spatial_version < (2, 0, 0):\n+                self.assertIsNone(c.num_geom)\n             else:\n                 self.assertEqual(1, c.num_geom)\n "
        },
        {
            "sha": "8fc39db58d1625da876001683df1a22d440277d7",
            "filename": "django/contrib/gis/tests/inspectapp/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Finspectapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Finspectapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Finspectapp%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@\n \n from django.db import connections\n from django.test import TestCase\n-from django.contrib.gis.gdal import Driver\n+from django.contrib.gis.gdal import Driver, GDAL_VERSION\n from django.contrib.gis.geometry.test_data import TEST_DATA\n from django.contrib.gis.utils.ogrinspect import ogrinspect\n \n@@ -74,15 +74,33 @@ def test_time_field(self):\n             '',\n             'class Measurement(models.Model):',\n             '    f_decimal = models.DecimalField(max_digits=0, decimal_places=0)',\n+        ]\n+\n+        if GDAL_VERSION < (1, 9, 0):\n+            # Prior to GDAL 1.9, the order of the model fields was not\n+            # the same as the columns in the database.\n+            expected.extend([\n             '    f_int = models.IntegerField()',\n             '    f_datetime = models.DateTimeField()',\n             '    f_time = models.TimeField()',\n             '    f_float = models.FloatField()',\n             '    f_char = models.CharField(max_length=10)',\n             '    f_date = models.DateField()',\n+            ])\n+        else:\n+            expected.extend([\n+            '    f_float = models.FloatField()',\n+            '    f_int = models.IntegerField()',\n+            '    f_char = models.CharField(max_length=10)',\n+            '    f_date = models.DateField()',\n+            '    f_datetime = models.DateTimeField()',\n+            '    f_time = models.TimeField()',\n+            ])\n+\n+        expected.extend([\n             '    geom = models.PolygonField()',\n             '    objects = models.GeoManager()',\n-        ]\n+        ])\n \n         self.assertEqual(model_def, '\\n'.join(expected))\n "
        },
        {
            "sha": "a976954d25254de72299ad4c096093becdf1cb63",
            "filename": "django/contrib/gis/tests/layermap/tests.py",
            "status": "modified",
            "additions": 42,
            "deletions": 1,
            "changes": 43,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Flayermap%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,5 @@\n-from __future__ import absolute_import\n+# coding: utf-8\n+from __future__ import absolute_import, unicode_literals\n \n import os\n from copy import copy\n@@ -8,7 +9,10 @@\n from django.contrib.gis.tests.utils import mysql\n from django.contrib.gis.utils.layermapping import (LayerMapping, LayerMapError,\n     InvalidDecimal, MissingForeignKey)\n+from django.db import router\n+from django.conf import settings\n from django.test import TestCase\n+from django.utils import unittest\n \n from .models import (\n     City, County, CountyFeat, Interstate, ICity1, ICity2, Invalid, State,\n@@ -26,6 +30,7 @@\n NUMS   = [1, 2, 1, 19, 1] # Number of polygons for each.\n STATES = ['Texas', 'Texas', 'Texas', 'Hawaii', 'Colorado']\n \n+\n class LayerMapTest(TestCase):\n \n     def test_init(self):\n@@ -281,3 +286,39 @@ def test_textfield(self):\n         lm.save(silent=True, strict=True)\n         self.assertEqual(City.objects.count(), 3)\n         self.assertEqual(City.objects.all().order_by('name_txt')[0].name_txt, \"Houston\")\n+\n+    def test_encoded_name(self):\n+        \"\"\" Test a layer containing utf-8-encoded name \"\"\"\n+        city_shp = os.path.join(shp_path, 'ch-city', 'ch-city.shp')\n+        lm = LayerMapping(City, city_shp, city_mapping)\n+        lm.save(silent=True, strict=True)\n+        self.assertEqual(City.objects.count(), 1)\n+        self.assertEqual(City.objects.all()[0].name, \"Z√ºrich\")\n+\n+class OtherRouter(object):\n+    def db_for_read(self, model, **hints):\n+        return 'other'\n+\n+    def db_for_write(self, model, **hints):\n+        return self.db_for_read(model, **hints)\n+\n+    def allow_relation(self, obj1, obj2, **hints):\n+        return None\n+\n+    def allow_syncdb(self, db, model):\n+        return True\n+\n+\n+class LayerMapRouterTest(TestCase):\n+\n+    def setUp(self):\n+        self.old_routers = router.routers\n+        router.routers = [OtherRouter()]\n+\n+    def tearDown(self):\n+        router.routers = self.old_routers\n+\n+    @unittest.skipUnless(len(settings.DATABASES) > 1, 'multiple databases required')\n+    def test_layermapping_default_db(self):\n+        lm = LayerMapping(City, city_shp, city_mapping)\n+        self.assertEqual(lm.using, 'other')"
        },
        {
            "sha": "8a793b96c3ab8c6553bfe22733a25864230fa650",
            "filename": "django/contrib/gis/utils/layermapping.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -9,7 +9,7 @@\n import sys\n from decimal import Decimal\n from django.core.exceptions import ObjectDoesNotExist\n-from django.db import connections, DEFAULT_DB_ALIAS\n+from django.db import connections, router\n from django.contrib.gis.db.models import GeometryField\n from django.contrib.gis.gdal import (CoordTransform, DataSource,\n     OGRException, OGRGeometry, OGRGeomType, SpatialReference)\n@@ -18,6 +18,8 @@\n from django.db import models, transaction\n from django.contrib.localflavor.us.models import USStateField\n from django.utils import six\n+from django.utils.encoding import force_text\n+\n \n # LayerMapping exceptions.\n class LayerMapError(Exception): pass\n@@ -65,9 +67,9 @@ class LayerMapping(object):\n                          }\n \n     def __init__(self, model, data, mapping, layer=0,\n-                 source_srs=None, encoding=None,\n+                 source_srs=None, encoding='utf-8',\n                  transaction_mode='commit_on_success',\n-                 transform=True, unique=None, using=DEFAULT_DB_ALIAS):\n+                 transform=True, unique=None, using=None):\n         \"\"\"\n         A LayerMapping object is initialized using the given Model (not an instance),\n         a DataSource (or string path to an OGR-supported data file), and a mapping\n@@ -76,13 +78,13 @@ def __init__(self, model, data, mapping, layer=0,\n         \"\"\"\n         # Getting the DataSource and the associated Layer.\n         if isinstance(data, six.string_types):\n-            self.ds = DataSource(data)\n+            self.ds = DataSource(data, encoding=encoding)\n         else:\n             self.ds = data\n         self.layer = self.ds[layer]\n \n-        self.using = using\n-        self.spatial_backend = connections[using].ops\n+        self.using = using if using is not None else router.db_for_write(model)\n+        self.spatial_backend = connections[self.using].ops\n \n         # Setting the mapping & model attributes.\n         self.mapping = mapping\n@@ -330,7 +332,7 @@ def verify_ogr_field(self, ogr_field, model_field):\n             if self.encoding:\n                 # The encoding for OGR data sources may be specified here\n                 # (e.g., 'cp437' for Census Bureau boundary files).\n-                val = six.text_type(ogr_field.value, self.encoding)\n+                val = force_text(ogr_field.value, self.encoding)\n             else:\n                 val = ogr_field.value\n                 if model_field.max_length and len(val) > model_field.max_length:"
        },
        {
            "sha": "1c870eaa30b10656ea071d4243d3b0e20891bc0d",
            "filename": "django/contrib/gis/utils/ogrinspect.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -2,8 +2,6 @@\n This module is for inspecting OGR data sources and generating either\n models for GeoDjango and/or mapping dictionaries for use with the\n `LayerMapping` utility.\n-\n-Author: Travis Pinney, Dane Springmeyer, & Justin Bronn\n \"\"\"\n from django.utils.six.moves import zip\n # Requires GDAL to use."
        },
        {
            "sha": "0e46126adbd1fa29eb9bcf1186260c58a9b51a0a",
            "filename": "django/contrib/humanize/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 48,
            "deletions": 48,
            "changes": 96,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fhumanize%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fhumanize%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:40+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:57+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,276 +13,276 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: tests.py:108 templatetags/humanize.py:164\n+#: tests.py:125 templatetags/humanize.py:167\n msgid \"today\"\n msgstr \"\"\n \n-#: tests.py:108 templatetags/humanize.py:168\n+#: tests.py:125 templatetags/humanize.py:171\n msgid \"yesterday\"\n msgstr \"\"\n \n-#: tests.py:108 templatetags/humanize.py:166\n+#: tests.py:125 templatetags/humanize.py:169\n msgid \"tomorrow\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:24\n+#: templatetags/humanize.py:25\n msgid \"th\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:24\n+#: templatetags/humanize.py:25\n msgid \"st\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:24\n+#: templatetags/humanize.py:25\n msgid \"nd\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:24\n+#: templatetags/humanize.py:25\n msgid \"rd\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:53\n+#: templatetags/humanize.py:54\n #, python-format\n msgid \"%(value).1f million\"\n msgid_plural \"%(value).1f million\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:54\n+#: templatetags/humanize.py:55\n #, python-format\n msgid \"%(value)s million\"\n msgid_plural \"%(value)s million\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:57\n+#: templatetags/humanize.py:58\n #, python-format\n msgid \"%(value).1f billion\"\n msgid_plural \"%(value).1f billion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:58\n+#: templatetags/humanize.py:59\n #, python-format\n msgid \"%(value)s billion\"\n msgid_plural \"%(value)s billion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:61\n+#: templatetags/humanize.py:62\n #, python-format\n msgid \"%(value).1f trillion\"\n msgid_plural \"%(value).1f trillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:62\n+#: templatetags/humanize.py:63\n #, python-format\n msgid \"%(value)s trillion\"\n msgid_plural \"%(value)s trillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:65\n+#: templatetags/humanize.py:66\n #, python-format\n msgid \"%(value).1f quadrillion\"\n msgid_plural \"%(value).1f quadrillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:66\n+#: templatetags/humanize.py:67\n #, python-format\n msgid \"%(value)s quadrillion\"\n msgid_plural \"%(value)s quadrillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:69\n+#: templatetags/humanize.py:70\n #, python-format\n msgid \"%(value).1f quintillion\"\n msgid_plural \"%(value).1f quintillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:70\n+#: templatetags/humanize.py:71\n #, python-format\n msgid \"%(value)s quintillion\"\n msgid_plural \"%(value)s quintillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:73\n+#: templatetags/humanize.py:74\n #, python-format\n msgid \"%(value).1f sextillion\"\n msgid_plural \"%(value).1f sextillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:74\n+#: templatetags/humanize.py:75\n #, python-format\n msgid \"%(value)s sextillion\"\n msgid_plural \"%(value)s sextillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:77\n+#: templatetags/humanize.py:78\n #, python-format\n msgid \"%(value).1f septillion\"\n msgid_plural \"%(value).1f septillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:78\n+#: templatetags/humanize.py:79\n #, python-format\n msgid \"%(value)s septillion\"\n msgid_plural \"%(value)s septillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:81\n+#: templatetags/humanize.py:82\n #, python-format\n msgid \"%(value).1f octillion\"\n msgid_plural \"%(value).1f octillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:82\n+#: templatetags/humanize.py:83\n #, python-format\n msgid \"%(value)s octillion\"\n msgid_plural \"%(value)s octillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:85\n+#: templatetags/humanize.py:86\n #, python-format\n msgid \"%(value).1f nonillion\"\n msgid_plural \"%(value).1f nonillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:86\n+#: templatetags/humanize.py:87\n #, python-format\n msgid \"%(value)s nonillion\"\n msgid_plural \"%(value)s nonillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:89\n+#: templatetags/humanize.py:90\n #, python-format\n msgid \"%(value).1f decillion\"\n msgid_plural \"%(value).1f decillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:90\n+#: templatetags/humanize.py:91\n #, python-format\n msgid \"%(value)s decillion\"\n msgid_plural \"%(value)s decillion\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:93\n+#: templatetags/humanize.py:94\n #, python-format\n msgid \"%(value).1f googol\"\n msgid_plural \"%(value).1f googol\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:94\n+#: templatetags/humanize.py:95\n #, python-format\n msgid \"%(value)s googol\"\n msgid_plural \"%(value)s googol\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"one\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"two\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"three\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"four\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"five\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"six\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"seven\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"eight\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:143\n+#: templatetags/humanize.py:144\n msgid \"nine\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:185\n+#: templatetags/humanize.py:190\n #, python-format\n msgctxt \"naturaltime\"\n msgid \"%(delta)s ago\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:188 templatetags/humanize.py:210\n+#: templatetags/humanize.py:193 templatetags/humanize.py:215\n msgid \"now\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:191\n+#: templatetags/humanize.py:196\n #, python-format\n msgid \"a second ago\"\n msgid_plural \"%(count)s seconds ago\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:196\n+#: templatetags/humanize.py:201\n #, python-format\n msgid \"a minute ago\"\n msgid_plural \"%(count)s minutes ago\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:201\n+#: templatetags/humanize.py:206\n #, python-format\n msgid \"an hour ago\"\n msgid_plural \"%(count)s hours ago\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:207\n+#: templatetags/humanize.py:212\n #, python-format\n msgctxt \"naturaltime\"\n msgid \"%(delta)s from now\"\n msgstr \"\"\n \n-#: templatetags/humanize.py:213\n+#: templatetags/humanize.py:218\n #, python-format\n msgid \"a second from now\"\n msgid_plural \"%(count)s seconds from now\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:218\n+#: templatetags/humanize.py:223\n #, python-format\n msgid \"a minute from now\"\n msgid_plural \"%(count)s minutes from now\"\n msgstr[0] \"\"\n msgstr[1] \"\"\n \n-#: templatetags/humanize.py:223\n+#: templatetags/humanize.py:228\n #, python-format\n msgid \"an hour from now\"\n msgid_plural \"%(count)s hours from now\""
        },
        {
            "sha": "785186fd28710d8d027647de6366d5bddc2760cb",
            "filename": "django/contrib/localflavor/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Flocalflavor%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Flocalflavor%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,2 @@\n+import warnings\n+warnings.warn(\"django.contrib.localflavor is deprecated. Use the separate django-localflavor-* packages instead.\", DeprecationWarning)"
        },
        {
            "sha": "ffccefdfbc818e1a88d004cb6ba8a3fc11aac359",
            "filename": "django/contrib/localflavor/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 211,
            "deletions": 188,
            "changes": 399,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Flocalflavor%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Flocalflavor%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:41+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:57+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -33,6 +33,10 @@ msgstr \"\"\n msgid \"Invalid CUIT.\"\n msgstr \"\"\n \n+#: ar/forms.py:84\n+msgid \"Invalid legal type. Type must be 27, 20, 23 or 30.\"\n+msgstr \"\"\n+\n #: at/at_states.py:5\n msgid \"Burgenland\"\n msgstr \"\"\n@@ -194,6 +198,14 @@ msgstr \"\"\n msgid \"Enter a postal code in the format XXX XXX.\"\n msgstr \"\"\n \n+#: ca/forms.py:47 us/forms.py:30\n+msgid \"Phone numbers must be in XXX-XXX-XXXX format.\"\n+msgstr \"\"\n+\n+#: ca/forms.py:69\n+msgid \"Enter a Canadian province or territory.\"\n+msgstr \"\"\n+\n #: ca/forms.py:110\n msgid \"Enter a valid Canadian Social Insurance number in XXX-XXX-XXX format.\"\n msgstr \"\"\n@@ -302,6 +314,10 @@ msgstr \"\"\n msgid \"Zurich\"\n msgstr \"\"\n \n+#: ch/forms.py:37\n+msgid \"Phone numbers must be in 0XX XXX XX XX format.\"\n+msgstr \"\"\n+\n #: ch/forms.py:68\n msgid \"\"\n \"Enter a valid Swiss identity or passport card number in X1234567<0 or \"\n@@ -413,14 +429,10 @@ msgid \"Enter a birth number in the format XXXXXX/XXXX or XXXXXXXXXX.\"\n msgstr \"\"\n \n #: cz/forms.py:53\n-msgid \"Invalid optional parameter Gender, valid values are 'f' and 'm'\"\n-msgstr \"\"\n-\n-#: cz/forms.py:54\n msgid \"Enter a valid birth number.\"\n msgstr \"\"\n \n-#: cz/forms.py:115\n+#: cz/forms.py:102\n msgid \"Enter a valid IC number.\"\n msgstr \"\"\n \n@@ -499,7 +511,7 @@ msgid \"\"\n msgstr \"\"\n \n #: es/es_provinces.py:5\n-msgid \"Arava\"\n+msgid \"Araba\"\n msgstr \"\"\n \n #: es/es_provinces.py:6\n@@ -1093,11 +1105,26 @@ msgstr \"\"\n msgid \"Wales\"\n msgstr \"\"\n \n-#: hr/forms.py:75\n-msgid \"Enter a valid 13 digit JMBG\"\n+#: hk/forms.py:37\n+#, python-format\n+msgid \"Phone number should not start with one of the followings: %s.\"\n+msgstr \"\"\n+\n+#: hk/forms.py:40\n+#, python-format\n+msgid \"Phone number must be in one of the following formats: %s.\"\n+msgstr \"\"\n+\n+#: hk/forms.py:42\n+#, python-format\n+msgid \"Phone number should start with one of the followings: %s.\"\n msgstr \"\"\n \n #: hr/forms.py:76\n+msgid \"Enter a valid 13 digit JMBG\"\n+msgstr \"\"\n+\n+#: hr/forms.py:77\n msgid \"Error in date segment\"\n msgstr \"\"\n \n@@ -1141,87 +1168,87 @@ msgstr \"\"\n msgid \"Card issue number cannot be zero\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:12\n+#: hr/hr_choices.py:14\n msgid \"Grad Zagreb\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:13\n+#: hr/hr_choices.py:15\n msgid \"Bjelovarsko-bilogorska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:14\n+#: hr/hr_choices.py:16\n msgid \"Brodsko-posavska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:15\n+#: hr/hr_choices.py:17\n msgid \"Dubrovaƒçko-neretvanska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:16\n+#: hr/hr_choices.py:18\n msgid \"Istarska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:17\n+#: hr/hr_choices.py:19\n msgid \"Karlovaƒçka ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:18\n+#: hr/hr_choices.py:20\n msgid \"Koprivniƒçko-kri≈æevaƒçka ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:19\n+#: hr/hr_choices.py:21\n msgid \"Krapinsko-zagorska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:20\n+#: hr/hr_choices.py:22\n msgid \"Liƒçko-senjska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:21\n+#: hr/hr_choices.py:23\n msgid \"Meƒëimurska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:22\n+#: hr/hr_choices.py:24\n msgid \"Osjeƒçko-baranjska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:23\n+#: hr/hr_choices.py:25\n msgid \"Po≈æe≈°ko-slavonska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:24\n+#: hr/hr_choices.py:26\n msgid \"Primorsko-goranska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:25\n+#: hr/hr_choices.py:27\n msgid \"Sisaƒçko-moslavaƒçka ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:26\n+#: hr/hr_choices.py:28\n msgid \"Splitsko-dalmatinska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:27\n+#: hr/hr_choices.py:29\n msgid \"≈†ibensko-kninska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:28\n+#: hr/hr_choices.py:30\n msgid \"Vara≈ædinska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:29\n+#: hr/hr_choices.py:31\n msgid \"Virovitiƒçko-podravska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:30\n+#: hr/hr_choices.py:32\n msgid \"Vukovarsko-srijemska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:31\n+#: hr/hr_choices.py:33\n msgid \"Zadarska ≈æupanija\"\n msgstr \"\"\n \n-#: hr/hr_choices.py:32\n+#: hr/hr_choices.py:34\n msgid \"Zagrebaƒçka ≈æupanija\"\n msgstr \"\"\n \n@@ -1625,11 +1652,11 @@ msgstr \"\"\n msgid \"Wicklow\"\n msgstr \"\"\n \n-#: il/forms.py:31\n+#: il/forms.py:32\n msgid \"Enter a postal code in the format XXXXX\"\n msgstr \"\"\n \n-#: il/forms.py:50\n+#: il/forms.py:51\n msgid \"Enter a valid ID number.\"\n msgstr \"\"\n \n@@ -1858,7 +1885,7 @@ msgstr \"\"\n msgid \"Okinawa\"\n msgstr \"\"\n \n-#: kw/forms.py:25\n+#: kw/forms.py:27\n msgid \"Enter a valid Kuwaiti Civil ID number\"\n msgstr \"\"\n \n@@ -1880,339 +1907,339 @@ msgstr \"\"\n msgid \"The UMCN is not valid.\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:8\n+#: mk/mk_choices.py:10\n msgid \"Aerodrom\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:9\n+#: mk/mk_choices.py:11\n msgid \"Araƒçinovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:10\n+#: mk/mk_choices.py:12\n msgid \"Berovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:11\n+#: mk/mk_choices.py:13\n msgid \"Bitola\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:12\n+#: mk/mk_choices.py:14\n msgid \"Bogdanci\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:13\n+#: mk/mk_choices.py:15\n msgid \"Bogovinje\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:14\n+#: mk/mk_choices.py:16\n msgid \"Bosilovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:15\n+#: mk/mk_choices.py:17\n msgid \"Brvenica\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:16\n+#: mk/mk_choices.py:18\n msgid \"Butel\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:17\n+#: mk/mk_choices.py:19\n msgid \"Valandovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:18\n+#: mk/mk_choices.py:20\n msgid \"Vasilevo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:19\n+#: mk/mk_choices.py:21\n msgid \"Vevƒçani\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:20\n+#: mk/mk_choices.py:22\n msgid \"Veles\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:21\n+#: mk/mk_choices.py:23\n msgid \"Vinica\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:22\n+#: mk/mk_choices.py:24\n msgid \"Vrane≈°tica\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:23\n+#: mk/mk_choices.py:25\n msgid \"Vrapƒçi≈°te\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:24\n+#: mk/mk_choices.py:26\n msgid \"Gazi Baba\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:25\n+#: mk/mk_choices.py:27\n msgid \"Gevgelija\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:26\n+#: mk/mk_choices.py:28\n msgid \"Gostivar\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:27\n+#: mk/mk_choices.py:29\n msgid \"Gradsko\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:28\n+#: mk/mk_choices.py:30\n msgid \"Debar\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:29\n+#: mk/mk_choices.py:31\n msgid \"Debarca\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:30\n+#: mk/mk_choices.py:32\n msgid \"Delƒçevo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:31\n+#: mk/mk_choices.py:33\n msgid \"Demir Kapija\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:32\n+#: mk/mk_choices.py:34\n msgid \"Demir Hisar\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:33\n+#: mk/mk_choices.py:35\n msgid \"Dolneni\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:34\n+#: mk/mk_choices.py:36\n msgid \"Drugovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:35\n+#: mk/mk_choices.py:37\n msgid \"Gjorƒçe Petrov\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:36\n+#: mk/mk_choices.py:38\n msgid \"≈Ωelino\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:37\n+#: mk/mk_choices.py:39\n msgid \"Zajas\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:38\n+#: mk/mk_choices.py:40\n msgid \"Zelenikovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:39\n+#: mk/mk_choices.py:41\n msgid \"Zrnovci\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:40\n+#: mk/mk_choices.py:42\n msgid \"Ilinden\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:41\n+#: mk/mk_choices.py:43\n msgid \"Jegunovce\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:42\n+#: mk/mk_choices.py:44\n msgid \"Kavadarci\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:43\n+#: mk/mk_choices.py:45\n msgid \"Karbinci\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:44\n+#: mk/mk_choices.py:46\n msgid \"Karpo≈°\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:45\n+#: mk/mk_choices.py:47\n msgid \"Kisela Voda\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:46\n+#: mk/mk_choices.py:48\n msgid \"Kiƒçevo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:47\n+#: mk/mk_choices.py:49\n msgid \"Konƒçe\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:48\n+#: mk/mk_choices.py:50\n msgid \"Koƒáani\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:49\n+#: mk/mk_choices.py:51\n msgid \"Kratovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:50\n+#: mk/mk_choices.py:52\n msgid \"Kriva Palanka\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:51\n+#: mk/mk_choices.py:53\n msgid \"Krivoga≈°tani\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:52\n+#: mk/mk_choices.py:54\n msgid \"Kru≈°evo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:53\n+#: mk/mk_choices.py:55\n msgid \"Kumanovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:54\n+#: mk/mk_choices.py:56\n msgid \"Lipkovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:55\n+#: mk/mk_choices.py:57\n msgid \"Lozovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:56\n+#: mk/mk_choices.py:58\n msgid \"Mavrovo i Rostu≈°a\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:57\n+#: mk/mk_choices.py:59\n msgid \"Makedonska Kamenica\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:58\n+#: mk/mk_choices.py:60\n msgid \"Makedonski Brod\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:59\n+#: mk/mk_choices.py:61\n msgid \"Mogila\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:60\n+#: mk/mk_choices.py:62\n msgid \"Negotino\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:61\n+#: mk/mk_choices.py:63\n msgid \"Novaci\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:62\n+#: mk/mk_choices.py:64\n msgid \"Novo Selo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:63\n+#: mk/mk_choices.py:65\n msgid \"Oslomej\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:64\n+#: mk/mk_choices.py:66\n msgid \"Ohrid\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:65\n+#: mk/mk_choices.py:67\n msgid \"Petrovec\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:66\n+#: mk/mk_choices.py:68\n msgid \"Pehƒçevo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:67\n+#: mk/mk_choices.py:69\n msgid \"Plasnica\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:68\n+#: mk/mk_choices.py:70\n msgid \"Prilep\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:69\n+#: mk/mk_choices.py:71\n msgid \"Probi≈°tip\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:70\n+#: mk/mk_choices.py:72\n msgid \"Radovi≈°\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:71\n+#: mk/mk_choices.py:73\n msgid \"Rankovce\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:72\n+#: mk/mk_choices.py:74\n msgid \"Resen\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:73\n+#: mk/mk_choices.py:75\n msgid \"Rosoman\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:74\n+#: mk/mk_choices.py:76\n msgid \"Saraj\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:75\n+#: mk/mk_choices.py:77\n msgid \"Sveti Nikole\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:76\n+#: mk/mk_choices.py:78\n msgid \"Sopi≈°te\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:77\n+#: mk/mk_choices.py:79\n msgid \"Star Dojran\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:78\n+#: mk/mk_choices.py:80\n msgid \"Staro Nagoriƒçane\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:79\n+#: mk/mk_choices.py:81\n msgid \"Struga\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:80\n+#: mk/mk_choices.py:82\n msgid \"Strumica\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:81\n+#: mk/mk_choices.py:83\n msgid \"Studeniƒçani\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:82\n+#: mk/mk_choices.py:84\n msgid \"Tearce\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:83\n+#: mk/mk_choices.py:85\n msgid \"Tetovo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:84\n+#: mk/mk_choices.py:86\n msgid \"Centar\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:85\n+#: mk/mk_choices.py:87\n msgid \"Centar-≈Ωupa\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:86\n+#: mk/mk_choices.py:88\n msgid \"ƒåair\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:87\n+#: mk/mk_choices.py:89\n msgid \"ƒåa≈°ka\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:88\n+#: mk/mk_choices.py:90\n msgid \"ƒåe≈°inovo-Oble≈°evo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:89\n+#: mk/mk_choices.py:91\n msgid \"ƒåuƒçer-Sandevo\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:90\n+#: mk/mk_choices.py:92\n msgid \"≈†tip\"\n msgstr \"\"\n \n-#: mk/mk_choices.py:91\n+#: mk/mk_choices.py:93\n msgid \"≈†uto Orizari\"\n msgstr \"\"\n \n@@ -2228,23 +2255,23 @@ msgstr \"\"\n msgid \"Unique master citizen number (13 digits)\"\n msgstr \"\"\n \n-#: mx/forms.py:65\n+#: mx/forms.py:67\n msgid \"Enter a valid zip code in the format XXXXX.\"\n msgstr \"\"\n \n-#: mx/forms.py:108\n+#: mx/forms.py:110\n msgid \"Enter a valid RFC.\"\n msgstr \"\"\n \n-#: mx/forms.py:109\n+#: mx/forms.py:111\n msgid \"Invalid checksum for RFC.\"\n msgstr \"\"\n \n-#: mx/forms.py:189\n+#: mx/forms.py:191\n msgid \"Enter a valid CURP.\"\n msgstr \"\"\n \n-#: mx/forms.py:190\n+#: mx/forms.py:192\n msgid \"Invalid checksum for CURP.\"\n msgstr \"\"\n \n@@ -2264,131 +2291,131 @@ msgstr \"\"\n msgid \"Mexican CURP\"\n msgstr \"\"\n \n-#: mx/mx_states.py:13\n+#: mx/mx_states.py:14\n msgid \"Aguascalientes\"\n msgstr \"\"\n \n-#: mx/mx_states.py:14\n+#: mx/mx_states.py:15\n msgid \"Baja California\"\n msgstr \"\"\n \n-#: mx/mx_states.py:15\n+#: mx/mx_states.py:16\n msgid \"Baja California Sur\"\n msgstr \"\"\n \n-#: mx/mx_states.py:16\n+#: mx/mx_states.py:17\n msgid \"Campeche\"\n msgstr \"\"\n \n-#: mx/mx_states.py:17\n+#: mx/mx_states.py:18\n msgid \"Chihuahua\"\n msgstr \"\"\n \n-#: mx/mx_states.py:18\n+#: mx/mx_states.py:19\n msgid \"Chiapas\"\n msgstr \"\"\n \n-#: mx/mx_states.py:19\n+#: mx/mx_states.py:20\n msgid \"Coahuila\"\n msgstr \"\"\n \n-#: mx/mx_states.py:20\n+#: mx/mx_states.py:21\n msgid \"Colima\"\n msgstr \"\"\n \n-#: mx/mx_states.py:21\n+#: mx/mx_states.py:22\n msgid \"Distrito Federal\"\n msgstr \"\"\n \n-#: mx/mx_states.py:22\n+#: mx/mx_states.py:23\n msgid \"Durango\"\n msgstr \"\"\n \n-#: mx/mx_states.py:23\n+#: mx/mx_states.py:24\n msgid \"Guerrero\"\n msgstr \"\"\n \n-#: mx/mx_states.py:24\n+#: mx/mx_states.py:25\n msgid \"Guanajuato\"\n msgstr \"\"\n \n-#: mx/mx_states.py:25\n+#: mx/mx_states.py:26\n msgid \"Hidalgo\"\n msgstr \"\"\n \n-#: mx/mx_states.py:26\n+#: mx/mx_states.py:27\n msgid \"Jalisco\"\n msgstr \"\"\n \n-#: mx/mx_states.py:27\n+#: mx/mx_states.py:28\n msgid \"Estado de M√©xico\"\n msgstr \"\"\n \n-#: mx/mx_states.py:28\n+#: mx/mx_states.py:29\n msgid \"Michoac√°n\"\n msgstr \"\"\n \n-#: mx/mx_states.py:29\n+#: mx/mx_states.py:30\n msgid \"Morelos\"\n msgstr \"\"\n \n-#: mx/mx_states.py:30\n+#: mx/mx_states.py:31\n msgid \"Nayarit\"\n msgstr \"\"\n \n-#: mx/mx_states.py:31\n+#: mx/mx_states.py:32\n msgid \"Nuevo Le√≥n\"\n msgstr \"\"\n \n-#: mx/mx_states.py:32\n+#: mx/mx_states.py:33\n msgid \"Oaxaca\"\n msgstr \"\"\n \n-#: mx/mx_states.py:33\n+#: mx/mx_states.py:34\n msgid \"Puebla\"\n msgstr \"\"\n \n-#: mx/mx_states.py:34\n+#: mx/mx_states.py:35\n msgid \"Quer√©taro\"\n msgstr \"\"\n \n-#: mx/mx_states.py:35\n+#: mx/mx_states.py:36\n msgid \"Quintana Roo\"\n msgstr \"\"\n \n-#: mx/mx_states.py:36\n+#: mx/mx_states.py:37\n msgid \"Sinaloa\"\n msgstr \"\"\n \n-#: mx/mx_states.py:37\n+#: mx/mx_states.py:38\n msgid \"San Luis Potos√≠\"\n msgstr \"\"\n \n-#: mx/mx_states.py:38\n+#: mx/mx_states.py:39\n msgid \"Sonora\"\n msgstr \"\"\n \n-#: mx/mx_states.py:39\n+#: mx/mx_states.py:40\n msgid \"Tabasco\"\n msgstr \"\"\n \n-#: mx/mx_states.py:40\n+#: mx/mx_states.py:41\n msgid \"Tamaulipas\"\n msgstr \"\"\n \n-#: mx/mx_states.py:41\n+#: mx/mx_states.py:42\n msgid \"Tlaxcala\"\n msgstr \"\"\n \n-#: mx/mx_states.py:42\n+#: mx/mx_states.py:43\n msgid \"Veracruz\"\n msgstr \"\"\n \n-#: mx/mx_states.py:43\n+#: mx/mx_states.py:44\n msgid \"Yucat√°n\"\n msgstr \"\"\n \n-#: mx/mx_states.py:44\n+#: mx/mx_states.py:45\n msgid \"Zacatecas\"\n msgstr \"\"\n \n@@ -2558,31 +2585,31 @@ msgstr \"\"\n msgid \"West Pomerania\"\n msgstr \"\"\n \n-#: pt/forms.py:17\n+#: pt/forms.py:19\n msgid \"Enter a zip code in the format XXXX-XXX.\"\n msgstr \"\"\n \n-#: pt/forms.py:37\n+#: pt/forms.py:39\n msgid \"Phone numbers must have 9 digits, or start by + or 00.\"\n msgstr \"\"\n \n-#: ro/forms.py:20\n+#: ro/forms.py:22\n msgid \"Enter a valid CIF.\"\n msgstr \"\"\n \n-#: ro/forms.py:57\n+#: ro/forms.py:59\n msgid \"Enter a valid CNP.\"\n msgstr \"\"\n \n-#: ro/forms.py:142\n+#: ro/forms.py:143\n msgid \"Enter a valid IBAN in ROXX-XXXX-XXXX-XXXX-XXXX-XXXX format\"\n msgstr \"\"\n \n-#: ro/forms.py:174\n+#: ro/forms.py:175\n msgid \"Phone numbers must be in XXXX-XXXXXX format.\"\n msgstr \"\"\n \n-#: ro/forms.py:199\n+#: ro/forms.py:200\n msgid \"Enter a valid postal code in the format XXXXXX\"\n msgstr \"\"\n \n@@ -2978,87 +3005,87 @@ msgstr \"\"\n msgid \"Enter a Swedish postal code in the format XXXXX.\"\n msgstr \"\"\n \n-#: se/se_counties.py:15\n+#: se/se_counties.py:16\n msgid \"Stockholm\"\n msgstr \"\"\n \n-#: se/se_counties.py:16\n+#: se/se_counties.py:17\n msgid \"V√§sterbotten\"\n msgstr \"\"\n \n-#: se/se_counties.py:17\n+#: se/se_counties.py:18\n msgid \"Norrbotten\"\n msgstr \"\"\n \n-#: se/se_counties.py:18\n+#: se/se_counties.py:19\n msgid \"Uppsala\"\n msgstr \"\"\n \n-#: se/se_counties.py:19\n+#: se/se_counties.py:20\n msgid \"S√∂dermanland\"\n msgstr \"\"\n \n-#: se/se_counties.py:20\n+#: se/se_counties.py:21\n msgid \"√ñsterg√∂tland\"\n msgstr \"\"\n \n-#: se/se_counties.py:21\n+#: se/se_counties.py:22\n msgid \"J√∂nk√∂ping\"\n msgstr \"\"\n \n-#: se/se_counties.py:22\n+#: se/se_counties.py:23\n msgid \"Kronoberg\"\n msgstr \"\"\n \n-#: se/se_counties.py:23\n+#: se/se_counties.py:24\n msgid \"Kalmar\"\n msgstr \"\"\n \n-#: se/se_counties.py:24\n+#: se/se_counties.py:25\n msgid \"Gotland\"\n msgstr \"\"\n \n-#: se/se_counties.py:25\n+#: se/se_counties.py:26\n msgid \"Blekinge\"\n msgstr \"\"\n \n-#: se/se_counties.py:26\n+#: se/se_counties.py:27\n msgid \"Sk√•ne\"\n msgstr \"\"\n \n-#: se/se_counties.py:27\n+#: se/se_counties.py:28\n msgid \"Halland\"\n msgstr \"\"\n \n-#: se/se_counties.py:28\n+#: se/se_counties.py:29\n msgid \"V√§stra G√∂taland\"\n msgstr \"\"\n \n-#: se/se_counties.py:29\n+#: se/se_counties.py:30\n msgid \"V√§rmland\"\n msgstr \"\"\n \n-#: se/se_counties.py:30\n+#: se/se_counties.py:31\n msgid \"√ñrebro\"\n msgstr \"\"\n \n-#: se/se_counties.py:31\n+#: se/se_counties.py:32\n msgid \"V√§stmanland\"\n msgstr \"\"\n \n-#: se/se_counties.py:32\n+#: se/se_counties.py:33\n msgid \"Dalarna\"\n msgstr \"\"\n \n-#: se/se_counties.py:33\n+#: se/se_counties.py:34\n msgid \"G√§vleborg\"\n msgstr \"\"\n \n-#: se/se_counties.py:34\n+#: se/se_counties.py:35\n msgid \"V√§sternorrland\"\n msgstr \"\"\n \n-#: se/se_counties.py:35\n+#: se/se_counties.py:36\n msgid \"J√§mtland\"\n msgstr \"\"\n \n@@ -3446,10 +3473,6 @@ msgstr \"\"\n msgid \"Enter a zip code in the format XXXXX or XXXXX-XXXX.\"\n msgstr \"\"\n \n-#: us/forms.py:30\n-msgid \"Phone numbers must be in XXX-XXX-XXXX format.\"\n-msgstr \"\"\n-\n #: us/forms.py:59\n msgid \"Enter a valid U.S. Social Security number in XXX-XX-XXXX format.\"\n msgstr \"\"\n@@ -3478,11 +3501,11 @@ msgstr \"\"\n msgid \"Enter a valid CI number.\"\n msgstr \"\"\n \n-#: za/forms.py:21\n+#: za/forms.py:22\n msgid \"Enter a valid South African ID number\"\n msgstr \"\"\n \n-#: za/forms.py:55\n+#: za/forms.py:56\n msgid \"Enter a valid South African postal code\"\n msgstr \"\"\n "
        },
        {
            "sha": "6f16dd041112db8c4953a068293251e9d2579d7d",
            "filename": "django/contrib/messages/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fmessages%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fmessages%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:43+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:57+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,6 +13,6 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: tests/base.py:100\n+#: tests/base.py:101\n msgid \"lazy message\"\n msgstr \"\""
        },
        {
            "sha": "885b5fdb97b0525a1246684b9e9768133df72803",
            "filename": "django/contrib/redirects/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fredirects%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fredirects%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fredirects%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:43+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:57+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,30 +13,30 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: models.py:7\n+#: models.py:9\n msgid \"redirect from\"\n msgstr \"\"\n \n-#: models.py:8\n+#: models.py:10\n msgid \"\"\n \"This should be an absolute path, excluding the domain name. Example: '/\"\n \"events/search/'.\"\n msgstr \"\"\n \n-#: models.py:9\n+#: models.py:11\n msgid \"redirect to\"\n msgstr \"\"\n \n-#: models.py:10\n+#: models.py:12\n msgid \"\"\n \"This can be either an absolute path (as above) or a full URL starting with \"\n \"'http://'.\"\n msgstr \"\"\n \n-#: models.py:13\n+#: models.py:15\n msgid \"redirect\"\n msgstr \"\"\n \n-#: models.py:14\n+#: models.py:16\n msgid \"redirects\"\n msgstr \"\""
        },
        {
            "sha": "927220d44d18ad9e98cebdd523b73d65b30d55a6",
            "filename": "django/contrib/redirects/middleware.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fredirects%2Fmiddleware.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fredirects%2Fmiddleware.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fredirects%2Fmiddleware.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,5 @@\n from django.contrib.redirects.models import Redirect\n+from django.contrib.sites.models import get_current_site\n from django import http\n from django.conf import settings\n \n@@ -7,14 +8,15 @@ def process_response(self, request, response):\n         if response.status_code != 404:\n             return response # No need to check for a redirect for non-404 responses.\n         path = request.get_full_path()\n+        current_site = get_current_site(request)\n         try:\n-            r = Redirect.objects.get(site__id__exact=settings.SITE_ID, old_path=path)\n+            r = Redirect.objects.get(site__id__exact=current_site.id, old_path=path)\n         except Redirect.DoesNotExist:\n             r = None\n         if r is None and settings.APPEND_SLASH:\n             # Try removing the trailing slash.\n             try:\n-                r = Redirect.objects.get(site__id__exact=settings.SITE_ID,\n+                r = Redirect.objects.get(site__id__exact=current_site.id,\n                     old_path=path[:path.rfind('/')]+path[path.rfind('/')+1:])\n             except Redirect.DoesNotExist:\n                 pass"
        },
        {
            "sha": "5147a71fe574c9aae47cc96d632f6a2287d64ee5",
            "filename": "django/contrib/sessions/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsessions%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsessions%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:43+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:57+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\""
        },
        {
            "sha": "fc2d8753d7c681a013355053c81cf93f1f0c2c17",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -12,6 +12,7 @@\n from django.contrib.sessions.backends.signed_cookies import SessionStore as CookieSession\n from django.contrib.sessions.models import Session\n from django.contrib.sessions.middleware import SessionMiddleware\n+from django.core.cache import DEFAULT_CACHE_ALIAS\n from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.http import HttpResponse\n from django.test import TestCase, RequestFactory\n@@ -133,6 +134,9 @@ def test_clear(self):\n         self.assertTrue(self.session.modified)\n \n     def test_save(self):\n+        if (hasattr(self.session, '_cache') and\n+                'DummyCache' in settings.CACHES[DEFAULT_CACHE_ALIAS]['BACKEND']):\n+            raise unittest.SkipTest(\"Session saving tests require a real cache backend\")\n         self.session.save()\n         self.assertTrue(self.session.exists(self.session.session_key))\n \n@@ -296,6 +300,8 @@ class CacheDBSessionTests(SessionTestsMixin, TestCase):\n \n     backend = CacheDBSession\n \n+    @unittest.skipIf('DummyCache' in settings.CACHES[DEFAULT_CACHE_ALIAS]['BACKEND'],\n+        \"Session saving tests require a real cache backend\")\n     def test_exists_searches_cache_first(self):\n         self.session.save()\n         with self.assertNumQueries(0):"
        },
        {
            "sha": "bbe8229aae5d18f115d90d8ec46f5bd98924da0c",
            "filename": "django/contrib/sitemaps/tests/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,5 +1,6 @@\n from django.contrib.auth.models import User\n from django.contrib.sites.models import Site\n+from django.core.cache import cache\n from django.test import TestCase\n \n \n@@ -11,6 +12,7 @@ class SitemapTestsBase(TestCase):\n     def setUp(self):\n         self.base_url = '%s://%s' % (self.protocol, self.domain)\n         self.old_Site_meta_installed = Site._meta.installed\n+        cache.clear()\n         # Create a user that will double as sitemap content\n         User.objects.create_user('testuser', 'test@example.com', 's3krit')\n "
        },
        {
            "sha": "ae054c95c28aa8cff371e9638dbd1409a2ca294f",
            "filename": "django/contrib/sitemaps/tests/generic.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -19,4 +19,4 @@ def test_generic_sitemap(self):\n %s\n </urlset>\n \"\"\" % expected\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)"
        },
        {
            "sha": "99042fef03ffaaa16f8c89f68907101c36d09511",
            "filename": "django/contrib/sitemaps/tests/http.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttp.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -26,7 +26,7 @@ def test_simple_sitemap_index(self):\n <sitemap><loc>%s/simple/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n \"\"\" % self.base_url\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @override_settings(\n         TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n@@ -40,7 +40,7 @@ def test_simple_sitemap_custom_index(self):\n <sitemap><loc>%s/simple/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n \"\"\" % self.base_url\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n \n     def test_simple_sitemap_section(self):\n@@ -51,7 +51,7 @@ def test_simple_sitemap_section(self):\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n \"\"\" % (self.base_url, date.today())\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     def test_simple_sitemap(self):\n         \"A simple sitemap can be rendered\"\n@@ -61,7 +61,7 @@ def test_simple_sitemap(self):\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n \"\"\" % (self.base_url, date.today())\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @override_settings(\n         TEMPLATE_DIRS=(os.path.join(os.path.dirname(__file__), 'templates'),)\n@@ -75,7 +75,7 @@ def test_simple_custom_sitemap(self):\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n \"\"\" % (self.base_url, date.today())\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @skipUnless(settings.USE_I18N, \"Internationalization is not enabled\")\n     @override_settings(USE_L10N=True)\n@@ -101,7 +101,7 @@ def test_requestsite_sitemap(self):\n <url><loc>http://testserver/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n \"\"\" % date.today()\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     @skipUnless(\"django.contrib.sites\" in settings.INSTALLED_APPS,\n                 \"django.contrib.sites app not installed.\")\n@@ -143,4 +143,4 @@ def test_cached_sitemap_index(self):\n <sitemap><loc>%s/cached/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n \"\"\" % self.base_url\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)"
        },
        {
            "sha": "baad02ac0758189fd5a66a53114cef0932685eba",
            "filename": "django/contrib/sitemaps/tests/https.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttps.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttps.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fhttps.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -18,7 +18,7 @@ def test_secure_sitemap_index(self):\n <sitemap><loc>%s/secure/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n \"\"\" % self.base_url\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     def test_secure_sitemap_section(self):\n         \"A secure sitemap section can be rendered\"\n@@ -28,7 +28,7 @@ def test_secure_sitemap_section(self):\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n \"\"\" % (self.base_url, date.today())\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n \n @override_settings(SECURE_PROXY_SSL_HEADER=False)\n@@ -43,7 +43,7 @@ def test_sitemap_index_with_https_request(self):\n <sitemap><loc>%s/simple/sitemap-simple.xml</loc></sitemap>\n </sitemapindex>\n \"\"\" % self.base_url.replace('http://', 'https://')\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)\n \n     def test_sitemap_section_with_https_request(self):\n         \"A sitemap section requested in HTTPS is rendered with HTTPS links\"\n@@ -53,4 +53,4 @@ def test_sitemap_section_with_https_request(self):\n <url><loc>%s/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n \"\"\" % (self.base_url.replace('http://', 'https://'), date.today())\n-        self.assertEqual(response.content, expected_content.encode('utf-8'))\n+        self.assertXMLEqual(response.content.decode('utf-8'), expected_content)"
        },
        {
            "sha": "410b61b9c78b80f43a0508159bad9bf6ec69ec7c",
            "filename": "django/contrib/sites/locale/en/LC_MESSAGES/django.po",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsites%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsites%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsites%2Flocale%2Fen%2FLC_MESSAGES%2Fdjango.po?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -4,7 +4,7 @@ msgid \"\"\n msgstr \"\"\n \"Project-Id-Version: Django\\n\"\n \"Report-Msgid-Bugs-To: \\n\"\n-\"POT-Creation-Date: 2012-03-23 02:43+0100\\n\"\n+\"POT-Creation-Date: 2012-10-15 10:57+0200\\n\"\n \"PO-Revision-Date: 2010-05-13 15:35+0200\\n\"\n \"Last-Translator: Django team\\n\"\n \"Language-Team: English <en@li.org>\\n\"\n@@ -13,18 +13,18 @@ msgstr \"\"\n \"Content-Type: text/plain; charset=UTF-8\\n\"\n \"Content-Transfer-Encoding: 8bit\\n\"\n \n-#: models.py:37\n+#: models.py:39\n msgid \"domain name\"\n msgstr \"\"\n \n-#: models.py:38\n+#: models.py:40\n msgid \"display name\"\n msgstr \"\"\n \n-#: models.py:43\n+#: models.py:45\n msgid \"site\"\n msgstr \"\"\n \n-#: models.py:44\n+#: models.py:46\n msgid \"sites\"\n msgstr \"\""
        },
        {
            "sha": "996b7dfb40d528effec42cf4a7961970dfe0de0a",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,5 +1,7 @@\n from __future__ import unicode_literals\n \n+from calendar import timegm\n+\n from django.conf import settings\n from django.contrib.sites.models import get_current_site\n from django.core.exceptions import ImproperlyConfigured, ObjectDoesNotExist\n@@ -8,6 +10,7 @@\n from django.utils import feedgenerator, tzinfo\n from django.utils.encoding import force_text, iri_to_uri, smart_text\n from django.utils.html import escape\n+from django.utils.http import http_date\n from django.utils.timezone import is_naive\n \n \n@@ -22,6 +25,7 @@ def add_domain(domain, url, secure=False):\n         url = iri_to_uri('%s://%s%s' % (protocol, domain, url))\n     return url\n \n+\n class FeedDoesNotExist(ObjectDoesNotExist):\n     pass\n \n@@ -38,6 +42,11 @@ def __call__(self, request, *args, **kwargs):\n             raise Http404('Feed object does not exist.')\n         feedgen = self.get_feed(obj, request)\n         response = HttpResponse(content_type=feedgen.mime_type)\n+        if hasattr(self, 'item_pubdate'):\n+            # if item_pubdate is defined for the feed, set header so as\n+            # ConditionalGetMiddleware is able to send 304 NOT MODIFIED\n+            response['Last-Modified'] = http_date(\n+                timegm(feedgen.latest_post_date().utctimetuple()))\n         feedgen.write(response, 'utf-8')\n         return response\n "
        },
        {
            "sha": "233af40f88a2236eba154af2b8292bb8193a4c92",
            "filename": "django/core/exceptions.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fexceptions.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fexceptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fexceptions.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,42 +3,54 @@\n \"\"\"\n from functools import reduce\n \n+\n class DjangoRuntimeWarning(RuntimeWarning):\n     pass\n \n+\n class ObjectDoesNotExist(Exception):\n     \"The requested object does not exist\"\n     silent_variable_failure = True\n \n+\n class MultipleObjectsReturned(Exception):\n     \"The query returned multiple objects when only one was expected.\"\n     pass\n \n+\n class SuspiciousOperation(Exception):\n     \"The user did something suspicious\"\n     pass\n \n+\n class PermissionDenied(Exception):\n     \"The user did not have permission to do that\"\n     pass\n \n+\n class ViewDoesNotExist(Exception):\n     \"The requested view does not exist\"\n     pass\n \n+\n class MiddlewareNotUsed(Exception):\n     \"This middleware is not used in this server configuration\"\n     pass\n \n+\n class ImproperlyConfigured(Exception):\n     \"Django is somehow improperly configured\"\n     pass\n \n+\n class FieldError(Exception):\n     \"\"\"Some kind of problem with a model field.\"\"\"\n     pass\n \n+\n NON_FIELD_ERRORS = '__all__'\n+\n+\n class ValidationError(Exception):\n     \"\"\"An error while validating data.\"\"\"\n     def __init__(self, message, code=None, params=None):\n@@ -85,4 +97,3 @@ def update_error_dict(self, error_dict):\n         else:\n             error_dict[NON_FIELD_ERRORS] = self.messages\n         return error_dict\n-"
        },
        {
            "sha": "650373f0c36523626e1d0c5178067b63b896fc39",
            "filename": "django/core/files/storage.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Ffiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Ffiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fstorage.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -192,7 +192,10 @@ def _save(self, name, content):\n                 else:\n                     # This fun binary flag incantation makes os.open throw an\n                     # OSError if the file already exists before we open it.\n-                    fd = os.open(full_path, os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, 'O_BINARY', 0))\n+                    flags = (os.O_WRONLY | os.O_CREAT | os.O_EXCL |\n+                             getattr(os, 'O_BINARY', 0))\n+                    # The current umask value is masked out by os.open!\n+                    fd = os.open(full_path, flags, 0o666)\n                     try:\n                         locks.lock(fd, locks.LOCK_EX)\n                         _file = None"
        },
        {
            "sha": "23572465cfdf930bb9b99d57dd07eb329d0f0cd7",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,16 +1,16 @@\n from __future__ import unicode_literals\n \n+import logging\n import sys\n import types\n \n from django import http\n from django.core import signals\n from django.utils.encoding import force_text\n from django.utils.importlib import import_module\n-from django.utils.log import getLogger\n from django.utils import six\n \n-logger = getLogger('django.request')\n+logger = logging.getLogger('django.request')\n \n \n class BaseHandler(object):\n@@ -95,14 +95,15 @@ def get_response(self, request):\n                         break\n \n                 if response is None:\n-                    if hasattr(request, \"urlconf\"):\n+                    if hasattr(request, 'urlconf'):\n                         # Reset url resolver with a custom urlconf.\n                         urlconf = request.urlconf\n                         urlresolvers.set_urlconf(urlconf)\n                         resolver = urlresolvers.RegexURLResolver(r'^/', urlconf)\n \n-                    callback, callback_args, callback_kwargs = resolver.resolve(\n-                            request.path_info)\n+                    resolver_match = resolver.resolve(request.path_info)\n+                    callback, callback_args, callback_kwargs = resolver_match\n+                    request.resolver_match = resolver_match\n \n                     # Apply view middleware\n                     for middleware_method in self._view_middleware:"
        },
        {
            "sha": "45cb2268ed6210fdb7cbe10461c2ba400ec4a217",
            "filename": "django/core/handlers/wsgi.py",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fwsgi.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import unicode_literals\n \n+import logging\n import sys\n from io import BytesIO\n from threading import Lock\n@@ -10,9 +11,8 @@\n from django.core.urlresolvers import set_script_prefix\n from django.utils import datastructures\n from django.utils.encoding import force_str, force_text, iri_to_uri\n-from django.utils.log import getLogger\n \n-logger = getLogger('django.request')\n+logger = logging.getLogger('django.request')\n \n \n # See http://www.iana.org/assignments/http-status-codes\n@@ -152,11 +152,6 @@ def __init__(self, environ):\n         self._stream = LimitedStream(self.environ['wsgi.input'], content_length)\n         self._read_started = False\n \n-    def get_full_path(self):\n-        # RFC 3986 requires query string arguments to be in the ASCII range.\n-        # Rather than crash if this doesn't happen, we encode defensively.\n-        return '%s%s' % (self.path, self.environ.get('QUERY_STRING', '') and ('?' + iri_to_uri(self.environ.get('QUERY_STRING', ''))) or '')\n-\n     def _is_secure(self):\n         return 'wsgi.url_scheme' in self.environ and self.environ['wsgi.url_scheme'] == 'https'\n "
        },
        {
            "sha": "6826d09ee5f9aebd18514ef215aa7e887274cf45",
            "filename": "django/core/mail/backends/locmem.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmail%2Fbackends%2Flocmem.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmail%2Fbackends%2Flocmem.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Flocmem.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -20,5 +20,7 @@ def __init__(self, *args, **kwargs):\n \n     def send_messages(self, messages):\n         \"\"\"Redirect messages to the dummy outbox\"\"\"\n+        for message in messages:  # .message() triggers header validation\n+            message.message()\n         mail.outbox.extend(messages)\n         return len(messages)"
        },
        {
            "sha": "98ab3c907535bbf9672abf5d6f7687abc5608317",
            "filename": "django/core/mail/message.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmail%2Fmessage.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmail%2Fmessage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fmessage.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,6 +3,7 @@\n import mimetypes\n import os\n import random\n+import sys\n import time\n from email import charset as Charset, encoders as Encoders\n from email.generator import Generator\n@@ -138,6 +139,9 @@ def as_string(self, unixfrom=False):\n         \"\"\"\n         fp = six.StringIO()\n         g = Generator(fp, mangle_from_ = False)\n+        if sys.version_info < (2, 6, 6) and isinstance(self._payload, six.text_type):\n+            # Workaround for http://bugs.python.org/issue1368247\n+            self._payload = self._payload.encode(self._charset.output_charset)\n         g.flatten(self, unixfrom=unixfrom)\n         return fp.getvalue()\n "
        },
        {
            "sha": "c61ab2b663db85203246f160e793b4290c16bd9c",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -103,10 +103,12 @@ def get_commands():\n         _commands = dict([(name, 'django.core') for name in find_commands(__path__[0])])\n \n         # Find the installed apps\n+        from django.conf import settings\n         try:\n-            from django.conf import settings\n             apps = settings.INSTALLED_APPS\n-        except (AttributeError, ImproperlyConfigured):\n+        except ImproperlyConfigured:\n+            # Still useful for commands that do not require functional settings,\n+            # like startproject or help\n             apps = []\n \n         # Find and load the management module for each installed app."
        },
        {
            "sha": "32ae8abf5ad9def171674036d8ecc2ae0f66b9f0",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -23,6 +23,7 @@\n except ImportError:\n     has_bz2 = False\n \n+\n class Command(BaseCommand):\n     help = 'Installs the named fixture(s) in the database.'\n     args = \"fixture [fixture ...]\"\n@@ -31,9 +32,14 @@ class Command(BaseCommand):\n         make_option('--database', action='store', dest='database',\n             default=DEFAULT_DB_ALIAS, help='Nominates a specific database to load '\n                 'fixtures into. Defaults to the \"default\" database.'),\n+        make_option('--ignorenonexistent', '-i', action='store_true', dest='ignore',\n+            default=False, help='Ignores entries in the serialized data for fields'\n+                                ' that do not currently exist on the model.'),\n     )\n \n     def handle(self, *fixture_labels, **options):\n+\n+        ignore = options.get('ignore')\n         using = options.get('database')\n \n         connection = connections[using]\n@@ -175,7 +181,7 @@ def read(self):\n                                         self.stdout.write(\"Installing %s fixture '%s' from %s.\" % \\\n                                             (format, fixture_name, humanize(fixture_dir)))\n \n-                                    objects = serializers.deserialize(format, fixture, using=using)\n+                                    objects = serializers.deserialize(format, fixture, using=using, ignorenonexistent=ignore)\n \n                                     for obj in objects:\n                                         objects_in_fixture += 1"
        },
        {
            "sha": "391e0b440ab0e76773b4877cb5247fc6df1adca2",
            "filename": "django/core/management/commands/runserver.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Frunserver.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -123,7 +123,7 @@ def inner_run(self, *args, **options):\n                 error_text = ERRORS[e.args[0].args[0]]\n             except (AttributeError, KeyError):\n                 error_text = str(e)\n-            sys.stderr.write(\"Error: %s\" % error_text)\n+            self.stderr.write(\"Error: %s\" % error_text)\n             # Need to use an OS exit because sys.exit doesn't work in a thread\n             os._exit(1)\n         except KeyboardInterrupt:"
        },
        {
            "sha": "0e2c05ba82c5c7f61eb329e6b4454f124aa409c5",
            "filename": "django/core/management/commands/sqlall.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Fsqlall.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Fsqlall.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fsqlall.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -6,6 +6,7 @@\n from django.core.management.sql import sql_all\n from django.db import connections, DEFAULT_DB_ALIAS\n \n+\n class Command(AppCommand):\n     help = \"Prints the CREATE TABLE, custom SQL and CREATE INDEX SQL statements for the given model module name(s).\"\n "
        },
        {
            "sha": "d6f6fc6b76c0fd2325c4a9974b469e90a855be46",
            "filename": "django/core/management/commands/syncdb.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fsyncdb.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -68,6 +68,7 @@ def handle_noargs(self, **options):\n                 if router.allow_syncdb(db, m)])\n             for app in models.get_apps()\n         ]\n+\n         def model_installed(model):\n             opts = model._meta\n             converter = connection.introspection.table_name_converter\n@@ -103,7 +104,6 @@ def model_installed(model):\n                     cursor.execute(statement)\n                 tables.append(connection.introspection.table_name_converter(model._meta.db_table))\n \n-\n         transaction.commit_unless_managed(using=db)\n \n         # Send the post_syncdb signal, so individual apps can do whatever they need"
        },
        {
            "sha": "0dec3ea8b927722acc7f877370e89fa328750854",
            "filename": "django/core/management/commands/validate.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Fvalidate.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fcommands%2Fvalidate.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fvalidate.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,5 +1,6 @@\n from django.core.management.base import NoArgsCommand\n \n+\n class Command(NoArgsCommand):\n     help = \"Validates all installed models.\"\n "
        },
        {
            "sha": "78cd17a23a75ab16ba0b5244ee7b6bf906b4dff1",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -9,16 +9,16 @@\n from django.db import models\n from django.db.models import get_models\n \n+\n def sql_create(app, style, connection):\n     \"Returns a list of the CREATE TABLE SQL statements for the given app.\"\n \n     if connection.settings_dict['ENGINE'] == 'django.db.backends.dummy':\n         # This must be the \"dummy\" database backend, which means the user\n         # hasn't set ENGINE for the database.\n         raise CommandError(\"Django doesn't know which syntax to use for your SQL statements,\\n\" +\n-            \"because you haven't specified the ENGINE setting for the database.\\n\" +\n-            \"Edit your settings file and change DATBASES['default']['ENGINE'] to something like\\n\" +\n-            \"'django.db.backends.postgresql' or 'django.db.backends.mysql'.\")\n+            \"because you haven't properly specified the ENGINE setting for the database.\\n\" +\n+            \"see: https://docs.djangoproject.com/en/dev/ref/settings/#databases\")\n \n     # Get installed models, so we generate REFERENCES right.\n     # We trim models from the current app so that the sqlreset command does not\n@@ -55,6 +55,7 @@ def sql_create(app, style, connection):\n \n     return final_output\n \n+\n def sql_delete(app, style, connection):\n     \"Returns a list of the DROP TABLE SQL statements for the given app.\"\n \n@@ -83,7 +84,7 @@ def sql_delete(app, style, connection):\n             opts = model._meta\n             for f in opts.local_fields:\n                 if f.rel and f.rel.to not in to_delete:\n-                    references_to_delete.setdefault(f.rel.to, []).append( (model, f) )\n+                    references_to_delete.setdefault(f.rel.to, []).append((model, f))\n \n             to_delete.add(model)\n \n@@ -97,7 +98,8 @@ def sql_delete(app, style, connection):\n         cursor.close()\n         connection.close()\n \n-    return output[::-1] # Reverse it, to deal with table dependencies.\n+    return output[::-1]  # Reverse it, to deal with table dependencies.\n+\n \n def sql_flush(style, connection, only_django=False, reset_sequences=True):\n     \"\"\"\n@@ -114,6 +116,7 @@ def sql_flush(style, connection, only_django=False, reset_sequences=True):\n     statements = connection.ops.sql_flush(style, tables, seqs)\n     return statements\n \n+\n def sql_custom(app, style, connection):\n     \"Returns a list of the custom table modifying SQL statements for the given app.\"\n     output = []\n@@ -125,17 +128,20 @@ def sql_custom(app, style, connection):\n \n     return output\n \n+\n def sql_indexes(app, style, connection):\n     \"Returns a list of the CREATE INDEX SQL statements for all models in the given app.\"\n     output = []\n     for model in models.get_models(app):\n         output.extend(connection.creation.sql_indexes_for_model(model, style))\n     return output\n \n+\n def sql_all(app, style, connection):\n     \"Returns a list of CREATE TABLE SQL, initial-data inserts, and CREATE INDEX SQL for the given module.\"\n     return sql_create(app, style, connection) + sql_custom(app, style, connection) + sql_indexes(app, style, connection)\n \n+\n def _split_statements(content):\n     comment_re = re.compile(r\"^((?:'[^']*'|[^'])*?)--.*$\")\n     statements = []\n@@ -150,6 +156,7 @@ def _split_statements(content):\n             statement = \"\"\n     return statements\n \n+\n def custom_sql_for_model(model, style, connection):\n     opts = model._meta\n     app_dir = os.path.normpath(os.path.join(os.path.dirname(models.get_app(model._meta.app_label).__file__), 'sql'))"
        },
        {
            "sha": "d34a0deb7ec0d40af7397463eafba072be764912",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -138,7 +138,7 @@ def handle(self, app_or_project, name, target=None, **options):\n                     os.mkdir(target_dir)\n \n             for dirname in dirs[:]:\n-                if dirname.startswith('.'):\n+                if dirname.startswith('.') or dirname == '__pycache__':\n                     dirs.remove(dirname)\n \n             for filename in files:"
        },
        {
            "sha": "957a712b72e7d24b5ebcceb75aba00e65b926be5",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 34,
            "deletions": 5,
            "changes": 39,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,10 +1,12 @@\n import sys\n \n+from django.conf import settings\n from django.core.management.color import color_style\n from django.utils.encoding import force_str\n from django.utils.itercompat import is_iterable\n from django.utils import six\n \n+\n class ModelErrorCollection:\n     def __init__(self, outfile=sys.stdout):\n         self.errors = []\n@@ -15,13 +17,13 @@ def add(self, context, error):\n         self.errors.append((context, error))\n         self.outfile.write(self.style.ERROR(force_str(\"%s: %s\\n\" % (context, error))))\n \n+\n def get_validation_errors(outfile, app=None):\n     \"\"\"\n     Validates all models that are part of the specified app. If no app name is provided,\n     validates all models of all installed apps. Writes errors, if any, to outfile.\n     Returns number of errors.\n     \"\"\"\n-    from django.conf import settings\n     from django.db import models, connection\n     from django.db.models.loading import get_app_errors\n     from django.db.models.fields.related import RelatedObject\n@@ -35,7 +37,25 @@ def get_validation_errors(outfile, app=None):\n     for cls in models.get_models(app):\n         opts = cls._meta\n \n-        # Do field-specific validation.\n+        # Check swappable attribute.\n+        if opts.swapped:\n+            try:\n+                app_label, model_name = opts.swapped.split('.')\n+            except ValueError:\n+                e.add(opts, \"%s is not of the form 'app_label.app_name'.\" % opts.swappable)\n+                continue\n+            if not models.get_model(app_label, model_name):\n+                e.add(opts, \"Model has been swapped out for '%s' which has not been installed or is abstract.\" % opts.swapped)\n+            # No need to perform any other validation checks on a swapped model.\n+            continue\n+\n+        # This is the current User model. Check known validation problems with User models\n+        if settings.AUTH_USER_MODEL == '%s.%s' % (opts.app_label, opts.object_name):\n+            # Check that the USERNAME FIELD isn't included in REQUIRED_FIELDS.\n+            if cls.USERNAME_FIELD in cls.REQUIRED_FIELDS:\n+                e.add(opts, 'The field named as the USERNAME_FIELD should not be included in REQUIRED_FIELDS on a swappable User model.')\n+\n+        # Model isn't swapped; do field-specific validation.\n         for f in opts.local_fields:\n             if f.name == 'id' and not f.primary_key and opts.pk.name == 'id':\n                 e.add(opts, '\"%s\": You can\\'t use \"id\" as a field name, because each model automatically gets an \"id\" field if none of the fields have primary_key=True. You need to either remove/rename your \"id\" field or add primary_key=True to a field.' % f.name)\n@@ -56,7 +76,7 @@ def get_validation_errors(outfile, app=None):\n                     e.add(opts, '\"%s\": CharFields require a \"max_length\" attribute that is a positive integer.' % f.name)\n             if isinstance(f, models.DecimalField):\n                 decimalp_ok, mdigits_ok = False, False\n-                decimalp_msg ='\"%s\": DecimalFields require a \"decimal_places\" attribute that is a non-negative integer.'\n+                decimalp_msg = '\"%s\": DecimalFields require a \"decimal_places\" attribute that is a non-negative integer.'\n                 try:\n                     decimal_places = int(f.decimal_places)\n                     if decimal_places < 0:\n@@ -123,6 +143,10 @@ def get_validation_errors(outfile, app=None):\n                 if isinstance(f.rel.to, six.string_types):\n                     continue\n \n+                # Make sure the model we're related hasn't been swapped out\n+                if f.rel.to._meta.swapped:\n+                    e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n+\n                 # Make sure the related field specified by a ForeignKey is unique\n                 if not f.rel.to._meta.get_field(f.rel.field_name).unique:\n                     e.add(opts, \"Field '%s' under model '%s' must have a unique=True constraint.\" % (f.rel.field_name, f.rel.to.__name__))\n@@ -165,6 +189,10 @@ def get_validation_errors(outfile, app=None):\n                 if isinstance(f.rel.to, six.string_types):\n                     continue\n \n+            # Make sure the model we're related hasn't been swapped out\n+            if f.rel.to._meta.swapped:\n+                e.add(opts, \"'%s' defines a relation with the model '%s.%s', which has been swapped out. Update the relation to point at settings.%s.\" % (f.name, f.rel.to._meta.app_label, f.rel.to._meta.object_name, f.rel.to._meta.swappable))\n+\n             # Check that the field is not set to unique.  ManyToManyFields do not support unique.\n             if f.unique:\n                 e.add(opts, \"ManyToManyFields cannot be unique.  Remove the unique argument on '%s'.\" % f.name)\n@@ -176,7 +204,7 @@ def get_validation_errors(outfile, app=None):\n                 seen_from, seen_to, seen_self = False, False, 0\n                 for inter_field in f.rel.through._meta.fields:\n                     rel_to = getattr(inter_field.rel, 'to', None)\n-                    if from_model == to_model: # relation to self\n+                    if from_model == to_model:  # relation to self\n                         if rel_to == from_model:\n                             seen_self += 1\n                         if seen_self > 2:\n@@ -278,7 +306,8 @@ def get_validation_errors(outfile, app=None):\n         # Check ordering attribute.\n         if opts.ordering:\n             for field_name in opts.ordering:\n-                if field_name == '?': continue\n+                if field_name == '?':\n+                    continue\n                 if field_name.startswith('-'):\n                     field_name = field_name[1:]\n                 if opts.order_with_respect_to and field_name == '_order':"
        },
        {
            "sha": "37fa90628030669dc99f9367d601a11fbe31ae1a",
            "filename": "django/core/serializers/python.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fserializers%2Fpython.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fserializers%2Fpython.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpython.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.encoding import smart_text, is_protected_type\n from django.utils import six\n \n+\n class Serializer(base.Serializer):\n     \"\"\"\n     Serializes a QuerySet to basic Python objects.\n@@ -72,6 +73,7 @@ def handle_m2m_field(self, obj, field):\n     def getvalue(self):\n         return self.objects\n \n+\n def Deserializer(object_list, **options):\n     \"\"\"\n     Deserialize simple Python objects back into Django ORM instances.\n@@ -80,15 +82,23 @@ def Deserializer(object_list, **options):\n     stream or a string) to the constructor\n     \"\"\"\n     db = options.pop('using', DEFAULT_DB_ALIAS)\n+    ignore = options.pop('ignorenonexistent', False)\n+\n     models.get_apps()\n     for d in object_list:\n         # Look up the model and starting build a dict of data for it.\n         Model = _get_model(d[\"model\"])\n-        data = {Model._meta.pk.attname : Model._meta.pk.to_python(d[\"pk\"])}\n+        data = {Model._meta.pk.attname: Model._meta.pk.to_python(d[\"pk\"])}\n         m2m_data = {}\n+        model_fields = Model._meta.get_all_field_names()\n \n         # Handle each field\n         for (field_name, field_value) in six.iteritems(d[\"fields\"]):\n+\n+            if ignore and field_name not in model_fields:\n+                # skip fields no longer on model\n+                continue\n+\n             if isinstance(field_value, str):\n                 field_value = smart_text(field_value, options.get(\"encoding\", settings.DEFAULT_CHARSET), strings_only=True)\n "
        },
        {
            "sha": "a7004f2c2fe283f6eb678f72cdb50a08aa22fa27",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 1,
            "deletions": 33,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,9 +14,8 @@\n import sys\n import traceback\n try:\n-    from urllib.parse import unquote, urljoin\n+    from urllib.parse import urljoin\n except ImportError:     # Python 2\n-    from urllib import unquote\n     from urlparse import urljoin\n from django.utils.six.moves import socketserver\n from wsgiref import simple_server\n@@ -139,37 +138,6 @@ def __init__(self, *args, **kwargs):\n         self.style = color_style()\n         super(WSGIRequestHandler, self).__init__(*args, **kwargs)\n \n-    def get_environ(self):\n-        env = self.server.base_environ.copy()\n-        env['SERVER_PROTOCOL'] = self.request_version\n-        env['REQUEST_METHOD'] = self.command\n-        if '?' in self.path:\n-            path,query = self.path.split('?',1)\n-        else:\n-            path,query = self.path,''\n-\n-        env['PATH_INFO'] = unquote(path)\n-        env['QUERY_STRING'] = query\n-        env['REMOTE_ADDR'] = self.client_address[0]\n-        env['CONTENT_TYPE'] = self.headers.get('content-type', 'text/plain')\n-\n-        length = self.headers.get('content-length')\n-        if length:\n-            env['CONTENT_LENGTH'] = length\n-\n-        for key, value in self.headers.items():\n-            key = key.replace('-','_').upper()\n-            value = value.strip()\n-            if key in env:\n-                # Skip content length, type, etc.\n-                continue\n-            if 'HTTP_' + key in env:\n-                # Comma-separate multiple headers\n-                env['HTTP_' + key] += ',' + value\n-            else:\n-                env['HTTP_' + key] = value\n-        return env\n-\n     def log_message(self, format, *args):\n         # Don't bother logging requests for admin images or the favicon.\n         if (self.path.startswith(self.admin_static_prefix)"
        },
        {
            "sha": "251b5d88560fd142ecbd7fe3f1dff8866e97f1d3",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 23,
            "deletions": 14,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -15,6 +15,7 @@\n # These values, if given to validate(), will trigger the self.required check.\n EMPTY_VALUES = (None, '', [], (), {})\n \n+\n class RegexValidator(object):\n     regex = ''\n     message = _('Enter a valid value.')\n@@ -39,14 +40,15 @@ def __call__(self, value):\n         if not self.regex.search(force_text(value)):\n             raise ValidationError(self.message, code=self.code)\n \n+\n class URLValidator(RegexValidator):\n     regex = re.compile(\n-        r'^(?:http|ftp)s?://' # http:// or https://\n-        r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:[A-Z]{2,6}\\.?|[A-Z0-9-]{2,}\\.?)|' #domain...\n-        r'localhost|' #localhost...\n-        r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|' # ...or ipv4\n-        r'\\[?[A-F0-9]*:[A-F0-9:]+\\]?)' # ...or ipv6\n-        r'(?::\\d+)?' # optional port\n+        r'^(?:http|ftp)s?://'  # http:// or https://\n+        r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:[A-Z]{2,6}\\.?|[A-Z0-9-]{2,}\\.?)|'  # domain...\n+        r'localhost|'  # localhost...\n+        r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|'  # ...or ipv4\n+        r'\\[?[A-F0-9]*:[A-F0-9:]+\\]?)'  # ...or ipv6\n+        r'(?::\\d+)?'  # optional port\n         r'(?:/?|[/?]\\S+)$', re.IGNORECASE)\n \n     def __call__(self, value):\n@@ -58,8 +60,8 @@ def __call__(self, value):\n                 value = force_text(value)\n                 scheme, netloc, path, query, fragment = urlsplit(value)\n                 try:\n-                    netloc = netloc.encode('idna').decode('ascii') # IDN -> ACE\n-                except UnicodeError: # invalid domain part\n+                    netloc = netloc.encode('idna').decode('ascii')  # IDN -> ACE\n+                except UnicodeError:  # invalid domain part\n                     raise e\n                 url = urlunsplit((scheme, netloc, path, query, fragment))\n                 super(URLValidator, self).__call__(url)\n@@ -75,6 +77,7 @@ def validate_integer(value):\n     except (ValueError, TypeError):\n         raise ValidationError('')\n \n+\n class EmailValidator(RegexValidator):\n \n     def __call__(self, value):\n@@ -96,20 +99,22 @@ def __call__(self, value):\n     r\"(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*\"  # dot-atom\n     # quoted-string, see also http://tools.ietf.org/html/rfc2822#section-3.2.5\n     r'|^\"([\\001-\\010\\013\\014\\016-\\037!#-\\[\\]-\\177]|\\\\[\\001-\\011\\013\\014\\016-\\177])*\"'\n-    r')@((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+[A-Z]{2,6}\\.?$)'  # domain\n+    r')@((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:[A-Z]{2,6}\\.?|[A-Z0-9-]{2,}\\.?)$)'  # domain\n     r'|\\[(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}\\]$', re.IGNORECASE)  # literal form, ipv4 address (SMTP 4.1.3)\n-validate_email = EmailValidator(email_re, _('Enter a valid e-mail address.'), 'invalid')\n+validate_email = EmailValidator(email_re, _('Enter a valid email address.'), 'invalid')\n \n slug_re = re.compile(r'^[-a-zA-Z0-9_]+$')\n validate_slug = RegexValidator(slug_re, _(\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"), 'invalid')\n \n ipv4_re = re.compile(r'^(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}$')\n validate_ipv4_address = RegexValidator(ipv4_re, _('Enter a valid IPv4 address.'), 'invalid')\n \n+\n def validate_ipv6_address(value):\n     if not is_valid_ipv6_address(value):\n         raise ValidationError(_('Enter a valid IPv6 address.'), code='invalid')\n \n+\n def validate_ipv46_address(value):\n     try:\n         validate_ipv4_address(value)\n@@ -125,6 +130,7 @@ def validate_ipv46_address(value):\n     'ipv6': ([validate_ipv6_address], _('Enter a valid IPv6 address.')),\n }\n \n+\n def ip_address_validators(protocol, unpack_ipv4):\n     \"\"\"\n     Depending on the given parameters returns the appropriate validators for\n@@ -147,7 +153,7 @@ def ip_address_validators(protocol, unpack_ipv4):\n \n class BaseValidator(object):\n     compare = lambda self, a, b: a is not b\n-    clean   = lambda self, x: x\n+    clean = lambda self, x: x\n     message = _('Ensure this value is %(limit_value)s (it is %(show_value)s).')\n     code = 'limit_value'\n \n@@ -164,25 +170,28 @@ def __call__(self, value):\n                 params=params,\n             )\n \n+\n class MaxValueValidator(BaseValidator):\n     compare = lambda self, a, b: a > b\n     message = _('Ensure this value is less than or equal to %(limit_value)s.')\n     code = 'max_value'\n \n+\n class MinValueValidator(BaseValidator):\n     compare = lambda self, a, b: a < b\n     message = _('Ensure this value is greater than or equal to %(limit_value)s.')\n     code = 'min_value'\n \n+\n class MinLengthValidator(BaseValidator):\n     compare = lambda self, a, b: a < b\n-    clean   = lambda self, x: len(x)\n+    clean = lambda self, x: len(x)\n     message = _('Ensure this value has at least %(limit_value)d characters (it has %(show_value)d).')\n     code = 'min_length'\n \n+\n class MaxLengthValidator(BaseValidator):\n     compare = lambda self, a, b: a > b\n-    clean   = lambda self, x: len(x)\n+    clean = lambda self, x: len(x)\n     message = _('Ensure this value has at most %(limit_value)d characters (it has %(show_value)d).')\n     code = 'max_length'\n-"
        },
        {
            "sha": "28024c6428e167dec29f2e6914416ad305f35106",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -796,7 +796,7 @@ def sequence_reset_sql(self, style, model_list):\n         The `style` argument is a Style object as returned by either\n         color_style() or no_style() in django.core.management.color.\n         \"\"\"\n-        return [] # No sequence reset required by default.\n+        return []  # No sequence reset required by default.\n \n     def start_transaction_sql(self):\n         \"\"\"\n@@ -935,6 +935,7 @@ def combine_expression(self, connector, sub_expressions):\n         conn = ' %s ' % connector\n         return conn.join(sub_expressions)\n \n+\n class BaseDatabaseIntrospection(object):\n     \"\"\"\n     This class encapsulates all backend-specific introspection utilities\n@@ -1030,12 +1031,14 @@ def sequence_list(self):\n             for model in models.get_models(app):\n                 if not model._meta.managed:\n                     continue\n+                if model._meta.swapped:\n+                    continue\n                 if not router.allow_syncdb(self.connection.alias, model):\n                     continue\n                 for f in model._meta.local_fields:\n                     if isinstance(f, models.AutoField):\n                         sequence_list.append({'table': model._meta.db_table, 'column': f.column})\n-                        break # Only one AutoField is allowed per model, so don't bother continuing.\n+                        break  # Only one AutoField is allowed per model, so don't bother continuing.\n \n                 for f in model._meta.local_many_to_many:\n                     # If this is an m2m using an intermediate table,\n@@ -1097,6 +1100,7 @@ def __init__(self, connection):\n     def runshell(self):\n         raise NotImplementedError()\n \n+\n class BaseDatabaseValidation(object):\n     \"\"\"\n     This class encapsualtes all backend-specific model validation."
        },
        {
            "sha": "69eee3535234131232a386d835335aa0e7ff200e",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -42,7 +42,7 @@ def sql_create_model(self, model, style, known_models=set()):\n             (list_of_sql, pending_references_dict)\n         \"\"\"\n         opts = model._meta\n-        if not opts.managed or opts.proxy:\n+        if not opts.managed or opts.proxy or opts.swapped:\n             return [], {}\n         final_output = []\n         table_output = []\n@@ -94,9 +94,9 @@ def sql_create_model(self, model, style, known_models=set()):\n \n         full_statement = [style.SQL_KEYWORD('CREATE TABLE') + ' ' +\n                           style.SQL_TABLE(qn(opts.db_table)) + ' (']\n-        for i, line in enumerate(table_output): # Combine and add commas.\n+        for i, line in enumerate(table_output):  # Combine and add commas.\n             full_statement.append(\n-                '    %s%s' % (line, i < len(table_output)-1 and ',' or ''))\n+                '    %s%s' % (line, i < len(table_output) - 1 and ',' or ''))\n         full_statement.append(')')\n         if opts.db_tablespace:\n             tablespace_sql = self.connection.ops.tablespace_sql(\n@@ -145,11 +145,11 @@ def sql_for_pending_references(self, model, style, pending_references):\n         \"\"\"\n         from django.db.backends.util import truncate_name\n \n-        if not model._meta.managed or model._meta.proxy:\n+        opts = model._meta\n+        if not opts.managed or opts.proxy or opts.swapped:\n             return []\n         qn = self.connection.ops.quote_name\n         final_output = []\n-        opts = model._meta\n         if model in pending_references:\n             for rel_class, f in pending_references[model]:\n                 rel_opts = rel_class._meta\n@@ -174,7 +174,7 @@ def sql_indexes_for_model(self, model, style):\n         \"\"\"\n         Returns the CREATE INDEX SQL statements for a single model.\n         \"\"\"\n-        if not model._meta.managed or model._meta.proxy:\n+        if not model._meta.managed or model._meta.proxy or model._meta.swapped:\n             return []\n         output = []\n         for f in model._meta.local_fields:\n@@ -213,7 +213,7 @@ def sql_destroy_model(self, model, references_to_delete, style):\n         Return the DROP TABLE and restraint dropping statements for a single\n         model.\n         \"\"\"\n-        if not model._meta.managed or model._meta.proxy:\n+        if not model._meta.managed or model._meta.proxy or model._meta.swapped:\n             return []\n         # Drop the table now\n         qn = self.connection.ops.quote_name\n@@ -230,7 +230,7 @@ def sql_destroy_model(self, model, references_to_delete, style):\n \n     def sql_remove_table_constraints(self, model, references_to_delete, style):\n         from django.db.backends.util import truncate_name\n-        if not model._meta.managed or model._meta.proxy:\n+        if not model._meta.managed or model._meta.proxy or model._meta.swapped:\n             return []\n         output = []\n         qn = self.connection.ops.quote_name"
        },
        {
            "sha": "797406859c782ce6920b272689d4bad406a6e0f2",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -66,7 +66,7 @@ def adapt_datetime_with_timezone_support(value, conv):\n     # Equivalent to DateTimeField.get_db_prep_value. Used only by raw SQL.\n     if settings.USE_TZ:\n         if timezone.is_naive(value):\n-            warnings.warn(\"SQLite received a naive datetime (%s)\"\n+            warnings.warn(\"MySQL received a naive datetime (%s)\"\n                           \" while time zone support is active.\" % value,\n                           RuntimeWarning)\n             default_timezone = timezone.get_default_timezone()"
        },
        {
            "sha": "cd26098caaa5767ef463c57d16eaa1f51e323738",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,6 +3,7 @@\n \n Requires psycopg 2: http://initd.org/projects/psycopg2\n \"\"\"\n+import logging\n import sys\n \n from django.db import utils\n@@ -15,7 +16,6 @@\n from django.db.backends.postgresql_psycopg2.introspection import DatabaseIntrospection\n from django.db.backends.postgresql_psycopg2.schema import DatabaseSchemaEditor\n from django.utils.encoding import force_str\n-from django.utils.log import getLogger\n from django.utils.safestring import SafeText, SafeBytes\n from django.utils import six\n from django.utils.timezone import utc\n@@ -34,7 +34,7 @@\n psycopg2.extensions.register_adapter(SafeBytes, psycopg2.extensions.QuotedString)\n psycopg2.extensions.register_adapter(SafeText, psycopg2.extensions.QuotedString)\n \n-logger = getLogger('django.db.backends')\n+logger = logging.getLogger('django.db.backends')\n \n def utc_tzinfo_factory(offset):\n     if offset != 0:"
        },
        {
            "sha": "9dacac72e187283c3c444965887ba7cf9db86e19",
            "filename": "django/db/backends/sqlite3/creation.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -56,11 +56,11 @@ def _create_test_db(self, verbosity, autoclobber):\n                 if not autoclobber:\n                     confirm = input(\"Type 'yes' if you would like to try deleting the test database '%s', or 'no' to cancel: \" % test_database_name)\n                 if autoclobber or confirm == 'yes':\n-                  try:\n-                      os.remove(test_database_name)\n-                  except Exception as e:\n-                      sys.stderr.write(\"Got an error deleting the old test database: %s\\n\" % e)\n-                      sys.exit(2)\n+                    try:\n+                        os.remove(test_database_name)\n+                    except Exception as e:\n+                        sys.stderr.write(\"Got an error deleting the old test database: %s\\n\" % e)\n+                        sys.exit(2)\n                 else:\n                     print(\"Tests cancelled.\")\n                     sys.exit(1)"
        },
        {
            "sha": "e029c42899db63d3463ebfcb2ebeea71ff432f77",
            "filename": "django/db/backends/util.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fbackends%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Futil.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,15 +3,15 @@\n import datetime\n import decimal\n import hashlib\n+import logging\n from time import time\n \n from django.conf import settings\n from django.utils.encoding import force_bytes\n-from django.utils.log import getLogger\n from django.utils.timezone import utc\n \n \n-logger = getLogger('django.db.backends')\n+logger = logging.getLogger('django.db.backends')\n \n \n class CursorWrapper(object):"
        },
        {
            "sha": "35c607ac2da78cf3cc3b384f71bef3a06d3beaa8",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -5,7 +5,7 @@\n from functools import update_wrapper\n from django.utils.six.moves import zip\n \n-import django.db.models.manager     # Imported to register signal handler.\n+import django.db.models.manager  # Imported to register signal handler.\n from django.conf import settings\n from django.core.exceptions import (ObjectDoesNotExist,\n     MultipleObjectsReturned, FieldError, ValidationError, NON_FIELD_ERRORS)\n@@ -108,6 +108,11 @@ def __new__(cls, name, bases, attrs):\n \n         is_proxy = new_class._meta.proxy\n \n+        # If the model is a proxy, ensure that the base class\n+        # hasn't been swapped out.\n+        if is_proxy and base_meta and base_meta.swapped:\n+            raise TypeError(\"%s cannot proxy the swapped model '%s'.\" % (name, base_meta.swapped))\n+\n         if getattr(new_class, '_default_manager', None):\n             if not is_proxy:\n                 # Multi-table inheritance doesn't inherit default manager from\n@@ -265,6 +270,7 @@ def _prepare(cls):\n         if opts.order_with_respect_to:\n             cls.get_next_in_order = curry(cls._get_next_or_previous_in_order, is_next=True)\n             cls.get_previous_in_order = curry(cls._get_next_or_previous_in_order, is_next=False)\n+\n             # defer creating accessors on the foreign class until we are\n             # certain it has been created\n             def make_foreign_order_accessors(field, model, cls):\n@@ -295,6 +301,7 @@ def make_foreign_order_accessors(field, model, cls):\n \n         signals.class_prepared.send(sender=cls)\n \n+\n class ModelState(object):\n     \"\"\"\n     A class for storing instance state\n@@ -306,6 +313,7 @@ def __init__(self, db=None):\n         # This impacts validation only; it has no effect on the actual save.\n         self.adding = True\n \n+\n class Model(six.with_metaclass(ModelBase, object)):\n     _deferred = False\n \n@@ -635,7 +643,6 @@ def save_base(self, raw=False, cls=None, origin=None, force_insert=False,\n             signals.post_save.send(sender=origin, instance=self, created=(not record_exists),\n                                    update_fields=update_fields, raw=raw, using=using)\n \n-\n     save_base.alters_data = True\n \n     def delete(self, using=None):\n@@ -659,7 +666,7 @@ def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):\n         order = not is_next and '-' or ''\n         param = force_text(getattr(self, field.attname))\n         q = Q(**{'%s__%s' % (field.name, op): param})\n-        q = q|Q(**{field.name: param, 'pk__%s' % op: self.pk})\n+        q = q | Q(**{field.name: param, 'pk__%s' % op: self.pk})\n         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by('%s%s' % (order, field.name), '%spk' % order)\n         try:\n             return qs[0]\n@@ -852,15 +859,15 @@ def unique_error_message(self, model_class, unique_check):\n             field = opts.get_field(field_name)\n             field_label = capfirst(field.verbose_name)\n             # Insert the error into the error dict, very sneaky\n-            return field.error_messages['unique'] %  {\n+            return field.error_messages['unique'] % {\n                 'model_name': six.text_type(model_name),\n                 'field_label': six.text_type(field_label)\n             }\n         # unique_together\n         else:\n             field_labels = [capfirst(opts.get_field(f).verbose_name) for f in unique_check]\n             field_labels = get_text_list(field_labels, _('and'))\n-            return _(\"%(model_name)s with this %(field_label)s already exists.\") %  {\n+            return _(\"%(model_name)s with this %(field_label)s already exists.\") % {\n                 'model_name': six.text_type(model_name),\n                 'field_label': six.text_type(field_labels)\n             }\n@@ -924,7 +931,6 @@ def clean_fields(self, exclude=None):\n             raise ValidationError(errors)\n \n \n-\n ############################################\n # HELPER FUNCTIONS (CURRIED MODEL METHODS) #\n ############################################\n@@ -966,6 +972,7 @@ def get_absolute_url(opts, func, self, *args, **kwargs):\n class Empty(object):\n     pass\n \n+\n def model_unpickle(model, attrs):\n     \"\"\"\n     Used to unpickle Model subclasses with deferred fields.\n@@ -974,6 +981,7 @@ def model_unpickle(model, attrs):\n     return cls.__new__(cls)\n model_unpickle.__safe_for_unpickle__ = True\n \n+\n def unpickle_inner_exception(klass, exception_name):\n     # Get the exception class from the class it is attached to:\n     exception = getattr(klass, exception_name)"
        },
        {
            "sha": "6dff4a288207fe19b343574143ccaf21ccf7b100",
            "filename": "django/db/models/deletion.py",
            "status": "modified",
            "additions": 57,
            "deletions": 6,
            "changes": 63,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fdeletion.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fdeletion.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fdeletion.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -77,6 +77,9 @@ def __init__(self, using):\n         self.data = {}\n         self.batches = {} # {model: {field: set([instances])}}\n         self.field_updates = {} # {model: {(field, value): set([instances])}}\n+        # fast_deletes is a list of queryset-likes that can be deleted without\n+        # fetching the objects into memory.\n+        self.fast_deletes = [] \n \n         # Tracks deletion-order dependency for databases without transactions\n         # or ability to defer constraint checks. Only concrete model classes\n@@ -131,6 +134,43 @@ def add_field_update(self, field, value, objs):\n             model, {}).setdefault(\n             (field, value), set()).update(objs)\n \n+    def can_fast_delete(self, objs, from_field=None):\n+        \"\"\"\n+        Determines if the objects in the given queryset-like can be\n+        fast-deleted. This can be done if there are no cascades, no\n+        parents and no signal listeners for the object class.\n+\n+        The 'from_field' tells where we are coming from - we need this to\n+        determine if the objects are in fact to be deleted. Allows also\n+        skipping parent -> child -> parent chain preventing fast delete of\n+        the child.\n+        \"\"\"\n+        if from_field and from_field.rel.on_delete is not CASCADE:\n+            return False\n+        if not (hasattr(objs, 'model') and hasattr(objs, '_raw_delete')):\n+            return False\n+        model = objs.model\n+        if (signals.pre_delete.has_listeners(model)\n+                or signals.post_delete.has_listeners(model)\n+                or signals.m2m_changed.has_listeners(model)):\n+            return False\n+        # The use of from_field comes from the need to avoid cascade back to\n+        # parent when parent delete is cascading to child.\n+        opts = model._meta\n+        if any(link != from_field for link in opts.concrete_model._meta.parents.values()):\n+            return False\n+        # Foreign keys pointing to this model, both from m2m and other\n+        # models.\n+        for related in opts.get_all_related_objects(\n+            include_hidden=True, include_proxy_eq=True):\n+            if related.field.rel.on_delete is not DO_NOTHING:\n+                return False\n+        # GFK deletes\n+        for relation in opts.many_to_many:\n+            if not relation.rel.through:\n+                return False\n+        return True\n+\n     def collect(self, objs, source=None, nullable=False, collect_related=True,\n         source_attr=None, reverse_dependency=False):\n         \"\"\"\n@@ -148,6 +188,9 @@ def collect(self, objs, source=None, nullable=False, collect_related=True,\n         models, the one case in which the cascade follows the forwards\n         direction of an FK rather than the reverse direction.)\n         \"\"\"\n+        if self.can_fast_delete(objs):\n+            self.fast_deletes.append(objs)\n+            return\n         new_objs = self.add(objs, source, nullable,\n                             reverse_dependency=reverse_dependency)\n         if not new_objs:\n@@ -160,6 +203,10 @@ def collect(self, objs, source=None, nullable=False, collect_related=True,\n         concrete_model = model._meta.concrete_model\n         for ptr in six.itervalues(concrete_model._meta.parents):\n             if ptr:\n+                # FIXME: This seems to be buggy and execute a query for each\n+                # parent object fetch. We have the parent data in the obj,\n+                # but we don't have a nice way to turn that data into parent\n+                # object instance.\n                 parent_objs = [getattr(obj, ptr.name) for obj in new_objs]\n                 self.collect(parent_objs, source=model,\n                              source_attr=ptr.rel.related_name,\n@@ -170,12 +217,12 @@ def collect(self, objs, source=None, nullable=False, collect_related=True,\n             for related in model._meta.get_all_related_objects(\n                     include_hidden=True, include_proxy_eq=True):\n                 field = related.field\n-                if related.model._meta.auto_created:\n-                    self.add_batch(related.model, field, new_objs)\n-                else:\n-                    sub_objs = self.related_objects(related, new_objs)\n-                    if not sub_objs:\n-                        continue\n+                if field.rel.on_delete == DO_NOTHING:\n+                    continue\n+                sub_objs = self.related_objects(related, new_objs)\n+                if self.can_fast_delete(sub_objs, from_field=field):\n+                    self.fast_deletes.append(sub_objs)\n+                elif sub_objs:\n                     field.rel.on_delete(self, field, sub_objs, self.using)\n \n             # TODO This entire block is only needed as a special case to\n@@ -241,6 +288,10 @@ def delete(self):\n                     sender=model, instance=obj, using=self.using\n                 )\n \n+        # fast deletes\n+        for qs in self.fast_deletes:\n+            qs._raw_delete(using=self.using)\n+\n         # update fields\n         for model, instances_for_fieldvalues in six.iteritems(self.field_updates):\n             query = sql.UpdateQuery(model)"
        },
        {
            "sha": "30c44bacdef35341cd8c6a73e52bc32c35e15b2d",
            "filename": "django/db/models/expressions.py",
            "status": "modified",
            "additions": 23,
            "deletions": 7,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fexpressions.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fexpressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fexpressions.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,9 +14,11 @@ class ExpressionNode(tree.Node):\n                 # because it can be used in strings that also\n                 # have parameter substitution.\n \n-    # Bitwise operators\n-    AND = '&'\n-    OR = '|'\n+    # Bitwise operators - note that these are generated by .bitand()\n+    # and .bitor(), the '&' and '|' are reserved for boolean operator\n+    # usage.\n+    BITAND = '&'\n+    BITOR = '|'\n \n     def __init__(self, children=None, connector=None, negated=False):\n         if children is not None and len(children) > 1 and connector is None:\n@@ -66,10 +68,20 @@ def __mod__(self, other):\n         return self._combine(other, self.MOD, False)\n \n     def __and__(self, other):\n-        return self._combine(other, self.AND, False)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n+\n+    def bitand(self, other):\n+        return self._combine(other, self.BITAND, False)\n \n     def __or__(self, other):\n-        return self._combine(other, self.OR, False)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n+\n+    def bitor(self, other):\n+        return self._combine(other, self.BITOR, False)\n \n     def __radd__(self, other):\n         return self._combine(other, self.ADD, True)\n@@ -88,10 +100,14 @@ def __rmod__(self, other):\n         return self._combine(other, self.MOD, True)\n \n     def __rand__(self, other):\n-        return self._combine(other, self.AND, True)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n \n     def __ror__(self, other):\n-        return self._combine(other, self.OR, True)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n \n     def prepare_database_save(self, unused):\n         return self"
        },
        {
            "sha": "30770a0639d25997fcd740a24c1753fb66f3962f",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -925,7 +925,7 @@ def formfield(self, **kwargs):\n \n class EmailField(CharField):\n     default_validators = [validators.validate_email]\n-    description = _(\"E-mail address\")\n+    description = _(\"Email address\")\n \n     def __init__(self, *args, **kwargs):\n         # max_length should be overridden to 254 characters to be fully"
        },
        {
            "sha": "92d35dc720d9c53b8be5eadb993d906fc40a864d",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 46,
            "deletions": 18,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -21,6 +21,7 @@\n \n pending_lookups = {}\n \n+\n def add_lazy_relation(cls, field, relation, operation):\n     \"\"\"\n     Adds a lookup on ``cls`` when a related field is defined using a string,\n@@ -77,6 +78,7 @@ class MyModel(Model):\n         value = (cls, field, operation)\n         pending_lookups.setdefault(key, []).append(value)\n \n+\n def do_pending_lookups(sender, **kwargs):\n     \"\"\"\n     Handle any pending relations to the sending model. Sent from class_prepared.\n@@ -87,6 +89,7 @@ def do_pending_lookups(sender, **kwargs):\n \n signals.class_prepared.connect(do_pending_lookups)\n \n+\n #HACK\n class RelatedField(object):\n     def contribute_to_class(self, cls, name):\n@@ -220,6 +223,7 @@ def related_query_name(self):\n         # \"related_name\" option.\n         return self.rel.related_name or self.opts.object_name.lower()\n \n+\n class SingleRelatedObjectDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -257,13 +261,17 @@ def __get__(self, instance, instance_type=None):\n         try:\n             rel_obj = getattr(instance, self.cache_name)\n         except AttributeError:\n-            params = {'%s__pk' % self.related.field.name: instance._get_pk_val()}\n-            try:\n-                rel_obj = self.get_query_set(instance=instance).get(**params)\n-            except self.related.model.DoesNotExist:\n+            related_pk = instance._get_pk_val()\n+            if related_pk is None:\n                 rel_obj = None\n             else:\n-                setattr(rel_obj, self.related.field.get_cache_name(), instance)\n+                params = {'%s__pk' % self.related.field.name: related_pk}\n+                try:\n+                    rel_obj = self.get_query_set(instance=instance).get(**params)\n+                except self.related.model.DoesNotExist:\n+                    rel_obj = None\n+                else:\n+                    setattr(rel_obj, self.related.field.get_cache_name(), instance)\n             setattr(instance, self.cache_name, rel_obj)\n         if rel_obj is None:\n             raise self.related.model.DoesNotExist\n@@ -297,15 +305,21 @@ def __set__(self, instance, value):\n                     raise ValueError('Cannot assign \"%r\": instance is on database \"%s\", value is on database \"%s\"' %\n                                         (value, instance._state.db, value._state.db))\n \n+        related_pk = getattr(instance, self.related.field.rel.get_related_field().attname)\n+        if related_pk is None:\n+            raise ValueError('Cannot assign \"%r\": \"%s\" instance isn\\'t saved in the database.' %\n+                                (value, instance._meta.object_name))\n+\n         # Set the value of the related field to the value of the related object's related field\n-        setattr(value, self.related.field.attname, getattr(instance, self.related.field.rel.get_related_field().attname))\n+        setattr(value, self.related.field.attname, related_pk)\n \n         # Since we already know what the related object is, seed the related\n         # object caches now, too. This avoids another db hit if you get the\n         # object you just set.\n         setattr(instance, self.cache_name, value)\n         setattr(value, self.related.field.get_cache_name(), instance)\n \n+\n class ReverseSingleRelatedObjectDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -430,6 +444,7 @@ def __set__(self, instance, value):\n         if value is not None and not self.field.rel.multiple:\n             setattr(value, self.field.related.get_cache_name(), instance)\n \n+\n class ForeignRelatedObjectsDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -660,7 +675,7 @@ def _add_items(self, source_field_name, target_field_name, *objs):\n                 for obj in objs:\n                     if isinstance(obj, self.model):\n                         if not router.allow_relation(obj, self.instance):\n-                           raise ValueError('Cannot add \"%r\": instance is on database \"%s\", value is on database \"%s\"' %\n+                            raise ValueError('Cannot add \"%r\": instance is on database \"%s\", value is on database \"%s\"' %\n                                                (obj, self.instance._state.db, obj._state.db))\n                         new_ids.add(obj.pk)\n                     elif isinstance(obj, Model):\n@@ -752,6 +767,7 @@ def _clear_items(self, source_field_name):\n \n     return ManyRelatedManager\n \n+\n class ManyRelatedObjectsDescriptor(object):\n     # This class provides the functionality that makes the related-object\n     # managers available as attributes on a model class, for fields that have\n@@ -860,12 +876,13 @@ def __set__(self, instance, value):\n         manager.clear()\n         manager.add(*value)\n \n+\n class ManyToOneRel(object):\n     def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         parent_link=False, on_delete=None):\n         try:\n             to._meta\n-        except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n+        except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"'to' must be either a model, a model name or the string %r\" % RECURSIVE_RELATIONSHIP_CONSTANT\n         self.to, self.field_name = to, field_name\n         self.related_name = related_name\n@@ -891,6 +908,7 @@ def get_related_field(self):\n                     self.field_name)\n         return data[0]\n \n+\n class OneToOneRel(ManyToOneRel):\n     def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         parent_link=False, on_delete=None):\n@@ -900,6 +918,7 @@ def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         )\n         self.multiple = False\n \n+\n class ManyToManyRel(object):\n     def __init__(self, to, related_name=None, limit_choices_to=None,\n             symmetrical=True, through=None):\n@@ -924,16 +943,18 @@ def get_related_field(self):\n         \"\"\"\n         return self.to._meta.pk\n \n+\n class ForeignKey(RelatedField, Field):\n     empty_strings_allowed = False\n     default_error_messages = {\n         'invalid': _('Model %(model)s with pk %(pk)r does not exist.')\n     }\n     description = _(\"Foreign Key (type determined by related field)\")\n+\n     def __init__(self, to, to_field=None, rel_class=ManyToOneRel, **kwargs):\n         try:\n             to_name = to._meta.object_name.lower()\n-        except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n+        except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ForeignKey must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n         else:\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n@@ -1013,8 +1034,8 @@ def contribute_to_class(self, cls, name):\n \n     def contribute_to_related_class(self, cls, related):\n         # Internal FK's - i.e., those with a related name ending with '+' -\n-        # don't get a related descriptor.\n-        if not self.rel.is_hidden():\n+        # and swapped models don't get a related descriptor.\n+        if not self.rel.is_hidden() and not related.model._meta.swapped:\n             setattr(cls, related.get_accessor_name(), ForeignRelatedObjectsDescriptor(related))\n             if self.rel.limit_choices_to:\n                 cls._meta.related_fkey_lookups.append(self.rel.limit_choices_to)\n@@ -1053,6 +1074,7 @@ def db_type(self, connection):\n     def db_parameters(self, connection):\n         return {\"type\": self.db_type(connection), \"check\": []}\n \n+\n class OneToOneField(ForeignKey):\n     \"\"\"\n     A OneToOneField is essentially the same as a ForeignKey, with the exception\n@@ -1061,6 +1083,7 @@ class OneToOneField(ForeignKey):\n     rather than returning a list.\n     \"\"\"\n     description = _(\"One-to-one relationship\")\n+\n     def __init__(self, to, to_field=None, **kwargs):\n         kwargs['unique'] = True\n         super(OneToOneField, self).__init__(to, to_field, OneToOneRel, **kwargs)\n@@ -1080,12 +1103,14 @@ def save_form_data(self, instance, data):\n         else:\n             setattr(instance, self.attname, data)\n \n+\n def create_many_to_many_intermediary_model(field, klass):\n     from django.db import models\n     managed = True\n     if isinstance(field.rel.to, six.string_types) and field.rel.to != RECURSIVE_RELATIONSHIP_CONSTANT:\n         to_model = field.rel.to\n         to = to_model.split('.')[-1]\n+\n         def set_managed(field, model, cls):\n             field.rel.through._meta.managed = model._meta.managed or cls._meta.managed\n         add_lazy_relation(klass, field, to_model, set_managed)\n@@ -1122,12 +1147,14 @@ def set_managed(field, model, cls):\n         to: models.ForeignKey(to_model, related_name='%s+' % name, db_tablespace=field.db_tablespace)\n     })\n \n+\n class ManyToManyField(RelatedField, Field):\n     description = _(\"Many-to-many relationship\")\n+\n     def __init__(self, to, **kwargs):\n         try:\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n-        except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n+        except AttributeError:  # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n             assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ManyToManyField must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n             # Python 2.6 and earlier require dictionary keys to be of str type,\n             # not unicode and class names must be ASCII (in Python 2.x), so we\n@@ -1138,7 +1165,7 @@ def __init__(self, to, **kwargs):\n         kwargs['rel'] = ManyToManyRel(to,\n             related_name=kwargs.pop('related_name', None),\n             limit_choices_to=kwargs.pop('limit_choices_to', None),\n-            symmetrical=kwargs.pop('symmetrical', to==RECURSIVE_RELATIONSHIP_CONSTANT),\n+            symmetrical=kwargs.pop('symmetrical', to == RECURSIVE_RELATIONSHIP_CONSTANT),\n             through=kwargs.pop('through', None))\n \n         self.db_table = kwargs.pop('db_table', None)\n@@ -1169,7 +1196,7 @@ def _get_m2m_attr(self, related, attr):\n         if hasattr(self, cache_attr):\n             return getattr(self, cache_attr)\n         for f in self.rel.through._meta.fields:\n-            if hasattr(f,'rel') and f.rel and f.rel.to == related.model:\n+            if hasattr(f, 'rel') and f.rel and f.rel.to == related.model:\n                 setattr(self, cache_attr, getattr(f, attr))\n                 return getattr(self, cache_attr)\n \n@@ -1180,7 +1207,7 @@ def _get_m2m_reverse_attr(self, related, attr):\n             return getattr(self, cache_attr)\n         found = False\n         for f in self.rel.through._meta.fields:\n-            if hasattr(f,'rel') and f.rel and f.rel.to == related.parent_model:\n+            if hasattr(f, 'rel') and f.rel and f.rel.to == related.parent_model:\n                 if related.model == related.parent_model:\n                     # If this is an m2m-intermediate to self,\n                     # the first foreign key you find will be\n@@ -1225,7 +1252,8 @@ def contribute_to_class(self, cls, name):\n         # The intermediate m2m model is not auto created if:\n         #  1) There is a manually specified intermediate, or\n         #  2) The class owning the m2m field is abstract.\n-        if not self.rel.through and not cls._meta.abstract:\n+        #  3) The class owning the m2m field has been swapped out.\n+        if not self.rel.through and not cls._meta.abstract and not cls._meta.swapped:\n             self.rel.through = create_many_to_many_intermediary_model(self, cls)\n \n         # Add the descriptor for the m2m relation\n@@ -1249,8 +1277,8 @@ def resolve_through_model(field, model, cls):\n \n     def contribute_to_related_class(self, cls, related):\n         # Internal M2Ms (i.e., those with a related name ending with '+')\n-        # don't get a related descriptor.\n-        if not self.rel.is_hidden():\n+        # and swapped models don't get a related descriptor.\n+        if not self.rel.is_hidden() and not related.model._meta.swapped:\n             setattr(cls, related.get_accessor_name(), ManyRelatedObjectsDescriptor(related))\n \n         # Set up the accessors for the column names on the m2m table"
        },
        {
            "sha": "8da8af487c845d4c2e3831f47aec97d22b39b4ed",
            "filename": "django/db/models/manager.py",
            "status": "modified",
            "additions": 39,
            "deletions": 1,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fmanager.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fmanager.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fmanager.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,6 +14,10 @@ def ensure_default_manager(sender, **kwargs):\n     \"\"\"\n     cls = sender\n     if cls._meta.abstract:\n+        setattr(cls, 'objects', AbstractManagerDescriptor(cls))\n+        return\n+    elif cls._meta.swapped:\n+        setattr(cls, 'objects', SwappedManagerDescriptor(cls))\n         return\n     if not getattr(cls, '_default_manager', None):\n         # Create the default manager, if needed.\n@@ -42,6 +46,7 @@ def ensure_default_manager(sender, **kwargs):\n \n signals.class_prepared.connect(ensure_default_manager)\n \n+\n class Manager(object):\n     # Tracks each time a Manager instance is created. Used to retain order.\n     creation_counter = 0\n@@ -56,7 +61,14 @@ def __init__(self):\n     def contribute_to_class(self, model, name):\n         # TODO: Use weakref because of possible memory leak / circular reference.\n         self.model = model\n-        setattr(model, name, ManagerDescriptor(self))\n+        # Only contribute the manager if the model is concrete\n+        if model._meta.abstract:\n+            setattr(model, name, AbstractManagerDescriptor(model))\n+        elif model._meta.swapped:\n+            setattr(model, name, SwappedManagerDescriptor(model))\n+        else:\n+        # if not model._meta.abstract and not model._meta.swapped:\n+            setattr(model, name, ManagerDescriptor(self))\n         if not getattr(model, '_default_manager', None) or self.creation_counter < model._default_manager.creation_counter:\n             model._default_manager = self\n         if model._meta.abstract or (self._inherited and not self.model._meta.proxy):\n@@ -208,6 +220,7 @@ def _update(self, values, **kwargs):\n     def raw(self, raw_query, params=None, *args, **kwargs):\n         return RawQuerySet(raw_query=raw_query, model=self.model, params=params, using=self._db, *args, **kwargs)\n \n+\n class ManagerDescriptor(object):\n     # This class ensures managers aren't accessible via model instances.\n     # For example, Poll.objects works, but poll_obj.objects raises AttributeError.\n@@ -219,6 +232,31 @@ def __get__(self, instance, type=None):\n             raise AttributeError(\"Manager isn't accessible via %s instances\" % type.__name__)\n         return self.manager\n \n+\n+class AbstractManagerDescriptor(object):\n+    # This class provides a better error message when you try to access a\n+    # manager on an abstract model.\n+    def __init__(self, model):\n+        self.model = model\n+\n+    def __get__(self, instance, type=None):\n+        raise AttributeError(\"Manager isn't available; %s is abstract\" % (\n+            self.model._meta.object_name,\n+        ))\n+\n+\n+class SwappedManagerDescriptor(object):\n+    # This class provides a better error message when you try to access a\n+    # manager on a swapped model.\n+    def __init__(self, model):\n+        self.model = model\n+\n+    def __get__(self, instance, type=None):\n+        raise AttributeError(\"Manager isn't available; %s has been swapped for '%s'\" % (\n+            self.model._meta.object_name, self.model._meta.swapped\n+        ))\n+\n+\n class EmptyManager(Manager):\n     def get_query_set(self):\n         return self.get_empty_query_set()"
        },
        {
            "sha": "ace2816b0b6628405a49610becc65457ad351333",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 32,
            "deletions": 13,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -21,7 +21,8 @@\n DEFAULT_NAMES = ('verbose_name', 'verbose_name_plural', 'db_table', 'ordering',\n                  'unique_together', 'permissions', 'get_latest_by',\n                  'order_with_respect_to', 'app_label', 'db_tablespace',\n-                 'abstract', 'managed', 'proxy', 'auto_created', 'auto_register')\n+                 'abstract', 'managed', 'proxy', 'swappable', 'auto_created', 'auto_register')\n+\n \n @python_2_unicode_compatible\n class Options(object):\n@@ -32,8 +33,8 @@ def __init__(self, meta, app_label=None):\n         self.verbose_name_plural = None\n         self.db_table = ''\n         self.ordering = []\n-        self.unique_together =  []\n-        self.permissions =  []\n+        self.unique_together = []\n+        self.permissions = []\n         self.object_name, self.app_label = None, app_label\n         self.get_latest_by = None\n         self.order_with_respect_to = None\n@@ -55,6 +56,7 @@ def __init__(self, meta, app_label=None):\n         # in the end of the proxy_for_model chain. In particular, for\n         # concrete models, the concrete_model is always the class itself.\n         self.concrete_model = None\n+        self.swappable = None\n         self.parents = SortedDict()\n         self.duplicate_targets = {}\n         self.auto_created = False\n@@ -221,6 +223,19 @@ def verbose_name_raw(self):\n         return raw\n     verbose_name_raw = property(verbose_name_raw)\n \n+    def _swapped(self):\n+        \"\"\"\n+        Has this model been swapped out for another? If so, return the model\n+        name of the replacement; otherwise, return None.\n+        \"\"\"\n+        if self.swappable:\n+            model_label = '%s.%s' % (self.app_label, self.object_name)\n+            swapped_for = getattr(settings, self.swappable, None)\n+            if swapped_for not in (None, model_label):\n+                return swapped_for\n+        return None\n+    swapped = property(_swapped)\n+\n     def _fields(self):\n         \"\"\"\n         The getter for self.fields. This returns the list of field objects\n@@ -406,13 +421,14 @@ def _fill_related_objects_cache(self):\n         # Collect also objects which are in relation to some proxy child/parent of self.\n         proxy_cache = cache.copy()\n         for klass in get_models(include_auto_created=True, only_installed=False):\n-            for f in klass._meta.local_fields:\n-                if f.rel and not isinstance(f.rel.to, six.string_types):\n-                    if self == f.rel.to._meta:\n-                        cache[RelatedObject(f.rel.to, klass, f)] = None\n-                        proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n-                    elif self.concrete_model == f.rel.to._meta.concrete_model:\n-                        proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n+            if not klass._meta.swapped:\n+                for f in klass._meta.local_fields:\n+                    if f.rel and not isinstance(f.rel.to, six.string_types):\n+                        if self == f.rel.to._meta:\n+                            cache[RelatedObject(f.rel.to, klass, f)] = None\n+                            proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n+                        elif self.concrete_model == f.rel.to._meta.concrete_model:\n+                            proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n         self._related_objects_cache = cache\n         self._related_objects_proxy_cache = proxy_cache\n \n@@ -448,9 +464,12 @@ def _fill_related_many_to_many_cache(self):\n                 else:\n                     cache[obj] = model\n         for klass in get_models(only_installed=False):\n-            for f in klass._meta.local_many_to_many:\n-                if f.rel and not isinstance(f.rel.to, six.string_types) and self == f.rel.to._meta:\n-                    cache[RelatedObject(f.rel.to, klass, f)] = None\n+            if not klass._meta.swapped:\n+                for f in klass._meta.local_many_to_many:\n+                    if (f.rel\n+                            and not isinstance(f.rel.to, six.string_types)\n+                            and self == f.rel.to._meta):\n+                        cache[RelatedObject(f.rel.to, klass, f)] = None\n         if app_cache_ready():\n             self._related_many_to_many_cache = cache\n         return cache"
        },
        {
            "sha": "dc1ddf16061102bc7d0f6faa7e2d2bc3f257d1f8",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -529,6 +529,14 @@ def delete(self):\n         self._result_cache = None\n     delete.alters_data = True\n \n+    def _raw_delete(self, using):\n+        \"\"\"\n+        Deletes objects found from the given queryset in single direct SQL\n+        query. No signals are sent, and there is no protection for cascades.\n+        \"\"\"\n+        sql.DeleteQuery(self.model).delete_qs(self, using)\n+    _raw_delete.alters_data = True\n+\n     def update(self, **kwargs):\n         \"\"\"\n         Updates all elements in the current QuerySet, setting all the given\n@@ -975,6 +983,12 @@ def iterator(self):\n         for row in self.query.get_compiler(self.db).results_iter():\n             yield dict(zip(names, row))\n \n+    def delete(self):\n+        # values().delete() doesn't work currently - make sure it raises an\n+        # user friendly error.\n+        raise TypeError(\"Queries with .values() or .values_list() applied \"\n+                        \"can't be deleted\")\n+\n     def _setup_query(self):\n         \"\"\"\n         Constructs the field_names list that the values query will be\n@@ -1263,6 +1277,18 @@ def aggregate(self, *args, **kwargs):\n             kwargs[arg.default_alias] = arg\n         return dict([(key, None) for key in kwargs])\n \n+    def values(self, *fields):\n+        \"\"\"\n+        Always returns EmptyQuerySet.\n+        \"\"\"\n+        return self\n+\n+    def values_list(self, *fields, **kwargs):\n+        \"\"\"\n+        Always returns EmptyQuerySet.\n+        \"\"\"\n+        return self\n+\n     # EmptyQuerySet is always an empty result in where-clauses (and similar\n     # situations).\n     value_annotation = False"
        },
        {
            "sha": "b9095e503ae109791c611604e30c75b8fc7cff01",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -774,10 +774,20 @@ def results_iter(self):\n                         # We only set this up here because\n                         # related_select_fields isn't populated until\n                         # execute_sql() has been called.\n+\n+                        # We also include types of fields of related models that\n+                        # will be included via select_related() for the benefit\n+                        # of MySQL/MySQLdb when boolean fields are involved\n+                        # (#15040).\n+\n+                        # This code duplicates the logic for the order of fields\n+                        # found in get_columns(). It would be nice to clean this up.\n                         if self.query.select_fields:\n-                            fields = self.query.select_fields + self.query.related_select_fields\n+                            fields = self.query.select_fields\n                         else:\n                             fields = self.query.model._meta.fields\n+                        fields = fields + self.query.related_select_fields\n+\n                         # If the field was deferred, exclude it from being passed\n                         # into `resolve_columns` because it wasn't selected.\n                         only_load = self.deferred_to_columns()\n@@ -897,8 +907,11 @@ def as_sql(self):\n             col = \"%s.%s\" % (qn(opts.db_table), qn(opts.pk.column))\n             result.append(\"VALUES (%s)\" % \", \".join(placeholders[0]))\n             r_fmt, r_params = self.connection.ops.return_insert_id()\n-            result.append(r_fmt % col)\n-            params += r_params\n+            # Skip empty r_fmt to allow subclasses to customize behaviour for\n+            # 3rd party backends. Refs #19096.\n+            if r_fmt:\n+                result.append(r_fmt % col)\n+                params += r_params\n             return [(\" \".join(result), tuple(params))]\n         if can_bulk:\n             result.append(self.connection.ops.bulk_insert_sql(fields, len(values)))\n@@ -934,7 +947,8 @@ def as_sql(self):\n         qn = self.quote_name_unless_alias\n         result = ['DELETE FROM %s' % qn(self.query.tables[0])]\n         where, params = self.query.where.as_sql(qn=qn, connection=self.connection)\n-        result.append('WHERE %s' % where)\n+        if where:\n+            result.append('WHERE %s' % where)\n         return ' '.join(result), tuple(params)\n \n class SQLUpdateCompiler(SQLCompiler):"
        },
        {
            "sha": "374509914d86be9cede9be69b278b4d475481d69",
            "filename": "django/db/models/sql/expressions.py",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fexpressions.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fexpressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fexpressions.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -6,7 +6,7 @@ class SQLEvaluator(object):\n     def __init__(self, expression, query, allow_joins=True):\n         self.expression = expression\n         self.opts = query.get_meta()\n-        self.cols = {}\n+        self.cols = []\n \n         self.contains_aggregate = False\n         self.expression.prepare(self, query, allow_joins)\n@@ -18,11 +18,15 @@ def as_sql(self, qn, connection):\n         return self.expression.evaluate(self, qn, connection)\n \n     def relabel_aliases(self, change_map):\n-        for node, col in self.cols.items():\n+        new_cols = []\n+        for node, col in self.cols:\n             if hasattr(col, \"relabel_aliases\"):\n                 col.relabel_aliases(change_map)\n+                new_cols.append((node, col))\n             else:\n-                self.cols[node] = (change_map.get(col[0], col[0]), col[1])\n+                new_cols.append((node,\n+                                (change_map.get(col[0], col[0]), col[1])))\n+        self.cols = new_cols\n \n     #####################################################\n     # Vistor methods for initial expression preparation #\n@@ -41,15 +45,15 @@ def prepare_leaf(self, node, query, allow_joins):\n         if (len(field_list) == 1 and\n             node.name in query.aggregate_select.keys()):\n             self.contains_aggregate = True\n-            self.cols[node] = query.aggregate_select[node.name]\n+            self.cols.append((node, query.aggregate_select[node.name]))\n         else:\n             try:\n                 field, source, opts, join_list, last, _ = query.setup_joins(\n                     field_list, query.get_meta(),\n                     query.get_initial_alias(), False)\n                 col, _, join_list = query.trim_joins(source, join_list, last, False)\n \n-                self.cols[node] = (join_list[-1], col)\n+                self.cols.append((node, (join_list[-1], col)))\n             except FieldDoesNotExist:\n                 raise FieldError(\"Cannot resolve keyword %r into field. \"\n                                  \"Choices are: %s\" % (self.name,\n@@ -80,7 +84,13 @@ def evaluate_node(self, node, qn, connection):\n         return connection.ops.combine_expression(node.connector, expressions), expression_params\n \n     def evaluate_leaf(self, node, qn, connection):\n-        col = self.cols[node]\n+        col = None\n+        for n, c in self.cols:\n+            if n is node:\n+                col = c\n+                break\n+        if col is None:\n+            raise ValueError(\"Given node not found\")\n         if hasattr(col, 'as_sql'):\n             return col.as_sql(qn, connection), ()\n         else:"
        },
        {
            "sha": "cef01c48ab61e3602a94bd3d807d68b16da4d429",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 24,
            "deletions": 7,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -115,7 +115,6 @@ def __init__(self, model, where=WhereNode):\n         self.default_ordering = True\n         self.standard_ordering = True\n         self.ordering_aliases = []\n-        self.select_fields = []\n         self.related_select_fields = []\n         self.dupe_avoidance = {}\n         self.used_aliases = set()\n@@ -124,6 +123,9 @@ def __init__(self, model, where=WhereNode):\n \n         # SQL-related attributes\n         self.select = []\n+        # For each to-be-selected field in self.select there must be a\n+        # corresponding entry in self.select - git seems to need this.\n+        self.select_fields = []\n         self.tables = []    # Aliases in the order they are created.\n         self.where = where()\n         self.where_class = where\n@@ -431,13 +433,9 @@ def get_count(self, using):\n \n     def has_results(self, using):\n         q = self.clone()\n+        q.clear_select_clause()\n         q.add_extra({'a': 1}, None, None, None, None, None)\n-        q.select = []\n-        q.select_fields = []\n-        q.default_cols = False\n-        q.select_related = False\n-        q.set_extra_mask(('a',))\n-        q.set_aggregate_mask(())\n+        q.set_extra_mask(['a'])\n         q.clear_ordering(True)\n         q.set_limits(high=1)\n         compiler = q.get_compiler(using=using)\n@@ -702,6 +700,11 @@ def promote_joins(self, aliases, unconditional=False):\n         aliases = list(aliases)\n         while aliases:\n             alias = aliases.pop(0)\n+            if self.alias_map[alias].rhs_join_col is None:\n+                # This is the base table (first FROM entry) - this table\n+                # isn't really joined at all in the query, so we should not\n+                # alter its join type.\n+                continue\n             parent_alias = self.alias_map[alias].lhs_alias\n             parent_louter = (parent_alias\n                 and self.alias_map[parent_alias].join_type == self.LOUTER)\n@@ -1188,6 +1191,9 @@ def add_filter(self, filter_expr, connector=AND, negate=False, trim=False,\n                     for alias in join_list:\n                         if self.alias_map[alias].join_type == self.LOUTER:\n                             j_col = self.alias_map[alias].rhs_join_col\n+                            # The join promotion logic should never produce\n+                            # a LOUTER join for the base join - assert that.\n+                            assert j_col is not None\n                             entry = self.where_class()\n                             entry.add(\n                                 (Constraint(alias, j_col, None), 'isnull', True),\n@@ -1618,6 +1624,17 @@ def can_filter(self):\n         \"\"\"\n         return not self.low_mark and self.high_mark is None\n \n+    def clear_select_clause(self):\n+        \"\"\"\n+        Removes all fields from SELECT clause.\n+        \"\"\"\n+        self.select = []\n+        self.select_fields = []\n+        self.default_cols = False\n+        self.select_related = False\n+        self.set_extra_mask(())\n+        self.set_aggregate_mask(())\n+\n     def clear_select_fields(self):\n         \"\"\"\n         Clears the list of fields to select (but not extra_select columns)."
        },
        {
            "sha": "24ac957cbf4a8d827df0d4152aa7d586924493a4",
            "filename": "django/db/models/sql/subqueries.py",
            "status": "modified",
            "additions": 40,
            "deletions": 5,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -3,6 +3,7 @@\n \"\"\"\n \n from django.core.exceptions import FieldError\n+from django.db import connections\n from django.db.models.constants import LOOKUP_SEP\n from django.db.models.fields import DateField, FieldDoesNotExist\n from django.db.models.sql.constants import *\n@@ -46,6 +47,43 @@ def delete_batch(self, pk_list, using, field=None):\n                     pk_list[offset:offset + GET_ITERATOR_CHUNK_SIZE]), AND)\n             self.do_query(self.model._meta.db_table, where, using=using)\n \n+    def delete_qs(self, query, using):\n+        \"\"\"\n+        Delete the queryset in one SQL query (if possible). For simple queries\n+        this is done by copying the query.query.where to self.query, for\n+        complex queries by using subquery.\n+        \"\"\"\n+        innerq = query.query\n+        # Make sure the inner query has at least one table in use.\n+        innerq.get_initial_alias()\n+        # The same for our new query.\n+        self.get_initial_alias()\n+        innerq_used_tables = [t for t in innerq.tables\n+                              if innerq.alias_refcount[t]]\n+        if ((not innerq_used_tables or innerq_used_tables == self.tables)\n+            and not len(innerq.having)):\n+            # There is only the base table in use in the query, and there are\n+            # no aggregate filtering going on.\n+            self.where = innerq.where\n+        else:\n+            pk = query.model._meta.pk\n+            if not connections[using].features.update_can_self_select:\n+                # We can't do the delete using subquery.\n+                values = list(query.values_list('pk', flat=True))\n+                if not values:\n+                    return\n+                self.delete_batch(values, using)\n+                return\n+            else:\n+                innerq.clear_select_clause()\n+                innerq.select, innerq.select_fields = [(self.get_initial_alias(), pk.column)], [None]\n+                values = innerq\n+            where = self.where_class()\n+            where.add((Constraint(None, pk.column, pk), 'in', values), AND)\n+            self.where = where\n+        self.get_compiler(using).execute_sql(None)\n+\n+\n class UpdateQuery(Query):\n     \"\"\"\n     Represents an \"update\" SQL query.\n@@ -205,11 +243,8 @@ def add_date_select(self, field_name, lookup_type, order='ASC'):\n                 % field.name\n         alias = result[3][-1]\n         select = Date((alias, field.column), lookup_type)\n-        self.select = [select]\n-        self.select_fields = [None]\n-        self.select_related = False # See #7097.\n-        self.aggregates = SortedDict() # See 18056.\n-        self.set_extra_mask([])\n+        self.clear_select_clause()\n+        self.select, self.select_fields = [select], [None]\n         self.distinct = True\n         self.order_by = order == 'ASC' and [1] or [-1]\n "
        },
        {
            "sha": "5fa78fe3509c9d6d26b4ed0c4f458552cd6f7f42",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 9,
            "deletions": 17,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,5 @@\n import os\n+import pkgutil\n from threading import local\n \n from django.conf import settings\n@@ -28,28 +29,19 @@ def load_backend(backend_name):\n         # listing all possible (built-in) database backends.\n         backend_dir = os.path.join(os.path.dirname(__file__), 'backends')\n         try:\n-            available_backends = [f for f in os.listdir(backend_dir)\n-                    if os.path.isdir(os.path.join(backend_dir, f))\n-                    and not f.startswith('.')]\n+            builtin_backends = [\n+                name for _, name, ispkg in pkgutil.iter_modules([backend_dir])\n+                if ispkg and name != 'dummy']\n         except EnvironmentError:\n-            available_backends = []\n-        full_notation = backend_name.startswith('django.db.backends.')\n-        if full_notation:\n-            backend_name = backend_name[19:] # See #15621.\n-        if backend_name not in available_backends:\n-            backend_reprs = map(repr, sorted(available_backends))\n+            builtin_backends = []\n+        if backend_name not in ['django.db.backends.%s' % b for b in\n+                                builtin_backends]:\n+            backend_reprs = map(repr, sorted(builtin_backends))\n             error_msg = (\"%r isn't an available database backend.\\n\"\n-                         \"Try using django.db.backends.XXX, where XXX \"\n+                         \"Try using 'django.db.backends.XXX', where XXX \"\n                          \"is one of:\\n    %s\\nError was: %s\" %\n                          (backend_name, \", \".join(backend_reprs), e_user))\n             raise ImproperlyConfigured(error_msg)\n-        elif not full_notation:\n-            # user tried to use the old notation for the database backend\n-            error_msg = (\"%r isn't an available database backend.\\n\"\n-                         \"Try using django.db.backends.%s instead.\\n\"\n-                         \"Error was: %s\" %\n-                         (backend_name, backend_name, e_user))\n-            raise ImproperlyConfigured(error_msg)\n         else:\n             # If there's some other error, this must be an error in Django\n             raise"
        },
        {
            "sha": "8d26e58bf4d63489b9da506a90a8cea8d5530980",
            "filename": "django/dispatch/dispatcher.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdispatch%2Fdispatcher.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fdispatch%2Fdispatcher.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fdispatcher.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -141,6 +141,9 @@ def disconnect(self, receiver=None, sender=None, weak=True, dispatch_uid=None):\n                     del self.receivers[index]\n                     break\n \n+    def has_listeners(self, sender=None):\n+        return bool(self._live_receivers(_make_id(sender)))\n+\n     def send(self, sender, **named):\n         \"\"\"\n         Send signal from sender to all connected receivers."
        },
        {
            "sha": "4438812a37000b88e9b5ba2969c2a2647313c66c",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -341,7 +341,7 @@ def to_python(self, value):\n             for format in self.input_formats:\n                 try:\n                     return self.strptime(value, format)\n-                except ValueError:\n+                except (ValueError, TypeError):\n                     continue\n         raise ValidationError(self.error_messages['invalid'])\n \n@@ -461,7 +461,7 @@ def _set_regex(self, regex):\n \n class EmailField(CharField):\n     default_error_messages = {\n-        'invalid': _('Enter a valid e-mail address.'),\n+        'invalid': _('Enter a valid email address.'),\n     }\n     default_validators = [validators.validate_email]\n "
        },
        {
            "sha": "c646eed506fb173409b960b17b5fedf7bbcc2215",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -123,7 +123,11 @@ def _construct_form(self, i, **kwargs):\n         \"\"\"\n         Instantiates and returns the i-th form instance in a formset.\n         \"\"\"\n-        defaults = {'auto_id': self.auto_id, 'prefix': self.add_prefix(i)}\n+        defaults = {\n+            'auto_id': self.auto_id,\n+            'prefix': self.add_prefix(i),\n+            'error_class': self.error_class,\n+            }\n         if self.is_bound:\n             defaults['data'] = self.data\n             defaults['files'] = self.files"
        },
        {
            "sha": "11fe0c09eada2bde44ab7b8703ce24723ea9210b",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1013,7 +1013,7 @@ def clean(self, value):\n         if self.required and not value:\n             raise ValidationError(self.error_messages['required'])\n         elif not self.required and not value:\n-            return []\n+            return self.queryset.none()\n         if not isinstance(value, (list, tuple)):\n             raise ValidationError(self.error_messages['list'])\n         key = self.to_field_name or 'pk'"
        },
        {
            "sha": "46afa34ee7376c78d66dd3c1934a6e642f7ab69c",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 812,
            "changes": 822,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,812 +1,10 @@\n-from __future__ import absolute_import, unicode_literals\n-\n-import copy\n-import datetime\n-from email.header import Header\n-import os\n-import re\n-import sys\n-import time\n-import warnings\n-\n-from io import BytesIO\n-from pprint import pformat\n-try:\n-    from urllib.parse import quote, parse_qsl, urlencode, urljoin, urlparse\n-except ImportError:     # Python 2\n-    from urllib import quote, urlencode\n-    from urlparse import parse_qsl, urljoin, urlparse\n-\n-from django.utils.six.moves import http_cookies\n-# Some versions of Python 2.7 and later won't need this encoding bug fix:\n-_cookie_encodes_correctly = http_cookies.SimpleCookie().value_encode(';') == (';', '\"\\\\073\"')\n-# See ticket #13007, http://bugs.python.org/issue2193 and http://trac.edgewall.org/ticket/2256\n-_tc = http_cookies.SimpleCookie()\n-try:\n-    _tc.load(str('foo:bar=1'))\n-    _cookie_allows_colon_in_names = True\n-except http_cookies.CookieError:\n-    _cookie_allows_colon_in_names = False\n-\n-if _cookie_encodes_correctly and _cookie_allows_colon_in_names:\n-    SimpleCookie = http_cookies.SimpleCookie\n-else:\n-    Morsel = http_cookies.Morsel\n-\n-    class SimpleCookie(http_cookies.SimpleCookie):\n-        if not _cookie_encodes_correctly:\n-            def value_encode(self, val):\n-                # Some browsers do not support quoted-string from RFC 2109,\n-                # including some versions of Safari and Internet Explorer.\n-                # These browsers split on ';', and some versions of Safari\n-                # are known to split on ', '. Therefore, we encode ';' and ','\n-\n-                # SimpleCookie already does the hard work of encoding and decoding.\n-                # It uses octal sequences like '\\\\012' for newline etc.\n-                # and non-ASCII chars. We just make use of this mechanism, to\n-                # avoid introducing two encoding schemes which would be confusing\n-                # and especially awkward for javascript.\n-\n-                # NB, contrary to Python docs, value_encode returns a tuple containing\n-                # (real val, encoded_val)\n-                val, encoded = super(SimpleCookie, self).value_encode(val)\n-\n-                encoded = encoded.replace(\";\", \"\\\\073\").replace(\",\",\"\\\\054\")\n-                # If encoded now contains any quoted chars, we need double quotes\n-                # around the whole string.\n-                if \"\\\\\" in encoded and not encoded.startswith('\"'):\n-                    encoded = '\"' + encoded + '\"'\n-\n-                return val, encoded\n-\n-        if not _cookie_allows_colon_in_names:\n-            def load(self, rawdata):\n-                self.bad_cookies = set()\n-                super(SimpleCookie, self).load(force_str(rawdata))\n-                for key in self.bad_cookies:\n-                    del self[key]\n-\n-            # override private __set() method:\n-            # (needed for using our Morsel, and for laxness with CookieError\n-            def _BaseCookie__set(self, key, real_value, coded_value):\n-                key = force_str(key)\n-                try:\n-                    M = self.get(key, Morsel())\n-                    M.set(key, real_value, coded_value)\n-                    dict.__setitem__(self, key, M)\n-                except http_cookies.CookieError:\n-                    self.bad_cookies.add(key)\n-                    dict.__setitem__(self, key, http_cookies.Morsel())\n-\n-\n-from django.conf import settings\n-from django.core import signing\n-from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n-from django.core.files import uploadhandler\n-from django.http.multipartparser import MultiPartParser\n-from django.http.utils import *\n-from django.utils.datastructures import MultiValueDict, ImmutableList\n-from django.utils.encoding import force_bytes, force_str, force_text, iri_to_uri\n-from django.utils.http import cookie_date\n-from django.utils import six\n-from django.utils import timezone\n-\n-RESERVED_CHARS=\"!*'();:@&=+$,/?%#[]\"\n-\n-absolute_http_url_re = re.compile(r\"^https?://\", re.I)\n-\n-class Http404(Exception):\n-    pass\n-\n-RAISE_ERROR = object()\n-\n-\n-def build_request_repr(request, path_override=None, GET_override=None,\n-                       POST_override=None, COOKIES_override=None,\n-                       META_override=None):\n-    \"\"\"\n-    Builds and returns the request's representation string. The request's\n-    attributes may be overridden by pre-processed values.\n-    \"\"\"\n-    # Since this is called as part of error handling, we need to be very\n-    # robust against potentially malformed input.\n-    try:\n-        get = (pformat(GET_override)\n-               if GET_override is not None\n-               else pformat(request.GET))\n-    except Exception:\n-        get = '<could not parse>'\n-    if request._post_parse_error:\n-        post = '<could not parse>'\n-    else:\n-        try:\n-            post = (pformat(POST_override)\n-                    if POST_override is not None\n-                    else pformat(request.POST))\n-        except Exception:\n-            post = '<could not parse>'\n-    try:\n-        cookies = (pformat(COOKIES_override)\n-                   if COOKIES_override is not None\n-                   else pformat(request.COOKIES))\n-    except Exception:\n-        cookies = '<could not parse>'\n-    try:\n-        meta = (pformat(META_override)\n-                if META_override is not None\n-                else pformat(request.META))\n-    except Exception:\n-        meta = '<could not parse>'\n-    path = path_override if path_override is not None else request.path\n-    return force_str('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n-                     (request.__class__.__name__,\n-                      path,\n-                      six.text_type(get),\n-                      six.text_type(post),\n-                      six.text_type(cookies),\n-                      six.text_type(meta)))\n-\n-class UnreadablePostError(IOError):\n-    pass\n-\n-class HttpRequest(object):\n-    \"\"\"A basic HTTP request.\"\"\"\n-\n-    # The encoding used in GET/POST dicts. None means use default setting.\n-    _encoding = None\n-    _upload_handlers = []\n-\n-    def __init__(self):\n-        self.GET, self.POST, self.COOKIES, self.META, self.FILES = {}, {}, {}, {}, {}\n-        self.path = ''\n-        self.path_info = ''\n-        self.method = None\n-        self._post_parse_error = False\n-\n-    def __repr__(self):\n-        return build_request_repr(self)\n-\n-    def get_host(self):\n-        \"\"\"Returns the HTTP host using the environment or request headers.\"\"\"\n-        # We try three options, in order of decreasing preference.\n-        if settings.USE_X_FORWARDED_HOST and (\n-            'HTTP_X_FORWARDED_HOST' in self.META):\n-            host = self.META['HTTP_X_FORWARDED_HOST']\n-        elif 'HTTP_HOST' in self.META:\n-            host = self.META['HTTP_HOST']\n-        else:\n-            # Reconstruct the host using the algorithm from PEP 333.\n-            host = self.META['SERVER_NAME']\n-            server_port = str(self.META['SERVER_PORT'])\n-            if server_port != ('443' if self.is_secure() else '80'):\n-                host = '%s:%s' % (host, server_port)\n-        return host\n-\n-    def get_full_path(self):\n-        # RFC 3986 requires query string arguments to be in the ASCII range.\n-        # Rather than crash if this doesn't happen, we encode defensively.\n-        return '%s%s' % (self.path, ('?' + iri_to_uri(self.META.get('QUERY_STRING', ''))) if self.META.get('QUERY_STRING', '') else '')\n-\n-    def get_signed_cookie(self, key, default=RAISE_ERROR, salt='', max_age=None):\n-        \"\"\"\n-        Attempts to return a signed cookie. If the signature fails or the\n-        cookie has expired, raises an exception... unless you provide the\n-        default argument in which case that value will be returned instead.\n-        \"\"\"\n-        try:\n-            cookie_value = self.COOKIES[key]\n-        except KeyError:\n-            if default is not RAISE_ERROR:\n-                return default\n-            else:\n-                raise\n-        try:\n-            value = signing.get_cookie_signer(salt=key + salt).unsign(\n-                cookie_value, max_age=max_age)\n-        except signing.BadSignature:\n-            if default is not RAISE_ERROR:\n-                return default\n-            else:\n-                raise\n-        return value\n-\n-    def build_absolute_uri(self, location=None):\n-        \"\"\"\n-        Builds an absolute URI from the location and the variables available in\n-        this request. If no location is specified, the absolute URI is built on\n-        ``request.get_full_path()``.\n-        \"\"\"\n-        if not location:\n-            location = self.get_full_path()\n-        if not absolute_http_url_re.match(location):\n-            current_uri = '%s://%s%s' % ('https' if self.is_secure() else 'http',\n-                                         self.get_host(), self.path)\n-            location = urljoin(current_uri, location)\n-        return iri_to_uri(location)\n-\n-    def _is_secure(self):\n-        return os.environ.get(\"HTTPS\") == \"on\"\n-\n-    def is_secure(self):\n-        # First, check the SECURE_PROXY_SSL_HEADER setting.\n-        if settings.SECURE_PROXY_SSL_HEADER:\n-            try:\n-                header, value = settings.SECURE_PROXY_SSL_HEADER\n-            except ValueError:\n-                raise ImproperlyConfigured('The SECURE_PROXY_SSL_HEADER setting must be a tuple containing two values.')\n-            if self.META.get(header, None) == value:\n-                return True\n-\n-        # Failing that, fall back to _is_secure(), which is a hook for\n-        # subclasses to implement.\n-        return self._is_secure()\n-\n-    def is_ajax(self):\n-        return self.META.get('HTTP_X_REQUESTED_WITH') == 'XMLHttpRequest'\n-\n-    @property\n-    def encoding(self):\n-        return self._encoding\n-\n-    @encoding.setter\n-    def encoding(self, val):\n-        \"\"\"\n-        Sets the encoding used for GET/POST accesses. If the GET or POST\n-        dictionary has already been created, it is removed and recreated on the\n-        next access (so that it is decoded correctly).\n-        \"\"\"\n-        self._encoding = val\n-        if hasattr(self, '_get'):\n-            del self._get\n-        if hasattr(self, '_post'):\n-            del self._post\n-\n-    def _initialize_handlers(self):\n-        self._upload_handlers = [uploadhandler.load_handler(handler, self)\n-                                 for handler in settings.FILE_UPLOAD_HANDLERS]\n-\n-    @property\n-    def upload_handlers(self):\n-        if not self._upload_handlers:\n-            # If there are no upload handlers defined, initialize them from settings.\n-            self._initialize_handlers()\n-        return self._upload_handlers\n-\n-    @upload_handlers.setter\n-    def upload_handlers(self, upload_handlers):\n-        if hasattr(self, '_files'):\n-            raise AttributeError(\"You cannot set the upload handlers after the upload has been processed.\")\n-        self._upload_handlers = upload_handlers\n-\n-    def parse_file_upload(self, META, post_data):\n-        \"\"\"Returns a tuple of (POST QueryDict, FILES MultiValueDict).\"\"\"\n-        self.upload_handlers = ImmutableList(\n-            self.upload_handlers,\n-            warning=\"You cannot alter upload handlers after the upload has been processed.\"\n-        )\n-        parser = MultiPartParser(META, post_data, self.upload_handlers, self.encoding)\n-        return parser.parse()\n-\n-    @property\n-    def body(self):\n-        if not hasattr(self, '_body'):\n-            if self._read_started:\n-                raise Exception(\"You cannot access body after reading from request's data stream\")\n-            try:\n-                self._body = self.read()\n-            except IOError as e:\n-                six.reraise(UnreadablePostError, UnreadablePostError(*e.args), sys.exc_info()[2])\n-            self._stream = BytesIO(self._body)\n-        return self._body\n-\n-    @property\n-    def raw_post_data(self):\n-        warnings.warn('HttpRequest.raw_post_data has been deprecated. Use HttpRequest.body instead.', DeprecationWarning)\n-        return self.body\n-\n-    def _mark_post_parse_error(self):\n-        self._post = QueryDict('')\n-        self._files = MultiValueDict()\n-        self._post_parse_error = True\n-\n-    def _load_post_and_files(self):\n-        # Populates self._post and self._files\n-        if self.method != 'POST':\n-            self._post, self._files = QueryDict('', encoding=self._encoding), MultiValueDict()\n-            return\n-        if self._read_started and not hasattr(self, '_body'):\n-            self._mark_post_parse_error()\n-            return\n-\n-        if self.META.get('CONTENT_TYPE', '').startswith('multipart'):\n-            if hasattr(self, '_body'):\n-                # Use already read data\n-                data = BytesIO(self._body)\n-            else:\n-                data = self\n-            try:\n-                self._post, self._files = self.parse_file_upload(self.META, data)\n-            except:\n-                # An error occured while parsing POST data. Since when\n-                # formatting the error the request handler might access\n-                # self.POST, set self._post and self._file to prevent\n-                # attempts to parse POST data again.\n-                # Mark that an error occured. This allows self.__repr__ to\n-                # be explicit about it instead of simply representing an\n-                # empty POST\n-                self._mark_post_parse_error()\n-                raise\n-        else:\n-            self._post, self._files = QueryDict(self.body, encoding=self._encoding), MultiValueDict()\n-\n-    ## File-like and iterator interface.\n-    ##\n-    ## Expects self._stream to be set to an appropriate source of bytes by\n-    ## a corresponding request subclass (e.g. WSGIRequest).\n-    ## Also when request data has already been read by request.POST or\n-    ## request.body, self._stream points to a BytesIO instance\n-    ## containing that data.\n-\n-    def read(self, *args, **kwargs):\n-        self._read_started = True\n-        return self._stream.read(*args, **kwargs)\n-\n-    def readline(self, *args, **kwargs):\n-        self._read_started = True\n-        return self._stream.readline(*args, **kwargs)\n-\n-    def xreadlines(self):\n-        while True:\n-            buf = self.readline()\n-            if not buf:\n-                break\n-            yield buf\n-\n-    __iter__ = xreadlines\n-\n-    def readlines(self):\n-        return list(iter(self))\n-\n-\n-class QueryDict(MultiValueDict):\n-    \"\"\"\n-    A specialized MultiValueDict that takes a query string when initialized.\n-    This is immutable unless you create a copy of it.\n-\n-    Values retrieved from this class are converted from the given encoding\n-    (DEFAULT_CHARSET by default) to unicode.\n-    \"\"\"\n-    # These are both reset in __init__, but is specified here at the class\n-    # level so that unpickling will have valid values\n-    _mutable = True\n-    _encoding = None\n-\n-    def __init__(self, query_string, mutable=False, encoding=None):\n-        super(QueryDict, self).__init__()\n-        if not encoding:\n-            encoding = settings.DEFAULT_CHARSET\n-        self.encoding = encoding\n-        if six.PY3:\n-            for key, value in parse_qsl(query_string or '',\n-                                        keep_blank_values=True,\n-                                        encoding=encoding):\n-                self.appendlist(key, value)\n-        else:\n-            for key, value in parse_qsl(query_string or '',\n-                                        keep_blank_values=True):\n-                self.appendlist(force_text(key, encoding, errors='replace'),\n-                                force_text(value, encoding, errors='replace'))\n-        self._mutable = mutable\n-\n-    @property\n-    def encoding(self):\n-        if self._encoding is None:\n-            self._encoding = settings.DEFAULT_CHARSET\n-        return self._encoding\n-\n-    @encoding.setter\n-    def encoding(self, value):\n-        self._encoding = value\n-\n-    def _assert_mutable(self):\n-        if not self._mutable:\n-            raise AttributeError(\"This QueryDict instance is immutable\")\n-\n-    def __setitem__(self, key, value):\n-        self._assert_mutable()\n-        key = bytes_to_text(key, self.encoding)\n-        value = bytes_to_text(value, self.encoding)\n-        super(QueryDict, self).__setitem__(key, value)\n-\n-    def __delitem__(self, key):\n-        self._assert_mutable()\n-        super(QueryDict, self).__delitem__(key)\n-\n-    def __copy__(self):\n-        result = self.__class__('', mutable=True, encoding=self.encoding)\n-        for key, value in six.iterlists(self):\n-            result.setlist(key, value)\n-        return result\n-\n-    def __deepcopy__(self, memo):\n-        result = self.__class__('', mutable=True, encoding=self.encoding)\n-        memo[id(self)] = result\n-        for key, value in six.iterlists(self):\n-            result.setlist(copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n-        return result\n-\n-    def setlist(self, key, list_):\n-        self._assert_mutable()\n-        key = bytes_to_text(key, self.encoding)\n-        list_ = [bytes_to_text(elt, self.encoding) for elt in list_]\n-        super(QueryDict, self).setlist(key, list_)\n-\n-    def setlistdefault(self, key, default_list=None):\n-        self._assert_mutable()\n-        return super(QueryDict, self).setlistdefault(key, default_list)\n-\n-    def appendlist(self, key, value):\n-        self._assert_mutable()\n-        key = bytes_to_text(key, self.encoding)\n-        value = bytes_to_text(value, self.encoding)\n-        super(QueryDict, self).appendlist(key, value)\n-\n-    def pop(self, key, *args):\n-        self._assert_mutable()\n-        return super(QueryDict, self).pop(key, *args)\n-\n-    def popitem(self):\n-        self._assert_mutable()\n-        return super(QueryDict, self).popitem()\n-\n-    def clear(self):\n-        self._assert_mutable()\n-        super(QueryDict, self).clear()\n-\n-    def setdefault(self, key, default=None):\n-        self._assert_mutable()\n-        key = bytes_to_text(key, self.encoding)\n-        default = bytes_to_text(default, self.encoding)\n-        return super(QueryDict, self).setdefault(key, default)\n-\n-    def copy(self):\n-        \"\"\"Returns a mutable copy of this object.\"\"\"\n-        return self.__deepcopy__({})\n-\n-    def urlencode(self, safe=None):\n-        \"\"\"\n-        Returns an encoded string of all query string arguments.\n-\n-        :arg safe: Used to specify characters which do not require quoting, for\n-            example::\n-\n-                >>> q = QueryDict('', mutable=True)\n-                >>> q['next'] = '/a&b/'\n-                >>> q.urlencode()\n-                'next=%2Fa%26b%2F'\n-                >>> q.urlencode(safe='/')\n-                'next=/a%26b/'\n-\n-        \"\"\"\n-        output = []\n-        if safe:\n-            safe = force_bytes(safe, self.encoding)\n-            encode = lambda k, v: '%s=%s' % ((quote(k, safe), quote(v, safe)))\n-        else:\n-            encode = lambda k, v: urlencode({k: v})\n-        for k, list_ in self.lists():\n-            k = force_bytes(k, self.encoding)\n-            output.extend([encode(k, force_bytes(v, self.encoding))\n-                           for v in list_])\n-        return '&'.join(output)\n-\n-\n-def parse_cookie(cookie):\n-    if cookie == '':\n-        return {}\n-    if not isinstance(cookie, http_cookies.BaseCookie):\n-        try:\n-            c = SimpleCookie()\n-            c.load(cookie)\n-        except http_cookies.CookieError:\n-            # Invalid cookie\n-            return {}\n-    else:\n-        c = cookie\n-    cookiedict = {}\n-    for key in c.keys():\n-        cookiedict[key] = c.get(key).value\n-    return cookiedict\n-\n-class BadHeaderError(ValueError):\n-    pass\n-\n-class HttpResponse(object):\n-    \"\"\"A basic HTTP response, with content and dictionary-accessed headers.\"\"\"\n-\n-    status_code = 200\n-\n-    def __init__(self, content='', content_type=None, status=None,\n-            mimetype=None):\n-        # _headers is a mapping of the lower-case name to the original case of\n-        # the header (required for working with legacy systems) and the header\n-        # value. Both the name of the header and its value are ASCII strings.\n-        self._headers = {}\n-        self._charset = settings.DEFAULT_CHARSET\n-        if mimetype:\n-            warnings.warn(\"Using mimetype keyword argument is deprecated, use\"\n-                          \" content_type instead\", PendingDeprecationWarning)\n-            content_type = mimetype\n-        if not content_type:\n-            content_type = \"%s; charset=%s\" % (settings.DEFAULT_CONTENT_TYPE,\n-                    self._charset)\n-        # content is a bytestring. See the content property methods.\n-        self.content = content\n-        self.cookies = SimpleCookie()\n-        if status:\n-            self.status_code = status\n-\n-        self['Content-Type'] = content_type\n-\n-    def serialize(self):\n-        \"\"\"Full HTTP message, including headers, as a bytestring.\"\"\"\n-        headers = [\n-            ('%s: %s' % (key, value)).encode('us-ascii')\n-            for key, value in self._headers.values()\n-        ]\n-        return b'\\r\\n'.join(headers) + b'\\r\\n\\r\\n' + self.content\n-\n-    if six.PY3:\n-        __bytes__ = serialize\n-    else:\n-        __str__ = serialize\n-\n-    def _convert_to_charset(self, value, charset, mime_encode=False):\n-        \"\"\"Converts headers key/value to ascii/latin1 native strings.\n-\n-        `charset` must be 'ascii' or 'latin-1'. If `mime_encode` is True and\n-        `value` value can't be represented in the given charset, MIME-encoding\n-        is applied.\n-        \"\"\"\n-        if not isinstance(value, (bytes, six.text_type)):\n-            value = str(value)\n-        try:\n-            if six.PY3:\n-                if isinstance(value, str):\n-                    # Ensure string is valid in given charset\n-                    value.encode(charset)\n-                else:\n-                    # Convert bytestring using given charset\n-                    value = value.decode(charset)\n-            else:\n-                if isinstance(value, str):\n-                    # Ensure string is valid in given charset\n-                    value.decode(charset)\n-                else:\n-                    # Convert unicode string to given charset\n-                    value = value.encode(charset)\n-        except UnicodeError as e:\n-            if mime_encode:\n-                # Wrapping in str() is a workaround for #12422 under Python 2.\n-                value = str(Header(value, 'utf-8').encode())\n-            else:\n-                e.reason += ', HTTP response headers must be in %s format' % charset\n-                raise\n-        if str('\\n') in value or str('\\r') in value:\n-            raise BadHeaderError(\"Header values can't contain newlines (got %r)\" % value)\n-        return value\n-\n-    def __setitem__(self, header, value):\n-        header = self._convert_to_charset(header, 'ascii')\n-        value = self._convert_to_charset(value, 'latin1', mime_encode=True)\n-        self._headers[header.lower()] = (header, value)\n-\n-    def __delitem__(self, header):\n-        try:\n-            del self._headers[header.lower()]\n-        except KeyError:\n-            pass\n-\n-    def __getitem__(self, header):\n-        return self._headers[header.lower()][1]\n-\n-    def __getstate__(self):\n-        # SimpleCookie is not pickeable with pickle.HIGHEST_PROTOCOL, so we\n-        # serialise to a string instead\n-        state = self.__dict__.copy()\n-        state['cookies'] = str(state['cookies'])\n-        return state\n-\n-    def __setstate__(self, state):\n-        self.__dict__.update(state)\n-        self.cookies = SimpleCookie(self.cookies)\n-\n-    def has_header(self, header):\n-        \"\"\"Case-insensitive check for a header.\"\"\"\n-        return header.lower() in self._headers\n-\n-    __contains__ = has_header\n-\n-    def items(self):\n-        return self._headers.values()\n-\n-    def get(self, header, alternate=None):\n-        return self._headers.get(header.lower(), (None, alternate))[1]\n-\n-    def set_cookie(self, key, value='', max_age=None, expires=None, path='/',\n-                   domain=None, secure=False, httponly=False):\n-        \"\"\"\n-        Sets a cookie.\n-\n-        ``expires`` can be:\n-        - a string in the correct format,\n-        - a naive ``datetime.datetime`` object in UTC,\n-        - an aware ``datetime.datetime`` object in any time zone.\n-        If it is a ``datetime.datetime`` object then ``max_age`` will be calculated.\n-\n-        \"\"\"\n-        self.cookies[key] = value\n-        if expires is not None:\n-            if isinstance(expires, datetime.datetime):\n-                if timezone.is_aware(expires):\n-                    expires = timezone.make_naive(expires, timezone.utc)\n-                delta = expires - expires.utcnow()\n-                # Add one second so the date matches exactly (a fraction of\n-                # time gets lost between converting to a timedelta and\n-                # then the date string).\n-                delta = delta + datetime.timedelta(seconds=1)\n-                # Just set max_age - the max_age logic will set expires.\n-                expires = None\n-                max_age = max(0, delta.days * 86400 + delta.seconds)\n-            else:\n-                self.cookies[key]['expires'] = expires\n-        if max_age is not None:\n-            self.cookies[key]['max-age'] = max_age\n-            # IE requires expires, so set it if hasn't been already.\n-            if not expires:\n-                self.cookies[key]['expires'] = cookie_date(time.time() +\n-                                                           max_age)\n-        if path is not None:\n-            self.cookies[key]['path'] = path\n-        if domain is not None:\n-            self.cookies[key]['domain'] = domain\n-        if secure:\n-            self.cookies[key]['secure'] = True\n-        if httponly:\n-            self.cookies[key]['httponly'] = True\n-\n-    def set_signed_cookie(self, key, value, salt='', **kwargs):\n-        value = signing.get_cookie_signer(salt=key + salt).sign(value)\n-        return self.set_cookie(key, value, **kwargs)\n-\n-    def delete_cookie(self, key, path='/', domain=None):\n-        self.set_cookie(key, max_age=0, path=path, domain=domain,\n-                        expires='Thu, 01-Jan-1970 00:00:00 GMT')\n-\n-    @property\n-    def content(self):\n-        if self.has_header('Content-Encoding'):\n-            def make_bytes(value):\n-                if isinstance(value, int):\n-                    value = six.text_type(value)\n-                if isinstance(value, six.text_type):\n-                    value = value.encode('ascii')\n-                # force conversion to bytes in case chunk is a subclass\n-                return bytes(value)\n-            return b''.join(make_bytes(e) for e in self._container)\n-        return b''.join(force_bytes(e, self._charset) for e in self._container)\n-\n-    @content.setter\n-    def content(self, value):\n-        if hasattr(value, '__iter__') and not isinstance(value, (bytes, six.string_types)):\n-            self._container = value\n-            self._base_content_is_iter = True\n-        else:\n-            self._container = [value]\n-            self._base_content_is_iter = False\n-\n-    def __iter__(self):\n-        self._iterator = iter(self._container)\n-        return self\n-\n-    def __next__(self):\n-        chunk = next(self._iterator)\n-        if isinstance(chunk, int):\n-            chunk = six.text_type(chunk)\n-        if isinstance(chunk, six.text_type):\n-            chunk = chunk.encode(self._charset)\n-        # force conversion to bytes in case chunk is a subclass\n-        return bytes(chunk)\n-\n-    next = __next__             # Python 2 compatibility\n-\n-    def close(self):\n-        if hasattr(self._container, 'close'):\n-            self._container.close()\n-\n-    # The remaining methods partially implement the file-like object interface.\n-    # See http://docs.python.org/lib/bltin-file-objects.html\n-    def write(self, content):\n-        if self._base_content_is_iter:\n-            raise Exception(\"This %s instance is not writable\" % self.__class__)\n-        self._container.append(content)\n-\n-    def flush(self):\n-        pass\n-\n-    def tell(self):\n-        if self._base_content_is_iter:\n-            raise Exception(\"This %s instance cannot tell its position\" % self.__class__)\n-        return sum([len(chunk) for chunk in self])\n-\n-class HttpResponseRedirectBase(HttpResponse):\n-    allowed_schemes = ['http', 'https', 'ftp']\n-\n-    def __init__(self, redirect_to, *args, **kwargs):\n-        parsed = urlparse(redirect_to)\n-        if parsed.scheme and parsed.scheme not in self.allowed_schemes:\n-            raise SuspiciousOperation(\"Unsafe redirect to URL with protocol '%s'\" % parsed.scheme)\n-        super(HttpResponseRedirectBase, self).__init__(*args, **kwargs)\n-        self['Location'] = iri_to_uri(redirect_to)\n-\n-class HttpResponseRedirect(HttpResponseRedirectBase):\n-    status_code = 302\n-\n-class HttpResponsePermanentRedirect(HttpResponseRedirectBase):\n-    status_code = 301\n-\n-class HttpResponseNotModified(HttpResponse):\n-    status_code = 304\n-\n-    def __init__(self, *args, **kwargs):\n-        super(HttpResponseNotModified, self).__init__(*args, **kwargs)\n-        del self['content-type']\n-\n-    @HttpResponse.content.setter\n-    def content(self, value):\n-        if value:\n-            raise AttributeError(\"You cannot set content to a 304 (Not Modified) response\")\n-        self._container = []\n-\n-class HttpResponseBadRequest(HttpResponse):\n-    status_code = 400\n-\n-class HttpResponseNotFound(HttpResponse):\n-    status_code = 404\n-\n-class HttpResponseForbidden(HttpResponse):\n-    status_code = 403\n-\n-class HttpResponseNotAllowed(HttpResponse):\n-    status_code = 405\n-\n-    def __init__(self, permitted_methods, *args, **kwargs):\n-        super(HttpResponseNotAllowed, self).__init__(*args, **kwargs)\n-        self['Allow'] = ', '.join(permitted_methods)\n-\n-class HttpResponseGone(HttpResponse):\n-    status_code = 410\n-\n-class HttpResponseServerError(HttpResponse):\n-    status_code = 500\n-\n-# A backwards compatible alias for HttpRequest.get_host.\n-def get_host(request):\n-    return request.get_host()\n-\n-# It's neither necessary nor appropriate to use\n-# django.utils.encoding.smart_text for parsing URLs and form inputs. Thus,\n-# this slightly more restricted function, used by QueryDict.\n-def bytes_to_text(s, encoding):\n-    \"\"\"\n-    Converts basestring objects to unicode, using the given encoding. Illegally\n-    encoded input characters are replaced with Unicode \"unknown\" codepoint\n-    (\\ufffd).\n-\n-    Returns any non-basestring objects without change.\n-    \"\"\"\n-    if isinstance(s, bytes):\n-        return six.text_type(s, encoding, 'replace')\n-    else:\n-        return s\n-\n+from django.http.cookie import SimpleCookie, parse_cookie\n+from django.http.request import (HttpRequest, QueryDict, UnreadablePostError,\n+    build_request_repr)\n+from django.http.response import (HttpResponse, StreamingHttpResponse,\n+    CompatibleStreamingHttpResponse, HttpResponsePermanentRedirect,\n+    HttpResponseRedirect, HttpResponseNotModified, HttpResponseBadRequest,\n+    HttpResponseForbidden, HttpResponseNotFound, HttpResponseNotAllowed,\n+    HttpResponseGone, HttpResponseServerError, Http404, BadHeaderError)\n+from django.http.utils import (fix_location_header, conditional_content_removal,\n+    fix_IE_for_attach, fix_IE_for_vary)"
        },
        {
            "sha": "78adb09ce81a025f50a27fd30f0a2d5855e56046",
            "filename": "django/http/cookie.py",
            "status": "added",
            "additions": 83,
            "deletions": 0,
            "changes": 83,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Fcookie.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Fcookie.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fcookie.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,83 @@\n+from __future__ import absolute_import, unicode_literals\n+\n+from django.utils.encoding import force_str\n+from django.utils.six.moves import http_cookies\n+\n+\n+# Some versions of Python 2.7 and later won't need this encoding bug fix:\n+_cookie_encodes_correctly = http_cookies.SimpleCookie().value_encode(';') == (';', '\"\\\\073\"')\n+# See ticket #13007, http://bugs.python.org/issue2193 and http://trac.edgewall.org/ticket/2256\n+_tc = http_cookies.SimpleCookie()\n+try:\n+    _tc.load(str('foo:bar=1'))\n+    _cookie_allows_colon_in_names = True\n+except http_cookies.CookieError:\n+    _cookie_allows_colon_in_names = False\n+\n+if _cookie_encodes_correctly and _cookie_allows_colon_in_names:\n+    SimpleCookie = http_cookies.SimpleCookie\n+else:\n+    Morsel = http_cookies.Morsel\n+\n+    class SimpleCookie(http_cookies.SimpleCookie):\n+        if not _cookie_encodes_correctly:\n+            def value_encode(self, val):\n+                # Some browsers do not support quoted-string from RFC 2109,\n+                # including some versions of Safari and Internet Explorer.\n+                # These browsers split on ';', and some versions of Safari\n+                # are known to split on ', '. Therefore, we encode ';' and ','\n+\n+                # SimpleCookie already does the hard work of encoding and decoding.\n+                # It uses octal sequences like '\\\\012' for newline etc.\n+                # and non-ASCII chars. We just make use of this mechanism, to\n+                # avoid introducing two encoding schemes which would be confusing\n+                # and especially awkward for javascript.\n+\n+                # NB, contrary to Python docs, value_encode returns a tuple containing\n+                # (real val, encoded_val)\n+                val, encoded = super(SimpleCookie, self).value_encode(val)\n+\n+                encoded = encoded.replace(\";\", \"\\\\073\").replace(\",\",\"\\\\054\")\n+                # If encoded now contains any quoted chars, we need double quotes\n+                # around the whole string.\n+                if \"\\\\\" in encoded and not encoded.startswith('\"'):\n+                    encoded = '\"' + encoded + '\"'\n+\n+                return val, encoded\n+\n+        if not _cookie_allows_colon_in_names:\n+            def load(self, rawdata):\n+                self.bad_cookies = set()\n+                super(SimpleCookie, self).load(force_str(rawdata))\n+                for key in self.bad_cookies:\n+                    del self[key]\n+\n+            # override private __set() method:\n+            # (needed for using our Morsel, and for laxness with CookieError\n+            def _BaseCookie__set(self, key, real_value, coded_value):\n+                key = force_str(key)\n+                try:\n+                    M = self.get(key, Morsel())\n+                    M.set(key, real_value, coded_value)\n+                    dict.__setitem__(self, key, M)\n+                except http_cookies.CookieError:\n+                    self.bad_cookies.add(key)\n+                    dict.__setitem__(self, key, http_cookies.Morsel())\n+\n+\n+def parse_cookie(cookie):\n+    if cookie == '':\n+        return {}\n+    if not isinstance(cookie, http_cookies.BaseCookie):\n+        try:\n+            c = SimpleCookie()\n+            c.load(cookie)\n+        except http_cookies.CookieError:\n+            # Invalid cookie\n+            return {}\n+    else:\n+        c = cookie\n+    cookiedict = {}\n+    for key in c.keys():\n+        cookiedict[key] = c.get(key).value\n+    return cookiedict"
        },
        {
            "sha": "96c7606c86d94b4ed3a1bf4299d1fd45770da20e",
            "filename": "django/http/request.py",
            "status": "added",
            "additions": 453,
            "deletions": 0,
            "changes": 453,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Frequest.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Frequest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Frequest.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,453 @@\n+from __future__ import absolute_import, unicode_literals\n+\n+import copy\n+import os\n+import re\n+import sys\n+import warnings\n+from io import BytesIO\n+from pprint import pformat\n+try:\n+    from urllib.parse import parse_qsl, urlencode, quote, urljoin\n+except ImportError:\n+    from urllib import urlencode, quote\n+    from urlparse import parse_qsl, urljoin\n+\n+from django.conf import settings\n+from django.core import signing\n+from django.core.exceptions import SuspiciousOperation, ImproperlyConfigured\n+from django.core.files import uploadhandler\n+from django.http.multipartparser import MultiPartParser\n+from django.utils import six\n+from django.utils.datastructures import MultiValueDict, ImmutableList\n+from django.utils.encoding import force_bytes, force_text, force_str, iri_to_uri\n+\n+\n+RAISE_ERROR = object()\n+absolute_http_url_re = re.compile(r\"^https?://\", re.I)\n+\n+\n+class UnreadablePostError(IOError):\n+    pass\n+\n+\n+class HttpRequest(object):\n+    \"\"\"A basic HTTP request.\"\"\"\n+\n+    # The encoding used in GET/POST dicts. None means use default setting.\n+    _encoding = None\n+    _upload_handlers = []\n+\n+    def __init__(self):\n+        self.GET, self.POST, self.COOKIES, self.META, self.FILES = {}, {}, {}, {}, {}\n+        self.path = ''\n+        self.path_info = ''\n+        self.method = None\n+        self._post_parse_error = False\n+\n+    def __repr__(self):\n+        return build_request_repr(self)\n+\n+    def get_host(self):\n+        \"\"\"Returns the HTTP host using the environment or request headers.\"\"\"\n+        # We try three options, in order of decreasing preference.\n+        if settings.USE_X_FORWARDED_HOST and (\n+            'HTTP_X_FORWARDED_HOST' in self.META):\n+            host = self.META['HTTP_X_FORWARDED_HOST']\n+        elif 'HTTP_HOST' in self.META:\n+            host = self.META['HTTP_HOST']\n+        else:\n+            # Reconstruct the host using the algorithm from PEP 333.\n+            host = self.META['SERVER_NAME']\n+            server_port = str(self.META['SERVER_PORT'])\n+            if server_port != ('443' if self.is_secure() else '80'):\n+                host = '%s:%s' % (host, server_port)\n+\n+        # Disallow potentially poisoned hostnames.\n+        if set(';/?@&=+$,').intersection(host):\n+            raise SuspiciousOperation('Invalid HTTP_HOST header: %s' % host)\n+\n+        return host\n+\n+    def get_full_path(self):\n+        # RFC 3986 requires query string arguments to be in the ASCII range.\n+        # Rather than crash if this doesn't happen, we encode defensively.\n+        return '%s%s' % (self.path, ('?' + iri_to_uri(self.META.get('QUERY_STRING', ''))) if self.META.get('QUERY_STRING', '') else '')\n+\n+    def get_signed_cookie(self, key, default=RAISE_ERROR, salt='', max_age=None):\n+        \"\"\"\n+        Attempts to return a signed cookie. If the signature fails or the\n+        cookie has expired, raises an exception... unless you provide the\n+        default argument in which case that value will be returned instead.\n+        \"\"\"\n+        try:\n+            cookie_value = self.COOKIES[key]\n+        except KeyError:\n+            if default is not RAISE_ERROR:\n+                return default\n+            else:\n+                raise\n+        try:\n+            value = signing.get_cookie_signer(salt=key + salt).unsign(\n+                cookie_value, max_age=max_age)\n+        except signing.BadSignature:\n+            if default is not RAISE_ERROR:\n+                return default\n+            else:\n+                raise\n+        return value\n+\n+    def build_absolute_uri(self, location=None):\n+        \"\"\"\n+        Builds an absolute URI from the location and the variables available in\n+        this request. If no location is specified, the absolute URI is built on\n+        ``request.get_full_path()``.\n+        \"\"\"\n+        if not location:\n+            location = self.get_full_path()\n+        if not absolute_http_url_re.match(location):\n+            current_uri = '%s://%s%s' % ('https' if self.is_secure() else 'http',\n+                                         self.get_host(), self.path)\n+            location = urljoin(current_uri, location)\n+        return iri_to_uri(location)\n+\n+    def _is_secure(self):\n+        return os.environ.get(\"HTTPS\") == \"on\"\n+\n+    def is_secure(self):\n+        # First, check the SECURE_PROXY_SSL_HEADER setting.\n+        if settings.SECURE_PROXY_SSL_HEADER:\n+            try:\n+                header, value = settings.SECURE_PROXY_SSL_HEADER\n+            except ValueError:\n+                raise ImproperlyConfigured('The SECURE_PROXY_SSL_HEADER setting must be a tuple containing two values.')\n+            if self.META.get(header, None) == value:\n+                return True\n+\n+        # Failing that, fall back to _is_secure(), which is a hook for\n+        # subclasses to implement.\n+        return self._is_secure()\n+\n+    def is_ajax(self):\n+        return self.META.get('HTTP_X_REQUESTED_WITH') == 'XMLHttpRequest'\n+\n+    @property\n+    def encoding(self):\n+        return self._encoding\n+\n+    @encoding.setter\n+    def encoding(self, val):\n+        \"\"\"\n+        Sets the encoding used for GET/POST accesses. If the GET or POST\n+        dictionary has already been created, it is removed and recreated on the\n+        next access (so that it is decoded correctly).\n+        \"\"\"\n+        self._encoding = val\n+        if hasattr(self, '_get'):\n+            del self._get\n+        if hasattr(self, '_post'):\n+            del self._post\n+\n+    def _initialize_handlers(self):\n+        self._upload_handlers = [uploadhandler.load_handler(handler, self)\n+                                 for handler in settings.FILE_UPLOAD_HANDLERS]\n+\n+    @property\n+    def upload_handlers(self):\n+        if not self._upload_handlers:\n+            # If there are no upload handlers defined, initialize them from settings.\n+            self._initialize_handlers()\n+        return self._upload_handlers\n+\n+    @upload_handlers.setter\n+    def upload_handlers(self, upload_handlers):\n+        if hasattr(self, '_files'):\n+            raise AttributeError(\"You cannot set the upload handlers after the upload has been processed.\")\n+        self._upload_handlers = upload_handlers\n+\n+    def parse_file_upload(self, META, post_data):\n+        \"\"\"Returns a tuple of (POST QueryDict, FILES MultiValueDict).\"\"\"\n+        self.upload_handlers = ImmutableList(\n+            self.upload_handlers,\n+            warning=\"You cannot alter upload handlers after the upload has been processed.\"\n+        )\n+        parser = MultiPartParser(META, post_data, self.upload_handlers, self.encoding)\n+        return parser.parse()\n+\n+    @property\n+    def body(self):\n+        if not hasattr(self, '_body'):\n+            if self._read_started:\n+                raise Exception(\"You cannot access body after reading from request's data stream\")\n+            try:\n+                self._body = self.read()\n+            except IOError as e:\n+                six.reraise(UnreadablePostError, UnreadablePostError(*e.args), sys.exc_info()[2])\n+            self._stream = BytesIO(self._body)\n+        return self._body\n+\n+    @property\n+    def raw_post_data(self):\n+        warnings.warn('HttpRequest.raw_post_data has been deprecated. Use HttpRequest.body instead.', DeprecationWarning)\n+        return self.body\n+\n+    def _mark_post_parse_error(self):\n+        self._post = QueryDict('')\n+        self._files = MultiValueDict()\n+        self._post_parse_error = True\n+\n+    def _load_post_and_files(self):\n+        \"\"\"Populate self._post and self._files if the content-type is a form type\"\"\"\n+        if self.method != 'POST':\n+            self._post, self._files = QueryDict('', encoding=self._encoding), MultiValueDict()\n+            return\n+        if self._read_started and not hasattr(self, '_body'):\n+            self._mark_post_parse_error()\n+            return\n+\n+        if self.META.get('CONTENT_TYPE', '').startswith('multipart/form-data'):\n+            if hasattr(self, '_body'):\n+                # Use already read data\n+                data = BytesIO(self._body)\n+            else:\n+                data = self\n+            try:\n+                self._post, self._files = self.parse_file_upload(self.META, data)\n+            except:\n+                # An error occured while parsing POST data. Since when\n+                # formatting the error the request handler might access\n+                # self.POST, set self._post and self._file to prevent\n+                # attempts to parse POST data again.\n+                # Mark that an error occured. This allows self.__repr__ to\n+                # be explicit about it instead of simply representing an\n+                # empty POST\n+                self._mark_post_parse_error()\n+                raise\n+        elif self.META.get('CONTENT_TYPE', '').startswith('application/x-www-form-urlencoded'):\n+            self._post, self._files = QueryDict(self.body, encoding=self._encoding), MultiValueDict()\n+        else:\n+            self._post, self._files = QueryDict('', encoding=self._encoding), MultiValueDict()\n+\n+    ## File-like and iterator interface.\n+    ##\n+    ## Expects self._stream to be set to an appropriate source of bytes by\n+    ## a corresponding request subclass (e.g. WSGIRequest).\n+    ## Also when request data has already been read by request.POST or\n+    ## request.body, self._stream points to a BytesIO instance\n+    ## containing that data.\n+\n+    def read(self, *args, **kwargs):\n+        self._read_started = True\n+        return self._stream.read(*args, **kwargs)\n+\n+    def readline(self, *args, **kwargs):\n+        self._read_started = True\n+        return self._stream.readline(*args, **kwargs)\n+\n+    def xreadlines(self):\n+        while True:\n+            buf = self.readline()\n+            if not buf:\n+                break\n+            yield buf\n+\n+    __iter__ = xreadlines\n+\n+    def readlines(self):\n+        return list(iter(self))\n+\n+\n+class QueryDict(MultiValueDict):\n+    \"\"\"\n+    A specialized MultiValueDict that takes a query string when initialized.\n+    This is immutable unless you create a copy of it.\n+\n+    Values retrieved from this class are converted from the given encoding\n+    (DEFAULT_CHARSET by default) to unicode.\n+    \"\"\"\n+    # These are both reset in __init__, but is specified here at the class\n+    # level so that unpickling will have valid values\n+    _mutable = True\n+    _encoding = None\n+\n+    def __init__(self, query_string, mutable=False, encoding=None):\n+        super(QueryDict, self).__init__()\n+        if not encoding:\n+            encoding = settings.DEFAULT_CHARSET\n+        self.encoding = encoding\n+        if six.PY3:\n+            for key, value in parse_qsl(query_string or '',\n+                                        keep_blank_values=True,\n+                                        encoding=encoding):\n+                self.appendlist(key, value)\n+        else:\n+            for key, value in parse_qsl(query_string or '',\n+                                        keep_blank_values=True):\n+                self.appendlist(force_text(key, encoding, errors='replace'),\n+                                force_text(value, encoding, errors='replace'))\n+        self._mutable = mutable\n+\n+    @property\n+    def encoding(self):\n+        if self._encoding is None:\n+            self._encoding = settings.DEFAULT_CHARSET\n+        return self._encoding\n+\n+    @encoding.setter\n+    def encoding(self, value):\n+        self._encoding = value\n+\n+    def _assert_mutable(self):\n+        if not self._mutable:\n+            raise AttributeError(\"This QueryDict instance is immutable\")\n+\n+    def __setitem__(self, key, value):\n+        self._assert_mutable()\n+        key = bytes_to_text(key, self.encoding)\n+        value = bytes_to_text(value, self.encoding)\n+        super(QueryDict, self).__setitem__(key, value)\n+\n+    def __delitem__(self, key):\n+        self._assert_mutable()\n+        super(QueryDict, self).__delitem__(key)\n+\n+    def __copy__(self):\n+        result = self.__class__('', mutable=True, encoding=self.encoding)\n+        for key, value in six.iterlists(self):\n+            result.setlist(key, value)\n+        return result\n+\n+    def __deepcopy__(self, memo):\n+        result = self.__class__('', mutable=True, encoding=self.encoding)\n+        memo[id(self)] = result\n+        for key, value in six.iterlists(self):\n+            result.setlist(copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n+        return result\n+\n+    def setlist(self, key, list_):\n+        self._assert_mutable()\n+        key = bytes_to_text(key, self.encoding)\n+        list_ = [bytes_to_text(elt, self.encoding) for elt in list_]\n+        super(QueryDict, self).setlist(key, list_)\n+\n+    def setlistdefault(self, key, default_list=None):\n+        self._assert_mutable()\n+        return super(QueryDict, self).setlistdefault(key, default_list)\n+\n+    def appendlist(self, key, value):\n+        self._assert_mutable()\n+        key = bytes_to_text(key, self.encoding)\n+        value = bytes_to_text(value, self.encoding)\n+        super(QueryDict, self).appendlist(key, value)\n+\n+    def pop(self, key, *args):\n+        self._assert_mutable()\n+        return super(QueryDict, self).pop(key, *args)\n+\n+    def popitem(self):\n+        self._assert_mutable()\n+        return super(QueryDict, self).popitem()\n+\n+    def clear(self):\n+        self._assert_mutable()\n+        super(QueryDict, self).clear()\n+\n+    def setdefault(self, key, default=None):\n+        self._assert_mutable()\n+        key = bytes_to_text(key, self.encoding)\n+        default = bytes_to_text(default, self.encoding)\n+        return super(QueryDict, self).setdefault(key, default)\n+\n+    def copy(self):\n+        \"\"\"Returns a mutable copy of this object.\"\"\"\n+        return self.__deepcopy__({})\n+\n+    def urlencode(self, safe=None):\n+        \"\"\"\n+        Returns an encoded string of all query string arguments.\n+\n+        :arg safe: Used to specify characters which do not require quoting, for\n+            example::\n+\n+                >>> q = QueryDict('', mutable=True)\n+                >>> q['next'] = '/a&b/'\n+                >>> q.urlencode()\n+                'next=%2Fa%26b%2F'\n+                >>> q.urlencode(safe='/')\n+                'next=/a%26b/'\n+\n+        \"\"\"\n+        output = []\n+        if safe:\n+            safe = force_bytes(safe, self.encoding)\n+            encode = lambda k, v: '%s=%s' % ((quote(k, safe), quote(v, safe)))\n+        else:\n+            encode = lambda k, v: urlencode({k: v})\n+        for k, list_ in self.lists():\n+            k = force_bytes(k, self.encoding)\n+            output.extend([encode(k, force_bytes(v, self.encoding))\n+                           for v in list_])\n+        return '&'.join(output)\n+\n+\n+def build_request_repr(request, path_override=None, GET_override=None,\n+                       POST_override=None, COOKIES_override=None,\n+                       META_override=None):\n+    \"\"\"\n+    Builds and returns the request's representation string. The request's\n+    attributes may be overridden by pre-processed values.\n+    \"\"\"\n+    # Since this is called as part of error handling, we need to be very\n+    # robust against potentially malformed input.\n+    try:\n+        get = (pformat(GET_override)\n+               if GET_override is not None\n+               else pformat(request.GET))\n+    except Exception:\n+        get = '<could not parse>'\n+    if request._post_parse_error:\n+        post = '<could not parse>'\n+    else:\n+        try:\n+            post = (pformat(POST_override)\n+                    if POST_override is not None\n+                    else pformat(request.POST))\n+        except Exception:\n+            post = '<could not parse>'\n+    try:\n+        cookies = (pformat(COOKIES_override)\n+                   if COOKIES_override is not None\n+                   else pformat(request.COOKIES))\n+    except Exception:\n+        cookies = '<could not parse>'\n+    try:\n+        meta = (pformat(META_override)\n+                if META_override is not None\n+                else pformat(request.META))\n+    except Exception:\n+        meta = '<could not parse>'\n+    path = path_override if path_override is not None else request.path\n+    return force_str('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n+                     (request.__class__.__name__,\n+                      path,\n+                      six.text_type(get),\n+                      six.text_type(post),\n+                      six.text_type(cookies),\n+                      six.text_type(meta)))\n+\n+\n+# It's neither necessary nor appropriate to use\n+# django.utils.encoding.smart_text for parsing URLs and form inputs. Thus,\n+# this slightly more restricted function, used by QueryDict.\n+def bytes_to_text(s, encoding):\n+    \"\"\"\n+    Converts basestring objects to unicode, using the given encoding. Illegally\n+    encoded input characters are replaced with Unicode \"unknown\" codepoint\n+    (\\ufffd).\n+\n+    Returns any non-basestring objects without change.\n+    \"\"\"\n+    if isinstance(s, bytes):\n+        return six.text_type(s, encoding, 'replace')\n+    else:\n+        return s"
        },
        {
            "sha": "56e3d00096563eb5be55f8f347e650e25ef402e4",
            "filename": "django/http/response.py",
            "status": "added",
            "additions": 441,
            "deletions": 0,
            "changes": 441,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fresponse.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,441 @@\n+from __future__ import absolute_import, unicode_literals\n+\n+import datetime\n+import time\n+import warnings\n+from email.header import Header\n+try:\n+    from urllib.parse import urlparse\n+except ImportError:\n+    from urlparse import urlparse\n+\n+from django.conf import settings\n+from django.core import signing\n+from django.core.exceptions import SuspiciousOperation\n+from django.http.cookie import SimpleCookie\n+from django.utils import six, timezone\n+from django.utils.encoding import force_bytes, iri_to_uri\n+from django.utils.http import cookie_date\n+from django.utils.six.moves import map\n+\n+\n+class BadHeaderError(ValueError):\n+    pass\n+\n+\n+class HttpResponseBase(object):\n+    \"\"\"\n+    An HTTP response base class with dictionary-accessed headers.\n+\n+    This class doesn't handle content. It should not be used directly.\n+    Use the HttpResponse and StreamingHttpResponse subclasses instead.\n+    \"\"\"\n+\n+    status_code = 200\n+\n+    def __init__(self, content_type=None, status=None, mimetype=None):\n+        # _headers is a mapping of the lower-case name to the original case of\n+        # the header (required for working with legacy systems) and the header\n+        # value. Both the name of the header and its value are ASCII strings.\n+        self._headers = {}\n+        self._charset = settings.DEFAULT_CHARSET\n+        self._closable_objects = []\n+        if mimetype:\n+            warnings.warn(\"Using mimetype keyword argument is deprecated, use\"\n+                          \" content_type instead\", PendingDeprecationWarning)\n+            content_type = mimetype\n+        if not content_type:\n+            content_type = \"%s; charset=%s\" % (settings.DEFAULT_CONTENT_TYPE,\n+                    self._charset)\n+        self.cookies = SimpleCookie()\n+        if status:\n+            self.status_code = status\n+\n+        self['Content-Type'] = content_type\n+\n+    def serialize_headers(self):\n+        \"\"\"HTTP headers as a bytestring.\"\"\"\n+        headers = [\n+            ('%s: %s' % (key, value)).encode('us-ascii')\n+            for key, value in self._headers.values()\n+        ]\n+        return b'\\r\\n'.join(headers)\n+\n+    if six.PY3:\n+        __bytes__ = serialize_headers\n+    else:\n+        __str__ = serialize_headers\n+\n+    def _convert_to_charset(self, value, charset, mime_encode=False):\n+        \"\"\"Converts headers key/value to ascii/latin1 native strings.\n+\n+        `charset` must be 'ascii' or 'latin-1'. If `mime_encode` is True and\n+        `value` value can't be represented in the given charset, MIME-encoding\n+        is applied.\n+        \"\"\"\n+        if not isinstance(value, (bytes, six.text_type)):\n+            value = str(value)\n+        try:\n+            if six.PY3:\n+                if isinstance(value, str):\n+                    # Ensure string is valid in given charset\n+                    value.encode(charset)\n+                else:\n+                    # Convert bytestring using given charset\n+                    value = value.decode(charset)\n+            else:\n+                if isinstance(value, str):\n+                    # Ensure string is valid in given charset\n+                    value.decode(charset)\n+                else:\n+                    # Convert unicode string to given charset\n+                    value = value.encode(charset)\n+        except UnicodeError as e:\n+            if mime_encode:\n+                # Wrapping in str() is a workaround for #12422 under Python 2.\n+                value = str(Header(value, 'utf-8').encode())\n+            else:\n+                e.reason += ', HTTP response headers must be in %s format' % charset\n+                raise\n+        if str('\\n') in value or str('\\r') in value:\n+            raise BadHeaderError(\"Header values can't contain newlines (got %r)\" % value)\n+        return value\n+\n+    def __setitem__(self, header, value):\n+        header = self._convert_to_charset(header, 'ascii')\n+        value = self._convert_to_charset(value, 'latin1', mime_encode=True)\n+        self._headers[header.lower()] = (header, value)\n+\n+    def __delitem__(self, header):\n+        try:\n+            del self._headers[header.lower()]\n+        except KeyError:\n+            pass\n+\n+    def __getitem__(self, header):\n+        return self._headers[header.lower()][1]\n+\n+    def __getstate__(self):\n+        # SimpleCookie is not pickeable with pickle.HIGHEST_PROTOCOL, so we\n+        # serialise to a string instead\n+        state = self.__dict__.copy()\n+        state['cookies'] = str(state['cookies'])\n+        return state\n+\n+    def __setstate__(self, state):\n+        self.__dict__.update(state)\n+        self.cookies = SimpleCookie(self.cookies)\n+\n+    def has_header(self, header):\n+        \"\"\"Case-insensitive check for a header.\"\"\"\n+        return header.lower() in self._headers\n+\n+    __contains__ = has_header\n+\n+    def items(self):\n+        return self._headers.values()\n+\n+    def get(self, header, alternate=None):\n+        return self._headers.get(header.lower(), (None, alternate))[1]\n+\n+    def set_cookie(self, key, value='', max_age=None, expires=None, path='/',\n+                   domain=None, secure=False, httponly=False):\n+        \"\"\"\n+        Sets a cookie.\n+\n+        ``expires`` can be:\n+        - a string in the correct format,\n+        - a naive ``datetime.datetime`` object in UTC,\n+        - an aware ``datetime.datetime`` object in any time zone.\n+        If it is a ``datetime.datetime`` object then ``max_age`` will be calculated.\n+\n+        \"\"\"\n+        self.cookies[key] = value\n+        if expires is not None:\n+            if isinstance(expires, datetime.datetime):\n+                if timezone.is_aware(expires):\n+                    expires = timezone.make_naive(expires, timezone.utc)\n+                delta = expires - expires.utcnow()\n+                # Add one second so the date matches exactly (a fraction of\n+                # time gets lost between converting to a timedelta and\n+                # then the date string).\n+                delta = delta + datetime.timedelta(seconds=1)\n+                # Just set max_age - the max_age logic will set expires.\n+                expires = None\n+                max_age = max(0, delta.days * 86400 + delta.seconds)\n+            else:\n+                self.cookies[key]['expires'] = expires\n+        if max_age is not None:\n+            self.cookies[key]['max-age'] = max_age\n+            # IE requires expires, so set it if hasn't been already.\n+            if not expires:\n+                self.cookies[key]['expires'] = cookie_date(time.time() +\n+                                                           max_age)\n+        if path is not None:\n+            self.cookies[key]['path'] = path\n+        if domain is not None:\n+            self.cookies[key]['domain'] = domain\n+        if secure:\n+            self.cookies[key]['secure'] = True\n+        if httponly:\n+            self.cookies[key]['httponly'] = True\n+\n+    def set_signed_cookie(self, key, value, salt='', **kwargs):\n+        value = signing.get_cookie_signer(salt=key + salt).sign(value)\n+        return self.set_cookie(key, value, **kwargs)\n+\n+    def delete_cookie(self, key, path='/', domain=None):\n+        self.set_cookie(key, max_age=0, path=path, domain=domain,\n+                        expires='Thu, 01-Jan-1970 00:00:00 GMT')\n+\n+    # Common methods used by subclasses\n+\n+    def make_bytes(self, value):\n+        \"\"\"Turn a value into a bytestring encoded in the output charset.\"\"\"\n+        # Per PEP 3333, this response body must be bytes. To avoid returning\n+        # an instance of a subclass, this function returns `bytes(value)`.\n+        # This doesn't make a copy when `value` already contains bytes.\n+\n+        # If content is already encoded (eg. gzip), assume bytes.\n+        if self.has_header('Content-Encoding'):\n+            return bytes(value)\n+\n+        # Handle string types -- we can't rely on force_bytes here because:\n+        # - under Python 3 it attemps str conversion first\n+        # - when self._charset != 'utf-8' it re-encodes the content\n+        if isinstance(value, bytes):\n+            return bytes(value)\n+        if isinstance(value, six.text_type):\n+            return bytes(value.encode(self._charset))\n+\n+        # Handle non-string types (#16494)\n+        return force_bytes(value, self._charset)\n+\n+    def __iter__(self):\n+        return self\n+\n+    def __next__(self):\n+        # Subclasses must define self._iterator for this function.\n+        return self.make_bytes(next(self._iterator))\n+\n+    next = __next__             # Python 2 compatibility\n+\n+    # These methods partially implement the file-like object interface.\n+    # See http://docs.python.org/lib/bltin-file-objects.html\n+\n+    # The WSGI server must call this method upon completion of the request.\n+    # See http://blog.dscpl.com.au/2012/10/obligations-for-calling-close-on.html\n+    def close(self):\n+        for closable in self._closable_objects:\n+            closable.close()\n+\n+    def write(self, content):\n+        raise Exception(\"This %s instance is not writable\" % self.__class__.__name__)\n+\n+    def flush(self):\n+        pass\n+\n+    def tell(self):\n+        raise Exception(\"This %s instance cannot tell its position\" % self.__class__.__name__)\n+\n+\n+class HttpResponse(HttpResponseBase):\n+    \"\"\"\n+    An HTTP response class with a string as content.\n+\n+    This content that can be read, appended to or replaced.\n+    \"\"\"\n+\n+    streaming = False\n+\n+    def __init__(self, content='', *args, **kwargs):\n+        super(HttpResponse, self).__init__(*args, **kwargs)\n+        # Content is a bytestring. See the `content` property methods.\n+        self.content = content\n+\n+    def serialize(self):\n+        \"\"\"Full HTTP message, including headers, as a bytestring.\"\"\"\n+        return self.serialize_headers() + b'\\r\\n\\r\\n' + self.content\n+\n+    if six.PY3:\n+        __bytes__ = serialize\n+    else:\n+        __str__ = serialize\n+\n+    def _consume_content(self):\n+        # If the response was instantiated with an iterator, when its content\n+        # is accessed, the iterator is going be exhausted and the content\n+        # loaded in memory. At this point, it's better to abandon the original\n+        # iterator and save the content for later reuse. This is a temporary\n+        # solution. See the comment in __iter__ below for the long term plan.\n+        if self._base_content_is_iter:\n+            self.content = b''.join(self.make_bytes(e) for e in self._container)\n+\n+    @property\n+    def content(self):\n+        self._consume_content()\n+        return b''.join(self.make_bytes(e) for e in self._container)\n+\n+    @content.setter\n+    def content(self, value):\n+        if hasattr(value, '__iter__') and not isinstance(value, (bytes, six.string_types)):\n+            self._container = value\n+            self._base_content_is_iter = True\n+            if hasattr(value, 'close'):\n+                self._closable_objects.append(value)\n+        else:\n+            self._container = [value]\n+            self._base_content_is_iter = False\n+\n+    def __iter__(self):\n+        # Raise a deprecation warning only if the content wasn't consumed yet,\n+        # because the response may be intended to be streamed.\n+        # Once the deprecation completes, iterators should be consumed upon\n+        # assignment rather than upon access. The _consume_content method\n+        # should be removed. See #6527.\n+        if self._base_content_is_iter:\n+            warnings.warn(\n+                'Creating streaming responses with `HttpResponse` is '\n+                'deprecated. Use `StreamingHttpResponse` instead '\n+                'if you need the streaming behavior.',\n+                PendingDeprecationWarning, stacklevel=2)\n+        if not hasattr(self, '_iterator'):\n+            self._iterator = iter(self._container)\n+        return self\n+\n+    def write(self, content):\n+        self._consume_content()\n+        self._container.append(content)\n+\n+    def tell(self):\n+        self._consume_content()\n+        return len(self.content)\n+\n+\n+class StreamingHttpResponse(HttpResponseBase):\n+    \"\"\"\n+    A streaming HTTP response class with an iterator as content.\n+\n+    This should only be iterated once, when the response is streamed to the\n+    client. However, it can be appended to or replaced with a new iterator\n+    that wraps the original content (or yields entirely new content).\n+    \"\"\"\n+\n+    streaming = True\n+\n+    def __init__(self, streaming_content=(), *args, **kwargs):\n+        super(StreamingHttpResponse, self).__init__(*args, **kwargs)\n+        # `streaming_content` should be an iterable of bytestrings.\n+        # See the `streaming_content` property methods.\n+        self.streaming_content = streaming_content\n+\n+    @property\n+    def content(self):\n+        raise AttributeError(\"This %s instance has no `content` attribute. \"\n+            \"Use `streaming_content` instead.\" % self.__class__.__name__)\n+\n+    @property\n+    def streaming_content(self):\n+        return map(self.make_bytes, self._iterator)\n+\n+    @streaming_content.setter\n+    def streaming_content(self, value):\n+        # Ensure we can never iterate on \"value\" more than once.\n+        self._iterator = iter(value)\n+        if hasattr(value, 'close'):\n+            self._closable_objects.append(value)\n+\n+\n+class CompatibleStreamingHttpResponse(StreamingHttpResponse):\n+    \"\"\"\n+    This class maintains compatibility with middleware that doesn't know how\n+    to handle the content of a streaming response by exposing a `content`\n+    attribute that will consume and cache the content iterator when accessed.\n+\n+    These responses will stream only if no middleware attempts to access the\n+    `content` attribute. Otherwise, they will behave like a regular response,\n+    and raise a `PendingDeprecationWarning`.\n+    \"\"\"\n+    @property\n+    def content(self):\n+        warnings.warn(\n+            'Accessing the `content` attribute on a streaming response is '\n+            'deprecated. Use the `streaming_content` attribute instead.',\n+            PendingDeprecationWarning)\n+        content = b''.join(self)\n+        self.streaming_content = [content]\n+        return content\n+\n+    @content.setter\n+    def content(self, content):\n+        warnings.warn(\n+            'Accessing the `content` attribute on a streaming response is '\n+            'deprecated. Use the `streaming_content` attribute instead.',\n+            PendingDeprecationWarning)\n+        self.streaming_content = [content]\n+\n+\n+class HttpResponseRedirectBase(HttpResponse):\n+    allowed_schemes = ['http', 'https', 'ftp']\n+\n+    def __init__(self, redirect_to, *args, **kwargs):\n+        parsed = urlparse(redirect_to)\n+        if parsed.scheme and parsed.scheme not in self.allowed_schemes:\n+            raise SuspiciousOperation(\"Unsafe redirect to URL with protocol '%s'\" % parsed.scheme)\n+        super(HttpResponseRedirectBase, self).__init__(*args, **kwargs)\n+        self['Location'] = iri_to_uri(redirect_to)\n+\n+\n+class HttpResponseRedirect(HttpResponseRedirectBase):\n+    status_code = 302\n+\n+\n+class HttpResponsePermanentRedirect(HttpResponseRedirectBase):\n+    status_code = 301\n+\n+\n+class HttpResponseNotModified(HttpResponse):\n+    status_code = 304\n+\n+    def __init__(self, *args, **kwargs):\n+        super(HttpResponseNotModified, self).__init__(*args, **kwargs)\n+        del self['content-type']\n+\n+    @HttpResponse.content.setter\n+    def content(self, value):\n+        if value:\n+            raise AttributeError(\"You cannot set content to a 304 (Not Modified) response\")\n+        self._container = []\n+        self._base_content_is_iter = False\n+\n+\n+class HttpResponseBadRequest(HttpResponse):\n+    status_code = 400\n+\n+\n+class HttpResponseNotFound(HttpResponse):\n+    status_code = 404\n+\n+\n+class HttpResponseForbidden(HttpResponse):\n+    status_code = 403\n+\n+\n+class HttpResponseNotAllowed(HttpResponse):\n+    status_code = 405\n+\n+    def __init__(self, permitted_methods, *args, **kwargs):\n+        super(HttpResponseNotAllowed, self).__init__(*args, **kwargs)\n+        self['Allow'] = ', '.join(permitted_methods)\n+\n+\n+class HttpResponseGone(HttpResponse):\n+    status_code = 410\n+\n+\n+class HttpResponseServerError(HttpResponse):\n+    status_code = 500\n+\n+\n+class Http404(Exception):\n+    pass"
        },
        {
            "sha": "fcb3fecb6ca5fec7d72d94408d24e05815ff9d56",
            "filename": "django/http/utils.py",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fhttp%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Futils.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -8,6 +8,7 @@\n # it's a little fiddly to override this behavior, so they should be truly\n # universally applicable.\n \n+\n def fix_location_header(request, response):\n     \"\"\"\n     Ensures that we always use an absolute URI in any location header in the\n@@ -20,18 +21,26 @@ def fix_location_header(request, response):\n         response['Location'] = request.build_absolute_uri(response['Location'])\n     return response\n \n+\n def conditional_content_removal(request, response):\n     \"\"\"\n     Removes the content of responses for HEAD requests, 1xx, 204 and 304\n     responses. Ensures compliance with RFC 2616, section 4.3.\n     \"\"\"\n     if 100 <= response.status_code < 200 or response.status_code in (204, 304):\n-       response.content = ''\n-       response['Content-Length'] = 0\n+        if response.streaming:\n+            response.streaming_content = []\n+        else:\n+            response.content = ''\n+        response['Content-Length'] = '0'\n     if request.method == 'HEAD':\n-        response.content = ''\n+        if response.streaming:\n+            response.streaming_content = []\n+        else:\n+            response.content = ''\n     return response\n \n+\n def fix_IE_for_attach(request, response):\n     \"\"\"\n     This function will prevent Django from serving a Content-Disposition header\n@@ -60,6 +69,7 @@ def fix_IE_for_attach(request, response):\n \n     return response\n \n+\n def fix_IE_for_vary(request, response):\n     \"\"\"\n     This function will fix the bug reported at\n@@ -84,4 +94,3 @@ def fix_IE_for_vary(request, response):\n             pass\n \n     return response\n-"
        },
        {
            "sha": "6fbbf4304414f0e805e17e9471c5730075d2f85c",
            "filename": "django/middleware/common.py",
            "status": "modified",
            "additions": 13,
            "deletions": 8,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fcommon.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fcommon.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcommon.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,14 +1,15 @@\n import hashlib\n+import logging\n import re\n \n from django.conf import settings\n from django import http\n from django.core.mail import mail_managers\n from django.utils.http import urlquote\n from django.core import urlresolvers\n-from django.utils.log import getLogger\n \n-logger = getLogger('django.request')\n+\n+logger = logging.getLogger('django.request')\n \n \n class CommonMiddleware(object):\n@@ -112,14 +113,18 @@ def process_response(self, request, response):\n         if settings.USE_ETAGS:\n             if response.has_header('ETag'):\n                 etag = response['ETag']\n+            elif response.streaming:\n+                etag = None\n             else:\n                 etag = '\"%s\"' % hashlib.md5(response.content).hexdigest()\n-            if response.status_code >= 200 and response.status_code < 300 and request.META.get('HTTP_IF_NONE_MATCH') == etag:\n-                cookies = response.cookies\n-                response = http.HttpResponseNotModified()\n-                response.cookies = cookies\n-            else:\n-                response['ETag'] = etag\n+            if etag is not None:\n+                if (200 <= response.status_code < 300\n+                    and request.META.get('HTTP_IF_NONE_MATCH') == etag):\n+                    cookies = response.cookies\n+                    response = http.HttpResponseNotModified()\n+                    response.cookies = cookies\n+                else:\n+                    response['ETag'] = etag\n \n         return response\n "
        },
        {
            "sha": "b2eb0df3f5f88a91e65d609c3fcad83710c51916",
            "filename": "django/middleware/csrf.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fcsrf.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fcsrf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcsrf.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -7,6 +7,7 @@\n from __future__ import unicode_literals\n \n import hashlib\n+import logging\n import re\n import random\n \n@@ -15,10 +16,10 @@\n from django.utils.cache import patch_vary_headers\n from django.utils.encoding import force_text\n from django.utils.http import same_origin\n-from django.utils.log import getLogger\n from django.utils.crypto import constant_time_compare, get_random_string\n \n-logger = getLogger('django.request')\n+\n+logger = logging.getLogger('django.request')\n \n REASON_NO_REFERER = \"Referer checking failed - no Referer.\"\n REASON_BAD_REFERER = \"Referer checking failed - %s does not match %s.\""
        },
        {
            "sha": "fb54501a032f04cefb1b7a78d7ac8ca0b3872e4f",
            "filename": "django/middleware/gzip.py",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fgzip.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fgzip.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fgzip.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,6 +1,6 @@\n import re\n \n-from django.utils.text import compress_string\n+from django.utils.text import compress_sequence, compress_string\n from django.utils.cache import patch_vary_headers\n \n re_accepts_gzip = re.compile(r'\\bgzip\\b')\n@@ -13,7 +13,7 @@ class GZipMiddleware(object):\n     \"\"\"\n     def process_response(self, request, response):\n         # It's not worth attempting to compress really short responses.\n-        if len(response.content) < 200:\n+        if not response.streaming and len(response.content) < 200:\n             return response\n \n         patch_vary_headers(response, ('Accept-Encoding',))\n@@ -32,15 +32,21 @@ def process_response(self, request, response):\n         if not re_accepts_gzip.search(ae):\n             return response\n \n-        # Return the compressed content only if it's actually shorter.\n-        compressed_content = compress_string(response.content)\n-        if len(compressed_content) >= len(response.content):\n-            return response\n+        if response.streaming:\n+            # Delete the `Content-Length` header for streaming content, because\n+            # we won't know the compressed size until we stream it.\n+            response.streaming_content = compress_sequence(response.streaming_content)\n+            del response['Content-Length']\n+        else:\n+            # Return the compressed content only if it's actually shorter.\n+            compressed_content = compress_string(response.content)\n+            if len(compressed_content) >= len(response.content):\n+                return response\n+            response.content = compressed_content\n+            response['Content-Length'] = str(len(response.content))\n \n         if response.has_header('ETag'):\n             response['ETag'] = re.sub('\"$', ';gzip\"', response['ETag'])\n-\n-        response.content = compressed_content\n         response['Content-Encoding'] = 'gzip'\n-        response['Content-Length'] = str(len(response.content))\n+\n         return response"
        },
        {
            "sha": "5a46e049469804bd8109f5988442ff11e66c3d9a",
            "filename": "django/middleware/http.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fmiddleware%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fhttp.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -10,7 +10,7 @@ class ConditionalGetMiddleware(object):\n     \"\"\"\n     def process_response(self, request, response):\n         response['Date'] = http_date()\n-        if not response.has_header('Content-Length'):\n+        if not response.streaming and not response.has_header('Content-Length'):\n             response['Content-Length'] = str(len(response.content))\n \n         if response.has_header('ETag'):"
        },
        {
            "sha": "e15440f90ee2fe69f4af6f534c67d8b3af427ca4",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -96,7 +96,7 @@ def fix_ampersands_filter(value):\n # Values for testing floatformat input against infinity and NaN representations,\n # which differ across platforms and Python versions.  Some (i.e. old Windows\n # ones) are not recognized by Decimal but we want to return them unchanged vs.\n-# returning an empty string as we do for completley invalid input.  Note these\n+# returning an empty string as we do for completely invalid input.  Note these\n # need to be built up from values that are not inf/nan, since inf/nan values do\n # not reload properly from .pyc files on Windows prior to some level of Python 2.5\n # (see Python Issue757815 and Issue1080440)."
        },
        {
            "sha": "fa2e840cbf21d875713813c9213468b5166bed41",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -48,7 +48,7 @@ def render(self, context):\n             if csrf_token == 'NOTPROVIDED':\n                 return format_html(\"\")\n             else:\n-                return format_html(\"<div><input type='hidden' name='csrfmiddlewaretoken' value='{0}' /></div>\", csrf_token)\n+                return format_html(\"<input type='hidden' name='csrfmiddlewaretoken' value='{0}' />\", csrf_token)\n         else:\n             # It's very probable that the token is missing because of\n             # misconfiguration, so we raise a warning"
        },
        {
            "sha": "5576beb4a31bcd067aade77446c0acef337da982",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -110,13 +110,13 @@ def render_token_list(self, tokens):\n         vars = []\n         for token in tokens:\n             if token.token_type == TOKEN_TEXT:\n-                result.append(token.contents)\n+                result.append(token.contents.replace('%', '%%'))\n             elif token.token_type == TOKEN_VAR:\n                 result.append('%%(%s)s' % token.contents)\n                 vars.append(token.contents)\n         return ''.join(result), vars\n \n-    def render(self, context):\n+    def render(self, context, nested=False):\n         if self.message_context:\n             message_context = self.message_context.resolve(context)\n         else:\n@@ -128,13 +128,10 @@ def render(self, context):\n         # the end of function\n         context.update(tmp_context)\n         singular, vars = self.render_token_list(self.singular)\n-        # Escape all isolated '%'\n-        singular = re.sub('%(?!\\()', '%%', singular)\n         if self.plural and self.countervar and self.counter:\n             count = self.counter.resolve(context)\n             context[self.countervar] = count\n             plural, plural_vars = self.render_token_list(self.plural)\n-            plural = re.sub('%(?!\\()', '%%', plural)\n             if message_context:\n                 result = translation.npgettext(message_context, singular,\n                                                plural, count)\n@@ -151,8 +148,12 @@ def render(self, context):\n         try:\n             result = result % data\n         except (KeyError, ValueError):\n+            if nested:\n+                # Either string is malformed, or it's a bug\n+                raise TemplateSyntaxError(\"'blocktrans' is unable to format \"\n+                    \"string returned by gettext: %r using %r\" % (result, data))\n             with translation.override(None):\n-                result = self.render(context)\n+                result = self.render(context, nested=True)\n         return result\n \n "
        },
        {
            "sha": "7a4987508e6833030d13b1505a2f25767e7fcd9e",
            "filename": "django/test/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F__init__.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -5,5 +5,6 @@\n from django.test.client import Client, RequestFactory\n from django.test.testcases import (TestCase, TransactionTestCase,\n     SimpleTestCase, LiveServerTestCase, skipIfDBFeature,\n-    skipUnlessDBFeature)\n+    skipUnlessDBFeature\n+)\n from django.test.utils import Approximate"
        },
        {
            "sha": "6d12321075642b4a835e64a2524571ecbad424ab",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 19,
            "deletions": 3,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -43,18 +43,34 @@ class FakePayload(object):\n     length. This makes sure that views can't do anything under the test client\n     that wouldn't work in Real Life.\n     \"\"\"\n-    def __init__(self, content):\n-        self.__content = BytesIO(content)\n-        self.__len = len(content)\n+    def __init__(self, content=None):\n+        self.__content = BytesIO()\n+        self.__len = 0\n+        self.read_started = False\n+        if content is not None:\n+            self.write(content)\n+\n+    def __len__(self):\n+        return self.__len\n \n     def read(self, num_bytes=None):\n+        if not self.read_started:\n+            self.__content.seek(0)\n+            self.read_started = True\n         if num_bytes is None:\n             num_bytes = self.__len or 0\n         assert self.__len >= num_bytes, \"Cannot read more than the available bytes from the HTTP incoming data.\"\n         content = self.__content.read(num_bytes)\n         self.__len -= num_bytes\n         return content\n \n+    def write(self, content):\n+        if self.read_started:\n+            raise ValueError(\"Unable to write a payload after he's been read\")\n+        content = force_bytes(content)\n+        self.__content.write(content)\n+        self.__len += len(content)\n+\n \n class ClientHandler(BaseHandler):\n     \"\"\""
        },
        {
            "sha": "1239275264b43a41fa0fadc0fa868b89ece078bd",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 49,
            "deletions": 91,
            "changes": 140,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -11,7 +11,6 @@\n     from urllib.parse import urlsplit, urlunsplit\n except ImportError:     # Python 2\n     from urlparse import urlsplit, urlunsplit\n-from xml.dom.minidom import parseString, Node\n import select\n import socket\n import threading\n@@ -38,12 +37,13 @@\n from django.test.html import HTMLParseError, parse_html\n from django.test.signals import template_rendered\n from django.test.utils import (get_warnings_state, restore_warnings_state,\n-    override_settings)\n+    override_settings, compare_xml, strip_quotes)\n from django.test.utils import ContextList\n from django.utils import unittest as ut2\n from django.utils.encoding import force_text\n from django.utils import six\n from django.utils.unittest.util import safe_repr\n+from django.utils.unittest import skipIf\n from django.views.static import serve\n \n __all__ = ('DocTestRunner', 'OutputChecker', 'TestCase', 'TransactionTestCase',\n@@ -53,6 +53,7 @@\n normalize_decimals = lambda s: re.sub(r\"Decimal\\('(\\d+(\\.\\d*)?)'\\)\",\n                                 lambda m: \"Decimal(\\\"%s\\\")\" % m.groups()[0], s)\n \n+\n def to_list(value):\n     \"\"\"\n     Puts value into a list if it's not already one.\n@@ -132,108 +133,23 @@ def check_output_numeric(self, want, got, optionflags):\n             optionflags)\n \n     def check_output_xml(self, want, got, optionsflags):\n-        \"\"\"Tries to do a 'xml-comparision' of want and got.  Plain string\n-        comparision doesn't always work because, for example, attribute\n-        ordering should not be important.\n-\n-        Based on http://codespeak.net/svn/lxml/trunk/src/lxml/doctestcompare.py\n-        \"\"\"\n-        _norm_whitespace_re = re.compile(r'[ \\t\\n][ \\t\\n]+')\n-        def norm_whitespace(v):\n-            return _norm_whitespace_re.sub(' ', v)\n-\n-        def child_text(element):\n-            return ''.join([c.data for c in element.childNodes\n-                            if c.nodeType == Node.TEXT_NODE])\n-\n-        def children(element):\n-            return [c for c in element.childNodes\n-                    if c.nodeType == Node.ELEMENT_NODE]\n-\n-        def norm_child_text(element):\n-            return norm_whitespace(child_text(element))\n-\n-        def attrs_dict(element):\n-            return dict(element.attributes.items())\n-\n-        def check_element(want_element, got_element):\n-            if want_element.tagName != got_element.tagName:\n-                return False\n-            if norm_child_text(want_element) != norm_child_text(got_element):\n-                return False\n-            if attrs_dict(want_element) != attrs_dict(got_element):\n-                return False\n-            want_children = children(want_element)\n-            got_children = children(got_element)\n-            if len(want_children) != len(got_children):\n-                return False\n-            for want, got in zip(want_children, got_children):\n-                if not check_element(want, got):\n-                    return False\n-            return True\n-\n-        want, got = self._strip_quotes(want, got)\n-        want = want.replace('\\\\n','\\n')\n-        got = got.replace('\\\\n','\\n')\n-\n-        # If the string is not a complete xml document, we may need to add a\n-        # root element. This allow us to compare fragments, like \"<foo/><bar/>\"\n-        if not want.startswith('<?xml'):\n-            wrapper = '<root>%s</root>'\n-            want = wrapper % want\n-            got = wrapper % got\n-\n-        # Parse the want and got strings, and compare the parsings.\n         try:\n-            want_root = parseString(want).firstChild\n-            got_root = parseString(got).firstChild\n+            return compare_xml(want, got)\n         except Exception:\n             return False\n-        return check_element(want_root, got_root)\n \n     def check_output_json(self, want, got, optionsflags):\n         \"\"\"\n         Tries to compare want and got as if they were JSON-encoded data\n         \"\"\"\n-        want, got = self._strip_quotes(want, got)\n+        want, got = strip_quotes(want, got)\n         try:\n             want_json = json.loads(want)\n             got_json = json.loads(got)\n         except Exception:\n             return False\n         return want_json == got_json\n \n-    def _strip_quotes(self, want, got):\n-        \"\"\"\n-        Strip quotes of doctests output values:\n-\n-        >>> o = OutputChecker()\n-        >>> o._strip_quotes(\"'foo'\")\n-        \"foo\"\n-        >>> o._strip_quotes('\"foo\"')\n-        \"foo\"\n-        \"\"\"\n-        def is_quoted_string(s):\n-            s = s.strip()\n-            return (len(s) >= 2\n-                    and s[0] == s[-1]\n-                    and s[0] in ('\"', \"'\"))\n-\n-        def is_quoted_unicode(s):\n-            s = s.strip()\n-            return (len(s) >= 3\n-                    and s[0] == 'u'\n-                    and s[1] == s[-1]\n-                    and s[1] in ('\"', \"'\"))\n-\n-        if is_quoted_string(want) and is_quoted_string(got):\n-            want = want.strip()[1:-1]\n-            got = got.strip()[1:-1]\n-        elif is_quoted_unicode(want) and is_quoted_unicode(got):\n-            want = want.strip()[2:-1]\n-            got = got.strip()[2:-1]\n-        return want, got\n-\n \n class DocTestRunner(doctest.DocTestRunner):\n     def __init__(self, *args, **kwargs):\n@@ -443,6 +359,38 @@ def assertHTMLNotEqual(self, html1, html2, msg=None):\n                 safe_repr(dom1, True), safe_repr(dom2, True))\n             self.fail(self._formatMessage(msg, standardMsg))\n \n+    def assertXMLEqual(self, xml1, xml2, msg=None):\n+        \"\"\"\n+        Asserts that two XML snippets are semantically the same.\n+        Whitespace in most cases is ignored, and attribute ordering is not\n+        significant. The passed-in arguments must be valid XML.\n+        \"\"\"\n+        try:\n+            result = compare_xml(xml1, xml2)\n+        except Exception as e:\n+            standardMsg = 'First or second argument is not valid XML\\n%s' % e\n+            self.fail(self._formatMessage(msg, standardMsg))\n+        else:\n+            if not result:\n+                standardMsg = '%s != %s' % (safe_repr(xml1, True), safe_repr(xml2, True))\n+                self.fail(self._formatMessage(msg, standardMsg))\n+\n+    def assertXMLNotEqual(self, xml1, xml2, msg=None):\n+        \"\"\"\n+        Asserts that two XML snippets are not semantically equivalent.\n+        Whitespace in most cases is ignored, and attribute ordering is not\n+        significant. The passed-in arguments must be valid XML.\n+        \"\"\"\n+        try:\n+            result = compare_xml(xml1, xml2)\n+        except Exception as e:\n+            standardMsg = 'First or second argument is not valid XML\\n%s' % e\n+            self.fail(self._formatMessage(msg, standardMsg))\n+        else:\n+            if result:\n+                standardMsg = '%s == %s' % (safe_repr(xml1, True), safe_repr(xml2, True))\n+                self.fail(self._formatMessage(msg, standardMsg))\n+\n \n class TransactionTestCase(SimpleTestCase):\n \n@@ -647,7 +595,14 @@ def assertContains(self, response, text, count=None, status_code=200,\n         self.assertEqual(response.status_code, status_code,\n             msg_prefix + \"Couldn't retrieve content: Response code was %d\"\n             \" (expected %d)\" % (response.status_code, status_code))\n-        content = response.content.decode(response._charset)\n+        text = force_text(text, encoding=response._charset)\n+        if response.streaming:\n+            content = b''.join(response.streaming_content)\n+        else:\n+            content = response.content\n+        content = content.decode(response._charset)\n+        # Avoid ResourceWarning about unclosed files.\n+        response.close()\n         if html:\n             content = assert_and_parse_html(self, content, None,\n                 \"Response's content is not valid HTML:\")\n@@ -682,6 +637,7 @@ def assertNotContains(self, response, text, status_code=200,\n         self.assertEqual(response.status_code, status_code,\n             msg_prefix + \"Couldn't retrieve content: Response code was %d\"\n             \" (expected %d)\" % (response.status_code, status_code))\n+        text = force_text(text, encoding=response._charset)\n         content = response.content.decode(response._charset)\n         if html:\n             content = assert_and_parse_html(self, content, None,\n@@ -917,7 +873,9 @@ def log_message(*args):\n         pass\n \n \n-if sys.version_info >= (2, 7, 0):\n+if sys.version_info >= (3, 3, 0):\n+    _ImprovedEvent = threading.Event\n+elif sys.version_info >= (2, 7, 0):\n     _ImprovedEvent = threading._Event\n else:\n     class _ImprovedEvent(threading._Event):"
        },
        {
            "sha": "f10d3882277ba61341f5425f2429d4e89e3108f0",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 103,
            "deletions": 2,
            "changes": 105,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,4 +1,7 @@\n+import re\n import warnings\n+from xml.dom.minidom import parseString, Node\n+\n from django.conf import settings, UserSettingsHolder\n from django.core import mail\n from django.test.signals import template_rendered, setting_changed\n@@ -28,7 +31,7 @@ def __repr__(self):\n     def __eq__(self, other):\n         if self.val == other:\n             return True\n-        return round(abs(self.val-other), self.places) == 0\n+        return round(abs(self.val - other), self.places) == 0\n \n \n class ContextList(list):\n@@ -46,7 +49,7 @@ def __getitem__(self, key):\n \n     def __contains__(self, key):\n         try:\n-            value = self[key]\n+            self[key]\n         except KeyError:\n             return False\n         return True\n@@ -188,9 +191,11 @@ def __call__(self, test_func):\n         if isinstance(test_func, type) and issubclass(test_func, TransactionTestCase):\n             original_pre_setup = test_func._pre_setup\n             original_post_teardown = test_func._post_teardown\n+\n             def _pre_setup(innerself):\n                 self.enable()\n                 original_pre_setup(innerself)\n+\n             def _post_teardown(innerself):\n                 original_post_teardown(innerself)\n                 self.disable()\n@@ -220,5 +225,101 @@ def disable(self):\n             setting_changed.send(sender=settings._wrapped.__class__,\n                                  setting=key, value=new_value)\n \n+\n+def compare_xml(want, got):\n+    \"\"\"Tries to do a 'xml-comparison' of want and got.  Plain string\n+    comparison doesn't always work because, for example, attribute\n+    ordering should not be important. Comment nodes are not considered in the\n+    comparison.\n+\n+    Based on http://codespeak.net/svn/lxml/trunk/src/lxml/doctestcompare.py\n+    \"\"\"\n+    _norm_whitespace_re = re.compile(r'[ \\t\\n][ \\t\\n]+')\n+    def norm_whitespace(v):\n+        return _norm_whitespace_re.sub(' ', v)\n+\n+    def child_text(element):\n+        return ''.join([c.data for c in element.childNodes\n+                        if c.nodeType == Node.TEXT_NODE])\n+\n+    def children(element):\n+        return [c for c in element.childNodes\n+                if c.nodeType == Node.ELEMENT_NODE]\n+\n+    def norm_child_text(element):\n+        return norm_whitespace(child_text(element))\n+\n+    def attrs_dict(element):\n+        return dict(element.attributes.items())\n+\n+    def check_element(want_element, got_element):\n+        if want_element.tagName != got_element.tagName:\n+            return False\n+        if norm_child_text(want_element) != norm_child_text(got_element):\n+            return False\n+        if attrs_dict(want_element) != attrs_dict(got_element):\n+            return False\n+        want_children = children(want_element)\n+        got_children = children(got_element)\n+        if len(want_children) != len(got_children):\n+            return False\n+        for want, got in zip(want_children, got_children):\n+            if not check_element(want, got):\n+                return False\n+        return True\n+\n+    def first_node(document):\n+        for node in document.childNodes:\n+            if node.nodeType != Node.COMMENT_NODE:\n+                return node\n+\n+    want, got = strip_quotes(want, got)\n+    want = want.replace('\\\\n','\\n')\n+    got = got.replace('\\\\n','\\n')\n+\n+    # If the string is not a complete xml document, we may need to add a\n+    # root element. This allow us to compare fragments, like \"<foo/><bar/>\"\n+    if not want.startswith('<?xml'):\n+        wrapper = '<root>%s</root>'\n+        want = wrapper % want\n+        got = wrapper % got\n+\n+    # Parse the want and got strings, and compare the parsings.\n+    want_root = first_node(parseString(want))\n+    got_root = first_node(parseString(got))\n+\n+    return check_element(want_root, got_root)\n+\n+\n+def strip_quotes(want, got):\n+    \"\"\"\n+    Strip quotes of doctests output values:\n+\n+    >>> strip_quotes(\"'foo'\")\n+    \"foo\"\n+    >>> strip_quotes('\"foo\"')\n+    \"foo\"\n+    \"\"\"\n+    def is_quoted_string(s):\n+        s = s.strip()\n+        return (len(s) >= 2\n+                and s[0] == s[-1]\n+                and s[0] in ('\"', \"'\"))\n+\n+    def is_quoted_unicode(s):\n+        s = s.strip()\n+        return (len(s) >= 3\n+                and s[0] == 'u'\n+                and s[1] == s[-1]\n+                and s[1] in ('\"', \"'\"))\n+\n+    if is_quoted_string(want) and is_quoted_string(got):\n+        want = want.strip()[1:-1]\n+        got = got.strip()[1:-1]\n+    elif is_quoted_unicode(want) and is_quoted_unicode(got):\n+        want = want.strip()[2:-1]\n+        got = got.strip()[2:-1]\n+    return want, got\n+\n def str_prefix(s):\n     return s % {'_': '' if six.PY3 else 'u'}"
        },
        {
            "sha": "0fceaa96e68475b43adc106f2117a0763025bad5",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -95,7 +95,8 @@ def get_max_age(response):\n             pass\n \n def _set_response_etag(response):\n-    response['ETag'] = '\"%s\"' % hashlib.md5(response.content).hexdigest()\n+    if not response.streaming:\n+        response['ETag'] = '\"%s\"' % hashlib.md5(response.content).hexdigest()\n     return response\n \n def patch_response_headers(response, cache_timeout=None):"
        },
        {
            "sha": "d94a05dfb48dbcd1ebab8722665ecbcba5121568",
            "filename": "django/utils/datastructures.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdatastructures.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -160,6 +160,9 @@ def __delitem__(self, key):\n     def __iter__(self):\n         return iter(self.keyOrder)\n \n+    def __reversed__(self):\n+        return reversed(self.keyOrder)\n+\n     def pop(self, k, *args):\n         result = super(SortedDict, self).pop(k, *args)\n         try:"
        },
        {
            "sha": "b2586ba1ff03aaa8c5975047c1dd696003e46ca8",
            "filename": "django/utils/dateformat.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fdateformat.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fdateformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdateformat.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -110,8 +110,8 @@ def s(self):\n         return '%02d' % self.data.second\n \n     def u(self):\n-        \"Microseconds\"\n-        return self.data.microsecond\n+        \"Microseconds; i.e. '000000' to '999999'\"\n+        return '%06d' %self.data.microsecond\n \n \n class DateFormat(TimeFormat):"
        },
        {
            "sha": "b0872471c2d737f7991ff67612511c33f82489a9",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 6,
            "deletions": 18,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -98,25 +98,13 @@ def force_text(s, encoding='utf-8', strings_only=False, errors='strict'):\n             if hasattr(s, '__unicode__'):\n                 s = s.__unicode__()\n             else:\n-                try:\n-                    if six.PY3:\n-                        if isinstance(s, bytes):\n-                            s = six.text_type(s, encoding, errors)\n-                        else:\n-                            s = six.text_type(s)\n+                if six.PY3:\n+                    if isinstance(s, bytes):\n+                        s = six.text_type(s, encoding, errors)\n                     else:\n-                        s = six.text_type(bytes(s), encoding, errors)\n-                except UnicodeEncodeError:\n-                    if not isinstance(s, Exception):\n-                        raise\n-                    # If we get to here, the caller has passed in an Exception\n-                    # subclass populated with non-ASCII data without special\n-                    # handling to display as a string. We need to handle this\n-                    # without raising a further exception. We do an\n-                    # approximation to what the Exception's standard str()\n-                    # output should be.\n-                    s = ' '.join([force_text(arg, encoding, strings_only,\n-                            errors) for arg in s])\n+                        s = six.text_type(s)\n+                else:\n+                    s = six.text_type(bytes(s), encoding, errors)\n         else:\n             # Note: We use .decode() here, instead of six.text_type(s, encoding,\n             # errors), so that if s is a SafeBytes, it ends up being a"
        },
        {
            "sha": "505931e158b1817cc96a47886af38d3211977b7e",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -293,6 +293,16 @@ def __getstate__(self):\n             self._setup()\n         return self._wrapped.__dict__\n \n+    # Python 3.3 will call __reduce__ when pickling; these methods are needed\n+    # to serialize and deserialize correctly. They are not called in earlier\n+    # versions of Python.\n+    @classmethod\n+    def __newobj__(cls, *args):\n+        return cls.__new__(cls, *args)\n+\n+    def __reduce__(self):\n+        return (self.__newobj__, (self.__class__,), self.__getstate__())\n+\n     # Need to pretend to be the wrapped class, for the sake of objects that care\n     # about this (especially in equality tests)\n     __class__ = property(new_method_proxy(operator.attrgetter(\"__class__\")))"
        },
        {
            "sha": "cc8372906bc81fc27c04fbbed3a8d25443acf794",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 15,
            "deletions": 18,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -42,29 +42,26 @@ def escape(text):\n     return mark_safe(force_text(text).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('\"', '&quot;').replace(\"'\", '&#39;'))\n escape = allow_lazy(escape, six.text_type)\n \n-_base_js_escapes = (\n-    ('\\\\', '\\\\u005C'),\n-    ('\\'', '\\\\u0027'),\n-    ('\"', '\\\\u0022'),\n-    ('>', '\\\\u003E'),\n-    ('<', '\\\\u003C'),\n-    ('&', '\\\\u0026'),\n-    ('=', '\\\\u003D'),\n-    ('-', '\\\\u002D'),\n-    (';', '\\\\u003B'),\n-    ('\\u2028', '\\\\u2028'),\n-    ('\\u2029', '\\\\u2029')\n-)\n+_js_escapes = {\n+    ord('\\\\'): '\\\\u005C',\n+    ord('\\''): '\\\\u0027',\n+    ord('\"'): '\\\\u0022',\n+    ord('>'): '\\\\u003E',\n+    ord('<'): '\\\\u003C',\n+    ord('&'): '\\\\u0026',\n+    ord('='): '\\\\u003D',\n+    ord('-'): '\\\\u002D',\n+    ord(';'): '\\\\u003B',\n+    ord('\\u2028'): '\\\\u2028',\n+    ord('\\u2029'): '\\\\u2029'\n+}\n \n # Escape every ASCII character with a value less than 32.\n-_js_escapes = (_base_js_escapes +\n-               tuple([('%c' % z, '\\\\u%04X' % z) for z in range(32)]))\n+_js_escapes.update((ord('%c' % z), '\\\\u%04X' % z) for z in range(32))\n \n def escapejs(value):\n     \"\"\"Hex encodes characters for use in JavaScript strings.\"\"\"\n-    for bad, good in _js_escapes:\n-        value = mark_safe(force_text(value).replace(bad, good))\n-    return value\n+    return mark_safe(force_text(value).translate(_js_escapes))\n escapejs = allow_lazy(escapejs, six.text_type)\n \n def conditional_escape(text):"
        },
        {
            "sha": "1c3b0039b51ce776822a9b608112c4ba7e849670",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -118,8 +118,7 @@ def parse_http_date(date):\n     The three formats allowed by the RFC are accepted, even if only the first\n     one is still in widespread use.\n \n-    Returns an floating point number expressed in seconds since the epoch, in\n-    UTC.\n+    Returns an integer expressed in seconds since the epoch, in UTC.\n     \"\"\"\n     # emails.Util.parsedate does the job for RFC1123 dates; unfortunately\n     # RFC2616 makes it mandatory to support RFC850 dates too. So we roll"
        },
        {
            "sha": "ea0122794ba645f91097cc78d52108738096939d",
            "filename": "django/utils/log.py",
            "status": "modified",
            "additions": 46,
            "deletions": 6,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Flog.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -5,6 +5,7 @@\n from django.core import mail\n from django.views.debug import ExceptionReporter, get_exception_reporter_filter\n \n+\n # Make sure a NullHandler is available\n # This was added in Python 2.7/3.2\n try:\n@@ -23,12 +24,46 @@ def emit(self, record):\n \n getLogger = logging.getLogger\n \n-# Ensure the creation of the Django logger\n-# with a null handler. This ensures we don't get any\n-# 'No handlers could be found for logger \"django\"' messages\n-logger = getLogger('django')\n-if not logger.handlers:\n-    logger.addHandler(NullHandler())\n+# Default logging for Django. This sends an email to the site admins on every\n+# HTTP 500 error. Depending on DEBUG, all other log records are either sent to\n+# the console (DEBUG=True) or discarded by mean of the NullHandler (DEBUG=False).\n+DEFAULT_LOGGING = {\n+    'version': 1,\n+    'disable_existing_loggers': False,\n+    'filters': {\n+        'require_debug_false': {\n+            '()': 'django.utils.log.RequireDebugFalse',\n+        },\n+        'require_debug_true': {\n+            '()': 'django.utils.log.RequireDebugTrue',\n+        },\n+    },\n+    'handlers': {\n+        'console':{\n+            'level': 'INFO',\n+            'filters': ['require_debug_true'],\n+            'class': 'logging.StreamHandler',\n+        },\n+        'null': {\n+            'class': 'django.utils.log.NullHandler',\n+        },\n+        'mail_admins': {\n+            'level': 'ERROR',\n+            'filters': ['require_debug_false'],\n+            'class': 'django.utils.log.AdminEmailHandler'\n+        }\n+    },\n+    'loggers': {\n+        'django': {\n+            'handlers': ['console'],\n+        },\n+        'django.request': {\n+            'handlers': ['mail_admins'],\n+            'level': 'ERROR',\n+            'propagate': False,\n+        },\n+    }\n+}\n \n \n class AdminEmailHandler(logging.Handler):\n@@ -103,3 +138,8 @@ def filter(self, record):\n class RequireDebugFalse(logging.Filter):\n     def filter(self, record):\n         return not settings.DEBUG\n+\n+\n+class RequireDebugTrue(logging.Filter):\n+    def filter(self, record):\n+       return settings.DEBUG"
        },
        {
            "sha": "6a31237f135ea962520f8348a120ba1e0260ea0a",
            "filename": "django/utils/numberformat.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fnumberformat.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fnumberformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fnumberformat.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -21,12 +21,10 @@ def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',\n     if isinstance(number, int) and not use_grouping and not decimal_pos:\n         return mark_safe(six.text_type(number))\n     # sign\n-    if float(number) < 0:\n-        sign = '-'\n-    else:\n-        sign = ''\n+    sign = ''\n     str_number = six.text_type(number)\n     if str_number[0] == '-':\n+        sign = '-'\n         str_number = str_number[1:]\n     # decimal part\n     if '.' in str_number:\n@@ -48,4 +46,3 @@ def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',\n             int_part_gd += digit\n         int_part = int_part_gd[::-1]\n     return sign + int_part + dec_part\n-"
        },
        {
            "sha": "d75ca8dbca89f21b49d67da9c040fdcc5c8157fb",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -288,6 +288,37 @@ def compress_string(s):\n     zfile.close()\n     return zbuf.getvalue()\n \n+class StreamingBuffer(object):\n+    def __init__(self):\n+        self.vals = []\n+\n+    def write(self, val):\n+        self.vals.append(val)\n+\n+    def read(self):\n+        ret = b''.join(self.vals)\n+        self.vals = []\n+        return ret\n+\n+    def flush(self):\n+        return\n+\n+    def close(self):\n+        return\n+\n+# Like compress_string, but for iterators of strings.\n+def compress_sequence(sequence):\n+    buf = StreamingBuffer()\n+    zfile = GzipFile(mode='wb', compresslevel=6, fileobj=buf)\n+    # Output headers...\n+    yield buf.read()\n+    for item in sequence:\n+        zfile.write(item)\n+        zfile.flush()\n+        yield buf.read()\n+    zfile.close()\n+    yield buf.read()\n+\n ustring_re = re.compile(\"([\\u0080-\\uffff])\")\n \n def javascript_quote(s, quote_double_quotes=False):"
        },
        {
            "sha": "9e94840ee0bc602a5644dcb7b0f50d4471811c22",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -30,9 +30,10 @@\n # magic gettext number to separate context from message\n CONTEXT_SEPARATOR = \"\\x04\"\n \n-# Format of Accept-Language header values. From RFC 2616, section 14.4 and 3.9.\n+# Format of Accept-Language header values. From RFC 2616, section 14.4 and 3.9\n+# and RFC 3066, section 2.1\n accept_language_re = re.compile(r'''\n-        ([A-Za-z]{1,8}(?:-[A-Za-z]{1,8})*|\\*)         # \"en\", \"en-au\", \"x-y-z\", \"*\"\n+        ([A-Za-z]{1,8}(?:-[A-Za-z0-9]{1,8})*|\\*)      # \"en\", \"en-au\", \"x-y-z\", \"es-419\", \"*\"\n         (?:\\s*;\\s*q=(0(?:\\.\\d{,3})?|1(?:.0{,3})?))?   # Optional \"q=1.00\", \"q=0.8\"\n         (?:\\s*,\\s*|$)                                 # Multiple accepts per header.\n         ''', re.VERBOSE)\n@@ -273,7 +274,8 @@ def ugettext(message):\n         return do_translate(message, 'ugettext')\n \n def pgettext(context, message):\n-    result = ugettext(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, message))\n+    msg_with_ctxt = \"%s%s%s\" % (context, CONTEXT_SEPARATOR, message)\n+    result = ugettext(msg_with_ctxt)\n     if CONTEXT_SEPARATOR in result:\n         # Translation not found\n         result = message\n@@ -319,9 +321,10 @@ def ungettext(singular, plural, number):\n         return do_ntranslate(singular, plural, number, 'ungettext')\n \n def npgettext(context, singular, plural, number):\n-    result = ungettext(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, singular),\n-                       \"%s%s%s\" % (context, CONTEXT_SEPARATOR, plural),\n-                        number)\n+    msgs_with_ctxt = (\"%s%s%s\" % (context, CONTEXT_SEPARATOR, singular),\n+                      \"%s%s%s\" % (context, CONTEXT_SEPARATOR, plural),\n+                      number)\n+    result = ungettext(*msgs_with_ctxt)\n     if CONTEXT_SEPARATOR in result:\n         # Translation not found\n         result = ungettext(singular, plural, number)\n@@ -437,8 +440,8 @@ def blankout(src, char):\n     return dot_re.sub(char, src)\n \n context_re = re.compile(r\"\"\"^\\s+.*context\\s+((?:\"[^\"]*?\")|(?:'[^']*?'))\\s*\"\"\")\n-inline_re = re.compile(r\"\"\"^\\s*trans\\s+((?:\"[^\"]*?\")|(?:'[^']*?'))(\\s+.*context\\s+(?:\"[^\"]*?\")|(?:'[^']*?'))?\\s*\"\"\")\n-block_re = re.compile(r\"\"\"^\\s*blocktrans(\\s+.*context\\s+(?:\"[^\"]*?\")|(?:'[^']*?'))?(?:\\s+|$)\"\"\")\n+inline_re = re.compile(r\"\"\"^\\s*trans\\s+((?:\"[^\"]*?\")|(?:'[^']*?'))(\\s+.*context\\s+((?:\"[^\"]*?\")|(?:'[^']*?')))?\\s*\"\"\")\n+block_re = re.compile(r\"\"\"^\\s*blocktrans(\\s+.*context\\s+((?:\"[^\"]*?\")|(?:'[^']*?')))?(?:\\s+|$)\"\"\")\n endblock_re = re.compile(r\"\"\"^\\s*endblocktrans$\"\"\")\n plural_re = re.compile(r\"\"\"^\\s*plural$\"\"\")\n constant_re = re.compile(r\"\"\"_\\(((?:\".*?\")|(?:'.*?'))\\)\"\"\")"
        },
        {
            "sha": "e0a8286e48f2e4445de6be47105a683d13b2a23a",
            "filename": "django/utils/version.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fversion.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Futils%2Fversion.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fversion.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -30,7 +30,7 @@ def get_version(version=None):\n         mapping = {'alpha': 'a', 'beta': 'b', 'rc': 'c'}\n         sub = mapping[version[3]] + str(version[4])\n \n-    return main + sub\n+    return str(main + sub)\n \n def get_git_changeset():\n     \"\"\"Returns a numeric identifier of the latest git changeset."
        },
        {
            "sha": "aaa7e40efe58e1d453a2e4c137c3436fb3327c8d",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 13,
            "deletions": 9,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -354,15 +354,19 @@ def _get_lines_from_file(self, filename, lineno, context_lines, loader=None, mod\n         if source is None:\n             return None, [], None, []\n \n-        encoding = 'ascii'\n-        for line in source[:2]:\n-            # File coding may be specified. Match pattern from PEP-263\n-            # (http://www.python.org/dev/peps/pep-0263/)\n-            match = re.search(br'coding[:=]\\s*([-\\w.]+)', line)\n-            if match:\n-                encoding = match.group(1)\n-                break\n-        source = [six.text_type(sline, encoding, 'replace') for sline in source]\n+        # If we just read the source from a file, or if the loader did not\n+        # apply tokenize.detect_encoding to decode the source into a Unicode\n+        # string, then we should do that ourselves.\n+        if isinstance(source[0], six.binary_type):\n+            encoding = 'ascii'\n+            for line in source[:2]:\n+                # File coding may be specified. Match pattern from PEP-263\n+                # (http://www.python.org/dev/peps/pep-0263/)\n+                match = re.search(br'coding[:=]\\s*([-\\w.]+)', line)\n+                if match:\n+                    encoding = match.group(1).decode('ascii')\n+                    break\n+            source = [six.text_type(sline, encoding, 'replace') for sline in source]\n \n         lower_bound = max(0, lineno - context_lines)\n         upper_bound = lineno + context_lines"
        },
        {
            "sha": "06925c1f4a2c9ee75c955cc4613e88a62a654119",
            "filename": "django/views/decorators/cache.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdecorators%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdecorators%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fcache.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -12,7 +12,7 @@ def cache_page(*args, **kwargs):\n     The cache is keyed by the URL and some data from the headers.\n     Additionally there is the key prefix that is used to distinguish different\n     cache areas in a multi-site setup. You could use the\n-    sites.get_current().domain, for example, as that is unique across a Django\n+    sites.get_current_site().domain, for example, as that is unique across a Django\n     project.\n \n     Additionally, all headers from the response's Vary header will be taken"
        },
        {
            "sha": "410979e1e4b49c58e6bf15e235a92aca731e6eca",
            "filename": "django/views/decorators/http.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdecorators%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdecorators%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fhttp.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -2,18 +2,18 @@\n Decorators for views based on HTTP headers.\n \"\"\"\n \n+import logging\n from calendar import timegm\n from functools import wraps\n \n from django.utils.decorators import decorator_from_middleware, available_attrs\n from django.utils.http import http_date, parse_http_date_safe, parse_etags, quote_etag\n-from django.utils.log import getLogger\n from django.middleware.http import ConditionalGetMiddleware\n from django.http import HttpResponseNotAllowed, HttpResponseNotModified, HttpResponse\n \n conditional_page = decorator_from_middleware(ConditionalGetMiddleware)\n \n-logger = getLogger('django.request')\n+logger = logging.getLogger('django.request')\n \n \n def require_http_methods(request_method_list):"
        },
        {
            "sha": "ec7a233ff7cc3e549fa3db9ae1a0c5e861212130",
            "filename": "django/views/defaults.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdefaults.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fdefaults.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdefaults.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,6 +1,6 @@\n from django import http\n from django.template import (Context, RequestContext,\n-                             loader, TemplateDoesNotExist)\n+                             loader, Template, TemplateDoesNotExist)\n from django.views.decorators.csrf import requires_csrf_token\n \n \n@@ -17,8 +17,13 @@ def page_not_found(request, template_name='404.html'):\n         request_path\n             The path of the requested URL (e.g., '/app/pages/bad_page/')\n     \"\"\"\n-    t = loader.get_template(template_name) # You need to create a 404.html template.\n-    return http.HttpResponseNotFound(t.render(RequestContext(request, {'request_path': request.path})))\n+    try:\n+        template = loader.get_template(template_name)\n+    except TemplateDoesNotExist:\n+        template = Template(\n+            '<h1>Not Found</h1>'\n+            '<p>The requested URL {{ request_path }} was not found on this server.</p>')\n+    return http.HttpResponseNotFound(template.render(RequestContext(request, {'request_path': request.path})))\n \n \n @requires_csrf_token\n@@ -29,8 +34,11 @@ def server_error(request, template_name='500.html'):\n     Templates: :template:`500.html`\n     Context: None\n     \"\"\"\n-    t = loader.get_template(template_name) # You need to create a 500.html template.\n-    return http.HttpResponseServerError(t.render(Context({})))\n+    try:\n+        template = loader.get_template(template_name)\n+    except TemplateDoesNotExist:\n+        return http.HttpResponseServerError('<h1>Server Error (500)</h1>')\n+    return http.HttpResponseServerError(template.render(Context({})))\n \n \n # This can be called when CsrfViewMiddleware.process_view has not run,"
        },
        {
            "sha": "23e18c54a0205eb28079840b69f5e5480c84121e",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -1,14 +1,15 @@\n from __future__ import unicode_literals\n \n+import logging\n from functools import update_wrapper\n+\n from django import http\n from django.core.exceptions import ImproperlyConfigured\n from django.template.response import TemplateResponse\n-from django.utils.log import getLogger\n from django.utils.decorators import classonlymethod\n from django.utils import six\n \n-logger = getLogger('django.request')\n+logger = logging.getLogger('django.request')\n \n \n class ContextMixin(object):\n@@ -98,7 +99,7 @@ def options(self, request, *args, **kwargs):\n         \"\"\"\n         response = http.HttpResponse()\n         response['Allow'] = ', '.join(self._allowed_methods())\n-        response['Content-Length'] = 0\n+        response['Content-Length'] = '0'\n         return response\n \n     def _allowed_methods(self):"
        },
        {
            "sha": "e1b0eb99fe5190e8432d6023f286d966fe955d2b",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -377,7 +377,7 @@ def get_date_list_period(self):\n         \"\"\"\n         return self.date_list_period\n \n-    def get_date_list(self, queryset, date_type=None):\n+    def get_date_list(self, queryset, date_type=None, ordering='ASC'):\n         \"\"\"\n         Get a date list by calling `queryset.dates()`, checking along the way\n         for empty lists that aren't allowed.\n@@ -387,7 +387,7 @@ def get_date_list(self, queryset, date_type=None):\n         if date_type is None:\n             date_type = self.get_date_list_period()\n \n-        date_list = queryset.dates(date_field, date_type)[::-1]\n+        date_list = queryset.dates(date_field, date_type, ordering)\n         if date_list is not None and not date_list and not allow_empty:\n             name = force_text(queryset.model._meta.verbose_name_plural)\n             raise Http404(_(\"No %(verbose_name_plural)s available\") %\n@@ -409,7 +409,7 @@ def get_dated_items(self):\n         Return (date_list, items, extra_context) for this request.\n         \"\"\"\n         qs = self.get_dated_queryset(ordering='-%s' % self.get_date_field())\n-        date_list = self.get_date_list(qs)\n+        date_list = self.get_date_list(qs, ordering='DESC')\n \n         if not date_list:\n             qs = qs.none()"
        },
        {
            "sha": "f61ba28bd58a0b233b153c2df10bb449f95150c2",
            "filename": "django/views/static.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/django%2Fviews%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fstatic.py?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -14,7 +14,8 @@\n except ImportError:     # Python 2\n     from urllib import unquote\n \n-from django.http import Http404, HttpResponse, HttpResponseRedirect, HttpResponseNotModified\n+from django.http import (CompatibleStreamingHttpResponse, Http404,\n+    HttpResponse, HttpResponseRedirect, HttpResponseNotModified)\n from django.template import loader, Template, Context, TemplateDoesNotExist\n from django.utils.http import http_date, parse_http_date\n from django.utils.translation import ugettext as _, ugettext_noop\n@@ -62,8 +63,7 @@ def serve(request, path, document_root=None, show_indexes=False):\n     if not was_modified_since(request.META.get('HTTP_IF_MODIFIED_SINCE'),\n                               statobj.st_mtime, statobj.st_size):\n         return HttpResponseNotModified()\n-    with open(fullpath, 'rb') as f:\n-        response = HttpResponse(f.read(), content_type=mimetype)\n+    response = CompatibleStreamingHttpResponse(open(fullpath, 'rb'), content_type=mimetype)\n     response[\"Last-Modified\"] = http_date(statobj.st_mtime)\n     if stat.S_ISREG(statobj.st_mode):\n         response[\"Content-Length\"] = statobj.st_size\n@@ -138,7 +138,7 @@ def was_modified_since(header=None, mtime=0, size=0):\n         header_len = matches.group(3)\n         if header_len and int(header_len) != size:\n             raise ValueError\n-        if mtime > header_mtime:\n+        if int(mtime) > header_mtime:\n             raise ValueError\n     except (AttributeError, ValueError, OverflowError):\n         return True"
        },
        {
            "sha": "872ad254c90e2f2ce457de614d2b076584c7389d",
            "filename": "docs/faq/admin.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Ffaq%2Fadmin.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Ffaq%2Fadmin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Fadmin.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -68,6 +68,18 @@ For example, if your ``list_filter`` includes ``sites``, and there's only one\n site in your database, it won't display a \"Site\" filter. In that case,\n filtering by site would be meaningless.\n \n+Some objects aren't appearing in the admin.\n+-------------------------------------------\n+\n+Inconsistent row counts may be caused by missing foreign key values or a\n+foreign key field incorrectly set to :attr:`null=False\n+<django.db.models.Field.null>`. If you have a record with a\n+:class:`~django.db.models.ForeignKey` pointing to a non-existent object and\n+that foreign key is included is\n+:attr:`~django.contrib.admin.ModelAdmin.list_display`, the record will not be\n+shown in the admin changelist because the Django model is declaring an\n+integrity constraint that is not implemented at the database level.\n+\n How can I customize the functionality of the admin interface?\n -------------------------------------------------------------\n \n@@ -104,4 +116,3 @@ example, some browsers may not support rounded corners. These are considered\n acceptable variations in rendering.\n \n .. _YUI's A-grade: http://yuilibrary.com/yui/docs/tutorials/gbs/\n-"
        },
        {
            "sha": "719fbc176949ed4bf6e9017b34e1cb44c64ae8d6",
            "filename": "docs/howto/apache-auth.txt",
            "status": "removed",
            "additions": 0,
            "deletions": 45,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/a589fdff81ab36c57ff0a1003e60ee0dd55f3a88/docs%2Fhowto%2Fapache-auth.txt",
            "raw_url": "https://github.com/django/django/raw/a589fdff81ab36c57ff0a1003e60ee0dd55f3a88/docs%2Fhowto%2Fapache-auth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fapache-auth.txt?ref=a589fdff81ab36c57ff0a1003e60ee0dd55f3a88",
            "patch": "@@ -1,45 +0,0 @@\n-=========================================================\n-Authenticating against Django's user database from Apache\n-=========================================================\n-\n-Since keeping multiple authentication databases in sync is a common problem when\n-dealing with Apache, you can configuring Apache to authenticate against Django's\n-:doc:`authentication system </topics/auth>` directly. This requires Apache\n-version >= 2.2 and mod_wsgi >= 2.0. For example, you could:\n-\n-* Serve static/media files directly from Apache only to authenticated users.\n-\n-* Authenticate access to a Subversion_ repository against Django users with\n-  a certain permission.\n-\n-* Allow certain users to connect to a WebDAV share created with mod_dav_.\n-\n-.. _Subversion: http://subversion.tigris.org/\n-.. _mod_dav: http://httpd.apache.org/docs/2.2/mod/mod_dav.html\n-\n-Configuring Apache\n-==================\n-\n-To check against Django's authorization database from a Apache configuration\n-file, you'll need to set 'wsgi' as the value of ``AuthBasicProvider`` or\n-``AuthDigestProvider`` directive and then use the ``WSGIAuthUserScript``\n-directive to set the path to your authentification script:\n-\n-.. code-block:: apache\n-\n-    <Location /example/>\n-        AuthType Basic\n-        AuthName \"example.com\"\n-        AuthBasicProvider wsgi\n-        WSGIAuthUserScript /usr/local/wsgi/scripts/auth.wsgi\n-        Require valid-user\n-    </Location>\n-\n-Your auth.wsgi script will have to implement either a\n-``check_password(environ, user, password)`` function (for ``AuthBasicProvider``)\n-or a ``get_realm_hash(environ, user, realm)`` function (for ``AuthDigestProvider``).\n-\n-See the `mod_wsgi documentation`_ for more details about the implementation\n-of such a solution.\n-\n-.. _mod_wsgi documentation: http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Authentication_Provider"
        },
        {
            "sha": "1e9d5d8701c464e478dd733bf717bcf34a3e3d04",
            "filename": "docs/howto/custom-model-fields.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fcustom-model-fields.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fcustom-model-fields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-model-fields.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -448,6 +448,13 @@ called when it is created, you should be using `The SubfieldBase metaclass`_\n mentioned earlier. Otherwise :meth:`.to_python` won't be called\n automatically.\n \n+.. warning::\n+\n+    If your custom field allows ``null=True``, any field method that takes\n+    ``value`` as an argument, like :meth:`~Field.to_python` and\n+    :meth:`~Field.get_prep_value`, should handle the case when ``value`` is\n+    ``None``.\n+\n Converting Python objects to query values\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n "
        },
        {
            "sha": "70b6288beed2ef56ff7ccd8aea847ccbe4ee1eb6",
            "filename": "docs/howto/custom-template-tags.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fcustom-template-tags.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fcustom-template-tags.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-template-tags.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -760,8 +760,6 @@ A few things to note about the ``simple_tag`` helper function:\n * If the argument was a template variable, our function is passed the\n   current value of the variable, not the variable itself.\n \n-.. versionadded:: 1.3\n-\n If your template tag needs to access the current context, you can use the\n ``takes_context`` argument when registering your tag:\n "
        },
        {
            "sha": "5f700f1cb34bbdaefabe0fb2a2eb81d191a675aa",
            "filename": "docs/howto/deployment/wsgi/apache-auth.txt",
            "status": "added",
            "additions": 130,
            "deletions": 0,
            "changes": 130,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fapache-auth.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fapache-auth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fapache-auth.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,130 @@\n+=========================================================\n+Authenticating against Django's user database from Apache\n+=========================================================\n+\n+Since keeping multiple authentication databases in sync is a common problem when\n+dealing with Apache, you can configure Apache to authenticate against Django's\n+:doc:`authentication system </topics/auth>` directly. This requires Apache\n+version >= 2.2 and mod_wsgi >= 2.0. For example, you could:\n+\n+* Serve static/media files directly from Apache only to authenticated users.\n+\n+* Authenticate access to a Subversion_ repository against Django users with\n+  a certain permission.\n+\n+* Allow certain users to connect to a WebDAV share created with mod_dav_.\n+\n+.. note::\n+    If you have installed a :ref:`custom User model <auth-custom-user>` and\n+    want to use this default auth handler, it must support an `is_active`\n+    attribute. If you want to use group based authorization, your custom user\n+    must have a relation named 'groups', referring to a related object that has\n+    a 'name' field. You can also specify your own custom mod_wsgi\n+    auth handler if your custom cannot conform to these requirements.\n+\n+.. _Subversion: http://subversion.tigris.org/\n+.. _mod_dav: http://httpd.apache.org/docs/2.2/mod/mod_dav.html\n+\n+Authentication with mod_wsgi\n+============================\n+\n+Make sure that mod_wsgi is installed and activated and that you have\n+followed the steps to setup\n+:doc:`Apache with mod_wsgi </howto/deployment/wsgi/modwsgi>`\n+\n+Next, edit your Apache configuration to add a location that you want\n+only authenticated users to be able to view:\n+\n+.. code-block:: apache\n+\n+    WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py\n+\n+    WSGIProcessGroup %{GLOBAL}\n+    WSGIApplicationGroup django\n+\n+    <Location \"/secret\">\n+        AuthType Basic\n+        AuthName \"Top Secret\"\n+        Require valid-user\n+        AuthBasicProvider wsgi\n+        WSGIAuthUserScript /path/to/mysite.com/mysite/wsgi.py\n+    </Location>\n+\n+The ``WSGIAuthUserScript`` directive tells mod_wsgi to execute the\n+``check_password`` function in specified wsgi script, passing the user name and\n+password that it receives from the prompt. In this example, the\n+``WSGIAuthUserScript`` is the same as the ``WSGIScriptAlias`` that defines your\n+application :doc:`that is created by django-admin.py startproject\n+</howto/deployment/wsgi/index>`.\n+\n+.. admonition:: Using Apache 2.2 with authentication\n+\n+    Make sure that ``mod_auth_basic`` and ``mod_authz_user`` are loaded.\n+\n+    These might be compiled statically into Apache, or you might need to use\n+    LoadModule to load them dynamically in your ``httpd.conf``:\n+\n+    .. code-block:: apache\n+\n+        LoadModule auth_basic_module modules/mod_auth_basic.so\n+        LoadModule authz_user_module modules/mod_authz_user.so\n+\n+Finally, edit your WSGI script ``mysite.wsgi`` to tie Apache's\n+authentication to your site's authentication mechanisms by importing the\n+check_user function:\n+\n+.. code-block:: python\n+\n+    import os\n+    import sys\n+\n+    os.environ['DJANGO_SETTINGS_MODULE'] = 'mysite.settings'\n+\n+    from django.contrib.auth.handlers.modwsgi import check_password\n+\n+    from django.core.handlers.wsgi import WSGIHandler\n+    application = WSGIHandler()\n+\n+\n+Requests beginning with ``/secret/`` will now require a user to authenticate.\n+\n+The mod_wsgi `access control mechanisms documentation`_ provides additional\n+details and information about alternative methods of authentication.\n+\n+.. _access control mechanisms documentation: http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms\n+\n+Authorization with mod_wsgi and Django groups\n+---------------------------------------------\n+\n+mod_wsgi also provides functionality to restrict a particular location to\n+members of a group.\n+\n+In this case, the Apache configuration should look like this:\n+\n+.. code-block:: apache\n+\n+    WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py\n+\n+    WSGIProcessGroup %{GLOBAL}\n+    WSGIApplicationGroup django\n+\n+    <Location \"/secret\">\n+        AuthType Basic\n+        AuthName \"Top Secret\"\n+        AuthBasicProvider wsgi\n+        WSGIAuthUserScript /path/to/mysite.com/mysite/wsgi.py\n+        WSGIAuthGroupScript /path/to/mysite.com/mysite/wsgi.py\n+        Require group secret-agents\n+        Require valid-user\n+    </Location>\n+\n+To support the ``WSGIAuthGroupScript`` directive, the same WSGI script\n+``mysite.wsgi`` must also import the ``groups_for_user`` function which\n+returns a list groups the given user belongs to.\n+\n+.. code-block:: python\n+\n+    from django.contrib.auth.handlers.modwsgi import check_password, groups_for_user\n+\n+Requests for ``/secret/`` will now also require user to be a member of the\n+\"secret-agents\" group."
        },
        {
            "sha": "769d406b1b9a7a3a47d549f7c16955db6c6c2a98",
            "filename": "docs/howto/deployment/wsgi/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fdeployment%2Fwsgi%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fdeployment%2Fwsgi%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fwsgi%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -16,6 +16,7 @@ documentation for the following WSGI servers:\n    :maxdepth: 1\n \n    modwsgi\n+   apache-auth\n    gunicorn\n    uwsgi\n "
        },
        {
            "sha": "7f68485dfffbfda222ec4b9faf42ecb3db938bc5",
            "filename": "docs/howto/deployment/wsgi/modwsgi.txt",
            "status": "modified",
            "additions": 24,
            "deletions": 4,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fmodwsgi.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fmodwsgi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fmodwsgi.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -25,7 +25,9 @@ Basic configuration\n ===================\n \n Once you've got mod_wsgi installed and activated, edit your Apache server's\n-``httpd.conf`` file and add::\n+``httpd.conf`` file and add\n+\n+.. code-block:: apache\n \n     WSGIScriptAlias / /path/to/mysite.com/mysite/wsgi.py\n     WSGIPythonPath /path/to/mysite.com\n@@ -56,21 +58,32 @@ for you; otherwise, you'll need to create it. See the :doc:`WSGI overview\n documentation</howto/deployment/wsgi/index>` for the default contents you\n should put in this file, and what else you can add to it.\n \n+.. warning::\n+\n+   If multiple Django sites are run in a single mod_wsgi process, all of them\n+   will use the settings of whichever one happens to run first. This can be\n+   solved with a minor edit to ``wsgi.py`` (see comment in the file for\n+   details), or by :ref:`using mod_wsgi daemon mode<daemon-mode>` and ensuring\n+   that each site runs in its own daemon process.\n+\n+\n Using a virtualenv\n ==================\n \n If you install your project's Python dependencies inside a `virtualenv`_,\n you'll need to add the path to this virtualenv's ``site-packages`` directory to\n-your Python path as well. To do this, you can add another line to your\n-Apache configuration::\n+your Python path as well. To do this, add an additional path to your\n+`WSGIPythonPath` directive, with multiple paths separated by a colon::\n \n-    WSGIPythonPath /path/to/your/venv/lib/python2.X/site-packages\n+    WSGIPythonPath /path/to/mysite.com:/path/to/your/venv/lib/python2.X/site-packages\n \n Make sure you give the correct path to your virtualenv, and replace\n ``python2.X`` with the correct Python version (e.g. ``python2.7``).\n \n .. _virtualenv: http://www.virtualenv.org\n \n+.. _daemon-mode:\n+\n Using mod_wsgi daemon mode\n ==========================\n \n@@ -177,6 +190,13 @@ other approaches:\n 3. Copy the admin static files so that they live within your Apache\n    document root.\n \n+Authenticating against Django's user database from Apache\n+=========================================================\n+\n+Django provides a handler to allow Apache to authenticate users directly\n+against Django's authentication backends. See the :doc:`mod_wsgi authentication\n+documentation </howto/deployment/wsgi/apache-auth>`.\n+\n If you get a UnicodeEncodeError\n ===============================\n "
        },
        {
            "sha": "78e797b6075ecd37a1427459e8fba9b14528c56d",
            "filename": "docs/howto/error-reporting.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Ferror-reporting.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Ferror-reporting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Ferror-reporting.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -44,8 +44,6 @@ setting.\n \n .. seealso::\n \n-   .. versionadded:: 1.3\n-\n    Server error emails are sent using the logging framework, so you can\n    customize this behavior by :doc:`customizing your logging configuration\n    </topics/logging>`.\n@@ -99,8 +97,6 @@ The best way to disable this behavior is to set\n \n .. seealso::\n \n-   .. versionadded:: 1.3\n-\n    404 errors are logged using the logging framework. By default, these log\n    records are ignored, but you can use them for error reporting by writing a\n    handler and :doc:`configuring logging </topics/logging>` appropriately."
        },
        {
            "sha": "d39222be26f158c7acd173588cc9cbf700ab6199",
            "filename": "docs/howto/index.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -9,7 +9,6 @@ you quickly accomplish common tasks.\n .. toctree::\n    :maxdepth: 1\n \n-   apache-auth\n    auth-remote-user\n    custom-management-commands\n    custom-model-fields"
        },
        {
            "sha": "461a5d3804a1e522e6aee056efff8333cf14a2ba",
            "filename": "docs/howto/jython.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fjython.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fjython.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fjython.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -6,9 +6,10 @@ Running Django on Jython\n \n .. admonition:: Python 2.6 support\n \n-    Django 1.5 has dropped support for Python 2.5. Until Jython provides a new\n-    version that supports 2.6, Django 1.5 is no more compatible with Jython.\n-    Please use Django 1.4 if you want to use Django over Jython.\n+    Django 1.5 has dropped support for Python 2.5. Therefore, you have to use\n+    a Jython 2.7 alpha release if you want to use Django 1.5 with Jython.\n+    Please use Django 1.4 if you want to keep using Django on a stable Jython\n+    version.\n \n Jython_ is an implementation of Python that runs on the Java platform (JVM).\n Django runs cleanly on Jython version 2.5 or later, which means you can deploy"
        },
        {
            "sha": "bcc6f3827bd70c4f99ffc43108ba1000c6221605",
            "filename": "docs/howto/outputting-csv.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Foutputting-csv.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Foutputting-csv.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Foutputting-csv.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -21,7 +21,7 @@ Here's an example::\n     def some_view(request):\n         # Create the HttpResponse object with the appropriate CSV header.\n         response = HttpResponse(mimetype='text/csv')\n-        response['Content-Disposition'] = 'attachment; filename=somefilename.csv'\n+        response['Content-Disposition'] = 'attachment; filename=\"somefilename.csv\"'\n \n         writer = csv.writer(response)\n         writer.writerow(['First row', 'Foo', 'Bar', 'Baz'])\n@@ -93,7 +93,7 @@ Here's an example, which generates the same CSV file as above::\n     def some_view(request):\n         # Create the HttpResponse object with the appropriate CSV header.\n         response = HttpResponse(mimetype='text/csv')\n-        response['Content-Disposition'] = 'attachment; filename=somefilename.csv'\n+        response['Content-Disposition'] = 'attachment; filename=\"somefilename.csv\"'\n \n         # The data is hard-coded here, but you could load it from a database or\n         # some other source."
        },
        {
            "sha": "9d87b977106cf649e3138c7c28e73f89768ec118",
            "filename": "docs/howto/outputting-pdf.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Foutputting-pdf.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Foutputting-pdf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Foutputting-pdf.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -52,7 +52,7 @@ Here's a \"Hello World\" example::\n     def some_view(request):\n         # Create the HttpResponse object with the appropriate PDF headers.\n         response = HttpResponse(mimetype='application/pdf')\n-        response['Content-Disposition'] = 'attachment; filename=somefilename.pdf'\n+        response['Content-Disposition'] = 'attachment; filename=\"somefilename.pdf\"'\n \n         # Create the PDF object, using the response object as its \"file.\"\n         p = canvas.Canvas(response)\n@@ -87,7 +87,7 @@ mention:\n   the PDF using whatever program/plugin they've been configured to use for\n   PDFs. Here's what that code would look like::\n \n-      response['Content-Disposition'] = 'filename=somefilename.pdf'\n+      response['Content-Disposition'] = 'filename=\"somefilename.pdf\"'\n \n * Hooking into the ReportLab API is easy: Just pass ``response`` as the\n   first argument to ``canvas.Canvas``. The ``Canvas`` class expects a\n@@ -121,7 +121,7 @@ Here's the above \"Hello World\" example rewritten to use :mod:`io`::\n     def some_view(request):\n         # Create the HttpResponse object with the appropriate PDF headers.\n         response = HttpResponse(mimetype='application/pdf')\n-        response['Content-Disposition'] = 'attachment; filename=somefilename.pdf'\n+        response['Content-Disposition'] = 'attachment; filename=\"somefilename.pdf\"'\n \n         buffer = BytesIO()\n "
        },
        {
            "sha": "964b5fab610c0196d49ce18adbaa9e3fcfdaffd4",
            "filename": "docs/howto/static-files.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fstatic-files.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fhowto%2Fstatic-files.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fstatic-files.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -2,8 +2,6 @@\n Managing static files\n =====================\n \n-.. versionadded:: 1.3\n-\n Django developers mostly concern themselves with the dynamic parts of web\n applications -- the views and templates that render anew for each request. But\n web applications have other parts: the static files (images, CSS,"
        },
        {
            "sha": "5055edf7e7b9b7edbf5bfaa5646943629becd822",
            "filename": "docs/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -181,7 +181,6 @@ testing of Django applications:\n   :doc:`Overview <howto/deployment/index>` |\n   :doc:`WSGI servers <howto/deployment/wsgi/index>` |\n   :doc:`FastCGI/SCGI/AJP <howto/deployment/fastcgi>` |\n-  :doc:`Apache authentication <howto/apache-auth>` |\n   :doc:`Handling static files <howto/static-files>` |\n   :doc:`Tracking code errors by email <howto/error-reporting>`\n \n@@ -241,7 +240,7 @@ applications:\n * :doc:`Authentication <topics/auth>`\n * :doc:`Caching <topics/cache>`\n * :doc:`Logging <topics/logging>`\n-* :doc:`Sending e-mails <topics/email>`\n+* :doc:`Sending emails <topics/email>`\n * :doc:`Syndication feeds (RSS/Atom) <ref/contrib/syndication>`\n * :doc:`Comments <ref/contrib/comments/index>`, :doc:`comment moderation <ref/contrib/comments/moderation>` and :doc:`custom comments <ref/contrib/comments/custom>`\n * :doc:`Pagination <topics/pagination>`"
        },
        {
            "sha": "7900dd8cd0d14f956f6d596d5e4d88fe8f8befc0",
            "filename": "docs/internals/committers.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcommitters.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcommitters.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcommitters.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -407,6 +407,18 @@ Jeremy Dunck\n .. _vlogger: http://youtube.com/bryanveloso/\n .. _shoutcaster: http://twitch.tv/vlogalonstar/\n \n+`Preston Holmes`_\n+    Preston is a recovering neuroscientist who originally discovered Django as\n+    part of a sweeping move to Python from a grab bag of half a dozen\n+    languages. He was drawn to Django's balance of practical batteries included\n+    philosophy, care and thought in code design, and strong open source\n+    community. In addition to his current job in private progressive education,\n+    Preston contributes some developer time to local non-profits.\n+\n+    Preston lives with his family and animal menagerie in Santa Barbara, CA, USA.\n+\n+.. _Preston Holmes: http://www.ptone.com/\n+\n Specialists\n -----------\n "
        },
        {
            "sha": "67dda02f8b32fbb4c2f03a3ce74dd5d96d303e53",
            "filename": "docs/internals/contributing/committing-code.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fcommitting-code.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fcommitting-code.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fcommitting-code.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -187,7 +187,15 @@ Django's Git repository:\n \n   For the curious, we're using a `Trac plugin`_ for this.\n \n-  .. _Trac plugin: https://github.com/aaugustin/trac-github\n+.. note::\n+\n+    Note that the Trac integration doesn't know anything about pull requests.\n+    So if you try to close a pull request with the phrase \"closes #400\" in your\n+    commit message, GitHub will close the pull request, but the Trac plugin\n+    will also close the same numbered ticket in Trac.\n+\n+\n+.. _Trac plugin: https://github.com/aaugustin/trac-github\n \n * If your commit references a ticket in the Django `ticket tracker`_ but\n   does *not* close the ticket, include the phrase \"Refs #xxxxx\", where \"xxxxx\""
        },
        {
            "sha": "0cde77882c9f6d4939f8ef8d59dac27a5a4acb06",
            "filename": "docs/internals/contributing/localizing.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Flocalizing.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Flocalizing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Flocalizing.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -55,7 +55,7 @@ The format files aren't managed by the use of Transifex. To change them, you\n must :doc:`create a patch<writing-code/submitting-patches>` against the\n Django source tree, as for any code change:\n \n-* Create a diff against the current Subversion trunk.\n+* Create a diff against the current Git master branch.\n \n * Open a ticket in Django's ticket system, set its ``Component`` field to\n   ``Translations``, and attach the patch to it."
        },
        {
            "sha": "84f70fd7312b5d153585e63888870a5613388f51",
            "filename": "docs/internals/contributing/triaging-tickets.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Ftriaging-tickets.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Ftriaging-tickets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Ftriaging-tickets.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -171,15 +171,6 @@ concrete actionable issues. They are enhancement requests that we might\n consider adding someday to the framework if an excellent patch is submitted.\n These tickets are not a high priority.\n \n-Fixed on a branch\n-~~~~~~~~~~~~~~~~~\n-\n-Used to indicate that a ticket is resolved as part of a major body of work\n-that will eventually be merged to trunk. Tickets in this stage generally\n-don't need further work. This may happen in the case of major\n-features/refactors in each release cycle, or as part of the annual Google\n-Summer of Code efforts.\n-\n Other triage attributes\n -----------------------\n "
        },
        {
            "sha": "a699e39bd8c2f5e1776bc3ae7b86584af37ee63f",
            "filename": "docs/internals/contributing/writing-code/coding-style.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fwriting-code%2Fcoding-style.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fwriting-code%2Fcoding-style.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-code%2Fcoding-style.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -140,9 +140,9 @@ Model style\n   a tuple of tuples, with an all-uppercase name, either near the top of\n   the model module or just above the model class. Example::\n \n-      GENDER_CHOICES = (\n-          ('M', 'Male'),\n-          ('F', 'Female'),\n+      DIRECTION_CHOICES = (\n+          ('U', 'Up'),\n+          ('D', 'Down'),\n       )\n \n Use of ``django.conf.settings``"
        },
        {
            "sha": "a828b06b36d54e2cda7e3256a070b6f9514f6e41",
            "filename": "docs/internals/contributing/writing-code/unit-tests.txt",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -163,6 +163,26 @@ associated tests will be skipped.\n .. _gettext: http://www.gnu.org/software/gettext/manual/gettext.html\n .. _selenium: http://pypi.python.org/pypi/selenium\n \n+Code coverage\n+~~~~~~~~~~~~~\n+\n+Contributors are encouraged to run coverage on the test suite to identify areas\n+that need additional tests. The coverage tool installation and use is described\n+in :ref:`testing code coverage<topics-testing-code-coverage>`.\n+\n+To run coverage on the Django test suite using the standard test settings::\n+\n+    coverage run ./runtests.py --settings=test_sqlite\n+\n+After running coverage, generate the html report by running::\n+\n+    coverage html\n+\n+When running coverage for the Django tests, the included ``.coveragerc``\n+settings file  defines ``coverage_html`` as the output directory for the report\n+and also excludes several directories not relevant to the results\n+(test code or external code included in Django).\n+\n .. _contrib-apps:\n \n Contrib apps"
        },
        {
            "sha": "469f8614b9380a9338a4b29a7152d6aa0f8b87f4",
            "filename": "docs/internals/contributing/writing-documentation.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fwriting-documentation.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fcontributing%2Fwriting-documentation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-documentation.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -30,8 +30,9 @@ If you'd like to start contributing to our docs, get the development version of\n Django from the source code repository\n (see :ref:`installing-development-version`). The development version has the\n latest-and-greatest documentation, just as it has latest-and-greatest code.\n-Generally, we only revise documentation in the development version, as our\n-policy is to freeze documentation for existing releases (see\n+We also backport documentation fixes and improvements, at the discretion of the\n+committer, to the last release branch. That's because it's highly advantageous\n+to have the docs for the last release be up-to-date and correct (see\n :ref:`differences-between-doc-versions`).\n \n Getting started with Sphinx"
        },
        {
            "sha": "10bbfe1a9180dbab8e961f871d2395ef01df9d43",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -23,7 +23,7 @@ these changes.\n * The :mod:`django.contrib.gis.db.backend` module will be removed in favor\n   of the specific backends.\n \n-* ``SMTPConnection`` will be removed in favor of a generic E-mail backend API.\n+* ``SMTPConnection`` will be removed in favor of a generic Email backend API.\n \n * The many to many SQL generation functions on the database backends\n   will be removed.\n@@ -134,16 +134,16 @@ these changes.\n \n * The function-based generic view modules will be removed in favor of their\n   class-based equivalents, outlined :doc:`here\n-  </topics/class-based-views/index>`:\n+  </topics/class-based-views/index>`.\n \n * The :class:`~django.core.servers.basehttp.AdminMediaHandler` will be\n   removed.  In its place use\n   :class:`~django.contrib.staticfiles.handlers.StaticFilesHandler`.\n \n * The :ttag:`url` and :ttag:`ssi` template tags will be\n-  modified so that the first argument to each tag is a\n-  template variable, not an implied string. Until then, the new-style\n-  behavior is provided in the ``future`` template tag library.\n+  modified so that the first argument to each tag is a template variable, not\n+  an implied string. In 1.4, this behavior is provided by a version of the tag\n+  in the ``future`` template tag library.\n \n * The :djadmin:`reset` and :djadmin:`sqlreset` management commands\n   will be removed.\n@@ -286,6 +286,13 @@ these changes.\n * The ``mimetype`` argument to :class:`~django.http.HttpResponse` ``__init__``\n   will be removed (``content_type`` should be used instead).\n \n+* When :class:`~django.http.HttpResponse` is instantiated with an iterator,\n+  or when :attr:`~django.http.HttpResponse.content` is set to an iterator,\n+  that iterator will be immediately consumed.\n+\n+* The ``AUTH_PROFILE_MODULE`` setting, and the ``get_profile()`` method on\n+  the User model, will be removed.\n+\n 2.0\n ---\n "
        },
        {
            "sha": "b87b280d7c16ceba8543e30e7e0fbce264a21818",
            "filename": "docs/intro/tutorial02.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Ftutorial02.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Ftutorial02.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial02.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -440,20 +440,30 @@ Open your settings file (``mysite/settings.py``, remember) and look at the\n filesystem directories to check when loading Django templates. It's a search\n path.\n \n+Create a ``mytemplates`` directory in your project directory. Templates can\n+live anywhere on your filesystem that Django can access. (Django runs as\n+whatever user your server runs.) However, keeping your templates within the\n+project is a good convention to follow.\n+\n+When you‚Äôve done that, create a directory polls in your template directory.\n+Within that, create a file called index.html. Note that our\n+``loader.get_template('polls/index.html')`` code from above maps to\n+[template_directory]/polls/index.html‚Äù on the filesystem.\n+\n By default, :setting:`TEMPLATE_DIRS` is empty. So, let's add a line to it, to\n tell Django where our templates live::\n \n     TEMPLATE_DIRS = (\n-        '/home/my_username/mytemplates', # Change this to your own directory.\n+        '/path/to/mysite/mytemplates', # Change this to your own directory.\n     )\n \n Now copy the template ``admin/base_site.html`` from within the default Django\n admin template directory in the source code of Django itself\n (``django/contrib/admin/templates``) into an ``admin`` subdirectory of\n whichever directory you're using in :setting:`TEMPLATE_DIRS`. For example, if\n-your :setting:`TEMPLATE_DIRS` includes ``'/home/my_username/mytemplates'``, as\n+your :setting:`TEMPLATE_DIRS` includes ``'/path/to/mysite/mytemplates'``, as\n above, then copy ``django/contrib/admin/templates/admin/base_site.html`` to\n-``/home/my_username/mytemplates/admin/base_site.html``. Don't forget that\n+``/path/to/mysite/mytemplates/admin/base_site.html``. Don't forget that\n ``admin`` subdirectory.\n \n .. admonition:: Where are the Django source files?"
        },
        {
            "sha": "169e6cd59fbefbd56acd9657a5aa83403675934f",
            "filename": "docs/intro/tutorial03.txt",
            "status": "modified",
            "additions": 261,
            "deletions": 268,
            "changes": 529,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Ftutorial03.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Ftutorial03.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial03.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -10,7 +10,7 @@ Philosophy\n ==========\n \n A view is a \"type\" of Web page in your Django application that generally serves\n-a specific function and has a specific template. For example, in a Weblog\n+a specific function and has a specific template. For example, in a blog\n application, you might have the following views:\n \n * Blog homepage -- displays the latest few entries.\n@@ -41,154 +41,212 @@ In our poll application, we'll have the following four views:\n \n In Django, each view is represented by a simple Python function.\n \n-Design your URLs\n-================\n+Write your first view\n+=====================\n+\n+Let's write the first view. Open the file ``polls/views.py``\n+and put the following Python code in it::\n+\n+    from django.http import HttpResponse\n+\n+    def index(request):\n+        return HttpResponse(\"Hello, world. You're at the poll index.\")\n \n-The first step of writing views is to design your URL structure. You do this by\n-creating a Python module, called a URLconf. URLconfs are how Django associates\n-a given URL with given Python code.\n+This is the simplest view possible in Django. Now we have a problem, how does\n+this view get called? For that we need to map it to a URL, in Django this is\n+done in a configuration file called a URLconf.\n \n-When a user requests a Django-powered page, the system looks at the\n-:setting:`ROOT_URLCONF` setting, which contains a string in Python dotted\n-syntax. Django loads that module and looks for a module-level variable called\n-``urlpatterns``, which is a sequence of tuples in the following format::\n+.. admonition:: What is a URLconf?\n \n-    (regular expression, Python callback function [, optional dictionary])\n+    In Django, web pages and other content are delivered by views and\n+    determining which view is called is done by Python modules informally\n+    titled 'URLconfs'. These modules are pure Python code and are a simple\n+    mapping between URL patterns (as simple regular expressions) to Python\n+    callback functions (your views). This tutorial provides basic instruction\n+    in their use, and you can refer to :mod:`django.core.urlresolvers` for\n+    more information.\n \n-Django starts at the first regular expression and makes its way down the list,\n-comparing the requested URL against each regular expression until it finds one\n-that matches.\n+To create a URLconf in the polls directory, create a file called ``urls.py``.\n+Your app directory should now look like::\n \n-When it finds a match, Django calls the Python callback function, with an\n-:class:`~django.http.HttpRequest` object as the first argument, any \"captured\"\n-values from the regular expression as keyword arguments, and, optionally,\n-arbitrary keyword arguments from the dictionary (an optional third item in the\n-tuple).\n+    polls/\n+        __init__.py\n+        admin.py\n+        models.py\n+        tests.py\n+        urls.py\n+        views.py\n \n-For more on :class:`~django.http.HttpRequest` objects, see the\n-:doc:`/ref/request-response`. For more details on URLconfs, see the\n-:doc:`/topics/http/urls`.\n+In the ``polls/urls.py`` file include the following code::\n \n-When you ran ``django-admin.py startproject mysite`` at the beginning of\n-Tutorial 1, it created a default URLconf in ``mysite/urls.py``. It also\n-automatically set your :setting:`ROOT_URLCONF` setting (in ``settings.py``) to\n-point at that file::\n+    from django.conf.urls import patterns, url\n \n-    ROOT_URLCONF = 'mysite.urls'\n+    from polls import views\n \n-Time for an example. Edit ``mysite/urls.py`` so it looks like this::\n+    urlpatterns = patterns('',\n+        url(r'^$', views.index, name='index')\n+    )\n+\n+The next step is to point the root URLconf at the ``polls.urls`` module. In\n+``mysite/urls.py`` insert an :func:`~django.conf.urls.include`, leaving you\n+with::\n \n     from django.conf.urls import patterns, include, url\n \n     from django.contrib import admin\n     admin.autodiscover()\n \n     urlpatterns = patterns('',\n-        url(r'^polls/$', 'polls.views.index'),\n-        url(r'^polls/(?P<poll_id>\\d+)/$', 'polls.views.detail'),\n-        url(r'^polls/(?P<poll_id>\\d+)/results/$', 'polls.views.results'),\n-        url(r'^polls/(?P<poll_id>\\d+)/vote/$', 'polls.views.vote'),\n+        url(r'^polls/', include('polls.urls')),\n         url(r'^admin/', include(admin.site.urls)),\n     )\n \n-This is worth a review. When somebody requests a page from your Web site -- say,\n-\"/polls/23/\", Django will load this Python module, because it's pointed to by\n-the :setting:`ROOT_URLCONF` setting. It finds the variable named ``urlpatterns``\n-and traverses the regular expressions in order. When it finds a regular\n-expression that matches -- ``r'^polls/(?P<poll_id>\\d+)/$'`` -- it loads the\n-function ``detail()`` from ``polls/views.py``. Finally, it calls that\n-``detail()`` function like so::\n+You have now wired an `index` view into the URLconf. Go to\n+http://localhost:8000/polls/ in your browser, and you should see the text\n+\"*Hello, world. You're at the poll index.*\", which you defined in the\n+``index`` view.\n \n-    detail(request=<HttpRequest object>, poll_id='23')\n+The :func:`~django.conf.urls.url` function is passed four arguments, two\n+required: ``regex`` and ``view``, and two optional: ``kwargs``, and ``name``.\n+At this point, it's worth reviewing what these arguments are for.\n \n-The ``poll_id='23'`` part comes from ``(?P<poll_id>\\d+)``. Using parentheses\n-around a pattern \"captures\" the text matched by that pattern and sends it as an\n-argument to the view function; the ``?P<poll_id>`` defines the name that will be\n-used to identify the matched pattern; and ``\\d+`` is a regular expression to\n-match a sequence of digits (i.e., a number).\n+:func:`~django.conf.urls.url` argument: regex\n+---------------------------------------------\n \n-Because the URL patterns are regular expressions, there really is no limit on\n-what you can do with them. And there's no need to add URL cruft such as ``.php``\n--- unless you have a sick sense of humor, in which case you can do something\n-like this::\n-\n-    (r'^polls/latest\\.php$', 'polls.views.index'),\n-\n-But, don't do that. It's silly.\n+The term `regex` is a commonly used short form meaning `regular expression`,\n+which is a syntax for matching patterns in strings, or in this case, url\n+patterns. Django starts at the first regular expression and makes its way down\n+the list,  comparing the requested URL against each regular expression until it\n+finds one that matches.\n \n Note that these regular expressions do not search GET and POST parameters, or\n-the domain name. For example, in a request to ``http://www.example.com/myapp/``,\n-the URLconf will look for ``myapp/``. In a request to\n-``http://www.example.com/myapp/?page=3``, the URLconf will look for ``myapp/``.\n+the domain name. For example, in a request to\n+``http://www.example.com/myapp/``, the URLconf will look for ``myapp/``. In a\n+request to ``http://www.example.com/myapp/?page=3``, the URLconf will also\n+look for ``myapp/``.\n \n If you need help with regular expressions, see `Wikipedia's entry`_ and the\n documentation of the :mod:`re` module. Also, the O'Reilly book \"Mastering\n-Regular Expressions\" by Jeffrey Friedl is fantastic.\n+Regular Expressions\" by Jeffrey Friedl is fantastic. In practice, however,\n+you don't need to be an expert on regular expressions, as you really only need\n+to know how to capture simple patterns. In fact, complex regexes can have poor\n+lookup performance, so you probably shouldn't rely on the full power of regexes.\n \n Finally, a performance note: these regular expressions are compiled the first\n-time the URLconf module is loaded. They're super fast.\n+time the URLconf module is loaded. They're super fast (as long as the lookups\n+aren't too complex as noted above).\n \n .. _Wikipedia's entry: http://en.wikipedia.org/wiki/Regular_expression\n \n-Write your first view\n-=====================\n+:func:`~django.conf.urls.url` argument: view\n+--------------------------------------------\n \n-Well, we haven't created any views yet -- we just have the URLconf. But let's\n-make sure Django is following the URLconf properly.\n+When Django finds a regular expression match, Django calls the specified view\n+function, with an :class:`~django.http.HttpRequest` object as the first\n+argument and any ‚Äúcaptured‚Äù values from the regular expression as other\n+arguments. If the regex uses simple captures, values are passed as positional\n+arguments; if it uses named captures, values are passed as keyword arguments.\n+We'll give an example of this in a bit.\n \n-Fire up the Django development Web server:\n+:func:`~django.conf.urls.url` argument: kwargs\n+----------------------------------------------\n \n-.. code-block:: bash\n+Arbitrary keyword arguments can be passed in a dictionary to the target view. We\n+aren't going to use this feature of Django in the tutorial.\n \n-    python manage.py runserver\n+:func:`~django.conf.urls.url` argument: name\n+---------------------------------------------\n \n-Now go to \"http://localhost:8000/polls/\" on your domain in your Web browser.\n-You should get a pleasantly-colored error page with the following message::\n+Naming your URL lets you refer to it unambiguously from elsewhere in Django\n+especially templates. This powerful feature allows you to make  global changes\n+to the url patterns of your project while only touching a single file.\n \n-    ViewDoesNotExist at /polls/\n+Writing more views\n+==================\n \n-    Could not import polls.views.index. View does not exist in module polls.views.\n+Now let's add a few more views to ``polls/views.py``. These views are\n+slightly different, because they take an argument::\n \n-This error happened because you haven't written a function ``index()`` in the\n-module ``polls/views.py``.\n+    def detail(request, poll_id):\n+        return HttpResponse(\"You're looking at poll %s.\" % poll_id)\n \n-Try \"/polls/23/\", \"/polls/23/results/\" and \"/polls/23/vote/\". The error\n-messages tell you which view Django tried (and failed to find, because you\n-haven't written any views yet).\n+    def results(request, poll_id):\n+        return HttpResponse(\"You're looking at the results of poll %s.\" % poll_id)\n \n-Time to write the first view. Open the file ``polls/views.py``\n-and put the following Python code in it::\n+    def vote(request, poll_id):\n+        return HttpResponse(\"You're voting on poll %s.\" % poll_id)\n \n-    from django.http import HttpResponse\n+Wire these news views into the ``polls.urls`` module by adding the following\n+:func:`~django.conf.urls.url` calls::\n \n-    def index(request):\n-        return HttpResponse(\"Hello, world. You're at the poll index.\")\n+    from django.conf.urls import patterns, url\n \n-This is the simplest view possible. Go to \"/polls/\" in your browser, and you\n-should see your text.\n+    from polls import views\n \n-Now lets add a few more views. These views are slightly different, because\n-they take an argument (which, remember, is passed in from whatever was\n-captured by the regular expression in the URLconf)::\n+    urlpatterns = patterns('',\n+        # ex: /polls/\n+        url(r'^$', views.index, name='index'),\n+        # ex: /polls/5/\n+        url(r'^(?P<poll_id>\\d+)/$', views.detail, name='detail'),\n+        # ex: /polls/5/results/\n+        url(r'^(?P<poll_id>\\d+)/results/$', views.results, name='results'),\n+        # ex: /polls/5/vote/\n+        url(r'^(?P<poll_id>\\d+)/vote/$', views.vote, name='vote'),\n+    )\n \n-    def detail(request, poll_id):\n-        return HttpResponse(\"You're looking at poll %s.\" % poll_id)\n+Take a look in your browser, at \"/polls/34/\". It'll run the ``detail()``\n+method and display whatever ID you provide in the URL. Try\n+\"/polls/34/results/\" and \"/polls/34/vote/\" too -- these will display the\n+placeholder results and voting pages.\n+\n+When somebody requests a page from your Web site -- say, \"/polls/34/\", Django\n+will load the ``mysite.urls`` Python module because it's pointed to by the\n+:setting:`ROOT_URLCONF` setting. It finds the variable named ``urlpatterns``\n+and traverses the regular expressions in order. The\n+:func:`~django.conf.urls.include` functions we are using simply reference\n+other URLconfs. Note that the regular expressions for the\n+:func:`~django.conf.urls.include` functions don't have a ``$`` (end-of-string\n+match character) but rather a trailing slash. Whenever Django encounters\n+:func:`~django.conf.urls.include`, it chops off whatever part of the URL\n+matched up to that point and sends the remaining string to the included\n+URLconf for further processing.\n \n-    def results(request, poll_id):\n-        return HttpResponse(\"You're looking at the results of poll %s.\" % poll_id)\n+The idea behind :func:`~django.conf.urls.include` is to make it easy to\n+plug-and-play URLs. Since polls are in their own URLconf\n+(``polls/urls.py``), they can be placed under \"/polls/\", or under\n+\"/fun_polls/\", or under \"/content/polls/\", or any other path root, and the\n+app will still work.\n \n-    def vote(request, poll_id):\n-        return HttpResponse(\"You're voting on poll %s.\" % poll_id)\n+Here's what happens if a user goes to \"/polls/34/\" in this system:\n \n-Take a look in your browser, at \"/polls/34/\". It'll run the `detail()` method\n-and display whatever ID you provide in the URL. Try \"/polls/34/results/\" and\n-\"/polls/34/vote/\" too -- these will display the placeholder results and voting\n-pages.\n+* Django will find the match at ``'^polls/'``\n+\n+* Then, Django will strip off the matching text (``\"polls/\"``) and send the\n+  remaining text -- ``\"34/\"`` -- to the 'polls.urls' URLconf for\n+  further processing which matches ``r'^(?P<poll_id>\\d+)/$'`` resulting in a\n+  call to the ``detail()`` view like so::\n+\n+    detail(request=<HttpRequest object>, poll_id='34')\n+\n+The ``poll_id='34'`` part comes from ``(?P<poll_id>\\d+)``. Using parentheses\n+around a pattern \"captures\" the text matched by that pattern and sends it as an\n+argument to the view function; ``?P<poll_id>`` defines the name that will\n+be used to identify the matched pattern; and ``\\d+`` is a regular expression to\n+match a sequence of digits (i.e., a number).\n+\n+Because the URL patterns are regular expressions, there really is no limit on\n+what you can do with them. And there's no need to add URL cruft such as ``.php``\n+-- unless you have a sick sense of humor, in which case you can do something\n+like this::\n+\n+    (r'^polls/latest\\.php$', 'polls.views.index'),\n+\n+But, don't do that. It's silly.\n \n Write views that actually do something\n ======================================\n \n-Each view is responsible for doing one of two things: Returning an\n+Each view is responsible for doing one of two things: returning an\n :class:`~django.http.HttpResponse` object containing the content for the\n requested page, or raising an exception such as :exc:`~django.http.Http404`. The\n rest is up to you.\n@@ -205,51 +263,21 @@ in :doc:`Tutorial 1 </intro/tutorial01>`. Here's one stab at the ``index()``\n view, which displays the latest 5 poll questions in the system, separated by\n commas, according to publication date::\n \n-    from polls.models import Poll\n     from django.http import HttpResponse\n \n+    from polls.models import Poll\n+\n     def index(request):\n-        latest_poll_list = Poll.objects.all().order_by('-pub_date')[:5]\n+        latest_poll_list = Poll.objects.order_by('-pub_date')[:5]\n         output = ', '.join([p.question for p in latest_poll_list])\n         return HttpResponse(output)\n \n-There's a problem here, though: The page's design is hard-coded in the view. If\n+There's a problem here, though: the page's design is hard-coded in the view. If\n you want to change the way the page looks, you'll have to edit this Python code.\n-So let's use Django's template system to separate the design from Python::\n-\n-    from django.template import Context, loader\n-    from polls.models import Poll\n-    from django.http import HttpResponse\n-\n-    def index(request):\n-        latest_poll_list = Poll.objects.all().order_by('-pub_date')[:5]\n-        t = loader.get_template('polls/index.html')\n-        c = Context({\n-            'latest_poll_list': latest_poll_list,\n-        })\n-        return HttpResponse(t.render(c))\n-\n-That code loads the template called \"polls/index.html\" and passes it a context.\n-The context is a dictionary mapping template variable names to Python objects.\n-\n-Reload the page. Now you'll see an error::\n-\n-    TemplateDoesNotExist at /polls/\n-    polls/index.html\n-\n-Ah. There's no template yet. First, create a directory, somewhere on your\n-filesystem, whose contents Django can access. (Django runs as whatever user your\n-server runs.) Don't put them under your document root, though. You probably\n-shouldn't make them public, just for security's sake.\n-Then edit :setting:`TEMPLATE_DIRS` in your ``settings.py`` to tell Django where\n-it can find templates -- just as you did in the \"Customize the admin look and\n-feel\" section of Tutorial 2.\n-\n-When you've done that, create a directory ``polls`` in your template directory.\n-Within that, create a file called ``index.html``. Note that our\n-``loader.get_template('polls/index.html')`` code from above maps to\n-\"[template_directory]/polls/index.html\" on the filesystem.\n+So let's use Django's template system to separate the design from Python.\n \n+First, create a directory ``polls`` in your template directory you specified\n+in setting:`TEMPLATE_DIRS`. Within that, create a file called ``index.html``.\n Put the following code in that template:\n \n .. code-block:: html+django\n@@ -264,36 +292,58 @@ Put the following code in that template:\n         <p>No polls are available.</p>\n     {% endif %}\n \n+Now let's use that html template in our index view::\n+\n+    from django.http import HttpResponse\n+    from django.template import Context, loader\n+\n+    from polls.models import Poll\n+\n+    def index(request):\n+        latest_poll_list = Poll.objects.order_by('-pub_date')[:5]\n+        template = loader.get_template('polls/index.html')\n+        context = Context({\n+            'latest_poll_list': latest_poll_list,\n+        })\n+        return HttpResponse(template.render(context))\n+\n+That code loads the template called  ``polls/index.html`` and passes it a\n+context. The context is a dictionary mapping template variable names to Python\n+objects.\n+\n Load the page in your Web browser, and you should see a bulleted-list\n containing the \"What's up\" poll from Tutorial 1. The link points to the poll's\n detail page.\n \n-A shortcut: render_to_response()\n---------------------------------\n+A shortcut: :func:`~django.shortcuts.render`\n+--------------------------------------------\n \n It's a very common idiom to load a template, fill a context and return an\n :class:`~django.http.HttpResponse` object with the result of the rendered\n template. Django provides a shortcut. Here's the full ``index()`` view,\n rewritten::\n \n-    from django.shortcuts import render_to_response\n+    from django.shortcuts import render\n+\n     from polls.models import Poll\n \n     def index(request):\n         latest_poll_list = Poll.objects.all().order_by('-pub_date')[:5]\n-        return render_to_response('polls/index.html', {'latest_poll_list': latest_poll_list})\n+        context = {'latest_poll_list': latest_poll_list}\n+        return render(request, 'polls/index.html', context)\n \n Note that once we've done this in all these views, we no longer need to import\n :mod:`~django.template.loader`, :class:`~django.template.Context` and\n-:class:`~django.http.HttpResponse`.\n+:class:`~django.http.HttpResponse` (you'll want to keep ``HttpResponse`` if you\n+still have the stub methods for ``detail``, ``results``, and ``vote``).\n \n-The :func:`~django.shortcuts.render_to_response` function takes a template name\n-as its first argument and a dictionary as its optional second argument. It\n-returns an :class:`~django.http.HttpResponse` object of the given template\n-rendered with the given context.\n+The :func:`~django.shortcuts.render` function takes the request object as its\n+first argument, a template name as its second argument and a dictionary as its\n+optional third argument. It returns an :class:`~django.http.HttpResponse`\n+object of the given template rendered with the given context.\n \n-Raising 404\n-===========\n+Raising a 404 error\n+===================\n \n Now, let's tackle the poll detail view -- the page that displays the question\n for a given poll. Here's the view::\n@@ -302,10 +352,10 @@ for a given poll. Here's the view::\n     # ...\n     def detail(request, poll_id):\n         try:\n-            p = Poll.objects.get(pk=poll_id)\n+            poll = Poll.objects.get(pk=poll_id)\n         except Poll.DoesNotExist:\n             raise Http404\n-        return render_to_response('polls/detail.html', {'poll': p})\n+        return render(request, 'polls/detail.html', {'poll': poll})\n \n The new concept here: The view raises the :exc:`~django.http.Http404` exception\n if a poll with the requested ID doesn't exist.\n@@ -317,18 +367,18 @@ later, but if you'd like to quickly get the above example working, just::\n \n will get you started for now.\n \n-A shortcut: get_object_or_404()\n--------------------------------\n+A shortcut: :func:`~django.shortcuts.get_object_or_404`\n+-------------------------------------------------------\n \n It's a very common idiom to use :meth:`~django.db.models.query.QuerySet.get`\n and raise :exc:`~django.http.Http404` if the object doesn't exist. Django\n provides a shortcut. Here's the ``detail()`` view, rewritten::\n \n-    from django.shortcuts import render_to_response, get_object_or_404\n+    from django.shortcuts import render, get_object_or_404\n     # ...\n     def detail(request, poll_id):\n-        p = get_object_or_404(Poll, pk=poll_id)\n-        return render_to_response('polls/detail.html', {'poll': p})\n+        poll = get_object_or_404(Poll, pk=poll_id)\n+        return render(request, 'polls/detail.html', {'poll': poll})\n \n The :func:`~django.shortcuts.get_object_or_404` function takes a Django model\n as its first argument and an arbitrary number of keyword arguments, which it\n@@ -345,7 +395,8 @@ exist.\n     :exc:`~django.core.exceptions.ObjectDoesNotExist`?\n \n     Because that would couple the model layer to the view layer. One of the\n-    foremost design goals of Django is to maintain loose coupling.\n+    foremost design goals of Django is to maintain loose coupling. Some\n+    controlled coupling is introduced in the :mod:`django.shortcuts` module.\n \n There's also a :func:`~django.shortcuts.get_list_or_404` function, which works\n just as :func:`~django.shortcuts.get_object_or_404` -- except using\n@@ -366,11 +417,11 @@ special: It's just a normal view.\n \n You normally won't have to bother with writing 404 views. If you don't set\n ``handler404``, the built-in view :func:`django.views.defaults.page_not_found`\n-is used by default. In this case, you still have one obligation: create a\n-``404.html`` template in the root of your template directory. The default 404\n-view will use that template for all 404 errors. If :setting:`DEBUG` is set to\n-``False`` (in your settings module) and if you didn't create a ``404.html``\n-file, an ``Http500`` is raised instead. So remember to create a ``404.html``.\n+is used by default. Optionally, you can create a ``404.html`` template\n+in the root of your template directory. The default 404 view will then use that\n+template for all 404 errors when :setting:`DEBUG` is set to ``False`` (in your\n+settings module). If you do create the template, add at least some dummy\n+content like \"Page not found\".\n \n A couple more things to note about 404 views:\n \n@@ -388,11 +439,14 @@ Similarly, your root URLconf may define a ``handler500``, which points\n to a view to call in case of server errors. Server errors happen when\n you have runtime errors in view code.\n \n+Likewise, you should create a ``500.html`` template at the root of your\n+template directory and add some content like \"Something went wrong\".\n+\n Use the template system\n =======================\n \n Back to the ``detail()`` view for our poll application. Given the context\n-variable ``poll``, here's what the \"polls/detail.html\" template might look\n+variable ``poll``, here's what the ``polls/detail.html`` template might look\n like:\n \n .. code-block:: html+django\n@@ -417,150 +471,89 @@ suitable for use in the :ttag:`{% for %}<for>` tag.\n \n See the :doc:`template guide </topics/templates>` for more about templates.\n \n-Simplifying the URLconfs\n-========================\n+Removing hardcoded URLs in templates\n+====================================\n \n-Take some time to play around with the views and template system. As you edit\n-the URLconf, you may notice there's a fair bit of redundancy in it::\n+Remember, when we wrote the link to a poll in the ``polls/index.html``\n+template, the link was partially hardcoded like this:\n \n-    urlpatterns = patterns('',\n-        url(r'^polls/$', 'polls.views.index'),\n-        url(r'^polls/(?P<poll_id>\\d+)/$', 'polls.views.detail'),\n-        url(r'^polls/(?P<poll_id>\\d+)/results/$', 'polls.views.results'),\n-        url(r'^polls/(?P<poll_id>\\d+)/vote/$', 'polls.views.vote'),\n-    )\n+.. code-block:: html+django\n \n-Namely, ``polls.views`` is in every callback.\n+    <li><a href=\"/polls/{{ poll.id }}/\">{{ poll.question }}</a></li>\n \n-Because this is a common case, the URLconf framework provides a shortcut for\n-common prefixes. You can factor out the common prefixes and add them as the\n-first argument to :func:`~django.conf.urls.patterns`, like so::\n+The problem with this hardcoded, tightly-coupled approach is that it becomes\n+challenging to change URLs on projects with a lot of templates. However, since\n+you defined the name argument in the :func:`~django.conf.urls.url` functions in\n+the ``polls.urls`` module, you can remove a reliance on specific URL paths\n+defined in your url configurations by using the ``{% url %}`` template tag:\n \n-    urlpatterns = patterns('polls.views',\n-        url(r'^polls/$', 'index'),\n-        url(r'^polls/(?P<poll_id>\\d+)/$', 'detail'),\n-        url(r'^polls/(?P<poll_id>\\d+)/results/$', 'results'),\n-        url(r'^polls/(?P<poll_id>\\d+)/vote/$', 'vote'),\n-    )\n+.. code-block:: html+django\n \n-This is functionally identical to the previous formatting. It's just a bit\n-tidier.\n+    <li><a href=\"{% url 'detail' poll.id %}\">{{ poll.question }}</a></li>\n \n-Since you generally don't want the prefix for one app to be applied to every\n-callback in your URLconf, you can concatenate multiple\n-:func:`~django.conf.urls.patterns`. Your full ``mysite/urls.py`` might\n-now look like this::\n+.. note::\n \n-    from django.conf.urls import patterns, include, url\n+    If ``{% url 'detail' poll.id %}`` (with quotes) doesn't work, but\n+    ``{% url detail poll.id %}`` (without quotes) does, that means you're\n+    using a version of Django < 1.5. In this case, add the following\n+    declaration at the top of your template:\n \n-    from django.contrib import admin\n-    admin.autodiscover()\n+    .. code-block:: html+django\n \n-    urlpatterns = patterns('polls.views',\n-        url(r'^polls/$', 'index'),\n-        url(r'^polls/(?P<poll_id>\\d+)/$', 'detail'),\n-        url(r'^polls/(?P<poll_id>\\d+)/results/$', 'results'),\n-        url(r'^polls/(?P<poll_id>\\d+)/vote/$', 'vote'),\n-    )\n+        {% load url from future %}\n \n-    urlpatterns += patterns('',\n-        url(r'^admin/', include(admin.site.urls)),\n-    )\n+The way this works is by looking up the URL definition as specified in the\n+``polls.urls`` module. You can see exactly where the URL name of 'detail' is\n+defined below::\n \n-Decoupling the URLconfs\n-=======================\n+    ...\n+    # the 'name' value as called by the {% url %} template tag\n+    url(r'^(?P<poll_id>\\d+)/$', views.detail, name='detail'),\n+    ...\n \n-While we're at it, we should take the time to decouple our poll-app URLs from\n-our Django project configuration. Django apps are meant to be pluggable -- that\n-is, each particular app should be transferable to another Django installation\n-with minimal fuss.\n+If you want to change the URL of the polls detail view to something else,\n+perhaps to something like ``polls/specifics/12/`` instead of doing it in the\n+template (or templates) you would change it in ``polls/urls.py``::\n \n-Our poll app is pretty decoupled at this point, thanks to the strict directory\n-structure that ``python manage.py startapp`` created, but one part of it is\n-coupled to the Django settings: The URLconf.\n+    ...\n+    # added the word 'specifics'\n+    url(r'^specifics/(?P<poll_id>\\d+)/$', views.detail, name='detail'),\n+    ...\n \n-We've been editing the URLs in ``mysite/urls.py``, but the URL design of an\n-app is specific to the app, not to the Django installation -- so let's move the\n-URLs within the app directory.\n+Namespacing URL names\n+======================\n \n-Copy the file ``mysite/urls.py`` to ``polls/urls.py``. Then, change\n-``mysite/urls.py`` to remove the poll-specific URLs and insert an\n-:func:`~django.conf.urls.include`, leaving you with::\n+The tutorial project has just one app, ``polls``. In real Django projects,\n+there might be five, ten, twenty apps or more. How does Django differentiate\n+the URL names between them? For example, the ``polls`` app has a ``detail``\n+view, and so might an app on the same project that is for a blog. How does one\n+make it so that Django knows which app view to create for a url when using the\n+``{% url %}`` template tag?\n+\n+The answer is to add namespaces to your root URLconf. In the\n+``mysite/urls.py`` file, go ahead and change it to include namespacing::\n \n     from django.conf.urls import patterns, include, url\n \n     from django.contrib import admin\n     admin.autodiscover()\n \n     urlpatterns = patterns('',\n-        url(r'^polls/', include('polls.urls')),\n+        url(r'^polls/', include('polls.urls', namespace=\"polls\")),\n         url(r'^admin/', include(admin.site.urls)),\n     )\n \n-:func:`~django.conf.urls.include` simply references another URLconf.\n-Note that the regular expression doesn't have a ``$`` (end-of-string match\n-character) but has the trailing slash. Whenever Django encounters\n-:func:`~django.conf.urls.include`, it chops off whatever part of the\n-URL matched up to that point and sends the remaining string to the included\n-URLconf for further processing.\n-\n-Here's what happens if a user goes to \"/polls/34/\" in this system:\n-\n-* Django will find the match at ``'^polls/'``\n-\n-* Then, Django will strip off the matching text (``\"polls/\"``) and send the\n-  remaining text -- ``\"34/\"`` -- to the 'polls.urls' URLconf for\n-  further processing.\n-\n-Now that we've decoupled that, we need to decouple the ``polls.urls``\n-URLconf by removing the leading \"polls/\" from each line, removing the\n-lines registering the admin site, and removing the ``include`` import which\n-is no longer used. Your ``polls/urls.py`` file should now look like\n-this::\n-\n-    from django.conf.urls import patterns, url\n-\n-    urlpatterns = patterns('polls.views',\n-        url(r'^$', 'index'),\n-        url(r'^(?P<poll_id>\\d+)/$', 'detail'),\n-        url(r'^(?P<poll_id>\\d+)/results/$', 'results'),\n-        url(r'^(?P<poll_id>\\d+)/vote/$', 'vote'),\n-    )\n-\n-The idea behind :func:`~django.conf.urls.include` and URLconf\n-decoupling is to make it easy to plug-and-play URLs. Now that polls are in their\n-own URLconf, they can be placed under \"/polls/\", or under \"/fun_polls/\", or\n-under \"/content/polls/\", or any other path root, and the app will still work.\n-\n-All the poll app cares about is its relative path, not its absolute path.\n-\n-Removing hardcoded URLs in templates\n-------------------------------------\n-\n-Remember, when we wrote the link to a poll in our template, the link was\n-partially hardcoded like this:\n+Now change your ``polls/index.html`` template from:\n \n .. code-block:: html+django\n \n-    <li><a href=\"/polls/{{ poll.id }}/\">{{ poll.question }}</a></li>\n+    <li><a href=\"{% url 'detail' poll.id %}\">{{ poll.question }}</a></li>\n \n-To use the decoupled URLs we've just introduced, replace the hardcoded link\n-with the :ttag:`url` template tag:\n+to point at the namespaced detail view:\n \n .. code-block:: html+django\n \n-    <li><a href=\"{% url 'polls.views.detail' poll.id %}\">{{ poll.question }}</a></li>\n-\n-.. note::\n-\n-    If ``{% url 'polls.views.detail' poll.id %}`` (with quotes) doesn't work,\n-    but ``{% url polls.views.detail poll.id %}`` (without quotes) does, that\n-    means you're using a version of Django ‚â§ 1.4. In this case, add the\n-    following declaration at the top of your template:\n-\n-    .. code-block:: html+django\n-\n-        {% load url from future %}\n+    <li><a href=\"{% url 'polls:detail' poll.id %}\">{{ poll.question }}</a></li>\n \n When you're comfortable with writing views, read :doc:`part 4 of this tutorial\n </intro/tutorial04>` to learn about simple form processing and generic views."
        },
        {
            "sha": "8909caf98bf6a68902358a1c9d59430535603473",
            "filename": "docs/intro/tutorial04.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 87,
            "changes": 108,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Ftutorial04.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Ftutorial04.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial04.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -18,7 +18,7 @@ tutorial, so that the template contains an HTML ``<form>`` element:\n \n     {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}\n \n-    <form action=\"{% url 'polls.views.vote' poll.id %}\" method=\"post\">\n+    <form action=\"{% url 'polls:vote' poll.id %}\" method=\"post\">\n     {% csrf_token %}\n     {% for choice in poll.choice_set.all %}\n         <input type=\"radio\" name=\"choice\" id=\"choice{{ forloop.counter }}\" value=\"{{ choice.id }}\" />\n@@ -35,7 +35,7 @@ A quick rundown:\n   selects one of the radio buttons and submits the form, it'll send the\n   POST data ``choice=3``. This is HTML Forms 101.\n \n-* We set the form's ``action`` to ``{% url 'polls.views.vote' poll.id %}``, and we\n+* We set the form's ``action`` to ``{% url 'polls:vote' poll.id %}``, and we\n   set ``method=\"post\"``. Using ``method=\"post\"`` (as opposed to\n   ``method=\"get\"``) is very important, because the act of submitting this\n   form will alter data server-side. Whenever you create a form that alters\n@@ -52,34 +52,18 @@ A quick rundown:\n   forms that are targeted at internal URLs should use the\n   :ttag:`{% csrf_token %}<csrf_token>` template tag.\n \n-The :ttag:`{% csrf_token %}<csrf_token>` tag requires information from the\n-request object, which is not normally accessible from within the template\n-context. To fix this, a small adjustment needs to be made to the ``detail``\n-view, so that it looks like the following::\n-\n-    from django.template import RequestContext\n-    # ...\n-    def detail(request, poll_id):\n-        p = get_object_or_404(Poll, pk=poll_id)\n-        return render_to_response('polls/detail.html', {'poll': p},\n-                                   context_instance=RequestContext(request))\n-\n-The details of how this works are explained in the documentation for\n-:ref:`RequestContext <subclassing-context-requestcontext>`.\n-\n Now, let's create a Django view that handles the submitted data and does\n something with it. Remember, in :doc:`Tutorial 3 </intro/tutorial03>`, we\n created a URLconf for the polls application that includes this line::\n \n-    (r'^(?P<poll_id>\\d+)/vote/$', 'vote'),\n+    url(r'^(?P<poll_id>\\d+)/vote/$', views.vote, name='vote'),\n \n We also created a dummy implementation of the ``vote()`` function. Let's\n create a real version. Add the following to ``polls/views.py``::\n \n-    from django.shortcuts import get_object_or_404, render_to_response\n+    from django.shortcuts import get_object_or_404, render\n     from django.http import HttpResponseRedirect, HttpResponse\n     from django.core.urlresolvers import reverse\n-    from django.template import RequestContext\n     from polls.models import Choice, Poll\n     # ...\n     def vote(request, poll_id):\n@@ -88,17 +72,17 @@ create a real version. Add the following to ``polls/views.py``::\n             selected_choice = p.choice_set.get(pk=request.POST['choice'])\n         except (KeyError, Choice.DoesNotExist):\n             # Redisplay the poll voting form.\n-            return render_to_response('polls/detail.html', {\n+            return render(request, 'polls/detail.html', {\n                 'poll': p,\n                 'error_message': \"You didn't select a choice.\",\n-            }, context_instance=RequestContext(request))\n+            })\n         else:\n             selected_choice.votes += 1\n             selected_choice.save()\n             # Always return an HttpResponseRedirect after successfully dealing\n             # with POST data. This prevents data from being posted twice if a\n             # user hits the Back button.\n-            return HttpResponseRedirect(reverse('polls.views.results', args=(p.id,)))\n+            return HttpResponseRedirect(reverse('polls:results', args=(p.id,)))\n \n This code includes a few things we haven't covered yet in this tutorial:\n \n@@ -142,8 +126,7 @@ This code includes a few things we haven't covered yet in this tutorial:\n     '/polls/3/results/'\n \n   ... where the ``3`` is the value of ``p.id``. This redirected URL will\n-  then call the ``'results'`` view to display the final page. Note that you\n-  need to use the full name of the view here (including the prefix).\n+  then call the ``'results'`` view to display the final page.\n \n As mentioned in Tutorial 3, ``request`` is a :class:`~django.http.HttpRequest`\n object. For more on :class:`~django.http.HttpRequest` objects, see the\n@@ -153,14 +136,14 @@ After somebody votes in a poll, the ``vote()`` view redirects to the results\n page for the poll. Let's write that view::\n \n     def results(request, poll_id):\n-        p = get_object_or_404(Poll, pk=poll_id)\n-        return render_to_response('polls/results.html', {'poll': p})\n+        poll = get_object_or_404(Poll, pk=poll_id)\n+        return render(request, 'polls/results.html', {'poll': poll})\n \n This is almost exactly the same as the ``detail()`` view from :doc:`Tutorial 3\n </intro/tutorial03>`. The only difference is the template name. We'll fix this\n redundancy later.\n \n-Now, create a ``results.html`` template:\n+Now, create a ``polls/results.html`` template:\n \n .. code-block:: html+django\n \n@@ -172,7 +155,7 @@ Now, create a ``results.html`` template:\n     {% endfor %}\n     </ul>\n \n-    <a href=\"{% url 'polls.views.detail' poll.id %}\">Vote again?</a>\n+    <a href=\"{% url 'polls:detail' poll.id %}\">Vote again?</a>\n \n Now, go to ``/polls/1/`` in your browser and vote in the poll. You should see a\n results page that gets updated each time you vote. If you submit the form\n@@ -215,19 +198,7 @@ Read on for details.\n \n     You should know basic math before you start using a calculator.\n \n-First, open the ``polls/urls.py`` URLconf. It looks like this, according to the\n-tutorial so far::\n-\n-    from django.conf.urls import patterns, url\n-\n-    urlpatterns = patterns('polls.views',\n-        url(r'^$', 'index'),\n-        url(r'^(?P<poll_id>\\d+)/$', 'detail'),\n-        url(r'^(?P<poll_id>\\d+)/results/$', 'results'),\n-        url(r'^(?P<poll_id>\\d+)/vote/$', 'vote'),\n-    )\n-\n-Change it like so::\n+First, open the ``polls/urls.py`` URLconf and change it like so::\n \n     from django.conf.urls import patterns, url\n     from django.views.generic import DetailView, ListView\n@@ -239,18 +210,18 @@ Change it like so::\n                 queryset=Poll.objects.order_by('-pub_date')[:5],\n                 context_object_name='latest_poll_list',\n                 template_name='polls/index.html'),\n-            name='poll_index'),\n+            name='index'),\n         url(r'^(?P<pk>\\d+)/$',\n             DetailView.as_view(\n                 model=Poll,\n                 template_name='polls/detail.html'),\n-            name='poll_detail'),\n+            name='detail'),\n         url(r'^(?P<pk>\\d+)/results/$',\n             DetailView.as_view(\n                 model=Poll,\n                 template_name='polls/results.html'),\n-            name='poll_results'),\n-        url(r'^(?P<poll_id>\\d+)/vote/$', 'polls.views.vote'),\n+            name='results'),\n+        url(r'^(?P<poll_id>\\d+)/vote/$', 'polls.views.vote', name='vote'),\n     )\n \n We're using two generic views here:\n@@ -267,15 +238,6 @@ two views abstract the concepts of \"display a list of objects\" and\n   ``\"pk\"``, so we've changed ``poll_id`` to ``pk`` for the generic\n   views.\n \n-* We've added the ``name`` argument to the views (e.g. ``name='poll_results'``)\n-  so that we have a way to refer to their URL later on (see the\n-  documentation about :ref:`naming URL patterns\n-  <naming-url-patterns>` for information). We're also using the\n-  :func:`~django.conf.urls.url` function from\n-  :mod:`django.conf.urls` here. It's a good habit to use\n-  :func:`~django.conf.urls.url` when you are providing a\n-  pattern name like this.\n-\n By default, the :class:`~django.views.generic.list.DetailView` generic\n view uses a template called ``<app name>/<model name>_detail.html``.\n In our case, it'll use the template ``\"polls/poll_detail.html\"``. The\n@@ -308,41 +270,13 @@ You can now delete the ``index()``, ``detail()`` and ``results()``\n views from ``polls/views.py``. We don't need them anymore -- they have\n been replaced by generic views.\n \n-The last thing to do is fix the URL handling to account for the use of\n-generic views. In the vote view above, we used the\n-:func:`~django.core.urlresolvers.reverse` function to avoid\n-hard-coding our URLs. Now that we've switched to a generic view, we'll\n-need to change the :func:`~django.core.urlresolvers.reverse` call to\n-point back to our new generic view. We can't simply use the view\n-function anymore -- generic views can be (and are) used multiple times\n--- but we can use the name we've given::\n-\n-    return HttpResponseRedirect(reverse('poll_results', args=(p.id,)))\n-\n-The same rule apply for the :ttag:`url` template tag. For example in the\n-``results.html`` template:\n-\n-.. code-block:: html+django\n-\n-    <a href=\"{% url 'poll_detail' poll.id %}\">Vote again?</a>\n-\n Run the server, and use your new polling app based on generic views.\n \n For full details on generic views, see the :doc:`generic views documentation\n </topics/class-based-views/index>`.\n \n-Coming soon\n-===========\n-\n-The tutorial ends here for the time being. Future installments of the tutorial\n-will cover:\n-\n-* Advanced form processing\n-* Using the RSS framework\n-* Using the cache framework\n-* Using the comments framework\n-* Advanced admin features: Permissions\n-* Advanced admin features: Custom JavaScript\n+What's next?\n+============\n \n-In the meantime, you might want to check out some pointers on :doc:`where to go\n-from here </intro/whatsnext>`\n+The tutorial ends here for the time being. In the meantime, you might want to\n+check out some pointers on :doc:`where to go from here </intro/whatsnext>`."
        },
        {
            "sha": "500a858d47cb08fd5dea400c66b3dd0ba6f2333b",
            "filename": "docs/intro/whatsnext.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Fwhatsnext.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fintro%2Fwhatsnext.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Fwhatsnext.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -216,15 +216,13 @@ We follow this policy:\n   \"New in version X.Y\", being X.Y the next release version (hence, the one\n   being developed).\n \n-* Documentation for a particular Django release is frozen once the version\n-  has been released officially. It remains a snapshot of the docs as of the\n-  moment of the release. We will make exceptions to this rule in\n-  the case of retroactive security updates or other such retroactive\n-  changes. Once documentation is frozen, we add a note to the top of each\n-  frozen document that says \"These docs are frozen for Django version XXX\"\n-  and links to the current version of that document.\n+* Documentation fixes and improvements may be backported to the last release\n+  branch, at the discretion of the committer, however, once a version of\n+  Django is :ref:`no longer supported<backwards-compatibility-policy>`, that\n+  version of the docs won't get any further updates.\n \n * The `main documentation Web page`_ includes links to documentation for\n-  all previous versions.\n+  all previous versions. Be sure you are using the version of the docs\n+  corresponding to the version of Django you are using!\n \n .. _main documentation Web page: https://docs.djangoproject.com/en/dev/"
        },
        {
            "sha": "4f232e795bd678d09664cfe447e87495b8a6133f",
            "filename": "docs/misc/api-stability.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fmisc%2Fapi-stability.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fmisc%2Fapi-stability.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fmisc%2Fapi-stability.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -155,8 +155,6 @@ Certain APIs are explicitly marked as \"internal\" in a couple of ways:\n Local flavors\n -------------\n \n-.. versionchanged:: 1.3\n-\n :mod:`django.contrib.localflavor` contains assorted pieces of code\n that are useful for particular countries or cultures. This data is\n local in nature, and is subject to change on timelines that will"
        },
        {
            "sha": "1b324234d1536ff8306e6d942e392d44841bc3b3",
            "filename": "docs/misc/distributions.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fmisc%2Fdistributions.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fmisc%2Fdistributions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fmisc%2Fdistributions.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -11,7 +11,7 @@ requires.\n Typically, these packages are based on the latest stable release of Django, so\n if you want to use the development version of Django you'll need to follow the\n instructions for :ref:`installing the development version\n-<installing-development-version>` from our Subversion repository.\n+<installing-development-version>` from our Git repository.\n \n If you're using Linux or a Unix installation, such as OpenSolaris,\n check with your distributor to see if they already package Django. If"
        },
        {
            "sha": "c6af23e421bae3cf32a3f0de0a6f47c74f909092",
            "filename": "docs/ref/class-based-views/generic-date-based.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-date-based.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -87,16 +87,24 @@ YearArchiveView\n     * ``year``: A :class:`~datetime.date` object\n       representing the given year.\n \n+      .. versionchanged:: 1.5\n+\n+      Previously, this returned a string.\n+\n     * ``next_year``: A :class:`~datetime.date` object\n       representing the first day of the next year, according to\n       :attr:`~BaseDateListView.allow_empty` and\n       :attr:`~DateMixin.allow_future`.\n \n+      .. versionadded:: 1.5\n+\n     * ``previous_year``: A :class:`~datetime.date` object\n       representing the first day of the previous year, according to\n       :attr:`~BaseDateListView.allow_empty` and\n       :attr:`~DateMixin.allow_future`.\n \n+      .. versionadded:: 1.5\n+\n     **Notes**\n \n     * Uses a default ``template_name_suffix`` of ``_archive_year``."
        },
        {
            "sha": "561e525e704927889eb61afd56c507d5dba0c6e0",
            "filename": "docs/ref/class-based-views/mixins-date-based.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-date-based.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -318,12 +318,16 @@ BaseDateListView\n         Returns the aggregation period for ``date_list``. Returns\n         :attr:`~BaseDateListView.date_list_period` by default.\n \n-    .. method:: get_date_list(queryset, date_type=None)\n+    .. method:: get_date_list(queryset, date_type=None, ordering='ASC')\n \n         Returns the list of dates of type ``date_type`` for which ``queryset``\n         contains entries. For example, ``get_date_list(qs, 'year')`` will\n         return the list of years for which ``qs`` has entries. If\n         ``date_type`` isn't provided, the result of\n-        :meth:`BaseDateListView.get_date_list_period` is used. See\n-        :meth:`~django.db.models.query.QuerySet.dates()` for the ways that the\n-        ``date_type`` argument can be used.\n+        :meth:`~BaseDateListView.get_date_list_period` is used. ``date_type``\n+        and ``ordering`` are simply passed to\n+        :meth:`QuerySet.dates()<django.db.models.query.QuerySet.dates>`.\n+\n+        .. versionchanged:: 1.5\n+            The ``ordering`` parameter was added, and the default order was\n+            changed to ascending."
        },
        {
            "sha": "0774c40469146f085020e8e6df4dda27cc2309af",
            "filename": "docs/ref/contrib/admin/_images/raw_id_fields.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Fraw_id_fields.png",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Fraw_id_fields.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Fraw_id_fields.png?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "6ed929cb7d2818577dbc0fe6e60c47649779b3c1",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 59,
            "deletions": 23,
            "changes": 82,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -60,6 +60,8 @@ Other topics\n     For information about serving the static files (images, JavaScript, and\n     CSS) associated with the admin in production, see :ref:`serving-files`.\n \n+    Having problems?  Try :doc:`/faq/admin`.\n+\n ``ModelAdmin`` objects\n ======================\n \n@@ -129,8 +131,6 @@ subclass::\n \n         date_hierarchy = 'pub_date'\n \n-    .. versionadded:: 1.3\n-\n     This will intelligently populate itself based on available data,\n     e.g. if all the dates are in one month, it'll show the day-level\n     drill-down only.\n@@ -307,7 +307,9 @@ subclass::\n     By default a ``ModelForm`` is dynamically created for your model. It is\n     used to create the form presented on both the add/change pages. You can\n     easily provide your own ``ModelForm`` to override any default form behavior\n-    on the add/change pages.\n+    on the add/change pages. Alternatively, you can customize the default\n+    form rather than specifying an entirely new one by using the\n+    :meth:`ModelAdmin.get_form` method.\n \n     For an example see the section `Adding custom validation to the admin`_.\n \n@@ -373,7 +375,8 @@ subclass::\n \n .. attribute:: ModelAdmin.inlines\n \n-    See :class:`InlineModelAdmin` objects below.\n+    See :class:`InlineModelAdmin` objects below as well as\n+    :meth:`ModelAdmin.get_formsets`.\n \n .. attribute:: ModelAdmin.list_display\n \n@@ -576,8 +579,6 @@ subclass::\n           class PersonAdmin(ModelAdmin):\n               list_filter = ('is_staff', 'company')\n \n-      .. versionadded:: 1.3\n-\n       Field names in ``list_filter`` can also span relations\n       using the ``__`` lookup, for example::\n \n@@ -748,8 +749,6 @@ subclass::\n \n .. attribute:: ModelAdmin.paginator\n \n-    .. versionadded:: 1.3\n-\n     The paginator class to be used for pagination. By default,\n     :class:`django.core.paginator.Paginator` is used. If the custom paginator\n     class doesn't have the same constructor interface as\n@@ -804,6 +803,14 @@ subclass::\n         class ArticleAdmin(admin.ModelAdmin):\n             raw_id_fields = (\"newspaper\",)\n \n+    The ``raw_id_fields`` ``Input`` widget should contain a primary key if the\n+    field is a ``ForeignKey`` or a comma separated list of values if the field\n+    is a ``ManyToManyField``.  The ``raw_id_fields`` widget shows a magnifying\n+    glass button next to the field which allows users to search for and select\n+    a value:\n+\n+    .. image:: _images/raw_id_fields.png\n+\n .. attribute:: ModelAdmin.readonly_fields\n \n     By default the admin shows all fields as editable. Any fields in this\n@@ -966,8 +973,6 @@ templates used by the :class:`ModelAdmin` views:\n \n .. method:: ModelAdmin.delete_model(self, request, obj)\n \n-    .. versionadded:: 1.3\n-\n     The ``delete_model`` method is given the ``HttpRequest`` and a model\n     instance. Use this method to do pre- or post-delete operations.\n \n@@ -1049,6 +1054,16 @@ templates used by the :class:`ModelAdmin` views:\n     changelist that will be linked to the change view, as described in the\n     :attr:`ModelAdmin.list_display_links` section.\n \n+.. method:: ModelAdmin.get_inline_instances(self, request, obj=None)\n+\n+    .. versionadded:: 1.5\n+\n+    The ``get_inline_instances`` method is given the ``HttpRequest`` and the\n+    ``obj`` being edited (or ``None`` on an add form) and is expected to return\n+    a ``list`` or ``tuple`` of :class:`~django.contrib.admin.InlineModelAdmin`\n+    objects, as described below in the :class:`~django.contrib.admin.InlineModelAdmin`\n+    section.\n+\n .. method:: ModelAdmin.get_urls(self)\n \n     The ``get_urls`` method on a ``ModelAdmin`` returns the URLs to be used for\n@@ -1115,6 +1130,38 @@ templates used by the :class:`ModelAdmin` views:\n \n         (r'^my_view/$', self.admin_site.admin_view(self.my_view, cacheable=True))\n \n+.. method:: ModelAdmin.get_form(self, request, obj=None, **kwargs)\n+\n+    Returns a :class:`~django.forms.ModelForm` class for use in the admin add\n+    and change views, see :meth:`add_view` and :meth:`change_view`.\n+\n+    If you wanted to hide a field from non-superusers, for example, you could\n+    override ``get_form`` as follows::\n+\n+        class MyModelAdmin(admin.ModelAdmin):\n+            def get_form(self, request, obj=None, **kwargs):\n+                self.exclude = []\n+                if not request.user.is_superuser:\n+                    self.exclude.append('field_to_hide')\n+                return super(MyModelAdmin, self).get_form(request, obj, **kwargs)\n+\n+.. method:: ModelAdmin.get_formsets(self, request, obj=None)\n+\n+    Yields :class:`InlineModelAdmin`\\s for use in admin add and change views.\n+\n+    For example if you wanted to display a particular inline only in the change\n+    view, you could override ``get_formsets`` as follows::\n+\n+        class MyModelAdmin(admin.ModelAdmin):\n+            inlines = [MyInline, SomeOtherInline]\n+\n+            def get_formsets(self, request, obj=None):\n+                for inline in self.get_inline_instances(request, obj):\n+                    # hide MyInline in the add view\n+                    if isinstance(inline, MyInline) and obj is None:\n+                        continue\n+                    yield inline.get_formset(request, obj)\n+\n .. method:: ModelAdmin.formfield_for_foreignkey(self, db_field, request, **kwargs)\n \n     The ``formfield_for_foreignkey`` method on a ``ModelAdmin`` allows you to\n@@ -1213,8 +1260,6 @@ templates used by the :class:`ModelAdmin` views:\n \n .. method:: ModelAdmin.get_paginator(queryset, per_page, orphans=0, allow_empty_first_page=True)\n \n-    .. versionadded:: 1.3\n-\n     Returns an instance of the paginator to use for this view. By default,\n     instantiates an instance of :attr:`paginator`.\n \n@@ -1295,8 +1340,6 @@ on your ``ModelAdmin``::\n             }\n             js = (\"my_code.js\",)\n \n-.. versionchanged:: 1.3\n-\n The :doc:`staticfiles app </ref/contrib/staticfiles>` prepends\n :setting:`STATIC_URL` (or :setting:`MEDIA_URL` if :setting:`STATIC_URL` is\n ``None``) to any media paths. The same rules apply as :ref:`regular media\n@@ -1394,18 +1437,15 @@ adds some of its own (the shared features are actually defined in the\n - :attr:`~ModelAdmin.exclude`\n - :attr:`~ModelAdmin.filter_horizontal`\n - :attr:`~ModelAdmin.filter_vertical`\n+- :attr:`~ModelAdmin.ordering`\n - :attr:`~ModelAdmin.prepopulated_fields`\n+- :meth:`~ModelAdmin.queryset`\n - :attr:`~ModelAdmin.radio_fields`\n - :attr:`~ModelAdmin.readonly_fields`\n - :attr:`~InlineModelAdmin.raw_id_fields`\n - :meth:`~ModelAdmin.formfield_for_foreignkey`\n - :meth:`~ModelAdmin.formfield_for_manytomany`\n \n-.. versionadded:: 1.3\n-\n-- :attr:`~ModelAdmin.ordering`\n-- :meth:`~ModelAdmin.queryset`\n-\n .. versionadded:: 1.4\n \n - :meth:`~ModelAdmin.has_add_permission`\n@@ -1436,8 +1476,6 @@ The ``InlineModelAdmin`` class adds:\n     through to ``inlineformset_factory`` when creating the formset for this\n     inline.\n \n-    .. _ref-contrib-admin-inline-extra:\n-\n .. attribute:: InlineModelAdmin.extra\n \n     This controls the number of extra forms the formset will display in\n@@ -1813,8 +1851,6 @@ Templates can override or extend base admin templates as described in\n \n .. attribute:: AdminSite.login_form\n \n-    .. versionadded:: 1.3\n-\n     Subclass of :class:`~django.contrib.auth.forms.AuthenticationForm` that\n     will be used by the admin site login view.\n "
        },
        {
            "sha": "2bff778c2fea7e09b1005e9a4e08cf43c7e9bb0a",
            "filename": "docs/ref/contrib/comments/example.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Fexample.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Fexample.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Fexample.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -152,27 +152,6 @@ enable it in your project's ``urls.py``:\n \n Now you should have the latest comment feeds being served off ``/feeds/latest/``.\n \n-.. versionchanged:: 1.3\n-\n-Prior to Django 1.3, the LatestCommentFeed was deployed using the\n-syndication feed view:\n-\n-.. code-block:: python\n-\n-    from django.conf.urls import patterns\n-    from django.contrib.comments.feeds import LatestCommentFeed\n-\n-    feeds = {\n-        'latest': LatestCommentFeed,\n-    }\n-\n-    urlpatterns = patterns('',\n-    # ...\n-        (r'^feeds/(?P<url>.*)/$', 'django.contrib.syndication.views.feed',\n-            {'feed_dict': feeds}),\n-    # ...\n-    )\n-\n \n Moderation\n =========="
        },
        {
            "sha": "1c6ff7c7ed72ec6d636acef7ebdc5b369fd720b8",
            "filename": "docs/ref/contrib/comments/index.txt",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -254,6 +254,56 @@ you can include a hidden form input called ``next`` in your comment form. For ex\n \n     <input type=\"hidden\" name=\"next\" value=\"{% url 'my_comment_was_posted' %}\" />\n \n+Providing a comment form for authenticated users\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+If a user is already authenticated, it makes little sense to display the name,\n+email, and URL fields, since these can already be retrieved from their login\n+data and profile. In addition, some sites will only accept comments from\n+authenticated users.\n+\n+To provide a comment form for authenticated users, you can manually provide the\n+additional fields expected by the Django comments framework. For example,\n+assuming comments are attached to the model \"object\"::\n+\n+    {% if user.is_authenticated %}\n+        {% get_comment_form for object as form %}\n+        <form action=\"{% comment_form_target %}\" method=\"POST\">\n+        {% csrf_token %}\n+        {{ form.comment }}\n+        {{ form.honeypot }}\n+        {{ form.content_type }}\n+        {{ form.object_pk }}\n+        {{ form.timestamp }}\n+        {{ form.security_hash }}\n+        <input type=\"hidden\" name=\"next\" value=\"{% url 'object_detail_view' object.id %}\" />\n+        <input type=\"submit\" value=\"Add comment\" id=\"id_submit\" />\n+        </form>\n+    {% else %}\n+        <p>Please <a href=\"{% url 'auth_login' %}\">log in</a> to leave a comment.</p>\n+    {% endif %}\n+\n+The honeypot, content_type, object_pk, timestamp, and security_hash fields are\n+fields that would have been created automatically if you had simply used\n+``{{ form }}`` in your template, and are referred to in `Notes on the comment\n+form`_ below.\n+\n+Note that we do not need to specify the user to be associated with comments\n+submitted by authenticated users. This is possible because the :doc:`Built-in\n+Comment Models</ref/contrib/comments/models>` that come with Django associate\n+comments with authenticated users by default.\n+\n+In this example, the honeypot field will still be visible to the user; you'll\n+need to hide that field in your CSS::\n+\n+    #id_honeypot {\n+        display: none;\n+    }\n+\n+If you want to accept either anonymous or authenticated comments, replace the\n+contents of the \"else\" clause above with a standard comment form and the right\n+thing will happen whether a user is logged in or not.\n+\n .. _notes-on-the-comment-form:\n \n Notes on the comment form"
        },
        {
            "sha": "39b3ea7913a3ccf50e9f44df6c7d201482e318d1",
            "filename": "docs/ref/contrib/comments/moderation.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Fmoderation.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcomments%2Fmoderation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Fmoderation.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -136,10 +136,6 @@ Simply subclassing :class:`CommentModerator` and changing the values of these\n options will automatically enable the various moderation methods for any\n models registered using the subclass.\n \n-.. versionchanged:: 1.3\n-\n-``moderate_after`` and ``close_after`` now accept 0 as a valid value.\n-\n Adding custom moderation methods\n --------------------------------\n "
        },
        {
            "sha": "dfbeabc3024f47ad0dff4a437f81e613e6ffcdd7",
            "filename": "docs/ref/contrib/contenttypes.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcontenttypes.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcontenttypes.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcontenttypes.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -423,8 +423,6 @@ pointing at it will be deleted as well. In the example above, this means that\n if a ``Bookmark`` object were deleted, any ``TaggedItem`` objects pointing at\n it would be deleted at the same time.\n \n-.. versionadded:: 1.3\n-\n Unlike :class:`~django.db.models.ForeignKey`,\n :class:`~django.contrib.contenttypes.generic.GenericForeignKey` does not accept\n an :attr:`~django.db.models.ForeignKey.on_delete` argument to customize this"
        },
        {
            "sha": "32d8a705bcf6cd58a3b76de8e702a5050c05ae0b",
            "filename": "docs/ref/contrib/csrf.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcsrf.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -72,9 +72,9 @@ To enable CSRF protection for your views, follow these steps:\n       :func:`~django.shortcuts.render_to_response()` wrapper that takes care\n       of this step for you.\n \n-The utility script ``extras/csrf_migration_helper.py`` can help to automate the\n-finding of code and templates that may need these steps. It contains full help\n-on how to use it.\n+The utility script ``extras/csrf_migration_helper.py`` (located in the Django\n+distribution, but not installed) can help to automate the finding of code and\n+templates that may need these steps. It contains full help on how to use it.\n \n .. _csrf-ajax:\n "
        },
        {
            "sha": "7ff9165642f2ac54fbdfece122ff5a88b3a66c30",
            "filename": "docs/ref/contrib/flatpages.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fflatpages.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fflatpages.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fflatpages.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -158,9 +158,7 @@ For more on middleware, read the :doc:`middleware docs\n     :class:`~django.contrib.flatpages.middleware.FlatpageFallbackMiddleware`\n     only steps in once another view has successfully produced a 404 response.\n     If another view or middleware class attempts to produce a 404 but ends up\n-    raising an exception instead (such as a ``TemplateDoesNotExist``\n-    exception if your site does not have an appropriate template to\n-    use for HTTP 404 responses), the response will become an HTTP 500\n+    raising an exception instead, the response will become an HTTP 500\n     (\"Internal Server Error\") and the\n     :class:`~django.contrib.flatpages.middleware.FlatpageFallbackMiddleware`\n     will not attempt to serve a flat page.\n@@ -239,8 +237,6 @@ template.\n Getting a list of :class:`~django.contrib.flatpages.models.FlatPage` objects in your templates\n ==============================================================================================\n \n-.. versionadded:: 1.3\n-\n The flatpages app provides a template tag that allows you to iterate\n over all of the available flatpages on the :ref:`current site\n <hooking-into-current-site-from-views>`."
        },
        {
            "sha": "0ced1bf1559f51aa53bec2a19929c94666c21a7b",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -226,7 +226,7 @@ Hooking the wizard into a URLconf\n ---------------------------------\n \n Finally, we need to specify which forms to use in the wizard, and then\n-deploy the new :class:`WizardView` object at an URL in the ``urls.py``. The\n+deploy the new :class:`WizardView` object at a URL in the ``urls.py``. The\n wizard's :meth:`as_view` method takes a list of your\n :class:`~django.forms.Form` classes as an argument during instantiation::\n "
        },
        {
            "sha": "d1a9fc1dcb35c62caefda435bf6c8e4d21438e13",
            "filename": "docs/ref/contrib/gis/admin.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fadmin.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fadmin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fadmin.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -45,7 +45,7 @@ GeoDjango's admin site\n    .. attribute:: openlayers_url\n \n    Link to the URL of the OpenLayers JavaScript.  Defaults to\n-   ``'http://openlayers.org/api/2.8/OpenLayers.js'``.\n+   ``'http://openlayers.org/api/2.11/OpenLayers.js'``.\n \n \n    .. attribute:: modifiable"
        },
        {
            "sha": "519f79f0d48901a8aa5377b8fcd0f3d325f0d2f8",
            "filename": "docs/ref/contrib/gis/db-api.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fdb-api.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fdb-api.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fdb-api.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -282,7 +282,7 @@ Method                                PostGIS  Oracle  SpatiaLite\n :meth:`GeoQuerySet.extent3d`          X\n :meth:`GeoQuerySet.force_rhr`         X\n :meth:`GeoQuerySet.geohash`           X\n-:meth:`GeoQuerySet.geojson`           X\n+:meth:`GeoQuerySet.geojson`           X                X\n :meth:`GeoQuerySet.gml`               X        X       X\n :meth:`GeoQuerySet.intersection`      X        X       X\n :meth:`GeoQuerySet.kml`               X                X"
        },
        {
            "sha": "e37c4c60b09cf7a59cd8f48082baae5459d27a17",
            "filename": "docs/ref/contrib/gis/geoip.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fgeoip.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fgeoip.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeoip.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -23,10 +23,10 @@ to the GPL-licensed `Python GeoIP`__ interface provided by MaxMind.\n In order to perform IP-based geolocation, the :class:`GeoIP` object requires\n the GeoIP C libary and either the GeoIP `Country`__ or `City`__ \n datasets in binary format (the CSV files will not work!).  These datasets may be \n-`downloaded from MaxMind`__.  Grab the ``GeoIP.dat.gz`` and ``GeoLiteCity.dat.gz``\n-and unzip them in a directory corresponding to what you set \n-:setting:`GEOIP_PATH` with in your settings.  See the example and reference below\n-for more details.\n+`downloaded from MaxMind`__.  Grab the ``GeoLiteCountry/GeoIP.dat.gz`` and\n+``GeoLiteCity.dat.gz`` files and unzip them in a directory corresponding to what\n+you set :setting:`GEOIP_PATH` with in your settings.  See the example and\n+reference below for more details.\n \n __ http://www.maxmind.com/app/c\n __ http://www.maxmind.com/app/python"
        },
        {
            "sha": "69280dc0286ab4998a9c85f3f88bb840af60cf85",
            "filename": "docs/ref/contrib/gis/geoquerysets.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -947,7 +947,7 @@ __ http://geohash.org/\n \n .. method:: GeoQuerySet.geojson(**kwargs)\n \n-*Availability*: PostGIS\n+*Availability*: PostGIS, SpatiaLite\n \n Attaches a ``geojson`` attribute to every model in the queryset that contains the\n `GeoJSON`__ representation of the geometry."
        },
        {
            "sha": "eb20b1f41150ea72dd346cee952aee0d941a271d",
            "filename": "docs/ref/contrib/gis/geos.txt",
            "status": "modified",
            "additions": 44,
            "deletions": 10,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -163,6 +163,11 @@ WKB / EWKB     ``buffer``\n GeoJSON        ``str`` or ``unicode``\n =============  ======================\n \n+.. note::\n+\n+    The new 3D/4D WKT notation with an intermediary Z or M (like\n+    ``POINT Z (3, 4, 5)``) is only supported with GEOS 3.3.0 or later.\n+\n Properties\n ~~~~~~~~~~\n \n@@ -232,8 +237,6 @@ Returns a boolean indicating whether the geometry is valid.\n \n .. attribute:: GEOSGeometry.valid_reason\n \n-.. versionadded:: 1.3\n-\n Returns a string describing the reason why a geometry is invalid.\n \n .. attribute:: GEOSGeometry.srid\n@@ -270,14 +273,18 @@ Essentially the SRID is prepended to the WKT representation, for example\n .. attribute:: GEOSGeometry.hex\n \n Returns the WKB of this Geometry in hexadecimal form.  Please note\n-that the SRID and Z values are not included in this representation\n+that the SRID value is not included in this representation\n because it is not a part of the OGC specification (use the\n :attr:`GEOSGeometry.hexewkb` property instead).\n \n+.. versionchanged:: 1.5\n+\n+    Prior to Django 1.5, the Z value of the geometry was dropped.\n+\n .. attribute:: GEOSGeometry.hexewkb\n \n Returns the EWKB of this Geometry in hexadecimal form.  This is an\n-extension of the WKB specification that includes SRID and Z values\n+extension of the WKB specification that includes the SRID value\n that are a part of this geometry.\n \n .. note::\n@@ -316,16 +323,20 @@ correspondg to the GEOS geometry.\n .. attribute:: GEOSGeometry.wkb\n \n Returns the WKB (Well-Known Binary) representation of this Geometry\n-as a Python buffer.  SRID and Z values are not included, use the\n+as a Python buffer.  SRID value is not included, use the\n :attr:`GEOSGeometry.ewkb` property instead.\n \n+.. versionchanged:: 1.5\n+\n+    Prior to Django 1.5, the Z value of the geometry was dropped.\n+\n .. _ewkb:\n \n .. attribute:: GEOSGeometry.ewkb\n \n Return the EWKB representation of this Geometry as a Python buffer.\n This is an extension of the WKB specification that includes any SRID\n-and Z values that are a part of this geometry.\n+value that are a part of this geometry.\n \n .. note::\n \n@@ -413,11 +424,36 @@ quarter circle (defaults is 8).\n Returns a :class:`GEOSGeometry` representing the points making up this\n geometry that do not make up other.\n \n+.. method:: GEOSGeometry.interpolate(distance)\n+.. method:: GEOSGeometry.interpolate_normalized(distance)\n+\n+.. versionadded:: 1.5\n+\n+Given a distance (float), returns the point (or closest point) within the\n+geometry (:class:`LineString` or :class:`MultiLineString`) at that distance.\n+The normalized version takes the distance as a float between 0 (origin) and 1\n+(endpoint).\n+\n+Reverse of :meth:`GEOSGeometry.project`.\n+\n .. method:: GEOSGeometry:intersection(other)\n \n Returns a :class:`GEOSGeometry` representing the points shared by this\n geometry and other.\n \n+.. method:: GEOSGeometry.project(point)\n+.. method:: GEOSGeometry.project_normalized(point)\n+\n+.. versionadded:: 1.5\n+\n+Returns the distance (float) from the origin of the geometry\n+(:class:`LineString` or :class:`MultiLineString`) to the point projected on the\n+geometry (that is to a point of the line the closest to the given point).\n+The normalized version returns the distance as a float between 0 (origin) and 1\n+(endpoint).\n+\n+Reverse of :meth:`GEOSGeometry.interpolate`.\n+\n .. method:: GEOSGeometry.relate(other)\n \n Returns the DE-9IM intersection matrix (a string) representing the\n@@ -530,8 +566,6 @@ corresponding to the SRID of the geometry or ``None``.\n \n .. method:: GEOSGeometry.transform(ct, clone=False)\n \n-.. versionchanged:: 1.3\n-\n Transforms the geometry according to the given coordinate transformation paramter\n (``ct``), which may be an integer SRID, spatial reference WKT string,\n a PROJ.4 string, a :class:`~django.contrib.gis.gdal.SpatialReference` object, or a\n@@ -796,7 +830,7 @@ Writer Objects\n All writer objects have a ``write(geom)`` method that returns either the\n WKB or WKT of the given geometry.  In addition, :class:`WKBWriter` objects\n also have properties that may be used to change the byte order, and or\n-include the SRID and 3D values (in other words, EWKB).\n+include the SRID value (in other words, EWKB).\n \n .. class:: WKBWriter\n \n@@ -858,7 +892,7 @@ so that the Z value is included in the WKB.\n Outdim Value Description\n ============ ===========================\n 2            The default, output 2D WKB.\n-3            Output 3D EWKB.\n+3            Output 3D WKB.\n ============ ===========================\n \n Example::"
        },
        {
            "sha": "6a1402bfab75713e46900462803a448e688c634a",
            "filename": "docs/ref/contrib/gis/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -15,7 +15,7 @@ of spatially enabled data.\n    :maxdepth: 2\n \n    tutorial\n-   install\n+   install/index\n    model-api\n    db-api\n    geoquerysets"
        },
        {
            "sha": "b81597320216afdd4ac7fd1788b4bc6967cfc351",
            "filename": "docs/ref/contrib/gis/install.txt",
            "status": "removed",
            "additions": 0,
            "deletions": 1267,
            "changes": 1267,
            "blob_url": "https://github.com/django/django/blob/a589fdff81ab36c57ff0a1003e60ee0dd55f3a88/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/a589fdff81ab36c57ff0a1003e60ee0dd55f3a88/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt?ref=a589fdff81ab36c57ff0a1003e60ee0dd55f3a88",
            "patch": "@@ -1,1267 +0,0 @@\n-.. _ref-gis-install:\n-\n-======================\n-GeoDjango Installation\n-======================\n-\n-.. highlight:: console\n-\n-Overview\n-========\n-In general, GeoDjango installation requires:\n-\n-1. :ref:`Python and Django <django>`\n-2. :ref:`spatial_database`\n-3. :ref:`geospatial_libs`\n-\n-Details for each of the requirements and installation instructions\n-are provided in the sections below.   In addition, platform-specific\n-instructions are available for:\n-\n-* :ref:`macosx`\n-* :ref:`ubuntudebian`\n-* :ref:`windows`\n-\n-.. admonition:: Use the Source\n-\n-    Because GeoDjango takes advantage of the latest in the open source geospatial\n-    software technology, recent versions of the libraries are necessary.\n-    If binary packages aren't available for your platform,\n-    :ref:`installation from source <build_from_source>`\n-    may be required. When compiling the libraries from source, please follow the\n-    directions closely, especially if you're a beginner.\n-\n-Requirements\n-============\n-\n-.. _django:\n-\n-Python and Django\n------------------\n-\n-Because GeoDjango is included with Django, please refer to Django's\n-:ref:`installation instructions <installing-official-release>` for details on\n-how to install.\n-\n-\n-.. _spatial_database:\n-\n-Spatial database\n-----------------\n-PostgreSQL (with PostGIS), MySQL, Oracle, and SQLite (with SpatiaLite) are\n-the spatial databases currently supported.\n-\n-.. note::\n-\n-    PostGIS is recommended, because it is the most mature and feature-rich\n-    open source spatial database.\n-\n-The geospatial libraries required for a GeoDjango installation depends\n-on the spatial database used.  The following lists the library requirements,\n-supported versions, and any notes for each of the supported database backends:\n-\n-==================  ==============================  ==================  =========================================\n-Database            Library Requirements            Supported Versions  Notes\n-==================  ==============================  ==================  =========================================\n-PostgreSQL          GEOS, PROJ.4, PostGIS           8.1+                Requires PostGIS.\n-MySQL               GEOS                            5.x                 Not OGC-compliant; limited functionality.\n-Oracle              GEOS                            10.2, 11            XE not supported; not tested with 9.\n-SQLite              GEOS, GDAL, PROJ.4, SpatiaLite  3.6.+               Requires SpatiaLite 2.3+, pysqlite2 2.5+\n-==================  ==============================  ==================  =========================================\n-\n-.. _geospatial_libs:\n-\n-Geospatial libraries\n---------------------\n-GeoDjango uses and/or provides interfaces for the following open source\n-geospatial libraries:\n-\n-========================  ====================================  ================================  ==========================\n-Program                   Description                           Required                          Supported Versions\n-========================  ====================================  ================================  ==========================\n-:ref:`GEOS <ref-geos>`    Geometry Engine Open Source           Yes                               3.3, 3.2, 3.1, 3.0\n-`PROJ.4`_                 Cartographic Projections library      Yes (PostgreSQL and SQLite only)  4.8, 4.7, 4.6, 4.5, 4.4\n-:ref:`GDAL <ref-gdal>`    Geospatial Data Abstraction Library   No (but, required for SQLite)     1.9, 1.8, 1.7, 1.6, 1.5\n-:ref:`GeoIP <ref-geoip>`  IP-based geolocation library          No                                1.4\n-`PostGIS`__               Spatial extensions for PostgreSQL     Yes (PostgreSQL only)             1.5, 1.4, 1.3\n-`SpatiaLite`__            Spatial extensions for SQLite         Yes (SQLite only)                 3.0, 2.4, 2.3\n-========================  ====================================  ================================  ==========================\n-\n-.. admonition::  Install GDAL\n-\n-    While :ref:`gdalbuild` is technically not required, it is *recommended*.\n-    Important features of GeoDjango (including the :ref:`ref-layermapping`,\n-    geometry reprojection, and the geographic admin) depend on its\n-    functionality.\n-\n-.. note::\n-\n-    The GeoDjango interfaces to GEOS, GDAL, and GeoIP may be used\n-    independently of Django.  In other words, no database or settings file\n-    required -- just import them as normal from :mod:`django.contrib.gis`.\n-\n-.. _PROJ.4: http://trac.osgeo.org/proj/\n-__ http://postgis.refractions.net/\n-__ http://www.gaia-gis.it/gaia-sins/\n-\n-.. _build_from_source:\n-\n-Building from source\n-====================\n-\n-When installing from source on UNIX and GNU/Linux systems, please follow\n-the installation instructions carefully, and install the libraries in the\n-given order.  If using MySQL or Oracle as the spatial database, only GEOS\n-is required.\n-\n-.. note::\n-\n-   On Linux platforms, it may be necessary to run the ``ldconfig``\n-   command after installing each library.  For example::\n-\n-       $ sudo make install\n-       $ sudo ldconfig\n-\n-.. note::\n-\n-    OS X users are required to install `Apple Developer Tools`_ in order\n-    to compile software from source.  This is typically included on your\n-    OS X installation DVDs.\n-\n-.. _Apple Developer Tools: https://developer.apple.com/technologies/tools/\n-\n-.. _geosbuild:\n-\n-GEOS\n-----\n-\n-GEOS is a C++ library for performing geometric operations, and is the default\n-internal geometry representation used by GeoDjango (it's behind the \"lazy\"\n-geometries).  Specifically, the C API library is called (e.g., ``libgeos_c.so``)\n-directly from Python using ctypes.\n-\n-First, download GEOS 3.3.5 from the refractions Web site and untar the source\n-archive::\n-\n-    $ wget http://download.osgeo.org/geos/geos-3.3.5.tar.bz2\n-    $ tar xjf geos-3.3.5.tar.bz2\n-\n-Next, change into the directory where GEOS was unpacked, run the configure\n-script, compile, and install::\n-\n-    $ cd geos-3.3.5\n-    $ ./configure\n-    $ make\n-    $ sudo make install\n-    $ cd ..\n-\n-Troubleshooting\n-^^^^^^^^^^^^^^^\n-\n-Can't find GEOS library\n-~~~~~~~~~~~~~~~~~~~~~~~\n-\n-When GeoDjango can't find GEOS, this error is raised:\n-\n-.. code-block:: text\n-\n-    ImportError: Could not find the GEOS library (tried \"geos_c\"). Try setting GEOS_LIBRARY_PATH in your settings.\n-\n-The most common solution is to properly configure your :ref:`libsettings` *or* set\n-:ref:`geoslibrarypath` in your settings.\n-\n-If using a binary package of GEOS (e.g., on Ubuntu), you may need to :ref:`binutils`.\n-\n-.. _geoslibrarypath:\n-\n-``GEOS_LIBRARY_PATH``\n-~~~~~~~~~~~~~~~~~~~~~\n-\n-If your GEOS library is in a non-standard location, or you don't want to\n-modify the system's library path then the :setting:`GEOS_LIBRARY_PATH`\n-setting may be added to your Django settings file with the full path to the\n-GEOS C library.  For example:\n-\n-.. code-block:: python\n-\n-    GEOS_LIBRARY_PATH = '/home/bob/local/lib/libgeos_c.so'\n-\n-.. note::\n-\n-    The setting must be the *full* path to the **C** shared library; in\n-    other words you want to use ``libgeos_c.so``, not ``libgeos.so``.\n-\n-See also :ref:`My logs are filled with GEOS-related errors <geos-exceptions-in-logfile>`.\n-\n-.. _proj4:\n-\n-PROJ.4\n-------\n-\n-`PROJ.4`_ is a library for converting geospatial data to different coordinate\n-reference systems.\n-\n-First, download the PROJ.4 source code and datum shifting files [#]_::\n-\n-    $ wget http://download.osgeo.org/proj/proj-4.8.0.tar.gz\n-    $ wget http://download.osgeo.org/proj/proj-datumgrid-1.5.tar.gz\n-\n-Next, untar the source code archive, and extract the datum shifting files in the\n-``nad`` subdirectory.  This must be done *prior* to configuration::\n-\n-    $ tar xzf proj-4.8.0.tar.gz\n-    $ cd proj-4.8.0/nad\n-    $ tar xzf ../../proj-datumgrid-1.5.tar.gz\n-    $ cd ..\n-\n-Finally, configure, make and install PROJ.4::\n-\n-    $ ./configure\n-    $ make\n-    $ sudo make install\n-    $ cd ..\n-\n-.. _postgis:\n-\n-PostGIS\n--------\n-\n-`PostGIS`__ adds geographic object support to PostgreSQL, turning it\n-into a spatial database. :ref:`geosbuild` and :ref:`proj4` should be\n-installed prior to building PostGIS.\n-\n-.. note::\n-\n-    The `psycopg2`_ module is required for use as the database adaptor\n-    when using GeoDjango with PostGIS.\n-\n-.. _psycopg2: http://initd.org/psycopg/\n-\n-First download the source archive, and extract::\n-\n-    $ wget http://postgis.refractions.net/download/postgis-1.5.5.tar.gz\n-    $ tar xzf postgis-1.5.5.tar.gz\n-    $ cd postgis-1.5.5\n-\n-Next, configure, make and install PostGIS::\n-\n-    $ ./configure\n-\n-Finally, make and install::\n-\n-    $ make\n-    $ sudo make install\n-    $ cd ..\n-\n-.. note::\n-\n-    GeoDjango does not automatically create a spatial database.  Please\n-    consult the section on :ref:`spatialdb_template` for more information.\n-\n-__ http://postgis.refractions.net/\n-\n-.. _gdalbuild:\n-\n-GDAL\n-----\n-\n-`GDAL`__ is an excellent open source geospatial library that has support for\n-reading most vector and raster spatial data formats.  Currently, GeoDjango only\n-supports :ref:`GDAL's vector data <ref-gdal>` capabilities [#]_.\n-:ref:`geosbuild` and :ref:`proj4` should be installed prior to building GDAL.\n-\n-First download the latest GDAL release version and untar the archive::\n-\n-    $ wget http://download.osgeo.org/gdal/gdal-1.9.1.tar.gz\n-    $ tar xzf gdal-1.9.1.tar.gz\n-    $ cd gdal-1.9.1\n-\n-Configure, make and install::\n-\n-    $ ./configure\n-    $ make # Go get some coffee, this takes a while.\n-    $ sudo make install\n-    $ cd ..\n-\n-.. note::\n-\n-   Because GeoDjango has it's own Python interface, the preceding instructions\n-   do not build GDAL's own Python bindings.  The bindings may be built by\n-   adding the ``--with-python`` flag when running ``configure``.  See\n-   `GDAL/OGR In Python`__ for more information on GDAL's bindings.\n-\n-If you have any problems, please see the troubleshooting section below for\n-suggestions and solutions.\n-\n-__ http://trac.osgeo.org/gdal/\n-__ http://trac.osgeo.org/gdal/wiki/GdalOgrInPython\n-\n-.. _gdaltrouble:\n-\n-Troubleshooting\n-^^^^^^^^^^^^^^^\n-\n-Can't find GDAL library\n-~~~~~~~~~~~~~~~~~~~~~~~\n-\n-When GeoDjango can't find the GDAL library, the ``HAS_GDAL`` flag\n-will be false:\n-\n-.. code-block:: pycon\n-\n-    >>> from django.contrib.gis import gdal\n-    >>> gdal.HAS_GDAL\n-    False\n-\n-The solution is to properly configure your :ref:`libsettings` *or* set\n-:ref:`gdallibrarypath` in your settings.\n-\n-.. _gdallibrarypath:\n-\n-``GDAL_LIBRARY_PATH``\n-~~~~~~~~~~~~~~~~~~~~~\n-\n-If your GDAL library is in a non-standard location, or you don't want to\n-modify the system's library path then the :setting:`GDAL_LIBRARY_PATH`\n-setting may be added to your Django settings file with the full path to\n-the GDAL library.  For example:\n-\n-.. code-block:: python\n-\n-    GDAL_LIBRARY_PATH = '/home/sue/local/lib/libgdal.so'\n-\n-.. _gdaldata:\n-\n-Can't find GDAL data files (``GDAL_DATA``)\n-~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n-\n-When installed from source, GDAL versions 1.5.1 and below have an autoconf bug\n-that places data in the wrong location. [#]_   This can lead to error messages\n-like this:\n-\n-.. code-block:: text\n-\n-    ERROR 4: Unable to open EPSG support file gcs.csv.\n-    ...\n-    OGRException: OGR failure.\n-\n-The solution is to set the ``GDAL_DATA`` environment variable to the location of the\n-GDAL data files before invoking Python  (typically ``/usr/local/share``; use\n-``gdal-config --datadir`` to find out). For example::\n-\n-    $ export GDAL_DATA=`gdal-config --datadir`\n-    $ python manage.py shell\n-\n-If using Apache, you may need to add this environment variable to your configuration\n-file:\n-\n-.. code-block:: apache\n-\n-    SetEnv GDAL_DATA /usr/local/share\n-\n-.. _spatialite:\n-\n-SpatiaLite\n-----------\n-\n-.. note::\n-\n-   Mac OS X users should follow the instructions in the :ref:`kyngchaos` section,\n-   as it is much easier than building from source.\n-\n-`SpatiaLite`__ adds spatial support to SQLite, turning it into a full-featured\n-spatial database.  Because SpatiaLite has special requirements, it typically\n-requires SQLite and pysqlite2 (the Python SQLite DB-API adaptor) to be built from\n-source.  :ref:`geosbuild` and :ref:`proj4` should be installed prior to building\n-SpatiaLite.\n-\n-After installation is complete, don't forget to read the post-installation\n-docs on :ref:`create_spatialite_db`.\n-\n-__ http://www.gaia-gis.it/gaia-sins/\n-\n-.. _sqlite:\n-\n-SQLite\n-^^^^^^\n-\n-Typically, SQLite packages are not compiled to include the `R*Tree module`__ --\n-thus it must be compiled from source.  First download the latest amalgamation\n-source archive from the `SQLite download page`__, and extract::\n-\n-    $ wget http://sqlite.org/sqlite-amalgamation-3.6.23.1.tar.gz\n-    $ tar xzf sqlite-amalgamation-3.6.23.1.tar.gz\n-    $ cd sqlite-3.6.23.1\n-\n-Next, run the ``configure`` script -- however the ``CFLAGS`` environment variable\n-needs to be customized so that SQLite knows to build the R*Tree module::\n-\n-    $ CFLAGS=\"-DSQLITE_ENABLE_RTREE=1\" ./configure\n-    $ make\n-    $ sudo make install\n-    $ cd ..\n-\n-.. note::\n-\n-    If using Ubuntu, installing a newer SQLite from source can be very difficult\n-    because it links to the existing ``libsqlite3.so`` in ``/usr/lib`` which\n-    many other packages depend on.  Unfortunately, the best solution at this time\n-    is to overwrite the existing library by adding ``--prefix=/usr`` to the\n-    ``configure`` command.\n-\n-__ http://www.sqlite.org/rtree.html\n-__ http://www.sqlite.org/download.html\n-\n-.. _spatialitebuild :\n-\n-SpatiaLite library (``libspatialite``) and tools (``spatialite``)\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-After SQLite has been built with the R*Tree module enabled, get the latest\n-SpatiaLite library source and tools bundle from the `download page`__::\n-\n-    $ wget http://www.gaia-gis.it/gaia-sins/libspatialite-sources/libspatialite-amalgamation-2.3.1.tar.gz\n-    $ wget http://www.gaia-gis.it/gaia-sins/spatialite-tools-sources/spatialite-tools-2.3.1.tar.gz\n-    $ tar xzf libspatialite-amalgamation-2.3.1.tar.gz\n-    $ tar xzf spatialite-tools-2.3.1.tar.gz\n-\n-Prior to attempting to build, please read the important notes below to see if\n-customization of the ``configure`` command is necessary.  If not, then run the\n-``configure`` script, make, and install for the SpatiaLite library::\n-\n-    $ cd libspatialite-amalgamation-2.3.1\n-    $ ./configure # May need to modified, see notes below.\n-    $ make\n-    $ sudo make install\n-    $ cd ..\n-\n-Finally, do the same for the SpatiaLite tools::\n-\n-    $ cd spatialite-tools-2.3.1\n-    $ ./configure # May need to modified, see notes below.\n-    $ make\n-    $ sudo make install\n-    $ cd ..\n-\n-.. note::\n-\n-    If you've installed GEOS and PROJ.4 from binary packages, you will have to specify\n-    their paths when running the ``configure`` scripts for *both* the library and the\n-    tools (the configure scripts look, by default, in ``/usr/local``).  For example,\n-    on Debian/Ubuntu distributions that have GEOS and PROJ.4 packages, the command would be::\n-\n-       $ ./configure --with-proj-include=/usr/include --with-proj-lib=/usr/lib --with-geos-include=/usr/include --with-geos-lib=/usr/lib\n-\n-.. note::\n-\n-    For Mac OS X users building from source, the SpatiaLite library *and* tools\n-    need to have their ``target`` configured::\n-\n-        $ ./configure --target=macosx\n-\n-__ http://www.gaia-gis.it/gaia-sins/libspatialite-sources/\n-\n-.. _pysqlite2:\n-\n-pysqlite2\n-^^^^^^^^^\n-\n-Because SpatiaLite must be loaded as an external extension, it requires the\n-``enable_load_extension`` method, which is only available in versions 2.5+ of\n-pysqlite2. Thus, download pysqlite2 2.6, and untar::\n-\n-    $ wget http://pysqlite.googlecode.com/files/pysqlite-2.6.0.tar.gz\n-    $ tar xzf pysqlite-2.6.0.tar.gz\n-    $ cd pysqlite-2.6.0\n-\n-Next, use a text editor (e.g., ``emacs`` or ``vi``) to edit the ``setup.cfg`` file\n-to look like the following:\n-\n-.. code-block:: ini\n-\n-    [build_ext]\n-    #define=\n-    include_dirs=/usr/local/include\n-    library_dirs=/usr/local/lib\n-    libraries=sqlite3\n-    #define=SQLITE_OMIT_LOAD_EXTENSION\n-\n-.. note::\n-\n-    The important thing here is to make sure you comment out the\n-    ``define=SQLITE_OMIT_LOAD_EXTENSION`` flag and that the ``include_dirs``\n-    and ``library_dirs`` settings are uncommented and set to the appropriate\n-    path if the SQLite header files and libraries are not in ``/usr/include``\n-    and ``/usr/lib``, respectively.\n-\n-After modifying ``setup.cfg`` appropriately, then run the ``setup.py`` script\n-to build and install::\n-\n-    $ sudo python setup.py install\n-\n-Post-installation\n-=================\n-\n-.. _spatialdb_template:\n-\n-Creating a spatial database template for PostGIS\n-------------------------------------------------\n-\n-Creating a spatial database with PostGIS is different than normal because\n-additional SQL must be loaded to enable spatial functionality.  Because of\n-the steps in this process, it's better to create a database template that\n-can be reused later.\n-\n-First, you need to be able to execute the commands as a privileged database\n-user.  For example, you can use the following to become the ``postgres`` user::\n-\n-    $ sudo su - postgres\n-\n-.. note::\n-\n-   The location *and* name of the PostGIS SQL files (e.g., from\n-   ``POSTGIS_SQL_PATH`` below) depends on the version of PostGIS.\n-   PostGIS versions 1.3 and below use ``<pg_sharedir>/contrib/lwpostgis.sql``;\n-   whereas version 1.4 uses ``<sharedir>/contrib/postgis.sql`` and\n-   version 1.5 uses ``<sharedir>/contrib/postgis-1.5/postgis.sql``.\n-\n-   To complicate matters, :ref:`ubuntudebian` distributions have their\n-   own separate directory naming system that changes each release.\n-\n-   The example below assumes PostGIS 1.5, thus you may need to modify\n-   ``POSTGIS_SQL_PATH`` and the name of the SQL file for the specific\n-   version of PostGIS you are using.\n-\n-Once you're a database super user, then you may execute the following commands\n-to create a PostGIS spatial database template::\n-\n-    $ POSTGIS_SQL_PATH=`pg_config --sharedir`/contrib/postgis-1.5\n-    # Creating the template spatial database.\n-    $ createdb -E UTF8 template_postgis\n-    $ createlang -d template_postgis plpgsql # Adding PLPGSQL language support.\n-    # Allows non-superusers the ability to create from this template\n-    $ psql -d postgres -c \"UPDATE pg_database SET datistemplate='true' WHERE datname='template_postgis';\"\n-    # Loading the PostGIS SQL routines\n-    $ psql -d template_postgis -f $POSTGIS_SQL_PATH/postgis.sql\n-    $ psql -d template_postgis -f $POSTGIS_SQL_PATH/spatial_ref_sys.sql\n-    # Enabling users to alter spatial tables.\n-    $ psql -d template_postgis -c \"GRANT ALL ON geometry_columns TO PUBLIC;\"\n-    $ psql -d template_postgis -c \"GRANT ALL ON geography_columns TO PUBLIC;\"\n-    $ psql -d template_postgis -c \"GRANT ALL ON spatial_ref_sys TO PUBLIC;\"\n-\n-These commands may be placed in a shell script for later use; for convenience\n-the following scripts are available:\n-\n-===============  =============================================\n-PostGIS version  Bash shell script\n-===============  =============================================\n-1.3              :download:`create_template_postgis-1.3.sh`\n-1.4              :download:`create_template_postgis-1.4.sh`\n-1.5              :download:`create_template_postgis-1.5.sh`\n-Debian/Ubuntu    :download:`create_template_postgis-debian.sh`\n-===============  =============================================\n-\n-Afterwards, you may create a spatial database by simply specifying\n-``template_postgis`` as the template to use (via the ``-T`` option)::\n-\n-    $ createdb -T template_postgis <db name>\n-\n-.. note::\n-\n-    While the ``createdb`` command does not require database super-user privileges,\n-    it must be executed by a database user that has permissions to create databases.\n-    You can create such a user with the following command::\n-\n-        $ createuser --createdb <user>\n-\n-.. _create_spatialite_db:\n-\n-Creating a spatial database for SpatiaLite\n-------------------------------------------\n-\n-After you've installed SpatiaLite, you'll need to create a number of spatial\n-metadata tables in your database in order to perform spatial queries.\n-\n-If you're using SpatiaLite 2.4 or newer, use the ``spatialite`` utility to\n-call the ``InitSpatialMetaData()`` function, like this::\n-\n-   $ spatialite geodjango.db \"SELECT InitSpatialMetaData();\"\n-   the SPATIAL_REF_SYS table already contains some row(s)\n-    InitSpatiaMetaData ()error:\"table spatial_ref_sys already exists\"\n-   0\n-\n-You can safely ignore the error messages shown. When you've done this, you can\n-skip the rest of this section.\n-\n-If you're using SpatiaLite 2.3, you'll need to download a\n-database-initialization file and execute its SQL queries in your database.\n-\n-First, get it from the `SpatiaLite Resources`__ page::\n-\n-   $ wget http://www.gaia-gis.it/spatialite-2.3.1/init_spatialite-2.3.sql.gz\n-   $ gunzip init_spatialite-2.3.sql.gz\n-\n-Then, use the ``spatialite`` command to initialize a spatial database::\n-\n-   $ spatialite geodjango.db < init_spatialite-2.3.sql\n-\n-.. note::\n-\n-    The parameter ``geodjango.db`` is the *filename* of the SQLite database\n-    you want to use.  Use the same in the :setting:`DATABASES` ``\"name\"`` key\n-    inside your ``settings.py``.\n-\n-__ http://www.gaia-gis.it/spatialite-2.3.1/resources.html\n-\n-Add ``django.contrib.gis`` to :setting:`INSTALLED_APPS`\n--------------------------------------------------------\n-\n-Like other Django contrib applications, you will *only* need to add\n-:mod:`django.contrib.gis` to :setting:`INSTALLED_APPS` in your settings.\n-This is the so that ``gis`` templates can be located -- if not done, then\n-features such as the geographic admin or KML sitemaps will not function properly.\n-\n-.. _addgoogleprojection:\n-\n-Add Google projection to ``spatial_ref_sys`` table\n---------------------------------------------------\n-\n-.. note::\n-\n-    If you're running PostGIS 1.4 or above, you can skip this step. The entry\n-    is already included in the default ``spatial_ref_sys`` table.\n-\n-In order to conduct database transformations to the so-called \"Google\"\n-projection (a spherical mercator projection used by Google Maps),\n-an entry must be added to your spatial database's ``spatial_ref_sys`` table.\n-Invoke the Django shell from your project and execute the\n-``add_srs_entry`` function:\n-\n-.. code-block:: pycon\n-\n-    $ python manage shell\n-    >>> from django.contrib.gis.utils import add_srs_entry\n-    >>> add_srs_entry(900913)\n-\n-This adds an entry for the 900913 SRID to the ``spatial_ref_sys`` (or equivalent)\n-table, making it possible for the spatial database to transform coordinates in\n-this projection.  You only need to execute this command *once* per spatial database.\n-\n-Troubleshooting\n-===============\n-\n-If you can't find the solution to your problem here then participate in the\n-community!  You can:\n-\n-* Join the ``#geodjango`` IRC channel on FreeNode. Please be patient and polite\n-  -- while you may not get an immediate response, someone will attempt to answer\n-  your question as soon as they see it.\n-* Ask your question on the `GeoDjango`__ mailing list.\n-* File a ticket on the `Django trac`__ if you think there's a bug.  Make\n-  sure to provide a complete description of the problem, versions used,\n-  and specify the component as \"GIS\".\n-\n-__ http://groups.google.com/group/geodjango\n-__ https://code.djangoproject.com/newticket\n-\n-.. _libsettings:\n-\n-Library environment settings\n-----------------------------\n-\n-By far, the most common problem when installing GeoDjango is that the\n-external shared libraries (e.g., for GEOS and GDAL) cannot be located. [#]_\n-Typically, the cause of this problem is that the operating system isn't aware\n-of the directory where the libraries built from source were installed.\n-\n-In general, the library path may be set on a per-user basis by setting\n-an environment variable, or by configuring the library path for the entire\n-system.\n-\n-``LD_LIBRARY_PATH`` environment variable\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-A user may set this environment variable to customize the library paths\n-they want to use.  The typical library directory for software\n-built from source is ``/usr/local/lib``.  Thus, ``/usr/local/lib`` needs\n-to be included in the ``LD_LIBRARY_PATH`` variable.  For example, the user\n-could place the following in their bash profile::\n-\n-    export LD_LIBRARY_PATH=/usr/local/lib\n-\n-Setting system library path\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-On GNU/Linux systems, there is typically a file in ``/etc/ld.so.conf``, which may include\n-additional paths from files in another directory, such as ``/etc/ld.so.conf.d``.\n-As the root user, add the custom library path (like ``/usr/local/lib``) on a\n-new line in ``ld.so.conf``.  This is *one* example of how to do so::\n-\n-    $ sudo echo /usr/local/lib >> /etc/ld.so.conf\n-    $ sudo ldconfig\n-\n-For OpenSolaris users, the system library path may be modified using the\n-``crle`` utility.  Run ``crle`` with no options to see the current configuration\n-and use ``crle -l`` to set with the new library path.  Be *very* careful when\n-modifying the system library path::\n-\n-    # crle -l $OLD_PATH:/usr/local/lib\n-\n-.. _binutils:\n-\n-Install ``binutils``\n-^^^^^^^^^^^^^^^^^^^^\n-\n-GeoDjango uses the ``find_library`` function (from the ``ctypes.util`` Python\n-module) to discover libraries.  The ``find_library`` routine uses a program\n-called ``objdump`` (part of the ``binutils`` package) to verify a shared\n-library on GNU/Linux systems.  Thus, if ``binutils`` is not installed on your\n-Linux system then Python's ctypes may not be able to find your library even if\n-your library path is set correctly and geospatial libraries were built perfectly.\n-\n-The ``binutils`` package may be installed on Debian and Ubuntu systems using the\n-following command::\n-\n-    $ sudo apt-get install binutils\n-\n-Similarly, on Red Hat and CentOS systems::\n-\n-    $ sudo yum install binutils\n-\n-Platform-specific instructions\n-==============================\n-\n-.. _macosx:\n-\n-Mac OS X\n---------\n-\n-Because of the variety of packaging systems available for OS X, users have\n-several different options for installing GeoDjango. These options are:\n-\n-* :ref:`homebrew`\n-* :ref:`kyngchaos`\n-* :ref:`fink`\n-* :ref:`macports`\n-* :ref:`build_from_source`\n-\n-.. note::\n-\n-    Currently, the easiest and recommended approach for installing GeoDjango\n-    on OS X is to use the KyngChaos packages.\n-\n-This section also includes instructions for installing an upgraded version\n-of :ref:`macosx_python` from packages provided by the Python Software\n-Foundation, however, this is not required.\n-\n-.. _macosx_python:\n-\n-Python\n-^^^^^^\n-\n-Although OS X comes with Python installed, users can use framework\n-installers (`2.6`__ and `2.7`__ are available) provided by\n-the Python Software Foundation.  An advantage to using the installer is\n-that OS X's Python will remain \"pristine\" for internal operating system\n-use.\n-\n-__ http://python.org/ftp/python/2.6.6/python-2.6.6-macosx10.3.dmg\n-__ http://python.org/ftp/python/2.7.3/\n-\n-.. note::\n-\n-    You will need to modify the ``PATH`` environment variable in your\n-    ``.profile`` file so that the new version of Python is used when\n-    ``python`` is entered at the command-line::\n-\n-        export PATH=/Library/Frameworks/Python.framework/Versions/Current/bin:$PATH\n-\n-.. _homebrew:\n-\n-Homebrew\n-^^^^^^^^\n-\n-`Homebrew`__ provides \"recipes\" for building binaries and packages from source.\n-It provides recipes for the GeoDjango prerequisites on Macintosh computers\n-running OS X. Because Homebrew still builds the software from source, the\n-`Apple Developer Tools`_ are required.\n-\n-Summary::\n-\n-    $ brew install postgresql\n-    $ brew install postgis\n-    $ brew install gdal\n-    $ brew install libgeoip\n-\n-__ http://mxcl.github.com/homebrew/\n-\n-.. _kyngchaos:\n-\n-KyngChaos packages\n-^^^^^^^^^^^^^^^^^^\n-\n-William Kyngesburye provides a number of `geospatial library binary packages`__\n-that make it simple to get GeoDjango installed on OS X without compiling\n-them from source.  However, the `Apple Developer Tools`_ are still necessary\n-for compiling the Python database adapters :ref:`psycopg2_kyngchaos` (for PostGIS)\n-and :ref:`pysqlite2_kyngchaos` (for SpatiaLite).\n-\n-.. note::\n-\n-    SpatiaLite users should consult the :ref:`spatialite_kyngchaos` section\n-    after installing the packages for additional instructions.\n-\n-Download the framework packages for:\n-\n-* UnixImageIO\n-* PROJ\n-* GEOS\n-* SQLite3 (includes the SpatiaLite library)\n-* GDAL\n-\n-Install the packages in the order they are listed above, as the GDAL and SQLite\n-packages require the packages listed before them.\n-\n-Afterwards, you can also install the KyngChaos binary packages for `PostgreSQL\n-and PostGIS`__.\n-\n-After installing the binary packages, you'll want to add the following to\n-your ``.profile`` to be able to run the package programs from the command-line::\n-\n-    export PATH=/Library/Frameworks/UnixImageIO.framework/Programs:$PATH\n-    export PATH=/Library/Frameworks/PROJ.framework/Programs:$PATH\n-    export PATH=/Library/Frameworks/GEOS.framework/Programs:$PATH\n-    export PATH=/Library/Frameworks/SQLite3.framework/Programs:$PATH\n-    export PATH=/Library/Frameworks/GDAL.framework/Programs:$PATH\n-    export PATH=/usr/local/pgsql/bin:$PATH\n-\n-__ http://www.kyngchaos.com/software/frameworks\n-__ http://www.kyngchaos.com/software/postgres\n-\n-.. _psycopg2_kyngchaos:\n-\n-psycopg2\n-~~~~~~~~\n-\n-After you've installed the KyngChaos binaries and modified your ``PATH``, as\n-described above, ``psycopg2`` may be installed using the following command::\n-\n-    $ sudo pip install psycopg2\n-\n-.. note::\n-\n-    If you don't have ``pip``, follow the the :ref:`installation instructions\n-    <installing-official-release>` to install it.\n-\n-.. _pysqlite2_kyngchaos:\n-\n-pysqlite2\n-~~~~~~~~~\n-\n-Follow the :ref:`pysqlite2` source install instructions, however,\n-when editing the ``setup.cfg`` use the following instead:\n-\n-.. code-block:: ini\n-\n-    [build_ext]\n-    #define=\n-    include_dirs=/Library/Frameworks/SQLite3.framework/unix/include\n-    library_dirs=/Library/Frameworks/SQLite3.framework/unix/lib\n-    libraries=sqlite3\n-    #define=SQLITE_OMIT_LOAD_EXTENSION\n-\n-.. _spatialite_kyngchaos:\n-\n-SpatiaLite\n-~~~~~~~~~~\n-\n-When :ref:`create_spatialite_db`, the ``spatialite`` program is required.\n-However, instead of attempting to compile the SpatiaLite tools from source,\n-download the `SpatiaLite Binaries`__ for OS X, and install ``spatialite`` in a\n-location available in your ``PATH``.  For example::\n-\n-    $ curl -O http://www.gaia-gis.it/spatialite/spatialite-tools-osx-x86-2.3.1.tar.gz\n-    $ tar xzf spatialite-tools-osx-x86-2.3.1.tar.gz\n-    $ cd spatialite-tools-osx-x86-2.3.1/bin\n-    $ sudo cp spatialite /Library/Frameworks/SQLite3.framework/Programs\n-\n-Finally, for GeoDjango to be able to find the KyngChaos SpatiaLite library,\n-add the following to your ``settings.py``:\n-\n-.. code-block:: python\n-\n-    SPATIALITE_LIBRARY_PATH='/Library/Frameworks/SQLite3.framework/SQLite3'\n-\n-__ http://www.gaia-gis.it/spatialite-2.3.1/binaries.html\n-\n-.. _fink:\n-\n-Fink\n-^^^^\n-\n-`Kurt Schwehr`__ has been gracious enough to create GeoDjango packages for users\n-of the `Fink`__ package system.  The following packages are available, depending\n-on which version of Python you want to use:\n-\n-* ``django-gis-py26``\n-* ``django-gis-py25``\n-* ``django-gis-py24``\n-\n-__ http://schwehr.org/blog/\n-__ http://www.finkproject.org/\n-\n-.. _macports:\n-\n-MacPorts\n-^^^^^^^^\n-\n-`MacPorts`__ may be used to install GeoDjango prerequisites on Macintosh\n-computers running OS X.  Because MacPorts still builds the software from source,\n-the `Apple Developer Tools`_ are required.\n-\n-Summary::\n-\n-    $ sudo port install postgresql83-server\n-    $ sudo port install geos\n-    $ sudo port install proj\n-    $ sudo port install postgis\n-    $ sudo port install gdal +geos\n-    $ sudo port install libgeoip\n-\n-.. note::\n-\n-    You will also have to modify the ``PATH`` in your ``.profile`` so\n-    that the MacPorts programs are accessible from the command-line::\n-\n-        export PATH=/opt/local/bin:/opt/local/lib/postgresql83/bin\n-\n-    In addition, add the ``DYLD_FALLBACK_LIBRARY_PATH`` setting so that\n-    the libraries can be found by Python::\n-\n-        export DYLD_FALLBACK_LIBRARY_PATH=/opt/local/lib:/opt/local/lib/postgresql83\n-\n-__ http://www.macports.org/\n-\n-.. _ubuntudebian:\n-\n-Ubuntu & Debian GNU/Linux\n--------------------------\n-\n-.. note::\n-\n-    The PostGIS SQL files are not placed in the PostgreSQL share directory in\n-    the Debian and Ubuntu packages. Instead, they're located in a special\n-    directory depending on the release. In this case, use the\n-    :download:`create_template_postgis-debian.sh` script\n-\n-.. _ubuntu:\n-\n-Ubuntu\n-^^^^^^\n-\n-11.10 through 12.04\n-~~~~~~~~~~~~~~~~~~~\n-\n-In Ubuntu 11.10, PostgreSQL was upgraded to 9.1. The installation command is:\n-\n-.. code-block:: bash\n-\n-    $ sudo apt-get install binutils gdal-bin libproj-dev \\\n-         postgresql-9.1-postgis postgresql-server-dev-9.1 python-psycopg2\n-\n-.. _ubuntu10:\n-\n-10.04 through 11.04\n-~~~~~~~~~~~~~~~~~~~\n-\n-In Ubuntu 10.04, PostgreSQL was upgraded to 8.4 and GDAL was upgraded to 1.6.\n-Ubuntu 10.04 uses PostGIS 1.4, while Ubuntu 10.10 uses PostGIS 1.5 (with\n-geography support).  The installation command is:\n-\n-.. code-block:: bash\n-\n-    $ sudo apt-get install binutils gdal-bin libproj-dev postgresql-8.4-postgis \\\n-         postgresql-server-dev-8.4 python-psycopg2\n-\n-.. _ibex:\n-\n-8.10\n-~~~~\n-\n-Use the synaptic package manager to install the following packages:\n-\n-.. code-block:: bash\n-\n-    $ sudo apt-get install binutils gdal-bin postgresql-8.3-postgis \\\n-        postgresql-server-dev-8.3 python-psycopg2\n-\n-That's it!  For the curious, the required binary prerequisites packages are:\n-\n-* ``binutils``: for ctypes to find libraries\n-* ``postgresql-8.3``\n-* ``postgresql-server-dev-8.3``: for ``pg_config``\n-* ``postgresql-8.3-postgis``: for PostGIS 1.3.3\n-* ``libgeos-3.0.0``, and ``libgeos-c1``: for GEOS 3.0.0\n-* ``libgdal1-1.5.0``: for GDAL 1.5.0 library\n-* ``proj``: for PROJ 4.6.0 -- but no datum shifting files, see note below\n-* ``python-psycopg2``\n-\n-Optional packages to consider:\n-\n-* ``libgeoip1``: for :ref:`GeoIP <ref-geoip>` support\n-* ``gdal-bin``: for GDAL command line programs like ``ogr2ogr``\n-* ``python-gdal`` for GDAL's own Python bindings -- includes interfaces for raster manipulation\n-\n-.. note::\n-\n-    On this version of Ubuntu the ``proj`` package does not come with the\n-    datum shifting files installed, which will cause problems with the\n-    geographic admin because the ``null`` datum grid is not available for\n-    transforming geometries to the spherical mercator projection. A solution\n-    is to download the datum-shifting files, create the grid file, and\n-    install it yourself:\n-\n-    .. code-block:: bash\n-\n-        $ wget http://download.osgeo.org/proj/proj-datumgrid-1.4.tar.gz\n-        $ mkdir nad\n-        $ cd nad\n-        $ tar xzf ../proj-datumgrid-1.4.tar.gz\n-        $ nad2bin null < null.lla\n-        $ sudo cp null /usr/share/proj\n-\n-    Otherwise, the Ubuntu ``proj`` package is fine for general use as long as you\n-    do not plan on doing any database transformation of geometries to the\n-    Google projection (900913).\n-\n-.. _debian:\n-\n-Debian\n-------\n-\n-.. _lenny:\n-\n-5.0 (Lenny)\n-^^^^^^^^^^^\n-\n-This version is comparable to Ubuntu :ref:`ibex`, so the command\n-is very similar:\n-\n-.. code-block:: bash\n-\n-    $ sudo apt-get install binutils libgdal1-1.5.0 postgresql-8.3 \\\n-        postgresql-8.3-postgis postgresql-server-dev-8.3 \\\n-        python-psycopg2 python-setuptools\n-\n-This assumes that you are using PostgreSQL version 8.3. Else, replace ``8.3``\n-in the above command with the appropriate PostgreSQL version.\n-\n-.. note::\n-\n-   Please read the note in the Ubuntu :ref:`ibex` install documentation\n-   about the ``proj`` package -- it also applies here because the package does\n-   not include the datum shifting files.\n-\n-.. _post_install:\n-\n-Post-installation notes\n-~~~~~~~~~~~~~~~~~~~~~~~\n-\n-If the PostgreSQL database cluster was not initiated after installing, then it\n-can be created (and started) with the following command:\n-\n-.. code-block:: bash\n-\n-    $ sudo pg_createcluster --start 8.3 main\n-\n-Afterwards, the ``/etc/init.d/postgresql-8.3`` script should be used to manage\n-the starting and stopping of PostgreSQL.\n-\n-In addition, the SQL files for PostGIS are placed in a different location on\n-Debian 5.0 . Thus when :ref:`spatialdb_template` either:\n-\n-* Create a symbolic link to these files:\n-\n-  .. code-block:: bash\n-\n-    $ sudo ln -s /usr/share/postgresql-8.3-postgis/{lwpostgis,spatial_ref_sys}.sql \\\n-        /usr/share/postgresql/8.3\n-\n-  If not running PostgreSQL 8.3, then  replace ``8.3`` in the command above with\n-  the correct version.\n-\n-* Or use the :download:`create_template_postgis-debian.sh` to create the spatial database.\n-\n-.. _windows:\n-\n-Windows\n--------\n-\n-Proceed through the following sections sequentially in order to install\n-GeoDjango on Windows.\n-\n-.. note::\n-\n-    These instructions assume that you are using 32-bit versions of\n-    all programs.  While 64-bit versions of Python and PostgreSQL 9.0\n-    are available, 64-bit versions of spatial libraries, like\n-    GEOS and GDAL, are not yet provided by the :ref:`OSGeo4W` installer.\n-\n-Python\n-^^^^^^\n-\n-First, download the latest `Python 2.7 installer`__ from the Python Web site.\n-Next, run the installer and keep the defaults -- for example, keep\n-'Install for all users' checked and the installation path set as\n-``C:\\Python27``.\n-\n-.. note::\n-\n-    You may already have a version of Python installed in ``C:\\python`` as ESRI\n-    products sometimes install a copy there.  *You should still install a\n-    fresh version of Python 2.7.*\n-\n-__ http://python.org/download/\n-\n-PostgreSQL\n-^^^^^^^^^^\n-\n-First, download the latest `PostgreSQL 9.0 installer`__ from the\n-`EnterpriseDB`__ Web site.  After downloading, simply run the installer,\n-follow the on-screen directions, and keep the default options unless\n-you know the consequences of changing them.\n-\n-.. note::\n-\n-    The PostgreSQL installer creates both a new Windows user to be the\n-    'postgres service account' and a ``postgres`` database superuser\n-    You will be prompted once to set the password for both accounts --\n-    make sure to remember it!\n-\n-When the installer completes, it will ask to launch the Application Stack\n-Builder (ASB) on exit -- keep this checked, as it is necessary to\n-install :ref:`postgisasb`.\n-\n-.. note::\n-\n-    If installed successfully, the PostgreSQL server will run in the\n-    background each time the system as started as a Windows service.\n-    A :menuselection:`PostgreSQL 9.0` start menu group will created\n-    and contains shortcuts for the ASB as well as the 'SQL Shell',\n-    which will launch a ``psql`` command window.\n-\n-__ http://www.enterprisedb.com/products-services-training/pgdownload\n-__ http://www.enterprisedb.com\n-\n-.. _postgisasb:\n-\n-PostGIS\n-^^^^^^^\n-\n-From within the Application Stack Builder (to run outside of the installer,\n-:menuselection:`Start --> Programs --> PostgreSQL 9.0`), select\n-:menuselection:`PostgreSQL Database Server 9.0 on port 5432` from the drop down\n-menu.  Next, expand the :menuselection:`Categories --> Spatial Extensions` menu\n-tree and select :menuselection:`PostGIS 1.5 for PostgreSQL 9.0`.\n-\n-After clicking next, you will be prompted to select your mirror, PostGIS\n-will be downloaded, and the PostGIS installer will begin.  Select only the\n-default options during install (e.g., do not uncheck the option to create a\n-default PostGIS database).\n-\n-.. note::\n-\n-    You will be prompted to enter your ``postgres`` database superuser\n-    password in the 'Database Connection Information' dialog.\n-\n-psycopg2\n-^^^^^^^^\n-\n-The ``psycopg2`` Python module provides the interface between Python and the\n-PostgreSQL database.  Download the latest `Windows installer`__ for your version\n-of Python and PostgreSQL and run using the default settings. [#]_\n-\n-__ http://www.stickpeople.com/projects/python/win-psycopg/\n-\n-.. _osgeo4w:\n-\n-OSGeo4W\n-^^^^^^^\n-\n-The `OSGeo4W installer`_ makes it simple to install the PROJ.4, GDAL, and GEOS\n-libraries required by GeoDjango.  First, download the `OSGeo4W installer`_,\n-and run it.  Select :menuselection:`Express Web-GIS Install` and click next.\n-In the 'Select Packages' list, ensure that GDAL is selected; MapServer and\n-Apache are also enabled by default, but are not required by GeoDjango and\n-may be unchecked safely.  After clicking next, the packages will be\n-automatically downloaded and installed, after which you may exit the\n-installer.\n-\n-.. _OSGeo4W installer: http://trac.osgeo.org/osgeo4w/\n-\n-Modify Windows environment\n-^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-In order to use GeoDjango, you will need to add your Python and OSGeo4W\n-directories to your Windows system ``Path``, as well as create ``GDAL_DATA``\n-and ``PROJ_LIB`` environment variables.  The following set of commands,\n-executable with ``cmd.exe``, will set this up:\n-\n-.. code-block:: bat\n-\n-     set OSGEO4W_ROOT=C:\\OSGeo4W\n-     set PYTHON_ROOT=C:\\Python27\n-     set GDAL_DATA=%OSGEO4W_ROOT%\\share\\gdal\n-     set PROJ_LIB=%OSGEO4W_ROOT%\\share\\proj\n-     set PATH=%PATH%;%PYTHON_ROOT%;%OSGEO4W_ROOT%\\bin\n-     reg ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v Path /t REG_EXPAND_SZ /f /d \"%PATH%\"\n-     reg ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v GDAL_DATA /t REG_EXPAND_SZ /f /d \"%GDAL_DATA%\"\n-     reg ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v PROJ_LIB /t REG_EXPAND_SZ /f /d \"%PROJ_LIB%\"\n-\n-For your convenience, these commands are available in the executable batch\n-script, :download:`geodjango_setup.bat`.\n-\n-.. note::\n-\n-    Administrator privileges are required to execute these commands.\n-    To do this, right-click on :download:`geodjango_setup.bat` and select\n-    :menuselection:`Run as administrator`. You need to log out and log back in again\n-    for the settings to take effect.\n-\n-.. note::\n-\n-    If you customized the Python or OSGeo4W installation directories,\n-    then you will need to modify the ``OSGEO4W_ROOT`` and/or ``PYTHON_ROOT``\n-    variables accordingly.\n-\n-Install Django and set up database\n-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-\n-Finally, :ref:`install Django <installing-official-release>` on your system.\n-You do not need to create a spatial database template, as one named\n-``template_postgis`` is created for you when installing PostGIS.\n-\n-To administer the database, you can either use the pgAdmin III program\n-(:menuselection:`Start --> PostgreSQL 9.0 --> pgAdmin III`) or the\n-SQL Shell (:menuselection:`Start --> PostgreSQL 9.0 --> SQL Shell`).\n-For example, to create a ``geodjango`` spatial database and user, the following\n-may be executed from the SQL Shell as the ``postgres`` user::\n-\n-    postgres# CREATE USER geodjango PASSWORD 'my_passwd';\n-    postgres# CREATE DATABASE geodjango OWNER geodjango TEMPLATE template_postgis ENCODING 'utf8';\n-\n-.. rubric:: Footnotes\n-.. [#] The datum shifting files are needed for converting data to and from\n-       certain projections.\n-       For example, the PROJ.4 string for the `Google projection (900913 or 3857)\n-       <http://spatialreference.org/ref/sr-org/6864/prj/>`_ requires the\n-       ``null`` grid file only included in the extra datum shifting files.\n-       It is easier to install the shifting files now, then to have debug a\n-       problem caused by their absence later.\n-.. [#] Specifically, GeoDjango provides support for the `OGR\n-       <http://gdal.org/ogr>`_ library, a component of GDAL.\n-.. [#] See `GDAL ticket #2382 <http://trac.osgeo.org/gdal/ticket/2382>`_.\n-.. [#] GeoDjango uses the :func:`~ctypes.util.find_library` routine from\n-       :mod:`ctypes.util` to locate shared libraries.\n-.. [#] The ``psycopg2`` Windows installers are packaged and maintained by\n-       `Jason Erickson <http://www.stickpeople.com/projects/python/win-psycopg/>`_."
        },
        {
            "sha": "c9ab4fcebfbe26c401485ff83371db99b89a0871",
            "filename": "docs/ref/contrib/gis/install/create_template_postgis-1.3.sh",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.3.sh",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.3.sh",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.3.sh?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "previous_filename": "docs/ref/contrib/gis/create_template_postgis-1.3.sh"
        },
        {
            "sha": "57a1373f9604053ae2ca4df72e4eff74991dbe40",
            "filename": "docs/ref/contrib/gis/install/create_template_postgis-1.4.sh",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.4.sh",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.4.sh",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.4.sh?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "previous_filename": "docs/ref/contrib/gis/create_template_postgis-1.4.sh"
        },
        {
            "sha": "081b5f2656e5b96ff7a56fd043a936ea35c23466",
            "filename": "docs/ref/contrib/gis/install/create_template_postgis-1.5.sh",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.5.sh",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.5.sh",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-1.5.sh?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "previous_filename": "docs/ref/contrib/gis/create_template_postgis-1.5.sh"
        },
        {
            "sha": "3e621837fa69c6856c3fa02d339e274541b4dba4",
            "filename": "docs/ref/contrib/gis/install/create_template_postgis-debian.sh",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-debian.sh",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-debian.sh",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fcreate_template_postgis-debian.sh?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "previous_filename": "docs/ref/contrib/gis/create_template_postgis-debian.sh"
        },
        {
            "sha": "b3e6cc6822ac78d2c51f1a7e4f83b638bd9f9ec5",
            "filename": "docs/ref/contrib/gis/install/geodjango_setup.bat",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fgeodjango_setup.bat",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fgeodjango_setup.bat",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fgeodjango_setup.bat?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "previous_filename": "docs/ref/contrib/gis/geodjango_setup.bat"
        },
        {
            "sha": "c78f0c0e629f21a812f01b5ef31b27334e92521d",
            "filename": "docs/ref/contrib/gis/install/geolibs.txt",
            "status": "added",
            "additions": 282,
            "deletions": 0,
            "changes": 282,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fgeolibs.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fgeolibs.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fgeolibs.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,282 @@\n+.. _geospatial_libs:\n+\n+===============================\n+Installing Geospatial libraries\n+===============================\n+\n+GeoDjango uses and/or provides interfaces for the following open source\n+geospatial libraries:\n+\n+========================  ====================================  ================================  ==========================\n+Program                   Description                           Required                          Supported Versions\n+========================  ====================================  ================================  ==========================\n+:ref:`GEOS <ref-geos>`    Geometry Engine Open Source           Yes                               3.3, 3.2, 3.1, 3.0\n+`PROJ.4`_                 Cartographic Projections library      Yes (PostgreSQL and SQLite only)  4.8, 4.7, 4.6, 4.5, 4.4\n+:ref:`GDAL <ref-gdal>`    Geospatial Data Abstraction Library   No (but, required for SQLite)     1.9, 1.8, 1.7, 1.6, 1.5\n+:ref:`GeoIP <ref-geoip>`  IP-based geolocation library          No                                1.4\n+`PostGIS`__               Spatial extensions for PostgreSQL     Yes (PostgreSQL only)             2.0, 1.5, 1.4, 1.3\n+`SpatiaLite`__            Spatial extensions for SQLite         Yes (SQLite only)                 3.0, 2.4, 2.3\n+========================  ====================================  ================================  ==========================\n+\n+.. admonition::  Install GDAL\n+\n+    While :ref:`gdalbuild` is technically not required, it is *recommended*.\n+    Important features of GeoDjango (including the :ref:`ref-layermapping`,\n+    geometry reprojection, and the geographic admin) depend on its\n+    functionality.\n+\n+.. note::\n+\n+    The GeoDjango interfaces to GEOS, GDAL, and GeoIP may be used\n+    independently of Django.  In other words, no database or settings file\n+    required -- just import them as normal from :mod:`django.contrib.gis`.\n+\n+.. _PROJ.4: http://trac.osgeo.org/proj/\n+__ http://postgis.refractions.net/\n+__ http://www.gaia-gis.it/gaia-sins/\n+\n+\n+On Debian/Ubuntu, you are advised to install the following packages which will\n+install, directly or by dependency, the required geospatial libraries:\n+\n+.. code-block:: bash\n+\n+    $ sudo apt-get install binutils libproj-dev gdal-bin\n+\n+Optional packages to consider:\n+\n+* ``libgeoip1``: for :ref:`GeoIP <ref-geoip>` support\n+* ``gdal-bin``: for GDAL command line programs like ``ogr2ogr``\n+* ``python-gdal`` for GDAL's own Python bindings -- includes interfaces for raster manipulation\n+\n+Please also consult platform-specific instructions if you are on :ref:`macosx`\n+or :ref:`windows`.\n+\n+.. _build_from_source:\n+\n+Building from source\n+====================\n+\n+When installing from source on UNIX and GNU/Linux systems, please follow\n+the installation instructions carefully, and install the libraries in the\n+given order.  If using MySQL or Oracle as the spatial database, only GEOS\n+is required.\n+\n+.. note::\n+\n+   On Linux platforms, it may be necessary to run the ``ldconfig``\n+   command after installing each library.  For example::\n+\n+       $ sudo make install\n+       $ sudo ldconfig\n+\n+.. note::\n+\n+    OS X users are required to install `Apple Developer Tools`_ in order\n+    to compile software from source.  This is typically included on your\n+    OS X installation DVDs.\n+\n+.. _Apple Developer Tools: https://developer.apple.com/technologies/tools/\n+\n+.. _geosbuild:\n+\n+GEOS\n+----\n+\n+GEOS is a C++ library for performing geometric operations, and is the default\n+internal geometry representation used by GeoDjango (it's behind the \"lazy\"\n+geometries).  Specifically, the C API library is called (e.g., ``libgeos_c.so``)\n+directly from Python using ctypes.\n+\n+First, download GEOS 3.3.5 from the refractions Web site and untar the source\n+archive::\n+\n+    $ wget http://download.osgeo.org/geos/geos-3.3.5.tar.bz2\n+    $ tar xjf geos-3.3.5.tar.bz2\n+\n+Next, change into the directory where GEOS was unpacked, run the configure\n+script, compile, and install::\n+\n+    $ cd geos-3.3.5\n+    $ ./configure\n+    $ make\n+    $ sudo make install\n+    $ cd ..\n+\n+Troubleshooting\n+^^^^^^^^^^^^^^^\n+\n+Can't find GEOS library\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+When GeoDjango can't find GEOS, this error is raised:\n+\n+.. code-block:: text\n+\n+    ImportError: Could not find the GEOS library (tried \"geos_c\"). Try setting GEOS_LIBRARY_PATH in your settings.\n+\n+The most common solution is to properly configure your :ref:`libsettings` *or* set\n+:ref:`geoslibrarypath` in your settings.\n+\n+If using a binary package of GEOS (e.g., on Ubuntu), you may need to :ref:`binutils`.\n+\n+.. _geoslibrarypath:\n+\n+``GEOS_LIBRARY_PATH``\n+~~~~~~~~~~~~~~~~~~~~~\n+\n+If your GEOS library is in a non-standard location, or you don't want to\n+modify the system's library path then the :setting:`GEOS_LIBRARY_PATH`\n+setting may be added to your Django settings file with the full path to the\n+GEOS C library.  For example:\n+\n+.. code-block:: python\n+\n+    GEOS_LIBRARY_PATH = '/home/bob/local/lib/libgeos_c.so'\n+\n+.. note::\n+\n+    The setting must be the *full* path to the **C** shared library; in\n+    other words you want to use ``libgeos_c.so``, not ``libgeos.so``.\n+\n+See also :ref:`My logs are filled with GEOS-related errors <geos-exceptions-in-logfile>`.\n+\n+.. _proj4:\n+\n+PROJ.4\n+------\n+\n+`PROJ.4`_ is a library for converting geospatial data to different coordinate\n+reference systems.\n+\n+First, download the PROJ.4 source code and datum shifting files [#]_::\n+\n+    $ wget http://download.osgeo.org/proj/proj-4.8.0.tar.gz\n+    $ wget http://download.osgeo.org/proj/proj-datumgrid-1.5.tar.gz\n+\n+Next, untar the source code archive, and extract the datum shifting files in the\n+``nad`` subdirectory.  This must be done *prior* to configuration::\n+\n+    $ tar xzf proj-4.8.0.tar.gz\n+    $ cd proj-4.8.0/nad\n+    $ tar xzf ../../proj-datumgrid-1.5.tar.gz\n+    $ cd ..\n+\n+Finally, configure, make and install PROJ.4::\n+\n+    $ ./configure\n+    $ make\n+    $ sudo make install\n+    $ cd ..\n+\n+.. _gdalbuild:\n+\n+GDAL\n+----\n+\n+`GDAL`__ is an excellent open source geospatial library that has support for\n+reading most vector and raster spatial data formats.  Currently, GeoDjango only\n+supports :ref:`GDAL's vector data <ref-gdal>` capabilities [#]_.\n+:ref:`geosbuild` and :ref:`proj4` should be installed prior to building GDAL.\n+\n+First download the latest GDAL release version and untar the archive::\n+\n+    $ wget http://download.osgeo.org/gdal/gdal-1.9.1.tar.gz\n+    $ tar xzf gdal-1.9.1.tar.gz\n+    $ cd gdal-1.9.1\n+\n+Configure, make and install::\n+\n+    $ ./configure\n+    $ make # Go get some coffee, this takes a while.\n+    $ sudo make install\n+    $ cd ..\n+\n+.. note::\n+\n+   Because GeoDjango has it's own Python interface, the preceding instructions\n+   do not build GDAL's own Python bindings.  The bindings may be built by\n+   adding the ``--with-python`` flag when running ``configure``.  See\n+   `GDAL/OGR In Python`__ for more information on GDAL's bindings.\n+\n+If you have any problems, please see the troubleshooting section below for\n+suggestions and solutions.\n+\n+__ http://trac.osgeo.org/gdal/\n+__ http://trac.osgeo.org/gdal/wiki/GdalOgrInPython\n+\n+.. _gdaltrouble:\n+\n+Troubleshooting\n+^^^^^^^^^^^^^^^\n+\n+Can't find GDAL library\n+~~~~~~~~~~~~~~~~~~~~~~~\n+\n+When GeoDjango can't find the GDAL library, the ``HAS_GDAL`` flag\n+will be false:\n+\n+.. code-block:: pycon\n+\n+    >>> from django.contrib.gis import gdal\n+    >>> gdal.HAS_GDAL\n+    False\n+\n+The solution is to properly configure your :ref:`libsettings` *or* set\n+:ref:`gdallibrarypath` in your settings.\n+\n+.. _gdallibrarypath:\n+\n+``GDAL_LIBRARY_PATH``\n+~~~~~~~~~~~~~~~~~~~~~\n+\n+If your GDAL library is in a non-standard location, or you don't want to\n+modify the system's library path then the :setting:`GDAL_LIBRARY_PATH`\n+setting may be added to your Django settings file with the full path to\n+the GDAL library.  For example:\n+\n+.. code-block:: python\n+\n+    GDAL_LIBRARY_PATH = '/home/sue/local/lib/libgdal.so'\n+\n+.. _gdaldata:\n+\n+Can't find GDAL data files (``GDAL_DATA``)\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+When installed from source, GDAL versions 1.5.1 and below have an autoconf bug\n+that places data in the wrong location. [#]_   This can lead to error messages\n+like this:\n+\n+.. code-block:: text\n+\n+    ERROR 4: Unable to open EPSG support file gcs.csv.\n+    ...\n+    OGRException: OGR failure.\n+\n+The solution is to set the ``GDAL_DATA`` environment variable to the location of the\n+GDAL data files before invoking Python  (typically ``/usr/local/share``; use\n+``gdal-config --datadir`` to find out). For example::\n+\n+    $ export GDAL_DATA=`gdal-config --datadir`\n+    $ python manage.py shell\n+\n+If using Apache, you may need to add this environment variable to your configuration\n+file:\n+\n+.. code-block:: apache\n+\n+    SetEnv GDAL_DATA /usr/local/share\n+\n+.. rubric:: Footnotes\n+.. [#] The datum shifting files are needed for converting data to and from\n+       certain projections.\n+       For example, the PROJ.4 string for the `Google projection (900913 or 3857)\n+       <http://spatialreference.org/ref/sr-org/6864/prj/>`_ requires the\n+       ``null`` grid file only included in the extra datum shifting files.\n+       It is easier to install the shifting files now, then to have debug a\n+       problem caused by their absence later.\n+.. [#] Specifically, GeoDjango provides support for the `OGR\n+       <http://gdal.org/ogr>`_ library, a component of GDAL.\n+.. [#] See `GDAL ticket #2382 <http://trac.osgeo.org/gdal/ticket/2382>`_.\n+"
        },
        {
            "sha": "c710866813faa1d429830e7443c228979211527a",
            "filename": "docs/ref/contrib/gis/install/index.txt",
            "status": "added",
            "additions": 535,
            "deletions": 0,
            "changes": 535,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,535 @@\n+.. _ref-gis-install:\n+\n+======================\n+GeoDjango Installation\n+======================\n+\n+.. highlight:: console\n+\n+Overview\n+========\n+In general, GeoDjango installation requires:\n+\n+1. :ref:`Python and Django <django>`\n+2. :ref:`spatial_database`\n+3. :ref:`geospatial_libs`\n+\n+Details for each of the requirements and installation instructions\n+are provided in the sections below. In addition, platform-specific\n+instructions are available for:\n+\n+* :ref:`macosx`\n+* :ref:`windows`\n+\n+.. admonition:: Use the Source\n+\n+    Because GeoDjango takes advantage of the latest in the open source geospatial\n+    software technology, recent versions of the libraries are necessary.\n+    If binary packages aren't available for your platform, installation from\n+    source may be required. When compiling the libraries from source, please\n+    follow the directions closely, especially if you're a beginner.\n+\n+Requirements\n+============\n+\n+.. _django:\n+\n+Python and Django\n+-----------------\n+\n+Because GeoDjango is included with Django, please refer to Django's\n+:ref:`installation instructions <installing-official-release>` for details on\n+how to install.\n+\n+\n+.. _spatial_database:\n+\n+Spatial database\n+----------------\n+PostgreSQL (with PostGIS), MySQL, Oracle, and SQLite (with SpatiaLite) are\n+the spatial databases currently supported.\n+\n+.. note::\n+\n+    PostGIS is recommended, because it is the most mature and feature-rich\n+    open source spatial database.\n+\n+The geospatial libraries required for a GeoDjango installation depends\n+on the spatial database used.  The following lists the library requirements,\n+supported versions, and any notes for each of the supported database backends:\n+\n+==================  ==============================  ==================  =========================================\n+Database            Library Requirements            Supported Versions  Notes\n+==================  ==============================  ==================  =========================================\n+PostgreSQL          GEOS, PROJ.4, PostGIS           8.2+                Requires PostGIS.\n+MySQL               GEOS                            5.x                 Not OGC-compliant; limited functionality.\n+Oracle              GEOS                            10.2, 11            XE not supported; not tested with 9.\n+SQLite              GEOS, GDAL, PROJ.4, SpatiaLite  3.6.+               Requires SpatiaLite 2.3+, pysqlite2 2.5+\n+==================  ==============================  ==================  =========================================\n+\n+See also `this comparison matrix`__ on the OSGeo Wiki for\n+PostgreSQL/PostGIS/GEOS/GDAL possible combinations.\n+\n+__ http://trac.osgeo.org/postgis/wiki/UsersWikiPostgreSQLPostGIS\n+\n+Installation\n+============\n+\n+Geospatial libraries\n+--------------------\n+\n+.. toctree::\n+   :maxdepth: 1\n+\n+   geolibs\n+\n+Database installation\n+---------------------\n+\n+.. toctree::\n+   :maxdepth: 1\n+\n+   postgis\n+   spatialite\n+\n+Add ``django.contrib.gis`` to :setting:`INSTALLED_APPS`\n+-------------------------------------------------------\n+\n+Like other Django contrib applications, you will *only* need to add\n+:mod:`django.contrib.gis` to :setting:`INSTALLED_APPS` in your settings.\n+This is the so that ``gis`` templates can be located -- if not done, then\n+features such as the geographic admin or KML sitemaps will not function properly.\n+\n+.. _addgoogleprojection:\n+\n+Add Google projection to ``spatial_ref_sys`` table\n+--------------------------------------------------\n+\n+.. note::\n+\n+    If you're running PostGIS 1.4 or above, you can skip this step. The entry\n+    is already included in the default ``spatial_ref_sys`` table.\n+\n+In order to conduct database transformations to the so-called \"Google\"\n+projection (a spherical mercator projection used by Google Maps),\n+an entry must be added to your spatial database's ``spatial_ref_sys`` table.\n+Invoke the Django shell from your project and execute the\n+``add_srs_entry`` function:\n+\n+.. code-block:: pycon\n+\n+    $ python manage shell\n+    >>> from django.contrib.gis.utils import add_srs_entry\n+    >>> add_srs_entry(900913)\n+\n+This adds an entry for the 900913 SRID to the ``spatial_ref_sys`` (or equivalent)\n+table, making it possible for the spatial database to transform coordinates in\n+this projection.  You only need to execute this command *once* per spatial database.\n+\n+Troubleshooting\n+===============\n+\n+If you can't find the solution to your problem here then participate in the\n+community!  You can:\n+\n+* Join the ``#geodjango`` IRC channel on FreeNode. Please be patient and polite\n+  -- while you may not get an immediate response, someone will attempt to answer\n+  your question as soon as they see it.\n+* Ask your question on the `GeoDjango`__ mailing list.\n+* File a ticket on the `Django trac`__ if you think there's a bug.  Make\n+  sure to provide a complete description of the problem, versions used,\n+  and specify the component as \"GIS\".\n+\n+__ http://groups.google.com/group/geodjango\n+__ https://code.djangoproject.com/newticket\n+\n+.. _libsettings:\n+\n+Library environment settings\n+----------------------------\n+\n+By far, the most common problem when installing GeoDjango is that the\n+external shared libraries (e.g., for GEOS and GDAL) cannot be located. [#]_\n+Typically, the cause of this problem is that the operating system isn't aware\n+of the directory where the libraries built from source were installed.\n+\n+In general, the library path may be set on a per-user basis by setting\n+an environment variable, or by configuring the library path for the entire\n+system.\n+\n+``LD_LIBRARY_PATH`` environment variable\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+A user may set this environment variable to customize the library paths\n+they want to use.  The typical library directory for software\n+built from source is ``/usr/local/lib``.  Thus, ``/usr/local/lib`` needs\n+to be included in the ``LD_LIBRARY_PATH`` variable.  For example, the user\n+could place the following in their bash profile::\n+\n+    export LD_LIBRARY_PATH=/usr/local/lib\n+\n+Setting system library path\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+On GNU/Linux systems, there is typically a file in ``/etc/ld.so.conf``, which may include\n+additional paths from files in another directory, such as ``/etc/ld.so.conf.d``.\n+As the root user, add the custom library path (like ``/usr/local/lib``) on a\n+new line in ``ld.so.conf``.  This is *one* example of how to do so::\n+\n+    $ sudo echo /usr/local/lib >> /etc/ld.so.conf\n+    $ sudo ldconfig\n+\n+For OpenSolaris users, the system library path may be modified using the\n+``crle`` utility.  Run ``crle`` with no options to see the current configuration\n+and use ``crle -l`` to set with the new library path.  Be *very* careful when\n+modifying the system library path::\n+\n+    # crle -l $OLD_PATH:/usr/local/lib\n+\n+.. _binutils:\n+\n+Install ``binutils``\n+^^^^^^^^^^^^^^^^^^^^\n+\n+GeoDjango uses the ``find_library`` function (from the ``ctypes.util`` Python\n+module) to discover libraries.  The ``find_library`` routine uses a program\n+called ``objdump`` (part of the ``binutils`` package) to verify a shared\n+library on GNU/Linux systems.  Thus, if ``binutils`` is not installed on your\n+Linux system then Python's ctypes may not be able to find your library even if\n+your library path is set correctly and geospatial libraries were built perfectly.\n+\n+The ``binutils`` package may be installed on Debian and Ubuntu systems using the\n+following command::\n+\n+    $ sudo apt-get install binutils\n+\n+Similarly, on Red Hat and CentOS systems::\n+\n+    $ sudo yum install binutils\n+\n+Platform-specific instructions\n+==============================\n+\n+.. _macosx:\n+\n+Mac OS X\n+--------\n+\n+Because of the variety of packaging systems available for OS X, users have\n+several different options for installing GeoDjango. These options are:\n+\n+* :ref:`homebrew`\n+* :ref:`kyngchaos`\n+* :ref:`fink`\n+* :ref:`macports`\n+* :ref:`build_from_source`\n+\n+.. note::\n+\n+    Currently, the easiest and recommended approach for installing GeoDjango\n+    on OS X is to use the KyngChaos packages.\n+\n+This section also includes instructions for installing an upgraded version\n+of :ref:`macosx_python` from packages provided by the Python Software\n+Foundation, however, this is not required.\n+\n+.. _macosx_python:\n+\n+Python\n+^^^^^^\n+\n+Although OS X comes with Python installed, users can use framework\n+installers (`2.6`__ and `2.7`__ are available) provided by\n+the Python Software Foundation.  An advantage to using the installer is\n+that OS X's Python will remain \"pristine\" for internal operating system\n+use.\n+\n+__ http://python.org/ftp/python/2.6.6/python-2.6.6-macosx10.3.dmg\n+__ http://python.org/ftp/python/2.7.3/\n+\n+.. note::\n+\n+    You will need to modify the ``PATH`` environment variable in your\n+    ``.profile`` file so that the new version of Python is used when\n+    ``python`` is entered at the command-line::\n+\n+        export PATH=/Library/Frameworks/Python.framework/Versions/Current/bin:$PATH\n+\n+.. _homebrew:\n+\n+Homebrew\n+^^^^^^^^\n+\n+`Homebrew`__ provides \"recipes\" for building binaries and packages from source.\n+It provides recipes for the GeoDjango prerequisites on Macintosh computers\n+running OS X. Because Homebrew still builds the software from source, the\n+`Apple Developer Tools`_ are required.\n+\n+Summary::\n+\n+    $ brew install postgresql\n+    $ brew install postgis\n+    $ brew install gdal\n+    $ brew install libgeoip\n+\n+__ http://mxcl.github.com/homebrew/\n+.. _Apple Developer Tools: https://developer.apple.com/technologies/tools/\n+\n+.. _kyngchaos:\n+\n+KyngChaos packages\n+^^^^^^^^^^^^^^^^^^\n+\n+William Kyngesburye provides a number of `geospatial library binary packages`__\n+that make it simple to get GeoDjango installed on OS X without compiling\n+them from source.  However, the `Apple Developer Tools`_ are still necessary\n+for compiling the Python database adapters :ref:`psycopg2_kyngchaos` (for PostGIS)\n+and :ref:`pysqlite2` (for SpatiaLite).\n+\n+.. note::\n+\n+    SpatiaLite users should consult the :ref:`spatialite_macosx` section\n+    after installing the packages for additional instructions.\n+\n+Download the framework packages for:\n+\n+* UnixImageIO\n+* PROJ\n+* GEOS\n+* SQLite3 (includes the SpatiaLite library)\n+* GDAL\n+\n+Install the packages in the order they are listed above, as the GDAL and SQLite\n+packages require the packages listed before them.\n+\n+Afterwards, you can also install the KyngChaos binary packages for `PostgreSQL\n+and PostGIS`__.\n+\n+After installing the binary packages, you'll want to add the following to\n+your ``.profile`` to be able to run the package programs from the command-line::\n+\n+    export PATH=/Library/Frameworks/UnixImageIO.framework/Programs:$PATH\n+    export PATH=/Library/Frameworks/PROJ.framework/Programs:$PATH\n+    export PATH=/Library/Frameworks/GEOS.framework/Programs:$PATH\n+    export PATH=/Library/Frameworks/SQLite3.framework/Programs:$PATH\n+    export PATH=/Library/Frameworks/GDAL.framework/Programs:$PATH\n+    export PATH=/usr/local/pgsql/bin:$PATH\n+\n+__ http://www.kyngchaos.com/software/frameworks\n+__ http://www.kyngchaos.com/software/postgres\n+\n+.. _psycopg2_kyngchaos:\n+\n+psycopg2\n+~~~~~~~~\n+\n+After you've installed the KyngChaos binaries and modified your ``PATH``, as\n+described above, ``psycopg2`` may be installed using the following command::\n+\n+    $ sudo pip install psycopg2\n+\n+.. note::\n+\n+    If you don't have ``pip``, follow the the :ref:`installation instructions\n+    <installing-official-release>` to install it.\n+\n+.. _fink:\n+\n+Fink\n+^^^^\n+\n+`Kurt Schwehr`__ has been gracious enough to create GeoDjango packages for users\n+of the `Fink`__ package system.  The following packages are available, depending\n+on which version of Python you want to use:\n+\n+* ``django-gis-py26``\n+* ``django-gis-py25``\n+* ``django-gis-py24``\n+\n+__ http://schwehr.org/blog/\n+__ http://www.finkproject.org/\n+\n+.. _macports:\n+\n+MacPorts\n+^^^^^^^^\n+\n+`MacPorts`__ may be used to install GeoDjango prerequisites on Macintosh\n+computers running OS X.  Because MacPorts still builds the software from source,\n+the `Apple Developer Tools`_ are required.\n+\n+Summary::\n+\n+    $ sudo port install postgresql83-server\n+    $ sudo port install geos\n+    $ sudo port install proj\n+    $ sudo port install postgis\n+    $ sudo port install gdal +geos\n+    $ sudo port install libgeoip\n+\n+.. note::\n+\n+    You will also have to modify the ``PATH`` in your ``.profile`` so\n+    that the MacPorts programs are accessible from the command-line::\n+\n+        export PATH=/opt/local/bin:/opt/local/lib/postgresql83/bin\n+\n+    In addition, add the ``DYLD_FALLBACK_LIBRARY_PATH`` setting so that\n+    the libraries can be found by Python::\n+\n+        export DYLD_FALLBACK_LIBRARY_PATH=/opt/local/lib:/opt/local/lib/postgresql83\n+\n+__ http://www.macports.org/\n+\n+.. _windows:\n+\n+Windows\n+-------\n+\n+Proceed through the following sections sequentially in order to install\n+GeoDjango on Windows.\n+\n+.. note::\n+\n+    These instructions assume that you are using 32-bit versions of\n+    all programs.  While 64-bit versions of Python and PostgreSQL 9.0\n+    are available, 64-bit versions of spatial libraries, like\n+    GEOS and GDAL, are not yet provided by the :ref:`OSGeo4W` installer.\n+\n+Python\n+^^^^^^\n+\n+First, download the latest `Python 2.7 installer`__ from the Python Web site.\n+Next, run the installer and keep the defaults -- for example, keep\n+'Install for all users' checked and the installation path set as\n+``C:\\Python27``.\n+\n+.. note::\n+\n+    You may already have a version of Python installed in ``C:\\python`` as ESRI\n+    products sometimes install a copy there.  *You should still install a\n+    fresh version of Python 2.7.*\n+\n+__ http://python.org/download/\n+\n+PostgreSQL\n+^^^^^^^^^^\n+\n+First, download the latest `PostgreSQL 9.0 installer`__ from the\n+`EnterpriseDB`__ Web site.  After downloading, simply run the installer,\n+follow the on-screen directions, and keep the default options unless\n+you know the consequences of changing them.\n+\n+.. note::\n+\n+    The PostgreSQL installer creates both a new Windows user to be the\n+    'postgres service account' and a ``postgres`` database superuser\n+    You will be prompted once to set the password for both accounts --\n+    make sure to remember it!\n+\n+When the installer completes, it will ask to launch the Application Stack\n+Builder (ASB) on exit -- keep this checked, as it is necessary to\n+install :ref:`postgisasb`.\n+\n+.. note::\n+\n+    If installed successfully, the PostgreSQL server will run in the\n+    background each time the system as started as a Windows service.\n+    A :menuselection:`PostgreSQL 9.0` start menu group will created\n+    and contains shortcuts for the ASB as well as the 'SQL Shell',\n+    which will launch a ``psql`` command window.\n+\n+__ http://www.enterprisedb.com/products-services-training/pgdownload\n+__ http://www.enterprisedb.com\n+\n+.. _postgisasb:\n+\n+PostGIS\n+^^^^^^^\n+\n+From within the Application Stack Builder (to run outside of the installer,\n+:menuselection:`Start --> Programs --> PostgreSQL 9.0`), select\n+:menuselection:`PostgreSQL Database Server 9.0 on port 5432` from the drop down\n+menu.  Next, expand the :menuselection:`Categories --> Spatial Extensions` menu\n+tree and select :menuselection:`PostGIS 1.5 for PostgreSQL 9.0`.\n+\n+After clicking next, you will be prompted to select your mirror, PostGIS\n+will be downloaded, and the PostGIS installer will begin.  Select only the\n+default options during install (e.g., do not uncheck the option to create a\n+default PostGIS database).\n+\n+.. note::\n+\n+    You will be prompted to enter your ``postgres`` database superuser\n+    password in the 'Database Connection Information' dialog.\n+\n+psycopg2\n+^^^^^^^^\n+\n+The ``psycopg2`` Python module provides the interface between Python and the\n+PostgreSQL database.  Download the latest `Windows installer`__ for your version\n+of Python and PostgreSQL and run using the default settings. [#]_\n+\n+__ http://www.stickpeople.com/projects/python/win-psycopg/\n+\n+.. _osgeo4w:\n+\n+OSGeo4W\n+^^^^^^^\n+\n+The `OSGeo4W installer`_ makes it simple to install the PROJ.4, GDAL, and GEOS\n+libraries required by GeoDjango.  First, download the `OSGeo4W installer`_,\n+and run it.  Select :menuselection:`Express Web-GIS Install` and click next.\n+In the 'Select Packages' list, ensure that GDAL is selected; MapServer and\n+Apache are also enabled by default, but are not required by GeoDjango and\n+may be unchecked safely.  After clicking next, the packages will be\n+automatically downloaded and installed, after which you may exit the\n+installer.\n+\n+.. _OSGeo4W installer: http://trac.osgeo.org/osgeo4w/\n+\n+Modify Windows environment\n+^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+In order to use GeoDjango, you will need to add your Python and OSGeo4W\n+directories to your Windows system ``Path``, as well as create ``GDAL_DATA``\n+and ``PROJ_LIB`` environment variables.  The following set of commands,\n+executable with ``cmd.exe``, will set this up:\n+\n+.. code-block:: bat\n+\n+     set OSGEO4W_ROOT=C:\\OSGeo4W\n+     set PYTHON_ROOT=C:\\Python27\n+     set GDAL_DATA=%OSGEO4W_ROOT%\\share\\gdal\n+     set PROJ_LIB=%OSGEO4W_ROOT%\\share\\proj\n+     set PATH=%PATH%;%PYTHON_ROOT%;%OSGEO4W_ROOT%\\bin\n+     reg ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v Path /t REG_EXPAND_SZ /f /d \"%PATH%\"\n+     reg ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v GDAL_DATA /t REG_EXPAND_SZ /f /d \"%GDAL_DATA%\"\n+     reg ADD \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Environment\" /v PROJ_LIB /t REG_EXPAND_SZ /f /d \"%PROJ_LIB%\"\n+\n+For your convenience, these commands are available in the executable batch\n+script, :download:`geodjango_setup.bat`.\n+\n+.. note::\n+\n+    Administrator privileges are required to execute these commands.\n+    To do this, right-click on :download:`geodjango_setup.bat` and select\n+    :menuselection:`Run as administrator`. You need to log out and log back in again\n+    for the settings to take effect.\n+\n+.. note::\n+\n+    If you customized the Python or OSGeo4W installation directories,\n+    then you will need to modify the ``OSGEO4W_ROOT`` and/or ``PYTHON_ROOT``\n+    variables accordingly.\n+\n+Install Django and set up database\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Finally, :ref:`install Django <installing-official-release>` on your system.\n+\n+.. rubric:: Footnotes\n+.. [#] GeoDjango uses the :func:`~ctypes.util.find_library` routine from\n+       :mod:`ctypes.util` to locate shared libraries.\n+.. [#] The ``psycopg2`` Windows installers are packaged and maintained by\n+       `Jason Erickson <http://www.stickpeople.com/projects/python/win-psycopg/>`_."
        },
        {
            "sha": "6d7fe88203e269c21e759e0c1feffe7cd2ff9222",
            "filename": "docs/ref/contrib/gis/install/postgis.txt",
            "status": "added",
            "additions": 175,
            "deletions": 0,
            "changes": 175,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fpostgis.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fpostgis.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fpostgis.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4",
            "patch": "@@ -0,0 +1,175 @@\n+.. _postgis:\n+\n+==================\n+Installing PostGIS\n+==================\n+\n+`PostGIS`__ adds geographic object support to PostgreSQL, turning it\n+into a spatial database. :ref:`geosbuild`, :ref:`proj4` and\n+:ref:`gdalbuild` should be installed prior to building PostGIS. You\n+might also need additional libraries, see `PostGIS requirements`_.\n+\n+.. note::\n+\n+    The `psycopg2`_ module is required for use as the database adaptor\n+    when using GeoDjango with PostGIS.\n+\n+.. _psycopg2: http://initd.org/psycopg/\n+.. _PostGIS requirements: http://www.postgis.org/documentation/manual-2.0/postgis_installation.html#id2711662\n+\n+On Debian/Ubuntu, you are advised to install the following packages:\n+postgresql-x.x, postgresql-x.x-postgis, postgresql-server-dev-x.x,\n+python-psycopg2 (x.x matching the PostgreSQL version you want to install).\n+Please also consult platform-specific instructions if you are on :ref:`macosx`\n+or :ref:`windows`.\n+\n+Building from source\n+====================\n+\n+First download the source archive, and extract::\n+\n+    $ wget http://postgis.refractions.net/download/postgis-2.0.1.tar.gz\n+    $ tar xzf postgis-2.0.1.tar.gz\n+    $ cd postgis-2.0.1\n+\n+Next, configure, make and install PostGIS::\n+\n+    $ ./configure\n+\n+Finally, make and install::\n+\n+    $ make\n+    $ sudo make install\n+    $ cd ..\n+\n+.. note::\n+\n+    GeoDjango does not automatically create a spatial database.  Please consult\n+    the section on :ref:`spatialdb_template91` or\n+    :ref:`spatialdb_template_earlier` for more information.\n+\n+__ http://postgis.refractions.net/\n+\n+Post-installation\n+=================\n+\n+.. _spatialdb_template:\n+.. _spatialdb_template91:\n+\n+Creating a spatial database with PostGIS 2.0 and PostgreSQL 9.1\n+---------------------------------------------------------------\n+\n+PostGIS 2 includes an extension for Postgres 9.1 that can be used to enable\n+spatial functionality::\n+\n+    $ createdb  <db name>\n+    $ psql <db name>\n+    > CREATE EXTENSION postgis;\n+    > CREATE EXTENSION postgis_topology;\n+\n+No PostGIS topology functionalities are yet available from GeoDjango, so the\n+creation of the ``postgis_topology`` extension is entirely optional.\n+\n+.. _spatialdb_template_earlier:\n+\n+Creating a spatial database template for earlier versions\n+---------------------------------------------------------\n+\n+If you have an earlier version of PostGIS or PostgreSQL, the CREATE\n+EXTENSION isn't available and you need to create the spatial database\n+using the following instructions.\n+\n+Creating a spatial database with PostGIS is different than normal because\n+additional SQL must be loaded to enable spatial functionality.  Because of\n+the steps in this process, it's better to create a database template that\n+can be reused later.\n+\n+First, you need to be able to execute the commands as a privileged database\n+user.  For example, you can use the following to become the ``postgres`` user::\n+\n+    $ sudo su - postgres\n+\n+.. note::\n+\n+   The location *and* name of the PostGIS SQL files (e.g., from\n+   ``POSTGIS_SQL_PATH`` below) depends on the version of PostGIS.\n+   PostGIS versions 1.3 and below use ``<pg_sharedir>/contrib/lwpostgis.sql``;\n+   whereas version 1.4 uses ``<sharedir>/contrib/postgis.sql`` and\n+   version 1.5 uses ``<sharedir>/contrib/postgis-1.5/postgis.sql``.\n+\n+   To complicate matters, Debian/Ubuntu distributions have their own separate\n+   directory naming system that might change with time. In this case, use the\n+   :download:`create_template_postgis-debian.sh` script.\n+\n+   The example below assumes PostGIS 1.5, thus you may need to modify\n+   ``POSTGIS_SQL_PATH`` and the name of the SQL file for the specific\n+   version of PostGIS you are using.\n+\n+Once you're a database super user, then you may execute the following commands\n+to create a PostGIS spatial database template::\n+\n+    $ POSTGIS_SQL_PATH=`pg_config --sharedir`/contrib/postgis-2.0\n+    # Creating the template spatial database.\n+    $ createdb -E UTF8 template_postgis\n+    $ createlang -d template_postgis plpgsql # Adding PLPGSQL language support.\n+    # Allows non-superusers the ability to create from this template\n+    $ psql -d postgres -c \"UPDATE pg_database SET datistemplate='true' WHERE datname='template_postgis';\"\n+    # Loading the PostGIS SQL routines\n+    $ psql -d template_postgis -f $POSTGIS_SQL_PATH/postgis.sql\n+    $ psql -d template_postgis -f $POSTGIS_SQL_PATH/spatial_ref_sys.sql\n+    # Enabling users to alter spatial tables.\n+    $ psql -d template_postgis -c \"GRANT ALL ON geometry_columns TO PUBLIC;\"\n+    $ psql -d template_postgis -c \"GRANT ALL ON geography_columns TO PUBLIC;\"\n+    $ psql -d template_postgis -c \"GRANT ALL ON spatial_ref_sys TO PUBLIC;\"\n+\n+These commands may be placed in a shell script for later use; for convenience\n+the following scripts are available:\n+\n+===============  =============================================\n+PostGIS version  Bash shell script\n+===============  =============================================\n+1.3              :download:`create_template_postgis-1.3.sh`\n+1.4              :download:`create_template_postgis-1.4.sh`\n+1.5              :download:`create_template_postgis-1.5.sh`\n+Debian/Ubuntu    :download:`create_template_postgis-debian.sh`\n+===============  =============================================\n+\n+Afterwards, you may create a spatial database by simply specifying\n+``template_postgis`` as the template to use (via the ``-T`` option)::\n+\n+    $ createdb -T template_postgis <db name>\n+\n+.. note::\n+\n+    While the ``createdb`` command does not require database super-user privileges,\n+    it must be executed by a database user that has permissions to create databases.\n+    You can create such a user with the following command::\n+\n+        $ createuser --createdb <user>\n+\n+PostgreSQL's createdb fails\n+---------------------------\n+\n+When the PostgreSQL cluster uses a non-UTF8 encoding, the\n+:file:`create_template_postgis-*.sh` script will fail when executing\n+``createdb``::\n+\n+    createdb: database creation failed: ERROR:  new encoding (UTF8) is incompatible\n+      with the encoding of the template database (SQL_ASCII)\n+\n+The `current workaround`__ is to re-create the cluster using UTF8 (back up any\n+databases before dropping the cluster).\n+\n+__ http://jacobian.org/writing/pg-encoding-ubuntu/\n+\n+Managing the database\n+---------------------\n+\n+To administer the database, you can either use the pgAdmin III program\n+(:menuselection:`Start --> PostgreSQL 9.0 --> pgAdmin III`) or the\n+SQL Shell (:menuselection:`Start --> PostgreSQL 9.0 --> SQL Shell`).\n+For example, to create a ``geodjango`` spatial database and user, the following\n+may be executed from the SQL Shell as the ``postgres`` user::\n+\n+    postgres# CREATE USER geodjango PASSWORD 'my_passwd';\n+    postgres# CREATE DATABASE geodjango OWNER geodjango TEMPLATE template_postgis ENCODING 'utf8';"
        },
        {
            "sha": "941d55927285e79a1a3498716d02caee2fea36e6",
            "filename": "docs/ref/contrib/gis/install/spatialite.txt",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fspatialite.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fspatialite.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall%2Fspatialite.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "86979f0308a4106afbf11d50b4ffcd93730b5c53",
            "filename": "docs/ref/contrib/gis/testing.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Ftesting.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "9bb27e6e741b2bb9d8516565ee7bc1134c55b7ce",
            "filename": "docs/ref/contrib/localflavor.txt",
            "status": "modified",
            "additions": 108,
            "deletions": 1368,
            "changes": 1476,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Flocalflavor.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "ef6c64dc61dfd6ae1021e5a7d9fdbb73f2c05c29",
            "filename": "docs/ref/contrib/sitemaps.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsitemaps.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "790e003453466735f6c503d1da847bf89e1d4166",
            "filename": "docs/ref/contrib/sites.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 38,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fsites.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fsites.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsites.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "3a74797145d92633e8a23886e1e288b96d0de469",
            "filename": "docs/ref/contrib/staticfiles.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fstaticfiles.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "27b8fc087557a64c18ce867c0d04ae741568d71a",
            "filename": "docs/ref/contrib/syndication.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsyndication.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "3a52f838e753bc12430209806d2459653d55b433",
            "filename": "docs/ref/databases.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fdatabases.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fdatabases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdatabases.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "7fa753998514e0efbc0d83270df51c0e6651e8a9",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 25,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "f9bcf9b61e8e8ee87d4e3e9916715793f4fe96fe",
            "filename": "docs/ref/files/storage.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Ffiles%2Fstorage.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Ffiles%2Fstorage.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ffiles%2Fstorage.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "dffef314b76e395fcc35f059c63ad8adb4a6489f",
            "filename": "docs/ref/forms/api.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fapi.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "7c8d5090314a91aeae16511ea1bf337d19de2f20",
            "filename": "docs/ref/forms/fields.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Ffields.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "e89bce748f6793d1c94306cc23f19c25d2cd2c8a",
            "filename": "docs/ref/forms/validation.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Fvalidation.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Fvalidation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fvalidation.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "3c458930fa7d80eba03eddfe206adc479cc28f01",
            "filename": "docs/ref/forms/widgets.txt",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Fwidgets.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fforms%2Fwidgets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fwidgets.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "e1959d44a61b798a490c4af74372d3f06d0bbf7a",
            "filename": "docs/ref/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Findex.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "b542aee6e216899364fc9242558c3fbac12aef2a",
            "filename": "docs/ref/middleware.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmiddleware.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmiddleware.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmiddleware.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "809d56eaf5901322a15b5b2f02f6771c82ac3b53",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "1ba41148b095101a61281e552d532bf69ebb76c4",
            "filename": "docs/ref/models/instances.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmodels%2Finstances.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmodels%2Finstances.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Finstances.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        },
        {
            "sha": "7138cd0e746c2b9a5201fc724af50784d4681be5",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 33,
            "deletions": 15,
            "changes": 48,
            "blob_url": "https://github.com/django/django/blob/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/6a632e04578776e877adc5e2dc53f008c890a0d4/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=6a632e04578776e877adc5e2dc53f008c890a0d4"
        }
    ],
    "stats": {
        "total": 25256,
        "additions": 11911,
        "deletions": 13345
    }
}