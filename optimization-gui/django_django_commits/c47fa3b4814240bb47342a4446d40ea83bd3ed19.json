{
    "author": "aaugustin",
    "message": "Fixed #19676 -- Supported 'self' foreign keys in inspectdb.\n\nThanks Georgy Kutsurua for the report and Simon Charette for the patch.",
    "sha": "c47fa3b4814240bb47342a4446d40ea83bd3ed19",
    "files": [
        {
            "sha": "443312c66dfc773aef177cbbe0276431ee33cb21",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/c47fa3b4814240bb47342a4446d40ea83bd3ed19/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/c47fa3b4814240bb47342a4446d40ea83bd3ed19/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=c47fa3b4814240bb47342a4446d40ea83bd3ed19",
            "patch": "@@ -6,7 +6,7 @@\n \n from django.core.management.base import NoArgsCommand, CommandError\n from django.db import connections, DEFAULT_DB_ALIAS\n-from django.utils import six\n+\n \n class Command(NoArgsCommand):\n     help = \"Introspects the database tables in the given database and outputs a Django model module.\"\n@@ -34,7 +34,7 @@ def handle_inspection(self, options):\n         table_name_filter = options.get('table_name_filter')\n \n         table2model = lambda table_name: table_name.title().replace('_', '').replace(' ', '').replace('-', '')\n-        strip_prefix = lambda s: s.startswith(\"u'\") and s[1:] or s\n+        strip_prefix = lambda s: s[1:] if s.startswith(\"u'\") else s\n \n         cursor = connection.cursor()\n         yield \"# This is an auto-generated Django model module.\"\n@@ -86,7 +86,7 @@ def handle_inspection(self, options):\n                         extra_params['unique'] = True\n \n                 if is_relation:\n-                    rel_to = relations[i][1] == table_name and \"'self'\" or table2model(relations[i][1])\n+                    rel_to = \"self\" if relations[i][1] == table_name else table2model(relations[i][1])\n                     if rel_to in known_models:\n                         field_type = 'ForeignKey(%s' % rel_to\n                     else:"
        },
        {
            "sha": "a8adf862b11470954f794a06931ca1d15e86a02a",
            "filename": "tests/regressiontests/inspectdb/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/c47fa3b4814240bb47342a4446d40ea83bd3ed19/tests%2Fregressiontests%2Finspectdb%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/c47fa3b4814240bb47342a4446d40ea83bd3ed19/tests%2Fregressiontests%2Finspectdb%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Fmodels.py?ref=c47fa3b4814240bb47342a4446d40ea83bd3ed19",
            "patch": "@@ -3,6 +3,7 @@\n \n class People(models.Model):\n     name = models.CharField(max_length=255)\n+    parent = models.ForeignKey('self')\n \n class Message(models.Model):\n     from_field = models.ForeignKey(People, db_column='from_id')"
        },
        {
            "sha": "f9cbbce5c4b28f33c9aa4e5f459360c74d3319c3",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c47fa3b4814240bb47342a4446d40ea83bd3ed19/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c47fa3b4814240bb47342a4446d40ea83bd3ed19/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=c47fa3b4814240bb47342a4446d40ea83bd3ed19",
            "patch": "@@ -31,6 +31,8 @@ def test_attribute_name_not_python_keyword(self):\n                      stdout=out)\n         output = out.getvalue()\n         error_message = \"inspectdb generated an attribute name which is a python keyword\"\n+        # Recursive foreign keys should be set to 'self'\n+        self.assertIn(\"parent = models.ForeignKey('self')\", output)\n         self.assertNotIn(\"from = models.ForeignKey(InspectdbPeople)\", output, msg=error_message)\n         # As InspectdbPeople model is defined after InspectdbMessage, it should be quoted\n         self.assertIn(\"from_field = models.ForeignKey('InspectdbPeople', db_column='from_id')\","
        }
    ],
    "stats": {
        "total": 9,
        "additions": 6,
        "deletions": 3
    }
}