{
    "author": "freakboy3742",
    "message": "Fixed #14999 -- Ensure that filters on local fields are allowed, and aren't caught as a security problem. Thanks to medhat for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15139 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6bd8c14be98815627e740d862b1148d0c4fb1514",
    "files": [
        {
            "sha": "864325f266eea1bb10ffc33b64d6e8e220856d19",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6bd8c14be98815627e740d862b1148d0c4fb1514/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/6bd8c14be98815627e740d862b1148d0c4fb1514/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=6bd8c14be98815627e740d862b1148d0c4fb1514",
            "patch": "@@ -239,6 +239,8 @@ def lookup_allowed(self, lookup):\n             # later.\n             return True\n         else:\n+            if len(parts) == 1:\n+                return True\n             clean_lookup = LOOKUP_SEP.join(parts)\n             return clean_lookup in self.list_filter or clean_lookup == self.date_hierarchy\n "
        },
        {
            "sha": "49c68e633f904b515a0df4f3ac3c896b7c8ae8db",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/6bd8c14be98815627e740d862b1148d0c4fb1514/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/6bd8c14be98815627e740d862b1148d0c4fb1514/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=6bd8c14be98815627e740d862b1148d0c4fb1514",
            "patch": "@@ -176,7 +176,7 @@ def __unicode__(self):\n         return self.title\n \n class ThingAdmin(admin.ModelAdmin):\n-    list_filter = ('color', 'color__warm', 'color__value')\n+    list_filter = ('color__warm', 'color__value')\n \n class Fabric(models.Model):\n     NG_CHOICES = (\n@@ -200,6 +200,7 @@ class Person(models.Model):\n     )\n     name = models.CharField(max_length=100)\n     gender = models.IntegerField(choices=GENDER_CHOICES)\n+    age = models.IntegerField(default=21)\n     alive = models.BooleanField()\n \n     def __unicode__(self):"
        },
        {
            "sha": "5a0385faa5cd1271decb55123e426cdefb9f9f29",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6bd8c14be98815627e740d862b1148d0c4fb1514/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6bd8c14be98815627e740d862b1148d0c4fb1514/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=6bd8c14be98815627e740d862b1148d0c4fb1514",
            "patch": "@@ -372,10 +372,16 @@ def test_disallowed_filtering(self):\n         )\n \n         try:\n-            self.client.get(\"/test_admin/admin/admin_views/stuff/?color__value__startswith=red\")\n+            self.client.get(\"/test_admin/admin/admin_views/thing/?color__value__startswith=red\")\n+            self.client.get(\"/test_admin/admin/admin_views/thing/?color__value=red\")\n         except SuspiciousOperation:\n             self.fail(\"Filters are allowed if explicitly included in list_filter\")\n \n+        try:\n+            self.client.get(\"/test_admin/admin/admin_views/person/?age__gt=30\")\n+        except SuspiciousOperation:\n+            self.fail(\"Filters should be allowed if they involve a local field without the need to whitelist them in list_filter or date_hierarchy.\")\n+\n class SaveAsTests(TestCase):\n     fixtures = ['admin-views-users.xml','admin-views-person.xml']\n \n@@ -387,7 +393,7 @@ def tearDown(self):\n \n     def test_save_as_duplication(self):\n         \"\"\"Ensure save as actually creates a new person\"\"\"\n-        post_data = {'_saveasnew':'', 'name':'John M', 'gender':1}\n+        post_data = {'_saveasnew':'', 'name':'John M', 'gender':1, 'age': 42}\n         response = self.client.post('/test_admin/admin/admin_views/person/1/', post_data)\n         self.assertEqual(len(Person.objects.filter(name='John M')), 1)\n         self.assertEqual(len(Person.objects.filter(id=1)), 1)"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 12,
        "deletions": 3
    }
}