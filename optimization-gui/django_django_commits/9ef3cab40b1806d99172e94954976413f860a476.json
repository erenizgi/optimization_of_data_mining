{
    "author": "akaariai",
    "message": "Made sure join_field is always available in .join()\n\nRefs #19385",
    "sha": "9ef3cab40b1806d99172e94954976413f860a476",
    "files": [
        {
            "sha": "b0fb9337051da0f735fae11f45411666dc84123d",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/9ef3cab40b1806d99172e94954976413f860a476/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/9ef3cab40b1806d99172e94954976413f860a476/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=9ef3cab40b1806d99172e94954976413f860a476",
            "patch": "@@ -636,10 +636,10 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                         int_opts = int_model._meta\n                         continue\n                     lhs_col = int_opts.parents[int_model].column\n+                    link_field = int_opts.get_ancestor_link(int_model)\n                     int_opts = int_model._meta\n                     alias = self.query.join((alias, int_opts.db_table, lhs_col,\n-                            int_opts.pk.column),\n-                            promote=promote)\n+                            int_opts.pk.column), promote=promote, join_field=link_field)\n                     alias_chain.append(alias)\n             else:\n                 alias = root_alias\n@@ -685,10 +685,11 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                             int_opts = int_model._meta\n                             continue\n                         lhs_col = int_opts.parents[int_model].column\n+                        link_field = int_opts.get_ancestor_link(int_model)\n                         int_opts = int_model._meta\n                         alias = self.query.join(\n                             (alias, int_opts.db_table, lhs_col, int_opts.pk.column),\n-                            promote=True\n+                            promote=True, join_field=link_field\n                         )\n                         alias_chain.append(alias)\n                 alias = self.query.join("
        },
        {
            "sha": "841452636bb2144eb08a2a1a8e865bbb65b62463",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/9ef3cab40b1806d99172e94954976413f860a476/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/9ef3cab40b1806d99172e94954976413f860a476/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=9ef3cab40b1806d99172e94954976413f860a476",
            "patch": "@@ -944,6 +944,7 @@ def join(self, connection, reuse=None, promote=False,\n         The 'join_field' is the field we are joining along (if any).\n         \"\"\"\n         lhs, table, lhs_col, col = connection\n+        assert lhs is None or join_field is not None\n         existing = self.join_map.get(connection, ())\n         if reuse is None:\n             reuse = existing\n@@ -1003,8 +1004,9 @@ def setup_inherited_models(self):\n         for field, model in opts.get_fields_with_model():\n             if model not in seen:\n                 link_field = opts.get_ancestor_link(model)\n-                seen[model] = self.join((root_alias, model._meta.db_table,\n-                        link_field.column, model._meta.pk.column))\n+                seen[model] = self.join(\n+                    (root_alias, model._meta.db_table, link_field.column,\n+                     model._meta.pk.column), join_field=link_field)\n         self.included_inherited_models = seen\n \n     def remove_inherited_models(self):"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 8,
        "deletions": 5
    }
}