{
    "author": "aaugustin",
    "message": "Fixed #17037 -- Added a --all option to diffsettings.",
    "sha": "20a91cce04c72bc8c64a1c43b7398edac7b709cc",
    "files": [
        {
            "sha": "9e70e9ad8fdfb2b1a2f4212f9eaa2553ba480dc1",
            "filename": "django/core/management/commands/diffsettings.py",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/20a91cce04c72bc8c64a1c43b7398edac7b709cc/django%2Fcore%2Fmanagement%2Fcommands%2Fdiffsettings.py",
            "raw_url": "https://github.com/django/django/raw/20a91cce04c72bc8c64a1c43b7398edac7b709cc/django%2Fcore%2Fmanagement%2Fcommands%2Fdiffsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fdiffsettings.py?ref=20a91cce04c72bc8c64a1c43b7398edac7b709cc",
            "patch": "@@ -1,14 +1,22 @@\n+from optparse import make_option\n+\n from django.core.management.base import NoArgsCommand\n \n def module_to_dict(module, omittable=lambda k: k.startswith('_')):\n-    \"Converts a module namespace to a Python dictionary. Used by get_settings_diff.\"\n-    return dict([(k, repr(v)) for k, v in module.__dict__.items() if not omittable(k)])\n+    \"\"\"Converts a module namespace to a Python dictionary.\"\"\"\n+    return dict((k, repr(v)) for k, v in module.__dict__.items() if not omittable(k))\n \n class Command(NoArgsCommand):\n     help = \"\"\"Displays differences between the current settings.py and Django's\n     default settings. Settings that don't appear in the defaults are\n     followed by \"###\".\"\"\"\n \n+    option_list = NoArgsCommand.option_list + (\n+        make_option('--all', action='store_true', dest='all', default=False,\n+                    help='Display all settings, regardless of their value. '\n+                         'Default values are prefixed by \"###\".'),\n+    )\n+\n     requires_model_validation = False\n \n     def handle_noargs(self, **options):\n@@ -22,9 +30,11 @@ def handle_noargs(self, **options):\n         default_settings = module_to_dict(global_settings)\n \n         output = []\n-        for key in sorted(user_settings.keys()):\n+        for key in sorted(user_settings):\n             if key not in default_settings:\n                 output.append(\"%s = %s  ###\" % (key, user_settings[key]))\n             elif user_settings[key] != default_settings[key]:\n                 output.append(\"%s = %s\" % (key, user_settings[key]))\n+            elif options['all']:\n+                output.append(\"### %s = %s\" % (key, user_settings[key]))\n         return '\\n'.join(output)"
        },
        {
            "sha": "ac257db9f5d65d4fba4f85bd3f78dd46ac5c019a",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/20a91cce04c72bc8c64a1c43b7398edac7b709cc/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/20a91cce04c72bc8c64a1c43b7398edac7b709cc/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=20a91cce04c72bc8c64a1c43b7398edac7b709cc",
            "patch": "@@ -168,8 +168,11 @@ example, the default settings don't define :setting:`ROOT_URLCONF`, so\n :setting:`ROOT_URLCONF` is followed by ``\"###\"`` in the output of\n ``diffsettings``.\n \n-Note that Django's default settings live in ``django/conf/global_settings.py``,\n-if you're ever curious to see the full list of defaults.\n+The :djadminopt:`--all` option may be provided to display all settings, even\n+if they have Django's default value. Such settings are prefixed by ``\"###\"``.\n+\n+.. versionadded:: 1.6\n+    The :djadminopt:`--all` option was added.\n \n dumpdata <appname appname appname.Model ...>\n --------------------------------------------"
        },
        {
            "sha": "c52f6ee3d95d7cd72152836393229c1e7197923d",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/20a91cce04c72bc8c64a1c43b7398edac7b709cc/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/20a91cce04c72bc8c64a1c43b7398edac7b709cc/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=20a91cce04c72bc8c64a1c43b7398edac7b709cc",
            "patch": "@@ -157,6 +157,8 @@ Minor features\n * The documentation contains a :doc:`deployment checklist\n   </howto/deployment/checklist>`.\n \n+* The :djadmin:`diffsettings` comand gained a ``--all`` option.\n+\n Backwards incompatible changes in 1.6\n =====================================\n "
        },
        {
            "sha": "baec16820ea8ed8e7d2a5f60f17991341f7ad63f",
            "filename": "tests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/20a91cce04c72bc8c64a1c43b7398edac7b709cc/tests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/20a91cce04c72bc8c64a1c43b7398edac7b709cc/tests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fadmin_scripts%2Ftests.py?ref=20a91cce04c72bc8c64a1c43b7398edac7b709cc",
            "patch": "@@ -1661,11 +1661,21 @@ def test_custom_project_template_with_non_ascii_templates(self):\n \n class DiffSettings(AdminScriptTestCase):\n     \"\"\"Tests for diffsettings management command.\"\"\"\n+\n     def test_basic(self):\n-        \"Runs without error and emits settings diff.\"\n+        \"\"\"Runs without error and emits settings diff.\"\"\"\n         self.write_settings('settings_to_diff.py', sdict={'FOO': '\"bar\"'})\n         self.addCleanup(self.remove_settings, 'settings_to_diff.py')\n         args = ['diffsettings', '--settings=settings_to_diff']\n         out, err = self.run_manage(args)\n         self.assertNoOutput(err)\n         self.assertOutput(out, \"FOO = 'bar'  ###\")\n+\n+    def test_all(self):\n+        \"\"\"The all option also shows settings with the default value.\"\"\"\n+        self.write_settings('settings_to_diff.py', sdict={'STATIC_URL': 'None'})\n+        self.addCleanup(self.remove_settings, 'settings_to_diff.py')\n+        args = ['diffsettings', '--settings=settings_to_diff', '--all']\n+        out, err = self.run_manage(args)\n+        self.assertNoOutput(err)\n+        self.assertOutput(out, \"### STATIC_URL = None\")"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 31,
        "deletions": 6
    }
}