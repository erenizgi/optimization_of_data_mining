{
    "author": "kmtracey",
    "message": "Fix #17876: Corrected an exception (regression) raised where select_realted and only is used on a proxy model. Thanks milosu and charettes.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17692 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d",
    "files": [
        {
            "sha": "44acadf0378abacda9e61806622bca3d1f4d7e1a",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d",
            "patch": "@@ -1266,7 +1266,7 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n         return None\n \n     if only_load:\n-        load_fields = only_load.get(klass)\n+        load_fields = only_load.get(klass) or set()\n         # When we create the object, we will also be creating populating\n         # all the parent classes, so traverse the parent classes looking\n         # for fields that must be included on load."
        },
        {
            "sha": "c64becf972376d14f69198cd402941638daf14f1",
            "filename": "tests/modeltests/defer/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d/tests%2Fmodeltests%2Fdefer%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d/tests%2Fmodeltests%2Fdefer%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdefer%2Fmodels.py?ref=9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d",
            "patch": "@@ -22,3 +22,7 @@ class Child(Primary):\n \n class BigChild(Primary):\n     other = models.CharField(max_length=50)\n+\n+class ChildProxy(Child):\n+    class Meta:\n+        proxy=True"
        },
        {
            "sha": "88aac0c9e5a68e3429994a4cb73a914fb67ac0c5",
            "filename": "tests/modeltests/defer/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d/tests%2Fmodeltests%2Fdefer%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d/tests%2Fmodeltests%2Fdefer%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fdefer%2Ftests.py?ref=9d98b9eb4bee1c9d69694f37dc618c36ecfecb8d",
            "patch": "@@ -3,7 +3,7 @@\n from django.db.models.query_utils import DeferredAttribute\n from django.test import TestCase\n \n-from .models import Secondary, Primary, Child, BigChild\n+from .models import Secondary, Primary, Child, BigChild, ChildProxy\n \n \n class DeferTests(TestCase):\n@@ -145,3 +145,7 @@ def test_defer(self):\n         obj.name = \"bb\"\n         obj.save()\n \n+    def test_defer_proxy(self):\n+        # using select related and only should not result in Exception\n+        for obj in ChildProxy.objects.all().select_related().only('id'):\n+            continue"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}