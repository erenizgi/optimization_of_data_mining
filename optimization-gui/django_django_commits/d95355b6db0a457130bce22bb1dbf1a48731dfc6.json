{
    "author": "jezdez",
    "message": "Fixed #16048 -- Use the base manager instead of the default manager to retrieve a related object of a GenericForeignKey similar to ForeignKeys. Thanks, adurdin.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16261 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d95355b6db0a457130bce22bb1dbf1a48731dfc6",
    "files": [
        {
            "sha": "1f2a3dbbd29d2f2e237ec22f6430d87cdab1fa52",
            "filename": "django/contrib/contenttypes/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d95355b6db0a457130bce22bb1dbf1a48731dfc6/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/d95355b6db0a457130bce22bb1dbf1a48731dfc6/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmodels.py?ref=d95355b6db0a457130bce22bb1dbf1a48731dfc6",
            "patch": "@@ -100,7 +100,7 @@ def get_object_for_this_type(self, **kwargs):\n         method. The ObjectNotExist exception, if thrown, will not be caught,\n         so code that calls this method should catch it.\n         \"\"\"\n-        return self.model_class()._default_manager.using(self._state.db).get(**kwargs)\n+        return self.model_class()._base_manager.using(self._state.db).get(**kwargs)\n \n     def natural_key(self):\n         return (self.app_label, self.model)"
        },
        {
            "sha": "f3e216edf59b3f6899f08aaea08bf4484f12025a",
            "filename": "tests/modeltests/generic_relations/models.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/d95355b6db0a457130bce22bb1dbf1a48731dfc6/tests%2Fmodeltests%2Fgeneric_relations%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/d95355b6db0a457130bce22bb1dbf1a48731dfc6/tests%2Fmodeltests%2Fgeneric_relations%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fgeneric_relations%2Fmodels.py?ref=d95355b6db0a457130bce22bb1dbf1a48731dfc6",
            "patch": "@@ -78,3 +78,11 @@ class Mineral(models.Model):\n \n     def __unicode__(self):\n         return self.name\n+\n+class GeckoManager(models.Manager):\n+    def get_query_set(self):\n+        return super(GeckoManager, self).get_query_set().filter(has_tail=True)\n+\n+class Gecko(models.Model):\n+    has_tail = models.BooleanField()\n+    objects = GeckoManager()"
        },
        {
            "sha": "7596f77fbe24a329addc2c7891917b7dcc437c71",
            "filename": "tests/modeltests/generic_relations/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/d95355b6db0a457130bce22bb1dbf1a48731dfc6/tests%2Fmodeltests%2Fgeneric_relations%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d95355b6db0a457130bce22bb1dbf1a48731dfc6/tests%2Fmodeltests%2Fgeneric_relations%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fgeneric_relations%2Ftests.py?ref=d95355b6db0a457130bce22bb1dbf1a48731dfc6",
            "patch": "@@ -4,7 +4,7 @@\n from django.test import TestCase\n \n from models import (TaggedItem, ValuableTaggedItem, Comparison, Animal,\n-    Vegetable, Mineral)\n+    Vegetable, Mineral, Gecko)\n \n \n class GenericRelationsTests(TestCase):\n@@ -223,6 +223,11 @@ def test_generic_inline_formsets(self):\n         self.assertEqual(u''.join(form.as_p() for form in formset.forms), u\"\"\"<p><label for=\"id_x-0-tag\">Tag:</label> <input id=\"id_x-0-tag\" type=\"text\" name=\"x-0-tag\" maxlength=\"50\" /></p>\n <p><label for=\"id_x-0-DELETE\">Delete:</label> <input type=\"checkbox\" name=\"x-0-DELETE\" id=\"id_x-0-DELETE\" /><input type=\"hidden\" name=\"x-0-id\" id=\"id_x-0-id\" /></p>\"\"\")\n \n+    def test_gfk_manager(self):\n+        # GenericForeignKey should not use the default manager (which may filter objects) #16048\n+        tailless = Gecko.objects.create(has_tail=False)\n+        tag = TaggedItem.objects.create(content_object=tailless, tag=\"lizard\")\n+        self.assertEqual(tag.content_object, tailless)\n \n class CustomWidget(forms.CharField):\n     pass"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}