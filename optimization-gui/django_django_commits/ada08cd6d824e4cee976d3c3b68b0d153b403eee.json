{
    "author": "jezdez",
    "message": "Fixed #15314 -- Added tests for the static URL pattern function added in r15530 and made sure the **kwargs are passed to the view correctly. Thanks for the report and initial patch, Bruno Reni√©.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15552 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "ada08cd6d824e4cee976d3c3b68b0d153b403eee",
    "files": [
        {
            "sha": "ff1942f990200ebc4013e9d543d4bad2c0c0ac48",
            "filename": "django/conf/urls/static.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/ada08cd6d824e4cee976d3c3b68b0d153b403eee/django%2Fconf%2Furls%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/ada08cd6d824e4cee976d3c3b68b0d153b403eee/django%2Fconf%2Furls%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Furls%2Fstatic.py?ref=ada08cd6d824e4cee976d3c3b68b0d153b403eee",
            "patch": "@@ -22,5 +22,5 @@ def static(prefix, view='django.views.static.serve', **kwargs):\n     elif '://' in prefix:\n         raise ImproperlyConfigured(\"URL '%s' not allowed as static prefix\" % prefix)\n     return patterns('',\n-        url(r'^%s(?P<path>.*)$' % re.escape(prefix.lstrip('/')), view, **kwargs),\n+        url(r'^%s(?P<path>.*)$' % re.escape(prefix.lstrip('/')), view, kwargs=kwargs),\n     )"
        },
        {
            "sha": "8ae04c2176fecf8738fbdb56399000d1f8ab13ee",
            "filename": "tests/regressiontests/views/tests/static.py",
            "status": "modified",
            "additions": 26,
            "deletions": 8,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/ada08cd6d824e4cee976d3c3b68b0d153b403eee/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/ada08cd6d824e4cee976d3c3b68b0d153b403eee/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py?ref=ada08cd6d824e4cee976d3c3b68b0d153b403eee",
            "patch": "@@ -2,14 +2,18 @@\n from os import path\n \n from django.conf import settings\n+from django.conf.urls.static import static\n from django.test import TestCase\n from django.http import HttpResponseNotModified\n+\n+from regressiontests.views import urls\n from regressiontests.views.urls import media_dir\n \n class StaticTests(TestCase):\n     \"\"\"Tests django views in django/views/static.py\"\"\"\n \n     def setUp(self):\n+        self.prefix = 'site_media'\n         self.old_debug = settings.DEBUG\n         settings.DEBUG = True\n \n@@ -20,34 +24,33 @@ def test_serve(self):\n         \"The static view can serve static media\"\n         media_files = ['file.txt', 'file.txt.gz']\n         for filename in media_files:\n-            response = self.client.get('/views/site_media/%s' % filename)\n+            response = self.client.get('/views/%s/%s' % (self.prefix, filename))\n             file_path = path.join(media_dir, filename)\n             self.assertEquals(open(file_path).read(), response.content)\n             self.assertEquals(len(response.content), int(response['Content-Length']))\n             self.assertEquals(mimetypes.guess_type(file_path)[1], response.get('Content-Encoding', None))\n \n     def test_unknown_mime_type(self):\n-        response = self.client.get('/views/site_media/file.unknown')\n+        response = self.client.get('/views/%s/file.unknown' % self.prefix)\n         self.assertEquals('application/octet-stream', response['Content-Type'])\n \n     def test_copes_with_empty_path_component(self):\n         file_name = 'file.txt'\n-        response = self.client.get('/views/site_media//%s' % file_name)\n+        response = self.client.get('/views/%s//%s' % (self.prefix, file_name))\n         file = open(path.join(media_dir, file_name))\n         self.assertEquals(file.read(), response.content)\n \n     def test_is_modified_since(self):\n         file_name = 'file.txt'\n-        response = self.client.get(\n-            '/views/site_media/%s' % file_name,\n+        response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n             HTTP_IF_MODIFIED_SINCE='Thu, 1 Jan 1970 00:00:00 GMT')\n         file = open(path.join(media_dir, file_name))\n         self.assertEquals(file.read(), response.content)\n \n     def test_not_modified_since(self):\n         file_name = 'file.txt'\n         response = self.client.get(\n-            '/views/site_media/%s' % file_name,\n+            '/views/%s/%s' % (self.prefix, file_name),\n             HTTP_IF_MODIFIED_SINCE='Mon, 18 Jan 2038 05:14:07 UTC'\n             # This is 24h before max Unix time. Remember to fix Django and\n             # update this test well before 2038 :)\n@@ -62,7 +65,7 @@ def test_invalid_if_modified_since(self):\n         \"\"\"\n         file_name = 'file.txt'\n         invalid_date = 'Mon, 28 May 999999999999 28:25:26 GMT'\n-        response = self.client.get('/views/site_media/%s' % file_name,\n+        response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n                                    HTTP_IF_MODIFIED_SINCE=invalid_date)\n         file = open(path.join(media_dir, file_name))\n         self.assertEquals(file.read(), response.content)\n@@ -77,9 +80,24 @@ def test_invalid_if_modified_since2(self):\n         \"\"\"\n         file_name = 'file.txt'\n         invalid_date = ': 1291108438, Wed, 20 Oct 2010 14:05:00 GMT'\n-        response = self.client.get('/views/site_media/%s' % file_name,\n+        response = self.client.get('/views/%s/%s' % (self.prefix, file_name),\n                                    HTTP_IF_MODIFIED_SINCE=invalid_date)\n         file = open(path.join(media_dir, file_name))\n         self.assertEquals(file.read(), response.content)\n         self.assertEquals(len(response.content),\n                           int(response['Content-Length']))\n+\n+\n+class StaticHelperTest(StaticTests):\n+    \"\"\"\n+    Test case to make sure the static URL pattern helper works as expected\n+    \"\"\"\n+    def setUp(self):\n+        super(StaticHelperTest, self).setUp()\n+        self.prefix = 'media'\n+        self._old_views_urlpatterns = urls.urlpatterns\n+        urls.urlpatterns += static('/media/', document_root=media_dir)\n+\n+    def tearDown(self):\n+        super(StaticHelperTest, self).tearDown()\n+        urls.urlpatterns = self._old_views_urlpatterns"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 27,
        "deletions": 9
    }
}