{
    "author": "claudep",
    "message": "Fixed #19261 -- Delayed Queryset evaluation in paginators\n\nThanks trbs for the report and the patch.",
    "sha": "1b307d6c8fe9a897da2daa189b7d5f59120e4410",
    "files": [
        {
            "sha": "d22e16c452c7d9a6934b0a79489c965da715829e",
            "filename": "django/core/paginator.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/1b307d6c8fe9a897da2daa189b7d5f59120e4410/django%2Fcore%2Fpaginator.py",
            "raw_url": "https://github.com/django/django/raw/1b307d6c8fe9a897da2daa189b7d5f59120e4410/django%2Fcore%2Fpaginator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fpaginator.py?ref=1b307d6c8fe9a897da2daa189b7d5f59120e4410",
            "patch": "@@ -1,6 +1,9 @@\n import collections\n from math import ceil\n \n+from django.utils import six\n+\n+\n class InvalidPage(Exception):\n     pass\n \n@@ -89,6 +92,8 @@ def __len__(self):\n         return len(self.object_list)\n \n     def __getitem__(self, index):\n+        if not isinstance(index, (slice,) + six.integer_types):\n+            raise TypeError\n         # The object_list is converted to a list so that if it was a QuerySet\n         # it won't be a database hit per __getitem__.\n         return list(self.object_list)[index]"
        },
        {
            "sha": "63ccd8f61cc9b3cdca41ab433222e2a5d35f76bb",
            "filename": "tests/regressiontests/pagination/tests.py",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/1b307d6c8fe9a897da2daa189b7d5f59120e4410/tests%2Fregressiontests%2Fpagination%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/1b307d6c8fe9a897da2daa189b7d5f59120e4410/tests%2Fregressiontests%2Fpagination%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fpagination%2Ftests.py?ref=1b307d6c8fe9a897da2daa189b7d5f59120e4410",
            "patch": "@@ -266,3 +266,25 @@ def test_last_page(self):\n         self.assertEqual(1, p.previous_page_number())\n         self.assertEqual(6, p.start_index())\n         self.assertEqual(9, p.end_index())\n+\n+    def test_page_getitem(self):\n+        \"\"\"\n+        Tests proper behaviour of a paginator page __getitem__ (queryset\n+        evaluation, slicing, exception raised).\n+        \"\"\"\n+        paginator = Paginator(Article.objects.all(), 5)\n+        p = paginator.page(1)\n+\n+        # Make sure object_list queryset is not evaluated by an invalid __getitem__ call.\n+        # (this happens from the template engine when using eg: {% page_obj.has_previous %})\n+        self.assertIsNone(p.object_list._result_cache)\n+        self.assertRaises(TypeError, lambda: p['has_previous'])\n+        self.assertIsNone(p.object_list._result_cache)\n+\n+        # Make sure slicing the Page object with numbers and slice objects work.\n+        self.assertEqual(p[0], Article.objects.get(headline='Article 1'))\n+        self.assertQuerysetEqual(p[slice(2)], [\n+                \"<Article: Article 1>\",\n+                \"<Article: Article 2>\",\n+            ]\n+        )"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 27,
        "deletions": 0
    }
}