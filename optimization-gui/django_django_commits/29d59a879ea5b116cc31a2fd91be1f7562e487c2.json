{
    "author": "edwtjo",
    "message": "Fixed #17911 -- Ensure that admin readonly fields' display values are shown in change forms when the raw value is None.",
    "sha": "29d59a879ea5b116cc31a2fd91be1f7562e487c2",
    "files": [
        {
            "sha": "4203287123d841af6a2a61564be953b491b465ae",
            "filename": "django/contrib/admin/helpers.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/29d59a879ea5b116cc31a2fd91be1f7562e487c2/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "raw_url": "https://github.com/django/django/raw/29d59a879ea5b116cc31a2fd91be1f7562e487c2/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fhelpers.py?ref=29d59a879ea5b116cc31a2fd91be1f7562e487c2",
            "patch": "@@ -186,9 +186,7 @@ def contents(self):\n                     if getattr(attr, \"allow_tags\", False):\n                         result_repr = mark_safe(result_repr)\n             else:\n-                if value is None:\n-                    result_repr = EMPTY_CHANGELIST_VALUE\n-                elif isinstance(f.rel, ManyToManyRel):\n+                if isinstance(f.rel, ManyToManyRel) and value is not None:\n                     result_repr = \", \".join(map(six.text_type, value.all()))\n                 else:\n                     result_repr = display_for_field(value, f)"
        },
        {
            "sha": "d71c3983763b81ac72f9dd99405cc6ca0fd8e222",
            "filename": "tests/regressiontests/admin_views/admin.py",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/29d59a879ea5b116cc31a2fd91be1f7562e487c2/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/29d59a879ea5b116cc31a2fd91be1f7562e487c2/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py?ref=29d59a879ea5b116cc31a2fd91be1f7562e487c2",
            "patch": "@@ -27,7 +27,7 @@\n     Album, Question, Answer, ComplexSortedPerson, PrePopulatedPostLargeSlug,\n     AdminOrderedField, AdminOrderedModelMethod, AdminOrderedAdminMethod,\n     AdminOrderedCallable, Report, Color2, UnorderedObject, MainPrepopulated,\n-    RelatedPrepopulated, UndeletableObject, UserMessenger, Simple)\n+    RelatedPrepopulated, UndeletableObject, UserMessenger, Simple, Choice)\n \n \n def callable_year(dt_value):\n@@ -615,6 +615,12 @@ def message_extra_tags(self, request, selected):\n         self.message_user(request, \"Test tags\", extra_tags=\"extra_tag\")\n \n \n+class ChoiceList(admin.ModelAdmin):\n+    list_display = ['choice']\n+    readonly_fields = ['choice']\n+    fields = ['choice']\n+\n+\n site = admin.AdminSite(name=\"admin\")\n site.register(Article, ArticleAdmin)\n site.register(CustomArticle, CustomArticleAdmin)\n@@ -690,6 +696,7 @@ def message_extra_tags(self, request, selected):\n site.register(Color2, CustomTemplateFilterColorAdmin)\n site.register(Simple, AttributeErrorRaisingAdmin)\n site.register(UserMessenger, MessageTestingAdmin)\n+site.register(Choice, ChoiceList)\n \n # Register core models we need in our tests\n from django.contrib.auth.models import User, Group"
        },
        {
            "sha": "003b6ce8b2db6278204386f957f8b280d1cf5ae0",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/29d59a879ea5b116cc31a2fd91be1f7562e487c2/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/29d59a879ea5b116cc31a2fd91be1f7562e487c2/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=29d59a879ea5b116cc31a2fd91be1f7562e487c2",
            "patch": "@@ -660,3 +660,7 @@ class Simple(models.Model):\n     \"\"\"\n     Simple model with nothing on it for use in testing\n     \"\"\"\n+\n+class Choice(models.Model):\n+    choice = models.CharField(max_length=1, blank=True, null=True,\n+        choices=(('y','Yes'), ('n','No'), (None, 'No opinion')))"
        },
        {
            "sha": "62f69f6d941c1487d75657558640fd613609f712",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/29d59a879ea5b116cc31a2fd91be1f7562e487c2/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/29d59a879ea5b116cc31a2fd91be1f7562e487c2/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=29d59a879ea5b116cc31a2fd91be1f7562e487c2",
            "patch": "@@ -46,7 +46,7 @@\n     OtherStory, ComplexSortedPerson, Parent, Child, AdminOrderedField,\n     AdminOrderedModelMethod, AdminOrderedAdminMethod, AdminOrderedCallable,\n     Report, MainPrepopulated, RelatedPrepopulated, UnorderedObject,\n-    Simple, UndeletableObject)\n+    Simple, UndeletableObject, Choice)\n \n \n ERROR_MESSAGE = \"Please enter the correct username and password \\\n@@ -3202,6 +3202,15 @@ def test_user_password_change_limited_queryset(self):\n         response = self.client.get('/test_admin/admin2/auth/user/%s/password/' % su.pk)\n         self.assertEqual(response.status_code, 404)\n \n+    def test_change_form_renders_correct_null_choice_value(self):\n+        \"\"\"\n+        Regression test for #17911.\n+        \"\"\"\n+        choice = Choice.objects.create(choice=None)\n+        response = self.client.get('/test_admin/admin/admin_views/choice/%s/' % choice.pk)\n+        self.assertContains(response, '<p>No opinion</p>', html=True)\n+        self.assertNotContains(response, '<p>(None)</p>')\n+\n \n @override_settings(PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n class RawIdFieldsTest(TestCase):"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 23,
        "deletions": 5
    }
}