{
    "author": "claudep",
    "message": "Fixed #14681 -- Do not set mode to None on file-like objects.\n\ngzip.GzipFile does not support files with mode set to None.",
    "sha": "2626ea4a74d09642a50c3fb30944513b68dda289",
    "files": [
        {
            "sha": "a2d703c963f120ff2871f04e7505a3ad9ca067d2",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/2626ea4a74d09642a50c3fb30944513b68dda289/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/2626ea4a74d09642a50c3fb30944513b68dda289/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=2626ea4a74d09642a50c3fb30944513b68dda289",
            "patch": "@@ -12,7 +12,8 @@ def __init__(self, file, name=None):\n         if name is None:\n             name = getattr(file, 'name', None)\n         self.name = name\n-        self.mode = getattr(file, 'mode', None)\n+        if hasattr(file, 'mode'):\n+            self.mode = file.mode\n \n     def __str__(self):\n         return smart_str(self.name or '')"
        },
        {
            "sha": "837723a049344035980d0e94ed167f04d28abdde",
            "filename": "tests/modeltests/files/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/2626ea4a74d09642a50c3fb30944513b68dda289/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2626ea4a74d09642a50c3fb30944513b68dda289/tests%2Fmodeltests%2Ffiles%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffiles%2Ftests.py?ref=2626ea4a74d09642a50c3fb30944513b68dda289",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import absolute_import\n \n+import gzip\n import shutil\n import tempfile\n \n@@ -8,11 +9,12 @@\n from django.core.files.base import ContentFile\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.test import TestCase\n+from django.utils import unittest\n \n from .models import Storage, temp_storage, temp_storage_location\n \n \n-class FileTests(TestCase):\n+class FileStorageTests(TestCase):\n     def tearDown(self):\n         shutil.rmtree(temp_storage_location)\n \n@@ -106,6 +108,8 @@ def test_files(self):\n         obj3.default.delete()\n         obj4.random.delete()\n \n+\n+class FileTests(unittest.TestCase):\n     def test_context_manager(self):\n         orig_file = tempfile.TemporaryFile()\n         base_file = File(orig_file)\n@@ -114,3 +118,10 @@ def test_context_manager(self):\n             self.assertFalse(f.closed)\n         self.assertTrue(f.closed)\n         self.assertTrue(orig_file.closed)\n+\n+    def test_file_mode(self):\n+        # Should not set mode to None if it is not present.\n+        # See #14681, stdlib gzip module crashes if mode is set to None\n+        file = SimpleUploadedFile(\"mode_test.txt\", \"content\")\n+        self.assertFalse(hasattr(file, 'mode'))\n+        g = gzip.GzipFile(fileobj=file)"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 14,
        "deletions": 2
    }
}