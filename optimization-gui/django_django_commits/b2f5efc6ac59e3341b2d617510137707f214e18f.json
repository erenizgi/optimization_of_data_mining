{
    "author": "ramiro",
    "message": "Fixed #8999 -- Removed useless code in handling of `exclude` option in ModelAdmin and InlineModelAdmin custom form(set) hooks. Thanks goes to seanl for the report, patch and bkonkle and Julien for further work on final patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16422 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b2f5efc6ac59e3341b2d617510137707f214e18f",
    "files": [
        {
            "sha": "6d332392921acc9f629386967ee814a400d216e7",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b2f5efc6ac59e3341b2d617510137707f214e18f/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/b2f5efc6ac59e3341b2d617510137707f214e18f/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=b2f5efc6ac59e3341b2d617510137707f214e18f",
            "patch": "@@ -433,7 +433,6 @@ def get_form(self, request, obj=None, **kwargs):\n             exclude = []\n         else:\n             exclude = list(self.exclude)\n-        exclude.extend(kwargs.get(\"exclude\", []))\n         exclude.extend(self.get_readonly_fields(request, obj))\n         # if exclude is an empty list we pass None to be consistant with the\n         # default on modelform_factory\n@@ -1342,7 +1341,6 @@ def get_formset(self, request, obj=None, **kwargs):\n             exclude = []\n         else:\n             exclude = list(self.exclude)\n-        exclude.extend(kwargs.get(\"exclude\", []))\n         exclude.extend(self.get_readonly_fields(request, obj))\n         # if exclude is an empty list we use None, since that's the actual\n         # default"
        },
        {
            "sha": "e83dc39baccdcb4805b0ebbaf32713f5057ddf4f",
            "filename": "tests/regressiontests/modeladmin/tests.py",
            "status": "modified",
            "additions": 57,
            "deletions": 0,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/b2f5efc6ac59e3341b2d617510137707f214e18f/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b2f5efc6ac59e3341b2d617510137707f214e18f/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py?ref=b2f5efc6ac59e3341b2d617510137707f214e18f",
            "patch": "@@ -141,6 +141,63 @@ class BandAdmin(ModelAdmin):\n             type(ma.get_form(request).base_fields['sign_date'].widget),\n             AdminDateWidget)\n \n+    def test_form_exclude_kwarg_override(self):\n+        \"\"\"\n+        Ensure that the `exclude` kwarg passed to `ModelAdmin.get_form()`\n+        overrides all other declarations. Refs #8999.\n+        \"\"\"\n+\n+        class AdminBandForm(forms.ModelForm):\n+\n+            class Meta:\n+                model = Band\n+                exclude = ['name']\n+\n+        class BandAdmin(ModelAdmin):\n+            exclude = ['sign_date',]\n+            form = AdminBandForm\n+\n+            def get_form(self, request, obj=None, **kwargs):\n+                kwargs['exclude'] = ['bio']\n+                return super(BandAdmin, self).get_form(request, obj, **kwargs)\n+\n+        ma = BandAdmin(Band, self.site)\n+        self.assertEqual(ma.get_form(request).base_fields.keys(),\n+            ['name', 'sign_date',])\n+\n+\n+    def test_formset_exclude_kwarg_override(self):\n+        \"\"\"\n+        Ensure that the `exclude` kwarg passed to `InlineModelAdmin.get_formset()`\n+        overrides all other declarations. Refs #8999.\n+        \"\"\"\n+\n+        class AdminConcertForm(forms.ModelForm):\n+\n+            class Meta:\n+                model = Concert\n+                exclude = ['day']\n+\n+        class ConcertInline(TabularInline):\n+            exclude = ['transport']\n+            form = AdminConcertForm\n+            fk_name = 'main_band'\n+            model = Concert\n+\n+            def get_formset(self, request, obj=None, **kwargs):\n+                kwargs['exclude'] = ['opening_band']\n+                return super(ConcertInline, self).get_formset(request, obj, **kwargs)\n+\n+        class BandAdmin(ModelAdmin):\n+            inlines = [\n+                ConcertInline\n+            ]\n+\n+        ma = BandAdmin(Band, self.site)\n+        self.assertEqual(\n+            list(ma.get_formsets(request))[0]().forms[0].fields.keys(),\n+            ['main_band', 'day', 'transport', 'id', 'DELETE',])\n+\n     def test_queryset_override(self):\n         # If we need to override the queryset of a ModelChoiceField in our custom form\n         # make sure that RelatedFieldWidgetWrapper doesn't mess that up."
        }
    ],
    "stats": {
        "total": 59,
        "additions": 57,
        "deletions": 2
    }
}