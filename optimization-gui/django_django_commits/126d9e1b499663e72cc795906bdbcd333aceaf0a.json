{
    "author": "jezdez",
    "message": "Fixed #17817 -- Modified LocalMiddleware to use full URLs when redirecting to i18n URLs. Thanks to Paul for keeping an eye on the standards.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17633 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "126d9e1b499663e72cc795906bdbcd333aceaf0a",
    "files": [
        {
            "sha": "628782b18154a92fb0f6b85c2b19652e6c9021b4",
            "filename": "django/middleware/locale.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/126d9e1b499663e72cc795906bdbcd333aceaf0a/django%2Fmiddleware%2Flocale.py",
            "raw_url": "https://github.com/django/django/raw/126d9e1b499663e72cc795906bdbcd333aceaf0a/django%2Fmiddleware%2Flocale.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Flocale.py?ref=126d9e1b499663e72cc795906bdbcd333aceaf0a",
            "patch": "@@ -33,9 +33,12 @@ def process_response(self, request, response):\n             language_path = '/%s%s' % (language, request.path_info)\n             if settings.APPEND_SLASH and not language_path.endswith('/'):\n                 language_path = language_path + '/'\n+\n             if is_valid_path(language_path, urlconf):\n-                return HttpResponseRedirect(\n-                    '/%s%s' % (language, request.get_full_path()))\n+                language_url = \"%s://%s/%s%s\" % (\n+                    request.is_secure() and 'https' or 'http',\n+                    request.get_host(), language, request.get_full_path())\n+                return HttpResponseRedirect(language_url)\n         translation.deactivate()\n \n         patch_vary_headers(response, ('Accept-Language',))"
        },
        {
            "sha": "16fbec014a992f41ff5553c11c3a9c7e97cae065",
            "filename": "tests/regressiontests/i18n/patterns/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/126d9e1b499663e72cc795906bdbcd333aceaf0a/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/126d9e1b499663e72cc795906bdbcd333aceaf0a/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fpatterns%2Ftests.py?ref=126d9e1b499663e72cc795906bdbcd333aceaf0a",
            "patch": "@@ -182,12 +182,10 @@ def test_not_prefixed_redirect(self):\n         self.assertRedirects(response, '/not-prefixed/', 301)\n \n     def test_en_redirect(self):\n-        response = self.client.get('/account/register', HTTP_ACCEPT_LANGUAGE='en')\n+        response = self.client.get('/account/register', HTTP_ACCEPT_LANGUAGE='en', follow=True)\n         # target status code of 301 because of CommonMiddleware redirecting\n-        self.assertRedirects(response, '/en/account/register', 302, target_status_code=301)\n-\n-        response = self.client.get(response['location'])\n-        self.assertRedirects(response, '/en/account/register/', 301)\n+        self.assertIn(('http://testserver/en/account/register/', 301), response.redirect_chain)\n+        self.assertRedirects(response, '/en/account/register/', 302)\n \n \n class URLRedirectWithoutTrailingSlashSettingTests(URLTestCaseBase):"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}