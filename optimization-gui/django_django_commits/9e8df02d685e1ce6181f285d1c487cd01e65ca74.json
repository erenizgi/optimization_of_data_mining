{
    "author": "aaugustin",
    "message": "[py3] Ported django.utils.translation.",
    "sha": "9e8df02d685e1ce6181f285d1c487cd01e65ca74",
    "files": [
        {
            "sha": "9e6eadcd4891559104400caaf9a559427a037d71",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 24,
            "deletions": 17,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/9e8df02d685e1ce6181f285d1c487cd01e65ca74/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/9e8df02d685e1ce6181f285d1c487cd01e65ca74/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=9e8df02d685e1ce6181f285d1c487cd01e65ca74",
            "patch": "@@ -9,7 +9,9 @@\n from threading import local\n \n from django.utils.importlib import import_module\n+from django.utils.encoding import smart_str, smart_text\n from django.utils.safestring import mark_safe, SafeData\n+from django.utils import six\n from django.utils.six import StringIO\n \n \n@@ -259,12 +261,14 @@ def do_translate(message, translation_function):\n def gettext(message):\n     return do_translate(message, 'gettext')\n \n-def ugettext(message):\n-    return do_translate(message, 'ugettext')\n+if six.PY3:\n+    ugettext = gettext\n+else:\n+    def ugettext(message):\n+        return do_translate(message, 'ugettext')\n \n def pgettext(context, message):\n-    result = do_translate(\n-        \"%s%s%s\" % (context, CONTEXT_SEPARATOR, message), 'ugettext')\n+    result = ugettext(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, message))\n     if CONTEXT_SEPARATOR in result:\n         # Translation not found\n         result = message\n@@ -297,20 +301,23 @@ def ngettext(singular, plural, number):\n     \"\"\"\n     return do_ntranslate(singular, plural, number, 'ngettext')\n \n-def ungettext(singular, plural, number):\n-    \"\"\"\n-    Returns a unicode strings of the translation of either the singular or\n-    plural, based on the number.\n-    \"\"\"\n-    return do_ntranslate(singular, plural, number, 'ungettext')\n+if six.PY3:\n+    ungettext = ngettext\n+else:\n+    def ungettext(singular, plural, number):\n+        \"\"\"\n+        Returns a unicode strings of the translation of either the singular or\n+        plural, based on the number.\n+        \"\"\"\n+        return do_ntranslate(singular, plural, number, 'ungettext')\n \n def npgettext(context, singular, plural, number):\n-    result = do_ntranslate(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, singular),\n-                           \"%s%s%s\" % (context, CONTEXT_SEPARATOR, plural),\n-                           number, 'ungettext')\n+    result = ungettext(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, singular),\n+                       \"%s%s%s\" % (context, CONTEXT_SEPARATOR, plural),\n+                        number)\n     if CONTEXT_SEPARATOR in result:\n         # Translation not found\n-        result = do_ntranslate(singular, plural, number, 'ungettext')\n+        result = ungettext(singular, plural, number)\n     return result\n \n def all_locale_paths():\n@@ -440,7 +447,7 @@ def templatize(src, origin=None):\n     from django.conf import settings\n     from django.template import (Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK,\n             TOKEN_COMMENT, TRANSLATOR_COMMENT_MARK)\n-    src = src.decode(settings.FILE_CHARSET)\n+    src = smart_text(src, settings.FILE_CHARSET)\n     out = StringIO()\n     message_context = None\n     intrans = False\n@@ -455,7 +462,7 @@ def templatize(src, origin=None):\n                 content = ''.join(comment)\n                 translators_comment_start = None\n                 for lineno, line in enumerate(content.splitlines(True)):\n-                    if line.lstrip().startswith(TRANSLATOR_COMMENT_MARK):\n+                    if line.lstrip().startswith(smart_text(TRANSLATOR_COMMENT_MARK)):\n                         translators_comment_start = lineno\n                 for lineno, line in enumerate(content.splitlines(True)):\n                     if translators_comment_start is not None and lineno >= translators_comment_start:\n@@ -570,7 +577,7 @@ def templatize(src, origin=None):\n                 out.write(' # %s' % t.contents)\n             else:\n                 out.write(blankout(t.contents, 'X'))\n-    return out.getvalue().encode('utf-8')\n+    return smart_str(out.getvalue())\n \n def parse_accept_lang_header(lang_string):\n     \"\"\""
        }
    ],
    "stats": {
        "total": 41,
        "additions": 24,
        "deletions": 17
    }
}