{
    "author": "akaariai",
    "message": "Fixed SortedDict.__copy__()\n\nFixed #18175 -- Calling SortedDict.__copy__() resulted in changes to\nthe original dictionary. The reason was likely related to subclassing\ndict.\n\nThanks to linovia for report and patch.",
    "sha": "4b11762f7d7aed2f4f36c4158326c0a4332038f9",
    "files": [
        {
            "sha": "f7042f70611897f37c769bc82c9c072a8a0174f4",
            "filename": "django/utils/datastructures.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4b11762f7d7aed2f4f36c4158326c0a4332038f9/django%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/4b11762f7d7aed2f4f36c4158326c0a4332038f9/django%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdatastructures.py?ref=4b11762f7d7aed2f4f36c4158326c0a4332038f9",
            "patch": "@@ -128,6 +128,12 @@ def __deepcopy__(self, memo):\n         return self.__class__([(key, copy.deepcopy(value, memo))\n                                for key, value in self.iteritems()])\n \n+    def __copy__(self):\n+        # The Python's default copy implementation will alter the state\n+        # of self. The reason for this seems complex but is likely related to\n+        # subclassing dict.\n+        return self.copy()\n+\n     def __setitem__(self, key, value):\n         if key not in self:\n             self.keyOrder.append(key)\n@@ -200,9 +206,7 @@ def insert(self, index, key, value):\n     def copy(self):\n         \"\"\"Returns a copy of this object.\"\"\"\n         # This way of initializing the copy means it works for subclasses, too.\n-        obj = self.__class__(self)\n-        obj.keyOrder = self.keyOrder[:]\n-        return obj\n+        return self.__class__(self)\n \n     def __repr__(self):\n         \"\"\""
        },
        {
            "sha": "000f7f76a1052559c80f5265c5b88574b06eab6f",
            "filename": "tests/regressiontests/utils/datastructures.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4b11762f7d7aed2f4f36c4158326c0a4332038f9/tests%2Fregressiontests%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/4b11762f7d7aed2f4f36c4158326c0a4332038f9/tests%2Fregressiontests%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fdatastructures.py?ref=4b11762f7d7aed2f4f36c4158326c0a4332038f9",
            "patch": "@@ -111,6 +111,12 @@ def test_pickle(self):\n             {7: 'seven', 1: 'one', 9: 'nine'}\n         )\n \n+    def test_copy(self):\n+        orig = SortedDict(((1, \"one\"), (0, \"zero\"), (2, \"two\")))\n+        copied = copy.copy(orig)\n+        self.assertEqual(orig.keys(), [1, 0, 2])\n+        self.assertEqual(copied.keys(), [1, 0, 2])\n+\n     def test_clear(self):\n         self.d1.clear()\n         self.assertEqual(self.d1, {})"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
    }
}