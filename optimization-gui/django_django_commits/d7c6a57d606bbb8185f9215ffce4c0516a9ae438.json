{
    "author": "aaugustin",
    "message": "Used @override_settings in several tests.",
    "sha": "d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
    "files": [
        {
            "sha": "07acb297419653730c0519c26de9d7cff7e6a745",
            "filename": "tests/regressiontests/forms/tests/extra.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -3,11 +3,11 @@\n \n import datetime\n \n-from django.conf import settings\n from django.forms import *\n from django.forms.extras import SelectDateWidget\n from django.forms.util import ErrorList\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils import six\n from django.utils import translation\n from django.utils.encoding import force_text, smart_text, python_2_unicode_compatible\n@@ -642,17 +642,14 @@ def test_field_not_required(self):\n         self.assertFalse(b.has_changed())\n \n \n-\n+@override_settings(USE_L10N=True)\n class FormsExtraL10NTestCase(TestCase):\n     def setUp(self):\n         super(FormsExtraL10NTestCase, self).setUp()\n-        self.old_use_l10n = getattr(settings, 'USE_L10N', False)\n-        settings.USE_L10N = True\n         translation.activate('nl')\n \n     def tearDown(self):\n         translation.deactivate()\n-        settings.USE_L10N = self.old_use_l10n\n         super(FormsExtraL10NTestCase, self).tearDown()\n \n     def test_l10n(self):"
        },
        {
            "sha": "d591804b9db744d91637817c092ca345707d69d2",
            "filename": "tests/regressiontests/forms/tests/input_formats.py",
            "status": "modified",
            "additions": 9,
            "deletions": 49,
            "changes": 58,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fforms%2Ftests%2Finput_formats.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fforms%2Ftests%2Finput_formats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Finput_formats.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -1,25 +1,17 @@\n from datetime import time, date, datetime\n \n from django import forms\n-from django.conf import settings\n+from django.test.utils import override_settings\n from django.utils.translation import activate, deactivate\n from django.utils.unittest import TestCase\n \n \n+@override_settings(TIME_INPUT_FORMATS=[\"%I:%M:%S %p\", \"%I:%M %p\"], USE_L10N=True)\n class LocalizedTimeTests(TestCase):\n     def setUp(self):\n-        self.old_TIME_INPUT_FORMATS = settings.TIME_INPUT_FORMATS\n-        self.old_USE_L10N = settings.USE_L10N\n-\n-        settings.TIME_INPUT_FORMATS = [\"%I:%M:%S %p\", \"%I:%M %p\"]\n-        settings.USE_L10N = True\n-\n         activate('de')\n \n     def tearDown(self):\n-        settings.TIME_INPUT_FORMATS = self.old_TIME_INPUT_FORMATS\n-        settings.USE_L10N = self.old_USE_L10N\n-\n         deactivate()\n \n     def test_timeField(self):\n@@ -113,14 +105,8 @@ def test_localized_timeField_with_inputformat(self):\n         self.assertEqual(text, \"13:30:00\")\n \n \n+@override_settings(TIME_INPUT_FORMATS=[\"%I:%M:%S %p\", \"%I:%M %p\"])\n class CustomTimeInputFormatsTests(TestCase):\n-    def setUp(self):\n-        self.old_TIME_INPUT_FORMATS = settings.TIME_INPUT_FORMATS\n-        settings.TIME_INPUT_FORMATS = [\"%I:%M:%S %p\", \"%I:%M %p\"]\n-\n-    def tearDown(self):\n-        settings.TIME_INPUT_FORMATS = self.old_TIME_INPUT_FORMATS\n-\n     def test_timeField(self):\n         \"TimeFields can parse dates in the default format\"\n         f = forms.TimeField()\n@@ -302,20 +288,12 @@ def test_localized_timeField_with_inputformat(self):\n         self.assertEqual(text, \"13:30:00\")\n \n \n+@override_settings(DATE_INPUT_FORMATS=[\"%d/%m/%Y\", \"%d-%m-%Y\"], USE_L10N=True)\n class LocalizedDateTests(TestCase):\n     def setUp(self):\n-        self.old_DATE_INPUT_FORMATS = settings.DATE_INPUT_FORMATS\n-        self.old_USE_L10N = settings.USE_L10N\n-\n-        settings.DATE_INPUT_FORMATS = [\"%d/%m/%Y\", \"%d-%m-%Y\"]\n-        settings.USE_L10N = True\n-\n         activate('de')\n \n     def tearDown(self):\n-        settings.DATE_INPUT_FORMATS = self.old_DATE_INPUT_FORMATS\n-        settings.USE_L10N = self.old_USE_L10N\n-\n         deactivate()\n \n     def test_dateField(self):\n@@ -410,14 +388,9 @@ def test_localized_dateField_with_inputformat(self):\n         text = f.widget._format_value(result)\n         self.assertEqual(text, \"21.12.2010\")\n \n-class CustomDateInputFormatsTests(TestCase):\n-    def setUp(self):\n-        self.old_DATE_INPUT_FORMATS = settings.DATE_INPUT_FORMATS\n-        settings.DATE_INPUT_FORMATS = [\"%d.%m.%Y\", \"%d-%m-%Y\"]\n-\n-    def tearDown(self):\n-        settings.DATE_INPUT_FORMATS = self.old_DATE_INPUT_FORMATS\n \n+@override_settings(DATE_INPUT_FORMATS=[\"%d.%m.%Y\", \"%d-%m-%Y\"])\n+class CustomDateInputFormatsTests(TestCase):\n     def test_dateField(self):\n         \"DateFields can parse dates in the default format\"\n         f = forms.DateField()\n@@ -597,20 +570,13 @@ def test_localized_dateField_with_inputformat(self):\n         text = f.widget._format_value(result)\n         self.assertEqual(text, \"2010-12-21\")\n \n+\n+@override_settings(DATETIME_INPUT_FORMATS=[\"%I:%M:%S %p %d/%m/%Y\", \"%I:%M %p %d-%m-%Y\"], USE_L10N=True)\n class LocalizedDateTimeTests(TestCase):\n     def setUp(self):\n-        self.old_DATETIME_INPUT_FORMATS = settings.DATETIME_INPUT_FORMATS\n-        self.old_USE_L10N = settings.USE_L10N\n-\n-        settings.DATETIME_INPUT_FORMATS = [\"%I:%M:%S %p %d/%m/%Y\", \"%I:%M %p %d-%m-%Y\"]\n-        settings.USE_L10N = True\n-\n         activate('de')\n \n     def tearDown(self):\n-        settings.DATETIME_INPUT_FORMATS = self.old_DATETIME_INPUT_FORMATS\n-        settings.USE_L10N = self.old_USE_L10N\n-\n         deactivate()\n \n     def test_dateTimeField(self):\n@@ -706,14 +672,8 @@ def test_localized_dateTimeField_with_inputformat(self):\n         self.assertEqual(text, \"21.12.2010 13:30:00\")\n \n \n+@override_settings(DATETIME_INPUT_FORMATS=[\"%I:%M:%S %p %d/%m/%Y\", \"%I:%M %p %d-%m-%Y\"])\n class CustomDateTimeInputFormatsTests(TestCase):\n-    def setUp(self):\n-        self.old_DATETIME_INPUT_FORMATS = settings.DATETIME_INPUT_FORMATS\n-        settings.DATETIME_INPUT_FORMATS = [\"%I:%M:%S %p %d/%m/%Y\", \"%I:%M %p %d-%m-%Y\"]\n-\n-    def tearDown(self):\n-        settings.DATETIME_INPUT_FORMATS = self.old_DATETIME_INPUT_FORMATS\n-\n     def test_dateTimeField(self):\n         \"DateTimeFields can parse dates in the default format\"\n         f = forms.DateTimeField()"
        },
        {
            "sha": "4bdd3f76eac6f55d13c41acbce6ef07a97084095",
            "filename": "tests/regressiontests/forms/tests/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -4,7 +4,6 @@\n import copy\n import datetime\n \n-from django.conf import settings\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.forms import *\n from django.forms.widgets import RadioFieldRenderer\n@@ -13,6 +12,7 @@\n from django.utils import six\n from django.utils.translation import activate, deactivate\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils.encoding import python_2_unicode_compatible\n \n \n@@ -989,16 +989,14 @@ class NullBooleanSelectLazyForm(Form):\n     \"\"\"Form to test for lazy evaluation. Refs #17190\"\"\"\n     bool = BooleanField(widget=NullBooleanSelect())\n \n+@override_settings(USE_L10N=True)\n class FormsI18NWidgetsTestCase(TestCase):\n     def setUp(self):\n         super(FormsI18NWidgetsTestCase, self).setUp()\n-        self.old_use_l10n = getattr(settings, 'USE_L10N', False)\n-        settings.USE_L10N = True\n         activate('de-at')\n \n     def tearDown(self):\n         deactivate()\n-        settings.USE_L10N = self.old_use_l10n\n         super(FormsI18NWidgetsTestCase, self).tearDown()\n \n     def test_splitdatetime(self):"
        },
        {
            "sha": "8676a448d95be2ba0d984828ad1f94433b051f07",
            "filename": "tests/regressiontests/handlers/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fhandlers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fhandlers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhandlers%2Ftests.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -1,27 +1,23 @@\n-from django.conf import settings\n from django.core.handlers.wsgi import WSGIHandler\n from django.test import RequestFactory\n+from django.test.utils import override_settings\n from django.utils import unittest\n \n-\n class HandlerTests(unittest.TestCase):\n \n+    # Mangle settings so the handler will fail\n+    @override_settings(MIDDLEWARE_CLASSES=42)\n     def test_lock_safety(self):\n         \"\"\"\n         Tests for bug #11193 (errors inside middleware shouldn't leave\n         the initLock locked).\n         \"\"\"\n-        # Mangle settings so the handler will fail\n-        old_middleware_classes = settings.MIDDLEWARE_CLASSES\n-        settings.MIDDLEWARE_CLASSES = 42\n         # Try running the handler, it will fail in load_middleware\n         handler = WSGIHandler()\n         self.assertEqual(handler.initLock.locked(), False)\n         with self.assertRaises(Exception):\n             handler(None, None)\n         self.assertEqual(handler.initLock.locked(), False)\n-        # Reset settings\n-        settings.MIDDLEWARE_CLASSES = old_middleware_classes\n \n     def test_bad_path_info(self):\n         \"\"\"Tests for bug #15672 ('request' referenced before assignment)\"\"\""
        },
        {
            "sha": "79fe6beebd7b2fae479e933f4a659fb5e91a12fb",
            "filename": "tests/regressiontests/multiple_database/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 12,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fmultiple_database%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fmultiple_database%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmultiple_database%2Ftests.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -4,13 +4,13 @@\n import pickle\n from operator import attrgetter\n \n-from django.conf import settings\n from django.contrib.auth.models import User\n from django.contrib.contenttypes.models import ContentType\n from django.core import management\n from django.db import connections, router, DEFAULT_DB_ALIAS\n from django.db.models import signals\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils.six import StringIO\n \n from .models import Book, Person, Pet, Review, UserProfile\n@@ -1620,20 +1620,11 @@ def test_dumpdata(self):\n         command_output = new_io.getvalue().strip()\n         self.assertTrue('\"email\": \"alice@example.com\",' in command_output)\n \n-_missing = object()\n-class UserProfileTestCase(TestCase):\n-    def setUp(self):\n-        self.old_auth_profile_module = getattr(settings, 'AUTH_PROFILE_MODULE', _missing)\n-        settings.AUTH_PROFILE_MODULE = 'multiple_database.UserProfile'\n \n-    def tearDown(self):\n-        if self.old_auth_profile_module is _missing:\n-            del settings.AUTH_PROFILE_MODULE\n-        else:\n-            settings.AUTH_PROFILE_MODULE = self.old_auth_profile_module\n+@override_settings(AUTH_PROFILE_MODULE='multiple_database.UserProfile')\n+class UserProfileTestCase(TestCase):\n \n     def test_user_profiles(self):\n-\n         alice = User.objects.create_user('alice', 'alice@example.com')\n         bob = User.objects.db_manager('other').create_user('bob', 'bob@example.com')\n "
        },
        {
            "sha": "9a3197a06a1d7ed213fcfe786d467df3fa91fd4b",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 117,
            "deletions": 129,
            "changes": 246,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -5,12 +5,11 @@\n from datetime import datetime, timedelta\n from io import BytesIO\n \n-from django.conf import settings\n from django.core.exceptions import SuspiciousOperation\n from django.core.handlers.wsgi import WSGIRequest, LimitedStream\n from django.http import HttpRequest, HttpResponse, parse_cookie, build_request_repr, UnreadablePostError\n from django.test.client import FakePayload\n-from django.test.utils import str_prefix\n+from django.test.utils import override_settings, str_prefix\n from django.utils import unittest\n from django.utils.http import cookie_date\n from django.utils.timezone import utc\n@@ -70,157 +69,146 @@ def test_httprequest_location(self):\n         self.assertEqual(request.build_absolute_uri(location=\"/path/with:colons\"),\n             'http://www.example.com/path/with:colons')\n \n+    @override_settings(USE_X_FORWARDED_HOST=False)\n     def test_http_get_host(self):\n-        old_USE_X_FORWARDED_HOST = settings.USE_X_FORWARDED_HOST\n-        try:\n-            settings.USE_X_FORWARDED_HOST = False\n-\n-            # Check if X_FORWARDED_HOST is provided.\n-            request = HttpRequest()\n-            request.META = {\n-                'HTTP_X_FORWARDED_HOST': 'forward.com',\n-                'HTTP_HOST': 'example.com',\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 80,\n-            }\n-            # X_FORWARDED_HOST is ignored.\n-            self.assertEqual(request.get_host(), 'example.com')\n-\n-            # Check if X_FORWARDED_HOST isn't provided.\n-            request = HttpRequest()\n-            request.META = {\n-                'HTTP_HOST': 'example.com',\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 80,\n-            }\n-            self.assertEqual(request.get_host(), 'example.com')\n+        # Check if X_FORWARDED_HOST is provided.\n+        request = HttpRequest()\n+        request.META = {\n+            'HTTP_X_FORWARDED_HOST': 'forward.com',\n+            'HTTP_HOST': 'example.com',\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 80,\n+        }\n+        # X_FORWARDED_HOST is ignored.\n+        self.assertEqual(request.get_host(), 'example.com')\n+\n+        # Check if X_FORWARDED_HOST isn't provided.\n+        request = HttpRequest()\n+        request.META = {\n+            'HTTP_HOST': 'example.com',\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 80,\n+        }\n+        self.assertEqual(request.get_host(), 'example.com')\n+\n+        # Check if HTTP_HOST isn't provided.\n+        request = HttpRequest()\n+        request.META = {\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 80,\n+        }\n+        self.assertEqual(request.get_host(), 'internal.com')\n \n-            # Check if HTTP_HOST isn't provided.\n+        # Check if HTTP_HOST isn't provided, and we're on a nonstandard port\n+        request = HttpRequest()\n+        request.META = {\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 8042,\n+        }\n+        self.assertEqual(request.get_host(), 'internal.com:8042')\n+\n+        # Poisoned host headers are rejected as suspicious\n+        legit_hosts = [\n+            'example.com',\n+            'example.com:80',\n+            '12.34.56.78',\n+            '12.34.56.78:443',\n+            '[2001:19f0:feee::dead:beef:cafe]',\n+            '[2001:19f0:feee::dead:beef:cafe]:8080',\n+        ]\n+\n+        poisoned_hosts = [\n+            'example.com@evil.tld',\n+            'example.com:dr.frankenstein@evil.tld',\n+            'example.com:someone@somestie.com:80',\n+            'example.com:80/badpath'\n+        ]\n+\n+        for host in legit_hosts:\n             request = HttpRequest()\n             request.META = {\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 80,\n+                'HTTP_HOST': host,\n             }\n-            self.assertEqual(request.get_host(), 'internal.com')\n+            request.get_host()\n \n-            # Check if HTTP_HOST isn't provided, and we're on a nonstandard port\n-            request = HttpRequest()\n-            request.META = {\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 8042,\n-            }\n-            self.assertEqual(request.get_host(), 'internal.com:8042')\n-\n-            # Poisoned host headers are rejected as suspicious\n-            legit_hosts = [\n-                'example.com',\n-                'example.com:80',\n-                '12.34.56.78',\n-                '12.34.56.78:443',\n-                '[2001:19f0:feee::dead:beef:cafe]',\n-                '[2001:19f0:feee::dead:beef:cafe]:8080',\n-            ]\n-\n-            poisoned_hosts = [\n-                'example.com@evil.tld',\n-                'example.com:dr.frankenstein@evil.tld',\n-                'example.com:someone@somestie.com:80',\n-                'example.com:80/badpath'\n-            ]\n-\n-            for host in legit_hosts:\n+        for host in poisoned_hosts:\n+            with self.assertRaises(SuspiciousOperation):\n                 request = HttpRequest()\n                 request.META = {\n                     'HTTP_HOST': host,\n                 }\n                 request.get_host()\n \n-            for host in poisoned_hosts:\n-                with self.assertRaises(SuspiciousOperation):\n-                    request = HttpRequest()\n-                    request.META = {\n-                        'HTTP_HOST': host,\n-                    }\n-                    request.get_host()\n-\n-        finally:\n-            settings.USE_X_FORWARDED_HOST = old_USE_X_FORWARDED_HOST\n-\n+    @override_settings(USE_X_FORWARDED_HOST=True)\n     def test_http_get_host_with_x_forwarded_host(self):\n-        old_USE_X_FORWARDED_HOST = settings.USE_X_FORWARDED_HOST\n-        try:\n-            settings.USE_X_FORWARDED_HOST = True\n-\n-            # Check if X_FORWARDED_HOST is provided.\n-            request = HttpRequest()\n-            request.META = {\n-                'HTTP_X_FORWARDED_HOST': 'forward.com',\n-                'HTTP_HOST': 'example.com',\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 80,\n-            }\n-            # X_FORWARDED_HOST is obeyed.\n-            self.assertEqual(request.get_host(), 'forward.com')\n-\n-            # Check if X_FORWARDED_HOST isn't provided.\n-            request = HttpRequest()\n-            request.META = {\n-                'HTTP_HOST': 'example.com',\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 80,\n-            }\n-            self.assertEqual(request.get_host(), 'example.com')\n+        # Check if X_FORWARDED_HOST is provided.\n+        request = HttpRequest()\n+        request.META = {\n+            'HTTP_X_FORWARDED_HOST': 'forward.com',\n+            'HTTP_HOST': 'example.com',\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 80,\n+        }\n+        # X_FORWARDED_HOST is obeyed.\n+        self.assertEqual(request.get_host(), 'forward.com')\n+\n+        # Check if X_FORWARDED_HOST isn't provided.\n+        request = HttpRequest()\n+        request.META = {\n+            'HTTP_HOST': 'example.com',\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 80,\n+        }\n+        self.assertEqual(request.get_host(), 'example.com')\n+\n+        # Check if HTTP_HOST isn't provided.\n+        request = HttpRequest()\n+        request.META = {\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 80,\n+        }\n+        self.assertEqual(request.get_host(), 'internal.com')\n \n-            # Check if HTTP_HOST isn't provided.\n+        # Check if HTTP_HOST isn't provided, and we're on a nonstandard port\n+        request = HttpRequest()\n+        request.META = {\n+            'SERVER_NAME': 'internal.com',\n+            'SERVER_PORT': 8042,\n+        }\n+        self.assertEqual(request.get_host(), 'internal.com:8042')\n+\n+        # Poisoned host headers are rejected as suspicious\n+        legit_hosts = [\n+            'example.com',\n+            'example.com:80',\n+            '12.34.56.78',\n+            '12.34.56.78:443',\n+            '[2001:19f0:feee::dead:beef:cafe]',\n+            '[2001:19f0:feee::dead:beef:cafe]:8080',\n+        ]\n+\n+        poisoned_hosts = [\n+            'example.com@evil.tld',\n+            'example.com:dr.frankenstein@evil.tld',\n+            'example.com:dr.frankenstein@evil.tld:80',\n+            'example.com:80/badpath'\n+        ]\n+\n+        for host in legit_hosts:\n             request = HttpRequest()\n             request.META = {\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 80,\n+                'HTTP_HOST': host,\n             }\n-            self.assertEqual(request.get_host(), 'internal.com')\n+            request.get_host()\n \n-            # Check if HTTP_HOST isn't provided, and we're on a nonstandard port\n-            request = HttpRequest()\n-            request.META = {\n-                'SERVER_NAME': 'internal.com',\n-                'SERVER_PORT': 8042,\n-            }\n-            self.assertEqual(request.get_host(), 'internal.com:8042')\n-\n-            # Poisoned host headers are rejected as suspicious\n-            legit_hosts = [\n-                'example.com',\n-                'example.com:80',\n-                '12.34.56.78',\n-                '12.34.56.78:443',\n-                '[2001:19f0:feee::dead:beef:cafe]',\n-                '[2001:19f0:feee::dead:beef:cafe]:8080',\n-            ]\n-\n-            poisoned_hosts = [\n-                'example.com@evil.tld',\n-                'example.com:dr.frankenstein@evil.tld',\n-                'example.com:dr.frankenstein@evil.tld:80',\n-                'example.com:80/badpath'\n-            ]\n-\n-            for host in legit_hosts:\n+        for host in poisoned_hosts:\n+            with self.assertRaises(SuspiciousOperation):\n                 request = HttpRequest()\n                 request.META = {\n                     'HTTP_HOST': host,\n                 }\n                 request.get_host()\n \n-            for host in poisoned_hosts:\n-                with self.assertRaises(SuspiciousOperation):\n-                    request = HttpRequest()\n-                    request.META = {\n-                        'HTTP_HOST': host,\n-                    }\n-                    request.get_host()\n-\n-        finally:\n-            settings.USE_X_FORWARDED_HOST = old_USE_X_FORWARDED_HOST\n \n     def test_near_expiration(self):\n         \"Cookie will expire when an near expiration time is provided\""
        },
        {
            "sha": "c95b5bfa3c863693d01fde022e1d530d9a072368",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -155,16 +155,8 @@ class UTF8Class:\n     def __str__(self):\n         return 'ŠĐĆŽćžšđ'\n \n+@override_settings(MEDIA_URL=\"/media/\", STATIC_URL=\"/static/\")\n class Templates(unittest.TestCase):\n-    def setUp(self):\n-        self.old_static_url = settings.STATIC_URL\n-        self.old_media_url = settings.MEDIA_URL\n-        settings.STATIC_URL = \"/static/\"\n-        settings.MEDIA_URL = \"/media/\"\n-\n-    def tearDown(self):\n-        settings.STATIC_URL = self.old_static_url\n-        settings.MEDIA_URL = self.old_media_url\n \n     def test_loaders_security(self):\n         ad_loader = app_directories.Loader()"
        },
        {
            "sha": "8b8ef8ba9b77cb22d77cdb44404fa32db35d6e15",
            "filename": "tests/regressiontests/views/tests/static.py",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/d7c6a57d606bbb8185f9215ffce4c0516a9ae438/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fstatic.py?ref=d7c6a57d606bbb8185f9215ffce4c0516a9ae438",
            "patch": "@@ -4,27 +4,22 @@\n from os import path\n import unittest\n \n-from django.conf import settings\n from django.conf.urls.static import static\n from django.http import HttpResponseNotModified\n from django.test import TestCase\n+from django.test.utils import override_settings\n from django.utils.http import http_date\n from django.views.static import was_modified_since\n \n from .. import urls\n from ..urls import media_dir\n \n \n+@override_settings(DEBUG=True)\n class StaticTests(TestCase):\n     \"\"\"Tests django views in django/views/static.py\"\"\"\n \n-    def setUp(self):\n-        self.prefix = 'site_media'\n-        self.old_debug = settings.DEBUG\n-        settings.DEBUG = True\n-\n-    def tearDown(self):\n-        settings.DEBUG = self.old_debug\n+    prefix = 'site_media'\n \n     def test_serve(self):\n         \"The static view can serve static media\"\n@@ -112,7 +107,6 @@ class StaticHelperTest(StaticTests):\n     \"\"\"\n     def setUp(self):\n         super(StaticHelperTest, self).setUp()\n-        self.prefix = 'media'\n         self._old_views_urlpatterns = urls.urlpatterns[:]\n         urls.urlpatterns += static('/media/', document_root=media_dir)\n "
        }
    ],
    "stats": {
        "total": 364,
        "additions": 140,
        "deletions": 224
    }
}