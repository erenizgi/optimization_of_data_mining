{
    "author": "spookylukey",
    "message": "Fixed #14880 - raw_id_fields in admin does not work when limit_choices_to dictionary has value=False\n\nThanks to smallming for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15348 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "655d5afea9d1f3d5aa55efc9fe77a14b353e35a6",
    "files": [
        {
            "sha": "1978b3e800a2bbdff32e39b2ef7d0ebcdfff8709",
            "filename": "django/contrib/admin/widgets.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/655d5afea9d1f3d5aa55efc9fe77a14b353e35a6/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/655d5afea9d1f3d5aa55efc9fe77a14b353e35a6/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fwidgets.py?ref=655d5afea9d1f3d5aa55efc9fe77a14b353e35a6",
            "patch": "@@ -102,6 +102,9 @@ def url_params_from_lookup_dict(lookups):\n         for k, v in lookups.items():\n             if isinstance(v, list):\n                 v = u','.join([str(x) for x in v])\n+            elif isinstance(v, bool):\n+                # See django.db.fields.BooleanField.get_prep_lookup\n+                v = ('0', '1')[v]\n             else:\n                 v = unicode(v)\n             items.append((k, v))"
        },
        {
            "sha": "02c6b9208d4316ff61b0f2f1186fb080187d51fb",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/655d5afea9d1f3d5aa55efc9fe77a14b353e35a6/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/655d5afea9d1f3d5aa55efc9fe77a14b353e35a6/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=655d5afea9d1f3d5aa55efc9fe77a14b353e35a6",
            "patch": "@@ -187,17 +187,27 @@ def __unicode__(self):\n class Inquisition(models.Model):\n     expected = models.BooleanField()\n     leader = models.ForeignKey(Actor)\n+    country = models.CharField(max_length=20)\n+\n     def __unicode__(self):\n-        return self.expected\n+        return u\"by %s from %s\" % (self.leader, self.country)\n+\n+class InquisitionAdmin(admin.ModelAdmin):\n+    list_display = ('leader', 'country', 'expected')\n \n class Sketch(models.Model):\n     title = models.CharField(max_length=100)\n     inquisition = models.ForeignKey(Inquisition, limit_choices_to={'leader__name': 'Palin',\n                                                                    'leader__age': 27,\n+                                                                   'expected': False,\n                                                                    })\n+\n     def __unicode__(self):\n         return self.title\n \n+class SketchAdmin(admin.ModelAdmin):\n+    raw_id_fields = ('inquisition',)\n+\n class Fabric(models.Model):\n     NG_CHOICES = (\n         ('Textured', (\n@@ -663,8 +673,8 @@ def __unicode__(self):\n admin.site.register(Color)\n admin.site.register(Thing, ThingAdmin)\n admin.site.register(Actor)\n-admin.site.register(Inquisition)\n-admin.site.register(Sketch)\n+admin.site.register(Inquisition, InquisitionAdmin)\n+admin.site.register(Sketch, SketchAdmin)\n admin.site.register(Person, PersonAdmin)\n admin.site.register(Persona, PersonaAdmin)\n admin.site.register(Subscriber, SubscriberAdmin)"
        },
        {
            "sha": "54cc74930269ed03d7f89231ffac2ff0447c284e",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/655d5afea9d1f3d5aa55efc9fe77a14b353e35a6/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/655d5afea9d1f3d5aa55efc9fe77a14b353e35a6/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=655d5afea9d1f3d5aa55efc9fe77a14b353e35a6",
            "patch": "@@ -2,6 +2,7 @@\n \n import re\n import datetime\n+import urlparse\n \n from django.conf import settings\n from django.core import mail\n@@ -34,7 +35,7 @@\n     Person, Persona, Picture, Podcast, Section, Subscriber, Vodcast,\n     Language, Collector, Widget, Grommet, DooHickey, FancyDoodad, Whatsit,\n     Category, Post, Plot, FunkyTag, Chapter, Book, Promo, WorkHour, Employee,\n-    Question, Answer)\n+    Question, Answer, Inquisition, Actor)\n \n \n class AdminViewBasicTest(TestCase):\n@@ -2350,6 +2351,39 @@ def test_readonly_manytomany(self):\n         response = self.client.get('/test_admin/admin/admin_views/pizza/add/')\n         self.assertEqual(response.status_code, 200)\n \n+\n+class RawIdFieldsTest(TestCase):\n+    fixtures = ['admin-views-users.xml']\n+\n+    def setUp(self):\n+        self.client.login(username='super', password='secret')\n+\n+    def tearDown(self):\n+        self.client.logout()\n+\n+    def test_limit_choices_to(self):\n+        \"\"\"Regression test for 14880\"\"\"\n+        # This includes tests integers, strings and booleans in the lookup query string\n+        actor = Actor.objects.create(name=\"Palin\", age=27)\n+        inquisition1 = Inquisition.objects.create(expected=True,\n+                                                  leader=actor,\n+                                                  country=\"England\")\n+        inquisition2 = Inquisition.objects.create(expected=False,\n+                                                  leader=actor,\n+                                                  country=\"Spain\")\n+        response = self.client.get('/test_admin/admin/admin_views/sketch/add/')\n+        # Find the link\n+        m = re.search(r'<a href=\"([^\"]*)\"[^>]* id=\"lookup_id_inquisition\"', response.content)\n+        self.assertTrue(m) # Got a match\n+        popup_url = m.groups()[0].replace(\"&amp;\", \"&\")\n+\n+        # Handle relative links\n+        popup_url = urlparse.urljoin(response.request['PATH_INFO'], popup_url)\n+        # Get the popup\n+        response2 = self.client.get(popup_url)\n+        self.assertContains(response2, \"Spain\")\n+        self.assertNotContains(response2, \"England\")\n+\n class UserAdminTest(TestCase):\n     \"\"\"\n     Tests user CRUD functionality."
        }
    ],
    "stats": {
        "total": 55,
        "additions": 51,
        "deletions": 4
    }
}