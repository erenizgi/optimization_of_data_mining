{
    "author": "jezdez",
    "message": "Fixed #17594 -- Stopped ModelFormset.save from running a SELECT query by relying on the fact that the initial form is already set. Thanks, tswicegood.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17434 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4d8a0f8902dd55348fbaf897048bef1cba285f05",
    "files": [
        {
            "sha": "cd8f027070e79ae862130f44dcdc1990f263cd70",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4d8a0f8902dd55348fbaf897048bef1cba285f05/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4d8a0f8902dd55348fbaf897048bef1cba285f05/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=4d8a0f8902dd55348fbaf897048bef1cba285f05",
            "patch": "@@ -591,7 +591,7 @@ def get_form_error(self):\n     def save_existing_objects(self, commit=True):\n         self.changed_objects = []\n         self.deleted_objects = []\n-        if not self.get_queryset():\n+        if not self.initial_forms:\n             return []\n \n         saved_instances = []"
        },
        {
            "sha": "f1e935e2ea8e8224ac7971474569be64c0b64e11",
            "filename": "tests/regressiontests/model_formsets_regress/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4d8a0f8902dd55348fbaf897048bef1cba285f05/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4d8a0f8902dd55348fbaf897048bef1cba285f05/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py?ref=4d8a0f8902dd55348fbaf897048bef1cba285f05",
            "patch": "@@ -249,6 +249,17 @@ def test_initial_data(self):\n         self.assertEqual(formset.extra_forms[0].initial['username'], \"apollo11\")\n         self.assertTrue(u'value=\"apollo12\"' in formset.extra_forms[1].as_p())\n \n+    def test_extraneous_query_is_not_run(self):\n+        Formset = modelformset_factory(Network)\n+        data = {u'test-TOTAL_FORMS': u'1',\n+                u'test-INITIAL_FORMS': u'0',\n+                u'test-MAX_NUM_FORMS': u'',\n+                u'test-0-name': u'Random Place', }\n+        with self.assertNumQueries(1):\n+            formset = Formset(data, prefix=\"test\")\n+            formset.save()\n+\n+\n class CustomWidget(forms.CharField):\n     pass\n "
        }
    ],
    "stats": {
        "total": 13,
        "additions": 12,
        "deletions": 1
    }
}