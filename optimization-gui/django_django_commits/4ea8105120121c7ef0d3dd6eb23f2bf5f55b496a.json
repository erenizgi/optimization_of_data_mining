{
    "author": "ptone",
    "message": "Fixed #19061 -- added is_active attribute to AbstractBaseUser",
    "sha": "4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a",
    "files": [
        {
            "sha": "9279c526754501952925dd4ab0ba0a4c4a582439",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a",
            "patch": "@@ -209,10 +209,12 @@ def clean_email(self):\n         \"\"\"\n         UserModel = get_user_model()\n         email = self.cleaned_data[\"email\"]\n-        self.users_cache = UserModel.objects.filter(email__iexact=email,\n-                                                    is_active=True)\n+        self.users_cache = UserModel.objects.filter(email__iexact=email)\n         if not len(self.users_cache):\n             raise forms.ValidationError(self.error_messages['unknown'])\n+        if not any(user.is_active for user in self.users_cache):\n+            # none of the filtered users are active\n+            raise forms.ValidationError(self.error_messages['unknown'])\n         if any((user.password == UNUSABLE_PASSWORD)\n                for user in self.users_cache):\n             raise forms.ValidationError(self.error_messages['unusable'])"
        },
        {
            "sha": "de4de7cdfd7710bdd6bfe2ddba307882334e9646",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a",
            "patch": "@@ -232,6 +232,8 @@ class AbstractBaseUser(models.Model):\n     password = models.CharField(_('password'), max_length=128)\n     last_login = models.DateTimeField(_('last login'), default=timezone.now)\n \n+    is_active = True\n+\n     REQUIRED_FIELDS = []\n \n     class Meta:"
        },
        {
            "sha": "710ac8bdd746601119f18f902f34b82103c959a1",
            "filename": "django/contrib/auth/tests/custom_user.py",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "raw_url": "https://github.com/django/django/raw/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fcustom_user.py?ref=4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a",
            "patch": "@@ -88,3 +88,20 @@ class ExtensionUser(AbstractUser):\n \n     class Meta:\n         app_label = 'auth'\n+\n+\n+class IsActiveTestUser1(AbstractBaseUser):\n+    \"\"\"\n+    This test user class and derivatives test the default is_active behavior\n+    \"\"\"\n+    username = models.CharField(max_length=30, unique=True)\n+\n+    objects = BaseUserManager()\n+\n+    USERNAME_FIELD = 'username'\n+\n+    class Meta:\n+        app_label = 'auth'\n+\n+    # the is_active attr is provided by AbstractBaseUser\n+"
        },
        {
            "sha": "cb7d8888fef53473a647923e31e5a8bc87eec907",
            "filename": "django/contrib/auth/tests/models.py",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py?ref=4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a",
            "patch": "@@ -1,4 +1,5 @@\n from django.conf import settings\n+from django.contrib.auth import get_user_model\n from django.contrib.auth.models import (Group, User, SiteProfileNotAvailable,\n     UserManager)\n from django.contrib.auth.tests.utils import skipIfCustomUser\n@@ -98,3 +99,34 @@ def test_empty_username(self):\n         self.assertRaisesMessage(ValueError,\n                                  'The given username must be set',\n                                   User.objects.create_user, username='')\n+\n+class IsActiveTestCase(TestCase):\n+    \"\"\"\n+    Tests the behavior of the guaranteed is_active attribute\n+    \"\"\"\n+\n+    def test_builtin_user_isactive(self):\n+        user = User.objects.create(username='foo', email='foo@bar.com')\n+        # is_active is true by default\n+        self.assertEqual(user.is_active, True)\n+        user.is_active = False\n+        user.save()\n+        user_fetched = User.objects.get(pk=user.pk)\n+        # the is_active flag is saved\n+        self.assertFalse(user_fetched.is_active)\n+\n+    @override_settings(AUTH_USER_MODEL='auth.IsActiveTestUser1')\n+    def test_is_active_field_default(self):\n+        \"\"\"\n+        tests that the default value for is_active is provided\n+        \"\"\"\n+        UserModel = get_user_model()\n+        user = UserModel(username='foo')\n+        self.assertEqual(user.is_active, True)\n+        # you can set the attribute - but it will not save\n+        user.is_active = False\n+        # there should be no problem saving - but the attribute is not saved\n+        user.save()\n+        user_fetched = UserModel.objects.get(pk=user.pk)\n+        # the attribute is always true for newly retrieved instance\n+        self.assertEqual(user_fetched.is_active, True)"
        },
        {
            "sha": "f7a90840087adc7ea99bff5643930d4491a93569",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=4ea8105120121c7ef0d3dd6eb23f2bf5f55b496a",
            "patch": "@@ -1911,6 +1911,15 @@ password resets. You must then provide some key implementation details:\n             ``REQUIRED_FIELDS`` must contain all required fields on your User\n             model, but should *not* contain the ``USERNAME_FIELD``.\n \n+    .. attribute:: User.is_active\n+\n+        A boolean attribute that indicates whether the user is considered\n+        \"active\".  This attribute is provided as an attribute on\n+        ``AbstractBaseUser`` defaulting to ``True``. How you choose to\n+        implement it will depend on the details of your chosen auth backends.\n+        See the documentation of the :attr:`attribute on the builtin user model\n+        <django.contrib.auth.models.User.is_active>` for details.\n+\n     .. method:: User.get_full_name():\n \n         A longer formal identifier for the user. A common interpretation"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 64,
        "deletions": 2
    }
}