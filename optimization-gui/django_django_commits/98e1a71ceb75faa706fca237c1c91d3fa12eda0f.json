{
    "author": "jezdez",
    "message": "Fixed #14900 -- Added ability to override the paginator class used in a ModelAdmin. Thanks, Adam Vandenberg.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14997 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "98e1a71ceb75faa706fca237c1c91d3fa12eda0f",
    "files": [
        {
            "sha": "ae715a17c4d8d0a56fd68f2f982abd3c19f6e8a5",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=98e1a71ceb75faa706fca237c1c91d3fa12eda0f",
            "patch": "@@ -9,6 +9,7 @@\n from django.contrib import messages\n from django.views.decorators.csrf import csrf_protect\n from django.core.exceptions import PermissionDenied, ValidationError\n+from django.core.paginator import Paginator\n from django.db import models, transaction, router\n from django.db.models.fields import BLANK_CHOICE_DASH\n from django.http import Http404, HttpResponse, HttpResponseRedirect\n@@ -215,6 +216,7 @@ class ModelAdmin(BaseModelAdmin):\n     date_hierarchy = None\n     save_as = False\n     save_on_top = False\n+    paginator = Paginator\n     inlines = []\n \n     # Custom templates (designed to be over-ridden in subclasses)\n@@ -975,8 +977,9 @@ def changelist_view(self, request, extra_context=None):\n \n         ChangeList = self.get_changelist(request)\n         try:\n-            cl = ChangeList(request, self.model, list_display, self.list_display_links, self.list_filter,\n-                self.date_hierarchy, self.search_fields, self.list_select_related, self.list_per_page, self.list_editable, self)\n+            cl = ChangeList(request, self.model, list_display, self.list_display_links,\n+                self.list_filter, self.date_hierarchy, self.search_fields,\n+                self.list_select_related, self.list_per_page, self.list_editable, self.paginator, self)\n         except IncorrectLookupParameters:\n             # Wacky lookup parameters were given, so redirect to the main\n             # changelist page, without parameters, and pass an 'invalid=1'"
        },
        {
            "sha": "288ecac87526b255ce539642282eb556ccb1bc43",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=98e1a71ceb75faa706fca237c1c91d3fa12eda0f",
            "patch": "@@ -26,7 +26,7 @@\n EMPTY_CHANGELIST_VALUE = '(None)'\n \n class ChangeList(object):\n-    def __init__(self, request, model, list_display, list_display_links, list_filter, date_hierarchy, search_fields, list_select_related, list_per_page, list_editable, model_admin):\n+    def __init__(self, request, model, list_display, list_display_links, list_filter, date_hierarchy, search_fields, list_select_related, list_per_page, list_editable, paginator, model_admin):\n         self.model = model\n         self.opts = model._meta\n         self.lookup_opts = self.opts\n@@ -40,6 +40,7 @@ def __init__(self, request, model, list_display, list_display_links, list_filter\n         self.list_per_page = list_per_page\n         self.list_editable = list_editable\n         self.model_admin = model_admin\n+        self.paginator = paginator\n \n         # Get search parameters from the query string.\n         try:\n@@ -94,7 +95,7 @@ def get_query_string(self, new_params=None, remove=None):\n         return '?%s' % urlencode(p)\n \n     def get_results(self, request):\n-        paginator = Paginator(self.query_set, self.list_per_page)\n+        paginator = self.get_paginator(self.query_set, self.list_per_page)\n         # Get the number of objects, with admin filters applied.\n         result_count = paginator.count\n \n@@ -244,3 +245,6 @@ def construct_search(field_name):\n \n     def url_for_result(self, result):\n         return \"%s/\" % quote(getattr(result, self.pk_attname))\n+\n+    def get_paginator(self, queryset, per_page, orphans=0, allow_empty_first_page=True):\n+        return self.paginator(queryset, per_page, orphans, allow_empty_first_page)"
        },
        {
            "sha": "1e3098d7db0c69866c69e096760f7d535983b61b",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=98e1a71ceb75faa706fca237c1c91d3fa12eda0f",
            "patch": "@@ -516,6 +516,16 @@ subclass::\n         Django will only honor the first element in the list/tuple; any others\n         will be ignored.\n \n+.. attribute:: ModelAdmin.paginator\n+\n+    .. versionadded:: 1.3\n+\n+    The paginator class to be used for pagination. By default,\n+    :class:`django.core.paginator.Paginator` is used. If the custom paginator\n+    class doesn't have the same constructor interface as\n+    :class:`django.core.paginator.Paginator`, you will also need to\n+    provide an implementation for :meth:`MultipleObjectMixin.get_paginator`.\n+\n .. attribute:: ModelAdmin.prepopulated_fields\n \n     Set ``prepopulated_fields`` to a dictionary mapping field names to the\n@@ -945,6 +955,13 @@ templates used by the :class:`ModelAdmin` views:\n     using the :mod:`django.contrib.messages` backend. See the\n     :ref:`custom ModelAdmin example <custom-admin-action>`.\n \n+.. method:: ModelAdmin.get_paginator(queryset, per_page, orphans=0, allow_empty_first_page=True)\n+\n+    .. versionadded:: 1.3\n+\n+    Returns an instance of the paginator to use for this view. By default,\n+    instantiates an instance of :attr:`paginator`.\n+\n Other methods\n ~~~~~~~~~~~~~\n "
        },
        {
            "sha": "1fbd76f34afeef487ff0243d54cbc6d3aa2caa72",
            "filename": "tests/regressiontests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 41,
            "deletions": 4,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/98e1a71ceb75faa706fca237c1c91d3fa12eda0f/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py?ref=98e1a71ceb75faa706fca237c1c91d3fa12eda0f",
            "patch": "@@ -1,10 +1,13 @@\n from django.contrib import admin\n from django.contrib.admin.options import IncorrectLookupParameters\n from django.contrib.admin.views.main import ChangeList\n+from django.core.paginator import Paginator\n from django.template import Context, Template\n from django.test import TransactionTestCase\n+\n from regressiontests.admin_changelist.models import Child, Parent\n \n+\n class ChangeListTests(TransactionTestCase):\n     def test_select_related_preserved(self):\n         \"\"\"\n@@ -14,7 +17,8 @@ def test_select_related_preserved(self):\n         m = ChildAdmin(Child, admin.site)\n         cl = ChangeList(MockRequest(), Child, m.list_display, m.list_display_links,\n                 m.list_filter, m.date_hierarchy, m.search_fields,\n-                m.list_select_related, m.list_per_page, m.list_editable, m)\n+                m.list_select_related, m.list_per_page, m.list_editable,\n+                m.paginator, m)\n         self.assertEqual(cl.query_set.query.select_related, {'parent': {'name': {}}})\n \n     def test_result_list_html(self):\n@@ -28,7 +32,8 @@ def test_result_list_html(self):\n         m = ChildAdmin(Child, admin.site)\n         cl = ChangeList(request, Child, m.list_display, m.list_display_links,\n                 m.list_filter, m.date_hierarchy, m.search_fields,\n-                m.list_select_related, m.list_per_page, m.list_editable, m)\n+                m.list_select_related, m.list_per_page, m.list_editable,\n+                m.paginator, m)\n         cl.formset = None\n         template = Template('{% load admin_list %}{% spaceless %}{% result_list cl %}{% endspaceless %}')\n         context = Context({'cl': cl})\n@@ -57,7 +62,8 @@ def test_result_list_editable_html(self):\n         m.list_editable = ['name']\n         cl = ChangeList(request, Child, m.list_display, m.list_display_links,\n                 m.list_filter, m.date_hierarchy, m.search_fields,\n-                m.list_select_related, m.list_per_page, m.list_editable, m)\n+                m.list_select_related, m.list_per_page, m.list_editable,\n+                m.paginator, m)\n         FormSet = m.get_changelist_formset(request)\n         cl.formset = FormSet(queryset=cl.result_list)\n         template = Template('{% load admin_list %}{% spaceless %}{% result_list cl %}{% endspaceless %}')\n@@ -91,13 +97,44 @@ def test_result_list_editable(self):\n         self.assertRaises(IncorrectLookupParameters, lambda: \\\n             ChangeList(request, Child, m.list_display, m.list_display_links,\n                     m.list_filter, m.date_hierarchy, m.search_fields,\n-                    m.list_select_related, m.list_per_page, m.list_editable, m))\n+                    m.list_select_related, m.list_per_page, m.list_editable,\n+                    m.paginator, m))\n+\n+    def test_custom_paginator(self):\n+        new_parent = Parent.objects.create(name='parent')\n+        for i in range(200):\n+            new_child = Child.objects.create(name='name %s' % i, parent=new_parent)\n+\n+        request = MockRequest()\n+        m = ChildAdmin(Child, admin.site)\n+        m.list_display = ['id', 'name', 'parent']\n+        m.list_display_links = ['id']\n+        m.list_editable = ['name']\n+        m.paginator = CustomPaginator\n+\n+        cl = ChangeList(request, Child, m.list_display, m.list_display_links,\n+                m.list_filter, m.date_hierarchy, m.search_fields,\n+                m.list_select_related, m.list_per_page, m.list_editable,\n+                m.paginator, m)\n+\n+        cl.get_results(request)\n+        self.assertIsInstance(cl.paginator, CustomPaginator)\n \n \n class ChildAdmin(admin.ModelAdmin):\n     list_display = ['name', 'parent']\n     def queryset(self, request):\n         return super(ChildAdmin, self).queryset(request).select_related(\"parent__name\")\n \n+\n class MockRequest(object):\n     GET = {}\n+\n+\n+class CustomPaginator(Paginator):\n+    def __init__(self, queryset, page_size, orphans=0, allow_empty_first_page=True):\n+        super(CustomPaginator, self).__init__(\n+            queryset,\n+            5,\n+            orphans=2,\n+            allow_empty_first_page=allow_empty_first_page)"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 69,
        "deletions": 8
    }
}