{
    "author": "jezdez",
    "message": "Fixed #19136 -- Properly escape gettext context prefixes in the i18n JavaScript view template.",
    "sha": "4a5e8087ac7676ef08e76275c1f756778b39c13e",
    "files": [
        {
            "sha": "96643f0d7d429720cee8b64d27255db2ad31730e",
            "filename": "django/views/i18n.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/django%2Fviews%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/django%2Fviews%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fi18n.py?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -99,16 +99,16 @@ def get_formats():\n function gettext_noop(msgid) { return msgid; }\n \n function pgettext(context, msgid) {\n-  var value = gettext(context + '\\x04' + msgid);\n-  if (value.indexOf('\\x04') != -1) {\n+  var value = gettext(context + '\\\\x04' + msgid);\n+  if (value.indexOf('\\\\x04') != -1) {\n     value = msgid;\n   }\n   return value;\n }\n \n function npgettext(context, singular, plural, count) {\n-  var value = ngettext(context + '\\x04' + singular, context + '\\x04' + plural, count);\n-  if (value.indexOf('\\x04') != -1) {\n+  var value = ngettext(context + '\\\\x04' + singular, context + '\\\\x04' + plural, count);\n+  if (value.indexOf('\\\\x04') != -1) {\n     value = ngettext(singular, plural, count);\n   }\n   return value;"
        },
        {
            "sha": "34ba691029be7805899e6e28a03d36a5eb358d2f",
            "filename": "tests/regressiontests/views/locale/de/LC_MESSAGES/djangojs.mo",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Flocale%2Fde%2FLC_MESSAGES%2Fdjangojs.mo",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Flocale%2Fde%2FLC_MESSAGES%2Fdjangojs.mo",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Flocale%2Fde%2FLC_MESSAGES%2Fdjangojs.mo?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e"
        },
        {
            "sha": "88cc35e88f9cc7fa45fa924c99f1cf2a847fd096",
            "filename": "tests/regressiontests/views/locale/de/LC_MESSAGES/djangojs.po",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Flocale%2Fde%2FLC_MESSAGES%2Fdjangojs.po",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Flocale%2Fde%2FLC_MESSAGES%2Fdjangojs.po",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Flocale%2Fde%2FLC_MESSAGES%2Fdjangojs.po?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -0,0 +1,40 @@\n+# SOME DESCRIPTIVE TITLE.\n+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER\n+# This file is distributed under the same license as the PACKAGE package.\n+# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.\n+#\n+msgid \"\"\n+msgstr \"\"\n+\"Project-Id-Version: django tests\\n\"\n+\"Report-Msgid-Bugs-To: \\n\"\n+\"POT-Creation-Date: 2010-02-14 17:33+0100\\n\"\n+\"PO-Revision-Date: 2011-01-21 21:37-0300\\n\"\n+\"Last-Translator: Jannis Leidel <jannis@leidel.info>\\n\"\n+\"Language-Team: de <de@li.org>\\n\"\n+\"MIME-Version: 1.0\\n\"\n+\"Content-Type: text/plain; charset=UTF-8\\n\"\n+\"Content-Transfer-Encoding: 8bit\\n\"\n+\"Plural-Forms: nplurals=2; plural=(n != 1)\\n\"\n+\n+#: models.py:7\n+msgctxt \"month name\"\n+msgid \"May\"\n+msgstr \"Mai\"\n+\n+#: models.py:9\n+msgctxt \"verb\"\n+msgid \"May\"\n+msgstr \"Kann\"\n+\n+#: models.py:11\n+msgid \"%s item\"\n+msgid_plural \"%s items\"\n+msgstr[0] \"%s Element\"\n+msgstr[1] \"%s Elemente\"\n+\n+#: models.py:11\n+msgctxt \"search\"\n+msgid \"%s result\"\n+msgid_plural \"%s results\"\n+msgstr[0] \"%s Resultat\"\n+msgstr[1] \"%s Resultate\""
        },
        {
            "sha": "d6093c8ef4ae8ac84c74fb33b62659d77c6d3fa4",
            "filename": "tests/regressiontests/views/templates/jsi18n.html",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Ftemplates%2Fjsi18n.html",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Ftemplates%2Fjsi18n.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftemplates%2Fjsi18n.html?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -0,0 +1,44 @@\n+<html>\n+<head>\n+  <script type=\"text/javascript\" src=\"/jsi18n_admin/\"></script>\n+</head>\n+\n+<body>\n+  <p id=\"gettext\">\n+    <script type=\"text/javascript\">\n+    document.write(gettext(\"Remove\"));\n+    </script>\n+  </p>\n+\n+  <p id=\"ngettext_sing\">\n+    <script type=\"text/javascript\">\n+    document.write(interpolate(ngettext(\"%s item\", \"%s items\", 1), [1]));\n+    </script>\n+  </p>\n+\n+  <p id=\"ngettext_plur\">\n+    <script type=\"text/javascript\">\n+    document.write(interpolate(ngettext(\"%s item\", \"%s items\", 455), [455]));\n+    </script>\n+  </p>\n+\n+  <p id=\"pgettext\">\n+    <script type=\"text/javascript\">\n+    document.write(pgettext(\"verb\", \"May\"));\n+    </script>\n+  </p>\n+\n+  <p id=\"npgettext_sing\">\n+    <script type=\"text/javascript\">\n+    document.write(interpolate(npgettext(\"search\", \"%s result\", \"%s results\", 1), [1]));\n+    </script>\n+  </p>\n+\n+  <p id=\"npgettext_plur\">\n+    <script type=\"text/javascript\">\n+    document.write(interpolate(npgettext(\"search\", \"%s result\", \"%s results\", 455), [455]));\n+    </script>\n+  </p>\n+\n+</body>\n+</html>"
        },
        {
            "sha": "17f3f4562dbf2a99a88ab62505f46b44416570f1",
            "filename": "tests/regressiontests/views/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2F__init__.py?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -4,7 +4,7 @@\n     ExceptionReporterTests, PlainTextReportTests, ExceptionReporterFilterTests,\n     AjaxResponseExceptionReporterFilter)\n from .defaults import DefaultsTests\n-from .i18n import JsI18NTests, I18NTests, JsI18NTestsMultiPackage\n+from .i18n import JsI18NTests, I18NTests, JsI18NTestsMultiPackage, JavascriptI18nTests\n from .shortcuts import ShortcutTests\n from .specials import URLHandling\n from .static import StaticHelperTest, StaticUtilsTests, StaticTests"
        },
        {
            "sha": "d0bf7d229996526135554414d6aac01887a64bb8",
            "filename": "tests/regressiontests/views/tests/i18n.py",
            "status": "modified",
            "additions": 49,
            "deletions": 3,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -6,11 +6,17 @@\n \n from django.conf import settings\n from django.core.urlresolvers import reverse\n-from django.test import TestCase\n-from django.utils import six\n-from django.utils.translation import override, get_language\n+from django.test import LiveServerTestCase, TestCase\n+from django.test.utils import override_settings\n+from django.utils import six, unittest\n+from django.utils.translation import override\n from django.utils.text import javascript_quote\n \n+try:\n+    from selenium.webdriver.firefox import webdriver as firefox\n+except ImportError:\n+    firefox = None\n+\n from ..urls import locale_dir\n \n \n@@ -152,3 +158,43 @@ def testI18NWithLocalePaths(self):\n                 response = self.client.get('/views/jsi18n/')\n                 self.assertContains(response,\n                     javascript_quote('este texto de app3 debe ser traducido'))\n+\n+\n+@unittest.skipUnless(firefox, 'Selenium not installed')\n+class JavascriptI18nTests(LiveServerTestCase):\n+    urls = 'regressiontests.views.urls'\n+\n+    @classmethod\n+    def setUpClass(cls):\n+        cls.selenium = firefox.WebDriver()\n+        super(JavascriptI18nTests, cls).setUpClass()\n+\n+    @classmethod\n+    def tearDownClass(cls):\n+        cls.selenium.quit()\n+        super(JavascriptI18nTests, cls).tearDownClass()\n+\n+    @override_settings(LANGUAGE_CODE='de')\n+    def test_javascript_gettext(self):\n+        extended_apps = list(settings.INSTALLED_APPS) + ['regressiontests.views']\n+        with self.settings(INSTALLED_APPS=extended_apps):\n+            self.selenium.get('%s%s' % (self.live_server_url, '/jsi18n_template/'))\n+\n+            elem = self.selenium.find_element_by_id(\"gettext\")\n+            self.assertEqual(elem.text, u\"Entfernen\")\n+            elem = self.selenium.find_element_by_id(\"ngettext_sing\")\n+            self.assertEqual(elem.text, \"1 Element\")\n+            elem = self.selenium.find_element_by_id(\"ngettext_plur\")\n+            self.assertEqual(elem.text, \"455 Elemente\")\n+            elem = self.selenium.find_element_by_id(\"pgettext\")\n+            self.assertEqual(elem.text, \"Kann\")\n+            elem = self.selenium.find_element_by_id(\"npgettext_sing\")\n+            self.assertEqual(elem.text, \"1 Resultat\")\n+            elem = self.selenium.find_element_by_id(\"npgettext_plur\")\n+            self.assertEqual(elem.text, \"455 Resultate\")\n+\n+    def test_escaping(self):\n+        extended_apps = list(settings.INSTALLED_APPS) + ['regressiontests.views']\n+        with self.settings(INSTALLED_APPS=extended_apps):\n+            response = self.client.get('%s%s' % (self.live_server_url, '/jsi18n_admin/'))\n+            self.assertContains(response, '\\\\x04')"
        },
        {
            "sha": "ae3b9c0a9eaebcd07d894b1e46e3bc471993f40b",
            "filename": "tests/regressiontests/views/urls.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Furls.py?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -32,6 +32,11 @@\n     'packages': ('regressiontests.views.app3', 'regressiontests.views.app4'),\n }\n \n+js_info_dict_admin = {\n+    'domain': 'djangojs',\n+    'packages': ('django.contrib.admin', 'regressiontests.views'),\n+}\n+\n urlpatterns = patterns('',\n     (r'^$', views.index_page),\n \n@@ -51,6 +56,8 @@\n     (r'^jsi18n_english_translation/$', 'django.views.i18n.javascript_catalog', js_info_dict_english_translation),\n     (r'^jsi18n_multi_packages1/$', 'django.views.i18n.javascript_catalog', js_info_dict_multi_packages1),\n     (r'^jsi18n_multi_packages2/$', 'django.views.i18n.javascript_catalog', js_info_dict_multi_packages2),\n+    (r'^jsi18n_admin/$', 'django.views.i18n.javascript_catalog', js_info_dict_admin),\n+    (r'^jsi18n_template/$', views.jsi18n),\n \n     # Static views\n     (r'^site_media/(?P<path>.*)$', 'django.views.static.serve', {'document_root': media_dir}),"
        },
        {
            "sha": "ed9d61144aad33e803ad24090a9c62d4fc9fc6e3",
            "filename": "tests/regressiontests/views/views.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a5e8087ac7676ef08e76275c1f756778b39c13e/tests%2Fregressiontests%2Fviews%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Fviews.py?ref=4a5e8087ac7676ef08e76275c1f756778b39c13e",
            "patch": "@@ -51,6 +51,9 @@ def template_exception(request, n):\n     return render_to_response('debug/template_exception.html',\n         {'arg': except_args[int(n)]})\n \n+def jsi18n(request):\n+    return render_to_response('jsi18n.html')\n+\n # Some views to exercise the shortcuts\n \n def render_to_response_view(request):"
        }
    ],
    "stats": {
        "total": 156,
        "additions": 148,
        "deletions": 8
    }
}