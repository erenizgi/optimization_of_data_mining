{
    "author": "ramiro",
    "message": "Made inspectdb tests deal with a smaller generated models.py file.\n\nImplemented this by adding a stealth table_name_filter option for the\ncommand.",
    "sha": "72130385bfe503bd440e52605c44a10a0480a25b",
    "files": [
        {
            "sha": "a524e64f65294aa614d55f87fb448bc1064c78b3",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/72130385bfe503bd440e52605c44a10a0480a25b/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/72130385bfe503bd440e52605c44a10a0480a25b/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=72130385bfe503bd440e52605c44a10a0480a25b",
            "patch": "@@ -26,6 +26,8 @@ def handle_noargs(self, **options):\n \n     def handle_inspection(self, options):\n         connection = connections[options.get('database')]\n+        # 'table_name_filter' is a stealth option\n+        table_name_filter = options.get('table_name_filter')\n \n         table2model = lambda table_name: table_name.title().replace('_', '').replace(' ', '').replace('-', '')\n \n@@ -43,6 +45,9 @@ def handle_inspection(self, options):\n         yield ''\n         known_models = []\n         for table_name in connection.introspection.table_names(cursor):\n+            if table_name_filter is not None and callable(table_name_filter):\n+                if not table_name_filter(table_name):\n+                    continue\n             yield 'class %s(models.Model):' % table2model(table_name)\n             known_models.append(table2model(table_name))\n             try:"
        },
        {
            "sha": "8d1222c545d8f48c52a5fdc8f484b30e7fe83df6",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 27,
            "deletions": 2,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/72130385bfe503bd440e52605c44a10a0480a25b/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/72130385bfe503bd440e52605c44a10a0480a25b/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=72130385bfe503bd440e52605c44a10a0480a25b",
            "patch": "@@ -6,10 +6,31 @@\n \n class InspectDBTestCase(TestCase):\n \n+    def test_stealth_table_name_filter_option(self):\n+        out = StringIO()\n+        # Lets limit the introspection to tables created for models of this\n+        # application\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_'),\n+                     stdout=out)\n+        error_message = \"inspectdb has examined a table that should have been filtered out.\"\n+        # contrib.contenttypes is one of the apps always installed when running\n+        # the Django test suite, check that one of its tables hasn't been\n+        # inspected\n+        self.assertNotIn(\"class DjangoContentType(models.Model):\", out.getvalue(), msg=error_message)\n+        out.close()\n+\n     @skipUnlessDBFeature('can_introspect_foreign_keys')\n     def test_attribute_name_not_python_keyword(self):\n         out = StringIO()\n-        call_command('inspectdb', stdout=out)\n+        # Lets limit the introspection to tables created for models of this\n+        # application\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_'),\n+                     stdout=out)\n+        f = open('/home/ramiro/models2.py', 'w')\n+        f.write(out.getvalue())\n+        f.close()\n         error_message = \"inspectdb generated an attribute name which is a python keyword\"\n         self.assertNotIn(\"from = models.ForeignKey(InspectdbPeople)\", out.getvalue(), msg=error_message)\n         # As InspectdbPeople model is defined after InspectdbMessage, it should be quoted\n@@ -23,7 +44,11 @@ def test_attribute_name_not_python_keyword(self):\n     def test_digits_column_name_introspection(self):\n         \"\"\"Introspection of column names consist/start with digits (#16536/#17676)\"\"\"\n         out = StringIO()\n-        call_command('inspectdb', stdout=out)\n+        # Lets limit the introspection to tables created for models of this\n+        # application\n+        call_command('inspectdb',\n+                     table_name_filter=lambda tn:tn.startswith('inspectdb_'),\n+                     stdout=out)\n         error_message = \"inspectdb generated a model field name which is a number\"\n         self.assertNotIn(\"    123 = models.CharField\", out.getvalue(), msg=error_message)\n         self.assertIn(\"number_123 = models.CharField\", out.getvalue())"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 32,
        "deletions": 2
    }
}