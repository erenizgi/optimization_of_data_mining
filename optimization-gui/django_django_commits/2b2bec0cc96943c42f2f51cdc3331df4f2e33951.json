{
    "author": "jezdez",
    "message": "Fixed test failure on Postgres that was added in r16510.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16512 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2b2bec0cc96943c42f2f51cdc3331df4f2e33951",
    "files": [
        {
            "sha": "278b6b69dae5e2b4a86d27a98460fefe703725fb",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 16,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/2b2bec0cc96943c42f2f51cdc3331df4f2e33951/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2b2bec0cc96943c42f2f51cdc3331df4f2e33951/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=2b2bec0cc96943c42f2f51cdc3331df4f2e33951",
            "patch": "@@ -2,6 +2,7 @@\n \n # Unit tests for cache framework\n # Uses whatever cache backend is set in the test settings file.\n+from __future__ import with_statement\n \n import hashlib\n import os\n@@ -775,23 +776,23 @@ def allow_syncdb(self, db, model):\n \n class CreateCacheTableForDBCacheTests(unittest.TestCase):\n \n-    @override_settings(DEBUG=True)\n     def test_createcachetable_observes_database_router(self):\n-        old_routers = router.routers\n-        try:\n-            router.routers = [DBCacheRouter()]\n-            # cache table should not be created on 'default'\n-            management.call_command('createcachetable', 'cache_table',\n-                                    database='default',\n-                                    verbosity=0, interactive=False)\n-            self.assertEqual(len(connections['default'].queries), 0)\n-            # cache table should be created on 'other'\n-            management.call_command('createcachetable', 'cache_table',\n-                                    database='other',\n-                                    verbosity=0, interactive=False)\n-            self.assertNotEqual(len(connections['other'].queries), 0)\n-        finally:\n-            router.routers = old_routers\n+        with override_settings(DEBUG=True):\n+            old_routers = router.routers\n+            try:\n+                router.routers = [DBCacheRouter()]\n+                # cache table should not be created on 'default'\n+                management.call_command('createcachetable', 'cache_table',\n+                                        database='default',\n+                                        verbosity=0, interactive=False)\n+                self.assertEqual(len(connections['default'].queries), 0)\n+                # cache table should be created on 'other'\n+                management.call_command('createcachetable', 'cache_table',\n+                                        database='other',\n+                                        verbosity=0, interactive=False)\n+                self.assertNotEqual(len(connections['other'].queries), 0)\n+            finally:\n+                router.routers = old_routers\n \n class LocMemCacheTests(unittest.TestCase, BaseCacheTests):\n     backend_name = 'django.core.cache.backends.locmem.LocMemCache'"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 17,
        "deletions": 16
    }
}