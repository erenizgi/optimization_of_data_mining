{
    "author": "andrewgodwin",
    "message": "Merge branch 'master' of github.com:django/django into schema-alteration\n\nConflicts:\n\tdjango/db/backends/postgresql_psycopg2/base.py",
    "sha": "4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
    "files": [
        {
            "sha": "6ca8b297f427f31b823df25302e72464ba22a6c0",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -30,6 +30,7 @@ The PRIMARY AUTHORS are (and/or have been):\n     * Aymeric Augustin\n     * Claude Paroz\n     * Anssi Kääriäinen\n+    * Florian Apolloner\n \n More information on the main contributors to Django can be found in\n docs/internals/committers.txt.\n@@ -61,7 +62,6 @@ answer newbie questions, and generally made Django that much better:\n     andy@jadedplanet.net\n     Fabrice Aneche <akh@nobugware.com>\n     ant9000@netwise.it\n-    Florian Apolloner <florian@apolloner.eu>\n     arien <regexbot@gmail.com>\n     David Ascher <http://ascher.ca/>\n     atlithorn <atlithorn@gmail.com>"
        },
        {
            "sha": "77454b3fb915ffa815f7d3803c804d90aeda4ae7",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -15,6 +15,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.functional import LazyObject, empty\n from django.utils import importlib\n+from django.utils import six\n \n ENVIRONMENT_VARIABLE = \"DJANGO_SETTINGS_MODULE\"\n \n@@ -73,7 +74,7 @@ def __setattr__(self, name, value):\n         elif name == \"ADMIN_MEDIA_PREFIX\":\n             warnings.warn(\"The ADMIN_MEDIA_PREFIX setting has been removed; \"\n                           \"use STATIC_URL instead.\", DeprecationWarning)\n-        elif name == \"ALLOWED_INCLUDE_ROOTS\" and isinstance(value, basestring):\n+        elif name == \"ALLOWED_INCLUDE_ROOTS\" and isinstance(value, six.string_types):\n             raise ValueError(\"The ALLOWED_INCLUDE_ROOTS setting must be set \"\n                 \"to a tuple, not a string.\")\n         object.__setattr__(self, name, value)\n@@ -102,7 +103,10 @@ def __init__(self, settings_module):\n             if setting == setting.upper():\n                 setting_value = getattr(mod, setting)\n                 if setting in tuple_settings and \\\n-                        isinstance(setting_value, basestring):\n+                        isinstance(setting_value, six.string_types):\n+                    warnings.warn(\"The %s setting must be a tuple. Please fix your \"\n+                                  \"settings, as auto-correction is now deprecated.\" % setting,\n+                        PendingDeprecationWarning)\n                     setting_value = (setting_value,) # In case the user forgot the comma.\n                 setattr(self, setting, setting_value)\n "
        },
        {
            "sha": "04fb1dff59023c2212c56c8b4c54f71e8490ee77",
            "filename": "django/conf/urls/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fconf%2Furls%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fconf%2Furls%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Furls%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n     RegexURLResolver, LocaleRegexURLResolver)\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n+from django.utils import six\n \n \n __all__ = ['handler403', 'handler404', 'handler500', 'include', 'patterns', 'url']\n@@ -20,7 +21,7 @@ def include(arg, namespace=None, app_name=None):\n         # No namespace hint - use manually provided namespace\n         urlconf_module = arg\n \n-    if isinstance(urlconf_module, basestring):\n+    if isinstance(urlconf_module, six.string_types):\n         urlconf_module = import_module(urlconf_module)\n     patterns = getattr(urlconf_module, 'urlpatterns', urlconf_module)\n \n@@ -52,7 +53,7 @@ def url(regex, view, kwargs=None, name=None, prefix=''):\n         urlconf_module, app_name, namespace = view\n         return RegexURLResolver(regex, urlconf_module, kwargs, app_name=app_name, namespace=namespace)\n     else:\n-        if isinstance(view, basestring):\n+        if isinstance(view, six.string_types):\n             if not view:\n                 raise ImproperlyConfigured('Empty URL pattern view name not permitted (for pattern %r)' % regex)\n             if prefix:"
        },
        {
            "sha": "1bc843cdf9b2c300cc74538553416cb3e010d433",
            "filename": "django/contrib/admin/helpers.py",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fhelpers.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,8 +10,9 @@\n from django.forms.util import flatatt\n from django.template.defaultfilters import capfirst\n from django.utils.encoding import force_unicode, smart_unicode\n-from django.utils.html import escape, conditional_escape\n+from django.utils.html import conditional_escape, format_html\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n from django.conf import settings\n \n@@ -49,7 +50,7 @@ def first_field(self):\n         try:\n             fieldset_name, fieldset_options = self.fieldsets[0]\n             field_name = fieldset_options['fields'][0]\n-            if not isinstance(field_name, basestring):\n+            if not isinstance(field_name, six.string_types):\n                 field_name = field_name[0]\n             return self.form[field_name]\n         except (KeyError, IndexError):\n@@ -163,11 +164,9 @@ def label_tag(self):\n         if not self.is_first:\n             attrs[\"class\"] = \"inline\"\n         label = self.field['label']\n-        contents = capfirst(force_unicode(escape(label))) + \":\"\n-        return mark_safe('<label%(attrs)s>%(contents)s</label>' % {\n-            \"attrs\": flatatt(attrs),\n-            \"contents\": contents,\n-        })\n+        return format_html('<label{0}>{1}:</label>',\n+                           flatatt(attrs),\n+                           capfirst(force_unicode(label)))\n \n     def contents(self):\n         from django.contrib.admin.templatetags.admin_list import _boolean_icon\n@@ -190,7 +189,7 @@ def contents(self):\n                 if value is None:\n                     result_repr = EMPTY_CHANGELIST_VALUE\n                 elif isinstance(f.rel, ManyToManyRel):\n-                    result_repr = \", \".join(map(unicode, value.all()))\n+                    result_repr = \", \".join(map(six.text_type, value.all()))\n                 else:\n                     result_repr = display_for_field(value, f)\n         return conditional_escape(result_repr)"
        },
        {
            "sha": "58bbbabfdf447bbaaf58cfbe3829dd74524fb5b7",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,7 +6,6 @@\n from django.contrib.admin.util import quote\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_unicode\n-from django.utils.safestring import mark_safe\n \n ADDITION = 1\n CHANGE = 2\n@@ -66,5 +65,5 @@ def get_admin_url(self):\n         This is relative to the Django admin index page.\n         \"\"\"\n         if self.content_type and self.object_id:\n-            return mark_safe(\"%s/%s/%s/\" % (self.content_type.app_label, self.content_type.model, quote(self.object_id)))\n+            return \"%s/%s/%s/\" % (self.content_type.app_label, self.content_type.model, quote(self.object_id))\n         return None"
        },
        {
            "sha": "c13a6bc5cc8f3a255adbe8a7030e728c338b0be8",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -24,6 +24,7 @@\n from django.utils.datastructures import SortedDict\n from django.utils.html import escape, escapejs\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.text import capfirst, get_text_list\n from django.utils.translation import ugettext as _\n from django.utils.translation import ungettext\n@@ -57,9 +58,8 @@ class IncorrectLookupParameters(Exception):\n \n csrf_protect_m = method_decorator(csrf_protect)\n \n-class BaseModelAdmin(object):\n+class BaseModelAdmin(six.with_metaclass(forms.MediaDefiningClass)):\n     \"\"\"Functionality common to both ModelAdmin and InlineAdmin.\"\"\"\n-    __metaclass__ = forms.MediaDefiningClass\n \n     raw_id_fields = ()\n     fields = None\n@@ -745,7 +745,7 @@ def render_change_form(self, request, context, add=False, change=False, form_url\n             'has_file_field': True, # FIXME - this should check if form or formsets have a FileField,\n             'has_absolute_url': hasattr(self.model, 'get_absolute_url'),\n             'ordered_objects': ordered_objects,\n-            'form_url': mark_safe(form_url),\n+            'form_url': form_url,\n             'opts': opts,\n             'content_type_id': ContentType.objects.get_for_model(self.model).id,\n             'save_as': self.save_as,\n@@ -998,7 +998,6 @@ def add_view(self, request, form_url='', extra_context=None):\n             'title': _('Add %s') % force_unicode(opts.verbose_name),\n             'adminform': adminForm,\n             'is_popup': \"_popup\" in request.REQUEST,\n-            'show_delete': False,\n             'media': media,\n             'inline_admin_formsets': inline_admin_formsets,\n             'errors': helpers.AdminErrorList(form, formsets),\n@@ -1321,7 +1320,7 @@ def history_view(self, request, object_id, extra_context=None):\n         opts = model._meta\n         app_label = opts.app_label\n         action_list = LogEntry.objects.filter(\n-            object_id = object_id,\n+            object_id = unquote(object_id),\n             content_type__id__exact = ContentType.objects.get_for_model(model).id\n         ).select_related().order_by('action_time')\n         # If no history was found, see whether this object even exists."
        },
        {
            "sha": "515cc33eca6d57c202c82e81cc98a7ddf6c3ae15",
            "filename": "django/contrib/admin/sites.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fsites.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fsites.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fsites.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -231,7 +231,8 @@ def wrapper(*args, **kwargs):\n                 wrap(self.i18n_javascript, cacheable=True),\n                 name='jsi18n'),\n             url(r'^r/(?P<content_type_id>\\d+)/(?P<object_id>.+)/$',\n-                wrap(contenttype_views.shortcut)),\n+                wrap(contenttype_views.shortcut),\n+                name='view_on_site'),\n             url(r'^(?P<app_label>\\w+)/$',\n                 wrap(self.app_index),\n                 name='app_list')"
        },
        {
            "sha": "0a7012c7b23dab9a3fe80592c8e8444ef6c3840d",
            "filename": "django/contrib/admin/static/admin/css/widgets.css",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fwidgets.css?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -41,7 +41,8 @@\n     text-align: left;\n }\n \n-.selector .selector-filter label {\n+.selector .selector-filter label,\n+.inline-group .aligned .selector .selector-filter label {\n     width: 16px;\n     padding: 2px;\n }"
        },
        {
            "sha": "f367223bc5ea14c327219b3890bd13f51d7da71a",
            "filename": "django/contrib/admin/templates/admin/auth/user/change_password.html",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fauth%2Fuser%2Fchange_password.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,8 +3,7 @@\n {% load admin_urls %}\n \n {% block extrahead %}{{ block.super }}\n-{% url 'admin:jsi18n' as jsi18nurl %}\n-<script type=\"text/javascript\" src=\"{{ jsi18nurl|default:\"../../../../jsi18n/\" }}\"></script>\n+<script type=\"text/javascript\" src=\"{% url 'admin:jsi18n' %}\"></script>\n {% endblock %}\n {% block extrastyle %}{{ block.super }}<link rel=\"stylesheet\" type=\"text/css\" href=\"{% static \"admin/css/forms.css\" %}\" />{% endblock %}\n {% block bodyclass %}{{ opts.app_label }}-{{ opts.object_name.lower }} change-form{% endblock %}"
        },
        {
            "sha": "82d7296c8584585d661ea654db57f48f725b88bd",
            "filename": "django/contrib/admin/templates/admin/change_form.html",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_form.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,8 +3,7 @@\n {% load admin_urls %}\n \n {% block extrahead %}{{ block.super }}\n-{% url 'admin:jsi18n' as jsi18nurl %}\n-<script type=\"text/javascript\" src=\"{{ jsi18nurl|default:\"../../../jsi18n/\" }}\"></script>\n+<script type=\"text/javascript\" src=\"{% url 'admin:jsi18n' %}\"></script>\n {{ media }}\n {% endblock %}\n \n@@ -31,7 +30,7 @@\n   <ul class=\"object-tools\">\n     {% block object-tools-items %}\n     <li><a href=\"history/\" class=\"historylink\">{% trans \"History\" %}</a></li>\n-    {% if has_absolute_url %}<li><a href=\"../../../r/{{ content_type_id }}/{{ original.pk }}/\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n+    {% if has_absolute_url %}<li><a href=\"{% url 'admin:view_on_site' content_type_id original.pk %}\" class=\"viewsitelink\">{% trans \"View on site\" %}</a></li>{% endif%}\n     {% endblock %}\n   </ul>\n {% endif %}{% endif %}"
        },
        {
            "sha": "c72b6630a35d711456e43d446743c60457df2de9",
            "filename": "django/contrib/admin/templates/admin/change_list.html",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,8 +9,7 @@\n     <link rel=\"stylesheet\" type=\"text/css\" href=\"{% static \"admin/css/forms.css\" %}\" />\n   {% endif %}\n   {% if cl.formset or action_form %}\n-    {% url 'admin:jsi18n' as jsi18nurl %}\n-    <script type=\"text/javascript\" src=\"{{ jsi18nurl|default:'../../jsi18n/' }}\"></script>\n+    <script type=\"text/javascript\" src=\"{% url 'admin:jsi18n' %}\"></script>\n   {% endif %}\n   {{ media.css }}\n   {% if not actions_on_top and not actions_on_bottom %}"
        },
        {
            "sha": "c1a711534d6c127d1c625e2d1c1e15dcbc3ec0be",
            "filename": "django/contrib/admin/templates/admin/delete_confirmation.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fdelete_confirmation.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fdelete_confirmation.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fdelete_confirmation.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,7 +7,7 @@\n <a href=\"{% url 'admin:index' %}\">{% trans 'Home' %}</a>\n &rsaquo; <a href=\"{% url 'admin:app_list' app_label=opts.app_label %}\">{{ app_label|capfirst }}</a>\n &rsaquo; <a href=\"{% url opts|admin_urlname:'changelist' %}\">{{ opts.verbose_name_plural|capfirst|escape }}</a>\n-&rsaquo; <a href=\"{% url opts|admin_urlname:'changelist' %}{{ object.pk }}\">{{ object|truncatewords:\"18\" }}</a>\n+&rsaquo; <a href=\"{% url opts|admin_urlname:'change' object.pk|admin_urlquote %}\">{{ object|truncatewords:\"18\" }}</a>\n &rsaquo; {% trans 'Delete' %}\n </div>\n {% endblock %}"
        },
        {
            "sha": "d57d3dad491d1c58a1199b46bcf2b3e1192e185f",
            "filename": "django/contrib/admin/templates/admin/edit_inline/stacked.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Fstacked.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,7 +6,7 @@ <h2>{{ inline_admin_formset.opts.verbose_name_plural|title }}</h2>\n \n {% for inline_admin_form in inline_admin_formset %}<div class=\"inline-related{% if forloop.last %} empty-form last-related{% endif %}\" id=\"{{ inline_admin_formset.formset.prefix }}-{% if not forloop.last %}{{ forloop.counter0 }}{% else %}empty{% endif %}\">\n   <h3><b>{{ inline_admin_formset.opts.verbose_name|title }}:</b>&nbsp;<span class=\"inline_label\">{% if inline_admin_form.original %}{{ inline_admin_form.original }}{% else %}#{{ forloop.counter }}{% endif %}</span>\n-    {% if inline_admin_form.show_url %}<a href=\"../../../r/{{ inline_admin_form.original_content_type_id }}/{{ inline_admin_form.original.pk }}/\">{% trans \"View on site\" %}</a>{% endif %}\n+    {% if inline_admin_form.show_url %}<a href=\"{% url 'admin:view_on_site' inline_admin_form.original_content_type_id inline_admin_form.original.pk %}\">{% trans \"View on site\" %}</a>{% endif %}\n     {% if inline_admin_formset.formset.can_delete and inline_admin_form.original %}<span class=\"delete\">{{ inline_admin_form.deletion_field.field }} {{ inline_admin_form.deletion_field.label_tag }}</span>{% endif %}\n   </h3>\n   {% if inline_admin_form.form.non_field_errors %}{{ inline_admin_form.form.non_field_errors }}{% endif %}"
        },
        {
            "sha": "4f4915381999d5031458ae6c270089281910f8a9",
            "filename": "django/contrib/admin/templates/admin/edit_inline/tabular.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fedit_inline%2Ftabular.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -27,7 +27,7 @@ <h2>{{ inline_admin_formset.opts.verbose_name_plural|capfirst }}</h2>\n         <td class=\"original\">\n           {% if inline_admin_form.original or inline_admin_form.show_url %}<p>\n           {% if inline_admin_form.original %} {{ inline_admin_form.original }}{% endif %}\n-          {% if inline_admin_form.show_url %}<a href=\"../../../r/{{ inline_admin_form.original_content_type_id }}/{{ inline_admin_form.original.pk }}/\">{% trans \"View on site\" %}</a>{% endif %}\n+          {% if inline_admin_form.show_url %}<a href=\"{% url 'admin:view_on_site' inline_admin_form.original_content_type_id inline_admin_form.original.pk %}\">{% trans \"View on site\" %}</a>{% endif %}\n             </p>{% endif %}\n           {% if inline_admin_form.has_auto_field %}{{ inline_admin_form.pk_field.field }}{% endif %}\n           {{ inline_admin_form.fk_field.field }}"
        },
        {
            "sha": "55dd4a3b4c8f739d32dfedfc2304dc91735e118f",
            "filename": "django/contrib/admin/templates/admin/object_history.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fobject_history.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fobject_history.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fobject_history.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,7 +7,7 @@\n <a href=\"{% url 'admin:index' %}\">{% trans 'Home' %}</a>\n &rsaquo; <a href=\"{% url 'admin:app_list' app_label=app_label %}\">{{ app_label|capfirst|escape }}</a>\n &rsaquo; <a href=\"{% url opts|admin_urlname:'changelist' %}\">{{ module_name }}</a>\n-&rsaquo; <a href=\"{% url opts|admin_urlname:'change' object.pk %}\">{{ object|truncatewords:\"18\" }}</a>\n+&rsaquo; <a href=\"{% url opts|admin_urlname:'change' object.pk|admin_urlquote %}\">{{ object|truncatewords:\"18\" }}</a>\n &rsaquo; {% trans 'History' %}\n </div>\n {% endblock %}"
        },
        {
            "sha": "0f15781fa942da438a9321d65fe800f98270ef4a",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 24,
            "deletions": 18,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.exceptions import ObjectDoesNotExist\n from django.db import models\n from django.utils import formats\n-from django.utils.html import escape, conditional_escape\n+from django.utils.html import format_html\n from django.utils.safestring import mark_safe\n from django.utils.text import capfirst\n from django.utils.translation import ugettext as _\n@@ -31,9 +31,12 @@ def paginator_number(cl,i):\n     if i == DOT:\n         return '... '\n     elif i == cl.page_num:\n-        return mark_safe('<span class=\"this-page\">%d</span> ' % (i+1))\n+        return format_html('<span class=\"this-page\">{0}</span> ', i+1)\n     else:\n-        return mark_safe('<a href=\"%s\"%s>%d</a> ' % (escape(cl.get_query_string({PAGE_VAR: i})), (i == cl.paginator.num_pages-1 and ' class=\"end\"' or ''), i+1))\n+        return format_html('<a href=\"{0}\"{1}>{2}</a> ',\n+                           cl.get_query_string({PAGE_VAR: i}),\n+                           mark_safe(' class=\"end\"' if i == cl.paginator.num_pages-1 else ''),\n+                           i+1)\n \n @register.inclusion_tag('admin/pagination.html')\n def pagination(cl):\n@@ -159,13 +162,14 @@ def result_headers(cl):\n             \"url_primary\": cl.get_query_string({ORDER_VAR: '.'.join(o_list_primary)}),\n             \"url_remove\": cl.get_query_string({ORDER_VAR: '.'.join(o_list_remove)}),\n             \"url_toggle\": cl.get_query_string({ORDER_VAR: '.'.join(o_list_toggle)}),\n-            \"class_attrib\": mark_safe(th_classes and ' class=\"%s\"' % ' '.join(th_classes) or '')\n+            \"class_attrib\": format_html(' class=\"{0}\"', ' '.join(th_classes))\n+                            if th_classes else '',\n         }\n \n def _boolean_icon(field_val):\n     icon_url = static('admin/img/icon-%s.gif' %\n                       {True: 'yes', False: 'no', None: 'unknown'}[field_val])\n-    return mark_safe('<img src=\"%s\" alt=\"%s\" />' % (icon_url, field_val))\n+    return format_html('<img src=\"{0}\" alt=\"{1}\" />', icon_url, field_val)\n \n def items_for_result(cl, result, form):\n     \"\"\"\n@@ -182,31 +186,29 @@ def items_for_result(cl, result, form):\n         else:\n             if f is None:\n                 if field_name == 'action_checkbox':\n-                    row_class = ' class=\"action-checkbox\"'\n+                    row_class = mark_safe(' class=\"action-checkbox\"')\n                 allow_tags = getattr(attr, 'allow_tags', False)\n                 boolean = getattr(attr, 'boolean', False)\n                 if boolean:\n                     allow_tags = True\n                 result_repr = display_for_value(value, boolean)\n                 # Strip HTML tags in the resulting text, except if the\n                 # function has an \"allow_tags\" attribute set to True.\n-                if not allow_tags:\n-                    result_repr = escape(result_repr)\n-                else:\n+                if allow_tags:\n                     result_repr = mark_safe(result_repr)\n                 if isinstance(value, (datetime.date, datetime.time)):\n-                    row_class = ' class=\"nowrap\"'\n+                    row_class = mark_safe(' class=\"nowrap\"')\n             else:\n                 if isinstance(f.rel, models.ManyToOneRel):\n                     field_val = getattr(result, f.name)\n                     if field_val is None:\n                         result_repr = EMPTY_CHANGELIST_VALUE\n                     else:\n-                        result_repr = escape(field_val)\n+                        result_repr = field_val\n                 else:\n                     result_repr = display_for_field(value, f)\n                 if isinstance(f, (models.DateField, models.TimeField, models.ForeignKey)):\n-                    row_class = ' class=\"nowrap\"'\n+                    row_class = mark_safe(' class=\"nowrap\"')\n         if force_unicode(result_repr) == '':\n             result_repr = mark_safe('&nbsp;')\n         # If list_display_links not defined, add the link tag to the first field\n@@ -222,8 +224,14 @@ def items_for_result(cl, result, form):\n                 attr = pk\n             value = result.serializable_value(attr)\n             result_id = repr(force_unicode(value))[1:]\n-            yield mark_safe('<%s%s><a href=\"%s\"%s>%s</a></%s>' % \\\n-                (table_tag, row_class, url, (cl.is_popup and ' onclick=\"opener.dismissRelatedLookupPopup(window, %s); return false;\"' % result_id or ''), conditional_escape(result_repr), table_tag))\n+            yield format_html('<{0}{1}><a href=\"{2}\"{3}>{4}</a></{5}>',\n+                              table_tag,\n+                              row_class,\n+                              url,\n+                              format_html(' onclick=\"opener.dismissRelatedLookupPopup(window, {0}); return false;\"', result_id)\n+                                if cl.is_popup else '',\n+                              result_repr,\n+                              table_tag)\n         else:\n             # By default the fields come from ModelAdmin.list_editable, but if we pull\n             # the fields out of the form instead of list_editable custom admins\n@@ -233,11 +241,9 @@ def items_for_result(cl, result, form):\n                         form[cl.model._meta.pk.name].is_hidden)):\n                 bf = form[field_name]\n                 result_repr = mark_safe(force_unicode(bf.errors) + force_unicode(bf))\n-            else:\n-                result_repr = conditional_escape(result_repr)\n-            yield mark_safe('<td%s>%s</td>' % (row_class, result_repr))\n+            yield format_html('<td{0}>{1}</td>', row_class, result_repr)\n     if form and not form[cl.model._meta.pk.name].is_hidden:\n-        yield mark_safe('<td>%s</td>' % force_unicode(form[cl.model._meta.pk.name]))\n+        yield format_html('<td>{0}</td>', force_unicode(form[cl.model._meta.pk.name]))\n \n class ResultList(list):\n     # Wrapper class used to return items in a list_editable"
        },
        {
            "sha": "c190533f9569bd062d85e690347a37b938550069",
            "filename": "django/contrib/admin/templatetags/admin_modify.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_modify.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -32,7 +32,7 @@ def submit_row(context):\n         'onclick_attrib': (opts.get_ordered_objects() and change\n                             and 'onclick=\"submitOrderForm();\"' or ''),\n         'show_delete_link': (not is_popup and context['has_delete_permission']\n-                              and (change or context['show_delete'])),\n+                              and change and context.get('show_delete', True)),\n         'show_save_as_new': not is_popup and change and save_as,\n         'show_save_and_add_another': context['has_add_permission'] and\n                             not is_popup and (not save_as or context['add']),"
        },
        {
            "sha": "90e81b0ef3ddc90f8eb34d2f16a847f54e9c814a",
            "filename": "django/contrib/admin/templatetags/admin_urls.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_urls.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_urls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_urls.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,8 +1,14 @@\n-from django.core.urlresolvers import reverse, NoReverseMatch\n+from django.core.urlresolvers import reverse\n from django import template\n+from django.contrib.admin.util import quote\n \n register = template.Library()\n \n @register.filter\n def admin_urlname(value, arg):\n     return 'admin:%s_%s_%s' % (value.app_label, value.module_name, arg)\n+\n+\n+@register.filter\n+def admin_urlquote(value):\n+    return quote(value)"
        },
        {
            "sha": "16bdfe056613681c2f7ee965b272208db5f6ff5c",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,11 +9,11 @@\n from django.db.models.related import RelatedObject\n from django.forms.forms import pretty_name\n from django.utils import formats\n-from django.utils.html import escape\n-from django.utils.safestring import mark_safe\n+from django.utils.html import format_html\n from django.utils.text import capfirst\n from django.utils import timezone\n from django.utils.encoding import force_unicode, smart_unicode, smart_str\n+from django.utils import six\n from django.utils.translation import ungettext\n from django.core.urlresolvers import reverse\n \n@@ -52,7 +52,7 @@ def quote(s):\n     quoting is slightly different so that it doesn't get automatically\n     unquoted by the Web browser.\n     \"\"\"\n-    if not isinstance(s, basestring):\n+    if not isinstance(s, six.string_types):\n         return s\n     res = list(s)\n     for i in range(len(res)):\n@@ -124,10 +124,10 @@ def format_callback(obj):\n             if not user.has_perm(p):\n                 perms_needed.add(opts.verbose_name)\n             # Display a link to the admin page.\n-            return mark_safe('%s: <a href=\"%s\">%s</a>' %\n-                             (escape(capfirst(opts.verbose_name)),\n-                              admin_url,\n-                              escape(obj)))\n+            return format_html('{0}: <a href=\"{1}\">{2}</a>',\n+                               capfirst(opts.verbose_name),\n+                               admin_url,\n+                               obj)\n         else:\n             # Don't display link to edit, because it either has no\n             # admin or is edited inline.\n@@ -275,10 +275,10 @@ def label_for_field(name, model, model_admin=None, return_attr=False):\n     except models.FieldDoesNotExist:\n         if name == \"__unicode__\":\n             label = force_unicode(model._meta.verbose_name)\n-            attr = unicode\n+            attr = six.text_type\n         elif name == \"__str__\":\n             label = smart_str(model._meta.verbose_name)\n-            attr = str\n+            attr = bytes\n         else:\n             if callable(name):\n                 attr = name\n@@ -350,7 +350,7 @@ def display_for_value(value, boolean=False):\n         return formats.localize(timezone.template_localtime(value))\n     elif isinstance(value, (datetime.date, datetime.time)):\n         return formats.localize(value)\n-    elif isinstance(value, (decimal.Decimal, float, int, long)):\n+    elif isinstance(value, six.integer_types + (decimal.Decimal, float)):\n         return formats.number_format(value)\n     else:\n         return smart_unicode(value)"
        },
        {
            "sha": "550ed0f7e2e6f1490b25e67bdaa2e137602e2205",
            "filename": "django/contrib/admin/widgets.py",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fwidgets.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,11 +10,12 @@\n from django.core.urlresolvers import reverse\n from django.forms.widgets import RadioFieldRenderer\n from django.forms.util import flatatt\n-from django.utils.html import escape\n+from django.utils.html import escape, format_html, format_html_join\n from django.utils.text import Truncator\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n from django.utils.encoding import force_unicode\n+from django.utils import six\n \n \n class FilteredSelectMultiple(forms.SelectMultiple):\n@@ -85,16 +86,17 @@ def __init__(self, attrs=None):\n         forms.MultiWidget.__init__(self, widgets, attrs)\n \n     def format_output(self, rendered_widgets):\n-        return mark_safe('<p class=\"datetime\">%s %s<br />%s %s</p>' % \\\n-            (_('Date:'), rendered_widgets[0], _('Time:'), rendered_widgets[1]))\n+        return format_html('<p class=\"datetime\">{0} {1}<br />{2} {3}</p>',\n+                           _('Date:'), rendered_widgets[0],\n+                           _('Time:'), rendered_widgets[1])\n \n class AdminRadioFieldRenderer(RadioFieldRenderer):\n     def render(self):\n         \"\"\"Outputs a <ul> for this set of radio fields.\"\"\"\n-        return mark_safe('<ul%s>\\n%s\\n</ul>' % (\n-            flatatt(self.attrs),\n-            '\\n'.join(['<li>%s</li>' % force_unicode(w) for w in self]))\n-        )\n+        return format_html('<ul{0}>\\n{1}\\n</ul>',\n+                           flatatt(self.attrs),\n+                           format_html_join('\\n', '<li>{0}</li>',\n+                                            ((force_unicode(w),) for w in self)))\n \n class AdminRadioSelect(forms.RadioSelect):\n     renderer = AdminRadioFieldRenderer\n@@ -120,7 +122,7 @@ def url_params_from_lookup_dict(lookups):\n                 # See django.db.fields.BooleanField.get_prep_lookup\n                 v = ('0', '1')[v]\n             else:\n-                v = unicode(v)\n+                v = six.text_type(v)\n             items.append((k, v))\n         params.update(dict(items))\n     return params"
        },
        {
            "sha": "819beea32667a21c988a53d34acb00c637c0ae2b",
            "filename": "django/contrib/admindocs/templates/admin_doc/bookmarklets.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmindocs%2Ftemplates%2Fadmin_doc%2Fbookmarklets.html",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmindocs%2Ftemplates%2Fadmin_doc%2Fbookmarklets.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Ftemplates%2Fadmin_doc%2Fbookmarklets.html?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -22,7 +22,7 @@\n {% endblocktrans %}\n \n <div id=\"content-main\">\n-    <h3><a href=\"javascript:(function(){if(typeof ActiveXObject!='undefined'){x=new ActiveXObject('Microsoft.XMLHTTP')}else if(typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest()}else{return;}x.open('HEAD',location.href,false);x.send(null);try{view=x.getResponseHeader('x-view');}catch(e){alert('No view found for this page');return;}if(view=='undefined'){alert('No view found for this page');}document.location='{{ admin_url }}doc/views/'+view+'/';})()\">{% trans \"Documentation for this page\" %}</a></h3>\n+    <h3><a href=\"javascript:(function(){if(typeof ActiveXObject!='undefined'){x=new ActiveXObject('Microsoft.XMLHTTP')}else if(typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest()}else{return;}x.open('HEAD',location.href,false);x.send(null);try{view=x.getResponseHeader('x-view');}catch(e){alert('No view found for this page');return;}if(view=='undefined'){alert('No view found for this page');}document.location='{{ admin_url|escapejs }}doc/views/'+view+'/';})()\">{% trans \"Documentation for this page\" %}</a></h3>\n     <p>{% trans \"Jumps you from any page to the documentation for the view that generates that page.\" %}</p>\n \n     <h3><a href=\"javascript:(function(){if(typeof ActiveXObject!='undefined'){x=new ActiveXObject('Microsoft.XMLHTTP')}else if(typeof XMLHttpRequest!='undefined'){x=new XMLHttpRequest()}else{return;}x.open('GET',location.href,false);x.send(null);try{type=x.getResponseHeader('x-object-type');id=x.getResponseHeader('x-object-id');}catch(e){type='(none)';id='(none)';}d=document;b=d.body;e=d.createElement('div');e.id='xxxhhh';s=e.style;s.position='absolute';s.left='10px';s.top='10px';s.font='10px monospace';s.border='1px black solid';s.padding='4px';s.backgroundColor='#eee';e.appendChild(d.createTextNode('Type: '+type));e.appendChild(d.createElement('br'));e.appendChild(d.createTextNode('ID: '+id));e.appendChild(d.createElement('br'));l=d.createElement('a');l.href='#';l.onclick=function(){b.removeChild(e);};l.appendChild(d.createTextNode('[close]'));l.style.textDecoration='none';e.appendChild(l);b.appendChild(e);})();\">{% trans \"Show object ID\" %}</a></h3>"
        },
        {
            "sha": "5649398cc8f32d233a1361dc0b2e576453f12ac5",
            "filename": "django/contrib/admindocs/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -37,7 +37,7 @@ def bookmarklets(request):\n     admin_root = urlresolvers.reverse('admin:index')\n     return render_to_response('admin_doc/bookmarklets.html', {\n         'root_path': admin_root,\n-        'admin_url': mark_safe(\"%s://%s%s\" % (request.is_secure() and 'https' or 'http', request.get_host(), admin_root)),\n+        'admin_url': \"%s://%s%s\" % (request.is_secure() and 'https' or 'http', request.get_host(), admin_root),\n     }, context_instance=RequestContext(request))\n \n @staff_member_required"
        },
        {
            "sha": "ad61904041faa275986df49aa87c3679f01964ae",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -134,7 +134,7 @@ def user_change_password(self, request, id, form_url=''):\n         context = {\n             'title': _('Change password: %s') % escape(user.username),\n             'adminForm': adminForm,\n-            'form_url': mark_safe(form_url),\n+            'form_url': form_url,\n             'form': form,\n             'is_popup': '_popup' in request.REQUEST,\n             'add': True,"
        },
        {
            "sha": "7a608d0777637330c03a19b9f7c17577df025359",
            "filename": "django/contrib/auth/decorators.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fdecorators.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,4 +1,7 @@\n-import urlparse\n+try:\n+    from urllib.parse import urlparse\n+except ImportError:     # Python 2\n+    from urlparse import urlparse\n from functools import wraps\n from django.conf import settings\n from django.contrib.auth import REDIRECT_FIELD_NAME\n@@ -21,9 +24,8 @@ def _wrapped_view(request, *args, **kwargs):\n             path = request.build_absolute_uri()\n             # If the login url is the same scheme and net location then just\n             # use the path as the \"next\" url.\n-            login_scheme, login_netloc = urlparse.urlparse(login_url or\n-                                                        settings.LOGIN_URL)[:2]\n-            current_scheme, current_netloc = urlparse.urlparse(path)[:2]\n+            login_scheme, login_netloc = urlparse(login_url or settings.LOGIN_URL)[:2]\n+            current_scheme, current_netloc = urlparse(path)[:2]\n             if ((not login_scheme or login_scheme == current_scheme) and\n                 (not login_netloc or login_netloc == current_netloc)):\n                 path = request.get_full_path()"
        },
        {
            "sha": "d17c41132ed05c81874617065f3f0197f67a093a",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 17,
            "deletions": 7,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,10 @@\n+from __future__ import unicode_literals\n+\n from django import forms\n from django.forms.util import flatatt\n from django.template import loader\n+from django.utils.datastructures import SortedDict\n+from django.utils.html import format_html, format_html_join\n from django.utils.http import int_to_base36\n from django.utils.safestring import mark_safe\n from django.utils.translation import ugettext, ugettext_lazy as _\n@@ -11,6 +15,7 @@\n from django.contrib.auth.tokens import default_token_generator\n from django.contrib.sites.models import get_current_site\n \n+\n UNMASKED_DIGITS_TO_SHOW = 6\n \n mask_password = lambda p: \"%s%s\" % (p[:UNMASKED_DIGITS_TO_SHOW], \"*\" * max(len(p) - UNMASKED_DIGITS_TO_SHOW, 0))\n@@ -28,13 +33,15 @@ def render(self, name, value, attrs):\n         try:\n             hasher = identify_hasher(encoded)\n         except ValueError:\n-            summary = \"<strong>Invalid password format or unknown hashing algorithm.</strong>\"\n+            summary = mark_safe(\"<strong>Invalid password format or unknown hashing algorithm.</strong>\")\n         else:\n-            summary = \"\"\n-            for key, value in hasher.safe_summary(encoded).iteritems():\n-                summary += \"<strong>%(key)s</strong>: %(value)s \" % {\"key\": ugettext(key), \"value\": value}\n+            summary = format_html_join('',\n+                                       \"<strong>{0}</strong>: {1} \",\n+                                       ((ugettext(key), value)\n+                                        for key, value in hasher.safe_summary(encoded).items())\n+                                       )\n \n-        return mark_safe(\"<div%(attrs)s>%(summary)s</div>\" % {\"attrs\": flatatt(final_attrs), \"summary\": summary})\n+        return format_html(\"<div{0}>{1}</div>\", flatatt(final_attrs), summary)\n \n \n class ReadOnlyPasswordHashField(forms.Field):\n@@ -288,8 +295,11 @@ def clean_old_password(self):\n             raise forms.ValidationError(\n                 self.error_messages['password_incorrect'])\n         return old_password\n-PasswordChangeForm.base_fields.keyOrder = ['old_password', 'new_password1',\n-                                           'new_password2']\n+\n+PasswordChangeForm.base_fields = SortedDict([\n+    (k, PasswordChangeForm.base_fields[k])\n+    for k in ['old_password', 'new_password1', 'new_password2']\n+])\n \n \n class AdminPasswordChangeForm(forms.Form):"
        },
        {
            "sha": "1099aa195ba311e05b9017e5c09f9df2c7d356a4",
            "filename": "django/contrib/auth/models.py",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmodels.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,13 +1,12 @@\n from __future__ import unicode_literals\n \n-import urllib\n-\n from django.core.exceptions import ImproperlyConfigured\n from django.core.mail import send_mail\n from django.db import models\n from django.db.models.manager import EmptyManager\n from django.utils.crypto import get_random_string\n-from django.utils.encoding import smart_str\n+from django.utils.http import urlquote\n+from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n \n@@ -79,9 +78,9 @@ class Meta:\n \n     def __unicode__(self):\n         return \"%s | %s | %s\" % (\n-            unicode(self.content_type.app_label),\n-            unicode(self.content_type),\n-            unicode(self.name))\n+            six.text_type(self.content_type.app_label),\n+            six.text_type(self.content_type),\n+            six.text_type(self.name))\n \n     def natural_key(self):\n         return (self.codename,) + self.content_type.natural_key()\n@@ -267,7 +266,7 @@ def natural_key(self):\n         return (self.username,)\n \n     def get_absolute_url(self):\n-        return \"/users/%s/\" % urllib.quote(smart_str(self.username))\n+        return \"/users/%s/\" % urlquote(self.username)\n \n     def is_anonymous(self):\n         \"\"\"\n@@ -300,7 +299,7 @@ def check_password(self, raw_password):\n         \"\"\"\n         def setter(raw_password):\n             self.set_password(raw_password)\n-            self.save()\n+            self.save(update_fields=[\"password\"])\n         return check_password(raw_password, self.password, setter)\n \n     def set_unusable_password(self):\n@@ -421,7 +420,7 @@ def __unicode__(self):\n         return 'AnonymousUser'\n \n     def __str__(self):\n-        return unicode(self).encode('utf-8')\n+        return six.text_type(self).encode('utf-8')\n \n     def __eq__(self, other):\n         return isinstance(other, self.__class__)"
        },
        {
            "sha": "21acb2004f6bc45f93d59f3c9972e9e3916ad0e6",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,8 +1,8 @@\n-from django.test import TestCase\n-from django.utils.unittest import skipUnless\n from django.contrib.auth.models import User, AnonymousUser\n from django.core.management import call_command\n-from StringIO import StringIO\n+from django.test import TestCase\n+from django.utils.six import StringIO\n+from django.utils.unittest import skipUnless\n \n try:\n     import crypt as crypt_module"
        },
        {
            "sha": "c98b7491c80ce48cc8ce82296ff7ef29e867cb19",
            "filename": "django/contrib/auth/tests/management.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmanagement.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,11 +1,10 @@\n from __future__ import unicode_literals\n \n-from StringIO import StringIO\n-\n from django.contrib.auth import models, management\n from django.contrib.auth.management.commands import changepassword\n from django.core.management.base import CommandError\n from django.test import TestCase\n+from django.utils.six import StringIO\n \n \n class GetDefaultUsernameTestCase(TestCase):"
        },
        {
            "sha": "b40157bfe2080eb0b2301254e1157fa0adf52d9b",
            "filename": "django/contrib/auth/tests/models.py",
            "status": "modified",
            "additions": 13,
            "deletions": 23,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fmodels.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,39 +5,29 @@\n     SiteProfileNotAvailable, UserManager)\n \n \n-@override_settings(USE_TZ=False)\n+@override_settings(USE_TZ=False, AUTH_PROFILE_MODULE='')\n class ProfileTestCase(TestCase):\n-    fixtures = ['authtestdata.json']\n-\n-    def setUp(self):\n-        \"\"\"Backs up the AUTH_PROFILE_MODULE\"\"\"\n-        self.old_AUTH_PROFILE_MODULE = getattr(settings,\n-                                               'AUTH_PROFILE_MODULE', None)\n-\n-    def tearDown(self):\n-        \"\"\"Restores the AUTH_PROFILE_MODULE -- if it was not set it is deleted,\n-        otherwise the old value is restored\"\"\"\n-        if self.old_AUTH_PROFILE_MODULE is None and \\\n-                hasattr(settings, 'AUTH_PROFILE_MODULE'):\n-            del settings.AUTH_PROFILE_MODULE\n-\n-        if self.old_AUTH_PROFILE_MODULE is not None:\n-            settings.AUTH_PROFILE_MODULE = self.old_AUTH_PROFILE_MODULE\n \n     def test_site_profile_not_available(self):\n+        user = User.objects.create(username='testclient')\n+\n         # calling get_profile without AUTH_PROFILE_MODULE set\n-        if hasattr(settings, 'AUTH_PROFILE_MODULE'):\n-            del settings.AUTH_PROFILE_MODULE\n-        user = User.objects.get(username='testclient')\n-        self.assertRaises(SiteProfileNotAvailable, user.get_profile)\n+        del settings.AUTH_PROFILE_MODULE\n+        with self.assertRaisesRegexp(SiteProfileNotAvailable,\n+                \"You need to set AUTH_PROFILE_MODULE in your project\"):\n+            user.get_profile()\n \n         # Bad syntax in AUTH_PROFILE_MODULE:\n         settings.AUTH_PROFILE_MODULE = 'foobar'\n-        self.assertRaises(SiteProfileNotAvailable, user.get_profile)\n+        with self.assertRaisesRegexp(SiteProfileNotAvailable,\n+                \"app_label and model_name should be separated by a dot\"):\n+            user.get_profile()\n \n         # module that doesn't exist\n         settings.AUTH_PROFILE_MODULE = 'foo.bar'\n-        self.assertRaises(SiteProfileNotAvailable, user.get_profile)\n+        with self.assertRaisesRegexp(SiteProfileNotAvailable,\n+                \"Unable to load the profile model\"):\n+            user.get_profile()\n \n \n @override_settings(USE_TZ=False)"
        },
        {
            "sha": "e76e7dd10f7d55de7b57de4f5196bd990a5e6662",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,5 @@\n import os\n import re\n-import urllib\n \n from django.conf import settings\n from django.contrib.sites.models import Site, RequestSite\n@@ -10,6 +9,7 @@\n from django.http import QueryDict\n from django.utils.encoding import force_unicode\n from django.utils.html import escape\n+from django.utils.http import urlquote\n from django.test import TestCase\n from django.test.utils import override_settings\n \n@@ -256,7 +256,7 @@ def test_security_check(self, password='password'):\n             nasty_url = '%(url)s?%(next)s=%(bad_url)s' % {\n                 'url': login_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'bad_url': urllib.quote(bad_url),\n+                'bad_url': urlquote(bad_url),\n             }\n             response = self.client.post(nasty_url, {\n                 'username': 'testclient',\n@@ -277,7 +277,7 @@ def test_security_check(self, password='password'):\n             safe_url = '%(url)s?%(next)s=%(good_url)s' % {\n                 'url': login_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'good_url': urllib.quote(good_url),\n+                'good_url': urlquote(good_url),\n             }\n             response = self.client.post(safe_url, {\n                     'username': 'testclient',\n@@ -412,7 +412,7 @@ def test_security_check(self, password='password'):\n             nasty_url = '%(url)s?%(next)s=%(bad_url)s' % {\n                 'url': logout_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'bad_url': urllib.quote(bad_url),\n+                'bad_url': urlquote(bad_url),\n             }\n             self.login()\n             response = self.client.get(nasty_url)\n@@ -432,7 +432,7 @@ def test_security_check(self, password='password'):\n             safe_url = '%(url)s?%(next)s=%(good_url)s' % {\n                 'url': logout_url,\n                 'next': REDIRECT_FIELD_NAME,\n-                'good_url': urllib.quote(good_url),\n+                'good_url': urlquote(good_url),\n             }\n             self.login()\n             response = self.client.get(safe_url)"
        },
        {
            "sha": "9b2eda83d4cfff2144b6584f9b5b4c83dd3bbaf8",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n from django.conf import settings\n from django.utils.http import int_to_base36, base36_to_int\n from django.utils.crypto import constant_time_compare, salted_hmac\n+from django.utils import six\n \n class PasswordResetTokenGenerator(object):\n     \"\"\"\n@@ -56,8 +57,8 @@ def _make_token_with_timestamp(self, user, timestamp):\n         # Ensure results are consistent across DB backends\n         login_timestamp = user.last_login.replace(microsecond=0, tzinfo=None)\n \n-        value = (unicode(user.id) + user.password +\n-                unicode(login_timestamp) + unicode(timestamp))\n+        value = (six.text_type(user.id) + user.password +\n+                six.text_type(login_timestamp) + six.text_type(timestamp))\n         hash = salted_hmac(key_salt, value).hexdigest()[::2]\n         return \"%s-%s\" % (ts_b36, hash)\n "
        },
        {
            "sha": "ccfc7a1003cb32481d4b454b3440250e765d1b9f",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,4 +1,7 @@\n-import urlparse\n+try:\n+    from urllib.parse import urlparse, urlunparse\n+except ImportError:     # Python 2\n+    from urlparse import urlparse, urlunparse\n \n from django.conf import settings\n from django.core.urlresolvers import reverse\n@@ -34,7 +37,7 @@ def login(request, template_name='registration/login.html',\n     if request.method == \"POST\":\n         form = authentication_form(data=request.POST)\n         if form.is_valid():\n-            netloc = urlparse.urlparse(redirect_to)[1]\n+            netloc = urlparse(redirect_to)[1]\n \n             # Use default setting if redirect_to is empty\n             if not redirect_to:\n@@ -80,7 +83,7 @@ def logout(request, next_page=None,\n     auth_logout(request)\n     redirect_to = request.REQUEST.get(redirect_field_name, '')\n     if redirect_to:\n-        netloc = urlparse.urlparse(redirect_to)[1]\n+        netloc = urlparse(redirect_to)[1]\n         # Security check -- don't allow redirection to a different host.\n         if not (netloc and netloc != request.get_host()):\n             return HttpResponseRedirect(redirect_to)\n@@ -116,13 +119,13 @@ def redirect_to_login(next, login_url=None,\n     if not login_url:\n         login_url = settings.LOGIN_URL\n \n-    login_url_parts = list(urlparse.urlparse(login_url))\n+    login_url_parts = list(urlparse(login_url))\n     if redirect_field_name:\n         querystring = QueryDict(login_url_parts[4], mutable=True)\n         querystring[redirect_field_name] = next\n         login_url_parts[4] = querystring.urlencode(safe='/')\n \n-    return HttpResponseRedirect(urlparse.urlunparse(login_url_parts))\n+    return HttpResponseRedirect(urlunparse(login_url_parts))\n \n # 4 views for password reset:\n # - password_reset sends the mail"
        },
        {
            "sha": "39933e75c80b972ccee72879900719583fccb1d9",
            "filename": "django/contrib/comments/views/moderation.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Fmoderation.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -17,7 +17,7 @@ def flag(request, comment_id, next=None):\n     \"\"\"\n     Flags a comment. Confirmation on GET, action on POST.\n \n-    Templates: `comments/flag.html`,\n+    Templates: :template:`comments/flag.html`,\n     Context:\n         comment\n             the flagged `comments.comment` object\n@@ -43,7 +43,7 @@ def delete(request, comment_id, next=None):\n     Deletes a comment. Confirmation on GET, action on POST. Requires the \"can\n     moderate comments\" permission.\n \n-    Templates: `comments/delete.html`,\n+    Templates: :template:`comments/delete.html`,\n     Context:\n         comment\n             the flagged `comments.comment` object\n@@ -70,7 +70,7 @@ def approve(request, comment_id, next=None):\n     Approve a comment (that is, mark it as public and non-removed). Confirmation\n     on GET, action on POST. Requires the \"can moderate comments\" permission.\n \n-    Templates: `comments/approve.html`,\n+    Templates: :template:`comments/approve.html`,\n     Context:\n         comment\n             the `comments.comment` object for approval"
        },
        {
            "sha": "abaed68560a50b70b6f6ff94b95029c0db87a8fb",
            "filename": "django/contrib/comments/views/utils.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fviews%2Futils.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,8 +2,12 @@\n A few bits of helper functions for comment views.\n \"\"\"\n \n-import urllib\n import textwrap\n+try:\n+    from urllib.parse import urlencode\n+except ImportError:     # Python 2\n+    from urllib import urlencode\n+\n from django.http import HttpResponseRedirect\n from django.core import urlresolvers\n from django.shortcuts import render_to_response\n@@ -33,7 +37,7 @@ def next_redirect(data, default, default_view, **get_kwargs):\n             anchor = ''\n \n         joiner = ('?' in next) and '&' or '?'\n-        next += joiner + urllib.urlencode(get_kwargs) + anchor\n+        next += joiner + urlencode(get_kwargs) + anchor\n     return HttpResponseRedirect(next)\n \n def confirmation_view(template, doc=\"Display a confirmation view.\"):\n@@ -56,7 +60,7 @@ def confirmed(request):\n     confirmed.__doc__ = textwrap.dedent(\"\"\"\\\n         %s\n \n-        Templates: `%s``\n+        Templates: :template:`%s``\n         Context:\n             comment\n                 The posted comment"
        },
        {
            "sha": "cfd7e6ff32c3cd9f27209127872748cf106b101c",
            "filename": "django/contrib/contenttypes/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,14 +1,13 @@\n from __future__ import unicode_literals\n \n-import urllib\n-\n from django.db import models\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.contenttypes.views import shortcut\n from django.contrib.sites.models import Site\n from django.http import HttpRequest, Http404\n from django.test import TestCase\n-from django.utils.encoding import smart_str\n+from django.utils.http import urlquote\n+from django.utils import six\n \n \n class ConcreteModel(models.Model):\n@@ -35,7 +34,7 @@ class FooWithUrl(FooWithoutUrl):\n     \"\"\"\n \n     def get_absolute_url(self):\n-        return \"/users/%s/\" % urllib.quote(smart_str(self.name))\n+        return \"/users/%s/\" % urlquote(self.name)\n \n class FooWithBrokenAbsoluteUrl(FooWithoutUrl):\n     \"\"\"\n@@ -271,4 +270,4 @@ def test_missing_model(self):\n             app_label = 'contenttypes',\n             model = 'OldModel',\n         )\n-        self.assertEqual(unicode(ct), 'Old model')\n+        self.assertEqual(six.text_type(ct), 'Old model')"
        },
        {
            "sha": "687aa87f0304e65c8a74fb6e29120446b5a6a162",
            "filename": "django/contrib/databrowse/datastructures.py",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,7 +8,6 @@\n from django.utils import formats\n from django.utils.text import capfirst\n from django.utils.encoding import smart_unicode, smart_str, iri_to_uri\n-from django.utils.safestring import mark_safe\n from django.db.models.query import QuerySet\n \n EMPTY_VALUE = '(None)'\n@@ -30,7 +29,7 @@ def model_databrowse(self):\n         return self.site.registry[self.model]\n \n     def url(self):\n-        return mark_safe('%s%s/%s/' % (self.site.root_url, self.model._meta.app_label, self.model._meta.module_name))\n+        return '%s%s/%s/' % (self.site.root_url, self.model._meta.app_label, self.model._meta.module_name)\n \n     def objects(self, **kwargs):\n         return self.get_query_set().filter(**kwargs)\n@@ -70,9 +69,9 @@ def choices(self):\n \n     def url(self):\n         if self.field.choices:\n-            return mark_safe('%s%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name))\n+            return '%s%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name)\n         elif self.field.rel:\n-            return mark_safe('%s%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name))\n+            return '%s%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name)\n \n class EasyChoice(object):\n     def __init__(self, easy_model, field, value, label):\n@@ -83,7 +82,7 @@ def __repr__(self):\n         return smart_str('<EasyChoice for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def url(self):\n-        return mark_safe('%s%s/%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.field.name, iri_to_uri(self.value)))\n+        return '%s%s/%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.field.name, iri_to_uri(self.value))\n \n class EasyInstance(object):\n     def __init__(self, easy_model, instance):\n@@ -105,7 +104,7 @@ def pk(self):\n         return self.instance._get_pk_val()\n \n     def url(self):\n-        return mark_safe('%s%s/%s/objects/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, iri_to_uri(self.pk())))\n+        return '%s%s/%s/objects/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, iri_to_uri(self.pk()))\n \n     def fields(self):\n         \"\"\"\n@@ -187,14 +186,14 @@ def urls(self):\n                 for value in self.values():\n                     if value is None:\n                         continue\n-                    url = mark_safe('%s%s/%s/objects/%s/' % (self.model.site.root_url, m.model._meta.app_label, m.model._meta.module_name, iri_to_uri(value._get_pk_val())))\n+                    url = '%s%s/%s/objects/%s/' % (self.model.site.root_url, m.model._meta.app_label, m.model._meta.module_name, iri_to_uri(value._get_pk_val()))\n                     lst.append((smart_unicode(value), url))\n             else:\n                 lst = [(value, None) for value in self.values()]\n         elif self.field.choices:\n             lst = []\n             for value in self.values():\n-                url = mark_safe('%s%s/%s/fields/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name, iri_to_uri(self.raw_value)))\n+                url = '%s%s/%s/fields/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name, iri_to_uri(self.raw_value))\n                 lst.append((value, url))\n         elif isinstance(self.field, models.URLField):\n             val = self.values()[0]"
        },
        {
            "sha": "7bdd1e0032319806b6c7e8699633bb3daf220ab1",
            "filename": "django/contrib/databrowse/plugins/calendars.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,9 +5,9 @@\n from django.contrib.databrowse.datastructures import EasyModel\n from django.contrib.databrowse.sites import DatabrowsePlugin\n from django.shortcuts import render_to_response\n+from django.utils.html import format_html, format_html_join\n from django.utils.text import capfirst\n from django.utils.encoding import force_unicode\n-from django.utils.safestring import mark_safe\n from django.views.generic import dates\n from django.utils import datetime_safe\n \n@@ -64,18 +64,19 @@ def model_index_html(self, request, model, site):\n         fields = self.field_dict(model)\n         if not fields:\n             return ''\n-        return mark_safe('<p class=\"filter\"><strong>View calendar by:</strong> %s</p>' % \\\n-            ', '.join(['<a href=\"calendars/%s/\">%s</a>' % (f.name, force_unicode(capfirst(f.verbose_name))) for f in fields.values()]))\n+        return format_html('<p class=\"filter\"><strong>View calendar by:</strong> {0}</p>',\n+                           format_html_join(', ', '<a href=\"calendars/{0}/\">{1}</a>',\n+                                            ((f.name, force_unicode(capfirst(f.verbose_name))) for f in fields.values())))\n \n     def urls(self, plugin_name, easy_instance_field):\n         if isinstance(easy_instance_field.field, models.DateField):\n             d = easy_instance_field.raw_value\n-            return [mark_safe('%s%s/%s/%s/%s/%s/' % (\n+            return ['%s%s/%s/%s/%s/%s/' % (\n                 easy_instance_field.model.url(),\n                 plugin_name, easy_instance_field.field.name,\n                 str(d.year),\n                 datetime_safe.new_date(d).strftime('%b').lower(),\n-                d.day))]\n+                d.day)]\n \n     def model_view(self, request, model_databrowse, url):\n         self.model, self.site = model_databrowse.model, model_databrowse.site"
        },
        {
            "sha": "c016385ffbb46ea75e66a0733651cacd85d16360",
            "filename": "django/contrib/databrowse/plugins/fieldchoices.py",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,10 +5,11 @@\n from django.contrib.databrowse.datastructures import EasyModel\n from django.contrib.databrowse.sites import DatabrowsePlugin\n from django.shortcuts import render_to_response\n+from django.utils.html import format_html, format_html_join\n+from django.utils.http import urlquote\n from django.utils.text import capfirst\n-from django.utils.encoding import smart_str, force_unicode\n-from django.utils.safestring import mark_safe\n-import urllib\n+from django.utils.encoding import force_unicode\n+\n \n class FieldChoicePlugin(DatabrowsePlugin):\n     def __init__(self, field_filter=None):\n@@ -32,16 +33,16 @@ def model_index_html(self, request, model, site):\n         fields = self.field_dict(model)\n         if not fields:\n             return ''\n-        return mark_safe('<p class=\"filter\"><strong>View by:</strong> %s</p>' % \\\n-            ', '.join(['<a href=\"fields/%s/\">%s</a>' % (f.name, force_unicode(capfirst(f.verbose_name))) for f in fields.values()]))\n+        return format_html('<p class=\"filter\"><strong>View by:</strong> {0}</p>',\n+                           format_html_join(', ', '<a href=\"fields/{0}/\">{1}</a>',\n+                                            ((f.name, force_unicode(capfirst(f.verbose_name))) for f in fields.values())))\n \n     def urls(self, plugin_name, easy_instance_field):\n         if easy_instance_field.field in self.field_dict(easy_instance_field.model.model).values():\n-            field_value = smart_str(easy_instance_field.raw_value)\n-            return [mark_safe('%s%s/%s/%s/' % (\n+            return ['%s%s/%s/%s/' % (\n                 easy_instance_field.model.url(),\n                 plugin_name, easy_instance_field.field.name,\n-                urllib.quote(field_value, safe='')))]\n+                urlquote(easy_instance_field.raw_value, safe=''))]\n \n     def model_view(self, request, model_databrowse, url):\n         self.model, self.site = model_databrowse.model, model_databrowse.site"
        },
        {
            "sha": "e956f4ea6775b04d05ba53b6ac1c68271b22a5cc",
            "filename": "django/contrib/databrowse/plugins/objects.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fobjects.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fobjects.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fobjects.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,14 +1,18 @@\n+try:\n+    from urllib.parse import urljoin\n+except ImportError:     # Python 2\n+    from urlparse import urljoin\n+\n from django import http\n from django.contrib.databrowse.datastructures import EasyModel\n from django.contrib.databrowse.sites import DatabrowsePlugin\n from django.shortcuts import render_to_response\n-import urlparse\n \n class ObjectDetailPlugin(DatabrowsePlugin):\n     def model_view(self, request, model_databrowse, url):\n         # If the object ID wasn't provided, redirect to the model page, which is one level up.\n         if url is None:\n-            return http.HttpResponseRedirect(urlparse.urljoin(request.path, '../'))\n+            return http.HttpResponseRedirect(urljoin(request.path, '../'))\n         easy_model = EasyModel(model_databrowse.site, model_databrowse.model)\n         obj = easy_model.object_by_pk(url)\n         return render_to_response('databrowse/object_detail.html', {'object': obj, 'root_url': model_databrowse.site.root_url})"
        },
        {
            "sha": "0b462ac5a474e2e27b81a529e8bfd2914046bb50",
            "filename": "django/contrib/flatpages/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fflatpages%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fflatpages%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fflatpages%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -23,7 +23,7 @@ def flatpage(request, url):\n \n     Models: `flatpages.flatpages`\n     Templates: Uses the template defined by the ``template_name`` field,\n-        or `flatpages/default.html` if template_name is not defined.\n+        or :template:`flatpages/default.html` if template_name is not defined.\n     Context:\n         flatpage\n             `flatpages.flatpages` object"
        },
        {
            "sha": "8763cded07865c33ab8773ad2ce61cb2ea95c0b5",
            "filename": "django/contrib/formtools/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fformtools%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fformtools%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Futils.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n import pickle\n \n from django.utils.crypto import salted_hmac\n+from django.utils import six\n \n \n def form_hmac(form):\n@@ -16,7 +17,7 @@ def form_hmac(form):\n             value = bf.data or ''\n         else:\n             value = bf.field.clean(bf.data) or ''\n-        if isinstance(value, basestring):\n+        if isinstance(value, six.string_types):\n             value = value.strip()\n         data.append((bf.name, value))\n "
        },
        {
            "sha": "466af1cac94236f2887ec6c016871569cfe982ef",
            "filename": "django/contrib/formtools/wizard/views.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,7 @@\n from django.views.generic import TemplateView\n from django.utils.datastructures import SortedDict\n from django.utils.decorators import classonlymethod\n+from django.utils import six\n \n from django.contrib.formtools.wizard.storage import get_storage\n from django.contrib.formtools.wizard.storage.exceptions import NoFileStorageConfigured\n@@ -133,8 +134,9 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n           The key should be equal to the `step_name` in the `form_list` (or\n           the str of the zero based counter - if no step_names added in the\n           `form_list`)\n-        * `instance_dict` - contains a dictionary of instance objects. This\n-          is only used when `ModelForm`s are used. The key should be equal to\n+        * `instance_dict` - contains a dictionary whose values are model\n+          instances if the step is based on a ``ModelForm`` and querysets if\n+          the step is based on a ``ModelFormSet``. The key should be equal to\n           the `step_name` in the `form_list`. Same rules as for `initial_dict`\n           apply.\n         * `condition_dict` - contains a dictionary of boolean values or\n@@ -156,10 +158,10 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n             if isinstance(form, (list, tuple)):\n                 # if the element is a tuple, add the tuple to the new created\n                 # sorted dictionary.\n-                init_form_list[unicode(form[0])] = form[1]\n+                init_form_list[six.text_type(form[0])] = form[1]\n             else:\n                 # if not, add the form with a zero based counter as unicode\n-                init_form_list[unicode(i)] = form\n+                init_form_list[six.text_type(i)] = form\n \n         # walk through the new created list of forms\n         for form in init_form_list.itervalues():"
        },
        {
            "sha": "47570d3f9daedf741dd74838a959c4cb8d86893b",
            "filename": "django/contrib/gis/admin/widgets.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fadmin%2Fwidgets.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,7 @@\n from django.forms.widgets import Textarea\n from django.template import loader, Context\n from django.templatetags.static import static\n+from django.utils import six\n from django.utils import translation\n \n from django.contrib.gis.gdal import OGRException\n@@ -25,7 +26,7 @@ def render(self, name, value, attrs=None):\n \n         # If a string reaches here (via a validation error on another\n         # field) then just reconstruct the Geometry.\n-        if isinstance(value, basestring):\n+        if isinstance(value, six.string_types):\n             try:\n                 value = GEOSGeometry(value)\n             except (GEOSException, ValueError):\n@@ -109,7 +110,7 @@ def _has_changed(self, initial, data):\n         \"\"\" Compare geographic value of data with its initial value. \"\"\"\n \n         # Ensure we are dealing with a geographic object\n-        if isinstance(initial, basestring):\n+        if isinstance(initial, six.string_types):\n             try:\n                 initial = GEOSGeometry(initial)\n             except (GEOSException, ValueError):"
        },
        {
            "sha": "d9f3546cffca864095a931d5eb3c7f90292a36b2",
            "filename": "django/contrib/gis/db/backends/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,6 +4,7 @@\n \"\"\"\n import re\n from django.contrib.gis import gdal\n+from django.utils import six\n \n class BaseSpatialOperations(object):\n     \"\"\"\n@@ -88,7 +89,7 @@ def convert_geom(self, geom_val, geom_field):\n \n     # For quoting column values, rather than columns.\n     def geo_quote_name(self, name):\n-        if isinstance(name, unicode):\n+        if isinstance(name, six.text_type):\n             name = name.encode('ascii')\n         return \"'%s'\" % name\n \n@@ -330,6 +331,6 @@ def __unicode__(self):\n         it will be 'pretty' OGC WKT.\n         \"\"\"\n         try:\n-            return unicode(self.srs)\n+            return six.text_type(self.srs)\n         except:\n-            return unicode(self.wkt)\n+            return six.text_type(self.wkt)"
        },
        {
            "sha": "4e33942f7aba1bc48c0adcab1f4ce4e91f136a4f",
            "filename": "django/contrib/gis/db/backends/oracle/operations.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,6 +16,7 @@\n from django.contrib.gis.db.backends.util import SpatialFunction\n from django.contrib.gis.geometry.backend import Geometry\n from django.contrib.gis.measure import Distance\n+from django.utils import six\n \n class SDOOperation(SpatialFunction):\n     \"Base class for SDO* Oracle operations.\"\n@@ -65,7 +66,7 @@ def __init__(self, mask):\n         super(SDORelate, self).__init__(self.relate_func, mask=mask)\n \n # Valid distance types and substitutions\n-dtypes = (Decimal, Distance, float, int, long)\n+dtypes = (Decimal, Distance, float) + six.integer_types\n \n class OracleOperations(DatabaseOperations, BaseSpatialOperations):\n     compiler_module = \"django.contrib.gis.db.backends.oracle.compiler\"\n@@ -120,7 +121,7 @@ class OracleOperations(DatabaseOperations, BaseSpatialOperations):\n         'exact' : SDOOperation('SDO_EQUAL'),\n         'overlaps' : SDOOperation('SDO_OVERLAPS'),\n         'same_as' : SDOOperation('SDO_EQUAL'),\n-        'relate' : (SDORelate, basestring), # Oracle uses a different syntax, e.g., 'mask=inside+touch'\n+        'relate' : (SDORelate, six.string_types), # Oracle uses a different syntax, e.g., 'mask=inside+touch'\n         'touches' : SDOOperation('SDO_TOUCH'),\n         'within' : SDOOperation('SDO_INSIDE'),\n         }"
        },
        {
            "sha": "a6340ce22b231323601f890b4d54663aa09582d5",
            "filename": "django/contrib/gis/db/backends/postgis/operations.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.db.backends.postgresql_psycopg2.base import DatabaseOperations\n from django.db.utils import DatabaseError\n+from django.utils import six\n \n #### Classes used in constructing PostGIS spatial SQL ####\n class PostGISOperator(SpatialOperation):\n@@ -161,11 +162,11 @@ def __init__(self, connection):\n             'overlaps' : PostGISFunction(prefix, 'Overlaps'),\n             'contains' : PostGISFunction(prefix, 'Contains'),\n             'intersects' : PostGISFunction(prefix, 'Intersects'),\n-            'relate' : (PostGISRelate, basestring),\n+            'relate' : (PostGISRelate, six.string_types),\n             }\n \n         # Valid distance types and substitutions\n-        dtypes = (Decimal, Distance, float, int, long)\n+        dtypes = (Decimal, Distance, float) + six.integer_types\n         def get_dist_ops(operator):\n             \"Returns operations for both regular and spherical distances.\"\n             return {'cartesian' : PostGISDistance(prefix, operator),"
        },
        {
            "sha": "4f12ade1147f2abe3805cd5c9741951856075bc7",
            "filename": "django/contrib/gis/db/backends/spatialite/introspection.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fintrospection.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,6 @@\n from django.contrib.gis.gdal import OGRGeomType\n from django.db.backends.sqlite3.introspection import DatabaseIntrospection, FlexibleFieldLookupDict\n+from django.utils import six\n \n class GeoFlexibleFieldLookupDict(FlexibleFieldLookupDict):\n     \"\"\"\n@@ -43,7 +44,7 @@ def get_geometry_type(self, table_name, geo_col):\n             field_params = {}\n             if srid != 4326:\n                 field_params['srid'] = srid\n-            if isinstance(dim, basestring) and 'Z' in dim:\n+            if isinstance(dim, six.string_types) and 'Z' in dim:\n                 field_params['dim'] = 3\n         finally:\n             cursor.close()"
        },
        {
            "sha": "1d7c4fab52ebca81aed8e3ddf8a1b84ae9d70f5c",
            "filename": "django/contrib/gis/db/backends/spatialite/operations.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,6 +9,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.db.backends.sqlite3.base import DatabaseOperations\n from django.db.utils import DatabaseError\n+from django.utils import six\n \n class SpatiaLiteOperator(SpatialOperation):\n     \"For SpatiaLite operators (e.g. `&&`, `~`).\"\n@@ -42,7 +43,7 @@ def __init__(self, pattern):\n         super(SpatiaLiteRelate, self).__init__('Relate')\n \n # Valid distance types and substitutions\n-dtypes = (Decimal, Distance, float, int, long)\n+dtypes = (Decimal, Distance, float) + six.integer_types\n def get_dist_ops(operator):\n     \"Returns operations for regular distances; spherical distances are not currently supported.\"\n     return (SpatiaLiteDistance(operator),)\n@@ -89,7 +90,7 @@ class SpatiaLiteOperations(DatabaseOperations, BaseSpatialOperations):\n         'overlaps' : SpatiaLiteFunction('Overlaps'),\n         'contains' : SpatiaLiteFunction('Contains'),\n         'intersects' : SpatiaLiteFunction('Intersects'),\n-        'relate' : (SpatiaLiteRelate, basestring),\n+        'relate' : (SpatiaLiteRelate, six.string_types),\n         # Returns true if B's bounding box completely contains A's bounding box.\n         'contained' : SpatiaLiteFunction('MbrWithin'),\n         # Returns true if A's bounding box completely contains B's bounding box."
        },
        {
            "sha": "648fcfe96377c1c60afdfa12c3e88aced8131baf",
            "filename": "django/contrib/gis/db/backends/util.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Futil.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,14 +3,16 @@\n backends.\n \"\"\"\n \n+from django.utils import six\n+\n def gqn(val):\n     \"\"\"\n     The geographic quote name function; used for quoting tables and\n     geometries (they use single rather than the double quotes of the\n     backend quotename function).\n     \"\"\"\n-    if isinstance(val, basestring):\n-        if isinstance(val, unicode): val = val.encode('ascii')\n+    if isinstance(val, six.string_types):\n+        if isinstance(val, six.text_type): val = val.encode('ascii')\n         return \"'%s'\" % val\n     else:\n         return str(val)"
        },
        {
            "sha": "17630d0899c4bf9f37cb31b5c3c26449c7e00fe1",
            "filename": "django/contrib/gis/db/models/fields.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Ffields.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,6 +4,7 @@\n from django.contrib.gis import forms\n from django.contrib.gis.db.models.proxy import GeometryProxy\n from django.contrib.gis.geometry.backend import Geometry, GeometryException\n+from django.utils import six\n \n # Local cache of the spatial_ref_sys table, which holds SRID data for each\n # spatial database alias. This cache exists so that the database isn't queried\n@@ -159,7 +160,7 @@ def get_prep_value(self, value):\n         # from the given string input.\n         if isinstance(geom, Geometry):\n             pass\n-        elif isinstance(geom, basestring) or hasattr(geom, '__geo_interface__'):\n+        elif isinstance(geom, six.string_types) or hasattr(geom, '__geo_interface__'):\n             try:\n                 geom = Geometry(geom)\n             except GeometryException:"
        },
        {
            "sha": "413610fc5cdbd4d0ced11b1b2be120880a046125",
            "filename": "django/contrib/gis/db/models/proxy.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fproxy.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fproxy.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fproxy.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,6 +5,7 @@\n \n Thanks to Robert Coup for providing this functionality (see #4322).\n \"\"\"\n+from django.utils import six\n \n class GeometryProxy(object):\n     def __init__(self, klass, field):\n@@ -53,7 +54,7 @@ def __set__(self, obj, value):\n         if isinstance(value, self._klass) and (str(value.geom_type).upper() == gtype or gtype == 'GEOMETRY'):\n             # Assigning the SRID to the geometry.\n             if value.srid is None: value.srid = self._field.srid\n-        elif value is None or isinstance(value, (basestring, buffer)):\n+        elif value is None or isinstance(value, six.string_types + (buffer,)):\n             # Set with None, WKT, HEX, or WKB\n             pass\n         else:"
        },
        {
            "sha": "dd2983aeccea5742dd544860294cbda12b3815e2",
            "filename": "django/contrib/gis/db/models/query.py",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,6 +6,9 @@\n from django.contrib.gis.db.models.sql import AreaField, DistanceField, GeomField, GeoQuery\n from django.contrib.gis.geometry.backend import Geometry\n from django.contrib.gis.measure import Area, Distance\n+from django.utils import six\n+\n+from django.utils import six\n \n class GeoQuerySet(QuerySet):\n     \"The Geographic QuerySet.\"\n@@ -144,7 +147,7 @@ def geojson(self, precision=8, crs=False, bbox=False, **kwargs):\n         if not backend.geojson:\n             raise NotImplementedError('Only PostGIS 1.3.4+ supports GeoJSON serialization.')\n \n-        if not isinstance(precision, (int, long)):\n+        if not isinstance(precision, six.integer_types):\n             raise TypeError('Precision keyword must be set with an integer.')\n \n         # Setting the options flag -- which depends on which version of\n@@ -173,7 +176,7 @@ def geohash(self, precision=20, **kwargs):\n         The `precision` keyword may be used to custom the number of\n         _characters_ used in the output GeoHash, the default is 20.\n         \"\"\"\n-        s = {'desc' : 'GeoHash', \n+        s = {'desc' : 'GeoHash',\n              'procedure_args': {'precision': precision},\n              'procedure_fmt': '%(geo_col)s,%(precision)s',\n              }\n@@ -309,7 +312,7 @@ def snap_to_grid(self, *args, **kwargs):\n           - 2 arguments: X and Y sizes to snap the grid to.\n           - 4 arguments: X, Y sizes and the X, Y origins.\n         \"\"\"\n-        if False in [isinstance(arg, (float, int, long)) for arg in args]:\n+        if False in [isinstance(arg, (float,) + six.integer_types) for arg in args]:\n             raise TypeError('Size argument(s) for the grid must be a float or integer values.')\n \n         nargs = len(args)\n@@ -349,7 +352,7 @@ def svg(self, relative=False, precision=8, **kwargs):\n                         digits used in output (defaults to 8).\n         \"\"\"\n         relative = int(bool(relative))\n-        if not isinstance(precision, (int, long)):\n+        if not isinstance(precision, six.integer_types):\n             raise TypeError('SVG precision keyword argument must be an integer.')\n         s = {'desc' : 'SVG',\n              'procedure_fmt' : '%(geo_col)s,%(rel)s,%(precision)s',\n@@ -390,7 +393,7 @@ def transform(self, srid=4326, **kwargs):\n         Transforms the given geometry field to the given SRID.  If no SRID is\n         provided, the transformation will default to using 4326 (WGS84).\n         \"\"\"\n-        if not isinstance(srid, (int, long)):\n+        if not isinstance(srid, six.integer_types):\n             raise TypeError('An integer SRID must be provided.')\n         field_name = kwargs.get('field_name', None)\n         tmp, geo_field = self._spatial_setup('transform', field_name=field_name)\n@@ -533,7 +536,7 @@ def _spatial_attribute(self, att, settings, field_name=None, model_att=None):\n             geo_field = settings['geo_field']\n \n         # The attribute to attach to the model.\n-        if not isinstance(model_att, basestring): model_att = att\n+        if not isinstance(model_att, six.string_types): model_att = att\n \n         # Special handling for any argument that is a geometry.\n         for name in settings['geom_args']:"
        },
        {
            "sha": "d016357f1b6c1758815fa6b1f462ae268ba9323a",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,4 +1,4 @@\n-from future_builtins import zip\n+from django.utils.six.moves import zip\n \n from django.db.backends.util import truncate_name, typecast_timestamp\n from django.db.models.sql import compiler"
        },
        {
            "sha": "cefb6830ba881ee2ac8303df6cf2374fbf6ab2b1",
            "filename": "django/contrib/gis/forms/fields.py",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fforms%2Ffields.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,7 +5,7 @@\n \n # While this couples the geographic forms to the GEOS library,\n # it decouples from database (by not importing SpatialBackend).\n-from django.contrib.gis.geos import GEOSGeometry\n+from django.contrib.gis.geos import GEOSException, GEOSGeometry\n \n class GeometryField(forms.Field):\n     \"\"\"\n@@ -31,6 +31,15 @@ def __init__(self, **kwargs):\n         self.null = kwargs.pop('null', True)\n         super(GeometryField, self).__init__(**kwargs)\n \n+    def to_python(self, value):\n+        \"\"\"\n+        Transforms the value to a Geometry object.\n+        \"\"\"\n+        try:\n+            return GEOSGeometry(value)\n+        except (GEOSException, ValueError, TypeError):\n+            raise forms.ValidationError(self.error_messages['invalid_geom'])\n+\n     def clean(self, value):\n         \"\"\"\n         Validates that the input value can be converted to a Geometry\n@@ -44,11 +53,8 @@ def clean(self, value):\n             else:\n                 raise forms.ValidationError(self.error_messages['no_geom'])\n \n-        # Trying to create a Geometry object from the form value.\n-        try:\n-            geom = GEOSGeometry(value)\n-        except:\n-            raise forms.ValidationError(self.error_messages['invalid_geom'])\n+        # Transform the value to a python object first\n+        geom = self.to_python(value)\n \n         # Ensuring that the geometry is of the correct type (indicated\n         # using the OGC string label)."
        },
        {
            "sha": "adff96b47aba8d924858816938e906b003fe1c6d",
            "filename": "django/contrib/gis/gdal/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -37,12 +37,12 @@\n try:\n     from django.contrib.gis.gdal.driver import Driver\n     from django.contrib.gis.gdal.datasource import DataSource\n-    from django.contrib.gis.gdal.libgdal import gdal_version, gdal_full_version, gdal_release_date, GEOJSON, GDAL_VERSION\n+    from django.contrib.gis.gdal.libgdal import gdal_version, gdal_full_version, gdal_release_date, GDAL_VERSION\n     from django.contrib.gis.gdal.srs import SpatialReference, CoordTransform\n     from django.contrib.gis.gdal.geometries import OGRGeometry\n     HAS_GDAL = True\n except:\n-    HAS_GDAL, GEOJSON = False, False\n+    HAS_GDAL = False\n \n try:\n     from django.contrib.gis.gdal.envelope import Envelope"
        },
        {
            "sha": "e86277e95ef07cd05aae94de70e554e71e76a14c",
            "filename": "django/contrib/gis/gdal/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,7 @@\n from ctypes import c_void_p\n \n from django.contrib.gis.gdal.error import GDALException\n+from django.utils import six\n \n class GDALBase(object):\n     \"\"\"\n@@ -24,7 +25,7 @@ def _get_ptr(self):\n     def _set_ptr(self, ptr):\n         # Only allow the pointer to be set with pointers of the\n         # compatible type or None (NULL).\n-        if isinstance(ptr, (int, long)):\n+        if isinstance(ptr, six.integer_types):\n             self._ptr = self.ptr_type(ptr)\n         elif ptr is None or isinstance(ptr, self.ptr_type):\n             self._ptr = ptr"
        },
        {
            "sha": "4ceddc6c72c4c24760e7775ffb653320351ccfd5",
            "filename": "django/contrib/gis/gdal/datasource.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fdatasource.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fdatasource.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fdatasource.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -45,6 +45,9 @@\n # Getting the ctypes prototypes for the DataSource.\n from django.contrib.gis.gdal.prototypes import ds as capi\n \n+from django.utils import six\n+from django.utils.six.moves import xrange\n+\n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n #\n@@ -65,7 +68,7 @@ def __init__(self, ds_input, ds_driver=False, write=False):\n         if not capi.get_driver_count():\n             capi.register_all()\n \n-        if isinstance(ds_input, basestring):\n+        if isinstance(ds_input, six.string_types):\n             # The data source driver is a void pointer.\n             ds_driver = Driver.ptr_type()\n             try:\n@@ -84,7 +87,7 @@ def __init__(self, ds_input, ds_driver=False, write=False):\n             self.ptr = ds\n             self.driver = Driver(ds_driver)\n         else:\n-            # Raise an exception if the returned pointer is NULL \n+            # Raise an exception if the returned pointer is NULL\n             raise OGRException('Invalid data source file \"%s\"' % ds_input)\n \n     def __del__(self):\n@@ -98,7 +101,7 @@ def __iter__(self):\n \n     def __getitem__(self, index):\n         \"Allows use of the index [] operator to get a layer at the index.\"\n-        if isinstance(index, basestring):\n+        if isinstance(index, six.string_types):\n             l = capi.get_layer_by_name(self.ptr, index)\n             if not l: raise OGRIndexError('invalid OGR Layer name given: \"%s\"' % index)\n         elif isinstance(index, int):\n@@ -108,7 +111,7 @@ def __getitem__(self, index):\n         else:\n             raise TypeError('Invalid index type: %s' % type(index))\n         return Layer(l, self)\n-        \n+\n     def __len__(self):\n         \"Returns the number of layers within the data source.\"\n         return self.layer_count"
        },
        {
            "sha": "de4dc61c63bf9dd26d7c7572f10fd38b30d67ce8",
            "filename": "django/contrib/gis/gdal/driver.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fdriver.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fdriver.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fdriver.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,9 +1,11 @@\n-# prerequisites imports \n+# prerequisites imports\n from ctypes import c_void_p\n from django.contrib.gis.gdal.base import GDALBase\n from django.contrib.gis.gdal.error import OGRException\n from django.contrib.gis.gdal.prototypes import ds as capi\n \n+from django.utils import six\n+\n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n #\n@@ -18,11 +20,11 @@ class Driver(GDALBase):\n               'tiger' : 'TIGER',\n               'tiger/line' : 'TIGER',\n               }\n-                \n+\n     def __init__(self, dr_input):\n         \"Initializes an OGR driver on either a string or integer input.\"\n \n-        if isinstance(dr_input, basestring):\n+        if isinstance(dr_input, six.string_types):\n             # If a string name of the driver was passed in\n             self._register()\n \n@@ -57,7 +59,7 @@ def _register(self):\n         # Only register all if the driver count is 0 (or else all drivers\n         # will be registered over and over again)\n         if not self.driver_count: capi.register_all()\n-                    \n+\n     # Driver properties\n     @property\n     def driver_count(self):"
        },
        {
            "sha": "292004873dac737ed93d214fa8b47e31969e748d",
            "filename": "django/contrib/gis/gdal/feature.py",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Ffeature.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Ffeature.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ffeature.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,9 @@\n # ctypes function prototypes\n from django.contrib.gis.gdal.prototypes import ds as capi, geom as geom_api\n \n+from django.utils import six\n+from django.utils.six.moves import xrange\n+\n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n #\n@@ -30,17 +33,17 @@ def __getitem__(self, index):\n         \"\"\"\n         Gets the Field object at the specified index, which may be either\n         an integer or the Field's string label.  Note that the Field object\n-        is not the field's _value_ -- use the `get` method instead to \n+        is not the field's _value_ -- use the `get` method instead to\n         retrieve the value (e.g. an integer) instead of a Field instance.\n         \"\"\"\n-        if isinstance(index, basestring):\n+        if isinstance(index, six.string_types):\n             i = self.index(index)\n         else:\n             if index < 0 or index > self.num_fields:\n                 raise OGRIndexError('index out of range')\n             i = index\n         return Field(self.ptr, i)\n-    \n+\n     def __iter__(self):\n         \"Iterates over each field in the Feature.\"\n         for i in xrange(self.num_fields):\n@@ -49,7 +52,7 @@ def __iter__(self):\n     def __len__(self):\n         \"Returns the count of fields in this feature.\"\n         return self.num_fields\n-        \n+\n     def __str__(self):\n         \"The string name of the feature.\"\n         return 'Feature FID %d in Layer<%s>' % (self.fid, self.layer_name)\n@@ -63,7 +66,7 @@ def __eq__(self, other):\n     def fid(self):\n         \"Returns the feature identifier.\"\n         return capi.get_fid(self.ptr)\n-        \n+\n     @property\n     def layer_name(self):\n         \"Returns the name of the layer for the feature.\"\n@@ -77,7 +80,7 @@ def num_fields(self):\n     @property\n     def fields(self):\n         \"Returns a list of fields in the Feature.\"\n-        return [capi.get_field_name(capi.get_field_defn(self._fdefn, i)) \n+        return [capi.get_field_name(capi.get_field_defn(self._fdefn, i))\n                 for i in xrange(self.num_fields)]\n \n     @property\n@@ -91,7 +94,7 @@ def geom(self):\n     def geom_type(self):\n         \"Returns the OGR Geometry Type for this Feture.\"\n         return OGRGeomType(capi.get_fd_geom_type(self._fdefn))\n-    \n+\n     #### Feature Methods ####\n     def get(self, field):\n         \"\"\""
        },
        {
            "sha": "d752104e0a831a5878298a27c78fd15e2f3803f5",
            "filename": "django/contrib/gis/gdal/geometries.py",
            "status": "modified",
            "additions": 14,
            "deletions": 21,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -48,7 +48,7 @@\n from django.contrib.gis.gdal.envelope import Envelope, OGREnvelope\n from django.contrib.gis.gdal.error import OGRException, OGRIndexError, SRSException\n from django.contrib.gis.gdal.geomtype import OGRGeomType\n-from django.contrib.gis.gdal.libgdal import GEOJSON, GDAL_VERSION\n+from django.contrib.gis.gdal.libgdal import GDAL_VERSION\n from django.contrib.gis.gdal.srs import SpatialReference, CoordTransform\n \n # Getting the ctypes prototype functions that interface w/the GDAL C library.\n@@ -57,6 +57,9 @@\n # For recognizing geometry input.\n from django.contrib.gis.geometry.regex import hex_regex, wkt_regex, json_regex\n \n+from django.utils import six\n+from django.utils.six.moves import xrange\n+\n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n #\n@@ -69,7 +72,7 @@ class OGRGeometry(GDALBase):\n     def __init__(self, geom_input, srs=None):\n         \"Initializes Geometry on either WKT or an OGR pointer as input.\"\n \n-        str_instance = isinstance(geom_input, basestring)\n+        str_instance = isinstance(geom_input, six.string_types)\n \n         # If HEX, unpack input to to a binary buffer.\n         if str_instance and hex_regex.match(geom_input):\n@@ -79,7 +82,7 @@ def __init__(self, geom_input, srs=None):\n         # Constructing the geometry,\n         if str_instance:\n             # Checking if unicode\n-            if isinstance(geom_input, unicode):\n+            if isinstance(geom_input, six.text_type):\n                 # Encoding to ASCII, WKT or HEX doesn't need any more.\n                 geom_input = geom_input.encode('ascii')\n \n@@ -97,10 +100,7 @@ def __init__(self, geom_input, srs=None):\n                 else:\n                     g = capi.from_wkt(byref(c_char_p(wkt_m.group('wkt'))), None, byref(c_void_p()))\n             elif json_m:\n-                if GEOJSON:\n-                    g = capi.from_json(geom_input)\n-                else:\n-                    raise NotImplementedError('GeoJSON input only supported on GDAL 1.5+.')\n+                g = capi.from_json(geom_input)\n             else:\n                 # Seeing if the input is a valid short-hand string\n                 # (e.g., 'Point', 'POLYGON').\n@@ -284,7 +284,7 @@ def _set_srs(self, srs):\n         # (decremented) when this geometry's destructor is called.\n         if isinstance(srs, SpatialReference):\n             srs_ptr = srs.ptr\n-        elif isinstance(srs, (int, long, basestring)):\n+        elif isinstance(srs, six.integer_types + six.string_types):\n             sr = SpatialReference(srs)\n             srs_ptr = sr.ptr\n         else:\n@@ -300,7 +300,7 @@ def _get_srid(self):\n         return None\n \n     def _set_srid(self, srid):\n-        if isinstance(srid, (int, long)):\n+        if isinstance(srid, six.integer_types):\n             self.srs = srid\n         else:\n             raise TypeError('SRID must be set with an integer.')\n@@ -328,22 +328,15 @@ def hex(self):\n     @property\n     def json(self):\n         \"\"\"\n-        Returns the GeoJSON representation of this Geometry (requires\n-        GDAL 1.5+).\n+        Returns the GeoJSON representation of this Geometry.\n         \"\"\"\n-        if GEOJSON:\n-            return capi.to_json(self.ptr)\n-        else:\n-            raise NotImplementedError('GeoJSON output only supported on GDAL 1.5+.')\n+        return capi.to_json(self.ptr)\n     geojson = json\n \n     @property\n     def kml(self):\n         \"Returns the KML representation of the Geometry.\"\n-        if GEOJSON:\n-            return capi.to_kml(self.ptr, None)\n-        else:\n-            raise NotImplementedError('KML output only supported on GDAL 1.5+.')\n+        return capi.to_kml(self.ptr, None)\n \n     @property\n     def wkb_size(self):\n@@ -420,7 +413,7 @@ def transform(self, coord_trans, clone=False):\n             capi.geom_transform(self.ptr, coord_trans.ptr)\n         elif isinstance(coord_trans, SpatialReference):\n             capi.geom_transform_to(self.ptr, coord_trans.ptr)\n-        elif isinstance(coord_trans, (int, long, basestring)):\n+        elif isinstance(coord_trans, six.integer_types + six.string_types):\n             sr = SpatialReference(coord_trans)\n             capi.geom_transform_to(self.ptr, sr.ptr)\n         else:\n@@ -695,7 +688,7 @@ def add(self, geom):\n                 for g in geom: capi.add_geom(self.ptr, g.ptr)\n             else:\n                 capi.add_geom(self.ptr, geom.ptr)\n-        elif isinstance(geom, basestring):\n+        elif isinstance(geom, six.string_types):\n             tmp = OGRGeometry(geom)\n             capi.add_geom(self.ptr, tmp.ptr)\n         else:"
        },
        {
            "sha": "fe4b89adeb8187b895d5e1f8ce1c95b7b0f5d436",
            "filename": "django/contrib/gis/gdal/geomtype.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fgeomtype.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fgeomtype.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fgeomtype.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,7 @@\n from django.contrib.gis.gdal.error import OGRException\n \n+from django.utils import six\n+\n #### OGRGeomType ####\n class OGRGeomType(object):\n     \"Encapulates OGR Geometry Types.\"\n@@ -32,7 +34,7 @@ def __init__(self, type_input):\n         \"Figures out the correct OGR Type based upon the input.\"\n         if isinstance(type_input, OGRGeomType):\n             num = type_input.num\n-        elif isinstance(type_input, basestring):\n+        elif isinstance(type_input, six.string_types):\n             type_input = type_input.lower()\n             if type_input == 'geometry': type_input='unknown'\n             num = self._str_types.get(type_input, None)\n@@ -44,7 +46,7 @@ def __init__(self, type_input):\n             num = type_input\n         else:\n             raise TypeError('Invalid OGR input type given.')\n-        \n+\n         # Setting the OGR geometry type number.\n         self.num = num\n \n@@ -59,7 +61,7 @@ def __eq__(self, other):\n         \"\"\"\n         if isinstance(other, OGRGeomType):\n             return self.num == other.num\n-        elif isinstance(other, basestring):\n+        elif isinstance(other, six.string_types):\n             return self.name.lower() == other.lower()\n         elif isinstance(other, int):\n             return self.num == other"
        },
        {
            "sha": "2357fbb88a6942c2abd73d59804ca9641287dc56",
            "filename": "django/contrib/gis/gdal/layer.py",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Flayer.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Flayer.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Flayer.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -14,6 +14,9 @@\n # GDAL ctypes function prototypes.\n from django.contrib.gis.gdal.prototypes import ds as capi, geom as geom_api, srs as srs_api\n \n+from django.utils import six\n+from django.utils.six.moves import xrange\n+\n # For more information, see the OGR C API source code:\n #  http://www.gdal.org/ogr/ogr__api_8h.html\n #\n@@ -25,8 +28,8 @@ class Layer(GDALBase):\n     def __init__(self, layer_ptr, ds):\n         \"\"\"\n         Initializes on an OGR C pointer to the Layer and the `DataSource` object\n-        that owns this layer.  The `DataSource` object is required so that a \n-        reference to it is kept with this Layer.  This prevents garbage \n+        that owns this layer.  The `DataSource` object is required so that a\n+        reference to it is kept with this Layer.  This prevents garbage\n         collection of the `DataSource` while this Layer is still active.\n         \"\"\"\n         if not layer_ptr:\n@@ -39,7 +42,7 @@ def __init__(self, layer_ptr, ds):\n \n     def __getitem__(self, index):\n         \"Gets the Feature at the specified index.\"\n-        if isinstance(index, (int, long)):\n+        if isinstance(index, six.integer_types):\n             # An integer index was given -- we cannot do a check based on the\n             # number of features because the beginning and ending feature IDs\n             # are not guaranteed to be 0 and len(layer)-1, respectively.\n@@ -85,7 +88,7 @@ def _make_feature(self, feat_id):\n             # each feature until the given feature ID is encountered.\n             for feat in self:\n                 if feat.fid == feat_id: return feat\n-        # Should have returned a Feature, raise an OGRIndexError.    \n+        # Should have returned a Feature, raise an OGRIndexError.\n         raise OGRIndexError('Invalid feature id: %s.' % feat_id)\n \n     #### Layer properties ####\n@@ -131,9 +134,9 @@ def fields(self):\n         Returns a list of string names corresponding to each of the Fields\n         available in this Layer.\n         \"\"\"\n-        return [capi.get_field_name(capi.get_field_defn(self._ldefn, i)) \n+        return [capi.get_field_name(capi.get_field_defn(self._ldefn, i))\n                 for i in xrange(self.num_fields) ]\n-    \n+\n     @property\n     def field_types(self):\n         \"\"\"\n@@ -145,13 +148,13 @@ def field_types(self):\n         return [OGRFieldTypes[capi.get_field_type(capi.get_field_defn(self._ldefn, i))]\n                 for i in xrange(self.num_fields)]\n \n-    @property \n+    @property\n     def field_widths(self):\n         \"Returns a list of the maximum field widths for the features.\"\n         return [capi.get_field_width(capi.get_field_defn(self._ldefn, i))\n                 for i in xrange(self.num_fields)]\n \n-    @property \n+    @property\n     def field_precisions(self):\n         \"Returns the field precisions for the features.\"\n         return [capi.get_field_precision(capi.get_field_defn(self._ldefn, i))"
        },
        {
            "sha": "27a5b8172e6c652524e4085c0dea488e52b26e23",
            "filename": "django/contrib/gis/gdal/libgdal.py",
            "status": "modified",
            "additions": 11,
            "deletions": 17,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Flibgdal.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Flibgdal.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Flibgdal.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -15,31 +15,32 @@\n     lib_names = None\n elif os.name == 'nt':\n     # Windows NT shared libraries\n-    lib_names = ['gdal18', 'gdal17', 'gdal16', 'gdal15']\n+    lib_names = ['gdal19', 'gdal18', 'gdal17', 'gdal16', 'gdal15']\n elif os.name == 'posix':\n     # *NIX library names.\n-    lib_names = ['gdal', 'GDAL', 'gdal1.8.0', 'gdal1.7.0', 'gdal1.6.0', 'gdal1.5.0', 'gdal1.4.0']\n+    lib_names = ['gdal', 'GDAL', 'gdal1.9.0', 'gdal1.8.0', 'gdal1.7.0',\n+        'gdal1.6.0', 'gdal1.5.0']\n else:\n     raise OGRException('Unsupported OS \"%s\"' % os.name)\n \n-# Using the ctypes `find_library` utility  to find the \n+# Using the ctypes `find_library` utility  to find the\n # path to the GDAL library from the list of library names.\n if lib_names:\n     for lib_name in lib_names:\n         lib_path = find_library(lib_name)\n         if not lib_path is None: break\n-        \n+\n if lib_path is None:\n     raise OGRException('Could not find the GDAL library (tried \"%s\"). '\n-                       'Try setting GDAL_LIBRARY_PATH in your settings.' % \n+                       'Try setting GDAL_LIBRARY_PATH in your settings.' %\n                        '\", \"'.join(lib_names))\n \n # This loads the GDAL/OGR C library\n lgdal = CDLL(lib_path)\n \n-# On Windows, the GDAL binaries have some OSR routines exported with \n-# STDCALL, while others are not.  Thus, the library will also need to \n-# be loaded up as WinDLL for said OSR functions that require the \n+# On Windows, the GDAL binaries have some OSR routines exported with\n+# STDCALL, while others are not.  Thus, the library will also need to\n+# be loaded up as WinDLL for said OSR functions that require the\n # different calling convention.\n if os.name == 'nt':\n     from ctypes import WinDLL\n@@ -66,11 +67,11 @@ def gdal_version():\n     \"Returns only the GDAL version number information.\"\n     return _version_info('RELEASE_NAME')\n \n-def gdal_full_version(): \n+def gdal_full_version():\n     \"Returns the full GDAL version information.\"\n     return _version_info('')\n \n-def gdal_release_date(date=False): \n+def gdal_release_date(date=False):\n     \"\"\"\n     Returns the release date in a string format, e.g, \"2007/06/27\".\n     If the date keyword argument is set to True, a Python datetime object\n@@ -96,10 +97,3 @@ def gdal_version_info():\n GDAL_SUBMINOR_VERSION = _verinfo['subminor'] and int(_verinfo['subminor'])\n GDAL_VERSION = (GDAL_MAJOR_VERSION, GDAL_MINOR_VERSION, GDAL_SUBMINOR_VERSION)\n del _verinfo\n-\n-# GeoJSON support is available only in GDAL 1.5+.\n-if GDAL_VERSION >= (1, 5):\n-    GEOJSON = True\n-else:\n-    GEOJSON = False\n-"
        },
        {
            "sha": "d8ff1c7dcf6011bed9d137c892d383be25f3c388",
            "filename": "django/contrib/gis/gdal/prototypes/errcheck.py",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Ferrcheck.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Ferrcheck.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Ferrcheck.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,9 +5,10 @@\n from ctypes import c_void_p, string_at\n from django.contrib.gis.gdal.error import check_err, OGRException, SRSException\n from django.contrib.gis.gdal.libgdal import lgdal\n+from django.utils import six\n \n-# Helper routines for retrieving pointers and/or values from \n-# arguments passed in by reference. \n+# Helper routines for retrieving pointers and/or values from\n+# arguments passed in by reference.\n def arg_byref(args, offset=-1):\n     \"Returns the pointer argument's by-refernece value.\"\n     return args[offset]._obj.value\n@@ -53,7 +54,7 @@ def check_string(result, func, cargs, offset=-1, str_result=False):\n         ptr = ptr_byref(cargs, offset)\n         # Getting the string value\n         s = ptr.value\n-    # Correctly freeing the allocated memory beind GDAL pointer \n+    # Correctly freeing the allocated memory beind GDAL pointer\n     # w/the VSIFree routine.\n     if ptr: lgdal.VSIFree(ptr)\n     return s\n@@ -71,9 +72,9 @@ def check_geom(result, func, cargs):\n     \"Checks a function that returns a geometry.\"\n     # OGR_G_Clone may return an integer, even though the\n     # restype is set to c_void_p\n-    if isinstance(result, (int, long)):\n+    if isinstance(result, six.integer_types):\n         result = c_void_p(result)\n-    if not result: \n+    if not result:\n         raise OGRException('Invalid geometry pointer returned from \"%s\".' % func.__name__)\n     return result\n \n@@ -85,7 +86,7 @@ def check_geom_offset(result, func, cargs, offset=-1):\n \n ### Spatial Reference error-checking routines ###\n def check_srs(result, func, cargs):\n-    if isinstance(result, (int, long)):\n+    if isinstance(result, six.integer_types):\n         result = c_void_p(result)\n     if not result:\n         raise SRSException('Invalid spatial reference pointer returned from \"%s\".' % func.__name__)\n@@ -109,11 +110,11 @@ def check_errcode(result, func, cargs):\n \n def check_pointer(result, func, cargs):\n     \"Makes sure the result pointer is valid.\"\n-    if isinstance(result, (int, long)):\n+    if isinstance(result, six.integer_types):\n         result = c_void_p(result)\n-    if bool(result): \n+    if bool(result):\n         return result\n-    else: \n+    else:\n         raise OGRException('Invalid pointer returned from \"%s\"' % func.__name__)\n \n def check_str_arg(result, func, cargs):"
        },
        {
            "sha": "f2c833d5764df298616bd19c9b9cb25ff3e607a4",
            "filename": "django/contrib/gis/gdal/prototypes/geom.py",
            "status": "modified",
            "additions": 5,
            "deletions": 10,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeom.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fprototypes%2Fgeom.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,6 @@\n from ctypes import c_char_p, c_double, c_int, c_void_p, POINTER\n from django.contrib.gis.gdal.envelope import OGREnvelope\n-from django.contrib.gis.gdal.libgdal import lgdal, GEOJSON\n+from django.contrib.gis.gdal.libgdal import lgdal\n from django.contrib.gis.gdal.prototypes.errcheck import check_bool, check_envelope\n from django.contrib.gis.gdal.prototypes.generation import (const_string_output,\n     double_output, geom_output, int_output, srs_output, string_output, void_output)\n@@ -25,15 +25,10 @@ def topology_func(f):\n \n ### OGR_G ctypes function prototypes ###\n \n-# GeoJSON routines, if supported.\n-if GEOJSON:\n-    from_json = geom_output(lgdal.OGR_G_CreateGeometryFromJson, [c_char_p])\n-    to_json = string_output(lgdal.OGR_G_ExportToJson, [c_void_p], str_result=True)\n-    to_kml = string_output(lgdal.OGR_G_ExportToKML, [c_void_p, c_char_p], str_result=True) \n-else:\n-    from_json = False\n-    to_json = False\n-    to_kml = False\n+# GeoJSON routines.\n+from_json = geom_output(lgdal.OGR_G_CreateGeometryFromJson, [c_char_p])\n+to_json = string_output(lgdal.OGR_G_ExportToJson, [c_void_p], str_result=True)\n+to_kml = string_output(lgdal.OGR_G_ExportToKML, [c_void_p, c_char_p], str_result=True)\n \n # GetX, GetY, GetZ all return doubles.\n getx = pnt_func(lgdal.OGR_G_GetX)"
        },
        {
            "sha": "cdeaaca690b427b5432e9cf207a89ad6a21d166c",
            "filename": "django/contrib/gis/gdal/srs.py",
            "status": "modified",
            "additions": 17,
            "deletions": 15,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fsrs.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Fsrs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fsrs.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -33,28 +33,30 @@\n from django.contrib.gis.gdal.error import SRSException\n from django.contrib.gis.gdal.prototypes import srs as capi\n \n+from django.utils import six\n+\n #### Spatial Reference class. ####\n class SpatialReference(GDALBase):\n     \"\"\"\n     A wrapper for the OGRSpatialReference object.  According to the GDAL Web site,\n-    the SpatialReference object \"provide[s] services to represent coordinate \n+    the SpatialReference object \"provide[s] services to represent coordinate\n     systems (projections and datums) and to transform between them.\"\n     \"\"\"\n \n     #### Python 'magic' routines ####\n     def __init__(self, srs_input=''):\n         \"\"\"\n         Creates a GDAL OSR Spatial Reference object from the given input.\n-        The input may be string of OGC Well Known Text (WKT), an integer \n-        EPSG code, a PROJ.4 string, and/or a projection \"well known\" shorthand \n+        The input may be string of OGC Well Known Text (WKT), an integer\n+        EPSG code, a PROJ.4 string, and/or a projection \"well known\" shorthand\n         string (one of 'WGS84', 'WGS72', 'NAD27', 'NAD83').\n         \"\"\"\n         buf = c_char_p('')\n         srs_type = 'user'\n \n-        if isinstance(srs_input, basestring):\n+        if isinstance(srs_input, six.string_types):\n             # Encoding to ASCII if unicode passed in.\n-            if isinstance(srs_input, unicode):\n+            if isinstance(srs_input, six.text_type):\n                 srs_input = srs_input.encode('ascii')\n             try:\n                 # If SRID is a string, e.g., '4326', then make acceptable\n@@ -63,7 +65,7 @@ def __init__(self, srs_input=''):\n                 srs_input = 'EPSG:%d' % srid\n             except ValueError:\n                 pass\n-        elif isinstance(srs_input, (int, long)):\n+        elif isinstance(srs_input, six.integer_types):\n             # EPSG integer code was input.\n             srs_type = 'epsg'\n         elif isinstance(srs_input, self.ptr_type):\n@@ -97,8 +99,8 @@ def __del__(self):\n \n     def __getitem__(self, target):\n         \"\"\"\n-        Returns the value of the given string attribute node, None if the node \n-        doesn't exist.  Can also take a tuple as a parameter, (target, child), \n+        Returns the value of the given string attribute node, None if the node\n+        doesn't exist.  Can also take a tuple as a parameter, (target, child),\n         where child is the index of the attribute in the WKT.  For example:\n \n         >>> wkt = 'GEOGCS[\"WGS 84\", DATUM[\"WGS_1984, ... AUTHORITY[\"EPSG\",\"4326\"]]')\n@@ -133,14 +135,14 @@ def attr_value(self, target, index=0):\n         The attribute value for the given target node (e.g. 'PROJCS'). The index\n         keyword specifies an index of the child node to return.\n         \"\"\"\n-        if not isinstance(target, basestring) or not isinstance(index, int):\n+        if not isinstance(target, six.string_types) or not isinstance(index, int):\n             raise TypeError\n         return capi.get_attr_value(self.ptr, target, index)\n \n     def auth_name(self, target):\n         \"Returns the authority name for the given string target node.\"\n         return capi.get_auth_name(self.ptr, target)\n-    \n+\n     def auth_code(self, target):\n         \"Returns the authority code for the given string target node.\"\n         return capi.get_auth_code(self.ptr, target)\n@@ -167,7 +169,7 @@ def to_esri(self):\n     def validate(self):\n         \"Checks to see if the given spatial reference is valid.\"\n         capi.srs_validate(self.ptr)\n-    \n+\n     #### Name & SRID properties ####\n     @property\n     def name(self):\n@@ -184,7 +186,7 @@ def srid(self):\n             return int(self.attr_value('AUTHORITY', 1))\n         except (TypeError, ValueError):\n             return None\n-        \n+\n     #### Unit Properties ####\n     @property\n     def linear_name(self):\n@@ -213,7 +215,7 @@ def angular_units(self):\n     @property\n     def units(self):\n         \"\"\"\n-        Returns a 2-tuple of the units value and the units name, \n+        Returns a 2-tuple of the units value and the units name,\n         and will automatically determines whether to return the linear\n         or angular units.\n         \"\"\"\n@@ -252,7 +254,7 @@ def inverse_flattening(self):\n     @property\n     def geographic(self):\n         \"\"\"\n-        Returns True if this SpatialReference is geographic \n+        Returns True if this SpatialReference is geographic\n          (root node is GEOGCS).\n         \"\"\"\n         return bool(capi.isgeographic(self.ptr))\n@@ -265,7 +267,7 @@ def local(self):\n     @property\n     def projected(self):\n         \"\"\"\n-        Returns True if this SpatialReference is a projected coordinate system \n+        Returns True if this SpatialReference is a projected coordinate system\n          (root node is PROJCS).\n         \"\"\"\n         return bool(capi.isprojected(self.ptr))"
        },
        {
            "sha": "a0b2593605eee6a7216a9c9d78f4f21190618b72",
            "filename": "django/contrib/gis/gdal/tests/test_geom.py",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,13 +1,13 @@\n from binascii import b2a_hex\n try:\n-    import cPickle as pickle\n+    from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n \n from django.contrib.gis.gdal import (OGRGeometry, OGRGeomType, OGRException,\n     OGRIndexError, SpatialReference, CoordTransform, GDAL_VERSION)\n-from django.contrib.gis.gdal.prototypes.geom import GEOJSON\n from django.contrib.gis.geometry.test_data import TestDataMixin\n+from django.utils.six.moves import xrange\n from django.utils import unittest\n \n class OGRGeomTest(unittest.TestCase, TestDataMixin):\n@@ -108,7 +108,6 @@ def test01d_wkb(self):\n \n     def test01e_json(self):\n         \"Testing GeoJSON input/output.\"\n-        if not GEOJSON: return\n         for g in self.geometries.json_geoms:\n             geom = OGRGeometry(g.wkt)\n             if not hasattr(g, 'not_equal'):\n@@ -244,9 +243,6 @@ def test07b_closepolygons(self):\n             self.fail('Should have raised an OGRException!')\n         print(\"\\nEND - expecting IllegalArgumentException; safe to ignore.\\n\")\n \n-        # Closing the rings -- doesn't work on GDAL versions 1.4.1 and below:\n-        # http://trac.osgeo.org/gdal/ticket/1673\n-        if GDAL_VERSION <= (1, 4, 1): return\n         poly.close_rings()\n         self.assertEqual(10, poly.point_count) # Two closing points should've been added\n         self.assertEqual(OGRGeometry('POINT(2.5 2.5)'), poly.centroid)"
        },
        {
            "sha": "944240c811c5351dbafcb985fb1543d56684fea7",
            "filename": "django/contrib/gis/geoip/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeoip%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeoip%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeoip%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,8 @@\n     GeoIP_country_code_by_addr, GeoIP_country_code_by_name,\n     GeoIP_country_name_by_addr, GeoIP_country_name_by_name)\n \n+from django.utils import six\n+\n # Regular expressions for recognizing the GeoIP free database editions.\n free_regex = re.compile(r'^GEO-\\d{3}FREE')\n lite_regex = re.compile(r'^GEO-\\d{3}LITE')\n@@ -86,7 +88,7 @@ def __init__(self, path=None, cache=0, country=None, city=None):\n         if not path:\n             path = GEOIP_SETTINGS.get('GEOIP_PATH', None)\n             if not path: raise GeoIPException('GeoIP path must be provided via parameter or the GEOIP_PATH setting.')\n-        if not isinstance(path, basestring):\n+        if not isinstance(path, six.string_types):\n             raise TypeError('Invalid path type: %s' % type(path).__name__)\n \n         if os.path.isdir(path):\n@@ -129,7 +131,7 @@ def __del__(self):\n     def _check_query(self, query, country=False, city=False, city_or_country=False):\n         \"Helper routine for checking the query and database availability.\"\n         # Making sure a string was passed in for the query.\n-        if not isinstance(query, basestring):\n+        if not isinstance(query, six.string_types):\n             raise TypeError('GeoIP query must be a string, not type %s' % type(query).__name__)\n \n         # GeoIP only takes ASCII-encoded strings."
        },
        {
            "sha": "e53230d9ad98a7442417f64b8dadb69cf7050bdc",
            "filename": "django/contrib/gis/geoip/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeoip%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeoip%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeoip%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,6 +6,8 @@\n from django.contrib.gis.geoip import GeoIP, GeoIPException\n from django.utils import unittest\n \n+from django.utils import six\n+\n # Note: Requires use of both the GeoIP country and city datasets.\n # The GEOIP_DATA path should be the only setting set (the directory\n # should contain links or the actual database files 'GeoIP.dat' and\n@@ -35,7 +37,7 @@ def test01_init(self):\n         bad_params = (23, 'foo', 15.23)\n         for bad in bad_params:\n             self.assertRaises(GeoIPException, GeoIP, cache=bad)\n-            if isinstance(bad, basestring):\n+            if isinstance(bad, six.string_types):\n                 e = GeoIPException\n             else:\n                 e = TypeError"
        },
        {
            "sha": "fd2693ed59dd5cc994ab10cc526971dabfb8bec9",
            "filename": "django/contrib/gis/geos/base.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,7 +10,6 @@\n     # A 'dummy' gdal module.\n     class GDALInfo(object):\n         HAS_GDAL = False\n-        GEOJSON = False\n     gdal = GDALInfo()\n \n # NumPy supported?"
        },
        {
            "sha": "2b62bce22c587d61e7b6c2382f4a8d72a984b120",
            "filename": "django/contrib/gis/geos/collections.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fcollections.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fcollections.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fcollections.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,7 @@\n from django.contrib.gis.geos.point import Point\n from django.contrib.gis.geos.polygon import Polygon\n from django.contrib.gis.geos import prototypes as capi\n+from django.utils.six.moves import xrange\n \n class GeometryCollection(GEOSGeometry):\n     _typeid = 7\n@@ -100,11 +101,11 @@ class MultiLineString(GeometryCollection):\n \n     @property\n     def merged(self):\n-        \"\"\" \n-        Returns a LineString representing the line merge of this \n+        \"\"\"\n+        Returns a LineString representing the line merge of this\n         MultiLineString.\n-        \"\"\" \n-        return self._topology(capi.geos_linemerge(self.ptr))         \n+        \"\"\"\n+        return self._topology(capi.geos_linemerge(self.ptr))\n \n class MultiPolygon(GeometryCollection):\n     _allowed = Polygon"
        },
        {
            "sha": "acf34f7262783ef4e05b1d090399fbf6d92624ac",
            "filename": "django/contrib/gis/geos/coordseq.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fcoordseq.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fcoordseq.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fcoordseq.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,6 +8,7 @@\n from django.contrib.gis.geos.error import GEOSException, GEOSIndexError\n from django.contrib.gis.geos.libgeos import CS_PTR\n from django.contrib.gis.geos import prototypes as capi\n+from django.utils.six.moves import xrange\n \n class GEOSCoordSeq(GEOSBase):\n     \"The internal representation of a list of coordinates inside a Geometry.\""
        },
        {
            "sha": "fbd7d5a3e939f310e7ed64586b35bb692e5b7e62",
            "filename": "django/contrib/gis/geos/factory.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ffactory.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,12 +1,14 @@\n from django.contrib.gis.geos.geometry import GEOSGeometry, wkt_regex, hex_regex\n \n+from django.utils import six\n+\n def fromfile(file_h):\n     \"\"\"\n     Given a string file name, returns a GEOSGeometry. The file may contain WKB,\n     WKT, or HEX.\n     \"\"\"\n     # If given a file name, get a real handle.\n-    if isinstance(file_h, basestring): \n+    if isinstance(file_h, six.string_types):\n         with open(file_h, 'rb') as file_h:\n             buf = file_h.read()\n     else:"
        },
        {
            "sha": "4e5409de1dd291598437c2ca1ee5c72ba6f5fcab",
            "filename": "django/contrib/gis/geos/geometry.py",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fgeometry.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fgeometry.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fgeometry.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -27,6 +27,8 @@\n # For recognizing geometry input.\n from django.contrib.gis.geometry.regex import hex_regex, wkt_regex, json_regex\n \n+from django.utils import six\n+\n class GEOSGeometry(GEOSBase, ListMixin):\n     \"A class that, generally, encapsulates a GEOS geometry.\"\n \n@@ -52,8 +54,8 @@ def __init__(self, geo_input, srid=None):\n         The `srid` keyword is used to specify the Source Reference Identifier\n         (SRID) number for this Geometry.  If not set, the SRID will be None.\n         \"\"\"\n-        if isinstance(geo_input, basestring):\n-            if isinstance(geo_input, unicode):\n+        if isinstance(geo_input, six.string_types):\n+            if isinstance(geo_input, six.text_type):\n                 # Encoding to ASCII, WKT or HEXEWKB doesn't need any more.\n                 geo_input = geo_input.encode('ascii')\n \n@@ -65,7 +67,7 @@ def __init__(self, geo_input, srid=None):\n             elif hex_regex.match(geo_input):\n                 # Handling HEXEWKB input.\n                 g = wkb_r().read(geo_input)\n-            elif gdal.GEOJSON and json_regex.match(geo_input):\n+            elif gdal.HAS_GDAL and json_regex.match(geo_input):\n                 # Handling GeoJSON input.\n                 g = wkb_r().read(gdal.OGRGeometry(geo_input).wkb)\n             else:\n@@ -153,7 +155,7 @@ def __eq__(self, other):\n         Equivalence testing, a Geometry may be compared with another Geometry\n         or a WKT representation.\n         \"\"\"\n-        if isinstance(other, basestring):\n+        if isinstance(other, six.string_types):\n             return self.wkt == other\n         elif isinstance(other, GEOSGeometry):\n             return self.equals_exact(other)\n@@ -333,7 +335,7 @@ def relate_pattern(self, other, pattern):\n         Returns true if the elements in the DE-9IM intersection matrix for the\n         two Geometries match the elements in pattern.\n         \"\"\"\n-        if not isinstance(pattern, basestring) or len(pattern) > 9:\n+        if not isinstance(pattern, six.string_types) or len(pattern) > 9:\n             raise GEOSException('invalid intersection matrix pattern')\n         return capi.geos_relatepattern(self.ptr, other.ptr, pattern)\n \n@@ -409,13 +411,12 @@ def hexewkb(self):\n     @property\n     def json(self):\n         \"\"\"\n-        Returns GeoJSON representation of this Geometry if GDAL 1.5+\n-        is installed.\n+        Returns GeoJSON representation of this Geometry if GDAL is installed.\n         \"\"\"\n-        if gdal.GEOJSON:\n+        if gdal.HAS_GDAL:\n             return self.ogr.json\n         else:\n-            raise GEOSException('GeoJSON output only supported on GDAL 1.5+.')\n+            raise GEOSException('GeoJSON output only supported when GDAL is installed.')\n     geojson = json\n \n     @property"
        },
        {
            "sha": "4784ea7c2dd0217f6e91f8aa62f8aead78f471ab",
            "filename": "django/contrib/gis/geos/linestring.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Flinestring.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Flinestring.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Flinestring.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,6 +4,7 @@\n from django.contrib.gis.geos.geometry import GEOSGeometry\n from django.contrib.gis.geos.point import Point\n from django.contrib.gis.geos import prototypes as capi\n+from django.utils.six.moves import xrange\n \n class LineString(GEOSGeometry):\n     _init_func = capi.create_linestring\n@@ -128,7 +129,7 @@ def array(self):\n     @property\n     def merged(self):\n         \"Returns the line merge of this LineString.\"\n-        return self._topology(capi.geos_linemerge(self.ptr))   \n+        return self._topology(capi.geos_linemerge(self.ptr))\n \n     @property\n     def x(self):"
        },
        {
            "sha": "69e50e6b3fb09dc0bd4f3294bb6b0bbc6d5f6989",
            "filename": "django/contrib/gis/geos/mutable_list.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fmutable_list.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,6 +9,8 @@\n Author: Aryeh Leib Taurog.\n \"\"\"\n from django.utils.functional import total_ordering\n+from django.utils import six\n+from django.utils.six.moves import xrange\n \n @total_ordering\n class ListMixin(object):\n@@ -82,12 +84,12 @@ def __getitem__(self, index):\n \n     def __delitem__(self, index):\n         \"Delete the item(s) at the specified index/slice.\"\n-        if not isinstance(index, (int, long, slice)):\n+        if not isinstance(index, six.integer_types + (slice,)):\n             raise TypeError(\"%s is not a legal index\" % index)\n \n         # calculate new length and dimensions\n         origLen     = len(self)\n-        if isinstance(index, (int, long)):\n+        if isinstance(index, six.integer_types):\n             index = self._checkindex(index)\n             indexRange  = [index]\n         else:\n@@ -195,7 +197,7 @@ def extend(self, vals):\n \n     def insert(self, index, val):\n         \"Standard list insert method\"\n-        if not isinstance(index, (int, long)):\n+        if not isinstance(index, six.integer_types):\n             raise TypeError(\"%s is not a legal index\" % index)\n         self[index:index] = [val]\n "
        },
        {
            "sha": "907347dbf83b1e44a7a6b03e4126c6c6bddcdc73",
            "filename": "django/contrib/gis/geos/point.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fpoint.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fpoint.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fpoint.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,8 @@\n from django.contrib.gis.geos.error import GEOSException\n from django.contrib.gis.geos.geometry import GEOSGeometry\n from django.contrib.gis.geos import prototypes as capi\n+from django.utils import six\n+from django.utils.six.moves import xrange\n \n class Point(GEOSGeometry):\n     _minlength = 2\n@@ -20,9 +22,9 @@ def __init__(self, x, y=None, z=None, srid=None):\n             # Here a tuple or list was passed in under the `x` parameter.\n             ndim = len(x)\n             coords = x\n-        elif isinstance(x, (int, float, long)) and isinstance(y, (int, float, long)):\n+        elif isinstance(x, six.integer_types + (float,)) and isinstance(y, six.integer_types + (float,)):\n             # Here X, Y, and (optionally) Z were passed in individually, as parameters.\n-            if isinstance(z, (int, float, long)):\n+            if isinstance(z, six.integer_types + (float,)):\n                 ndim = 3\n                 coords = [x, y, z]\n             else:"
        },
        {
            "sha": "c50f549e7a7338320a4a0b5208b8f82aa2ac8cae",
            "filename": "django/contrib/gis/geos/polygon.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fpolygon.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fpolygon.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fpolygon.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,6 +3,8 @@\n from django.contrib.gis.geos.libgeos import get_pointer_arr, GEOM_PTR\n from django.contrib.gis.geos.linestring import LinearRing\n from django.contrib.gis.geos import prototypes as capi\n+from django.utils import six\n+from django.utils.six.moves import xrange\n \n class Polygon(GEOSGeometry):\n     _minlength = 1\n@@ -56,7 +58,7 @@ def from_bbox(cls, bbox):\n         \"Constructs a Polygon from a bounding box (4-tuple).\"\n         x0, y0, x1, y1 = bbox\n         for z in bbox:\n-            if not isinstance(z, (int, long, float)):\n+            if not isinstance(z, six.integer_types + (float,)):\n                 return GEOSGeometry('POLYGON((%s %s, %s %s, %s %s, %s %s, %s %s))' %\n                                     (x0, y0, x0, y1, x1, y1, x1, y0, x0, y0))\n         return Polygon(((x0, y0), (x0, y1), (x1, y1), (x1, y0), (x0, y0)))"
        },
        {
            "sha": "053b9948a289a683d7da9db2a8052b0f70063cab",
            "filename": "django/contrib/gis/geos/prototypes/io.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fio.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fio.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fio.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,6 +6,8 @@\n from django.contrib.gis.geos.prototypes.geom import c_uchar_p, geos_char_p\n from django.contrib.gis.geos.prototypes.threadsafe import GEOSFunc\n \n+from django.utils import six\n+\n ### The WKB/WKT Reader/Writer structures and pointers ###\n class WKTReader_st(Structure): pass\n class WKTWriter_st(Structure): pass\n@@ -118,7 +120,7 @@ class _WKTReader(IOBase):\n     ptr_type = WKT_READ_PTR\n \n     def read(self, wkt):\n-        if not isinstance(wkt, basestring): raise TypeError\n+        if not isinstance(wkt, six.string_types): raise TypeError\n         return wkt_reader_read(self.ptr, wkt)\n \n class _WKBReader(IOBase):\n@@ -131,7 +133,7 @@ def read(self, wkb):\n         if isinstance(wkb, buffer):\n             wkb_s = str(wkb)\n             return wkb_reader_read(self.ptr, wkb_s, len(wkb_s))\n-        elif isinstance(wkb, basestring):\n+        elif isinstance(wkb, six.string_types):\n             return wkb_reader_read_hex(self.ptr, wkb, len(wkb))\n         else:\n             raise TypeError\n@@ -195,7 +197,7 @@ def _set_include_srid(self, include):\n # `ThreadLocalIO` object holds instances of the WKT and WKB reader/writer\n # objects that are local to the thread.  The `GEOSGeometry` internals\n # access these instances by calling the module-level functions, defined\n-# below. \n+# below.\n class ThreadLocalIO(threading.local):\n     wkt_r = None\n     wkt_w = None"
        },
        {
            "sha": "5a9b5555ada0f3edfc2e5afb7f9621f432365dbd",
            "filename": "django/contrib/gis/geos/prototypes/misc.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fmisc.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fmisc.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Fprototypes%2Fmisc.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,7 @@\n from django.contrib.gis.geos.prototypes.errcheck import check_dbl, check_string\n from django.contrib.gis.geos.prototypes.geom import geos_char_p\n from django.contrib.gis.geos.prototypes.threadsafe import GEOSFunc\n+from django.utils.six.moves import xrange\n \n __all__ = ['geos_area', 'geos_distance', 'geos_length']\n "
        },
        {
            "sha": "d621c6b4d408a5f9014a8132697cd77262c781a7",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,6 +8,8 @@\n from django.contrib.gis.geos.libgeos import GEOS_PREPARE\n from django.contrib.gis.geometry.test_data import TestDataMixin\n \n+from django.utils import six\n+from django.utils.six.moves import xrange\n from django.utils import unittest\n \n \n@@ -196,7 +198,7 @@ def test_ewkt(self):\n                 self.assertEqual(srid, poly.shell.srid)\n                 self.assertEqual(srid, fromstr(poly.ewkt).srid) # Checking export\n \n-    @unittest.skipUnless(gdal.HAS_GDAL and gdal.GEOJSON, \"gdal >= 1.5 is required\")\n+    @unittest.skipUnless(gdal.HAS_GDAL, \"gdal is required\")\n     def test_json(self):\n         \"Testing GeoJSON input/output (via GDAL).\"\n         for g in self.geometries.json_geoms:\n@@ -951,7 +953,8 @@ def test_extent(self):\n     def test_pickle(self):\n         \"Testing pickling and unpickling support.\"\n         # Using both pickle and cPickle -- just 'cause.\n-        import pickle, cPickle\n+        from django.utils.six.moves import cPickle\n+        import pickle\n \n         # Creating a list of test geometries for pickling,\n         # and setting the SRID on some of them.\n@@ -1004,15 +1007,15 @@ def test_valid_reason(self):\n \n         g = GEOSGeometry(\"POINT(0 0)\")\n         self.assertTrue(g.valid)\n-        self.assertTrue(isinstance(g.valid_reason, basestring))\n+        self.assertTrue(isinstance(g.valid_reason, six.string_types))\n         self.assertEqual(g.valid_reason, \"Valid Geometry\")\n \n         print(\"\\nBEGIN - expecting GEOS_NOTICE; safe to ignore.\\n\")\n \n         g = GEOSGeometry(\"LINESTRING(0 0, 0 0)\")\n \n         self.assertTrue(not g.valid)\n-        self.assertTrue(isinstance(g.valid_reason, basestring))\n+        self.assertTrue(isinstance(g.valid_reason, six.string_types))\n         self.assertTrue(g.valid_reason.startswith(\"Too few points in geometry component\"))\n \n         print(\"\\nEND - expecting GEOS_NOTICE; safe to ignore.\\n\")"
        },
        {
            "sha": "ebf178a80702177050c4350fc4055bec2765a219",
            "filename": "django/contrib/gis/geos/tests/test_io.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_io.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_io.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_io.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,7 @@\n import binascii\n import unittest\n from django.contrib.gis.geos import GEOSGeometry, WKTReader, WKTWriter, WKBReader, WKBWriter, geos_version_info\n+from django.utils import six\n \n class GEOSIOTest(unittest.TestCase):\n \n@@ -12,12 +13,12 @@ def test01_wktreader(self):\n         # read() should return a GEOSGeometry\n         ref = GEOSGeometry(wkt)\n         g1 = wkt_r.read(wkt)\n-        g2 = wkt_r.read(unicode(wkt))\n+        g2 = wkt_r.read(six.text_type(wkt))\n \n         for geom in (g1, g2):\n             self.assertEqual(ref, geom)\n \n-        # Should only accept basestring objects.\n+        # Should only accept six.string_types objects.\n         self.assertRaises(TypeError, wkt_r.read, 1)\n         self.assertRaises(TypeError, wkt_r.read, buffer('foo'))\n \n@@ -48,7 +49,7 @@ def test03_wkbreader(self):\n         bad_input = (1, 5.23, None, False)\n         for bad_wkb in bad_input:\n             self.assertRaises(TypeError, wkb_r.read, bad_wkb)\n-        \n+\n     def test04_wkbwriter(self):\n         wkb_w = WKBWriter()\n \n@@ -67,7 +68,7 @@ def test04_wkbwriter(self):\n         for bad_byteorder in (-1, 2, 523, 'foo', None):\n             # Equivalent of `wkb_w.byteorder = bad_byteorder`\n             self.assertRaises(ValueError, wkb_w._set_byteorder, bad_byteorder)\n-            \n+\n         # Setting the byteorder to 0 (for Big Endian)\n         wkb_w.byteorder = 0\n         self.assertEqual(hex2, wkb_w.write_hex(g))\n@@ -79,7 +80,7 @@ def test04_wkbwriter(self):\n         # Now, trying out the 3D and SRID flags.\n         g = GEOSGeometry('POINT (5 23 17)')\n         g.srid = 4326\n-        \n+\n         hex3d = '0101000080000000000000144000000000000037400000000000003140'\n         wkb3d = buffer(binascii.a2b_hex(hex3d))\n         hex3d_srid = '01010000A0E6100000000000000000144000000000000037400000000000003140'"
        },
        {
            "sha": "cd174d7cfa3bb763e92bb10f64bac19f82a10f44",
            "filename": "django/contrib/gis/geos/tests/test_mutable_list.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_mutable_list.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,6 +4,7 @@\n # Modified from original contribution by Aryeh Leib Taurog, which was\n # released under the New BSD license.\n from django.contrib.gis.geos.mutable_list import ListMixin\n+from django.utils import six\n from django.utils import unittest\n \n \n@@ -267,7 +268,7 @@ def removefcn(x, v): return x.remove(v)\n     def test07_allowed_types(self):\n         'Type-restricted list'\n         pl, ul = self.lists_of_len()\n-        ul._allowed = (int, long)\n+        ul._allowed = six.integer_types\n         ul[1] = 50\n         ul[:2] = [60, 70, 80]\n         def setfcn(x, i, v): x[i] = v"
        },
        {
            "sha": "75b285ca76b483c9355f60bd86956287925597f2",
            "filename": "django/contrib/gis/maps/google/gmap.py",
            "status": "modified",
            "additions": 11,
            "deletions": 8,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fgmap.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fgmap.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fgmap.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,8 @@\n from django.conf import settings\n from django.template.loader import render_to_string\n+from django.utils.html import format_html\n from django.utils.safestring import mark_safe\n+from django.utils.six.moves import xrange\n \n from django.contrib.gis.maps.google.overlays import GPolygon, GPolyline, GMarker\n \n@@ -10,7 +12,7 @@ class GoogleMapException(Exception):\n \n # The default Google Maps URL (for the API javascript)\n # TODO: Internationalize for Japan, UK, etc.\n-GOOGLE_MAPS_URL='http://maps.google.com/maps?file=api&amp;v=%s&amp;key='\n+GOOGLE_MAPS_URL='http://maps.google.com/maps?file=api&v=%s&key='\n \n \n class GoogleMap(object):\n@@ -48,7 +50,7 @@ def __init__(self, key=None, api_url=None, version=None,\n \n         # Can specify the API URL in the `api_url` keyword.\n         if not api_url:\n-            self.api_url = mark_safe(getattr(settings, 'GOOGLE_MAPS_URL', GOOGLE_MAPS_URL) % self.version)\n+            self.api_url = getattr(settings, 'GOOGLE_MAPS_URL', GOOGLE_MAPS_URL) % self.version\n         else:\n             self.api_url = api_url\n \n@@ -111,17 +113,18 @@ def render(self):\n     @property\n     def body(self):\n         \"Returns HTML body tag for loading and unloading Google Maps javascript.\"\n-        return mark_safe('<body %s %s>' % (self.onload, self.onunload))\n+        return format_html('<body {0} {1}>', self.onload, self.onunload)\n \n     @property\n     def onload(self):\n         \"Returns the `onload` HTML <body> attribute.\"\n-        return mark_safe('onload=\"%s.%s_load()\"' % (self.js_module, self.dom_id))\n+        return format_html('onload=\"{0}.{1}_load()\"', self.js_module, self.dom_id)\n \n     @property\n     def api_script(self):\n         \"Returns the <script> tag for the Google Maps API javascript.\"\n-        return mark_safe('<script src=\"%s%s\" type=\"text/javascript\"></script>' % (self.api_url, self.key))\n+        return format_html('<script src=\"{0}{1}\" type=\"text/javascript\"></script>',\n+                           self.api_url, self.key)\n \n     @property\n     def js(self):\n@@ -131,17 +134,17 @@ def js(self):\n     @property\n     def scripts(self):\n         \"Returns all <script></script> tags required with Google Maps JavaScript.\"\n-        return mark_safe('%s\\n  <script type=\"text/javascript\">\\n//<![CDATA[\\n%s//]]>\\n  </script>' % (self.api_script, self.js))\n+        return format_html('%s\\n  <script type=\"text/javascript\">\\n//<![CDATA[\\n%s//]]>\\n  </script>', self.api_script, mark_safe(self.js))\n \n     @property\n     def style(self):\n         \"Returns additional CSS styling needed for Google Maps on IE.\"\n-        return mark_safe('<style type=\"text/css\">%s</style>' % self.vml_css)\n+        return format_html('<style type=\"text/css\">{0}</style>', self.vml_css)\n \n     @property\n     def xhtml(self):\n         \"Returns XHTML information needed for IE VML overlays.\"\n-        return mark_safe('<html xmlns=\"http://www.w3.org/1999/xhtml\" %s>' % self.xmlns)\n+        return format_html('<html xmlns=\"http://www.w3.org/1999/xhtml\" {0}>', self.xmlns)\n \n     @property\n     def icons(self):"
        },
        {
            "sha": "28603ac422744a0a82cb887dd46e60fbcaf0bb32",
            "filename": "django/contrib/gis/maps/google/overlays.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Foverlays.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,7 @@\n from django.contrib.gis.geos import fromstr, Point, LineString, LinearRing, Polygon\n from django.utils.functional import total_ordering\n from django.utils.safestring import mark_safe\n+from django.utils import six\n \n \n class GEvent(object):\n@@ -98,7 +99,7 @@ def __init__(self, poly,\n           fill_opacity:\n             The opacity of the polygon fill.  Defaults to 0.4.\n         \"\"\"\n-        if isinstance(poly, basestring): poly = fromstr(poly)\n+        if isinstance(poly, six.string_types): poly = fromstr(poly)\n         if isinstance(poly, (tuple, list)): poly = Polygon(poly)\n         if not isinstance(poly, Polygon):\n             raise TypeError('GPolygon may only initialize on GEOS Polygons.')\n@@ -148,7 +149,7 @@ def __init__(self, geom, color='#0000ff', weight=2, opacity=1):\n             The opacity of the polyline, between 0 and 1.  Defaults to 1.\n         \"\"\"\n         # If a GEOS geometry isn't passed in, try to contsruct one.\n-        if isinstance(geom, basestring): geom = fromstr(geom)\n+        if isinstance(geom, six.string_types): geom = fromstr(geom)\n         if isinstance(geom, (tuple, list)): geom = Polygon(geom)\n         # Generating the lat/lng coordinate pairs.\n         if isinstance(geom, (LineString, LinearRing)):\n@@ -239,9 +240,9 @@ def __eq__(self, other):\n \n     def __lt__(self, other):\n         return self.varname < other.varname\n-    \n+\n     def __hash__(self):\n-        # XOR with hash of GIcon type so that hash('varname') won't \n+        # XOR with hash of GIcon type so that hash('varname') won't\n         # equal hash(GIcon('varname')).\n         return hash(self.__class__) ^ hash(self.varname)\n \n@@ -278,7 +279,7 @@ def __init__(self, geom, title=None, draggable=False, icon=None):\n            Draggable option for GMarker, disabled by default.\n         \"\"\"\n         # If a GEOS geometry isn't passed in, try to construct one.\n-        if isinstance(geom, basestring): geom = fromstr(geom)\n+        if isinstance(geom, six.string_types): geom = fromstr(geom)\n         if isinstance(geom, (tuple, list)): geom = Point(geom)\n         if isinstance(geom, Point):\n             self.latlng = self.latlng_from_coords(geom.coords)"
        },
        {
            "sha": "c93cf4ef4865b485a1da42ef19c790701b1765bf",
            "filename": "django/contrib/gis/maps/google/zoom.py",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fzoom.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fzoom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmaps%2Fgoogle%2Fzoom.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,6 @@\n from django.contrib.gis.geos import GEOSGeometry, LinearRing, Polygon, Point\n from django.contrib.gis.maps.google.gmap import GoogleMapException\n+from django.utils.six.moves import xrange\n from math import pi, sin, log, exp, atan\n \n # Constants used for degree to radian conversion, and vice-versa.\n@@ -20,21 +21,21 @@ class GoogleZoom(object):\n \n     \"Google Maps Hacks\" may be found at http://safari.oreilly.com/0596101619\n     \"\"\"\n-    \n+\n     def __init__(self, num_zoom=19, tilesize=256):\n         \"Initializes the Google Zoom object.\"\n         # Google's tilesize is 256x256, square tiles are assumed.\n         self._tilesize = tilesize\n-        \n+\n         # The number of zoom levels\n         self._nzoom = num_zoom\n \n-        # Initializing arrays to hold the parameters for each one of the \n+        # Initializing arrays to hold the parameters for each one of the\n         # zoom levels.\n         self._degpp = [] # Degrees per pixel\n         self._radpp = [] # Radians per pixel\n         self._npix  = [] # 1/2 the number of pixels for a tile at the given zoom level\n-        \n+\n         # Incrementing through the zoom levels and populating the parameter arrays.\n         z = tilesize # The number of pixels per zoom level.\n         for i in xrange(num_zoom):\n@@ -70,9 +71,9 @@ def lonlat_to_pixel(self, lonlat, zoom):\n         # with with the number of degrees/pixel at the given zoom level.\n         px_x = round(npix + (lon * self._degpp[zoom]))\n \n-        # Creating the factor, and ensuring that 1 or -1 is not passed in as the \n+        # Creating the factor, and ensuring that 1 or -1 is not passed in as the\n         # base to the logarithm.  Here's why:\n-        #  if fac = -1, we'll get log(0) which is undefined; \n+        #  if fac = -1, we'll get log(0) which is undefined;\n         #  if fac =  1, our logarithm base will be divided by 0, also undefined.\n         fac = min(max(sin(DTOR * lat), -0.9999), 0.9999)\n \n@@ -98,7 +99,7 @@ def pixel_to_lonlat(self, px, zoom):\n \n         # Returning the longitude, latitude coordinate pair.\n         return (lon, lat)\n-    \n+\n     def tile(self, lonlat, zoom):\n         \"\"\"\n         Returns a Polygon  corresponding to the region represented by a fictional\n@@ -119,7 +120,7 @@ def tile(self, lonlat, zoom):\n \n         # Constructing the Polygon, representing the tile and returning.\n         return Polygon(LinearRing(ll, (ll[0], ur[1]), ur, (ur[0], ll[1]), ll), srid=4326)\n-        \n+\n     def get_zoom(self, geom):\n         \"Returns the optimal Zoom level for the given geometry.\"\n         # Checking the input type.\n@@ -139,10 +140,10 @@ def get_zoom(self, geom):\n             # When we span more than one tile, this is an approximately good\n             # zoom level.\n             if (env_w > tile_w) or (env_h > tile_h):\n-                if z == 0: \n+                if z == 0:\n                     raise GoogleMapException('Geometry width and height should not exceed that of the Earth.')\n                 return z-1\n-        \n+\n         # Otherwise, we've zoomed in to the max.\n         return self._nzoom-1\n "
        },
        {
            "sha": "ba7817e51c7bf866d298d74e4db0b65c53919ae9",
            "filename": "django/contrib/gis/measure.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmeasure.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -39,8 +39,9 @@\n from decimal import Decimal\n \n from django.utils.functional import total_ordering\n+from django.utils import six\n \n-NUMERIC_TYPES = (int, float, long, Decimal)\n+NUMERIC_TYPES = six.integer_types + (float, Decimal)\n AREA_PREFIX = \"sq_\"\n \n def pretty_name(obj):\n@@ -57,7 +58,7 @@ class MeasureBase(object):\n     def __init__(self, default_unit=None, **kwargs):\n         value, self._default_unit = self.default_units(kwargs)\n         setattr(self, self.STANDARD_UNIT, value)\n-        if default_unit and isinstance(default_unit, basestring):\n+        if default_unit and isinstance(default_unit, six.string_types):\n             self._default_unit = default_unit\n \n     def _get_standard(self):"
        },
        {
            "sha": "bcdbe734fff3e20afeffc22c4387e1c282f8f8f9",
            "filename": "django/contrib/gis/tests/geoapp/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -11,6 +11,7 @@\n     no_mysql, no_oracle, no_spatialite,\n     mysql, oracle, postgis, spatialite)\n from django.test import TestCase\n+from django.utils import six\n \n from .models import Country, City, PennsylvaniaCity, State, Track\n \n@@ -663,7 +664,7 @@ def test27_snap_to_grid(self):\n         # Let's try and break snap_to_grid() with bad combinations of arguments.\n         for bad_args in ((), range(3), range(5)):\n             self.assertRaises(ValueError, Country.objects.snap_to_grid, *bad_args)\n-        for bad_args in (('1.0',), (1.0, None), tuple(map(unicode, range(4)))):\n+        for bad_args in (('1.0',), (1.0, None), tuple(map(six.text_type, range(4)))):\n             self.assertRaises(TypeError, Country.objects.snap_to_grid, *bad_args)\n \n         # Boundary for San Marino, courtesy of Bjorn Sandvik of thematicmapping.org"
        },
        {
            "sha": "ed851df0d2a5de01984e9910970b82640f274c9f",
            "filename": "django/contrib/gis/tests/test_geoforms.py",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Ftests%2Ftest_geoforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Ftests%2Ftest_geoforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Ftest_geoforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -56,8 +56,25 @@ def test03_geom_type(self):\n \n         pnt_fld = forms.GeometryField(geom_type='POINT')\n         self.assertEqual(GEOSGeometry('POINT(5 23)'), pnt_fld.clean('POINT(5 23)'))\n+        # a WKT for any other geom_type will be properly transformed by `to_python`\n+        self.assertEqual(GEOSGeometry('LINESTRING(0 0, 1 1)'), pnt_fld.to_python('LINESTRING(0 0, 1 1)'))\n+        # but rejected by `clean`\n         self.assertRaises(forms.ValidationError, pnt_fld.clean, 'LINESTRING(0 0, 1 1)')\n \n+    def test04_to_python(self):\n+        \"\"\"\n+        Testing to_python returns a correct GEOSGeometry object or\n+        a ValidationError\n+        \"\"\"\n+        fld = forms.GeometryField()\n+        # to_python returns the same GEOSGeometry for a WKT\n+        for wkt in ('POINT(5 23)', 'MULTIPOLYGON(((0 0, 0 1, 1 1, 1 0, 0 0)))', 'LINESTRING(0 0, 1 1)'):\n+            self.assertEqual(GEOSGeometry(wkt), fld.to_python(wkt))\n+        # but raises a ValidationError for any other string\n+        for wkt in ('POINT(5)', 'MULTI   POLYGON(((0 0, 0 1, 1 1, 1 0, 0 0)))', 'BLAH(0 0, 1 1)'):\n+            self.assertRaises(forms.ValidationError, fld.to_python, wkt)\n+\n+\n def suite():\n     s = unittest.TestSuite()\n     s.addTest(unittest.makeSuite(GeometryFieldTest))"
        },
        {
            "sha": "e898f6de2eb1d24cddffb82f2bd05fcb242bcaab",
            "filename": "django/contrib/gis/utils/layermapping.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Flayermapping.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -17,6 +17,7 @@\n     OFTDate, OFTDateTime, OFTInteger, OFTReal, OFTString, OFTTime)\n from django.db import models, transaction\n from django.contrib.localflavor.us.models import USStateField\n+from django.utils import six\n \n # LayerMapping exceptions.\n class LayerMapError(Exception): pass\n@@ -74,7 +75,7 @@ def __init__(self, model, data, mapping, layer=0,\n         argument usage.\n         \"\"\"\n         # Getting the DataSource and the associated Layer.\n-        if isinstance(data, basestring):\n+        if isinstance(data, six.string_types):\n             self.ds = DataSource(data)\n         else:\n             self.ds = data\n@@ -249,7 +250,7 @@ def check_srs(self, source_srs):\n             sr = source_srs\n         elif isinstance(source_srs, self.spatial_backend.spatial_ref_sys()):\n             sr = source_srs.srs\n-        elif isinstance(source_srs, (int, basestring)):\n+        elif isinstance(source_srs, (int, six.string_types)):\n             sr = SpatialReference(source_srs)\n         else:\n             # Otherwise just pulling the SpatialReference from the layer\n@@ -266,7 +267,7 @@ def check_unique(self, unique):\n             # List of fields to determine uniqueness with\n             for attr in unique:\n                 if not attr in self.mapping: raise ValueError\n-        elif isinstance(unique, basestring):\n+        elif isinstance(unique, six.string_types):\n             # Only a single field passed in.\n             if unique not in self.mapping: raise ValueError\n         else:\n@@ -312,7 +313,7 @@ def unique_kwargs(self, kwargs):\n         will construct and return the uniqueness keyword arguments -- a subset\n         of the feature kwargs.\n         \"\"\"\n-        if isinstance(self.unique, basestring):\n+        if isinstance(self.unique, six.string_types):\n             return {self.unique : kwargs[self.unique]}\n         else:\n             return dict((fld, kwargs[fld]) for fld in self.unique)\n@@ -329,7 +330,7 @@ def verify_ogr_field(self, ogr_field, model_field):\n             if self.encoding:\n                 # The encoding for OGR data sources may be specified here\n                 # (e.g., 'cp437' for Census Bureau boundary files).\n-                val = unicode(ogr_field.value, self.encoding)\n+                val = six.text_type(ogr_field.value, self.encoding)\n             else:\n                 val = ogr_field.value\n                 if model_field.max_length and len(val) > model_field.max_length:"
        },
        {
            "sha": "f8977059d98a46a84baa3adfba5b3cfe13095527",
            "filename": "django/contrib/gis/utils/ogrinspect.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Fogrinspect.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,10 +5,11 @@\n \n Author: Travis Pinney, Dane Springmeyer, & Justin Bronn\n \"\"\"\n-from future_builtins import zip\n+from django.utils.six.moves import zip\n # Requires GDAL to use.\n from django.contrib.gis.gdal import DataSource\n from django.contrib.gis.gdal.field import OFTDate, OFTDateTime, OFTInteger, OFTReal, OFTString, OFTTime\n+from django.utils import six\n \n def mapping(data_source, geom_name='geom', layer_key=0, multi_geom=False):\n     \"\"\"\n@@ -24,7 +25,7 @@ def mapping(data_source, geom_name='geom', layer_key=0, multi_geom=False):\n \n      `multi_geom` => Boolean (default: False) - specify as multigeometry.\n     \"\"\"\n-    if isinstance(data_source, basestring):\n+    if isinstance(data_source, six.string_types):\n         # Instantiating the DataSource from the string.\n         data_source = DataSource(data_source)\n     elif isinstance(data_source, DataSource):"
        },
        {
            "sha": "d60eed31bd98353dc88d493258621920969dd063",
            "filename": "django/contrib/gis/utils/wkt.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Futils%2Fwkt.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fgis%2Futils%2Fwkt.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Futils%2Fwkt.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,9 +2,11 @@\n  Utilities for manipulating Geometry WKT.\n \"\"\"\n \n+from django.utils import six\n+\n def precision_wkt(geom, prec):\n     \"\"\"\n-    Returns WKT text of the geometry according to the given precision (an \n+    Returns WKT text of the geometry according to the given precision (an\n     integer or a string).  If the precision is an integer, then the decimal\n     places of coordinates WKT will be truncated to that number:\n \n@@ -14,12 +16,12 @@ def precision_wkt(geom, prec):\n      >>> precision(geom, 1)\n      'POINT (5.0 23.0)'\n \n-    If the precision is a string, it must be valid Python format string \n+    If the precision is a string, it must be valid Python format string\n     (e.g., '%20.7f') -- thus, you should know what you're doing.\n     \"\"\"\n     if isinstance(prec, int):\n         num_fmt = '%%.%df' % prec\n-    elif isinstance(prec, basestring):\n+    elif isinstance(prec, six.string_types):\n         num_fmt = prec\n     else:\n         raise TypeError"
        },
        {
            "sha": "8f6c2602c93ecb2ed6adcb0e28cdcbb586738f0d",
            "filename": "django/contrib/humanize/templatetags/humanize.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,6 @@\n from __future__ import unicode_literals\n import re\n-from datetime import date, datetime, timedelta\n+from datetime import date, datetime\n \n from django import template\n from django.conf import settings\n@@ -143,7 +143,9 @@ def apnumber(value):\n         return value\n     return (_('one'), _('two'), _('three'), _('four'), _('five'), _('six'), _('seven'), _('eight'), _('nine'))[value-1]\n \n-@register.filter\n+# Perform the comparison in the default time zone when USE_TZ = True\n+# (unless a specific time zone has been applied with the |timezone filter).\n+@register.filter(expects_localtime=True)\n def naturalday(value, arg=None):\n     \"\"\"\n     For date values that are tomorrow, today or yesterday compared to\n@@ -169,6 +171,8 @@ def naturalday(value, arg=None):\n         return _('yesterday')\n     return defaultfilters.date(value, arg)\n \n+# This filter doesn't require expects_localtime=True because it deals properly\n+# with both naive and aware datetimes. Therefore avoid the cost of conversion.\n @register.filter\n def naturaltime(value):\n     \"\"\"\n@@ -184,7 +188,7 @@ def naturaltime(value):\n         if delta.days != 0:\n             return pgettext(\n                 'naturaltime', '%(delta)s ago'\n-            ) % {'delta': defaultfilters.timesince(value)}\n+            ) % {'delta': defaultfilters.timesince(value, now)}\n         elif delta.seconds == 0:\n             return _('now')\n         elif delta.seconds < 60:\n@@ -206,7 +210,7 @@ def naturaltime(value):\n         if delta.days != 0:\n             return pgettext(\n                 'naturaltime', '%(delta)s from now'\n-            ) % {'delta': defaultfilters.timeuntil(value)}\n+            ) % {'delta': defaultfilters.timeuntil(value, now)}\n         elif delta.seconds == 0:\n             return _('now')\n         elif delta.seconds < 60:"
        },
        {
            "sha": "a0f13d3ee9418d8d46a62bfb456612e154a14998",
            "filename": "django/contrib/humanize/tests.py",
            "status": "modified",
            "additions": 47,
            "deletions": 31,
            "changes": 78,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fhumanize%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,13 +1,31 @@\n from __future__ import unicode_literals\n import datetime\n-import new\n \n+from django.contrib.humanize.templatetags import humanize\n from django.template import Template, Context, defaultfilters\n from django.test import TestCase\n-from django.utils import translation, tzinfo\n-from django.utils.translation import ugettext as _\n+from django.test.utils import override_settings\n from django.utils.html import escape\n from django.utils.timezone import utc\n+from django.utils import translation\n+from django.utils.translation import ugettext as _\n+from django.utils import tzinfo\n+\n+\n+# Mock out datetime in some tests so they don't fail occasionally when they\n+# run too slow. Use a fixed datetime for datetime.now(). DST change in\n+# America/Chicago (the default time zone) happened on March 11th in 2012.\n+\n+now = datetime.datetime(2012, 3, 9, 22, 30)\n+\n+class MockDateTime(datetime.datetime):\n+    @classmethod\n+    def now(self, tz=None):\n+        if tz is None or tz.utcoffset(now) is None:\n+            return now\n+        else:\n+            # equals now.replace(tzinfo=utc)\n+            return now.replace(tzinfo=tz) + tz.utcoffset(now)\n \n \n class HumanizeTests(TestCase):\n@@ -109,28 +127,36 @@ def test_naturalday(self):\n         self.humanize_tester(test_list, result_list, 'naturalday')\n \n     def test_naturalday_tz(self):\n-        from django.contrib.humanize.templatetags.humanize import naturalday\n-\n         today = datetime.date.today()\n         tz_one = tzinfo.FixedOffset(datetime.timedelta(hours=-12))\n         tz_two = tzinfo.FixedOffset(datetime.timedelta(hours=12))\n \n         # Can be today or yesterday\n         date_one = datetime.datetime(today.year, today.month, today.day, tzinfo=tz_one)\n-        naturalday_one = naturalday(date_one)\n+        naturalday_one = humanize.naturalday(date_one)\n         # Can be today or tomorrow\n         date_two = datetime.datetime(today.year, today.month, today.day, tzinfo=tz_two)\n-        naturalday_two = naturalday(date_two)\n+        naturalday_two = humanize.naturalday(date_two)\n \n         # As 24h of difference they will never be the same\n         self.assertNotEqual(naturalday_one, naturalday_two)\n \n+    def test_naturalday_uses_localtime(self):\n+        # Regression for #18504\n+        # This is 2012-03-08HT19:30:00-06:00 in Ameria/Chicago\n+        dt = datetime.datetime(2012, 3, 9, 1, 30, tzinfo=utc)\n+\n+        orig_humanize_datetime, humanize.datetime = humanize.datetime, MockDateTime\n+        try:\n+            with override_settings(USE_TZ=True):\n+                self.humanize_tester([dt], ['yesterday'], 'naturalday')\n+        finally:\n+            humanize.datetime = orig_humanize_datetime\n+\n     def test_naturaltime(self):\n         class naive(datetime.tzinfo):\n             def utcoffset(self, dt):\n                 return None\n-        # we're going to mock datetime.datetime, so use a fixed datetime\n-        now = datetime.datetime(2011, 8, 15)\n         test_list = [\n             now,\n             now - datetime.timedelta(seconds=1),\n@@ -148,6 +174,7 @@ def utcoffset(self, dt):\n             now + datetime.timedelta(hours=1, minutes=30, seconds=30),\n             now + datetime.timedelta(hours=23, minutes=50, seconds=50),\n             now + datetime.timedelta(days=1),\n+            now + datetime.timedelta(days=2, hours=6),\n             now + datetime.timedelta(days=500),\n             now.replace(tzinfo=naive()),\n             now.replace(tzinfo=utc),\n@@ -169,33 +196,22 @@ def utcoffset(self, dt):\n             'an hour from now',\n             '23 hours from now',\n             '1 day from now',\n+            '2 days, 6 hours from now',\n             '1 year, 4 months from now',\n             'now',\n             'now',\n         ]\n-\n-        # mock out datetime so these tests don't fail occasionally when the\n-        # test runs too slow\n-        class MockDateTime(datetime.datetime):\n-            @classmethod\n-            def now(self, tz=None):\n-                if tz is None or tz.utcoffset(now) is None:\n-                    return now\n-                else:\n-                    # equals now.replace(tzinfo=utc)\n-                    return now.replace(tzinfo=tz) + tz.utcoffset(now)\n-\n-        # naturaltime also calls timesince/timeuntil\n-        from django.contrib.humanize.templatetags import humanize\n-        from django.utils import timesince\n-        orig_humanize_datetime = humanize.datetime\n-        orig_timesince_datetime = timesince.datetime\n-        humanize.datetime = MockDateTime\n-        timesince.datetime = new.module(b\"mock_datetime\")\n-        timesince.datetime.datetime = MockDateTime\n-\n+        # Because of the DST change, 2 days and 6 hours after the chosen\n+        # date in naive arithmetic is only 2 days and 5 hours after in\n+        # aware arithmetic.\n+        result_list_with_tz_support = result_list[:]\n+        assert result_list_with_tz_support[-4] == '2 days, 6 hours from now'\n+        result_list_with_tz_support[-4] == '2 days, 5 hours from now'\n+\n+        orig_humanize_datetime, humanize.datetime = humanize.datetime, MockDateTime\n         try:\n             self.humanize_tester(test_list, result_list, 'naturaltime')\n+            with override_settings(USE_TZ=True):\n+                self.humanize_tester(test_list, result_list_with_tz_support, 'naturaltime')\n         finally:\n             humanize.datetime = orig_humanize_datetime\n-            timesince.datetime = orig_timesince_datetime"
        },
        {
            "sha": "dc4235f9dd3a62dfac84994d2a8ccb68291de369",
            "filename": "django/contrib/localflavor/ar/forms.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Far%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Far%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Far%2Fforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -81,6 +81,7 @@ class ARCUITField(RegexField):\n     default_error_messages = {\n         'invalid': _('Enter a valid CUIT in XX-XXXXXXXX-X or XXXXXXXXXXXX format.'),\n         'checksum': _(\"Invalid CUIT.\"),\n+        'legal_type': _('Invalid legal type. Type must be 27, 20, 23 or 30.'),\n     }\n \n     def __init__(self, max_length=None, min_length=None, *args, **kwargs):\n@@ -96,6 +97,8 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n         value, cd = self._canon(value)\n+        if not value[:2] in ['27', '20', '23', '30']:\n+            raise ValidationError(self.error_messages['legal_type'])\n         if self._calc_cd(value) != cd:\n             raise ValidationError(self.error_messages['checksum'])\n         return self._format(value, cd)\n@@ -105,9 +108,16 @@ def _canon(self, cuit):\n         return cuit[:-1], cuit[-1]\n \n     def _calc_cd(self, cuit):\n+        # Calculation code based on:\n+        # http://es.wikipedia.org/wiki/C%C3%B3digo_%C3%9Anico_de_Identificaci%C3%B3n_Tributaria\n         mults = (5, 4, 3, 2, 7, 6, 5, 4, 3, 2)\n         tmp = sum([m * int(cuit[idx]) for idx, m in enumerate(mults)])\n-        return str(11 - tmp % 11)\n+        result = 11 - (tmp % 11)\n+        if result == 11:\n+            result = 0\n+        elif result == 10:\n+            result = 9\n+        return str(result)\n \n     def _format(self, cuit, check_digit=None):\n         if check_digit == None:"
        },
        {
            "sha": "d836dd6397b0fed66a76e36f66a26454a78c694a",
            "filename": "django/contrib/localflavor/fr/forms.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Ffr%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Ffr%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Ffr%2Fforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,7 +8,7 @@\n from django.contrib.localflavor.fr.fr_department import DEPARTMENT_CHOICES\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n-from django.forms.fields import Field, RegexField, Select\n+from django.forms.fields import CharField, RegexField, Select\n from django.utils.encoding import smart_unicode\n from django.utils.translation import ugettext_lazy as _\n \n@@ -20,11 +20,11 @@ class FRZipCodeField(RegexField):\n         'invalid': _('Enter a zip code in the format XXXXX.'),\n     }\n \n-    def __init__(self, max_length=None, min_length=None, *args, **kwargs):\n+    def __init__(self, max_length=5, min_length=5, *args, **kwargs):\n         super(FRZipCodeField, self).__init__(r'^\\d{5}$',\n             max_length, min_length, *args, **kwargs)\n \n-class FRPhoneNumberField(Field):\n+class FRPhoneNumberField(CharField):\n     \"\"\"\n     Validate local French phone number (not international ones)\n     The correct format is '0X XX XX XX XX'.\n@@ -35,6 +35,10 @@ class FRPhoneNumberField(Field):\n         'invalid': _('Phone numbers must be in 0X XX XX XX XX format.'),\n     }\n \n+    def __init__(self, max_length=14, min_length=10, *args, **kwargs):\n+        super(FRPhoneNumberField, self).__init__(\n+            max_length, min_length, *args, **kwargs)\n+\n     def clean(self, value):\n         super(FRPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n@@ -51,4 +55,3 @@ class FRDepartmentSelect(Select):\n     \"\"\"\n     def __init__(self, attrs=None):\n         super(FRDepartmentSelect, self).__init__(attrs, choices=DEPARTMENT_CHOICES)\n-"
        },
        {
            "sha": "b42bf22b89045657a3b7c10537af607ae047e5a0",
            "filename": "django/contrib/localflavor/mx/forms.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Fmx%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Fmx%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fmx%2Fforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,7 @@\n \n from django.forms import ValidationError\n from django.forms.fields import Select, RegexField\n+from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n from django.core.validators import EMPTY_VALUES\n from django.contrib.localflavor.mx.mx_states import STATE_CHOICES\n@@ -147,15 +148,15 @@ def _checksum(self, rfc):\n         if len(rfc) == 11:\n             rfc = '-' + rfc\n \n-        sum_ = sum(i * chars.index(c) for i, c in zip(reversed(xrange(14)), rfc))\n+        sum_ = sum(i * chars.index(c) for i, c in zip(reversed(range(14)), rfc))\n         checksum = 11 - sum_ % 11\n \n         if checksum == 10:\n             return 'A'\n         elif checksum == 11:\n             return '0'\n \n-        return unicode(checksum)\n+        return six.text_type(checksum)\n \n     def _has_inconvenient_word(self, rfc):\n         first_four = rfc[:4]\n@@ -214,12 +215,12 @@ def clean(self, value):\n     def _checksum(self, value):\n         chars = '0123456789ABCDEFGHIJKLMN&OPQRSTUVWXYZ'\n \n-        s = sum(i * chars.index(c) for i, c in zip(reversed(xrange(19)), value))\n+        s = sum(i * chars.index(c) for i, c in zip(reversed(range(19)), value))\n         checksum = 10 - s % 10\n \n         if checksum == 10:\n             return '0'\n-        return unicode(checksum)\n+        return six.text_type(checksum)\n \n     def _has_inconvenient_word(self, curp):\n         first_four = curp[:4]"
        },
        {
            "sha": "783062ebb476db2dcf2b9f26dafbef4d435628d5",
            "filename": "django/contrib/localflavor/se/utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Fse%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Fse%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fse%2Futils.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,4 +1,5 @@\n import datetime\n+from django.utils import six\n \n def id_number_checksum(gd):\n     \"\"\"\n@@ -65,15 +66,15 @@ def validate_id_birthday(gd, fix_coordination_number_day=True):\n \n def format_personal_id_number(birth_day, gd):\n     # birth_day.strftime cannot be used, since it does not support dates < 1900\n-    return unicode(str(birth_day.year) + gd['month'] + gd['day'] + gd['serial'] + gd['checksum'])\n+    return six.text_type(str(birth_day.year) + gd['month'] + gd['day'] + gd['serial'] + gd['checksum'])\n \n def format_organisation_number(gd):\n     if gd['century'] is None:\n         century = ''\n     else:\n         century = gd['century']\n \n-    return unicode(century + gd['year'] + gd['month'] + gd['day'] + gd['serial'] + gd['checksum'])\n+    return six.text_type(century + gd['year'] + gd['month'] + gd['day'] + gd['serial'] + gd['checksum'])\n \n def valid_organisation(gd):\n     return gd['century'] in (None, 16) and \\"
        },
        {
            "sha": "15bc1f99bb0f0c009196f25ce1a844c2ffdd944b",
            "filename": "django/contrib/localflavor/tr/forms.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Ftr%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Flocalflavor%2Ftr%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Ftr%2Fforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -80,10 +80,10 @@ def clean(self, value):\n             raise ValidationError(self.error_messages['invalid'])\n         if int(value[0]) == 0:\n             raise ValidationError(self.error_messages['invalid'])\n-        chksum = (sum([int(value[i]) for i in xrange(0,9,2)])*7-\n-                          sum([int(value[i]) for i in xrange(1,9,2)])) % 10\n+        chksum = (sum([int(value[i]) for i in range(0, 9, 2)]) * 7 -\n+                          sum([int(value[i]) for i in range(1, 9, 2)])) % 10\n         if chksum != int(value[9]) or \\\n-           (sum([int(value[i]) for i in xrange(10)]) % 10) != int(value[10]):\n+           (sum([int(value[i]) for i in range(10)]) % 10) != int(value[10]):\n             raise ValidationError(self.error_messages['invalid'])\n         return value\n "
        },
        {
            "sha": "e9a67b05009aee35f945dbdfcf5069c525397386",
            "filename": "django/contrib/messages/tests/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Ftests%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -152,7 +152,7 @@ def test_full_request_response_cycle(self):\n         cycle.\n         \"\"\"\n         data = {\n-            'messages': ['Test message %d' % x for x in xrange(10)],\n+            'messages': ['Test message %d' % x for x in range(10)],\n         }\n         show_url = reverse('django.contrib.messages.tests.urls.show')\n         for level in ('debug', 'info', 'success', 'warning', 'error'):\n@@ -170,7 +170,7 @@ def test_full_request_response_cycle(self):\n     @override_settings(MESSAGE_LEVEL=constants.DEBUG)\n     def test_with_template_response(self):\n         data = {\n-            'messages': ['Test message %d' % x for x in xrange(10)],\n+            'messages': ['Test message %d' % x for x in range(10)],\n         }\n         show_url = reverse('django.contrib.messages.tests.urls.show_template_response')\n         for level in self.levels.keys():\n@@ -194,7 +194,7 @@ def test_multiple_posts(self):\n         before a GET.\n         \"\"\"\n         data = {\n-            'messages': ['Test message %d' % x for x in xrange(10)],\n+            'messages': ['Test message %d' % x for x in range(10)],\n         }\n         show_url = reverse('django.contrib.messages.tests.urls.show')\n         messages = []\n@@ -226,7 +226,7 @@ def test_middleware_disabled(self):\n         when one attempts to store a message.\n         \"\"\"\n         data = {\n-            'messages': ['Test message %d' % x for x in xrange(10)],\n+            'messages': ['Test message %d' % x for x in range(10)],\n         }\n         show_url = reverse('django.contrib.messages.tests.urls.show')\n         for level in ('debug', 'info', 'success', 'warning', 'error'):\n@@ -251,7 +251,7 @@ def test_middleware_disabled_fail_silently(self):\n         raised if 'fail_silently' = True\n         \"\"\"\n         data = {\n-            'messages': ['Test message %d' % x for x in xrange(10)],\n+            'messages': ['Test message %d' % x for x in range(10)],\n             'fail_silently': True,\n         }\n         show_url = reverse('django.contrib.messages.tests.urls.show')"
        },
        {
            "sha": "e0668ab6045b3bca80caaa935ddb8190615b03df",
            "filename": "django/contrib/messages/tests/cookie.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fmessages%2Ftests%2Fcookie.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fmessages%2Ftests%2Fcookie.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Ftests%2Fcookie.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -123,7 +123,7 @@ def test_json_encoder_decoder(self):\n             {\n                 'message': Message(constants.INFO, 'Test message'),\n                 'message_list': [Message(constants.INFO, 'message %s') \\\n-                                 for x in xrange(5)] + [{'another-message': \\\n+                                 for x in range(5)] + [{'another-message': \\\n                                  Message(constants.ERROR, 'error')}],\n             },\n             Message(constants.INFO, 'message %s'),"
        },
        {
            "sha": "153cde98302fec25fd63691c8f7e55d883d569c4",
            "filename": "django/contrib/sessions/backends/base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,7 +2,7 @@\n import time\n from datetime import datetime, timedelta\n try:\n-    import cPickle as pickle\n+    from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n "
        },
        {
            "sha": "b66123b915036a9791691866226c9540a91f610a",
            "filename": "django/contrib/sessions/backends/cache.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fcache.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,6 @@\n from django.contrib.sessions.backends.base import SessionBase, CreateError\n from django.core.cache import cache\n+from django.utils.six.moves import xrange\n \n KEY_PREFIX = \"django.contrib.sessions.cache\"\n "
        },
        {
            "sha": "41ba7af634a3d08936a99e99b2fc080f42441b7d",
            "filename": "django/contrib/sessions/backends/signed_cookies.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fbackends%2Fsigned_cookies.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fbackends%2Fsigned_cookies.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fsigned_cookies.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,5 @@\n try:\n-    import cPickle as pickle\n+    from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n "
        },
        {
            "sha": "9f65255f47f02af6de236f991359e899ba0215a8",
            "filename": "django/contrib/sessions/middleware.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fmiddleware.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Fmiddleware.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fmiddleware.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -33,11 +33,13 @@ def process_response(self, request, response):\n                     expires_time = time.time() + max_age\n                     expires = cookie_date(expires_time)\n                 # Save the session data and refresh the client cookie.\n-                request.session.save()\n-                response.set_cookie(settings.SESSION_COOKIE_NAME,\n-                        request.session.session_key, max_age=max_age,\n-                        expires=expires, domain=settings.SESSION_COOKIE_DOMAIN,\n-                        path=settings.SESSION_COOKIE_PATH,\n-                        secure=settings.SESSION_COOKIE_SECURE or None,\n-                        httponly=settings.SESSION_COOKIE_HTTPONLY or None)\n+                # Skip session save for 500 responses, refs #3881.\n+                if response.status_code != 500:\n+                    request.session.save()\n+                    response.set_cookie(settings.SESSION_COOKIE_NAME,\n+                            request.session.session_key, max_age=max_age,\n+                            expires=expires, domain=settings.SESSION_COOKIE_DOMAIN,\n+                            path=settings.SESSION_COOKIE_PATH,\n+                            secure=settings.SESSION_COOKIE_SECURE or None,\n+                            httponly=settings.SESSION_COOKIE_HTTPONLY or None)\n         return response"
        },
        {
            "sha": "328b085f1e8f5ce47c8c923a1c32c467557eca3e",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -409,6 +409,22 @@ def test_no_httponly_session_cookie(self):\n         self.assertNotIn('httponly',\n                          str(response.cookies[settings.SESSION_COOKIE_NAME]))\n \n+    def test_session_save_on_500(self):\n+        request = RequestFactory().get('/')\n+        response = HttpResponse('Horrible error')\n+        response.status_code = 500\n+        middleware = SessionMiddleware()\n+\n+        # Simulate a request the modifies the session\n+        middleware.process_request(request)\n+        request.session['hello'] = 'world'\n+\n+        # Handle the response through the middleware\n+        response = middleware.process_response(request, response)\n+\n+        # Check that the value wasn't saved above.\n+        self.assertNotIn('hello', request.session.load())\n+\n \n class CookieSessionTests(SessionTestsMixin, TestCase):\n "
        },
        {
            "sha": "7d03ef19f51cf378e78cc6232c676f4726d25ad1",
            "filename": "django/contrib/sitemaps/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsitemaps%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsitemaps%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,7 +1,11 @@\n from django.contrib.sites.models import Site\n from django.core import urlresolvers, paginator\n from django.core.exceptions import ImproperlyConfigured\n-import urllib\n+try:\n+    from urllib.parse import urlencode\n+    from urllib.request import urlopen\n+except ImportError:     # Python 2\n+    from urllib import urlencode, urlopen\n \n PING_URL = \"http://www.google.com/webmasters/tools/ping\"\n \n@@ -32,8 +36,8 @@ def ping_google(sitemap_url=None, ping_url=PING_URL):\n     from django.contrib.sites.models import Site\n     current_site = Site.objects.get_current()\n     url = \"http://%s%s\" % (current_site.domain, sitemap_url)\n-    params = urllib.urlencode({'sitemap':url})\n-    urllib.urlopen(\"%s?%s\" % (ping_url, params))\n+    params = urlencode({'sitemap':url})\n+    urlopen(\"%s?%s\" % (ping_url, params))\n \n class Sitemap(object):\n     # This limit is defined by Google. See the index documentation at"
        },
        {
            "sha": "e392cbf909ebe62e804dc02aa3e6677bd39c815c",
            "filename": "django/contrib/sitemaps/tests/generic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fgeneric.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,7 +1,9 @@\n from django.contrib.auth.models import User\n+from django.test.utils import override_settings\n \n from .base import SitemapTestsBase\n \n+@override_settings(ABSOLUTE_URL_OVERRIDES={})\n class GenericViewsSitemapTests(SitemapTestsBase):\n \n     def test_generic_sitemap(self):"
        },
        {
            "sha": "9067a0e75e1ea05cf26d5aab5e0baf12da3cfd5d",
            "filename": "django/contrib/staticfiles/handlers.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Fhandlers.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Fhandlers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fhandlers.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,9 @@\n-import urllib\n-from urlparse import urlparse\n+try:\n+    from urllib.parse import urlparse\n+    from urllib.request import url2pathname\n+except ImportError:     # Python 2\n+    from urllib import url2pathname\n+    from urlparse import urlparse\n \n from django.conf import settings\n from django.core.handlers.wsgi import WSGIHandler\n@@ -42,7 +46,7 @@ def file_path(self, url):\n         Returns the relative path to the media file on disk for the given URL.\n         \"\"\"\n         relative_url = url[len(self.base_url[2]):]\n-        return urllib.url2pathname(relative_url)\n+        return url2pathname(relative_url)\n \n     def serve(self, request):\n         \"\"\""
        },
        {
            "sha": "a0133e1c6a8db7e23293b1cb490b3677d0c9d96f",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 22,
            "deletions": 10,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,8 +3,11 @@\n import os\n import posixpath\n import re\n-from urllib import unquote\n-from urlparse import urlsplit, urlunsplit, urldefrag\n+try:\n+    from urllib.parse import unquote, urlsplit, urlunsplit, urldefrag\n+except ImportError:     # Python 2\n+    from urllib import unquote\n+    from urlparse import urlsplit, urlunsplit, urldefrag\n \n from django.conf import settings\n from django.core.cache import (get_cache, InvalidCacheBackendError,\n@@ -45,10 +48,11 @@ def path(self, name):\n \n \n class CachedFilesMixin(object):\n+    default_template = \"\"\"url(\"%s\")\"\"\"\n     patterns = (\n         (\"*.css\", (\n             br\"\"\"(url\\(['\"]{0,1}\\s*(.*?)[\"']{0,1}\\))\"\"\",\n-            br\"\"\"(@import\\s*[\"']\\s*(.*?)[\"'])\"\"\",\n+            (br\"\"\"(@import\\s*[\"']\\s*(.*?)[\"'])\"\"\", \"\"\"@import url(\"%s\")\"\"\"),\n         )),\n     )\n \n@@ -62,8 +66,12 @@ def __init__(self, *args, **kwargs):\n         self._patterns = SortedDict()\n         for extension, patterns in self.patterns:\n             for pattern in patterns:\n+                if isinstance(pattern, (tuple, list)):\n+                    pattern, template = pattern\n+                else:\n+                    template = self.default_template\n                 compiled = re.compile(pattern)\n-                self._patterns.setdefault(extension, []).append(compiled)\n+                self._patterns.setdefault(extension, []).append((compiled, template))\n \n     def file_hash(self, name, content=None):\n         \"\"\"\n@@ -140,10 +148,13 @@ def url(self, name, force=False):\n \n         return unquote(final_url)\n \n-    def url_converter(self, name):\n+    def url_converter(self, name, template=None):\n         \"\"\"\n         Returns the custom URL converter for the given file name.\n         \"\"\"\n+        if template is None:\n+            template = self.default_template\n+\n         def converter(matchobj):\n             \"\"\"\n             Converts the matched URL depending on the parent level (`..`)\n@@ -153,7 +164,7 @@ def converter(matchobj):\n             matched, url = matchobj.groups()\n             # Completely ignore http(s) prefixed URLs,\n             # fragments and data-uri URLs\n-            if url.startswith(('#', 'http:', 'https:', 'data:')):\n+            if url.startswith(('#', 'http:', 'https:', 'data:', '//')):\n                 return matched\n             name_parts = name.split(os.sep)\n             # Using posix normpath here to remove duplicates\n@@ -178,7 +189,8 @@ def converter(matchobj):\n             relative_url = '/'.join(url.split('/')[:-1] + file_name)\n \n             # Return the hashed version to the file\n-            return 'url(\"%s\")' % unquote(relative_url)\n+            return template % unquote(relative_url)\n+\n         return converter\n \n     def post_process(self, paths, dry_run=False, **options):\n@@ -228,10 +240,10 @@ def post_process(self, paths, dry_run=False, **options):\n \n                 # ..to apply each replacement pattern to the content\n                 if name in adjustable_paths:\n-                    content = original_file.read()\n-                    converter = self.url_converter(name)\n+                    content = original_file.read().decode(settings.FILE_CHARSET)\n                     for patterns in self._patterns.values():\n-                        for pattern in patterns:\n+                        for pattern, template in patterns:\n+                            converter = self.url_converter(name, template)\n                             content = pattern.sub(converter, content)\n                     if hashed_file_exists:\n                         self.delete(hashed_name)"
        },
        {
            "sha": "71339ea8cd43f6886619a3ea76c2c09716987609",
            "filename": "django/contrib/staticfiles/templatetags/staticfiles.py",
            "status": "modified",
            "additions": 27,
            "deletions": 3,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Ftemplatetags%2Fstaticfiles.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,13 +1,37 @@\n from django import template\n+from django.templatetags.static import StaticNode\n from django.contrib.staticfiles.storage import staticfiles_storage\n \n register = template.Library()\n \n \n-@register.simple_tag\n-def static(path):\n+class StaticFilesNode(StaticNode):\n+\n+    def url(self, context):\n+        path = self.path.resolve(context)\n+        return staticfiles_storage.url(path)\n+\n+\n+@register.tag('static')\n+def do_static(parser, token):\n     \"\"\"\n     A template tag that returns the URL to a file\n     using staticfiles' storage backend\n+\n+    Usage::\n+\n+        {% static path [as varname] %}\n+\n+    Examples::\n+\n+        {% static \"myapp/css/base.css\" %}\n+        {% static variable_with_path %}\n+        {% static \"myapp/css/base.css\" as admin_base_css %}\n+        {% static variable_with_path as varname %}\n+\n     \"\"\"\n-    return staticfiles_storage.url(path)\n+    return StaticFilesNode.handle_token(parser, token)\n+\n+\n+def static(path):\n+    return StaticNode.handle_simple(path)"
        },
        {
            "sha": "85459812ad488e8f63759d8db11c0a05c9e9a7a1",
            "filename": "django/contrib/staticfiles/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fstaticfiles%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,7 +5,10 @@\n \"\"\"\n import os\n import posixpath\n-import urllib\n+try:\n+    from urllib.parse import unquote\n+except ImportError:     # Python 2\n+    from urllib import unquote\n \n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n@@ -31,7 +34,7 @@ def serve(request, path, document_root=None, insecure=False, **kwargs):\n         raise ImproperlyConfigured(\"The staticfiles view can only be used in \"\n                                    \"debug mode or if the the --insecure \"\n                                    \"option of 'runserver' is used\")\n-    normalized_path = posixpath.normpath(urllib.unquote(path)).lstrip('/')\n+    normalized_path = posixpath.normpath(unquote(path)).lstrip('/')\n     absolute_path = finders.find(normalized_path)\n     if not absolute_path:\n         if path.endswith('/') or path == '':"
        },
        {
            "sha": "3c84f1f60c7caae9afd059a8605bfb44f5be5b1d",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,7 @@\n from django.utils.html import escape\n from django.utils.timezone import is_naive\n \n+\n def add_domain(domain, url, secure=False):\n     protocol = 'https' if secure else 'http'\n     if url.startswith('//'):\n@@ -18,8 +19,6 @@ def add_domain(domain, url, secure=False):\n     elif not (url.startswith('http://')\n             or url.startswith('https://')\n             or url.startswith('mailto:')):\n-        # 'url' must already be ASCII and URL-quoted, so no need for encoding\n-        # conversions here.\n         url = iri_to_uri('%s://%s%s' % (protocol, domain, url))\n     return url\n \n@@ -61,14 +60,14 @@ def __get_dynamic_attr(self, attname, obj, default=None):\n         except AttributeError:\n             return default\n         if callable(attr):\n-            # Check func_code.co_argcount rather than try/excepting the\n+            # Check __code__.co_argcount rather than try/excepting the\n             # function and catching the TypeError, because something inside\n             # the function may raise the TypeError. This technique is more\n             # accurate.\n-            if hasattr(attr, 'func_code'):\n-                argcount = attr.func_code.co_argcount\n+            if hasattr(attr, '__code__'):\n+                argcount = attr.__code__.co_argcount\n             else:\n-                argcount = attr.__call__.func_code.co_argcount\n+                argcount = attr.__call__.__code__.co_argcount\n             if argcount == 2: # one argument is 'self'\n                 return attr(obj)\n             else:"
        },
        {
            "sha": "f496c35e2bfafdaf73349580f3ae0a75b47900a9",
            "filename": "django/core/cache/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -14,7 +14,10 @@\n \n See docs/topics/cache.txt for information on the public API.\n \"\"\"\n-from urlparse import parse_qsl\n+try:\n+    from urllib.parse import parse_qsl\n+except ImportError:     # Python 2\n+    from urlparse import parse_qsl\n \n from django.conf import settings\n from django.core import signals"
        },
        {
            "sha": "f60b4e0cd1f70785e0b0d086ace8f799ad3b8d54",
            "filename": "django/core/cache/backends/db.py",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fdb.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,7 +4,7 @@\n from datetime import datetime\n \n try:\n-    import cPickle as pickle\n+    from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n \n@@ -167,17 +167,9 @@ def _cull(self, db, cursor, now):\n             num = cursor.fetchone()[0]\n             if num > self._max_entries:\n                 cull_num = num / self._cull_frequency\n-                if connections[db].vendor == 'oracle':\n-                    # Oracle doesn't support LIMIT + OFFSET\n-                    cursor.execute(\"\"\"SELECT cache_key FROM\n-(SELECT ROW_NUMBER() OVER (ORDER BY cache_key) AS counter, cache_key FROM %s)\n-WHERE counter > %%s AND COUNTER <= %%s\"\"\" % table, [cull_num, cull_num + 1])\n-                else:\n-                    # This isn't standard SQL, it's likely to break\n-                    # with some non officially supported databases\n-                    cursor.execute(\"SELECT cache_key FROM %s \"\n-                                   \"ORDER BY cache_key \"\n-                                   \"LIMIT 1 OFFSET %%s\" % table, [cull_num])\n+                cursor.execute(\n+                    connections[db].ops.cache_key_culling_sql() % table,\n+                    [cull_num])\n                 cursor.execute(\"DELETE FROM %s \"\n                                \"WHERE cache_key < %%s\" % table,\n                                [cursor.fetchone()[0]])"
        },
        {
            "sha": "1170996a7634462258bbd9ba78683fe484cda378",
            "filename": "django/core/cache/backends/filebased.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Ffilebased.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,7 +5,7 @@\n import shutil\n import time\n try:\n-    import cPickle as pickle\n+    from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n "
        },
        {
            "sha": "76667e96094745c7c0e82c0eed6c113fb795d5fe",
            "filename": "django/core/cache/backends/locmem.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Flocmem.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Flocmem.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Flocmem.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,7 +2,7 @@\n \n import time\n try:\n-    import cPickle as pickle\n+    from django.utils.six.moves import cPickle as pickle\n except ImportError:\n     import pickle\n "
        },
        {
            "sha": "e7724f1b918fac8fa91a7371ddf4d68be87618fe",
            "filename": "django/core/cache/backends/memcached.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fmemcached.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,10 +5,12 @@\n \n from django.core.cache.backends.base import BaseCache, InvalidCacheBackendError\n \n+from django.utils import six\n+\n class BaseMemcachedCache(BaseCache):\n     def __init__(self, server, params, library, value_not_found_exception):\n         super(BaseMemcachedCache, self).__init__(params)\n-        if isinstance(server, basestring):\n+        if isinstance(server, six.string_types):\n             self._servers = server.split(';')\n         else:\n             self._servers = server"
        },
        {
            "sha": "51799805131c6f44094fd49a9d96c8f27e3b5877",
            "filename": "django/core/files/storage.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Ffiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Ffiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fstorage.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,9 @@\n import os\n import errno\n-import urlparse\n+try:\n+    from urllib.parse import urljoin\n+except ImportError:     # Python 2\n+    from urlparse import urljoin\n import itertools\n from datetime import datetime\n \n@@ -252,7 +255,7 @@ def size(self, name):\n     def url(self, name):\n         if self.base_url is None:\n             raise ValueError(\"This file is not accessible via a URL.\")\n-        return urlparse.urljoin(self.base_url, filepath_to_uri(name))\n+        return urljoin(self.base_url, filepath_to_uri(name))\n \n     def accessed_time(self, name):\n         return datetime.fromtimestamp(os.path.getatime(self.path(name)))"
        },
        {
            "sha": "7fd7d19c4a829df3ac3273dfaef2a5c4d849de8d",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,7 @@\n from django.utils.encoding import force_unicode\n from django.utils.importlib import import_module\n from django.utils.log import getLogger\n+from django.utils import six\n \n logger = getLogger('django.request')\n \n@@ -224,7 +225,7 @@ def handle_uncaught_exception(self, request, resolver, exc_info):\n \n         # If Http500 handler is not installed, re-raise last exception\n         if resolver.urlconf_module is None:\n-            raise exc_info[1], None, exc_info[2]\n+            six.reraise(exc_info[1], None, exc_info[2])\n         # Return an HttpResponse that displays a friendly error message.\n         callback, param_dict = resolver.resolve500()\n         return callback(request, **param_dict)"
        },
        {
            "sha": "617068a21caaa59cafb9196801914ea0a5db8cc9",
            "filename": "django/core/handlers/wsgi.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fwsgi.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -210,8 +210,7 @@ def __call__(self, environ, start_response):\n         # Set up middleware if needed. We couldn't do this earlier, because\n         # settings weren't available.\n         if self._request_middleware is None:\n-            self.initLock.acquire()\n-            try:\n+            with self.initLock:\n                 try:\n                     # Check that middleware is still uninitialised.\n                     if self._request_middleware is None:\n@@ -220,8 +219,6 @@ def __call__(self, environ, start_response):\n                     # Unload whatever middleware we got\n                     self._request_middleware = None\n                     raise\n-            finally:\n-                self.initLock.release()\n \n         set_script_prefix(base.get_script_name(environ))\n         signals.request_started.send(sender=self.__class__)"
        },
        {
            "sha": "0baae0c01e8cc0f5af7d67354290d9085db80c11",
            "filename": "django/core/mail/backends/console.py",
            "status": "modified",
            "additions": 13,
            "deletions": 15,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fbackends%2Fconsole.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fbackends%2Fconsole.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Fconsole.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,19 +16,17 @@ def send_messages(self, email_messages):\n         \"\"\"Write all messages to the stream in a thread-safe way.\"\"\"\n         if not email_messages:\n             return\n-        self._lock.acquire()\n-        try:\n-            stream_created = self.open()\n-            for message in email_messages:\n-                self.stream.write('%s\\n' % message.message().as_string())\n-                self.stream.write('-'*79)\n-                self.stream.write('\\n')\n-                self.stream.flush()  # flush after each message\n-            if stream_created:\n-                self.close()\n-        except:\n-            if not self.fail_silently:\n-                raise\n-        finally:\n-            self._lock.release()\n+        with self._lock:\n+            try:\n+                stream_created = self.open()\n+                for message in email_messages:\n+                    self.stream.write('%s\\n' % message.message().as_string())\n+                    self.stream.write('-'*79)\n+                    self.stream.write('\\n')\n+                    self.stream.flush()  # flush after each message\n+                if stream_created:\n+                    self.close()\n+            except:\n+                if not self.fail_silently:\n+                    raise\n         return len(email_messages)"
        },
        {
            "sha": "4a74c34f1f10f6f561b3321ad3d85dda10336779",
            "filename": "django/core/mail/backends/filebased.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fbackends%2Ffilebased.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fbackends%2Ffilebased.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Ffilebased.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,6 +6,7 @@\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n from django.core.mail.backends.console import EmailBackend as ConsoleEmailBackend\n+from django.utils import six\n \n class EmailBackend(ConsoleEmailBackend):\n     def __init__(self, *args, **kwargs):\n@@ -15,7 +16,7 @@ def __init__(self, *args, **kwargs):\n         else:\n             self.file_path = getattr(settings, 'EMAIL_FILE_PATH',None)\n         # Make sure self.file_path is a string.\n-        if not isinstance(self.file_path, basestring):\n+        if not isinstance(self.file_path, six.string_types):\n             raise ImproperlyConfigured('Path for saving emails is invalid: %r' % self.file_path)\n         self.file_path = os.path.abspath(self.file_path)\n         # Make sure that self.file_path is an directory if it exists."
        },
        {
            "sha": "18437c62828044f93e0b76e13d4bea22e5aa1810",
            "filename": "django/core/mail/backends/smtp.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fbackends%2Fsmtp.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -80,8 +80,7 @@ def send_messages(self, email_messages):\n         \"\"\"\n         if not email_messages:\n             return\n-        self._lock.acquire()\n-        try:\n+        with self._lock:\n             new_conn_created = self.open()\n             if not self.connection:\n                 # We failed silently on open().\n@@ -94,8 +93,6 @@ def send_messages(self, email_messages):\n                     num_sent += 1\n             if new_conn_created:\n                 self.close()\n-        finally:\n-            self._lock.release()\n         return num_sent\n \n     def _send(self, email_message):"
        },
        {
            "sha": "629ad464f9117958b01718144d313e12ac45c5ae",
            "filename": "django/core/mail/message.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fmessage.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmail%2Fmessage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fmessage.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,6 +16,7 @@\n from django.conf import settings\n from django.core.mail.utils import DNS_NAME\n from django.utils.encoding import smart_str, force_unicode\n+from django.utils import six\n \n \n # Don't BASE64-encode UTF-8 messages so that we avoid unwanted attention from\n@@ -96,7 +97,7 @@ def forbid_multi_line_headers(name, val, encoding):\n \n \n def sanitize_address(addr, encoding):\n-    if isinstance(addr, basestring):\n+    if isinstance(addr, six.string_types):\n         addr = parseaddr(force_unicode(addr))\n     nm, addr = addr\n     nm = str(Header(nm, encoding))\n@@ -180,17 +181,17 @@ def __init__(self, subject='', body='', from_email=None, to=None, bcc=None,\n         necessary encoding conversions.\n         \"\"\"\n         if to:\n-            assert not isinstance(to, basestring), '\"to\" argument must be a list or tuple'\n+            assert not isinstance(to, six.string_types), '\"to\" argument must be a list or tuple'\n             self.to = list(to)\n         else:\n             self.to = []\n         if cc:\n-            assert not isinstance(cc, basestring), '\"cc\" argument must be a list or tuple'\n+            assert not isinstance(cc, six.string_types), '\"cc\" argument must be a list or tuple'\n             self.cc = list(cc)\n         else:\n             self.cc = []\n         if bcc:\n-            assert not isinstance(bcc, basestring), '\"bcc\" argument must be a list or tuple'\n+            assert not isinstance(bcc, six.string_types), '\"bcc\" argument must be a list or tuple'\n             self.bcc = list(bcc)\n         else:\n             self.bcc = []"
        },
        {
            "sha": "68048e5672edb0f4aa65fb7742fee635265a979e",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -324,7 +324,7 @@ def autocomplete(self):\n                         subcommand_cls.option_list]\n             # filter out previously specified options from available options\n             prev_opts = [x.split('=')[0] for x in cwords[1:cword-1]]\n-            options = filter(lambda (x, v): x not in prev_opts, options)\n+            options = [opt for opt in options if opt[0] not in prev_opts]\n \n             # filter options by current input\n             options = sorted([(k, v) for k, v in options if k.startswith(curr)])"
        },
        {
            "sha": "d3650b1eb8a51d4dba4919ec98a11582785b0c7c",
            "filename": "django/core/management/commands/dumpdata.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fdumpdata.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -150,11 +150,11 @@ def sort_dependencies(app_list):\n             for field in model._meta.fields:\n                 if hasattr(field.rel, 'to'):\n                     rel_model = field.rel.to\n-                    if hasattr(rel_model, 'natural_key'):\n+                    if hasattr(rel_model, 'natural_key') and rel_model != model:\n                         deps.append(rel_model)\n             for field in model._meta.many_to_many:\n                 rel_model = field.rel.to\n-                if hasattr(rel_model, 'natural_key'):\n+                if hasattr(rel_model, 'natural_key') and rel_model != model:\n                     deps.append(rel_model)\n             model_dependencies.append((model, deps))\n "
        },
        {
            "sha": "ac7b7a359931a9867555cb6ca4dc2fb258067ac7",
            "filename": "django/core/management/commands/flush.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fflush.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fflush.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fflush.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -29,6 +29,8 @@ def handle_noargs(self, **options):\n         connection = connections[db]\n         verbosity = int(options.get('verbosity'))\n         interactive = options.get('interactive')\n+        # 'reset_sequences' is a stealth option\n+        reset_sequences = options.get('reset_sequences', True)\n \n         self.style = no_style()\n \n@@ -40,7 +42,7 @@ def handle_noargs(self, **options):\n             except ImportError:\n                 pass\n \n-        sql_list = sql_flush(self.style, connection, only_django=True)\n+        sql_list = sql_flush(self.style, connection, only_django=True, reset_sequences=reset_sequences)\n \n         if interactive:\n             confirm = raw_input(\"\"\"You have requested a flush of the database."
        },
        {
            "sha": "7c868e4b60f0d200de4489b0ecb3e820a34b7c4b",
            "filename": "django/core/management/commands/inspectdb.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Finspectdb.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,6 +3,7 @@\n \n from django.core.management.base import NoArgsCommand, CommandError\n from django.db import connections, DEFAULT_DB_ALIAS\n+from django.utils import six\n \n class Command(NoArgsCommand):\n     help = \"Introspects the database tables in the given database and outputs a Django model module.\"\n@@ -115,7 +116,7 @@ def handle_inspection(self, options):\n \n                 if att_name[0].isdigit():\n                     att_name = 'number_%s' % att_name\n-                    extra_params['db_column'] = unicode(column_name)\n+                    extra_params['db_column'] = six.text_type(column_name)\n                     comment_notes.append(\"Field renamed because it wasn't a \"\n                         \"valid Python identifier.\")\n "
        },
        {
            "sha": "d8e8f6cff7a62c2e4b185df1937d700100c5928a",
            "filename": "django/core/management/commands/makemessages.py",
            "status": "modified",
            "additions": 44,
            "deletions": 23,
            "changes": 67,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fmakemessages.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -13,6 +13,7 @@\n from django.utils.jslex import prepare_js_for_gettext\n \n plural_forms_re = re.compile(r'^(?P<value>\"Plural-Forms.+?\\\\n\")\\s*$', re.MULTILINE | re.DOTALL)\n+STATUS_OK = 0\n \n def handle_extensions(extensions=('html',), ignored=('py',)):\n     \"\"\"\n@@ -43,7 +44,8 @@ def _popen(cmd):\n     Friendly wrapper around Popen for Windows\n     \"\"\"\n     p = Popen(cmd, shell=True, stdout=PIPE, stderr=PIPE, close_fds=os.name != 'nt', universal_newlines=True)\n-    return p.communicate()\n+    output, errors = p.communicate()\n+    return output, errors, p.returncode\n \n def walk(root, topdown=True, onerror=None, followlinks=False,\n          ignore_patterns=None, verbosity=0, stdout=sys.stdout):\n@@ -198,15 +200,19 @@ def process_file(file, dirpath, potfile, domain, verbosity,\n             (domain, wrap, location, work_file))\n     else:\n         return\n-    msgs, errors = _popen(cmd)\n+    msgs, errors, status = _popen(cmd)\n     if errors:\n-        if is_templatized:\n-            os.unlink(work_file)\n-        if os.path.exists(potfile):\n-            os.unlink(potfile)\n-        raise CommandError(\n-            \"errors happened while running xgettext on %s\\n%s\" %\n-            (file, errors))\n+        if status != STATUS_OK:\n+            if is_templatized:\n+                os.unlink(work_file)\n+            if os.path.exists(potfile):\n+                os.unlink(potfile)\n+            raise CommandError(\n+                \"errors happened while running xgettext on %s\\n%s\" %\n+                (file, errors))\n+        elif verbosity > 0:\n+            # Print warnings\n+            stdout.write(errors)\n     if msgs:\n         write_pot_file(potfile, msgs, orig_file, work_file, is_templatized)\n     if is_templatized:\n@@ -220,20 +226,28 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n \n     Uses mguniq, msgmerge, and msgattrib GNU gettext utilities.\n     \"\"\"\n-    msgs, errors = _popen('msguniq %s %s --to-code=utf-8 \"%s\"' %\n-                            (wrap, location, potfile))\n+    msgs, errors, status = _popen('msguniq %s %s --to-code=utf-8 \"%s\"' %\n+                                    (wrap, location, potfile))\n     if errors:\n-        os.unlink(potfile)\n-        raise CommandError(\"errors happened while running msguniq\\n%s\" % errors)\n+        if status != STATUS_OK:\n+            os.unlink(potfile)\n+            raise CommandError(\n+                \"errors happened while running msguniq\\n%s\" % errors)\n+        elif verbosity > 0:\n+            stdout.write(errors)\n+\n     if os.path.exists(pofile):\n         with open(potfile, 'w') as fp:\n             fp.write(msgs)\n-        msgs, errors = _popen('msgmerge %s %s -q \"%s\" \"%s\"' %\n-                                (wrap, location, pofile, potfile))\n+        msgs, errors, status = _popen('msgmerge %s %s -q \"%s\" \"%s\"' %\n+                                        (wrap, location, pofile, potfile))\n         if errors:\n-            os.unlink(potfile)\n-            raise CommandError(\n-                \"errors happened while running msgmerge\\n%s\" % errors)\n+            if status != STATUS_OK:\n+                os.unlink(potfile)\n+                raise CommandError(\n+                    \"errors happened while running msgmerge\\n%s\" % errors)\n+            elif verbosity > 0:\n+                stdout.write(errors)\n     elif copy_pforms:\n         msgs = copy_plural_forms(msgs, locale, domain, verbosity, stdout)\n     msgs = msgs.replace(\n@@ -242,11 +256,15 @@ def write_po_file(pofile, potfile, domain, locale, verbosity, stdout,\n         fp.write(msgs)\n     os.unlink(potfile)\n     if no_obsolete:\n-        msgs, errors = _popen('msgattrib %s %s -o \"%s\" --no-obsolete \"%s\"' %\n-                                (wrap, location, pofile, pofile))\n+        msgs, errors, status = _popen(\n+            'msgattrib %s %s -o \"%s\" --no-obsolete \"%s\"' %\n+            (wrap, location, pofile, pofile))\n         if errors:\n-            raise CommandError(\n-                \"errors happened while running msgattrib\\n%s\" % errors)\n+            if status != STATUS_OK:\n+                raise CommandError(\n+                    \"errors happened while running msgattrib\\n%s\" % errors)\n+            elif verbosity > 0:\n+                stdout.write(errors)\n \n def make_messages(locale=None, domain='django', verbosity=1, all=False,\n         extensions=None, symlinks=False, ignore_patterns=None, no_wrap=False,\n@@ -291,7 +309,10 @@ def make_messages(locale=None, domain='django', verbosity=1, all=False,\n         raise CommandError(message)\n \n     # We require gettext version 0.15 or newer.\n-    output = _popen('xgettext --version')[0]\n+    output, errors, status = _popen('xgettext --version')\n+    if status != STATUS_OK:\n+        raise CommandError(\"Error running xgettext. Note that Django \"\n+                    \"internationalization requires GNU gettext 0.15 or newer.\")\n     match = re.search(r'(?P<major>\\d+)\\.(?P<minor>\\d+)', output)\n     if match:\n         xversion = (int(match.group('major')), int(match.group('minor')))"
        },
        {
            "sha": "4e7d1dbbf47f42189791526bf332d06907dedb43",
            "filename": "django/core/management/commands/shell.py",
            "status": "modified",
            "additions": 17,
            "deletions": 7,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,13 +2,19 @@\n from django.core.management.base import NoArgsCommand\n from optparse import make_option\n \n+\n class Command(NoArgsCommand):\n+    shells = ['ipython', 'bpython']\n+\n     option_list = NoArgsCommand.option_list + (\n         make_option('--plain', action='store_true', dest='plain',\n-            help='Tells Django to use plain Python, not IPython.'),\n+            help='Tells Django to use plain Python, not IPython or bpython.'),\n+        make_option('-i', '--interface', action='store', type='choice', choices=shells,\n+                    dest='interface',\n+            help='Specify an interactive interpreter interface. Available options: \"ipython\" and \"bpython\"'),\n+\n     )\n-    help = \"Runs a Python interactive interpreter. Tries to use IPython, if it's available.\"\n-    shells = ['ipython', 'bpython']\n+    help = \"Runs a Python interactive interpreter. Tries to use IPython or bpython, if one of them is available.\"\n     requires_model_validation = False\n \n     def ipython(self):\n@@ -31,8 +37,10 @@ def bpython(self):\n         import bpython\n         bpython.embed()\n \n-    def run_shell(self):\n-        for shell in self.shells:\n+    def run_shell(self, shell=None):\n+        available_shells = [shell] if shell else self.shells\n+\n+        for shell in available_shells:\n             try:\n                 return getattr(self, shell)()\n             except ImportError:\n@@ -46,19 +54,21 @@ def handle_noargs(self, **options):\n         get_models()\n \n         use_plain = options.get('plain', False)\n+        interface = options.get('interface', None)\n \n         try:\n             if use_plain:\n                 # Don't bother loading IPython, because the user wants plain Python.\n                 raise ImportError\n-            self.run_shell()\n+\n+            self.run_shell(shell=interface)\n         except ImportError:\n             import code\n             # Set up a dictionary to serve as the environment for the shell, so\n             # that tab completion works on objects that are imported at runtime.\n             # See ticket 5082.\n             imported_objects = {}\n-            try: # Try activating rlcompleter, because it's handy.\n+            try:  # Try activating rlcompleter, because it's handy.\n                 import readline\n             except ImportError:\n                 pass"
        },
        {
            "sha": "7579cbe8abde69144229cb2888315a6044377594",
            "filename": "django/core/management/sql.py",
            "status": "modified",
            "additions": 20,
            "deletions": 14,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fsql.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fsql.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fsql.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -98,7 +98,7 @@ def sql_delete(app, style, connection):\n \n     return output[::-1] # Reverse it, to deal with table dependencies.\n \n-def sql_flush(style, connection, only_django=False):\n+def sql_flush(style, connection, only_django=False, reset_sequences=True):\n     \"\"\"\n     Returns a list of the SQL statements used to flush the database.\n \n@@ -109,9 +109,8 @@ def sql_flush(style, connection, only_django=False):\n         tables = connection.introspection.django_table_names(only_existing=True)\n     else:\n         tables = connection.introspection.table_names()\n-    statements = connection.ops.sql_flush(\n-        style, tables, connection.introspection.sequence_list()\n-    )\n+    seqs = connection.introspection.sequence_list() if reset_sequences else ()\n+    statements = connection.ops.sql_flush(style, tables, seqs)\n     return statements\n \n def sql_custom(app, style, connection):\n@@ -136,6 +135,20 @@ def sql_all(app, style, connection):\n     \"Returns a list of CREATE TABLE SQL, initial-data inserts, and CREATE INDEX SQL for the given module.\"\n     return sql_create(app, style, connection) + sql_custom(app, style, connection) + sql_indexes(app, style, connection)\n \n+def _split_statements(content):\n+    comment_re = re.compile(r\"^((?:'[^']*'|[^'])*?)--.*$\")\n+    statements = []\n+    statement = \"\"\n+    for line in content.split(\"\\n\"):\n+        cleaned_line = comment_re.sub(r\"\\1\", line).strip()\n+        if not cleaned_line:\n+            continue\n+        statement += cleaned_line\n+        if statement.endswith(\";\"):\n+            statements.append(statement)\n+            statement = \"\"\n+    return statements\n+\n def custom_sql_for_model(model, style, connection):\n     opts = model._meta\n     app_dir = os.path.normpath(os.path.join(os.path.dirname(models.get_app(model._meta.app_label).__file__), 'sql'))\n@@ -149,23 +162,16 @@ def custom_sql_for_model(model, style, connection):\n         for f in post_sql_fields:\n             output.extend(f.post_create_sql(style, model._meta.db_table))\n \n-    # Some backends can't execute more than one SQL statement at a time,\n-    # so split into separate statements.\n-    statements = re.compile(r\";[ \\t]*$\", re.M)\n-\n     # Find custom SQL, if it's available.\n     backend_name = connection.settings_dict['ENGINE'].split('.')[-1]\n     sql_files = [os.path.join(app_dir, \"%s.%s.sql\" % (opts.object_name.lower(), backend_name)),\n                  os.path.join(app_dir, \"%s.sql\" % opts.object_name.lower())]\n     for sql_file in sql_files:\n         if os.path.exists(sql_file):\n             with open(sql_file, 'U') as fp:\n-                for statement in statements.split(fp.read().decode(settings.FILE_CHARSET)):\n-                    # Remove any comments from the file\n-                    statement = re.sub(r\"--.*([\\n\\Z]|$)\", \"\", statement)\n-                    if statement.strip():\n-                        output.append(statement + \";\")\n-\n+                # Some backends can't execute more than one SQL statement at a time,\n+                # so split into separate statements.\n+                output.extend(_split_statements(fp.read().decode(settings.FILE_CHARSET)))\n     return output\n \n "
        },
        {
            "sha": "52d0e5c89d9f6a4a30f231703be725d1bcfc9255",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,7 +8,10 @@\n import stat\n import sys\n import tempfile\n-import urllib\n+try:\n+    from urllib.request import urlretrieve\n+except ImportError:     # Python 2\n+    from urllib import urlretrieve\n \n from optparse import make_option\n from os import path\n@@ -112,7 +115,7 @@ def handle(self, app_or_project, name, target=None, **options):\n         context = Context(dict(options, **{\n             base_name: name,\n             base_directory: top_dir,\n-        }))\n+        }), autoescape=False)\n \n         # Setup a stub settings environment for template rendering\n         from django.conf import settings\n@@ -227,8 +230,7 @@ def cleanup_url(url):\n         if self.verbosity >= 2:\n             self.stdout.write(\"Downloading %s\\n\" % display_url)\n         try:\n-            the_path, info = urllib.urlretrieve(url,\n-                                                path.join(tempdir, filename))\n+            the_path, info = urlretrieve(url, path.join(tempdir, filename))\n         except IOError as e:\n             raise CommandError(\"couldn't download URL %s to %s: %s\" %\n                                (url, filename, e))"
        },
        {
            "sha": "274f98ee797240f5fbace1131b79e37f818278be",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,6 +3,7 @@\n from django.core.management.color import color_style\n from django.utils.encoding import smart_str\n from django.utils.itercompat import is_iterable\n+from django.utils import six\n \n class ModelErrorCollection:\n     def __init__(self, outfile=sys.stdout):\n@@ -93,7 +94,7 @@ def get_validation_errors(outfile, app=None):\n             if isinstance(f, models.FilePathField) and not (f.allow_files or f.allow_folders):\n                 e.add(opts, '\"%s\": FilePathFields must have either allow_files or allow_folders set to True.' % f.name)\n             if f.choices:\n-                if isinstance(f.choices, basestring) or not is_iterable(f.choices):\n+                if isinstance(f.choices, six.string_types) or not is_iterable(f.choices):\n                     e.add(opts, '\"%s\": \"choices\" should be iterable (e.g., a tuple or list).' % f.name)\n                 else:\n                     for c in f.choices:\n@@ -119,7 +120,7 @@ def get_validation_errors(outfile, app=None):\n                     e.add(opts, \"'%s' has a relation with model %s, which has either not been installed or is abstract.\" % (f.name, f.rel.to))\n                 # it is a string and we could not find the model it refers to\n                 # so skip the next section\n-                if isinstance(f.rel.to, (str, unicode)):\n+                if isinstance(f.rel.to, six.string_types):\n                     continue\n \n                 # Make sure the related field specified by a ForeignKey is unique\n@@ -161,14 +162,14 @@ def get_validation_errors(outfile, app=None):\n                 e.add(opts, \"'%s' has an m2m relation with model %s, which has either not been installed or is abstract.\" % (f.name, f.rel.to))\n                 # it is a string and we could not find the model it refers to\n                 # so skip the next section\n-                if isinstance(f.rel.to, (str, unicode)):\n+                if isinstance(f.rel.to, six.string_types):\n                     continue\n \n             # Check that the field is not set to unique.  ManyToManyFields do not support unique.\n             if f.unique:\n                 e.add(opts, \"ManyToManyFields cannot be unique.  Remove the unique argument on '%s'.\" % f.name)\n \n-            if f.rel.through is not None and not isinstance(f.rel.through, basestring):\n+            if f.rel.through is not None and not isinstance(f.rel.through, six.string_types):\n                 from_model, to_model = cls, f.rel.to\n                 if from_model == to_model and f.rel.symmetrical and not f.rel.through._meta.auto_created:\n                     e.add(opts, \"Many-to-many fields with intermediate tables cannot be symmetrical.\")\n@@ -239,7 +240,7 @@ def get_validation_errors(outfile, app=None):\n                             \"to %s and %s\" % (f.name, f.rel.through._meta.object_name,\n                                 f.rel.to._meta.object_name, cls._meta.object_name)\n                         )\n-            elif isinstance(f.rel.through, basestring):\n+            elif isinstance(f.rel.through, six.string_types):\n                 e.add(opts, \"'%s' specifies an m2m relation through model %s, \"\n                     \"which has not been installed\" % (f.name, f.rel.through)\n                 )"
        },
        {
            "sha": "19886f7d53c334b933c11059dd59ed6ef067f8de",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,6 +6,7 @@\n \n from django.db import models\n from django.utils.encoding import smart_unicode\n+from django.utils import six\n \n class SerializerDoesNotExist(KeyError):\n     \"\"\"The requested serializer was not found.\"\"\"\n@@ -123,7 +124,7 @@ def __init__(self, stream_or_string, **options):\n         Init this serializer given a stream or a string\n         \"\"\"\n         self.options = options\n-        if isinstance(stream_or_string, basestring):\n+        if isinstance(stream_or_string, six.string_types):\n             self.stream = BytesIO(stream_or_string)\n         else:\n             self.stream = stream_or_string"
        },
        {
            "sha": "8b56d0e7b89862b499d1482b527af682f2692e56",
            "filename": "django/core/serializers/json.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fserializers%2Fjson.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fserializers%2Fjson.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fjson.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -13,6 +13,7 @@\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n from django.utils.encoding import smart_str\n+from django.utils import six\n from django.utils.timezone import is_aware\n \n class Serializer(PythonSerializer):\n@@ -52,9 +53,8 @@ def end_object(self, obj):\n         self._current = None\n \n     def getvalue(self):\n-        # overwrite PythonSerializer.getvalue() with base Serializer.getvalue()\n-        if callable(getattr(self.stream, 'getvalue', None)):\n-            return self.stream.getvalue()\n+        # Grand-parent super\n+        return super(PythonSerializer, self).getvalue()\n \n \n def Deserializer(stream_or_string, **options):\n@@ -64,7 +64,7 @@ def Deserializer(stream_or_string, **options):\n     if isinstance(stream_or_string, bytes):\n         stream_or_string = stream_or_string.decode('utf-8')\n     try:\n-        if isinstance(stream_or_string, basestring):\n+        if isinstance(stream_or_string, six.string_types):\n             objects = json.loads(stream_or_string)\n         else:\n             objects = json.load(stream_or_string)"
        },
        {
            "sha": "ac0e6cf82d1d689248d763695f9a451116de72f6",
            "filename": "django/core/serializers/pyyaml.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpyyaml.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -13,6 +13,7 @@\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n from django.utils.encoding import smart_str\n+from django.utils import six\n \n \n class DjangoSafeDumper(yaml.SafeDumper):\n@@ -44,15 +45,16 @@ def end_serialization(self):\n         yaml.dump(self.objects, self.stream, Dumper=DjangoSafeDumper, **self.options)\n \n     def getvalue(self):\n-        return self.stream.getvalue()\n+        # Grand-parent super\n+        return super(PythonSerializer, self).getvalue()\n \n def Deserializer(stream_or_string, **options):\n     \"\"\"\n     Deserialize a stream or string of YAML data.\n     \"\"\"\n     if isinstance(stream_or_string, bytes):\n         stream_or_string = stream_or_string.decode('utf-8')\n-    if isinstance(stream_or_string, basestring):\n+    if isinstance(stream_or_string, six.string_types):\n         stream = StringIO(stream_or_string)\n     else:\n         stream = stream_or_string"
        },
        {
            "sha": "2db4e5ef6a4fdf97700d081e6ad80599cf5440b7",
            "filename": "django/core/servers/basehttp.py",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fservers%2Fbasehttp.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fservers%2Fbasehttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fservers%2Fbasehttp.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -11,9 +11,12 @@\n import socket\n import sys\n import traceback\n-import urllib\n-import urlparse\n-from SocketServer import ThreadingMixIn\n+try:\n+    from urllib.parse import unquote, urljoin\n+except ImportError:     # Python 2\n+    from urllib import unquote\n+    from urlparse import urljoin\n+from django.utils.six.moves import socketserver\n from wsgiref import simple_server\n from wsgiref.util import FileWrapper   # for backwards compatibility\n \n@@ -127,7 +130,7 @@ class WSGIRequestHandler(simple_server.WSGIRequestHandler, object):\n \n     def __init__(self, *args, **kwargs):\n         from django.conf import settings\n-        self.admin_static_prefix = urlparse.urljoin(settings.STATIC_URL, 'admin/')\n+        self.admin_static_prefix = urljoin(settings.STATIC_URL, 'admin/')\n         # We set self.path to avoid crashes in log_message() on unsupported\n         # requests (like \"OPTIONS\").\n         self.path = ''\n@@ -143,7 +146,7 @@ def get_environ(self):\n         else:\n             path,query = self.path,''\n \n-        env['PATH_INFO'] = urllib.unquote(path)\n+        env['PATH_INFO'] = unquote(path)\n         env['QUERY_STRING'] = query\n         env['REMOTE_ADDR'] = self.client_address[0]\n         env['CONTENT_TYPE'] = self.headers.get('content-type', 'text/plain')\n@@ -197,7 +200,7 @@ def log_message(self, format, *args):\n def run(addr, port, wsgi_handler, ipv6=False, threading=False):\n     server_address = (addr, port)\n     if threading:\n-        httpd_cls = type('WSGIServer', (ThreadingMixIn, WSGIServer), {})\n+        httpd_cls = type('WSGIServer', (socketserver.ThreadingMixIn, WSGIServer), {})\n     else:\n         httpd_cls = WSGIServer\n     httpd = httpd_cls(server_address, WSGIRequestHandler, ipv6=ipv6)"
        },
        {
            "sha": "7397cf3b3dc5587a7e5e4c5fd508245e9abe4e08",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -19,6 +19,7 @@\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n from django.utils.regex_helper import normalize\n+from django.utils import six\n from django.utils.translation import get_language\n \n \n@@ -159,11 +160,17 @@ def regex(self):\n         \"\"\"\n         language_code = get_language()\n         if language_code not in self._regex_dict:\n-            if isinstance(self._regex, basestring):\n-                compiled_regex = re.compile(self._regex, re.UNICODE)\n+            if isinstance(self._regex, six.string_types):\n+                regex = self._regex\n             else:\n                 regex = force_unicode(self._regex)\n+            try:\n                 compiled_regex = re.compile(regex, re.UNICODE)\n+            except re.error as e:\n+                raise ImproperlyConfigured(\n+                    '\"%s\" is not a valid regular expression: %s' %\n+                    (regex, six.text_type(e)))\n+\n             self._regex_dict[language_code] = compiled_regex\n         return self._regex_dict[language_code]\n \n@@ -222,7 +229,7 @@ def __init__(self, regex, urlconf_name, default_kwargs=None, app_name=None, name\n         LocaleRegexProvider.__init__(self, regex)\n         # urlconf_name is a string representing the module containing URLconfs.\n         self.urlconf_name = urlconf_name\n-        if not isinstance(urlconf_name, basestring):\n+        if not isinstance(urlconf_name, six.string_types):\n             self._urlconf_module = self.urlconf_name\n         self.callback = None\n         self.default_kwargs = default_kwargs or {}\n@@ -428,7 +435,7 @@ def reverse(viewname, urlconf=None, args=None, kwargs=None, prefix=None, current\n     if prefix is None:\n         prefix = get_script_prefix()\n \n-    if not isinstance(viewname, basestring):\n+    if not isinstance(viewname, six.string_types):\n         view = viewname\n     else:\n         parts = viewname.split(':')"
        },
        {
            "sha": "03ff8be3bca906ea94c2b1f7c48fce31a40bf099",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,12 +1,16 @@\n from __future__ import unicode_literals\n \n import re\n-import urlparse\n+try:\n+    from urllib.parse import urlsplit, urlunsplit\n+except ImportError:     # Python 2\n+    from urlparse import urlsplit, urlunsplit\n \n from django.core.exceptions import ValidationError\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_unicode\n from django.utils.ipv6 import is_valid_ipv6_address\n+from django.utils import six\n \n # These values, if given to validate(), will trigger the self.required check.\n EMPTY_VALUES = (None, '', [], (), {})\n@@ -25,7 +29,7 @@ def __init__(self, regex=None, message=None, code=None):\n             self.code = code\n \n         # Compile the regex if it was not passed pre-compiled.\n-        if isinstance(self.regex, basestring):\n+        if isinstance(self.regex, six.string_types):\n             self.regex = re.compile(self.regex)\n \n     def __call__(self, value):\n@@ -51,12 +55,12 @@ def __call__(self, value):\n             # Trivial case failed. Try for possible IDN domain\n             if value:\n                 value = smart_unicode(value)\n-                scheme, netloc, path, query, fragment = urlparse.urlsplit(value)\n+                scheme, netloc, path, query, fragment = urlsplit(value)\n                 try:\n                     netloc = netloc.encode('idna') # IDN -> ACE\n                 except UnicodeError: # invalid domain part\n                     raise e\n-                url = urlparse.urlunsplit((scheme, netloc, path, query, fragment))\n+                url = urlunsplit((scheme, netloc, path, query, fragment))\n                 super(URLValidator, self).__call__(url)\n             else:\n                 raise"
        },
        {
            "sha": "816cbcda638470ccbdcc7a773d6e7453bf2251ac",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 74,
            "deletions": 29,
            "changes": 103,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,7 +3,7 @@\n try:\n     import thread\n except ImportError:\n-    import dummy_thread as thread\n+    from django.utils.six.moves import _dummy_thread as thread\n from contextlib import contextmanager\n \n from django.conf import settings\n@@ -12,6 +12,7 @@\n from django.db.transaction import TransactionManagementError\n from django.utils.functional import cached_property\n from django.utils.importlib import import_module\n+from django.utils import six\n from django.utils.timezone import is_aware\n \n \n@@ -109,16 +110,18 @@ def leave_transaction_management(self):\n         over to the surrounding block, as a commit will commit all changes, even\n         those from outside. (Commits are on connection level.)\n         \"\"\"\n-        self._leave_transaction_management(self.is_managed())\n         if self.transaction_state:\n             del self.transaction_state[-1]\n         else:\n-            raise TransactionManagementError(\"This code isn't under transaction \"\n-                \"management\")\n+            raise TransactionManagementError(\n+                \"This code isn't under transaction management\")\n+        # We will pass the next status (after leaving the previous state\n+        # behind) to subclass hook.\n+        self._leave_transaction_management(self.is_managed())\n         if self._dirty:\n             self.rollback()\n-            raise TransactionManagementError(\"Transaction managed block ended with \"\n-                \"pending COMMIT/ROLLBACK\")\n+            raise TransactionManagementError(\n+                \"Transaction managed block ended with pending COMMIT/ROLLBACK\")\n         self._dirty = False\n \n     def validate_thread_sharing(self):\n@@ -176,6 +179,8 @@ def is_managed(self):\n         \"\"\"\n         if self.transaction_state:\n             return self.transaction_state[-1]\n+        # Note that this setting isn't documented, and is only used here, and\n+        # in enter_transaction_management()\n         return settings.TRANSACTIONS_MANAGED\n \n     def managed(self, flag=True):\n@@ -428,15 +433,24 @@ def __init__(self, connection):\n     @cached_property\n     def supports_transactions(self):\n         \"Confirm support for transactions\"\n-        cursor = self.connection.cursor()\n-        cursor.execute('CREATE TABLE ROLLBACK_TEST (X INT)')\n-        self.connection._commit()\n-        cursor.execute('INSERT INTO ROLLBACK_TEST (X) VALUES (8)')\n-        self.connection._rollback()\n-        cursor.execute('SELECT COUNT(X) FROM ROLLBACK_TEST')\n-        count, = cursor.fetchone()\n-        cursor.execute('DROP TABLE ROLLBACK_TEST')\n-        self.connection._commit()\n+        try:\n+            # Make sure to run inside a managed transaction block,\n+            # otherwise autocommit will cause the confimation to\n+            # fail.\n+            self.connection.enter_transaction_management()\n+            self.connection.managed(True)\n+            cursor = self.connection.cursor()\n+            cursor.execute('CREATE TABLE ROLLBACK_TEST (X INT)')\n+            self.connection._commit()\n+            cursor.execute('INSERT INTO ROLLBACK_TEST (X) VALUES (8)')\n+            self.connection._rollback()\n+            cursor.execute('SELECT COUNT(X) FROM ROLLBACK_TEST')\n+            count, = cursor.fetchone()\n+            cursor.execute('DROP TABLE ROLLBACK_TEST')\n+            self.connection._commit()\n+            self.connection._dirty = False\n+        finally:\n+            self.connection.leave_transaction_management()\n         return count == 0\n \n     @cached_property\n@@ -473,6 +487,24 @@ def autoinc_sql(self, table, column):\n         \"\"\"\n         return None\n \n+    def bulk_batch_size(self, fields, objs):\n+        \"\"\"\n+        Returns the maximum allowed batch size for the backend. The fields\n+        are the fields going to be inserted in the batch, the objs contains\n+        all the objects to be inserted.\n+        \"\"\"\n+        return len(objs)\n+\n+    def cache_key_culling_sql(self):\n+        \"\"\"\n+        Returns a SQL query that retrieves the first cache key greater than the\n+        n smallest.\n+\n+        This is used by the 'db' cache backend to determine where to start\n+        culling.\n+        \"\"\"\n+        return \"SELECT cache_key FROM %s ORDER BY cache_key LIMIT 1 OFFSET %%s\"\n+\n     def date_extract_sql(self, lookup_type, field_name):\n         \"\"\"\n         Given a lookup_type of 'year', 'month' or 'day', returns the SQL that\n@@ -510,6 +542,17 @@ def deferrable_sql(self):\n         \"\"\"\n         return ''\n \n+    def distinct_sql(self, fields):\n+        \"\"\"\n+        Returns an SQL DISTINCT clause which removes duplicate rows from the\n+        result set. If any fields are given, only the given fields are being\n+        checked for duplicates.\n+        \"\"\"\n+        if fields:\n+            raise NotImplementedError('DISTINCT ON fields is not supported by this database backend')\n+        else:\n+            return 'DISTINCT'\n+\n     def drop_foreignkey_sql(self):\n         \"\"\"\n         Returns the SQL command that drops a foreign key.\n@@ -565,17 +608,6 @@ def fulltext_search_sql(self, field_name):\n         \"\"\"\n         raise NotImplementedError('Full-text search is not implemented for this database backend')\n \n-    def distinct_sql(self, fields):\n-        \"\"\"\n-        Returns an SQL DISTINCT clause which removes duplicate rows from the\n-        result set. If any fields are given, only the given fields are being\n-        checked for duplicates.\n-        \"\"\"\n-        if fields:\n-            raise NotImplementedError('DISTINCT ON fields is not supported by this database backend')\n-        else:\n-            return 'DISTINCT'\n-\n     def last_executed_query(self, cursor, sql, params):\n         \"\"\"\n         Returns a string of the query last executed by the given cursor, with\n@@ -727,11 +759,24 @@ def sql_flush(self, style, tables, sequences):\n         the given database tables (without actually removing the tables\n         themselves).\n \n+        The returned value also includes SQL statements required to reset DB\n+        sequences passed in :param sequences:.\n+\n         The `style` argument is a Style object as returned by either\n         color_style() or no_style() in django.core.management.color.\n         \"\"\"\n         raise NotImplementedError()\n \n+    def sequence_reset_by_name_sql(self, style, sequences):\n+        \"\"\"\n+        Returns a list of the SQL statements required to reset sequences\n+        passed in :param sequences:.\n+\n+        The `style` argument is a Style object as returned by either\n+        color_style() or no_style() in django.core.management.color.\n+        \"\"\"\n+        return []\n+\n     def sequence_reset_sql(self, style, model_list):\n         \"\"\"\n         Returns a list of the SQL statements required to reset sequences for\n@@ -788,7 +833,7 @@ def value_to_db_date(self, value):\n         \"\"\"\n         if value is None:\n             return None\n-        return unicode(value)\n+        return six.text_type(value)\n \n     def value_to_db_datetime(self, value):\n         \"\"\"\n@@ -797,7 +842,7 @@ def value_to_db_datetime(self, value):\n         \"\"\"\n         if value is None:\n             return None\n-        return unicode(value)\n+        return six.text_type(value)\n \n     def value_to_db_time(self, value):\n         \"\"\"\n@@ -808,7 +853,7 @@ def value_to_db_time(self, value):\n             return None\n         if is_aware(value):\n             raise ValueError(\"Django does not support timezone-aware times.\")\n-        return unicode(value)\n+        return six.text_type(value)\n \n     def value_to_db_decimal(self, value, max_digits, decimal_places):\n         \"\"\""
        },
        {
            "sha": "fcc6ab75841c6c64f4b914571a3e4411a1a3665c",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -26,7 +26,7 @@ def _digest(self, *args):\n         Generates a 32-bit digest of a set of arguments that can be used to\n         shorten identifying names.\n         \"\"\"\n-        return '%x' % (abs(hash(args)) % 4294967296L)  # 2**32\n+        return '%x' % (abs(hash(args)) % 4294967296)    # 2**32\n \n     def sql_create_model(self, model, style, known_models=set()):\n         \"\"\""
        },
        {
            "sha": "2222f89cf0075c8b92eba93017395a53c74b42d7",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 29,
            "deletions": 25,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -39,6 +39,7 @@\n from django.db.backends.mysql.validation import DatabaseValidation\n from django.utils.functional import cached_property\n from django.utils.safestring import SafeString, SafeUnicode\n+from django.utils import six\n from django.utils import timezone\n \n # Raise exceptions for database warnings if DEBUG is on\n@@ -117,29 +118,29 @@ def execute(self, query, args=None):\n         try:\n             return self.cursor.execute(query, args)\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.OperationalError as e:\n             # Map some error codes to IntegrityError, since they seem to be\n             # misclassified and Django would prefer the more logical place.\n             if e[0] in self.codes_for_integrityerror:\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def executemany(self, query, args):\n         try:\n             return self.cursor.executemany(query, args)\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.OperationalError as e:\n             # Map some error codes to IntegrityError, since they seem to be\n             # misclassified and Django would prefer the more logical place.\n             if e[0] in self.codes_for_integrityerror:\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def __getattr__(self, attr):\n         if attr in self.__dict__:\n@@ -242,7 +243,7 @@ def last_executed_query(self, cursor, sql, params):\n \n     def no_limit_value(self):\n         # 2**64 - 1, as recommended by the MySQL documentation\n-        return 18446744073709551615L\n+        return 18446744073709551615\n \n     def quote_name(self, name):\n         if name.startswith(\"`\") and name.endswith(\"`\"):\n@@ -261,22 +262,25 @@ def sql_flush(self, style, tables, sequences):\n             for table in tables:\n                 sql.append('%s %s;' % (style.SQL_KEYWORD('TRUNCATE'), style.SQL_FIELD(self.quote_name(table))))\n             sql.append('SET FOREIGN_KEY_CHECKS = 1;')\n-\n-            # Truncate already resets the AUTO_INCREMENT field from\n-            # MySQL version 5.0.13 onwards. Refs #16961.\n-            if self.connection.mysql_version < (5,0,13):\n-                sql.extend(\n-                    [\"%s %s %s %s %s;\" % \\\n-                     (style.SQL_KEYWORD('ALTER'),\n-                      style.SQL_KEYWORD('TABLE'),\n-                      style.SQL_TABLE(self.quote_name(sequence['table'])),\n-                      style.SQL_KEYWORD('AUTO_INCREMENT'),\n-                      style.SQL_FIELD('= 1'),\n-                     ) for sequence in sequences])\n+            sql.extend(self.sequence_reset_by_name_sql(style, sequences))\n             return sql\n         else:\n             return []\n \n+    def sequence_reset_by_name_sql(self, style, sequences):\n+        # Truncate already resets the AUTO_INCREMENT field from\n+        # MySQL version 5.0.13 onwards. Refs #16961.\n+        if self.connection.mysql_version < (5, 0, 13):\n+            return [\"%s %s %s %s %s;\" % \\\n+                    (style.SQL_KEYWORD('ALTER'),\n+                    style.SQL_KEYWORD('TABLE'),\n+                    style.SQL_TABLE(self.quote_name(sequence['table'])),\n+                    style.SQL_KEYWORD('AUTO_INCREMENT'),\n+                    style.SQL_FIELD('= 1'),\n+                    ) for sequence in sequences]\n+        else:\n+            return []\n+\n     def validate_autopk_value(self, value):\n         # MySQLism: zero in AUTO_INCREMENT field does not work. Refs #17653.\n         if value == 0:\n@@ -296,7 +300,7 @@ def value_to_db_datetime(self, value):\n                 raise ValueError(\"MySQL backend does not support timezone-aware datetimes when USE_TZ is False.\")\n \n         # MySQL doesn't support microseconds\n-        return unicode(value.replace(microsecond=0))\n+        return six.text_type(value.replace(microsecond=0))\n \n     def value_to_db_time(self, value):\n         if value is None:\n@@ -307,7 +311,7 @@ def value_to_db_time(self, value):\n             raise ValueError(\"MySQL backend does not support timezone-aware times.\")\n \n         # MySQL doesn't support microseconds\n-        return unicode(value.replace(microsecond=0))\n+        return six.text_type(value.replace(microsecond=0))\n \n     def year_lookup_bounds(self, value):\n         # Again, no microseconds\n@@ -398,8 +402,8 @@ def _cursor(self):\n             kwargs['client_flag'] = CLIENT.FOUND_ROWS\n             kwargs.update(settings_dict['OPTIONS'])\n             self.connection = Database.connect(**kwargs)\n-            self.connection.encoders[SafeUnicode] = self.connection.encoders[unicode]\n-            self.connection.encoders[SafeString] = self.connection.encoders[str]\n+            self.connection.encoders[SafeUnicode] = self.connection.encoders[six.text_type]\n+            self.connection.encoders[SafeString] = self.connection.encoders[bytes]\n             connection_created.send(sender=self.__class__, connection=self)\n         cursor = self.connection.cursor()\n         if new_connection:"
        },
        {
            "sha": "b08113fed76831cb047eacecbe290964371586c3",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 47,
            "deletions": 27,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,7 @@\n import sys\n import warnings\n \n+from django.utils import six\n \n def _setup_environment(environ):\n     import platform\n@@ -53,6 +54,7 @@ def _setup_environment(environ):\n from django.db.backends.oracle.creation import DatabaseCreation\n from django.db.backends.oracle.introspection import DatabaseIntrospection\n from django.utils.encoding import smart_str, force_unicode\n+from django.utils import six\n from django.utils import timezone\n \n DatabaseError = Database.DatabaseError\n@@ -118,6 +120,13 @@ def autoinc_sql(self, table, column):\n /\"\"\" % locals()\n         return sequence_sql, trigger_sql\n \n+    def cache_key_culling_sql(self):\n+        return \"\"\"\n+            SELECT cache_key\n+              FROM (SELECT cache_key, rank() OVER (ORDER BY cache_key) AS rank FROM %s)\n+             WHERE rank = %%s + 1\n+        \"\"\"\n+\n     def date_extract_sql(self, lookup_type, field_name):\n         # http://download-east.oracle.com/docs/cd/B10501_01/server.920/a96540/functions42a.htm#1017163\n         if lookup_type == 'week_day':\n@@ -201,7 +210,7 @@ def drop_sequence_sql(self, table):\n         return \"DROP SEQUENCE %s;\" % self.quote_name(self._get_sequence_name(table))\n \n     def fetch_returned_insert_id(self, cursor):\n-        return long(cursor._insert_id_var.getvalue())\n+        return int(cursor._insert_id_var.getvalue())\n \n     def field_cast_sql(self, db_type):\n         if db_type and db_type.endswith('LOB'):\n@@ -289,18 +298,23 @@ def sql_flush(self, style, tables, sequences):\n                     for table in tables]\n             # Since we've just deleted all the rows, running our sequence\n             # ALTER code will reset the sequence to 0.\n-            for sequence_info in sequences:\n-                sequence_name = self._get_sequence_name(sequence_info['table'])\n-                table_name = self.quote_name(sequence_info['table'])\n-                column_name = self.quote_name(sequence_info['column'] or 'id')\n-                query = _get_sequence_reset_sql() % {'sequence': sequence_name,\n-                                                     'table': table_name,\n-                                                     'column': column_name}\n-                sql.append(query)\n+            sql.extend(self.sequence_reset_by_name_sql(style, sequences))\n             return sql\n         else:\n             return []\n \n+    def sequence_reset_by_name_sql(self, style, sequences):\n+        sql = []\n+        for sequence_info in sequences:\n+            sequence_name = self._get_sequence_name(sequence_info['table'])\n+            table_name = self.quote_name(sequence_info['table'])\n+            column_name = self.quote_name(sequence_info['column'] or 'id')\n+            query = _get_sequence_reset_sql() % {'sequence': sequence_name,\n+                                                    'table': table_name,\n+                                                    'column': column_name}\n+            sql.append(query)\n+        return sql\n+\n     def sequence_reset_sql(self, style, model_list):\n         from django.db import models\n         output = []\n@@ -347,13 +361,13 @@ def value_to_db_datetime(self, value):\n             else:\n                 raise ValueError(\"Oracle backend does not support timezone-aware datetimes when USE_TZ is False.\")\n \n-        return unicode(value)\n+        return six.text_type(value)\n \n     def value_to_db_time(self, value):\n         if value is None:\n             return None\n \n-        if isinstance(value, basestring):\n+        if isinstance(value, six.string_types):\n             return datetime.datetime.strptime(value, '%H:%M:%S')\n \n         # Oracle doesn't support tz-aware times\n@@ -479,13 +493,19 @@ def _cursor(self):\n                 del conn_params['use_returning_into']\n             self.connection = Database.connect(conn_string, **conn_params)\n             cursor = FormatStylePlaceholderCursor(self.connection)\n+            # Set the territory first. The territory overrides NLS_DATE_FORMAT\n+            # and NLS_TIMESTAMP_FORMAT to the territory default. When all of\n+            # these are set in single statement it isn't clear what is supposed\n+            # to happen.\n+            cursor.execute(\"ALTER SESSION SET NLS_TERRITORY = 'AMERICA'\")\n             # Set oracle date to ansi date format.  This only needs to execute\n             # once when we create a new connection. We also set the Territory\n-            # to 'AMERICA' which forces Sunday to evaluate to a '1' in TO_CHAR().\n-            cursor.execute(\"ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS'\"\n-                           \" NLS_TIMESTAMP_FORMAT = 'YYYY-MM-DD HH24:MI:SS.FF'\"\n-                           \" NLS_TERRITORY = 'AMERICA'\"\n-                           + (\" TIME_ZONE = 'UTC'\" if settings.USE_TZ else ''))\n+            # to 'AMERICA' which forces Sunday to evaluate to a '1' in\n+            # TO_CHAR().\n+            cursor.execute(\n+                \"ALTER SESSION SET NLS_DATE_FORMAT = 'YYYY-MM-DD HH24:MI:SS'\"\n+                \" NLS_TIMESTAMP_FORMAT = 'YYYY-MM-DD HH24:MI:SS.FF'\"\n+                + (\" TIME_ZONE = 'UTC'\" if settings.USE_TZ else ''))\n \n             if 'operators' not in self.__dict__:\n                 # Ticket #14149: Check whether our LIKE implementation will\n@@ -536,7 +556,7 @@ def _commit(self):\n             except Database.IntegrityError as e:\n                 # In case cx_Oracle implements (now or in a future version)\n                 # raising this specific exception\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n             except Database.DatabaseError as e:\n                 # cx_Oracle 5.0.4 raises a cx_Oracle.DatabaseError exception\n                 # with the following attributes and values:\n@@ -548,8 +568,8 @@ def _commit(self):\n                 x = e.args[0]\n                 if hasattr(x, 'code') and hasattr(x, 'message') \\\n                    and x.code == 2091 and 'ORA-02291' in x.message:\n-                    raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-                raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+                    six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n+                six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n \n class OracleParam(object):\n@@ -582,7 +602,7 @@ def __init__(self, param, cursor, strings_only=False):\n         if hasattr(param, 'input_size'):\n             # If parameter has `input_size` attribute, use that.\n             self.input_size = param.input_size\n-        elif isinstance(param, basestring) and len(param) > 4000:\n+        elif isinstance(param, six.string_types) and len(param) > 4000:\n             # Mark any string param greater than 4000 characters as a CLOB.\n             self.input_size = Database.CLOB\n         else:\n@@ -675,12 +695,12 @@ def execute(self, query, params=None):\n         try:\n             return self.cursor.execute(query, self._param_generator(params))\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n             # cx_Oracle <= 4.4.0 wrongly raises a DatabaseError for ORA-01400.\n             if hasattr(e.args[0], 'code') and e.args[0].code == 1400 and not isinstance(e, IntegrityError):\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def executemany(self, query, params=None):\n         # cx_Oracle doesn't support iterators, convert them to lists\n@@ -704,12 +724,12 @@ def executemany(self, query, params=None):\n             return self.cursor.executemany(query,\n                                 [self._param_generator(p) for p in formatted])\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n             # cx_Oracle <= 4.4.0 wrongly raises a DatabaseError for ORA-01400.\n             if hasattr(e.args[0], 'code') and e.args[0].code == 1400 and not isinstance(e, IntegrityError):\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def fetchone(self):\n         row = self.cursor.fetchone()\n@@ -810,7 +830,7 @@ def to_unicode(s):\n     Convert strings to Unicode objects (and return all other data types\n     unchanged).\n     \"\"\"\n-    if isinstance(s, basestring):\n+    if isinstance(s, six.string_types):\n         return force_unicode(s)\n     return s\n "
        },
        {
            "sha": "005c0a04b15ae97303ae5dc5cbaef777f5fb8f7e",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,6 +16,7 @@\n from django.db.backends.postgresql_psycopg2.schema import DatabaseSchemaEditor\n from django.utils.log import getLogger\n from django.utils.safestring import SafeUnicode, SafeString\n+from django.utils import six\n from django.utils.timezone import utc\n \n try:\n@@ -52,17 +53,17 @@ def execute(self, query, args=None):\n         try:\n             return self.cursor.execute(query, args)\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def executemany(self, query, args):\n         try:\n             return self.cursor.executemany(query, args)\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def __getattr__(self, attr):\n         if attr in self.__dict__:\n@@ -160,9 +161,11 @@ def _get_pg_version(self):\n     def _cursor(self):\n         settings_dict = self.settings_dict\n         if self.connection is None:\n-            if settings_dict['NAME'] == '':\n+            if not settings_dict['NAME']:\n                 from django.core.exceptions import ImproperlyConfigured\n-                raise ImproperlyConfigured(\"You need to specify NAME in your Django settings file.\")\n+                raise ImproperlyConfigured(\n+                    \"settings.DATABASES is improperly configured. \"\n+                    \"Please supply the NAME value.\")\n             conn_params = {\n                 'database': settings_dict['NAME'],\n             }\n@@ -237,7 +240,7 @@ def _commit(self):\n             try:\n                 return self.connection.commit()\n             except Database.IntegrityError as e:\n-                raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+                six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n \n     def schema_editor(self):\n         \"Returns a new instance of this backend's SchemaEditor\""
        },
        {
            "sha": "40fe62911023e89276e1917df8374585c64a6d81",
            "filename": "django/db/backends/postgresql_psycopg2/operations.py",
            "status": "modified",
            "additions": 19,
            "deletions": 15,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Foperations.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -85,25 +85,29 @@ def sql_flush(self, style, tables, sequences):\n                 (style.SQL_KEYWORD('TRUNCATE'),\n                     style.SQL_FIELD(', '.join([self.quote_name(table) for table in tables]))\n             )]\n-\n-            # 'ALTER SEQUENCE sequence_name RESTART WITH 1;'... style SQL statements\n-            # to reset sequence indices\n-            for sequence_info in sequences:\n-                table_name = sequence_info['table']\n-                column_name = sequence_info['column']\n-                if not (column_name and len(column_name) > 0):\n-                    # This will be the case if it's an m2m using an autogenerated\n-                    # intermediate table (see BaseDatabaseIntrospection.sequence_list)\n-                    column_name = 'id'\n-                sql.append(\"%s setval(pg_get_serial_sequence('%s','%s'), 1, false);\" % \\\n-                    (style.SQL_KEYWORD('SELECT'),\n-                    style.SQL_TABLE(self.quote_name(table_name)),\n-                    style.SQL_FIELD(column_name))\n-                )\n+            sql.extend(self.sequence_reset_by_name_sql(style, sequences))\n             return sql\n         else:\n             return []\n \n+    def sequence_reset_by_name_sql(self, style, sequences):\n+        # 'ALTER SEQUENCE sequence_name RESTART WITH 1;'... style SQL statements\n+        # to reset sequence indices\n+        sql = []\n+        for sequence_info in sequences:\n+            table_name = sequence_info['table']\n+            column_name = sequence_info['column']\n+            if not (column_name and len(column_name) > 0):\n+                # This will be the case if it's an m2m using an autogenerated\n+                # intermediate table (see BaseDatabaseIntrospection.sequence_list)\n+                column_name = 'id'\n+            sql.append(\"%s setval(pg_get_serial_sequence('%s','%s'), 1, false);\" % \\\n+                (style.SQL_KEYWORD('SELECT'),\n+                style.SQL_TABLE(self.quote_name(table_name)),\n+                style.SQL_FIELD(column_name))\n+            )\n+        return sql\n+\n     def tablespace_sql(self, tablespace, inline=False):\n         if inline:\n             return \"USING INDEX TABLESPACE %s\" % self.quote_name(tablespace)"
        },
        {
            "sha": "0a9744978929305fa58f05b459ffb3514f0bb0a1",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 18,
            "deletions": 8,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -21,6 +21,7 @@\n from django.utils.dateparse import parse_date, parse_datetime, parse_time\n from django.utils.functional import cached_property\n from django.utils.safestring import SafeString\n+from django.utils import six\n from django.utils import timezone\n \n try:\n@@ -85,7 +86,7 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     supports_1000_query_parameters = False\n     supports_mixed_date_datetime_comparisons = False\n     has_bulk_insert = True\n-    can_combine_inserts_with_and_without_auto_increment_pk = True\n+    can_combine_inserts_with_and_without_auto_increment_pk = False\n \n     @cached_property\n     def supports_stddev(self):\n@@ -107,6 +108,13 @@ def supports_stddev(self):\n         return has_support\n \n class DatabaseOperations(BaseDatabaseOperations):\n+    def bulk_batch_size(self, fields, objs):\n+        \"\"\"\n+        SQLite has a compile-time default (SQLITE_LIMIT_VARIABLE_NUMBER) of\n+        999 variables per query.\n+        \"\"\"\n+        return (999 // len(fields)) if len(fields) > 0 else len(objs)\n+\n     def date_extract_sql(self, lookup_type, field_name):\n         # sqlite doesn't support extract, so we fake it with the user-defined\n         # function django_extract that's registered in connect(). Note that\n@@ -169,7 +177,7 @@ def value_to_db_datetime(self, value):\n             else:\n                 raise ValueError(\"SQLite backend does not support timezone-aware datetimes when USE_TZ is False.\")\n \n-        return unicode(value)\n+        return six.text_type(value)\n \n     def value_to_db_time(self, value):\n         if value is None:\n@@ -179,7 +187,7 @@ def value_to_db_time(self, value):\n         if timezone.is_aware(value):\n             raise ValueError(\"SQLite backend does not support timezone-aware times.\")\n \n-        return unicode(value)\n+        return six.text_type(value)\n \n     def year_lookup_bounds(self, value):\n         first = '%s-01-01'\n@@ -250,7 +258,9 @@ def _sqlite_create_connection(self):\n         settings_dict = self.settings_dict\n         if not settings_dict['NAME']:\n             from django.core.exceptions import ImproperlyConfigured\n-            raise ImproperlyConfigured(\"Please fill out the database NAME in the settings module before using the database.\")\n+            raise ImproperlyConfigured(\n+                \"settings.DATABASES is improperly configured. \"\n+                \"Please supply the NAME value.\")\n         kwargs = {\n             'database': settings_dict['NAME'],\n             'detect_types': Database.PARSE_DECLTYPES | Database.PARSE_COLNAMES,\n@@ -339,18 +349,18 @@ def execute(self, query, params=()):\n         try:\n             return Database.Cursor.execute(self, query, params)\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def executemany(self, query, param_list):\n         query = self.convert_query(query)\n         try:\n             return Database.Cursor.executemany(self, query, param_list)\n         except Database.IntegrityError as e:\n-            raise utils.IntegrityError, utils.IntegrityError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.IntegrityError, utils.IntegrityError(*tuple(e.args)), sys.exc_info()[2])\n         except Database.DatabaseError as e:\n-            raise utils.DatabaseError, utils.DatabaseError(*tuple(e)), sys.exc_info()[2]\n+            six.reraise(utils.DatabaseError, utils.DatabaseError(*tuple(e.args)), sys.exc_info()[2])\n \n     def convert_query(self, query):\n         return FORMAT_QMARK_REGEX.sub('?', query).replace('%%','%')"
        },
        {
            "sha": "2ad89b3ed585a5efa6320f19c96a460b8af94f35",
            "filename": "django/db/models/__init__.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -15,8 +15,6 @@\n from django.db.models import signals\n from django.utils.decorators import wraps\n \n-# Admin stages.\n-ADD, CHANGE, BOTH = 1, 2, 3\n \n def permalink(func):\n     \"\"\""
        },
        {
            "sha": "002e2aff65975c10c4f990baf541a74d3a3007e6",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 69,
            "deletions": 49,
            "changes": 118,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,7 +3,7 @@\n import copy\n import sys\n from functools import update_wrapper\n-from future_builtins import zip\n+from django.utils.six.moves import zip\n \n import django.db.models.manager     # Imported to register signal handler.\n from django.conf import settings\n@@ -16,14 +16,15 @@\n from django.db import (router, transaction, DatabaseError,\n     DEFAULT_DB_ALIAS)\n from django.db.models.query import Q\n-from django.db.models.query_utils import DeferredAttribute\n+from django.db.models.query_utils import DeferredAttribute, deferred_class_factory\n from django.db.models.deletion import Collector\n from django.db.models.options import Options\n from django.db.models import signals\n from django.db.models.loading import register_models, get_model\n from django.utils.translation import ugettext_lazy as _\n from django.utils.functional import curry\n from django.utils.encoding import smart_str, force_unicode\n+from django.utils import six\n from django.utils.text import get_text_list, capfirst\n \n \n@@ -33,7 +34,10 @@ class ModelBase(type):\n     \"\"\"\n     def __new__(cls, name, bases, attrs):\n         super_new = super(ModelBase, cls).__new__\n-        parents = [b for b in bases if isinstance(b, ModelBase)]\n+        # six.with_metaclass() inserts an extra class called 'NewBase' in the\n+        # inheritance tree: Model -> NewBase -> object. Ignore this class.\n+        parents = [b for b in bases if isinstance(b, ModelBase) and\n+                not (b.__name__ == 'NewBase' and b.__mro__ == (b, object))]\n         if not parents:\n             # If this isn't a subclass of Model, don't do anything special.\n             return super_new(cls, name, bases, attrs)\n@@ -61,12 +65,14 @@ def __new__(cls, name, bases, attrs):\n         if not abstract:\n             new_class.add_to_class('DoesNotExist', subclass_exception(b'DoesNotExist',\n                     tuple(x.DoesNotExist\n-                            for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n-                                    or (ObjectDoesNotExist,), module))\n+                          for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n+                    or (ObjectDoesNotExist,),\n+                    module, attached_to=new_class))\n             new_class.add_to_class('MultipleObjectsReturned', subclass_exception(b'MultipleObjectsReturned',\n                     tuple(x.MultipleObjectsReturned\n-                            for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n-                                    or (MultipleObjectsReturned,), module))\n+                          for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n+                    or (MultipleObjectsReturned,),\n+                    module, attached_to=new_class))\n             if base_meta and not base_meta.abstract:\n                 # Non-abstract child classes inherit some attributes from their\n                 # non-abstract parent (unless an ABC comes before it in the\n@@ -273,8 +279,7 @@ def __init__(self, db=None):\n         # This impacts validation only; it has no effect on the actual save.\n         self.adding = True\n \n-class Model(object):\n-    __metaclass__ = ModelBase\n+class Model(six.with_metaclass(ModelBase, object)):\n     _deferred = False\n \n     def __init__(self, *args, **kwargs):\n@@ -372,7 +377,7 @@ def __init__(self, *args, **kwargs):\n \n     def __repr__(self):\n         try:\n-            u = unicode(self)\n+            u = six.text_type(self)\n         except (UnicodeEncodeError, UnicodeDecodeError):\n             u = '[Bad Unicode data]'\n         return smart_str('<%s: %s>' % (self.__class__.__name__, u))\n@@ -398,25 +403,16 @@ def __reduce__(self):\n         need to do things manually, as they're dynamically created classes and\n         only module-level classes can be pickled by the default path.\n         \"\"\"\n+        if not self._deferred:\n+            return super(Model, self).__reduce__()\n         data = self.__dict__\n-        model = self.__class__\n-        # The obvious thing to do here is to invoke super().__reduce__()\n-        # for the non-deferred case. Don't do that.\n-        # On Python 2.4, there is something weird with __reduce__,\n-        # and as a result, the super call will cause an infinite recursion.\n-        # See #10547 and #12121.\n         defers = []\n-        if self._deferred:\n-            from django.db.models.query_utils import deferred_class_factory\n-            factory = deferred_class_factory\n-            for field in self._meta.fields:\n-                if isinstance(self.__class__.__dict__.get(field.attname),\n-                        DeferredAttribute):\n-                    defers.append(field.attname)\n-            model = self._meta.proxy_for_model\n-        else:\n-            factory = simple_class_factory\n-        return (model_unpickle, (model, defers, factory), data)\n+        for field in self._meta.fields:\n+            if isinstance(self.__class__.__dict__.get(field.attname),\n+                    DeferredAttribute):\n+                defers.append(field.attname)\n+        model = self._meta.proxy_for_model\n+        return (model_unpickle, (model, defers), data)\n \n     def _get_pk_val(self, meta=None):\n         if not meta:\n@@ -466,8 +462,15 @@ def save(self, force_insert=False, force_update=False, using=None,\n                 return\n \n             update_fields = frozenset(update_fields)\n-            field_names = set([field.name for field in self._meta.fields\n-                               if not field.primary_key])\n+            field_names = set()\n+\n+            for field in self._meta.fields:\n+                if not field.primary_key:\n+                    field_names.add(field.name)\n+\n+                    if field.name != field.attname:\n+                        field_names.add(field.attname)\n+\n             non_model_fields = update_fields.difference(field_names)\n \n             if non_model_fields:\n@@ -532,7 +535,7 @@ def save_base(self, raw=False, cls=None, origin=None, force_insert=False,\n             non_pks = [f for f in meta.local_fields if not f.primary_key]\n \n             if update_fields:\n-                non_pks = [f for f in non_pks if f.name in update_fields]\n+                non_pks = [f for f in non_pks if f.name in update_fields or f.attname in update_fields]\n \n             # First, try an UPDATE. If that doesn't update anything, do an INSERT.\n             pk_val = self._get_pk_val(meta)\n@@ -789,8 +792,8 @@ def _perform_date_checks(self, date_checks):\n     def date_error_message(self, lookup_type, field, unique_for):\n         opts = self._meta\n         return _(\"%(field_name)s must be unique for %(date_field)s %(lookup)s.\") % {\n-            'field_name': unicode(capfirst(opts.get_field(field).verbose_name)),\n-            'date_field': unicode(capfirst(opts.get_field(unique_for).verbose_name)),\n+            'field_name': six.text_type(capfirst(opts.get_field(field).verbose_name)),\n+            'date_field': six.text_type(capfirst(opts.get_field(unique_for).verbose_name)),\n             'lookup': lookup_type,\n         }\n \n@@ -805,16 +808,16 @@ def unique_error_message(self, model_class, unique_check):\n             field_label = capfirst(field.verbose_name)\n             # Insert the error into the error dict, very sneaky\n             return field.error_messages['unique'] %  {\n-                'model_name': unicode(model_name),\n-                'field_label': unicode(field_label)\n+                'model_name': six.text_type(model_name),\n+                'field_label': six.text_type(field_label)\n             }\n         # unique_together\n         else:\n             field_labels = map(lambda f: capfirst(opts.get_field(f).verbose_name), unique_check)\n             field_labels = get_text_list(field_labels, _('and'))\n             return _(\"%(model_name)s with this %(field_label)s already exists.\") %  {\n-                'model_name': unicode(model_name),\n-                'field_label': unicode(field_labels)\n+                'model_name': six.text_type(model_name),\n+                'field_label': six.text_type(field_labels)\n             }\n \n     def full_clean(self, exclude=None):\n@@ -876,6 +879,7 @@ def clean_fields(self, exclude=None):\n             raise ValidationError(errors)\n \n \n+\n ############################################\n # HELPER FUNCTIONS (CURRIED MODEL METHODS) #\n ############################################\n@@ -917,22 +921,38 @@ def get_absolute_url(opts, func, self, *args, **kwargs):\n class Empty(object):\n     pass\n \n-def simple_class_factory(model, attrs):\n-    \"\"\"Used to unpickle Models without deferred fields.\n-\n-    We need to do this the hard way, rather than just using\n-    the default __reduce__ implementation, because of a\n-    __deepcopy__ problem in Python 2.4\n-    \"\"\"\n-    return model\n-\n-def model_unpickle(model, attrs, factory):\n+def model_unpickle(model, attrs):\n     \"\"\"\n     Used to unpickle Model subclasses with deferred fields.\n     \"\"\"\n-    cls = factory(model, attrs)\n+    cls = deferred_class_factory(model, attrs)\n     return cls.__new__(cls)\n model_unpickle.__safe_for_unpickle__ = True\n \n-def subclass_exception(name, parents, module):\n-    return type(name, parents, {'__module__': module})\n+def subclass_exception(name, parents, module, attached_to=None):\n+    \"\"\"\n+    Create exception subclass.\n+\n+    If 'attached_to' is supplied, the exception will be created in a way that\n+    allows it to be pickled, assuming the returned exception class will be added\n+    as an attribute to the 'attached_to' class.\n+    \"\"\"\n+    class_dict = {'__module__': module}\n+    if attached_to is not None:\n+        def __reduce__(self):\n+            # Exceptions are special - they've got state that isn't\n+            # in self.__dict__. We assume it is all in self.args.\n+            return (unpickle_inner_exception, (attached_to, name), self.args)\n+\n+        def __setstate__(self, args):\n+            self.args = args\n+\n+        class_dict['__reduce__'] = __reduce__\n+        class_dict['__setstate__'] = __setstate__\n+\n+    return type(name, parents, class_dict)\n+\n+def unpickle_inner_exception(klass, exception_name):\n+    # Get the exception class from the class it is attached to:\n+    exception = getattr(klass, exception_name)\n+    return exception.__new__(exception)"
        },
        {
            "sha": "9606b1b843669c950ebe0ecbce8a3a1d16ca8d92",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -21,6 +21,7 @@\n from django.utils.translation import ugettext_lazy as _\n from django.utils.encoding import smart_unicode, force_unicode\n from django.utils.ipv6 import clean_ipv6_address\n+from django.utils import six\n \n class NOT_PROVIDED:\n     pass\n@@ -625,7 +626,7 @@ def get_internal_type(self):\n         return \"CharField\"\n \n     def to_python(self, value):\n-        if isinstance(value, basestring) or value is None:\n+        if isinstance(value, six.string_types) or value is None:\n             return value\n         return smart_unicode(value)\n \n@@ -864,7 +865,7 @@ def to_python(self, value):\n             raise exceptions.ValidationError(msg)\n \n     def _format(self, value):\n-        if isinstance(value, basestring) or value is None:\n+        if isinstance(value, six.string_types) or value is None:\n             return value\n         else:\n             return self.format_number(value)\n@@ -1185,7 +1186,7 @@ def get_internal_type(self):\n         return \"TextField\"\n \n     def get_prep_value(self, value):\n-        if isinstance(value, basestring) or value is None:\n+        if isinstance(value, six.string_types) or value is None:\n             return value\n         return smart_unicode(value)\n "
        },
        {
            "sha": "b51ef1d5d61876599222b6fdf72916a533f0de8b",
            "filename": "django/db/models/fields/files.py",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,6 +9,7 @@\n from django.core.files.images import ImageFile\n from django.db.models import signals\n from django.utils.encoding import force_unicode, smart_str\n+from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n \n class FieldFile(File):\n@@ -176,7 +177,7 @@ def __get__(self, instance=None, owner=None):\n         # subclasses might also want to subclass the attribute class]. This\n         # object understands how to convert a path to a file, and also how to\n         # handle None.\n-        if isinstance(file, basestring) or file is None:\n+        if isinstance(file, six.string_types) or file is None:\n             attr = self.field.attr_class(instance, self.field, file)\n             instance.__dict__[self.field.name] = attr\n \n@@ -242,7 +243,11 @@ def validate(self, value, model_instance):\n         # (ie. upload_to='path/to/upload/dir'), the length of the generated\n         # name equals the length of the uploaded name plus a constant. Thus\n         # we can tell the user how much shorter the name should be (roughly).\n-        length = len(self.generate_filename(model_instance, value.name))\n+        if value and value._committed:\n+            filename = value.name\n+        else:\n+            filename = self.generate_filename(model_instance, value.name)\n+        length = len(filename)\n         if self.max_length and length > self.max_length:\n             error_values = {'extra': length - self.max_length}\n             raise ValidationError(self.error_messages['max_length'] % error_values)\n@@ -260,7 +265,7 @@ def get_prep_value(self, value):\n         # Need to convert File objects provided via a form to unicode for database insertion\n         if value is None:\n             return None\n-        return unicode(value)\n+        return six.text_type(value)\n \n     def pre_save(self, model_instance, add):\n         \"Returns field's value just before saving.\""
        },
        {
            "sha": "2a2502b54ffe65a58fd0058d0e84d7bb495d6b18",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,7 @@\n from django.db.models.query_utils import QueryWrapper\n from django.db.models.deletion import CASCADE\n from django.utils.encoding import smart_unicode\n+from django.utils import six\n from django.utils.translation import ugettext_lazy as _, string_concat\n from django.utils.functional import curry, cached_property\n from django.core import exceptions\n@@ -104,7 +105,7 @@ def contribute_to_class(self, cls, name):\n                 }\n \n         other = self.rel.to\n-        if isinstance(other, basestring) or other._meta.pk is None:\n+        if isinstance(other, six.string_types) or other._meta.pk is None:\n             def resolve_related_class(field, model, cls):\n                 field.rel.to = model\n                 field.do_related_class(model, cls)\n@@ -865,7 +866,7 @@ def __init__(self, to, field_name, related_name=None, limit_choices_to=None,\n         try:\n             to._meta\n         except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n-            assert isinstance(to, basestring), \"'to' must be either a model, a model name or the string %r\" % RECURSIVE_RELATIONSHIP_CONSTANT\n+            assert isinstance(to, six.string_types), \"'to' must be either a model, a model name or the string %r\" % RECURSIVE_RELATIONSHIP_CONSTANT\n         self.to, self.field_name = to, field_name\n         self.related_name = related_name\n         if limit_choices_to is None:\n@@ -933,7 +934,7 @@ def __init__(self, to, to_field=None, rel_class=ManyToOneRel, **kwargs):\n         try:\n             to_name = to._meta.object_name.lower()\n         except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n-            assert isinstance(to, basestring), \"%s(%r) is invalid. First parameter to ForeignKey must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n+            assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ForeignKey must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n         else:\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n             # For backwards compatibility purposes, we need to *try* and set\n@@ -1004,7 +1005,7 @@ def value_to_string(self, obj):\n     def contribute_to_class(self, cls, name):\n         super(ForeignKey, self).contribute_to_class(cls, name)\n         setattr(cls, self.name, ReverseSingleRelatedObjectDescriptor(self))\n-        if isinstance(self.rel.to, basestring):\n+        if isinstance(self.rel.to, six.string_types):\n             target = self.rel.to\n         else:\n             target = self.rel.to._meta.db_table\n@@ -1022,7 +1023,7 @@ def contribute_to_related_class(self, cls, related):\n \n     def formfield(self, **kwargs):\n         db = kwargs.pop('using', None)\n-        if isinstance(self.rel.to, basestring):\n+        if isinstance(self.rel.to, six.string_types):\n             raise ValueError(\"Cannot create form field for %r yet, because \"\n                              \"its related model %r has not been loaded yet\" %\n                              (self.name, self.rel.to))\n@@ -1079,13 +1080,13 @@ def save_form_data(self, instance, data):\n def create_many_to_many_intermediary_model(field, klass):\n     from django.db import models\n     managed = True\n-    if isinstance(field.rel.to, basestring) and field.rel.to != RECURSIVE_RELATIONSHIP_CONSTANT:\n+    if isinstance(field.rel.to, six.string_types) and field.rel.to != RECURSIVE_RELATIONSHIP_CONSTANT:\n         to_model = field.rel.to\n         to = to_model.split('.')[-1]\n         def set_managed(field, model, cls):\n             field.rel.through._meta.managed = model._meta.managed or cls._meta.managed\n         add_lazy_relation(klass, field, to_model, set_managed)\n-    elif isinstance(field.rel.to, basestring):\n+    elif isinstance(field.rel.to, six.string_types):\n         to = klass._meta.object_name\n         to_model = klass\n         managed = klass._meta.managed\n@@ -1124,7 +1125,7 @@ def __init__(self, to, **kwargs):\n         try:\n             assert not to._meta.abstract, \"%s cannot define a relation with abstract class %s\" % (self.__class__.__name__, to._meta.object_name)\n         except AttributeError: # to._meta doesn't exist, so it must be RECURSIVE_RELATIONSHIP_CONSTANT\n-            assert isinstance(to, basestring), \"%s(%r) is invalid. First parameter to ManyToManyField must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n+            assert isinstance(to, six.string_types), \"%s(%r) is invalid. First parameter to ManyToManyField must be either a model, a model name, or the string %r\" % (self.__class__.__name__, to, RECURSIVE_RELATIONSHIP_CONSTANT)\n             # Python 2.6 and earlier require dictionary keys to be of str type,\n             # not unicode and class names must be ASCII (in Python 2.x), so we\n             # forcibly coerce it here (breaks early if there's a problem).\n@@ -1232,12 +1233,12 @@ def contribute_to_class(self, cls, name):\n \n         # Populate some necessary rel arguments so that cross-app relations\n         # work correctly.\n-        if isinstance(self.rel.through, basestring):\n+        if isinstance(self.rel.through, six.string_types):\n             def resolve_through_model(field, model, cls):\n                 field.rel.through = model\n             add_lazy_relation(cls, self, self.rel.through, resolve_through_model)\n \n-        if isinstance(self.rel.to, basestring):\n+        if isinstance(self.rel.to, six.string_types):\n             target = self.rel.to\n         else:\n             target = self.rel.to._meta.db_table"
        },
        {
            "sha": "d651584e7af5da6116d9699db57196e36730f268",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,9 +6,9 @@\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n \n+import imp\n import sys\n import os\n-import threading\n \n __all__ = ('get_apps', 'get_app', 'get_models', 'get_model', 'register_models',\n         'load_app', 'app_cache_ready')\n@@ -39,7 +39,6 @@ class AppCache(object):\n         handled = {},\n         postponed = [],\n         nesting_level = 0,\n-        write_lock = threading.RLock(),\n         _get_models_cache = {},\n     )\n \n@@ -54,7 +53,13 @@ def _populate(self):\n         \"\"\"\n         if self.loaded:\n             return\n-        self.write_lock.acquire()\n+        # Note that we want to use the import lock here - the app loading is\n+        # in many cases initiated implicitly by importing, and thus it is\n+        # possible to end up in deadlock when one thread initiates loading\n+        # without holding the importer lock and another thread then tries to\n+        # import something which also launches the app loading. For details of\n+        # this situation see #18251.\n+        imp.acquire_lock()\n         try:\n             if self.loaded:\n                 return\n@@ -67,7 +72,7 @@ def _populate(self):\n                     self.load_app(app_name)\n                 self.loaded = True\n         finally:\n-            self.write_lock.release()\n+            imp.release_lock()\n \n     def _label_for(self, app_mod):\n         \"\"\"\n@@ -138,7 +143,7 @@ def get_app(self, app_label, emptyOK=False):\n         the app has no models in it and 'emptyOK' is True, returns None.\n         \"\"\"\n         self._populate()\n-        self.write_lock.acquire()\n+        imp.acquire_lock()\n         try:\n             for app_name in settings.INSTALLED_APPS:\n                 if app_label == app_name.split('.')[-1]:\n@@ -151,7 +156,7 @@ def get_app(self, app_label, emptyOK=False):\n                         return mod\n             raise ImproperlyConfigured(\"App with label %s could not be found\" % app_label)\n         finally:\n-            self.write_lock.release()\n+            imp.release_lock()\n \n     def get_app_errors(self):\n         \"Returns the map of known problems with the INSTALLED_APPS.\""
        },
        {
            "sha": "7308a15c6bd12e7c4324fd13de3f214d72ec6780",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,6 +10,7 @@\n from django.utils.translation import activate, deactivate_all, get_language, string_concat\n from django.utils.encoding import force_unicode, smart_str\n from django.utils.datastructures import SortedDict\n+from django.utils import six\n \n # Calculate the verbose_name by converting from InitialCaps to \"lowercase with spaces\".\n get_verbose_name = lambda class_name: re.sub('(((?<=[a-z])[A-Z])|([A-Z](?![A-Z]|$)))', ' \\\\1', class_name).lower().strip()\n@@ -126,7 +127,7 @@ def _prepare(self, model):\n             if self.parents:\n                 # Promote the first parent link in lieu of adding yet another\n                 # field.\n-                field = self.parents.value_for_index(0)\n+                field = next(self.parents.itervalues())\n                 # Look for a local field with the same name as the\n                 # first parent link. If a local field has already been\n                 # created, use it instead of promoting the parent\n@@ -400,7 +401,7 @@ def _fill_related_objects_cache(self):\n         proxy_cache = cache.copy()\n         for klass in get_models(include_auto_created=True, only_installed=False):\n             for f in klass._meta.local_fields:\n-                if f.rel and not isinstance(f.rel.to, basestring):\n+                if f.rel and not isinstance(f.rel.to, six.string_types):\n                     if self == f.rel.to._meta:\n                         cache[RelatedObject(f.rel.to, klass, f)] = None\n                         proxy_cache[RelatedObject(f.rel.to, klass, f)] = None\n@@ -442,7 +443,7 @@ def _fill_related_many_to_many_cache(self):\n                     cache[obj] = model\n         for klass in get_models(only_installed=False):\n             for f in klass._meta.local_many_to_many:\n-                if f.rel and not isinstance(f.rel.to, basestring) and self == f.rel.to._meta:\n+                if f.rel and not isinstance(f.rel.to, six.string_types) and self == f.rel.to._meta:\n                     cache[RelatedObject(f.rel.to, klass, f)] = None\n         if app_cache_ready():\n             self._related_many_to_many_cache = cache"
        },
        {
            "sha": "8b6b42b7b1be447e8e4f7b50661493f307f77489",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 30,
            "deletions": 11,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -14,6 +14,7 @@\n from django.db.models.deletion import Collector\n from django.db.models import sql\n from django.utils.functional import partition\n+from django.utils import six\n \n # Used to control how many objects are worked with at once in some cases (e.g.\n # when deleting objects).\n@@ -168,7 +169,7 @@ def __getitem__(self, k):\n         \"\"\"\n         Retrieves an item or slice from the set of results.\n         \"\"\"\n-        if not isinstance(k, (slice, int, long)):\n+        if not isinstance(k, (slice,) + six.integer_types):\n             raise TypeError\n         assert ((not isinstance(k, slice) and (k >= 0))\n                 or (isinstance(k, slice) and (k.start is None or k.start >= 0)\n@@ -388,7 +389,7 @@ def create(self, **kwargs):\n         obj.save(force_insert=True, using=self.db)\n         return obj\n \n-    def bulk_create(self, objs):\n+    def bulk_create(self, objs, batch_size=None):\n         \"\"\"\n         Inserts each of the instances into the database. This does *not* call\n         save() on each of the instances, does not send any pre/post save\n@@ -401,8 +402,10 @@ def bulk_create(self, objs):\n         # this could be implemented if you didn't have an autoincrement pk,\n         # and 2) you could do it by doing O(n) normal inserts into the parent\n         # tables to get the primary keys back, and then doing a single bulk\n-        # insert into the childmost table. We're punting on these for now\n-        # because they are relatively rare cases.\n+        # insert into the childmost table. Some databases might allow doing\n+        # this by using RETURNING clause for the insert query. We're punting\n+        # on these for now because they are relatively rare cases.\n+        assert batch_size is None or batch_size > 0\n         if self.model._meta.parents:\n             raise ValueError(\"Can't bulk create an inherited model\")\n         if not objs:\n@@ -418,13 +421,14 @@ def bulk_create(self, objs):\n         try:\n             if (connection.features.can_combine_inserts_with_and_without_auto_increment_pk\n                 and self.model._meta.has_auto_field):\n-                self.model._base_manager._insert(objs, fields=fields, using=self.db)\n+                self._batched_insert(objs, fields, batch_size)\n             else:\n                 objs_with_pk, objs_without_pk = partition(lambda o: o.pk is None, objs)\n                 if objs_with_pk:\n-                    self.model._base_manager._insert(objs_with_pk, fields=fields, using=self.db)\n+                    self._batched_insert(objs_with_pk, fields, batch_size)\n                 if objs_without_pk:\n-                    self.model._base_manager._insert(objs_without_pk, fields=[f for f in fields if not isinstance(f, AutoField)], using=self.db)\n+                    fields= [f for f in fields if not isinstance(f, AutoField)]\n+                    self._batched_insert(objs_without_pk, fields, batch_size)\n             if forced_managed:\n                 transaction.commit(using=self.db)\n             else:\n@@ -467,7 +471,7 @@ def get_or_create(self, **kwargs):\n                     return self.get(**lookup), False\n                 except self.model.DoesNotExist:\n                     # Re-raise the IntegrityError with its original traceback.\n-                    raise exc_info[1], None, exc_info[2]\n+                    six.reraise(exc_info[1], None, exc_info[2])\n \n     def latest(self, field_name=None):\n         \"\"\"\n@@ -860,6 +864,20 @@ def db(self):\n     ###################\n     # PRIVATE METHODS #\n     ###################\n+    def _batched_insert(self, objs, fields, batch_size):\n+        \"\"\"\n+        A little helper method for bulk_insert to insert the bulk one batch\n+        at a time. Inserts recursively a batch from the front of the bulk and\n+        then _batched_insert() the remaining objects again.\n+        \"\"\"\n+        if not objs:\n+            return\n+        ops = connections[self.db].ops\n+        batch_size = (batch_size or max(ops.bulk_batch_size(fields, objs), 1))\n+        for batch in [objs[i:i+batch_size]\n+                      for i in range(0, len(objs), batch_size)]:\n+            self.model._base_manager._insert(batch, fields=fields,\n+                                             using=self.db)\n \n     def _clone(self, klass=None, setup=False, **kwargs):\n         if klass is None:\n@@ -1296,7 +1314,7 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n         # Build the list of fields that *haven't* been requested\n         for field, model in klass._meta.get_fields_with_model():\n             if field.name not in load_fields:\n-                skip.add(field.name)\n+                skip.add(field.attname)\n             elif local_only and model is not None:\n                 continue\n             else:\n@@ -1327,7 +1345,7 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n \n     related_fields = []\n     for f in klass._meta.fields:\n-        if select_related_descend(f, restricted, requested):\n+        if select_related_descend(f, restricted, requested, load_fields):\n             if restricted:\n                 next = requested[f.name]\n             else:\n@@ -1339,7 +1357,8 @@ def get_klass_info(klass, max_depth=0, cur_depth=0, requested=None,\n     reverse_related_fields = []\n     if restricted:\n         for o in klass._meta.get_all_related_objects():\n-            if o.field.unique and select_related_descend(o.field, restricted, requested, reverse=True):\n+            if o.field.unique and select_related_descend(o.field, restricted, requested,\n+                                                         only_load.get(o.model), reverse=True):\n                 next = requested[o.field.related_query_name()]\n                 klass_info = get_klass_info(o.model, max_depth=max_depth, cur_depth=cur_depth+1,\n                                             requested=next, only_load=only_load, local_only=True)"
        },
        {
            "sha": "60bdb2bcb4dbfe813cd68eb943347b905d2bbe04",
            "filename": "django/db/models/query_utils.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fquery_utils.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fquery_utils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery_utils.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -126,18 +126,19 @@ def _check_parent_chain(self, instance, name):\n         return None\n \n \n-def select_related_descend(field, restricted, requested, reverse=False):\n+def select_related_descend(field, restricted, requested, load_fields, reverse=False):\n     \"\"\"\n     Returns True if this field should be used to descend deeper for\n     select_related() purposes. Used by both the query construction code\n     (sql.query.fill_related_selections()) and the model instance creation code\n-    (query.get_cached_row()).\n+    (query.get_klass_info()).\n \n     Arguments:\n      * field - the field to be checked\n      * restricted - a boolean field, indicating if the field list has been\n        manually restricted using a requested clause)\n      * requested - The select_related() dictionary.\n+     * load_fields - the set of fields to be loaded on this model\n      * reverse - boolean, True if we are checking a reverse select related\n     \"\"\"\n     if not field.rel:\n@@ -151,6 +152,14 @@ def select_related_descend(field, restricted, requested, reverse=False):\n             return False\n     if not restricted and field.null:\n         return False\n+    if load_fields:\n+        if field.name not in load_fields:\n+            if restricted and field.name in requested:\n+                raise InvalidQuery(\"Field %s.%s cannot be both deferred\"\n+                                   \" and traversed using select_related\"\n+                                   \" at the same time.\" %\n+                                   (field.model._meta.object_name, field.name))\n+            return False\n     return True\n \n # This function is needed because data descriptors must be defined on a class"
        },
        {
            "sha": "7a0afa349d8d8b1341979ec1bbb100f8eeda4210",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,4 +1,4 @@\n-from future_builtins import zip\n+from django.utils.six.moves import zip\n \n from django.core.exceptions import FieldError\n from django.db import transaction\n@@ -596,6 +596,7 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n         if avoid_set is None:\n             avoid_set = set()\n         orig_dupe_set = dupe_set\n+        only_load = self.query.get_loaded_field_names()\n \n         # Setup for the case when only particular related fields should be\n         # included in the related selection.\n@@ -607,7 +608,8 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                 restricted = False\n \n         for f, model in opts.get_fields_with_model():\n-            if not select_related_descend(f, restricted, requested):\n+            if not select_related_descend(f, restricted, requested,\n+                                          only_load.get(model or self.query.model)):\n                 continue\n             # The \"avoid\" set is aliases we want to avoid just for this\n             # particular branch of the recursion. They aren't permanently\n@@ -680,7 +682,8 @@ def fill_related_selections(self, opts=None, root_alias=None, cur_depth=1,\n                 if o.field.unique\n             ]\n             for f, model in related_fields:\n-                if not select_related_descend(f, restricted, requested, reverse=True):\n+                if not select_related_descend(f, restricted, requested,\n+                                              only_load.get(model), reverse=True):\n                     continue\n                 # The \"avoid\" set is aliases we want to avoid just for this\n                 # particular branch of the recursion. They aren't permanently"
        },
        {
            "sha": "b8e06daf01a748ea3b516fd6cef103598c34be95",
            "filename": "django/db/models/sql/datastructures.py",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fdatastructures.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,9 +6,6 @@\n class EmptyResultSet(Exception):\n     pass\n \n-class FullResultSet(Exception):\n-    pass\n-\n class MultiJoin(Exception):\n     \"\"\"\n     Used by join construction code to indicate the point at which a"
        },
        {
            "sha": "53dad608bf78d01e25e124e3b2e76818ae6ad74f",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 18,
            "deletions": 7,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1655,10 +1655,15 @@ def add_fields(self, field_names, allow_m2m=True):\n         except MultiJoin:\n             raise FieldError(\"Invalid field name: '%s'\" % name)\n         except FieldError:\n-            names = opts.get_all_field_names() + self.extra.keys() + self.aggregate_select.keys()\n-            names.sort()\n-            raise FieldError(\"Cannot resolve keyword %r into field. \"\n-                    \"Choices are: %s\" % (name, \", \".join(names)))\n+            if LOOKUP_SEP in name:\n+                # For lookups spanning over relationships, show the error\n+                # from the model on which the lookup failed.\n+                raise\n+            else:\n+                names = sorted(opts.get_all_field_names() + self.extra.keys()\n+                               + self.aggregate_select.keys())\n+                raise FieldError(\"Cannot resolve keyword %r into field. \"\n+                                 \"Choices are: %s\" % (name, \", \".join(names)))\n         self.remove_inherited_models()\n \n     def add_ordering(self, *ordering):\n@@ -1845,9 +1850,15 @@ def get_loaded_field_names(self):\n \n         If no fields are marked for deferral, returns an empty dictionary.\n         \"\"\"\n-        collection = {}\n-        self.deferred_to_data(collection, self.get_loaded_field_names_cb)\n-        return collection\n+        # We cache this because we call this function multiple times\n+        # (compiler.fill_related_selections, query.iterator)\n+        try:\n+            return self._loaded_field_names_cache\n+        except AttributeError:\n+            collection = {}\n+            self.deferred_to_data(collection, self.get_loaded_field_names_cb)\n+            self._loaded_field_names_cache = collection\n+            return collection\n \n     def get_loaded_field_names_cb(self, target, model, fields):\n         \"\"\""
        },
        {
            "sha": "7b92394e906abbb1711d8294bcc471f068a5b27c",
            "filename": "django/db/models/sql/subqueries.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,6 +8,7 @@\n from django.db.models.sql.datastructures import Date\n from django.db.models.sql.query import Query\n from django.db.models.sql.where import AND, Constraint\n+from django.utils.datastructures import SortedDict\n from django.utils.functional import Promise\n from django.utils.encoding import force_unicode\n \n@@ -205,6 +206,7 @@ def add_date_select(self, field_name, lookup_type, order='ASC'):\n         self.select = [select]\n         self.select_fields = [None]\n         self.select_related = False # See #7097.\n+        self.aggregates = SortedDict() # See 18056.\n         self.set_extra_mask([])\n         self.distinct = True\n         self.order_by = order == 'ASC' and [1] or [-1]"
        },
        {
            "sha": "47f4ffaba98e38dfc3e1b0d33207e4d40f2003fd",
            "filename": "django/db/models/sql/where.py",
            "status": "modified",
            "additions": 50,
            "deletions": 33,
            "changes": 83,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,8 +10,9 @@\n \n from django.utils import tree\n from django.db.models.fields import Field\n-from django.db.models.sql.datastructures import EmptyResultSet, FullResultSet\n+from django.db.models.sql.datastructures import EmptyResultSet\n from django.db.models.sql.aggregates import Aggregate\n+from django.utils.six.moves import xrange\n \n # Connection types\n AND = 'AND'\n@@ -75,56 +76,72 @@ def add(self, data, connector):\n     def as_sql(self, qn, connection):\n         \"\"\"\n         Returns the SQL version of the where clause and the value to be\n-        substituted in. Returns None, None if this node is empty.\n-\n-        If 'node' is provided, that is the root of the SQL generation\n-        (generally not needed except by the internal implementation for\n-        recursion).\n+        substituted in. Returns '', [] if this node matches everything,\n+        None, [] if this node is empty, and raises EmptyResultSet if this\n+        node can't match anything.\n         \"\"\"\n-        if not self.children:\n-            return None, []\n+        # Note that the logic here is made slightly more complex than\n+        # necessary because there are two kind of empty nodes: Nodes\n+        # containing 0 children, and nodes that are known to match everything.\n+        # A match-everything node is different than empty node (which also\n+        # technically matches everything) for backwards compatibility reasons.\n+        # Refs #5261.\n         result = []\n         result_params = []\n-        empty = True\n+        everything_childs, nothing_childs = 0, 0\n+        non_empty_childs = len(self.children)\n+\n         for child in self.children:\n             try:\n                 if hasattr(child, 'as_sql'):\n                     sql, params = child.as_sql(qn=qn, connection=connection)\n                 else:\n                     # A leaf node in the tree.\n                     sql, params = self.make_atom(child, qn, connection)\n-\n             except EmptyResultSet:\n-                if self.connector == AND and not self.negated:\n-                    # We can bail out early in this particular case (only).\n-                    raise\n-                elif self.negated:\n-                    empty = False\n-                continue\n-            except FullResultSet:\n-                if self.connector == OR:\n-                    if self.negated:\n-                        empty = True\n-                        break\n-                    # We match everything. No need for any constraints.\n+                nothing_childs += 1\n+            else:\n+                if sql:\n+                    result.append(sql)\n+                    result_params.extend(params)\n+                else:\n+                    if sql is None:\n+                        # Skip empty childs totally.\n+                        non_empty_childs -= 1\n+                        continue\n+                    everything_childs += 1\n+            # Check if this node matches nothing or everything.\n+            # First check the amount of full nodes and empty nodes\n+            # to make this node empty/full.\n+            if self.connector == AND:\n+                full_needed, empty_needed = non_empty_childs, 1\n+            else:\n+                full_needed, empty_needed = 1, non_empty_childs\n+            # Now, check if this node is full/empty using the\n+            # counts.\n+            if empty_needed - nothing_childs <= 0:\n+                if self.negated:\n                     return '', []\n+                else:\n+                    raise EmptyResultSet\n+            if full_needed - everything_childs <= 0:\n                 if self.negated:\n-                    empty = True\n-                continue\n-\n-            empty = False\n-            if sql:\n-                result.append(sql)\n-                result_params.extend(params)\n-        if empty:\n-            raise EmptyResultSet\n+                    raise EmptyResultSet\n+                else:\n+                    return '', []\n \n+        if non_empty_childs == 0:\n+            # All the child nodes were empty, so this one is empty, too.\n+            return None, []\n         conn = ' %s ' % self.connector\n         sql_string = conn.join(result)\n         if sql_string:\n             if self.negated:\n+                # Some backends (Oracle at least) need parentheses\n+                # around the inner SQL in the negated case, even if the\n+                # inner SQL contains just a single expression.\n                 sql_string = 'NOT (%s)' % sql_string\n-            elif len(self.children) != 1:\n+            elif len(result) > 1:\n                 sql_string = '(%s)' % sql_string\n         return sql_string, result_params\n \n@@ -261,7 +278,7 @@ class EverythingNode(object):\n     \"\"\"\n \n     def as_sql(self, qn=None, connection=None):\n-        raise FullResultSet\n+        return '', []\n \n     def relabel_aliases(self, change_map, node=None):\n         return"
        },
        {
            "sha": "0ce09bab70ed8f1c03fc302a732dba6a15c2904f",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,6 +4,7 @@\n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.importlib import import_module\n+from django.utils import six\n \n \n DEFAULT_DB_ALIAS = 'default'\n@@ -108,7 +109,7 @@ class ConnectionRouter(object):\n     def __init__(self, routers):\n         self.routers = []\n         for r in routers:\n-            if isinstance(r, basestring):\n+            if isinstance(r, six.string_types):\n                 try:\n                     module_name, klass_name = r.rsplit('.', 1)\n                     module = import_module(module_name)"
        },
        {
            "sha": "ad7302176ef84d000186225930ca2bf875be5a58",
            "filename": "django/dispatch/dispatcher.py",
            "status": "modified",
            "additions": 34,
            "deletions": 34,
            "changes": 68,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdispatch%2Fdispatcher.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fdispatch%2Fdispatcher.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fdispatcher.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n import threading\n \n from django.dispatch import saferef\n+from django.utils.six.moves import xrange\n \n WEAKREF_TYPES = (weakref.ReferenceType, saferef.BoundMethodWeakref)\n \n@@ -13,17 +14,17 @@ def _make_id(target):\n class Signal(object):\n     \"\"\"\n     Base class for all signals\n-    \n+\n     Internal attributes:\n-    \n+\n         receivers\n             { receriverkey (id) : weakref(receiver) }\n     \"\"\"\n-    \n+\n     def __init__(self, providing_args=None):\n         \"\"\"\n         Create a new signal.\n-        \n+\n         providing_args\n             A list of the arguments this signal can pass along in a send() call.\n         \"\"\"\n@@ -36,17 +37,17 @@ def __init__(self, providing_args=None):\n     def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):\n         \"\"\"\n         Connect receiver to sender for signal.\n-    \n+\n         Arguments:\n-        \n+\n             receiver\n                 A function or an instance method which is to receive signals.\n                 Receivers must be hashable objects.\n \n                 If weak is True, then receiver must be weak-referencable (more\n                 precisely saferef.safeRef() must be able to create a reference\n                 to the receiver).\n-        \n+\n                 Receivers must be able to accept keyword arguments.\n \n                 If receivers have a dispatch_uid attribute, the receiver will\n@@ -62,19 +63,19 @@ def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):\n                 module will attempt to use weak references to the receiver\n                 objects. If this parameter is false, then strong references will\n                 be used.\n-        \n+\n             dispatch_uid\n                 An identifier used to uniquely identify a particular instance of\n                 a receiver. This will usually be a string, though it may be\n                 anything hashable.\n         \"\"\"\n         from django.conf import settings\n-        \n+\n         # If DEBUG is on, check that we got a good receiver\n         if settings.DEBUG:\n             import inspect\n             assert callable(receiver), \"Signal receivers must be callable.\"\n-            \n+\n             # Check for **kwargs\n             # Not all callables are inspectable with getargspec, so we'll\n             # try a couple different ways but in the end fall back on assuming\n@@ -90,7 +91,7 @@ def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):\n             if argspec:\n                 assert argspec[2] is not None, \\\n                     \"Signal receivers must accept keyword arguments (**kwargs).\"\n-        \n+\n         if dispatch_uid:\n             lookup_key = (dispatch_uid, _make_id(sender))\n         else:\n@@ -99,52 +100,46 @@ def connect(self, receiver, sender=None, weak=True, dispatch_uid=None):\n         if weak:\n             receiver = saferef.safeRef(receiver, onDelete=self._remove_receiver)\n \n-        self.lock.acquire()\n-        try:\n+        with self.lock:\n             for r_key, _ in self.receivers:\n                 if r_key == lookup_key:\n                     break\n             else:\n                 self.receivers.append((lookup_key, receiver))\n-        finally:\n-            self.lock.release()\n \n     def disconnect(self, receiver=None, sender=None, weak=True, dispatch_uid=None):\n         \"\"\"\n         Disconnect receiver from sender for signal.\n \n         If weak references are used, disconnect need not be called. The receiver\n         will be remove from dispatch automatically.\n-    \n+\n         Arguments:\n-        \n+\n             receiver\n                 The registered receiver to disconnect. May be none if\n                 dispatch_uid is specified.\n-            \n+\n             sender\n                 The registered sender to disconnect\n-            \n+\n             weak\n                 The weakref state to disconnect\n-            \n+\n             dispatch_uid\n                 the unique identifier of the receiver to disconnect\n         \"\"\"\n         if dispatch_uid:\n             lookup_key = (dispatch_uid, _make_id(sender))\n         else:\n             lookup_key = (_make_id(receiver), _make_id(sender))\n-        \n-        self.lock.acquire()\n-        try:\n+\n+        with self.lock:\n             for index in xrange(len(self.receivers)):\n                 (r_key, _) = self.receivers[index]\n                 if r_key == lookup_key:\n                     del self.receivers[index]\n                     break\n-        finally:\n-            self.lock.release()\n \n     def send(self, sender, **named):\n         \"\"\"\n@@ -155,10 +150,10 @@ def send(self, sender, **named):\n         receivers called if a raises an error.\n \n         Arguments:\n-        \n+\n             sender\n                 The sender of the signal Either a specific object or None.\n-    \n+\n             named\n                 Named arguments which will be passed to receivers.\n \n@@ -178,7 +173,7 @@ def send_robust(self, sender, **named):\n         Send signal from sender to all connected receivers catching errors.\n \n         Arguments:\n-        \n+\n             sender\n                 The sender of the signal. Can be any python object (normally one\n                 registered with a connect if you actually want something to\n@@ -237,8 +232,7 @@ def _remove_receiver(self, receiver):\n         Remove dead receivers from connections.\n         \"\"\"\n \n-        self.lock.acquire()\n-        try:\n+        with self.lock:\n             to_remove = []\n             for key, connected_receiver in self.receivers:\n                 if connected_receiver == receiver:\n@@ -250,21 +244,27 @@ def _remove_receiver(self, receiver):\n                 for idx, (r_key, _) in enumerate(reversed(self.receivers)):\n                     if r_key == key:\n                         del self.receivers[last_idx-idx]\n-        finally:\n-            self.lock.release()\n \n \n def receiver(signal, **kwargs):\n     \"\"\"\n     A decorator for connecting receivers to signals. Used by passing in the\n-    signal and keyword arguments to connect::\n+    signal (or list of signals) and keyword arguments to connect::\n \n         @receiver(post_save, sender=MyModel)\n         def signal_receiver(sender, **kwargs):\n             ...\n \n+        @receiver([post_save, post_delete], sender=MyModel)\n+        def signals_receiver(sender, **kwargs):\n+            ...\n+\n     \"\"\"\n     def _decorator(func):\n-        signal.connect(func, **kwargs)\n+        if isinstance(signal, (list, tuple)):\n+            for s in signal:\n+                s.connect(func, **kwargs)\n+        else:\n+            signal.connect(func, **kwargs)\n         return func\n     return _decorator"
        },
        {
            "sha": "4e11a4ee062b922f1a1a13396ba023406ac28101",
            "filename": "django/forms/extras/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fextras%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fextras%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fextras%2Fwidgets.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.dates import MONTHS\n from django.utils.safestring import mark_safe\n from django.utils.formats import get_format\n+from django.utils import six\n from django.conf import settings\n \n __all__ = ('SelectDateWidget',)\n@@ -64,7 +65,7 @@ def render(self, name, value, attrs=None):\n             year_val, month_val, day_val = value.year, value.month, value.day\n         except AttributeError:\n             year_val = month_val = day_val = None\n-            if isinstance(value, basestring):\n+            if isinstance(value, six.string_types):\n                 if settings.USE_L10N:\n                     try:\n                         input_format = get_format('DATE_INPUT_FORMATS')[0]"
        },
        {
            "sha": "c4a675da747f7a322423860900a1289aa9838926",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 12,
            "deletions": 8,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,7 +8,10 @@\n import datetime\n import os\n import re\n-import urlparse\n+try:\n+    from urllib.parse import urlsplit, urlunsplit\n+except ImportError:     # Python 2\n+    from urlparse import urlsplit, urlunsplit\n from decimal import Decimal, DecimalException\n from io import BytesIO\n \n@@ -22,6 +25,7 @@\n from django.utils import formats\n from django.utils.encoding import smart_unicode, force_unicode\n from django.utils.ipv6 import clean_ipv6_address\n+from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n \n # Provide this import for backwards compatibility.\n@@ -330,10 +334,10 @@ def __init__(self, input_formats=None, *args, **kwargs):\n     def to_python(self, value):\n         # Try to coerce the value to unicode.\n         unicode_value = force_unicode(value, strings_only=True)\n-        if isinstance(unicode_value, unicode):\n+        if isinstance(unicode_value, six.text_type):\n             value = unicode_value.strip()\n         # If unicode, try to strptime against each input format.\n-        if isinstance(value, unicode):\n+        if isinstance(value, six.text_type):\n             for format in self.input_formats:\n                 try:\n                     return self.strptime(value, format)\n@@ -445,7 +449,7 @@ def _get_regex(self):\n         return self._regex\n \n     def _set_regex(self, regex):\n-        if isinstance(regex, basestring):\n+        if isinstance(regex, six.string_types):\n             regex = re.compile(regex, re.UNICODE)\n         self._regex = regex\n         if hasattr(self, '_regex_validator') and self._regex_validator in self.validators:\n@@ -598,7 +602,7 @@ def split_url(url):\n             ``ValidationError`` exception for certain).\n             \"\"\"\n             try:\n-                return list(urlparse.urlsplit(url))\n+                return list(urlsplit(url))\n             except ValueError:\n                 # urlparse.urlsplit can raise a ValueError with some\n                 # misformatted URLs.\n@@ -617,11 +621,11 @@ def split_url(url):\n                 url_fields[2] = ''\n                 # Rebuild the url_fields list, since the domain segment may now\n                 # contain the path too.\n-                url_fields = split_url(urlparse.urlunsplit(url_fields))\n+                url_fields = split_url(urlunsplit(url_fields))\n             if not url_fields[2]:\n                 # the path portion may need to be added before query params\n                 url_fields[2] = '/'\n-            value = urlparse.urlunsplit(url_fields)\n+            value = urlunsplit(url_fields)\n         return value\n \n class BooleanField(Field):\n@@ -633,7 +637,7 @@ def to_python(self, value):\n         # will submit for False. Also check for '0', since this is what\n         # RadioSelect will provide. Because bool(\"True\") == bool('1') == True,\n         # we don't need to handle that explicitly.\n-        if isinstance(value, basestring) and value.lower() in ('false', '0'):\n+        if isinstance(value, six.string_types) and value.lower() in ('false', '0'):\n             value = False\n         else:\n             value = bool(value)"
        },
        {
            "sha": "4bc3ee9d264f56822734cb92620605b946bf0e64",
            "filename": "django/forms/forms.py",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fforms.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -11,9 +11,10 @@\n from django.forms.util import flatatt, ErrorDict, ErrorList\n from django.forms.widgets import Media, media_property, TextInput, Textarea\n from django.utils.datastructures import SortedDict\n-from django.utils.html import conditional_escape\n+from django.utils.html import conditional_escape, format_html\n from django.utils.encoding import StrAndUnicode, smart_unicode, force_unicode\n from django.utils.safestring import mark_safe\n+from django.utils import six\n \n \n __all__ = ('BaseForm', 'Form')\n@@ -150,7 +151,7 @@ def _html_output(self, normal_row, error_row, row_ender, help_text_html, errors_\n             if bf.is_hidden:\n                 if bf_errors:\n                     top_errors.extend(['(Hidden field %s) %s' % (name, force_unicode(e)) for e in bf_errors])\n-                hidden_fields.append(unicode(bf))\n+                hidden_fields.append(six.text_type(bf))\n             else:\n                 # Create a 'class=\"...\"' atribute if the row should have any\n                 # CSS classes applied.\n@@ -167,7 +168,7 @@ def _html_output(self, normal_row, error_row, row_ender, help_text_html, errors_\n                     # punctuation.\n                     if self.label_suffix:\n                         if label[-1] not in ':?.!':\n-                            label += self.label_suffix\n+                            label = format_html('{0}{1}', label, self.label_suffix)\n                     label = bf.label_tag(label) or ''\n                 else:\n                     label = ''\n@@ -180,7 +181,7 @@ def _html_output(self, normal_row, error_row, row_ender, help_text_html, errors_\n                 output.append(normal_row % {\n                     'errors': force_unicode(bf_errors),\n                     'label': force_unicode(label),\n-                    'field': unicode(bf),\n+                    'field': six.text_type(bf),\n                     'help_text': help_text,\n                     'html_class_attr': html_class_attr\n                 })\n@@ -380,14 +381,13 @@ def visible_fields(self):\n         \"\"\"\n         return [field for field in self if not field.is_hidden]\n \n-class Form(BaseForm):\n+class Form(six.with_metaclass(DeclarativeFieldsMetaclass, BaseForm)):\n     \"A collection of Fields, plus their associated data.\"\n     # This is a separate class from BaseForm in order to abstract the way\n     # self.fields is specified. This class (Form) is the one that does the\n     # fancy metaclass stuff purely for the semantic sugar -- it allows one\n     # to define a form using declarative syntax.\n     # BaseForm itself has no way of designating self.fields.\n-    __metaclass__ = DeclarativeFieldsMetaclass\n \n class BoundField(StrAndUnicode):\n     \"A Field plus data\"\n@@ -498,8 +498,8 @@ def value(self):\n     def label_tag(self, contents=None, attrs=None):\n         \"\"\"\n         Wraps the given contents in a <label>, if the field has an ID attribute.\n-        Does not HTML-escape the contents. If contents aren't given, uses the\n-        field's HTML-escaped label.\n+        contents should be 'mark_safe'd to avoid HTML escaping. If contents\n+        aren't given, uses the field's HTML-escaped label.\n \n         If attrs are given, they're used as HTML attributes on the <label> tag.\n         \"\"\"\n@@ -508,7 +508,9 @@ def label_tag(self, contents=None, attrs=None):\n         id_ = widget.attrs.get('id') or self.auto_id\n         if id_:\n             attrs = attrs and flatatt(attrs) or ''\n-            contents = '<label for=\"%s\"%s>%s</label>' % (widget.id_for_label(id_), attrs, unicode(contents))\n+            contents = format_html('<label for=\"{0}\"{1}>{2}</label>',\n+                                   widget.id_for_label(id_), attrs, contents\n+                                   )\n         return mark_safe(contents)\n \n     def css_classes(self, extra_classes=None):"
        },
        {
            "sha": "240cf71f436629baace005dd5039c72d3beafe55",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,8 @@\n from django.forms.widgets import Media, HiddenInput\n from django.utils.encoding import StrAndUnicode\n from django.utils.safestring import mark_safe\n+from django.utils import six\n+from django.utils.six.moves import xrange\n from django.utils.translation import ugettext as _\n \n \n@@ -345,17 +347,17 @@ def as_table(self):\n         # probably should be. It might make sense to render each form as a\n         # table row with each field as a td.\n         forms = ' '.join([form.as_table() for form in self])\n-        return mark_safe('\\n'.join([unicode(self.management_form), forms]))\n+        return mark_safe('\\n'.join([six.text_type(self.management_form), forms]))\n \n     def as_p(self):\n         \"Returns this formset rendered as HTML <p>s.\"\n         forms = ' '.join([form.as_p() for form in self])\n-        return mark_safe('\\n'.join([unicode(self.management_form), forms]))\n+        return mark_safe('\\n'.join([six.text_type(self.management_form), forms]))\n \n     def as_ul(self):\n         \"Returns this formset rendered as HTML <li>s.\"\n         forms = ' '.join([form.as_ul() for form in self])\n-        return mark_safe('\\n'.join([unicode(self.management_form), forms]))\n+        return mark_safe('\\n'.join([six.text_type(self.management_form), forms]))\n \n def formset_factory(form, formset=BaseFormSet, extra=1, can_order=False,\n                     can_delete=False, max_num=None):"
        },
        {
            "sha": "4d56f1d38abef9aeeb13cc649f4182739bcfac9d",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -15,6 +15,7 @@\n     MultipleHiddenInput, media_property)\n from django.utils.encoding import smart_unicode, force_unicode\n from django.utils.datastructures import SortedDict\n+from django.utils import six\n from django.utils.text import get_text_list, capfirst\n from django.utils.translation import ugettext_lazy as _, ugettext\n \n@@ -365,8 +366,8 @@ def save(self, commit=True):\n \n     save.alters_data = True\n \n-class ModelForm(BaseModelForm):\n-    __metaclass__ = ModelFormMetaclass\n+class ModelForm(six.with_metaclass(ModelFormMetaclass, BaseModelForm)):\n+    pass\n \n def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n                       formfield_callback=None,  widgets=None):\n@@ -401,6 +402,7 @@ def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n \n     form_metaclass = ModelFormMetaclass\n \n+    # TODO: this doesn't work under Python 3.\n     if issubclass(form, BaseModelForm) and hasattr(form, '__metaclass__'):\n         form_metaclass = form.__metaclass__\n \n@@ -574,15 +576,15 @@ def get_unique_error_message(self, unique_check):\n         else:\n             return ugettext(\"Please correct the duplicate data for %(field)s, \"\n                 \"which must be unique.\") % {\n-                    \"field\": get_text_list(unique_check, unicode(_(\"and\"))),\n+                    \"field\": get_text_list(unique_check, six.text_type(_(\"and\"))),\n                 }\n \n     def get_date_error_message(self, date_check):\n         return ugettext(\"Please correct the duplicate data for %(field_name)s \"\n             \"which must be unique for the %(lookup)s in %(date_field)s.\") % {\n             'field_name': date_check[2],\n             'date_field': date_check[3],\n-            'lookup': unicode(date_check[1]),\n+            'lookup': six.text_type(date_check[1]),\n         }\n \n     def get_form_error(self):\n@@ -712,7 +714,7 @@ def _construct_form(self, i, **kwargs):\n             # Remove the foreign key from the form's data\n             form.data[form.add_prefix(self.fk.name)] = None\n \n-        # Set the fk value here so that the form can do it's validation.\n+        # Set the fk value here so that the form can do its validation.\n         setattr(form.instance, self.fk.get_attname(), self.instance.pk)\n         return form\n "
        },
        {
            "sha": "8cf03d38aff36c07e3f5f1d411053ae2976dade8",
            "filename": "django/forms/util.py",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Futil.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,7 +1,7 @@\n from __future__ import unicode_literals\n \n from django.conf import settings\n-from django.utils.html import conditional_escape\n+from django.utils.html import format_html, format_html_join\n from django.utils.encoding import StrAndUnicode, force_unicode\n from django.utils.safestring import mark_safe\n from django.utils import timezone\n@@ -17,8 +17,10 @@ def flatatt(attrs):\n     The returned string will contain a leading space followed by key=\"value\",\n     XML-style pairs.  It is assumed that the keys do not need to be XML-escaped.\n     If the passed dictionary is empty, then return an empty string.\n+\n+    The result is passed through 'mark_safe'.\n     \"\"\"\n-    return ''.join([' %s=\"%s\"' % (k, conditional_escape(v)) for k, v in attrs.items()])\n+    return format_html_join('', ' {0}=\"{1}\"', attrs.items())\n \n class ErrorDict(dict, StrAndUnicode):\n     \"\"\"\n@@ -31,9 +33,11 @@ def __unicode__(self):\n \n     def as_ul(self):\n         if not self: return ''\n-        return mark_safe('<ul class=\"errorlist\">%s</ul>'\n-                % ''.join(['<li>%s%s</li>' % (k, conditional_escape(force_unicode(v)))\n-                    for k, v in self.items()]))\n+        return format_html('<ul class=\"errorlist\">{0}</ul>',\n+                           format_html_join('', '<li>{0}{1}</li>',\n+                                            ((k, force_unicode(v))\n+                                             for k, v in self.items())\n+                           ))\n \n     def as_text(self):\n         return '\\n'.join(['* %s\\n%s' % (k, '\\n'.join(['  * %s' % force_unicode(i) for i in v])) for k, v in self.items()])\n@@ -47,8 +51,11 @@ def __unicode__(self):\n \n     def as_ul(self):\n         if not self: return ''\n-        return mark_safe('<ul class=\"errorlist\">%s</ul>'\n-                % ''.join(['<li>%s</li>' % conditional_escape(force_unicode(e)) for e in self]))\n+        return format_html('<ul class=\"errorlist\">{0}</ul>',\n+                           format_html_join('', '<li>{0}</li>',\n+                                            ((force_unicode(e),) for e in self)\n+                                            )\n+                           )\n \n     def as_text(self):\n         if not self: return ''"
        },
        {
            "sha": "6b1be37ec27f5cc43c08109249267c3968cf076c",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 40,
            "deletions": 31,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,16 +7,21 @@\n import copy\n import datetime\n from itertools import chain\n-from urlparse import urljoin\n+try:\n+    from urllib.parse import urljoin\n+except ImportError:     # Python 2\n+    from urlparse import urljoin\n \n from django.conf import settings\n from django.forms.util import flatatt, to_current_timezone\n from django.utils.datastructures import MultiValueDict, MergeDict\n-from django.utils.html import escape, conditional_escape\n+from django.utils.html import conditional_escape, format_html, format_html_join\n from django.utils.translation import ugettext, ugettext_lazy\n from django.utils.encoding import StrAndUnicode, force_unicode\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils import datetime_safe, formats\n+from django.utils import six\n \n __all__ = (\n     'Media', 'MediaDefiningClass', 'Widget', 'TextInput', 'PasswordInput',\n@@ -53,15 +58,15 @@ def render(self):\n         return mark_safe('\\n'.join(chain(*[getattr(self, 'render_' + name)() for name in MEDIA_TYPES])))\n \n     def render_js(self):\n-        return ['<script type=\"text/javascript\" src=\"%s\"></script>' % self.absolute_path(path) for path in self._js]\n+        return [format_html('<script type=\"text/javascript\" src=\"{0}\"></script>', self.absolute_path(path)) for path in self._js]\n \n     def render_css(self):\n         # To keep rendering order consistent, we can't just iterate over items().\n         # We need to sort the keys, and iterate over the sorted list.\n         media = self._css.keys()\n         media.sort()\n         return chain(*[\n-            ['<link href=\"%s\" type=\"text/css\" media=\"%s\" rel=\"stylesheet\" />' % (self.absolute_path(path), medium)\n+                [format_html('<link href=\"{0}\" type=\"text/css\" media=\"{1}\" rel=\"stylesheet\" />', self.absolute_path(path), medium)\n                     for path in self._css[medium]]\n                 for medium in media])\n \n@@ -153,8 +158,7 @@ def __unicode__(self):\n             args.append(self.choices)\n         return self.parent_widget.render(*args)\n \n-class Widget(object):\n-    __metaclass__ = MediaDefiningClass\n+class Widget(six.with_metaclass(MediaDefiningClass)):\n     is_hidden = False          # Determines whether this corresponds to an <input type=\"hidden\">.\n     needs_multipart_form = False # Determines does this widget need multipart form\n     is_localized = False\n@@ -254,7 +258,7 @@ def render(self, name, value, attrs=None):\n         if value != '':\n             # Only add the 'value' attribute if a value is non-empty.\n             final_attrs['value'] = force_unicode(self._format_value(value))\n-        return mark_safe('<input%s />' % flatatt(final_attrs))\n+        return format_html('<input{0} />', flatatt(final_attrs))\n \n class TextInput(Input):\n     input_type = 'text'\n@@ -295,7 +299,7 @@ def render(self, name, value, attrs=None, choices=()):\n                 # An ID attribute was given. Add a numeric index as a suffix\n                 # so that the inputs don't all have the same ID attribute.\n                 input_attrs['id'] = '%s_%s' % (id_, i)\n-            inputs.append('<input%s />' % flatatt(input_attrs))\n+            inputs.append(format_html('<input{0} />', flatatt(input_attrs)))\n         return mark_safe('\\n'.join(inputs))\n \n     def value_from_datadict(self, data, files, name):\n@@ -355,9 +359,9 @@ def render(self, name, value, attrs=None):\n \n         if value and hasattr(value, \"url\"):\n             template = self.template_with_initial\n-            substitutions['initial'] = ('<a href=\"%s\">%s</a>'\n-                                        % (escape(value.url),\n-                                           escape(force_unicode(value))))\n+            substitutions['initial'] = format_html('<a href=\"{0}\">{1}</a>',\n+                                                   value.url,\n+                                                   force_unicode(value))\n             if not self.is_required:\n                 checkbox_name = self.clear_checkbox_name(name)\n                 checkbox_id = self.clear_checkbox_id(checkbox_name)\n@@ -392,8 +396,9 @@ def __init__(self, attrs=None):\n     def render(self, name, value, attrs=None):\n         if value is None: value = ''\n         final_attrs = self.build_attrs(attrs, name=name)\n-        return mark_safe('<textarea%s>%s</textarea>' % (flatatt(final_attrs),\n-                conditional_escape(force_unicode(value))))\n+        return format_html('<textarea{0}>{1}</textarea>',\n+                           flatatt(final_attrs),\n+                           force_unicode(value))\n \n class DateInput(Input):\n     input_type = 'text'\n@@ -511,7 +516,7 @@ def render(self, name, value, attrs=None):\n         if not (value is True or value is False or value is None or value == ''):\n             # Only add the 'value' attribute if a value is non-empty.\n             final_attrs['value'] = force_unicode(value)\n-        return mark_safe('<input%s />' % flatatt(final_attrs))\n+        return format_html('<input{0} />', flatatt(final_attrs))\n \n     def value_from_datadict(self, data, files, name):\n         if name not in data:\n@@ -521,7 +526,7 @@ def value_from_datadict(self, data, files, name):\n         value = data.get(name)\n         # Translate true and false strings to boolean values.\n         values =  {'true': True, 'false': False}\n-        if isinstance(value, basestring):\n+        if isinstance(value, six.string_types):\n             value = values.get(value.lower(), value)\n         return value\n \n@@ -543,7 +548,7 @@ def __init__(self, attrs=None, choices=()):\n     def render(self, name, value, attrs=None, choices=()):\n         if value is None: value = ''\n         final_attrs = self.build_attrs(attrs, name=name)\n-        output = ['<select%s>' % flatatt(final_attrs)]\n+        output = [format_html('<select{0}>', flatatt(final_attrs))]\n         options = self.render_options(choices, [value])\n         if options:\n             output.append(options)\n@@ -553,23 +558,24 @@ def render(self, name, value, attrs=None, choices=()):\n     def render_option(self, selected_choices, option_value, option_label):\n         option_value = force_unicode(option_value)\n         if option_value in selected_choices:\n-            selected_html = ' selected=\"selected\"'\n+            selected_html = mark_safe(' selected=\"selected\"')\n             if not self.allow_multiple_selected:\n                 # Only allow for a single selection.\n                 selected_choices.remove(option_value)\n         else:\n             selected_html = ''\n-        return '<option value=\"%s\"%s>%s</option>' % (\n-            escape(option_value), selected_html,\n-            conditional_escape(force_unicode(option_label)))\n+        return format_html('<option value=\"{0}\"{1}>{2}</option>',\n+                           option_value,\n+                           selected_html,\n+                           force_unicode(option_label))\n \n     def render_options(self, choices, selected_choices):\n         # Normalize to strings.\n         selected_choices = set(force_unicode(v) for v in selected_choices)\n         output = []\n         for option_value, option_label in chain(self.choices, choices):\n             if isinstance(option_label, (list, tuple)):\n-                output.append('<optgroup label=\"%s\">' % escape(force_unicode(option_value)))\n+                output.append(format_html('<optgroup label=\"{0}\">', force_unicode(option_value)))\n                 for option in option_label:\n                     output.append(self.render_option(selected_choices, *option))\n                 output.append('</optgroup>')\n@@ -618,7 +624,7 @@ class SelectMultiple(Select):\n     def render(self, name, value, attrs=None, choices=()):\n         if value is None: value = []\n         final_attrs = self.build_attrs(attrs, name=name)\n-        output = ['<select multiple=\"multiple\"%s>' % flatatt(final_attrs)]\n+        output = [format_html('<select multiple=\"multiple\"{0}>', flatatt(final_attrs))]\n         options = self.render_options(choices, value)\n         if options:\n             output.append(options)\n@@ -662,11 +668,11 @@ def render(self, name=None, value=None, attrs=None, choices=()):\n         value = value or self.value\n         attrs = attrs or self.attrs\n         if 'id' in self.attrs:\n-            label_for = ' for=\"%s_%s\"' % (self.attrs['id'], self.index)\n+            label_for = format_html(' for=\"{0}_{1}\"', self.attrs['id'], self.index)\n         else:\n             label_for = ''\n-        choice_label = conditional_escape(force_unicode(self.choice_label))\n-        return mark_safe('<label%s>%s %s</label>' % (label_for, self.tag(), choice_label))\n+        choice_label = force_unicode(self.choice_label)\n+        return format_html('<label{0}>{1} {2}</label>', label_for, self.tag(), choice_label)\n \n     def is_checked(self):\n         return self.value == self.choice_value\n@@ -677,7 +683,7 @@ def tag(self):\n         final_attrs = dict(self.attrs, type='radio', name=self.name, value=self.choice_value)\n         if self.is_checked():\n             final_attrs['checked'] = 'checked'\n-        return mark_safe('<input%s />' % flatatt(final_attrs))\n+        return format_html('<input{0} />', flatatt(final_attrs))\n \n class RadioFieldRenderer(StrAndUnicode):\n     \"\"\"\n@@ -701,8 +707,10 @@ def __unicode__(self):\n \n     def render(self):\n         \"\"\"Outputs a <ul> for this set of radio fields.\"\"\"\n-        return mark_safe('<ul>\\n%s\\n</ul>' % '\\n'.join(['<li>%s</li>'\n-                % force_unicode(w) for w in self]))\n+        return format_html('<ul>\\n{0}\\n</ul>',\n+                           format_html_join('\\n', '<li>{0}</li>',\n+                                            [(force_unicode(w),) for w in self]\n+                                            ))\n \n class RadioSelect(Select):\n     renderer = RadioFieldRenderer\n@@ -751,15 +759,16 @@ def render(self, name, value, attrs=None, choices=()):\n             # so that the checkboxes don't all have the same ID attribute.\n             if has_id:\n                 final_attrs = dict(final_attrs, id='%s_%s' % (attrs['id'], i))\n-                label_for = ' for=\"%s\"' % final_attrs['id']\n+                label_for = format_html(' for=\"{0}\"', final_attrs['id'])\n             else:\n                 label_for = ''\n \n             cb = CheckboxInput(final_attrs, check_test=lambda value: value in str_values)\n             option_value = force_unicode(option_value)\n             rendered_cb = cb.render(name, option_value)\n-            option_label = conditional_escape(force_unicode(option_label))\n-            output.append('<li><label%s>%s %s</label></li>' % (label_for, rendered_cb, option_label))\n+            option_label = force_unicode(option_label)\n+            output.append(format_html('<li><label{0}>{1} {2}</label></li>',\n+                                      label_for, rendered_cb, option_label))\n         output.append('</ul>')\n         return mark_safe('\\n'.join(output))\n "
        },
        {
            "sha": "6f9d70eebd993bba124467d51aaf92a32caa1366",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 49,
            "deletions": 54,
            "changes": 103,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,6 @@\n from __future__ import absolute_import, unicode_literals\n \n+import copy\n import datetime\n import os\n import re\n@@ -9,26 +10,29 @@\n \n from io import BytesIO\n from pprint import pformat\n-from urllib import urlencode, quote\n-from urlparse import urljoin, parse_qsl\n+try:\n+    from urllib.parse import quote, parse_qsl, urlencode, urljoin\n+except ImportError:     # Python 2\n+    from urllib import quote, urlencode\n+    from urlparse import parse_qsl, urljoin\n \n-import Cookie\n+from django.utils.six.moves import http_cookies\n # Some versions of Python 2.7 and later won't need this encoding bug fix:\n-_cookie_encodes_correctly = Cookie.SimpleCookie().value_encode(';') == (';', '\"\\\\073\"')\n+_cookie_encodes_correctly = http_cookies.SimpleCookie().value_encode(';') == (';', '\"\\\\073\"')\n # See ticket #13007, http://bugs.python.org/issue2193 and http://trac.edgewall.org/ticket/2256\n-_tc = Cookie.SimpleCookie()\n+_tc = http_cookies.SimpleCookie()\n try:\n     _tc.load(b'foo:bar=1')\n     _cookie_allows_colon_in_names = True\n-except Cookie.CookieError:\n+except http_cookies.CookieError:\n     _cookie_allows_colon_in_names = False\n \n if _cookie_encodes_correctly and _cookie_allows_colon_in_names:\n-    SimpleCookie = Cookie.SimpleCookie\n+    SimpleCookie = http_cookies.SimpleCookie\n else:\n-    Morsel = Cookie.Morsel\n+    Morsel = http_cookies.Morsel\n \n-    class SimpleCookie(Cookie.SimpleCookie):\n+    class SimpleCookie(http_cookies.SimpleCookie):\n         if not _cookie_encodes_correctly:\n             def value_encode(self, val):\n                 # Some browsers do not support quoted-string from RFC 2109,\n@@ -69,9 +73,9 @@ def _BaseCookie__set(self, key, real_value, coded_value):\n                     M = self.get(key, Morsel())\n                     M.set(key, real_value, coded_value)\n                     dict.__setitem__(self, key, M)\n-                except Cookie.CookieError:\n+                except http_cookies.CookieError:\n                     self.bad_cookies.add(key)\n-                    dict.__setitem__(self, key, Cookie.Morsel())\n+                    dict.__setitem__(self, key, http_cookies.Morsel())\n \n \n from django.conf import settings\n@@ -83,6 +87,7 @@ def _BaseCookie__set(self, key, real_value, coded_value):\n from django.utils.datastructures import MultiValueDict, ImmutableList\n from django.utils.encoding import smart_str, iri_to_uri, force_unicode\n from django.utils.http import cookie_date\n+from django.utils import six\n from django.utils import timezone\n \n RESERVED_CHARS=\"!*'();:@&=+$,/?%#[]\"\n@@ -135,10 +140,10 @@ def build_request_repr(request, path_override=None, GET_override=None,\n     return smart_str('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n                      (request.__class__.__name__,\n                       path,\n-                      unicode(get),\n-                      unicode(post),\n-                      unicode(cookies),\n-                      unicode(meta)))\n+                      six.text_type(get),\n+                      six.text_type(post),\n+                      six.text_type(cookies),\n+                      six.text_type(meta)))\n \n class UnreadablePostError(IOError):\n     pass\n@@ -289,7 +294,7 @@ def body(self):\n             try:\n                 self._body = self.read()\n             except IOError as e:\n-                raise UnreadablePostError, e, sys.exc_traceback\n+                six.reraise(UnreadablePostError, e, sys.exc_traceback)\n             self._stream = BytesIO(self._body)\n         return self._body\n \n@@ -360,6 +365,7 @@ def xreadlines(self):\n     def readlines(self):\n         return list(iter(self))\n \n+\n class QueryDict(MultiValueDict):\n     \"\"\"\n     A specialized MultiValueDict that takes a query string when initialized.\n@@ -374,7 +380,7 @@ class QueryDict(MultiValueDict):\n     _encoding = None\n \n     def __init__(self, query_string, mutable=False, encoding=None):\n-        MultiValueDict.__init__(self)\n+        super(QueryDict, self).__init__()\n         if not encoding:\n             encoding = settings.DEFAULT_CHARSET\n         self.encoding = encoding\n@@ -401,72 +407,58 @@ def __setitem__(self, key, value):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         value = str_to_unicode(value, self.encoding)\n-        MultiValueDict.__setitem__(self, key, value)\n+        super(QueryDict, self).__setitem__(key, value)\n \n     def __delitem__(self, key):\n         self._assert_mutable()\n         super(QueryDict, self).__delitem__(key)\n \n     def __copy__(self):\n         result = self.__class__('', mutable=True, encoding=self.encoding)\n-        for key, value in dict.items(self):\n-            dict.__setitem__(result, key, value)\n+        for key, value in self.iterlists():\n+            result.setlist(key, value)\n         return result\n \n     def __deepcopy__(self, memo):\n-        import copy\n         result = self.__class__('', mutable=True, encoding=self.encoding)\n         memo[id(self)] = result\n-        for key, value in dict.items(self):\n-            dict.__setitem__(result, copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n+        for key, value in self.iterlists():\n+            result.setlist(copy.deepcopy(key, memo), copy.deepcopy(value, memo))\n         return result\n \n     def setlist(self, key, list_):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         list_ = [str_to_unicode(elt, self.encoding) for elt in list_]\n-        MultiValueDict.setlist(self, key, list_)\n+        super(QueryDict, self).setlist(key, list_)\n \n-    def setlistdefault(self, key, default_list=()):\n+    def setlistdefault(self, key, default_list=None):\n         self._assert_mutable()\n-        if key not in self:\n-            self.setlist(key, default_list)\n-        return MultiValueDict.getlist(self, key)\n+        return super(QueryDict, self).setlistdefault(key, default_list)\n \n     def appendlist(self, key, value):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         value = str_to_unicode(value, self.encoding)\n-        MultiValueDict.appendlist(self, key, value)\n-\n-    def update(self, other_dict):\n-        self._assert_mutable()\n-        f = lambda s: str_to_unicode(s, self.encoding)\n-        if hasattr(other_dict, 'lists'):\n-            for key, valuelist in other_dict.lists():\n-                for value in valuelist:\n-                    MultiValueDict.update(self, {f(key): f(value)})\n-        else:\n-            d = dict([(f(k), f(v)) for k, v in other_dict.items()])\n-            MultiValueDict.update(self, d)\n+        super(QueryDict, self).appendlist(key, value)\n \n     def pop(self, key, *args):\n         self._assert_mutable()\n-        return MultiValueDict.pop(self, key, *args)\n+        return super(QueryDict, self).pop(key, *args)\n \n     def popitem(self):\n         self._assert_mutable()\n-        return MultiValueDict.popitem(self)\n+        return super(QueryDict, self).popitem()\n \n     def clear(self):\n         self._assert_mutable()\n-        MultiValueDict.clear(self)\n+        super(QueryDict, self).clear()\n \n     def setdefault(self, key, default=None):\n         self._assert_mutable()\n         key = str_to_unicode(key, self.encoding)\n         default = str_to_unicode(default, self.encoding)\n-        return MultiValueDict.setdefault(self, key, default)\n+        return super(QueryDict, self).setdefault(key, default)\n \n     def copy(self):\n         \"\"\"Returns a mutable copy of this object.\"\"\"\n@@ -499,14 +491,15 @@ def urlencode(self, safe=None):\n                            for v in list_])\n         return '&'.join(output)\n \n+\n def parse_cookie(cookie):\n     if cookie == '':\n         return {}\n-    if not isinstance(cookie, Cookie.BaseCookie):\n+    if not isinstance(cookie, http_cookies.BaseCookie):\n         try:\n             c = SimpleCookie()\n             c.load(cookie)\n-        except Cookie.CookieError:\n+        except http_cookies.CookieError:\n             # Invalid cookie\n             return {}\n     else:\n@@ -524,14 +517,16 @@ class HttpResponse(object):\n \n     status_code = 200\n \n-    def __init__(self, content='', mimetype=None, status=None,\n-            content_type=None):\n+    def __init__(self, content='', content_type=None, status=None,\n+            mimetype=None):\n         # _headers is a mapping of the lower-case name to the original case of\n         # the header (required for working with legacy systems) and the header\n         # value. Both the name of the header and its value are ASCII strings.\n         self._headers = {}\n         self._charset = settings.DEFAULT_CHARSET\n-        if mimetype: # For backwards compatibility.\n+        if mimetype:\n+            warnings.warn(\"Using mimetype keyword argument is deprecated, use\"\n+                          \" content_type instead\", PendingDeprecationWarning)\n             content_type = mimetype\n         if not content_type:\n             content_type = \"%s; charset=%s\" % (settings.DEFAULT_CONTENT_TYPE,\n@@ -552,7 +547,7 @@ def __str__(self):\n     def _convert_to_ascii(self, *values):\n         \"\"\"Converts all values to ascii strings.\"\"\"\n         for value in values:\n-            if isinstance(value, unicode):\n+            if isinstance(value, six.text_type):\n                 try:\n                     value = value.encode('us-ascii')\n                 except UnicodeError as e:\n@@ -671,7 +666,7 @@ def __iter__(self):\n \n     def next(self):\n         chunk = next(self._iterator)\n-        if isinstance(chunk, unicode):\n+        if isinstance(chunk, six.text_type):\n             chunk = chunk.encode(self._charset)\n         return str(chunk)\n \n@@ -692,7 +687,7 @@ def flush(self):\n     def tell(self):\n         if self._base_content_is_iter:\n             raise Exception(\"This %s instance cannot tell its position\" % self.__class__)\n-        return sum([len(str(chunk)) for chunk in self._container])\n+        return sum([len(chunk) for chunk in self])\n \n class HttpResponseRedirect(HttpResponse):\n     status_code = 302\n@@ -748,8 +743,8 @@ def str_to_unicode(s, encoding):\n \n     Returns any non-basestring objects without change.\n     \"\"\"\n-    if isinstance(s, str):\n-        return unicode(s, encoding, 'replace')\n+    if isinstance(s, bytes):\n+        return six.text_type(s, encoding, 'replace')\n     else:\n         return s\n "
        },
        {
            "sha": "0e28a55c3a14cb695f8574f8590cc673be874d28",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -11,6 +11,7 @@\n from django.core.exceptions import SuspiciousOperation\n from django.utils.datastructures import MultiValueDict\n from django.utils.encoding import force_unicode\n+from django.utils import six\n from django.utils.text import unescape_entities\n from django.core.files.uploadhandler import StopUpload, SkipFile, StopFutureHandlers\n \n@@ -77,7 +78,7 @@ def __init__(self, META, input_data, upload_handlers, encoding=None):\n             # This means we shouldn't continue...raise an error.\n             raise MultiPartParserError(\"Invalid content length: %r\" % content_length)\n \n-        if isinstance(boundary, unicode):\n+        if isinstance(boundary, six.text_type):\n             boundary = boundary.encode('ascii')\n         self._boundary = boundary\n         self._input_data = input_data"
        },
        {
            "sha": "154f2246718c6f19baa8562eee88b0ac33941a63",
            "filename": "django/shortcuts/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fshortcuts%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fshortcuts%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fshortcuts%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,7 +16,7 @@ def render_to_response(*args, **kwargs):\n     Returns a HttpResponse whose content is filled with the result of calling\n     django.template.loader.render_to_string() with the passed arguments.\n     \"\"\"\n-    httpresponse_kwargs = {'mimetype': kwargs.pop('mimetype', None)}\n+    httpresponse_kwargs = {'content_type': kwargs.pop('mimetype', None)}\n     return HttpResponse(loader.render_to_string(*args, **kwargs), **httpresponse_kwargs)\n \n def render(request, *args, **kwargs):"
        },
        {
            "sha": "489b1681e0ff21d2b5b8962cac53461ab33f8c51",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -18,6 +18,7 @@\n from django.utils.formats import localize\n from django.utils.html import escape\n from django.utils.module_loading import module_has_submodule\n+from django.utils import six\n from django.utils.timezone import template_localtime\n \n \n@@ -85,7 +86,7 @@ def __init__(self, msg, params=()):\n         self.params = params\n \n     def __str__(self):\n-        return unicode(self).encode('utf-8')\n+        return six.text_type(self).encode('utf-8')\n \n     def __unicode__(self):\n         return self.msg % tuple([force_unicode(p, errors='replace')\n@@ -216,13 +217,8 @@ def create_token(self, token_string, in_tag):\n             if token_string.startswith(VARIABLE_TAG_START):\n                 token = Token(TOKEN_VAR, token_string[2:-2].strip())\n             elif token_string.startswith(BLOCK_TAG_START):\n-                if block_content.startswith('verbatim'):\n-                    bits = block_content.split(' ', 1)\n-                    if bits[0] == 'verbatim':\n-                        if len(bits) > 1:\n-                            self.verbatim = bits[1]\n-                        else:\n-                            self.verbatim = 'endverbatim'\n+                if block_content[:9] in ('verbatim', 'verbatim '):\n+                    self.verbatim = 'end%s' % block_content\n                 token = Token(TOKEN_BLOCK, block_content)\n             elif token_string.startswith(COMMENT_TAG_START):\n                 content = ''\n@@ -1193,7 +1189,7 @@ def render(self, context):\n                         from django.template.loader import get_template, select_template\n                         if isinstance(file_name, Template):\n                             t = file_name\n-                        elif not isinstance(file_name, basestring) and is_iterable(file_name):\n+                        elif not isinstance(file_name, six.string_types) and is_iterable(file_name):\n                             t = select_template(file_name)\n                         else:\n                             t = get_template(file_name)"
        },
        {
            "sha": "fa799cd46f63206c4cc3a38e3333edc5dd5defaa",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 21,
            "deletions": 14,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -18,6 +18,7 @@\n from django.utils.http import urlquote\n from django.utils.text import Truncator, wrap, phone2numeric\n from django.utils.safestring import mark_safe, SafeData, mark_for_escaping\n+from django.utils import six\n from django.utils.timesince import timesince, timeuntil\n from django.utils.translation import ugettext, ungettext\n from django.utils.text import normalize_newlines\n@@ -176,7 +177,7 @@ def floatformat(text, arg=-1):\n         # and `exponent` from `Decimal.as_tuple()` directly.\n         sign, digits, exponent = d.quantize(exp, ROUND_HALF_UP,\n             Context(prec=prec)).as_tuple()\n-        digits = [unicode(digit) for digit in reversed(digits)]\n+        digits = [six.text_type(digit) for digit in reversed(digits)]\n         while len(digits) <= abs(exponent):\n             digits.append('0')\n         digits.insert(-exponent, '.')\n@@ -200,7 +201,7 @@ def linenumbers(value, autoescape=None):\n     lines = value.split('\\n')\n     # Find the maximum width of the line count, for use with zero padding\n     # string format command\n-    width = unicode(len(unicode(len(lines))))\n+    width = six.text_type(len(six.text_type(len(lines))))\n     if not autoescape or isinstance(value, SafeData):\n         for i, line in enumerate(lines):\n             lines[i] = (\"%0\" + width  + \"d. %s\") % (i + 1, line)\n@@ -234,7 +235,7 @@ def slugify(value):\n     and converts spaces to hyphens.\n     \"\"\"\n     value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore')\n-    value = unicode(re.sub('[^\\w\\s-]', '', value).strip().lower())\n+    value = six.text_type(re.sub('[^\\w\\s-]', '', value).strip().lower())\n     return mark_safe(re.sub('[-\\s]+', '-', value))\n \n @register.filter(is_safe=True)\n@@ -249,7 +250,7 @@ def stringformat(value, arg):\n     of Python string formatting\n     \"\"\"\n     try:\n-        return (\"%\" + unicode(arg)) % value\n+        return (\"%\" + six.text_type(arg)) % value\n     except (ValueError, TypeError):\n         return \"\"\n \n@@ -827,17 +828,23 @@ def filesizeformat(bytes):\n \n     filesize_number_format = lambda value: formats.number_format(round(value, 1), 1)\n \n-    if bytes < 1024:\n+    KB = 1<<10\n+    MB = 1<<20\n+    GB = 1<<30\n+    TB = 1<<40\n+    PB = 1<<50\n+\n+    if bytes < KB:\n         return ungettext(\"%(size)d byte\", \"%(size)d bytes\", bytes) % {'size': bytes}\n-    if bytes < 1024 * 1024:\n-        return ugettext(\"%s KB\") % filesize_number_format(bytes / 1024)\n-    if bytes < 1024 * 1024 * 1024:\n-        return ugettext(\"%s MB\") % filesize_number_format(bytes / (1024 * 1024))\n-    if bytes < 1024 * 1024 * 1024 * 1024:\n-        return ugettext(\"%s GB\") % filesize_number_format(bytes / (1024 * 1024 * 1024))\n-    if bytes < 1024 * 1024 * 1024 * 1024 * 1024:\n-        return ugettext(\"%s TB\") % filesize_number_format(bytes / (1024 * 1024 * 1024 * 1024))\n-    return ugettext(\"%s PB\") % filesize_number_format(bytes / (1024 * 1024 * 1024 * 1024 * 1024))\n+    if bytes < MB:\n+        return ugettext(\"%s KB\") % filesize_number_format(bytes / KB)\n+    if bytes < GB:\n+        return ugettext(\"%s MB\") % filesize_number_format(bytes / MB)\n+    if bytes < TB:\n+        return ugettext(\"%s GB\") % filesize_number_format(bytes / GB)\n+    if bytes < PB:\n+        return ugettext(\"%s TB\") % filesize_number_format(bytes / TB)\n+    return ugettext(\"%s PB\") % filesize_number_format(bytes / PB)\n \n @register.filter(is_safe=False)\n def pluralize(value, arg='s'):"
        },
        {
            "sha": "fb45fe722ebb836afb4b9ca63da98b23575a59c0",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 8,
            "deletions": 11,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,6 +16,7 @@\n from django.template.defaultfilters import date\n from django.utils.encoding import smart_unicode\n from django.utils.safestring import mark_safe\n+from django.utils.html import format_html\n from django.utils import timezone\n \n register = Library()\n@@ -44,9 +45,9 @@ def render(self, context):\n         csrf_token = context.get('csrf_token', None)\n         if csrf_token:\n             if csrf_token == 'NOTPROVIDED':\n-                return mark_safe(\"\")\n+                return format_html(\"\")\n             else:\n-                return mark_safe(\"<div style='display:none'><input type='hidden' name='csrfmiddlewaretoken' value='%s' /></div>\" % csrf_token)\n+                return format_html(\"<div><input type='hidden' name='csrfmiddlewaretoken' value='{0}' /></div>\", csrf_token)\n         else:\n             # It's very probable that the token is missing because of\n             # misconfiguration, so we raise a warning\n@@ -1291,18 +1292,14 @@ def verbatim(parser, token):\n             {% don't process this %}\n         {% endverbatim %}\n \n-    You can also specify an alternate closing tag::\n+    You can also designate a specific closing tag block (allowing the\n+    unrendered use of ``{% endverbatim %}``)::\n \n-        {% verbatim -- %}\n+        {% verbatim myblock %}\n             ...\n-        {% -- %}\n+        {% endverbatim myblock %}\n     \"\"\"\n-    bits = token.contents.split(' ', 1)\n-    if len(bits) > 1:\n-        closing_tag = bits[1]\n-    else:\n-        closing_tag = 'endverbatim'\n-    nodelist = parser.parse((closing_tag,))\n+    nodelist = parser.parse(('endverbatim',))\n     parser.delete_first_token()\n     return VerbatimNode(nodelist.render(Context()))\n "
        },
        {
            "sha": "cfffb4014e481ce3836355e166b74688ebed4273",
            "filename": "django/template/loader.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Floader.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Floader.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floader.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -29,6 +29,7 @@\n from django.template.base import Origin, Template, Context, TemplateDoesNotExist, add_to_builtins\n from django.utils.importlib import import_module\n from django.conf import settings\n+from django.utils import six\n \n template_source_loaders = None\n \n@@ -89,7 +90,7 @@ def find_template_loader(loader):\n         loader, args = loader[0], loader[1:]\n     else:\n         args = []\n-    if isinstance(loader, basestring):\n+    if isinstance(loader, six.string_types):\n         module, attr = loader.rsplit('.', 1)\n         try:\n             mod = import_module(module)"
        },
        {
            "sha": "800e060c746534025db4c693580a9757864e0354",
            "filename": "django/template/response.py",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fresponse.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplate%2Fresponse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fresponse.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,6 @@\n from django.http import HttpResponse\n from django.template import loader, Context, RequestContext\n+from django.utils import six\n \n \n class ContentNotRenderedError(Exception):\n@@ -9,8 +10,8 @@ class ContentNotRenderedError(Exception):\n class SimpleTemplateResponse(HttpResponse):\n     rendering_attrs = ['template_name', 'context_data', '_post_render_callbacks']\n \n-    def __init__(self, template, context=None, mimetype=None, status=None,\n-            content_type=None):\n+    def __init__(self, template, context=None, content_type=None, status=None,\n+            mimetype=None):\n         # It would seem obvious to call these next two members 'template' and\n         # 'context', but those names are reserved as part of the test Client\n         # API. To avoid the name collision, we use tricky-to-debug problems\n@@ -22,8 +23,8 @@ def __init__(self, template, context=None, mimetype=None, status=None,\n         # content argument doesn't make sense here because it will be replaced\n         # with rendered template so we always pass empty string in order to\n         # prevent errors and provide shorter signature.\n-        super(SimpleTemplateResponse, self).__init__('', mimetype, status,\n-                                                     content_type)\n+        super(SimpleTemplateResponse, self).__init__('', content_type, status,\n+                                                     mimetype)\n \n         # _is_rendered tracks whether the template and context has been baked\n         # into a final response.\n@@ -53,7 +54,7 @@ def resolve_template(self, template):\n         \"Accepts a template object, path-to-template or list of paths\"\n         if isinstance(template, (list, tuple)):\n             return loader.select_template(template)\n-        elif isinstance(template, basestring):\n+        elif isinstance(template, six.string_types):\n             return loader.get_template(template)\n         else:\n             return template\n@@ -137,8 +138,8 @@ class TemplateResponse(SimpleTemplateResponse):\n     rendering_attrs = SimpleTemplateResponse.rendering_attrs + \\\n         ['_request', '_current_app']\n \n-    def __init__(self, request, template, context=None, mimetype=None,\n-            status=None, content_type=None, current_app=None):\n+    def __init__(self, request, template, context=None, content_type=None,\n+            status=None, mimetype=None, current_app=None):\n         # self.request gets over-written by django.test.client.Client - and\n         # unlike context_data and template_name the _request should not\n         # be considered part of the public API.\n@@ -147,7 +148,7 @@ def __init__(self, request, template, context=None, mimetype=None,\n         # having to avoid needing to create the RequestContext directly\n         self._current_app = current_app\n         super(TemplateResponse, self).__init__(\n-            template, context, mimetype, status, content_type)\n+            template, context, content_type, status, mimetype)\n \n     def resolve_context(self, context):\n         \"\"\"Convert context data into a full RequestContext object"
        },
        {
            "sha": "509ab6707de200c50dc0c364b8bcd1abd4eb0ffb",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,6 +5,7 @@\n     TokenParser, Library, TOKEN_TEXT, TOKEN_VAR)\n from django.template.base import _render_value_in_context\n from django.template.defaulttags import token_kwargs\n+from django.utils import six\n from django.utils import translation\n \n \n@@ -76,7 +77,7 @@ def __init__(self, filter_expression, noop, asvar=None,\n         self.asvar = asvar\n         self.message_context = message_context\n         self.filter_expression = filter_expression\n-        if isinstance(self.filter_expression.var, basestring):\n+        if isinstance(self.filter_expression.var, six.string_types):\n             self.filter_expression.var = Variable(\"'%s'\" %\n                                                   self.filter_expression.var)\n "
        },
        {
            "sha": "5b0e40eba6c591cd322d534b4e4748a4a2199ef2",
            "filename": "django/templatetags/static.py",
            "status": "modified",
            "additions": 64,
            "deletions": 5,
            "changes": 69,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplatetags%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplatetags%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fstatic.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,9 +1,15 @@\n-from urlparse import urljoin\n+try:\n+    from urllib.parse import urljoin\n+except ImportError:     # Python 2\n+    from urlparse import urljoin\n+\n from django import template\n+from django.template.base import Node\n from django.utils.encoding import iri_to_uri\n \n register = template.Library()\n \n+\n class PrefixNode(template.Node):\n \n     def __repr__(self):\n@@ -48,6 +54,7 @@ def render(self, context):\n         context[self.varname] = prefix\n         return ''\n \n+\n @register.tag\n def get_static_prefix(parser, token):\n     \"\"\"\n@@ -66,6 +73,7 @@ def get_static_prefix(parser, token):\n     \"\"\"\n     return PrefixNode.handle_token(parser, token, \"STATIC_URL\")\n \n+\n @register.tag\n def get_media_prefix(parser, token):\n     \"\"\"\n@@ -84,19 +92,70 @@ def get_media_prefix(parser, token):\n     \"\"\"\n     return PrefixNode.handle_token(parser, token, \"MEDIA_URL\")\n \n-@register.simple_tag\n-def static(path):\n+\n+class StaticNode(Node):\n+    def __init__(self, varname=None, path=None):\n+        if path is None:\n+            raise template.TemplateSyntaxError(\n+                \"Static template nodes must be given a path to return.\")\n+        self.path = path\n+        self.varname = varname\n+\n+    def url(self, context):\n+        path = self.path.resolve(context)\n+        return self.handle_simple(path)\n+\n+    def render(self, context):\n+        url = self.url(context)\n+        if self.varname is None:\n+            return url\n+        context[self.varname] = url\n+        return ''\n+\n+    @classmethod\n+    def handle_simple(cls, path):\n+        return urljoin(PrefixNode.handle_simple(\"STATIC_URL\"), path)\n+\n+    @classmethod\n+    def handle_token(cls, parser, token):\n+        \"\"\"\n+        Class method to parse prefix node and return a Node.\n+        \"\"\"\n+        bits = token.split_contents()\n+\n+        if len(bits) < 2:\n+            raise template.TemplateSyntaxError(\n+                \"'%s' takes at least one argument (path to file)\" % bits[0])\n+\n+        path = parser.compile_filter(bits[1])\n+\n+        if len(bits) >= 2 and bits[-2] == 'as':\n+            varname = bits[3]\n+        else:\n+            varname = None\n+\n+        return cls(varname, path)\n+\n+\n+@register.tag('static')\n+def do_static(parser, token):\n     \"\"\"\n     Joins the given path with the STATIC_URL setting.\n \n     Usage::\n \n-        {% static path %}\n+        {% static path [as varname] %}\n \n     Examples::\n \n         {% static \"myapp/css/base.css\" %}\n         {% static variable_with_path %}\n+        {% static \"myapp/css/base.css\" as admin_base_css %}\n+        {% static variable_with_path as varname %}\n \n     \"\"\"\n-    return urljoin(PrefixNode.handle_simple(\"STATIC_URL\"), path)\n+    return StaticNode.handle_token(parser, token)\n+\n+\n+def static(path):\n+    return StaticNode.handle_simple(path)"
        },
        {
            "sha": "96210f189d5a5254026a45263065764a2aa5b398",
            "filename": "django/templatetags/tz.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplatetags%2Ftz.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftemplatetags%2Ftz.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Ftz.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,7 @@\n \n from django.template import Node\n from django.template import TemplateSyntaxError, Library\n+from django.utils import six\n from django.utils import timezone\n \n register = Library()\n@@ -64,7 +65,7 @@ def do_timezone(value, arg):\n     # Obtain a tzinfo instance\n     if isinstance(arg, tzinfo):\n         tz = arg\n-    elif isinstance(arg, basestring) and pytz is not None:\n+    elif isinstance(arg, six.string_types) and pytz is not None:\n         try:\n             tz = pytz.timezone(arg)\n         except pytz.UnknownTimeZoneError:"
        },
        {
            "sha": "316c785f3361b4d8266be9963d8921bfc3026682",
            "filename": "django/test/_doctest.py",
            "status": "modified",
            "additions": 15,
            "deletions": 13,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2F_doctest.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2F_doctest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F_doctest.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -103,7 +103,9 @@ def _test():\n import sys, traceback, inspect, linecache, os, re\n import unittest, difflib, pdb, tempfile\n import warnings\n-from StringIO import StringIO\n+\n+from django.utils import six\n+from django.utils.six import StringIO\n \n if sys.platform.startswith('java'):\n     # On Jython, isclass() reports some modules as classes. Patch it.\n@@ -209,7 +211,7 @@ def _normalize_module(module, depth=2):\n     \"\"\"\n     if inspect.ismodule(module):\n         return module\n-    elif isinstance(module, (str, unicode)):\n+    elif isinstance(module, six.string_types):\n         return __import__(module, globals(), locals(), [\"*\"])\n     elif module is None:\n         return sys.modules[sys._getframe(depth).f_globals['__name__']]\n@@ -478,7 +480,7 @@ def __init__(self, examples, globs, name, filename, lineno, docstring):\n         Create a new DocTest containing the given examples.  The\n         DocTest's globals are initialized with a copy of `globs`.\n         \"\"\"\n-        assert not isinstance(examples, basestring), \\\n+        assert not isinstance(examples, six.string_types), \\\n                \"DocTest no longer accepts str; use DocTestParser instead\"\n         self.examples = examples\n         self.docstring = docstring\n@@ -861,7 +863,7 @@ def _from_module(self, module, object):\n         if module is None:\n             return True\n         elif inspect.isfunction(object):\n-            return module.__dict__ is object.func_globals\n+            return module.__dict__ is object.__globals__\n         elif inspect.isclass(object):\n             return module.__name__ == object.__module__\n         elif inspect.getmodule(object) is not None:\n@@ -904,13 +906,13 @@ def _find(self, tests, obj, name, module, source_lines, globs, seen):\n         # Look for tests in a module's __test__ dictionary.\n         if inspect.ismodule(obj) and self._recurse:\n             for valname, val in getattr(obj, '__test__', {}).items():\n-                if not isinstance(valname, basestring):\n+                if not isinstance(valname, six.string_types):\n                     raise ValueError(\"DocTestFinder.find: __test__ keys \"\n                                      \"must be strings: %r\" %\n                                      (type(valname),))\n                 if not (inspect.isfunction(val) or inspect.isclass(val) or\n                         inspect.ismethod(val) or inspect.ismodule(val) or\n-                        isinstance(val, basestring)):\n+                        isinstance(val, six.string_types)):\n                     raise ValueError(\"DocTestFinder.find: __test__ values \"\n                                      \"must be strings, functions, methods, \"\n                                      \"classes, or modules: %r\" %\n@@ -926,7 +928,7 @@ def _find(self, tests, obj, name, module, source_lines, globs, seen):\n                 if isinstance(val, staticmethod):\n                     val = getattr(obj, valname)\n                 if isinstance(val, classmethod):\n-                    val = getattr(obj, valname).im_func\n+                    val = getattr(obj, valname).__func__\n \n                 # Recurse to methods, properties, and nested classes.\n                 if ((inspect.isfunction(val) or inspect.isclass(val) or\n@@ -943,15 +945,15 @@ def _get_test(self, obj, name, module, globs, source_lines):\n         \"\"\"\n         # Extract the object's docstring.  If it doesn't have one,\n         # then return None (no test for this object).\n-        if isinstance(obj, basestring):\n+        if isinstance(obj, six.string_types):\n             docstring = obj\n         else:\n             try:\n                 if obj.__doc__ is None:\n                     docstring = ''\n                 else:\n                     docstring = obj.__doc__\n-                    if not isinstance(docstring, basestring):\n+                    if not isinstance(docstring, six.string_types):\n                         docstring = str(docstring)\n             except (TypeError, AttributeError):\n                 docstring = ''\n@@ -998,8 +1000,8 @@ def _find_lineno(self, obj, source_lines):\n                     break\n \n         # Find the line number for functions & methods.\n-        if inspect.ismethod(obj): obj = obj.im_func\n-        if inspect.isfunction(obj): obj = obj.func_code\n+        if inspect.ismethod(obj): obj = obj.__func__\n+        if inspect.isfunction(obj): obj = obj.__code__\n         if inspect.istraceback(obj): obj = obj.tb_frame\n         if inspect.isframe(obj): obj = obj.f_code\n         if inspect.iscode(obj):\n@@ -1232,8 +1234,8 @@ def __run(self, test, compileflags, out):\n             # keyboard interrupts.)\n             try:\n                 # Don't blink!  This is where the user's code gets run.\n-                exec compile(example.source, filename, \"single\",\n-                             compileflags, 1) in test.globs\n+                six.exec_(compile(example.source, filename, \"single\",\n+                             compileflags, 1), test.globs)\n                 self.debugger.set_continue() # ==== Example Finished ====\n                 exception = None\n             except KeyboardInterrupt:"
        },
        {
            "sha": "a18b7f8853073af22ae1ebc5c50896bb8512a3d9",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,11 +1,14 @@\n-import urllib\n import sys\n import os\n import re\n import mimetypes\n from copy import copy\n from io import BytesIO\n-from urlparse import urlparse, urlsplit\n+try:\n+    from urllib.parse import unquote, urlparse, urlsplit\n+except ImportError:     # Python 2\n+    from urllib import unquote\n+    from urlparse import urlparse, urlsplit\n \n from django.conf import settings\n from django.contrib.auth import authenticate, login\n@@ -20,6 +23,7 @@\n from django.utils.http import urlencode\n from django.utils.importlib import import_module\n from django.utils.itercompat import is_iterable\n+from django.utils import six\n from django.db import close_connection\n from django.test.utils import ContextList\n \n@@ -115,7 +119,7 @@ def encode_multipart(boundary, data):\n     for (key, value) in data.items():\n         if is_file(value):\n             lines.extend(encode_file(boundary, key, value))\n-        elif not isinstance(value, basestring) and is_iterable(value):\n+        elif not isinstance(value, six.string_types) and is_iterable(value):\n             for item in value:\n                 if is_file(item):\n                     lines.extend(encode_file(boundary, key, item))\n@@ -221,9 +225,9 @@ def _encode_data(self, data, content_type, ):\n     def _get_path(self, parsed):\n         # If there are parameters, add them\n         if parsed[3]:\n-            return urllib.unquote(parsed[2] + \";\" + parsed[3])\n+            return unquote(parsed[2] + \";\" + parsed[3])\n         else:\n-            return urllib.unquote(parsed[2])\n+            return unquote(parsed[2])\n \n     def get(self, path, data={}, **extra):\n         \"Construct a GET request.\"\n@@ -381,7 +385,7 @@ def request(self, **request):\n             if self.exc_info:\n                 exc_info = self.exc_info\n                 self.exc_info = None\n-                raise exc_info[1], None, exc_info[2]\n+                six.reraise(exc_info[1], None, exc_info[2])\n \n             # Save the client and request that stimulated the response.\n             response.client = self"
        },
        {
            "sha": "2a1421bf17a25a16a424fdd884521e781bb5c70e",
            "filename": "django/test/html.py",
            "status": "modified",
            "additions": 14,
            "deletions": 14,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fhtml.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,9 +5,9 @@\n from __future__ import unicode_literals\n \n import re\n-from HTMLParser import HTMLParseError\n from django.utils.encoding import force_unicode\n-from django.utils.html_parser import HTMLParser\n+from django.utils.html_parser import HTMLParser, HTMLParseError\n+from django.utils import six\n \n \n WHITESPACE = re.compile('\\s+')\n@@ -24,19 +24,19 @@ def __init__(self, name, attributes):\n         self.children = []\n \n     def append(self, element):\n-        if isinstance(element, basestring):\n+        if isinstance(element, six.string_types):\n             element = force_unicode(element)\n             element = normalize_whitespace(element)\n             if self.children:\n-                if isinstance(self.children[-1], basestring):\n+                if isinstance(self.children[-1], six.string_types):\n                     self.children[-1] += element\n                     self.children[-1] = normalize_whitespace(self.children[-1])\n                     return\n         elif self.children:\n             # removing last children if it is only whitespace\n             # this can result in incorrect dom representations since\n             # whitespace between inline tags like <span> is significant\n-            if isinstance(self.children[-1], basestring):\n+            if isinstance(self.children[-1], six.string_types):\n                 if self.children[-1].isspace():\n                     self.children.pop()\n         if element:\n@@ -45,7 +45,7 @@ def append(self, element):\n     def finalize(self):\n         def rstrip_last_element(children):\n             if children:\n-                if isinstance(children[-1], basestring):\n+                if isinstance(children[-1], six.string_types):\n                     children[-1] = children[-1].rstrip()\n                     if not children[-1]:\n                         children.pop()\n@@ -54,7 +54,7 @@ def rstrip_last_element(children):\n \n         rstrip_last_element(self.children)\n         for i, child in enumerate(self.children):\n-            if isinstance(child, basestring):\n+            if isinstance(child, six.string_types):\n                 self.children[i] = child.strip()\n             elif hasattr(child, 'finalize'):\n                 child.finalize()\n@@ -87,15 +87,15 @@ def __ne__(self, element):\n         return not self.__eq__(element)\n \n     def _count(self, element, count=True):\n-        if not isinstance(element, basestring):\n+        if not isinstance(element, six.string_types):\n             if self == element:\n                 return 1\n         i = 0\n         for child in self.children:\n             # child is text content and element is also text content, then\n             # make a simple \"text\" in \"text\"\n-            if isinstance(child, basestring):\n-                if isinstance(element, basestring):\n+            if isinstance(child, six.string_types):\n+                if isinstance(element, six.string_types):\n                     if count:\n                         i += child.count(element)\n                     elif element in child:\n@@ -124,22 +124,22 @@ def __unicode__(self):\n                 output += ' %s' % key\n         if self.children:\n             output += '>\\n'\n-            output += ''.join(unicode(c) for c in self.children)\n+            output += ''.join(six.text_type(c) for c in self.children)\n             output += '\\n</%s>' % self.name\n         else:\n             output += ' />'\n         return output\n \n     def __repr__(self):\n-        return unicode(self)\n+        return six.text_type(self)\n \n \n class RootElement(Element):\n     def __init__(self):\n         super(RootElement, self).__init__(None, ())\n \n     def __unicode__(self):\n-        return ''.join(unicode(c) for c in self.children)\n+        return ''.join(six.text_type(c) for c in self.children)\n \n \n class Parser(HTMLParser):\n@@ -219,6 +219,6 @@ def parse_html(html):\n     document.finalize()\n     # Removing ROOT element if it's not necessary\n     if len(document.children) == 1:\n-        if not isinstance(document.children[0], basestring):\n+        if not isinstance(document.children[0], six.string_types):\n             document = document.children[0]\n     return document"
        },
        {
            "sha": "052b7dfa5c527ebaea1a89eac8ba2a832cd45067",
            "filename": "django/test/signals.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsignals.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -11,6 +11,9 @@\n \n setting_changed = Signal(providing_args=[\"setting\", \"value\"])\n \n+# Most setting_changed receivers are supposed to be added below,\n+# except for cases where the receiver is related to a contrib app.\n+\n \n @receiver(setting_changed)\n def update_connections_time_zone(**kwargs):\n@@ -46,3 +49,12 @@ def update_connections_time_zone(**kwargs):\n def clear_context_processors_cache(**kwargs):\n     if kwargs['setting'] == 'TEMPLATE_CONTEXT_PROCESSORS':\n         context._standard_context_processors = None\n+\n+\n+@receiver(setting_changed)\n+def language_changed(**kwargs):\n+    if kwargs['setting'] in ('LOCALE_PATHS', 'LANGUAGE_CODE'):\n+        from django.utils.translation import trans_real\n+        trans_real._default = None\n+        if kwargs['setting'] == 'LOCALE_PATHS':\n+            trans_real._translations = {}"
        },
        {
            "sha": "bf0219d53f011b1e6531b81a07b40ac1c0adda6f",
            "filename": "django/test/simple.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fsimple.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Fsimple.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fsimple.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,7 +5,7 @@\n from django.db.models import get_app, get_apps\n from django.test import _doctest as doctest\n from django.test.utils import setup_test_environment, teardown_test_environment\n-from django.test.testcases import OutputChecker, DocTestRunner, TestCase\n+from django.test.testcases import OutputChecker, DocTestRunner\n from django.utils import unittest\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n@@ -263,7 +263,7 @@ def build_suite(self, test_labels, extra_tests=None, **kwargs):\n             for test in extra_tests:\n                 suite.addTest(test)\n \n-        return reorder_suite(suite, (TestCase,))\n+        return reorder_suite(suite, (unittest.TestCase,))\n \n     def setup_databases(self, **kwargs):\n         from django.db import connections, DEFAULT_DB_ALIAS"
        },
        {
            "sha": "b60188bf303f89c0ff9fdc4409fc84e9d11afe3c",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 57,
            "deletions": 22,
            "changes": 79,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,7 +7,10 @@\n import sys\n from copy import copy\n from functools import wraps\n-from urlparse import urlsplit, urlunsplit\n+try:\n+    from urllib.parse import urlsplit, urlunsplit\n+except ImportError:     # Python 2\n+    from urlparse import urlsplit, urlunsplit\n from xml.dom.minidom import parseString, Node\n import select\n import socket\n@@ -20,6 +23,7 @@\n from django.core.exceptions import ValidationError, ImproperlyConfigured\n from django.core.handlers.wsgi import WSGIHandler\n from django.core.management import call_command\n+from django.core.management.color import no_style\n from django.core.signals import request_started\n from django.core.servers.basehttp import (WSGIRequestHandler, WSGIServer,\n     WSGIServerException)\n@@ -38,6 +42,7 @@\n from django.test.utils import ContextList\n from django.utils import unittest as ut2\n from django.utils.encoding import smart_str, force_unicode\n+from django.utils import six\n from django.utils.unittest.util import safe_repr\n from django.views.static import serve\n \n@@ -421,8 +426,8 @@ def assertHTMLEqual(self, html1, html2, msg=None):\n             standardMsg = '%s != %s' % (\n                 safe_repr(dom1, True), safe_repr(dom2, True))\n             diff = ('\\n' + '\\n'.join(difflib.ndiff(\n-                           unicode(dom1).splitlines(),\n-                           unicode(dom2).splitlines())))\n+                           six.text_type(dom1).splitlines(),\n+                           six.text_type(dom2).splitlines())))\n             standardMsg = self._truncateMessage(standardMsg, diff)\n             self.fail(self._formatMessage(msg, standardMsg))\n \n@@ -440,10 +445,15 @@ def assertHTMLNotEqual(self, html1, html2, msg=None):\n \n \n class TransactionTestCase(SimpleTestCase):\n+\n     # The class we'll use for the test client self.client.\n     # Can be overridden in derived classes.\n     client_class = Client\n \n+    # Subclasses can ask for resetting of auto increment sequence before each\n+    # test case\n+    reset_sequences = False\n+\n     def _pre_setup(self):\n         \"\"\"Performs any pre-test setup. This includes:\n \n@@ -458,22 +468,36 @@ def _pre_setup(self):\n         self._urlconf_setup()\n         mail.outbox = []\n \n+    def _reset_sequences(self, db_name):\n+        conn = connections[db_name]\n+        if conn.features.supports_sequence_reset:\n+            sql_list = \\\n+                conn.ops.sequence_reset_by_name_sql(no_style(),\n+                                                    conn.introspection.sequence_list())\n+            if sql_list:\n+                try:\n+                    cursor = conn.cursor()\n+                    for sql in sql_list:\n+                        cursor.execute(sql)\n+                except Exception:\n+                    transaction.rollback_unless_managed(using=db_name)\n+                    raise\n+                transaction.commit_unless_managed(using=db_name)\n+\n     def _fixture_setup(self):\n-        # If the test case has a multi_db=True flag, flush all databases.\n-        # Otherwise, just flush default.\n-        if getattr(self, 'multi_db', False):\n-            databases = connections\n-        else:\n-            databases = [DEFAULT_DB_ALIAS]\n-        for db in databases:\n-            call_command('flush', verbosity=0, interactive=False, database=db,\n-                         skip_validation=True)\n+        # If the test case has a multi_db=True flag, act on all databases.\n+        # Otherwise, just on the default DB.\n+        db_names = connections if getattr(self, 'multi_db', False) else [DEFAULT_DB_ALIAS]\n+        for db_name in db_names:\n+            # Reset sequences\n+            if self.reset_sequences:\n+                self._reset_sequences(db_name)\n \n             if hasattr(self, 'fixtures'):\n                 # We have to use this slightly awkward syntax due to the fact\n                 # that we're using *args and **kwargs together.\n                 call_command('loaddata', *self.fixtures,\n-                             **{'verbosity': 0, 'database': db, 'skip_validation': True})\n+                             **{'verbosity': 0, 'database': db_name, 'skip_validation': True})\n \n     def _urlconf_setup(self):\n         if hasattr(self, 'urls'):\n@@ -530,7 +554,12 @@ def _post_teardown(self):\n             conn.close()\n \n     def _fixture_teardown(self):\n-        pass\n+        # If the test case has a multi_db=True flag, flush all databases.\n+        # Otherwise, just flush default.\n+        databases = connections if getattr(self, 'multi_db', False) else [DEFAULT_DB_ALIAS]\n+        for db in databases:\n+            call_command('flush', verbosity=0, interactive=False, database=db,\n+                         skip_validation=True, reset_sequences=False)\n \n     def _urlconf_teardown(self):\n         if hasattr(self, '_old_root_urlconf'):\n@@ -804,22 +833,21 @@ def _fixture_setup(self):\n         if not connections_support_transactions():\n             return super(TestCase, self)._fixture_setup()\n \n+        assert not self.reset_sequences, 'reset_sequences cannot be used on TestCase instances'\n+\n         # If the test case has a multi_db=True flag, setup all databases.\n         # Otherwise, just use default.\n-        if getattr(self, 'multi_db', False):\n-            databases = connections\n-        else:\n-            databases = [DEFAULT_DB_ALIAS]\n+        db_names = connections if getattr(self, 'multi_db', False) else [DEFAULT_DB_ALIAS]\n \n-        for db in databases:\n-            transaction.enter_transaction_management(using=db)\n-            transaction.managed(True, using=db)\n+        for db_name in db_names:\n+            transaction.enter_transaction_management(using=db_name)\n+            transaction.managed(True, using=db_name)\n         disable_transaction_methods()\n \n         from django.contrib.sites.models import Site\n         Site.objects.clear_cache()\n \n-        for db in databases:\n+        for db in db_names:\n             if hasattr(self, 'fixtures'):\n                 call_command('loaddata', *self.fixtures,\n                              **{\n@@ -1138,4 +1166,11 @@ def tearDownClass(cls):\n         if hasattr(cls, 'server_thread'):\n             # Terminate the live server's thread\n             cls.server_thread.join()\n+\n+        # Restore sqlite connections' non-sharability\n+        for conn in connections.all():\n+            if (conn.settings_dict['ENGINE'] == 'django.db.backends.sqlite3'\n+                and conn.settings_dict['NAME'] == ':memory:'):\n+                conn.allow_thread_sharing = False\n+\n         super(LiveServerTestCase, cls).tearDownClass()"
        },
        {
            "sha": "4b121bdfb0e4ac0b3edb4b422d6486345c150197",
            "filename": "django/test/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Ftest%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Futils.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,6 +6,7 @@\n from django.template.loaders import cached\n from django.utils.translation import deactivate\n from django.utils.functional import wraps\n+from django.utils import six\n \n \n __all__ = (\n@@ -35,7 +36,7 @@ class ContextList(list):\n     in a list of context objects.\n     \"\"\"\n     def __getitem__(self, key):\n-        if isinstance(key, basestring):\n+        if isinstance(key, six.string_types):\n             for subcontext in self:\n                 if key in subcontext:\n                     return subcontext[key]"
        },
        {
            "sha": "6b5d73290f62a29d7d026c920f0913f53a3709b4",
            "filename": "django/utils/archive.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Farchive.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Farchive.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Farchive.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -27,6 +27,8 @@\n import tarfile\n import zipfile\n \n+from django.utils import six\n+\n \n class ArchiveException(Exception):\n     \"\"\"\n@@ -58,7 +60,7 @@ def __init__(self, file):\n     @staticmethod\n     def _archive_cls(file):\n         cls = None\n-        if isinstance(file, basestring):\n+        if isinstance(file, six.string_types):\n             filename = file\n         else:\n             try:"
        },
        {
            "sha": "b6c055383c153f456c797fee4f5ca10904c82bb4",
            "filename": "django/utils/autoreload.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fautoreload.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fautoreload.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fautoreload.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -33,7 +33,7 @@\n try:\n     import thread\n except ImportError:\n-    import dummy_thread as thread\n+    from django.utils.six.moves import _dummy_thread as thread\n \n # This import does nothing, but it's necessary to avoid some race conditions\n # in the threading module. See http://code.djangoproject.com/ticket/2330 ."
        },
        {
            "sha": "053ce3e97ecde313d80717dd871d2fcbc3020a0d",
            "filename": "django/utils/baseconv.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fbaseconv.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fbaseconv.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fbaseconv.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,4 +1,4 @@\n-# Copyright (c) 2010 Taurinus Collective. All rights reserved.\n+# Copyright (c) 2010 Guilherme Gondim. All rights reserved.\n # Copyright (c) 2009 Simon Willison. All rights reserved.\n # Copyright (c) 2002 Drew Perttula. All rights reserved.\n #"
        },
        {
            "sha": "6bbdccc58c5b671b1f15c4cbae73a78b2a295f2a",
            "filename": "django/utils/checksums.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fchecksums.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fchecksums.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fchecksums.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,6 +4,8 @@\n \n __all__ = ['luhn',]\n \n+from django.utils import six\n+\n LUHN_ODD_LOOKUP = (0, 2, 4, 6, 8, 1, 3, 5, 7, 9) # sum_of_digits(index * 2)\n \n def luhn(candidate):\n@@ -12,7 +14,7 @@ def luhn(candidate):\n     algorithm (used in validation of, for example, credit cards).\n     Both numeric and string candidates are accepted.\n     \"\"\"\n-    if not isinstance(candidate, basestring):\n+    if not isinstance(candidate, six.string_types):\n         candidate = str(candidate)\n     try:\n         evens = sum([int(c) for c in candidate[-1::-2]])"
        },
        {
            "sha": "9d46bdd793818423dd7bbca6f79ff7d052ca7227",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -24,10 +24,11 @@\n \n from django.conf import settings\n from django.utils.encoding import smart_str\n+from django.utils.six.moves import xrange\n \n \n-_trans_5c = b\"\".join([chr(x ^ 0x5C) for x in xrange(256)])\n-_trans_36 = b\"\".join([chr(x ^ 0x36) for x in xrange(256)])\n+_trans_5c = bytearray([(x ^ 0x5C) for x in xrange(256)])\n+_trans_36 = bytearray([(x ^ 0x36) for x in xrange(256)])\n \n \n def salted_hmac(key_salt, value, secret=None):\n@@ -98,7 +99,7 @@ def _bin_to_long(x):\n \n     This is a clever optimization for fast xor vector math\n     \"\"\"\n-    return long(x.encode('hex'), 16)\n+    return int(x.encode('hex'), 16)\n \n \n def _long_to_bin(x, hex_format_string):"
        },
        {
            "sha": "763a9db752938488a6b83501eea5c84c947b7c1c",
            "filename": "django/utils/daemonize.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdaemonize.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdaemonize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdaemonize.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,7 +3,7 @@\n \n if os.name == 'posix':\n     def become_daemon(our_home_dir='.', out_log='/dev/null',\n-                      err_log='/dev/null', umask=022):\n+                      err_log='/dev/null', umask=0o022):\n         \"Robustly turn into a UNIX daemon, running in our_home_dir.\"\n         # First fork\n         try:\n@@ -33,7 +33,7 @@ def become_daemon(our_home_dir='.', out_log='/dev/null',\n         # Set custom file descriptors so that they get proper buffering.\n         sys.stdout, sys.stderr = so, se\n else:\n-    def become_daemon(our_home_dir='.', out_log=None, err_log=None, umask=022):\n+    def become_daemon(our_home_dir='.', out_log=None, err_log=None, umask=0o022):\n         \"\"\"\n         If we're not running under a POSIX system, just simulate the daemon\n         mode by doing redirections and directory changing."
        },
        {
            "sha": "bbd31ad36cfa7bf80cb3e59db5216db3c24963c0",
            "filename": "django/utils/datastructures.py",
            "status": "modified",
            "additions": 97,
            "deletions": 89,
            "changes": 186,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdatastructures.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,8 @@\n import copy\n+import warnings\n from types import GeneratorType\n+from django.utils import six\n+\n \n class MergeDict(object):\n     \"\"\"\n@@ -29,38 +32,48 @@ def get(self, key, default=None):\n         except KeyError:\n             return default\n \n+    # This is used by MergeDicts of MultiValueDicts.\n     def getlist(self, key):\n         for dict_ in self.dicts:\n-            if key in dict_.keys():\n+            if key in dict_:\n                 return dict_.getlist(key)\n         return []\n \n-    def iteritems(self):\n+    def _iteritems(self):\n         seen = set()\n         for dict_ in self.dicts:\n-            for item in dict_.iteritems():\n-                k, v = item\n+            for item in six.iteritems(dict_):\n+                k = item[0]\n                 if k in seen:\n                     continue\n                 seen.add(k)\n                 yield item\n \n-    def iterkeys(self):\n-        for k, v in self.iteritems():\n+    def _iterkeys(self):\n+        for k, v in self._iteritems():\n             yield k\n \n-    def itervalues(self):\n-        for k, v in self.iteritems():\n+    def _itervalues(self):\n+        for k, v in self._iteritems():\n             yield v\n \n-    def items(self):\n-        return list(self.iteritems())\n+    if six.PY3:\n+        items = _iteritems\n+        keys = _iterkeys\n+        values = _itervalues\n+    else:\n+        iteritems = _iteritems\n+        iterkeys = _iterkeys\n+        itervalues = _itervalues\n \n-    def keys(self):\n-        return list(self.iterkeys())\n+        def items(self):\n+            return list(self.iteritems())\n \n-    def values(self):\n-        return list(self.itervalues())\n+        def keys(self):\n+            return list(self.iterkeys())\n+\n+        def values(self):\n+            return list(self.itervalues())\n \n     def has_key(self, key):\n         for dict_ in self.dicts:\n@@ -69,7 +82,8 @@ def has_key(self, key):\n         return False\n \n     __contains__ = has_key\n-    __iter__ = iterkeys\n+\n+    __iter__ = _iterkeys\n \n     def copy(self):\n         \"\"\"Returns a copy of this object.\"\"\"\n@@ -115,7 +129,7 @@ def __init__(self, data=None):\n             data = list(data)\n         super(SortedDict, self).__init__(data)\n         if isinstance(data, dict):\n-            self.keyOrder = data.keys()\n+            self.keyOrder = list(six.iterkeys(data))\n         else:\n             self.keyOrder = []\n             seen = set()\n@@ -126,7 +140,7 @@ def __init__(self, data=None):\n \n     def __deepcopy__(self, memo):\n         return self.__class__([(key, copy.deepcopy(value, memo))\n-                               for key, value in self.iteritems()])\n+                               for key, value in six.iteritems(self)])\n \n     def __copy__(self):\n         # The Python's default copy implementation will alter the state\n@@ -160,28 +174,38 @@ def popitem(self):\n         self.keyOrder.remove(result[0])\n         return result\n \n-    def items(self):\n-        return zip(self.keyOrder, self.values())\n-\n-    def iteritems(self):\n+    def _iteritems(self):\n         for key in self.keyOrder:\n             yield key, self[key]\n \n-    def keys(self):\n-        return self.keyOrder[:]\n-\n-    def iterkeys(self):\n-        return iter(self.keyOrder)\n-\n-    def values(self):\n-        return map(self.__getitem__, self.keyOrder)\n+    def _iterkeys(self):\n+        for key in self.keyOrder:\n+            yield key\n \n-    def itervalues(self):\n+    def _itervalues(self):\n         for key in self.keyOrder:\n             yield self[key]\n \n+    if six.PY3:\n+        items = _iteritems\n+        keys = _iterkeys\n+        values = _itervalues\n+    else:\n+        iteritems = _iteritems\n+        iterkeys = _iterkeys\n+        itervalues = _itervalues\n+\n+        def items(self):\n+            return list(self.iteritems())\n+\n+        def keys(self):\n+            return list(self.iterkeys())\n+\n+        def values(self):\n+            return list(self.itervalues())\n+\n     def update(self, dict_):\n-        for k, v in dict_.iteritems():\n+        for k, v in six.iteritems(dict_):\n             self[k] = v\n \n     def setdefault(self, key, default):\n@@ -191,10 +215,21 @@ def setdefault(self, key, default):\n \n     def value_for_index(self, index):\n         \"\"\"Returns the value of the item at the given zero-based index.\"\"\"\n+        # This, and insert() are deprecated because they cannot be implemented\n+        # using collections.OrderedDict (Python 2.7 and up), which we'll\n+        # eventually switch to\n+        warnings.warn(\n+            \"SortedDict.value_for_index is deprecated\", PendingDeprecationWarning,\n+            stacklevel=2\n+        )\n         return self[self.keyOrder[index]]\n \n     def insert(self, index, key, value):\n         \"\"\"Inserts the key, value pair before the item with the given index.\"\"\"\n+        warnings.warn(\n+            \"SortedDict.insert is deprecated\", PendingDeprecationWarning,\n+            stacklevel=2\n+        )\n         if key in self.keyOrder:\n             n = self.keyOrder.index(key)\n             del self.keyOrder[n]\n@@ -213,7 +248,7 @@ def __repr__(self):\n         Replaces the normal dict.__repr__ with a version that returns the keys\n         in their sorted order.\n         \"\"\"\n-        return '{%s}' % ', '.join(['%r: %r' % (k, v) for k, v in self.items()])\n+        return '{%s}' % ', '.join(['%r: %r' % (k, v) for k, v in six.iteritems(self)])\n \n     def clear(self):\n         super(SortedDict, self).clear()\n@@ -326,53 +361,58 @@ def setlist(self, key, list_):\n     def setdefault(self, key, default=None):\n         if key not in self:\n             self[key] = default\n-            return default\n+            # Do not return default here because __setitem__() may store\n+            # another value -- QueryDict.__setitem__() does. Look it up.\n         return self[key]\n \n     def setlistdefault(self, key, default_list=None):\n         if key not in self:\n             if default_list is None:\n                 default_list = []\n             self.setlist(key, default_list)\n-            return default_list\n+            # Do not return default_list here because setlist() may store\n+            # another value -- QueryDict.setlist() does. Look it up.\n         return self.getlist(key)\n \n     def appendlist(self, key, value):\n         \"\"\"Appends an item to the internal list associated with key.\"\"\"\n         self.setlistdefault(key).append(value)\n \n-    def items(self):\n-        \"\"\"\n-        Returns a list of (key, value) pairs, where value is the last item in\n-        the list associated with the key.\n-        \"\"\"\n-        return [(key, self[key]) for key in self.keys()]\n-\n-    def iteritems(self):\n+    def _iteritems(self):\n         \"\"\"\n         Yields (key, value) pairs, where value is the last item in the list\n         associated with the key.\n         \"\"\"\n-        for key in self.keys():\n-            yield (key, self[key])\n-\n-    def lists(self):\n-        \"\"\"Returns a list of (key, list) pairs.\"\"\"\n-        return super(MultiValueDict, self).items()\n+        for key in self:\n+            yield key, self[key]\n \n-    def iterlists(self):\n+    def _iterlists(self):\n         \"\"\"Yields (key, list) pairs.\"\"\"\n-        return super(MultiValueDict, self).iteritems()\n-\n-    def values(self):\n-        \"\"\"Returns a list of the last value on every key list.\"\"\"\n-        return [self[key] for key in self.keys()]\n+        return six.iteritems(super(MultiValueDict, self))\n \n-    def itervalues(self):\n+    def _itervalues(self):\n         \"\"\"Yield the last value on every key list.\"\"\"\n-        for key in self.iterkeys():\n+        for key in self:\n             yield self[key]\n \n+    if six.PY3:\n+        items = _iteritems\n+        lists = _iterlists\n+        values = _itervalues\n+    else:\n+        iteritems = _iteritems\n+        iterlists = _iterlists\n+        itervalues = _itervalues\n+\n+        def items(self):\n+            return list(self.iteritems())\n+\n+        def lists(self):\n+            return list(self.iterlists())\n+\n+        def values(self):\n+            return list(self.itervalues())\n+\n     def copy(self):\n         \"\"\"Returns a shallow copy of this object.\"\"\"\n         return copy.copy(self)\n@@ -395,7 +435,7 @@ def update(self, *args, **kwargs):\n                         self.setlistdefault(key).append(value)\n                 except TypeError:\n                     raise ValueError(\"MultiValueDict.update() takes either a MultiValueDict or dictionary\")\n-        for key, value in kwargs.iteritems():\n+        for key, value in six.iteritems(kwargs):\n             self.setlistdefault(key).append(value)\n \n     def dict(self):\n@@ -404,38 +444,6 @@ def dict(self):\n         \"\"\"\n         return dict((key, self[key]) for key in self)\n \n-class DotExpandedDict(dict):\n-    \"\"\"\n-    A special dictionary constructor that takes a dictionary in which the keys\n-    may contain dots to specify inner dictionaries. It's confusing, but this\n-    example should make sense.\n-\n-    >>> d = DotExpandedDict({'person.1.firstname': ['Simon'], \\\n-            'person.1.lastname': ['Willison'], \\\n-            'person.2.firstname': ['Adrian'], \\\n-            'person.2.lastname': ['Holovaty']})\n-    >>> d\n-    {'person': {'1': {'lastname': ['Willison'], 'firstname': ['Simon']}, '2': {'lastname': ['Holovaty'], 'firstname': ['Adrian']}}}\n-    >>> d['person']\n-    {'1': {'lastname': ['Willison'], 'firstname': ['Simon']}, '2': {'lastname': ['Holovaty'], 'firstname': ['Adrian']}}\n-    >>> d['person']['1']\n-    {'lastname': ['Willison'], 'firstname': ['Simon']}\n-\n-    # Gotcha: Results are unpredictable if the dots are \"uneven\":\n-    >>> DotExpandedDict({'c.1': 2, 'c.2': 3, 'c': 1})\n-    {'c': 1}\n-    \"\"\"\n-    def __init__(self, key_to_list_mapping):\n-        for k, v in key_to_list_mapping.items():\n-            current = self\n-            bits = k.split('.')\n-            for bit in bits[:-1]:\n-                current = current.setdefault(bit, {})\n-            # Now assign value to current position\n-            try:\n-                current[bits[-1]] = v\n-            except TypeError: # Special-case if current isn't a dict.\n-                current = {bits[-1]: v}\n \n class ImmutableList(tuple):\n     \"\"\""
        },
        {
            "sha": "c9a6138aed2b3c4b1b76c0d0e0a47dd1080b78f1",
            "filename": "django/utils/dateformat.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdateformat.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdateformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdateformat.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -21,6 +21,7 @@\n from django.utils.tzinfo import LocalTimezone\n from django.utils.translation import ugettext as _\n from django.utils.encoding import force_unicode\n+from django.utils import six\n from django.utils.timezone import is_aware, is_naive\n \n re_formatchars = re.compile(r'(?<!\\\\)([aAbBcdDeEfFgGhHiIjlLmMnNoOPrsStTUuwWyYzZ])')\n@@ -236,7 +237,7 @@ def T(self):\n         name = self.timezone and self.timezone.tzname(self.data) or None\n         if name is None:\n             name = self.format('O')\n-        return unicode(name)\n+        return six.text_type(name)\n \n     def U(self):\n         \"Seconds since the Unix epoch (January 1 1970 00:00:00 GMT)\"\n@@ -277,7 +278,7 @@ def W(self):\n \n     def y(self):\n         \"Year, 2 digits; e.g. '99'\"\n-        return unicode(self.data.year)[2:]\n+        return six.text_type(self.data.year)[2:]\n \n     def Y(self):\n         \"Year, 4 digits; e.g. '1999'\""
        },
        {
            "sha": "b4d6d66b3c4420335d6e15b285a40dc74a3d5fc0",
            "filename": "django/utils/dictconfig.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdictconfig.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fdictconfig.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdictconfig.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -23,6 +23,8 @@\n import sys\n import types\n \n+from django.utils import six\n+\n IDENTIFIER = re.compile('^[a-z_][a-z0-9_]*$', re.I)\n \n def valid_ident(s):\n@@ -231,7 +233,7 @@ def convert(self, value):\n                  isinstance(value, tuple):\n             value = ConvertingTuple(value)\n             value.configurator = self\n-        elif isinstance(value, basestring): # str for py3k\n+        elif isinstance(value, six.string_types): # str for py3k\n             m = self.CONVERT_PATTERN.match(value)\n             if m:\n                 d = m.groupdict()"
        },
        {
            "sha": "f2295444bf5ee272ec08979d16bb7c8d0c45eed2",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 37,
            "deletions": 24,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,12 +1,16 @@\n from __future__ import unicode_literals\n \n-import urllib\n-import locale\n-import datetime\n import codecs\n+import datetime\n from decimal import Decimal\n+import locale\n+try:\n+    from urllib.parse import quote\n+except ImportError:     # Python 2\n+    from urllib import quote\n \n from django.utils.functional import Promise\n+from django.utils import six\n \n class DjangoUnicodeDecodeError(UnicodeDecodeError):\n     def __init__(self, obj, *args):\n@@ -24,8 +28,12 @@ class StrAndUnicode(object):\n \n     Useful as a mix-in.\n     \"\"\"\n-    def __str__(self):\n-        return self.__unicode__().encode('utf-8')\n+    if six.PY3:\n+        def __str__(self):\n+            return self.__unicode__()\n+    else:\n+        def __str__(self):\n+            return self.__unicode__().encode('utf-8')\n \n def smart_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n@@ -45,12 +53,8 @@ def is_protected_type(obj):\n     Objects of protected types are preserved as-is when passed to\n     force_unicode(strings_only=True).\n     \"\"\"\n-    return isinstance(obj, (\n-        type(None),\n-        int, long,\n-        datetime.datetime, datetime.date, datetime.time,\n-        float, Decimal)\n-    )\n+    return isinstance(obj, six.integer_types + (type(None), float, Decimal,\n+        datetime.datetime, datetime.date, datetime.time))\n \n def force_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n@@ -62,17 +66,23 @@ def force_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n     # Handle the common case first, saves 30-40% in performance when s\n     # is an instance of unicode. This function gets called often in that\n     # setting.\n-    if isinstance(s, unicode):\n+    if isinstance(s, six.text_type):\n         return s\n     if strings_only and is_protected_type(s):\n         return s\n     try:\n-        if not isinstance(s, basestring,):\n+        if not isinstance(s, six.string_types):\n             if hasattr(s, '__unicode__'):\n-                s = unicode(s)\n+                s = s.__unicode__()\n             else:\n                 try:\n-                    s = unicode(str(s), encoding, errors)\n+                    if six.PY3:\n+                        if isinstance(s, bytes):\n+                            s = six.text_type(s, encoding, errors)\n+                        else:\n+                            s = six.text_type(s)\n+                    else:\n+                        s = six.text_type(bytes(s), encoding, errors)\n                 except UnicodeEncodeError:\n                     if not isinstance(s, Exception):\n                         raise\n@@ -84,8 +94,8 @@ def force_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n                     # output should be.\n                     s = ' '.join([force_unicode(arg, encoding, strings_only,\n                             errors) for arg in s])\n-        elif not isinstance(s, unicode):\n-            # Note: We use .decode() here, instead of unicode(s, encoding,\n+        elif not isinstance(s, six.text_type):\n+            # Note: We use .decode() here, instead of six.text_type(s, encoding,\n             # errors), so that if s is a SafeString, it ends up being a\n             # SafeUnicode at the end.\n             s = s.decode(encoding, errors)\n@@ -111,19 +121,22 @@ def smart_str(s, encoding='utf-8', strings_only=False, errors='strict'):\n     if strings_only and (s is None or isinstance(s, int)):\n         return s\n     if isinstance(s, Promise):\n-        return unicode(s).encode(encoding, errors)\n-    elif not isinstance(s, basestring):\n+        return six.text_type(s).encode(encoding, errors)\n+    elif not isinstance(s, six.string_types):\n         try:\n-            return str(s)\n+            if six.PY3:\n+                return six.text_type(s).encode(encoding)\n+            else:\n+                return bytes(s)\n         except UnicodeEncodeError:\n             if isinstance(s, Exception):\n                 # An Exception subclass containing non-ASCII data that doesn't\n                 # know how to print itself properly. We shouldn't raise a\n                 # further exception.\n                 return ' '.join([smart_str(arg, encoding, strings_only,\n                         errors) for arg in s])\n-            return unicode(s).encode(encoding, errors)\n-    elif isinstance(s, unicode):\n+            return six.text_type(s).encode(encoding, errors)\n+    elif isinstance(s, six.text_type):\n         return s.encode(encoding, errors)\n     elif s and encoding != 'utf-8':\n         return s.decode('utf-8', errors).encode(encoding, errors)\n@@ -155,7 +168,7 @@ def iri_to_uri(iri):\n     # converted.\n     if iri is None:\n         return iri\n-    return urllib.quote(smart_str(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n+    return quote(smart_str(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n \n def filepath_to_uri(path):\n     \"\"\"Convert an file system path to a URI portion that is suitable for\n@@ -174,7 +187,7 @@ def filepath_to_uri(path):\n         return path\n     # I know about `os.sep` and `os.altsep` but I want to leave\n     # some flexibility for hardcoding separators.\n-    return urllib.quote(smart_str(path).replace(\"\\\\\", \"/\"), safe=b\"/~!*()'\")\n+    return quote(smart_str(path).replace(\"\\\\\", \"/\"), safe=b\"/~!*()'\")\n \n # The encoding of the default system locale but falls back to the\n # given fallback encoding if the encoding is unsupported by python or could"
        },
        {
            "sha": "6498aaf57ceeaf037724250edd4cdebffbca09e5",
            "filename": "django/utils/feedgenerator.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ffeedgenerator.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ffeedgenerator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffeedgenerator.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -19,12 +19,15 @@\n ...     feed.write(fp, 'utf-8')\n \n For definitions of the different versions of RSS, see:\n-http://diveintomark.org/archives/2004/02/04/incompatible-rss\n+http://web.archive.org/web/20110718035220/http://diveintomark.org/archives/2004/02/04/incompatible-rss\n \"\"\"\n from __future__ import unicode_literals\n \n import datetime\n-import urlparse\n+try:\n+    from urllib.parse import urlparse\n+except ImportError:     # Python 2\n+    from urlparse import urlparse\n from django.utils.xmlutils import SimplerXMLGenerator\n from django.utils.encoding import force_unicode, iri_to_uri\n from django.utils import datetime_safe\n@@ -65,9 +68,9 @@ def get_tag_uri(url, date):\n     \"\"\"\n     Creates a TagURI.\n \n-    See http://diveintomark.org/archives/2004/05/28/howto-atom-id\n+    See http://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id\n     \"\"\"\n-    bits = urlparse.urlparse(url)\n+    bits = urlparse(url)\n     d = ''\n     if date is not None:\n         d = ',%s' % datetime_safe.new_datetime(date).strftime('%Y-%m-%d')"
        },
        {
            "sha": "2e54d792fa8ed57ad6a9daec30339eb48d8848c5",
            "filename": "django/utils/formats.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fformats.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,7 @@\n from django.utils.encoding import smart_str\n from django.utils.functional import lazy\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.translation import get_language, to_locale, check_for_language\n \n # format_cache is a mapping from (format_type, lang) to the format string.\n@@ -88,7 +89,7 @@ def get_format(format_type, lang=None, use_l10n=None):\n             _format_cache[cache_key] = None\n     return getattr(settings, format_type)\n \n-get_format_lazy = lazy(get_format, unicode, list, tuple)\n+get_format_lazy = lazy(get_format, six.text_type, list, tuple)\n \n def date_format(value, format=None, use_l10n=None):\n     \"\"\"\n@@ -138,8 +139,8 @@ def localize(value, use_l10n=None):\n     be localized (or not), overriding the value of settings.USE_L10N.\n     \"\"\"\n     if isinstance(value, bool):\n-        return mark_safe(unicode(value))\n-    elif isinstance(value, (decimal.Decimal, float, int, long)):\n+        return mark_safe(six.text_type(value))\n+    elif isinstance(value, (decimal.Decimal, float) + six.integer_types):\n         return number_format(value, use_l10n=use_l10n)\n     elif isinstance(value, datetime.datetime):\n         return date_format(value, 'DATETIME_FORMAT', use_l10n=use_l10n)\n@@ -155,7 +156,7 @@ def localize_input(value, default=None):\n     Checks if an input value is a localizable type and returns it\n     formatted with the appropriate formatting string of the current locale.\n     \"\"\"\n-    if isinstance(value, (decimal.Decimal, float, int, long)):\n+    if isinstance(value, (decimal.Decimal, float) + six.integer_types):\n         return number_format(value)\n     elif isinstance(value, datetime.datetime):\n         value = datetime_safe.new_datetime(value)\n@@ -177,7 +178,7 @@ def sanitize_separators(value):\n     \"\"\"\n     if settings.USE_L10N:\n         decimal_separator = get_format('DECIMAL_SEPARATOR')\n-        if isinstance(value, basestring):\n+        if isinstance(value, six.string_types):\n             parts = []\n             if decimal_separator in value:\n                 value, decimals = value.split(decimal_separator, 1)"
        },
        {
            "sha": "2dca182b992de5b986f68047bd1a9bf8353f612f",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,6 +3,7 @@\n from functools import wraps, update_wrapper\n import sys\n \n+from django.utils import six\n \n # You can't trivially replace this `functools.partial` because this binds to\n # classes and returns bound instances, whereas functools.partial (on CPython)\n@@ -92,8 +93,8 @@ def __prepare_class__(cls):\n                         if hasattr(cls, k):\n                             continue\n                         setattr(cls, k, meth)\n-            cls._delegate_str = str in resultclasses\n-            cls._delegate_unicode = unicode in resultclasses\n+            cls._delegate_str = bytes in resultclasses\n+            cls._delegate_unicode = six.text_type in resultclasses\n             assert not (cls._delegate_str and cls._delegate_unicode), \"Cannot call lazy() with both str and unicode return types.\"\n             if cls._delegate_unicode:\n                 cls.__unicode__ = cls.__unicode_cast\n@@ -147,7 +148,7 @@ def __mod__(self, rhs):\n             if self._delegate_str:\n                 return str(self) % rhs\n             elif self._delegate_unicode:\n-                return unicode(self) % rhs\n+                return six.text_type(self) % rhs\n             else:\n                 raise AssertionError('__mod__ not supported for non-string types')\n \n@@ -255,8 +256,8 @@ def __init__(self, func):\n     def _setup(self):\n         self._wrapped = self._setupfunc()\n \n-    __str__ = new_method_proxy(str)\n-    __unicode__ = new_method_proxy(unicode)\n+    __str__ = new_method_proxy(bytes)\n+    __unicode__ = new_method_proxy(six.text_type)\n \n     def __deepcopy__(self, memo):\n         if self._wrapped is empty:"
        },
        {
            "sha": "ca3340ccb171ee67e24451695e7aea9cc3cfae11",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 56,
            "deletions": 21,
            "changes": 77,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,16 +4,20 @@\n \n import re\n import string\n-import urllib\n-import urlparse\n+try:\n+    from urllib.parse import quote, urlsplit, urlunsplit\n+except ImportError:     # Python 2\n+    from urllib import quote\n+    from urlparse import urlsplit, urlunsplit\n \n from django.utils.safestring import SafeData, mark_safe\n from django.utils.encoding import smart_str, force_unicode\n from django.utils.functional import allow_lazy\n+from django.utils import six\n from django.utils.text import normalize_newlines\n \n # Configuration for urlize() function.\n-TRAILING_PUNCTUATION = ['.', ',', ':', ';']\n+TRAILING_PUNCTUATION = ['.', ',', ':', ';', '.)']\n WRAPPING_PUNCTUATION = [('(', ')'), ('<', '>'), ('&lt;', '&gt;')]\n \n # List of possible strings used for bullets in bulleted lists.\n@@ -31,12 +35,12 @@\n trailing_empty_content_re = re.compile(r'(?:<p>(?:&nbsp;|\\s|<br \\/>)*?</p>\\s*)+\\Z')\n del x # Temporary variable\n \n-def escape(html):\n+def escape(text):\n     \"\"\"\n-    Returns the given HTML with ampersands, quotes and angle brackets encoded.\n+    Returns the given text with ampersands, quotes and angle brackets encoded for use in HTML.\n     \"\"\"\n-    return mark_safe(force_unicode(html).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('\"', '&quot;').replace(\"'\", '&#39;'))\n-escape = allow_lazy(escape, unicode)\n+    return mark_safe(force_unicode(text).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('\"', '&quot;').replace(\"'\", '&#39;'))\n+escape = allow_lazy(escape, six.text_type)\n \n _base_js_escapes = (\n     ('\\\\', '\\\\u005C'),\n@@ -61,16 +65,47 @@ def escapejs(value):\n     for bad, good in _js_escapes:\n         value = mark_safe(force_unicode(value).replace(bad, good))\n     return value\n-escapejs = allow_lazy(escapejs, unicode)\n+escapejs = allow_lazy(escapejs, six.text_type)\n \n-def conditional_escape(html):\n+def conditional_escape(text):\n     \"\"\"\n     Similar to escape(), except that it doesn't operate on pre-escaped strings.\n     \"\"\"\n-    if isinstance(html, SafeData):\n-        return html\n+    if isinstance(text, SafeData):\n+        return text\n     else:\n-        return escape(html)\n+        return escape(text)\n+\n+def format_html(format_string, *args, **kwargs):\n+    \"\"\"\n+    Similar to str.format, but passes all arguments through conditional_escape,\n+    and calls 'mark_safe' on the result. This function should be used instead\n+    of str.format or % interpolation to build up small HTML fragments.\n+    \"\"\"\n+    args_safe = map(conditional_escape, args)\n+    kwargs_safe = dict([(k, conditional_escape(v)) for (k, v) in\n+                        kwargs.iteritems()])\n+    return mark_safe(format_string.format(*args_safe, **kwargs_safe))\n+\n+def format_html_join(sep, format_string, args_generator):\n+    \"\"\"\n+    A wrapper format_html, for the common case of a group of arguments that need\n+    to be formatted using the same format string, and then joined using\n+    'sep'. 'sep' is also passed through conditional_escape.\n+\n+    'args_generator' should be an iterator that returns the sequence of 'args'\n+    that will be passed to format_html.\n+\n+    Example:\n+\n+      format_html_join('\\n', \"<li>{0} {1}</li>\", ((u.first_name, u.last_name)\n+                                                  for u in users))\n+\n+    \"\"\"\n+    return mark_safe(conditional_escape(sep).join(\n+            format_html(format_string, *tuple(args))\n+            for args in args_generator))\n+\n \n def linebreaks(value, autoescape=False):\n     \"\"\"Converts newlines into <p> and <br />s.\"\"\"\n@@ -81,7 +116,7 @@ def linebreaks(value, autoescape=False):\n     else:\n         paras = ['<p>%s</p>' % p.replace('\\n', '<br />') for p in paras]\n     return '\\n\\n'.join(paras)\n-linebreaks = allow_lazy(linebreaks, unicode)\n+linebreaks = allow_lazy(linebreaks, six.text_type)\n \n def strip_tags(value):\n     \"\"\"Returns the given HTML with all tags stripped.\"\"\"\n@@ -91,34 +126,34 @@ def strip_tags(value):\n def strip_spaces_between_tags(value):\n     \"\"\"Returns the given HTML with spaces between tags removed.\"\"\"\n     return re.sub(r'>\\s+<', '><', force_unicode(value))\n-strip_spaces_between_tags = allow_lazy(strip_spaces_between_tags, unicode)\n+strip_spaces_between_tags = allow_lazy(strip_spaces_between_tags, six.text_type)\n \n def strip_entities(value):\n     \"\"\"Returns the given HTML with all entities (&something;) stripped.\"\"\"\n     return re.sub(r'&(?:\\w+|#\\d+);', '', force_unicode(value))\n-strip_entities = allow_lazy(strip_entities, unicode)\n+strip_entities = allow_lazy(strip_entities, six.text_type)\n \n def fix_ampersands(value):\n     \"\"\"Returns the given HTML with all unencoded ampersands encoded correctly.\"\"\"\n     return unencoded_ampersands_re.sub('&amp;', force_unicode(value))\n-fix_ampersands = allow_lazy(fix_ampersands, unicode)\n+fix_ampersands = allow_lazy(fix_ampersands, six.text_type)\n \n def smart_urlquote(url):\n     \"Quotes a URL if it isn't already quoted.\"\n     # Handle IDN before quoting.\n-    scheme, netloc, path, query, fragment = urlparse.urlsplit(url)\n+    scheme, netloc, path, query, fragment = urlsplit(url)\n     try:\n         netloc = netloc.encode('idna') # IDN -> ACE\n     except UnicodeError: # invalid domain part\n         pass\n     else:\n-        url = urlparse.urlunsplit((scheme, netloc, path, query, fragment))\n+        url = urlunsplit((scheme, netloc, path, query, fragment))\n \n     # An URL is considered unquoted if it contains no % characters or\n     # contains a % not followed by two hexadecimal digits. See #9655.\n     if '%' not in url or unquoted_percents_re.search(url):\n         # See http://bugs.python.org/issue2637\n-        url = urllib.quote(smart_str(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n+        url = quote(smart_str(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n \n     return force_unicode(url)\n \n@@ -195,7 +230,7 @@ def urlize(text, trim_url_limit=None, nofollow=False, autoescape=False):\n         elif autoescape:\n             words[i] = escape(word)\n     return ''.join(words)\n-urlize = allow_lazy(urlize, unicode)\n+urlize = allow_lazy(urlize, six.text_type)\n \n def clean_html(text):\n     \"\"\"\n@@ -229,4 +264,4 @@ def replace_p_tags(match):\n     # of the text.\n     text = trailing_empty_content_re.sub('', text)\n     return text\n-clean_html = allow_lazy(clean_html, unicode)\n+clean_html = allow_lazy(clean_html, six.text_type)"
        },
        {
            "sha": "ee56c01aec66fef59d714c8835de714f5eb1dc34",
            "filename": "django/utils/html_parser.py",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fhtml_parser.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fhtml_parser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml_parser.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,25 +1,28 @@\n-import HTMLParser as _HTMLParser\n+from django.utils.six.moves import html_parser as _html_parser\n import re\n \n+tagfind = re.compile('([a-zA-Z][-.a-zA-Z0-9:_]*)(?:\\s|/(?!>))*')\n \n-class HTMLParser(_HTMLParser.HTMLParser):\n+HTMLParseError = _html_parser.HTMLParseError\n+\n+class HTMLParser(_html_parser.HTMLParser):\n     \"\"\"\n     Patched version of stdlib's HTMLParser with patch from:\n     http://bugs.python.org/issue670664\n     \"\"\"\n     def __init__(self):\n-        _HTMLParser.HTMLParser.__init__(self)\n+        _html_parser.HTMLParser.__init__(self)\n         self.cdata_tag = None\n \n     def set_cdata_mode(self, tag):\n         try:\n-            self.interesting = _HTMLParser.interesting_cdata\n+            self.interesting = _html_parser.interesting_cdata\n         except AttributeError:\n             self.interesting = re.compile(r'</\\s*%s\\s*>' % tag.lower(), re.I)\n         self.cdata_tag = tag.lower()\n \n     def clear_cdata_mode(self):\n-        self.interesting = _HTMLParser.interesting_normal\n+        self.interesting = _html_parser.interesting_normal\n         self.cdata_tag = None\n \n     # Internal -- handle starttag, return end or -1 if not terminated\n@@ -33,13 +36,13 @@ def parse_starttag(self, i):\n \n         # Now parse the data between i+1 and j into a tag and attrs\n         attrs = []\n-        match = _HTMLParser.tagfind.match(rawdata, i + 1)\n+        match = tagfind.match(rawdata, i + 1)\n         assert match, 'unexpected call to parse_starttag()'\n         k = match.end()\n-        self.lasttag = tag = rawdata[i + 1:k].lower()\n+        self.lasttag = tag = match.group(1).lower()\n \n         while k < endpos:\n-            m = _HTMLParser.attrfind.match(rawdata, k)\n+            m = _html_parser.attrfind.match(rawdata, k)\n             if not m:\n                 break\n             attrname, rest, attrvalue = m.group(1, 2, 3)\n@@ -48,6 +51,7 @@ def parse_starttag(self, i):\n             elif attrvalue[:1] == '\\'' == attrvalue[-1:] or \\\n                  attrvalue[:1] == '\"' == attrvalue[-1:]:\n                 attrvalue = attrvalue[1:-1]\n+            if attrvalue:\n                 attrvalue = self.unescape(attrvalue)\n             attrs.append((attrname.lower(), attrvalue))\n             k = m.end()\n@@ -76,11 +80,11 @@ def parse_starttag(self, i):\n     def parse_endtag(self, i):\n         rawdata = self.rawdata\n         assert rawdata[i:i + 2] == \"</\", \"unexpected call to parse_endtag\"\n-        match = _HTMLParser.endendtag.search(rawdata, i + 1) # >\n+        match = _html_parser.endendtag.search(rawdata, i + 1) # >\n         if not match:\n             return -1\n         j = match.end()\n-        match = _HTMLParser.endtagfind.match(rawdata, i) # </ + tag + >\n+        match = _html_parser.endtagfind.match(rawdata, i) # </ + tag + >\n         if not match:\n             if self.cdata_tag is not None: # *** add ***\n                 self.handle_data(rawdata[i:j]) # *** add ***"
        },
        {
            "sha": "f3a3dce58ca585e21da41366423d1f1f2f330902",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 19,
            "deletions": 12,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,13 +2,20 @@\n import datetime\n import re\n import sys\n-import urllib\n-import urlparse\n+try:\n+    from urllib import parse as urllib_parse\n+except ImportError:     # Python 2\n+    import urllib as urllib_parse\n+    import urlparse\n+    urllib_parse.urlparse = urlparse.urlparse\n+\n+\n from email.utils import formatdate\n \n from django.utils.datastructures import MultiValueDict\n from django.utils.encoding import smart_str, force_unicode\n from django.utils.functional import allow_lazy\n+from django.utils import six\n \n ETAG_MATCH = re.compile(r'(?:W/)?\"((?:\\\\.|[^\"])*)\"')\n \n@@ -30,8 +37,8 @@ def urlquote(url, safe='/'):\n     can safely be used as part of an argument to a subsequent iri_to_uri() call\n     without double-quoting occurring.\n     \"\"\"\n-    return force_unicode(urllib.quote(smart_str(url), smart_str(safe)))\n-urlquote = allow_lazy(urlquote, unicode)\n+    return force_unicode(urllib_parse.quote(smart_str(url), smart_str(safe)))\n+urlquote = allow_lazy(urlquote, six.text_type)\n \n def urlquote_plus(url, safe=''):\n     \"\"\"\n@@ -40,24 +47,24 @@ def urlquote_plus(url, safe=''):\n     returned string can safely be used as part of an argument to a subsequent\n     iri_to_uri() call without double-quoting occurring.\n     \"\"\"\n-    return force_unicode(urllib.quote_plus(smart_str(url), smart_str(safe)))\n-urlquote_plus = allow_lazy(urlquote_plus, unicode)\n+    return force_unicode(urllib_parse.quote_plus(smart_str(url), smart_str(safe)))\n+urlquote_plus = allow_lazy(urlquote_plus, six.text_type)\n \n def urlunquote(quoted_url):\n     \"\"\"\n     A wrapper for Python's urllib.unquote() function that can operate on\n     the result of django.utils.http.urlquote().\n     \"\"\"\n-    return force_unicode(urllib.unquote(smart_str(quoted_url)))\n-urlunquote = allow_lazy(urlunquote, unicode)\n+    return force_unicode(urllib_parse.unquote(smart_str(quoted_url)))\n+urlunquote = allow_lazy(urlunquote, six.text_type)\n \n def urlunquote_plus(quoted_url):\n     \"\"\"\n     A wrapper for Python's urllib.unquote_plus() function that can operate on\n     the result of django.utils.http.urlquote_plus().\n     \"\"\"\n-    return force_unicode(urllib.unquote_plus(smart_str(quoted_url)))\n-urlunquote_plus = allow_lazy(urlunquote_plus, unicode)\n+    return force_unicode(urllib_parse.unquote_plus(smart_str(quoted_url)))\n+urlunquote_plus = allow_lazy(urlunquote_plus, six.text_type)\n \n def urlencode(query, doseq=0):\n     \"\"\"\n@@ -69,7 +76,7 @@ def urlencode(query, doseq=0):\n         query = query.lists()\n     elif hasattr(query, 'items'):\n         query = query.items()\n-    return urllib.urlencode(\n+    return urllib_parse.urlencode(\n         [(smart_str(k),\n          [smart_str(i) for i in v] if isinstance(v, (list,tuple)) else smart_str(v))\n             for k, v in query],\n@@ -211,5 +218,5 @@ def same_origin(url1, url2):\n     \"\"\"\n     Checks if two URLs are 'same-origin'\n     \"\"\"\n-    p1, p2 = urlparse.urlparse(url1), urlparse.urlparse(url2)\n+    p1, p2 = urllib_parse.urlparse(url1), urllib_parse.urlparse(url2)\n     return (p1.scheme, p1.hostname, p1.port) == (p2.scheme, p2.hostname, p2.port)"
        },
        {
            "sha": "703ba7f6d8060499a0927d25eaf8a674017761a9",
            "filename": "django/utils/importlib.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fimportlib.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fimportlib.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fimportlib.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,7 +6,7 @@ def _resolve_name(name, package, level):\n     if not hasattr(package, 'rindex'):\n         raise ValueError(\"'package' not set to a string\")\n     dot = len(package)\n-    for x in xrange(level, 1, -1):\n+    for x in range(level, 1, -1):\n         try:\n             dot = package.rindex('.', 0, dot)\n         except ValueError:"
        },
        {
            "sha": "2ccae8cdd07613a4297a768ae808ac8458f0e2dd",
            "filename": "django/utils/ipv6.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fipv6.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fipv6.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fipv6.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n # Copyright 2007 Google Inc. http://code.google.com/p/ipaddr-py/\n # Licensed under the Apache License, Version 2.0 (the \"License\").\n from django.core.exceptions import ValidationError\n+from django.utils.six.moves import xrange\n \n def clean_ipv6_address(ip_str, unpack_ipv4=False,\n         error_message=\"This is not a valid IPv6 address\"):"
        },
        {
            "sha": "aa329c152eb6f1c32ff9569ca73556abc082602a",
            "filename": "django/utils/itercompat.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fitercompat.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fitercompat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fitercompat.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,7 +4,7 @@\n these implementations if necessary.\n \"\"\"\n \n-import __builtin__\n+from django.utils.six.moves import builtins\n import itertools\n import warnings\n \n@@ -25,9 +25,9 @@ def product(*args, **kwds):\n def all(iterable):\n     warnings.warn(\"django.utils.itercompat.all is deprecated; use the native version instead\",\n                   DeprecationWarning)\n-    return __builtin__.all(iterable)\n+    return builtins.all(iterable)\n \n def any(iterable):\n     warnings.warn(\"django.utils.itercompat.any is deprecated; use the native version instead\",\n                   DeprecationWarning)\n-    return __builtin__.any(iterable)\n+    return builtins.any(iterable)"
        },
        {
            "sha": "d51b2308230e0c0c3fac6cf165dc30194c338e5b",
            "filename": "django/utils/numberformat.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fnumberformat.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fnumberformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fnumberformat.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,5 +1,6 @@\n from django.conf import settings\n from django.utils.safestring import mark_safe\n+from django.utils import six\n \n \n def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',\n@@ -18,13 +19,13 @@ def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',\n     use_grouping = use_grouping and grouping > 0\n     # Make the common case fast\n     if isinstance(number, int) and not use_grouping and not decimal_pos:\n-        return mark_safe(unicode(number))\n+        return mark_safe(six.text_type(number))\n     # sign\n     if float(number) < 0:\n         sign = '-'\n     else:\n         sign = ''\n-    str_number = unicode(number)\n+    str_number = six.text_type(number)\n     if str_number[0] == '-':\n         str_number = str_number[1:]\n     # decimal part"
        },
        {
            "sha": "8a5c37e97662fed5545db0d6d108da90a944b84c",
            "filename": "django/utils/py3.py",
            "status": "removed",
            "additions": 0,
            "deletions": 109,
            "changes": 109,
            "blob_url": "https://github.com/django/django/blob/959a3f9791d780062c4efe8765404a8ef95e87f0/django%2Futils%2Fpy3.py",
            "raw_url": "https://github.com/django/django/raw/959a3f9791d780062c4efe8765404a8ef95e87f0/django%2Futils%2Fpy3.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fpy3.py?ref=959a3f9791d780062c4efe8765404a8ef95e87f0",
            "patch": "@@ -1,109 +0,0 @@\n-# Compatibility layer for running Django both in 2.x and 3.x\n-\n-import sys\n-\n-if sys.version_info[0] < 3:\n-    PY3 = False\n-    # Changed module locations\n-    from urlparse import (urlparse, urlunparse, urljoin, urlsplit, urlunsplit,\n-                          urldefrag, parse_qsl)\n-    from urllib import (quote, unquote, quote_plus, urlopen, urlencode,\n-                        url2pathname, urlretrieve, unquote_plus)\n-    from urllib2 import (Request, OpenerDirector, UnknownHandler, HTTPHandler,\n-                         HTTPSHandler, HTTPDefaultErrorHandler, FTPHandler,\n-                         HTTPError, HTTPErrorProcessor)\n-    import urllib2\n-    import Cookie as cookies\n-    try:\n-        import cPickle as pickle\n-    except ImportError:\n-        import pickle\n-    try:\n-        import thread\n-    except ImportError:\n-        import dummy_thread as thread\n-    from htmlentitydefs import name2codepoint\n-    import HTMLParser\n-    from os import getcwdu\n-    from itertools import izip as zip\n-    unichr = unichr\n-    xrange = xrange\n-    maxsize = sys.maxint\n-\n-    # Type aliases\n-    string_types = basestring,\n-    text_type = unicode\n-    integer_types = int, long\n-    long_type = long\n-\n-    from io import BytesIO as OutputIO\n-\n-    # Glue code for syntax differences\n-    def reraise(tp, value, tb=None):\n-        exec(\"raise tp, value, tb\")\n-\n-    def with_metaclass(meta, base=object):\n-        class _DjangoBase(base):\n-            __metaclass__ = meta\n-        return _DjangoBase\n-\n-    iteritems = lambda o: o.iteritems()\n-    itervalues = lambda o: o.itervalues()\n-    iterkeys = lambda o: o.iterkeys()\n-\n-    # n() is useful when python3 needs a str (unicode), and python2 str (bytes)\n-    n = lambda s: s.encode('utf-8')\n-\n-else:\n-    PY3 = True\n-    import builtins\n-\n-    # Changed module locations\n-    from urllib.parse import (urlparse, urlunparse, urlencode, urljoin,\n-                              urlsplit, urlunsplit, quote, unquote,\n-                              quote_plus, unquote_plus, parse_qsl,\n-                              urldefrag)\n-    from urllib.request import (urlopen, url2pathname, Request, OpenerDirector,\n-                                UnknownHandler, HTTPHandler, HTTPSHandler,\n-                                HTTPDefaultErrorHandler, FTPHandler,\n-                                HTTPError, HTTPErrorProcessor, urlretrieve)\n-    import urllib.request as urllib2\n-    import http.cookies as cookies\n-    import pickle\n-    try:\n-        import _thread as thread\n-    except ImportError:\n-        import _dummy_thread as thread\n-    from html.entities import name2codepoint\n-    import html.parser as HTMLParser\n-    from os import getcwd as getcwdu\n-    zip = zip\n-    unichr = chr\n-    xrange = range\n-    maxsize = sys.maxsize\n-\n-    # Type aliases\n-    string_types = str,\n-    text_type = str\n-    integer_types = int,\n-    long_type = int\n-\n-    from io import StringIO as OutputIO\n-\n-    # Glue code for syntax differences\n-    def reraise(tp, value, tb=None):\n-        if value.__traceback__ is not tb:\n-            raise value.with_traceback(tb)\n-        raise value\n-\n-    def with_metaclass(meta, base=object):\n-        ns = dict(base=base, meta=meta)\n-        exec(\"\"\"class _DjangoBase(base, metaclass=meta):\n-    pass\"\"\", ns)\n-        return ns[\"_DjangoBase\"]\n-\n-    iteritems = lambda o: o.items()\n-    itervalues = lambda o: o.values()\n-    iterkeys = lambda o: o.keys()\n-\n-    n = lambda s: s"
        },
        {
            "sha": "8953a21e955ff76eb1db6868f8228f4b37c9f130",
            "filename": "django/utils/regex_helper.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fregex_helper.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fregex_helper.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fregex_helper.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -7,6 +7,8 @@\n \"\"\"\n from __future__ import unicode_literals\n \n+from django.utils import six\n+\n # Mapping of an escape character to a representative of that class. So, e.g.,\n # \"\\w\" is replaced by \"x\" in a reverse URL. A value of None means to ignore\n # this sequence. Any missing key is mapped to itself.\n@@ -302,7 +304,7 @@ def flatten_result(source):\n     result_args = [[]]\n     pos = last = 0\n     for pos, elt in enumerate(source):\n-        if isinstance(elt, basestring):\n+        if isinstance(elt, six.string_types):\n             continue\n         piece = ''.join(source[last:pos])\n         if isinstance(elt, Group):"
        },
        {
            "sha": "1599fc2a6624f02da1e09404301526e691203fc9",
            "filename": "django/utils/safestring.py",
            "status": "modified",
            "additions": 17,
            "deletions": 16,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fsafestring.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fsafestring.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsafestring.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,17 +5,18 @@\n be interpreted by the HTML engine (e.g. '<') into the appropriate entities.\n \"\"\"\n from django.utils.functional import curry, Promise\n+from django.utils import six\n \n class EscapeData(object):\n     pass\n \n-class EscapeString(str, EscapeData):\n+class EscapeString(bytes, EscapeData):\n     \"\"\"\n     A string that should be HTML-escaped when output.\n     \"\"\"\n     pass\n \n-class EscapeUnicode(unicode, EscapeData):\n+class EscapeUnicode(six.text_type, EscapeData):\n     \"\"\"\n     A unicode object that should be HTML-escaped when output.\n     \"\"\"\n@@ -24,7 +25,7 @@ class EscapeUnicode(unicode, EscapeData):\n class SafeData(object):\n     pass\n \n-class SafeString(str, SafeData):\n+class SafeString(bytes, SafeData):\n     \"\"\"\n     A string subclass that has been specifically marked as \"safe\" (requires no\n     further escaping) for HTML output purposes.\n@@ -40,7 +41,7 @@ def __add__(self, rhs):\n         elif isinstance(rhs, SafeString):\n             return SafeString(t)\n         return t\n-        \n+\n     def _proxy_method(self, *args, **kwargs):\n         \"\"\"\n         Wrap a call to a normal unicode method up so that we return safe\n@@ -49,14 +50,14 @@ def _proxy_method(self, *args, **kwargs):\n         \"\"\"\n         method = kwargs.pop('method')\n         data = method(self, *args, **kwargs)\n-        if isinstance(data, str):\n+        if isinstance(data, bytes):\n             return SafeString(data)\n         else:\n             return SafeUnicode(data)\n \n-    decode = curry(_proxy_method, method = str.decode)\n+    decode = curry(_proxy_method, method=bytes.decode)\n \n-class SafeUnicode(unicode, SafeData):\n+class SafeUnicode(six.text_type, SafeData):\n     \"\"\"\n     A unicode subclass that has been specifically marked as \"safe\" for HTML\n     output purposes.\n@@ -70,7 +71,7 @@ def __add__(self, rhs):\n         if isinstance(rhs, SafeData):\n             return SafeUnicode(t)\n         return t\n-    \n+\n     def _proxy_method(self, *args, **kwargs):\n         \"\"\"\n         Wrap a call to a normal unicode method up so that we return safe\n@@ -79,12 +80,12 @@ def _proxy_method(self, *args, **kwargs):\n         \"\"\"\n         method = kwargs.pop('method')\n         data = method(self, *args, **kwargs)\n-        if isinstance(data, str):\n+        if isinstance(data, bytes):\n             return SafeString(data)\n         else:\n             return SafeUnicode(data)\n \n-    encode = curry(_proxy_method, method = unicode.encode)\n+    encode = curry(_proxy_method, method=six.text_type.encode)\n \n def mark_safe(s):\n     \"\"\"\n@@ -95,11 +96,11 @@ def mark_safe(s):\n     \"\"\"\n     if isinstance(s, SafeData):\n         return s\n-    if isinstance(s, str) or (isinstance(s, Promise) and s._delegate_str):\n+    if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_str):\n         return SafeString(s)\n-    if isinstance(s, (unicode, Promise)):\n+    if isinstance(s, (six.text_type, Promise)):\n         return SafeUnicode(s)\n-    return SafeString(str(s))\n+    return SafeString(bytes(s))\n \n def mark_for_escaping(s):\n     \"\"\"\n@@ -111,9 +112,9 @@ def mark_for_escaping(s):\n     \"\"\"\n     if isinstance(s, (SafeData, EscapeData)):\n         return s\n-    if isinstance(s, str) or (isinstance(s, Promise) and s._delegate_str):\n+    if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_str):\n         return EscapeString(s)\n-    if isinstance(s, (unicode, Promise)):\n+    if isinstance(s, (six.text_type, Promise)):\n         return EscapeUnicode(s)\n-    return EscapeString(str(s))\n+    return EscapeString(bytes(s))\n "
        },
        {
            "sha": "e226bba09e4acdece089514f71b0ee40a3325a0b",
            "filename": "django/utils/six.py",
            "status": "added",
            "additions": 367,
            "deletions": 0,
            "changes": 367,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fsix.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Fsix.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsix.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -0,0 +1,367 @@\n+\"\"\"Utilities for writing code that runs on Python 2 and 3\"\"\"\n+\n+import operator\n+import sys\n+import types\n+\n+__author__ = \"Benjamin Peterson <benjamin@python.org>\"\n+__version__ = \"1.1.0\"\n+\n+\n+# True if we are running on Python 3.\n+PY3 = sys.version_info[0] == 3\n+\n+if PY3:\n+    string_types = str,\n+    integer_types = int,\n+    class_types = type,\n+    text_type = str\n+    binary_type = bytes\n+\n+    MAXSIZE = sys.maxsize\n+else:\n+    string_types = basestring,\n+    integer_types = (int, long)\n+    class_types = (type, types.ClassType)\n+    text_type = unicode\n+    binary_type = str\n+\n+    # It's possible to have sizeof(long) != sizeof(Py_ssize_t).\n+    class X(object):\n+        def __len__(self):\n+            return 1 << 31\n+    try:\n+        len(X())\n+    except OverflowError:\n+        # 32-bit\n+        MAXSIZE = int((1 << 31) - 1)\n+    else:\n+        # 64-bit\n+        MAXSIZE = int((1 << 63) - 1)\n+    del X\n+\n+\n+def _add_doc(func, doc):\n+    \"\"\"Add documentation to a function.\"\"\"\n+    func.__doc__ = doc\n+\n+\n+def _import_module(name):\n+    \"\"\"Import module, returning the module after the last dot.\"\"\"\n+    __import__(name)\n+    return sys.modules[name]\n+\n+\n+class _LazyDescr(object):\n+\n+    def __init__(self, name):\n+        self.name = name\n+\n+    def __get__(self, obj, tp):\n+        result = self._resolve()\n+        setattr(obj, self.name, result)\n+        # This is a bit ugly, but it avoids running this again.\n+        delattr(tp, self.name)\n+        return result\n+\n+\n+class MovedModule(_LazyDescr):\n+\n+    def __init__(self, name, old, new=None):\n+        super(MovedModule, self).__init__(name)\n+        if PY3:\n+            if new is None:\n+                new = name\n+            self.mod = new\n+        else:\n+            self.mod = old\n+\n+    def _resolve(self):\n+        return _import_module(self.mod)\n+\n+\n+class MovedAttribute(_LazyDescr):\n+\n+    def __init__(self, name, old_mod, new_mod, old_attr=None, new_attr=None):\n+        super(MovedAttribute, self).__init__(name)\n+        if PY3:\n+            if new_mod is None:\n+                new_mod = name\n+            self.mod = new_mod\n+            if new_attr is None:\n+                if old_attr is None:\n+                    new_attr = name\n+                else:\n+                    new_attr = old_attr\n+            self.attr = new_attr\n+        else:\n+            self.mod = old_mod\n+            if old_attr is None:\n+                old_attr = name\n+            self.attr = old_attr\n+\n+    def _resolve(self):\n+        module = _import_module(self.mod)\n+        return getattr(module, self.attr)\n+\n+\n+\n+class _MovedItems(types.ModuleType):\n+    \"\"\"Lazy loading of moved objects\"\"\"\n+\n+\n+_moved_attributes = [\n+    MovedAttribute(\"cStringIO\", \"cStringIO\", \"io\", \"StringIO\"),\n+    MovedAttribute(\"filter\", \"itertools\", \"builtins\", \"ifilter\", \"filter\"),\n+    MovedAttribute(\"map\", \"itertools\", \"builtins\", \"imap\", \"map\"),\n+    MovedAttribute(\"reload_module\", \"__builtin__\", \"imp\", \"reload\"),\n+    MovedAttribute(\"reduce\", \"__builtin__\", \"functools\"),\n+    MovedAttribute(\"StringIO\", \"StringIO\", \"io\"),\n+    MovedAttribute(\"xrange\", \"__builtin__\", \"builtins\", \"xrange\", \"range\"),\n+    MovedAttribute(\"zip\", \"itertools\", \"builtins\", \"izip\", \"zip\"),\n+\n+    MovedModule(\"builtins\", \"__builtin__\"),\n+    MovedModule(\"configparser\", \"ConfigParser\"),\n+    MovedModule(\"copyreg\", \"copy_reg\"),\n+    MovedModule(\"http_cookiejar\", \"cookielib\", \"http.cookiejar\"),\n+    MovedModule(\"http_cookies\", \"Cookie\", \"http.cookies\"),\n+    MovedModule(\"html_entities\", \"htmlentitydefs\", \"html.entities\"),\n+    MovedModule(\"html_parser\", \"HTMLParser\", \"html.parser\"),\n+    MovedModule(\"http_client\", \"httplib\", \"http.client\"),\n+    MovedModule(\"BaseHTTPServer\", \"BaseHTTPServer\", \"http.server\"),\n+    MovedModule(\"CGIHTTPServer\", \"CGIHTTPServer\", \"http.server\"),\n+    MovedModule(\"SimpleHTTPServer\", \"SimpleHTTPServer\", \"http.server\"),\n+    MovedModule(\"cPickle\", \"cPickle\", \"pickle\"),\n+    MovedModule(\"queue\", \"Queue\"),\n+    MovedModule(\"reprlib\", \"repr\"),\n+    MovedModule(\"socketserver\", \"SocketServer\"),\n+    MovedModule(\"tkinter\", \"Tkinter\"),\n+    MovedModule(\"tkinter_dialog\", \"Dialog\", \"tkinter.dialog\"),\n+    MovedModule(\"tkinter_filedialog\", \"FileDialog\", \"tkinter.filedialog\"),\n+    MovedModule(\"tkinter_scrolledtext\", \"ScrolledText\", \"tkinter.scrolledtext\"),\n+    MovedModule(\"tkinter_simpledialog\", \"SimpleDialog\", \"tkinter.simpledialog\"),\n+    MovedModule(\"tkinter_tix\", \"Tix\", \"tkinter.tix\"),\n+    MovedModule(\"tkinter_constants\", \"Tkconstants\", \"tkinter.constants\"),\n+    MovedModule(\"tkinter_dnd\", \"Tkdnd\", \"tkinter.dnd\"),\n+    MovedModule(\"tkinter_colorchooser\", \"tkColorChooser\",\n+                \"tkinter.colorchooser\"),\n+    MovedModule(\"tkinter_commondialog\", \"tkCommonDialog\",\n+                \"tkinter.commondialog\"),\n+    MovedModule(\"tkinter_tkfiledialog\", \"tkFileDialog\", \"tkinter.filedialog\"),\n+    MovedModule(\"tkinter_font\", \"tkFont\", \"tkinter.font\"),\n+    MovedModule(\"tkinter_messagebox\", \"tkMessageBox\", \"tkinter.messagebox\"),\n+    MovedModule(\"tkinter_tksimpledialog\", \"tkSimpleDialog\",\n+                \"tkinter.simpledialog\"),\n+    MovedModule(\"urllib_robotparser\", \"robotparser\", \"urllib.robotparser\"),\n+    MovedModule(\"winreg\", \"_winreg\"),\n+]\n+for attr in _moved_attributes:\n+    setattr(_MovedItems, attr.name, attr)\n+del attr\n+\n+moves = sys.modules[\"django.utils.six.moves\"] = _MovedItems(\"moves\")\n+\n+\n+def add_move(move):\n+    \"\"\"Add an item to six.moves.\"\"\"\n+    setattr(_MovedItems, move.name, move)\n+\n+\n+def remove_move(name):\n+    \"\"\"Remove item from six.moves.\"\"\"\n+    try:\n+        delattr(_MovedItems, name)\n+    except AttributeError:\n+        try:\n+            del moves.__dict__[name]\n+        except KeyError:\n+            raise AttributeError(\"no such move, %r\" % (name,))\n+\n+\n+if PY3:\n+    _meth_func = \"__func__\"\n+    _meth_self = \"__self__\"\n+\n+    _func_code = \"__code__\"\n+    _func_defaults = \"__defaults__\"\n+\n+    _iterkeys = \"keys\"\n+    _itervalues = \"values\"\n+    _iteritems = \"items\"\n+else:\n+    _meth_func = \"im_func\"\n+    _meth_self = \"im_self\"\n+\n+    _func_code = \"func_code\"\n+    _func_defaults = \"func_defaults\"\n+\n+    _iterkeys = \"iterkeys\"\n+    _itervalues = \"itervalues\"\n+    _iteritems = \"iteritems\"\n+\n+\n+if PY3:\n+    def get_unbound_function(unbound):\n+        return unbound\n+\n+\n+    advance_iterator = next\n+\n+    def callable(obj):\n+        return any(\"__call__\" in klass.__dict__ for klass in type(obj).__mro__)\n+else:\n+    def get_unbound_function(unbound):\n+        return unbound.im_func\n+\n+\n+    def advance_iterator(it):\n+        return it.next()\n+\n+    callable = callable\n+_add_doc(get_unbound_function,\n+         \"\"\"Get the function out of a possibly unbound function\"\"\")\n+\n+\n+get_method_function = operator.attrgetter(_meth_func)\n+get_method_self = operator.attrgetter(_meth_self)\n+get_function_code = operator.attrgetter(_func_code)\n+get_function_defaults = operator.attrgetter(_func_defaults)\n+\n+\n+def iterkeys(d):\n+    \"\"\"Return an iterator over the keys of a dictionary.\"\"\"\n+    return getattr(d, _iterkeys)()\n+\n+def itervalues(d):\n+    \"\"\"Return an iterator over the values of a dictionary.\"\"\"\n+    return getattr(d, _itervalues)()\n+\n+def iteritems(d):\n+    \"\"\"Return an iterator over the (key, value) pairs of a dictionary.\"\"\"\n+    return getattr(d, _iteritems)()\n+\n+\n+if PY3:\n+    def b(s):\n+        return s.encode(\"latin-1\")\n+    def u(s):\n+        return s\n+    if sys.version_info[1] <= 1:\n+        def int2byte(i):\n+            return bytes((i,))\n+    else:\n+        # This is about 2x faster than the implementation above on 3.2+\n+        int2byte = operator.methodcaller(\"to_bytes\", 1, \"big\")\n+    import io\n+    StringIO = io.StringIO\n+    BytesIO = io.BytesIO\n+else:\n+    def b(s):\n+        return s\n+    def u(s):\n+        return unicode(s, \"unicode_escape\")\n+    int2byte = chr\n+    import StringIO\n+    StringIO = BytesIO = StringIO.StringIO\n+_add_doc(b, \"\"\"Byte literal\"\"\")\n+_add_doc(u, \"\"\"Text literal\"\"\")\n+\n+\n+if PY3:\n+    import builtins\n+    exec_ = getattr(builtins, \"exec\")\n+\n+\n+    def reraise(tp, value, tb=None):\n+        if value.__traceback__ is not tb:\n+            raise value.with_traceback(tb)\n+        raise value\n+\n+\n+    print_ = getattr(builtins, \"print\")\n+    del builtins\n+\n+else:\n+    def exec_(code, globs=None, locs=None):\n+        \"\"\"Execute code in a namespace.\"\"\"\n+        if globs is None:\n+            frame = sys._getframe(1)\n+            globs = frame.f_globals\n+            if locs is None:\n+                locs = frame.f_locals\n+            del frame\n+        elif locs is None:\n+            locs = globs\n+        exec(\"\"\"exec code in globs, locs\"\"\")\n+\n+\n+    exec_(\"\"\"def reraise(tp, value, tb=None):\n+    raise tp, value, tb\n+\"\"\")\n+\n+\n+    def print_(*args, **kwargs):\n+        \"\"\"The new-style print function.\"\"\"\n+        fp = kwargs.pop(\"file\", sys.stdout)\n+        if fp is None:\n+            return\n+        def write(data):\n+            if not isinstance(data, basestring):\n+                data = str(data)\n+            fp.write(data)\n+        want_unicode = False\n+        sep = kwargs.pop(\"sep\", None)\n+        if sep is not None:\n+            if isinstance(sep, unicode):\n+                want_unicode = True\n+            elif not isinstance(sep, str):\n+                raise TypeError(\"sep must be None or a string\")\n+        end = kwargs.pop(\"end\", None)\n+        if end is not None:\n+            if isinstance(end, unicode):\n+                want_unicode = True\n+            elif not isinstance(end, str):\n+                raise TypeError(\"end must be None or a string\")\n+        if kwargs:\n+            raise TypeError(\"invalid keyword arguments to print()\")\n+        if not want_unicode:\n+            for arg in args:\n+                if isinstance(arg, unicode):\n+                    want_unicode = True\n+                    break\n+        if want_unicode:\n+            newline = unicode(\"\\n\")\n+            space = unicode(\" \")\n+        else:\n+            newline = \"\\n\"\n+            space = \" \"\n+        if sep is None:\n+            sep = space\n+        if end is None:\n+            end = newline\n+        for i, arg in enumerate(args):\n+            if i:\n+                write(sep)\n+            write(arg)\n+        write(end)\n+\n+_add_doc(reraise, \"\"\"Reraise an exception.\"\"\")\n+\n+\n+def with_metaclass(meta, base=object):\n+    \"\"\"Create a base class with a metaclass.\"\"\"\n+    return meta(\"NewBase\", (base,), {})\n+\n+\n+### Additional customizations for Django ###\n+\n+if PY3:\n+    _iterlists = \"lists\"\n+else:\n+    _iterlists = \"iterlists\"\n+\n+def iterlists(d):\n+    \"\"\"Return an iterator over the values of a MultiValueDict.\"\"\"\n+    return getattr(d, _iterlists)()\n+\n+add_move(MovedModule(\"_dummy_thread\", \"dummy_thread\"))"
        },
        {
            "sha": "43056aa63451fdde260f7a2c98067dbbd7a9ed6c",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 15,
            "deletions": 14,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -4,16 +4,17 @@\n import unicodedata\n import warnings\n from gzip import GzipFile\n-from htmlentitydefs import name2codepoint\n+from django.utils.six.moves import html_entities\n from io import BytesIO\n \n from django.utils.encoding import force_unicode\n from django.utils.functional import allow_lazy, SimpleLazyObject\n+from django.utils import six\n from django.utils.translation import ugettext_lazy, ugettext as _, pgettext\n \n # Capitalizes the first letter of a string.\n capfirst = lambda x: x and force_unicode(x)[0].upper() + force_unicode(x)[1:]\n-capfirst = allow_lazy(capfirst, unicode)\n+capfirst = allow_lazy(capfirst, six.text_type)\n \n # Set up regular expressions\n re_words = re.compile(r'&.*?;|<.*?>|(\\w[\\w-]*)', re.U|re.S)\n@@ -46,7 +47,7 @@ def _generator():\n                     pos = len(lines[-1])\n             yield word\n     return ''.join(_generator())\n-wrap = allow_lazy(wrap, unicode)\n+wrap = allow_lazy(wrap, six.text_type)\n \n \n class Truncator(SimpleLazyObject):\n@@ -207,14 +208,14 @@ def truncate_words(s, num, end_text='...'):\n         'in django.utils.text instead.', category=DeprecationWarning)\n     truncate = end_text and ' %s' % end_text or ''\n     return Truncator(s).words(num, truncate=truncate)\n-truncate_words = allow_lazy(truncate_words, unicode)\n+truncate_words = allow_lazy(truncate_words, six.text_type)\n \n def truncate_html_words(s, num, end_text='...'):\n     warnings.warn('This function has been deprecated. Use the Truncator class '\n         'in django.utils.text instead.', category=DeprecationWarning)\n     truncate = end_text and ' %s' % end_text or ''\n     return Truncator(s).words(num, truncate=truncate, html=True)\n-truncate_html_words = allow_lazy(truncate_html_words, unicode)\n+truncate_html_words = allow_lazy(truncate_html_words, six.text_type)\n \n def get_valid_filename(s):\n     \"\"\"\n@@ -227,7 +228,7 @@ def get_valid_filename(s):\n     \"\"\"\n     s = force_unicode(s).strip().replace(' ', '_')\n     return re.sub(r'(?u)[^-\\w.]', '', s)\n-get_valid_filename = allow_lazy(get_valid_filename, unicode)\n+get_valid_filename = allow_lazy(get_valid_filename, six.text_type)\n \n def get_text_list(list_, last_word=ugettext_lazy('or')):\n     \"\"\"\n@@ -248,11 +249,11 @@ def get_text_list(list_, last_word=ugettext_lazy('or')):\n         # Translators: This string is used as a separator between list elements\n         _(', ').join([force_unicode(i) for i in list_][:-1]),\n         force_unicode(last_word), force_unicode(list_[-1]))\n-get_text_list = allow_lazy(get_text_list, unicode)\n+get_text_list = allow_lazy(get_text_list, six.text_type)\n \n def normalize_newlines(text):\n     return force_unicode(re.sub(r'\\r\\n|\\r|\\n', '\\n', text))\n-normalize_newlines = allow_lazy(normalize_newlines, unicode)\n+normalize_newlines = allow_lazy(normalize_newlines, six.text_type)\n \n def recapitalize(text):\n     \"Recapitalizes text, placing caps after end-of-sentence punctuation.\"\n@@ -288,9 +289,9 @@ def javascript_quote(s, quote_double_quotes=False):\n     def fix(match):\n         return b\"\\u%04x\" % ord(match.group(1))\n \n-    if type(s) == str:\n+    if type(s) == bytes:\n         s = s.decode('utf-8')\n-    elif type(s) != unicode:\n+    elif type(s) != six.text_type:\n         raise TypeError(s)\n     s = s.replace('\\\\', '\\\\\\\\')\n     s = s.replace('\\r', '\\\\r')\n@@ -300,7 +301,7 @@ def fix(match):\n     if quote_double_quotes:\n         s = s.replace('\"', '&quot;')\n     return str(ustring_re.sub(fix, s))\n-javascript_quote = allow_lazy(javascript_quote, unicode)\n+javascript_quote = allow_lazy(javascript_quote, six.text_type)\n \n # Expression to match some_token and some_token=\"with spaces\" (and similarly\n # for single-quoted strings).\n@@ -332,7 +333,7 @@ def smart_split(text):\n     text = force_unicode(text)\n     for bit in smart_split_re.finditer(text):\n         yield bit.group(0)\n-smart_split = allow_lazy(smart_split, unicode)\n+smart_split = allow_lazy(smart_split, six.text_type)\n \n def _replace_entity(match):\n     text = match.group(1)\n@@ -348,15 +349,15 @@ def _replace_entity(match):\n             return match.group(0)\n     else:\n         try:\n-            return unichr(name2codepoint[text])\n+            return unichr(html_entities.name2codepoint[text])\n         except (ValueError, KeyError):\n             return match.group(0)\n \n _entity_re = re.compile(r\"&(#?[xX]?(?:[0-9a-fA-F]+|\\w{1,8}));\")\n \n def unescape_entities(text):\n     return _entity_re.sub(_replace_entity, text)\n-unescape_entities = allow_lazy(unescape_entities, unicode)\n+unescape_entities = allow_lazy(unescape_entities, six.text_type)\n \n def unescape_string_literal(s):\n     r\"\"\""
        },
        {
            "sha": "68c214d26f1ea11942a6513c452d67c2ac98e14d",
            "filename": "django/utils/timezone.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftimezone.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftimezone.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimezone.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -13,6 +13,7 @@\n     pytz = None\n \n from django.conf import settings\n+from django.utils import six\n \n __all__ = [\n     'utc', 'get_default_timezone', 'get_current_timezone',\n@@ -107,7 +108,7 @@ def get_default_timezone():\n     \"\"\"\n     global _localtime\n     if _localtime is None:\n-        if isinstance(settings.TIME_ZONE, basestring) and pytz is not None:\n+        if isinstance(settings.TIME_ZONE, six.string_types) and pytz is not None:\n             _localtime = pytz.timezone(settings.TIME_ZONE)\n         else:\n             _localtime = LocalTimezone()\n@@ -160,7 +161,7 @@ def activate(timezone):\n     \"\"\"\n     if isinstance(timezone, tzinfo):\n         _active.value = timezone\n-    elif isinstance(timezone, basestring) and pytz is not None:\n+    elif isinstance(timezone, six.string_types) and pytz is not None:\n         _active.value = pytz.timezone(timezone)\n     else:\n         raise ValueError(\"Invalid timezone: %r\" % timezone)"
        },
        {
            "sha": "d31a7aebf19b79b0c7a822221d4aeda34b129bd8",
            "filename": "django/utils/translation/__init__.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftranslation%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftranslation%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2F__init__.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,6 +5,7 @@\n \n from django.utils.encoding import force_unicode\n from django.utils.functional import lazy\n+from django.utils import six\n \n \n __all__ = [\n@@ -78,12 +79,12 @@ def pgettext(context, message):\n def npgettext(context, singular, plural, number):\n     return _trans.npgettext(context, singular, plural, number)\n \n-ngettext_lazy = lazy(ngettext, str)\n-gettext_lazy = lazy(gettext, str)\n-ungettext_lazy = lazy(ungettext, unicode)\n-ugettext_lazy = lazy(ugettext, unicode)\n-pgettext_lazy = lazy(pgettext, unicode)\n-npgettext_lazy = lazy(npgettext, unicode)\n+ngettext_lazy = lazy(ngettext, bytes)\n+gettext_lazy = lazy(gettext, bytes)\n+ungettext_lazy = lazy(ungettext, six.text_type)\n+ugettext_lazy = lazy(ugettext, six.text_type)\n+pgettext_lazy = lazy(pgettext, six.text_type)\n+npgettext_lazy = lazy(npgettext, six.text_type)\n \n def activate(language):\n     return _trans.activate(language)\n@@ -139,7 +140,7 @@ def _string_concat(*strings):\n     constructed from multiple parts.\n     \"\"\"\n     return ''.join([force_unicode(s) for s in strings])\n-string_concat = lazy(_string_concat, unicode)\n+string_concat = lazy(_string_concat, six.text_type)\n \n def get_language_info(lang_code):\n     from django.conf.locale import LANG_INFO"
        },
        {
            "sha": "9ebcbf54411d5e36c0ce232277e5c726918625ea",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -6,11 +6,11 @@\n import re\n import sys\n import gettext as gettext_module\n-from io import StringIO\n from threading import local\n \n from django.utils.importlib import import_module\n from django.utils.safestring import mark_safe, SafeData\n+from django.utils.six import StringIO\n \n \n # Translations are cached in a dictionary for every language+app tuple."
        },
        {
            "sha": "c95d19d56d0c766be8c8b809760e673121464e55",
            "filename": "django/views/csrf.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fcsrf.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fcsrf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fcsrf.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -101,4 +101,4 @@ def csrf_failure(request, reason=\"\"):\n                  'reason': reason,\n                  'no_referer': reason == REASON_NO_REFERER\n                  })\n-    return HttpResponseForbidden(t.render(c), mimetype='text/html')\n+    return HttpResponseForbidden(t.render(c), content_type='text/html')"
        },
        {
            "sha": "8e81b8239bd0efc89f67c203f026477192ff1ae4",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -15,6 +15,7 @@\n from django.utils.html import escape\n from django.utils.importlib import import_module\n from django.utils.encoding import smart_unicode, smart_str\n+from django.utils import six\n \n HIDDEN_SETTINGS = re.compile('API|TOKEN|KEY|SECRET|PASS|PROFANITIES_LIST|SIGNATURE')\n \n@@ -63,10 +64,10 @@ def technical_500_response(request, exc_type, exc_value, tb):\n     reporter = ExceptionReporter(request, exc_type, exc_value, tb)\n     if request.is_ajax():\n         text = reporter.get_traceback_text()\n-        return HttpResponseServerError(text, mimetype='text/plain')\n+        return HttpResponseServerError(text, content_type='text/plain')\n     else:\n         html = reporter.get_traceback_html()\n-        return HttpResponseServerError(html, mimetype='text/html')\n+        return HttpResponseServerError(html, content_type='text/html')\n \n # Cache for the default exception reporter filter instance.\n default_exception_reporter_filter = None\n@@ -214,7 +215,7 @@ def __init__(self, request, exc_type, exc_value, tb, is_email=False):\n         self.loader_debug_info = None\n \n         # Handle deprecated string exceptions\n-        if isinstance(self.exc_type, basestring):\n+        if isinstance(self.exc_type, six.string_types):\n             self.exc_value = Exception('Deprecated String Exception: %r' % self.exc_type)\n             self.exc_type = type(self.exc_value)\n \n@@ -361,7 +362,7 @@ def _get_lines_from_file(self, filename, lineno, context_lines, loader=None, mod\n             if match:\n                 encoding = match.group(1)\n                 break\n-        source = [unicode(sline, encoding, 'replace') for sline in source]\n+        source = [six.text_type(sline, encoding, 'replace') for sline in source]\n \n         lower_bound = max(0, lineno - context_lines)\n         upper_bound = lineno + context_lines\n@@ -443,15 +444,15 @@ def technical_404_response(request, exception):\n         'request': request,\n         'settings': get_safe_settings(),\n     })\n-    return HttpResponseNotFound(t.render(c), mimetype='text/html')\n+    return HttpResponseNotFound(t.render(c), content_type='text/html')\n \n def empty_urlconf(request):\n     \"Create an empty URLconf 404 error response.\"\n     t = Template(EMPTY_URLCONF_TEMPLATE, name='Empty URLConf template')\n     c = Context({\n         'project_name': settings.SETTINGS_MODULE.split('.')[0]\n     })\n-    return HttpResponse(t.render(c), mimetype='text/html')\n+    return HttpResponse(t.render(c), content_type='text/html')\n \n #\n # Templates are embedded in the file so that we know the error handler will"
        },
        {
            "sha": "2bbc23321ec115ea2d61e7c6376a4c4a05773f3f",
            "filename": "django/views/defaults.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fdefaults.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fdefaults.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdefaults.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -12,7 +12,7 @@ def page_not_found(request, template_name='404.html'):\n     \"\"\"\n     Default 404 handler.\n \n-    Templates: `404.html`\n+    Templates: :template:`404.html`\n     Context:\n         request_path\n             The path of the requested URL (e.g., '/app/pages/bad_page/')\n@@ -26,7 +26,7 @@ def server_error(request, template_name='500.html'):\n     \"\"\"\n     500 error handler.\n \n-    Templates: `500.html`\n+    Templates: :template:`500.html`\n     Context: None\n     \"\"\"\n     t = loader.get_template(template_name) # You need to create a 500.html template.\n@@ -41,7 +41,7 @@ def permission_denied(request, template_name='403.html'):\n     \"\"\"\n     Permission denied (403) handler.\n \n-    Templates: `403.html`\n+    Templates: :template:`403.html`\n     Context: None\n \n     If the template does not exist, an Http403 response containing the text"
        },
        {
            "sha": "c27b92b85ee7013a2aa33bca233fc25c0d315d6e",
            "filename": "django/views/generic/detail.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fgeneric%2Fdetail.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fgeneric%2Fdetail.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdetail.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -66,7 +66,7 @@ def get_queryset(self):\n             else:\n                 raise ImproperlyConfigured(\"%(cls)s is missing a queryset. Define \"\n                                            \"%(cls)s.model, %(cls)s.queryset, or override \"\n-                                           \"%(cls)s.get_object().\" % {\n+                                           \"%(cls)s.get_queryset().\" % {\n                                                 'cls': self.__class__.__name__\n                                         })\n         return self.queryset._clone()"
        },
        {
            "sha": "b0f64f49024ed7af3b36b7585c06ebac3392a63e",
            "filename": "django/views/i18n.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fi18n.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -8,6 +8,7 @@\n from django.utils.text import javascript_quote\n from django.utils.encoding import smart_unicode\n from django.utils.formats import get_format_modules, get_format\n+from django.utils import six\n \n def set_language(request):\n     \"\"\"\n@@ -52,7 +53,7 @@ def get_formats():\n             result[attr] = get_format(attr)\n     src = []\n     for k, v in result.items():\n-        if isinstance(v, (basestring, int)):\n+        if isinstance(v, (six.string_types, int)):\n             src.append(\"formats['%s'] = '%s';\\n\" % (javascript_quote(k), javascript_quote(smart_unicode(v))))\n         elif isinstance(v, (tuple, list)):\n             v = [javascript_quote(smart_unicode(value)) for value in v]\n@@ -184,7 +185,7 @@ def javascript_catalog(request, domain='djangojs', packages=None):\n                 activate(request.GET['language'])\n     if packages is None:\n         packages = ['django.conf']\n-    if isinstance(packages, basestring):\n+    if isinstance(packages, six.string_types):\n         packages = packages.split('+')\n     packages = [p for p in packages if p == 'django.conf' or p in settings.INSTALLED_APPS]\n     default_locale = to_locale(settings.LANGUAGE_CODE)\n@@ -258,7 +259,7 @@ def javascript_catalog(request, domain='djangojs', packages=None):\n     for k, v in t.items():\n         if k == '':\n             continue\n-        if isinstance(k, basestring):\n+        if isinstance(k, six.string_types):\n             csrc.append(\"catalog['%s'] = '%s';\\n\" % (javascript_quote(k), javascript_quote(v)))\n         elif isinstance(k, tuple):\n             if k[0] not in pdict:"
        },
        {
            "sha": "bcac9475e2530e1ada51fcad9a38df39a15687d7",
            "filename": "django/views/static.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fstatic.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/django%2Fviews%2Fstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fstatic.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,7 +9,10 @@\n import stat\n import posixpath\n import re\n-import urllib\n+try:\n+    from urllib.parse import unquote\n+except ImportError:     # Python 2\n+    from urllib import unquote\n \n from django.http import Http404, HttpResponse, HttpResponseRedirect, HttpResponseNotModified\n from django.template import loader, Template, Context, TemplateDoesNotExist\n@@ -30,7 +33,7 @@ def serve(request, path, document_root=None, show_indexes=False):\n     but if you'd like to override it, you can create a template called\n     ``static/directory_index.html``.\n     \"\"\"\n-    path = posixpath.normpath(urllib.unquote(path))\n+    path = posixpath.normpath(unquote(path))\n     path = path.lstrip('/')\n     newpath = ''\n     for part in path.split('/'):\n@@ -58,9 +61,9 @@ def serve(request, path, document_root=None, show_indexes=False):\n     mimetype = mimetype or 'application/octet-stream'\n     if not was_modified_since(request.META.get('HTTP_IF_MODIFIED_SINCE'),\n                               statobj.st_mtime, statobj.st_size):\n-        return HttpResponseNotModified(mimetype=mimetype)\n+        return HttpResponseNotModified(content_type=mimetype)\n     with open(fullpath, 'rb') as f:\n-        response = HttpResponse(f.read(), mimetype=mimetype)\n+        response = HttpResponse(f.read(), content_type=mimetype)\n     response[\"Last-Modified\"] = http_date(statobj.st_mtime)\n     if stat.S_ISREG(statobj.st_mode):\n         response[\"Content-Length\"] = statobj.st_size"
        },
        {
            "sha": "39a280e464c5a44709d237d4e2ac39f12cd95faf",
            "filename": "docs/conf.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fconf.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fconf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fconf.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -94,6 +94,7 @@\n intersphinx_mapping = {\n     'python': ('http://docs.python.org/2.7', None),\n     'sphinx': ('http://sphinx.pocoo.org/', None),\n+    'six': ('http://packages.python.org/six/', None),\n }\n \n # Python's docs don't change every week."
        },
        {
            "sha": "a14615e47c2668a6d38a7ff0d2b0440deee53591",
            "filename": "docs/faq/install.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ffaq%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ffaq%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Finstall.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,8 +16,8 @@ How do I get started?\n What are Django's prerequisites?\n --------------------------------\n \n-Django requires Python_, specifically Python 2.6 or 2.7.\n-No other Python libraries are required for basic Django usage.\n+Django requires Python_, specifically Python 2.6.5 - 2.7.x.  No other Python\n+libraries are required for basic Django usage.\n \n For a development environment -- if you just want to experiment with Django --\n you don't need to have a separate Web server installed; Django comes with its\n@@ -42,7 +42,7 @@ Do I lose anything by using Python 2.6 versus newer Python versions, such as Pyt\n ----------------------------------------------------------------------------------------\n \n Not in the core framework. Currently, Django itself officially supports\n-Python 2.6 and 2.7. However, newer versions of\n+Python 2.6 (2.6.5 or higher) and 2.7. However, newer versions of\n Python are often faster, have more features, and are better supported. If you\n use a newer version of Python you will also have access to some APIs that\n aren't available under older versions of Python."
        },
        {
            "sha": "4a83aa9f2cc5905c9e7dcaabc77ae175c9a9a940",
            "filename": "docs/faq/models.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ffaq%2Fmodels.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ffaq%2Fmodels.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Fmodels.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -40,18 +40,15 @@ Yes. See :doc:`Integrating with a legacy database </howto/legacy-databases>`.\n If I make changes to a model, how do I update the database?\n -----------------------------------------------------------\n \n-If you don't mind clearing data, your project's ``manage.py`` utility has an\n-option to reset the SQL for a particular application::\n-\n-    manage.py reset appname\n-\n-This drops any tables associated with ``appname`` and recreates them.\n+If you don't mind clearing data, your project's ``manage.py`` utility has a\n+:djadmin:`flush` option to reset the database to the state it was in\n+immediately after :djadmin:`syncdb` was executed.\n \n If you do care about deleting data, you'll have to execute the ``ALTER TABLE``\n statements manually in your database.\n \n There are `external projects which handle schema updates\n-<http://djangopackages.com/grids/g/database-migration/>`_, of which the current\n+<http://www.djangopackages.com/grids/g/database-migration/>`_, of which the current\n defacto standard is `south <http://south.aeracode.org/>`_.\n \n Do Django models support multiple-column primary keys?"
        },
        {
            "sha": "12e8ec2494df5f70021748a27be114e148ca7e23",
            "filename": "docs/howto/custom-management-commands.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fcustom-management-commands.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fcustom-management-commands.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-management-commands.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -129,7 +129,7 @@ default options such as :djadminopt:`--verbosity` and :djadminopt:`--traceback`.\n \n         class Command(BaseCommand):\n             ...\n-            self.can_import_settings = True\n+            can_import_settings = True\n \n             def handle(self, *args, **options):\n "
        },
        {
            "sha": "706cc2512903af35a454001ff5cb5c20031da20e",
            "filename": "docs/howto/custom-model-fields.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fcustom-model-fields.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fcustom-model-fields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-model-fields.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -434,10 +434,14 @@ database, so we need to be able to process strings and ``Hand`` instances in\n             p1 = re.compile('.{26}')\n             p2 = re.compile('..')\n             args = [p2.findall(x) for x in p1.findall(value)]\n+            if len(args) != 4:\n+                raise ValidationError(\"Invalid input for a Hand instance\")\n             return Hand(*args)\n \n Notice that we always return a ``Hand`` instance from this method. That's the\n-Python object type we want to store in the model's attribute.\n+Python object type we want to store in the model's attribute. If anything is\n+going wrong during value conversion, you should raise a\n+:exc:`~django.core.exceptions.ValidationError` exception.\n \n **Remember:** If your custom field needs the :meth:`to_python` method to be\n called when it is created, you should be using `The SubfieldBase metaclass`_\n@@ -666,7 +670,7 @@ data storage anyway, we can reuse some existing conversion code::\n \n         def value_to_string(self, obj):\n             value = self._get_val_from_obj(obj)\n-            return self.get_db_prep_value(value)\n+            return self.get_prep_value(value)\n \n Some general advice\n --------------------"
        },
        {
            "sha": "b5d438450effeca6c5694b24341a0e39348af78f",
            "filename": "docs/howto/deployment/wsgi/uwsgi.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fuwsgi.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fuwsgi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fdeployment%2Fwsgi%2Fuwsgi.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -46,7 +46,7 @@ uWSGI supports multiple ways to configure the process. See uWSGI's\n \n Here's an example command to start a uWSGI server::\n \n-    uwsgi --chdir=/path/to/your/project\n+    uwsgi --chdir=/path/to/your/project \\\n         --module=mysite.wsgi:application \\\n         --env DJANGO_SETTINGS_MODULE=mysite.settings \\\n         --master --pidfile=/tmp/project-master.pid \\"
        },
        {
            "sha": "eca2e2c4f99f60ab4c91dedfcc4d290a1164091a",
            "filename": "docs/howto/initial-data.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Finitial-data.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Finitial-data.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Finitial-data.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -67,12 +67,12 @@ And here's that same fixture as YAML:\n \n You'll store this data in a ``fixtures`` directory inside your app.\n \n-Loading data is easy: just call :djadmin:`manage.py loaddata <fixturename>\n-<loaddata>`, where ``<fixturename>`` is the name of the fixture file you've\n-created. Each time you run :djadmin:`loaddata`, the data will be read from the\n-fixture and re-loaded into the database. Note this means that if you change one\n-of the rows created by a fixture and then run :djadmin:`loaddata` again, you'll\n-wipe out any changes you've made.\n+Loading data is easy: just call :djadmin:`manage.py loaddata <loaddata>`\n+``<fixturename>``, where ``<fixturename>`` is the name of the fixture file\n+you've created. Each time you run :djadmin:`loaddata`, the data will be read\n+from the fixture and re-loaded into the database. Note this means that if you\n+change one of the rows created by a fixture and then run :djadmin:`loaddata`\n+again, you'll wipe out any changes you've made.\n \n Automatically loading initial data fixtures\n -------------------------------------------"
        },
        {
            "sha": "762250212a33bb07969d3124e642a32ab740fbac",
            "filename": "docs/howto/jython.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fjython.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fhowto%2Fjython.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fjython.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -36,7 +36,7 @@ such as `Apache Tomcat`_. Full JavaEE applications servers such as `GlassFish`_\n or `JBoss`_ are also OK, if you need the extra features they include.\n \n .. _`Apache Tomcat`: http://tomcat.apache.org/\n-.. _GlassFish: https://glassfish.dev.java.net/\n+.. _GlassFish: http://glassfish.java.net/\n .. _JBoss: http://www.jboss.org/\n \n Installing Django"
        },
        {
            "sha": "fb601a24c02ba0e45e3e2d22d1a20a1fab03b727",
            "filename": "docs/internals/committers.txt",
            "status": "modified",
            "additions": 26,
            "deletions": 11,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcommitters.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcommitters.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcommitters.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -146,7 +146,7 @@ Joseph Kocherhans\n \n     Brian lives in Denver, Colorado, USA.\n \n-.. _brian rosner: http://oebfare.com/\n+.. _brian rosner: http://brosner.com/\n .. _eldarion: http://eldarion.com/\n .. _django dose: http://djangodose.com/\n \n@@ -162,7 +162,7 @@ Joseph Kocherhans\n \n     Gary lives in Austin, Texas, USA.\n \n-.. _Gary Wilson: http://gdub.wordpress.com/\n+.. _Gary Wilson: http://thegarywilson.com/\n .. _The University of Texas: http://www.utexas.edu/\n \n Justin Bronn\n@@ -191,14 +191,19 @@ Karen Tracey\n `Jannis Leidel`_\n     Jannis graduated in media design from `Bauhaus-University Weimar`_,\n     is the author of a number of pluggable Django apps and likes to\n-    contribute to Open Source projects like Pinax_. He currently works as\n-    a freelance Web developer and designer.\n+    contribute to Open Source projects like virtualenv_ and pip_.\n+\n+    He has worked on Django's auth, admin and staticfiles apps as well as\n+    the form, core, internationalization and test systems. He currently works\n+    as the lead engineer at Gidsy_.\n \n     Jannis lives in Berlin, Germany.\n \n .. _Jannis Leidel: http://jezdez.com/\n .. _Bauhaus-University Weimar: http://www.uni-weimar.de/\n-.. _pinax: http://pinaxproject.com/\n+.. _virtualenv: http://www.virtualenv.org/\n+.. _pip: http://www.pip-installer.org/\n+.. _Gidsy: http://gidsy.com/\n \n `James Tauber`_\n     James is the lead developer of Pinax_ and the CEO and founder of\n@@ -214,15 +219,15 @@ Karen Tracey\n .. _James Tauber: http://jtauber.com/\n \n `Alex Gaynor`_\n-    Alex is a student at Rensselaer Polytechnic Institute, and is also an\n-    independent contractor.  He found Django in 2007 and has been addicted ever\n-    since he found out you don't need to write out your forms by hand.  He has\n-    a small obsession with compilers.  He's contributed to the ORM, forms,\n-    admin, and other components of Django.\n+    Alex is a software engineer working at Rdio_. He found Django in 2007 and\n+    has been addicted ever since he found out you don't need to write out your\n+    forms by hand. He has a small obsession with compilers.  He's contributed\n+    to the ORM, forms, admin, and other components of Django.\n \n-    Alex lives in Chicago, IL, but spends most of his time in Troy, NY.\n+    Alex lives in San Francisco, CA, USA.\n \n .. _Alex Gaynor: http://alexgaynor.net\n+.. _Rdio: http://rdio.com\n \n `Andrew Godwin`_\n     Andrew is a freelance Python developer and tinkerer, and has been\n@@ -365,6 +370,16 @@ Anssi Kääriäinen\n     all related features. He's also a fan of benckmarking and he tries keep\n     Django as fast as possible.\n \n+Florian Apolloner\n+    Florian is currently studying Physics at the `Graz University of Technology`_.\n+    Soon after he started using Django he joined the `Ubuntuusers webteam`_ to\n+    work on *Inyoka*, the software powering the whole Ubuntusers site.\n+\n+    For the time beeing he lives in Graz, Austria (not Australia ;)).\n+\n+.. _Graz University of Technology: http://tugraz.at/\n+.. _Ubuntuusers webteam: http://wiki.ubuntuusers.de/ubuntuusers/Webteam\n+\n Specialists\n -----------\n "
        },
        {
            "sha": "263087b5fac20a73f3013dcebb50dced1ad4f0d4",
            "filename": "docs/internals/contributing/localizing.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcontributing%2Flocalizing.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcontributing%2Flocalizing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Flocalizing.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -60,7 +60,7 @@ Django source tree, as for any code change:\n * Open a ticket in Django's ticket system, set its ``Component`` field to\n   ``Translations``, and attach the patch to it.\n \n-.. _Transifex: https://www.transifex.net/\n+.. _Transifex: https://www.transifex.com/\n .. _Django i18n mailing list: http://groups.google.com/group/django-i18n/\n-.. _Django project page: https://www.transifex.net/projects/p/django/\n-.. _Transifex User Guide: http://help.transifex.net/\n+.. _Django project page: https://www.transifex.com/projects/p/django/\n+.. _Transifex User Guide: http://help.transifex.com/"
        },
        {
            "sha": "4de506a654a8803aab518987b50dfcab6b7fa2cc",
            "filename": "docs/internals/contributing/writing-code/unit-tests.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-code%2Funit-tests.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -159,7 +159,7 @@ associated tests will be skipped.\n .. _Textile: http://pypi.python.org/pypi/textile\n .. _docutils: http://pypi.python.org/pypi/docutils/0.4\n .. _setuptools: http://pypi.python.org/pypi/setuptools/\n-.. _memcached: http://www.danga.com/memcached/\n+.. _memcached: http://memcached.org/\n .. _gettext: http://www.gnu.org/software/gettext/manual/gettext.html\n .. _selenium: http://pypi.python.org/pypi/selenium\n "
        },
        {
            "sha": "c8d7039a68fb274128c81c704dc5c0bd70452aa4",
            "filename": "docs/internals/contributing/writing-documentation.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcontributing%2Fwriting-documentation.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fcontributing%2Fwriting-documentation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fwriting-documentation.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -22,7 +22,7 @@ Getting the raw documentation\n -----------------------------\n \n Though Django's documentation is intended to be read as HTML at\n-http://docs.djangoproject.com/, we edit it as a collection of text files for\n+https://docs.djangoproject.com/, we edit it as a collection of text files for\n maximum flexibility. These files live in the top-level ``docs/`` directory of a\n Django release.\n "
        },
        {
            "sha": "9359c82e4670b21aef35447522beb33b354c48e7",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -276,6 +276,13 @@ these changes.\n * The function ``django.utils.itercompat.product`` will be removed. The Python\n   builtin version should be used instead.\n \n+* Auto-correction of INSTALLED_APPS and TEMPLATE_DIRS settings when they are\n+  specified as a plain string instead of a tuple will be removed and raise an\n+  exception.\n+\n+* The ``mimetype`` argument to :class:`~django.http.HttpResponse` ``__init__``\n+  will be removed (``content_type`` should be used instead).\n+\n 2.0\n ---\n "
        },
        {
            "sha": "14c5c31a4f36e4305646cf8cfa478fb0047bc4f4",
            "filename": "docs/intro/_images/admin12t.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2F_images%2Fadmin12t.png",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2F_images%2Fadmin12t.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin12t.png?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45"
        },
        {
            "sha": "7e8c7db7b365ed37e936f0e4baaa5ef1193fb242",
            "filename": "docs/intro/install.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Finstall.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -10,7 +10,7 @@ Install Python\n --------------\n \n Being a Python Web framework, Django requires Python. It works with any Python\n-version from 2.6 to 2.7 (due to backwards incompatibilities in Python 3.0,\n+version from 2.6.5 to 2.7 (due to backwards incompatibilities in Python 3.0,\n Django does not currently work with Python 3.0; see :doc:`the Django FAQ\n </faq/install>` for more information on supported Python versions and the 3.0\n transition), these versions of Python include a lightweight database called"
        },
        {
            "sha": "84da36be86f84e04261021aefcb2d96c773d5e05",
            "filename": "docs/intro/tutorial02.txt",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2Ftutorial02.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2Ftutorial02.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial02.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -113,8 +113,8 @@ Just one thing to do: We need to tell the admin that ``Poll``\n objects have an admin interface. To do this, create a file called\n ``admin.py`` in your ``polls`` directory, and edit it to look like this::\n \n-    from polls.models import Poll\n     from django.contrib import admin\n+    from polls.models import Poll\n \n     admin.site.register(Poll)\n \n@@ -283,6 +283,9 @@ It'd be better if you could add a bunch of Choices directly when you create the\n Remove the ``register()`` call for the ``Choice`` model. Then, edit the ``Poll``\n registration code to read::\n \n+    from django.contrib import admin\n+    from polls.models import Choice, Poll\n+\n     class ChoiceInline(admin.StackedInline):\n         model = Choice\n         extra = 3\n@@ -319,9 +322,12 @@ the ``ChoiceInline`` declaration to read::\n With that ``TabularInline`` (instead of ``StackedInline``), the\n related objects are displayed in a more compact, table-based format:\n \n-.. image:: _images/admin12.png\n+.. image:: _images/admin12t.png\n    :alt: Add poll page now has more compact choices\n \n+Note that there is an extra \"Delete?\" column that allows removing rows added\n+using the \"Add Another Choice\" button and rows that have already been saved.\n+\n Customize the admin change list\n ===============================\n \n@@ -442,6 +448,19 @@ above, then copy ``django/contrib/admin/templates/admin/base_site.html`` to\n ``/home/my_username/mytemplates/admin/base_site.html``. Don't forget that\n ``admin`` subdirectory.\n \n+.. admonition:: Where are the Django source files?\n+\n+    If you have difficulty finding where the Django source files are located\n+    on your system, run the following command:\n+\n+    .. code-block:: bash\n+\n+        python -c \"\n+        import sys\n+        sys.path = sys.path[1:]\n+        import django\n+        print(django.__path__)\"\n+\n Then, just edit the file and replace the generic Django text with your own\n site's name as you see fit.\n "
        },
        {
            "sha": "cc793c8129e61ed5897ea0958fd60a362199cdda",
            "filename": "docs/intro/whatsnext.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2Fwhatsnext.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fintro%2Fwhatsnext.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Fwhatsnext.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -108,7 +108,7 @@ On the Web\n ----------\n \n The most recent version of the Django documentation lives at\n-http://docs.djangoproject.com/en/dev/. These HTML pages are generated\n+https://docs.djangoproject.com/en/dev/. These HTML pages are generated\n automatically from the text files in source control. That means they reflect the\n \"latest and greatest\" in Django -- they include the very latest corrections and\n additions, and they discuss the latest Django features, which may only be\n@@ -124,7 +124,7 @@ rather than asking broad tech-support questions. If you need help with your\n particular Django setup, try the `django-users mailing list`_ or the `#django\n IRC channel`_ instead.\n \n-.. _ticket system: https://code.djangoproject.com/simpleticket?component=Documentation\n+.. _ticket system: https://code.djangoproject.com/newticket?component=Documentation\n .. _django-users mailing list: http://groups.google.com/group/django-users\n .. _#django IRC channel: irc://irc.freenode.net/django\n \n@@ -228,4 +228,4 @@ We follow this policy:\n * The `main documentation Web page`_ includes links to documentation for\n   all previous versions.\n \n-.. _main documentation Web page: http://docs.djangoproject.com/en/dev/\n+.. _main documentation Web page: https://docs.djangoproject.com/en/dev/"
        },
        {
            "sha": "bbf0d4f05a8f2db299bb6fc68d94788cf84ca11f",
            "filename": "docs/ref/class-based-views/generic-display.txt",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fclass-based-views%2Fgeneric-display.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fclass-based-views%2Fgeneric-display.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-display.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -54,7 +54,7 @@ many projects they are typically the most commonly used views.\n         from article.views import ArticleDetailView\n \n         urlpatterns = patterns('',\n-            url(r'^(?P<slug>[-_\\w]+)/$', ArticleDetailView.as_view(), 'article-detail'),\n+            url(r'^(?P<slug>[-_\\w]+)/$', ArticleDetailView.as_view(), name='article-detail'),\n         )    \n \n .. class:: django.views.generic.list.ListView\n@@ -76,11 +76,11 @@ many projects they are typically the most commonly used views.\n \n     **Method Flowchart**\n \n-    1. :meth:`dispatch():`\n-    2. :meth:`http_method_not_allowed():`\n-    3. :meth:`get_template_names():`\n-    4. :meth:`get_queryset():`\n-    5. :meth:`get_objects():`\n-    6. :meth:`get_context_data():`\n-    7. :meth:`get():`\n-    8. :meth:`render_to_response():`\n+    1. :meth:`dispatch()`\n+    2. :meth:`http_method_not_allowed()`\n+    3. :meth:`get_template_names()`\n+    4. :meth:`get_queryset()`\n+    5. :meth:`get_objects()`\n+    6. :meth:`get_context_data()`\n+    7. :meth:`get()`\n+    8. :meth:`render_to_response()`"
        },
        {
            "sha": "f28aa4687bd4c2fd85492e4fe54883b92470e460",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 17,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -115,7 +115,7 @@ subclass::\n \n .. attribute:: ModelAdmin.actions_selection_counter\n \n-    Controls whether a selection counter is display next to the action dropdown.\n+    Controls whether a selection counter is displayed next to the action dropdown.\n     By default, the admin changelist will display it\n     (``actions_selection_counter = True``).\n \n@@ -371,12 +371,6 @@ subclass::\n         because ``raw_id_fields`` and ``radio_fields`` imply custom widgets of\n         their own.\n \n-.. attribute:: ModelAdmin.get_changelist\n-\n-    Returns the Changelist class to be used for listing. By default,\n-    ``django.contrib.admin.views.main.ChangeList`` is used. By inheriting this\n-    class you can change the behavior of the listing.\n-\n .. attribute:: ModelAdmin.inlines\n \n     See :class:`InlineModelAdmin` objects below.\n@@ -1168,6 +1162,12 @@ templates used by the :class:`ModelAdmin` views:\n                         kwargs['choices'] += (('ready', 'Ready for deployment'),)\n                 return super(MyModelAdmin, self).formfield_for_choice_field(db_field, request, **kwargs)\n \n+.. method:: ModelAdmin.get_changelist(self, request, **kwargs)\n+\n+    Returns the Changelist class to be used for listing. By default,\n+    ``django.contrib.admin.views.main.ChangeList`` is used. By inheriting this\n+    class you can change the behavior of the listing.\n+\n .. method:: ModelAdmin.has_add_permission(self, request)\n \n     Should return ``True`` if adding an object is permitted, ``False``\n@@ -1948,16 +1948,17 @@ accessible using Django's :ref:`URL reversing system <naming-url-patterns>`.\n \n The :class:`AdminSite` provides the following named URL patterns:\n \n-======================  ========================  =============\n-Page                    URL name                  Parameters\n-======================  ========================  =============\n-Index                   ``index``\n-Logout                  ``logout``\n-Password change         ``password_change``\n-Password change done    ``password_change_done``\n-i18n javascript         ``jsi18n``\n-Application index page  ``app_list``              ``app_label``\n-======================  ========================  =============\n+=========================  ========================  ==================================\n+Page                       URL name                  Parameters\n+=========================  ========================  ==================================\n+Index                      ``index``\n+Logout                     ``logout``\n+Password change            ``password_change``\n+Password change done       ``password_change_done``\n+i18n javascript            ``jsi18n``\n+Application index page     ``app_list``              ``app_label``\n+Redirect to object's page  ``view_on_site``          ``content_type_id``, ``object_id``\n+=========================  ========================  ==================================\n \n Each :class:`ModelAdmin` instance provides an additional set of named URLs:\n "
        },
        {
            "sha": "af937e036ebc5c302b3a2f697842ce16fc4e83c8",
            "filename": "docs/ref/contrib/comments/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Findex.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -250,7 +250,7 @@ Redirecting after the comment post\n To specify the URL you want to redirect to after the comment has been posted,\n you can include a hidden form input called ``next`` in your comment form. For example::\n \n-    <input type=\"hidden\" name=\"next\" value=\"{% url my_comment_was_posted %}\" />\n+    <input type=\"hidden\" name=\"next\" value=\"{% url 'my_comment_was_posted' %}\" />\n \n .. _notes-on-the-comment-form:\n "
        },
        {
            "sha": "7d229a5d66bf3a7da553f407e1f0aae68a9e49ef",
            "filename": "docs/ref/contrib/formtools/form-wizard.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fformtools%2Fform-wizard.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -554,9 +554,8 @@ How to work with ModelForm and ModelFormSet\n WizardView supports :doc:`ModelForms </topics/forms/modelforms>` and\n :ref:`ModelFormSets <model-formsets>`. Additionally to\n :attr:`~WizardView.initial_dict`, the :meth:`~WizardView.as_view` method takes\n-an ``instance_dict`` argument that should contain instances of ``ModelForm`` and\n-``ModelFormSet``.  Similarly to :attr:`~WizardView.initial_dict`, these\n-dictionary key values should be equal to the step number in the form list.\n+an ``instance_dict`` argument that should contain model instances for steps\n+based on ``ModelForm`` and querysets for steps based on ``ModelFormSet``.\n \n Usage of ``NamedUrlWizardView``\n ==============================="
        },
        {
            "sha": "f90c9c2e91d7dcacdbf97c43123976036ffeef2c",
            "filename": "docs/ref/contrib/gis/deployment.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 53,
            "changes": 59,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fdeployment.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fdeployment.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fdeployment.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,10 @@\n Deploying GeoDjango\n ===================\n \n+Basically, the deployment of a GeoDjango application is not different from\n+the deployment of a normal Django application. Please consult Django's\n+:doc:`deployment documentation </howto/deployment/index>`.\n+\n .. warning::\n \n     GeoDjango uses the GDAL geospatial library which is\n@@ -10,58 +14,7 @@ Deploying GeoDjango\n     appropriate configuration of Apache or the prefork method\n     when using FastCGI through another Web server.\n \n-Apache\n-======\n-In this section there are some example ``VirtualHost`` directives for\n-when deploying using ``mod_wsgi``, which is now officially the recommended\n-way to deploy Django applications with Apache.\n-As long as ``mod_wsgi`` is configured correctly, it does not\n-matter whether the version of Apache is prefork or worker.\n-\n-.. note::\n-\n-    The ``Alias`` and ``Directory`` configurations in the examples\n-    below use an example path to a system-wide installation folder of Django.\n-    Substitute in an appropriate location, if necessary, as it may be\n-    different than the path on your system.\n-\n-``mod_wsgi``\n-------------\n-\n-Example::\n-\n-    <VirtualHost *:80>\n-      WSGIDaemonProcess geodjango user=geo group=geo processes=5 threads=1\n-      WSGIProcessGroup geodjango\n-      WSGIScriptAlias / /home/geo/geodjango/world.wsgi\n-\n-      Alias /media/ \"/usr/lib/python2.6/site-packages/django/contrib/admin/media/\"\n-      <Directory \"/usr/lib/python2.6/site-packages/django/contrib/admin/media/\">\n-        Order allow,deny\n-        Options Indexes\n-        Allow from all\n-        IndexOptions FancyIndexing\n-      </Directory>\n-\n-    </VirtualHost>\n-\n-.. warning::\n-\n-    If the ``WSGIDaemonProcess`` attribute ``threads`` is not set to ``1``, then\n+    For example, when configuring your application with ``mod_wsgi``,\n+    set the ``WSGIDaemonProcess`` attribute ``threads`` to ``1``, unless\n     Apache may crash when running your GeoDjango application.  Increase the\n     number of ``processes`` instead.\n-\n-For more information, please consult Django's\n-:doc:`mod_wsgi documentation </howto/deployment/wsgi/modwsgi>`.\n-\n-Lighttpd\n-========\n-\n-FastCGI\n--------\n-\n-Nginx\n-=====\n-\n-FastCGI\n--------"
        },
        {
            "sha": "c4b29bead725e5a09f56edf485ab5883b9ddc7d4",
            "filename": "docs/ref/contrib/gis/gdal.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fgdal.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fgdal.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgdal.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -447,7 +447,7 @@ systems and coordinate transformation::\n \n    This object is a wrapper for the `OGR Geometry`__ class.\n    These objects are instantiated directly from the given ``geom_input`` \n-   parameter, which may be a string containing WKT or HEX, a ``buffer``\n+   parameter, which may be a string containing WKT, HEX, GeoJSON, a ``buffer``\n    containing WKB data, or an :class:`OGRGeomType` object. These objects\n    are also returned from the :class:`Feature.geom` attribute, when \n    reading vector data from :class:`Layer` (which is in turn a part of"
        },
        {
            "sha": "eeec2e2133b842831d417f3ecc8a246d0dd68896",
            "filename": "docs/ref/contrib/gis/geoquerysets.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeoquerysets.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1026,7 +1026,7 @@ Keyword Argument       Description\n                        representation -- the default value is 8.\n =====================  =====================================================\n \n-__ http://code.google.com/apis/kml/documentation/\n+__ https://developers.google.com/kml/documentation/\n \n ``svg``\n ~~~~~~~\n@@ -1185,7 +1185,7 @@ Keyword Argument       Description\n                        details.\n =====================  =====================================================\n \n-__ http://download.oracle.com/docs/html/B14255_01/sdo_intro.htm#sthref150\n+__ http://docs.oracle.com/html/B14255_01/sdo_intro.htm#sthref150\n \n Aggregate Functions\n -------------------\n@@ -1232,6 +1232,6 @@ Returns the same as the :meth:`GeoQuerySet.union` aggregate method.\n \n .. rubric:: Footnotes\n .. [#fnde9im] *See* `OpenGIS Simple Feature Specification For SQL <http://www.opengis.org/docs/99-049.pdf>`_, at Ch. 2.1.13.2, p. 2-13 (The Dimensionally Extended Nine-Intersection Model).\n-.. [#fnsdorelate] *See* `SDO_RELATE documentation <http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14255/sdo_operat.htm#sthref845>`_, from Ch. 11 of the Oracle Spatial User's Guide and Manual.\n+.. [#fnsdorelate] *See* `SDO_RELATE documentation <http://docs.oracle.com/cd/B19306_01/appdev.102/b14255/sdo_operat.htm#sthref845>`_, from Ch. 11 of the Oracle Spatial User's Guide and Manual.\n .. [#fncovers] For an explanation of this routine, read `Quirks of the \"Contains\" Spatial Predicate <http://lin-ear-th-inking.blogspot.com/2007/06/subtleties-of-ogc-covers-spatial.html>`_ by Martin Davis (a PostGIS developer).\n .. [#fncontainsproperly] Refer to the PostGIS ``ST_ContainsProperly`` `documentation <http://postgis.refractions.net/documentation/manual-1.4/ST_ContainsProperly.html>`_ for more details."
        },
        {
            "sha": "eda961738123137ce40b68b0680b2c062f121072",
            "filename": "docs/ref/contrib/gis/geos.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -324,7 +324,7 @@ and Z values that are a part of this geometry.\n \n Returns the Well-Known Text of the geometry (an OGC standard).\n \n-__ http://code.google.com/apis/kml/documentation/\n+__ https://developers.google.com/kml/documentation/\n \n Spatial Predicate Methods\n ~~~~~~~~~~~~~~~~~~~~~~~~~\n@@ -891,7 +891,7 @@ Returns the WKT of the given geometry. Example::\n \n \n .. rubric:: Footnotes\n-.. [#fnogc] *See* `PostGIS EWKB, EWKT and Canonical Forms <http://postgis.refractions.net/docs/ch04.html#id2591381>`_, PostGIS documentation at Ch. 4.1.2.\n+.. [#fnogc] *See* `PostGIS EWKB, EWKT and Canonical Forms <http://postgis.refractions.net/docs/using_postgis_dbmanagement.html#EWKB_EWKT>`_, PostGIS documentation at Ch. 4.1.2.\n .. [#fncascadedunion] For more information, read Paul Ramsey's blog post about `(Much) Faster Unions in PostGIS 1.4 <http://blog.cleverelephant.ca/2009/01/must-faster-unions-in-postgis-14.html>`_ and Martin Davis' blog post on `Fast polygon merging in JTS using Cascaded Union <http://lin-ear-th-inking.blogspot.com/2007/11/fast-polygon-merging-in-jts-using.html>`_.\n \n Settings"
        },
        {
            "sha": "5ee6d5153d837691aceaa5d88773a7bec45a4f3a",
            "filename": "docs/ref/contrib/gis/install.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 76,
            "changes": 91,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -81,7 +81,7 @@ Program                   Description                           Required\n ========================  ====================================  ================================  ==========================\n :ref:`GEOS <ref-geos>`    Geometry Engine Open Source           Yes                               3.3, 3.2, 3.1, 3.0\n `PROJ.4`_                 Cartographic Projections library      Yes (PostgreSQL and SQLite only)  4.7, 4.6, 4.5, 4.4\n-:ref:`GDAL <ref-gdal>`    Geospatial Data Abstraction Library   No (but, required for SQLite)     1.8, 1.7, 1.6, 1.5, 1.4\n+:ref:`GDAL <ref-gdal>`    Geospatial Data Abstraction Library   No (but, required for SQLite)     1.9, 1.8, 1.7, 1.6, 1.5\n :ref:`GeoIP <ref-geoip>`  IP-based geolocation library          No                                1.4\n `PostGIS`__               Spatial extensions for PostgreSQL     Yes (PostgreSQL only)             1.5, 1.4, 1.3\n `SpatiaLite`__            Spatial extensions for SQLite         Yes (SQLite only)                 3.0, 2.4, 2.3\n@@ -102,7 +102,7 @@ Program                   Description                           Required\n \n .. _PROJ.4: http://trac.osgeo.org/proj/\n __ http://postgis.refractions.net/\n-__ http://www.gaia-gis.it/spatialite/index.html\n+__ http://www.gaia-gis.it/gaia-sins/\n \n .. _build_from_source:\n \n@@ -233,7 +233,7 @@ installed prior to building PostGIS.\n     The `psycopg2`_ module is required for use as the database adaptor\n     when using GeoDjango with PostGIS.\n \n-.. _psycopg2: http://initd.org/projects/psycopg2\n+.. _psycopg2: http://initd.org/psycopg/\n \n First download the source archive, and extract::\n \n@@ -270,9 +270,9 @@ supports :ref:`GDAL's vector data <ref-gdal>` capabilities [#]_.\n \n First download the latest GDAL release version and untar the archive::\n \n-    $ wget http://download.osgeo.org/gdal/gdal-1.8.1.tar.gz\n-    $ tar xzf gdal-1.8.1.tar.gz\n-    $ cd gdal-1.8.1\n+    $ wget http://download.osgeo.org/gdal/gdal-1.9.1.tar.gz\n+    $ tar xzf gdal-1.9.1.tar.gz\n+    $ cd gdal-1.9.1\n \n Configure, make and install::\n \n@@ -376,7 +376,7 @@ SpatiaLite.\n After installation is complete, don't forget to read the post-installation\n docs on :ref:`create_spatialite_db`.\n \n-__ http://www.gaia-gis.it/spatialite/index.html\n+__ http://www.gaia-gis.it/gaia-sins/\n \n .. _sqlite:\n \n@@ -457,7 +457,7 @@ Finally, do the same for the SpatiaLite tools::\n \n         $ ./configure --target=macosx\n \n-__ http://www.gaia-gis.it/spatialite/sources.html\n+__ http://www.gaia-gis.it/gaia-sins/libspatialite-sources/\n \n .. _pysqlite2:\n \n@@ -664,7 +664,7 @@ community!  You can:\n   and specify the component as \"GIS\".\n \n __ http://groups.google.com/group/geodjango\n-__ https://code.djangoproject.com/simpleticket\n+__ https://code.djangoproject.com/newticket\n \n .. _libsettings:\n \n@@ -762,13 +762,13 @@ Python\n ^^^^^^\n \n Although OS X comes with Python installed, users can use framework\n-installers (`2.5`__ and `2.6`__ are available) provided by\n+installers (`2.6`__ and `2.7`__ are available) provided by\n the Python Software Foundation.  An advantage to using the installer is\n that OS X's Python will remain \"pristine\" for internal operating system\n use.\n \n-__ http://python.org/ftp/python/2.5.4/python-2.5.4-macosx.dmg\n-__ http://python.org/ftp/python/2.6.2/python-2.6.2-macosx2009-04-16.dmg\n+__ http://python.org/ftp/python/2.6.6/python-2.6.6-macosx10.3.dmg\n+__ http://python.org/ftp/python/2.7.3/\n \n .. note::\n \n@@ -838,17 +838,6 @@ your ``.profile`` to be able to run the package programs from the command-line::\n __ http://www.kyngchaos.com/software/frameworks\n __ http://www.kyngchaos.com/software/postgres\n \n-.. note::\n-\n-    Use of these binaries requires Django 1.0.3 and above.  If you are\n-    using a previous version of Django (like 1.0.2), then you will have\n-    to add the following in your settings:\n-\n-    .. code-block:: python\n-\n-        GEOS_LIBRARY_PATH='/Library/Frameworks/GEOS.framework/GEOS'\n-        GDAL_LIBRARY_PATH='/Library/Frameworks/GDAL.framework/GDAL'\n-\n .. _psycopg2_kyngchaos:\n \n psycopg2\n@@ -903,7 +892,7 @@ add the following to your ``settings.py``:\n \n     SPATIALITE_LIBRARY_PATH='/Library/Frameworks/SQLite3.framework/SQLite3'\n \n-__ http://www.gaia-gis.it/spatialite/binaries.html\n+__ http://www.gaia-gis.it/spatialite-2.3.1/binaries.html\n \n .. _fink:\n \n@@ -1045,61 +1034,11 @@ Optional packages to consider:\n     do not plan on doing any database transformation of geometries to the\n     Google projection (900913).\n \n-.. _heron:\n-\n-8.04 and lower\n-~~~~~~~~~~~~~~\n-\n-The 8.04 (and lower) versions of Ubuntu use GEOS v2.2.3 in their binary packages,\n-which is incompatible with GeoDjango.  Thus, do *not* use the binary packages\n-for GEOS or PostGIS and build some prerequisites from source, per the instructions\n-in this document; however, it is okay to use the PostgreSQL binary packages.\n-\n-For more details, please see the Debian instructions for :ref:`etch` below.\n-\n .. _debian:\n \n Debian\n ------\n \n-.. _etch:\n-\n-4.0 (Etch)\n-^^^^^^^^^^\n-\n-The situation here is the same as that of Ubuntu :ref:`heron` -- in other words,\n-some packages must be built from source to work properly with GeoDjango.\n-\n-Binary packages\n-~~~~~~~~~~~~~~~\n-The following command will install acceptable binary packages, as well as\n-the development tools necessary to build the rest of the requirements:\n-\n-.. code-block:: bash\n-\n-    $ sudo apt-get install binutils bzip2 gcc g++ flex make postgresql-8.1 \\\n-        postgresql-server-dev-8.1 python-ctypes python-psycopg2 python-setuptools\n-\n-Required package information:\n-\n-* ``binutils``: for ctypes to find libraries\n-* ``bzip2``: for decompressing the source packages\n-* ``gcc``, ``g++``, ``make``: GNU developer tools used to compile the libraries\n-* ``flex``: required to build PostGIS\n-* ``postgresql-8.1``\n-* ``postgresql-server-dev-8.1``: for ``pg_config``\n-* ``python-psycopg2``\n-\n-Optional packages:\n-\n-* ``libgeoip``: for :ref:`GeoIP <ref-geoip>` support\n-\n-Source packages\n-~~~~~~~~~~~~~~~\n-You will still have to install :ref:`geosbuild`, :ref:`proj4`,\n-:ref:`postgis`, and :ref:`gdalbuild` from source.  Please follow the\n-directions carefully.\n-\n .. _lenny:\n \n 5.0 (Lenny)\n@@ -1314,8 +1253,8 @@ may be executed from the SQL Shell as the ``postgres`` user::\n .. rubric:: Footnotes\n .. [#] The datum shifting files are needed for converting data to and from\n        certain projections.\n-       For example, the PROJ.4 string for the `Google projection (900913)\n-       <http://spatialreference.org/ref/epsg/900913/proj4>`_ requires the\n+       For example, the PROJ.4 string for the `Google projection (900913 or 3857)\n+       <http://spatialreference.org/ref/sr-org/6864/prj/>`_ requires the\n        ``null`` grid file only included in the extra datum shifting files.\n        It is easier to install the shifting files now, then to have debug a\n        problem caused by their absence later."
        },
        {
            "sha": "8c5274e6d3451f2963478ed7846077d9766f5124",
            "filename": "docs/ref/contrib/gis/model-api.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fmodel-api.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fmodel-api.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fmodel-api.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -142,7 +142,7 @@ __ http://en.wikipedia.org/wiki/Geodesy\n __ http://en.wikipedia.org/wiki/Great_circle\n __ http://www.spatialreference.org/ref/epsg/2796/\n __ http://spatialreference.org/\n-__ http://welcome.warnercnr.colostate.edu/class_info/nr502/lg3/datums_coordinates/spcs.html\n+__ http://web.archive.org/web/20080302095452/http://welcome.warnercnr.colostate.edu/class_info/nr502/lg3/datums_coordinates/spcs.html\n \n ``spatial_index``\n -----------------\n@@ -252,7 +252,7 @@ for example::\n     qs = Address.objects.filter(zipcode__poly__contains='POINT(-104.590948 38.319914)')\n \n .. rubric:: Footnotes\n-.. [#fnogc] OpenGIS Consortium, Inc., `Simple Feature Specification For SQL <http://www.opengis.org/docs/99-049.pdf>`_, Document 99-049 (May 5, 1999).\n+.. [#fnogc] OpenGIS Consortium, Inc., `Simple Feature Specification For SQL <http://www.opengeospatial.org/standards/sfs>`_.\n .. [#fnogcsrid] *See id.* at Ch. 2.3.8, p. 39 (Geometry Values and Spatial Reference Systems).\n .. [#fnsrid] Typically, SRID integer corresponds to an EPSG (`European Petroleum Survey Group <http://www.epsg.org>`_) identifier.  However, it may also be associated with custom projections defined in spatial database's spatial reference systems table.\n .. [#fnharvard] Harvard Graduate School of Design, `An Overview of Geodesy and Geographic Referencing Systems <http://www.gsd.harvard.edu/gis/manual/projections/fundamentals/>`_.  This is an excellent resource for an overview of principles relating to geographic and Cartesian coordinate systems."
        },
        {
            "sha": "0ab8f7582502a897ac8ae40b826a810b94c07eb6",
            "filename": "docs/ref/contrib/gis/sitemaps.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fsitemaps.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Fsitemaps.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fsitemaps.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,10 +2,10 @@\n Geographic Sitemaps\n ===================\n \n-Google's sitemap protocol has been recently extended to support geospatial\n-content. [#]_   This includes the addition of the ``<url>`` child element\n+Google's sitemap protocol used to include geospatial content support. [#]_\n+This included the addition of the ``<url>`` child element\n ``<geo:geo>``, which tells Google that the content located at the URL is\n-geographic in nature. [#]_ \n+geographic in nature. This is now obsolete.\n \n Example\n =======\n@@ -23,5 +23,4 @@ Reference\n -----------------\n \n .. rubric:: Footnotes\n-.. [#] Google, Inc., `What is a Geo Sitemap? <http://www.google.com/support/webmasters/bin/answer.py?answer=94554>`_.\n-.. [#] Google, Inc., `Submit Your Geo Content to Google <http://code.google.com/apis/kml/documentation/kmlSearch.html>`_.\n+.. [#] Google, Inc., `What is a Geo Sitemap? <http://support.google.com/webmasters/bin/answer.py?answer=94555>`_."
        },
        {
            "sha": "3a63493137046683b15947ddd1f4586c72dd2109",
            "filename": "docs/ref/contrib/gis/tutorial.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Ftutorial.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -784,4 +784,4 @@ option class in your ``admin.py`` file::\n .. [#] Special thanks to Bjørn Sandvik of `thematicmapping.org <http://thematicmapping.org>`_ for providing and maintaining this data set.\n .. [#] GeoDjango basic apps was written by Dane Springmeyer, Josh Livni, and Christopher Schmidt.\n .. [#] Here the point is for the `University of Houston Law Center <http://www.law.uh.edu/>`_.\n-.. [#] Open Geospatial Consortium, Inc., `OpenGIS Simple Feature Specification For SQL <http://www.opengis.org/docs/99-049.pdf>`_, Document 99-049.\n+.. [#] Open Geospatial Consortium, Inc., `OpenGIS Simple Feature Specification For SQL <http://www.opengeospatial.org/standards/sfs>`_."
        },
        {
            "sha": "4595f51d9ef76b66d9ccc2aef1c66f4c1d6fdabb",
            "filename": "docs/ref/contrib/localflavor.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Flocalflavor.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Flocalflavor.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -93,7 +93,7 @@ Here's an example of how to use them::\n     class MyForm(forms.Form):\n         my_date_field = generic.forms.DateField()\n \n-.. _ISO 3166 country codes: http://www.iso.org/iso/country_codes/iso_3166_code_lists/english_country_names_and_code_elements.htm\n+.. _ISO 3166 country codes: http://www.iso.org/iso/country_codes.htm\n .. _Argentina: `Argentina (ar)`_\n .. _Australia: `Australia (au)`_\n .. _Austria: `Austria (at)`_\n@@ -158,7 +158,7 @@ any code you'd like to contribute. One thing we ask is that you please use\n Unicode objects (``u'mystring'``) for strings, rather than setting the encoding\n in the file. See any of the existing flavors for examples.\n \n-.. _create a ticket: https://code.djangoproject.com/simpleticket\n+.. _create a ticket: https://code.djangoproject.com/newticket\n \n Localflavor and backwards compatibility\n =======================================\n@@ -713,7 +713,7 @@ Italy (``it``)\n     A form field that validates input as an Italian social security number\n     (`codice fiscale`_).\n \n-.. _codice fiscale: http://www.agenziaentrate.it/ilwwcm/connect/Nsi/Servizi/Codice+fiscale+-+tessera+sanitaria/NSI+Informazioni+sulla+codificazione+delle+persone+fisiche\n+.. _codice fiscale: http://www.agenziaentrate.gov.it/wps/content/Nsilib/Nsi/Home/CosaDeviFare/Richiedere/Codice+fiscale+e+tessera+sanitaria/Richiesta+TS_CF/SchedaI/Informazioni+codificazione+pf/\n \n .. class:: it.forms.ITVatNumberField\n "
        },
        {
            "sha": "6929a3b0d0aa55165d1ce96256b29e819ed26075",
            "filename": "docs/ref/contrib/messages.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fmessages.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fmessages.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fmessages.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -54,15 +54,16 @@ Storage backends\n ----------------\n \n The messages framework can use different backends to store temporary messages.\n-To change which backend is being used, add a `MESSAGE_STORAGE`_ to your\n+If the default FallbackStorage isn't suitable to your needs, you can change\n+which backend is being used by adding a `MESSAGE_STORAGE`_ to your\n settings, referencing the module and class of the storage class. For\n example::\n \n     MESSAGE_STORAGE = 'django.contrib.messages.storage.cookie.CookieStorage'\n \n The value should be the full path of the desired storage class.\n \n-Four storage classes are included:\n+Three storage classes are available:\n \n ``'django.contrib.messages.storage.session.SessionStorage'``\n     This class stores all messages inside of the request's session. It\n@@ -74,6 +75,8 @@ Four storage classes are included:\n     messages are dropped if the cookie data size would exceed 4096 bytes.\n \n ``'django.contrib.messages.storage.fallback.FallbackStorage'``\n+    This is the default storage class.\n+\n     This class first uses CookieStorage for all messages, falling back to using\n     SessionStorage for the messages that could not fit in a single cookie.\n "
        },
        {
            "sha": "2393a4a9a32456b6b6b3474c1b1981af8c68ebcd",
            "filename": "docs/ref/contrib/sitemaps.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsitemaps.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -410,7 +410,7 @@ generate a Google News compatible sitemap:\n     {% endspaceless %}\n     </urlset>\n \n-.. _`Google news sitemaps`: http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=74288\n+.. _`Google news sitemaps`: http://support.google.com/webmasters/bin/answer.py?hl=en&answer=74288\n \n Pinging Google\n =============="
        },
        {
            "sha": "cbe8ad54b87d9a12f11d0d80dea5705a692b6511",
            "filename": "docs/ref/contrib/staticfiles.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fcontrib%2Fstaticfiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fstaticfiles.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -387,6 +387,17 @@ The previous example is equal to calling the ``url`` method of an instance of\n useful when using a non-local storage backend to deploy files as documented\n in :ref:`staticfiles-from-cdn`.\n \n+.. versionadded:: 1.5\n+\n+If you'd like to retrieve a static URL without displaying it, you can use a\n+slightly different call:\n+\n+.. code-block:: html+django\n+\n+    {% load static from staticfiles %}\n+    {% static \"images/hi.jpg\" as myphoto %}\n+    <img src=\"{{ myphoto }}\" alt=\"Hi!\" />\n+\n Other Helpers\n =============\n "
        },
        {
            "sha": "74e6b48f0741f34d5c2e9d2ed7ef48d1007ee023",
            "filename": "docs/ref/databases.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fdatabases.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fdatabases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdatabases.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -31,7 +31,7 @@ attempt to use the ``StdDev(sample=False)`` or ``Variance(sample=False)``\n aggregate with a database backend that falls within the affected release range.\n \n .. _known to be faulty: http://archives.postgresql.org/pgsql-bugs/2007-07/msg00046.php\n-.. _Release 8.2.5: http://developer.postgresql.org/pgdocs/postgres/release-8-2-5.html\n+.. _Release 8.2.5: http://www.postgresql.org/docs/devel/static/release-8-2-5.html\n \n Optimizing PostgreSQL's configuration\n -------------------------------------\n@@ -111,7 +111,7 @@ outputs a single ``CREATE INDEX`` statement.  However, if the database type\n for the field is either ``varchar`` or ``text`` (e.g., used by ``CharField``,\n ``FileField``, and ``TextField``), then Django will create\n an additional index that uses an appropriate `PostgreSQL operator class`_\n-for the column.  The extra index is necessary to correctly perfrom\n+for the column.  The extra index is necessary to correctly perform\n lookups that use the ``LIKE`` operator in their SQL, as is done with the\n ``contains`` and ``startswith`` lookup types.\n \n@@ -335,7 +335,9 @@ storage engine, you have a couple of options.\n       }\n \n   This sets the default storage engine upon connecting to the database.\n-  After your tables have been created, you should remove this option.\n+  After your tables have been created, you should remove this option as it\n+  adds a query that is only needed during table creation to each database\n+  connection.\n \n * Another method for changing the storage engine is described in\n   AlterModelOnSyncDB_."
        },
        {
            "sha": "c4295c68d597f481e34649cc4c73691bb5b84c9c",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 23,
            "deletions": 3,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -224,8 +224,8 @@ flush\n \n .. django-admin:: flush\n \n-Returns the database to the state it was in immediately after syncdb was\n-executed. This means that all data will be removed from the database, any\n+Returns the database to the state it was in immediately after :djadmin:`syncdb`\n+was executed. This means that all data will be removed from the database, any\n post-synchronization handlers will be re-executed, and the ``initial_data``\n fixture will be re-installed.\n \n@@ -668,6 +668,7 @@ Example usage::\n \n .. versionadded:: 1.4\n \n+Since version 1.4, the development server is multithreaded by default.\n Use the ``--nothreading`` option to disable the use of threading in the\n development server.\n \n@@ -742,6 +743,24 @@ use the ``--plain`` option, like so::\n \n     django-admin.py shell --plain\n \n+.. versionchanged:: 1.5\n+\n+If you would like to specify either IPython or bpython as your interpreter if\n+you have both installed you can specify an alternative interpreter interface\n+with the ``-i`` or ``--interface`` options like so::\n+\n+IPython::\n+\n+    django-admin.py shell -i ipython\n+    django-admin.py shell --interface ipython\n+\n+\n+bpython::\n+\n+    django-admin.py shell -i bpython\n+    django-admin.py shell --interface bpython\n+\n+\n .. _IPython: http://ipython.scipy.org/\n .. _bpython: http://bpython-interpreter.org/\n \n@@ -887,7 +906,8 @@ through the template engine: the files whose extensions match the\n with the ``--name`` option. The :class:`template context\n <django.template.Context>` used is:\n \n-- Any option passed to the startapp command\n+- Any option passed to the startapp command (among the command's supported\n+  options)\n - ``app_name`` -- the app name as passed to the command\n - ``app_directory`` -- the full path of the newly created app\n "
        },
        {
            "sha": "082ec17a3510161c1cb5e73f272ecf8866471d39",
            "filename": "docs/ref/forms/fields.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fforms%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fforms%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Ffields.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -591,7 +591,11 @@ For each field, we describe the default widget used if you don't specify\n     * Error message keys: ``required``, ``invalid``, ``missing``, ``empty``,\n       ``invalid_image``\n \n-    Using an ImageField requires that the `Python Imaging Library`_ is installed.\n+    Using an ``ImageField`` requires that the `Python Imaging Library`_ (PIL)\n+    is installed and supports the image formats you use. If you encounter a\n+    ``corrupt image`` error when you upload an image, it usually means PIL\n+    doesn't understand its format. To fix this, install the appropriate\n+    library and reinstall PIL.\n \n     When you use an ``ImageField`` on a form, you must also remember to\n     :ref:`bind the file data to the form <binding-uploaded-files>`."
        },
        {
            "sha": "fb7657349aa9846f65f2fd56bc11e33bd0803135",
            "filename": "docs/ref/forms/widgets.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fforms%2Fwidgets.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fforms%2Fwidgets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fwidgets.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -75,7 +75,7 @@ changing :attr:`ChoiceField.choices` will update :attr:`Select.choices`. For\n example::\n \n     >>> from django import forms\n-    >>> CHOICES = (('1', 'First',), ('2', 'Second',)))\n+    >>> CHOICES = (('1', 'First',), ('2', 'Second',))\n     >>> choice_field = forms.ChoiceField(widget=forms.RadioSelect, choices=CHOICES)\n     >>> choice_field.choices\n     [('1', 'First'), ('2', 'Second')]"
        },
        {
            "sha": "5039ba4373d0e4fd9aa5b18a74f2eed79169162b",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1074,15 +1074,14 @@ the model is related. This works exactly the same as it does for\n Database Representation\n ~~~~~~~~~~~~~~~~~~~~~~~\n \n-Behind the scenes, Django creates an intermediary join table to\n-represent the many-to-many relationship. By default, this table name\n-is generated using the name of the many-to-many field and the model\n-that contains it. Since some databases don't support table names above\n-a certain length, these table names will be automatically truncated to\n-64 characters and a uniqueness hash will be used. This means you might\n-see table names like ``author_books_9cdf4``; this is perfectly normal.\n-You can manually provide the name of the join table using the\n-:attr:`~ManyToManyField.db_table` option.\n+Behind the scenes, Django creates an intermediary join table to represent the\n+many-to-many relationship. By default, this table name is generated using the\n+name of the many-to-many field and the name of the table for the model that\n+contains it. Since some databases don't support table names above a certain\n+length, these table names will be automatically truncated to 64 characters and a\n+uniqueness hash will be used. This means you might see table names like\n+``author_books_9cdf4``; this is perfectly normal.  You can manually provide the\n+name of the join table using the :attr:`~ManyToManyField.db_table` option.\n \n .. _manytomany-arguments:\n \n@@ -1138,8 +1137,9 @@ that control how the relationship functions.\n .. attribute:: ManyToManyField.db_table\n \n     The name of the table to create for storing the many-to-many data. If this\n-    is not provided, Django will assume a default name based upon the names of\n-    the two tables being joined.\n+    is not provided, Django will assume a default name based upon the names of:\n+    the table for the model defining the relationship and the name of the field\n+    itself.\n \n .. _ref-onetoone:\n "
        },
        {
            "sha": "509ea9d30e08dc668a592cc7f0240f64d9dd56e5",
            "filename": "docs/ref/models/instances.txt",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Finstances.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Finstances.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Finstances.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -25,6 +25,41 @@ The keyword arguments are simply the names of the fields you've defined on your\n model. Note that instantiating a model in no way touches your database; for\n that, you need to :meth:`~Model.save()`.\n \n+.. note::\n+\n+    You may be tempted to customize the model by overriding the ``__init__``\n+    method. If you do so, however, take care not to change the calling\n+    signature as any change may prevent the model instance from being saved.\n+    Rather than overriding ``__init__``, try using one of these approaches:\n+\n+    1. Add a classmethod on the model class::\n+\n+        class Book(models.Model):\n+            title = models.CharField(max_length=100)\n+\n+            @classmethod\n+            def create(cls, title):\n+                book = cls(title=title)\n+                # do something with the book\n+                return book\n+\n+        book = Book.create(\"Pride and Prejudice\")\n+\n+    2. Add a method on a custom manager (usually preferred)::\n+\n+        class BookManager(models.Manager):\n+            def create_book(title):\n+                book = self.create(title=title)\n+                # do something with the book\n+                return book\n+\n+        class Book(models.Model):\n+            title = models.CharField(max_length=100)\n+\n+            objects = BookManager()\n+\n+        book = Book.objects.create_book(\"Pride and Prejudice\")\n+\n .. _validating-objects:\n \n Validating objects\n@@ -604,4 +639,3 @@ described in :ref:`Field lookups <field-lookups>`.\n Note that in the case of identical date values, these methods will use the\n primary key as a tie-breaker. This guarantees that no records are skipped or\n duplicated. That also means you cannot use those methods on unsaved objects.\n-"
        },
        {
            "sha": "9d076f6274a58a71d58ea7d43b462b48bf904f11",
            "filename": "docs/ref/models/options.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Foptions.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Foptions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Foptions.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -244,12 +244,12 @@ Django quotes column and table names behind the scenes.\n \n         unique_together = ((\"driver\", \"restaurant\"),)\n \n-    This is a list of lists of fields that must be unique when considered together.\n+    This is a tuple of tuples that must be unique when considered together.\n     It's used in the Django admin and is enforced at the database level (i.e., the\n     appropriate ``UNIQUE`` statements are included in the ``CREATE TABLE``\n     statement).\n \n-    For convenience, unique_together can be a single list when dealing with a single\n+    For convenience, unique_together can be a single tuple when dealing with a single\n     set of fields::\n \n         unique_together = (\"driver\", \"restaurant\")"
        },
        {
            "sha": "8c188c67c3998ba8e04b347b7806804eb5fa2db1",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 14,
            "deletions": 33,
            "changes": 47,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1081,11 +1081,13 @@ to ``defer()``::\n     # Load all fields immediately.\n     my_queryset.defer(None)\n \n+.. versionchanged:: 1.5\n+\n Some fields in a model won't be deferred, even if you ask for them. You can\n never defer the loading of the primary key. If you are using\n :meth:`select_related()` to retrieve related models, you shouldn't defer the\n-loading of the field that connects from the primary model to the related one\n-(at the moment, that doesn't raise an error, but it will eventually).\n+loading of the field that connects from the primary model to the related\n+one, doing so will result in an error.\n \n .. note::\n \n@@ -1145,9 +1147,12 @@ logically::\n     # existing set of fields).\n     Entry.objects.defer(\"body\").only(\"headline\", \"body\")\n \n+.. versionchanged:: 1.5\n+\n All of the cautions in the note for the :meth:`defer` documentation apply to\n ``only()`` as well. Use it cautiously and only after exhausting your other\n-options.\n+options. Also note that using :meth:`only` and omitting a field requested\n+using :meth:`select_related` is an error as well.\n \n using\n ~~~~~\n@@ -1345,7 +1350,7 @@ has a side effect on your data. For more, see `Safe methods`_ in the HTTP spec.\n bulk_create\n ~~~~~~~~~~~\n \n-.. method:: bulk_create(objs)\n+.. method:: bulk_create(objs, batch_size=None)\n \n .. versionadded:: 1.4\n \n@@ -1367,20 +1372,12 @@ This has a number of caveats though:\n * If the model's primary key is an :class:`~django.db.models.AutoField` it\n   does not retrieve and set the primary key attribute, as ``save()`` does.\n \n-.. admonition:: Limits of SQLite\n-\n-    SQLite sets a limit on the number of parameters per SQL statement. The\n-    maximum is defined by the SQLITE_MAX_VARIABLE_NUMBER_ compilation option,\n-    which defaults to 999. For instance, if your model has 8 fields (including\n-    the primary key), you cannot create more than 999 // 8 = 124 instances at\n-    a time. If you exceed this limit, you'll get an exception::\n+The ``batch_size`` parameter controls how many objects are created in single\n+query. The default is to create all objects in one batch, except for SQLite\n+where the default is such that at maximum 999 variables per query is used.\n \n-        django.db.utils.DatabaseError: too many SQL variables\n-\n-    If your application's performance requirements exceed SQLite's limits, you\n-    should switch to another database engine, such as PostgreSQL.\n-\n-.. _SQLITE_MAX_VARIABLE_NUMBER: http://sqlite.org/limits.html#max_variable_number\n+.. versionadded:: 1.5\n+    The ``batch_size`` parameter was added in version 1.5.\n \n count\n ~~~~~\n@@ -1763,22 +1760,6 @@ This queryset will be evaluated as subselect statement::\n \n     SELECT ... WHERE blog.id IN (SELECT id FROM ... WHERE NAME LIKE '%Cheddar%')\n \n-The above code fragment could also be written as follows::\n-\n-    inner_q = Blog.objects.filter(name__contains='Cheddar').values('pk').query\n-    entries = Entry.objects.filter(blog__in=inner_q)\n-\n-.. warning::\n-\n-    This ``query`` attribute should be considered an opaque internal attribute.\n-    It's fine to use it like above, but its API may change between Django\n-    versions.\n-\n-This second form is a bit less readable and unnatural to write, since it\n-accesses the internal ``query`` attribute and requires a ``ValuesQuerySet``.\n-If your code doesn't require compatibility with Django 1.0, use the first\n-form, passing in a queryset directly.\n-\n If you pass in a ``ValuesQuerySet`` or ``ValuesListQuerySet`` (the result of\n calling ``values()`` or ``values_list()`` on a queryset) as the value to an\n ``__in`` lookup, you need to ensure you are only extracting one field in the"
        },
        {
            "sha": "551ee00c6b156fd604c77d10ddb9da41f89cfdc9",
            "filename": "docs/ref/request-response.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Frequest-response.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Frequest-response.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Frequest-response.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -606,27 +606,26 @@ Attributes\n Methods\n -------\n \n-.. method:: HttpResponse.__init__(content='', mimetype=None, status=200, content_type=DEFAULT_CONTENT_TYPE)\n+.. method:: HttpResponse.__init__(content='', content_type=None, status=200)\n \n-    Instantiates an ``HttpResponse`` object with the given page content (a\n-    string) and MIME type. The :setting:`DEFAULT_CONTENT_TYPE` is\n-    ``'text/html'``.\n+    Instantiates an ``HttpResponse`` object with the given page content and\n+    content type.\n \n     ``content`` should be an iterator or a string. If it's an\n     iterator, it should return strings, and those strings will be\n     joined together to form the content of the response. If it is not\n     an iterator or a string, it will be converted to a string when\n     accessed.\n \n+    ``content_type`` is the MIME type optionally completed by a character set\n+    encoding and is used to fill the HTTP ``Content-Type`` header. If not\n+    specified, it is formed by the :setting:`DEFAULT_CONTENT_TYPE` and\n+    :setting:`DEFAULT_CHARSET` settings, by default: \"`text/html; charset=utf-8`\".\n+\n+    Historically, this parameter was called ``mimetype`` (now deprecated).\n+\n     ``status`` is the `HTTP Status code`_ for the response.\n \n-    ``content_type`` is an alias for ``mimetype``. Historically, this parameter\n-    was only called ``mimetype``, but since this is actually the value included\n-    in the HTTP ``Content-Type`` header, it can also include the character set\n-    encoding, which makes it more than just a MIME type specification.\n-    If ``mimetype`` is specified (not ``None``), that value is used.\n-    Otherwise, ``content_type`` is used. If neither is given, the\n-    :setting:`DEFAULT_CONTENT_TYPE` setting is used.\n \n .. method:: HttpResponse.__setitem__(header, value)\n \n@@ -684,7 +683,7 @@ Methods\n       risk of client side script accessing the protected cookie\n       data.\n \n-    .. _HTTPOnly: http://www.owasp.org/index.php/HTTPOnly\n+    .. _HTTPOnly: https://www.owasp.org/index.php/HTTPOnly\n \n .. method:: HttpResponse.set_signed_cookie(key, value='', salt='', max_age=None, expires=None, path='/', domain=None, secure=None, httponly=True)\n "
        },
        {
            "sha": "72d60453c38181e1c4bf3f2f1ad3bcb7ac7699c3",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1675,7 +1675,7 @@ consistently by all browsers. However, when it is honored, it can be a\n useful way to mitigate the risk of client side script accessing the\n protected cookie data.\n \n-.. _HTTPOnly: http://www.owasp.org/index.php/HTTPOnly\n+.. _HTTPOnly: https://www.owasp.org/index.php/HTTPOnly\n \n .. versionchanged:: 1.4\n     The default value of the setting was changed from ``False`` to ``True``."
        },
        {
            "sha": "bd2b4c6e9d006d6e2ba5f76c8eeb4934c1e9b4fb",
            "filename": "docs/ref/templates/api.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Ftemplates%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Ftemplates%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fapi.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -370,6 +370,7 @@ and return a dictionary of items to be merged into the context. By default,\n     \"django.core.context_processors.i18n\",\n     \"django.core.context_processors.media\",\n     \"django.core.context_processors.static\",\n+    \"django.core.context_processors.tz\",\n     \"django.contrib.messages.context_processors.messages\")\n \n In addition to these, ``RequestContext`` always uses\n@@ -648,14 +649,24 @@ class. Here are the template loaders that come with Django:\n \n         INSTALLED_APPS = ('myproject.polls', 'myproject.music')\n \n-    ...then ``get_template('foo.html')`` will look for templates in these\n+    ...then ``get_template('foo.html')`` will look for ``foo.html`` in these\n     directories, in this order:\n \n-    * ``/path/to/myproject/polls/templates/foo.html``\n-    * ``/path/to/myproject/music/templates/foo.html``\n+    * ``/path/to/myproject/polls/templates/``\n+    * ``/path/to/myproject/music/templates/``\n \n-    Note that the loader performs an optimization when it is first imported: It\n-    caches a list of which :setting:`INSTALLED_APPS` packages have a\n+    ... and will use the one it finds first.\n+\n+    The order of :setting:`INSTALLED_APPS` is significant! For example, if you\n+    want to customize the Django admin, you might choose to override the\n+    standard ``admin/base_site.html`` template, from ``django.contrib.admin``,\n+    with your own ``admin/base_site.html`` in ``myproject.polls``. You must\n+    then make sure that your ``myproject.polls`` comes *before*\n+    ``django.contrib.admin`` in :setting:`INSTALLED_APPS`, otherwise\n+    ``django.contrib.admin``'s will be loaded first and yours will be ignored.\n+\n+    Note that the loader performs an optimization when it is first imported:\n+    it caches a list of which :setting:`INSTALLED_APPS` packages have a\n     ``templates`` subdirectory.\n \n     This loader is enabled by default.\n@@ -773,7 +784,7 @@ Using an alternative template language\n The Django ``Template`` and ``Loader`` classes implement a simple API for\n loading and rendering templates. By providing some simple wrapper classes that\n implement this API we can use third party template systems like `Jinja2\n-<http://jinja.pocoo.org/2/>`_ or `Cheetah <http://www.cheetahtemplate.org/>`_. This\n+<http://jinja.pocoo.org/docs/>`_ or `Cheetah <http://www.cheetahtemplate.org/>`_. This\n allows us to use third-party template libraries without giving up useful Django\n features like the Django ``Context`` object and handy shortcuts like\n :func:`~django.shortcuts.render_to_response()`."
        },
        {
            "sha": "500a47c6f1d329ed60a6f27e2f1e362d093619b1",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -419,7 +419,7 @@ will be interpreted like:\n \n     if (athlete_list and coach_list) or cheerleader_list\n \n-Use of actual brackets in the :ttag:`if` tag is invalid syntax.  If you need\n+Use of actual parentheses in the :ttag:`if` tag is invalid syntax.  If you need\n them to indicate precedence, you should use nested :ttag:`if` tags.\n \n :ttag:`if` tags may also use the operators ``==``, ``!=``, ``<``, ``>``,\n@@ -1047,12 +1047,12 @@ Django's syntax. For example::\n         {{if dying}}Still alive.{{/if}}\n     {% endverbatim %}\n \n-You can also specify an alternate closing tag::\n+You can also designate a specific closing tag, allowing the use of\n+``{% endverbatim %}`` as part of the unrendered contents::\n \n-    {% verbatim finished %}\n-        The verbatim tag looks like this:\n-        {% verbatim %}{% endverbatim %}\n-    {% finished %}\n+    {% verbatim myblock %}\n+        Avoid template rendering via the {% verbatim %}{% endverbatim %} block.\n+    {% endverbatim myblock %}\n \n .. templatetag:: widthratio\n \n@@ -2354,6 +2354,17 @@ It is also able to consume standard context variables, e.g. assuming a\n     {% load static %}\n     <link rel=\"stylesheet\" href=\"{% static user_stylesheet %}\" type=\"text/css\" media=\"screen\" />\n \n+If you'd like to retrieve a static URL without displaying it, you can use a\n+slightly different call::\n+\n+.. versionadded:: 1.5\n+\n+.. code-block:: html+django\n+\n+    {% load static %}\n+    {% static \"images/hi.jpg\" as myphoto %}\n+    <img src=\"{{ myphoto }}\"></img>\n+\n .. note::\n \n     The :mod:`staticfiles<django.contrib.staticfiles>` contrib app also ships"
        },
        {
            "sha": "c2f2025bc3d1cff7fe2a46e8f914045300409742",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 68,
            "deletions": 3,
            "changes": 71,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -112,10 +112,14 @@ to distinguish caches by the ``Accept-language`` header.\n \n     .. method:: insert(index, key, value)\n \n+        .. deprecated:: 1.5\n+\n         Inserts the key, value pair before the item with the given index.\n \n     .. method:: value_for_index(index)\n \n+        .. deprecated:: 1.5\n+\n         Returns the value of the item at the given zero-based index.\n \n Creating a new SortedDict\n@@ -246,13 +250,13 @@ For simplifying the selection of a generator use ``feedgenerator.DefaultFeed``\n which is currently ``Rss201rev2Feed``\n \n For definitions of the different versions of RSS, see:\n-http://diveintomark.org/archives/2004/02/04/incompatible-rss\n+http://web.archive.org/web/20110718035220/http://diveintomark.org/archives/2004/02/04/incompatible-rss\n \n .. function:: get_tag_uri(url, date)\n \n     Creates a TagURI.\n \n-    See http://diveintomark.org/archives/2004/05/28/howto-atom-id\n+    See http://web.archive.org/web/20110514113830/http://diveintomark.org/archives/2004/05/28/howto-atom-id\n \n SyndicationFeed\n ---------------\n@@ -330,7 +334,7 @@ Rss201rev2Feed\n \n .. class:: Rss201rev2Feed(RssFeed)\n \n-    Spec: http://blogs.law.harvard.edu/tech/rss\n+    Spec: http://cyber.law.harvard.edu/rss/rss.html\n \n RssUserland091Feed\n ------------------\n@@ -387,6 +391,67 @@ Atom1Feed\n     input is a proper string, then add support for lazy translation objects at the\n     end.\n \n+``django.utils.html``\n+=====================\n+\n+.. module:: django.utils.html\n+   :synopsis: HTML helper functions\n+\n+Usually you should build up HTML using Django's templates to make use of its\n+autoescape mechanism, using the utilities in :mod:`django.utils.safestring`\n+where appropriate. This module provides some additional low level utilitiesfor\n+escaping HTML.\n+\n+.. function:: escape(text)\n+\n+    Returns the given text with ampersands, quotes and angle brackets encoded\n+    for use in HTML. The input is first passed through\n+    :func:`~django.utils.encoding.force_unicode` and the output has\n+    :func:`~django.utils.safestring.mark_safe` applied.\n+\n+.. function:: conditional_escape(text)\n+\n+    Similar to ``escape()``, except that it doesn't operate on pre-escaped strings,\n+    so it will not double escape.\n+\n+.. function:: format_html(format_string, *args, **kwargs)\n+\n+    This is similar to `str.format`_, except that it is appropriate for\n+    building up HTML fragments. All args and kwargs are passed through\n+    :func:`conditional_escape` before being passed to ``str.format``.\n+\n+    For the case of building up small HTML fragments, this function is to be\n+    preferred over string interpolation using ``%`` or ``str.format`` directly,\n+    because it applies escaping to all arguments - just like the Template system\n+    applies escaping by default.\n+\n+    So, instead of writing:\n+\n+    .. code-block:: python\n+\n+        mark_safe(u\"%s <b>%s</b> %s\" % (some_html,\n+                                        escape(some_text),\n+                                        escape(some_other_text),\n+                                        ))\n+\n+    you should instead use:\n+\n+    .. code-block:: python\n+\n+        format_html(u\"%{0} <b>{1}</b> {2}\",\n+                    mark_safe(some_html), some_text, some_other_text)\n+\n+    This has the advantage that you don't need to apply :func:`escape` to each\n+    argument and risk a bug and an XSS vulnerability if you forget one.\n+\n+    Note that although this function uses ``str.format`` to do the\n+    interpolation, some of the formatting options provided by `str.format`_\n+    (e.g. number formatting) will not work, since all arguments are passed\n+    through :func:`conditional_escape` which (ultimately) calls\n+    :func:`~django.utils.encoding.force_unicode` on the values.\n+\n+\n+.. _str.format: http://docs.python.org/library/stdtypes.html#str.format\n \n ``django.utils.http``\n ====================="
        },
        {
            "sha": "288ac8fbc1f5d0540077032801aa1e40d5634277",
            "filename": "docs/releases/1.0-beta-2.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.0-beta-2.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.0-beta-2.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.0-beta-2.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -46,7 +46,7 @@ Refactored documentation\n     documentation files bundled with Django.\n \n .. _Sphinx: http://sphinx.pocoo.org/\n-.. _online: http://docs.djangoproject.com/en/dev/\n+.. _online: https://docs.djangoproject.com/\n \n Along with these new features, the Django team has also been hard at\n work polishing Django's codebase for the final 1.0 release; this beta"
        },
        {
            "sha": "d6d21afc019d3c7eb99359897786b983dc2861a7",
            "filename": "docs/releases/1.0.1.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.0.1.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.0.1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.0.1.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -18,7 +18,7 @@ Fixes and improvements in Django 1.0.1\n \n Django 1.0.1 contains over two hundred fixes to the original Django\n 1.0 codebase; full details of every fix are available in `the\n-Subversion log of the 1.0.X branch`_, but here are some of the\n+history of the 1.0.X branch`_, but here are some of the\n highlights:\n \n * Several fixes in ``django.contrib.comments``, pertaining to RSS\n@@ -61,4 +61,4 @@ highlights:\n   documentation, including both corrections to existing documents and\n   expanded and new documentation.\n \n-.. _the Subversion log of the 1.0.X branch: https://code.djangoproject.com/log/django/branches/releases/1.0.X\n+.. _the history of the 1.0.X branch: https://github.com/django/django/commits/stable/1.0.x"
        },
        {
            "sha": "1e44f57de88f1f0db7b3fd17889b85d84c1a0f6b",
            "filename": "docs/releases/1.0.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.0.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.0.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.0.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -57,7 +57,7 @@ there.\n In fact, new documentation is one of our favorite features of Django 1.0, so we\n might as well start there. First, there's a new documentation site:\n \n-* http://docs.djangoproject.com/\n+* https://docs.djangoproject.com/\n \n The documentation has been greatly improved, cleaned up, and generally made\n awesome. There's now dedicated search, indexes, and more."
        },
        {
            "sha": "852644dee4651646f6dff8ed7093a8680adaa065",
            "filename": "docs/releases/1.1.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.1.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.1.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.1.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -101,7 +101,7 @@ If you've been relying on this middleware, the easiest upgrade path is:\n * Introduce your modified version of ``SetRemoteAddrFromForwardedFor`` as a\n   piece of middleware in your own project.\n \n-__ https://code.djangoproject.com/browser/django/trunk/django/middleware/http.py?rev=11000#L33\n+__ https://github.com/django/django/blob/91f18400cc0fb37659e2dbaab5484ff2081f1f30/django/middleware/http.py#L33\n \n Names of uploaded files are available later\n -------------------------------------------\n@@ -366,7 +366,7 @@ features:\n For more details, see the `GeoDjango documentation`_.\n \n .. _geodjango: http://geodjango.org/\n-.. _spatialite: http://www.gaia-gis.it/spatialite/\n+.. _spatialite: http://www.gaia-gis.it/gaia-sins/\n .. _geodjango documentation: http://geodjango.org/docs/\n \n Other improvements"
        },
        {
            "sha": "772dbdb2e756c1d2944be6ca62a9e6f0536ebbc8",
            "filename": "docs/releases/1.3.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.3.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.3.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -329,7 +329,7 @@ requests. These include:\n * Support for combining :ref:`F() expressions <query-expressions>`\n   with timedelta values when retrieving or updating database values.\n \n-.. _HTTPOnly: http://www.owasp.org/index.php/HTTPOnly\n+.. _HTTPOnly: https://www.owasp.org/index.php/HTTPOnly\n \n .. _backwards-incompatible-changes-1.3:\n "
        },
        {
            "sha": "01532cc04c9f9c9c76a095f341c524e1ffd2a00f",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -37,7 +37,7 @@ Other notable new features in Django 1.4 include:\n   the ability to `bulk insert <#model-objects-bulk-create-in-the-orm>`_\n   large datasets for improved performance, and\n   `QuerySet.prefetch_related`_, a method to batch-load related objects\n-  in areas where :meth:`~django.db.models.QuerySet.select_related` does't\n+  in areas where :meth:`~django.db.models.QuerySet.select_related` doesn't\n   work.\n \n * Some nice security additions, including `improved password hashing`_\n@@ -1145,6 +1145,15 @@ field. This was something that should not have worked, and in 1.4 loading such\n incomplete fixtures will fail. Because fixtures are a raw import, they should\n explicitly specify all field values, regardless of field options on the model.\n \n+Development Server Multithreading\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The development server is now is multithreaded by default. Use the\n+:djadminopt:`--nothreading` option to disable the use of threading in the\n+development server::\n+\n+    django-admin.py runserver --nothreading\n+\n Attributes disabled in markdown when safe mode set\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n@@ -1338,4 +1347,3 @@ Versions of Python-Markdown earlier than 2.1 do not support the option to\n disable attributes. As a security issue, earlier versions of this library will\n not be supported by the markup contrib app in 1.5 under an accelerated\n deprecation timeline.\n-"
        },
        {
            "sha": "aae8b25e0749a62092c4b93efec42b28dd71bfa8",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 84,
            "deletions": 4,
            "changes": 88,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -16,7 +16,7 @@ features`_.\n Python compatibility\n ====================\n \n-Django 1.5 has dropped support for Python 2.5. Python 2.6 is now the minimum\n+Django 1.5 has dropped support for Python 2.5. Python 2.6.5 is now the minimum\n required Python version. Django is tested and supported on Python 2.6 and\n 2.7.\n \n@@ -27,8 +27,9 @@ Django 1.4 until you can upgrade your Python version. Per :doc:`our support poli\n </internals/release-process>`, Django 1.4 will continue to receive security\n support until the release of Django 1.6.\n \n-Django 1.5 does not run on Jython, because Jython doesn't currently offer any\n-version compatible with Python 2.6.\n+Django 1.5 does not run on a Jython final release, because Jython's latest release\n+doesn't currently support Python 2.6. However, Jython currently does offer an alpha\n+release featuring 2.7 support.\n \n What's new in Django 1.5\n ========================\n@@ -69,7 +70,7 @@ To make it easier to deal with javascript templates which collide with Django's\n syntax, you can now use the :ttag:`verbatim` block tag to avoid parsing the\n tag's content.\n \n-Retreival of ``ContentType`` instances associated with proxy models\n+Retrieval of ``ContentType`` instances associated with proxy models\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n The methods :meth:`ContentTypeManager.get_for_model() <django.contrib.contenttypes.models.ContentTypeManager.get_for_model()>`\n@@ -102,6 +103,14 @@ Django 1.5 also includes several smaller improvements worth noting:\n * In the localflavor for Canada, \"pq\" was added to the acceptable codes for\n   Quebec. It's an old abbreviation.\n \n+* The :ref:`receiver <connecting-receiver-functions>` decorator is now able to\n+  connect to more than one signal by supplying a list of signals.\n+\n+* :meth:`QuerySet.bulk_create()\n+  <django.db.models.query.QuerySet.bulk_create>` has now a batch_size\n+  argument. By default the batch_size is unlimited except for SQLite where\n+  single batch is limited so that 999 parameters per query isn't exceeded.\n+\n Backwards incompatible changes in 1.5\n =====================================\n \n@@ -164,6 +173,77 @@ number was inside the existing page range.\n It does check it now and raises an :exc:`InvalidPage` exception when the number\n is either too low or too high.\n \n+Behavior of autocommit database option on PostgreSQL changed\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+PostgreSQL's autocommit option didn't work as advertised previously. It did\n+work for single transaction block, but after the first block was left the\n+autocommit behavior was never restored. This bug is now fixed in 1.5. While\n+this is only a bug fix, it is worth checking your applications behavior if\n+you are using PostgreSQL together with the autocommit option.\n+\n+Session not saved on 500 responses\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django's session middleware will skip saving the session data if the\n+response's status code is 500.\n+\n+Changes in tests execution\n+~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Some changes have been introduced in the execution of tests that might be\n+backward-incompatible for some testing setups:\n+\n+Database flushing in ``django.test.TransactionTestCase``\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+Previously, the test database was truncated *before* each test run in a\n+:class:`~django.test.TransactionTestCase`.\n+\n+In order to be able to run unit tests in any order and to make sure they are\n+always isolated from each other, :class:`~django.test.TransactionTestCase` will\n+now reset the database *after* each test run instead.\n+\n+No more implict DB sequences reset\n+^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+\n+:class:`~django.test.TransactionTestCase` tests used to reset primary key\n+sequences automatically together with the database flushing actions described\n+above.\n+\n+This has been changed so no sequences are implicitly reset. This can cause\n+:class:`~django.test.TransactionTestCase` tests that depend on hard-coded\n+primary key values to break.\n+\n+The new :attr:`~django.test.TransactionTestCase.reset_sequences` attribute can\n+be used to force the old behavior for :class:`~django.test.TransactionTestCase`\n+that might need it.\n+\n+Ordering of tests\n+^^^^^^^^^^^^^^^^^\n+\n+In order to make sure all ``TestCase`` code starts with a clean database,\n+tests are now executed in the following order:\n+\n+* First, all unittests (including :class:`unittest.TestCase`,\n+  :class:`~django.test.SimpleTestCase`, :class:`~django.test.TestCase` and\n+  :class:`~django.test.TransactionTestCase`) are run with no particular ordering\n+  guaranteed nor enforced among them.\n+\n+* Then any other tests (e.g. doctests) that may alter the database without\n+  restoring it to its original state are run.\n+\n+This should not cause any problems unless you have existing doctests which\n+assume a :class:`~django.test.TransactionTestCase` executed earlier left some\n+database state behind or unit tests that rely on some form of state being\n+preserved after the execution of other tests. Such tests are already very\n+fragile, and must now be changed to be able to run independently.\n+\n+Miscellaneous\n+~~~~~~~~~~~~~\n+\n+* GeoDjango dropped support for GDAL < 1.5\n+\n Features deprecated in 1.5\n ==========================\n "
        },
        {
            "sha": "0d4cb6244d6d4dc330f730e4b283c9c64fa5c647",
            "filename": "docs/topics/class-based-views/generic-display.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fclass-based-views%2Fgeneric-display.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fclass-based-views%2Fgeneric-display.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Fgeneric-display.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -157,7 +157,7 @@ might look like the following::\n That's really all there is to it. All the cool features of generic views come\n from changing the attributes set on the generic view. The\n :doc:`generic views reference</ref/class-based-views/index>` documents all the\n-generic views and their options in detail; the rest of this document will \n+generic views and their options in detail; the rest of this document will\n consider some of the common ways you might customize and extend generic views.\n \n \n@@ -220,7 +220,7 @@ more::\n \n         def get_context_data(self, **kwargs):\n             # Call the base implementation first to get a context\n-            context = super(PublisherDetailView, self).get_context_data(**kwargs)\n+            context = super(PublisherDetail, self).get_context_data(**kwargs)\n             # Add in a QuerySet of all the books\n             context['book_list'] = Book.objects.all()\n             return context\n@@ -284,7 +284,7 @@ technique::\n     from django.views.generic import ListView\n     from books.models import Book\n \n-    class AcmeBookListView(ListView):\n+    class AcmeBookList(ListView):\n \n         context_object_name = 'book_list'\n         queryset = Book.objects.filter(publisher__name='Acme Publishing')\n@@ -361,7 +361,7 @@ use it in the template::\n \n         def get_context_data(self, **kwargs):\n             # Call the base implementation first to get a context\n-            context = super(PublisherBookListView, self).get_context_data(**kwargs)\n+            context = super(PublisherBookList, self).get_context_data(**kwargs)\n             # Add in the publisher\n             context['publisher'] = self.publisher\n             return context\n@@ -397,7 +397,7 @@ custom view::\n \n     urlpatterns = patterns('',\n         #...\n-        url(r'^authors/(?P<pk>\\\\d+)/$', AuthorDetailView.as_view(), name='author-detail'),\n+        url(r'^authors/(?P<pk>\\d+)/$', AuthorDetailView.as_view(), name='author-detail'),\n     )\n \n Then we'd write our new view -- ``get_object`` is the method that retrieves the"
        },
        {
            "sha": "6c2848944c815c9e850b2aec0b4e357f18d1e4db",
            "filename": "docs/topics/class-based-views/index.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Findex.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -93,13 +93,13 @@ conversion to JSON once.\n For example, a simple JSON mixin might look something like this::\n \n     import json\n-    from django import http\n+    from django.http import HttpResponse\n \n     class JSONResponseMixin(object):\n         \"\"\"\n         A mixin that can be used to render a JSON response.\n         \"\"\"\n-        reponse_class = HTTPResponse\n+        response_class = HttpResponse\n \n         def render_to_response(self, context, **response_kwargs):\n             \"\"\""
        },
        {
            "sha": "ce15dc95358d1dca5f938ecf1c667bd3ed5b9d5c",
            "filename": "docs/topics/db/models.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fdb%2Fmodels.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fdb%2Fmodels.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fmodels.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -384,7 +384,8 @@ Extra fields on many-to-many relationships\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n When you're only dealing with simple many-to-many relationships such as\n-mixing and matching pizzas and toppings, a standard :class:`~django.db.models.ManyToManyField` is all you need. However, sometimes\n+mixing and matching pizzas and toppings, a standard\n+:class:`~django.db.models.ManyToManyField` is all you need. However, sometimes\n you may need to associate data with the relationship between two models.\n \n For example, consider the case of an application tracking the musical groups"
        },
        {
            "sha": "99283546642932716c7d0440d79d65789b83b405",
            "filename": "docs/topics/db/transactions.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fdb%2Ftransactions.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fdb%2Ftransactions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Ftransactions.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -54,6 +54,13 @@ The various cache middlewares are an exception:\n Even when using database caching, Django's cache backend uses its own\n database cursor (which is mapped to its own database connection internally).\n \n+.. note::\n+\n+    The ``TransactionMiddleware`` only affects the database aliased\n+    as \"default\" within your :setting:`DATABASES` setting.  If you are using\n+    multiple databases and want transaction control over databases other than\n+    \"default\", you will need to write your own transaction middleware.\n+\n .. _transaction-management-functions:\n \n Controlling transaction management in views"
        },
        {
            "sha": "0cc476e02c67ff986aff5f6674199401511052a7",
            "filename": "docs/topics/email.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Femail.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Femail.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Femail.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -192,7 +192,7 @@ from the request's POST data, sends that to admin@example.com and redirects to\n             # to get proper validation errors.\n             return HttpResponse('Make sure all fields are entered and valid.')\n \n-.. _Header injection: http://www.nyphp.org/phundamentals/email_header_injection.php\n+.. _Header injection: http://www.nyphp.org/phundamentals/8_Preventing-Email-Header-Injection\n \n .. _emailmessage-and-smtpconnection:\n "
        },
        {
            "sha": "c9b4327941f67bdace837ace86797f8c1df16054",
            "filename": "docs/topics/files.txt",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Ffiles.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Ffiles.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ffiles.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -75,6 +75,29 @@ using a Python built-in ``file`` object::\n Now you can use any of the documented attributes and methods\n of the :class:`~django.core.files.File` class.\n \n+Be aware that files created in this way are not automatically closed.\n+The following approach may be used to close files automatically::\n+\n+    >>> from django.core.files import File\n+\n+    # Create a Python file object using open() and the with statement\n+    >>> with open('/tmp/hello.world', 'w') as f:\n+    >>>     myfile = File(f)\n+    >>>     for line in myfile:\n+    >>>         print line\n+    >>> myfile.closed\n+    True\n+    >>> f.closed\n+    True\n+\n+Closing files is especially important when accessing file fields in a loop\n+over a large number of objects:: If files are not manually closed after\n+accessing them, the risk of running out of file descriptors may arise. This\n+may lead to the following error:\n+\n+    IOError: [Errno 24] Too many open files\n+\n+\n File storage\n ============\n "
        },
        {
            "sha": "4693de6c7eb9e2c4df993f752463118610a9f1a6",
            "filename": "docs/topics/forms/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fforms%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fforms%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Findex.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -91,6 +91,9 @@ The standard pattern for processing a form in a view looks like this:\n \n .. code-block:: python\n \n+   from django.shortcuts import render\n+   from django.http import HttpResponseRedirect\n+\n    def contact(request):\n        if request.method == 'POST': # If the form has been submitted...\n            form = ContactForm(request.POST) # A form bound to the POST data"
        },
        {
            "sha": "4cfde400a70a5cf6211cebf61e17980fd323a519",
            "filename": "docs/topics/forms/modelforms.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmodelforms.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -877,7 +877,8 @@ of a model. Here's how you can do that::\n             formset = BookInlineFormSet(request.POST, request.FILES, instance=author)\n             if formset.is_valid():\n                 formset.save()\n-                # Do something.\n+                # Do something. Should generally end with a redirect. For example:\n+                return HttpResponseRedirect(author.get_absolute_url())\n         else:\n             formset = BookInlineFormSet(instance=author)\n         return render_to_response(\"manage_books.html\", {"
        },
        {
            "sha": "fe92bc59a9d8d35119e4a9b1154e6f9f890c2a30",
            "filename": "docs/topics/http/middleware.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Fmiddleware.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Fmiddleware.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fmiddleware.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -199,7 +199,8 @@ of caveats:\n   define ``__init__`` as requiring any arguments.\n \n * Unlike the ``process_*`` methods which get called once per request,\n-  ``__init__`` gets called only *once*, when the Web server starts up.\n+  ``__init__`` gets called only *once*, when the Web server responds to the\n+  first request.\n \n Marking middleware as unused\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
        },
        {
            "sha": "1f55293413bb5ea884db301174b5419b8eae73bf",
            "filename": "docs/topics/http/sessions.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Fsessions.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fsessions.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -423,6 +423,9 @@ cookie will be sent on every request.\n Similarly, the ``expires`` part of a session cookie is updated each time the\n session cookie is sent.\n \n+.. versionchanged:: 1.5\n+  The session is not saved if the response's status code is 500.\n+\n Browser-length sessions vs. persistent sessions\n ===============================================\n \n@@ -521,7 +524,7 @@ consistently by all browsers. However, when it is honored, it can be a\n useful way to mitigate the risk of client side script accessing the\n protected cookie data.\n \n-.. _HTTPOnly: http://www.owasp.org/index.php/HTTPOnly\n+.. _HTTPOnly: https://www.owasp.org/index.php/HTTPOnly\n \n SESSION_COOKIE_NAME\n -------------------"
        },
        {
            "sha": "10be353e80d293bcf5c38c3654c0dba0620743a6",
            "filename": "docs/topics/http/shortcuts.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Fshortcuts.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Fshortcuts.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Fshortcuts.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -15,7 +15,7 @@ introduce controlled coupling for convenience's sake.\n ``render``\n ==========\n \n-.. function:: render(request, template[, dictionary][, context_instance][, content_type][, status][, current_app])\n+.. function:: render(request, template_name[, dictionary][, context_instance][, content_type][, status][, current_app])\n \n    .. versionadded:: 1.3\n \n@@ -32,7 +32,7 @@ Required arguments\n ``request``\n     The request object used to generate this response.\n \n-``template``\n+``template_name``\n     The full name of a template to use or sequence of template names.\n \n Optional arguments"
        },
        {
            "sha": "4e75dfe55f208a11e6e05b2e4b845b605e5a2dae",
            "filename": "docs/topics/http/urls.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Furls.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fhttp%2Furls.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fhttp%2Furls.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -704,8 +704,8 @@ target each pattern individually by using its name:\n \n .. code-block:: html+django\n \n-    {% url arch-summary 1945 %}\n-    {% url full-archive 2007 %}\n+    {% url 'arch-summary' 1945 %}\n+    {% url 'full-archive' 2007 %}\n \n Even though both URL patterns refer to the ``archive`` view here, using the\n ``name`` parameter to ``url()`` allows you to tell them apart in templates."
        },
        {
            "sha": "f3bb13ab0350769c1abefbc946bd088129032028",
            "filename": "docs/topics/i18n/timezones.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fi18n%2Ftimezones.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fi18n%2Ftimezones.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Ftimezones.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -509,7 +509,7 @@ Setup\n    Finally, our calendar system contains interesting traps for computers::\n \n        >>> import datetime\n-       >>> def substract_one_year(value):       # DON'T DO THAT!\n+       >>> def one_year_before(value):       # DON'T DO THAT!\n        ...     return value.replace(year=value.year - 1)\n        >>> one_year_before(datetime.datetime(2012, 3, 1, 10, 0))\n        datetime.datetime(2011, 3, 1, 10, 0)"
        },
        {
            "sha": "c912bf95755d88153c332da130c2eb226af938be",
            "filename": "docs/topics/i18n/translation.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fi18n%2Ftranslation.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fi18n%2Ftranslation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Ftranslation.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -596,7 +596,7 @@ apply.\n Reverse URL lookups cannot be carried out within the ``blocktrans`` and should\n be retrieved (and stored) beforehand::\n \n-    {% url path.to.view arg arg2 as the_url %}\n+    {% url 'path.to.view' arg arg2 as the_url %}\n     {% blocktrans %}\n     This is a URL: {{ the_url }}\n     {% endblocktrans %}\n@@ -790,7 +790,7 @@ To use the catalog, just pull in the dynamically generated script like this:\n \n .. code-block:: html+django\n \n-    <script type=\"text/javascript\" src=\"{% url django.views.i18n.javascript_catalog %}\"></script>\n+    <script type=\"text/javascript\" src=\"{% url 'django.views.i18n.javascript_catalog' %}\"></script>\n \n This uses reverse URL lookup to find the URL of the JavaScript catalog view.\n When the catalog is loaded, your JavaScript code can use the standard\n@@ -890,7 +890,7 @@ prepend the current active language code to all url patterns defined within\n \n     urlpatterns += i18n_patterns('',\n         url(r'^about/$', 'about.view', name='about'),\n-        url(r'^news/$', include(news_patterns, namespace='news')),\n+        url(r'^news/', include(news_patterns, namespace='news')),\n     )\n \n \n@@ -945,7 +945,7 @@ URL patterns can also be marked translatable using the\n \n     urlpatterns += i18n_patterns('',\n         url(_(r'^about/$'), 'about.view', name='about'),\n-        url(_(r'^news/$'), include(news_patterns, namespace='news')),\n+        url(_(r'^news/'), include(news_patterns, namespace='news')),\n     )\n \n \n@@ -992,7 +992,7 @@ template tag. It enables the given language in the enclosed template section:\n     {% trans \"View this category in:\" %}\n     {% for lang_code, lang_name in languages %}\n         {% language lang_code %}\n-        <a href=\"{% url category slug=category.slug %}\">{{ lang_name }}</a>\n+        <a href=\"{% url 'category' slug=category.slug %}\">{{ lang_name }}</a>\n         {% endlanguage %}\n     {% endfor %}\n "
        },
        {
            "sha": "a11a44baa1b68a9e31645a0f893c15b1db1fe663",
            "filename": "docs/topics/install.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Finstall.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -9,7 +9,7 @@ Install Python\n \n Being a Python Web framework, Django requires Python.\n \n-It works with any Python version from 2.6 to 2.7 (due to backwards\n+It works with any Python version from 2.6.5 to 2.7 (due to backwards\n incompatibilities in Python 3.0, Django does not currently work with\n Python 3.0; see :doc:`the Django FAQ </faq/install>` for more\n information on supported Python versions and the 3.0 transition).\n@@ -62,15 +62,15 @@ for information on how to configure mod_wsgi once you have it\n installed.\n \n If you can't use mod_wsgi for some reason, fear not: Django supports many other\n-deployment options. One is :doc:`uWSGI </howto/deployment/fastcgi>`; it works\n+deployment options. One is :doc:`uWSGI </howto/deployment/wsgi/uwsgi>`; it works\n very well with `nginx`_. Another is :doc:`FastCGI </howto/deployment/fastcgi>`,\n perfect for using Django with servers other than Apache. Additionally, Django\n follows the WSGI spec (:pep:`3333`), which allows it to run on a variety of\n server platforms. See the `server-arrangements wiki page`_ for specific\n installation instructions for each platform.\n \n .. _Apache: http://httpd.apache.org/\n-.. _nginx: http://nginx.net/\n+.. _nginx: http://nginx.org/\n .. _mod_wsgi: http://code.google.com/p/modwsgi/\n .. _server-arrangements wiki page: https://code.djangoproject.com/wiki/ServerArrangements\n "
        },
        {
            "sha": "a878d42266daa70ff1abb0f2990e48395307a7b4",
            "filename": "docs/topics/logging.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Flogging.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Flogging.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Flogging.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -209,8 +209,8 @@ By default, Django uses the `dictConfig format`_.\n     ``logging.dictConfig`` is a builtin library in Python 2.7. In\n     order to make this library available for users of earlier Python\n     versions, Django includes a copy as part of ``django.utils.log``.\n-    If you have Python 2.7, the system native library will be used; if\n-    you have Python 2.6 or earlier, Django's copy will be used.\n+    If you have Python 2.7 or later, the system native library will be used; if\n+    you have Python 2.6, Django's copy will be used.\n \n In order to configure logging, you use :setting:`LOGGING` to define a\n dictionary of logging settings. These settings describes the loggers,"
        },
        {
            "sha": "3f799edac77b85a30ccb008caa916f3545882109",
            "filename": "docs/topics/python3.txt",
            "status": "modified",
            "additions": 84,
            "deletions": 199,
            "changes": 283,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fpython3.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fpython3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fpython3.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,251 +2,136 @@\n Python 3 compatibility\n ======================\n \n-Django 1.5 introduces a compatibility layer that allows the code to be run both\n-in Python 2 (2.6/2.7) and Python 3 (>= 3.2) (*work in progress*).\n+Django 1.5 is the first version of Django to support Python 3. The same code\n+runs both on Python 2 (≥ 2.6.5) and Python 3 (≥ 3.2), thanks to the six_\n+compatibility layer and ``unicode_literals``.\n \n-This document is not meant as a complete Python 2 to Python 3 migration guide.\n-There are many existing resources you can read. But we describe some utilities\n-and guidelines that we recommend you should use when you want to ensure your\n-code can be run with both Python 2 and 3.\n+.. _six: http://packages.python.org/six/\n \n-* http://docs.python.org/py3k/howto/pyporting.html\n-* http://python3porting.com/\n+This document is not meant as a Python 2 to Python 3 migration guide. There\n+are many existing resources, including `Python's official porting guide`_.\n+Rather, it describes guidelines that apply to Django's code and are\n+recommended for pluggable apps that run with both Python 2 and 3.\n \n-django.utils.py3\n-================\n+.. _Python's official porting guide: http://docs.python.org/py3k/howto/pyporting.html\n \n-Whenever a symbol or module has different semantics or different locations on\n-Python 2 and Python 3, you can import it from ``django.utils.py3`` where it\n-will be automatically converted depending on your current Python version.\n+Syntax requirements\n+===================\n \n-PY3\n----\n-\n-If you need to know anywhere in your code if you are running Python 3 or a\n-previous Python 2 version, you can check the ``PY3`` boolean variable::\n-\n-    from django.utils.py3 import PY3\n+Unicode\n+-------\n \n-    if PY3:\n-        # Do stuff Python 3-wise\n-    else:\n-        # Do stuff Python 2-wise\n-\n-This should be considered as a last resort solution when it is not possible\n-to import a compatible name from django.utils.py3, as described in the sections\n-below.\n+In Python 3, all strings are considered Unicode by default. The ``unicode``\n+type from Python 2 is called ``str`` in Python 3, and ``str`` becomes\n+``bytes``.\n \n-String handling\n-===============\n+You mustn't use the ``u`` prefix before a unicode string literal because it's\n+a syntax error in Python 3.2. You must prefix byte strings with ``b``.\n \n-In Python 3, all strings are considered Unicode strings by default. Byte strings\n-have to be prefixed with the letter 'b'. To mimic the same behaviour in Python 2,\n-we recommend you import ``unicode_literals`` from the ``__future__`` library::\n+In order to enable the same behavior in Python 2, every module must import\n+``unicode_literals`` from ``__future__``::\n \n     from __future__ import unicode_literals\n \n     my_string = \"This is an unicode literal\"\n     my_bytestring = b\"This is a bytestring\"\n \n-Be cautious if you have to slice bytestrings.\n-See http://docs.python.org/py3k/howto/pyporting.html#bytes-literals\n-\n-Different expected strings\n---------------------------\n-\n-Some method parameters have changed the expected string type of a parameter.\n-For example, ``strftime`` format parameter expects a bytestring on Python 2 but\n-a normal (Unicode) string on Python 3. For these cases, ``django.utils.py3``\n-provides a ``n()`` function which encodes the string parameter only with\n-Python 2.\n-\n-    >>> from __future__ import unicode_literals\n-    >>> from datetime import datetime\n-\n-    >>> print(datetime.date(2012, 5, 21).strftime(n(\"%m → %Y\")))\n-    05 → 2012\n-\n-Renamed types\n-=============\n-\n-Several types are named differently in Python 2 and Python 3. In order to keep\n-compatibility while using those types, import their corresponding aliases from\n-``django.utils.py3``.\n-\n-===========  =========  =====================\n-Python 2     Python 3   django.utils.py3\n-===========  =========  =====================\n-basestring,  str,       string_types (tuple)\n-unicode      str        text_type\n-int, long    int,       integer_types (tuple)\n-long         int        long_type\n-===========  =========  =====================\n-\n-String aliases\n---------------\n-\n-Code sample::\n+Be cautious if you have to `slice bytestrings`_.\n \n-    if isinstance(foo, basestring):\n-        print(\"foo is a string\")\n+.. _slice bytestrings: http://docs.python.org/py3k/howto/pyporting.html#bytes-literals\n \n-    # I want to convert a number to a Unicode string\n-    bar = 45\n-    bar_string = unicode(bar)\n+Exceptions\n+----------\n \n-Should be replaced by::\n+When you capture exceptions, use the ``as`` keyword::\n \n-    from django.utils.py3 import string_types, text_type\n-\n-    if isinstance(foo, string_types):\n-        print(\"foo is a string\")\n-\n-    # I want to convert a number to a Unicode string\n-    bar = 45\n-    bar_string = text_type(bar)\n-\n-No more long type\n------------------\n-\n-``long`` and ``int`` types have been unified in Python 3, meaning that  ``long``\n-is no longer available. ``django.utils.py3`` provides both ``long_type`` and\n-``integer_types`` aliases. For example:\n-\n-.. code-block:: python\n+    try:\n+        ...\n+    except MyException as exc:\n+        ...\n \n-    # Old Python 2 code\n-    my_var = long(333463247234623)\n-    if isinstance(my_var, (int, long)):\n-        # ...\n+This older syntax was removed in Python 3::\n \n-Should be replaced by:\n+    try:\n+        ...\n+    except MyException, exc:\n+        ...\n \n-.. code-block:: python\n+The syntax to reraise an exception with a different traceback also changed.\n+Use :func:`six.reraise`.\n \n-    from django.utils.py3 import long_type, integer_types\n \n-    my_var = long_type(333463247234623)\n-    if isinstance(my_var, integer_types):\n-        # ...\n+.. module: django.utils.six\n \n+Writing compatible code with six\n+================================\n \n-Changed module locations\n-========================\n+six_ is the canonical compatibility library for supporting Python 2 and 3 in\n+a single codebase. Read its documentation!\n \n-The following modules have changed their location in Python 3. Therefore, it is\n-recommended to import them from the ``django.utils.py3`` compatibility layer:\n+:mod:`six` is bundled with Django: you can import it as :mod:`django.utils.six`.\n \n-=============================== ======================================  ======================\n-Python 2                        Python3                                 django.utils.py3\n-=============================== ======================================  ======================\n-Cookie                          http.cookies                            cookies\n+Here are the most common changes required to write compatible code.\n \n-urlparse.urlparse               urllib.parse.urlparse                   urlparse\n-urlparse.urlunparse             urllib.parse.urlunparse                 urlunparse\n-urlparse.urljoin                urllib.parse.urljoin                    urljoin\n-urlparse.urlsplit               urllib.parse.urlsplit                   urlsplit\n-urlparse.urlunsplit             urllib.parse.urlunsplit                 urlunsplit\n-urlparse.urldefrag              urllib.parse.urldefrag                  urldefrag\n-urlparse.parse_qsl              urllib.parse.parse_qsl                  parse_qsl\n-urllib.quote                    urllib.parse.quote                      quote\n-urllib.unquote                  urllib.parse.unquote                    unquote\n-urllib.quote_plus               urllib.parse.quote_plus                 quote_plus\n-urllib.unquote_plus             urllib.parse.unquote_plus               unquote_plus\n-urllib.urlencode                urllib.parse.urlencode                  urlencode\n-urllib.urlopen                  urllib.request.urlopen                  urlopen\n-urllib.url2pathname             urllib.request.url2pathname             url2pathname\n-urllib.urlretrieve              urllib.request.urlretrieve              urlretrieve\n-urllib2                         urllib.request                          urllib2\n-urllib2.Request                 urllib.request.Request                  Request\n-urllib2.OpenerDirector          urllib.request.OpenerDirector           OpenerDirector\n-urllib2.UnknownHandler          urllib.request.UnknownHandler           UnknownHandler\n-urllib2.HTTPHandler             urllib.request.HTTPHandler              HTTPHandler\n-urllib2.HTTPSHandler            urllib.request.HTTPSHandler             HTTPSHandler\n-urllib2.HTTPDefaultErrorHandler urllib.request.HTTPDefaultErrorHandler  HTTPDefaultErrorHandler\n-urllib2.FTPHandler              urllib.request.FTPHandler               FTPHandler\n-urllib2.HTTPError               urllib.request.HTTPError                HTTPError\n-urllib2.HTTPErrorProcessor      urllib.request.HTTPErrorProcessor       HTTPErrorProcessor\n+String types\n+------------\n \n-htmlentitydefs.name2codepoint   html.entities.name2codepoint            name2codepoint\n-HTMLParser                      html.parser                             HTMLParser\n-cPickle/pickle                  pickle                                  pickle\n-thread/dummy_thread             _thread/_dummy_thread                   thread\n+The ``basestring`` and ``unicode`` types were removed in Python 3, and the\n+meaning of ``str`` changed. To test these types, use the following idioms::\n \n-os.getcwdu                      os.getcwd                               getcwdu\n-itertools.izip                  zip                                     zip\n-sys.maxint                      sys.maxsize                             maxsize\n-unichr                          chr                                     unichr\n-xrange                          range                                   xrange\n-=============================== ======================================  ======================\n+    isinstance(myvalue, six.string_types)       # replacement for basestring\n+    isinstance(myvalue, six.text_type)          # replacement for unicode\n+    isinstance(myvalue, bytes)                  # replacement for str\n \n+Python ≥ 2.6 provides ``bytes`` as an alias for ``str``, so you don't need\n+:attr:`six.binary_type`.\n \n-Ouptut encoding now Unicode\n-===========================\n+``long``\n+--------\n \n-If you want to catch stdout/stderr output, the output content is UTF-8 encoded\n-in Python 2, while it is Unicode strings in Python 3. You can use the OutputIO\n-stream to capture this output::\n+The ``long`` type no longer exists in Python 3. ``1L`` is a syntax error. Use\n+:data:`six.integer_types` check if a value is an integer or a long::\n \n-    from django.utils.py3 import OutputIO\n+    isinstance(myvalue, six.integer_types)      # replacement for (int, long)\n \n-    try:\n-        old_stdout = sys.stdout\n-        out = OutputIO()\n-        sys.stdout = out\n-        # Do stuff which produces standard output\n-        result = out.getvalue()\n-    finally:\n-        sys.stdout = old_stdout\n+``xrange``\n+----------\n \n-Dict iteritems/itervalues/iterkeys\n-==================================\n+Import :func:`six.moves.xrange` wherever you use ``xrange``.\n \n-The iteritems(), itervalues() and iterkeys() methods of dictionaries do not\n-exist any more in Python 3, simply because they represent the default items()\n-values() and keys() behavior in Python 3. Therefore, to keep compatibility,\n-use similar functions from ``django.utils.py3``::\n+Moved modules\n+-------------\n \n-    from django.utils.py3 import iteritems, itervalues, iterkeys\n+Some modules were renamed in Python 3. The :mod:`django.utils.six.moves\n+<six.moves>` module provides a compatible location to import them.\n \n-    my_dict = {'a': 21, 'b': 42}\n-    for key, value in iteritems(my_dict):\n-        # ...\n-    for value in itervalues(my_dict):\n-        # ...\n-    for key in iterkeys(my_dict):\n-        # ...\n+In addition to six' defaults, Django's version provides ``dummy_thread`` as\n+``_dummy_thread``.\n \n-Note that in Python 3, dict.keys(), dict.items() and dict.values() return\n-\"views\" instead of lists. Wrap them into list() if you really need their return\n-values to be in a list.\n-\n-http://docs.python.org/release/3.0.1/whatsnew/3.0.html#views-and-iterators-instead-of-lists\n+PY3\n+---\n \n-Metaclass\n-=========\n+If you need different code in Python 2 and Python 3, check :data:`six.PY3`::\n \n-The syntax for declaring metaclasses has changed in Python 3.\n-``django.utils.py3`` offers a compatible way to declare metaclasses::\n+    if six.PY3:\n+        # do stuff Python 3-wise\n+    else:\n+        # do stuff Python 2-wise\n \n-    from django.utils.py3 import with_metaclass\n+This is a last resort solution when :mod:`six` doesn't provide an appropriate\n+function.\n \n-    class MyClass(with_metaclass(SubClass1, SubClass2,...)):\n-        # ...\n+.. module:: django.utils.six\n \n-Re-raising exceptions\n+Customizations of six\n =====================\n \n-One of the syntaxes to raise exceptions (raise E, V, T) is gone in Python 3.\n-This is especially used in very specific cases where you want to re-raise a\n-different exception that the initial one, while keeping the original traceback.\n-So, instead of::\n-\n-    raise Exception, Exception(msg), traceback\n-\n-Use::\n-\n-    from django.utils.py3 import reraise\n+The version of six bundled with Django includes a few additional tools:\n \n-    reraise(Exception, Exception(msg), traceback)\n+.. function:: iterlists(MultiValueDict)\n \n+    Returns an iterator over the lists of values of a\n+    :class:`~django.utils.datastructures.MultiValueDict`. This replaces\n+    :meth:`~django.utils.datastructures.MultiValueDict.iterlists()` on Python\n+    2 and :meth:`~django.utils.datastructures.MultiValueDict.lists()` on\n+    Python 3."
        },
        {
            "sha": "db1bcb03df8236b9f3216faa769e86a034bd0e30",
            "filename": "docs/topics/signals.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fsignals.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Fsignals.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fsignals.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -52,10 +52,10 @@ called when the signal is sent by using the\n :meth:`.Signal.connect` method:\n \n .. method:: Signal.connect(receiver, [sender=None, weak=True, dispatch_uid=None])\n-    \n+\n     :param receiver: The callback function which will be connected to this\n         signal. See :ref:`receiver-functions` for more information.\n-    \n+\n     :param sender: Specifies a particular sender to receive signals from. See\n         :ref:`connecting-to-specific-signals` for more information.\n \n@@ -129,10 +129,17 @@ receiver:\n \n Now, our ``my_callback`` function will be called each time a request finishes.\n \n+Note that ``receiver`` can also take a list of signals to connect a function\n+to.\n+\n .. versionadded:: 1.3\n \n The ``receiver`` decorator was added in Django 1.3.\n \n+.. versionchanged:: 1.5\n+\n+The ability to pass a list of signals was added.\n+\n .. admonition:: Where should this code live?\n \n     You can put signal handling and registration code anywhere you like.\n@@ -182,7 +189,7 @@ Preventing duplicate signals\n In some circumstances, the module in which you are connecting signals may be\n imported multiple times. This can cause your receiver function to be\n registered more than once, and thus called multiples times for a single signal\n-event. \n+event.\n \n If this behavior is problematic (such as when using signals to\n send an email whenever a model is saved), pass a unique identifier as\n@@ -228,7 +235,7 @@ Remember that you're allowed to change this list of arguments at any time, so ge\n Sending signals\n ---------------\n \n-There are two ways to send send signals in Django.\n+There are two ways to send signals in Django.\n \n .. method:: Signal.send(sender, **kwargs)\n .. method:: Signal.send_robust(sender, **kwargs)"
        },
        {
            "sha": "1f4c970d3eb2100fb8a296644ad0f39ea7cd7aa2",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 105,
            "deletions": 38,
            "changes": 143,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -478,6 +478,32 @@ If there are any circular dependencies in the\n :setting:`TEST_DEPENDENCIES` definition, an ``ImproperlyConfigured``\n exception will be raised.\n \n+Order in which tests are executed\n+---------------------------------\n+\n+In order to guarantee that all ``TestCase`` code starts with a clean database,\n+the Django test runner reorders tests in the following way:\n+\n+* First, all unittests (including :class:`unittest.TestCase`,\n+  :class:`~django.test.SimpleTestCase`, :class:`~django.test.TestCase` and\n+  :class:`~django.test.TransactionTestCase`) are run with no particular ordering\n+  guaranteed nor enforced among them.\n+\n+* Then any other tests (e.g. doctests) that may alter the database without\n+  restoring it to its original state are run.\n+\n+.. versionchanged:: 1.5\n+    Before Django 1.5, the only guarantee was that\n+    :class:`~django.test.TestCase` tests were always ran first, before any other\n+    tests.\n+\n+.. note::\n+\n+    The new ordering of tests may reveal unexpected dependencies on test case\n+    ordering. This is the case with doctests that relied on state left in the\n+    database by a given :class:`~django.test.TransactionTestCase` test, they\n+    must be updated to be able to run independently.\n+\n Other test conditions\n ---------------------\n \n@@ -1109,8 +1135,11 @@ The following is a simple unit test using the request factory::\n             response = my_view(request)\n             self.assertEqual(response.status_code, 200)\n \n-TestCase\n---------\n+Test cases\n+----------\n+\n+Provided test case classes\n+~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n .. currentmodule:: django.test\n \n@@ -1124,28 +1153,38 @@ Normal Python unit test classes extend a base class of\n \n    Hierarchy of Django unit testing classes\n \n+TestCase\n+^^^^^^^^\n+\n .. class:: TestCase()\n \n This class provides some additional capabilities that can be useful for testing\n Web sites.\n \n Converting a normal :class:`unittest.TestCase` to a Django :class:`TestCase` is\n-easy: just change the base class of your test from :class:`unittest.TestCase` to\n-:class:`django.test.TestCase`. All of the standard Python unit test\n-functionality will continue to be available, but it will be augmented with some\n-useful additions, including:\n+easy: Just change the base class of your test from `'unittest.TestCase'` to\n+`'django.test.TestCase'`. All of the standard Python unit test functionality\n+will continue to be available, but it will be augmented with some useful\n+additions, including:\n \n * Automatic loading of fixtures.\n \n * Wraps each test in a transaction.\n \n * Creates a TestClient instance.\n \n-* Django-specific assertions for testing for things\n-  like redirection and form errors.\n+* Django-specific assertions for testing for things like redirection and form\n+  errors.\n+\n+.. versionchanged:: 1.5\n+    The order in which tests are run has changed. See `Order in which tests are\n+    executed`_.\n \n ``TestCase`` inherits from :class:`~django.test.TransactionTestCase`.\n \n+TransactionTestCase\n+^^^^^^^^^^^^^^^^^^^\n+\n .. class:: TransactionTestCase()\n \n Django ``TestCase`` classes make use of database transaction facilities, if\n@@ -1157,38 +1196,66 @@ behavior, you should use a Django ``TransactionTestCase``.\n \n ``TransactionTestCase`` and ``TestCase`` are identical except for the manner\n in which the database is reset to a known state and the ability for test code\n-to test the effects of commit and rollback. A ``TransactionTestCase`` resets\n-the database before the test runs by truncating all tables and reloading\n-initial data. A ``TransactionTestCase`` may call commit and rollback and\n-observe the effects of these calls on the database.\n-\n-A ``TestCase``, on the other hand, does not truncate tables and reload initial\n-data at the beginning of a test. Instead, it encloses the test code in a\n-database transaction that is rolled back at the end of the test.  It also\n-prevents the code under test from issuing any commit or rollback operations\n-on the database, to ensure that the rollback at the end of the test restores\n-the database to its initial state. In order to guarantee that all ``TestCase``\n-code starts with a clean database, the Django test runner runs all ``TestCase``\n-tests first, before any other tests (e.g. doctests) that may alter the\n-database without restoring it to its original state.\n-\n-When running on a database that does not support rollback (e.g. MySQL with the\n-MyISAM storage engine), ``TestCase`` falls back to initializing the database\n-by truncating tables and reloading initial data.\n+to test the effects of commit and rollback:\n \n-``TransactionTestCase`` inherits from :class:`~django.test.SimpleTestCase`.\n+* A ``TransactionTestCase`` resets the database after the test runs by\n+  truncating all tables. A ``TransactionTestCase`` may call commit and rollback\n+  and observe the effects of these calls on the database.\n+\n+* A ``TestCase``, on the other hand, does not truncate tables after a test.\n+  Instead, it encloses the test code in a database transaction that is rolled\n+  back at the end of the test.  It also prevents the code under test from\n+  issuing any commit or rollback operations on the database, to ensure that the\n+  rollback at the end of the test restores the database to its initial state.\n+\n+  When running on a database that does not support rollback (e.g. MySQL with the\n+  MyISAM storage engine), ``TestCase`` falls back to initializing the database\n+  by truncating tables and reloading initial data.\n \n .. note::\n-    The ``TestCase`` use of rollback to un-do the effects of the test code\n-    may reveal previously-undetected errors in test code.  For example,\n-    test code that assumes primary keys values will be assigned starting at\n-    one may find that assumption no longer holds true when rollbacks instead\n-    of table truncation are being used to reset the database.  Similarly,\n-    the reordering of tests so that all ``TestCase`` classes run first may\n-    reveal unexpected dependencies on test case ordering.  In such cases a\n-    quick fix is to switch the ``TestCase`` to a ``TransactionTestCase``.\n-    A better long-term fix, that allows the test to take advantage of the\n-    speed benefit of ``TestCase``, is to fix the underlying test problem.\n+\n+    .. versionchanged:: 1.5\n+\n+    Prior to 1.5, ``TransactionTestCase`` flushed the database tables *before*\n+    each test. In Django 1.5, this is instead done *after* the test has been run.\n+\n+    When the flush took place before the test, it was guaranteed that primary\n+    key values started at one in :class:`~django.test.TransactionTestCase`\n+    tests.\n+\n+    Tests should not depend on this behaviour, but for legacy tests that do, the\n+    :attr:`~TransactionTestCase.reset_sequences` attribute can be used until\n+    the test has been properly updated.\n+\n+.. versionchanged:: 1.5\n+    The order in which tests are run has changed. See `Order in which tests are\n+    executed`_.\n+\n+``TransactionTestCase`` inherits from :class:`~django.test.SimpleTestCase`.\n+\n+.. attribute:: TransactionTestCase.reset_sequences\n+\n+    .. versionadded:: 1.5\n+\n+    Setting ``reset_sequences = True`` on a ``TransactionTestCase`` will make\n+    sure sequences are always reset before the test run::\n+\n+        class TestsThatDependsOnPrimaryKeySequences(TransactionTestCase):\n+            reset_sequences = True\n+\n+            def test_animal_pk(self):\n+                lion = Animal.objects.create(name=\"lion\", sound=\"roar\")\n+                # lion.pk is guaranteed to always be 1\n+                self.assertEqual(lion.pk, 1)\n+\n+    Unless you are explicitly testing primary keys sequence numbers, it is\n+    recommended that you do not hard code primary key values in tests.\n+\n+    Using ``reset_sequences = True`` will slow down the test, since the primary\n+    key reset is an relatively expensive database operation.\n+\n+SimpleTestCase\n+^^^^^^^^^^^^^^\n \n .. class:: SimpleTestCase()\n \n@@ -1940,7 +2007,7 @@ out the `full reference`_ for more details.\n \n .. _Selenium: http://seleniumhq.org/\n .. _selenium package: http://pypi.python.org/pypi/selenium\n-.. _full reference: http://readthedocs.org/docs/selenium-python/en/latest/api.html\n+.. _full reference: http://selenium-python.readthedocs.org/en/latest/api.html\n .. _Firefox: http://www.mozilla.com/firefox/\n \n .. note::"
        },
        {
            "sha": "c23b32fc85ee80825c6f2ee84d8c0b4b1165ccb4",
            "filename": "tests/modeltests/aggregation/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Faggregation%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Faggregation%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Faggregation%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -565,3 +565,23 @@ def test_annotate_values_list(self):\n                 (Decimal('82.8'), 1),\n             ]\n         )\n+\n+    def test_dates_with_aggregation(self):\n+        \"\"\"\n+        Test that .dates() returns a distinct set of dates when applied to a\n+        QuerySet with aggregation.\n+\n+        Refs #18056. Previously, .dates() would return distinct (date_kind,\n+        aggregation) sets, in this case (year, num_authors), so 2008 would be\n+        returned twice because there are books from 2008 with a different\n+        number of authors.\n+        \"\"\"\n+        dates = Book.objects.annotate(num_authors=Count(\"authors\")).dates('pubdate', 'year')\n+        self.assertQuerysetEqual(\n+            dates, [\n+                \"datetime.datetime(1991, 1, 1, 0, 0)\",\n+                \"datetime.datetime(1995, 1, 1, 0, 0)\",\n+                \"datetime.datetime(2007, 1, 1, 0, 0)\",\n+                \"datetime.datetime(2008, 1, 1, 0, 0)\"\n+            ]\n+        )"
        },
        {
            "sha": "d96c60bbe87e3f00002da12d364bfaa4b4cf622b",
            "filename": "tests/modeltests/basic/tests.py",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fbasic%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbasic%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -5,6 +5,7 @@\n from django.core.exceptions import ObjectDoesNotExist\n from django.db.models.fields import Field, FieldDoesNotExist\n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n+from django.utils.six import PY3\n from django.utils.translation import ugettext_lazy\n \n from .models import Article\n@@ -321,17 +322,18 @@ def test_object_creation(self):\n             [\"<Article: Area man programs in Python>\",\n              \"<Article: Third article>\"])\n \n-        # Slicing works with longs.\n-        self.assertEqual(Article.objects.all()[0L], a)\n-        self.assertQuerysetEqual(Article.objects.all()[1L:3L],\n-            [\"<Article: Second article>\", \"<Article: Third article>\"])\n-        self.assertQuerysetEqual((s1 | s2 | s3)[::2L],\n-            [\"<Article: Area man programs in Python>\",\n-             \"<Article: Third article>\"])\n-\n-        # And can be mixed with ints.\n-        self.assertQuerysetEqual(Article.objects.all()[1:3L],\n-            [\"<Article: Second article>\", \"<Article: Third article>\"])\n+        # Slicing works with longs (Python 2 only -- Python 3 doesn't have longs).\n+        if not PY3:\n+            self.assertEqual(Article.objects.all()[long(0)], a)\n+            self.assertQuerysetEqual(Article.objects.all()[long(1):long(3)],\n+                [\"<Article: Second article>\", \"<Article: Third article>\"])\n+            self.assertQuerysetEqual((s1 | s2 | s3)[::long(2)],\n+                [\"<Article: Area man programs in Python>\",\n+                \"<Article: Third article>\"])\n+\n+            # And can be mixed with ints.\n+            self.assertQuerysetEqual(Article.objects.all()[1:long(3)],\n+                [\"<Article: Second article>\", \"<Article: Third article>\"])\n \n         # Slices (without step) are lazy:\n         self.assertQuerysetEqual(Article.objects.all()[0:5].filter(),"
        },
        {
            "sha": "a2e5323a7510ec6412fdec8e764e7a3a309b3520",
            "filename": "tests/modeltests/custom_columns/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_columns%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_columns%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_columns%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n \n from django.core.exceptions import FieldError\n from django.test import TestCase\n+from django.utils import six\n \n from .models import Author, Article\n \n@@ -22,13 +23,13 @@ def test_db_column(self):\n             Author.objects.all(), [\n                 \"Peter Jones\", \"John Smith\",\n             ],\n-            unicode\n+            six.text_type\n         )\n         self.assertQuerysetEqual(\n             Author.objects.filter(first_name__exact=\"John\"), [\n                 \"John Smith\",\n             ],\n-            unicode\n+            six.text_type\n         )\n         self.assertEqual(\n             Author.objects.get(first_name__exact=\"John\"),\n@@ -55,7 +56,7 @@ def test_db_column(self):\n                 \"Peter Jones\",\n                 \"John Smith\",\n             ],\n-            unicode\n+            six.text_type\n         )\n         # Get the articles for an author\n         self.assertQuerysetEqual(\n@@ -69,5 +70,5 @@ def test_db_column(self):\n             art.authors.filter(last_name='Jones'), [\n                 \"Peter Jones\"\n             ],\n-            unicode\n+            six.text_type\n         )"
        },
        {
            "sha": "294920de2b7a6883a914fcd5b87acc0ec8304b42",
            "filename": "tests/modeltests/custom_managers/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_managers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_managers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_managers%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -1,6 +1,7 @@\n from __future__ import absolute_import\n \n from django.test import TestCase\n+from django.utils import six\n \n from .models import Person, Book, Car, PersonManager, PublishedBookManager\n \n@@ -14,7 +15,7 @@ def test_manager(self):\n             Person.objects.get_fun_people(), [\n                 \"Bugs Bunny\"\n             ],\n-            unicode\n+            six.text_type\n         )\n         # The RelatedManager used on the 'books' descriptor extends the default\n         # manager"
        },
        {
            "sha": "68fb9dcd16d9bc81a4dd77ce426e03db8c8e63b8",
            "filename": "tests/modeltests/custom_pk/fields.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_pk%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_pk%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_pk%2Ffields.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -2,6 +2,7 @@\n import string\n \n from django.db import models\n+from django.utils import six\n \n \n class MyWrapper(object):\n@@ -44,12 +45,12 @@ def get_db_prep_save(self, value, connection):\n         if not value:\n             return\n         if isinstance(value, MyWrapper):\n-            return unicode(value)\n+            return six.text_type(value)\n         return value\n \n     def get_db_prep_value(self, value, connection, prepared=False):\n         if not value:\n             return\n         if isinstance(value, MyWrapper):\n-            return unicode(value)\n+            return six.text_type(value)\n         return value"
        },
        {
            "sha": "3f562f0bed88ed28937ba9b9abd1c453c31a30c1",
            "filename": "tests/modeltests/custom_pk/tests.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_pk%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4a2e80fff44d0eb1856b593ac5f31ab1492b3e45/tests%2Fmodeltests%2Fcustom_pk%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fcustom_pk%2Ftests.py?ref=4a2e80fff44d0eb1856b593ac5f31ab1492b3e45",
            "patch": "@@ -3,6 +3,7 @@\n \n from django.db import transaction, IntegrityError\n from django.test import TestCase, skipIfDBFeature\n+from django.utils import six\n \n from .models import Employee, Business, Bar, Foo\n \n@@ -16,7 +17,7 @@ def test_custom_pk(self):\n             Employee.objects.all(), [\n                 \"Dan Jones\",\n             ],\n-            unicode\n+            six.text_type\n         )\n \n         fran = Employee.objects.create(\n@@ -27,7 +28,7 @@ def test_custom_pk(self):\n                 \"Fran Bones\",\n                 \"Dan Jones\",\n             ],\n-            unicode\n+            six.text_type\n         )\n \n         self.assertEqual(Employee.objects.get(pk=123), dan)\n@@ -45,7 +46,7 @@ def test_custom_pk(self):\n                 \"Fran Bones\",\n                 \"Dan Jones\",\n             ],\n-            unicode\n+            six.text_type\n         )\n         # The primary key can be accessed via the pk property on the model.\n         e = Employee.objects.get(pk=123)\n@@ -63,7 +64,7 @@ def test_custom_pk(self):\n                 \"Dan Jones\",\n                 \"Fran Jones\",\n             ],\n-            unicode\n+            six.text_type\n         )\n \n         emps = Employee.objects.in_bulk([123, 456])\n@@ -76,7 +77,7 @@ def test_custom_pk(self):\n                 \"Dan Jones\",\n                 \"Fran Jones\",\n             ],\n-            unicode\n+            six.text_type\n         )\n         self.assertQuerysetEqual(\n             fran.business_set.all(), [\n@@ -108,14 +109,14 @@ def test_custom_pk(self):\n                 \"Dan Jones\",\n                 \"Fran Jones\",\n             ],\n-            unicode,\n+            six.text_type,\n         )\n         self.assertQuerysetEqual(\n             Employee.objects.filter(business__pk=\"Sears\"), [\n                 \"Dan Jones\",\n                 \"Fran Jones\",\n             ],\n-            unicode,\n+            six.text_type,\n         )\n \n         self.assertQuerysetEqual("
        }
    ],
    "stats": {
        "total": 7217,
        "additions": 4436,
        "deletions": 2781
    }
}