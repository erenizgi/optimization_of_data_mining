{
    "author": "ramiro",
    "message": "Fixed #14012 (again) -- Admin app: Don't show the full user edition view after adding a user in a FK popup. Thanks dburke for reporting this regression introduced in r14628.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15637 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4b13e76debbb64818559b504a2dd043af5fcad33",
    "files": [
        {
            "sha": "8cd57f51ac6c0dbf86ab85cefab164364f10b909",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/4b13e76debbb64818559b504a2dd043af5fcad33/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/4b13e76debbb64818559b504a2dd043af5fcad33/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=4b13e76debbb64818559b504a2dd043af5fcad33",
            "patch": "@@ -142,9 +142,12 @@ def response_add(self, request, obj, post_url_continue='../%s/'):\n         its superclass implementation but is customized because the User model\n         has a slightly different workflow.\n         \"\"\"\n-        if '_addanother' not in request.POST:\n-            # The 'Save' button should act like the 'Save and continue\n-            # editing' button\n+        # We should allow further modification of the user just added i.e. the\n+        # 'Save' button should behave like the 'Save and continue editing'\n+        # button except in two scenarios:\n+        # * The user has pressed the 'Save and add another' button\n+        # * We are adding a user in a popup\n+        if '_addanother' not in request.POST and '_popup' not in request.POST:\n             request.POST['_continue'] = 1\n         return super(UserAdmin, self).response_add(request, obj, post_url_continue)\n "
        },
        {
            "sha": "aa8bf073805f71a90c5642fa61e4833b67a0d4ad",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/4b13e76debbb64818559b504a2dd043af5fcad33/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4b13e76debbb64818559b504a2dd043af5fcad33/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=4b13e76debbb64818559b504a2dd043af5fcad33",
            "patch": "@@ -2637,13 +2637,25 @@ def test_password_mismatch(self):\n                           [u\"The two password fields didn't match.\"])\n \n     def test_user_fk_popup(self):\n+        \"\"\"Quick user addition in a FK popup shouldn't invoke view for further user customization\"\"\"\n         response = self.client.get('/test_admin/admin/admin_views/album/add/')\n         self.assertEqual(response.status_code, 200)\n         self.assertContains(response, '/test_admin/admin/auth/user/add')\n         self.assertContains(response, 'class=\"add-another\" id=\"add_id_owner\" onclick=\"return showAddAnotherPopup(this);\"')\n         response = self.client.get('/test_admin/admin/auth/user/add/?_popup=1')\n+        self.assertEqual(response.status_code, 200)\n         self.assertNotContains(response, 'name=\"_continue\"')\n         self.assertNotContains(response, 'name=\"_addanother\"')\n+        data = {\n+            'username': 'newuser',\n+            'password1': 'newpassword',\n+            'password2': 'newpassword',\n+            '_popup': '1',\n+            '_save': '1',\n+        }\n+        response = self.client.post('/test_admin/admin/auth/user/add/?_popup=1', data, follow=True)\n+        self.assertEqual(response.status_code, 200)\n+        self.assertContains(response, 'dismissAddAnotherPopup')\n \n     def test_save_add_another_button(self):\n         user_count = User.objects.count()"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}