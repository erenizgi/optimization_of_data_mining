{
    "author": "akaariai",
    "message": "Fixed #19462 -- Made assertQuerysetEqual detect undefined ordering\n\nIf there are more than one values to compare against and the qs isn't\nordered then assertQuerysetEqual will raise a ValueError.",
    "sha": "088d3bc2f84b6b68fee7e5de053b58049bd110e7",
    "files": [
        {
            "sha": "3af6b8c346190f73380db65bfd94dfdcefd84c02",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -767,6 +767,12 @@ def assertQuerysetEqual(self, qs, values, transform=repr, ordered=True):\n         items = six.moves.map(transform, qs)\n         if not ordered:\n             return self.assertEqual(set(items), set(values))\n+        values = list(values)\n+        # For example qs.iterator() could be passed as qs, but it does not\n+        # have 'ordered' attribute.\n+        if len(values) > 1 and hasattr(qs, 'ordered') and not qs.ordered:\n+            raise ValueError(\"Trying to compare non-ordered queryset \"\n+                             \"against more than one ordered values\")\n         return self.assertEqual(list(items), values)\n \n     def assertNumQueries(self, num, func=None, *args, **kwargs):"
        },
        {
            "sha": "1f5791339721836d49ea1dee51c34f4841493a9a",
            "filename": "docs/releases/1.6.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/docs%2Freleases%2F1.6.txt",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/docs%2Freleases%2F1.6.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.6.txt?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -23,6 +23,11 @@ Minor features\n * Authentication backends can raise ``PermissionDenied`` to immediately fail\n   the authentication chain.\n \n+* The ``assertQuerysetEqual()`` now checks for undefined order and raises\n+  ``ValueError`` if undefined order is spotted. The order is seen as\n+  undefined if the given ``QuerySet`` isn't ordered and there are more than\n+  one ordered values to compare against.\n+\n Backwards incompatible changes in 1.6\n =====================================\n "
        },
        {
            "sha": "a52e4fe1691072162510375f127829a5256c2af0",
            "filename": "docs/topics/testing.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/docs%2Ftopics%2Ftesting.txt",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/docs%2Ftopics%2Ftesting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Ftesting.txt?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -1770,6 +1770,11 @@ your test suite.\n \tvia an explicit ``order_by()`` call on the queryset prior to\n \tcomparison.\n \n+    .. versionchanged:: 1.6\n+        The method now checks for undefined order and raises ``ValueError``\n+        if undefined order is spotted. The ordering is seen as undefined if\n+        the given ``qs`` isn't ordered and the comparison is against more\n+        than one ordered values.\n \n .. method:: TestCase.assertNumQueries(num, func, *args, **kwargs)\n "
        },
        {
            "sha": "a35149644235864a6290bbf68c4d2aae9389f2f7",
            "filename": "tests/modeltests/expressions/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fexpressions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fexpressions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fexpressions%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -158,6 +158,7 @@ def test_filter(self):\n                 \"Max Mustermann\",\n             ],\n             lambda c: six.text_type(c.point_of_contact),\n+            ordered=False\n         )\n \n         c = Company.objects.all()[0]\n@@ -170,7 +171,8 @@ def test_filter(self):\n                 \"Foobar Ltd.\",\n                 \"Test GmbH\",\n             ],\n-            lambda c: c.name\n+            lambda c: c.name,\n+            ordered=False\n         )\n \n         Company.objects.exclude("
        },
        {
            "sha": "0ec317dea583feb5124ac5da2b10bdce9911e019",
            "filename": "tests/modeltests/field_subclassing/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -77,7 +77,8 @@ def test_custom_field(self):\n                 \"12\",\n                 \"23\",\n             ],\n-            lambda m: str(m.data)\n+            lambda m: str(m.data),\n+            ordered=False\n         )\n \n     def test_field_subclassing(self):"
        },
        {
            "sha": "415ed6dcf21e58706fc0a0dbf6c09423910e8859",
            "filename": "tests/modeltests/fixtures/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -96,33 +96,33 @@ def test_loading_and_dumping(self):\n         management.call_command('loaddata', 'fixture6.json', verbosity=0, commit=False)\n         self.assertQuerysetEqual(Tag.objects.all(), [\n             '<Tag: <Article: Copyright is fine the way it is> tagged \"copyright\">',\n-            '<Tag: <Article: Copyright is fine the way it is> tagged \"law\">'\n-        ])\n+            '<Tag: <Article: Copyright is fine the way it is> tagged \"law\">',\n+        ], ordered=False)\n \n         # Load fixture 7, XML file with dynamic ContentType fields. Testing ManyToOne.\n         management.call_command('loaddata', 'fixture7.xml', verbosity=0, commit=False)\n         self.assertQuerysetEqual(Tag.objects.all(), [\n             '<Tag: <Article: Copyright is fine the way it is> tagged \"copyright\">',\n             '<Tag: <Article: Copyright is fine the way it is> tagged \"legal\">',\n             '<Tag: <Article: Django conquers world!> tagged \"django\">',\n-            '<Tag: <Article: Django conquers world!> tagged \"world domination\">'\n-        ])\n+            '<Tag: <Article: Django conquers world!> tagged \"world domination\">',\n+        ], ordered=False)\n \n         # Load fixture 8, JSON file with dynamic Permission fields. Testing ManyToMany.\n         management.call_command('loaddata', 'fixture8.json', verbosity=0, commit=False)\n         self.assertQuerysetEqual(Visa.objects.all(), [\n             '<Visa: Django Reinhardt Can add user, Can change user, Can delete user>',\n             '<Visa: Stephane Grappelli Can add user>',\n             '<Visa: Prince >'\n-        ])\n+        ], ordered=False)\n \n         # Load fixture 9, XML file with dynamic Permission fields. Testing ManyToMany.\n         management.call_command('loaddata', 'fixture9.xml', verbosity=0, commit=False)\n         self.assertQuerysetEqual(Visa.objects.all(), [\n             '<Visa: Django Reinhardt Can add user, Can change user, Can delete user>',\n             '<Visa: Stephane Grappelli Can add user, Can delete user>',\n             '<Visa: Artist formerly known as \"Prince\" Can change user>'\n-        ])\n+        ], ordered=False)\n \n         self.assertQuerysetEqual(Book.objects.all(), [\n             '<Book: Achieving self-awareness of Python programs>',\n@@ -280,7 +280,7 @@ def test_output_formats(self):\n         self.assertQuerysetEqual(Tag.objects.all(), [\n             '<Tag: <Article: Time to reform copyright> tagged \"copyright\">',\n             '<Tag: <Article: Time to reform copyright> tagged \"law\">'\n-        ])\n+        ], ordered=False)\n \n         # Dump the current contents of the database as a JSON fixture\n         self._dumpdata_assert(['fixtures'], '[{\"pk\": 1, \"model\": \"fixtures.category\", \"fields\": {\"description\": \"Latest news stories\", \"title\": \"News Stories\"}}, {\"pk\": 2, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Poker has no place on ESPN\", \"pub_date\": \"2006-06-16T12:00:00\"}}, {\"pk\": 3, \"model\": \"fixtures.article\", \"fields\": {\"headline\": \"Time to reform copyright\", \"pub_date\": \"2006-06-16T13:00:00\"}}, {\"pk\": 1, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"copyright\", \"tagged_id\": 3}}, {\"pk\": 2, \"model\": \"fixtures.tag\", \"fields\": {\"tagged_type\": [\"fixtures\", \"article\"], \"name\": \"law\", \"tagged_id\": 3}}, {\"pk\": 1, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Django Reinhardt\"}}, {\"pk\": 2, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Stephane Grappelli\"}}, {\"pk\": 3, \"model\": \"fixtures.person\", \"fields\": {\"name\": \"Prince\"}}, {\"pk\": 10, \"model\": \"fixtures.book\", \"fields\": {\"name\": \"Achieving self-awareness of Python programs\", \"authors\": []}}]', natural_keys=True)"
        },
        {
            "sha": "73b0a483a2b018f1960d76015e220ab57db78f02",
            "filename": "tests/modeltests/generic_relations/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fgeneric_relations%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fgeneric_relations%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fgeneric_relations%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -169,16 +169,16 @@ def test_multiple_gfk(self):\n         # Filtering works\n         self.assertQuerysetEqual(tiger.comparisons.filter(comparative=\"cooler\"), [\n             \"<Comparison: tiger is cooler than cheetah>\",\n-            \"<Comparison: tiger is cooler than bear>\"\n-        ])\n+            \"<Comparison: tiger is cooler than bear>\",\n+        ], ordered=False)\n \n         # Filtering and deleting works\n         subjective = [\"cooler\"]\n         tiger.comparisons.filter(comparative__in=subjective).delete()\n         self.assertQuerysetEqual(Comparison.objects.all(), [\n             \"<Comparison: cheetah is faster than tiger>\",\n             \"<Comparison: tiger is stronger than cheetah>\"\n-        ])\n+        ], ordered=False)\n \n         # If we delete cheetah, Comparisons with cheetah as 'first_obj' will be\n         # deleted since Animal has an explicit GenericRelation to Comparison"
        },
        {
            "sha": "a3f2c670d639bbf5e33aedbf55a5e45e0d9665b6",
            "filename": "tests/modeltests/m2m_recursive/tests.py",
            "status": "modified",
            "additions": 18,
            "deletions": 9,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fm2m_recursive%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fm2m_recursive%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fm2m_recursive%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -28,7 +28,8 @@ def test_recursive_m2m(self):\n                 \"Chuck\",\n                 \"David\"\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is friends with Bill?\n         self.assertQuerysetEqual(\n@@ -43,15 +44,17 @@ def test_recursive_m2m(self):\n                 \"Anne\",\n                 \"David\"\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is friends with David?\n         self.assertQuerysetEqual(\n             d.friends.all(), [\n                 \"Anne\",\n                 \"Chuck\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Bill is already friends with Anne - add Anne again, but in the\n         # reverse direction\n@@ -64,7 +67,8 @@ def test_recursive_m2m(self):\n                 \"Chuck\",\n                 \"David\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is friends with Bill?\n         self.assertQuerysetEqual(\n@@ -81,7 +85,8 @@ def test_recursive_m2m(self):\n                 \"Chuck\",\n                 \"David\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is friends with Bill?\n         self.assertQuerysetEqual(\n@@ -125,7 +130,8 @@ def test_recursive_m2m(self):\n                 \"Chuck\",\n                 \"David\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is stalking Anne?\n         self.assertQuerysetEqual(\n@@ -172,7 +178,8 @@ def test_recursive_m2m(self):\n                 \"Anne\",\n                 \"Chuck\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Bill is already being stalked by Anne - add Anne again, but in the\n         # reverse direction\n@@ -184,7 +191,8 @@ def test_recursive_m2m(self):\n                 \"Chuck\",\n                 \"David\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is stalking Anne?\n         self.assertQuerysetEqual(\n@@ -215,7 +223,8 @@ def test_recursive_m2m(self):\n                 \"Chuck\",\n                 \"David\",\n             ],\n-            attrgetter(\"name\")\n+            attrgetter(\"name\"),\n+            ordered=False\n         )\n         # Who is stalking Anne?\n         self.assertQuerysetEqual("
        },
        {
            "sha": "44ae689dd4982053bedd5add790978cdcac9b8fc",
            "filename": "tests/modeltests/many_to_one/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmany_to_one%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -267,7 +267,9 @@ def test_reverse_selects(self):\n             [\"<Reporter: John Smith>\"])\n         self.assertQuerysetEqual(\n             Reporter.objects.filter(article__headline__startswith='T'),\n-            [\"<Reporter: John Smith>\", \"<Reporter: John Smith>\"])\n+            [\"<Reporter: John Smith>\", \"<Reporter: John Smith>\"],\n+            ordered=False\n+        )\n         self.assertQuerysetEqual(\n             Reporter.objects.filter(article__headline__startswith='T').distinct(),\n             [\"<Reporter: John Smith>\"])\n@@ -285,7 +287,9 @@ def test_reverse_selects(self):\n                 \"<Reporter: John Smith>\",\n                 \"<Reporter: John Smith>\",\n                 \"<Reporter: John Smith>\",\n-            ])\n+            ],\n+            ordered=False\n+        )\n         self.assertQuerysetEqual(\n             Reporter.objects.filter(article__reporter__first_name__startswith='John').distinct(),\n             [\"<Reporter: John Smith>\"])"
        },
        {
            "sha": "9699b155c0a703f358c53155499d2d4e402c4be4",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -1044,9 +1044,12 @@ def test_with_data(self):\n         self.assertQuerysetEqual(f.clean([c1.id]), [\"Entertainment\"])\n         self.assertQuerysetEqual(f.clean([c2.id]), [\"It's a test\"])\n         self.assertQuerysetEqual(f.clean([str(c1.id)]), [\"Entertainment\"])\n-        self.assertQuerysetEqual(f.clean([str(c1.id), str(c2.id)]), [\"Entertainment\", \"It's a test\"])\n-        self.assertQuerysetEqual(f.clean([c1.id, str(c2.id)]), [\"Entertainment\", \"It's a test\"])\n-        self.assertQuerysetEqual(f.clean((c1.id, str(c2.id))), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([str(c1.id), str(c2.id)]), [\"Entertainment\", \"It's a test\"],\n+                                 ordered=False)\n+        self.assertQuerysetEqual(f.clean([c1.id, str(c2.id)]), [\"Entertainment\", \"It's a test\"],\n+                                 ordered=False)\n+        self.assertQuerysetEqual(f.clean((c1.id, str(c2.id))), [\"Entertainment\", \"It's a test\"],\n+                                 ordered=False)\n         with self.assertRaises(ValidationError):\n             f.clean(['100'])\n         with self.assertRaises(ValidationError):"
        },
        {
            "sha": "ddb2c83b4f12bfecd3a3b64974091a2d920e9086",
            "filename": "tests/regressiontests/expressions_regress/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 17,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fexpressions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fexpressions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fexpressions_regress%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -26,12 +26,13 @@ def test_fill_with_value_from_same_object(self):\n         same object.\n         \"\"\"\n         self.assertQuerysetEqual(\n-                Number.objects.all(),\n-                [\n-                    '<Number: -1, -1.000>',\n-                    '<Number: 42, 42.000>',\n-                    '<Number: 1337, 1337.000>'\n-                ]\n+            Number.objects.all(),\n+            [\n+                '<Number: -1, -1.000>',\n+                '<Number: 42, 42.000>',\n+                '<Number: 1337, 1337.000>'\n+            ],\n+            ordered=False\n         )\n \n     def test_increment_value(self):\n@@ -44,12 +45,13 @@ def test_increment_value(self):\n             2)\n \n         self.assertQuerysetEqual(\n-                Number.objects.all(),\n-                [\n-                    '<Number: -1, -1.000>',\n-                    '<Number: 43, 42.000>',\n-                    '<Number: 1338, 1337.000>'\n-                ]\n+            Number.objects.all(),\n+            [\n+                '<Number: -1, -1.000>',\n+                '<Number: 43, 42.000>',\n+                '<Number: 1338, 1337.000>'\n+            ],\n+            ordered=False\n         )\n \n     def test_filter_not_equals_other_field(self):\n@@ -62,11 +64,12 @@ def test_filter_not_equals_other_field(self):\n                   .update(integer=F('integer') + 1),\n             2)\n         self.assertQuerysetEqual(\n-                Number.objects.exclude(float=F('integer')),\n-                [\n-                    '<Number: 43, 42.000>',\n-                    '<Number: 1338, 1337.000>'\n-                ]\n+            Number.objects.exclude(float=F('integer')),\n+            [\n+                '<Number: 43, 42.000>',\n+                '<Number: 1338, 1337.000>'\n+            ],\n+            ordered=False\n         )\n \n     def test_complex_expressions(self):"
        },
        {
            "sha": "1bc6789eddd9bacd7cb773a3dbf2211df7dad067",
            "filename": "tests/regressiontests/extra_regress/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fextra_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fextra_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fextra_regress%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -58,13 +58,15 @@ def test_regression_7314_7372(self):\n                 ('First Revision', 'First Revision'),\n                 ('Second Revision', 'First Revision'),\n             ],\n-            transform=lambda r: (r.title, r.base.title)\n+            transform=lambda r: (r.title, r.base.title),\n+            ordered=False\n         )\n \n         # Following queryset should return the most recent revision:\n         self.assertQuerysetEqual(qs & qs2,\n             [('Second Revision', 'First Revision')],\n-            transform=lambda r: (r.title, r.base.title)\n+            transform=lambda r: (r.title, r.base.title),\n+            ordered=False\n         )\n \n     def test_extra_stay_tied(self):\n@@ -342,5 +344,6 @@ def test_regression_17877(self):\n             TestObject.objects.extra(\n                 where=[\"first = 'a' OR second = 'a'\", \"third = 'a'\"],\n             ),\n-            ['<TestObject: TestObject: a,a,a>', '<TestObject: TestObject: b,a,a>']\n+            ['<TestObject: TestObject: a,a,a>', '<TestObject: TestObject: b,a,a>'],\n+            ordered=False\n         )"
        },
        {
            "sha": "3dc1d2417c2d42d68081559309ad0b44b242204a",
            "filename": "tests/regressiontests/m2m_regress/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fm2m_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fm2m_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fm2m_regress%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -74,7 +74,7 @@ def test_add_m2m_with_base_class(self):\n         c1.tags = [t1, t2]\n         c1 = TagCollection.objects.get(name='c1')\n \n-        self.assertQuerysetEqual(c1.tags.all(), [\"<Tag: t1>\", \"<Tag: t2>\"])\n+        self.assertQuerysetEqual(c1.tags.all(), [\"<Tag: t1>\", \"<Tag: t2>\"], ordered=False)\n         self.assertQuerysetEqual(t1.tag_collections.all(), [\"<TagCollection: c1>\"])\n \n     def test_manager_class_caching(self):"
        },
        {
            "sha": "17a4525442d0f80d44353c49cb9b82fad0174a09",
            "filename": "tests/regressiontests/m2m_through_regress/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fm2m_through_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fm2m_through_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fm2m_through_regress%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -28,7 +28,8 @@ def test_everything(self):\n             bob.group_set.all(), [\n                 \"<Group: Rock>\",\n                 \"<Group: Roll>\",\n-            ]\n+            ],\n+            ordered=False\n         )\n \n         self.assertQuerysetEqual(\n@@ -51,7 +52,8 @@ def test_everything(self):\n             frank.group_set.all(), [\n                 \"<Group: Rock>\",\n                 \"<Group: Roll>\",\n-            ]\n+            ],\n+            ordered=False\n         )\n \n         self.assertQuerysetEqual(\n@@ -190,7 +192,8 @@ def test_add_reverse(self):\n         self.driver.car_set._add_items('driver', 'car', car2)\n         self.assertQuerysetEqual(\n             self.driver.car_set.all(),\n-            [\"<Car: Toyota>\", \"<Car: Honda>\"]\n+            [\"<Car: Toyota>\", \"<Car: Honda>\"],\n+            ordered=False\n         )\n \n     def test_add_null_reverse(self):"
        },
        {
            "sha": "45059be4e5444ab05c0edb2714feadd4576a2a2f",
            "filename": "tests/regressiontests/managers_regress/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fmanagers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fmanagers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmanagers_regress%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -61,7 +61,8 @@ def test_managers(self):\n         self.assertQuerysetEqual(Child4.manager1.all(), [\n                 \"<Child4: d1>\",\n                 \"<Child4: f1>\"\n-            ]\n+            ],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(Child5._default_manager.all(), [\"<Child5: fred>\"])\n         self.assertQuerysetEqual(Child6._default_manager.all(), [\"<Child6: f1>\"])"
        },
        {
            "sha": "c90fe98658db9a2c7d32c58c42f6b527592d73c8",
            "filename": "tests/regressiontests/model_regress/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fmodel_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fmodel_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_regress%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -71,7 +71,8 @@ def test_date_lookup(self):\n                 datetime.date(1999, 12, 31),\n                 datetime.date(1998, 12, 31),\n             ],\n-            attrgetter(\"when\")\n+            attrgetter(\"when\"),\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Party.objects.filter(when__year=1998), [\n@@ -85,14 +86,16 @@ def test_date_lookup(self):\n                 datetime.date(1999, 12, 31),\n                 datetime.date(1998, 12, 31),\n             ],\n-            attrgetter(\"when\")\n+            attrgetter(\"when\"),\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Party.objects.filter(when__month=\"12\"), [\n                 datetime.date(1999, 12, 31),\n                 datetime.date(1998, 12, 31),\n             ],\n-            attrgetter(\"when\")\n+            attrgetter(\"when\"),\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Party.objects.filter(when__year=\"1998\"), ["
        },
        {
            "sha": "e4009cdf2013b4e311ce03d3b17c591243ee536b",
            "filename": "tests/regressiontests/queries/tests.py",
            "status": "modified",
            "additions": 24,
            "deletions": 13,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Fqueries%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fqueries%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -841,11 +841,14 @@ def test_ticket17429(self):\n         \"\"\"\n         original_ordering = Tag._meta.ordering\n         Tag._meta.ordering = None\n-        self.assertQuerysetEqual(\n-            Tag.objects.all(),\n-            ['<Tag: t1>', '<Tag: t2>', '<Tag: t3>', '<Tag: t4>', '<Tag: t5>'],\n-        )\n-        Tag._meta.ordering = original_ordering\n+        try:\n+            self.assertQuerysetEqual(\n+                Tag.objects.all(),\n+                ['<Tag: t1>', '<Tag: t2>', '<Tag: t3>', '<Tag: t4>', '<Tag: t5>'],\n+                ordered=False\n+            )\n+        finally:\n+            Tag._meta.ordering = original_ordering\n \n     def test_exclude(self):\n         self.assertQuerysetEqual(\n@@ -925,15 +928,18 @@ def test_ticket12239(self):\n         self.assertQuerysetEqual(Number.objects.filter(num__gt=12.1), [])\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lt=12),\n-            ['<Number: 4>', '<Number: 8>']\n+            ['<Number: 4>', '<Number: 8>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lt=12.0),\n-            ['<Number: 4>', '<Number: 8>']\n+            ['<Number: 4>', '<Number: 8>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lt=12.1),\n-            ['<Number: 4>', '<Number: 8>', '<Number: 12>']\n+            ['<Number: 4>', '<Number: 8>', '<Number: 12>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__gte=11.9),\n@@ -951,23 +957,28 @@ def test_ticket12239(self):\n         self.assertQuerysetEqual(Number.objects.filter(num__gte=12.9), [])\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lte=11.9),\n-            ['<Number: 4>', '<Number: 8>']\n+            ['<Number: 4>', '<Number: 8>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lte=12),\n-            ['<Number: 4>', '<Number: 8>', '<Number: 12>']\n+            ['<Number: 4>', '<Number: 8>', '<Number: 12>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lte=12.0),\n-            ['<Number: 4>', '<Number: 8>', '<Number: 12>']\n+            ['<Number: 4>', '<Number: 8>', '<Number: 12>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lte=12.1),\n-            ['<Number: 4>', '<Number: 8>', '<Number: 12>']\n+            ['<Number: 4>', '<Number: 8>', '<Number: 12>'],\n+            ordered=False\n         )\n         self.assertQuerysetEqual(\n             Number.objects.filter(num__lte=12.9),\n-            ['<Number: 4>', '<Number: 8>', '<Number: 12>']\n+            ['<Number: 4>', '<Number: 8>', '<Number: 12>'],\n+            ordered=False\n         )\n \n     def test_ticket7411(self):"
        },
        {
            "sha": "85a1031c027bb72d6feeb0a3cdf6ff2f66b52bab",
            "filename": "tests/regressiontests/test_utils/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Ftest_utils%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Ftest_utils%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_utils%2Fmodels.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -1,5 +1,9 @@\n from django.db import models\n+from django.utils.encoding import python_2_unicode_compatible\n \n-\n+@python_2_unicode_compatible\n class Person(models.Model):\n     name = models.CharField(max_length=100)\n+\n+    def __str__(self):\n+        return self.name"
        },
        {
            "sha": "d5d49b21045a8f63fe101791bb1c4ca13e565e0c",
            "filename": "tests/regressiontests/test_utils/tests.py",
            "status": "modified",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/088d3bc2f84b6b68fee7e5de053b58049bd110e7/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_utils%2Ftests.py?ref=088d3bc2f84b6b68fee7e5de053b58049bd110e7",
            "patch": "@@ -54,6 +54,46 @@ def test_func():\n         self.assertNumQueries(2, test_func)\n \n \n+class AssertQuerysetEqualTests(TestCase):\n+    def setUp(self):\n+        self.p1 = Person.objects.create(name='p1')\n+        self.p2 = Person.objects.create(name='p2')\n+\n+    def test_ordered(self):\n+        self.assertQuerysetEqual(\n+            Person.objects.all().order_by('name'),\n+            [repr(self.p1), repr(self.p2)]\n+        )\n+\n+    def test_unordered(self):\n+        self.assertQuerysetEqual(\n+            Person.objects.all().order_by('name'),\n+            [repr(self.p2), repr(self.p1)],\n+            ordered=False\n+        )\n+\n+    def test_transform(self):\n+        self.assertQuerysetEqual(\n+            Person.objects.all().order_by('name'),\n+            [self.p1.pk, self.p2.pk],\n+            transform=lambda x: x.pk\n+        )\n+\n+    def test_undefined_order(self):\n+        # Using an unordered queryset with more than one ordered value\n+        # is an error.\n+        with self.assertRaises(ValueError):\n+            self.assertQuerysetEqual(\n+                Person.objects.all(),\n+                [repr(self.p1), repr(self.p2)]\n+            )\n+        # No error for one value.\n+        self.assertQuerysetEqual(\n+            Person.objects.filter(name='p1'),\n+            [repr(self.p1)]\n+        )\n+\n+\n class AssertNumQueriesContextManagerTests(TestCase):\n     urls = 'regressiontests.test_utils.urls'\n "
        }
    ],
    "stats": {
        "total": 239,
        "additions": 171,
        "deletions": 68
    }
}