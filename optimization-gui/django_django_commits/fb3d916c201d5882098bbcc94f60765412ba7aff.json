{
    "author": "claudep",
    "message": "Fixed #18751 -- Cleaned up BaseFormSet._should_delete_form\n\nWe can do that now that cleaned_data is guaranteed to be\npresent. Related to [121fd109].\nThanks Simon Charette for his work on the ticket.",
    "sha": "fb3d916c201d5882098bbcc94f60765412ba7aff",
    "files": [
        {
            "sha": "bdcef92dec77ccb62dc85989f30c2100e4087bff",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/fb3d916c201d5882098bbcc94f60765412ba7aff/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/fb3d916c201d5882098bbcc94f60765412ba7aff/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=fb3d916c201d5882098bbcc94f60765412ba7aff",
            "patch": "@@ -254,13 +254,10 @@ def _get_errors(self):\n     errors = property(_get_errors)\n \n     def _should_delete_form(self, form):\n-        # The way we lookup the value of the deletion field here takes\n-        # more code than we'd like, but the form's cleaned_data will\n-        # not exist if the form is invalid.\n-        field = form.fields[DELETION_FIELD_NAME]\n-        raw_value = form._raw_value(DELETION_FIELD_NAME)\n-        should_delete = field.clean(raw_value)\n-        return should_delete\n+        \"\"\"\n+        Returns whether or not the form was marked for deletion.\n+        \"\"\"\n+        return form.cleaned_data.get(DELETION_FIELD_NAME, False)\n \n     def is_valid(self):\n         \"\"\""
        },
        {
            "sha": "1aa49eaaec300f390b08ff89ac936f9c17f487d7",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/fb3d916c201d5882098bbcc94f60765412ba7aff/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/fb3d916c201d5882098bbcc94f60765412ba7aff/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=fb3d916c201d5882098bbcc94f60765412ba7aff",
            "patch": "@@ -591,6 +591,10 @@ def save_existing_objects(self, commit=True):\n             return []\n \n         saved_instances = []\n+        try:\n+            forms_to_delete = self.deleted_forms\n+        except AttributeError:\n+            forms_to_delete = []\n         for form in self.initial_forms:\n             pk_name = self._pk_field.name\n             raw_pk_value = form._raw_value(pk_name)\n@@ -601,7 +605,7 @@ def save_existing_objects(self, commit=True):\n             pk_value = getattr(pk_value, 'pk', pk_value)\n \n             obj = self._existing_object(pk_value)\n-            if self.can_delete and self._should_delete_form(form):\n+            if form in forms_to_delete:\n                 self.deleted_objects.append(obj)\n                 obj.delete()\n                 continue"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 9,
        "deletions": 8
    }
}