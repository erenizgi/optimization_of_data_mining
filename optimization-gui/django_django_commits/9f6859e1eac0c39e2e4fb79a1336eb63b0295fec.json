{
    "author": "ramiro",
    "message": "Fixed #15169 -- Corrected handling of model boolean fields in MySQL spatial backend.\n\nThanks goes to zmsmith and others for reporting the issue and to Justin Bronn for the fix.\n\nRefs #7190, r12578, r12900, #13293, r12939.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17588 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
    "files": [
        {
            "sha": "c0e5aa6691b14d8830ad04a18286d563c0bc2698",
            "filename": "django/contrib/gis/db/backends/mysql/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -5,7 +5,7 @@\n \n class MySQLOperations(DatabaseOperations, BaseSpatialOperations):\n \n-    compiler_module = 'django.contrib.gis.db.models.sql.compiler'\n+    compiler_module = 'django.contrib.gis.db.backends.mysql.compiler'\n     mysql = True\n     name = 'mysql'\n     select = 'AsText(%s)'"
        },
        {
            "sha": "93590256b43f3cdd38964029710dab88a6577ea5",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -185,9 +185,10 @@ def resolve_columns(self, row, fields=()):\n                                self.query.extra_select_fields.get(a, None),\n                                self.connection)\n                   for v, a in izip(row[rn_offset:index_start], aliases)]\n-        if self.connection.ops.oracle or getattr(self.query, 'geo_values', False):\n-            # We resolve the rest of the columns if we're on Oracle or if\n-            # the `geo_values` attribute is defined.\n+\n+        if self.connection.ops.oracle or self.connection.ops.mysql or getattr(self.query, 'geo_values', False):\n+            # We resolve the rest of the columns if we're on MySQL, Oracle or\n+            # if the `geo_values` attribute is defined.\n             for value, field in map(None, row[index_start:], fields):\n                 values.append(self.query.convert_values(value, field, self.connection))\n         else:"
        },
        {
            "sha": "25c0376996cb5d192e32de4f2695e67dc5faad0d",
            "filename": "django/contrib/gis/db/models/sql/query.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -56,8 +56,8 @@ def convert_values(self, value, field, connection):\n         extra selection objects into Geometry and Distance objects.\n         TODO: Make converted objects 'lazy' for less overhead.\n         \"\"\"\n-        if connection.ops.oracle:\n-            # Running through Oracle's first.\n+        if connection.ops.oracle or connection.ops.mysql:\n+            # On MySQL and Oracle, call their version of `convert_values` first.\n             value = super(GeoQuery, self).convert_values(value, field or GeomField(), connection)\n \n         if value is None:"
        },
        {
            "sha": "79061e1cfc2a540f18c2cab349a182091fd21bb6",
            "filename": "django/contrib/gis/tests/geoapp/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -34,6 +34,10 @@ class Track(models.Model):\n     objects = models.GeoManager()\n     def __unicode__(self): return self.name\n \n+class Truth(models.Model):\n+    val = models.BooleanField()\n+    objects = models.GeoManager()\n+\n if not spatialite:\n     class Feature(models.Model):\n         name = models.CharField(max_length=20)"
        },
        {
            "sha": "c9a2d8362543389be52164bcb305fec29f155eb6",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -7,7 +7,7 @@\n from django.db.models import Count\n from django.test import TestCase\n \n-from .models import City, PennsylvaniaCity, State\n+from .models import City, PennsylvaniaCity, State, Truth\n \n \n class GeoRegressionTests(TestCase):\n@@ -64,3 +64,11 @@ def test06_defer_or_only_with_annotate(self):\n         \"Regression for #16409 - make sure defer() and only() work with annotate()\"\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).defer('name')), list)\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).only('name')), list)\n+\n+    def test04_boolean_conversion(self):\n+        \"Testing Boolean value conversion with the spatial backend, see #15169.\"\n+        t1 = Truth.objects.create(val=True)\n+        t2 = Truth.objects.create(val=False)\n+\n+        self.assertTrue(Truth.objects.get(pk=1).val is True)\n+        self.assertTrue(Truth.objects.get(pk=2).val is False)"
        },
        {
            "sha": "8073e55cf45c8674ae9eef4720337eb9d1a5b796",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -176,6 +176,12 @@ def _can_introspect_foreign_keys(self):\n class DatabaseOperations(BaseDatabaseOperations):\n     compiler_module = \"django.db.backends.mysql.compiler\"\n \n+    def convert_values(self, value, field):\n+        if (field and field.get_internal_type() in (\"BooleanField\", \"NullBooleanField\") and\n+            value in (0, 1)):\n+            value = bool(value)\n+        return value\n+\n     def date_extract_sql(self, lookup_type, field_name):\n         # http://dev.mysql.com/doc/mysql/en/date-and-time-functions.html\n         if lookup_type == 'week_day':"
        },
        {
            "sha": "3fd536c0c6ae472395a4ec1a43a5656d441121c8",
            "filename": "django/db/backends/mysql/compiler.py",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/9f6859e1eac0c39e2e4fb79a1336eb63b0295fec/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py?ref=9f6859e1eac0c39e2e4fb79a1336eb63b0295fec",
            "patch": "@@ -5,10 +5,7 @@ def resolve_columns(self, row, fields=()):\n         values = []\n         index_extra_select = len(self.query.extra_select.keys())\n         for value, field in map(None, row[index_extra_select:], fields):\n-            if (field and field.get_internal_type() in (\"BooleanField\", \"NullBooleanField\") and\n-                value in (0, 1)):\n-                value = bool(value)\n-            values.append(value)\n+            values.append(self.query.convert_values(value, field, connection=self.connection))\n         return row[:index_extra_select] + tuple(values)\n \n class SQLInsertCompiler(compiler.SQLInsertCompiler, SQLCompiler):"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 27,
        "deletions": 11
    }
}