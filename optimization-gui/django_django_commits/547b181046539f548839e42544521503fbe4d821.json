{
    "author": "aaugustin",
    "message": "[py3] Ported django.utils.safestring.\n\nBackwards compatibility aliases were created under Python 2.",
    "sha": "547b181046539f548839e42544521503fbe4d821",
    "files": [
        {
            "sha": "cec3b04f7e0a90d3c7ac899b1c589752122a706f",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -38,7 +38,7 @@\n from django.db.backends.mysql.introspection import DatabaseIntrospection\n from django.db.backends.mysql.validation import DatabaseValidation\n from django.utils.functional import cached_property\n-from django.utils.safestring import SafeString, SafeUnicode\n+from django.utils.safestring import SafeBytes, SafeText\n from django.utils import six\n from django.utils import timezone\n \n@@ -75,7 +75,7 @@ def adapt_datetime_with_timezone_support(value, conv):\n # MySQLdb-1.2.1 returns TIME columns as timedelta -- they are more like\n # timedelta in terms of actual behavior as they are signed and include days --\n # and Django expects time, so we still need to override that. We also need to\n-# add special handling for SafeUnicode and SafeString as MySQLdb's type\n+# add special handling for SafeText and SafeBytes as MySQLdb's type\n # checking is too tight to catch those (see Django ticket #6052).\n # Finally, MySQLdb always returns naive datetime objects. However, when\n # timezone support is active, Django expects timezone-aware datetime objects.\n@@ -402,8 +402,8 @@ def _cursor(self):\n             kwargs['client_flag'] = CLIENT.FOUND_ROWS\n             kwargs.update(settings_dict['OPTIONS'])\n             self.connection = Database.connect(**kwargs)\n-            self.connection.encoders[SafeUnicode] = self.connection.encoders[six.text_type]\n-            self.connection.encoders[SafeString] = self.connection.encoders[bytes]\n+            self.connection.encoders[SafeText] = self.connection.encoders[six.text_type]\n+            self.connection.encoders[SafeBytes] = self.connection.encoders[bytes]\n             connection_created.send(sender=self.__class__, connection=self)\n         cursor = self.connection.cursor()\n         if new_connection:"
        },
        {
            "sha": "f6f534da8cdc2df4c8738166f2bbf87186043437",
            "filename": "django/db/backends/postgresql_psycopg2/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fpostgresql_psycopg2%2Fbase.py?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -14,7 +14,7 @@\n from django.db.backends.postgresql_psycopg2.version import get_version\n from django.db.backends.postgresql_psycopg2.introspection import DatabaseIntrospection\n from django.utils.log import getLogger\n-from django.utils.safestring import SafeUnicode, SafeString\n+from django.utils.safestring import SafeText, SafeBytes\n from django.utils import six\n from django.utils.timezone import utc\n \n@@ -29,8 +29,8 @@\n IntegrityError = Database.IntegrityError\n \n psycopg2.extensions.register_type(psycopg2.extensions.UNICODE)\n-psycopg2.extensions.register_adapter(SafeString, psycopg2.extensions.QuotedString)\n-psycopg2.extensions.register_adapter(SafeUnicode, psycopg2.extensions.QuotedString)\n+psycopg2.extensions.register_adapter(SafeBytes, psycopg2.extensions.QuotedString)\n+psycopg2.extensions.register_adapter(SafeText, psycopg2.extensions.QuotedString)\n \n logger = getLogger('django.db.backends')\n "
        },
        {
            "sha": "31a16b6a2b117881fe93cd7b5286e97d57ee7c42",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -20,7 +20,7 @@\n from django.db.backends.sqlite3.introspection import DatabaseIntrospection\n from django.utils.dateparse import parse_date, parse_datetime, parse_time\n from django.utils.functional import cached_property\n-from django.utils.safestring import SafeString\n+from django.utils.safestring import SafeBytes\n from django.utils import six\n from django.utils import timezone\n \n@@ -80,7 +80,7 @@ def decoder(conv_func):\n     # slow-down, this adapter is only registered for sqlite3 versions\n     # needing it (Python 2.6 and up).\n     Database.register_adapter(str, lambda s: s.decode('utf-8'))\n-    Database.register_adapter(SafeString, lambda s: s.decode('utf-8'))\n+    Database.register_adapter(SafeBytes, lambda s: s.decode('utf-8'))\n \n class DatabaseFeatures(BaseDatabaseFeatures):\n     # SQLite cannot handle us only partially reading from a cursor's result set"
        },
        {
            "sha": "3ac2c508b60015d5de952a4467ae96beaafcb294",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -119,8 +119,8 @@ def force_text(s, encoding='utf-8', strings_only=False, errors='strict'):\n                             errors) for arg in s])\n         else:\n             # Note: We use .decode() here, instead of six.text_type(s, encoding,\n-            # errors), so that if s is a SafeString, it ends up being a\n-            # SafeUnicode at the end.\n+            # errors), so that if s is a SafeBytes, it ends up being a\n+            # SafeText at the end.\n             s = s.decode(encoding, errors)\n     except UnicodeDecodeError as e:\n         if not isinstance(s, Exception):"
        },
        {
            "sha": "07e0bf4cea03b33d1a03f3beaba81418c2c72425",
            "filename": "django/utils/safestring.py",
            "status": "modified",
            "additions": 44,
            "deletions": 30,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/django%2Futils%2Fsafestring.py",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/django%2Futils%2Fsafestring.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsafestring.py?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -10,36 +10,43 @@\n class EscapeData(object):\n     pass\n \n-class EscapeString(bytes, EscapeData):\n+class EscapeBytes(bytes, EscapeData):\n     \"\"\"\n-    A string that should be HTML-escaped when output.\n+    A byte string that should be HTML-escaped when output.\n     \"\"\"\n     pass\n \n-class EscapeUnicode(six.text_type, EscapeData):\n+class EscapeText(six.text_type, EscapeData):\n     \"\"\"\n-    A unicode object that should be HTML-escaped when output.\n+    A unicode string object that should be HTML-escaped when output.\n     \"\"\"\n     pass\n \n+if six.PY3:\n+    EscapeString = EscapeText\n+else:\n+    EscapeString = EscapeBytes\n+    # backwards compatibility for Python 2\n+    EscapeUnicode = EscapeText\n+\n class SafeData(object):\n     pass\n \n-class SafeString(bytes, SafeData):\n+class SafeBytes(bytes, SafeData):\n     \"\"\"\n-    A string subclass that has been specifically marked as \"safe\" (requires no\n+    A bytes subclass that has been specifically marked as \"safe\" (requires no\n     further escaping) for HTML output purposes.\n     \"\"\"\n     def __add__(self, rhs):\n         \"\"\"\n-        Concatenating a safe string with another safe string or safe unicode\n-        object is safe. Otherwise, the result is no longer safe.\n+        Concatenating a safe byte string with another safe byte string or safe\n+        unicode string is safe. Otherwise, the result is no longer safe.\n         \"\"\"\n-        t = super(SafeString, self).__add__(rhs)\n-        if isinstance(rhs, SafeUnicode):\n-            return SafeUnicode(t)\n-        elif isinstance(rhs, SafeString):\n-            return SafeString(t)\n+        t = super(SafeBytes, self).__add__(rhs)\n+        if isinstance(rhs, SafeText):\n+            return SafeText(t)\n+        elif isinstance(rhs, SafeBytes):\n+            return SafeBytes(t)\n         return t\n \n     def _proxy_method(self, *args, **kwargs):\n@@ -51,25 +58,25 @@ def _proxy_method(self, *args, **kwargs):\n         method = kwargs.pop('method')\n         data = method(self, *args, **kwargs)\n         if isinstance(data, bytes):\n-            return SafeString(data)\n+            return SafeBytes(data)\n         else:\n-            return SafeUnicode(data)\n+            return SafeText(data)\n \n     decode = curry(_proxy_method, method=bytes.decode)\n \n-class SafeUnicode(six.text_type, SafeData):\n+class SafeText(six.text_type, SafeData):\n     \"\"\"\n-    A unicode subclass that has been specifically marked as \"safe\" for HTML\n-    output purposes.\n+    A unicode (Python 2) / str (Python 3) subclass that has been specifically\n+    marked as \"safe\" for HTML output purposes.\n     \"\"\"\n     def __add__(self, rhs):\n         \"\"\"\n-        Concatenating a safe unicode object with another safe string or safe\n-        unicode object is safe. Otherwise, the result is no longer safe.\n+        Concatenating a safe unicode string with another safe byte string or\n+        safe unicode string is safe. Otherwise, the result is no longer safe.\n         \"\"\"\n-        t = super(SafeUnicode, self).__add__(rhs)\n+        t = super(SafeText, self).__add__(rhs)\n         if isinstance(rhs, SafeData):\n-            return SafeUnicode(t)\n+            return SafeText(t)\n         return t\n \n     def _proxy_method(self, *args, **kwargs):\n@@ -81,12 +88,19 @@ def _proxy_method(self, *args, **kwargs):\n         method = kwargs.pop('method')\n         data = method(self, *args, **kwargs)\n         if isinstance(data, bytes):\n-            return SafeString(data)\n+            return SafeBytes(data)\n         else:\n-            return SafeUnicode(data)\n+            return SafeText(data)\n \n     encode = curry(_proxy_method, method=six.text_type.encode)\n \n+if six.PY3:\n+    SafeString = SafeText\n+else:\n+    SafeString = SafeBytes\n+    # backwards compatibility for Python 2\n+    SafeUnicode = SafeText\n+\n def mark_safe(s):\n     \"\"\"\n     Explicitly mark a string as safe for (HTML) output purposes. The returned\n@@ -97,10 +111,10 @@ def mark_safe(s):\n     if isinstance(s, SafeData):\n         return s\n     if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_bytes):\n-        return SafeString(s)\n+        return SafeBytes(s)\n     if isinstance(s, (six.text_type, Promise)):\n-        return SafeUnicode(s)\n-    return SafeString(bytes(s))\n+        return SafeText(s)\n+    return SafeString(str(s))\n \n def mark_for_escaping(s):\n     \"\"\"\n@@ -113,8 +127,8 @@ def mark_for_escaping(s):\n     if isinstance(s, (SafeData, EscapeData)):\n         return s\n     if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_bytes):\n-        return EscapeString(s)\n+        return EscapeBytes(s)\n     if isinstance(s, (six.text_type, Promise)):\n-        return EscapeUnicode(s)\n-    return EscapeString(bytes(s))\n+        return EscapeText(s)\n+    return EscapeBytes(bytes(s))\n "
        },
        {
            "sha": "5b27af82d69be602716a3bc7440824fb49d595f2",
            "filename": "docs/howto/custom-template-tags.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/docs%2Fhowto%2Fcustom-template-tags.txt",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/docs%2Fhowto%2Fcustom-template-tags.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-template-tags.txt?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -189,7 +189,7 @@ passed around inside the template code:\n   They're commonly used for output that contains raw HTML that is intended\n   to be interpreted as-is on the client side.\n \n-  Internally, these strings are of type ``SafeString`` or ``SafeUnicode``.\n+  Internally, these strings are of type ``SafeBytes`` or ``SafeText``.\n   They share a common base class of ``SafeData``, so you can test\n   for them using code like:\n \n@@ -204,8 +204,8 @@ passed around inside the template code:\n   not. These strings are only escaped once, however, even if auto-escaping\n   applies.\n \n-  Internally, these strings are of type ``EscapeString`` or\n-  ``EscapeUnicode``. Generally you don't have to worry about these; they\n+  Internally, these strings are of type ``EscapeBytes`` or\n+  ``EscapeText``. Generally you don't have to worry about these; they\n   exist for the implementation of the :tfilter:`escape` filter.\n \n Template filter code falls into one of two situations:"
        },
        {
            "sha": "20775fcc81b8f9e0ea3fe9b661e6437cf66c63f4",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -560,15 +560,29 @@ string\" means that the producer of the string has already turned characters\n that should not be interpreted by the HTML engine (e.g. '<') into the\n appropriate entities.\n \n+.. class:: SafeBytes\n+\n+    .. versionadded:: 1.5\n+\n+    A :class:`bytes` subclass that has been specifically marked as \"safe\"\n+    (requires no further escaping) for HTML output purposes.\n+\n .. class:: SafeString\n \n-    A string subclass that has been specifically marked as \"safe\" (requires no\n-    further escaping) for HTML output purposes.\n+    A :class:`str` subclass that has been specifically marked as \"safe\"\n+    (requires no further escaping) for HTML output purposes. This is\n+    :class:`SafeBytes` on Python 2 and :class:`SafeText` on Python 3.\n+\n+.. class:: SafeText\n+\n+    .. versionadded:: 1.5\n+\n+    A :class:`str` (in Python 3) or :class:`unicode` (in Python 2) subclass\n+    that has been specifically marked as \"safe\" for HTML output purposes.\n \n .. class:: SafeUnicode\n \n-    A unicode subclass that has been specifically marked as \"safe\" for HTML\n-    output purposes.\n+    Historical name of :class:`SafeText`. Only available under Python 2.\n \n .. function:: mark_safe(s)\n "
        },
        {
            "sha": "c13c1c6f8610187cbd8afdaae945ef26e85fb279",
            "filename": "tests/regressiontests/i18n/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/547b181046539f548839e42544521503fbe4d821/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/547b181046539f548839e42544521503fbe4d821/tests%2Fregressiontests%2Fi18n%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Ftests.py?ref=547b181046539f548839e42544521503fbe4d821",
            "patch": "@@ -18,7 +18,7 @@\n     number_format)\n from django.utils.importlib import import_module\n from django.utils.numberformat import format as nformat\n-from django.utils.safestring import mark_safe, SafeString, SafeUnicode\n+from django.utils.safestring import mark_safe, SafeBytes, SafeString, SafeText\n from django.utils import six\n from django.utils.six import PY3\n from django.utils.translation import (ugettext, ugettext_lazy, activate,\n@@ -235,9 +235,9 @@ def test_safe_status(self):\n         s = mark_safe(str('Password'))\n         self.assertEqual(SafeString, type(s))\n         with translation.override('de', deactivate=True):\n-            self.assertEqual(SafeUnicode, type(ugettext(s)))\n-        self.assertEqual('aPassword', SafeString('a') + s)\n-        self.assertEqual('Passworda', s + SafeString('a'))\n+            self.assertEqual(SafeText, type(ugettext(s)))\n+        self.assertEqual('aPassword', SafeText('a') + s)\n+        self.assertEqual('Passworda', s + SafeText('a'))\n         self.assertEqual('Passworda', s + mark_safe('a'))\n         self.assertEqual('aPassword', mark_safe('a') + s)\n         self.assertEqual('as', mark_safe('a') + mark_safe('s'))\n@@ -897,9 +897,9 @@ def test_lazy(self):\n \n     def test_safestr(self):\n         c = Company(cents_paid=12, products_delivered=1)\n-        c.name = SafeUnicode('Iñtërnâtiônàlizætiøn1')\n+        c.name = SafeText('Iñtërnâtiônàlizætiøn1')\n         c.save()\n-        c.name = SafeString('Iñtërnâtiônàlizætiøn1'.encode('utf-8'))\n+        c.name = SafeBytes('Iñtërnâtiônàlizætiøn1'.encode('utf-8'))\n         c.save()\n \n "
        }
    ],
    "stats": {
        "total": 136,
        "additions": 82,
        "deletions": 54
    }
}