{
    "author": "adrianholovaty",
    "message": "Fixed #15704 -- Made cache tests more reusable by moving the backend path into a class attribute. Thanks for the patch, jonash\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16008 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "fd309996df3bbfd14aff6aee293582cc86f8fccc",
    "files": [
        {
            "sha": "c5349d54c7290764b121238658641655c3756e45",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 25,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/fd309996df3bbfd14aff6aee293582cc86f8fccc/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/fd309996df3bbfd14aff6aee293582cc86f8fccc/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=fd309996df3bbfd14aff6aee293582cc86f8fccc",
            "patch": "@@ -34,8 +34,10 @@ def m(n):\n class DummyCacheTests(unittest.TestCase):\n     # The Dummy cache backend doesn't really behave like a test backend,\n     # so it has different test requirements.\n+    backend_name = 'django.core.cache.backends.dummy.DummyCache'\n+\n     def setUp(self):\n-        self.cache = get_cache('django.core.cache.backends.dummy.DummyCache')\n+        self.cache = get_cache(self.backend_name)\n \n     def test_simple(self):\n         \"Dummy cache backend ignores cache set calls\"\n@@ -727,15 +729,17 @@ def custom_key_func(key, key_prefix, version):\n     return 'CUSTOM-' + '-'.join([key_prefix, str(version), key])\n \n class DBCacheTests(unittest.TestCase, BaseCacheTests):\n+    backend_name = 'django.core.cache.backends.db.DatabaseCache'\n+\n     def setUp(self):\n         # Spaces are used in the table name to ensure quoting/escaping is working\n         self._table_name = 'test cache table'\n         management.call_command('createcachetable', self._table_name, verbosity=0, interactive=False)\n-        self.cache = get_cache('django.core.cache.backends.db.DatabaseCache', LOCATION=self._table_name, OPTIONS={'MAX_ENTRIES': 30})\n-        self.prefix_cache = get_cache('django.core.cache.backends.db.DatabaseCache', LOCATION=self._table_name, KEY_PREFIX='cacheprefix')\n-        self.v2_cache = get_cache('django.core.cache.backends.db.DatabaseCache', LOCATION=self._table_name, VERSION=2)\n-        self.custom_key_cache = get_cache('django.core.cache.backends.db.DatabaseCache', LOCATION=self._table_name, KEY_FUNCTION=custom_key_func)\n-        self.custom_key_cache2 = get_cache('django.core.cache.backends.db.DatabaseCache', LOCATION=self._table_name, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n+        self.cache = get_cache(self.backend_name, LOCATION=self._table_name, OPTIONS={'MAX_ENTRIES': 30})\n+        self.prefix_cache = get_cache(self.backend_name, LOCATION=self._table_name, KEY_PREFIX='cacheprefix')\n+        self.v2_cache = get_cache(self.backend_name, LOCATION=self._table_name, VERSION=2)\n+        self.custom_key_cache = get_cache(self.backend_name, LOCATION=self._table_name, KEY_FUNCTION=custom_key_func)\n+        self.custom_key_cache2 = get_cache(self.backend_name, LOCATION=self._table_name, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n \n     def tearDown(self):\n         from django.db import connection\n@@ -746,20 +750,22 @@ def test_cull(self):\n         self.perform_cull_test(50, 29)\n \n     def test_zero_cull(self):\n-        self.cache = get_cache('django.core.cache.backends.db.DatabaseCache', LOCATION=self._table_name, OPTIONS={'MAX_ENTRIES': 30, 'CULL_FREQUENCY': 0})\n+        self.cache = get_cache(self.backend_name, LOCATION=self._table_name, OPTIONS={'MAX_ENTRIES': 30, 'CULL_FREQUENCY': 0})\n         self.perform_cull_test(50, 18)\n \n     def test_old_initialization(self):\n         self.cache = get_cache('db://%s?max_entries=30&cull_frequency=0' % self._table_name)\n         self.perform_cull_test(50, 18)\n \n class LocMemCacheTests(unittest.TestCase, BaseCacheTests):\n+    backend_name = 'django.core.cache.backends.locmem.LocMemCache'\n+\n     def setUp(self):\n-        self.cache = get_cache('django.core.cache.backends.locmem.LocMemCache', OPTIONS={'MAX_ENTRIES': 30})\n-        self.prefix_cache = get_cache('django.core.cache.backends.locmem.LocMemCache', KEY_PREFIX='cacheprefix')\n-        self.v2_cache = get_cache('django.core.cache.backends.locmem.LocMemCache', VERSION=2)\n-        self.custom_key_cache = get_cache('django.core.cache.backends.locmem.LocMemCache', OPTIONS={'MAX_ENTRIES': 30}, KEY_FUNCTION=custom_key_func)\n-        self.custom_key_cache2 = get_cache('django.core.cache.backends.locmem.LocMemCache', OPTIONS={'MAX_ENTRIES': 30}, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n+        self.cache = get_cache(self.backend_name, OPTIONS={'MAX_ENTRIES': 30})\n+        self.prefix_cache = get_cache(self.backend_name, KEY_PREFIX='cacheprefix')\n+        self.v2_cache = get_cache(self.backend_name, VERSION=2)\n+        self.custom_key_cache = get_cache(self.backend_name, OPTIONS={'MAX_ENTRIES': 30}, KEY_FUNCTION=custom_key_func)\n+        self.custom_key_cache2 = get_cache(self.backend_name, OPTIONS={'MAX_ENTRIES': 30}, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n \n         # LocMem requires a hack to make the other caches\n         # share a data store with the 'normal' cache.\n@@ -782,7 +788,7 @@ def test_cull(self):\n         self.perform_cull_test(50, 29)\n \n     def test_zero_cull(self):\n-        self.cache = get_cache('django.core.cache.backends.locmem.LocMemCache', OPTIONS={'MAX_ENTRIES': 30, 'CULL_FREQUENCY': 0})\n+        self.cache = get_cache(self.backend_name, OPTIONS={'MAX_ENTRIES': 30, 'CULL_FREQUENCY': 0})\n         self.perform_cull_test(50, 19)\n \n     def test_old_initialization(self):\n@@ -791,8 +797,8 @@ def test_old_initialization(self):\n \n     def test_multiple_caches(self):\n         \"Check that multiple locmem caches are isolated\"\n-        mirror_cache = get_cache('django.core.cache.backends.locmem.LocMemCache')\n-        other_cache = get_cache('django.core.cache.backends.locmem.LocMemCache', LOCATION='other')\n+        mirror_cache = get_cache(self.backend_name)\n+        other_cache = get_cache(self.backend_name, LOCATION='other')\n \n         self.cache.set('value1', 42)\n         self.assertEqual(mirror_cache.get('value1'), 42)\n@@ -803,13 +809,15 @@ def test_multiple_caches(self):\n # need to contain a cache backend setting that points at\n # your memcache server.\n class MemcachedCacheTests(unittest.TestCase, BaseCacheTests):\n+    backend_name = 'django.core.cache.backends.memcached.MemcachedCache'\n+\n     def setUp(self):\n         name = settings.CACHES[DEFAULT_CACHE_ALIAS]['LOCATION']\n-        self.cache = get_cache('django.core.cache.backends.memcached.MemcachedCache', LOCATION=name)\n-        self.prefix_cache = get_cache('django.core.cache.backends.memcached.MemcachedCache', LOCATION=name, KEY_PREFIX='cacheprefix')\n-        self.v2_cache = get_cache('django.core.cache.backends.memcached.MemcachedCache', LOCATION=name, VERSION=2)\n-        self.custom_key_cache = get_cache('django.core.cache.backends.memcached.MemcachedCache', LOCATION=name, KEY_FUNCTION=custom_key_func)\n-        self.custom_key_cache2 = get_cache('django.core.cache.backends.memcached.MemcachedCache', LOCATION=name, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n+        self.cache = get_cache(self.backend_name, LOCATION=name)\n+        self.prefix_cache = get_cache(self.backend_name, LOCATION=name, KEY_PREFIX='cacheprefix')\n+        self.v2_cache = get_cache(self.backend_name, LOCATION=name, VERSION=2)\n+        self.custom_key_cache = get_cache(self.backend_name, LOCATION=name, KEY_FUNCTION=custom_key_func)\n+        self.custom_key_cache2 = get_cache(self.backend_name, LOCATION=name, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n \n     def tearDown(self):\n         self.cache.clear()\n@@ -835,13 +843,15 @@ class FileBasedCacheTests(unittest.TestCase, BaseCacheTests):\n     \"\"\"\n     Specific test cases for the file-based cache.\n     \"\"\"\n+    backend_name = 'django.core.cache.backends.filebased.FileBasedCache'\n+\n     def setUp(self):\n         self.dirname = tempfile.mkdtemp()\n-        self.cache = get_cache('django.core.cache.backends.filebased.FileBasedCache', LOCATION=self.dirname, OPTIONS={'MAX_ENTRIES': 30})\n-        self.prefix_cache = get_cache('django.core.cache.backends.filebased.FileBasedCache', LOCATION=self.dirname, KEY_PREFIX='cacheprefix')\n-        self.v2_cache = get_cache('django.core.cache.backends.filebased.FileBasedCache', LOCATION=self.dirname, VERSION=2)\n-        self.custom_key_cache = get_cache('django.core.cache.backends.filebased.FileBasedCache', LOCATION=self.dirname, KEY_FUNCTION=custom_key_func)\n-        self.custom_key_cache2 = get_cache('django.core.cache.backends.filebased.FileBasedCache', LOCATION=self.dirname, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n+        self.cache = get_cache(self.backend_name, LOCATION=self.dirname, OPTIONS={'MAX_ENTRIES': 30})\n+        self.prefix_cache = get_cache(self.backend_name, LOCATION=self.dirname, KEY_PREFIX='cacheprefix')\n+        self.v2_cache = get_cache(self.backend_name, LOCATION=self.dirname, VERSION=2)\n+        self.custom_key_cache = get_cache(self.backend_name, LOCATION=self.dirname, KEY_FUNCTION=custom_key_func)\n+        self.custom_key_cache2 = get_cache(self.backend_name, LOCATION=self.dirname, KEY_FUNCTION='regressiontests.cache.tests.custom_key_func')\n \n     def tearDown(self):\n         self.cache.clear()"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 35,
        "deletions": 25
    }
}