{
    "author": "freakboy3742",
    "message": "Fixed #14711 -- Corrected the calculation for the previous month in generic date views. Thanks to msundstr for the report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15438 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d89ad6423cec80c7550fb0a45d6cdf7b7b31564e",
    "files": [
        {
            "sha": "fa8d6e85060ac067492462ca870c3a456cc0bb5f",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/d89ad6423cec80c7550fb0a45d6cdf7b7b31564e/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/d89ad6423cec80c7550fb0a45d6cdf7b7b31564e/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=d89ad6423cec80c7550fb0a45d6cdf7b7b31564e",
            "patch": "@@ -70,7 +70,7 @@ def get_previous_month(self, date):\n         Get the previous valid month.\n         \"\"\"\n         first_day, last_day = _month_bounds(date)\n-        prev = (first_day - datetime.timedelta(days=1)).replace(day=1)\n+        prev = (first_day - datetime.timedelta(days=1))\n         return _get_next_prev_month(self, prev, is_previous=True, use_first_day=True)\n \n \n@@ -516,7 +516,7 @@ def _get_next_prev_month(generic_view, naive_result, is_previous, use_first_day)\n     This is a bit complicated since it handles both next and previous months\n     and days (for MonthArchiveView and DayArchiveView); hence the coupling to generic_view.\n \n-    However in essance the logic comes down to:\n+    However in essence the logic comes down to:\n \n         * If allow_empty and allow_future are both true, this is easy: just\n           return the naive result (just the next/previous day or month,\n@@ -546,7 +546,7 @@ def _get_next_prev_month(generic_view, naive_result, is_previous, use_first_day)\n     # whose date_field is at least (greater than/less than) the given\n     # naive result\n     else:\n-        # Construct a lookup and an ordering depending on weather we're doing\n+        # Construct a lookup and an ordering depending on whether we're doing\n         # a previous date or a next date lookup.\n         if is_previous:\n             lookup = {'%s__lte' % date_field: naive_result}\n@@ -569,7 +569,7 @@ def _get_next_prev_month(generic_view, naive_result, is_previous, use_first_day)\n         result = result.date()\n \n     # For month views, we always want to have a date that's the first of the\n-    # month for consistancy's sake.\n+    # month for consistency's sake.\n     if result and use_first_day:\n         result = result.replace(day=1)\n "
        },
        {
            "sha": "aa453ba2f23b137c0c5361416170cd70c2fc9e48",
            "filename": "tests/regressiontests/generic_views/dates.py",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/d89ad6423cec80c7550fb0a45d6cdf7b7b31564e/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/d89ad6423cec80c7550fb0a45d6cdf7b7b31564e/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Fdates.py?ref=d89ad6423cec80c7550fb0a45d6cdf7b7b31564e",
            "patch": "@@ -198,6 +198,29 @@ def test_month_view_invalid_pattern(self):\n         res = self.client.get('/dates/books/2007/no_month/')\n         self.assertEqual(res.status_code, 404)\n \n+    def test_previous_month_without_content(self):\n+        \"Content can exist on any day of the previous month. Refs #14711\"\n+        self.pubdate_list = [\n+            datetime.date(2010, month, day)\n+            for month,day in ((9,1), (10,2), (11,3))\n+        ]\n+        for pubdate in self.pubdate_list:\n+            name = str(pubdate)\n+            Book.objects.create(name=name, slug=name, pages=100, pubdate=pubdate)\n+\n+        res = self.client.get('/dates/books/2010/nov/allow_empty/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['previous_month'], datetime.date(2010,10,1))\n+        # The following test demonstrates the bug\n+        res = self.client.get('/dates/books/2010/nov/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['previous_month'], datetime.date(2010,10,1))\n+        # The bug does not occur here because a Book with pubdate of Sep 1 exists\n+        res = self.client.get('/dates/books/2010/oct/')\n+        self.assertEqual(res.status_code, 200)\n+        self.assertEqual(res.context['previous_month'], datetime.date(2010,9,1))\n+\n+\n class WeekArchiveViewTests(TestCase):\n     fixtures = ['generic-views-test-data.json']\n     urls = 'regressiontests.generic_views.urls'\n@@ -359,3 +382,4 @@ def test_date_detail_allow_future(self):\n \n     def test_invalid_url(self):\n         self.assertRaises(AttributeError, self.client.get, \"/dates/books/2008/oct/01/nopk/\")\n+"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 28,
        "deletions": 4
    }
}