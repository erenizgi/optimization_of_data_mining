{
    "author": "ramiro",
    "message": "Fixed #13968 -- Fixed SelectDateWidget processing of an invalid date input value when USE_L10N is on, for consistency with its behavior when USE_L10N=False (now the form field reports the validation error in both cases). Thanks mitar for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15416 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2d7049c4ee45e8d4820cdf8106a41a9f4a8331da",
    "files": [
        {
            "sha": "0cd88b8170e390179d7fc4a2a973061209772d2f",
            "filename": "django/forms/extras/widgets.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/2d7049c4ee45e8d4820cdf8106a41a9f4a8331da/django%2Fforms%2Fextras%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/2d7049c4ee45e8d4820cdf8106a41a9f4a8331da/django%2Fforms%2Fextras%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fextras%2Fwidgets.py?ref=2d7049c4ee45e8d4820cdf8106a41a9f4a8331da",
            "patch": "@@ -50,7 +50,7 @@ def render(self, name, value, attrs=None):\n                         input_format = get_format('DATE_INPUT_FORMATS')[0]\n                         # Python 2.4 compatibility:\n                         #     v = datetime.datetime.strptime(value, input_format)\n-                        # would be clearer, but datetime.strptime was added in \n+                        # would be clearer, but datetime.strptime was added in\n                         # Python 2.5\n                         v = datetime.datetime(*(time.strptime(value, input_format)[0:6]))\n                         year_val, month_val, day_val = v.year, v.month, v.day\n@@ -99,7 +99,7 @@ def value_from_datadict(self, data, files, name):\n                 try:\n                     date_value = datetime.date(int(y), int(m), int(d))\n                 except ValueError:\n-                    pass\n+                    return '%s-%s-%s' % (y, m, d)\n                 else:\n                     date_value = datetime_safe.new_date(date_value)\n                     return date_value.strftime(input_format)"
        },
        {
            "sha": "787a129338a088f72514a23e0a20beb459a6b389",
            "filename": "tests/regressiontests/forms/tests/extra.py",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/2d7049c4ee45e8d4820cdf8106a41a9f4a8331da/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/2d7049c4ee45e8d4820cdf8106a41a9f4a8331da/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py?ref=2d7049c4ee45e8d4820cdf8106a41a9f4a8331da",
            "patch": "@@ -1,19 +1,18 @@\n # -*- coding: utf-8 -*-\n import datetime\n-from decimal import Decimal\n-import re\n import time\n from django.conf import settings\n from django.forms import *\n from django.forms.extras import SelectDateWidget\n from django.forms.util import ErrorList\n-from django.test import TestCase\n from django.utils import translation\n from django.utils import unittest\n from django.utils.encoding import force_unicode\n from django.utils.encoding import smart_unicode\n from error_messages import AssertFormErrorsMixin\n \n+class GetDate(Form):\n+    mydate = DateField(widget=SelectDateWidget)\n \n class FormsExtraTestCase(unittest.TestCase, AssertFormErrorsMixin):\n     ###############\n@@ -338,9 +337,6 @@ def test_selectdate(self):\n <option value=\"2016\">2016</option>\n </select>\"\"\")\n \n-        class GetDate(Form):\n-            mydate = DateField(widget=SelectDateWidget)\n-\n         a = GetDate({'mydate_month':'4', 'mydate_day':'1', 'mydate_year':'2008'})\n         self.assertTrue(a.is_valid())\n         self.assertEqual(a.cleaned_data['mydate'], datetime.date(2008, 4, 1))\n@@ -355,6 +351,11 @@ class GetDate(Form):\n         self.assertTrue(b.is_valid())\n         self.assertEqual(b.cleaned_data['mydate'], datetime.date(2008, 4, 1))\n \n+        # Invalid dates shouldn't be allowed\n+        c = GetDate({'mydate_month':'2', 'mydate_day':'31', 'mydate_year':'2010'})\n+        self.assertFalse(c.is_valid())\n+        self.assertEqual(c.errors, {'mydate': [u'Enter a valid date.']})\n+\n     def test_multiwidget(self):\n         # MultiWidget and MultiValueField #############################################\n         # MultiWidgets are widgets composed of other widgets. They are usually\n@@ -608,3 +609,10 @@ def test_l10n(self):\n         # Years before 1900 work\n         w = SelectDateWidget(years=('1899',))\n         self.assertEqual(w.value_from_datadict({'date_year': '1899', 'date_month': '8', 'date_day': '13'}, {}, 'date'), '13-08-1899')\n+\n+    def test_l10n_invalid_date_in(self):\n+        # Invalid dates shouldn't be allowed\n+        a = GetDate({'mydate_month':'2', 'mydate_day':'31', 'mydate_year':'2010'})\n+        self.assertFalse(a.is_valid())\n+        # 'Geef een geldige datum op.' = 'Enter a valid date.'\n+        self.assertEqual(a.errors, {'mydate': [u'Geef een geldige datum op.']})"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 16,
        "deletions": 8
    }
}