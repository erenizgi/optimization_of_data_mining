{
    "author": "jezdez",
    "message": "Fixed #17717 (again) -- Used the new API for concrete models added in r17573. Many thanks to Simon Charette and Anssi Kääriäinen.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17643 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "dd441701ced9621f184f8e601339cfb9c16a844b",
    "files": [
        {
            "sha": "dbe7787726d9726831da4bb2db76c5cb08c80183",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/dd441701ced9621f184f8e601339cfb9c16a844b/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/dd441701ced9621f184f8e601339cfb9c16a844b/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=dd441701ced9621f184f8e601339cfb9c16a844b",
            "patch": "@@ -43,16 +43,16 @@ def serialize(self, queryset, **options):\n             self.start_object(obj)\n             # Use the concrete parent class' _meta instead of the object's _meta\n             # This is to avoid local_fields problems for proxy models. Refs #17717.\n-            concrete_class = obj._meta.proxy_for_model or obj.__class__\n-            for field in concrete_class._meta.local_fields:\n+            concrete_model = obj._meta.concrete_model\n+            for field in concrete_model._meta.local_fields:\n                 if field.serialize:\n                     if field.rel is None:\n                         if self.selected_fields is None or field.attname in self.selected_fields:\n                             self.handle_field(obj, field)\n                     else:\n                         if self.selected_fields is None or field.attname[:-3] in self.selected_fields:\n                             self.handle_fk_field(obj, field)\n-            for field in concrete_class._meta.many_to_many:\n+            for field in concrete_model._meta.many_to_many:\n                 if field.serialize:\n                     if self.selected_fields is None or field.attname in self.selected_fields:\n                         self.handle_m2m_field(obj, field)"
        },
        {
            "sha": "f366f90806b9797d24d022d1955c361035070394",
            "filename": "tests/regressiontests/serializers_regress/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/dd441701ced9621f184f8e601339cfb9c16a844b/tests%2Fregressiontests%2Fserializers_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/dd441701ced9621f184f8e601339cfb9c16a844b/tests%2Fregressiontests%2Fserializers_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Fmodels.py?ref=dd441701ced9621f184f8e601339cfb9c16a844b",
            "patch": "@@ -263,6 +263,10 @@ class ProxyBaseModel(BaseModel):\n     class Meta:\n         proxy = True\n \n+class ProxyProxyBaseModel(ProxyBaseModel):\n+    class Meta:\n+        proxy = True\n+\n class LengthModel(models.Model):\n     data = models.IntegerField()\n "
        },
        {
            "sha": "704e34b8ba2990054d9372c79409ced795c941d6",
            "filename": "tests/regressiontests/serializers_regress/tests.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/dd441701ced9621f184f8e601339cfb9c16a844b/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/dd441701ced9621f184f8e601339cfb9c16a844b/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fserializers_regress%2Ftests.py?ref=dd441701ced9621f184f8e601339cfb9c16a844b",
            "patch": "@@ -41,8 +41,8 @@\n     GenericIPAddressPKData, PhonePKData, PositiveIntegerPKData,\n     PositiveSmallIntegerPKData, SlugPKData, SmallPKData, USStatePKData,\n     AutoNowDateTimeData, ModifyingSaveData, InheritAbstractModel, BaseModel,\n-    ExplicitInheritBaseModel, InheritBaseModel, ProxyBaseModel, BigIntegerData,\n-    LengthModel, Tag, ComplexModel)\n+    ExplicitInheritBaseModel, InheritBaseModel, ProxyBaseModel,\n+    ProxyProxyBaseModel, BigIntegerData, LengthModel, Tag, ComplexModel)\n \n # A set of functions that can be used to recreate\n # test data objects of various kinds.\n@@ -410,11 +410,14 @@ def test_yaml_deserializer_exception(self):\n \n     def test_serialize_proxy_model(self):\n         BaseModel.objects.create(parent_data=1)\n-        base_objects  = BaseModel.objects.all()\n+        base_objects = BaseModel.objects.all()\n         proxy_objects = ProxyBaseModel.objects.all()\n-        base_data  = serializers.serialize(\"json\", base_objects)\n+        proxy_proxy_objects = ProxyProxyBaseModel.objects.all()\n+        base_data = serializers.serialize(\"json\", base_objects)\n         proxy_data = serializers.serialize(\"json\", proxy_objects)\n+        proxy_proxy_data = serializers.serialize(\"json\", proxy_proxy_objects)\n         self.assertEqual(base_data, proxy_data.replace('proxy', ''))\n+        self.assertEqual(base_data, proxy_proxy_data.replace('proxy', ''))\n \n \n def serializerTest(format, self):"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 14,
        "deletions": 7
    }
}