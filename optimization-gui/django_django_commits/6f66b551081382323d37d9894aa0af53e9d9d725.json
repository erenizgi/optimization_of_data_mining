{
    "author": "jezdez",
    "message": "Fixed #17255 -- Removed \"as\" prefix from new timezone template filter names for the sake of clarity. Cheers to Aymeric Augustin for bearing with me.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17107 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6f66b551081382323d37d9894aa0af53e9d9d725",
    "files": [
        {
            "sha": "551146472f726710361cd2376a26d94fb7c7196e",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -295,7 +295,7 @@ def display_for_field(value, field):\n     elif value is None:\n         return EMPTY_CHANGELIST_VALUE\n     elif isinstance(field, models.DateTimeField):\n-        return formats.localize(timezone.aslocaltime(value))\n+        return formats.localize(timezone.localtime(value))\n     elif isinstance(field, models.DateField) or isinstance(field, models.TimeField):\n         return formats.localize(value)\n     elif isinstance(field, models.DecimalField):"
        },
        {
            "sha": "40a577dbd83b0ab7f2826608cc0b5500d2d7b177",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -18,7 +18,7 @@\n from django.utils.formats import localize\n from django.utils.html import escape\n from django.utils.module_loading import module_has_submodule\n-from django.utils.timezone import aslocaltime\n+from django.utils.timezone import localtime\n \n \n TOKEN_TEXT = 0\n@@ -595,7 +595,7 @@ def resolve(self, context, ignore_failures=False):\n                 else:\n                     arg_vals.append(arg.resolve(context))\n             if getattr(func, 'expects_localtime', False):\n-                obj = aslocaltime(obj, context.use_tz)\n+                obj = localtime(obj, context.use_tz)\n             if getattr(func, 'needs_autoescape', False):\n                 new_obj = func(obj, autoescape=context.autoescape, *arg_vals)\n             else:\n@@ -856,7 +856,7 @@ def _render_value_in_context(value, context):\n     means escaping, if required, and conversion to a unicode object. If value\n     is a string, it is expected to have already been translated.\n     \"\"\"\n-    value = aslocaltime(value, use_tz=context.use_tz)\n+    value = localtime(value, use_tz=context.use_tz)\n     value = localize(value, use_l10n=context.use_l10n)\n     value = force_unicode(value)\n     if ((context.autoescape and not isinstance(value, SafeData)) or"
        },
        {
            "sha": "74aa82bcec98611fbfaabc3d588d85f8f2e20c06",
            "filename": "django/template/debug.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Ftemplate%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Ftemplate%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdebug.py?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -3,7 +3,7 @@\n from django.utils.html import escape\n from django.utils.safestring import SafeData, EscapeData\n from django.utils.formats import localize\n-from django.utils.timezone import aslocaltime\n+from django.utils.timezone import localtime\n \n \n class DebugLexer(Lexer):\n@@ -82,7 +82,7 @@ class DebugVariableNode(VariableNode):\n     def render(self, context):\n         try:\n             output = self.filter_expression.resolve(context)\n-            output = aslocaltime(output, use_tz=context.use_tz)\n+            output = localtime(output, use_tz=context.use_tz)\n             output = localize(output, use_l10n=context.use_l10n)\n             output = force_unicode(output)\n         except UnicodeDecodeError:"
        },
        {
            "sha": "48c511f2e0cb4c8fbb2559f57d1a736a364e9eaa",
            "filename": "django/templatetags/tz.py",
            "status": "modified",
            "additions": 20,
            "deletions": 9,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Ftemplatetags%2Ftz.py",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Ftemplatetags%2Ftz.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Ftz.py?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -13,6 +13,7 @@\n \n register = Library()\n \n+\n # HACK: datetime is an old-style class, create a new-style equivalent\n # so we can define additional attributes.\n class datetimeobject(datetime, object):\n@@ -22,23 +23,25 @@ class datetimeobject(datetime, object):\n # Template filters\n \n @register.filter\n-def aslocaltime(value):\n+def localtime(value):\n     \"\"\"\n     Converts a datetime to local time in the active time zone.\n \n     This only makes sense within a {% localtime off %} block.\n     \"\"\"\n-    return astimezone(value, timezone.get_current_timezone())\n+    return do_timezone(value, timezone.get_current_timezone())\n+\n \n @register.filter\n-def asutc(value):\n+def utc(value):\n     \"\"\"\n     Converts a datetime to UTC.\n     \"\"\"\n-    return astimezone(value, timezone.utc)\n+    return do_timezone(value, timezone.utc)\n \n-@register.filter\n-def astimezone(value, arg):\n+\n+@register.filter('timezone')\n+def do_timezone(value, arg):\n     \"\"\"\n     Converts a datetime to local time in a given time zone.\n \n@@ -103,6 +106,7 @@ def render(self, context):\n         context.use_tz = old_setting\n         return output\n \n+\n class TimezoneNode(Node):\n     \"\"\"\n     Template node class used by ``timezone_tag``.\n@@ -116,6 +120,7 @@ def render(self, context):\n             output = self.nodelist.render(context)\n         return output\n \n+\n class GetCurrentTimezoneNode(Node):\n     \"\"\"\n     Template node class used by ``get_current_timezone_tag``.\n@@ -127,6 +132,7 @@ def render(self, context):\n         context[self.variable] = timezone.get_current_timezone_name()\n         return ''\n \n+\n @register.tag('localtime')\n def localtime_tag(parser, token):\n     \"\"\"\n@@ -142,13 +148,15 @@ def localtime_tag(parser, token):\n     if len(bits) == 1:\n         use_tz = True\n     elif len(bits) > 2 or bits[1] not in ('on', 'off'):\n-        raise TemplateSyntaxError(\"%r argument should be 'on' or 'off'\" % bits[0])\n+        raise TemplateSyntaxError(\"%r argument should be 'on' or 'off'\" %\n+                                  bits[0])\n     else:\n         use_tz = bits[1] == 'on'\n     nodelist = parser.parse(('endlocaltime',))\n     parser.delete_first_token()\n     return LocalTimeNode(nodelist, use_tz)\n \n+\n @register.tag('timezone')\n def timezone_tag(parser, token):\n     \"\"\"\n@@ -167,12 +175,14 @@ def timezone_tag(parser, token):\n     \"\"\"\n     bits = token.split_contents()\n     if len(bits) != 2:\n-        raise TemplateSyntaxError(\"'%s' takes one argument (timezone)\" % bits[0])\n+        raise TemplateSyntaxError(\"'%s' takes one argument (timezone)\" %\n+                                  bits[0])\n     tz = parser.compile_filter(bits[1])\n     nodelist = parser.parse(('endtimezone',))\n     parser.delete_first_token()\n     return TimezoneNode(nodelist, tz)\n \n+\n @register.tag(\"get_current_timezone\")\n def get_current_timezone_tag(parser, token):\n     \"\"\"\n@@ -187,5 +197,6 @@ def get_current_timezone_tag(parser, token):\n     \"\"\"\n     args = token.contents.split()\n     if len(args) != 3 or args[1] != 'as':\n-        raise TemplateSyntaxError(\"'get_current_timezone' requires 'as variable' (got %r)\" % args)\n+        raise TemplateSyntaxError(\"'get_current_timezone' requires \"\n+                                  \"'as variable' (got %r)\" % args)\n     return GetCurrentTimezoneNode(args[2])"
        },
        {
            "sha": "9e78134d2a8622706fe9fadd40f5c19a0ede4a9a",
            "filename": "django/utils/timezone.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Futils%2Ftimezone.py",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/django%2Futils%2Ftimezone.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimezone.py?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -17,7 +17,7 @@\n __all__ = [\n     'utc', 'get_default_timezone', 'get_current_timezone',\n     'activate', 'deactivate', 'override',\n-    'aslocaltime', 'isnaive',\n+    'localtime', 'isnaive',\n ]\n \n \n@@ -198,7 +198,7 @@ def __exit__(self, exc_type, exc_value, traceback):\n \n # Utilities\n \n-def aslocaltime(value, use_tz=None):\n+def localtime(value, use_tz=None):\n     \"\"\"\n     Checks if value is a datetime and converts it to local time if necessary.\n "
        },
        {
            "sha": "a35d99a535a809f2ff1c11002e0903be9ce1a6f8",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -2108,6 +2108,7 @@ Otherwise, Django will use naive datetimes in local time.\n See also :setting:`TIME_ZONE`, :setting:`USE_I18N` and :setting:`USE_L10N`.\n \n .. note::\n+\n     The default :file:`settings.py` file created by\n     :djadmin:`django-admin.py startproject <startproject>` includes\n     ``USE_TZ = True`` for convenience."
        },
        {
            "sha": "2c0110f94af80412ba6238089ba8b0616629d3c8",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -660,7 +660,7 @@ For a complete discussion on the usage of the following see the\n     ``None``, the :ref:`current time zone <default-current-time-zone>` is unset\n     on entry with :func:`deactivate()` instead.\n \n-.. function:: aslocaltime(value, use_tz=None)\n+.. function:: localtime(value, use_tz=None)\n \n     This function is used by the template engine to convert datetimes to local\n     time where appropriate."
        },
        {
            "sha": "18d30b941ae4764167166cb3058af113b5cb65e8",
            "filename": "docs/topics/i18n/timezones.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 11,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/docs%2Ftopics%2Fi18n%2Ftimezones.txt",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/docs%2Ftopics%2Fi18n%2Ftimezones.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Ftimezones.txt?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -330,34 +330,36 @@ These filters accept both aware and naive datetimes. For conversion purposes,\n they assume that naive datetimes are in the default time zone. They always\n return aware datetimes.\n \n-.. templatefilter:: aslocaltime\n+.. templatefilter:: localtime\n \n-aslocaltime\n-~~~~~~~~~~~\n+localtime\n+~~~~~~~~~\n \n Forces conversion of a single value to the current time zone.\n \n For example::\n \n     {% load tz %}\n \n-    {{ value|aslocaltime }}\n+    {{ value|localtime }}\n \n-.. templatefilter:: asutc\n+.. templatefilter:: utc\n \n-asutc\n-~~~~~\n+utc\n+~~~\n \n Forces conversion of a single value to UTC.\n \n For example::\n \n     {% load tz %}\n \n-    {{ value|asutc }}\n+    {{ value|utc }}\n \n-astimezone\n-~~~~~~~~~~\n+.. templatefilter:: timezone\n+\n+timezone\n+~~~~~~~~\n \n Forces conversion of a single value to an arbitrary timezone.\n \n@@ -368,7 +370,7 @@ For example::\n \n     {% load tz %}\n \n-    {{ value|astimezone:\"Europe/Paris\" }}\n+    {{ value|timezone:\"Europe/Paris\" }}\n \n .. _time-zones-migration-guide:\n "
        },
        {
            "sha": "547680c7287a93b0e2bd8c9e647e944d15601478",
            "filename": "tests/modeltests/timezones/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/6f66b551081382323d37d9894aa0af53e9d9d725/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6f66b551081382323d37d9894aa0af53e9d9d725/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftimezones%2Ftests.py?ref=6f66b551081382323d37d9894aa0af53e9d9d725",
            "patch": "@@ -537,10 +537,10 @@ def test_localtime_templatetag_and_filters(self):\n             'naive': datetime.datetime(2011, 9, 1, 13, 20, 30),\n         }\n         templates = {\n-            'notag': Template(\"{% load tz %}{{ dt }}|{{ dt|aslocaltime }}|{{ dt|asutc }}|{{ dt|astimezone:ICT }}\"),\n-            'noarg': Template(\"{% load tz %}{% localtime %}{{ dt }}|{{ dt|aslocaltime }}|{{ dt|asutc }}|{{ dt|astimezone:ICT }}{% endlocaltime %}\"),\n-            'on':    Template(\"{% load tz %}{% localtime on %}{{ dt }}|{{ dt|aslocaltime }}|{{ dt|asutc }}|{{ dt|astimezone:ICT }}{% endlocaltime %}\"),\n-            'off':   Template(\"{% load tz %}{% localtime off %}{{ dt }}|{{ dt|aslocaltime }}|{{ dt|asutc }}|{{ dt|astimezone:ICT }}{% endlocaltime %}\"),\n+            'notag': Template(\"{% load tz %}{{ dt }}|{{ dt|localtime }}|{{ dt|utc }}|{{ dt|timezone:ICT }}\"),\n+            'noarg': Template(\"{% load tz %}{% localtime %}{{ dt }}|{{ dt|localtime }}|{{ dt|utc }}|{{ dt|timezone:ICT }}{% endlocaltime %}\"),\n+            'on':    Template(\"{% load tz %}{% localtime on %}{{ dt }}|{{ dt|localtime }}|{{ dt|utc }}|{{ dt|timezone:ICT }}{% endlocaltime %}\"),\n+            'off':   Template(\"{% load tz %}{% localtime off %}{{ dt }}|{{ dt|localtime }}|{{ dt|utc }}|{{ dt|timezone:ICT }}{% endlocaltime %}\"),\n         }\n \n         # Transform a list of keys in 'datetimes' to the expected template\n@@ -600,10 +600,10 @@ def t(*result):\n     @skipIf(pytz is None, \"this test requires pytz\")\n     def test_localtime_filters_with_pytz(self):\n         \"\"\"\n-        Test the |aslocaltime, |asutc, and |astimezone filters with pytz.\n+        Test the |localtime, |utc, and |timezone filters with pytz.\n         \"\"\"\n         # Use a pytz timezone as local time\n-        tpl = Template(\"{% load tz %}{{ dt|aslocaltime }}|{{ dt|asutc }}\")\n+        tpl = Template(\"{% load tz %}{{ dt|localtime }}|{{ dt|utc }}\")\n         ctx = Context({'dt': datetime.datetime(2011, 9, 1, 12, 20, 30)})\n \n         timezone._localtime = None\n@@ -612,13 +612,13 @@ def test_localtime_filters_with_pytz(self):\n         timezone._localtime = None\n \n         # Use a pytz timezone as argument\n-        tpl = Template(\"{% load tz %}{{ dt|astimezone:tz }}\")\n+        tpl = Template(\"{% load tz %}{{ dt|timezone:tz }}\")\n         ctx = Context({'dt': datetime.datetime(2011, 9, 1, 13, 20, 30),\n                        'tz': pytz.timezone('Europe/Paris')})\n         self.assertEqual(tpl.render(ctx), \"2011-09-01T12:20:30+02:00\")\n \n         # Use a pytz timezone name as argument\n-        tpl = Template(\"{% load tz %}{{ dt|astimezone:'Europe/Paris' }}\")\n+        tpl = Template(\"{% load tz %}{{ dt|timezone:'Europe/Paris' }}\")\n         ctx = Context({'dt': datetime.datetime(2011, 9, 1, 13, 20, 30),\n                        'tz': pytz.timezone('Europe/Paris')})\n         self.assertEqual(tpl.render(ctx), \"2011-09-01T12:20:30+02:00\")\n@@ -629,17 +629,17 @@ def test_localtime_templatetag_invalid_argument(self):\n \n     def test_localtime_filters_do_not_raise_exceptions(self):\n         \"\"\"\n-        Test the |aslocaltime, |asutc, and |astimezone filters on bad inputs.\n+        Test the |localtime, |utc, and |timezone filters on bad inputs.\n         \"\"\"\n-        tpl = Template(\"{% load tz %}{{ dt }}|{{ dt|aslocaltime }}|{{ dt|asutc }}|{{ dt|astimezone:tz }}\")\n+        tpl = Template(\"{% load tz %}{{ dt }}|{{ dt|localtime }}|{{ dt|utc }}|{{ dt|timezone:tz }}\")\n         with self.settings(USE_TZ=True):\n             # bad datetime value\n             ctx = Context({'dt': None, 'tz': ICT})\n             self.assertEqual(tpl.render(ctx), \"None|||\")\n             ctx = Context({'dt': 'not a date', 'tz': ICT})\n             self.assertEqual(tpl.render(ctx), \"not a date|||\")\n             # bad timezone value\n-            tpl = Template(\"{% load tz %}{{ dt|astimezone:tz }}\")\n+            tpl = Template(\"{% load tz %}{{ dt|timezone:tz }}\")\n             ctx = Context({'dt': datetime.datetime(2011, 9, 1, 13, 20, 30), 'tz': None})\n             self.assertEqual(tpl.render(ctx), \"\")\n             ctx = Context({'dt': datetime.datetime(2011, 9, 1, 13, 20, 30), 'tz': 'not a tz'})"
        }
    ],
    "stats": {
        "total": 94,
        "additions": 54,
        "deletions": 40
    }
}