{
    "author": "claudep",
    "message": "[py3] Fixed encoding issues in cache key generation",
    "sha": "45baaabafb6cf911afad9ec63c86753b284f7269",
    "files": [
        {
            "sha": "06e8952bfb5fa6120c90e865fdfe91b3fdd1f90d",
            "filename": "django/core/cache/backends/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/45baaabafb6cf911afad9ec63c86753b284f7269/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/45baaabafb6cf911afad9ec63c86753b284f7269/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fbase.py?ref=45baaabafb6cf911afad9ec63c86753b284f7269",
            "patch": "@@ -1,9 +1,9 @@\n \"Base Cache class.\"\n+from __future__ import unicode_literals\n \n import warnings\n \n from django.core.exceptions import ImproperlyConfigured, DjangoRuntimeWarning\n-from django.utils.encoding import smart_bytes\n from django.utils.importlib import import_module\n \n class InvalidCacheBackendError(ImproperlyConfigured):\n@@ -23,7 +23,7 @@ def default_key_func(key, key_prefix, version):\n     the `key_prefix'. KEY_FUNCTION can be used to specify an alternate\n     function with custom key making behavior.\n     \"\"\"\n-    return ':'.join([key_prefix, str(version), smart_bytes(key)])\n+    return ':'.join([key_prefix, str(version), key])\n \n def get_key_func(key_func):\n     \"\"\"\n@@ -62,7 +62,7 @@ def __init__(self, params):\n         except (ValueError, TypeError):\n             self._cull_frequency = 3\n \n-        self.key_prefix = smart_bytes(params.get('KEY_PREFIX', ''))\n+        self.key_prefix = params.get('KEY_PREFIX', '')\n         self.version = params.get('VERSION', 1)\n         self.key_func = get_key_func(params.get('KEY_FUNCTION', None))\n "
        },
        {
            "sha": "edac6ec75df3c47ef33b5b7066f72b58a9102d02",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/45baaabafb6cf911afad9ec63c86753b284f7269/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/45baaabafb6cf911afad9ec63c86753b284f7269/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=45baaabafb6cf911afad9ec63c86753b284f7269",
            "patch": "@@ -16,6 +16,7 @@\n An example: i18n middleware would need to distinguish caches by the\n \"Accept-language\" header.\n \"\"\"\n+from __future__ import unicode_literals\n \n import hashlib\n import re\n@@ -170,7 +171,7 @@ def _i18n_cache_key_suffix(request, cache_key):\n         # User-defined tzinfo classes may return absolutely anything.\n         # Hence this paranoid conversion to create a valid cache key.\n         tz_name = force_text(get_current_timezone_name(), errors='ignore')\n-        cache_key += '.%s' % tz_name.encode('ascii', 'ignore').replace(' ', '_')\n+        cache_key += '.%s' % tz_name.encode('ascii', 'ignore').decode('ascii').replace(' ', '_')\n     return cache_key\n \n def _generate_cache_key(request, method, headerlist, key_prefix):"
        },
        {
            "sha": "4ffca2d4583b3abe1f40e57c23a5850dd6ae9366",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/45baaabafb6cf911afad9ec63c86753b284f7269/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/45baaabafb6cf911afad9ec63c86753b284f7269/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=45baaabafb6cf911afad9ec63c86753b284f7269",
            "patch": "@@ -1308,7 +1308,7 @@ def test_cache_key_i18n_timezone(self):\n         # This is tightly coupled to the implementation,\n         # but it's the most straightforward way to test the key.\n         tz = force_text(timezone.get_current_timezone_name(), errors='ignore')\n-        tz = tz.encode('ascii', 'ignore').replace(' ', '_')\n+        tz = tz.encode('ascii', 'ignore').decode('ascii').replace(' ', '_')\n         response = HttpResponse()\n         key = learn_cache_key(request, response)\n         self.assertIn(tz, key, \"Cache keys should include the time zone name when time zones are active\")\n@@ -1320,7 +1320,7 @@ def test_cache_key_no_i18n (self):\n         request = self._get_request()\n         lang = translation.get_language()\n         tz = force_text(timezone.get_current_timezone_name(), errors='ignore')\n-        tz = tz.encode('ascii', 'ignore').replace(' ', '_')\n+        tz = tz.encode('ascii', 'ignore').decode('ascii').replace(' ', '_')\n         response = HttpResponse()\n         key = learn_cache_key(request, response)\n         self.assertNotIn(lang, key, \"Cache keys shouldn't include the language name when i18n isn't active\")"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 7,
        "deletions": 6
    }
}