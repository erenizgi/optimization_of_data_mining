{
    "author": "akaariai",
    "message": "Moved F() '&' and '|' to .bitand() and .bitor()\n\nDone for consistency with Q() expressions and QuerySet combining. This\nwill allow usage of '&' and '|' as boolean logical operators in the\nfuture. Refs #16211.",
    "sha": "b625e8272bd41714c838cfda3fb54e1f5177f009",
    "files": [
        {
            "sha": "30c44bacdef35341cd8c6a73e52bc32c35e15b2d",
            "filename": "django/db/models/expressions.py",
            "status": "modified",
            "additions": 23,
            "deletions": 7,
            "changes": 30,
            "blob_url": "https://github.com/django/django/blob/b625e8272bd41714c838cfda3fb54e1f5177f009/django%2Fdb%2Fmodels%2Fexpressions.py",
            "raw_url": "https://github.com/django/django/raw/b625e8272bd41714c838cfda3fb54e1f5177f009/django%2Fdb%2Fmodels%2Fexpressions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fexpressions.py?ref=b625e8272bd41714c838cfda3fb54e1f5177f009",
            "patch": "@@ -14,9 +14,11 @@ class ExpressionNode(tree.Node):\n                 # because it can be used in strings that also\n                 # have parameter substitution.\n \n-    # Bitwise operators\n-    AND = '&'\n-    OR = '|'\n+    # Bitwise operators - note that these are generated by .bitand()\n+    # and .bitor(), the '&' and '|' are reserved for boolean operator\n+    # usage.\n+    BITAND = '&'\n+    BITOR = '|'\n \n     def __init__(self, children=None, connector=None, negated=False):\n         if children is not None and len(children) > 1 and connector is None:\n@@ -66,10 +68,20 @@ def __mod__(self, other):\n         return self._combine(other, self.MOD, False)\n \n     def __and__(self, other):\n-        return self._combine(other, self.AND, False)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n+\n+    def bitand(self, other):\n+        return self._combine(other, self.BITAND, False)\n \n     def __or__(self, other):\n-        return self._combine(other, self.OR, False)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n+\n+    def bitor(self, other):\n+        return self._combine(other, self.BITOR, False)\n \n     def __radd__(self, other):\n         return self._combine(other, self.ADD, True)\n@@ -88,10 +100,14 @@ def __rmod__(self, other):\n         return self._combine(other, self.MOD, True)\n \n     def __rand__(self, other):\n-        return self._combine(other, self.AND, True)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n \n     def __ror__(self, other):\n-        return self._combine(other, self.OR, True)\n+        raise NotImplementedError(\n+            \"Use .bitand() and .bitor() for bitwise logical operations.\"\n+        )\n \n     def prepare_database_save(self, unused):\n         return self"
        },
        {
            "sha": "263392fdc735b4f63f48981e63a0224b7e6ced74",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/b625e8272bd41714c838cfda3fb54e1f5177f009/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/b625e8272bd41714c838cfda3fb54e1f5177f009/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=b625e8272bd41714c838cfda3fb54e1f5177f009",
            "patch": "@@ -438,6 +438,12 @@ Miscellaneous\n   needs. The new default value is `0666` (octal) and the current umask value\n   is first masked out.\n \n+* The :ref:`F() expressions <query-expressions>` supported bitwise operators by\n+  ``&`` and ``|``. These operators are now available using ``.bitand()`` and\n+  ``.bitor()`` instead. The removal of ``&`` and ``|`` was done to be consistent with\n+  :ref:`Q() expressions <complex-lookups-with-q>` and ``QuerySet`` combining where\n+  the operators are used as boolean AND and OR operators.\n+\n Features deprecated in 1.5\n ==========================\n "
        },
        {
            "sha": "543edf628073d2ee8b9d4cc02179e7e02f9ebf99",
            "filename": "docs/topics/db/queries.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/b625e8272bd41714c838cfda3fb54e1f5177f009/docs%2Ftopics%2Fdb%2Fqueries.txt",
            "raw_url": "https://github.com/django/django/raw/b625e8272bd41714c838cfda3fb54e1f5177f009/docs%2Ftopics%2Fdb%2Fqueries.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Fqueries.txt?ref=b625e8272bd41714c838cfda3fb54e1f5177f009",
            "patch": "@@ -640,6 +640,18 @@ that were modified more than 3 days after they were published::\n     >>> from datetime import timedelta\n     >>> Entry.objects.filter(mod_date__gt=F('pub_date') + timedelta(days=3))\n \n+.. versionadded:: 1.5\n+    ``.bitand()`` and ``.bitor()``\n+\n+The ``F()`` objects now support bitwise operations by ``.bitand()`` and\n+``.bitor()``, for example::\n+\n+    >>> F('somefield').bitand(16)\n+\n+.. versionchanged:: 1.5\n+    The previously undocumented operators ``&`` and ``|`` no longer produce\n+    bitwise operations, use ``.bitand()`` and ``.bitor()`` instead.\n+\n The pk lookup shortcut\n ----------------------\n "
        },
        {
            "sha": "06d97d2b3204815dbe79d8ed846a04ddb2eaf040",
            "filename": "tests/regressiontests/expressions_regress/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 16,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/b625e8272bd41714c838cfda3fb54e1f5177f009/tests%2Fregressiontests%2Fexpressions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b625e8272bd41714c838cfda3fb54e1f5177f009/tests%2Fregressiontests%2Fexpressions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fexpressions_regress%2Ftests.py?ref=b625e8272bd41714c838cfda3fb54e1f5177f009",
            "patch": "@@ -128,15 +128,15 @@ def test_lefthand_modulo(self):\n \n     def test_lefthand_bitwise_and(self):\n         # LH Bitwise ands on integers\n-        Number.objects.filter(pk=self.n.pk).update(integer=F('integer') & 56)\n+        Number.objects.filter(pk=self.n.pk).update(integer=F('integer').bitand(56))\n \n         self.assertEqual(Number.objects.get(pk=self.n.pk).integer, 40)\n         self.assertEqual(Number.objects.get(pk=self.n.pk).float, Approximate(15.500, places=3))\n \n     @skipUnlessDBFeature('supports_bitwise_or')\n     def test_lefthand_bitwise_or(self):\n         # LH Bitwise or on integers\n-        Number.objects.filter(pk=self.n.pk).update(integer=F('integer') | 48)\n+        Number.objects.filter(pk=self.n.pk).update(integer=F('integer').bitor(48))\n \n         self.assertEqual(Number.objects.get(pk=self.n.pk).integer, 58)\n         self.assertEqual(Number.objects.get(pk=self.n.pk).float, Approximate(15.500, places=3))\n@@ -181,20 +181,6 @@ def test_right_hand_modulo(self):\n         self.assertEqual(Number.objects.get(pk=self.n.pk).integer, 27)\n         self.assertEqual(Number.objects.get(pk=self.n.pk).float, Approximate(15.500, places=3))\n \n-    def test_right_hand_bitwise_and(self):\n-        # RH Bitwise ands on integers\n-        Number.objects.filter(pk=self.n.pk).update(integer=15 & F('integer'))\n-\n-        self.assertEqual(Number.objects.get(pk=self.n.pk).integer, 10)\n-        self.assertEqual(Number.objects.get(pk=self.n.pk).float, Approximate(15.500, places=3))\n-\n-    @skipUnlessDBFeature('supports_bitwise_or')\n-    def test_right_hand_bitwise_or(self):\n-        # RH Bitwise or on integers\n-        Number.objects.filter(pk=self.n.pk).update(integer=15 | F('integer'))\n-\n-        self.assertEqual(Number.objects.get(pk=self.n.pk).integer, 47)\n-        self.assertEqual(Number.objects.get(pk=self.n.pk).float, Approximate(15.500, places=3))\n \n class FTimeDeltaTests(TestCase):\n "
        }
    ],
    "stats": {
        "total": 66,
        "additions": 43,
        "deletions": 23
    }
}