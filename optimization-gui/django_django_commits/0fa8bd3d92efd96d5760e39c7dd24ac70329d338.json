{
    "author": "jezdez",
    "message": "Fixed #15920 -- Removed COMMENTS_BANNED_USERS_GROUP setting in favor of the established comments app customization. Thanks, Daniel Lindsley.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16124 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0fa8bd3d92efd96d5760e39c7dd24ac70329d338",
    "files": [
        {
            "sha": "1ab9b498a9e7f36741427bbddb55ef33c0aacfa4",
            "filename": "django/conf/global_settings.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0fa8bd3d92efd96d5760e39c7dd24ac70329d338/django%2Fconf%2Fglobal_settings.py",
            "raw_url": "https://github.com/django/django/raw/0fa8bd3d92efd96d5760e39c7dd24ac70329d338/django%2Fconf%2Fglobal_settings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fglobal_settings.py?ref=0fa8bd3d92efd96d5760e39c7dd24ac70329d338",
            "patch": "@@ -453,10 +453,6 @@\n # 'hasNoProfanities' validator. All of these should be in lowercase.\n PROFANITIES_LIST = ()\n \n-# The group ID that designates which users are banned.\n-# Set to None if you're not using it.\n-COMMENTS_BANNED_USERS_GROUP = None\n-\n ##################\n # AUTHENTICATION #\n ##################"
        },
        {
            "sha": "db4b2f818e8db6469d472d9809cf537055329601",
            "filename": "django/contrib/comments/feeds.py",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0fa8bd3d92efd96d5760e39c7dd24ac70329d338/django%2Fcontrib%2Fcomments%2Ffeeds.py",
            "raw_url": "https://github.com/django/django/raw/0fa8bd3d92efd96d5760e39c7dd24ac70329d338/django%2Fcontrib%2Fcomments%2Ffeeds.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Ffeeds.py?ref=0fa8bd3d92efd96d5760e39c7dd24ac70329d338",
            "patch": "@@ -28,10 +28,6 @@ def items(self):\n             is_public = True,\n             is_removed = False,\n         )\n-        if getattr(settings, 'COMMENTS_BANNED_USERS_GROUP', None):\n-            where = ['user_id NOT IN (SELECT user_id FROM auth_user_groups WHERE group_id = %s)']\n-            params = [settings.COMMENTS_BANNED_USERS_GROUP]\n-            qs = qs.extra(where=where, params=params)\n         return qs.order_by('-submit_date')[:40]\n \n     def item_pubdate(self, item):"
        },
        {
            "sha": "617c3ad1384dc747f047cbaeb2688ae0349773b8",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/0fa8bd3d92efd96d5760e39c7dd24ac70329d338/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/0fa8bd3d92efd96d5760e39c7dd24ac70329d338/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=0fa8bd3d92efd96d5760e39c7dd24ac70329d338",
            "patch": "@@ -117,3 +117,45 @@ subsequently raise a 404. Requesting ``/notaflatpageoravalidurl`` now will\n immediately raise a 404. Additionally redirects returned by flatpages are now\n permanent (301 status code) to match the behaviour of the\n :class:`~django.middleware.common.CommonMiddleware`.\n+\n+`COMMENTS_BANNED_USERS_GROUP` setting\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Django's :doc:`comments app </ref/contrib/comments/index>` has historically\n+supported excluding the comments of a special user group but never documented\n+the feature properly and didn't enforce the exclusion in other parts of the\n+app, e.g. the template tags. To fix this problem the code was removed from\n+the feed class.\n+\n+If you rely on the feature and want to restore the old behaviour, simply use\n+a custom comment model manager to exclude the user group, e.g.::\n+\n+    from django.conf import settings\n+    from django.contrib.comments.managers import CommentManager\n+\n+    class BanningCommentManager(CommentManager):\n+\n+        def get_query_set(self):\n+            qs = super(BanningCommentManager, self).get_query_set()\n+            if getattr(settings, 'COMMENTS_BANNED_USERS_GROUP', None):\n+                where = ['user_id NOT IN (SELECT user_id FROM auth_user_groups WHERE group_id = %s)']\n+                params = [settings.COMMENTS_BANNED_USERS_GROUP]\n+                qs = qs.extra(where=where, params=params)\n+            return qs\n+\n+Save this model manager in your custom comment app (e.g. in\n+``my_comments_app/managers.py``) and add it your\n+:ref:`custom comment app model <custom-comment-app-api>`::\n+\n+    from django.db import models\n+    from django.contrib.comments.models import Comment\n+\n+    from my_comments_app.managers import BanningCommentManager\n+\n+    class CommentWithTitle(Comment):\n+        title = models.CharField(max_length=300)\n+\n+        objects = BanningCommentManager()\n+\n+For more details see the docs about\n+:doc:`customizing the comments framework </ref/contrib/comments/custom>`."
        }
    ],
    "stats": {
        "total": 50,
        "additions": 42,
        "deletions": 8
    }
}