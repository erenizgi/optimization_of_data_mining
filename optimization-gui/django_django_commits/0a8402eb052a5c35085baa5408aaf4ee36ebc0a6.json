{
    "author": "zsiciarz",
    "message": "Test case and docs for custom context data in feeds\n\nThanks Paul Winkler for the initial patch. (Ref #18112).",
    "sha": "0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
    "files": [
        {
            "sha": "4abf1e53a9caf1615c42a38d4b043a4ad1cc9e60",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -100,6 +100,16 @@ def item_extra_kwargs(self, item):\n     def get_object(self, request, *args, **kwargs):\n         return None\n \n+    def get_context_data(self, **kwargs):\n+        \"\"\"\n+        Returns a dictionary to use as extra context if either\n+        ``self.description_template`` or ``self.item_template`` are used.\n+\n+        Default implementation preserves the old behavior\n+        of using {'obj': item, 'site': current_site} as the context.\n+        \"\"\"\n+        return {'obj': kwargs.get('item'), 'site': kwargs.get('site')}\n+\n     def get_feed(self, obj, request):\n         \"\"\"\n         Returns a feedgenerator.DefaultFeed object, fully populated, for\n@@ -146,12 +156,14 @@ def get_feed(self, obj, request):\n                 pass\n \n         for item in self.__get_dynamic_attr('items', obj):\n+            context = self.get_context_data(item=item, site=current_site,\n+                                            obj=obj, request=request)\n             if title_tmp is not None:\n-                title = title_tmp.render(RequestContext(request, {'obj': item, 'site': current_site}))\n+                title = title_tmp.render(RequestContext(request, context))\n             else:\n                 title = self.__get_dynamic_attr('item_title', item)\n             if description_tmp is not None:\n-                description = description_tmp.render(RequestContext(request, {'obj': item, 'site': current_site}))\n+                description = description_tmp.render(RequestContext(request, context))\n             else:\n                 description = self.__get_dynamic_attr('item_description', item)\n             link = add_domain("
        },
        {
            "sha": "02159c415b50e8b4682ad5cf87e19ef2bf6224da",
            "filename": "docs/ref/contrib/syndication.txt",
            "status": "modified",
            "additions": 54,
            "deletions": 0,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/docs%2Fref%2Fcontrib%2Fsyndication.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsyndication.txt?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -137,6 +137,51 @@ into those elements.\n \n   See `a complex example`_ below that uses a description template.\n \n+  There is also a way to pass additional information to title and description\n+  templates, if you need to supply more than the two variables mentioned\n+  before. You can provide your implementation of ``get_context_data`` method\n+  in your Feed subclass. For example::\n+\n+    from mysite.models import Article\n+    from django.contrib.syndication.views import Feed\n+\n+    class ArticlesFeed(Feed):\n+        title = \"My articles\"\n+        description_template = \"feeds/articles.html\"\n+\n+        def items(self):\n+            return Article.objects.order_by('-pub_date')[:5]\n+\n+        def get_context_data(self, **kwargs):\n+            context = super(ArticlesFeed, self).get_context_data(**kwargs)\n+            context['foo'] = 'bar'\n+            return context\n+\n+  And the template:\n+\n+  .. code-block:: html+django\n+\n+    Something about {{ foo }}: {{ obj.description }}\n+\n+  This method will be called once per each item in the list returned by\n+  ``items()`` with the following keyword arguments:\n+\n+  * ``item``: the current item. For backward compatibility reasons, the name\n+    of this context variable is ``{{ obj }}``.\n+\n+  * ``obj``: the object returned by ``get_object()``. By default this is not\n+    exposed to the templates to avoid confusion with ``{{ obj }}`` (see above),\n+    but you can use it in your implementation of ``get_context_data()``.\n+\n+  * ``site``: current site as described above.\n+\n+  * ``request``: current request.\n+\n+  The behavior of ``get_context_data()`` mimics that of\n+  :ref:`generic views <adding-extra-context>` - you're supposed to call\n+  ``super()`` to retrieve context data from parent class, add your data\n+  and return the modified dictionary.\n+\n * To specify the contents of ``<link>``, you have two options. For each item\n   in ``items()``, Django first tries calling the\n   ``item_link()`` method on the\n@@ -599,6 +644,15 @@ This example illustrates all possible attributes and methods for a\n \n         item_description = 'A description of the item.' # Hard-coded description.\n \n+        def get_context_data(self, **kwargs):\n+            \"\"\"\n+            Returns a dictionary to use as extra context if either\n+            description_template or item_template are used.\n+\n+            Default implementation preserves the old behavior\n+            of using {'obj': item, 'site': current_site} as the context.\n+            \"\"\"\n+\n         # ITEM LINK -- One of these three is required. The framework looks for\n         # them in this order.\n "
        },
        {
            "sha": "8695af7fe653074e739a04a97dd3c9df8d06c378",
            "filename": "docs/topics/class-based-views/generic-display.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/docs%2Ftopics%2Fclass-based-views%2Fgeneric-display.txt",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/docs%2Ftopics%2Fclass-based-views%2Fgeneric-display.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Fgeneric-display.txt?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -188,6 +188,8 @@ Providing a useful ``context_object_name`` is always a good idea. Your\n coworkers who design templates will thank you.\n \n \n+.. _adding-extra-context:\n+\n Adding extra context\n --------------------\n "
        },
        {
            "sha": "0956820bf0289bdd39971110ede9572e77904b08",
            "filename": "tests/regressiontests/syndication/feeds.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ffeeds.py",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ffeeds.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ffeeds.py?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -97,6 +97,19 @@ def item_title(self):\n         return \"Not in a template\"\n \n \n+class TemplateContextFeed(TestRss2Feed):\n+    \"\"\"\n+    A feed to test custom context data in templates for title or description.\n+    \"\"\"\n+    title_template = 'syndication/title_context.html'\n+    description_template = 'syndication/description_context.html'\n+\n+    def get_context_data(self, **kwargs):\n+        context = super(TemplateContextFeed, self).get_context_data(**kwargs)\n+        context['foo'] = 'bar'\n+        return context\n+\n+\n class NaiveDatesFeed(TestAtomFeed):\n     \"\"\"\n     A feed with naive (non-timezone-aware) dates."
        },
        {
            "sha": "319d84b1b03616ea1517613dfaf2bb01074889e1",
            "filename": "tests/regressiontests/syndication/templates/syndication/description_context.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ftemplates%2Fsyndication%2Fdescription_context.html",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ftemplates%2Fsyndication%2Fdescription_context.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ftemplates%2Fsyndication%2Fdescription_context.html?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -0,0 +1 @@\n+{{ obj }} (foo is {{ foo }})\n\\ No newline at end of file"
        },
        {
            "sha": "319d84b1b03616ea1517613dfaf2bb01074889e1",
            "filename": "tests/regressiontests/syndication/templates/syndication/title_context.html",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ftemplates%2Fsyndication%2Ftitle_context.html",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ftemplates%2Fsyndication%2Ftitle_context.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ftemplates%2Fsyndication%2Ftitle_context.html?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -0,0 +1 @@\n+{{ obj }} (foo is {{ foo }})\n\\ No newline at end of file"
        },
        {
            "sha": "e8fc6be420ebc840d4188f0c7052ed9ebcb54155",
            "filename": "tests/regressiontests/syndication/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Ftests.py?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -323,6 +323,22 @@ def test_template_feed(self):\n             'link': 'http://example.com/blog/1/',\n         })\n \n+    def test_template_context_feed(self):\n+        \"\"\"\n+        Test that custom context data can be passed to templates for title\n+        and description.\n+        \"\"\"\n+        response = self.client.get('/syndication/template_context/')\n+        doc = minidom.parseString(response.content)\n+        feed = doc.getElementsByTagName('rss')[0]\n+        chan = feed.getElementsByTagName('channel')[0]\n+        items = chan.getElementsByTagName('item')\n+\n+        self.assertChildNodeContent(items[0], {\n+            'title': 'My first entry (foo is bar)',\n+            'description': 'My first entry (foo is bar)',\n+        })\n+\n     def test_add_domain(self):\n         \"\"\"\n         Test add_domain() prefixes domains onto the correct URLs."
        },
        {
            "sha": "1dd7e92332c9678f39226d09bab4c951d6fc8362",
            "filename": "tests/regressiontests/syndication/urls.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/0a8402eb052a5c35085baa5408aaf4ee36ebc0a6/tests%2Fregressiontests%2Fsyndication%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsyndication%2Furls.py?ref=0a8402eb052a5c35085baa5408aaf4ee36ebc0a6",
            "patch": "@@ -21,4 +21,5 @@\n     (r'^syndication/feedurl/$', feeds.TestFeedUrlFeed()),\n     (r'^syndication/articles/$', feeds.ArticlesFeed()),\n     (r'^syndication/template/$', feeds.TemplateFeed()),\n+    (r'^syndication/template_context/$', feeds.TemplateContextFeed()),\n )"
        }
    ],
    "stats": {
        "total": 104,
        "additions": 102,
        "deletions": 2
    }
}