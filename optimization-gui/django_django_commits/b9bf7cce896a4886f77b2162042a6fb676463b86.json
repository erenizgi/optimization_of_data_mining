{
    "author": "carljm",
    "message": "Fixed #15169 -- Added conversion of 0/1 to False/True for MySQL GIS backend. Thanks zmsmith for report, and Ramiro for draft patch and review.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17632 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b9bf7cce896a4886f77b2162042a6fb676463b86",
    "files": [
        {
            "sha": "7079db9f6ac244a6a9464dfc4a40ce80712802cf",
            "filename": "django/contrib/gis/db/backends/mysql/compiler.py",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Fcompiler.py?ref=b9bf7cce896a4886f77b2162042a6fb676463b86",
            "patch": "@@ -0,0 +1,32 @@\n+from django.contrib.gis.db.models.sql.compiler import GeoSQLCompiler as BaseGeoSQLCompiler\n+from django.db.backends.mysql import compiler\n+\n+SQLCompiler = compiler.SQLCompiler\n+\n+class GeoSQLCompiler(BaseGeoSQLCompiler, SQLCompiler):\n+    def resolve_columns(self, row, fields=()):\n+        \"\"\"\n+        Integrate the cases handled both by the base GeoSQLCompiler and the\n+        main MySQL compiler (converting 0/1 to True/False for boolean fields).\n+\n+        Refs #15169.\n+\n+        \"\"\"\n+        row = BaseGeoSQLCompiler.resolve_columns(self, row, fields)\n+        return SQLCompiler.resolve_columns(self, row, fields)\n+\n+\n+class SQLInsertCompiler(compiler.SQLInsertCompiler, GeoSQLCompiler):\n+    pass\n+\n+class SQLDeleteCompiler(compiler.SQLDeleteCompiler, GeoSQLCompiler):\n+    pass\n+\n+class SQLUpdateCompiler(compiler.SQLUpdateCompiler, GeoSQLCompiler):\n+    pass\n+\n+class SQLAggregateCompiler(compiler.SQLAggregateCompiler, GeoSQLCompiler):\n+    pass\n+\n+class SQLDateCompiler(compiler.SQLDateCompiler, GeoSQLCompiler):\n+    pass"
        },
        {
            "sha": "c0e5aa6691b14d8830ad04a18286d563c0bc2698",
            "filename": "django/contrib/gis/db/backends/mysql/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py?ref=b9bf7cce896a4886f77b2162042a6fb676463b86",
            "patch": "@@ -5,7 +5,7 @@\n \n class MySQLOperations(DatabaseOperations, BaseSpatialOperations):\n \n-    compiler_module = 'django.contrib.gis.db.models.sql.compiler'\n+    compiler_module = 'django.contrib.gis.db.backends.mysql.compiler'\n     mysql = True\n     name = 'mysql'\n     select = 'AsText(%s)'"
        },
        {
            "sha": "79061e1cfc2a540f18c2cab349a182091fd21bb6",
            "filename": "django/contrib/gis/tests/geoapp/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Fmodels.py?ref=b9bf7cce896a4886f77b2162042a6fb676463b86",
            "patch": "@@ -34,6 +34,10 @@ class Track(models.Model):\n     objects = models.GeoManager()\n     def __unicode__(self): return self.name\n \n+class Truth(models.Model):\n+    val = models.BooleanField()\n+    objects = models.GeoManager()\n+\n if not spatialite:\n     class Feature(models.Model):\n         name = models.CharField(max_length=20)"
        },
        {
            "sha": "a9d802d8f18dd71fe85bfeb4d71429cf41f4e6ae",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/b9bf7cce896a4886f77b2162042a6fb676463b86/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=b9bf7cce896a4886f77b2162042a6fb676463b86",
            "patch": "@@ -7,7 +7,7 @@\n from django.db.models import Count\n from django.test import TestCase\n \n-from .models import City, PennsylvaniaCity, State\n+from .models import City, PennsylvaniaCity, State, Truth\n \n \n class GeoRegressionTests(TestCase):\n@@ -64,3 +64,17 @@ def test06_defer_or_only_with_annotate(self):\n         \"Regression for #16409. Make sure defer() and only() work with annotate()\"\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).defer('name')), list)\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).only('name')), list)\n+\n+    def test07_boolean_conversion(self):\n+        \"Testing Boolean value conversion with the spatial backend, see #15169.\"\n+        t1 = Truth.objects.create(val=True)\n+        t2 = Truth.objects.create(val=False)\n+\n+        val1 = Truth.objects.get(pk=1).val\n+        val2 = Truth.objects.get(pk=2).val\n+        # verify types -- should't be 0/1\n+        self.assertIsInstance(val1, bool)\n+        self.assertIsInstance(val2, bool)\n+        # verify values\n+        self.assertEqual(val1, True)\n+        self.assertEqual(val2, False)"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 52,
        "deletions": 2
    }
}