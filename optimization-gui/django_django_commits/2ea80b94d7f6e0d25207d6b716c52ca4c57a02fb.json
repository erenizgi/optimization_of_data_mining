{
    "author": "aaugustin",
    "message": "Fixed #19362 -- Detected invalid use of @python_2_unicode_compatible.\n\nThanks m3wolf for the report and akaariai for reproducing the problem.",
    "sha": "2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb",
    "files": [
        {
            "sha": "bf9854d2891e6589aca2360ca37a1ea2c8147e20",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb",
            "patch": "@@ -416,6 +416,11 @@ def __repr__(self):\n \n     def __str__(self):\n         if not six.PY3 and hasattr(self, '__unicode__'):\n+            if type(self).__unicode__ == Model.__str__:\n+                klass_name = type(self).__name__\n+                raise RuntimeError(\"%s.__unicode__ is aliased to __str__. Did\"\n+                                   \" you apply @python_2_unicode_compatible\"\n+                                   \" without defining __str__?\" % klass_name)\n             return force_text(self).encode('utf-8')\n         return '%s object' % self.__class__.__name__\n "
        },
        {
            "sha": "1c158ea008fad069ab6ab619745c86efd1aa8f54",
            "filename": "tests/modeltests/str/models.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb/tests%2Fmodeltests%2Fstr%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb/tests%2Fmodeltests%2Fstr%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fstr%2Fmodels.py?ref=2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb",
            "patch": "@@ -27,6 +27,14 @@ def __str__(self):\n         # in ASCII.\n         return self.headline\n \n+@python_2_unicode_compatible\n+class BrokenArticle(models.Model):\n+    headline = models.CharField(max_length=100)\n+    pub_date = models.DateTimeField()\n+\n+    def __unicode__(self):      # instead of __str__\n+        return self.headline\n+\n @python_2_unicode_compatible\n class InternationalArticle(models.Model):\n     headline = models.CharField(max_length=100)"
        },
        {
            "sha": "31869583aabd2824455e61a7394719a949506f9a",
            "filename": "tests/modeltests/str/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb/tests%2Fmodeltests%2Fstr%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb/tests%2Fmodeltests%2Fstr%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fstr%2Ftests.py?ref=2ea80b94d7f6e0d25207d6b716c52ca4c57a02fb",
            "patch": "@@ -7,7 +7,7 @@\n from django.utils import six\n from django.utils.unittest import skipIf\n \n-from .models import Article, InternationalArticle\n+from .models import Article, BrokenArticle, InternationalArticle\n \n \n class SimpleTests(TestCase):\n@@ -21,6 +21,16 @@ def test_basic(self):\n         self.assertEqual(str(a), str('Area man programs in Python'))\n         self.assertEqual(repr(a), str('<Article: Area man programs in Python>'))\n \n+    @skipIf(six.PY3, \"tests Model's default __str__ method under Python 2\")\n+    def test_broken(self):\n+        # Regression test for #19362.\n+        a = BrokenArticle.objects.create(\n+            headline='Girl wins €12.500 in lottery',\n+            pub_date=datetime.datetime(2005, 7, 28)\n+        )\n+        self.assertRaisesRegexp(RuntimeError, \"Did you apply \"\n+            \"@python_2_unicode_compatible without defining __str__\\?\", str, a)\n+\n     def test_international(self):\n         a = InternationalArticle.objects.create(\n             headline='Girl wins €12.500 in lottery',"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 24,
        "deletions": 1
    }
}