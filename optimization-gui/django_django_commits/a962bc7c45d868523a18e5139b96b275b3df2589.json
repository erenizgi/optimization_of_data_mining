{
    "author": "claudep",
    "message": "Updated User manager when testing custom AUTH_USER_MODEL\n\nThis is giving more real test conditions when AUTH_USER_MODEL is\nset with override_settings.",
    "sha": "a962bc7c45d868523a18e5139b96b275b3df2589",
    "files": [
        {
            "sha": "038c8980d9d9b063e6c871e1e3df374dab5b3509",
            "filename": "django/contrib/auth/tests/__init__.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/a962bc7c45d868523a18e5139b96b275b3df2589/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/a962bc7c45d868523a18e5139b96b275b3df2589/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2F__init__.py?ref=a962bc7c45d868523a18e5139b96b275b3df2589",
            "patch": "@@ -14,3 +14,16 @@\n from django.contrib.auth.tests.views import *\n \n # The password for the fixture data users is 'password'\n+\n+from django.dispatch import receiver\n+from django.test.signals import setting_changed\n+\n+\n+@receiver(setting_changed)\n+def user_model_swapped(**kwargs):\n+    if kwargs['setting'] == 'AUTH_USER_MODEL':\n+        from django.db.models.manager import ensure_default_manager\n+        from django.contrib.auth.models import User\n+        # Reset User manager\n+        setattr(User, 'objects', User._default_manager)\n+        ensure_default_manager(User)"
        },
        {
            "sha": "2c807cca517e2d5be3df2db7f4dedbf57cf3e78d",
            "filename": "django/contrib/auth/tests/basic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/a962bc7c45d868523a18e5139b96b275b3df2589/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/a962bc7c45d868523a18e5139b96b275b3df2589/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fbasic.py?ref=a962bc7c45d868523a18e5139b96b275b3df2589",
            "patch": "@@ -162,6 +162,8 @@ def test_get_user_model(self):\n     def test_swappable_user(self):\n         \"The current user model can be swapped out for another\"\n         self.assertEqual(get_user_model(), CustomUser)\n+        with self.assertRaises(AttributeError):\n+            User.objects.all()\n \n     @override_settings(AUTH_USER_MODEL='badsetting')\n     def test_swappable_user_bad_setting(self):"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
    }
}