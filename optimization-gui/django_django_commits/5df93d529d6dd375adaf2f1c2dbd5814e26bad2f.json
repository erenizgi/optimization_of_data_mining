{
    "author": "spookylukey",
    "message": "Documented the edge case of needing a view that is partly CSRF protected\n\nRefs #15518.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16189 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "5df93d529d6dd375adaf2f1c2dbd5814e26bad2f",
    "files": [
        {
            "sha": "8c003045608d763989f91070cb7f87324e9b5264",
            "filename": "docs/ref/contrib/csrf.txt",
            "status": "modified",
            "additions": 43,
            "deletions": 17,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/5df93d529d6dd375adaf2f1c2dbd5814e26bad2f/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "raw_url": "https://github.com/django/django/raw/5df93d529d6dd375adaf2f1c2dbd5814e26bad2f/docs%2Fref%2Fcontrib%2Fcsrf.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcsrf.txt?ref=5df93d529d6dd375adaf2f1c2dbd5814e26bad2f",
            "patch": "@@ -31,8 +31,8 @@ To enable CSRF protection for your views, follow these steps:\n        been dealt with.)\n \n        Alternatively, you can use the decorator\n-       ``django.views.decorators.csrf.csrf_protect`` on particular views you\n-       want to protect (see below).\n+       :func:`~django.views.decorators.csrf.csrf_protect` on particular views\n+       you want to protect (see below).\n \n     2. In any template that uses a POST form, use the :ttag:`csrf_token` tag inside\n        the ``<form>`` element if the form is for an internal URL, e.g.::\n@@ -126,26 +126,32 @@ protection.\n The decorator method\n --------------------\n \n+.. module:: django.views.decorators.csrf\n+\n Rather than adding ``CsrfViewMiddleware`` as a blanket protection, you can use\n the ``csrf_protect`` decorator, which has exactly the same functionality, on\n-particular views that need the protection.  It must be used **both** on views\n+particular views that need the protection. It must be used **both** on views\n that insert the CSRF token in the output, and on those that accept the POST form\n-data. (These are often the same view function, but not always).  It is used like\n-this::\n+data. (These are often the same view function, but not always).\n \n-    from django.views.decorators.csrf import csrf_protect\n-    from django.shortcuts import render\n+Use of the decorator by itself is **not recommended**, since if you forget to\n+use it, you will have a security hole. The 'belt and braces' strategy of using\n+both is fine, and will incur minimal overhead.\n \n-    @csrf_protect\n-    def my_view(request):\n-        c = {}\n-        # ...\n-        return render(request, \"a_template.html\", c)\n+.. function:: csrf_protect(view)\n \n-Use of the decorator is **not recommended** by itself, since if you forget to\n-use it, you will have a security hole.  The 'belt and braces' strategy of using\n-both is fine, and will incur minimal overhead.\n+    Decorator that provides the protection of ``CsrfViewMiddleware`` to a view.\n \n+    Usage::\n+\n+        from django.views.decorators.csrf import csrf_protect\n+        from django.shortcuts import render\n+\n+        @csrf_protect\n+        def my_view(request):\n+            c = {}\n+            # ...\n+            return render(request, \"a_template.html\", c)\n \n Subdomains\n ----------\n@@ -283,8 +289,6 @@ section.\n Utilities\n ---------\n \n-.. module:: django.views.decorators.csrf\n-\n .. function:: csrf_exempt(view)\n \n     This decorator marks a view as being exempt from the protection ensured by\n@@ -344,7 +348,29 @@ There may be some views that are unprotected and have been exempted by\n Solution: use :func:`~django.views.decorators.csrf.csrf_exempt` followed by\n :func:`~django.views.decorators.csrf.requires_csrf_token`.\n \n+View needs protection for one path\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+A view needs CRSF protection under one set of conditions only, and mustn't have\n+it for the rest of the time.\n+\n+Solution: use :func:`~django.views.decorators.csrf.csrf_exempt` for the whole\n+view function, and :func:`~django.views.decorators.csrf.csrf_protect` for the\n+path within it that needs protection. Example::\n+\n+    from django.views.decorators.csrf import csrf_exempt, csrf_protect\n+\n+    @csrf_exempt\n+    def my_view(request):\n+\n+        @csrf_protect\n+        def protected_path(request):\n+            do_something()\n \n+        if some_condition():\n+           return protected_path(request)\n+        else:\n+           do_something_else()\n \n Contrib and reusable apps\n ========================="
        }
    ],
    "stats": {
        "total": 60,
        "additions": 43,
        "deletions": 17
    }
}