{
    "author": "jphalip",
    "message": "Improved on r17454 to ensure that `collapse.js` only gets minified when `DEBUG` is `False`.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17455 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
    "files": [
        {
            "sha": "b08d1c84a58aa433fdf42089a1f4c5c29b331e64",
            "filename": "django/contrib/admin/helpers.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "raw_url": "https://github.com/django/django/raw/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fhelpers.py?ref=0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
            "patch": "@@ -11,6 +11,7 @@\n from django.utils.html import escape, conditional_escape\n from django.utils.safestring import mark_safe\n from django.utils.translation import ugettext_lazy as _\n+from django.conf import settings\n \n \n ACTION_CHECKBOX_NAME = '_selected_action'\n@@ -75,7 +76,10 @@ def __init__(self, form, name=None, readonly_fields=(), fields=(), classes=(),\n \n     def _media(self):\n         if 'collapse' in self.classes:\n-            js = ['jquery.min.js', 'jquery.init.js', 'collapse.min.js']\n+            extra = '' if settings.DEBUG else '.min'\n+            js = ['jquery%s.js' % extra,\n+                  'jquery.init.js',\n+                  'collapse%s.js' % extra]\n             return forms.Media(js=[static('admin/js/%s' % url) for url in js])\n         return forms.Media()\n     media = property(_media)"
        },
        {
            "sha": "5bfa891a69c1c032a7a894d565113a1bdbd73a42",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
            "patch": "@@ -395,7 +395,7 @@ def urls(self):\n \n     @property\n     def media(self):\n-        extra = \"\" if settings.DEBUG else \".min\"\n+        extra = '' if settings.DEBUG else '.min'\n         js = [\n             'core.js',\n             'admin/RelatedObjectLookups.js',\n@@ -1373,8 +1373,8 @@ def __init__(self, parent_model, admin_site):\n \n     @property\n     def media(self):\n-        extra = \"\" if settings.DEBUG else \".min\"\n-        js = ['jquery%s.js' % extra, 'jquery.init.js', \"inlines%s.js\" % extra]\n+        extra = '' if settings.DEBUG else '.min'\n+        js = ['jquery%s.js' % extra, 'jquery.init.js', 'inlines%s.js' % extra]\n         if self.prepopulated_fields:\n             js.extend(['urlify.js', 'prepopulate%s.js' % extra])\n         if self.filter_vertical or self.filter_horizontal:"
        },
        {
            "sha": "e541a4265e9db30907e7e08104fc3a8d12a1e613",
            "filename": "tests/regressiontests/admin_views/admin.py",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py?ref=0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
            "patch": "@@ -35,7 +35,19 @@ def callable_year(dt_value):\n \n class ArticleInline(admin.TabularInline):\n     model = Article\n-\n+    prepopulated_fields = {\n+        'title' : ('content',)\n+    }\n+    fieldsets=(\n+        ('Some fields', {\n+            'classes': ('collapse',),\n+            'fields': ('title', 'content')\n+        }),\n+        ('Some other fields', {\n+            'classes': ('wide',),\n+            'fields': ('date', 'section')\n+        })\n+    )\n \n class ChapterInline(admin.TabularInline):\n     model = Chapter\n@@ -512,6 +524,7 @@ def get_urls(self):\n                 name='cable_extra'),\n         )\n \n+\n site = admin.AdminSite(name=\"admin\")\n site.register(Article, ArticleAdmin)\n site.register(CustomArticle, CustomArticleAdmin)"
        },
        {
            "sha": "b3426b4ec336ab2ebec0133e6c2c00ad3978d0e1",
            "filename": "tests/regressiontests/admin_views/models.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fmodels.py?ref=0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
            "patch": "@@ -3,7 +3,6 @@\n import tempfile\n import os\n \n-from django import forms\n from django.contrib.auth.models import User\n from django.contrib.contenttypes import generic\n from django.contrib.contenttypes.models import ContentType"
        },
        {
            "sha": "ab40c698dedb46f83a471cc85eb15cf0ef9626b7",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/django/django/blob/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
            "patch": "@@ -573,6 +573,7 @@ def test_allowed_filtering_15103(self):\n         except SuspiciousOperation:\n             self.fail(\"Filters should be allowed if they are defined on a ForeignKey pointing to this model\")\n \n+\n class AdminJavaScriptTest(AdminViewBasicTest):\n     urls = \"regressiontests.admin_views.urls\"\n \n@@ -598,6 +599,40 @@ def testMultiWidgetFirsFieldFocus(self):\n         )\n \n \n+    def test_js_minified_only_if_debug_is_false(self):\n+        \"\"\"\n+        Ensure that the minified versions of the JS files are only used when\n+        DEBUG is False.\n+        Refs #17521.\n+        \"\"\"\n+        with override_settings(DEBUG=False):\n+            response = self.client.get(\n+                '/test_admin/%s/admin_views/section/add/' % self.urlbit)\n+            self.assertNotContains(response, 'jquery.js')\n+            self.assertContains(response, 'jquery.min.js')\n+            self.assertNotContains(response, 'prepopulate.js')\n+            self.assertContains(response, 'prepopulate.min.js')\n+            self.assertNotContains(response, 'actions.js')\n+            self.assertContains(response, 'actions.min.js')\n+            self.assertNotContains(response, 'collapse.js')\n+            self.assertContains(response, 'collapse.min.js')\n+            self.assertNotContains(response, 'inlines.js')\n+            self.assertContains(response, 'inlines.min.js')\n+        with override_settings(DEBUG=True):\n+            response = self.client.get(\n+                '/test_admin/%s/admin_views/section/add/' % self.urlbit)\n+            self.assertContains(response, 'jquery.js')\n+            self.assertNotContains(response, 'jquery.min.js')\n+            self.assertContains(response, 'prepopulate.js')\n+            self.assertNotContains(response, 'prepopulate.min.js')\n+            self.assertContains(response, 'actions.js')\n+            self.assertNotContains(response, 'actions.min.js')\n+            self.assertContains(response, 'collapse.js')\n+            self.assertNotContains(response, 'collapse.min.js')\n+            self.assertContains(response, 'inlines.js')\n+            self.assertNotContains(response, 'inlines.min.js')\n+\n+\n class SaveAsTests(TestCase):\n     urls = \"regressiontests.admin_views.urls\"\n     fixtures = ['admin-views-users.xml','admin-views-person.xml']"
        },
        {
            "sha": "f9dec69ae8b95517da4572b2a1abc4726b5a7e50",
            "filename": "tests/regressiontests/modeladmin/tests.py",
            "status": "modified",
            "additions": 0,
            "deletions": 57,
            "changes": 57,
            "blob_url": "https://github.com/django/django/blob/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodeladmin%2Ftests.py?ref=0f6cf4aba1d3db4be9a0d593becfc10bc4aa1fbe",
            "patch": "@@ -494,63 +494,6 @@ class BandAdmin(ModelAdmin):\n             list(ma.get_formsets(request))[0]().forms[0].fields.keys(),\n             ['extra', 'transport', 'id', 'DELETE', 'main_band'])\n \n-    def test_media_minified_only_if_debug_is_false(self):\n-        \"\"\"\n-        Ensure that, with ModelAdmin, the minified versions of the JS files are\n-        only used when DEBUG is False.\n-        Refs #17521.\n-        \"\"\"\n-        ma = ModelAdmin(Band, self.site)\n-        ma.prepopulated_fields = ['something']\n-        ma.actions = ['some action']\n-\n-        with override_settings(DEBUG=False):\n-            media_js = str(ma.media['js'])\n-            self.assertFalse('jquery.js' in media_js)\n-            self.assertTrue('jquery.min.js' in media_js)\n-            self.assertFalse('prepopulate.js' in media_js)\n-            self.assertTrue('prepopulate.min.js' in media_js)\n-            self.assertFalse('actions.js' in media_js)\n-            self.assertTrue('actions.min.js' in media_js)\n-        with override_settings(DEBUG=True):\n-            media_js = str(ma.media['js'])\n-            self.assertTrue('jquery.js' in media_js)\n-            self.assertFalse('jquery.min.js' in media_js)\n-            self.assertTrue('prepopulate.js' in media_js)\n-            self.assertFalse('prepopulate.min.js' in media_js)\n-            self.assertTrue('actions.js' in media_js)\n-            self.assertFalse('actions.min.js' in media_js)\n-\n-    def test_inlines_media_minified_only_if_debug_is_false(self):\n-        \"\"\"\n-        Ensure that, with InlineModelAdmin, the minified versions of the JS\n-        files are only used when DEBUG is False.\n-        Refs #17521.\n-        \"\"\"\n-        class InlineBandAdmin(InlineModelAdmin):\n-            model = Band\n-\n-        ma = InlineBandAdmin(Band, self.site)\n-        ma.prepopulated_fields = ['something']\n-        ma.actions = ['some action']\n-\n-        with override_settings(DEBUG=False):\n-            media_js = str(ma.media['js'])\n-            self.assertFalse('jquery.js' in media_js)\n-            self.assertTrue('jquery.min.js' in media_js)\n-            self.assertFalse('prepopulate.js' in media_js)\n-            self.assertTrue('prepopulate.min.js' in media_js)\n-            self.assertFalse('inlines.js' in media_js)\n-            self.assertTrue('inlines.min.js' in media_js)\n-        with override_settings(DEBUG=True):\n-            media_js = str(ma.media['js'])\n-            self.assertTrue('jquery.js' in media_js)\n-            self.assertFalse('jquery.min.js' in media_js)\n-            self.assertTrue('prepopulate.js' in media_js)\n-            self.assertFalse('prepopulate.min.js' in media_js)\n-            self.assertTrue('inlines.js' in media_js)\n-            self.assertFalse('inlines.min.js' in media_js)\n-\n \n class ValidationTests(unittest.TestCase):\n     def test_validation_only_runs_in_debug(self):"
        }
    ],
    "stats": {
        "total": 120,
        "additions": 57,
        "deletions": 63
    }
}