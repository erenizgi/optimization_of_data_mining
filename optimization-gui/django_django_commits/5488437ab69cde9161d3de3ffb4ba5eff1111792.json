{
    "author": "aaugustin",
    "message": "Factored code and added a missing docstring.",
    "sha": "5488437ab69cde9161d3de3ffb4ba5eff1111792",
    "files": [
        {
            "sha": "958982bdae96cff3756aabc8921c047357c8c821",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/5488437ab69cde9161d3de3ffb4ba5eff1111792/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/5488437ab69cde9161d3de3ffb4ba5eff1111792/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=5488437ab69cde9161d3de3ffb4ba5eff1111792",
            "patch": "@@ -208,6 +208,9 @@ def set_clean(self):\n         self.clean_savepoints()\n \n     def clean_savepoints(self):\n+        \"\"\"\n+        Resets the counter used to generate unique savepoint ids in this thread.\n+        \"\"\"\n         self.savepoint_state = 0\n \n     def is_managed(self):"
        },
        {
            "sha": "809f14f628b4f7fc231ebd32fe196255fc202900",
            "filename": "django/db/transaction.py",
            "status": "modified",
            "additions": 36,
            "deletions": 64,
            "changes": 100,
            "blob_url": "https://github.com/django/django/blob/5488437ab69cde9161d3de3ffb4ba5eff1111792/django%2Fdb%2Ftransaction.py",
            "raw_url": "https://github.com/django/django/raw/5488437ab69cde9161d3de3ffb4ba5eff1111792/django%2Fdb%2Ftransaction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Ftransaction.py?ref=5488437ab69cde9161d3de3ffb4ba5eff1111792",
            "patch": "@@ -24,6 +24,19 @@ class TransactionManagementError(Exception):\n     \"\"\"\n     pass\n \n+################\n+# Private APIs #\n+################\n+\n+def get_connection(using=None):\n+    \"\"\"\n+    Get a database connection by name, or the default database connection\n+    if no name is provided.\n+    \"\"\"\n+    if using is None:\n+        using = DEFAULT_DB_ALIAS\n+    return connections[using]\n+\n def abort(using=None):\n     \"\"\"\n     Roll back any ongoing transactions and clean the transaction management\n@@ -34,10 +47,7 @@ def abort(using=None):\n     request has finished, the transaction state isn't known, yet the connection\n     must be cleaned up for the next request.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.abort()\n+    get_connection(using).abort()\n \n def enter_transaction_management(managed=True, using=None):\n     \"\"\"\n@@ -49,68 +59,50 @@ def enter_transaction_management(managed=True, using=None):\n     from the settings, if there is no surrounding block (dirty is always false\n     when no current block is running).\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.enter_transaction_management(managed)\n+    get_connection(using).enter_transaction_management(managed)\n \n def leave_transaction_management(using=None):\n     \"\"\"\n     Leaves transaction management for a running thread. A dirty flag is carried\n     over to the surrounding block, as a commit will commit all changes, even\n     those from outside. (Commits are on connection level.)\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.leave_transaction_management()\n+    get_connection(using).leave_transaction_management()\n \n def is_dirty(using=None):\n     \"\"\"\n     Returns True if the current transaction requires a commit for changes to\n     happen.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    return connection.is_dirty()\n+    return get_connection(using).is_dirty()\n \n def set_dirty(using=None):\n     \"\"\"\n     Sets a dirty flag for the current thread and code streak. This can be used\n     to decide in a managed block of code to decide whether there are open\n     changes waiting for commit.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.set_dirty()\n+    get_connection(using).set_dirty()\n \n def set_clean(using=None):\n     \"\"\"\n     Resets a dirty flag for the current thread and code streak. This can be used\n     to decide in a managed block of code to decide whether a commit or rollback\n     should happen.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.set_clean()\n+    get_connection(using).set_clean()\n \n def clean_savepoints(using=None):\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.clean_savepoints()\n+    \"\"\"\n+    Resets the counter used to generate unique savepoint ids in this thread.\n+    \"\"\"\n+    get_connection(using).clean_savepoints()\n \n def is_managed(using=None):\n     \"\"\"\n     Checks whether the transaction manager is in manual or in auto state.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    return connection.is_managed()\n+    return get_connection(using).is_managed()\n \n def managed(flag=True, using=None):\n     \"\"\"\n@@ -119,77 +111,57 @@ def managed(flag=True, using=None):\n     management and there is a pending commit/rollback, the data will be\n     commited.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.managed(flag)\n+    get_connection(using).managed(flag)\n \n def commit_unless_managed(using=None):\n     \"\"\"\n     Commits changes if the system is not in managed transaction mode.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.commit_unless_managed()\n+    get_connection(using).commit_unless_managed()\n \n def rollback_unless_managed(using=None):\n     \"\"\"\n     Rolls back changes if the system is not in managed transaction mode.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.rollback_unless_managed()\n+    get_connection(using).rollback_unless_managed()\n+\n+###############\n+# Public APIs #\n+###############\n \n def commit(using=None):\n     \"\"\"\n     Does the commit itself and resets the dirty flag.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.commit()\n+    get_connection(using).commit()\n \n def rollback(using=None):\n     \"\"\"\n     This function does the rollback itself and resets the dirty flag.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.rollback()\n+    get_connection(using).rollback()\n \n def savepoint(using=None):\n     \"\"\"\n     Creates a savepoint (if supported and required by the backend) inside the\n     current transaction. Returns an identifier for the savepoint that will be\n     used for the subsequent rollback or commit.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    return connection.savepoint()\n+    return get_connection(using).savepoint()\n \n def savepoint_rollback(sid, using=None):\n     \"\"\"\n     Rolls back the most recent savepoint (if one exists). Does nothing if\n     savepoints are not supported.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.savepoint_rollback(sid)\n+    get_connection(using).savepoint_rollback(sid)\n \n def savepoint_commit(sid, using=None):\n     \"\"\"\n     Commits the most recent savepoint (if one exists). Does nothing if\n     savepoints are not supported.\n     \"\"\"\n-    if using is None:\n-        using = DEFAULT_DB_ALIAS\n-    connection = connections[using]\n-    connection.savepoint_commit(sid)\n+    get_connection(using).savepoint_commit(sid)\n \n ##############\n # DECORATORS #"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 39,
        "deletions": 64
    }
}