{
    "author": "alex",
    "message": "Fixed #14499 -- ATSocialSecurityNumberField now responds to all EMPTY_VALUES correctly.  Also converted Austrian localflavor doctests to unittests.  We have always been at war with doctests.  Thanks to Idan Gazit for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14873 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "575962c213c7e6b7393c9ba43ecbb11389ff7c8b",
    "files": [
        {
            "sha": "cfe02063c2b04b8fdb18e801a82c2f3a2c665aea",
            "filename": "django/contrib/localflavor/at/forms.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/django%2Fcontrib%2Flocalflavor%2Fat%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/django%2Fcontrib%2Flocalflavor%2Fat%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fat%2Fforms.py?ref=575962c213c7e6b7393c9ba43ecbb11389ff7c8b",
            "patch": "@@ -4,12 +4,14 @@\n \n import re\n \n-from django.utils.translation import ugettext_lazy as _\n-from django.forms.fields import Field, RegexField, Select\n+from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n+from django.forms.fields import Field, RegexField, Select\n+from django.utils.translation import ugettext_lazy as _\n \n re_ssn = re.compile(r'^\\d{4} \\d{6}')\n \n+\n class ATZipCodeField(RegexField):\n     \"\"\"\n     A form field that validates its input is an Austrian postcode.\n@@ -49,6 +51,9 @@ class ATSocialSecurityNumberField(Field):\n     }\n \n     def clean(self, value):\n+        value = super(ATSocialSecurityNumberField, self).clean(value)\n+        if value in EMPTY_VALUES:\n+            return u\"\"\n         if not re_ssn.search(value):\n             raise ValidationError(self.error_messages['invalid'])\n         sqnr, date = value.split(\" \")\n@@ -62,4 +67,3 @@ def clean(self, value):\n         if res != int(check):\n            raise ValidationError(self.error_messages['invalid'])\n         return u'%s%s %s'%(sqnr, check, date,)\n-"
        },
        {
            "sha": "3fa50ac4df7f15c91f910d43d971d1ed9bfef981",
            "filename": "tests/regressiontests/forms/localflavor/at.py",
            "status": "modified",
            "additions": 45,
            "deletions": 80,
            "changes": 125,
            "blob_url": "https://github.com/django/django/blob/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fat.py",
            "raw_url": "https://github.com/django/django/raw/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavor%2Fat.py?ref=575962c213c7e6b7393c9ba43ecbb11389ff7c8b",
            "patch": "@@ -1,80 +1,45 @@\n-# -*- coding: utf-8 -*-\n-# Tests for the contrib/localflavor/ AT form fields.\n-\n-tests = r\"\"\"\n-# ATZipCodeField ###########################################################\n-\n->>> from django.contrib.localflavor.at.forms import ATZipCodeField \n->>> f = ATZipCodeField()\n->>> f.clean('1150')\n-u'1150'\n->>> f.clean('4020')\n-u'4020'\n->>> f.clean('8020')\n-u'8020'\n->>> f.clean('111222')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXX.']\n->>> f.clean('eeffee')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXX.']\n->>> f.clean(u'')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean(None)\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n->>> f.clean('')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'This field is required.']\n-\n-\n->>> f = ATZipCodeField(required=False)\n->>> f.clean('1150')\n-u'1150'\n->>> f.clean('4020')\n-u'4020'\n->>> f.clean('8020')\n-u'8020'\n->>> f.clean('111222')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXX.']\n->>> f.clean('eeffee')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a zip code in the format XXXX.']\n->>> f.clean(None)\n-u''\n->>> f.clean('')\n-u''\n->>> f.clean(u'')\n-u''\n-\n-# ATStateSelect ##################################################################\n-\n->>> from django.contrib.localflavor.at.forms import ATStateSelect\n->>> f = ATStateSelect()\n->>> f.render('bundesland', 'WI')\n-u'<select name=\"bundesland\">\\n<option value=\"BL\">Burgenland</option>\\n<option value=\"KA\">Carinthia</option>\\n<option value=\"NO\">Lower Austria</option>\\n<option value=\"OO\">Upper Austria</option>\\n<option value=\"SA\">Salzburg</option>\\n<option value=\"ST\">Styria</option>\\n<option value=\"TI\">Tyrol</option>\\n<option value=\"VO\">Vorarlberg</option>\\n<option value=\"WI\" selected=\"selected\">Vienna</option>\\n</select>'\n-\n-# ATSocialSecurityNumberField ################################################\n-\n->>> from django.contrib.localflavor.at.forms import ATSocialSecurityNumberField\n->>> f = ATSocialSecurityNumberField()\n->>> f.clean('1237 010180')\n-u'1237 010180'\n->>> f.clean('1237 010181')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Austrian Social Security Number in XXXX XXXXXX format.']\n->>> f.clean('12370 010180')\n-Traceback (most recent call last):\n-...\n-ValidationError: [u'Enter a valid Austrian Social Security Number in XXXX XXXXXX format.']\n-\"\"\"\n+from django.contrib.localflavor.at.forms import (ATZipCodeField, ATStateSelect,\n+    ATSocialSecurityNumberField)\n+\n+from utils import LocalFlavorTestCase\n+\n+\n+class ATLocalFlavorTests(LocalFlavorTestCase):\n+    def test_ATStateSelect(self):\n+        f = ATStateSelect()\n+        out = u'''<select name=\"bundesland\">\n+<option value=\"BL\">Burgenland</option>\n+<option value=\"KA\">Carinthia</option>\n+<option value=\"NO\">Lower Austria</option>\n+<option value=\"OO\">Upper Austria</option>\n+<option value=\"SA\">Salzburg</option>\n+<option value=\"ST\">Styria</option>\n+<option value=\"TI\">Tyrol</option>\n+<option value=\"VO\">Vorarlberg</option>\n+<option value=\"WI\" selected=\"selected\">Vienna</option>\n+</select>'''\n+        self.assertEqual(f.render('bundesland', 'WI'), out)\n+\n+    def test_ATZipCodeField(self):\n+        error_format = [u'Enter a zip code in the format XXXX.']\n+        valid = {\n+            '1150': '1150',\n+            '4020': '4020',\n+            '8020': '8020',\n+        }\n+        invalid = {\n+            '111222': error_format,\n+            'eeffee': error_format,\n+        }\n+        self.assertFieldOutput(ATZipCodeField, valid, invalid)\n+\n+    def test_ATSocialSecurityNumberField(self):\n+        error_format = [u'Enter a valid Austrian Social Security Number in XXXX XXXXXX format.']\n+        valid = {\n+            '1237 010180': '1237 010180',\n+        }\n+        invalid = {\n+            '1237 010181': error_format,\n+            '12370 010180': error_format,\n+        }\n+        self.assertFieldOutput(ATSocialSecurityNumberField, valid, invalid)"
        },
        {
            "sha": "9a3d96f55f209a7a3fb95d723b41f7105515f10c",
            "filename": "tests/regressiontests/forms/localflavortests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "raw_url": "https://github.com/django/django/raw/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Flocalflavortests.py?ref=575962c213c7e6b7393c9ba43ecbb11389ff7c8b",
            "patch": "@@ -1,5 +1,4 @@\n # -*- coding: utf-8 -*-\n-from localflavor.at import tests as localflavor_at_tests\n from localflavor.au import tests as localflavor_au_tests\n from localflavor.br import tests as localflavor_br_tests\n from localflavor.ca import tests as localflavor_ca_tests\n@@ -28,14 +27,14 @@\n from localflavor.za import tests as localflavor_za_tests\n \n from localflavor.ar import ARLocalFlavorTests\n+from localflavor.at import ATLocalFlavorTests\n from localflavor.de import DELocalFlavorTests\n from localflavor.be import BELocalFlavorTests\n from localflavor.il import ILLocalFlavorTests\n from localflavor.tr import TRLocalFlavorTests\n \n \n __test__ = {\n-    'localflavor_at_tests': localflavor_at_tests,\n     'localflavor_au_tests': localflavor_au_tests,\n     'localflavor_br_tests': localflavor_br_tests,\n     'localflavor_ca_tests': localflavor_ca_tests,"
        },
        {
            "sha": "7489be5f9ba6cab80cdbe108ec339895cae639f6",
            "filename": "tests/regressiontests/forms/tests/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/575962c213c7e6b7393c9ba43ecbb11389ff7c8b/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2F__init__.py?ref=575962c213c7e6b7393c9ba43ecbb11389ff7c8b",
            "patch": "@@ -13,8 +13,10 @@\n \n from regressiontests.forms.localflavortests import (\n     __test__,\n+    ARLocalFlavorTests,\n+    ATLocalFlavorTests,\n     BELocalFlavorTests,\n     DELocalFlavorTests,\n     ILLocalFlavorTests,\n-    TRLocalFlavorTests\n+    TRLocalFlavorTests,\n )"
        }
    ],
    "stats": {
        "total": 142,
        "additions": 56,
        "deletions": 86
    }
}