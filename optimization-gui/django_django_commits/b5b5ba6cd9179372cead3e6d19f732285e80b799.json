{
    "author": "freakboy3742",
    "message": "Fixed #10918 -- Ensure that the search widget on a raw_id_admin uses the right field name when the ForeignKey has a to_field definition. Thanks to David Cramer for the report, Collin Anderson for the fix, and Julien Phalip for the test.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15657 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "b5b5ba6cd9179372cead3e6d19f732285e80b799",
    "files": [
        {
            "sha": "635330f6a851d2798ee14c62b8ff5012bd1a376e",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/b5b5ba6cd9179372cead3e6d19f732285e80b799/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/b5b5ba6cd9179372cead3e6d19f732285e80b799/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=b5b5ba6cd9179372cead3e6d19f732285e80b799",
            "patch": "@@ -52,8 +52,6 @@ def __init__(self, request, model, list_display, list_display_links, list_filter\n         self.params = dict(request.GET.items())\n         if PAGE_VAR in self.params:\n             del self.params[PAGE_VAR]\n-        if TO_FIELD_VAR in self.params:\n-            del self.params[TO_FIELD_VAR]\n         if ERROR_FLAG in self.params:\n             del self.params[ERROR_FLAG]\n \n@@ -173,7 +171,7 @@ def get_query_set(self):\n \n         qs = self.root_query_set\n         lookup_params = self.params.copy() # a dictionary of the query string\n-        for i in (ALL_VAR, ORDER_VAR, ORDER_TYPE_VAR, SEARCH_VAR, IS_POPUP_VAR):\n+        for i in (ALL_VAR, ORDER_VAR, ORDER_TYPE_VAR, SEARCH_VAR, IS_POPUP_VAR, TO_FIELD_VAR):\n             if i in lookup_params:\n                 del lookup_params[i]\n         for key, value in lookup_params.items():"
        },
        {
            "sha": "6be07b462df3b3ed3889852ba35be3b009c5dba8",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/b5b5ba6cd9179372cead3e6d19f732285e80b799/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/b5b5ba6cd9179372cead3e6d19f732285e80b799/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=b5b5ba6cd9179372cead3e6d19f732285e80b799",
            "patch": "@@ -1694,6 +1694,16 @@ def test_search_on_sibling_models(self):\n         # confirm the search returned 1 object\n         self.assertContains(response, \"\\n1 recommendation\\n\")\n \n+    def test_with_fk_to_field(self):\n+        \"\"\"Ensure that the to_field GET parameter is preserved when a search\n+        is performed. Refs #10918.\n+        \"\"\"\n+        from django.contrib.admin.views.main import TO_FIELD_VAR\n+        response = self.client.get('/test_admin/admin/auth/user/?q=joe&%s=username' % TO_FIELD_VAR)\n+        self.assertContains(response, \"\\n1 user\\n\")\n+        self.assertContains(response, '<input type=\"hidden\" name=\"t\" value=\"username\"/>')\n+\n+\n class AdminInheritedInlinesTest(TestCase):\n     fixtures = ['admin-views-users.xml',]\n "
        }
    ],
    "stats": {
        "total": 14,
        "additions": 11,
        "deletions": 3
    }
}