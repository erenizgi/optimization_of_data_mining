{
    "author": "apollo13",
    "message": "Fixed #18800 -- Support numbers bigger than max float in `numberformat`.\n\nThanks to jbvsmo for the patch and Brad Pitcher for the tests.",
    "sha": "319e1355190d414ee1b095b26fbb494cf9a27578",
    "files": [
        {
            "sha": "6a31237f135ea962520f8348a120ba1e0260ea0a",
            "filename": "django/utils/numberformat.py",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/319e1355190d414ee1b095b26fbb494cf9a27578/django%2Futils%2Fnumberformat.py",
            "raw_url": "https://github.com/django/django/raw/319e1355190d414ee1b095b26fbb494cf9a27578/django%2Futils%2Fnumberformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fnumberformat.py?ref=319e1355190d414ee1b095b26fbb494cf9a27578",
            "patch": "@@ -21,12 +21,10 @@ def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',\n     if isinstance(number, int) and not use_grouping and not decimal_pos:\n         return mark_safe(six.text_type(number))\n     # sign\n-    if float(number) < 0:\n-        sign = '-'\n-    else:\n-        sign = ''\n+    sign = ''\n     str_number = six.text_type(number)\n     if str_number[0] == '-':\n+        sign = '-'\n         str_number = str_number[1:]\n     # decimal part\n     if '.' in str_number:\n@@ -48,4 +46,3 @@ def format(number, decimal_sep, decimal_pos=None, grouping=0, thousand_sep='',\n             int_part_gd += digit\n         int_part = int_part_gd[::-1]\n     return sign + int_part + dec_part\n-"
        },
        {
            "sha": "f9d9031e488901ab94d6397aa30f80b7f4085337",
            "filename": "tests/regressiontests/utils/numberformat.py",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/django/django/blob/319e1355190d414ee1b095b26fbb494cf9a27578/tests%2Fregressiontests%2Futils%2Fnumberformat.py",
            "raw_url": "https://github.com/django/django/raw/319e1355190d414ee1b095b26fbb494cf9a27578/tests%2Fregressiontests%2Futils%2Fnumberformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fnumberformat.py?ref=319e1355190d414ee1b095b26fbb494cf9a27578",
            "patch": "@@ -0,0 +1,47 @@\n+from unittest import TestCase\n+from django.utils.numberformat import format as nformat\n+from sys import float_info\n+\n+\n+class TestNumberFormat(TestCase):\n+\n+    def test_format_number(self):\n+        self.assertEqual(nformat(1234, '.'), '1234')\n+        self.assertEqual(nformat(1234.2, '.'), '1234.2')\n+        self.assertEqual(nformat(1234, '.', decimal_pos=2), '1234.00')\n+        self.assertEqual(nformat(1234, '.', grouping=2, thousand_sep=','),\n+                         '1234')\n+        self.assertEqual(nformat(1234, '.', grouping=2, thousand_sep=',',\n+                                 force_grouping=True), '12,34')\n+        self.assertEqual(nformat(-1234.33, '.', decimal_pos=1), '-1234.3')\n+\n+    def test_format_string(self):\n+        self.assertEqual(nformat('1234', '.'), '1234')\n+        self.assertEqual(nformat('1234.2', '.'), '1234.2')\n+        self.assertEqual(nformat('1234', '.', decimal_pos=2), '1234.00')\n+        self.assertEqual(nformat('1234', '.', grouping=2, thousand_sep=','),\n+                         '1234')\n+        self.assertEqual(nformat('1234', '.', grouping=2, thousand_sep=',',\n+                                 force_grouping=True), '12,34')\n+        self.assertEqual(nformat('-1234.33', '.', decimal_pos=1), '-1234.3')\n+\n+    def test_large_number(self):\n+        most_max = ('{0}179769313486231570814527423731704356798070567525844996'\n+                    '598917476803157260780028538760589558632766878171540458953'\n+                    '514382464234321326889464182768467546703537516986049910576'\n+                    '551282076245490090389328944075868508455133942304583236903'\n+                    '222948165808559332123348274797826204144723168738177180919'\n+                    '29988125040402618412485836{1}')\n+        most_max2 = ('{0}35953862697246314162905484746340871359614113505168999'\n+                     '31978349536063145215600570775211791172655337563430809179'\n+                     '07028764928468642653778928365536935093407075033972099821'\n+                     '15310256415249098018077865788815173701691026788460916647'\n+                     '38064458963316171186642466965495956524082894463374763543'\n+                     '61838599762500808052368249716736')\n+        int_max = int(float_info.max)\n+        self.assertEqual(nformat(int_max, '.'), most_max.format('', '8'))\n+        self.assertEqual(nformat(int_max + 1, '.'), most_max.format('', '9'))\n+        self.assertEqual(nformat(int_max * 2, '.'), most_max2.format(''))\n+        self.assertEqual(nformat(0 - int_max, '.'), most_max.format('-', '8'))\n+        self.assertEqual(nformat(-1 - int_max, '.'), most_max.format('-', '9'))\n+        self.assertEqual(nformat(-2 * int_max, '.'), most_max2.format('-'))"
        },
        {
            "sha": "47af07561a54ea696378f392988b8056f3d2f53e",
            "filename": "tests/regressiontests/utils/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/319e1355190d414ee1b095b26fbb494cf9a27578/tests%2Fregressiontests%2Futils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/319e1355190d414ee1b095b26fbb494cf9a27578/tests%2Fregressiontests%2Futils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftests.py?ref=319e1355190d414ee1b095b26fbb494cf9a27578",
            "patch": "@@ -21,6 +21,7 @@\n from .ipv6 import TestUtilsIPv6\n from .jslex import JsToCForGettextTest, JsTokensTest\n from .module_loading import CustomLoader, DefaultLoader, EggLoader\n+from .numberformat import TestNumberFormat\n from .os_utils import SafeJoinTests\n from .regex_helper import NormalizeTests\n from .simplelazyobject import TestUtilsSimpleLazyObject"
        }
    ],
    "stats": {
        "total": 55,
        "additions": 50,
        "deletions": 5
    }
}