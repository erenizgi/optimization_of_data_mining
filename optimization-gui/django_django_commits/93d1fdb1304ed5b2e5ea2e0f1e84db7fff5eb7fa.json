{
    "author": "jphalip",
    "message": "Fixed #17877 -- Ensured that extra WHERE clauses get correctly ANDed when they contain OR operations. Thanks to Marek BrzoÃÅska for the report, to eleather for the test case and to Adrien Lemaire for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17880 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa",
    "files": [
        {
            "sha": "fc3cb93406e42ce860f56519b64b10e42f08bba3",
            "filename": "AUTHORS",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/AUTHORS",
            "raw_url": "https://github.com/django/django/raw/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/AUTHORS",
            "contents_url": "https://api.github.com/repos/django/django/contents/AUTHORS?ref=93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa",
            "patch": "@@ -326,6 +326,7 @@ answer newbie questions, and generally made Django that much better:\n     lcordier@point45.com\n     Jeong-Min Lee <falsetru@gmail.com>\n     Tai Lee <real.human@mrmachine.net>\n+    Adrien Lemaire <lemaire.adrien@gmail.com>\n     Christopher Lenz <http://www.cmlenz.net/>\n     lerouxb@gmail.com\n     Piotr Lewandowski <piotr.lewandowski@gmail.com>"
        },
        {
            "sha": "0bc3638b806111e9dcae2e5e6596c22114ee4fbf",
            "filename": "django/db/models/sql/where.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "raw_url": "https://github.com/django/django/raw/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fwhere.py?ref=93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa",
            "patch": "@@ -281,7 +281,8 @@ def __init__(self, sqls, params):\n         self.params = params\n \n     def as_sql(self, qn=None, connection=None):\n-        return \" AND \".join(self.sqls), tuple(self.params or ())\n+        sqls = [\"(%s)\" % sql for sql in self.sqls]\n+        return \" AND \".join(sqls), tuple(self.params or ())\n \n class Constraint(object):\n     \"\"\""
        },
        {
            "sha": "b20c6e34e50c589e44573a651fc12f373dbf3889",
            "filename": "docs/ref/models/querysets.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "raw_url": "https://github.com/django/django/raw/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/docs%2Fref%2Fmodels%2Fquerysets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Fquerysets.txt?ref=93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa",
            "patch": "@@ -968,11 +968,11 @@ of the arguments is required, but you should use at least one of them.\n \n   Example::\n \n-      Entry.objects.extra(where=['id IN (3, 4, 5, 20)'])\n+      Entry.objects.extra(where=[\"foo='a' OR bar = 'a'\", \"baz = 'a'\"])\n \n   ...translates (roughly) into the following SQL::\n \n-      SELECT * FROM blog_entry WHERE id IN (3, 4, 5, 20);\n+      SELECT * FROM blog_entry WHERE (foo='a' OR bar='a') AND (baz='a')\n \n   Be careful when using the ``tables`` parameter if you're specifying\n   tables that are already used in the query. When you add extra tables"
        },
        {
            "sha": "3fcafef5de2d5e85bff2f8b3553da7ab5122a202",
            "filename": "tests/regressiontests/extra_regress/tests.py",
            "status": "modified",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/django/django/blob/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/tests%2Fregressiontests%2Fextra_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa/tests%2Fregressiontests%2Fextra_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fextra_regress%2Ftests.py?ref=93d1fdb1304ed5b2e5ea2e0f1e84db7fff5eb7fa",
            "patch": "@@ -313,3 +313,34 @@ def test_regression_10847(self):\n                TestObject.objects.extra(where=[\"id > %s\"], params=[obj.pk]),\n             ['<TestObject: TestObject: first,second,third>']\n         )\n+\n+    def test_regression_17877(self):\n+        \"\"\"\n+        Ensure that extra WHERE clauses get correctly ANDed, even when they\n+        contain OR operations.\n+        \"\"\"\n+        # Test Case 1: should appear in queryset.\n+        t = TestObject(first='a', second='a', third='a')\n+        t.save()\n+        # Test Case 2: should appear in queryset.\n+        t = TestObject(first='b', second='a', third='a')\n+        t.save()\n+        # Test Case 3: should not appear in queryset, bug case.\n+        t = TestObject(first='a', second='a', third='b')\n+        t.save()\n+        # Test Case 4: should not appear in queryset.\n+        t = TestObject(first='b', second='a', third='b')\n+        t.save()\n+        # Test Case 5: should not appear in queryset.\n+        t = TestObject(first='b', second='b', third='a')\n+        t.save()\n+        # Test Case 6: should not appear in queryset, bug case.\n+        t = TestObject(first='a', second='b', third='b')\n+        t.save()\n+\n+        self.assertQuerysetEqual(\n+            TestObject.objects.extra(\n+                where=[\"first = 'a' OR second = 'a'\", \"third = 'a'\"],\n+            ),\n+            ['<TestObject: TestObject: a,a,a>', '<TestObject: TestObject: b,a,a>']\n+        )"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 36,
        "deletions": 3
    }
}