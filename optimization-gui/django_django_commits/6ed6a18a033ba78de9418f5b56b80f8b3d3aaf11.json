{
    "author": "claudep",
    "message": "Fixed #19432 -- Provided better error message for get_object_or_404\n\nThanks Kit Sunde for the report and Brian Holdefehr for the initial\npatch.",
    "sha": "6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11",
    "files": [
        {
            "sha": "9f896347a4b7847985d5981c1d17ef7ac834c9ad",
            "filename": "django/shortcuts/__init__.py",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11/django%2Fshortcuts%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11/django%2Fshortcuts%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fshortcuts%2F__init__.py?ref=6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11",
            "patch": "@@ -7,6 +7,7 @@\n from django.template import loader, RequestContext\n from django.http import HttpResponse, Http404\n from django.http import HttpResponseRedirect, HttpResponsePermanentRedirect\n+from django.db.models.base import ModelBase\n from django.db.models.manager import Manager\n from django.db.models.query import QuerySet\n from django.core import urlresolvers\n@@ -72,13 +73,20 @@ def _get_queryset(klass):\n     \"\"\"\n     Returns a QuerySet from a Model, Manager, or QuerySet. Created to make\n     get_object_or_404 and get_list_or_404 more DRY.\n+\n+    Raises a ValueError if klass is not a Model, Manager, or QuerySet.\n     \"\"\"\n     if isinstance(klass, QuerySet):\n         return klass\n     elif isinstance(klass, Manager):\n         manager = klass\n-    else:\n+    elif isinstance(klass, ModelBase):\n         manager = klass._default_manager\n+    else:\n+        klass__name = klass.__name__ if isinstance(klass, type) \\\n+                      else klass.__class__.__name__\n+        raise ValueError(\"Object is of type '%s', but must be a Django Model, \"\n+                         \"Manager, or QuerySet\" % klass__name)\n     return manager.all()\n \n def get_object_or_404(klass, *args, **kwargs):"
        },
        {
            "sha": "3b234c6cd303a0662ec8c2d6e174b7f551ea2050",
            "filename": "tests/modeltests/get_object_or_404/tests.py",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11/tests%2Fmodeltests%2Fget_object_or_404%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11/tests%2Fmodeltests%2Fget_object_or_404%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fget_object_or_404%2Ftests.py?ref=6ed6a18a033ba78de9418f5b56b80f8b3d3aaf11",
            "patch": "@@ -80,3 +80,28 @@ def test_get_object_or_404(self):\n             get_list_or_404(Article.objects.all(), title__icontains=\"Run\"),\n             [article]\n         )\n+\n+    def test_bad_class(self):\n+        # Given an argument klass that is not a Model, Manager, or Queryset\n+        # raises a helpful ValueError message\n+        self.assertRaisesMessage(ValueError,\n+            \"Object is of type 'str', but must be a Django Model, Manager, \"\n+            \"or QuerySet\",\n+            get_object_or_404, \"Article\", title__icontains=\"Run\"\n+        )\n+\n+        class CustomClass(object):\n+            pass\n+\n+        self.assertRaisesMessage(ValueError,\n+            \"Object is of type 'CustomClass', but must be a Django Model, \"\n+            \"Manager, or QuerySet\",\n+            get_object_or_404, CustomClass, title__icontains=\"Run\"\n+        )\n+\n+        # Works for lists too\n+        self.assertRaisesMessage(ValueError,\n+            \"Object is of type 'list', but must be a Django Model, Manager, \"\n+            \"or QuerySet\",\n+            get_list_or_404, [Article], title__icontains=\"Run\"\n+        )"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 34,
        "deletions": 1
    }
}