{
    "author": "slurms",
    "message": "Fixed #19746 -- Allow deserialization of pk-less data",
    "sha": "278dad5b411e3e2ba8b428f7761882424353dea7",
    "files": [
        {
            "sha": "cdfac5044bdff50fa19033541f84e5536ee8963e",
            "filename": "django/core/serializers/python.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/278dad5b411e3e2ba8b428f7761882424353dea7/django%2Fcore%2Fserializers%2Fpython.py",
            "raw_url": "https://github.com/django/django/raw/278dad5b411e3e2ba8b428f7761882424353dea7/django%2Fcore%2Fserializers%2Fpython.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpython.py?ref=278dad5b411e3e2ba8b428f7761882424353dea7",
            "patch": "@@ -88,7 +88,7 @@ def Deserializer(object_list, **options):\n     for d in object_list:\n         # Look up the model and starting build a dict of data for it.\n         Model = _get_model(d[\"model\"])\n-        data = {Model._meta.pk.attname: Model._meta.pk.to_python(d[\"pk\"])}\n+        data = {Model._meta.pk.attname: Model._meta.pk.to_python(d.get(\"pk\", None))}\n         m2m_data = {}\n         model_fields = Model._meta.get_all_field_names()\n "
        },
        {
            "sha": "982f986aadfa765c050b3418adba1373e3385118",
            "filename": "docs/topics/serialization.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/278dad5b411e3e2ba8b428f7761882424353dea7/docs%2Ftopics%2Fserialization.txt",
            "raw_url": "https://github.com/django/django/raw/278dad5b411e3e2ba8b428f7761882424353dea7/docs%2Ftopics%2Fserialization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fserialization.txt?ref=278dad5b411e3e2ba8b428f7761882424353dea7",
            "patch": "@@ -117,6 +117,16 @@ object and any associated relationship data.\n \n Calling ``DeserializedObject.save()`` saves the object to the database.\n \n+.. note::\n+\n+    If the ``pk`` attribute in the serialized data doesn't exist or is\n+    null, a new instance will be saved to the database.\n+\n+.. versionchanged:: 1.6\n+\n+In previous versions of Django, the ``pk`` attribute had to be present\n+on the serialized data or a ``DeserializationError`` would be raised.\n+\n This ensures that deserializing is a non-destructive operation even if the\n data in your serialized representation doesn't match what's currently in the\n database. Usually, working with these ``DeserializedObject`` instances looks"
        },
        {
            "sha": "34d0f5f1b1a7b64b7aecd06dd024f91198cd98ff",
            "filename": "tests/modeltests/serializers/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/278dad5b411e3e2ba8b428f7761882424353dea7/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/278dad5b411e3e2ba8b428f7761882424353dea7/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fserializers%2Ftests.py?ref=278dad5b411e3e2ba8b428f7761882424353dea7",
            "patch": "@@ -255,7 +255,7 @@ def test_pkless_serialized_strings(self):\n         for obj in deserial_objs:\n             self.assertFalse(obj.object.id)\n             obj.save()\n-        self.assertEqual(Category.objects.all().count(), 4)\n+        self.assertEqual(Category.objects.all().count(), 5)\n \n \n class SerializersTransactionTestBase(object):\n@@ -290,6 +290,9 @@ class XmlSerializerTestCase(SerializersTestBase, TestCase):\n     <object model=\"serializers.category\">\n         <field type=\"CharField\" name=\"name\">Reference</field>\n     </object>\n+    <object model=\"serializers.category\">\n+        <field type=\"CharField\" name=\"name\">Non-fiction</field>\n+    </object>\n </django-objects>\"\"\"\n \n     @staticmethod\n@@ -351,7 +354,15 @@ class XmlSerializerTransactionTestCase(SerializersTransactionTestBase, Transacti\n \n class JsonSerializerTestCase(SerializersTestBase, TestCase):\n     serializer_name = \"json\"\n-    pkless_str = \"\"\"[{\"pk\": null, \"model\": \"serializers.category\", \"fields\": {\"name\": \"Reference\"}}]\"\"\"\n+    pkless_str = \"\"\"[\n+    {\n+        \"pk\": null,\n+        \"model\": \"serializers.category\",\n+        \"fields\": {\"name\": \"Reference\"}\n+    }, {\n+        \"model\": \"serializers.category\",\n+        \"fields\": {\"name\": \"Non-fiction\"}\n+    }]\"\"\"\n \n     @staticmethod\n     def _validate_output(serial_str):\n@@ -433,6 +444,9 @@ class YamlSerializerTestCase(SerializersTestBase, TestCase):\n         pkless_str = \"\"\"- fields:\n     name: Reference\n   pk: null\n+  model: serializers.category\n+- fields:\n+    name: Non-fiction\n   model: serializers.category\"\"\"\n \n         @staticmethod"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 27,
        "deletions": 3
    }
}