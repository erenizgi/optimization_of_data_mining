{
    "author": "SmileyChris",
    "message": "Fixes #8103 -- Select widget should only allow for one selected option\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16848 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e63fa0ff832e4a6c18aa9f427b643b3445c5abb0",
    "files": [
        {
            "sha": "3797c163bd33e7ba5b7181042b187d9b8a6f7ae3",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/e63fa0ff832e4a6c18aa9f427b643b3445c5abb0/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/e63fa0ff832e4a6c18aa9f427b643b3445c5abb0/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=e63fa0ff832e4a6c18aa9f427b643b3445c5abb0",
            "patch": "@@ -499,6 +499,8 @@ def _has_changed(self, initial, data):\n         return bool(initial) != bool(data)\n \n class Select(Widget):\n+    allow_multiple_selected = False\n+\n     def __init__(self, attrs=None, choices=()):\n         super(Select, self).__init__(attrs)\n         # choices can be any iterable, but we may need to render this widget\n@@ -518,14 +520,20 @@ def render(self, name, value, attrs=None, choices=()):\n \n     def render_option(self, selected_choices, option_value, option_label):\n         option_value = force_unicode(option_value)\n-        selected_html = (option_value in selected_choices) and u' selected=\"selected\"' or ''\n+        if option_value in selected_choices:\n+            selected_html = u' selected=\"selected\"'\n+            if not self.allow_multiple_selected:\n+                # Only allow for a single selection.\n+                selected_choices.remove(option_value)\n+        else:\n+            selected_html = ''\n         return u'<option value=\"%s\"%s>%s</option>' % (\n             escape(option_value), selected_html,\n             conditional_escape(force_unicode(option_label)))\n \n     def render_options(self, choices, selected_choices):\n         # Normalize to strings.\n-        selected_choices = set([force_unicode(v) for v in selected_choices])\n+        selected_choices = set(force_unicode(v) for v in selected_choices)\n         output = []\n         for option_value, option_label in chain(self.choices, choices):\n             if isinstance(option_label, (list, tuple)):\n@@ -571,6 +579,8 @@ def _has_changed(self, initial, data):\n         return initial != data\n \n class SelectMultiple(Select):\n+    allow_multiple_selected = True\n+\n     def render(self, name, value, attrs=None, choices=()):\n         if value is None: value = []\n         final_attrs = self.build_attrs(attrs, name=name)"
        },
        {
            "sha": "e6667f7629b971c433a7c1151c84ca105708ed50",
            "filename": "tests/regressiontests/forms/tests/widgets.py",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/e63fa0ff832e4a6c18aa9f427b643b3445c5abb0/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/e63fa0ff832e4a6c18aa9f427b643b3445c5abb0/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fwidgets.py?ref=e63fa0ff832e4a6c18aa9f427b643b3445c5abb0",
            "patch": "@@ -12,7 +12,6 @@\n from django.utils.unittest import TestCase\n \n \n-\n class FormsWidgetTestCase(TestCase):\n     # Each Widget class corresponds to an HTML form widget. A Widget knows how to\n     # render itself, given a field name and some data. Widgets don't perform\n@@ -255,6 +254,15 @@ def test_select(self):\n <option value=\"P\">Paul</option>\n <option value=\"G\">George</option>\n <option value=\"R\">Ringo</option>\n+</select>\"\"\")\n+\n+        # Only one option can be selected, see #8103:\n+        self.assertEqual(w.render('choices', '0', choices=(('0', '0'), ('1', '1'), ('2', '2'), ('3', '3'), ('0', 'extra'))), \"\"\"<select name=\"choices\">\n+<option value=\"0\" selected=\"selected\">0</option>\n+<option value=\"1\">1</option>\n+<option value=\"2\">2</option>\n+<option value=\"3\">3</option>\n+<option value=\"0\">extra</option>\n </select>\"\"\")\n \n         # The value is compared to its str():\n@@ -438,6 +446,15 @@ def test_selectmultiple(self):\n <option value=\"P\">Paul</option>\n <option value=\"G\">George</option>\n <option value=\"R\">Ringo</option>\n+</select>\"\"\")\n+\n+        # Multiple options (with the same value) can be selected, see #8103:\n+        self.assertEqual(w.render('choices', ['0'], choices=(('0', '0'), ('1', '1'), ('2', '2'), ('3', '3'), ('0', 'extra'))), \"\"\"<select multiple=\"multiple\" name=\"choices\">\n+<option value=\"0\" selected=\"selected\">0</option>\n+<option value=\"1\">1</option>\n+<option value=\"2\">2</option>\n+<option value=\"3\">3</option>\n+<option value=\"0\" selected=\"selected\">extra</option>\n </select>\"\"\")\n \n         # If multiple values are given, but some of them are not valid, the valid ones are selected:"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 30,
        "deletions": 3
    }
}