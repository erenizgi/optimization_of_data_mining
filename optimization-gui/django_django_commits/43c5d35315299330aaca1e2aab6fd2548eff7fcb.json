{
    "author": "aaugustin",
    "message": "Fixed #17274 -- Accepted TIME_ZONE = None when USE_TZ = True. Thanks pressureman for the report.\n\nThis problem only occured when pytz is installed. It's still strongly recommended to define the correct time zone in TIME_ZONE in order to use pytz' implementation and not the approximation based on system time.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17134 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "43c5d35315299330aaca1e2aab6fd2548eff7fcb",
    "files": [
        {
            "sha": "16e65fc62db609ecb92e42e435bf3206a3d1213c",
            "filename": "django/utils/timezone.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/43c5d35315299330aaca1e2aab6fd2548eff7fcb/django%2Futils%2Ftimezone.py",
            "raw_url": "https://github.com/django/django/raw/43c5d35315299330aaca1e2aab6fd2548eff7fcb/django%2Futils%2Ftimezone.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftimezone.py?ref=43c5d35315299330aaca1e2aab6fd2548eff7fcb",
            "patch": "@@ -102,8 +102,10 @@ def get_default_timezone():\n     \"\"\"\n     global _localtime\n     if _localtime is None:\n-        tz = settings.TIME_ZONE\n-        _localtime = pytz.timezone(tz) if pytz else LocalTimezone()\n+        if isinstance(settings.TIME_ZONE, basestring) and pytz is not None:\n+            _localtime = pytz.timezone(settings.TIME_ZONE)\n+        else:\n+            _localtime = LocalTimezone()\n     return _localtime\n \n # This function exists for consistency with get_current_timezone_name"
        },
        {
            "sha": "53b14045abbb5b52e0116fb23bbffcfcfe693491",
            "filename": "tests/modeltests/timezones/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/43c5d35315299330aaca1e2aab6fd2548eff7fcb/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/43c5d35315299330aaca1e2aab6fd2548eff7fcb/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftimezones%2Ftests.py?ref=43c5d35315299330aaca1e2aab6fd2548eff7fcb",
            "patch": "@@ -774,6 +774,17 @@ def test_date_and_time_template_filters_honor_localtime(self):\n         with timezone.override(ICT):\n             self.assertEqual(tpl.render(ctx), \"2011-09-01 at 20:20:20\")\n \n+    def test_localtime_with_time_zone_setting_set_to_none(self):\n+        # Regression for #17274\n+        tpl = Template(\"{% load tz %}{{ dt }}\")\n+        ctx = Context({'dt': datetime.datetime(2011, 9, 1, 12, 20, 30, tzinfo=EAT)})\n+\n+        timezone._localtime = None\n+        with self.settings(TIME_ZONE=None):\n+            # the actual value depends on the system time zone of the host\n+            self.assertTrue(tpl.render(ctx).startswith(\"2011\"))\n+        timezone._localtime = None\n+\n TemplateTests = override_settings(DATETIME_FORMAT='c', USE_L10N=False, USE_TZ=True)(TemplateTests)\n \n #@override_settings(DATETIME_FORMAT='c', USE_L10N=False, USE_TZ=False)"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}