{
    "author": "jphalip",
    "message": "Fixed #8997 -- Prevented the contenttypes `shortcut` view to hide errors occurring inside the `get_absolute_url()` method. Thanks to Rob for the report and to joshlory, Aymeric Augustin and Claude Paroz for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17328 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6fa62b8166f00d6cf1160b84dce37416f0051f00",
    "files": [
        {
            "sha": "f2a338e1d4924eda5b6cae634b114b00df3f191a",
            "filename": "django/contrib/contenttypes/tests.py",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/6fa62b8166f00d6cf1160b84dce37416f0051f00/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6fa62b8166f00d6cf1160b84dce37416f0051f00/django%2Fcontrib%2Fcontenttypes%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Ftests.py?ref=6fa62b8166f00d6cf1160b84dce37416f0051f00",
            "patch": "@@ -30,6 +30,13 @@ class FooWithUrl(FooWithoutUrl):\n     def get_absolute_url(self):\n         return \"/users/%s/\" % urllib.quote(smart_str(self.name))\n \n+class FooWithBrokenAbsoluteUrl(FooWithoutUrl):\n+    \"\"\"\n+    Fake model defining a ``get_absolute_url`` method containing an error\n+    \"\"\"\n+\n+    def get_absolute_url(self):\n+        return \"/users/%s/\" % self.unknown_field\n \n class ContentTypesTests(TestCase):\n \n@@ -135,6 +142,22 @@ def test_shortcut_view_without_get_absolute_url(self):\n \n         self.assertRaises(Http404, shortcut, request, user_ct.id, obj.id)\n \n+    def test_shortcut_view_with_broken_get_absolute_url(self):\n+        \"\"\"\n+        Check that the shortcut view does not catch an AttributeError raised\n+        by the model's get_absolute_url method.\n+        Refs #8997.\n+        \"\"\"\n+        request = HttpRequest()\n+        request.META = {\n+            \"SERVER_NAME\": \"Example.com\",\n+            \"SERVER_PORT\": \"80\",\n+        }\n+        user_ct = ContentType.objects.get_for_model(FooWithBrokenAbsoluteUrl)\n+        obj = FooWithBrokenAbsoluteUrl.objects.create(name=\"john\")\n+\n+        self.assertRaises(AttributeError, shortcut, request, user_ct.id, obj.id)\n+\n     def test_missing_model(self):\n         \"\"\"\n         Ensures that displaying content types in admin (or anywhere) doesn't"
        },
        {
            "sha": "5085a2fa2c0ff019467ade7d12fcdcdfb65e2b79",
            "filename": "django/contrib/contenttypes/views.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/6fa62b8166f00d6cf1160b84dce37416f0051f00/django%2Fcontrib%2Fcontenttypes%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/6fa62b8166f00d6cf1160b84dce37416f0051f00/django%2Fcontrib%2Fcontenttypes%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fviews.py?ref=6fa62b8166f00d6cf1160b84dce37416f0051f00",
            "patch": "@@ -4,19 +4,25 @@\n from django.core.exceptions import ObjectDoesNotExist\n \n def shortcut(request, content_type_id, object_id):\n-    \"Redirect to an object's page based on a content-type ID and an object ID.\"\n+    \"\"\"\n+    Redirect to an object's page based on a content-type ID and an object ID.\n+    \"\"\"\n     # Look up the object, making sure it's got a get_absolute_url() function.\n     try:\n         content_type = ContentType.objects.get(pk=content_type_id)\n         if not content_type.model_class():\n-            raise http.Http404(\"Content type %s object has no associated model\" % content_type_id)\n+            raise http.Http404(\"Content type %s object has no associated model\"\n+                               % content_type_id)\n         obj = content_type.get_object_for_this_type(pk=object_id)\n     except (ObjectDoesNotExist, ValueError):\n-        raise http.Http404(\"Content type %s object %s doesn't exist\" % (content_type_id, object_id))\n+        raise http.Http404(\"Content type %s object %s doesn't exist\"\n+                           % (content_type_id, object_id))\n     try:\n-        absurl = obj.get_absolute_url()\n+        get_absolute_url = obj.get_absolute_url\n     except AttributeError:\n-        raise http.Http404(\"%s objects don't have get_absolute_url() methods\" % content_type.name)\n+        raise http.Http404(\"%s objects don't have a get_absolute_url() method\"\n+                           % content_type.name)\n+    absurl = get_absolute_url()\n \n     # Try to figure out the object's domain, so we can do a cross-site redirect\n     # if necessary.\n@@ -66,6 +72,7 @@ def shortcut(request, content_type_id, object_id):\n     # to whatever get_absolute_url() returned.\n     if object_domain is not None:\n         protocol = request.is_secure() and 'https' or 'http'\n-        return http.HttpResponseRedirect('%s://%s%s' % (protocol, object_domain, absurl))\n+        return http.HttpResponseRedirect('%s://%s%s'\n+                                         % (protocol, object_domain, absurl))\n     else:\n         return http.HttpResponseRedirect(absurl)"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 36,
        "deletions": 6
    }
}