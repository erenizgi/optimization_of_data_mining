{
    "author": "claudep",
    "message": "Fixed #20036 -- Improved GEOS version string parsing\n\nThanks chikiro.spam at gmail.com for the report.",
    "sha": "747f7d25490abc3d7fdb119f0ce3708d450eb4c2",
    "files": [
        {
            "sha": "05e5d1209b01b0bd2503c5c58880ab70dd82f3fd",
            "filename": "django/contrib/gis/geos/libgeos.py",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/747f7d25490abc3d7fdb119f0ce3708d450eb4c2/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py",
            "raw_url": "https://github.com/django/django/raw/747f7d25490abc3d7fdb119f0ce3708d450eb4c2/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py?ref=747f7d25490abc3d7fdb119f0ce3708d450eb4c2",
            "patch": "@@ -108,8 +108,11 @@ def get_pointer_arr(n):\n geos_version.restype = c_char_p\n \n # Regular expression should be able to parse version strings such as\n-# '3.0.0rc4-CAPI-1.3.3', '3.0.0-CAPI-1.4.1' or '3.4.0dev-CAPI-1.8.0'\n-version_regex = re.compile(r'^(?P<version>(?P<major>\\d+)\\.(?P<minor>\\d+)\\.(?P<subminor>\\d+))((rc(?P<release_candidate>\\d+))|dev)?-CAPI-(?P<capi_version>\\d+\\.\\d+\\.\\d+)$')\n+# '3.0.0rc4-CAPI-1.3.3', '3.0.0-CAPI-1.4.1', '3.4.0dev-CAPI-1.8.0' or '3.4.0dev-CAPI-1.8.0 r0'\n+version_regex = re.compile(\n+    r'^(?P<version>(?P<major>\\d+)\\.(?P<minor>\\d+)\\.(?P<subminor>\\d+))'\n+    r'((rc(?P<release_candidate>\\d+))|dev)?-CAPI-(?P<capi_version>\\d+\\.\\d+\\.\\d+)( r\\d+)?$'\n+)\n def geos_version_info():\n     \"\"\"\n     Returns a dictionary containing the various version metadata parsed from\n@@ -119,8 +122,10 @@ def geos_version_info():\n     \"\"\"\n     ver = geos_version().decode()\n     m = version_regex.match(ver)\n-    if not m: raise GEOSException('Could not parse version info string \"%s\"' % ver)\n-    return dict((key, m.group(key)) for key in ('version', 'release_candidate', 'capi_version', 'major', 'minor', 'subminor'))\n+    if not m:\n+        raise GEOSException('Could not parse version info string \"%s\"' % ver)\n+    return dict((key, m.group(key)) for key in (\n+        'version', 'release_candidate', 'capi_version', 'major', 'minor', 'subminor'))\n \n # Version numbers and whether or not prepared geometry support is available.\n _verinfo = geos_version_info()"
        },
        {
            "sha": "66d890d8cbcb6014299ce2f3a89196ffb047021c",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/747f7d25490abc3d7fdb119f0ce3708d450eb4c2/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/747f7d25490abc3d7fdb119f0ce3708d450eb4c2/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=747f7d25490abc3d7fdb119f0ce3708d450eb4c2",
            "patch": "@@ -1080,15 +1080,17 @@ def test_linearref(self):\n         self.assertEqual(mls.interpolate(17), Point(10, 7))\n \n     def test_geos_version(self):\n-        \"Testing the GEOS version regular expression.\"\n+        \"\"\"Testing the GEOS version regular expression.\"\"\"\n         from django.contrib.gis.geos.libgeos import version_regex\n-        versions = [ ('3.0.0rc4-CAPI-1.3.3', '3.0.0'),\n-                     ('3.0.0-CAPI-1.4.1', '3.0.0'),\n-                     ('3.4.0dev-CAPI-1.8.0', '3.4.0') ]\n-        for v, expected in versions:\n-            m = version_regex.match(v)\n-            self.assertTrue(m)\n-            self.assertEqual(m.group('version'), expected)\n+        versions = [('3.0.0rc4-CAPI-1.3.3', '3.0.0', '1.3.3'),\n+                    ('3.0.0-CAPI-1.4.1', '3.0.0', '1.4.1'),\n+                    ('3.4.0dev-CAPI-1.8.0', '3.4.0', '1.8.0'),\n+                    ('3.4.0dev-CAPI-1.8.0 r0', '3.4.0', '1.8.0')]\n+        for v_init, v_geos, v_capi in versions:\n+            m = version_regex.match(v_init)\n+            self.assertTrue(m, msg=\"Unable to parse the version string '%s'\" % v_init)\n+            self.assertEqual(m.group('version'), v_geos)\n+            self.assertEqual(m.group('capi_version'), v_capi)\n \n \n def suite():"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 19,
        "deletions": 12
    }
}