{
    "author": "andrewgodwin",
    "message": "Fixed #14939: Don't strip ;-parameters from URLs in the test client.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15027 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f117b91b4129b769032518d2b565e33eb0810da6",
    "files": [
        {
            "sha": "203828a98a0312796703056a1a7c90728509590f",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/f117b91b4129b769032518d2b565e33eb0810da6/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/f117b91b4129b769032518d2b565e33eb0810da6/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=f117b91b4129b769032518d2b565e33eb0810da6",
            "patch": "@@ -203,13 +203,20 @@ def request(self, **request):\n         \"Construct a generic request object.\"\n         return WSGIRequest(self._base_environ(**request))\n \n+    def _get_path(self, parsed):\n+        # If there are parameters, add them\n+        if parsed[3]:\n+            return urllib.unquote(parsed[2] + \";\" + parsed[3])\n+        else:\n+            return urllib.unquote(parsed[2])\n+\n     def get(self, path, data={}, **extra):\n         \"Construct a GET request\"\n \n         parsed = urlparse(path)\n         r = {\n             'CONTENT_TYPE':    'text/html; charset=utf-8',\n-            'PATH_INFO':       urllib.unquote(parsed[2]),\n+            'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'GET',\n             'wsgi.input':      FakePayload('')\n@@ -236,7 +243,7 @@ def post(self, path, data={}, content_type=MULTIPART_CONTENT,\n         r = {\n             'CONTENT_LENGTH': len(post_data),\n             'CONTENT_TYPE':   content_type,\n-            'PATH_INFO':      urllib.unquote(parsed[2]),\n+            'PATH_INFO':      self._get_path(parsed),\n             'QUERY_STRING':   parsed[4],\n             'REQUEST_METHOD': 'POST',\n             'wsgi.input':     FakePayload(post_data),\n@@ -250,7 +257,7 @@ def head(self, path, data={}, **extra):\n         parsed = urlparse(path)\n         r = {\n             'CONTENT_TYPE':    'text/html; charset=utf-8',\n-            'PATH_INFO':       urllib.unquote(parsed[2]),\n+            'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'HEAD',\n             'wsgi.input':      FakePayload('')\n@@ -263,7 +270,7 @@ def options(self, path, data={}, **extra):\n \n         parsed = urlparse(path)\n         r = {\n-            'PATH_INFO':       urllib.unquote(parsed[2]),\n+            'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'OPTIONS',\n             'wsgi.input':      FakePayload('')\n@@ -290,7 +297,7 @@ def put(self, path, data={}, content_type=MULTIPART_CONTENT,\n         r = {\n             'CONTENT_LENGTH': len(post_data),\n             'CONTENT_TYPE':   content_type,\n-            'PATH_INFO':      urllib.unquote(parsed[2]),\n+            'PATH_INFO':      self._get_path(parsed),\n             'QUERY_STRING':   query_string or parsed[4],\n             'REQUEST_METHOD': 'PUT',\n             'wsgi.input':     FakePayload(post_data),\n@@ -303,7 +310,7 @@ def delete(self, path, data={}, **extra):\n \n         parsed = urlparse(path)\n         r = {\n-            'PATH_INFO':       urllib.unquote(parsed[2]),\n+            'PATH_INFO':       self._get_path(parsed),\n             'QUERY_STRING':    urlencode(data, doseq=True) or parsed[4],\n             'REQUEST_METHOD': 'DELETE',\n             'wsgi.input':      FakePayload('')"
        },
        {
            "sha": "0960929004d1122a6a9e746055577499dbcfe008",
            "filename": "tests/modeltests/test_client/models.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/f117b91b4129b769032518d2b565e33eb0810da6/tests%2Fmodeltests%2Ftest_client%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/f117b91b4129b769032518d2b565e33eb0810da6/tests%2Fmodeltests%2Ftest_client%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftest_client%2Fmodels.py?ref=f117b91b4129b769032518d2b565e33eb0810da6",
            "patch": "@@ -269,6 +269,13 @@ def test_unknown_page(self):\n         # Check that the response was a 404\n         self.assertEqual(response.status_code, 404)\n \n+    def test_url_parameters(self):\n+        \"Make sure that URL ;-parameters are not stripped.\"\n+        response = self.client.get('/test_client/unknown_view/;some-parameter')\n+\n+        # Check that the path in the response includes it (ignore that it's a 404)\n+        self.assertEqual(response.request['PATH_INFO'], '/test_client/unknown_view/;some-parameter')\n+\n     def test_view_with_login(self):\n         \"Request a page that is protected with @login_required\"\n "
        }
    ],
    "stats": {
        "total": 26,
        "additions": 20,
        "deletions": 6
    }
}