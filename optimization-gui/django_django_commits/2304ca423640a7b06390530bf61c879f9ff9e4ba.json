{
    "author": "spookylukey",
    "message": "Fixed bug with `__str__` headers in admin changelist have a non-functioning sort URL\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16312 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "2304ca423640a7b06390530bf61c879f9ff9e4ba",
    "files": [
        {
            "sha": "7204a12fc46ab5a10061aa3fabf826b7f7ef764b",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/2304ca423640a7b06390530bf61c879f9ff9e4ba/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/2304ca423640a7b06390530bf61c879f9ff9e4ba/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=2304ca423640a7b06390530bf61c879f9ff9e4ba",
            "patch": "@@ -226,6 +226,12 @@ def lookup_field(name, obj, model_admin=None):\n \n \n def label_for_field(name, model, model_admin=None, return_attr=False):\n+    \"\"\"\n+    Returns a sensible label for a field name. The name can be a callable or the\n+    name of an object attributes, as well as a genuine fields. If return_attr is\n+    True, the resolved attribute (which could be a callable) is also returned.\n+    This will be None if (and only if) the name refers to a field.\n+    \"\"\"\n     attr = None\n     try:\n         field = model._meta.get_field_by_name(name)[0]\n@@ -236,8 +242,10 @@ def label_for_field(name, model, model_admin=None, return_attr=False):\n     except models.FieldDoesNotExist:\n         if name == \"__unicode__\":\n             label = force_unicode(model._meta.verbose_name)\n+            attr = unicode\n         elif name == \"__str__\":\n             label = smart_str(model._meta.verbose_name)\n+            attr = str\n         else:\n             if callable(name):\n                 attr = name"
        },
        {
            "sha": "cc5783cc86396a483ea038158367c07912fbd623",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/2304ca423640a7b06390530bf61c879f9ff9e4ba/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/2304ca423640a7b06390530bf61c879f9ff9e4ba/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=2304ca423640a7b06390530bf61c879f9ff9e4ba",
            "patch": "@@ -32,7 +32,7 @@\n \n # local test models\n from models import (Article, BarAccount, CustomArticle, EmptyModel,\n-    FooAccount, Gallery, ModelWithStringPrimaryKey,\n+    FooAccount, Gallery, GalleryAdmin, ModelWithStringPrimaryKey,\n     Person, Persona, Picture, Podcast, Section, Subscriber, Vodcast,\n     Language, Collector, Widget, Grommet, DooHickey, FancyDoodad, Whatsit,\n     Category, Post, Plot, FunkyTag, Chapter, Book, Promo, WorkHour, Employee,\n@@ -238,6 +238,17 @@ def testChangeListSortingModelAdmin(self):\n             \"Results of sorting on ModelAdmin method are out of order.\"\n         )\n \n+    def testChangeListSortColumnsDefault(self):\n+        # Need a model that has a list_display with '__str__' as only item.\n+        # Sanity check for assumption made in following test.\n+        self.assertEqual(list(GalleryAdmin.list_display), ['__str__'])\n+        # A header corresponding to '__str__' should not be in an anchor\n+        # for sorting.\n+        g = Gallery.objects.create(name='gallery1')\n+        response = self.client.get('/test_admin/%s/admin_views/gallery/' % self.urlbit, {})\n+        m = re.search('<th scope=\"col\">\\s*Gallery\\s*</th>', response.content)\n+        self.assertTrue(m is not None)\n+\n     def testLimitedFilter(self):\n         \"\"\"Ensure admin changelist filters do not contain objects excluded via limit_choices_to.\n         This also tests relation-spanning filters (e.g. 'color__value')."
        }
    ],
    "stats": {
        "total": 21,
        "additions": 20,
        "deletions": 1
    }
}