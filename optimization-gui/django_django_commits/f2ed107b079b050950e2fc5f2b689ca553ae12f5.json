{
    "author": "jphalip",
    "message": "Simplified the admin changelist multi-sort interface specifically by removing the popup window, adding explicit tooltip help texts, improving the hover visual states and allowing all operations (i.e. removing a column from sorting and toggling the sorting with and without changing the sorting priority) to be actionable with just one click. Many thanks to Idan Gazit for the feedback and direction. Refs #16212.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16899 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f2ed107b079b050950e2fc5f2b689ca553ae12f5",
    "files": [
        {
            "sha": "5db94a7d25e72c84d36323a31e09725d808868ff",
            "filename": "django/contrib/admin/static/admin/css/base.css",
            "status": "modified",
            "additions": 48,
            "deletions": 41,
            "changes": 89,
            "blob_url": "https://github.com/django/django/blob/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fbase.css",
            "raw_url": "https://github.com/django/django/raw/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fbase.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Fbase.css?ref=f2ed107b079b050950e2fc5f2b689ca553ae12f5",
            "patch": "@@ -309,77 +309,84 @@ tr.alt {\n \n /* SORTABLE TABLES */\n \n+thead th {\n+    padding: 0;\n+    line-height: normal;\n+}\n+\n thead th a:link, thead th a:visited {\n     color: #666;\n-    display: block;\n }\n \n thead th.sorted {\n     background: #c5c5c5 url(../img/nav-bg-selected.gif) top left repeat-x;\n }\n \n-table thead th.sorted a {\n-    padding-right: 13px;\n+table thead th .text span {\n+    padding: 2px 5px;\n+    display:block;\n }\n \n-table thead th.ascending a {\n-    background: url(../img/arrow-up.gif) right .4em no-repeat;\n+table thead th .text a {\n+    display: block;\n+    cursor: pointer;\n+    padding: 2px 5px;\n }\n \n-table thead th.descending a {\n-    background: url(../img/arrow-down.gif) right .4em no-repeat;\n+table thead th.sortable:hover {\n+    background: white url(../img/nav-bg-reverse.gif) 0 -5px repeat-x;\n }\n \n-table thead th.sorted a span.text {\n-   display: block;\n-   float: left;\n-   cursor: pointer; /* IE needs this */\n+thead th.sorted a.sortremove {\n+    visibility: hidden;\n }\n \n-table thead th.sorted a span.sortpos {\n-   display: block;\n-   float: right;\n-   font-size: .6em;\n-   text-align: right;\n-   cursor: pointer; /* IE needs this */\n+table thead th.sorted:hover a.sortremove {\n+    visibility: visible;\n }\n \n-table thead th.sorted a img {\n-   vertical-align: top;\n+table thead th.sorted .sortoptions {\n+    display: block;\n+    padding: 4px 5px 0 5px;\n+    float: right;\n+    text-align: right;\n }\n \n-table thead th.sorted a span.clear {\n-   display: block;\n-   clear: both;\n+table thead th.sorted .sortpriority {\n+    font-size: .8em;\n+    min-width: 12px;\n+    text-align: center;\n+    vertical-align: top;\n }\n \n-#sorting-popup-div {\n-    display: none;\n-    position: absolute;\n-    background-color: white;\n-    border: 1px solid #ddd;\n-    z-index: 2000; /* more than filters on right */\n+table thead th.sorted .sortoptions a {\n+    width: 14px;\n+    height: 12px;\n+    display: inline-block;\n }\n \n-#sorting-popup-div table {\n-    border-right: 0px;\n-    border-left: 0px;\n+table thead th.sorted .sortoptions a.sortremove {\n+    background: url(../img/sorting-icons.gif) -4px -5px no-repeat;\n }\n \n-#sorting-popup-div .reset {\n-    text-align: center;\n+table thead th.sorted .sortoptions a.sortremove:hover {\n+    background: url(../img/sorting-icons.gif) -4px -27px no-repeat;\n }\n \n-#sorting-popup-div .cancel {\n-    font-size: 10px;\n-    background: #e1e1e1 url(../img/nav-bg.gif) 0 50% repeat-x;\n-    border-top: 1px solid #ddd;\n-    text-align: center;\n+table thead th.sorted .sortoptions a.ascending {\n+    background: url(../img/sorting-icons.gif) -5px -50px no-repeat;\n }\n \n-#sorting-popup-div .cancel a {\n-    width: 100%;\n-    display: block;\n+table thead th.sorted .sortoptions a.ascending:hover {\n+    background: url(../img/sorting-icons.gif) -5px -72px no-repeat;\n+}\n+\n+table thead th.sorted .sortoptions a.descending {\n+    background: url(../img/sorting-icons.gif) -5px -94px no-repeat;\n+}\n+\n+table thead th.sorted .sortoptions a.descending:hover {\n+    background: url(../img/sorting-icons.gif) -5px -115px no-repeat;\n }\n \n /* ORDERABLE TABLES */"
        },
        {
            "sha": "029bf36f82bae5542969bd0c53f222295229c3a7",
            "filename": "django/contrib/admin/static/admin/css/rtl.css",
            "status": "modified",
            "additions": 1,
            "deletions": 16,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Frtl.css",
            "raw_url": "https://github.com/django/django/raw/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Frtl.css",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fcss%2Frtl.css?ref=f2ed107b079b050950e2fc5f2b689ca553ae12f5",
            "patch": "@@ -80,22 +80,7 @@ div.breadcrumbs {\n \n /* SORTABLE TABLES */\n \n-\n-table thead th.sorted a {\n-    padding-left: 13px;\n-    padding-right: 0px;\n-}\n-\n-table thead th.ascending a,\n-table thead th.descending a {\n-    background-position: left;\n-}\n-\n-table thead th.sorted a span.text {\n-   float: right;\n-}\n-\n-table thead th.sorted a span.sortpos {\n+table thead th.sorted .sortoptions {\n    float: left;\n }\n "
        },
        {
            "sha": "a967b9fd5563a0fc2f5fde8ec0f7de3fc8fbc5a9",
            "filename": "django/contrib/admin/static/admin/img/arrow-down.gif",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b1c3174cfaf2e850da86c7649f64bf62f60046dc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Farrow-down.gif",
            "raw_url": "https://github.com/django/django/raw/b1c3174cfaf2e850da86c7649f64bf62f60046dc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Farrow-down.gif",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Farrow-down.gif?ref=b1c3174cfaf2e850da86c7649f64bf62f60046dc"
        },
        {
            "sha": "3fe4851399a37337891ccf5452ee5d59bbedeec7",
            "filename": "django/contrib/admin/static/admin/img/arrow-up.gif",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b1c3174cfaf2e850da86c7649f64bf62f60046dc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Farrow-up.gif",
            "raw_url": "https://github.com/django/django/raw/b1c3174cfaf2e850da86c7649f64bf62f60046dc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Farrow-up.gif",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Farrow-up.gif?ref=b1c3174cfaf2e850da86c7649f64bf62f60046dc"
        },
        {
            "sha": "e390ef2ef5a00858c6dda1974a1f334eddff46be",
            "filename": "django/contrib/admin/static/admin/img/icon_cog.gif",
            "status": "removed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/b1c3174cfaf2e850da86c7649f64bf62f60046dc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Ficon_cog.gif",
            "raw_url": "https://github.com/django/django/raw/b1c3174cfaf2e850da86c7649f64bf62f60046dc/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Ficon_cog.gif",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Ficon_cog.gif?ref=b1c3174cfaf2e850da86c7649f64bf62f60046dc"
        },
        {
            "sha": "451aae59874c795763cee9b044bf2c487f15a853",
            "filename": "django/contrib/admin/static/admin/img/sorting-icons.gif",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Fsorting-icons.gif",
            "raw_url": "https://github.com/django/django/raw/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Fsorting-icons.gif",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fstatic%2Fadmin%2Fimg%2Fsorting-icons.gif?ref=f2ed107b079b050950e2fc5f2b689ca553ae12f5"
        },
        {
            "sha": "e3d4b2549a842fc0434cb46a3141d3b4887f05af",
            "filename": "django/contrib/admin/templates/admin/change_list_results.html",
            "status": "modified",
            "additions": 11,
            "deletions": 95,
            "changes": 106,
            "blob_url": "https://github.com/django/django/blob/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html",
            "raw_url": "https://github.com/django/django/raw/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplates%2Fadmin%2Fchange_list_results.html?ref=f2ed107b079b050950e2fc5f2b689ca553ae12f5",
            "patch": "@@ -11,15 +11,17 @@\n <tr>\n {% for header in result_headers %}\n <th scope=\"col\" {{ header.class_attrib }}>\n-  {% if header.sortable %}<a href=\"{{ header.url_primary }}\">{% endif %}\n-  <span class=\"text\">{{ header.text|capfirst }}</span>\n-  {% if header.sortable %}\n-    {% if header.sort_pos > 0 %}<span class=\"sortpos\">\n-      {% if header.sort_pos == 1 %}<img id=\"primary-sort-icon\" src=\"{% static \"admin/img/icon_cog.gif\" %}\" alt=\"\" />&nbsp;{% endif %}\n-      {{ header.sort_pos }}</span>\n-    {% endif %}\n-    <span class=\"clear\"></span></a>\n-  {% endif %}\n+   {% if header.sortable %}\n+     {% if header.sort_priority > 0 %}\n+       <div class=\"sortoptions\">\n+         <a class=\"sortremove\" href=\"{{ header.url_remove }}\" title=\"{% trans \"Remove from sorting\" %}\"></a>\n+         {% if num_sorted_fields > 1 %}<span class=\"sortpriority\" title=\"{% blocktrans with priority_number=header.sort_priority %}Sorting priority: {{ priority_number }}{% endblocktrans %}\">{{ header.sort_priority }}</span>{% endif %}\n+         <a href=\"{{ header.url_toggle }}\" class=\"toggle {% if header.ascending %}ascending{% else %}descending{% endif %}\" title=\"{% trans \"Toggle sorting\" %}\"></a>\n+       </div>\n+     {% endif %}\n+   {% endif %}\n+   <div class=\"text\">{% if header.sortable %}<a href=\"{{ header.url_primary }}\">{{ header.text|capfirst }}</a>{% else %}<span>{{ header.text|capfirst }}</span>{% endif %}</div>\n+   <div class=\"clear\"></div>\n </th>{% endfor %}\n </tr>\n </thead>\n@@ -33,90 +35,4 @@\n </tbody>\n </table>\n </div>\n-\n-{# Sorting popup: #}\n-<div id=\"sorting-popup-div\">\n-<table>\n-  <caption>\n-   {% trans \"Sorting by:\" %}\n-  </caption>\n-  <tbody>\n-  {% for header in result_headers|dictsort:\"sort_pos\" %}\n-    {% if header.sort_pos > 0 %}\n-    <tr>\n-      <td>{{ header.sort_pos }}</td>\n-      <td>{{ header.text|capfirst }}</td>\n-      <td>{% if header.ascending %}{% trans \"ascending\" %}{% else %}{% trans \"descending\" %}{% endif %}</td>\n-      <td><a href=\"{{ header.url_toggle }}\">{% trans \"toggle\" %}</a></td>\n-      <td><a href=\"{{ header.url_remove }}\">{% trans \"remove\" %}</a></td>\n-    </tr>\n-    {% endif %}\n-  {% endfor %}\n-  </tbody>\n-</table>\n-<div class=\"reset\"><a href=\"{{ reset_sorting_url }}\">{% trans \"Reset sorting\" %}</a></div>\n-<div class=\"cancel\"><a href=\"javascript:void\" id=\"sorting-popup-dismiss\">{% trans \"Cancel\" %}</a></div>\n-</div>\n-<script type=\"text/javascript\">\n-<!--\n-(function($) {\n-    $(document).ready(function() {\n-        var popup = $('#sorting-popup-div');\n-        var img = $('#primary-sort-icon');\n-        /* These next lines seems necessary to prime the popup: */\n-        popup.offset({left:0, top:-1000});\n-        popup.show();\n-        if ($.browser.msie) {\n-            // Can't find a way to make IE autosize the div.\n-            popup.width(300);\n-        }\n-        var popupWidth = popup.width();\n-        popup.hide();\n-\n-        var visible = false;\n-\n-        var escHandler = function(ev) {\n-            if (ev.which == 27) {\n-                hidePopup();\n-                ev.preventDefault();\n-            }\n-        };\n-\n-        var showPopup = function() {\n-            var pos = img.offset();\n-            pos.top += img.height();\n-            if (pos.left + popupWidth >\n-                $(window).width()) {\n-                pos.left -= popupWidth;\n-            }\n-            popup.show();\n-            popup.offset(pos);\n-            visible = true;\n-            $(document).bind('keyup', escHandler);\n-        };\n-\n-        var hidePopup = function() {\n-            popup.hide();\n-            visible = false;\n-            $(document).unbind('keyup', escHandler);\n-        };\n-\n-        $('#primary-sort-icon').click(function(ev) {\n-            ev.preventDefault();\n-            if (visible) {\n-                hidePopup();\n-            } else {\n-                showPopup();\n-            }\n-        });\n-\n-        $('#sorting-popup-dismiss').click(function(ev) {\n-            hidePopup();\n-            ev.preventDefault()\n-        });\n-    });\n-})(django.jQuery);\n-//-->\n-</script>\n-\n {% endif %}"
        },
        {
            "sha": "ba3d1329ad7d20cf1c004a0628635d74ebe29ee8",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 17,
            "deletions": 10,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/f2ed107b079b050950e2fc5f2b689ca553ae12f5/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=f2ed107b079b050950e2fc5f2b689ca553ae12f5",
            "patch": "@@ -83,7 +83,6 @@ def result_headers(cl):\n     \"\"\"\n     ordering_field_columns = cl.get_ordering_field_columns()\n     for i, field_name in enumerate(cl.list_display):\n-        admin_order_field = None\n         text, attr = label_for_field(field_name, cl.model,\n             model_admin = cl.model_admin,\n             return_attr = True\n@@ -95,25 +94,31 @@ def result_headers(cl):\n             if field_name == 'action_checkbox':\n                 yield {\n                     \"text\": text,\n-                    \"class_attrib\": mark_safe(' class=\"action-checkbox-column\"')\n+                    \"class_attrib\": mark_safe(' class=\"action-checkbox-column\"'),\n+                    \"sortable\": False,\n                 }\n                 continue\n \n             admin_order_field = getattr(attr, \"admin_order_field\", None)\n             if not admin_order_field:\n                 # Not sortable\n-                yield {\"text\": text}\n+                yield {\n+                    \"text\": text,\n+                    \"sortable\": False,\n+                }\n                 continue\n \n         # OK, it is sortable if we got this far\n-        th_classes = []\n+        th_classes = ['sortable']\n         order_type = ''\n         new_order_type = 'asc'\n-        sort_pos = 0\n+        sort_priority = 0\n+        sorted = False\n         # Is it currently being sorted on?\n         if i in ordering_field_columns:\n+            sorted = True\n             order_type = ordering_field_columns.get(i).lower()\n-            sort_pos = ordering_field_columns.keys().index(i) + 1\n+            sort_priority = ordering_field_columns.keys().index(i) + 1\n             th_classes.append('sorted %sending' % order_type)\n             new_order_type = {'asc': 'desc', 'desc': 'asc'}[order_type]\n \n@@ -144,8 +149,9 @@ def result_headers(cl):\n         yield {\n             \"text\": text,\n             \"sortable\": True,\n+            \"sorted\": sorted,\n             \"ascending\": order_type == \"asc\",\n-            \"sort_pos\": sort_pos,\n+            \"sort_priority\": sort_priority,\n             \"url_primary\": cl.get_query_string({ORDER_VAR: '.'.join(o_list_primary)}),\n             \"url_remove\": cl.get_query_string({ORDER_VAR: '.'.join(o_list_remove)}),\n             \"url_toggle\": cl.get_query_string({ORDER_VAR: '.'.join(o_list_toggle)}),\n@@ -260,13 +266,14 @@ def result_list(cl):\n     Displays the headers and data list together\n     \"\"\"\n     headers = list(result_headers(cl))\n+    num_sorted_fields = 0\n     for h in headers:\n-        # Sorting in templates depends on sort_pos attribute\n-        h.setdefault('sort_pos', 0)\n+        if h['sortable'] and h['sorted']:\n+            num_sorted_fields += 1\n     return {'cl': cl,\n             'result_hidden_fields': list(result_hidden_fields(cl)),\n             'result_headers': headers,\n-            'reset_sorting_url': cl.get_query_string(remove=[ORDER_VAR]),\n+            'num_sorted_fields': num_sorted_fields,\n             'results': list(results(cl))}\n \n @register.inclusion_tag('admin/date_hierarchy.html')"
        },
        {
            "sha": "9cf268a869cf01dbbfc668ee5a4d4d76dfca6ef7",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/f2ed107b079b050950e2fc5f2b689ca553ae12f5/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/f2ed107b079b050950e2fc5f2b689ca553ae12f5/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=f2ed107b079b050950e2fc5f2b689ca553ae12f5",
            "patch": "@@ -360,13 +360,16 @@ Removed admin icons\n ~~~~~~~~~~~~~~~~~~~\n \n As part of an effort to improve the performance and usability of the admin's\n-vertical and horizontal \"filter\" widgets, some icon files were removed and\n-grouped into a single sprite file (``selector-icons.gif``):\n+changelist sorting interface and of the admin's :attr:`horizontal\n+<django.contrib.admin.ModelAdmin.filter_horizontal>` and :attr:`vertical\n+<django.contrib.admin.ModelAdmin.filter_vertical>` \"filter\" widgets, some icon\n+files were removed and grouped into two sprite files, respectively:\n ``selector-add.gif``, ``selector-addall.gif``, ``selector-remove.gif``,\n ``selector-removeall.gif``, ``selector_stacked-add.gif`` and\n-``selector_stacked-remove.gif``. If you used those icons to customize the\n-admin then you will want to replace them with your own icons or retrieve them\n-from a previous release.\n+``selector_stacked-remove.gif`` into ``selector-icons.gif``; and\n+``arrow-up.gif`` and ``arrow-down.gif`` into ``sorting-icons.gif``. If you used\n+those icons to customize the admin then you will want to replace them with your\n+own icons or retrieve them from a previous release.\n \n Compatibility with old signed data\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
        }
    ],
    "stats": {
        "total": 252,
        "additions": 85,
        "deletions": 167
    }
}