{
    "author": "carljm",
    "message": "Fixed #15903 -- Allowed not-installed models to still be referenced in related fields. Missed case from r16053.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16106 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "c85b765288b2c36c948493a99706550eaf41a0b5",
    "files": [
        {
            "sha": "2c35fdb1df961f85d2a352671bf9d77449d681d8",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/c85b765288b2c36c948493a99706550eaf41a0b5/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/c85b765288b2c36c948493a99706550eaf41a0b5/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=c85b765288b2c36c948493a99706550eaf41a0b5",
            "patch": "@@ -159,7 +159,8 @@ def get_app_errors(self):\n         return self.app_errors\n \n     def get_models(self, app_mod=None,\n-                   include_auto_created=False, include_deferred=False):\n+                   include_auto_created=False, include_deferred=False,\n+                   only_installed=True):\n         \"\"\"\n         Given a module containing models, returns a list of the models.\n         Otherwise returns a list of all installed models.\n@@ -172,7 +173,7 @@ def get_models(self, app_mod=None,\n         queries are *not* included in the list of models. However, if\n         you specify include_deferred, they will be.\n         \"\"\"\n-        cache_key = (app_mod, include_auto_created, include_deferred)\n+        cache_key = (app_mod, include_auto_created, include_deferred, only_installed)\n         try:\n             return self._get_models_cache[cache_key]\n         except KeyError:\n@@ -185,8 +186,11 @@ def get_models(self, app_mod=None,\n             else:\n                 app_list = []\n         else:\n-            app_list = [self.app_models.get(app_label, SortedDict())\n-                        for app_label in self.app_labels.iterkeys()]\n+            if only_installed:\n+                app_list = [self.app_models.get(app_label, SortedDict())\n+                            for app_label in self.app_labels.iterkeys()]\n+            else:\n+                app_list = self.app_models.itervalues()\n         model_list = []\n         for app in app_list:\n             model_list.extend("
        },
        {
            "sha": "15cb18b1336c979242924d08a30e6b38d61ae919",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/c85b765288b2c36c948493a99706550eaf41a0b5/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/c85b765288b2c36c948493a99706550eaf41a0b5/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=c85b765288b2c36c948493a99706550eaf41a0b5",
            "patch": "@@ -383,7 +383,7 @@ def _fill_related_objects_cache(self):\n                     cache[obj] = parent\n                 else:\n                     cache[obj] = model\n-        for klass in get_models(include_auto_created=True):\n+        for klass in get_models(include_auto_created=True, only_installed=False):\n             for f in klass._meta.local_fields:\n                 if f.rel and not isinstance(f.rel.to, str) and self == f.rel.to._meta:\n                     cache[RelatedObject(f.rel.to, klass, f)] = None"
        },
        {
            "sha": "f62235dfd5c21729e28dccc5c49fe8482f371532",
            "filename": "tests/regressiontests/app_loading/not_installed/models.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/c85b765288b2c36c948493a99706550eaf41a0b5/tests%2Fregressiontests%2Fapp_loading%2Fnot_installed%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/c85b765288b2c36c948493a99706550eaf41a0b5/tests%2Fregressiontests%2Fapp_loading%2Fnot_installed%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fapp_loading%2Fnot_installed%2Fmodels.py?ref=c85b765288b2c36c948493a99706550eaf41a0b5",
            "patch": "@@ -3,3 +3,7 @@\n \n class NotInstalledModel(models.Model):\n     pass\n+\n+\n+class RelatedModel(models.Model):\n+    not_installed = models.ForeignKey(NotInstalledModel)"
        },
        {
            "sha": "3036ab8c07b13953bd3a8e2138322854379e489e",
            "filename": "tests/regressiontests/app_loading/tests.py",
            "status": "modified",
            "additions": 23,
            "deletions": 2,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/c85b765288b2c36c948493a99706550eaf41a0b5/tests%2Fregressiontests%2Fapp_loading%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/c85b765288b2c36c948493a99706550eaf41a0b5/tests%2Fregressiontests%2Fapp_loading%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fapp_loading%2Ftests.py?ref=c85b765288b2c36c948493a99706550eaf41a0b5",
            "patch": "@@ -85,15 +85,22 @@ def test_egg5(self):\n \n class GetModelsTest(TestCase):\n     def setUp(self):\n-        import not_installed.models\n-        self.not_installed_module = not_installed.models\n+        from .not_installed import models\n+        self.not_installed_module = models\n \n \n     def test_get_model_only_returns_installed_models(self):\n         self.assertEqual(\n             get_model(\"not_installed\", \"NotInstalledModel\"), None)\n \n \n+    def test_get_model_with_not_installed(self):\n+        self.assertEqual(\n+            get_model(\n+                \"not_installed\", \"NotInstalledModel\", only_installed=False),\n+            self.not_installed_module.NotInstalledModel)\n+\n+\n     def test_get_models_only_returns_installed_models(self):\n         self.assertFalse(\n             \"NotInstalledModel\" in\n@@ -102,3 +109,17 @@ def test_get_models_only_returns_installed_models(self):\n \n     def test_get_models_with_app_label_only_returns_installed_models(self):\n         self.assertEqual(get_models(self.not_installed_module), [])\n+\n+\n+    def test_get_models_with_not_installed(self):\n+        self.assertTrue(\n+            \"NotInstalledModel\" in [\n+                m.__name__ for m in get_models(only_installed=False)])\n+\n+\n+class NotInstalledModelsTest(TestCase):\n+    def test_related_not_installed_model(self):\n+        from .not_installed.models import NotInstalledModel\n+        self.assertEqual(\n+            set(NotInstalledModel._meta.get_all_field_names()),\n+            set([\"id\", \"relatedmodel\"]))"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 36,
        "deletions": 7
    }
}