{
    "author": "jbronn",
    "message": "Fixed #17212 -- Made GEOS version regular expression more robust.  Thanks, strk.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17682 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "771fce45b40deec44b47014829c1f7e973fc7fd7",
    "files": [
        {
            "sha": "a4f5adf4d0d74382df8ddeefb123511b998f794f",
            "filename": "django/contrib/gis/geos/libgeos.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/771fce45b40deec44b47014829c1f7e973fc7fd7/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py",
            "raw_url": "https://github.com/django/django/raw/771fce45b40deec44b47014829c1f7e973fc7fd7/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Flibgeos.py?ref=771fce45b40deec44b47014829c1f7e973fc7fd7",
            "patch": "@@ -101,8 +101,8 @@ def get_pointer_arr(n):\n geos_version.restype = c_char_p\n \n # Regular expression should be able to parse version strings such as\n-# '3.0.0rc4-CAPI-1.3.3', or '3.0.0-CAPI-1.4.1'\n-version_regex = re.compile(r'^(?P<version>(?P<major>\\d+)\\.(?P<minor>\\d+)\\.(?P<subminor>\\d+))(rc(?P<release_candidate>\\d+))?-CAPI-(?P<capi_version>\\d+\\.\\d+\\.\\d+)$')\n+# '3.0.0rc4-CAPI-1.3.3', '3.0.0-CAPI-1.4.1' or '3.4.0dev-CAPI-1.8.0'\n+version_regex = re.compile(r'^(?P<version>(?P<major>\\d+)\\.(?P<minor>\\d+)\\.(?P<subminor>\\d+))((rc(?P<release_candidate>\\d+))|dev)?-CAPI-(?P<capi_version>\\d+\\.\\d+\\.\\d+)$')\n def geos_version_info():\n     \"\"\"\n     Returns a dictionary containing the various version metadata parsed from"
        },
        {
            "sha": "a8372b4f699a4721b6e7f5a9f49e40481b2ec225",
            "filename": "django/contrib/gis/geos/tests/test_geos.py",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/771fce45b40deec44b47014829c1f7e973fc7fd7/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "raw_url": "https://github.com/django/django/raw/771fce45b40deec44b47014829c1f7e973fc7fd7/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeos%2Ftests%2Ftest_geos.py?ref=771fce45b40deec44b47014829c1f7e973fc7fd7",
            "patch": "@@ -901,7 +901,7 @@ def test23_transform_nosrid(self):\n             # Keeping line-noise down by only printing the relevant\n             # warnings once.\n             warnings.simplefilter('once', UserWarning)\n-            warnings.simplefilter('once', FutureWarning)    \n+            warnings.simplefilter('once', FutureWarning)\n \n             g = GEOSGeometry('POINT (-104.609 38.255)', srid=None)\n             g.transform(2774)\n@@ -1049,6 +1049,18 @@ def test27_valid_reason(self):\n \n         print \"\\nEND - expecting GEOS_NOTICE; safe to ignore.\\n\"\n \n+    def test28_geos_version(self):\n+        \"Testing the GEOS version regular expression.\"\n+        from django.contrib.gis.geos.libgeos import version_regex\n+        versions = [ ('3.0.0rc4-CAPI-1.3.3', '3.0.0'),\n+                     ('3.0.0-CAPI-1.4.1', '3.0.0'),\n+                     ('3.4.0dev-CAPI-1.8.0', '3.4.0') ]\n+        for v, expected in versions:\n+            m = version_regex.match(v)\n+            self.assertTrue(m)\n+            self.assertEqual(m.group('version'), expected)\n+\n+\n def suite():\n     s = unittest.TestSuite()\n     s.addTest(unittest.makeSuite(GEOSTest))"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 15,
        "deletions": 3
    }
}