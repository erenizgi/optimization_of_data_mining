{
    "author": "akaariai",
    "message": "Removed use of SortedDict for query.alias_refcount\n\nThis will have a smallish impact on performance. Refs #19276.",
    "sha": "ce1af8d7023f02e4521cce3bcdbc9fd13d76c5f8",
    "files": [
        {
            "sha": "4cfb816958dfe92999091b454e5c5bdef5065bd1",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/ce1af8d7023f02e4521cce3bcdbc9fd13d76c5f8/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/ce1af8d7023f02e4521cce3bcdbc9fd13d76c5f8/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=ce1af8d7023f02e4521cce3bcdbc9fd13d76c5f8",
            "patch": "@@ -103,7 +103,7 @@ class Query(object):\n \n     def __init__(self, model, where=WhereNode):\n         self.model = model\n-        self.alias_refcount = SortedDict()\n+        self.alias_refcount = {}\n         # alias_map is the most important data structure regarding joins.\n         # It's used for recording which joins exist in the query and what\n         # type they are. The key is the alias of the joined table (possibly\n@@ -860,7 +860,7 @@ def count_active_tables(self):\n         count. Note that after execution, the reference counts are zeroed, so\n         tables added in compiler will not be seen by this method.\n         \"\"\"\n-        return len([1 for count in six.itervalues(self.alias_refcount) if count])\n+        return len([1 for count in self.alias_refcount.values() if count])\n \n     def join(self, connection, reuse=REUSE_ALL, promote=False,\n              outer_if_first=False, nullable=False):\n@@ -1532,9 +1532,9 @@ def split_exclude(self, filter_expr, prefix, can_reuse):\n         # comparison to NULL (e.g. in\n         # Tag.objects.exclude(parent__parent__name='t1'), a tag with no parent\n         # would otherwise be overlooked).\n-        active_positions = [pos for (pos, count) in\n-                enumerate(six.itervalues(query.alias_refcount)) if count]\n-        if active_positions[-1] > 1:\n+        active_positions = len([count for count\n+                                in query.alias_refcount.items() if count])\n+        if active_positions > 1:\n             self.add_filter(('%s__isnull' % prefix, False), negate=True,\n                     trim=True, can_reuse=can_reuse)\n "
        }
    ],
    "stats": {
        "total": 10,
        "additions": 5,
        "deletions": 5
    }
}