{
    "author": "jphalip",
    "message": "Fixed #15912 -- Ensured that `forms.CharField.widget_attrs()` always returns a dictionary. Thanks to tsabi and rubyruy for the report and to mmcnickle and prestontimmons for the patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17096 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce",
    "files": [
        {
            "sha": "7f8bac5052ec049da2f15e045e8c6fb269d9e1b9",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce",
            "patch": "@@ -197,9 +197,11 @@ def to_python(self, value):\n         return smart_unicode(value)\n \n     def widget_attrs(self, widget):\n+        attrs = super(CharField, self).widget_attrs(widget)\n         if self.max_length is not None and isinstance(widget, (TextInput, PasswordInput)):\n             # The HTML attribute is maxlength, not max_length.\n-            return {'maxlength': str(self.max_length)}\n+            attrs.update({'maxlength': str(self.max_length)})\n+        return attrs\n \n class IntegerField(Field):\n     default_error_messages = {"
        },
        {
            "sha": "7dd3a27dc1abd3ea21f3082b19cf7dc5b9d9ed37",
            "filename": "tests/regressiontests/forms/tests/fields.py",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Ffields.py?ref=a6ccc8cc06e6b304e35f7a16f6067e6fa09b63ce",
            "patch": "@@ -136,6 +136,23 @@ def test_charfield_5(self):\n         self.assertEqual(f.max_length, None)\n         self.assertEqual(f.min_length, 10)\n \n+    def test_charfield_widget_attrs(self):\n+        \"\"\"\n+        Ensure that CharField.widget_attrs() always returns a dictionary.\n+        Refs #15912\n+        \"\"\"\n+        # Return an empty dictionary if max_length is None\n+        f = CharField()\n+        self.assertEqual(f.widget_attrs(TextInput()), {})\n+\n+        # Or if the widget is not TextInput or PasswordInput\n+        f = CharField(max_length=10)\n+        self.assertEqual(f.widget_attrs(HiddenInput()), {})\n+\n+        # Otherwise, return a maxlength attribute equal to max_length\n+        self.assertEqual(f.widget_attrs(TextInput()), {'maxlength': '10'})\n+        self.assertEqual(f.widget_attrs(PasswordInput()), {'maxlength': '10'})\n+\n     # IntegerField ################################################################\n \n     def test_integerfield_1(self):"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 20,
        "deletions": 1
    }
}