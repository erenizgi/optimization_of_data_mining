{
    "author": "claudep",
    "message": "Fixed #18993 -- 'django' logger logs to console when DEBUG=True\n\nThanks Preston Holmes for the review.",
    "sha": "f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf",
    "files": [
        {
            "sha": "9e079612212c0a5a0c849c1613c96343543acc95",
            "filename": "django/utils/log.py",
            "status": "modified",
            "additions": 19,
            "deletions": 6,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/django%2Futils%2Flog.py",
            "raw_url": "https://github.com/django/django/raw/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/django%2Futils%2Flog.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Flog.py?ref=f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf",
            "patch": "@@ -24,18 +24,25 @@ def emit(self, record):\n \n getLogger = logging.getLogger\n \n-# Default logging for Django. This sends an email to\n-# the site admins on every HTTP 500 error. All other log\n-# records are sent to the bit bucket.\n+# Default logging for Django. This sends an email to the site admins on every\n+# HTTP 500 error. Depending on DEBUG, all other log records are either sent to\n+# the console (DEBUG=True) or discarded by mean of the NullHandler (DEBUG=False).\n DEFAULT_LOGGING = {\n     'version': 1,\n     'disable_existing_loggers': False,\n     'filters': {\n         'require_debug_false': {\n             '()': 'django.utils.log.RequireDebugFalse',\n-        }\n+        },\n+        'require_debug_true': {\n+            '()': 'django.utils.log.RequireDebugTrue',\n+        },\n     },\n     'handlers': {\n+        'console':{\n+            'level': 'INFO',\n+            'class': 'logging.StreamHandler',\n+        },\n         'null': {\n             'class': 'django.utils.log.NullHandler',\n         },\n@@ -47,12 +54,13 @@ def emit(self, record):\n     },\n     'loggers': {\n         'django': {\n-            'handlers': ['null'],\n+            'handlers': ['console'],\n+            'filters': ['require_debug_true'],\n         },\n         'django.request': {\n             'handlers': ['mail_admins'],\n             'level': 'ERROR',\n-            'propagate': True,\n+            'propagate': False,\n         },\n     }\n }\n@@ -130,3 +138,8 @@ def filter(self, record):\n class RequireDebugFalse(logging.Filter):\n     def filter(self, record):\n         return not settings.DEBUG\n+\n+\n+class RequireDebugTrue(logging.Filter):\n+    def filter(self, record):\n+       return settings.DEBUG"
        },
        {
            "sha": "367b4f8349233a91b6ebbae56c13a62ab5217973",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf",
            "patch": "@@ -172,6 +172,10 @@ Django 1.5 also includes several smaller improvements worth noting:\n * An instance of :class:`~django.core.urlresolvers.ResolverMatch` is stored on\n   the request as ``resolver_match``.\n \n+* By default, all logging messages reaching the `django` logger when\n+  :setting:`DEBUG` is `True` are sent to the console (unless you redefine the\n+  logger in your :setting:`LOGGING` setting).\n+\n Backwards incompatible changes in 1.5\n =====================================\n "
        },
        {
            "sha": "7bd56e92ecf860f4084388bad3a3b2321e9b7924",
            "filename": "docs/topics/logging.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/docs%2Ftopics%2Flogging.txt",
            "raw_url": "https://github.com/django/django/raw/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/docs%2Ftopics%2Flogging.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Flogging.txt?ref=f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf",
            "patch": "@@ -546,6 +546,13 @@ logging module.\n             }\n         },\n \n+.. class:: RequireDebugTrue()\n+\n+   .. versionadded:: 1.5\n+\n+   This filter is similar to :class:`RequireDebugFalse`, except that records are\n+   passed only when :setting:`DEBUG` is `True`.\n+\n .. _default-logging-configuration:\n \n Django's default logging configuration\n@@ -555,5 +562,14 @@ By default, Django configures the ``django.request`` logger so that all messages\n with ``ERROR`` or ``CRITICAL`` level are sent to :class:`AdminEmailHandler`, as\n long as the :setting:`DEBUG` setting is set to ``False``.\n \n-All messages reaching the ``django`` catch-all logger are discarded\n-(sent to ``NullHandler``).\n+All messages reaching the ``django`` catch-all logger when :setting:`DEBUG` is\n+`True` are sent ot the console. They are simply discarded (sent to\n+``NullHandler``) when :setting:`DEBUG` is `False`.\n+\n+.. versionchanged:: 1.5\n+\n+    Before Django 1.5, all messages reaching the ``django`` logger were\n+    discarded, regardless of :setting:`DEBUG`.\n+\n+See also :ref:`Configuring logging <configuring-logging>` to learn how you can\n+complement or replace this default logging configuration."
        },
        {
            "sha": "e40800efde4e9e1035392da18e849d9869fbbcb3",
            "filename": "tests/regressiontests/logging_tests/tests.py",
            "status": "modified",
            "additions": 30,
            "deletions": 10,
            "changes": 40,
            "blob_url": "https://github.com/django/django/blob/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf/tests%2Fregressiontests%2Flogging_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Flogging_tests%2Ftests.py?ref=f0f327bbfe1caae6d11fbe20a3b5b96eed1704cf",
            "patch": "@@ -9,6 +9,7 @@\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n from django.utils.log import CallbackFilter, RequireDebugFalse\n+from django.utils.six import StringIO\n \n from ..admin_scripts.tests import AdminScriptTestCase\n \n@@ -109,6 +110,28 @@ def test_no_patch_if_no_mail_admins_handler(self):\n         self.assertEqual(config, new_config)\n \n \n+class DefaultLoggingTest(TestCase):\n+    def setUp(self):\n+        self.logger = logging.getLogger('django')\n+        self.old_stream = self.logger.handlers[0].stream\n+\n+    def tearDown(self):\n+        self.logger.handlers[0].stream = self.old_stream\n+\n+    def test_django_logger(self):\n+        \"\"\"\n+        The 'django' base logger only output anything when DEBUG=True.\n+        \"\"\"\n+        output = StringIO()\n+        self.logger.handlers[0].stream = output\n+        self.logger.error(\"Hey, this is an error.\")\n+        self.assertEqual(output.getvalue(), '')\n+\n+        with self.settings(DEBUG=True):\n+            self.logger.error(\"Hey, this is an error.\")\n+            self.assertEqual(output.getvalue(), 'Hey, this is an error.\\n')\n+\n+\n class CallbackFilterTest(TestCase):\n     def test_sense(self):\n         f_false = CallbackFilter(lambda r: False)\n@@ -131,6 +154,7 @@ def _callback(record):\n \n \n class AdminEmailHandlerTest(TestCase):\n+    logger = logging.getLogger('django.request')\n \n     def get_admin_email_handler(self, logger):\n         # Inspired from regressiontests/views/views.py: send_log()\n@@ -156,14 +180,13 @@ def test_accepts_args(self):\n         token1 = 'ping'\n         token2 = 'pong'\n \n-        logger = logging.getLogger('django.request')\n-        admin_email_handler = self.get_admin_email_handler(logger)\n+        admin_email_handler = self.get_admin_email_handler(self.logger)\n         # Backup then override original filters\n         orig_filters = admin_email_handler.filters\n         try:\n             admin_email_handler.filters = []\n \n-            logger.error(message, token1, token2)\n+            self.logger.error(message, token1, token2)\n \n             self.assertEqual(len(mail.outbox), 1)\n             self.assertEqual(mail.outbox[0].to, ['admin@example.com'])\n@@ -187,15 +210,14 @@ def test_accepts_args_and_request(self):\n         token1 = 'ping'\n         token2 = 'pong'\n \n-        logger = logging.getLogger('django.request')\n-        admin_email_handler = self.get_admin_email_handler(logger)\n+        admin_email_handler = self.get_admin_email_handler(self.logger)\n         # Backup then override original filters\n         orig_filters = admin_email_handler.filters\n         try:\n             admin_email_handler.filters = []\n             rf = RequestFactory()\n             request = rf.get('/')\n-            logger.error(message, token1, token2,\n+            self.logger.error(message, token1, token2,\n                 extra={\n                     'status_code': 403,\n                     'request': request,\n@@ -225,8 +247,7 @@ def test_subject_accepts_newlines(self):\n \n         self.assertEqual(len(mail.outbox), 0)\n \n-        logger = logging.getLogger('django.request')\n-        logger.error(message)\n+        self.logger.error(message)\n \n         self.assertEqual(len(mail.outbox), 1)\n         self.assertFalse('\\n' in mail.outbox[0].subject)\n@@ -250,8 +271,7 @@ def test_truncate_subject(self):\n \n         self.assertEqual(len(mail.outbox), 0)\n \n-        logger = logging.getLogger('django.request')\n-        logger.error(message)\n+        self.logger.error(message)\n \n         self.assertEqual(len(mail.outbox), 1)\n         self.assertEqual(mail.outbox[0].subject, expected_subject)"
        }
    ],
    "stats": {
        "total": 89,
        "additions": 71,
        "deletions": 18
    }
}