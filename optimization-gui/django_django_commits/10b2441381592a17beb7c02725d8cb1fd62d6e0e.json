{
    "author": "freakboy3742",
    "message": "Fixed #14982 -- Ensure that EMPTY_CHANGELIST_VALUE is honored for nullable foreign keys. Thanks to marcob for the report and fix, and to sontek for the test case.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15286 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "10b2441381592a17beb7c02725d8cb1fd62d6e0e",
    "files": [
        {
            "sha": "db58af9f2c980577939535a32bde1523196de7a2",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/10b2441381592a17beb7c02725d8cb1fd62d6e0e/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/10b2441381592a17beb7c02725d8cb1fd62d6e0e/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=10b2441381592a17beb7c02725d8cb1fd62d6e0e",
            "patch": "@@ -156,7 +156,11 @@ def items_for_result(cl, result, form):\n                 if value is None:\n                     result_repr = EMPTY_CHANGELIST_VALUE\n                 if isinstance(f.rel, models.ManyToOneRel):\n-                    result_repr = escape(getattr(result, f.name))\n+                    field_val = getattr(result, f.name)\n+                    if field_val is None:\n+                        result_repr = EMPTY_CHANGELIST_VALUE\n+                    else:\n+                        result_repr = escape(field_val)\n                 else:\n                     result_repr = display_for_field(value, f)\n                 if isinstance(f, models.DateField) or isinstance(f, models.TimeField):"
        },
        {
            "sha": "858d6dfd4587a53b84b1890af6d7015152838d4f",
            "filename": "tests/regressiontests/admin_changelist/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/10b2441381592a17beb7c02725d8cb1fd62d6e0e/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/10b2441381592a17beb7c02725d8cb1fd62d6e0e/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Fmodels.py?ref=10b2441381592a17beb7c02725d8cb1fd62d6e0e",
            "patch": "@@ -5,5 +5,5 @@ class Parent(models.Model):\n     name = models.CharField(max_length=128)\n \n class Child(models.Model):\n-    parent = models.ForeignKey(Parent, editable=False)\n-    name = models.CharField(max_length=30, blank=True)\n\\ No newline at end of file\n+    parent = models.ForeignKey(Parent, editable=False, null=True)\n+    name = models.CharField(max_length=30, blank=True)"
        },
        {
            "sha": "c3f6186770cbc3b48a0467d64e7d540228949286",
            "filename": "tests/regressiontests/admin_changelist/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/10b2441381592a17beb7c02725d8cb1fd62d6e0e/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/10b2441381592a17beb7c02725d8cb1fd62d6e0e/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_changelist%2Ftests.py?ref=10b2441381592a17beb7c02725d8cb1fd62d6e0e",
            "patch": "@@ -20,6 +20,26 @@ def test_select_related_preserved(self):\n                 m.list_select_related, m.list_per_page, m.list_editable, m)\n         self.assertEqual(cl.query_set.query.select_related, {'parent': {'name': {}}})\n \n+    def test_result_list_empty_changelist_value(self):\n+        \"\"\"\n+        Regression test for #14982: EMPTY_CHANGELIST_VALUE should be honored\n+        for relationship fields\n+        \"\"\"\n+        new_child = Child.objects.create(name='name', parent=None)\n+        request = MockRequest()\n+        m = ChildAdmin(Child, admin.site)\n+        cl = ChangeList(request, Child, m.list_display, m.list_display_links,\n+                m.list_filter, m.date_hierarchy, m.search_fields,\n+                m.list_select_related, m.list_per_page, m.list_editable, m)\n+        cl.formset = None\n+        template = Template('{% load admin_list %}{% spaceless %}{% result_list cl %}{% endspaceless %}')\n+        context = Context({'cl': cl})\n+        table_output = template.render(context)\n+        row_html = '<tbody><tr class=\"row1\"><td><input type=\"checkbox\" class=\"action-select\" value=\"1\" name=\"_selected_action\" /></td><th><a href=\"1/\">name</a></th><td>(None)</td></tr></tbody>'\n+        self.assertFalse(table_output.find(row_html) == -1,\n+            'Failed to find expected row element: %s' % table_output)\n+\n+\n     def test_result_list_html(self):\n         \"\"\"\n         Verifies that inclusion tag result_list generates a table when with"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 27,
        "deletions": 3
    }
}