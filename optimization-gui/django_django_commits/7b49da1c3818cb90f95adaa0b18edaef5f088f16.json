{
    "author": "aaugustin",
    "message": "Changed testing strategy used in 6b03179e.\n\nAvoid polluting the app cache as it causes unrelated test failures.\n\nRefs #19688.",
    "sha": "7b49da1c3818cb90f95adaa0b18edaef5f088f16",
    "files": [
        {
            "sha": "bddb406820708ab793f62e3e771985ccc8132f59",
            "filename": "tests/modeltests/base/models.py",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/7b49da1c3818cb90f95adaa0b18edaef5f088f16/tests%2Fmodeltests%2Fbase%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/7b49da1c3818cb90f95adaa0b18edaef5f088f16/tests%2Fmodeltests%2Fbase%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbase%2Fmodels.py?ref=7b49da1c3818cb90f95adaa0b18edaef5f088f16",
            "patch": "@@ -1,5 +1,23 @@\n-from django.db.models.base import ModelBase\n+from __future__ import unicode_literals\n \n+from django.db import models\n+from django.utils import six\n \n-class CustomBaseModel(ModelBase):\n+\n+# The models definitions below used to crash. Generating models dynamically\n+# at runtime is a bad idea because it pollutes the app cache. This doesn't\n+# integrate well with the test suite but at least it prevents regressions.\n+\n+\n+class CustomBaseModel(models.base.ModelBase):\n     pass\n+\n+\n+class MyModel(six.with_metaclass(CustomBaseModel, models.Model)):\n+        \"\"\"Model subclass with a custom base using six.with_metaclass.\"\"\"\n+\n+\n+if not six.PY3:\n+    class MyModel(models.Model):\n+        \"\"\"Model subclass with a custom base using __metaclass__.\"\"\"\n+        __metaclass__ = CustomBaseModel"
        },
        {
            "sha": "6229b7a305d653070e068378c3bfb82e2ebe6e57",
            "filename": "tests/modeltests/base/tests.py",
            "status": "removed",
            "additions": 0,
            "deletions": 36,
            "changes": 36,
            "blob_url": "https://github.com/django/django/blob/5eebb49c690097ec950b4db2a8eaa892c27433c0/tests%2Fmodeltests%2Fbase%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/5eebb49c690097ec950b4db2a8eaa892c27433c0/tests%2Fmodeltests%2Fbase%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fbase%2Ftests.py?ref=5eebb49c690097ec950b4db2a8eaa892c27433c0",
            "patch": "@@ -1,36 +0,0 @@\n-from __future__ import unicode_literals\n-\n-from django.db import models\n-from django.test.testcases import SimpleTestCase\n-from django.utils import six\n-from django.utils.unittest import skipIf\n-\n-from .models import CustomBaseModel\n-\n-\n-class CustomBaseTest(SimpleTestCase):\n-\n-    @skipIf(six.PY3, 'test metaclass definition under Python 2')\n-    def test_py2_custom_base(self):\n-        \"\"\"\n-        Make sure models.Model can be subclassed with a valid custom base\n-        using __metaclass__\n-        \"\"\"\n-        try:\n-            class MyModel(models.Model):\n-                __metaclass__ = CustomBaseModel\n-        except Exception:\n-            self.fail(\"models.Model couldn't be subclassed with a valid \"\n-                      \"custom base using __metaclass__.\")\n-\n-    def test_six_custom_base(self):\n-        \"\"\"\n-        Make sure models.Model can be subclassed with a valid custom base\n-        using `six.with_metaclass`.\n-        \"\"\"\n-        try:\n-            class MyModel(six.with_metaclass(CustomBaseModel, models.Model)):\n-                pass\n-        except Exception:\n-            self.fail(\"models.Model couldn't be subclassed with a valid \"\n-                      \"custom base using `six.with_metaclass`.\")"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 20,
        "deletions": 38
    }
}