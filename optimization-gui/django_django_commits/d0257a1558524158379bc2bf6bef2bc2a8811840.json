{
    "author": "jezdez",
    "message": "Fixed #14041 -- Added ability to override the template of the sitemaps views. Thanks, julien.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14883 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "d0257a1558524158379bc2bf6bef2bc2a8811840",
    "files": [
        {
            "sha": "3874ac740f875c6906a556bc5ed2007790f7b5fd",
            "filename": "django/contrib/sitemaps/tests/basic.py",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbasic.py",
            "raw_url": "https://github.com/django/django/raw/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbasic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Fbasic.py?ref=d0257a1558524158379bc2bf6bef2bc2a8811840",
            "patch": "@@ -1,3 +1,4 @@\n+import os\n from datetime import date\n from django.conf import settings\n from django.contrib.auth.models import User\n@@ -16,12 +17,40 @@ class SitemapTests(TestCase):\n     def setUp(self):\n         self.old_USE_L10N = settings.USE_L10N\n         self.old_Site_meta_installed = Site._meta.installed\n+        self.old_TEMPLATE_DIRS = settings.TEMPLATE_DIRS\n+        settings.TEMPLATE_DIRS = (\n+            os.path.join(os.path.dirname(__file__), 'templates'),\n+        )\n         # Create a user that will double as sitemap content\n         User.objects.create_user('testuser', 'test@example.com', 's3krit')\n \n     def tearDown(self):\n         settings.USE_L10N = self.old_USE_L10N\n         Site._meta.installed = self.old_Site_meta_installed\n+        settings.TEMPLATE_DIRS = self.old_TEMPLATE_DIRS\n+\n+    def test_simple_sitemap_index(self):\n+        \"A simple sitemap index can be rendered\"\n+        # Retrieve the sitemap.\n+        response = self.client.get('/simple/index.xml')\n+        # Check for all the important bits:\n+        self.assertEquals(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+<sitemap><loc>http://example.com/simple/sitemap-simple.xml</loc></sitemap>\n+</sitemapindex>\n+\"\"\")\n+\n+    def test_simple_sitemap_custom_index(self):\n+        \"A simple sitemap index can be rendered with a custom template\"\n+        # Retrieve the sitemap.\n+        response = self.client.get('/simple/custom-index.xml')\n+        # Check for all the important bits:\n+        self.assertEquals(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- This is a customised template -->\n+<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+<sitemap><loc>http://example.com/simple/sitemap-simple.xml</loc></sitemap>\n+</sitemapindex>\n+\"\"\")\n \n     def test_simple_sitemap(self):\n         \"A simple sitemap can be rendered\"\n@@ -32,6 +61,18 @@ def test_simple_sitemap(self):\n <urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n <url><loc>http://example.com/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n </urlset>\n+\"\"\" % date.today().strftime('%Y-%m-%d'))\n+\n+    def test_simple_custom_sitemap(self):\n+        \"A simple sitemap can be rendered with a custom template\"\n+        # Retrieve the sitemap.\n+        response = self.client.get('/simple/custom-sitemap.xml')\n+        # Check for all the important bits:\n+        self.assertEquals(response.content, \"\"\"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- This is a customised template -->\n+<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+<url><loc>http://example.com/location/</loc><lastmod>%s</lastmod><changefreq>never</changefreq><priority>0.5</priority></url>\n+</urlset>\n \"\"\" % date.today().strftime('%Y-%m-%d'))\n \n     @skipUnless(settings.USE_I18N, \"Internationalization is not enabled\")"
        },
        {
            "sha": "594aef1a3e1c488653595705cfc1e7bbe0f1bc50",
            "filename": "django/contrib/sitemaps/tests/templates/custom_sitemap.xml",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Ftemplates%2Fcustom_sitemap.xml",
            "raw_url": "https://github.com/django/django/raw/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Ftemplates%2Fcustom_sitemap.xml",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Ftemplates%2Fcustom_sitemap.xml?ref=d0257a1558524158379bc2bf6bef2bc2a8811840",
            "patch": "@@ -0,0 +1,14 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- This is a customised template -->\n+<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+{% spaceless %}\n+{% for url in urlset %}\n+  <url>\n+    <loc>{{ url.location }}</loc>\n+    {% if url.lastmod %}<lastmod>{{ url.lastmod|date:\"Y-m-d\" }}</lastmod>{% endif %}\n+    {% if url.changefreq %}<changefreq>{{ url.changefreq }}</changefreq>{% endif %}\n+    {% if url.priority %}<priority>{{ url.priority }}</priority>{% endif %}\n+  </url>\n+{% endfor %}\n+{% endspaceless %}\n+</urlset>"
        },
        {
            "sha": "406c6b760606a3e4a2ae69fdff63893e39f67e32",
            "filename": "django/contrib/sitemaps/tests/templates/custom_sitemap_index.xml",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Ftemplates%2Fcustom_sitemap_index.xml",
            "raw_url": "https://github.com/django/django/raw/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Ftemplates%2Fcustom_sitemap_index.xml",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Ftemplates%2Fcustom_sitemap_index.xml?ref=d0257a1558524158379bc2bf6bef2bc2a8811840",
            "patch": "@@ -0,0 +1,5 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!-- This is a customised template -->\n+<sitemapindex xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\n+{% for location in sitemaps %}<sitemap><loc>{{ location }}</loc></sitemap>{% endfor %}\n+</sitemapindex>"
        },
        {
            "sha": "03b060df7ae861c7ff9839f76e62b2e711f19c46",
            "filename": "django/contrib/sitemaps/tests/urls.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Ftests%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Ftests%2Furls.py?ref=d0257a1558524158379bc2bf6bef2bc2a8811840",
            "patch": "@@ -27,7 +27,11 @@ def items(self):\n }\n \n urlpatterns = patterns('django.contrib.sitemaps.views',\n+    (r'^simple/index\\.xml$', 'index', {'sitemaps': simple_sitemaps}),\n+    (r'^simple/custom-index\\.xml$', 'index', {'sitemaps': simple_sitemaps, 'template_name': 'custom_sitemap_index.xml'}),\n+    (r'^simple/sitemap-(?P<section>.+)\\.xml$', 'sitemap', {'sitemaps': simple_sitemaps}),\n     (r'^simple/sitemap\\.xml$', 'sitemap', {'sitemaps': simple_sitemaps}),\n+    (r'^simple/custom-sitemap\\.xml$', 'sitemap', {'sitemaps': simple_sitemaps, 'template_name': 'custom_sitemap.xml'}),\n     (r'^generic/sitemap\\.xml$', 'sitemap', {'sitemaps': generic_sitemaps}),\n     (r'^flatpages/sitemap\\.xml$', 'sitemap', {'sitemaps': flatpage_sitemaps}),\n )"
        },
        {
            "sha": "83094402c6a6df8ed4674403257af1654bbc9942",
            "filename": "django/contrib/sitemaps/views.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/d0257a1558524158379bc2bf6bef2bc2a8811840/django%2Fcontrib%2Fsitemaps%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Fviews.py?ref=d0257a1558524158379bc2bf6bef2bc2a8811840",
            "patch": "@@ -5,7 +5,7 @@\n from django.utils.encoding import smart_str\n from django.core.paginator import EmptyPage, PageNotAnInteger\n \n-def index(request, sitemaps):\n+def index(request, sitemaps, template_name='sitemap_index.xml'):\n     current_site = get_current_site(request)\n     sites = []\n     protocol = request.is_secure() and 'https' or 'http'\n@@ -20,10 +20,10 @@ def index(request, sitemaps):\n         if pages > 1:\n             for page in range(2, pages+1):\n                 sites.append('%s://%s%s?p=%s' % (protocol, current_site.domain, sitemap_url, page))\n-    xml = loader.render_to_string('sitemap_index.xml', {'sitemaps': sites})\n+    xml = loader.render_to_string(template_name, {'sitemaps': sites})\n     return HttpResponse(xml, mimetype='application/xml')\n \n-def sitemap(request, sitemaps, section=None):\n+def sitemap(request, sitemaps, section=None, template_name='sitemap.xml'):\n     maps, urls = [], []\n     if section is not None:\n         if section not in sitemaps:\n@@ -43,5 +43,5 @@ def sitemap(request, sitemaps, section=None):\n             raise Http404(\"Page %s empty\" % page)\n         except PageNotAnInteger:\n             raise Http404(\"No page '%s'\" % page)\n-    xml = smart_str(loader.render_to_string('sitemap.xml', {'urlset': urls}))\n+    xml = smart_str(loader.render_to_string(template_name, {'urlset': urls}))\n     return HttpResponse(xml, mimetype='application/xml')"
        },
        {
            "sha": "a9b1d08f66cdf4e8df4b0e54c438a1f315f5aa4d",
            "filename": "docs/ref/contrib/sitemaps.txt",
            "status": "modified",
            "additions": 24,
            "deletions": 2,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/d0257a1558524158379bc2bf6bef2bc2a8811840/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "raw_url": "https://github.com/django/django/raw/d0257a1558524158379bc2bf6bef2bc2a8811840/docs%2Fref%2Fcontrib%2Fsitemaps.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fsitemaps.txt?ref=d0257a1558524158379bc2bf6bef2bc2a8811840",
            "patch": "@@ -279,8 +279,10 @@ references individual sitemap files, one per each section defined in your\n \n Here's what the relevant URLconf lines would look like for the example above::\n \n-   (r'^sitemap\\.xml$', 'django.contrib.sitemaps.views.index', {'sitemaps': sitemaps}),\n-   (r'^sitemap-(?P<section>.+)\\.xml$', 'django.contrib.sitemaps.views.sitemap', {'sitemaps': sitemaps}),\n+    urlpatterns = patterns('django.contrib.sitemaps.views',\n+        (r'^sitemap\\.xml$', 'index', {'sitemaps': sitemaps}),\n+        (r'^sitemap-(?P<section>.+)\\.xml$', 'sitemap', {'sitemaps': sitemaps}),\n+    )\n \n This will automatically generate a :file:`sitemap.xml` file that references both\n :file:`sitemap-flatpages.xml` and :file:`sitemap-blog.xml`. The\n@@ -291,6 +293,26 @@ You should create an index file if one of your sitemaps has more than 50,000\n URLs. In this case, Django will automatically paginate the sitemap, and the\n index will reflect that.\n \n+.. versionadded:: 1.3\n+\n+Template customization\n+======================\n+\n+If you wish to use a different template for each sitemap or sitemap index available on your site,\n+you may specify it by passing a `template_name` parameter to the `sitemap` and `index` views via\n+the URLconf::\n+\n+    urlpatterns = patterns('django.contrib.sitemaps.views',\n+        (r'^custom-sitemap\\.xml$', 'index', {\n+            'sitemaps': sitemaps,\n+            'template_name': 'custom_sitemap.html'\n+        }),\n+        (r'^custom-sitemap-(?P<section>.+)\\.xml$', 'sitemap', {\n+            'sitemaps': sitemaps,\n+            'template_name': 'custom_sitemap.html'\n+        }),\n+    )\n+\n Pinging Google\n ==============\n "
        }
    ],
    "stats": {
        "total": 98,
        "additions": 92,
        "deletions": 6
    }
}