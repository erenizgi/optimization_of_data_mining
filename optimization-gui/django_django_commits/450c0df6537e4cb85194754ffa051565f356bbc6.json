{
    "author": "chrislawlor",
    "message": "[py3] Fixed modeltests.model_forms tests.",
    "sha": "450c0df6537e4cb85194754ffa051565f356bbc6",
    "files": [
        {
            "sha": "90b019b611bc5b7d39815813c89dd7d51f0884c5",
            "filename": "tests/modeltests/model_forms/models.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/450c0df6537e4cb85194754ffa051565f356bbc6/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/450c0df6537e4cb85194754ffa051565f356bbc6/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Fmodels.py?ref=450c0df6537e4cb85194754ffa051565f356bbc6",
            "patch": "@@ -41,6 +41,9 @@ class Category(models.Model):\n     def __str__(self):\n         return self.name\n \n+    def __repr__(self):\n+        return self.__str__()\n+\n @python_2_unicode_compatible\n class Writer(models.Model):\n     name = models.CharField(max_length=50, help_text='Use both first and last names.')\n@@ -195,6 +198,9 @@ class Meta:\n     def __str__(self):\n         return self.name\n \n+    def __repr__(self):\n+        return self.__str__()\n+\n class Book(models.Model):\n     title = models.CharField(max_length=40)\n     author = models.ForeignKey(Writer, blank=True, null=True)"
        },
        {
            "sha": "038ce322871a40c1b2f67ac4e1940e83f7a52a30",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 35,
            "deletions": 34,
            "changes": 69,
            "blob_url": "https://github.com/django/django/blob/450c0df6537e4cb85194754ffa051565f356bbc6/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/450c0df6537e4cb85194754ffa051565f356bbc6/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=450c0df6537e4cb85194754ffa051565f356bbc6",
            "patch": "@@ -179,14 +179,14 @@ class Meta:\n \n class ModelFormBaseTest(TestCase):\n     def test_base_form(self):\n-        self.assertEqual(BaseCategoryForm.base_fields.keys(),\n+        self.assertEqual(list(BaseCategoryForm.base_fields),\n                          ['name', 'slug', 'url'])\n \n     def test_extra_fields(self):\n         class ExtraFields(BaseCategoryForm):\n             some_extra_field = forms.BooleanField()\n \n-        self.assertEqual(ExtraFields.base_fields.keys(),\n+        self.assertEqual(list(ExtraFields.base_fields),\n                          ['name', 'slug', 'url', 'some_extra_field'])\n \n     def test_replace_field(self):\n@@ -215,7 +215,7 @@ class Meta:\n                 model = Category\n                 fields = ['url']\n \n-        self.assertEqual(LimitFields.base_fields.keys(),\n+        self.assertEqual(list(LimitFields.base_fields),\n                          ['url'])\n \n     def test_exclude_fields(self):\n@@ -224,7 +224,7 @@ class Meta:\n                 model = Category\n                 exclude = ['url']\n \n-        self.assertEqual(ExcludeFields.base_fields.keys(),\n+        self.assertEqual(list(ExcludeFields.base_fields),\n                          ['name', 'slug'])\n \n     def test_confused_form(self):\n@@ -237,7 +237,7 @@ class Meta:\n                 fields = ['name', 'url']\n                 exclude = ['url']\n \n-        self.assertEqual(ConfusedForm.base_fields.keys(),\n+        self.assertEqual(list(ConfusedForm.base_fields),\n                          ['name'])\n \n     def test_mixmodel_form(self):\n@@ -254,13 +254,13 @@ class Meta:\n             # overrides BaseCategoryForm.Meta.\n \n         self.assertEqual(\n-            MixModelForm.base_fields.keys(),\n+            list(MixModelForm.base_fields),\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n     def test_article_form(self):\n         self.assertEqual(\n-            ArticleForm.base_fields.keys(),\n+            list(ArticleForm.base_fields),\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n@@ -270,7 +270,7 @@ class BadForm(ArticleForm, BaseCategoryForm):\n             pass\n \n         self.assertEqual(\n-            BadForm.base_fields.keys(),\n+            list(BadForm.base_fields),\n             ['headline', 'slug', 'pub_date', 'writer', 'article', 'categories', 'status']\n         )\n \n@@ -282,7 +282,7 @@ class SubCategoryForm(BaseCategoryForm):\n             \"\"\"\n             pass\n \n-        self.assertEqual(SubCategoryForm.base_fields.keys(),\n+        self.assertEqual(list(SubCategoryForm.base_fields),\n                          ['name', 'slug', 'url'])\n \n     def test_subclassmeta_form(self):\n@@ -312,7 +312,7 @@ class Meta:\n                 model = Category\n                 fields = ['url', 'name']\n \n-        self.assertEqual(OrderFields.base_fields.keys(),\n+        self.assertEqual(list(OrderFields.base_fields),\n                          ['url', 'name'])\n         self.assertHTMLEqual(\n             str(OrderFields()),\n@@ -327,7 +327,7 @@ class Meta:\n                 fields = ['slug', 'url', 'name']\n                 exclude = ['url']\n \n-        self.assertEqual(OrderFields2.base_fields.keys(),\n+        self.assertEqual(list(OrderFields2.base_fields),\n                          ['slug', 'name'])\n \n \n@@ -751,9 +751,9 @@ def test_with_data(self):\n         self.assertEqual(new_art.headline, 'New headline')\n \n         # Add some categories and test the many-to-many form output.\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n         new_art.categories.add(Category.objects.get(name='Entertainment'))\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [\"Entertainment\"])\n+        self.assertQuerysetEqual(new_art.categories.all(), [\"Entertainment\"])\n         f = TestArticleForm(auto_id=False, instance=new_art)\n         self.assertHTMLEqual(f.as_ul(), '''<li>Headline: <input type=\"text\" name=\"headline\" value=\"New headline\" maxlength=\"50\" /></li>\n <li>Slug: <input type=\"text\" name=\"slug\" value=\"new-headline\" maxlength=\"50\" /></li>\n@@ -815,7 +815,7 @@ def test_with_data(self):\n         new_art = f.save()\n         self.assertEqual(new_art.id == art_id_1, True)\n         new_art = Article.objects.get(id=art_id_1)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')),\n+        self.assertQuerysetEqual(new_art.categories.order_by('name'),\n                          [\"Entertainment\", \"It's a test\"])\n \n         # Now, submit form data with no categories. This deletes the existing categories.\n@@ -824,7 +824,7 @@ def test_with_data(self):\n         new_art = f.save()\n         self.assertEqual(new_art.id == art_id_1, True)\n         new_art = Article.objects.get(id=art_id_1)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n \n         # Create a new article, with categories, via the form.\n         f = ArticleForm({'headline': 'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': '1967-11-01',\n@@ -833,7 +833,7 @@ def test_with_data(self):\n         art_id_2 = new_art.id\n         self.assertEqual(art_id_2 not in (None, art_id_1), True)\n         new_art = Article.objects.get(id=art_id_2)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(new_art.categories.order_by('name'), [\"Entertainment\", \"It's a test\"])\n \n         # Create a new article, with no categories, via the form.\n         f = ArticleForm({'headline': 'The walrus was Paul', 'slug': 'walrus-was-paul', 'pub_date': '1967-11-01',\n@@ -842,7 +842,7 @@ def test_with_data(self):\n         art_id_3 = new_art.id\n         self.assertEqual(art_id_3 not in (None, art_id_1, art_id_2), True)\n         new_art = Article.objects.get(id=art_id_3)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n \n         # Create a new article, with categories, via the form, but use commit=False.\n         # The m2m data won't be saved until save_m2m() is invoked on the form.\n@@ -857,11 +857,11 @@ def test_with_data(self):\n \n         # The instance doesn't have m2m data yet\n         new_art = Article.objects.get(id=art_id_4)\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.all()), [])\n+        self.assertQuerysetEqual(new_art.categories.all(), [])\n \n         # Save the m2m data on the form\n         f.save_m2m()\n-        self.assertEqual(map(lambda o: o.name, new_art.categories.order_by('name')), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(new_art.categories.order_by('name'), [\"Entertainment\", \"It's a test\"])\n \n         # Here, we define a custom ModelForm. Because it happens to have the same fields as\n         # the Category model, we can just call the form's save() to apply its changes to an\n@@ -1007,12 +1007,12 @@ def test_with_data(self):\n             f.clean(None)\n         with self.assertRaises(ValidationError):\n             f.clean([])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c1.id])), [\"Entertainment\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c2.id])), [\"It's a test\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([str(c1.id)])), [\"Entertainment\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([str(c1.id), str(c2.id)])), [\"Entertainment\", \"It's a test\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c1.id, str(c2.id)])), [\"Entertainment\", \"It's a test\"])\n-        self.assertEqual(map(lambda o: o.name, f.clean((c1.id, str(c2.id)))), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([c1.id]), [\"Entertainment\"])\n+        self.assertQuerysetEqual(f.clean([c2.id]), [\"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([str(c1.id)]), [\"Entertainment\"])\n+        self.assertQuerysetEqual(f.clean([str(c1.id), str(c2.id)]), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean([c1.id, str(c2.id)]), [\"Entertainment\", \"It's a test\"])\n+        self.assertQuerysetEqual(f.clean((c1.id, str(c2.id))), [\"Entertainment\", \"It's a test\"])\n         with self.assertRaises(ValidationError):\n             f.clean(['100'])\n         with self.assertRaises(ValidationError):\n@@ -1025,7 +1025,7 @@ def test_with_data(self):\n         # than caching it at time of instantiation.\n         c6 = Category.objects.create(id=6, name='Sixth', url='6th')\n         self.assertEqual(c6.name, 'Sixth')\n-        self.assertEqual(map(lambda o: o.name, f.clean([c6.id])), [\"Sixth\"])\n+        self.assertQuerysetEqual(f.clean([c6.id]), [\"Sixth\"])\n \n         # Delete a Category object *after* the ModelMultipleChoiceField has already been\n         # instantiated. This proves clean() checks the database during clean() rather\n@@ -1050,7 +1050,7 @@ def test_with_data(self):\n             (c1.pk, 'Entertainment'),\n             (c2.pk, \"It's a test\"),\n             (c3.pk, 'Third')])\n-        self.assertEqual(map(lambda o: o.name, f.clean([c3.id])), [\"Third\"])\n+        self.assertQuerysetEqual(f.clean([c3.id]), [\"Third\"])\n         with self.assertRaises(ValidationError):\n             f.clean([c4.id])\n         with self.assertRaises(ValidationError):\n@@ -1066,13 +1066,13 @@ def test_with_data(self):\n \n         # OneToOneField ###############################################################\n \n-        self.assertEqual(ImprovedArticleForm.base_fields.keys(), ['article'])\n+        self.assertEqual(list(ImprovedArticleForm.base_fields), ['article'])\n \n-        self.assertEqual(ImprovedArticleWithParentLinkForm.base_fields.keys(), [])\n+        self.assertEqual(list(ImprovedArticleWithParentLinkForm.base_fields), [])\n \n         bw = BetterWriter(name='Joe Better', score=10)\n         bw.save()\n-        self.assertEqual(sorted(model_to_dict(bw).keys()),\n+        self.assertEqual(sorted(model_to_dict(bw)),\n                          ['id', 'name', 'score', 'writer_ptr'])\n \n         form = BetterWriterForm({'name': 'Some Name', 'score': 12})\n@@ -1463,7 +1463,7 @@ class Meta:\n                 model = Category\n                 fields = ['description', 'url']\n \n-        self.assertEqual(CategoryForm.base_fields.keys(),\n+        self.assertEqual(list(CategoryForm.base_fields),\n                          ['description', 'url'])\n \n         self.assertHTMLEqual(six.text_type(CategoryForm()), '''<tr><th><label for=\"id_description\">Description:</label></th><td><input type=\"text\" name=\"description\" id=\"id_description\" /></td></tr>\n@@ -1472,14 +1472,15 @@ class Meta:\n \n         field = forms.ModelMultipleChoiceField(Inventory.objects.all(), to_field_name='barcode')\n         self.assertEqual(tuple(field.choices), ((86, 'Apple'), (87, 'Core'), (22, 'Pear')))\n-        self.assertEqual(map(lambda o: o.name, field.clean([86])), ['Apple'])\n+        self.assertQuerysetEqual(field.clean([86]), ['Apple'])\n \n         form = SelectInventoryForm({'items': [87, 22]})\n         self.assertEqual(form.is_valid(), True)\n         self.assertEqual(len(form.cleaned_data), 1)\n-        self.assertEqual(map(lambda o: o.name, form.cleaned_data['items']), ['Core', 'Pear'])\n+        self.assertQuerysetEqual(form.cleaned_data['items'], ['Core', 'Pear'])\n \n     def test_model_field_that_returns_none_to_exclude_itself_with_explicit_fields(self):\n-        self.assertEqual(CustomFieldForExclusionForm.base_fields.keys(), ['name'])\n+        self.assertEqual(list(CustomFieldForExclusionForm.base_fields),\n+                         ['name'])\n         self.assertHTMLEqual(six.text_type(CustomFieldForExclusionForm()),\n                          '''<tr><th><label for=\"id_name\">Name:</label></th><td><input id=\"id_name\" type=\"text\" name=\"name\" maxlength=\"10\" /></td></tr>''')"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 41,
        "deletions": 34
    }
}