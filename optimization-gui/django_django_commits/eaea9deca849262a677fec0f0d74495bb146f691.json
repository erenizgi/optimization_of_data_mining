{
    "author": "jbronn",
    "message": "Fixed #16790 -- Modified the geographic admin to work after r16594.  Thanks, jdiego, for the bug report and patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16775 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "eaea9deca849262a677fec0f0d74495bb146f691",
    "files": [
        {
            "sha": "4eced802f51fb3cc1c31a263af3ca919e3cd405b",
            "filename": "django/contrib/gis/admin/options.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fadmin%2Foptions.py?ref=eaea9deca849262a677fec0f0d74495bb146f691",
            "patch": "@@ -39,13 +39,13 @@ class GeoModelAdmin(ModelAdmin):\n     debug = False\n     widget = OpenLayersWidget\n \n-    def _media(self):\n+    @property\n+    def media(self):\n         \"Injects OpenLayers JavaScript into the admin.\"\n-        media = super(GeoModelAdmin, self)._media()\n+        media = super(GeoModelAdmin, self).media\n         media.add_js([self.openlayers_url])\n         media.add_js(self.extra_js)\n         return media\n-    media = property(_media)\n \n     def formfield_for_dbfield(self, db_field, **kwargs):\n         \"\"\""
        },
        {
            "sha": "f27ce7a40b23319c72238ff85f3483457b011ee4",
            "filename": "django/contrib/gis/tests/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2F__init__.py?ref=eaea9deca849262a677fec0f0d74495bb146f691",
            "patch": "@@ -29,6 +29,9 @@ def geo_apps(namespace=True, runtests=False):\n \n     # The following GeoDjango test apps depend on GDAL support.\n     if HAS_GDAL:\n+        # Geographic admin requires GDAL\n+        apps.append('geoadmin')\n+\n         # 3D apps use LayerMapping, which uses GDAL.\n         if connection.ops.postgis and GEOS_PREPARE:\n             apps.append('geo3d')"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "django/contrib/gis/tests/geoadmin/__init__.py",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2F__init__.py?ref=eaea9deca849262a677fec0f0d74495bb146f691"
        },
        {
            "sha": "51a76d1a0e5dd8f294d0b9bde69cb1a6f749f0d0",
            "filename": "django/contrib/gis/tests/geoadmin/models.py",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Fmodels.py?ref=eaea9deca849262a677fec0f0d74495bb146f691",
            "patch": "@@ -0,0 +1,10 @@\n+from django.contrib.gis.db import models\n+from django.contrib.gis import admin\n+\n+class City(models.Model):\n+    name = models.CharField(max_length=30)\n+    point = models.PointField()\n+    objects = models.GeoManager()\n+    def __unicode__(self): return self.name\n+\n+admin.site.register(City, admin.OSMGeoAdmin)"
        },
        {
            "sha": "419e30cd02e4ac063adc6f0dc27cbaac7cfbd387",
            "filename": "django/contrib/gis/tests/geoadmin/tests.py",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Ftests.py?ref=eaea9deca849262a677fec0f0d74495bb146f691",
            "patch": "@@ -0,0 +1,14 @@\n+from django.test import TestCase\n+from django.contrib.gis import admin\n+from models import City\n+\n+class GeoAdminTest(TestCase):\n+    urls = 'django.contrib.gis.tests.geoadmin.urls'\n+\n+    def test01_ensure_geographic_media(self):\n+        geoadmin = admin.site._registry[City]\n+        admin_js = geoadmin.media.render_js()\n+        osm_url = geoadmin.extra_js[0]\n+        self.assertTrue(any([geoadmin.openlayers_url in js for js in admin_js]))\n+        self.assertTrue(any([osm_url in js for js in admin_js]))\n+        "
        },
        {
            "sha": "c3e8af8fe1301aab5053fda91351cfe506411550",
            "filename": "django/contrib/gis/tests/geoadmin/urls.py",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Furls.py",
            "raw_url": "https://github.com/django/django/raw/eaea9deca849262a677fec0f0d74495bb146f691/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Furls.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoadmin%2Furls.py?ref=eaea9deca849262a677fec0f0d74495bb146f691",
            "patch": "@@ -0,0 +1,6 @@\n+from django.conf.urls.defaults import *\n+from django.contrib import admin\n+\n+urlpatterns = patterns('',\n+    (r'^admin/', include(admin.site.urls)),\n+)"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 36,
        "deletions": 3
    }
}