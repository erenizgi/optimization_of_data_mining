{
    "author": "aaugustin",
    "message": "Fixed #17251 -- In the select_for_update tests, close manually database connections made in threads, so they don't stay \"idle in transaction\" until the GC deletes them. Thanks Anssi Kääriäinen for the report and patch.\n\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17195 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "545c3159f57ca110f1b60f1f82b672a3a1b95b2c",
    "files": [
        {
            "sha": "65bc13a1f99f2a857458676e7f8620b727175b59",
            "filename": "tests/modeltests/select_for_update/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/545c3159f57ca110f1b60f1f82b672a3a1b95b2c/tests%2Fmodeltests%2Fselect_for_update%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/545c3159f57ca110f1b60f1f82b672a3a1b95b2c/tests%2Fmodeltests%2Fselect_for_update%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fselect_for_update%2Ftests.py?ref=545c3159f57ca110f1b60f1f82b672a3a1b95b2c",
            "patch": "@@ -155,7 +155,7 @@ def run_select_for_update(self, status, nowait=False):\n         Person instances. After the select_for_update, it attempts\n         to update the name of the only record, save, and commit.\n \n-        In general, this will be run in a separate thread.\n+        This function expects to run in a separate thread.\n         \"\"\"\n         status.append('started')\n         try:\n@@ -173,6 +173,10 @@ def run_select_for_update(self, status, nowait=False):\n             status.append(e)\n         except Exception, e:\n             raise\n+        finally:\n+            # This method is run in a separate thread. It uses its own\n+            # database connection. Close it without waiting for the GC.\n+            connection.close()\n \n     @requires_threading\n     @skipUnlessDBFeature('has_select_for_update')\n@@ -244,6 +248,11 @@ def raw(status):\n                 )\n             except DatabaseError, e:\n                 status.append(e)\n+            finally:\n+                # This method is run in a separate thread. It uses its own\n+                # database connection. Close it without waiting for the GC.\n+                connection.close()\n+\n         status = []\n         thread = threading.Thread(target=raw, kwargs={'status': status})\n         thread.start()"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 10,
        "deletions": 1
    }
}