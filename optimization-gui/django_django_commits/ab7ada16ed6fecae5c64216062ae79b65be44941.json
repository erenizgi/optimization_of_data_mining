{
    "author": "jbronn",
    "message": "Fixed brittle tests that broke with release of GDAL 1.8.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15806 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "ab7ada16ed6fecae5c64216062ae79b65be44941",
    "files": [
        {
            "sha": "7d4a1ffcee4bbc0142ccfd98dbb3bbd6f72a7d72",
            "filename": "django/contrib/gis/gdal/tests/test_geom.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/ab7ada16ed6fecae5c64216062ae79b65be44941/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py",
            "raw_url": "https://github.com/django/django/raw/ab7ada16ed6fecae5c64216062ae79b65be44941/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_geom.py?ref=ab7ada16ed6fecae5c64216062ae79b65be44941",
            "patch": "@@ -1,6 +1,6 @@\n from django.contrib.gis.gdal import OGRGeometry, OGRGeomType, \\\n     OGRException, OGRIndexError, SpatialReference, CoordTransform, \\\n-    gdal_version\n+    GDAL_VERSION\n from django.utils import unittest\n from django.contrib.gis.geometry.test_data import TestDataMixin\n \n@@ -74,7 +74,12 @@ def test01b_gml(self):\n         \"Testing GML output.\"\n         for g in self.geometries.wkt_out:\n             geom = OGRGeometry(g.wkt)\n-            self.assertEqual(g.gml, geom.gml)\n+            exp_gml = g.gml\n+            if GDAL_VERSION >= (1, 8):\n+                # In GDAL 1.8, the non-conformant GML tag  <gml:GeometryCollection> was\n+                # replaced with <gml:MultiGeometry>.\n+                exp_gml = exp_gml.replace('GeometryCollection', 'MultiGeometry')\n+            self.assertEqual(exp_gml, geom.gml)\n \n     def test01c_hex(self):\n         \"Testing HEX input/output.\"\n@@ -237,10 +242,7 @@ def test07b_closepolygons(self):\n \n         # Closing the rings -- doesn't work on GDAL versions 1.4.1 and below:\n         # http://trac.osgeo.org/gdal/ticket/1673\n-        major, minor1, minor2 = gdal_version().split('.')\n-        if major == '1':\n-            iminor1 = int(minor1)\n-            if iminor1 < 4 or (iminor1 == 4 and minor2.startswith('1')): return\n+        if GDAL_VERSION <= (1, 4, 1): return\n         poly.close_rings()\n         self.assertEqual(10, poly.point_count) # Two closing points should've been added\n         self.assertEqual(OGRGeometry('POINT(2.5 2.5)'), poly.centroid)"
        },
        {
            "sha": "3d3bba7939c4527ffc446f9d84d07743c7ae5492",
            "filename": "django/contrib/gis/gdal/tests/test_srs.py",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/ab7ada16ed6fecae5c64216062ae79b65be44941/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_srs.py",
            "raw_url": "https://github.com/django/django/raw/ab7ada16ed6fecae5c64216062ae79b65be44941/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_srs.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Ftests%2Ftest_srs.py?ref=ab7ada16ed6fecae5c64216062ae79b65be44941",
            "patch": "@@ -17,15 +17,13 @@ def __init__(self, wkt, **kwargs):\n                   attr=(('DATUM', 'WGS_1984'), (('SPHEROID', 1), '6378137'),('primem|authority', 'EPSG'),),\n                   ),\n           TestSRS('PROJCS[\"NAD83 / Texas South Central\",GEOGCS[\"NAD83\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS 1980\",6378137,298.257222101,AUTHORITY[\"EPSG\",\"7019\"]],AUTHORITY[\"EPSG\",\"6269\"]],PRIMEM[\"Greenwich\",0,AUTHORITY[\"EPSG\",\"8901\"]],UNIT[\"degree\",0.01745329251994328,AUTHORITY[\"EPSG\",\"9122\"]],AUTHORITY[\"EPSG\",\"4269\"]],PROJECTION[\"Lambert_Conformal_Conic_2SP\"],PARAMETER[\"standard_parallel_1\",30.28333333333333],PARAMETER[\"standard_parallel_2\",28.38333333333333],PARAMETER[\"latitude_of_origin\",27.83333333333333],PARAMETER[\"central_meridian\",-99],PARAMETER[\"false_easting\",600000],PARAMETER[\"false_northing\",4000000],UNIT[\"metre\",1,AUTHORITY[\"EPSG\",\"9001\"]],AUTHORITY[\"EPSG\",\"32140\"]]',\n-                  proj='+proj=lcc +lat_1=30.28333333333333 +lat_2=28.38333333333333 +lat_0=27.83333333333333 +lon_0=-99 +x_0=600000 +y_0=4000000 +ellps=GRS80 +datum=NAD83 +units=m +no_defs ',\n-                  epsg=32140, projected=True, geographic=False, local=False,\n+                  proj=None, epsg=32140, projected=True, geographic=False, local=False,\n                   lin_name='metre', ang_name='degree', lin_units=1.0, ang_units=0.0174532925199,\n                   auth={'PROJCS' : ('EPSG', '32140'), 'spheroid' : ('EPSG', '7019'), 'unit' : ('EPSG', '9001'),},\n                   attr=(('DATUM', 'North_American_Datum_1983'),(('SPHEROID', 2), '298.257222101'),('PROJECTION','Lambert_Conformal_Conic_2SP'),),\n                   ),\n           TestSRS('PROJCS[\"NAD_1983_StatePlane_Texas_South_Central_FIPS_4204_Feet\",GEOGCS[\"GCS_North_American_1983\",DATUM[\"North_American_Datum_1983\",SPHEROID[\"GRS_1980\",6378137.0,298.257222101]],PRIMEM[\"Greenwich\",0.0],UNIT[\"Degree\",0.0174532925199433]],PROJECTION[\"Lambert_Conformal_Conic_2SP\"],PARAMETER[\"False_Easting\",1968500.0],PARAMETER[\"False_Northing\",13123333.33333333],PARAMETER[\"Central_Meridian\",-99.0],PARAMETER[\"Standard_Parallel_1\",28.38333333333333],PARAMETER[\"Standard_Parallel_2\",30.28333333333334],PARAMETER[\"Latitude_Of_Origin\",27.83333333333333],UNIT[\"Foot_US\",0.3048006096012192]]',\n-                  proj='+proj=lcc +lat_1=28.38333333333333 +lat_2=30.28333333333334 +lat_0=27.83333333333333 +lon_0=-99 +x_0=600000 +y_0=3999999.999999999 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs ',\n-                  epsg=None, projected=True, geographic=False, local=False,\n+                  proj=None, epsg=None, projected=True, geographic=False, local=False,\n                   lin_name='Foot_US', ang_name='Degree', lin_units=0.3048006096012192, ang_units=0.0174532925199,\n                   auth={'PROJCS' : (None, None),},\n                   attr=(('PROJCS|GeOgCs|spheroid', 'GRS_1980'),(('projcs', 9), 'UNIT'), (('projcs', 11), None),),\n@@ -74,7 +72,6 @@ def test03_get_wkt(self):\n \n     def test04_proj(self):\n         \"Test PROJ.4 import and export.\"\n-\n         for s in srlist:\n             if s.proj:\n                 srs1 = SpatialReference(s.wkt)\n@@ -89,7 +86,6 @@ def test05_epsg(self):\n                 srs2 = SpatialReference(s.epsg)\n                 srs3 = SpatialReference(str(s.epsg))\n                 srs4 = SpatialReference('EPSG:%d' % s.epsg)\n-                #self.assertEqual(srs1.wkt, srs2.wkt)\n                 for srs in (srs1, srs2, srs3, srs4):\n                     for attr, expected in s.attr:\n                         self.assertEqual(expected, srs[attr])\n@@ -158,7 +154,6 @@ def test13_attr_value(self):\n         self.assertEqual('WGS_1984', s1['DATUM'])\n         self.assertEqual('EPSG', s1['AUTHORITY'])\n         self.assertEqual(4326, int(s1['AUTHORITY', 1]))\n-        #for i in range(7): self.assertEqual(0, int(s1['TOWGS84', i]))\n         self.assertEqual(None, s1['FOOBAR'])\n \n def suite():"
        },
        {
            "sha": "d9c8c38d60b0a35624b3e5c12c7570a1fcfbc4cb",
            "filename": "django/contrib/gis/tests/test_spatialrefsys.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/ab7ada16ed6fecae5c64216062ae79b65be44941/django%2Fcontrib%2Fgis%2Ftests%2Ftest_spatialrefsys.py",
            "raw_url": "https://github.com/django/django/raw/ab7ada16ed6fecae5c64216062ae79b65be44941/django%2Fcontrib%2Fgis%2Ftests%2Ftest_spatialrefsys.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Ftest_spatialrefsys.py?ref=ab7ada16ed6fecae5c64216062ae79b65be44941",
            "patch": "@@ -1,4 +1,5 @@\n from django.db import connection\n+from django.contrib.gis.gdal import GDAL_VERSION\n from django.contrib.gis.tests.utils import mysql, no_mysql, oracle, postgis, spatialite\n from django.utils import unittest\n \n@@ -78,7 +79,8 @@ def test02_osr(self):\n             # Testing the SpatialReference object directly.\n             if postgis or spatialite:\n                 srs = sr.srs\n-                self.assertEqual(sd['proj4'], srs.proj4)\n+                if GDAL_VERSION <= (1, 8):\n+                    self.assertEqual(sd['proj4'], srs.proj4)\n                 # No `srtext` field in the `spatial_ref_sys` table in SpatiaLite\n                 if not spatialite:\n                     if connection.ops.spatial_version >= (1, 4, 0):"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 13,
        "deletions": 14
    }
}