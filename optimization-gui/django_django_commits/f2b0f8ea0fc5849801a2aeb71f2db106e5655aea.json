{
    "author": "ramiro",
    "message": "Fixed #15226 - Made SelectDateWidget render the label tag associated with the correct dropdown sub-widget when USE_L10N is active and non-English locale is in use.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15427 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "f2b0f8ea0fc5849801a2aeb71f2db106e5655aea",
    "files": [
        {
            "sha": "e8bacf2b1ed64d2127d2d0d30fc83f437e620ab6",
            "filename": "django/forms/extras/widgets.py",
            "status": "modified",
            "additions": 32,
            "deletions": 12,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/f2b0f8ea0fc5849801a2aeb71f2db106e5655aea/django%2Fforms%2Fextras%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/f2b0f8ea0fc5849801a2aeb71f2db106e5655aea/django%2Fforms%2Fextras%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fextras%2Fwidgets.py?ref=f2b0f8ea0fc5849801a2aeb71f2db106e5655aea",
            "patch": "@@ -17,6 +17,26 @@\n \n RE_DATE = re.compile(r'(\\d{4})-(\\d\\d?)-(\\d\\d?)$')\n \n+def _parse_date_fmt():\n+    fmt = get_format('DATE_FORMAT')\n+    escaped = False\n+    output = []\n+    for char in fmt:\n+        if escaped:\n+            escaped = False\n+        elif char == '\\\\':\n+            escaped = True\n+        elif char in 'Yy':\n+            output.append('year')\n+            #if not self.first_select: self.first_select = 'year'\n+        elif char in 'bEFMmNn':\n+            output.append('month')\n+            #if not self.first_select: self.first_select = 'month'\n+        elif char in 'dj':\n+            output.append('day')\n+            #if not self.first_select: self.first_select = 'day'\n+    return output\n+\n class SelectDateWidget(Widget):\n     \"\"\"\n     A Widget that splits date input into three <select> boxes.\n@@ -67,24 +87,25 @@ def render(self, name, value, attrs=None):\n         choices = [(i, i) for i in range(1, 32)]\n         day_html = self.create_select(name, self.day_field, value, day_val,  choices)\n \n-        format = get_format('DATE_FORMAT')\n-        escaped = False\n         output = []\n-        for char in format:\n-            if escaped:\n-                escaped = False\n-            elif char == '\\\\':\n-                escaped = True\n-            elif char in 'Yy':\n+        for field in _parse_date_fmt():\n+            if field == 'year':\n                 output.append(year_html)\n-            elif char in 'bEFMmNn':\n+            elif field == 'month':\n                 output.append(month_html)\n-            elif char in 'dj':\n+            elif field == 'day':\n                 output.append(day_html)\n         return mark_safe(u'\\n'.join(output))\n \n     def id_for_label(self, id_):\n-        return '%s_month' % id_\n+        first_select = None\n+        field_list = _parse_date_fmt()\n+        if field_list:\n+            first_select = field_list[0]\n+        if first_select is not None:\n+            return '%s_%s' % (id_, first_select)\n+        else:\n+            return '%s_month' % id_\n     id_for_label = classmethod(id_for_label)\n \n     def value_from_datadict(self, data, files, name):\n@@ -118,4 +139,3 @@ def create_select(self, name, field, value, val, choices):\n         s = Select(choices=choices)\n         select_html = s.render(field % name, val, local_attrs)\n         return select_html\n-"
        },
        {
            "sha": "927362a71f2516551ed9f9dcfb1a18a1d7fb8eae",
            "filename": "tests/regressiontests/forms/tests/extra.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/f2b0f8ea0fc5849801a2aeb71f2db106e5655aea/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/f2b0f8ea0fc5849801a2aeb71f2db106e5655aea/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py?ref=f2b0f8ea0fc5849801a2aeb71f2db106e5655aea",
            "patch": "@@ -356,6 +356,10 @@ def test_selectdate(self):\n         self.assertFalse(c.is_valid())\n         self.assertEqual(c.errors, {'mydate': [u'Enter a valid date.']})\n \n+        # label tag is correctly associated with month dropdown\n+        d = GetDate({'mydate_month':'1', 'mydate_day':'1', 'mydate_year':'2010'})\n+        self.assertTrue('<label for=\"id_mydate_month\">' in d.as_p())\n+\n     def test_multiwidget(self):\n         # MultiWidget and MultiValueField #############################################\n         # MultiWidgets are widgets composed of other widgets. They are usually\n@@ -616,3 +620,8 @@ def test_l10n_invalid_date_in(self):\n         self.assertFalse(a.is_valid())\n         # 'Geef een geldige datum op.' = 'Enter a valid date.'\n         self.assertEqual(a.errors, {'mydate': [u'Geef een geldige datum op.']})\n+\n+    def test_form_label_association(self):\n+        # label tag is correctly associated with first rendered dropdown\n+        a = GetDate({'mydate_month':'1', 'mydate_day':'1', 'mydate_year':'2010'})\n+        self.assertTrue('<label for=\"id_mydate_day\">' in a.as_p())"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 41,
        "deletions": 12
    }
}