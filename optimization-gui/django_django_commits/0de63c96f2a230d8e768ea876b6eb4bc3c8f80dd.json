{
    "author": "jezdez",
    "message": "Fixed #14961 -- Revised staticfiles's prefix handling to make sure it runs on Windows. Also revised staticfiles tests to pass on Windows.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15119 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd",
    "files": [
        {
            "sha": "a43412c49912a1ee4a2ba96ac2428e7c6b54d98f",
            "filename": "django/contrib/staticfiles/finders.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd/django%2Fcontrib%2Fstaticfiles%2Ffinders.py",
            "raw_url": "https://github.com/django/django/raw/0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd/django%2Fcontrib%2Fstaticfiles%2Ffinders.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Ffinders.py?ref=0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd",
            "patch": "@@ -79,7 +79,7 @@ def find_location(self, root, path, prefix=None):\n         absolute path (or ``None`` if no match).\n         \"\"\"\n         if prefix:\n-            prefix = '%s/' % prefix\n+            prefix = '%s%s' % (prefix, os.sep)\n             if not path.startswith(prefix):\n                 return None\n             path = path[len(prefix):]\n@@ -144,7 +144,7 @@ def find_in_app(self, app, path):\n         storage = self.storages[app]\n         prefix = storage.get_prefix()\n         if prefix:\n-            prefix = '%s/' % prefix\n+            prefix = '%s%s' % (prefix, os.sep)\n             if not path.startswith(prefix):\n                 return None\n             path = path[len(prefix):]"
        },
        {
            "sha": "f5a6ec3daedb7fea62401358fc16f91b11a3cff5",
            "filename": "django/contrib/staticfiles/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd/django%2Fcontrib%2Fstaticfiles%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd/django%2Fcontrib%2Fstaticfiles%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fviews.py?ref=0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd",
            "patch": "@@ -47,6 +47,7 @@ def serve(request, path, document_root=None, show_indexes=False, insecure=False)\n                                    \"the --insecure option of 'runserver' is \"\n                                    \"used\")\n     if not document_root:\n+        path = os.path.normpath(path)\n         absolute_path = finders.find(path)\n         if not absolute_path:\n             raise Http404('\"%s\" could not be found' % path)"
        },
        {
            "sha": "35ee74393baeda54d70edde5e763133837e83bdb",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 19,
            "deletions": 23,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=0de63c96f2a230d8e768ea876b6eb4bc3c8f80dd",
            "patch": "@@ -15,7 +15,8 @@\n from django.test import TestCase\n \n \n-TEST_ROOT = os.path.dirname(__file__)\n+TEST_ROOT = os.path.normcase(os.path.dirname(__file__))\n+\n \n class StaticFilesTestCase(TestCase):\n     \"\"\"\n@@ -51,8 +52,8 @@ def setUp(self):\n             'django.contrib.staticfiles.finders.DefaultStorageFinder',\n         )\n         settings.INSTALLED_APPS = [\n-            \"django.contrib.staticfiles\",\n-            \"regressiontests.staticfiles_tests\",\n+            'django.contrib.staticfiles',\n+            'regressiontests.staticfiles_tests',\n         ]\n \n         # Clear the cached default_storage out, this is because when it first\n@@ -121,29 +122,25 @@ class TestDefaults(object):\n     def test_staticfiles_dirs(self):\n         \"\"\"\n         Can find a file in a STATICFILES_DIRS directory.\n-\n         \"\"\"\n         self.assertFileContains('test.txt', 'Can we find')\n \n     def test_staticfiles_dirs_subdir(self):\n         \"\"\"\n         Can find a file in a subdirectory of a STATICFILES_DIRS\n         directory.\n-\n         \"\"\"\n         self.assertFileContains('subdir/test.txt', 'Can we find')\n \n     def test_staticfiles_dirs_priority(self):\n         \"\"\"\n         File in STATICFILES_DIRS has priority over file in app.\n-\n         \"\"\"\n         self.assertFileContains('test/file.txt', 'STATICFILES_DIRS')\n \n     def test_app_files(self):\n         \"\"\"\n         Can find a file in an app media/ directory.\n-\n         \"\"\"\n         self.assertFileContains('test/file1.txt', 'file1 in the app dir')\n \n@@ -249,7 +246,6 @@ def run_collectstatic(self):\n         def test_links_created(self):\n             \"\"\"\n             With ``--link``, symbolic links are created.\n-\n             \"\"\"\n             self.assertTrue(os.path.islink(os.path.join(settings.STATIC_ROOT, 'test.txt')))\n \n@@ -258,7 +254,7 @@ class TestServeStatic(StaticFilesTestCase):\n     \"\"\"\n     Test static asset serving view.\n     \"\"\"\n-    urls = \"regressiontests.staticfiles_tests.urls.default\"\n+    urls = 'regressiontests.staticfiles_tests.urls.default'\n \n     def _response(self, filepath):\n         return self.client.get(\n@@ -280,8 +276,8 @@ def setUp(self):\n         settings.DEBUG = False\n \n     def test_disabled_serving(self):\n-        self.assertRaisesRegexp(ImproperlyConfigured, \"The view to serve \"\n-            \"static files can only be used if the DEBUG setting is True\",\n+        self.assertRaisesRegexp(ImproperlyConfigured, 'The view to serve '\n+            'static files can only be used if the DEBUG setting is True',\n             self._response, 'test.txt')\n \n \n@@ -295,7 +291,7 @@ class TestServeStaticWithURLHelper(TestServeStatic, TestDefaults):\n     \"\"\"\n     Test static asset serving view with staticfiles_urlpatterns helper.\n     \"\"\"\n-    urls = \"regressiontests.staticfiles_tests.urls.helper\"\n+    urls = 'regressiontests.staticfiles_tests.urls.helper'\n \n \n class TestServeAdminMedia(TestServeStatic):\n@@ -330,9 +326,9 @@ class TestFileSystemFinder(StaticFilesTestCase, FinderTestCase):\n     def setUp(self):\n         super(TestFileSystemFinder, self).setUp()\n         self.finder = finders.FileSystemFinder()\n-        test_file_path = os.path.join(TEST_ROOT, 'project/documents/test/file.txt')\n-        self.find_first = (\"test/file.txt\", test_file_path)\n-        self.find_all = (\"test/file.txt\", [test_file_path])\n+        test_file_path = os.path.join(TEST_ROOT, 'project', 'documents', 'test', 'file.txt')\n+        self.find_first = (os.path.join('test', 'file.txt'), test_file_path)\n+        self.find_all = (os.path.join('test', 'file.txt'), [test_file_path])\n \n \n class TestAppDirectoriesFinder(StaticFilesTestCase, FinderTestCase):\n@@ -342,9 +338,9 @@ class TestAppDirectoriesFinder(StaticFilesTestCase, FinderTestCase):\n     def setUp(self):\n         super(TestAppDirectoriesFinder, self).setUp()\n         self.finder = finders.AppDirectoriesFinder()\n-        test_file_path = os.path.join(TEST_ROOT, 'apps/test/static/test/file1.txt')\n-        self.find_first = (\"test/file1.txt\", test_file_path)\n-        self.find_all = (\"test/file1.txt\", [test_file_path])\n+        test_file_path = os.path.join(TEST_ROOT, 'apps', 'test', 'static', 'test', 'file1.txt')\n+        self.find_first = (os.path.join('test', 'file1.txt'), test_file_path)\n+        self.find_all = (os.path.join('test', 'file1.txt'), [test_file_path])\n \n \n class TestDefaultStorageFinder(StaticFilesTestCase, FinderTestCase):\n@@ -356,8 +352,8 @@ def setUp(self):\n         self.finder = finders.DefaultStorageFinder(\n             storage=storage.StaticFilesStorage(location=settings.MEDIA_ROOT))\n         test_file_path = os.path.join(settings.MEDIA_ROOT, 'media-file.txt')\n-        self.find_first = (\"media-file.txt\", test_file_path)\n-        self.find_all = (\"media-file.txt\", [test_file_path])\n+        self.find_first = ('media-file.txt', test_file_path)\n+        self.find_all = ('media-file.txt', [test_file_path])\n \n \n class TestMiscFinder(TestCase):\n@@ -366,9 +362,9 @@ class TestMiscFinder(TestCase):\n     \"\"\"\n     def test_get_finder(self):\n         self.assertTrue(isinstance(finders.get_finder(\n-            \"django.contrib.staticfiles.finders.FileSystemFinder\"),\n+            'django.contrib.staticfiles.finders.FileSystemFinder'),\n             finders.FileSystemFinder))\n         self.assertRaises(ImproperlyConfigured,\n-            finders.get_finder, \"django.contrib.staticfiles.finders.FooBarFinder\")\n+            finders.get_finder, 'django.contrib.staticfiles.finders.FooBarFinder')\n         self.assertRaises(ImproperlyConfigured,\n-            finders.get_finder, \"foo.bar.FooBarFinder\")\n+            finders.get_finder, 'foo.bar.FooBarFinder')"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 22,
        "deletions": 25
    }
}