{
    "author": "jacobian",
    "message": "Merge pull request #900 from bmispelon/ticket-20022\n\nFix #20022: Correctly handle prefixes with url-unsafe characters in reverse()",
    "sha": "e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13",
    "files": [
        {
            "sha": "ffe74bc6505447bd0f74112c7d6815f394317745",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13",
            "patch": "@@ -388,7 +388,7 @@ def _reverse_with_prefix(self, lookup_view, _prefix, *args, **kwargs):\n                     if len(args) != len(params) + len(prefix_args):\n                         continue\n                     unicode_args = [force_text(val) for val in args]\n-                    candidate = (prefix_norm + result) % dict(zip(prefix_args + params, unicode_args))\n+                    candidate = (prefix_norm.replace('%', '%%') + result) % dict(zip(prefix_args + params, unicode_args))\n                 else:\n                     if set(kwargs.keys()) | set(defaults.keys()) != set(params) | set(defaults.keys()) | set(prefix_args):\n                         continue"
        },
        {
            "sha": "1860c9dd2c977a4128ff012706790df87be62526",
            "filename": "tests/urlpatterns_reverse/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13/tests%2Furlpatterns_reverse%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13/tests%2Furlpatterns_reverse%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Furlpatterns_reverse%2Ftests.py?ref=e4d9f8aed11e964885cd77f8abd01ba0dfa4aa13",
            "patch": "@@ -183,6 +183,11 @@ def test_prefix_format_char(self):\n         self.assertEqual('/bump%2520map/includes/non_path_include/',\n                reverse('non_path_include', prefix='/bump%20map/'))\n \n+    def test_non_urlsafe_prefix_with_args(self):\n+        # Regression for #20022\n+        self.assertEqual('/%7Eme/places/1/',\n+                reverse('places', args=[1], prefix='/~me/'))\n+\n class ResolverTests(unittest.TestCase):\n     def test_resolver_repr(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}