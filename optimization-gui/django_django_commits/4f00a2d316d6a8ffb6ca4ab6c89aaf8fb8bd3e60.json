{
    "author": "jphalip",
    "message": "Fixed #15826 -- Made `assertContains` and `assertNotContains` work with `SimpleTemplateResponse` by forcing it to be rendered if it hasn't been rendered yet. Thanks to bmihelac for the report, to mmcnickle for the initial patch and tests, and to Carl Meyer for the guidance.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17025 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60",
    "files": [
        {
            "sha": "ee22ac219ebdba9b5fa828789b5bc1549173262d",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60",
            "patch": "@@ -500,6 +500,13 @@ def assertContains(self, response, text, count=None, status_code=200,\n         If ``count`` is None, the count doesn't matter - the assertion is true\n         if the text occurs at least once in the response.\n         \"\"\"\n+\n+        # If the response supports deferred rendering and hasn't been rendered\n+        # yet, then ensure that it does get rendered before proceeding further.\n+        if (hasattr(response, 'render') and callable(response.render)\n+            and not response.is_rendered):\n+            response.render()\n+\n         if msg_prefix:\n             msg_prefix += \": \"\n \n@@ -523,6 +530,13 @@ def assertNotContains(self, response, text, status_code=200,\n         successfully, (i.e., the HTTP status code was as expected), and that\n         ``text`` doesn't occurs in the content of the response.\n         \"\"\"\n+\n+        # If the response supports deferred rendering and hasn't been rendered\n+        # yet, then ensure that it does get rendered before proceeding further.\n+        if (hasattr(response, 'render') and callable(response.render)\n+            and not response.is_rendered):\n+            response.render()\n+\n         if msg_prefix:\n             msg_prefix += \": \"\n "
        },
        {
            "sha": "b1e5bc4ff0da7209c3ef836551cdbdacba3dbeb2",
            "filename": "tests/regressiontests/test_client_regress/models.py",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py?ref=4f00a2d316d6a8ffb6ca4ab6c89aaf8fb8bd3e60",
            "patch": "@@ -14,6 +14,8 @@\n from django.test import Client, TestCase\n from django.test.client import encode_file, RequestFactory\n from django.test.utils import ContextList, override_settings\n+from django.template.response import SimpleTemplateResponse\n+from django.http import HttpResponse\n \n \n class AssertContainsTests(TestCase):\n@@ -130,6 +132,37 @@ def test_unicode_not_contains(self):\n         self.assertNotContains(r, u'はたけ')\n         self.assertNotContains(r, '\\xe3\\x81\\xaf\\xe3\\x81\\x9f\\xe3\\x81\\x91'.decode('utf-8'))\n \n+    def test_assert_contains_renders_template_response(self):\n+        \"\"\" Test that we can pass in an unrendered SimpleTemplateReponse\n+            without throwing an error.\n+            Refs #15826.\n+        \"\"\"\n+        response = SimpleTemplateResponse(Template('Hello'), status=200)\n+        self.assertContains(response, 'Hello')\n+\n+    def test_assert_contains_using_non_template_response(self):\n+        \"\"\" Test that auto-rendering does not affect responses that aren't\n+            instances (or subclasses) of SimpleTemplateResponse.\n+            Refs #15826.\n+        \"\"\"\n+        response = HttpResponse('Hello')\n+        self.assertContains(response, 'Hello')\n+\n+    def test_assert_not_contains_renders_template_response(self):\n+        \"\"\" Test that we can pass in an unrendered SimpleTemplateReponse\n+            without throwing an error.\n+            Refs #15826.\n+        \"\"\"\n+        response = SimpleTemplateResponse(Template('Hello'), status=200)\n+        self.assertNotContains(response, 'Bye')\n+\n+    def test_assert_not_contains_using_non_template_response(self):\n+        \"\"\" Test that auto-rendering does not affect responses that aren't\n+            instances (or subclasses) of SimpleTemplateResponse.\n+            Refs #15826.\n+        \"\"\"\n+        response = HttpResponse('Hello')\n+        self.assertNotContains(response, 'Bye')\n \n class AssertTemplateUsedTests(TestCase):\n     fixtures = ['testdata.json']"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 47,
        "deletions": 0
    }
}