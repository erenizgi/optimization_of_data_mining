{
    "author": "claudep",
    "message": "Fixed #18334 -- Fixed detection of supports_stddev backend feature.\n\nThanks to Michael Manfre for the report and Anssi Kääriäinen for the\nreview.",
    "sha": "7549de841c6e0d18822af047763f5e3211539be8",
    "files": [
        {
            "sha": "bf622b9a0fce495041875388f7d09f66f972478f",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/7549de841c6e0d18822af047763f5e3211539be8/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/7549de841c6e0d18822af047763f5e3211539be8/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=7549de841c6e0d18822af047763f5e3211539be8",
            "patch": "@@ -414,10 +414,11 @@ def __init__(self, connection):\n \n     def confirm(self):\n         \"Perform manual checks of any database features that might vary between installs\"\n-        self._confirmed = True\n-        self.supports_transactions = self._supports_transactions()\n-        self.supports_stddev = self._supports_stddev()\n-        self.can_introspect_foreign_keys = self._can_introspect_foreign_keys()\n+        if not self._confirmed:\n+            self._confirmed = True\n+            self.supports_transactions = self._supports_transactions()\n+            self.supports_stddev = self._supports_stddev()\n+            self.can_introspect_foreign_keys = self._can_introspect_foreign_keys()\n \n     def _supports_transactions(self):\n         \"Confirm support for transactions\"\n@@ -439,8 +440,9 @@ class StdDevPop(object):\n \n         try:\n             self.connection.ops.check_aggregate_support(StdDevPop())\n+            return True\n         except NotImplementedError:\n-            self.supports_stddev = False\n+            return False\n \n     def _can_introspect_foreign_keys(self):\n         \"Confirm support for introspected foreign keys\""
        },
        {
            "sha": "10e69b65c1e42bf3cb33d243f3fd30c7044a4c38",
            "filename": "tests/regressiontests/backends/tests.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/7549de841c6e0d18822af047763f5e3211539be8/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/7549de841c6e0d18822af047763f5e3211539be8/tests%2Fregressiontests%2Fbackends%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbackends%2Ftests.py?ref=7549de841c6e0d18822af047763f5e3211539be8",
            "patch": "@@ -397,6 +397,12 @@ def test_database_operations_helper_class(self):\n         self.assertTrue(hasattr(connection.ops, 'connection'))\n         self.assertEqual(connection, connection.ops.connection)\n \n+    def test_supports_needed_confirm(self):\n+        connection.features.confirm()\n+        self.assertIn(connection.features.supports_transactions, (True, False))\n+        self.assertIn(connection.features.supports_stddev, (True, False))\n+        self.assertIn(connection.features.can_introspect_foreign_keys, (True, False))\n+\n     def test_duplicate_table_error(self):\n         \"\"\" Test that creating an existing table returns a DatabaseError \"\"\"\n         cursor = connection.cursor()"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 13,
        "deletions": 5
    }
}