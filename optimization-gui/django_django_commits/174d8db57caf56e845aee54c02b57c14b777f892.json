{
    "author": "jacobian",
    "message": "Prevented non-admin users from accessing the admin redirect shortcut.\n\nIf the admin shortcut view (e.g. /admin/r/<content-type>/<pk>/) is\npublically-accessible, and if a public users can guess a content-type ID\n(which isn't hard given that they're sequential), then the redirect view could\npossibly leak data by redirecting to pages a user shouldn't \"know about.\" So\nthe redirect view needs the same protection as the rest of the admin site.\n\nThanks to Jason Royes for pointing this out.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15639 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "174d8db57caf56e845aee54c02b57c14b777f892",
    "files": [
        {
            "sha": "4b6e3cad87b34b765206a8271d7835f2fab8504b",
            "filename": "django/contrib/admin/sites.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/174d8db57caf56e845aee54c02b57c14b777f892/django%2Fcontrib%2Fadmin%2Fsites.py",
            "raw_url": "https://github.com/django/django/raw/174d8db57caf56e845aee54c02b57c14b777f892/django%2Fcontrib%2Fadmin%2Fsites.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fsites.py?ref=174d8db57caf56e845aee54c02b57c14b777f892",
            "patch": "@@ -3,6 +3,7 @@\n from django.contrib.admin import ModelAdmin, actions\n from django.contrib.admin.forms import AdminAuthenticationForm, ERROR_MESSAGE\n from django.contrib.auth import REDIRECT_FIELD_NAME, authenticate, login\n+from django.contrib.contenttypes import views as contenttype_views\n from django.views.decorators.csrf import csrf_protect\n from django.db.models.base import ModelBase\n from django.core.exceptions import ImproperlyConfigured\n@@ -231,7 +232,7 @@ def wrapper(*args, **kwargs):\n                 wrap(self.i18n_javascript, cacheable=True),\n                 name='jsi18n'),\n             url(r'^r/(?P<content_type_id>\\d+)/(?P<object_id>.+)/$',\n-                'django.views.defaults.shortcut'),\n+                wrap(contenttype_views.shortcut)),\n             url(r'^(?P<app_label>\\w+)/$',\n                 wrap(self.app_index),\n                 name='app_list')"
        },
        {
            "sha": "7782f9eab7923d52da503f2cc6eec1ffbb4fddf6",
            "filename": "tests/regressiontests/admin_views/tests.py",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/174d8db57caf56e845aee54c02b57c14b777f892/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/174d8db57caf56e845aee54c02b57c14b777f892/tests%2Fregressiontests%2Fadmin_views%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Ftests.py?ref=174d8db57caf56e845aee54c02b57c14b777f892",
            "patch": "@@ -1143,7 +1143,7 @@ def test_url_conflicts_with_history(self):\n         self.assertContains(response, should_contain)\n \n \n-class SecureViewTest(TestCase):\n+class SecureViewTests(TestCase):\n     fixtures = ['admin-views-users.xml']\n \n     def setUp(self):\n@@ -1281,6 +1281,25 @@ def test_staff_member_required_decorator_works_as_per_admin_login(self):\n         # make sure the view removes test cookie\n         self.assertEqual(self.client.session.test_cookie_worked(), False)\n \n+    def test_shortcut_view_only_available_to_staff(self):\n+        \"\"\"\n+        Only admin users should be able to use the admin shortcut view.\n+        \"\"\"\n+        user_ctype = ContentType.objects.get_for_model(User)\n+        user = User.objects.get(username='super')\n+        shortcut_url = \"/test_admin/admin/r/%s/%s/\" % (user_ctype.pk, user.pk)\n+        \n+        # Not logged in: we should see the login page.\n+        response = self.client.get(shortcut_url, follow=False)\n+        self.assertTemplateUsed(response, 'admin/login.html')\n+        \n+        # Logged in? Redirect.\n+        self.client.login(username='super', password='secret')\n+        response = self.client.get(shortcut_url, follow=False)\n+        # Can't use self.assertRedirects() because User.get_absolute_url() is silly.\n+        self.assertEqual(response.status_code, 302)\n+        self.assertEqual(response['Location'], 'http://example.com/users/super/')\n+\n class AdminViewUnicodeTest(TestCase):\n     fixtures = ['admin-views-unicode.xml']\n \n@@ -2872,3 +2891,4 @@ def test_multiple_years(self):\n             self.assert_non_localized_year(response, 2000)\n             self.assert_non_localized_year(response, 2003)\n             self.assert_non_localized_year(response, 2005)\n+"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 23,
        "deletions": 2
    }
}