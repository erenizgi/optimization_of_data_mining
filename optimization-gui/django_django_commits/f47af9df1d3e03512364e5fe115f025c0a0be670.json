{
    "author": "unknown",
    "message": "Cleaned up several test cases, to better isolate state.",
    "sha": "f47af9df1d3e03512364e5fe115f025c0a0be670",
    "files": [
        {
            "sha": "d675372c7a99934ff1176042a7471ce7a6504116",
            "filename": "tests/regressiontests/fixtures_regress/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 16,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/f47af9df1d3e03512364e5fe115f025c0a0be670/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f47af9df1d3e03512364e5fe115f025c0a0be670/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffixtures_regress%2Ftests.py?ref=f47af9df1d3e03512364e5fe115f025c0a0be670",
            "patch": "@@ -21,18 +21,15 @@\n     ExternalDependency, Thingy)\n \n \n-pre_save_checks = []\n-def animal_pre_save_check(signal, sender, instance, **kwargs):\n-    \"A signal that is used to check the type of data loaded from fixtures\"\n-    pre_save_checks.append(\n-        (\n-            'Count = %s (%s)' % (instance.count, type(instance.count)),\n-            'Weight = %s (%s)' % (instance.weight, type(instance.weight)),\n+class TestFixtures(TestCase):\n+    def animal_pre_save_check(self, signal, sender, instance, **kwargs):\n+        self.pre_save_checks.append(\n+            (\n+                'Count = %s (%s)' % (instance.count, type(instance.count)),\n+                'Weight = %s (%s)' % (instance.weight, type(instance.weight)),\n+            )\n         )\n-    )\n-\n \n-class TestFixtures(TestCase):\n     def test_duplicate_pk(self):\n         \"\"\"\n         This is a regression test for ticket #3790.\n@@ -111,7 +108,6 @@ def test_absolute_path(self):\n         )\n         self.assertEqual(Absolute.load_count, 1)\n \n-\n     def test_unknown_format(self):\n         \"\"\"\n         Test for ticket #4371 -- Loading data of an unknown format should fail\n@@ -246,9 +242,8 @@ def test_field_value_coerce(self):\n         Test for tickets #8298, #9942 - Field values should be coerced into the\n         correct type by the deserializer, not as part of the database write.\n         \"\"\"\n-        global pre_save_checks\n-        pre_save_checks = []\n-        signals.pre_save.connect(animal_pre_save_check)\n+        self.pre_save_checks = []\n+        signals.pre_save.connect(self.animal_pre_save_check)\n         try:\n             management.call_command(\n                 'loaddata',\n@@ -257,14 +252,14 @@ def test_field_value_coerce(self):\n                 commit=False,\n             )\n             self.assertEqual(\n-                pre_save_checks,\n+                self.pre_save_checks,\n                 [\n                     (\"Count = 42 (<%s 'int'>)\" % ('class' if PY3 else 'type'),\n                      \"Weight = 1.2 (<%s 'float'>)\" % ('class' if PY3 else 'type'))\n                 ]\n             )\n         finally:\n-            signals.pre_save.disconnect(animal_pre_save_check)\n+            signals.pre_save.disconnect(self.animal_pre_save_check)\n \n     def test_dumpdata_uses_default_manager(self):\n         \"\"\""
        },
        {
            "sha": "aaf8bcffcf5853c897cd361f03c675ca8961caa2",
            "filename": "tests/regressiontests/settings_tests/tests.py",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/f47af9df1d3e03512364e5fe115f025c0a0be670/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f47af9df1d3e03512364e5fe115f025c0a0be670/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsettings_tests%2Ftests.py?ref=f47af9df1d3e03512364e5fe115f025c0a0be670",
            "patch": "@@ -71,16 +71,18 @@ class SettingGetter(object):\n     def __init__(self):\n         self.test = getattr(settings, 'TEST', 'undefined')\n \n-testvalue = None\n \n-def signal_callback(sender, setting, value, **kwargs):\n-    if setting == 'TEST':\n-        global testvalue\n-        testvalue = value\n+class SettingsTests(TestCase):\n+    def setUp(self):\n+        self.testvalue = None\n+        signals.setting_changed.connect(self.signal_callback)\n \n-signals.setting_changed.connect(signal_callback)\n+    def tearDown(self):\n+        signals.setting_changed.disconnect(self.signal_callback)\n \n-class SettingsTests(TestCase):\n+    def signal_callback(self, sender, setting, value, **kwargs):\n+        if setting == 'TEST':\n+            self.testvalue = value\n \n     def test_override(self):\n         settings.TEST = 'test'\n@@ -128,12 +130,12 @@ def test_class_decorator(self):\n     def test_signal_callback_context_manager(self):\n         self.assertRaises(AttributeError, getattr, settings, 'TEST')\n         with self.settings(TEST='override'):\n-            self.assertEqual(testvalue, 'override')\n-        self.assertEqual(testvalue, None)\n+            self.assertEqual(self.testvalue, 'override')\n+        self.assertEqual(self.testvalue, None)\n \n     @override_settings(TEST='override')\n     def test_signal_callback_decorator(self):\n-        self.assertEqual(testvalue, 'override')\n+        self.assertEqual(self.testvalue, 'override')\n \n     #\n     # Regression tests for #10130: deleting settings."
        },
        {
            "sha": "8fb3ad5a48e8cedd5fdbdd4d0760b488760c4ecc",
            "filename": "tests/regressiontests/signals_regress/tests.py",
            "status": "modified",
            "additions": 34,
            "deletions": 36,
            "changes": 70,
            "blob_url": "https://github.com/django/django/blob/f47af9df1d3e03512364e5fe115f025c0a0be670/tests%2Fregressiontests%2Fsignals_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/f47af9df1d3e03512364e5fe115f025c0a0be670/tests%2Fregressiontests%2Fsignals_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsignals_regress%2Ftests.py?ref=f47af9df1d3e03512364e5fe115f025c0a0be670",
            "patch": "@@ -6,61 +6,59 @@\n from .models import Author, Book\n \n \n-signal_output = []\n-\n-def pre_save_test(signal, sender, instance, **kwargs):\n-    signal_output.append('pre_save signal, %s' % instance)\n-    if kwargs.get('raw'):\n-        signal_output.append('Is raw')\n-\n-def post_save_test(signal, sender, instance, **kwargs):\n-    signal_output.append('post_save signal, %s' % instance)\n-    if 'created' in kwargs:\n-        if kwargs['created']:\n-            signal_output.append('Is created')\n-        else:\n-            signal_output.append('Is updated')\n-    if kwargs.get('raw'):\n-        signal_output.append('Is raw')\n-\n-def pre_delete_test(signal, sender, instance, **kwargs):\n-    signal_output.append('pre_save signal, %s' % instance)\n-    signal_output.append('instance.id is not None: %s' % (instance.id != None))\n-\n-def post_delete_test(signal, sender, instance, **kwargs):\n-    signal_output.append('post_delete signal, %s' % instance)\n-    signal_output.append('instance.id is not None: %s' % (instance.id != None))\n-\n class SignalsRegressTests(TestCase):\n     \"\"\"\n     Testing signals before/after saving and deleting.\n     \"\"\"\n \n     def get_signal_output(self, fn, *args, **kwargs):\n         # Flush any existing signal output\n-        global signal_output\n-        signal_output = []\n+        self.signal_output = []\n         fn(*args, **kwargs)\n-        return signal_output\n+        return self.signal_output\n+\n+    def pre_save_test(self, signal, sender, instance, **kwargs):\n+        self.signal_output.append('pre_save signal, %s' % instance)\n+        if kwargs.get('raw'):\n+            self.signal_output.append('Is raw')\n+\n+    def post_save_test(self, signal, sender, instance, **kwargs):\n+        self.signal_output.append('post_save signal, %s' % instance)\n+        if 'created' in kwargs:\n+            if kwargs['created']:\n+                self.signal_output.append('Is created')\n+            else:\n+                self.signal_output.append('Is updated')\n+        if kwargs.get('raw'):\n+            self.signal_output.append('Is raw')\n+\n+    def pre_delete_test(self, signal, sender, instance, **kwargs):\n+        self.signal_output.append('pre_save signal, %s' % instance)\n+        self.signal_output.append('instance.id is not None: %s' % (instance.id != None))\n+\n+    def post_delete_test(self, signal, sender, instance, **kwargs):\n+        self.signal_output.append('post_delete signal, %s' % instance)\n+        self.signal_output.append('instance.id is not None: %s' % (instance.id != None))\n \n     def setUp(self):\n+        self.signal_output = []\n         # Save up the number of connected signals so that we can check at the end\n         # that all the signals we register get properly unregistered (#9989)\n         self.pre_signals = (len(models.signals.pre_save.receivers),\n                        len(models.signals.post_save.receivers),\n                        len(models.signals.pre_delete.receivers),\n                        len(models.signals.post_delete.receivers))\n \n-        models.signals.pre_save.connect(pre_save_test)\n-        models.signals.post_save.connect(post_save_test)\n-        models.signals.pre_delete.connect(pre_delete_test)\n-        models.signals.post_delete.connect(post_delete_test)\n+        models.signals.pre_save.connect(self.pre_save_test)\n+        models.signals.post_save.connect(self.post_save_test)\n+        models.signals.pre_delete.connect(self.pre_delete_test)\n+        models.signals.post_delete.connect(self.post_delete_test)\n \n     def tearDown(self):\n-        models.signals.post_delete.disconnect(post_delete_test)\n-        models.signals.pre_delete.disconnect(pre_delete_test)\n-        models.signals.post_save.disconnect(post_save_test)\n-        models.signals.pre_save.disconnect(pre_save_test)\n+        models.signals.post_delete.disconnect(self.post_delete_test)\n+        models.signals.pre_delete.disconnect(self.pre_delete_test)\n+        models.signals.post_save.disconnect(self.post_save_test)\n+        models.signals.pre_save.disconnect(self.pre_save_test)\n \n         # Check that all our signals got disconnected properly.\n         post_signals = (len(models.signals.pre_save.receivers),"
        }
    ],
    "stats": {
        "total": 119,
        "additions": 57,
        "deletions": 62
    }
}