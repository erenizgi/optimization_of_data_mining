{
    "author": "akaariai",
    "message": "Added tests for already fixed #20101\n\nThe ticket dealt with a case where one query had .exclude() that\nproduced a subquery, the other query had a join to the same model that\nwas subqueried in the first query. This was already fixed in master, so\nonly test added.",
    "sha": "80e68ee2ffb44d90c66b48e2db18ec4e16c025b4",
    "files": [
        {
            "sha": "806648aa547498aa1ce11ce0aee43d2612c11a56",
            "filename": "tests/queries/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/80e68ee2ffb44d90c66b48e2db18ec4e16c025b4/tests%2Fqueries%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/80e68ee2ffb44d90c66b48e2db18ec4e16c025b4/tests%2Fqueries%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fqueries%2Ftests.py?ref=80e68ee2ffb44d90c66b48e2db18ec4e16c025b4",
            "patch": "@@ -2808,3 +2808,19 @@ def test_ticket_19964(self):\n         # not change results for the parents query.\n         self.assertEqual(list(children), [my2])\n         self.assertEqual(list(parents), [my1])\n+\n+class Ticket20101Tests(TestCase):\n+    def test_ticket_20101(self):\n+        \"\"\"\n+        Tests QuerySet ORed combining in exclude subquery case.\n+        \"\"\"\n+        t = Tag.objects.create(name='foo')\n+        a1 = Annotation.objects.create(tag=t, name='a1')\n+        a2 = Annotation.objects.create(tag=t, name='a2')\n+        a3 = Annotation.objects.create(tag=t, name='a3')\n+        n = Note.objects.create(note='foo', misc='bar')\n+        qs1 = Note.objects.exclude(annotation__in=[a1, a2])\n+        qs2 = Note.objects.filter(annotation__in=[a3])\n+        self.assertTrue(n in qs1)\n+        self.assertFalse(n in qs2)\n+        self.assertTrue(n in (qs1 | qs2))"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 16,
        "deletions": 0
    }
}