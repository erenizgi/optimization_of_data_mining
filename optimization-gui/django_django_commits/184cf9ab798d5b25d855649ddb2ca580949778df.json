{
    "author": "andrewgodwin",
    "message": "Merge branch 'master' into schema-alteration",
    "sha": "184cf9ab798d5b25d855649ddb2ca580949778df",
    "files": [
        {
            "sha": "e1c3fd18080381a75495ae2897fd86bb4ca6d9ed",
            "filename": "django/conf/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -158,7 +158,7 @@ def __getattr__(self, name):\n         return getattr(self.default_settings, name)\n \n     def __dir__(self):\n-        return self.__dict__.keys() + dir(self.default_settings)\n+        return list(self.__dict__) + dir(self.default_settings)\n \n     # For Python < 2.6:\n     __members__ = property(lambda self: self.__dir__())"
        },
        {
            "sha": "e76144a9e424ac29b3675b404116f01ed1160c85",
            "filename": "django/conf/locale/fi/formats.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2Flocale%2Ffi%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2Flocale%2Ffi%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Ffi%2Fformats.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,7 +7,7 @@\n # see http://docs.djangoproject.com/en/dev/ref/templates/builtins/#date\n DATE_FORMAT = 'j. E Y'\n TIME_FORMAT = 'G.i.s'\n-# DATETIME_FORMAT = \n+DATETIME_FORMAT = r'j. E Y \\k\\e\\l\\l\\o G.i.s'\n YEAR_MONTH_FORMAT = 'F Y'\n MONTH_DAY_FORMAT = 'j. F'\n SHORT_DATE_FORMAT = 'j.n.Y'"
        },
        {
            "sha": "ba7f6c52a011da7b1b6ccec0548b0836b5bf4e1d",
            "filename": "django/conf/locale/gl/formats.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2Flocale%2Fgl%2Fformats.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2Flocale%2Fgl%2Fformats.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Flocale%2Fgl%2Fformats.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,17 +1,18 @@\n # -*- encoding: utf-8 -*-\n # This file is distributed under the same license as the Django package.\n #\n+from __future__ import unicode_literals\n \n # The *_FORMAT strings use the Django date format syntax,\n # see http://docs.djangoproject.com/en/dev/ref/templates/builtins/#date\n-DATE_FORMAT = 'd F Y'\n+DATE_FORMAT = r'j \\d\\e F \\d\\e Y'\n TIME_FORMAT = 'H:i:s'\n-# DATETIME_FORMAT = \n-YEAR_MONTH_FORMAT = 'F Y'\n-MONTH_DAY_FORMAT = 'j F'\n-SHORT_DATE_FORMAT = 'j M, Y'\n-# SHORT_DATETIME_FORMAT = \n-# FIRST_DAY_OF_WEEK = \n+DATETIME_FORMAT = r'j \\d\\e F \\d\\e Y \\รก\\s H:i'\n+YEAR_MONTH_FORMAT = r'F \\d\\e Y'\n+MONTH_DAY_FORMAT = r'j \\d\\e F'\n+SHORT_DATE_FORMAT = 'd-m-Y'\n+SHORT_DATETIME_FORMAT = 'd-m-Y, H:i'\n+FIRST_DAY_OF_WEEK = 1 # Monday\n \n # The *_INPUT_FORMATS strings use the Python strftime format syntax,\n # see http://docs.python.org/library/datetime.html#strftime-strptime-behavior"
        },
        {
            "sha": "426c2b2d30e9e9921396cd943b4f9b4b9ced8d1b",
            "filename": "django/conf/urls/i18n.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2Furls%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fconf%2Furls%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Furls%2Fi18n.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,5 +1,5 @@\n from django.conf import settings\n-from django.conf.urls import patterns\n+from django.conf.urls import patterns, url\n from django.core.urlresolvers import LocaleRegexURLResolver\n \n def i18n_patterns(prefix, *args):\n@@ -16,5 +16,5 @@ def i18n_patterns(prefix, *args):\n \n \n urlpatterns = patterns('',\n-    (r'^setlang/$', 'django.views.i18n.set_language'),\n+    url(r'^setlang/$', 'django.views.i18n.set_language', name='set_language'),\n )"
        },
        {
            "sha": "201101736e92ce748f0fe722eeb3c79336829fed",
            "filename": "django/contrib/admin/actions.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Factions.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Factions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Factions.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,7 +7,7 @@\n from django.contrib.admin.util import get_deleted_objects, model_ngettext\n from django.db import router\n from django.template.response import TemplateResponse\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.translation import ugettext_lazy, ugettext as _\n \n def delete_selected(modeladmin, request, queryset):\n@@ -42,7 +42,7 @@ def delete_selected(modeladmin, request, queryset):\n         n = queryset.count()\n         if n:\n             for obj in queryset:\n-                obj_display = force_unicode(obj)\n+                obj_display = force_text(obj)\n                 modeladmin.log_deletion(request, obj, obj_display)\n             queryset.delete()\n             modeladmin.message_user(request, _(\"Successfully deleted %(count)d %(items)s.\") % {\n@@ -52,9 +52,9 @@ def delete_selected(modeladmin, request, queryset):\n         return None\n \n     if len(queryset) == 1:\n-        objects_name = force_unicode(opts.verbose_name)\n+        objects_name = force_text(opts.verbose_name)\n     else:\n-        objects_name = force_unicode(opts.verbose_name_plural)\n+        objects_name = force_text(opts.verbose_name_plural)\n \n     if perms_needed or protected:\n         title = _(\"Cannot delete %(name)s\") % {\"name\": objects_name}"
        },
        {
            "sha": "cecae216c087a29ed9c852ce02b25690396aa9c0",
            "filename": "django/contrib/admin/filters.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Ffilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ffilters.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n \n from django.db import models\n from django.core.exceptions import ImproperlyConfigured\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n from django.utils import timezone\n \n@@ -195,7 +195,7 @@ def choices(self, cl):\n         }\n         for pk_val, val in self.lookup_choices:\n             yield {\n-                'selected': self.lookup_val == smart_unicode(pk_val),\n+                'selected': self.lookup_val == smart_text(pk_val),\n                 'query_string': cl.get_query_string({\n                     self.lookup_kwarg: pk_val,\n                 }, [self.lookup_kwarg_isnull]),\n@@ -272,7 +272,7 @@ def choices(self, cl):\n         }\n         for lookup, title in self.field.flatchoices:\n             yield {\n-                'selected': smart_unicode(lookup) == self.lookup_val,\n+                'selected': smart_text(lookup) == self.lookup_val,\n                 'query_string': cl.get_query_string({\n                                     self.lookup_kwarg: lookup}),\n                 'display': title,\n@@ -381,7 +381,7 @@ def choices(self, cl):\n             if val is None:\n                 include_none = True\n                 continue\n-            val = smart_unicode(val)\n+            val = smart_text(val)\n             yield {\n                 'selected': self.lookup_val == val,\n                 'query_string': cl.get_query_string({"
        },
        {
            "sha": "90370bd9783fa4962d1748ac318dd6128234f416",
            "filename": "django/contrib/admin/helpers.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fhelpers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fhelpers.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.db.models.fields.related import ManyToManyRel\n from django.forms.util import flatatt\n from django.template.defaultfilters import capfirst\n-from django.utils.encoding import force_unicode, smart_unicode\n+from django.utils.encoding import force_text, smart_text\n from django.utils.html import conditional_escape, format_html\n from django.utils.safestring import mark_safe\n from django.utils import six\n@@ -94,7 +94,7 @@ def __iter__(self):\n class Fieldline(object):\n     def __init__(self, form, field, readonly_fields=None, model_admin=None):\n         self.form = form # A django.forms.Form instance\n-        if not hasattr(field, \"__iter__\"):\n+        if not hasattr(field, \"__iter__\") or isinstance(field, six.text_type):\n             self.fields = [field]\n         else:\n             self.fields = field\n@@ -122,7 +122,7 @@ def __init__(self, form, field, is_first):\n \n     def label_tag(self):\n         classes = []\n-        contents = conditional_escape(force_unicode(self.field.label))\n+        contents = conditional_escape(force_text(self.field.label))\n         if self.is_checkbox:\n             classes.append('vCheckboxLabel')\n         else:\n@@ -166,7 +166,7 @@ def label_tag(self):\n         label = self.field['label']\n         return format_html('<label{0}>{1}:</label>',\n                            flatatt(attrs),\n-                           capfirst(force_unicode(label)))\n+                           capfirst(force_text(label)))\n \n     def contents(self):\n         from django.contrib.admin.templatetags.admin_list import _boolean_icon\n@@ -182,7 +182,7 @@ def contents(self):\n                 if boolean:\n                     result_repr = _boolean_icon(value)\n                 else:\n-                    result_repr = smart_unicode(value)\n+                    result_repr = smart_text(value)\n                     if getattr(attr, \"allow_tags\", False):\n                         result_repr = mark_safe(result_repr)\n             else:\n@@ -325,11 +325,11 @@ class AdminErrorList(forms.util.ErrorList):\n     \"\"\"\n     def __init__(self, form, inline_formsets):\n         if form.is_bound:\n-            self.extend(form.errors.values())\n+            self.extend(list(six.itervalues(form.errors)))\n             for inline_formset in inline_formsets:\n                 self.extend(inline_formset.non_form_errors())\n                 for errors_in_inline_form in inline_formset.errors:\n-                    self.extend(errors_in_inline_form.values())\n+                    self.extend(list(six.itervalues(errors_in_inline_form)))\n \n def normalize_fieldsets(fieldsets):\n     \"\"\""
        },
        {
            "sha": "e31c6d84eda34a2cfc40a3ccae8a396697e6f6da",
            "filename": "django/contrib/admin/models.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fmodels.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,15 +5,15 @@\n from django.contrib.auth.models import User\n from django.contrib.admin.util import quote\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n ADDITION = 1\n CHANGE = 2\n DELETION = 3\n \n class LogEntryManager(models.Manager):\n     def log_action(self, user_id, content_type_id, object_id, object_repr, action_flag, change_message=''):\n-        e = self.model(None, None, user_id, content_type_id, smart_unicode(object_id), object_repr[:200], action_flag, change_message)\n+        e = self.model(None, None, user_id, content_type_id, smart_text(object_id), object_repr[:200], action_flag, change_message)\n         e.save()\n \n class LogEntry(models.Model):\n@@ -34,7 +34,7 @@ class Meta:\n         ordering = ('-action_time',)\n \n     def __repr__(self):\n-        return smart_unicode(self.action_time)\n+        return smart_text(self.action_time)\n \n     def __unicode__(self):\n         if self.action_flag == ADDITION:"
        },
        {
            "sha": "081d00121b1eaf60425b52affa5fa05682af30c4",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 32,
            "deletions": 32,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -28,7 +28,7 @@\n from django.utils.text import capfirst, get_text_list\n from django.utils.translation import ugettext as _\n from django.utils.translation import ungettext\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n HORIZONTAL, VERTICAL = 1, 2\n # returns the <ul> class for a given radio_admin field\n@@ -425,7 +425,7 @@ def get_fieldsets(self, request, obj=None):\n         if self.declared_fieldsets:\n             return self.declared_fieldsets\n         form = self.get_form(request, obj)\n-        fields = form.base_fields.keys() + list(self.get_readonly_fields(request, obj))\n+        fields = list(form.base_fields) + list(self.get_readonly_fields(request, obj))\n         return [(None, {'fields': fields})]\n \n     def get_form(self, request, obj=None, **kwargs):\n@@ -520,7 +520,7 @@ def log_addition(self, request, object):\n             user_id         = request.user.pk,\n             content_type_id = ContentType.objects.get_for_model(object).pk,\n             object_id       = object.pk,\n-            object_repr     = force_unicode(object),\n+            object_repr     = force_text(object),\n             action_flag     = ADDITION\n         )\n \n@@ -535,7 +535,7 @@ def log_change(self, request, object, message):\n             user_id         = request.user.pk,\n             content_type_id = ContentType.objects.get_for_model(object).pk,\n             object_id       = object.pk,\n-            object_repr     = force_unicode(object),\n+            object_repr     = force_text(object),\n             action_flag     = CHANGE,\n             change_message  = message\n         )\n@@ -560,7 +560,7 @@ def action_checkbox(self, obj):\n         \"\"\"\n         A list_display column containing a checkbox widget.\n         \"\"\"\n-        return helpers.checkbox.render(helpers.ACTION_CHECKBOX_NAME, force_unicode(obj.pk))\n+        return helpers.checkbox.render(helpers.ACTION_CHECKBOX_NAME, force_text(obj.pk))\n     action_checkbox.short_description = mark_safe('<input type=\"checkbox\" id=\"action-toggle\" />')\n     action_checkbox.allow_tags = True\n \n@@ -608,7 +608,7 @@ def get_action_choices(self, request, default_choices=BLANK_CHOICE_DASH):\n         tuple (name, description).\n         \"\"\"\n         choices = [] + default_choices\n-        for func, name, description in self.get_actions(request).itervalues():\n+        for func, name, description in six.itervalues(self.get_actions(request)):\n             choice = (name, description % model_format_dict(self.opts))\n             choices.append(choice)\n         return choices\n@@ -674,17 +674,17 @@ def construct_change_message(self, request, form, formsets):\n             for formset in formsets:\n                 for added_object in formset.new_objects:\n                     change_message.append(_('Added %(name)s \"%(object)s\".')\n-                                          % {'name': force_unicode(added_object._meta.verbose_name),\n-                                             'object': force_unicode(added_object)})\n+                                          % {'name': force_text(added_object._meta.verbose_name),\n+                                             'object': force_text(added_object)})\n                 for changed_object, changed_fields in formset.changed_objects:\n                     change_message.append(_('Changed %(list)s for %(name)s \"%(object)s\".')\n                                           % {'list': get_text_list(changed_fields, _('and')),\n-                                             'name': force_unicode(changed_object._meta.verbose_name),\n-                                             'object': force_unicode(changed_object)})\n+                                             'name': force_text(changed_object._meta.verbose_name),\n+                                             'object': force_text(changed_object)})\n                 for deleted_object in formset.deleted_objects:\n                     change_message.append(_('Deleted %(name)s \"%(object)s\".')\n-                                          % {'name': force_unicode(deleted_object._meta.verbose_name),\n-                                             'object': force_unicode(deleted_object)})\n+                                          % {'name': force_text(deleted_object._meta.verbose_name),\n+                                             'object': force_text(deleted_object)})\n         change_message = ' '.join(change_message)\n         return change_message or _('No fields changed.')\n \n@@ -769,7 +769,7 @@ def response_add(self, request, obj, post_url_continue='../%s/'):\n         opts = obj._meta\n         pk_value = obj._get_pk_val()\n \n-        msg = _('The %(name)s \"%(obj)s\" was added successfully.') % {'name': force_unicode(opts.verbose_name), 'obj': force_unicode(obj)}\n+        msg = _('The %(name)s \"%(obj)s\" was added successfully.') % {'name': force_text(opts.verbose_name), 'obj': force_text(obj)}\n         # Here, we distinguish between different save types by checking for\n         # the presence of keys in request.POST.\n         if \"_continue\" in request.POST:\n@@ -782,10 +782,10 @@ def response_add(self, request, obj, post_url_continue='../%s/'):\n             return HttpResponse(\n                 '<!DOCTYPE html><html><head><title></title></head><body>'\n                 '<script type=\"text/javascript\">opener.dismissAddAnotherPopup(window, \"%s\", \"%s\");</script></body></html>' % \\\n-                # escape() calls force_unicode.\n+                # escape() calls force_text.\n                 (escape(pk_value), escapejs(obj)))\n         elif \"_addanother\" in request.POST:\n-            self.message_user(request, msg + ' ' + (_(\"You may add another %s below.\") % force_unicode(opts.verbose_name)))\n+            self.message_user(request, msg + ' ' + (_(\"You may add another %s below.\") % force_text(opts.verbose_name)))\n             return HttpResponseRedirect(request.path)\n         else:\n             self.message_user(request, msg)\n@@ -819,22 +819,22 @@ def response_change(self, request, obj):\n \n         pk_value = obj._get_pk_val()\n \n-        msg = _('The %(name)s \"%(obj)s\" was changed successfully.') % {'name': force_unicode(verbose_name), 'obj': force_unicode(obj)}\n+        msg = _('The %(name)s \"%(obj)s\" was changed successfully.') % {'name': force_text(verbose_name), 'obj': force_text(obj)}\n         if \"_continue\" in request.POST:\n             self.message_user(request, msg + ' ' + _(\"You may edit it again below.\"))\n             if \"_popup\" in request.REQUEST:\n                 return HttpResponseRedirect(request.path + \"?_popup=1\")\n             else:\n                 return HttpResponseRedirect(request.path)\n         elif \"_saveasnew\" in request.POST:\n-            msg = _('The %(name)s \"%(obj)s\" was added successfully. You may edit it again below.') % {'name': force_unicode(verbose_name), 'obj': obj}\n+            msg = _('The %(name)s \"%(obj)s\" was added successfully. You may edit it again below.') % {'name': force_text(verbose_name), 'obj': obj}\n             self.message_user(request, msg)\n             return HttpResponseRedirect(reverse('admin:%s_%s_change' %\n                                         (opts.app_label, module_name),\n                                         args=(pk_value,),\n                                         current_app=self.admin_site.name))\n         elif \"_addanother\" in request.POST:\n-            self.message_user(request, msg + ' ' + (_(\"You may add another %s below.\") % force_unicode(verbose_name)))\n+            self.message_user(request, msg + ' ' + (_(\"You may add another %s below.\") % force_text(verbose_name)))\n             return HttpResponseRedirect(reverse('admin:%s_%s_add' %\n                                         (opts.app_label, module_name),\n                                         current_app=self.admin_site.name))\n@@ -995,7 +995,7 @@ def add_view(self, request, form_url='', extra_context=None):\n             media = media + inline_admin_formset.media\n \n         context = {\n-            'title': _('Add %s') % force_unicode(opts.verbose_name),\n+            'title': _('Add %s') % force_text(opts.verbose_name),\n             'adminform': adminForm,\n             'is_popup': \"_popup\" in request.REQUEST,\n             'media': media,\n@@ -1019,7 +1019,7 @@ def change_view(self, request, object_id, form_url='', extra_context=None):\n             raise PermissionDenied\n \n         if obj is None:\n-            raise Http404(_('%(name)s object with primary key %(key)r does not exist.') % {'name': force_unicode(opts.verbose_name), 'key': escape(object_id)})\n+            raise Http404(_('%(name)s object with primary key %(key)r does not exist.') % {'name': force_text(opts.verbose_name), 'key': escape(object_id)})\n \n         if request.method == 'POST' and \"_saveasnew\" in request.POST:\n             return self.add_view(request, form_url=reverse('admin:%s_%s_add' %\n@@ -1085,7 +1085,7 @@ def change_view(self, request, object_id, form_url='', extra_context=None):\n             media = media + inline_admin_formset.media\n \n         context = {\n-            'title': _('Change %s') % force_unicode(opts.verbose_name),\n+            'title': _('Change %s') % force_text(opts.verbose_name),\n             'adminform': adminForm,\n             'object_id': object_id,\n             'original': obj,\n@@ -1194,14 +1194,14 @@ def changelist_view(self, request, extra_context=None):\n \n                 if changecount:\n                     if changecount == 1:\n-                        name = force_unicode(opts.verbose_name)\n+                        name = force_text(opts.verbose_name)\n                     else:\n-                        name = force_unicode(opts.verbose_name_plural)\n+                        name = force_text(opts.verbose_name_plural)\n                     msg = ungettext(\"%(count)s %(name)s was changed successfully.\",\n                                     \"%(count)s %(name)s were changed successfully.\",\n                                     changecount) % {'count': changecount,\n                                                     'name': name,\n-                                                    'obj': force_unicode(obj)}\n+                                                    'obj': force_text(obj)}\n                     self.message_user(request, msg)\n \n                 return HttpResponseRedirect(request.get_full_path())\n@@ -1228,7 +1228,7 @@ def changelist_view(self, request, extra_context=None):\n             'All %(total_count)s selected', cl.result_count)\n \n         context = {\n-            'module_name': force_unicode(opts.verbose_name_plural),\n+            'module_name': force_text(opts.verbose_name_plural),\n             'selection_note': _('0 of %(cnt)s selected') % {'cnt': len(cl.result_list)},\n             'selection_note_all': selection_note_all % {'total_count': cl.result_count},\n             'title': cl.title,\n@@ -1263,7 +1263,7 @@ def delete_view(self, request, object_id, extra_context=None):\n             raise PermissionDenied\n \n         if obj is None:\n-            raise Http404(_('%(name)s object with primary key %(key)r does not exist.') % {'name': force_unicode(opts.verbose_name), 'key': escape(object_id)})\n+            raise Http404(_('%(name)s object with primary key %(key)r does not exist.') % {'name': force_text(opts.verbose_name), 'key': escape(object_id)})\n \n         using = router.db_for_write(self.model)\n \n@@ -1275,11 +1275,11 @@ def delete_view(self, request, object_id, extra_context=None):\n         if request.POST: # The user has already confirmed the deletion.\n             if perms_needed:\n                 raise PermissionDenied\n-            obj_display = force_unicode(obj)\n+            obj_display = force_text(obj)\n             self.log_deletion(request, obj, obj_display)\n             self.delete_model(request, obj)\n \n-            self.message_user(request, _('The %(name)s \"%(obj)s\" was deleted successfully.') % {'name': force_unicode(opts.verbose_name), 'obj': force_unicode(obj_display)})\n+            self.message_user(request, _('The %(name)s \"%(obj)s\" was deleted successfully.') % {'name': force_text(opts.verbose_name), 'obj': force_text(obj_display)})\n \n             if not self.has_change_permission(request, None):\n                 return HttpResponseRedirect(reverse('admin:index',\n@@ -1288,7 +1288,7 @@ def delete_view(self, request, object_id, extra_context=None):\n                                         (opts.app_label, opts.module_name),\n                                         current_app=self.admin_site.name))\n \n-        object_name = force_unicode(opts.verbose_name)\n+        object_name = force_text(opts.verbose_name)\n \n         if perms_needed or protected:\n             title = _(\"Cannot delete %(name)s\") % {\"name\": object_name}\n@@ -1326,9 +1326,9 @@ def history_view(self, request, object_id, extra_context=None):\n         # If no history was found, see whether this object even exists.\n         obj = get_object_or_404(model, pk=unquote(object_id))\n         context = {\n-            'title': _('Change history: %s') % force_unicode(obj),\n+            'title': _('Change history: %s') % force_text(obj),\n             'action_list': action_list,\n-            'module_name': capfirst(force_unicode(opts.verbose_name_plural)),\n+            'module_name': capfirst(force_text(opts.verbose_name_plural)),\n             'object': obj,\n             'app_label': app_label,\n             'opts': opts,\n@@ -1415,7 +1415,7 @@ def get_fieldsets(self, request, obj=None):\n         if self.declared_fieldsets:\n             return self.declared_fieldsets\n         form = self.get_formset(request, obj).form\n-        fields = form.base_fields.keys() + list(self.get_readonly_fields(request, obj))\n+        fields = list(form.base_fields) + list(self.get_readonly_fields(request, obj))\n         return [(None, {'fields': fields})]\n \n     def queryset(self, request):"
        },
        {
            "sha": "05773ceac055021db06cc26893ae579163454c2d",
            "filename": "django/contrib/admin/sites.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fsites.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fsites.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fsites.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,6 +10,7 @@\n from django.core.urlresolvers import reverse, NoReverseMatch\n from django.template.response import TemplateResponse\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.text import capfirst\n from django.utils.translation import ugettext as _\n from django.views.decorators.cache import never_cache\n@@ -133,7 +134,7 @@ def actions(self):\n         \"\"\"\n         Get all the enabled actions as an iterable of (name, func).\n         \"\"\"\n-        return self._actions.iteritems()\n+        return six.iteritems(self._actions)\n \n     def has_permission(self, request):\n         \"\"\"\n@@ -239,7 +240,7 @@ def wrapper(*args, **kwargs):\n         )\n \n         # Add in each model's views.\n-        for model, model_admin in self._registry.iteritems():\n+        for model, model_admin in six.iteritems(self._registry):\n             urlpatterns += patterns('',\n                 url(r'^%s/%s/' % (model._meta.app_label, model._meta.module_name),\n                     include(model_admin.urls))\n@@ -370,7 +371,7 @@ def index(self, request, extra_context=None):\n                         }\n \n         # Sort the apps alphabetically.\n-        app_list = app_dict.values()\n+        app_list = list(six.itervalues(app_dict))\n         app_list.sort(key=lambda x: x['name'])\n \n         # Sort the models alphabetically within each app."
        },
        {
            "sha": "1873d4498983d7fbb1f2266dd9f79b49924878d5",
            "filename": "django/contrib/admin/templatetags/admin_list.py",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Ftemplatetags%2Fadmin_list.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,9 +12,10 @@\n from django.utils import formats\n from django.utils.html import format_html\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.text import capfirst\n from django.utils.translation import ugettext as _\n-from django.utils.encoding import smart_unicode, force_unicode\n+from django.utils.encoding import smart_text, force_text\n from django.template import Library\n from django.template.loader import get_template\n from django.template.context import Context\n@@ -125,7 +126,7 @@ def result_headers(cl):\n         if i in ordering_field_columns:\n             sorted = True\n             order_type = ordering_field_columns.get(i).lower()\n-            sort_priority = ordering_field_columns.keys().index(i) + 1\n+            sort_priority = list(ordering_field_columns).index(i) + 1\n             th_classes.append('sorted %sending' % order_type)\n             new_order_type = {'asc': 'desc', 'desc': 'asc'}[order_type]\n \n@@ -209,7 +210,7 @@ def items_for_result(cl, result, form):\n                     result_repr = display_for_field(value, f)\n                 if isinstance(f, (models.DateField, models.TimeField, models.ForeignKey)):\n                     row_class = mark_safe(' class=\"nowrap\"')\n-        if force_unicode(result_repr) == '':\n+        if force_text(result_repr) == '':\n             result_repr = mark_safe('&nbsp;')\n         # If list_display_links not defined, add the link tag to the first field\n         if (first and not cl.list_display_links) or field_name in cl.list_display_links:\n@@ -223,7 +224,7 @@ def items_for_result(cl, result, form):\n             else:\n                 attr = pk\n             value = result.serializable_value(attr)\n-            result_id = repr(force_unicode(value))[1:]\n+            result_id = repr(force_text(value))[1:]\n             yield format_html('<{0}{1}><a href=\"{2}\"{3}>{4}</a></{5}>',\n                               table_tag,\n                               row_class,\n@@ -240,10 +241,10 @@ def items_for_result(cl, result, form):\n                     field_name == cl.model._meta.pk.name and\n                         form[cl.model._meta.pk.name].is_hidden)):\n                 bf = form[field_name]\n-                result_repr = mark_safe(force_unicode(bf.errors) + force_unicode(bf))\n+                result_repr = mark_safe(force_text(bf.errors) + force_text(bf))\n             yield format_html('<td{0}>{1}</td>', row_class, result_repr)\n     if form and not form[cl.model._meta.pk.name].is_hidden:\n-        yield format_html('<td>{0}</td>', force_unicode(form[cl.model._meta.pk.name]))\n+        yield format_html('<td>{0}</td>', force_text(form[cl.model._meta.pk.name]))\n \n class ResultList(list):\n     # Wrapper class used to return items in a list_editable\n@@ -266,7 +267,7 @@ def result_hidden_fields(cl):\n     if cl.formset:\n         for res, form in zip(cl.result_list, cl.formset.forms):\n             if form[cl.model._meta.pk.name].is_hidden:\n-                yield mark_safe(force_unicode(form[cl.model._meta.pk.name]))\n+                yield mark_safe(force_text(form[cl.model._meta.pk.name]))\n \n @register.inclusion_tag(\"admin/change_list_results.html\")\n def result_list(cl):"
        },
        {
            "sha": "ff90e1d0079a7aa5a99354bf4d8c865fab4407b4",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n from django.utils.html import format_html\n from django.utils.text import capfirst\n from django.utils import timezone\n-from django.utils.encoding import force_unicode, smart_unicode, smart_str\n+from django.utils.encoding import force_text, smart_text, smart_bytes\n from django.utils import six\n from django.utils.translation import ungettext\n from django.core.urlresolvers import reverse\n@@ -132,7 +132,7 @@ def format_callback(obj):\n             # Don't display link to edit, because it either has no\n             # admin or is edited inline.\n             return '%s: %s' % (capfirst(opts.verbose_name),\n-                                force_unicode(obj))\n+                                force_text(obj))\n \n     to_delete = collector.nested(format_callback)\n \n@@ -207,8 +207,8 @@ def model_format_dict(obj):\n     else:\n         opts = obj\n     return {\n-        'verbose_name': force_unicode(opts.verbose_name),\n-        'verbose_name_plural': force_unicode(opts.verbose_name_plural)\n+        'verbose_name': force_text(opts.verbose_name),\n+        'verbose_name_plural': force_text(opts.verbose_name_plural)\n     }\n \n \n@@ -274,10 +274,10 @@ def label_for_field(name, model, model_admin=None, return_attr=False):\n             label = field.verbose_name\n     except models.FieldDoesNotExist:\n         if name == \"__unicode__\":\n-            label = force_unicode(model._meta.verbose_name)\n+            label = force_text(model._meta.verbose_name)\n             attr = six.text_type\n         elif name == \"__str__\":\n-            label = smart_str(model._meta.verbose_name)\n+            label = smart_bytes(model._meta.verbose_name)\n             attr = bytes\n         else:\n             if callable(name):\n@@ -311,7 +311,7 @@ def help_text_for_field(name, model):\n         help_text = model._meta.get_field_by_name(name)[0].help_text\n     except models.FieldDoesNotExist:\n         help_text = \"\"\n-    return smart_unicode(help_text)\n+    return smart_text(help_text)\n \n \n def display_for_field(value, field):\n@@ -335,7 +335,7 @@ def display_for_field(value, field):\n     elif isinstance(field, models.FloatField):\n         return formats.number_format(value)\n     else:\n-        return smart_unicode(value)\n+        return smart_text(value)\n \n \n def display_for_value(value, boolean=False):\n@@ -353,7 +353,7 @@ def display_for_value(value, boolean=False):\n     elif isinstance(value, six.integer_types + (decimal.Decimal, float)):\n         return formats.number_format(value)\n     else:\n-        return smart_unicode(value)\n+        return smart_text(value)\n \n \n class NotRelationField(Exception):"
        },
        {
            "sha": "3eabf3dbebc8c8a1c4c95d5f6b984269f8f3e15b",
            "filename": "django/contrib/admin/views/main.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fviews%2Fmain.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,7 +6,7 @@\n from django.db import models\n from django.db.models.fields import FieldDoesNotExist\n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import force_unicode, smart_str\n+from django.utils.encoding import force_text, smart_bytes\n from django.utils.translation import ugettext, ugettext_lazy\n from django.utils.http import urlencode\n \n@@ -75,7 +75,7 @@ def __init__(self, request, model, list_display, list_display_links,\n             title = ugettext('Select %s')\n         else:\n             title = ugettext('Select %s to change')\n-        self.title = title % force_unicode(self.opts.verbose_name)\n+        self.title = title % force_text(self.opts.verbose_name)\n         self.pk_attname = self.lookup_opts.pk.attname\n \n     def get_filters(self, request):\n@@ -94,7 +94,7 @@ def get_filters(self, request):\n                 # 'key' will be used as a keyword argument later, so Python\n                 # requires it to be a string.\n                 del lookup_params[key]\n-                lookup_params[smart_str(key)] = value\n+                lookup_params[smart_bytes(key)] = value\n \n             if not self.model_admin.lookup_allowed(key, value):\n                 raise SuspiciousOperation(\"Filtering by %s not allowed\" % key)"
        },
        {
            "sha": "1e0bc2d36606dfea801fab68f0947c1057d30953",
            "filename": "django/contrib/admin/widgets.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmin%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Fwidgets.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -14,7 +14,7 @@\n from django.utils.text import Truncator\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils import six\n \n \n@@ -96,7 +96,7 @@ def render(self):\n         return format_html('<ul{0}>\\n{1}\\n</ul>',\n                            flatatt(self.attrs),\n                            format_html_join('\\n', '<li>{0}</li>',\n-                                            ((force_unicode(w),) for w in self)))\n+                                            ((force_text(w),) for w in self)))\n \n class AdminRadioSelect(forms.RadioSelect):\n     renderer = AdminRadioFieldRenderer\n@@ -197,7 +197,7 @@ def render(self, name, value, attrs=None):\n             # The related object is registered with the same AdminSite\n             attrs['class'] = 'vManyToManyRawIdAdminField'\n         if value:\n-            value = ','.join([force_unicode(v) for v in value])\n+            value = ','.join([force_text(v) for v in value])\n         else:\n             value = ''\n         return super(ManyToManyRawIdWidget, self).render(name, value, attrs)\n@@ -221,7 +221,7 @@ def _has_changed(self, initial, data):\n         if len(initial) != len(data):\n             return True\n         for pk1, pk2 in zip(initial, data):\n-            if force_unicode(pk1) != force_unicode(pk2):\n+            if force_text(pk1) != force_text(pk2):\n                 return True\n         return False\n "
        },
        {
            "sha": "0e10eb4fa3ab6a27cad8800467025b4063554db9",
            "filename": "django/contrib/admindocs/utils.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmindocs%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmindocs%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Futils.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,7 +6,7 @@\n \n from django.utils.safestring import mark_safe\n from django.core.urlresolvers import reverse\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n try:\n     import docutils.core\n     import docutils.nodes\n@@ -66,7 +66,7 @@ def parse_rst(text, default_reference_context, thing_being_parsed=None):\n         \"link_base\" : reverse('django-admindocs-docroot').rstrip('/')\n     }\n     if thing_being_parsed:\n-        thing_being_parsed = smart_str(\"<%s>\" % thing_being_parsed)\n+        thing_being_parsed = smart_bytes(\"<%s>\" % thing_being_parsed)\n     parts = docutils.core.publish_parts(text, source_path=thing_being_parsed,\n                 destination_path=None, writer_name='html',\n                 settings_overrides=overrides)"
        },
        {
            "sha": "94963b4d39b5e611da65176e78a6e14477879b65",
            "filename": "django/contrib/admindocs/views.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fadmindocs%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmindocs%2Fviews.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -14,6 +14,7 @@\n from django.contrib.admindocs import utils\n from django.contrib.sites.models import Site\n from django.utils.importlib import import_module\n+from django.utils import six\n from django.utils.translation import ugettext as _\n from django.utils.safestring import mark_safe\n \n@@ -48,7 +49,7 @@ def template_tag_index(request):\n     load_all_installed_template_libraries()\n \n     tags = []\n-    app_libs = template.libraries.items()\n+    app_libs = list(six.iteritems(template.libraries))\n     builtin_libs = [(None, lib) for lib in template.builtins]\n     for module_name, library in builtin_libs + app_libs:\n         for tag_name, tag_func in library.tags.items():\n@@ -83,7 +84,7 @@ def template_filter_index(request):\n     load_all_installed_template_libraries()\n \n     filters = []\n-    app_libs = template.libraries.items()\n+    app_libs = list(six.iteritems(template.libraries))\n     builtin_libs = [(None, lib) for lib in template.builtins]\n     for module_name, library in builtin_libs + app_libs:\n         for filter_name, filter_func in library.filters.items():"
        },
        {
            "sha": "ccf940d16d9fb5890aab65d29dd0274eb138a26c",
            "filename": "django/contrib/auth/admin.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fadmin.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,6 +12,7 @@\n from django.utils.html import escape\n from django.utils.decorators import method_decorator\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.translation import ugettext, ugettext_lazy as _\n from django.views.decorators.csrf import csrf_protect\n from django.views.decorators.debug import sensitive_post_parameters\n@@ -128,7 +129,7 @@ def user_change_password(self, request, id, form_url=''):\n         else:\n             form = self.change_password_form(user)\n \n-        fieldsets = [(None, {'fields': form.base_fields.keys()})]\n+        fieldsets = [(None, {'fields': list(form.base_fields)})]\n         adminForm = admin.helpers.AdminForm(form, fieldsets, {})\n \n         context = {"
        },
        {
            "sha": "1b6c2eedd0cac12e6c4f8c5b7973d011fcd7171a",
            "filename": "django/contrib/auth/context_processors.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fcontext_processors.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,8 +11,9 @@ def __repr__(self):\n     def __getitem__(self, perm_name):\n         return self.user.has_perm(\"%s.%s\" % (self.module_name, perm_name))\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         return self.user.has_module_perms(self.module_name)\n+    __nonzero__ = __bool__ # Python 2\n \n \n class PermWrapper(object):"
        },
        {
            "sha": "dfd039f018098e5d0971b37e5fbca2745658ba0b",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -89,9 +89,9 @@ def clean_username(self):\n         raise forms.ValidationError(self.error_messages['duplicate_username'])\n \n     def clean_password2(self):\n-        password1 = self.cleaned_data.get(\"password1\", \"\")\n-        password2 = self.cleaned_data[\"password2\"]\n-        if password1 != password2:\n+        password1 = self.cleaned_data.get(\"password1\")\n+        password2 = self.cleaned_data.get(\"password2\")\n+        if password1 and password2 and password1 != password2:\n             raise forms.ValidationError(\n                 self.error_messages['password_mismatch'])\n         return password2"
        },
        {
            "sha": "45c1f88ab2c85b7d1e938d044d63fb269222cb17",
            "filename": "django/contrib/auth/hashers.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fhashers.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fhashers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fhashers.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,13 +1,14 @@\n from __future__ import unicode_literals\n \n+import base64\n import hashlib\n \n from django.dispatch import receiver\n from django.conf import settings\n from django.test.signals import setting_changed\n from django.utils import importlib\n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.core.exceptions import ImproperlyConfigured\n from django.utils.crypto import (\n     pbkdf2, constant_time_compare, get_random_string)\n@@ -218,7 +219,7 @@ def encode(self, password, salt, iterations=None):\n         if not iterations:\n             iterations = self.iterations\n         hash = pbkdf2(password, salt, iterations, digest=self.digest)\n-        hash = hash.encode('base64').strip()\n+        hash = base64.b64encode(hash).strip()\n         return \"%s$%d$%s$%s\" % (self.algorithm, iterations, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -298,7 +299,7 @@ class SHA1PasswordHasher(BasePasswordHasher):\n     def encode(self, password, salt):\n         assert password\n         assert salt and '$' not in salt\n-        hash = hashlib.sha1(smart_str(salt + password)).hexdigest()\n+        hash = hashlib.sha1(smart_bytes(salt + password)).hexdigest()\n         return \"%s$%s$%s\" % (self.algorithm, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -326,7 +327,7 @@ class MD5PasswordHasher(BasePasswordHasher):\n     def encode(self, password, salt):\n         assert password\n         assert salt and '$' not in salt\n-        hash = hashlib.md5(smart_str(salt + password)).hexdigest()\n+        hash = hashlib.md5(smart_bytes(salt + password)).hexdigest()\n         return \"%s$%s$%s\" % (self.algorithm, salt, hash)\n \n     def verify(self, password, encoded):\n@@ -360,7 +361,7 @@ def salt(self):\n         return ''\n \n     def encode(self, password, salt):\n-        return hashlib.md5(smart_str(password)).hexdigest()\n+        return hashlib.md5(smart_bytes(password)).hexdigest()\n \n     def verify(self, password, encoded):\n         encoded_2 = self.encode(password, '')"
        },
        {
            "sha": "7abd2abcf44897831f1d733b55094dee8d254616",
            "filename": "django/contrib/auth/management/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,6 +9,7 @@\n from django.contrib.auth import models as auth_app\n from django.db.models import get_models, signals\n from django.contrib.auth.models import User\n+from django.utils.six.moves import input\n \n \n def _get_permission_codename(action, opts):\n@@ -66,10 +67,10 @@ def create_superuser(app, created_models, verbosity, db, **kwargs):\n         msg = (\"\\nYou just installed Django's auth system, which means you \"\n             \"don't have any superusers defined.\\nWould you like to create one \"\n             \"now? (yes/no): \")\n-        confirm = raw_input(msg)\n+        confirm = input(msg)\n         while 1:\n             if confirm not in ('yes', 'no'):\n-                confirm = raw_input('Please enter either \"yes\" or \"no\": ')\n+                confirm = input('Please enter either \"yes\" or \"no\": ')\n                 continue\n             if confirm == 'yes':\n                 call_command(\"createsuperuser\", interactive=True, database=db)"
        },
        {
            "sha": "6e0d0bc75410848131b0b12e0bd5b3445cfc4213",
            "filename": "django/contrib/auth/management/commands/createsuperuser.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fmanagement%2Fcommands%2Fcreatesuperuser.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,6 +12,7 @@\n from django.core import exceptions\n from django.core.management.base import BaseCommand, CommandError\n from django.db import DEFAULT_DB_ALIAS\n+from django.utils.six.moves import input\n from django.utils.translation import ugettext as _\n \n RE_VALID_USERNAME = re.compile('[\\w.@+-]+$')\n@@ -76,7 +77,7 @@ def handle(self, *args, **options):\n                         input_msg = 'Username'\n                         if default_username:\n                             input_msg += ' (leave blank to use %r)' % default_username\n-                        username = raw_input(input_msg + ': ')\n+                        username = input(input_msg + ': ')\n                     if default_username and username == '':\n                         username = default_username\n                     if not RE_VALID_USERNAME.match(username):\n@@ -94,7 +95,7 @@ def handle(self, *args, **options):\n                 # Get an email\n                 while 1:\n                     if not email:\n-                        email = raw_input('E-mail address: ')\n+                        email = input('E-mail address: ')\n                     try:\n                         is_valid_email(email)\n                     except exceptions.ValidationError:"
        },
        {
            "sha": "594b55c6336c614c4bdfc0395f9355ced58b199f",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 17,
            "deletions": 15,
            "changes": 32,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,8 @@\n from django.forms.fields import Field, EmailField\n from django.test import TestCase\n from django.test.utils import override_settings\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n+from django.utils import six\n from django.utils import translation\n from django.utils.translation import ugettext as _\n \n@@ -27,7 +28,7 @@ def test_user_already_exists(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"username\"].errors,\n-                         [force_unicode(form.error_messages['duplicate_username'])])\n+                         [force_text(form.error_messages['duplicate_username'])])\n \n     def test_invalid_data(self):\n         data = {\n@@ -38,7 +39,7 @@ def test_invalid_data(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"username\"].errors,\n-                         [force_unicode(form.fields['username'].error_messages['invalid'])])\n+                         [force_text(form.fields['username'].error_messages['invalid'])])\n \n     def test_password_verification(self):\n         # The verification password is incorrect.\n@@ -50,13 +51,13 @@ def test_password_verification(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"password2\"].errors,\n-                         [force_unicode(form.error_messages['password_mismatch'])])\n+                         [force_text(form.error_messages['password_mismatch'])])\n \n     def test_both_passwords(self):\n         # One (or both) passwords weren't given\n         data = {'username': 'jsmith'}\n         form = UserCreationForm(data)\n-        required_error = [force_unicode(Field.default_error_messages['required'])]\n+        required_error = [force_text(Field.default_error_messages['required'])]\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form['password1'].errors, required_error)\n         self.assertEqual(form['password2'].errors, required_error)\n@@ -65,6 +66,7 @@ def test_both_passwords(self):\n         form = UserCreationForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form['password1'].errors, required_error)\n+        self.assertEqual(form['password2'].errors, [])\n \n     def test_success(self):\n         # The success case.\n@@ -94,7 +96,7 @@ def test_invalid_username(self):\n         form = AuthenticationForm(None, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.non_field_errors(),\n-                         [force_unicode(form.error_messages['invalid_login'])])\n+                         [force_text(form.error_messages['invalid_login'])])\n \n     def test_inactive_user(self):\n         # The user is inactive.\n@@ -105,7 +107,7 @@ def test_inactive_user(self):\n         form = AuthenticationForm(None, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.non_field_errors(),\n-                         [force_unicode(form.error_messages['inactive'])])\n+                         [force_text(form.error_messages['inactive'])])\n \n     def test_inactive_user_i18n(self):\n         with self.settings(USE_I18N=True):\n@@ -118,7 +120,7 @@ def test_inactive_user_i18n(self):\n                 form = AuthenticationForm(None, data)\n                 self.assertFalse(form.is_valid())\n                 self.assertEqual(form.non_field_errors(),\n-                                 [force_unicode(form.error_messages['inactive'])])\n+                                 [force_text(form.error_messages['inactive'])])\n \n     def test_success(self):\n         # The success case\n@@ -146,7 +148,7 @@ def test_password_verification(self):\n         form = SetPasswordForm(user, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"new_password2\"].errors,\n-                         [force_unicode(form.error_messages['password_mismatch'])])\n+                         [force_text(form.error_messages['password_mismatch'])])\n \n     def test_success(self):\n         user = User.objects.get(username='testclient')\n@@ -173,7 +175,7 @@ def test_incorrect_password(self):\n         form = PasswordChangeForm(user, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"old_password\"].errors,\n-                         [force_unicode(form.error_messages['password_incorrect'])])\n+                         [force_text(form.error_messages['password_incorrect'])])\n \n     def test_password_verification(self):\n         # The two new passwords do not match.\n@@ -186,7 +188,7 @@ def test_password_verification(self):\n         form = PasswordChangeForm(user, data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form[\"new_password2\"].errors,\n-                         [force_unicode(form.error_messages['password_mismatch'])])\n+                         [force_text(form.error_messages['password_mismatch'])])\n \n     def test_success(self):\n         # The success case.\n@@ -202,7 +204,7 @@ def test_success(self):\n     def test_field_order(self):\n         # Regression test - check the order of fields:\n         user = User.objects.get(username='testclient')\n-        self.assertEqual(PasswordChangeForm(user, {}).fields.keys(),\n+        self.assertEqual(list(PasswordChangeForm(user, {}).fields),\n                          ['old_password', 'new_password1', 'new_password2'])\n \n \n@@ -217,7 +219,7 @@ def test_username_validity(self):\n         form = UserChangeForm(data, instance=user)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form['username'].errors,\n-                         [force_unicode(form.fields['username'].error_messages['invalid'])])\n+                         [force_text(form.fields['username'].error_messages['invalid'])])\n \n     def test_bug_14242(self):\n         # A regression test, introduce by adding an optimization for the\n@@ -272,15 +274,15 @@ def test_invalid_email(self):\n         form = PasswordResetForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form['email'].errors,\n-                         [force_unicode(EmailField.default_error_messages['invalid'])])\n+                         [force_text(EmailField.default_error_messages['invalid'])])\n \n     def test_nonexistant_email(self):\n         # Test nonexistant email address\n         data = {'email': 'foo@bar.com'}\n         form = PasswordResetForm(data)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.errors,\n-                         {'email': [force_unicode(form.error_messages['unknown'])]})\n+                         {'email': [force_text(form.error_messages['unknown'])]})\n \n     def test_cleaned_data(self):\n         # Regression test"
        },
        {
            "sha": "3c847f456a92f45ea621fddd80e2cd74cc5591d1",
            "filename": "django/contrib/auth/tests/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fviews.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,7 +7,7 @@\n from django.core import mail\n from django.core.urlresolvers import reverse, NoReverseMatch\n from django.http import QueryDict\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.html import escape\n from django.utils.http import urlquote\n from django.test import TestCase\n@@ -46,7 +46,7 @@ def login(self, password='password'):\n         self.assertTrue(SESSION_KEY in self.client.session)\n \n     def assertContainsEscaped(self, response, text, **kwargs):\n-        return self.assertContains(response, escape(force_unicode(text)), **kwargs)\n+        return self.assertContains(response, escape(force_text(text)), **kwargs)\n \n \n class AuthViewNamedURLTests(AuthViewsTestCase):"
        },
        {
            "sha": "bd254d27337ce9dbd5a3e41f58d4b2ecac6e8665",
            "filename": "django/contrib/comments/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcomments%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcomments%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n from django.contrib.contenttypes.models import ContentType\n from django.contrib.comments.models import Comment\n from django.utils.crypto import salted_hmac, constant_time_compare\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.text import get_text_list\n from django.utils import timezone\n from django.utils.translation import ungettext, ugettext, ugettext_lazy as _\n@@ -133,7 +133,7 @@ def get_comment_create_data(self):\n         \"\"\"\n         return dict(\n             content_type = ContentType.objects.get_for_model(self.target_object),\n-            object_pk    = force_unicode(self.target_object._get_pk_val()),\n+            object_pk    = force_text(self.target_object._get_pk_val()),\n             user_name    = self.cleaned_data[\"name\"],\n             user_email   = self.cleaned_data[\"email\"],\n             user_url     = self.cleaned_data[\"url\"],"
        },
        {
            "sha": "bc0fc5f332af258397c5470ca87c3b4258137a08",
            "filename": "django/contrib/comments/managers.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcomments%2Fmanagers.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcomments%2Fmanagers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Fmanagers.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,6 +1,6 @@\n from django.db import models\n from django.contrib.contenttypes.models import ContentType\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n class CommentManager(models.Manager):\n \n@@ -18,5 +18,5 @@ def for_model(self, model):\n         ct = ContentType.objects.get_for_model(model)\n         qs = self.get_query_set().filter(content_type=ct)\n         if isinstance(model, models.Model):\n-            qs = qs.filter(object_pk=force_unicode(model._get_pk_val()))\n+            qs = qs.filter(object_pk=force_text(model._get_pk_val()))\n         return qs"
        },
        {
            "sha": "4d4eb2322f7662093a7f644682cebe47ddd509f6",
            "filename": "django/contrib/comments/templatetags/comments.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcomments%2Ftemplatetags%2Fcomments.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcomments%2Ftemplatetags%2Fcomments.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcomments%2Ftemplatetags%2Fcomments.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n from django.conf import settings\n from django.contrib.contenttypes.models import ContentType\n from django.contrib import comments\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n register = template.Library()\n \n@@ -75,7 +75,7 @@ def get_query_set(self, context):\n \n         qs = self.comment_model.objects.filter(\n             content_type = ctype,\n-            object_pk    = smart_unicode(object_pk),\n+            object_pk    = smart_text(object_pk),\n             site__pk     = settings.SITE_ID,\n         )\n "
        },
        {
            "sha": "29e93eefe7a73ed9e777f80cc0624f3b7699580b",
            "filename": "django/contrib/contenttypes/generic.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcontenttypes%2Fgeneric.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcontenttypes%2Fgeneric.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fgeneric.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -17,7 +17,7 @@\n from django.forms.models import BaseModelFormSet, modelformset_factory, save_instance\n from django.contrib.admin.options import InlineModelAdmin, flatten_fieldsets\n from django.contrib.contenttypes.models import ContentType\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n class GenericForeignKey(object):\n     \"\"\"\n@@ -169,7 +169,7 @@ def get_choices_default(self):\n \n     def value_to_string(self, obj):\n         qs = getattr(obj, self.name).all()\n-        return smart_unicode([instance._get_pk_val() for instance in qs])\n+        return smart_text([instance._get_pk_val() for instance in qs])\n \n     def m2m_db_table(self):\n         return self.rel.to._meta.db_table"
        },
        {
            "sha": "9f287d494bf91961bc21957ab98744d97a5c19e5",
            "filename": "django/contrib/contenttypes/management.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcontenttypes%2Fmanagement.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcontenttypes%2Fmanagement.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmanagement.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,6 +1,8 @@\n from django.contrib.contenttypes.models import ContentType\n from django.db.models import get_apps, get_models, signals\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n+from django.utils import six\n+from django.utils.six.moves import input\n \n def update_contenttypes(app, created_models, verbosity=2, **kwargs):\n     \"\"\"\n@@ -24,17 +26,17 @@ def update_contenttypes(app, created_models, verbosity=2, **kwargs):\n     )\n     to_remove = [\n         ct\n-        for (model_name, ct) in content_types.iteritems()\n+        for (model_name, ct) in six.iteritems(content_types)\n         if model_name not in app_models\n     ]\n \n     cts = ContentType.objects.bulk_create([\n         ContentType(\n-            name=smart_unicode(model._meta.verbose_name_raw),\n+            name=smart_text(model._meta.verbose_name_raw),\n             app_label=app_label,\n             model=model_name,\n         )\n-        for (model_name, model) in app_models.iteritems()\n+        for (model_name, model) in six.iteritems(app_models)\n         if model_name not in content_types\n     ])\n     if verbosity >= 2:\n@@ -48,7 +50,7 @@ def update_contenttypes(app, created_models, verbosity=2, **kwargs):\n                 '    %s | %s' % (ct.app_label, ct.model)\n                 for ct in to_remove\n             ])\n-            ok_to_delete = raw_input(\"\"\"The following content types are stale and need to be deleted:\n+            ok_to_delete = input(\"\"\"The following content types are stale and need to be deleted:\n \n %s\n "
        },
        {
            "sha": "e6d547a4910bf36487edd1584af2c0716d8c7713",
            "filename": "django/contrib/contenttypes/models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fcontenttypes%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fcontenttypes%2Fmodels.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,6 +1,6 @@\n from django.db import models\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode, force_unicode\n+from django.utils.encoding import smart_text, force_text\n \n class ContentTypeManager(models.Manager):\n \n@@ -37,13 +37,13 @@ def get_for_model(self, model, for_concrete_model=True):\n         try:\n             ct = self._get_from_cache(opts)\n         except KeyError:\n-            # Load or create the ContentType entry. The smart_unicode() is\n+            # Load or create the ContentType entry. The smart_text() is\n             # needed around opts.verbose_name_raw because name_raw might be a\n             # django.utils.functional.__proxy__ object.\n             ct, created = self.get_or_create(\n                 app_label = opts.app_label,\n                 model = opts.object_name.lower(),\n-                defaults = {'name': smart_unicode(opts.verbose_name_raw)},\n+                defaults = {'name': smart_text(opts.verbose_name_raw)},\n             )\n             self._add_to_cache(self.db, ct)\n \n@@ -86,7 +86,7 @@ def get_for_models(self, *models, **kwargs):\n             ct = self.create(\n                 app_label=opts.app_label,\n                 model=opts.object_name.lower(),\n-                name=smart_unicode(opts.verbose_name_raw),\n+                name=smart_text(opts.verbose_name_raw),\n             )\n             self._add_to_cache(self.db, ct)\n             results[ct.model_class()] = ct\n@@ -147,7 +147,7 @@ def __unicode__(self):\n         if not model or self.name != model._meta.verbose_name_raw:\n             return self.name\n         else:\n-            return force_unicode(model._meta.verbose_name)\n+            return force_text(model._meta.verbose_name)\n \n     def model_class(self):\n         \"Returns the Python model class for this type of content.\""
        },
        {
            "sha": "810e039894625dab6aaf19a5eda6a1c644a7da61",
            "filename": "django/contrib/databrowse/datastructures.py",
            "status": "modified",
            "additions": 11,
            "deletions": 13,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fdatastructures.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,7 +7,7 @@\n from django.db import models\n from django.utils import formats\n from django.utils.text import capfirst\n-from django.utils.encoding import smart_unicode, smart_str, iri_to_uri\n+from django.utils.encoding import smart_text, smart_bytes, iri_to_uri\n from django.db.models.query import QuerySet\n \n EMPTY_VALUE = '(None)'\n@@ -17,12 +17,12 @@ class EasyModel(object):\n     def __init__(self, site, model):\n         self.site = site\n         self.model = model\n-        self.model_list = site.registry.keys()\n+        self.model_list = list(site.registry.keys())\n         self.verbose_name = model._meta.verbose_name\n         self.verbose_name_plural = model._meta.verbose_name_plural\n \n     def __repr__(self):\n-        return '<EasyModel for %s>' % smart_str(self.model._meta.object_name)\n+        return '<EasyModel for %s>' % smart_bytes(self.model._meta.object_name)\n \n     def model_databrowse(self):\n         \"Returns the ModelDatabrowse class for this model.\"\n@@ -61,7 +61,7 @@ def __init__(self, easy_model, field):\n         self.model, self.field = easy_model, field\n \n     def __repr__(self):\n-        return smart_str('<EasyField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n+        return smart_bytes('<EasyField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def choices(self):\n         for value, label in self.field.choices:\n@@ -79,7 +79,7 @@ def __init__(self, easy_model, field, value, label):\n         self.value, self.label = value, label\n \n     def __repr__(self):\n-        return smart_str('<EasyChoice for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n+        return smart_bytes('<EasyChoice for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def url(self):\n         return '%s%s/%s/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.field.name, iri_to_uri(self.value))\n@@ -89,10 +89,10 @@ def __init__(self, easy_model, instance):\n         self.model, self.instance = easy_model, instance\n \n     def __repr__(self):\n-        return smart_str('<EasyInstance for %s (%s)>' % (self.model.model._meta.object_name, self.instance._get_pk_val()))\n+        return smart_bytes('<EasyInstance for %s (%s)>' % (self.model.model._meta.object_name, self.instance._get_pk_val()))\n \n     def __unicode__(self):\n-        val = smart_unicode(self.instance)\n+        val = smart_text(self.instance)\n         if len(val) > DISPLAY_SIZE:\n             return val[:DISPLAY_SIZE] + '...'\n         return val\n@@ -136,7 +136,7 @@ def __init__(self, easy_model, instance, field):\n         self.raw_value = getattr(instance.instance, field.name)\n \n     def __repr__(self):\n-        return smart_str('<EasyInstanceField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n+        return smart_bytes('<EasyInstanceField for %s.%s>' % (self.model.model._meta.object_name, self.field.name))\n \n     def values(self):\n         \"\"\"\n@@ -176,8 +176,6 @@ def urls(self):\n         for plugin_name, plugin in self.model.model_databrowse().plugins.items():\n             urls = plugin.urls(plugin_name, self)\n             if urls is not None:\n-                #plugin_urls.append(urls)\n-                values = self.values()\n                 return zip(self.values(), urls)\n         if self.field.rel:\n             m = EasyModel(self.model.site, self.field.rel.to)\n@@ -187,7 +185,7 @@ def urls(self):\n                     if value is None:\n                         continue\n                     url = '%s%s/%s/objects/%s/' % (self.model.site.root_url, m.model._meta.app_label, m.model._meta.module_name, iri_to_uri(value._get_pk_val()))\n-                    lst.append((smart_unicode(value), url))\n+                    lst.append((smart_text(value), url))\n             else:\n                 lst = [(value, None) for value in self.values()]\n         elif self.field.choices:\n@@ -196,10 +194,10 @@ def urls(self):\n                 url = '%s%s/%s/fields/%s/%s/' % (self.model.site.root_url, self.model.model._meta.app_label, self.model.model._meta.module_name, self.field.name, iri_to_uri(self.raw_value))\n                 lst.append((value, url))\n         elif isinstance(self.field, models.URLField):\n-            val = self.values()[0]\n+            val = list(self.values())[0]\n             lst = [(val, iri_to_uri(val))]\n         else:\n-            lst = [(self.values()[0], None)]\n+            lst = [(list(self.values())[0], None)]\n         return lst\n \n class EasyQuerySet(QuerySet):"
        },
        {
            "sha": "a548c33c8fba35fb2b9777d917ba0cc7c8647916",
            "filename": "django/contrib/databrowse/plugins/calendars.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Fcalendars.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,7 +7,7 @@\n from django.shortcuts import render_to_response\n from django.utils.html import format_html, format_html_join\n from django.utils.text import capfirst\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.views.generic import dates\n from django.utils import datetime_safe\n \n@@ -66,7 +66,7 @@ def model_index_html(self, request, model, site):\n             return ''\n         return format_html('<p class=\"filter\"><strong>View calendar by:</strong> {0}</p>',\n                            format_html_join(', ', '<a href=\"calendars/{0}/\">{1}</a>',\n-                                            ((f.name, force_unicode(capfirst(f.verbose_name))) for f in fields.values())))\n+                                            ((f.name, force_text(capfirst(f.verbose_name))) for f in fields.values())))\n \n     def urls(self, plugin_name, easy_instance_field):\n         if isinstance(easy_instance_field.field, models.DateField):\n@@ -96,7 +96,7 @@ def model_view(self, request, model_databrowse, url):\n \n     def homepage_view(self, request):\n         easy_model = EasyModel(self.site, self.model)\n-        field_list = self.fields.values()\n+        field_list = list(self.fields.values())\n         field_list.sort(key=lambda k:k.verbose_name)\n         return render_to_response('databrowse/calendar_homepage.html', {\n                 'root_url': self.site.root_url,"
        },
        {
            "sha": "dc5e9aef14b466124dfd8ae9cb3e69c32ad33480",
            "filename": "django/contrib/databrowse/plugins/fieldchoices.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fdatabrowse%2Fplugins%2Ffieldchoices.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.utils.html import format_html, format_html_join\n from django.utils.http import urlquote\n from django.utils.text import capfirst\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n \n class FieldChoicePlugin(DatabrowsePlugin):\n@@ -35,7 +35,7 @@ def model_index_html(self, request, model, site):\n             return ''\n         return format_html('<p class=\"filter\"><strong>View by:</strong> {0}</p>',\n                            format_html_join(', ', '<a href=\"fields/{0}/\">{1}</a>',\n-                                            ((f.name, force_unicode(capfirst(f.verbose_name))) for f in fields.values())))\n+                                            ((f.name, force_text(capfirst(f.verbose_name))) for f in fields.values())))\n \n     def urls(self, plugin_name, easy_instance_field):\n         if easy_instance_field.field in self.field_dict(easy_instance_field.model.model).values():\n@@ -63,7 +63,7 @@ def model_view(self, request, model_databrowse, url):\n \n     def homepage_view(self, request):\n         easy_model = EasyModel(self.site, self.model)\n-        field_list = self.fields.values()\n+        field_list = list(self.fields.values())\n         field_list.sort(key=lambda k: k.verbose_name)\n         return render_to_response('databrowse/fieldchoice_homepage.html', {'root_url': self.site.root_url, 'model': easy_model, 'field_list': field_list})\n "
        },
        {
            "sha": "ee93479cbd73c0cf8413b5bc7f76e1e644359c34",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -317,7 +317,7 @@ def test_14498(self):\n \n         class WizardWithProcessStep(TestWizardClass):\n             def process_step(self, request, form, step):\n-                that.assertTrue(hasattr(form, 'cleaned_data'))\n+                that.assertTrue(form.is_valid())\n                 reached[0] = True\n \n         wizard = WizardWithProcessStep([WizardPageOneForm,"
        },
        {
            "sha": "05c9f6f121b72b00152b0048c75cba215a5efa79",
            "filename": "django/contrib/formtools/wizard/storage/base.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fstorage%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,7 +1,8 @@\n from django.core.files.uploadedfile import UploadedFile\n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils.functional import lazy_property\n+from django.utils import six\n \n from django.contrib.formtools.wizard.storage.exceptions import NoFileStorageConfigured\n \n@@ -72,9 +73,9 @@ def get_step_files(self, step):\n             raise NoFileStorageConfigured\n \n         files = {}\n-        for field, field_dict in wizard_files.iteritems():\n-            field_dict = dict((smart_str(k), v)\n-                              for k, v in field_dict.iteritems())\n+        for field, field_dict in six.iteritems(wizard_files):\n+            field_dict = dict((smart_bytes(k), v)\n+                              for k, v in six.iteritems(field_dict))\n             tmp_name = field_dict.pop('tmp_name')\n             files[field] = UploadedFile(\n                 file=self.file_storage.open(tmp_name), **field_dict)\n@@ -87,7 +88,7 @@ def set_step_files(self, step, files):\n         if step not in self.data[self.step_files_key]:\n             self.data[self.step_files_key][step] = {}\n \n-        for field, field_file in (files or {}).iteritems():\n+        for field, field_file in six.iteritems(files or {}):\n             tmp_filename = self.file_storage.save(field_file.name, field_file)\n             file_dict = {\n                 'tmp_name': tmp_filename,"
        },
        {
            "sha": "ea41e86852b0982a89fe71b058ee5e5c524e61a0",
            "filename": "django/contrib/formtools/wizard/views.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Fwizard%2Fviews.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -44,7 +44,7 @@ def __repr__(self):\n     @property\n     def all(self):\n         \"Returns the names of all steps/forms.\"\n-        return self._wizard.get_form_list().keys()\n+        return list(self._wizard.get_form_list())\n \n     @property\n     def count(self):\n@@ -164,14 +164,14 @@ def get_initkwargs(cls, form_list, initial_dict=None,\n                 init_form_list[six.text_type(i)] = form\n \n         # walk through the new created list of forms\n-        for form in init_form_list.itervalues():\n+        for form in six.itervalues(init_form_list):\n             if issubclass(form, formsets.BaseFormSet):\n                 # if the element is based on BaseFormSet (FormSet/ModelFormSet)\n                 # we need to override the form variable.\n                 form = form.form\n             # check if any form contains a FileField, if yes, we need a\n             # file_storage added to the wizardview (by subclassing).\n-            for field in form.base_fields.itervalues():\n+            for field in six.itervalues(form.base_fields):\n                 if (isinstance(field, forms.FileField) and\n                         not hasattr(cls, 'file_storage')):\n                     raise NoFileStorageConfigured\n@@ -196,7 +196,7 @@ def get_form_list(self):\n         could use data from other (maybe previous forms).\n         \"\"\"\n         form_list = SortedDict()\n-        for form_key, form_class in self.form_list.iteritems():\n+        for form_key, form_class in six.iteritems(self.form_list):\n             # try to fetch the value from condition list, by default, the form\n             # gets passed to the new list.\n             condition = self.condition_dict.get(form_key, True)"
        },
        {
            "sha": "7152f4682d41c3fd0fd2d08de7a5dd22ee05d4a9",
            "filename": "django/contrib/gis/db/backends/mysql/operations.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fmysql%2Foperations.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,6 +3,8 @@\n from django.contrib.gis.db.backends.adapter import WKTAdapter\n from django.contrib.gis.db.backends.base import BaseSpatialOperations\n \n+from django.utils import six\n+\n class MySQLOperations(DatabaseOperations, BaseSpatialOperations):\n \n     compiler_module = 'django.contrib.gis.db.backends.mysql.compiler'\n@@ -30,7 +32,7 @@ class MySQLOperations(DatabaseOperations, BaseSpatialOperations):\n         'within' : 'MBRWithin',\n         }\n \n-    gis_terms = dict([(term, None) for term in geometry_functions.keys() + ['isnull']])\n+    gis_terms = dict([(term, None) for term in list(geometry_functions) + ['isnull']])\n \n     def geo_db_type(self, f):\n         return f.geom_type"
        },
        {
            "sha": "392feb129beb19398f80143cf277773d0bab553d",
            "filename": "django/contrib/gis/db/backends/oracle/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Foracle%2Foperations.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -128,7 +128,7 @@ class OracleOperations(DatabaseOperations, BaseSpatialOperations):\n     geometry_functions.update(distance_functions)\n \n     gis_terms = ['isnull']\n-    gis_terms += geometry_functions.keys()\n+    gis_terms += list(geometry_functions)\n     gis_terms = dict([(term, None) for term in gis_terms])\n \n     truncate_params = {'relate' : None}"
        },
        {
            "sha": "434d8719cccfb4883882c01050487d2f494d2f9c",
            "filename": "django/contrib/gis/db/backends/postgis/operations.py",
            "status": "modified",
            "additions": 11,
            "deletions": 30,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fpostgis%2Foperations.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -163,7 +163,9 @@ def __init__(self, connection):\n             'contains' : PostGISFunction(prefix, 'Contains'),\n             'intersects' : PostGISFunction(prefix, 'Intersects'),\n             'relate' : (PostGISRelate, six.string_types),\n-            }\n+            'coveredby' : PostGISFunction(prefix, 'CoveredBy'),\n+            'covers' : PostGISFunction(prefix, 'Covers'),\n+        }\n \n         # Valid distance types and substitutions\n         dtypes = (Decimal, Distance, float) + six.integer_types\n@@ -178,33 +180,12 @@ def get_dist_ops(operator):\n             'distance_gte' : (get_dist_ops('>='), dtypes),\n             'distance_lt' : (get_dist_ops('<'), dtypes),\n             'distance_lte' : (get_dist_ops('<='), dtypes),\n-            }\n-\n-        # Versions 1.2.2+ have KML serialization support.\n-        if version < (1, 2, 2):\n-            ASKML = False\n-        else:\n-            ASKML = 'ST_AsKML'\n-            self.geometry_functions.update(\n-                {'coveredby' : PostGISFunction(prefix, 'CoveredBy'),\n-                 'covers' : PostGISFunction(prefix, 'Covers'),\n-                 })\n-            self.distance_functions['dwithin'] = (PostGISFunctionParam(prefix, 'DWithin'), dtypes)\n+            'dwithin' : (PostGISFunctionParam(prefix, 'DWithin'), dtypes)\n+        }\n \n         # Adding the distance functions to the geometries lookup.\n         self.geometry_functions.update(self.distance_functions)\n \n-        # The union aggregate and topology operation use the same signature\n-        # in versions 1.3+.\n-        if version < (1, 3, 0):\n-            UNIONAGG = 'GeomUnion'\n-            UNION = 'Union'\n-            MAKELINE = False\n-        else:\n-            UNIONAGG = 'ST_Union'\n-            UNION = 'ST_Union'\n-            MAKELINE = 'ST_MakeLine'\n-\n         # Only PostGIS versions 1.3.4+ have GeoJSON serialization support.\n         if version < (1, 3, 4):\n             GEOJSON = False\n@@ -236,8 +217,8 @@ def get_dist_ops(operator):\n \n         # Creating a dictionary lookup of all GIS terms for PostGIS.\n         gis_terms = ['isnull']\n-        gis_terms += self.geometry_operators.keys()\n-        gis_terms += self.geometry_functions.keys()\n+        gis_terms += list(self.geometry_operators)\n+        gis_terms += list(self.geometry_functions)\n         self.gis_terms = dict([(term, None) for term in gis_terms])\n \n         self.area = prefix + 'Area'\n@@ -256,11 +237,11 @@ def get_dist_ops(operator):\n         self.geojson = GEOJSON\n         self.gml = prefix + 'AsGML'\n         self.intersection = prefix + 'Intersection'\n-        self.kml = ASKML\n+        self.kml = prefix + 'AsKML'\n         self.length = prefix + 'Length'\n         self.length3d = prefix + 'Length3D'\n         self.length_spheroid = prefix + 'length_spheroid'\n-        self.makeline = MAKELINE\n+        self.makeline = prefix + 'MakeLine'\n         self.mem_size = prefix + 'mem_size'\n         self.num_geom = prefix + 'NumGeometries'\n         self.num_points =prefix + 'npoints'\n@@ -275,8 +256,8 @@ def get_dist_ops(operator):\n         self.sym_difference = prefix + 'SymDifference'\n         self.transform = prefix + 'Transform'\n         self.translate = prefix + 'Translate'\n-        self.union = UNION\n-        self.unionagg = UNIONAGG\n+        self.union = prefix + 'Union'\n+        self.unionagg = prefix + 'Union'\n \n     def check_aggregate_support(self, aggregate):\n         \"\"\""
        },
        {
            "sha": "d0a5f820332aeae7f419b0a51003e6e190577c9b",
            "filename": "django/contrib/gis/db/backends/spatialite/creation.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Fcreation.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -99,14 +99,14 @@ def load_spatialite_sql(self):\n         \"\"\"\n         This routine loads up the SpatiaLite SQL file.\n         \"\"\"\n-        if self.connection.ops.spatial_version[:2] >= (3, 0):\n-            # Spatialite >= 3.0.x -- No need to load any SQL file, calling\n+        if self.connection.ops.spatial_version[:2] >= (2, 4):\n+            # Spatialite >= 2.4 -- No need to load any SQL file, calling\n             # InitSpatialMetaData() transparently creates the spatial metadata\n             # tables\n             cur = self.connection._cursor()\n             cur.execute(\"SELECT InitSpatialMetaData()\")\n         else:\n-            # Spatialite < 3.0.x -- Load the initial SQL\n+            # Spatialite < 2.4 -- Load the initial SQL\n \n             # Getting the location of the SpatiaLite SQL file, and confirming\n             # it exists."
        },
        {
            "sha": "60fe0a806969e18301819701c83e3e5fbb2cae05",
            "filename": "django/contrib/gis/db/backends/spatialite/operations.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fbackends%2Fspatialite%2Foperations.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -131,7 +131,7 @@ def __init__(self, connection):\n \n         # Creating the GIS terms dictionary.\n         gis_terms = ['isnull']\n-        gis_terms += self.geometry_functions.keys()\n+        gis_terms += list(self.geometry_functions)\n         self.gis_terms = dict([(term, None) for term in gis_terms])\n \n         if version >= (2, 4, 0):"
        },
        {
            "sha": "cc61dfa4d2fec9acd5dab86cbc8050890ac9a387",
            "filename": "django/contrib/gis/db/models/query.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fquery.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,5 +1,6 @@\n from django.db import connections\n from django.db.models.query import QuerySet, ValuesQuerySet, ValuesListQuerySet\n+from django.utils import six\n \n from django.contrib.gis.db.models import aggregates\n from django.contrib.gis.db.models.fields import get_srid_info, PointField, LineStringField\n@@ -25,7 +26,7 @@ def values_list(self, *fields, **kwargs):\n         flat = kwargs.pop('flat', False)\n         if kwargs:\n             raise TypeError('Unexpected keyword arguments to values_list: %s'\n-                    % (kwargs.keys(),))\n+                    % (list(kwargs),))\n         if flat and len(fields) > 1:\n             raise TypeError(\"'flat' is not valid when values_list is called with more than one field.\")\n         return self._clone(klass=GeoValuesListQuerySet, setup=True, flat=flat,\n@@ -531,7 +532,7 @@ def _spatial_attribute(self, att, settings, field_name=None, model_att=None):\n         if settings.get('setup', True):\n             default_args, geo_field = self._spatial_setup(att, desc=settings['desc'], field_name=field_name,\n                                                           geo_field_type=settings.get('geo_field_type', None))\n-            for k, v in default_args.iteritems(): settings['procedure_args'].setdefault(k, v)\n+            for k, v in six.iteritems(default_args): settings['procedure_args'].setdefault(k, v)\n         else:\n             geo_field = settings['geo_field']\n "
        },
        {
            "sha": "5c8d2647f7f5dcd3dbe45a382a5cbfc7ed260dfa",
            "filename": "django/contrib/gis/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,6 +3,7 @@\n from django.db.backends.util import truncate_name, typecast_timestamp\n from django.db.models.sql import compiler\n from django.db.models.sql.constants import MULTI\n+from django.utils import six\n \n SQLCompiler = compiler.SQLCompiler\n \n@@ -24,7 +25,7 @@ def get_columns(self, with_aliases=False):\n         qn = self.quote_name_unless_alias\n         qn2 = self.connection.ops.quote_name\n         result = ['(%s) AS %s' % (self.get_extra_select_format(alias) % col[0], qn2(alias))\n-                  for alias, col in self.query.extra_select.iteritems()]\n+                  for alias, col in six.iteritems(self.query.extra_select)]\n         aliases = set(self.query.extra_select.keys())\n         if with_aliases:\n             col_aliases = aliases.copy()\n@@ -170,7 +171,7 @@ def resolve_columns(self, row, fields=()):\n         objects.\n         \"\"\"\n         values = []\n-        aliases = self.query.extra_select.keys()\n+        aliases = list(self.query.extra_select)\n \n         # Have to set a starting row number offset that is used for\n         # determining the correct starting row index -- needed for"
        },
        {
            "sha": "373ece777d52494a24224f7adca4f437e120dace",
            "filename": "django/contrib/gis/gdal/geometries.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgdal%2Fgeometries.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -40,7 +40,7 @@\n \"\"\"\n # Python library requisites.\n import sys\n-from binascii import a2b_hex\n+from binascii import a2b_hex, b2a_hex\n from ctypes import byref, string_at, c_char_p, c_double, c_ubyte, c_void_p\n \n # Getting GDAL prerequisites\n@@ -322,8 +322,7 @@ def gml(self):\n     @property\n     def hex(self):\n         \"Returns the hexadecimal representation of the WKB (a string).\"\n-        return str(self.wkb).encode('hex').upper()\n-        #return b2a_hex(self.wkb).upper()\n+        return b2a_hex(self.wkb).upper()\n \n     @property\n     def json(self):"
        },
        {
            "sha": "505f0e4f4b4ec283a043637763d45e38de463655",
            "filename": "django/contrib/gis/geometry/test_data.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fgeometry%2Ftest_data.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,6 +7,7 @@\n import os\n \n from django.contrib import gis\n+from django.utils import six\n \n \n # This global used to store reference geometry data.\n@@ -25,7 +26,7 @@ def tuplize(seq):\n \n def strconvert(d):\n     \"Converts all keys in dictionary to str type.\"\n-    return dict([(str(k), v) for k, v in d.iteritems()])\n+    return dict([(str(k), v) for k, v in six.iteritems(d)])\n \n \n def get_ds_file(name, ext):"
        },
        {
            "sha": "6e074be355bcb539717d0a71c3817d7f385c7bc5",
            "filename": "django/contrib/gis/measure.py",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fmeasure.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fmeasure.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -143,24 +143,27 @@ def __imul__(self, other):\n     def __rmul__(self, other):\n         return self * other\n \n-    def __div__(self, other):\n+    def __truediv__(self, other):\n         if isinstance(other, self.__class__):\n             return self.standard / other.standard\n         if isinstance(other, NUMERIC_TYPES):\n             return self.__class__(default_unit=self._default_unit,\n                 **{self.STANDARD_UNIT: (self.standard / other)})\n         else:\n             raise TypeError('%(class)s must be divided with number or %(class)s' % {\"class\":pretty_name(self)})\n+    __div__ = __truediv__ # Python 2 compatibility\n \n-    def __idiv__(self, other):\n+    def __itruediv__(self, other):\n         if isinstance(other, NUMERIC_TYPES):\n             self.standard /= float(other)\n             return self\n         else:\n             raise TypeError('%(class)s must be divided with number' % {\"class\":pretty_name(self)})\n+    __idiv__ = __itruediv__ # Python 2 compatibility\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         return bool(self.standard)\n+    __nonzero__ = __bool__ # Python 2 compatibility\n \n     def default_units(self, kwargs):\n         \"\"\"\n@@ -169,7 +172,7 @@ def default_units(self, kwargs):\n         \"\"\"\n         val = 0.0\n         default_unit = self.STANDARD_UNIT\n-        for unit, value in kwargs.iteritems():\n+        for unit, value in six.iteritems(kwargs):\n             if not isinstance(value, float): value = float(value)\n             if unit in self.UNITS:\n                 val += self.UNITS[unit] * value\n@@ -305,12 +308,13 @@ class Area(MeasureBase):\n     ALIAS = dict([(k, '%s%s' % (AREA_PREFIX, v)) for k, v in Distance.ALIAS.items()])\n     LALIAS = dict([(k.lower(), v) for k, v in ALIAS.items()])\n \n-    def __div__(self, other):\n+    def __truediv__(self, other):\n         if isinstance(other, NUMERIC_TYPES):\n             return self.__class__(default_unit=self._default_unit,\n                 **{self.STANDARD_UNIT: (self.standard / other)})\n         else:\n             raise TypeError('%(class)s must be divided by a number' % {\"class\":pretty_name(self)})\n+    __div__ = __truediv__ # Python 2 compatibility\n \n \n # Shortcuts"
        },
        {
            "sha": "8bcdba1b44d3dfad8872f658258067e7ced33697",
            "filename": "django/contrib/gis/sitemaps/views.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fsitemaps%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Fsitemaps%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Fsitemaps%2Fviews.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,8 @@\n from django.contrib.gis.db.models.fields import GeometryField\n from django.db import connections, DEFAULT_DB_ALIAS\n from django.db.models import get_model\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n+from django.utils import six\n from django.utils.translation import ugettext as _\n \n from django.contrib.gis.shortcuts import render_to_kml, render_to_kmz\n@@ -46,7 +47,7 @@ def sitemap(request, sitemaps, section=None):\n             raise Http404(_(\"No sitemap available for section: %r\") % section)\n         maps.append(sitemaps[section])\n     else:\n-        maps = sitemaps.values()\n+        maps = list(six.itervalues(sitemaps))\n \n     page = request.GET.get(\"p\", 1)\n     current_site = get_current_site(request)\n@@ -60,7 +61,7 @@ def sitemap(request, sitemaps, section=None):\n             raise Http404(_(\"Page %s empty\") % page)\n         except PageNotAnInteger:\n             raise Http404(_(\"No page '%s'\") % page)\n-    xml = smart_str(loader.render_to_string('gis/sitemaps/geo_sitemap.xml', {'urlset': urls}))\n+    xml = smart_bytes(loader.render_to_string('gis/sitemaps/geo_sitemap.xml', {'urlset': urls}))\n     return HttpResponse(xml, content_type='application/xml')\n \n def kml(request, label, model, field_name=None, compress=False, using=DEFAULT_DB_ALIAS):"
        },
        {
            "sha": "fffd7d3cab3bf063c54787c0ab4ce72d3a82facb",
            "filename": "django/contrib/gis/tests/geoapp/test_regress.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftest_regress.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n \n class GeoRegressionTests(TestCase):\n \n-    def test01_update(self):\n+    def test_update(self):\n         \"Testing GeoQuerySet.update(). See #10411.\"\n         pnt = City.objects.get(name='Pueblo').point\n         bak = pnt.clone()\n@@ -24,7 +24,7 @@ def test01_update(self):\n         City.objects.filter(name='Pueblo').update(point=bak)\n         self.assertEqual(bak, City.objects.get(name='Pueblo').point)\n \n-    def test02_kmz(self):\n+    def test_kmz(self):\n         \"Testing `render_to_kmz` with non-ASCII data. See #11624.\"\n         name = '\\xc3\\x85land Islands'.decode('iso-8859-1')\n         places = [{'name' : name,\n@@ -35,22 +35,22 @@ def test02_kmz(self):\n \n     @no_spatialite\n     @no_mysql\n-    def test03_extent(self):\n+    def test_extent(self):\n         \"Testing `extent` on a table with a single point. See #11827.\"\n         pnt = City.objects.get(name='Pueblo').point\n         ref_ext = (pnt.x, pnt.y, pnt.x, pnt.y)\n         extent = City.objects.filter(name='Pueblo').extent()\n         for ref_val, val in zip(ref_ext, extent):\n             self.assertAlmostEqual(ref_val, val, 4)\n \n-    def test04_unicode_date(self):\n+    def test_unicode_date(self):\n         \"Testing dates are converted properly, even on SpatiaLite. See #16408.\"\n         founded = datetime(1857, 5, 23)\n         mansfield = PennsylvaniaCity.objects.create(name='Mansfield', county='Tioga', point='POINT(-77.071445 41.823881)',\n                                                     founded=founded)\n         self.assertEqual(founded, PennsylvaniaCity.objects.dates('founded', 'day')[0])\n \n-    def test05_empty_count(self):\n+    def test_empty_count(self):\n          \"Testing that PostGISAdapter.__eq__ does check empty strings. See #13670.\"\n          # contrived example, but need a geo lookup paired with an id__in lookup\n          pueblo = City.objects.get(name='Pueblo')\n@@ -60,12 +60,12 @@ def test05_empty_count(self):\n          # .count() should not throw TypeError in __eq__\n          self.assertEqual(cities_within_state.count(), 1)\n \n-    def test06_defer_or_only_with_annotate(self):\n+    def test_defer_or_only_with_annotate(self):\n         \"Regression for #16409. Make sure defer() and only() work with annotate()\"\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).defer('name')), list)\n         self.assertIsInstance(list(City.objects.annotate(Count('point')).only('name')), list)\n \n-    def test07_boolean_conversion(self):\n+    def test_boolean_conversion(self):\n         \"Testing Boolean value conversion with the spatial backend, see #15169.\"\n         t1 = Truth.objects.create(val=True)\n         t2 = Truth.objects.create(val=False)"
        },
        {
            "sha": "b06d6b5e1bb91098c5f9b1bd94bdf3eae5c490db",
            "filename": "django/contrib/gis/tests/geoapp/tests.py",
            "status": "modified",
            "additions": 404,
            "deletions": 397,
            "changes": 801,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fgis%2Ftests%2Fgeoapp%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -15,19 +15,24 @@\n \n from .models import Country, City, PennsylvaniaCity, State, Track\n \n+from .test_feeds import GeoFeedTest\n+from .test_regress import GeoRegressionTests\n+from .test_sitemaps import GeoSitemapTest\n+\n+\n if not spatialite:\n     from .models import Feature, MinusOneSRID\n \n class GeoModelTest(TestCase):\n \n-    def test01_fixtures(self):\n+    def test_fixtures(self):\n         \"Testing geographic model initialization from fixtures.\"\n         # Ensuring that data was loaded from initial data fixtures.\n         self.assertEqual(2, Country.objects.count())\n         self.assertEqual(8, City.objects.count())\n         self.assertEqual(2, State.objects.count())\n \n-    def test02_proxy(self):\n+    def test_proxy(self):\n         \"Testing Lazy-Geometry support (using the GeometryProxy).\"\n         ## Testing on a Point\n         pnt = Point(0, 0)\n@@ -95,165 +100,97 @@ def test02_proxy(self):\n         self.assertEqual(ply, State.objects.get(name='NullState').poly)\n         ns.delete()\n \n-    def test03a_kml(self):\n-        \"Testing KML output from the database using GeoQuerySet.kml().\"\n-        # Only PostGIS and Spatialite (>=2.4.0-RC4) support KML serialization\n-        if not (postgis or (spatialite and connection.ops.kml)):\n-            self.assertRaises(NotImplementedError, State.objects.all().kml, field_name='poly')\n-            return\n-\n-        # Should throw a TypeError when trying to obtain KML from a\n-        #  non-geometry field.\n-        qs = City.objects.all()\n-        self.assertRaises(TypeError, qs.kml, 'name')\n-\n-        # The reference KML depends on the version of PostGIS used\n-        # (the output stopped including altitude in 1.3.3).\n-        if connection.ops.spatial_version >= (1, 3, 3):\n-            ref_kml =  '<Point><coordinates>-104.609252,38.255001</coordinates></Point>'\n-        else:\n-            ref_kml = '<Point><coordinates>-104.609252,38.255001,0</coordinates></Point>'\n-\n-        # Ensuring the KML is as expected.\n-        ptown1 = City.objects.kml(field_name='point', precision=9).get(name='Pueblo')\n-        ptown2 = City.objects.kml(precision=9).get(name='Pueblo')\n-        for ptown in [ptown1, ptown2]:\n-            self.assertEqual(ref_kml, ptown.kml)\n-\n-    def test03b_gml(self):\n-        \"Testing GML output from the database using GeoQuerySet.gml().\"\n-        if mysql or (spatialite and not connection.ops.gml) :\n-            self.assertRaises(NotImplementedError, Country.objects.all().gml, field_name='mpoly')\n-            return\n-\n-        # Should throw a TypeError when tyring to obtain GML from a\n-        # non-geometry field.\n-        qs = City.objects.all()\n-        self.assertRaises(TypeError, qs.gml, field_name='name')\n-        ptown1 = City.objects.gml(field_name='point', precision=9).get(name='Pueblo')\n-        ptown2 = City.objects.gml(precision=9).get(name='Pueblo')\n+    @no_mysql\n+    def test_lookup_insert_transform(self):\n+        \"Testing automatic transform for lookups and inserts.\"\n+        # San Antonio in 'WGS84' (SRID 4326)\n+        sa_4326 = 'POINT (-98.493183 29.424170)'\n+        wgs_pnt = fromstr(sa_4326, srid=4326) # Our reference point in WGS84\n \n+        # Oracle doesn't have SRID 3084, using 41157.\n         if oracle:\n-            # No precision parameter for Oracle :-/\n-            gml_regex = re.compile(r'^<gml:Point srsName=\"SDO:4326\" xmlns:gml=\"http://www.opengis.net/gml\"><gml:coordinates decimal=\"\\.\" cs=\",\" ts=\" \">-104.60925\\d+,38.25500\\d+ </gml:coordinates></gml:Point>')\n-        elif spatialite:\n-            # Spatialite has extra colon in SrsName\n-            gml_regex = re.compile(r'^<gml:Point SrsName=\"EPSG::4326\"><gml:coordinates decimal=\"\\.\" cs=\",\" ts=\" \">-104.609251\\d+,38.255001</gml:coordinates></gml:Point>')\n+            # San Antonio in 'Texas 4205, Southern Zone (1983, meters)' (SRID 41157)\n+            # Used the following Oracle SQL to get this value:\n+            #  SELECT SDO_UTIL.TO_WKTGEOMETRY(SDO_CS.TRANSFORM(SDO_GEOMETRY('POINT (-98.493183 29.424170)', 4326), 41157)) FROM DUAL;\n+            nad_wkt  = 'POINT (300662.034646583 5416427.45974934)'\n+            nad_srid = 41157\n         else:\n-            gml_regex = re.compile(r'^<gml:Point srsName=\"EPSG:4326\"><gml:coordinates>-104\\.60925\\d+,38\\.255001</gml:coordinates></gml:Point>')\n-\n-        for ptown in [ptown1, ptown2]:\n-            self.assertTrue(gml_regex.match(ptown.gml))\n-\n-\n-    def test03c_geojson(self):\n-        \"Testing GeoJSON output from the database using GeoQuerySet.geojson().\"\n-        # Only PostGIS 1.3.4+ supports GeoJSON.\n-        if not connection.ops.geojson:\n-            self.assertRaises(NotImplementedError, Country.objects.all().geojson, field_name='mpoly')\n-            return\n+            # San Antonio in 'NAD83(HARN) / Texas Centric Lambert Conformal' (SRID 3084)\n+            nad_wkt = 'POINT (1645978.362408288754523 6276356.025927528738976)' # Used ogr.py in gdal 1.4.1 for this transform\n+            nad_srid = 3084\n \n-        if connection.ops.spatial_version >= (1, 4, 0):\n-            pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.609252,38.255001]}'\n-            houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"coordinates\":[-95.363151,29.763374]}'\n-            victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.305196,48.462611]}'\n-            chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n+        # Constructing & querying with a point from a different SRID. Oracle\n+        # `SDO_OVERLAPBDYINTERSECT` operates differently from\n+        # `ST_Intersects`, so contains is used instead.\n+        nad_pnt = fromstr(nad_wkt, srid=nad_srid)\n+        if oracle:\n+            tx = Country.objects.get(mpoly__contains=nad_pnt)\n         else:\n-            pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.60925200,38.25500100]}'\n-            houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"EPSG\",\"properties\":{\"EPSG\":4326}},\"coordinates\":[-95.36315100,29.76337400]}'\n-            victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.30519600,48.46261100]}'\n-            chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"EPSG\",\"properties\":{\"EPSG\":4326}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n+            tx = Country.objects.get(mpoly__intersects=nad_pnt)\n+        self.assertEqual('Texas', tx.name)\n \n-        # Precision argument should only be an integer\n-        self.assertRaises(TypeError, City.objects.geojson, precision='foo')\n+        # Creating San Antonio.  Remember the Alamo.\n+        sa = City.objects.create(name='San Antonio', point=nad_pnt)\n \n-        # Reference queries and values.\n-        # SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 0) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Pueblo';\n-        self.assertEqual(pueblo_json, City.objects.geojson().get(name='Pueblo').geojson)\n+        # Now verifying that San Antonio was transformed correctly\n+        sa = City.objects.get(name='San Antonio')\n+        self.assertAlmostEqual(wgs_pnt.x, sa.point.x, 6)\n+        self.assertAlmostEqual(wgs_pnt.y, sa.point.y, 6)\n \n-        # 1.3.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 1) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Houston';\n-        # 1.4.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 2) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Houston';\n-        # This time we want to include the CRS by using the `crs` keyword.\n-        self.assertEqual(houston_json, City.objects.geojson(crs=True, model_att='json').get(name='Houston').json)\n+        # If the GeometryField SRID is -1, then we shouldn't perform any\n+        # transformation if the SRID of the input geometry is different.\n+        # SpatiaLite does not support missing SRID values.\n+        if not spatialite:\n+            m1 = MinusOneSRID(geom=Point(17, 23, srid=4326))\n+            m1.save()\n+            self.assertEqual(-1, m1.geom.srid)\n \n-        # 1.3.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 2) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Victoria';\n-        # 1.4.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 1) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Houston';\n-        # This time we include the bounding box by using the `bbox` keyword.\n-        self.assertEqual(victoria_json, City.objects.geojson(bbox=True).get(name='Victoria').geojson)\n+    def test_createnull(self):\n+        \"Testing creating a model instance and the geometry being None\"\n+        c = City()\n+        self.assertEqual(c.point, None)\n \n-        # 1.(3|4).x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 5, 3) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Chicago';\n-        # Finally, we set every available keyword.\n-        self.assertEqual(chicago_json, City.objects.geojson(bbox=True, crs=True, precision=5).get(name='Chicago').geojson)\n+    @no_spatialite # SpatiaLite does not support abstract geometry columns\n+    def test_geometryfield(self):\n+        \"Testing the general GeometryField.\"\n+        Feature(name='Point', geom=Point(1, 1)).save()\n+        Feature(name='LineString', geom=LineString((0, 0), (1, 1), (5, 5))).save()\n+        Feature(name='Polygon', geom=Polygon(LinearRing((0, 0), (0, 5), (5, 5), (5, 0), (0, 0)))).save()\n+        Feature(name='GeometryCollection',\n+                geom=GeometryCollection(Point(2, 2), LineString((0, 0), (2, 2)),\n+                                        Polygon(LinearRing((0, 0), (0, 5), (5, 5), (5, 0), (0, 0))))).save()\n \n-    def test03d_svg(self):\n-        \"Testing SVG output using GeoQuerySet.svg().\"\n-        if mysql or oracle:\n-            self.assertRaises(NotImplementedError, City.objects.svg)\n-            return\n+        f_1 = Feature.objects.get(name='Point')\n+        self.assertEqual(True, isinstance(f_1.geom, Point))\n+        self.assertEqual((1.0, 1.0), f_1.geom.tuple)\n+        f_2 = Feature.objects.get(name='LineString')\n+        self.assertEqual(True, isinstance(f_2.geom, LineString))\n+        self.assertEqual(((0.0, 0.0), (1.0, 1.0), (5.0, 5.0)), f_2.geom.tuple)\n \n-        self.assertRaises(TypeError, City.objects.svg, precision='foo')\n-        # SELECT AsSVG(geoapp_city.point, 0, 8) FROM geoapp_city WHERE name = 'Pueblo';\n-        svg1 = 'cx=\"-104.609252\" cy=\"-38.255001\"'\n-        # Even though relative, only one point so it's practically the same except for\n-        # the 'c' letter prefix on the x,y values.\n-        svg2 = svg1.replace('c', '')\n-        self.assertEqual(svg1, City.objects.svg().get(name='Pueblo').svg)\n-        self.assertEqual(svg2, City.objects.svg(relative=5).get(name='Pueblo').svg)\n+        f_3 = Feature.objects.get(name='Polygon')\n+        self.assertEqual(True, isinstance(f_3.geom, Polygon))\n+        f_4 = Feature.objects.get(name='GeometryCollection')\n+        self.assertEqual(True, isinstance(f_4.geom, GeometryCollection))\n+        self.assertEqual(f_3.geom, f_4.geom[2])\n \n     @no_mysql\n-    def test04_transform(self):\n-        \"Testing the transform() GeoManager method.\"\n-        # Pre-transformed points for Houston and Pueblo.\n-        htown = fromstr('POINT(1947516.83115183 6322297.06040572)', srid=3084)\n-        ptown = fromstr('POINT(992363.390841912 481455.395105533)', srid=2774)\n-        prec = 3 # Precision is low due to version variations in PROJ and GDAL.\n-\n-        # Asserting the result of the transform operation with the values in\n-        #  the pre-transformed points.  Oracle does not have the 3084 SRID.\n-        if not oracle:\n-            h = City.objects.transform(htown.srid).get(name='Houston')\n-            self.assertEqual(3084, h.point.srid)\n-            self.assertAlmostEqual(htown.x, h.point.x, prec)\n-            self.assertAlmostEqual(htown.y, h.point.y, prec)\n-\n-        p1 = City.objects.transform(ptown.srid, field_name='point').get(name='Pueblo')\n-        p2 = City.objects.transform(srid=ptown.srid).get(name='Pueblo')\n-        for p in [p1, p2]:\n-            self.assertEqual(2774, p.point.srid)\n-            self.assertAlmostEqual(ptown.x, p.point.x, prec)\n-            self.assertAlmostEqual(ptown.y, p.point.y, prec)\n+    def test_inherited_geofields(self):\n+        \"Test GeoQuerySet methods on inherited Geometry fields.\"\n+        # Creating a Pennsylvanian city.\n+        mansfield = PennsylvaniaCity.objects.create(name='Mansfield', county='Tioga', point='POINT(-77.071445 41.823881)')\n \n-    @no_mysql\n-    @no_spatialite # SpatiaLite does not have an Extent function\n-    def test05_extent(self):\n-        \"Testing the `extent` GeoQuerySet method.\"\n-        # Reference query:\n-        # `SELECT ST_extent(point) FROM geoapp_city WHERE (name='Houston' or name='Dallas');`\n-        #   =>  BOX(-96.8016128540039 29.7633724212646,-95.3631439208984 32.7820587158203)\n-        expected = (-96.8016128540039, 29.7633724212646, -95.3631439208984, 32.782058715820)\n+        # All transformation SQL will need to be performed on the\n+        # _parent_ table.\n+        qs = PennsylvaniaCity.objects.transform(32128)\n \n-        qs = City.objects.filter(name__in=('Houston', 'Dallas'))\n-        extent = qs.extent()\n+        self.assertEqual(1, qs.count())\n+        for pc in qs: self.assertEqual(32128, pc.point.srid)\n \n-        for val, exp in zip(extent, expected):\n-            self.assertAlmostEqual(exp, val, 4)\n \n-    # Only PostGIS has support for the MakeLine aggregate.\n-    @no_mysql\n-    @no_oracle\n-    @no_spatialite\n-    def test06_make_line(self):\n-        \"Testing the `make_line` GeoQuerySet method.\"\n-        # Ensuring that a `TypeError` is raised on models without PointFields.\n-        self.assertRaises(TypeError, State.objects.make_line)\n-        self.assertRaises(TypeError, Country.objects.make_line)\n-        # Reference query:\n-        # SELECT AsText(ST_MakeLine(geoapp_city.point)) FROM geoapp_city;\n-        ref_line = GEOSGeometry('LINESTRING(-95.363151 29.763374,-96.801611 32.782057,-97.521157 34.464642,174.783117 -41.315268,-104.609252 38.255001,-95.23506 38.971823,-87.650175 41.850385,-123.305196 48.462611)', srid=4326)\n-        self.assertEqual(ref_line, City.objects.make_line())\n+class GeoLookupTest(TestCase):\n \n     @no_mysql\n-    def test09_disjoint(self):\n+    def test_disjoint_lookup(self):\n         \"Testing the `disjoint` lookup type.\"\n         ptown = City.objects.get(name='Pueblo')\n         qs1 = City.objects.filter(point__disjoint=ptown.point)\n@@ -263,7 +200,7 @@ def test09_disjoint(self):\n         self.assertEqual(1, qs2.count())\n         self.assertEqual('Kansas', qs2[0].name)\n \n-    def test10_contains_contained(self):\n+    def test_contains_contained_lookups(self):\n         \"Testing the 'contained', 'contains', and 'bbcontains' lookup types.\"\n         # Getting Texas, yes we were a country -- once ;)\n         texas = Country.objects.get(name='Texas')\n@@ -308,53 +245,56 @@ def test10_contains_contained(self):\n             self.assertEqual(1, len(qs))\n             self.assertEqual('Texas', qs[0].name)\n \n+    # Only PostGIS has `left` and `right` lookup types.\n     @no_mysql\n-    def test11_lookup_insert_transform(self):\n-        \"Testing automatic transform for lookups and inserts.\"\n-        # San Antonio in 'WGS84' (SRID 4326)\n-        sa_4326 = 'POINT (-98.493183 29.424170)'\n-        wgs_pnt = fromstr(sa_4326, srid=4326) # Our reference point in WGS84\n+    @no_oracle\n+    @no_spatialite\n+    def test_left_right_lookups(self):\n+        \"Testing the 'left' and 'right' lookup types.\"\n+        # Left: A << B => true if xmax(A) < xmin(B)\n+        # Right: A >> B => true if xmin(A) > xmax(B)\n+        # See: BOX2D_left() and BOX2D_right() in lwgeom_box2dfloat4.c in PostGIS source.\n \n-        # Oracle doesn't have SRID 3084, using 41157.\n-        if oracle:\n-            # San Antonio in 'Texas 4205, Southern Zone (1983, meters)' (SRID 41157)\n-            # Used the following Oracle SQL to get this value:\n-            #  SELECT SDO_UTIL.TO_WKTGEOMETRY(SDO_CS.TRANSFORM(SDO_GEOMETRY('POINT (-98.493183 29.424170)', 4326), 41157)) FROM DUAL;\n-            nad_wkt  = 'POINT (300662.034646583 5416427.45974934)'\n-            nad_srid = 41157\n-        else:\n-            # San Antonio in 'NAD83(HARN) / Texas Centric Lambert Conformal' (SRID 3084)\n-            nad_wkt = 'POINT (1645978.362408288754523 6276356.025927528738976)' # Used ogr.py in gdal 1.4.1 for this transform\n-            nad_srid = 3084\n+        # Getting the borders for Colorado & Kansas\n+        co_border = State.objects.get(name='Colorado').poly\n+        ks_border = State.objects.get(name='Kansas').poly\n \n-        # Constructing & querying with a point from a different SRID. Oracle\n-        # `SDO_OVERLAPBDYINTERSECT` operates differently from\n-        # `ST_Intersects`, so contains is used instead.\n-        nad_pnt = fromstr(nad_wkt, srid=nad_srid)\n-        if oracle:\n-            tx = Country.objects.get(mpoly__contains=nad_pnt)\n-        else:\n-            tx = Country.objects.get(mpoly__intersects=nad_pnt)\n-        self.assertEqual('Texas', tx.name)\n+        # Note: Wellington has an 'X' value of 174, so it will not be considered\n+        # to the left of CO.\n \n-        # Creating San Antonio.  Remember the Alamo.\n-        sa = City.objects.create(name='San Antonio', point=nad_pnt)\n+        # These cities should be strictly to the right of the CO border.\n+        cities = ['Houston', 'Dallas', 'Oklahoma City',\n+                  'Lawrence', 'Chicago', 'Wellington']\n+        qs = City.objects.filter(point__right=co_border)\n+        self.assertEqual(6, len(qs))\n+        for c in qs: self.assertEqual(True, c.name in cities)\n \n-        # Now verifying that San Antonio was transformed correctly\n-        sa = City.objects.get(name='San Antonio')\n-        self.assertAlmostEqual(wgs_pnt.x, sa.point.x, 6)\n-        self.assertAlmostEqual(wgs_pnt.y, sa.point.y, 6)\n+        # These cities should be strictly to the right of the KS border.\n+        cities = ['Chicago', 'Wellington']\n+        qs = City.objects.filter(point__right=ks_border)\n+        self.assertEqual(2, len(qs))\n+        for c in qs: self.assertEqual(True, c.name in cities)\n \n-        # If the GeometryField SRID is -1, then we shouldn't perform any\n-        # transformation if the SRID of the input geometry is different.\n-        # SpatiaLite does not support missing SRID values.\n-        if not spatialite:\n-            m1 = MinusOneSRID(geom=Point(17, 23, srid=4326))\n-            m1.save()\n-            self.assertEqual(-1, m1.geom.srid)\n+        # Note: Wellington has an 'X' value of 174, so it will not be considered\n+        #  to the left of CO.\n+        vic = City.objects.get(point__left=co_border)\n+        self.assertEqual('Victoria', vic.name)\n+\n+        cities = ['Pueblo', 'Victoria']\n+        qs = City.objects.filter(point__left=ks_border)\n+        self.assertEqual(2, len(qs))\n+        for c in qs: self.assertEqual(True, c.name in cities)\n+\n+    def test_equals_lookups(self):\n+        \"Testing the 'same_as' and 'equals' lookup types.\"\n+        pnt = fromstr('POINT (-95.363151 29.763374)', srid=4326)\n+        c1 = City.objects.get(point=pnt)\n+        c2 = City.objects.get(point__same_as=pnt)\n+        c3 = City.objects.get(point__equals=pnt)\n+        for c in [c1, c2, c3]: self.assertEqual('Houston', c.name)\n \n     @no_mysql\n-    def test12_null_geometries(self):\n+    def test_null_geometries(self):\n         \"Testing NULL geometry support, and the `isnull` lookup type.\"\n         # Creating a state with a NULL boundary.\n         State.objects.create(name='Puerto Rico')\n@@ -383,56 +323,8 @@ def test12_null_geometries(self):\n         State.objects.filter(name='Northern Mariana Islands').update(poly=None)\n         self.assertEqual(None, State.objects.get(name='Northern Mariana Islands').poly)\n \n-    # Only PostGIS has `left` and `right` lookup types.\n     @no_mysql\n-    @no_oracle\n-    @no_spatialite\n-    def test13_left_right(self):\n-        \"Testing the 'left' and 'right' lookup types.\"\n-        # Left: A << B => true if xmax(A) < xmin(B)\n-        # Right: A >> B => true if xmin(A) > xmax(B)\n-        # See: BOX2D_left() and BOX2D_right() in lwgeom_box2dfloat4.c in PostGIS source.\n-\n-        # Getting the borders for Colorado & Kansas\n-        co_border = State.objects.get(name='Colorado').poly\n-        ks_border = State.objects.get(name='Kansas').poly\n-\n-        # Note: Wellington has an 'X' value of 174, so it will not be considered\n-        # to the left of CO.\n-\n-        # These cities should be strictly to the right of the CO border.\n-        cities = ['Houston', 'Dallas', 'Oklahoma City',\n-                  'Lawrence', 'Chicago', 'Wellington']\n-        qs = City.objects.filter(point__right=co_border)\n-        self.assertEqual(6, len(qs))\n-        for c in qs: self.assertEqual(True, c.name in cities)\n-\n-        # These cities should be strictly to the right of the KS border.\n-        cities = ['Chicago', 'Wellington']\n-        qs = City.objects.filter(point__right=ks_border)\n-        self.assertEqual(2, len(qs))\n-        for c in qs: self.assertEqual(True, c.name in cities)\n-\n-        # Note: Wellington has an 'X' value of 174, so it will not be considered\n-        #  to the left of CO.\n-        vic = City.objects.get(point__left=co_border)\n-        self.assertEqual('Victoria', vic.name)\n-\n-        cities = ['Pueblo', 'Victoria']\n-        qs = City.objects.filter(point__left=ks_border)\n-        self.assertEqual(2, len(qs))\n-        for c in qs: self.assertEqual(True, c.name in cities)\n-\n-    def test14_equals(self):\n-        \"Testing the 'same_as' and 'equals' lookup types.\"\n-        pnt = fromstr('POINT (-95.363151 29.763374)', srid=4326)\n-        c1 = City.objects.get(point=pnt)\n-        c2 = City.objects.get(point__same_as=pnt)\n-        c3 = City.objects.get(point__equals=pnt)\n-        for c in [c1, c2, c3]: self.assertEqual('Houston', c.name)\n-\n-    @no_mysql\n-    def test15_relate(self):\n+    def test_relate_lookup(self):\n         \"Testing the 'relate' lookup type.\"\n         # To make things more interesting, we will have our Texas reference point in\n         # different SRIDs.\n@@ -474,60 +366,12 @@ def test15_relate(self):\n             self.assertEqual('Texas', Country.objects.get(mpoly__relate=(pnt2, intersects_mask)).name)\n             self.assertEqual('Lawrence', City.objects.get(point__relate=(ks.poly, intersects_mask)).name)\n \n-    def test16_createnull(self):\n-        \"Testing creating a model instance and the geometry being None\"\n-        c = City()\n-        self.assertEqual(c.point, None)\n \n-    @no_mysql\n-    def test17_unionagg(self):\n-        \"Testing the `unionagg` (aggregate union) GeoManager method.\"\n-        tx = Country.objects.get(name='Texas').mpoly\n-        # Houston, Dallas -- Oracle has different order.\n-        union1 = fromstr('MULTIPOINT(-96.801611 32.782057,-95.363151 29.763374)')\n-        union2 = fromstr('MULTIPOINT(-96.801611 32.782057,-95.363151 29.763374)')\n-        qs = City.objects.filter(point__within=tx)\n-        self.assertRaises(TypeError, qs.unionagg, 'name')\n-        # Using `field_name` keyword argument in one query and specifying an\n-        # order in the other (which should not be used because this is\n-        # an aggregate method on a spatial column)\n-        u1 = qs.unionagg(field_name='point')\n-        u2 = qs.order_by('name').unionagg()\n-        tol = 0.00001\n-        if oracle:\n-            union = union2\n-        else:\n-            union = union1\n-        self.assertEqual(True, union.equals_exact(u1, tol))\n-        self.assertEqual(True, union.equals_exact(u2, tol))\n-        qs = City.objects.filter(name='NotACity')\n-        self.assertEqual(None, qs.unionagg(field_name='point'))\n-\n-    @no_spatialite # SpatiaLite does not support abstract geometry columns\n-    def test18_geometryfield(self):\n-        \"Testing the general GeometryField.\"\n-        Feature(name='Point', geom=Point(1, 1)).save()\n-        Feature(name='LineString', geom=LineString((0, 0), (1, 1), (5, 5))).save()\n-        Feature(name='Polygon', geom=Polygon(LinearRing((0, 0), (0, 5), (5, 5), (5, 0), (0, 0)))).save()\n-        Feature(name='GeometryCollection',\n-                geom=GeometryCollection(Point(2, 2), LineString((0, 0), (2, 2)),\n-                                        Polygon(LinearRing((0, 0), (0, 5), (5, 5), (5, 0), (0, 0))))).save()\n-\n-        f_1 = Feature.objects.get(name='Point')\n-        self.assertEqual(True, isinstance(f_1.geom, Point))\n-        self.assertEqual((1.0, 1.0), f_1.geom.tuple)\n-        f_2 = Feature.objects.get(name='LineString')\n-        self.assertEqual(True, isinstance(f_2.geom, LineString))\n-        self.assertEqual(((0.0, 0.0), (1.0, 1.0), (5.0, 5.0)), f_2.geom.tuple)\n-\n-        f_3 = Feature.objects.get(name='Polygon')\n-        self.assertEqual(True, isinstance(f_3.geom, Polygon))\n-        f_4 = Feature.objects.get(name='GeometryCollection')\n-        self.assertEqual(True, isinstance(f_4.geom, GeometryCollection))\n-        self.assertEqual(f_3.geom, f_4.geom[2])\n+class GeoQuerySetTest(TestCase):\n+    # Please keep the tests in GeoQuerySet method's alphabetic order\n \n     @no_mysql\n-    def test19_centroid(self):\n+    def test_centroid(self):\n         \"Testing the `centroid` GeoQuerySet method.\"\n         qs = State.objects.exclude(poly__isnull=True).centroid()\n         if oracle:\n@@ -540,60 +384,182 @@ def test19_centroid(self):\n             self.assertEqual(True, s.poly.centroid.equals_exact(s.centroid, tol))\n \n     @no_mysql\n-    def test20_pointonsurface(self):\n-        \"Testing the `point_on_surface` GeoQuerySet method.\"\n-        # Reference values.\n-        if oracle:\n-            # SELECT SDO_UTIL.TO_WKTGEOMETRY(SDO_GEOM.SDO_POINTONSURFACE(GEOAPP_COUNTRY.MPOLY, 0.05)) FROM GEOAPP_COUNTRY;\n-            ref = {'New Zealand' : fromstr('POINT (174.616364 -36.100861)', srid=4326),\n-                   'Texas' : fromstr('POINT (-103.002434 36.500397)', srid=4326),\n-                   }\n+    def test_diff_intersection_union(self):\n+        \"Testing the `difference`, `intersection`, `sym_difference`, and `union` GeoQuerySet methods.\"\n+        geom = Point(5, 23)\n+        tol = 1\n+        qs = Country.objects.all().difference(geom).sym_difference(geom).union(geom)\n \n-        elif postgis or spatialite:\n-            # Using GEOSGeometry to compute the reference point on surface values\n-            # -- since PostGIS also uses GEOS these should be the same.\n-            ref = {'New Zealand' : Country.objects.get(name='New Zealand').mpoly.point_on_surface,\n-                   'Texas' : Country.objects.get(name='Texas').mpoly.point_on_surface\n-                   }\n+        # XXX For some reason SpatiaLite does something screwey with the Texas geometry here.  Also,\n+        # XXX it doesn't like the null intersection.\n+        if spatialite:\n+            qs = qs.exclude(name='Texas')\n+        else:\n+            qs = qs.intersection(geom)\n \n-        for c in Country.objects.point_on_surface():\n-            if spatialite:\n-                # XXX This seems to be a WKT-translation-related precision issue?\n-                tol = 0.00001\n+        for c in qs:\n+            if oracle:\n+                # Should be able to execute the queries; however, they won't be the same\n+                # as GEOS (because Oracle doesn't use GEOS internally like PostGIS or\n+                # SpatiaLite).\n+                pass\n             else:\n-                tol = 0.000000001\n-            self.assertEqual(True, ref[c.name].equals_exact(c.point_on_surface, tol))\n+                self.assertEqual(c.mpoly.difference(geom), c.difference)\n+                if not spatialite:\n+                    self.assertEqual(c.mpoly.intersection(geom), c.intersection)\n+                self.assertEqual(c.mpoly.sym_difference(geom), c.sym_difference)\n+                self.assertEqual(c.mpoly.union(geom), c.union)\n+\n+    @no_mysql\n+    @no_spatialite # SpatiaLite does not have an Extent function\n+    def test_extent(self):\n+        \"Testing the `extent` GeoQuerySet method.\"\n+        # Reference query:\n+        # `SELECT ST_extent(point) FROM geoapp_city WHERE (name='Houston' or name='Dallas');`\n+        #   =>  BOX(-96.8016128540039 29.7633724212646,-95.3631439208984 32.7820587158203)\n+        expected = (-96.8016128540039, 29.7633724212646, -95.3631439208984, 32.782058715820)\n+\n+        qs = City.objects.filter(name__in=('Houston', 'Dallas'))\n+        extent = qs.extent()\n+\n+        for val, exp in zip(extent, expected):\n+            self.assertAlmostEqual(exp, val, 4)\n \n     @no_mysql\n     @no_oracle\n-    def test21_scale(self):\n-        \"Testing the `scale` GeoQuerySet method.\"\n-        xfac, yfac = 2, 3\n-        tol = 5 # XXX The low precision tolerance is for SpatiaLite\n-        qs = Country.objects.scale(xfac, yfac, model_att='scaled')\n-        for c in qs:\n-            for p1, p2 in zip(c.mpoly, c.scaled):\n-                for r1, r2 in zip(p1, p2):\n-                    for c1, c2 in zip(r1.coords, r2.coords):\n-                        self.assertAlmostEqual(c1[0] * xfac, c2[0], tol)\n-                        self.assertAlmostEqual(c1[1] * yfac, c2[1], tol)\n+    @no_spatialite\n+    def test_force_rhr(self):\n+        \"Testing GeoQuerySet.force_rhr().\"\n+        rings = ( ( (0, 0), (5, 0), (0, 5), (0, 0) ),\n+                  ( (1, 1), (1, 3), (3, 1), (1, 1) ),\n+                  )\n+        rhr_rings = ( ( (0, 0), (0, 5), (5, 0), (0, 0) ),\n+                      ( (1, 1), (3, 1), (1, 3), (1, 1) ),\n+                      )\n+        State.objects.create(name='Foo', poly=Polygon(*rings))\n+        s = State.objects.force_rhr().get(name='Foo')\n+        self.assertEqual(rhr_rings, s.force_rhr.coords)\n \n     @no_mysql\n     @no_oracle\n-    def test22_translate(self):\n-        \"Testing the `translate` GeoQuerySet method.\"\n-        xfac, yfac = 5, -23\n-        qs = Country.objects.translate(xfac, yfac, model_att='translated')\n-        for c in qs:\n-            for p1, p2 in zip(c.mpoly, c.translated):\n-                for r1, r2 in zip(p1, p2):\n-                    for c1, c2 in zip(r1.coords, r2.coords):\n-                        # XXX The low precision is for SpatiaLite\n-                        self.assertAlmostEqual(c1[0] + xfac, c2[0], 5)\n-                        self.assertAlmostEqual(c1[1] + yfac, c2[1], 5)\n+    @no_spatialite\n+    def test_geohash(self):\n+        \"Testing GeoQuerySet.geohash().\"\n+        if not connection.ops.geohash: return\n+        # Reference query:\n+        # SELECT ST_GeoHash(point) FROM geoapp_city WHERE name='Houston';\n+        # SELECT ST_GeoHash(point, 5) FROM geoapp_city WHERE name='Houston';\n+        ref_hash = '9vk1mfq8jx0c8e0386z6'\n+        h1 = City.objects.geohash().get(name='Houston')\n+        h2 = City.objects.geohash(precision=5).get(name='Houston')\n+        self.assertEqual(ref_hash, h1.geohash)\n+        self.assertEqual(ref_hash[:5], h2.geohash)\n+\n+    def test_geojson(self):\n+        \"Testing GeoJSON output from the database using GeoQuerySet.geojson().\"\n+        # Only PostGIS 1.3.4+ supports GeoJSON.\n+        if not connection.ops.geojson:\n+            self.assertRaises(NotImplementedError, Country.objects.all().geojson, field_name='mpoly')\n+            return\n+\n+        if connection.ops.spatial_version >= (1, 4, 0):\n+            pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.609252,38.255001]}'\n+            houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"coordinates\":[-95.363151,29.763374]}'\n+            victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.305196,48.462611]}'\n+            chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"name\",\"properties\":{\"name\":\"EPSG:4326\"}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n+        else:\n+            pueblo_json = '{\"type\":\"Point\",\"coordinates\":[-104.60925200,38.25500100]}'\n+            houston_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"EPSG\",\"properties\":{\"EPSG\":4326}},\"coordinates\":[-95.36315100,29.76337400]}'\n+            victoria_json = '{\"type\":\"Point\",\"bbox\":[-123.30519600,48.46261100,-123.30519600,48.46261100],\"coordinates\":[-123.30519600,48.46261100]}'\n+            chicago_json = '{\"type\":\"Point\",\"crs\":{\"type\":\"EPSG\",\"properties\":{\"EPSG\":4326}},\"bbox\":[-87.65018,41.85039,-87.65018,41.85039],\"coordinates\":[-87.65018,41.85039]}'\n+\n+        # Precision argument should only be an integer\n+        self.assertRaises(TypeError, City.objects.geojson, precision='foo')\n+\n+        # Reference queries and values.\n+        # SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 0) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Pueblo';\n+        self.assertEqual(pueblo_json, City.objects.geojson().get(name='Pueblo').geojson)\n+\n+        # 1.3.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 1) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Houston';\n+        # 1.4.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 2) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Houston';\n+        # This time we want to include the CRS by using the `crs` keyword.\n+        self.assertEqual(houston_json, City.objects.geojson(crs=True, model_att='json').get(name='Houston').json)\n+\n+        # 1.3.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 2) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Victoria';\n+        # 1.4.x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 8, 1) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Houston';\n+        # This time we include the bounding box by using the `bbox` keyword.\n+        self.assertEqual(victoria_json, City.objects.geojson(bbox=True).get(name='Victoria').geojson)\n+\n+        # 1.(3|4).x: SELECT ST_AsGeoJson(\"geoapp_city\".\"point\", 5, 3) FROM \"geoapp_city\" WHERE \"geoapp_city\".\"name\" = 'Chicago';\n+        # Finally, we set every available keyword.\n+        self.assertEqual(chicago_json, City.objects.geojson(bbox=True, crs=True, precision=5).get(name='Chicago').geojson)\n+\n+    def test_gml(self):\n+        \"Testing GML output from the database using GeoQuerySet.gml().\"\n+        if mysql or (spatialite and not connection.ops.gml) :\n+            self.assertRaises(NotImplementedError, Country.objects.all().gml, field_name='mpoly')\n+            return\n+\n+        # Should throw a TypeError when tyring to obtain GML from a\n+        # non-geometry field.\n+        qs = City.objects.all()\n+        self.assertRaises(TypeError, qs.gml, field_name='name')\n+        ptown1 = City.objects.gml(field_name='point', precision=9).get(name='Pueblo')\n+        ptown2 = City.objects.gml(precision=9).get(name='Pueblo')\n+\n+        if oracle:\n+            # No precision parameter for Oracle :-/\n+            gml_regex = re.compile(r'^<gml:Point srsName=\"SDO:4326\" xmlns:gml=\"http://www.opengis.net/gml\"><gml:coordinates decimal=\"\\.\" cs=\",\" ts=\" \">-104.60925\\d+,38.25500\\d+ </gml:coordinates></gml:Point>')\n+        elif spatialite:\n+            # Spatialite has extra colon in SrsName\n+            gml_regex = re.compile(r'^<gml:Point SrsName=\"EPSG::4326\"><gml:coordinates decimal=\"\\.\" cs=\",\" ts=\" \">-104.609251\\d+,38.255001</gml:coordinates></gml:Point>')\n+        else:\n+            gml_regex = re.compile(r'^<gml:Point srsName=\"EPSG:4326\"><gml:coordinates>-104\\.60925\\d+,38\\.255001</gml:coordinates></gml:Point>')\n+\n+        for ptown in [ptown1, ptown2]:\n+            self.assertTrue(gml_regex.match(ptown.gml))\n+\n+    def test_kml(self):\n+        \"Testing KML output from the database using GeoQuerySet.kml().\"\n+        # Only PostGIS and Spatialite (>=2.4.0-RC4) support KML serialization\n+        if not (postgis or (spatialite and connection.ops.kml)):\n+            self.assertRaises(NotImplementedError, State.objects.all().kml, field_name='poly')\n+            return\n+\n+        # Should throw a TypeError when trying to obtain KML from a\n+        #  non-geometry field.\n+        qs = City.objects.all()\n+        self.assertRaises(TypeError, qs.kml, 'name')\n+\n+        # The reference KML depends on the version of PostGIS used\n+        # (the output stopped including altitude in 1.3.3).\n+        if connection.ops.spatial_version >= (1, 3, 3):\n+            ref_kml =  '<Point><coordinates>-104.609252,38.255001</coordinates></Point>'\n+        else:\n+            ref_kml = '<Point><coordinates>-104.609252,38.255001,0</coordinates></Point>'\n \n+        # Ensuring the KML is as expected.\n+        ptown1 = City.objects.kml(field_name='point', precision=9).get(name='Pueblo')\n+        ptown2 = City.objects.kml(precision=9).get(name='Pueblo')\n+        for ptown in [ptown1, ptown2]:\n+            self.assertEqual(ref_kml, ptown.kml)\n+\n+    # Only PostGIS has support for the MakeLine aggregate.\n     @no_mysql\n-    def test23_numgeom(self):\n+    @no_oracle\n+    @no_spatialite\n+    def test_make_line(self):\n+        \"Testing the `make_line` GeoQuerySet method.\"\n+        # Ensuring that a `TypeError` is raised on models without PointFields.\n+        self.assertRaises(TypeError, State.objects.make_line)\n+        self.assertRaises(TypeError, Country.objects.make_line)\n+        # Reference query:\n+        # SELECT AsText(ST_MakeLine(geoapp_city.point)) FROM geoapp_city;\n+        ref_line = GEOSGeometry('LINESTRING(-95.363151 29.763374,-96.801611 32.782057,-97.521157 34.464642,174.783117 -41.315268,-104.609252 38.255001,-95.23506 38.971823,-87.650175 41.850385,-123.305196 48.462611)', srid=4326)\n+        self.assertEqual(ref_line, City.objects.make_line())\n+\n+    @no_mysql\n+    def test_num_geom(self):\n         \"Testing the `num_geom` GeoQuerySet method.\"\n         # Both 'countries' only have two geometries.\n         for c in Country.objects.num_geom(): self.assertEqual(2, c.num_geom)\n@@ -607,7 +573,7 @@ def test23_numgeom(self):\n \n     @no_mysql\n     @no_spatialite # SpatiaLite can only count vertices in LineStrings\n-    def test24_numpoints(self):\n+    def test_num_points(self):\n         \"Testing the `num_points` GeoQuerySet method.\"\n         for c in Country.objects.num_points():\n             self.assertEqual(c.mpoly.num_points, c.num_points)\n@@ -617,49 +583,60 @@ def test24_numpoints(self):\n             for c in City.objects.num_points(): self.assertEqual(1, c.num_points)\n \n     @no_mysql\n-    def test25_geoset(self):\n-        \"Testing the `difference`, `intersection`, `sym_difference`, and `union` GeoQuerySet methods.\"\n-        geom = Point(5, 23)\n-        tol = 1\n-        qs = Country.objects.all().difference(geom).sym_difference(geom).union(geom)\n+    def test_point_on_surface(self):\n+        \"Testing the `point_on_surface` GeoQuerySet method.\"\n+        # Reference values.\n+        if oracle:\n+            # SELECT SDO_UTIL.TO_WKTGEOMETRY(SDO_GEOM.SDO_POINTONSURFACE(GEOAPP_COUNTRY.MPOLY, 0.05)) FROM GEOAPP_COUNTRY;\n+            ref = {'New Zealand' : fromstr('POINT (174.616364 -36.100861)', srid=4326),\n+                   'Texas' : fromstr('POINT (-103.002434 36.500397)', srid=4326),\n+                   }\n \n-        # XXX For some reason SpatiaLite does something screwey with the Texas geometry here.  Also,\n-        # XXX it doesn't like the null intersection.\n-        if spatialite:\n-            qs = qs.exclude(name='Texas')\n-        else:\n-            qs = qs.intersection(geom)\n+        elif postgis or spatialite:\n+            # Using GEOSGeometry to compute the reference point on surface values\n+            # -- since PostGIS also uses GEOS these should be the same.\n+            ref = {'New Zealand' : Country.objects.get(name='New Zealand').mpoly.point_on_surface,\n+                   'Texas' : Country.objects.get(name='Texas').mpoly.point_on_surface\n+                   }\n \n-        for c in qs:\n-            if oracle:\n-                # Should be able to execute the queries; however, they won't be the same\n-                # as GEOS (because Oracle doesn't use GEOS internally like PostGIS or\n-                # SpatiaLite).\n-                pass\n+        for c in Country.objects.point_on_surface():\n+            if spatialite:\n+                # XXX This seems to be a WKT-translation-related precision issue?\n+                tol = 0.00001\n             else:\n-                self.assertEqual(c.mpoly.difference(geom), c.difference)\n-                if not spatialite:\n-                    self.assertEqual(c.mpoly.intersection(geom), c.intersection)\n-                self.assertEqual(c.mpoly.sym_difference(geom), c.sym_difference)\n-                self.assertEqual(c.mpoly.union(geom), c.union)\n+                tol = 0.000000001\n+            self.assertEqual(True, ref[c.name].equals_exact(c.point_on_surface, tol))\n \n     @no_mysql\n-    def test26_inherited_geofields(self):\n-        \"Test GeoQuerySet methods on inherited Geometry fields.\"\n-        # Creating a Pennsylvanian city.\n-        mansfield = PennsylvaniaCity.objects.create(name='Mansfield', county='Tioga', point='POINT(-77.071445 41.823881)')\n-\n-        # All transformation SQL will need to be performed on the\n-        # _parent_ table.\n-        qs = PennsylvaniaCity.objects.transform(32128)\n+    @no_spatialite\n+    def test_reverse_geom(self):\n+        \"Testing GeoQuerySet.reverse_geom().\"\n+        coords = [ (-95.363151, 29.763374), (-95.448601, 29.713803) ]\n+        Track.objects.create(name='Foo', line=LineString(coords))\n+        t = Track.objects.reverse_geom().get(name='Foo')\n+        coords.reverse()\n+        self.assertEqual(tuple(coords), t.reverse_geom.coords)\n+        if oracle:\n+            self.assertRaises(TypeError, State.objects.reverse_geom)\n \n-        self.assertEqual(1, qs.count())\n-        for pc in qs: self.assertEqual(32128, pc.point.srid)\n+    @no_mysql\n+    @no_oracle\n+    def test_scale(self):\n+        \"Testing the `scale` GeoQuerySet method.\"\n+        xfac, yfac = 2, 3\n+        tol = 5 # XXX The low precision tolerance is for SpatiaLite\n+        qs = Country.objects.scale(xfac, yfac, model_att='scaled')\n+        for c in qs:\n+            for p1, p2 in zip(c.mpoly, c.scaled):\n+                for r1, r2 in zip(p1, p2):\n+                    for c1, c2 in zip(r1.coords, r2.coords):\n+                        self.assertAlmostEqual(c1[0] * xfac, c2[0], tol)\n+                        self.assertAlmostEqual(c1[1] * yfac, c2[1], tol)\n \n     @no_mysql\n     @no_oracle\n     @no_spatialite\n-    def test27_snap_to_grid(self):\n+    def test_snap_to_grid(self):\n         \"Testing GeoQuerySet.snap_to_grid().\"\n         # Let's try and break snap_to_grid() with bad combinations of arguments.\n         for bad_args in ((), range(3), range(5)):\n@@ -695,48 +672,78 @@ def test27_snap_to_grid(self):\n         ref = fromstr('MULTIPOLYGON(((12.4 43.87,12.45 43.87,12.45 44.1,12.5 44.1,12.5 43.87,12.45 43.87,12.4 43.87)))')\n         self.assertTrue(ref.equals_exact(Country.objects.snap_to_grid(0.05, 0.23, 0.5, 0.17).get(name='San Marino').snap_to_grid, tol))\n \n-    @no_mysql\n-    @no_spatialite\n-    def test28_reverse(self):\n-        \"Testing GeoQuerySet.reverse_geom().\"\n-        coords = [ (-95.363151, 29.763374), (-95.448601, 29.713803) ]\n-        Track.objects.create(name='Foo', line=LineString(coords))\n-        t = Track.objects.reverse_geom().get(name='Foo')\n-        coords.reverse()\n-        self.assertEqual(tuple(coords), t.reverse_geom.coords)\n-        if oracle:\n-            self.assertRaises(TypeError, State.objects.reverse_geom)\n+    def test_svg(self):\n+        \"Testing SVG output using GeoQuerySet.svg().\"\n+        if mysql or oracle:\n+            self.assertRaises(NotImplementedError, City.objects.svg)\n+            return\n+\n+        self.assertRaises(TypeError, City.objects.svg, precision='foo')\n+        # SELECT AsSVG(geoapp_city.point, 0, 8) FROM geoapp_city WHERE name = 'Pueblo';\n+        svg1 = 'cx=\"-104.609252\" cy=\"-38.255001\"'\n+        # Even though relative, only one point so it's practically the same except for\n+        # the 'c' letter prefix on the x,y values.\n+        svg2 = svg1.replace('c', '')\n+        self.assertEqual(svg1, City.objects.svg().get(name='Pueblo').svg)\n+        self.assertEqual(svg2, City.objects.svg(relative=5).get(name='Pueblo').svg)\n \n     @no_mysql\n-    @no_oracle\n-    @no_spatialite\n-    def test29_force_rhr(self):\n-        \"Testing GeoQuerySet.force_rhr().\"\n-        rings = ( ( (0, 0), (5, 0), (0, 5), (0, 0) ),\n-                  ( (1, 1), (1, 3), (3, 1), (1, 1) ),\n-                  )\n-        rhr_rings = ( ( (0, 0), (0, 5), (5, 0), (0, 0) ),\n-                      ( (1, 1), (3, 1), (1, 3), (1, 1) ),\n-                      )\n-        State.objects.create(name='Foo', poly=Polygon(*rings))\n-        s = State.objects.force_rhr().get(name='Foo')\n-        self.assertEqual(rhr_rings, s.force_rhr.coords)\n+    def test_transform(self):\n+        \"Testing the transform() GeoQuerySet method.\"\n+        # Pre-transformed points for Houston and Pueblo.\n+        htown = fromstr('POINT(1947516.83115183 6322297.06040572)', srid=3084)\n+        ptown = fromstr('POINT(992363.390841912 481455.395105533)', srid=2774)\n+        prec = 3 # Precision is low due to version variations in PROJ and GDAL.\n+\n+        # Asserting the result of the transform operation with the values in\n+        #  the pre-transformed points.  Oracle does not have the 3084 SRID.\n+        if not oracle:\n+            h = City.objects.transform(htown.srid).get(name='Houston')\n+            self.assertEqual(3084, h.point.srid)\n+            self.assertAlmostEqual(htown.x, h.point.x, prec)\n+            self.assertAlmostEqual(htown.y, h.point.y, prec)\n+\n+        p1 = City.objects.transform(ptown.srid, field_name='point').get(name='Pueblo')\n+        p2 = City.objects.transform(srid=ptown.srid).get(name='Pueblo')\n+        for p in [p1, p2]:\n+            self.assertEqual(2774, p.point.srid)\n+            self.assertAlmostEqual(ptown.x, p.point.x, prec)\n+            self.assertAlmostEqual(ptown.y, p.point.y, prec)\n \n     @no_mysql\n     @no_oracle\n-    @no_spatialite\n-    def test30_geohash(self):\n-        \"Testing GeoQuerySet.geohash().\"\n-        if not connection.ops.geohash: return\n-        # Reference query:\n-        # SELECT ST_GeoHash(point) FROM geoapp_city WHERE name='Houston';\n-        # SELECT ST_GeoHash(point, 5) FROM geoapp_city WHERE name='Houston';\n-        ref_hash = '9vk1mfq8jx0c8e0386z6'\n-        h1 = City.objects.geohash().get(name='Houston')\n-        h2 = City.objects.geohash(precision=5).get(name='Houston')\n-        self.assertEqual(ref_hash, h1.geohash)\n-        self.assertEqual(ref_hash[:5], h2.geohash)\n+    def test_translate(self):\n+        \"Testing the `translate` GeoQuerySet method.\"\n+        xfac, yfac = 5, -23\n+        qs = Country.objects.translate(xfac, yfac, model_att='translated')\n+        for c in qs:\n+            for p1, p2 in zip(c.mpoly, c.translated):\n+                for r1, r2 in zip(p1, p2):\n+                    for c1, c2 in zip(r1.coords, r2.coords):\n+                        # XXX The low precision is for SpatiaLite\n+                        self.assertAlmostEqual(c1[0] + xfac, c2[0], 5)\n+                        self.assertAlmostEqual(c1[1] + yfac, c2[1], 5)\n \n-from .test_feeds import GeoFeedTest\n-from .test_regress import GeoRegressionTests\n-from .test_sitemaps import GeoSitemapTest\n+    @no_mysql\n+    def test_unionagg(self):\n+        \"Testing the `unionagg` (aggregate union) GeoQuerySet method.\"\n+        tx = Country.objects.get(name='Texas').mpoly\n+        # Houston, Dallas -- Oracle has different order.\n+        union1 = fromstr('MULTIPOINT(-96.801611 32.782057,-95.363151 29.763374)')\n+        union2 = fromstr('MULTIPOINT(-96.801611 32.782057,-95.363151 29.763374)')\n+        qs = City.objects.filter(point__within=tx)\n+        self.assertRaises(TypeError, qs.unionagg, 'name')\n+        # Using `field_name` keyword argument in one query and specifying an\n+        # order in the other (which should not be used because this is\n+        # an aggregate method on a spatial column)\n+        u1 = qs.unionagg(field_name='point')\n+        u2 = qs.order_by('name').unionagg()\n+        tol = 0.00001\n+        if oracle:\n+            union = union2\n+        else:\n+            union = union1\n+        self.assertEqual(True, union.equals_exact(u1, tol))\n+        self.assertEqual(True, union.equals_exact(u2, tol))\n+        qs = City.objects.filter(name='NotACity')\n+        self.assertEqual(None, qs.unionagg(field_name='point'))"
        },
        {
            "sha": "7e8f1631741ef42fc0179ac924093786e7a9715c",
            "filename": "django/contrib/humanize/templatetags/humanize.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fhumanize%2Ftemplatetags%2Fhumanize.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n from django import template\n from django.conf import settings\n from django.template import defaultfilters\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.formats import number_format\n from django.utils.translation import pgettext, ungettext, ugettext as _\n from django.utils.timezone import is_aware, utc\n@@ -41,7 +41,7 @@ def intcomma(value, use_l10n=True):\n             return intcomma(value, False)\n         else:\n             return number_format(value, force_grouping=True)\n-    orig = force_unicode(value)\n+    orig = force_text(value)\n     new = re.sub(\"^(-?\\d+)(\\d{3})\", '\\g<1>,\\g<2>', orig)\n     if orig == new:\n         return new"
        },
        {
            "sha": "d3a00e200cd5540d9f319c97322b449ba4e7e4e1",
            "filename": "django/contrib/localflavor/au/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fau%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fau%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fau%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -44,7 +44,7 @@ def clean(self, value):\n         super(AUPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\(|\\)|\\s+|-)', '', smart_unicode(value))\n+        value = re.sub('(\\(|\\)|\\s+|-)', '', smart_text(value))\n         phone_match = PHONE_DIGITS_RE.search(value)\n         if phone_match:\n             return '%s' % phone_match.group(1)"
        },
        {
            "sha": "0f957be37f7939343b70f8369fb7b82290e4ee7a",
            "filename": "django/contrib/localflavor/br/forms.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fbr%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fbr%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fbr%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,7 +11,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, CharField, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -35,7 +35,7 @@ def clean(self, value):\n         super(BRPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\(|\\)|\\s+)', '', smart_unicode(value))\n+        value = re.sub('(\\(|\\)|\\s+)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s-%s-%s' % (m.group(1), m.group(2), m.group(3))\n@@ -68,10 +68,10 @@ def clean(self, value):\n         value = super(BRStateChoiceField, self).clean(value)\n         if value in EMPTY_VALUES:\n             value = ''\n-        value = smart_unicode(value)\n+        value = smart_text(value)\n         if value == '':\n             return value\n-        valid_values = set([smart_unicode(k) for k, v in self.widget.choices])\n+        valid_values = set([smart_text(k) for k, v in self.widget.choices])\n         if value not in valid_values:\n             raise ValidationError(self.error_messages['invalid'])\n         return value\n@@ -154,10 +154,10 @@ def clean(self, value):\n             raise ValidationError(self.error_messages['max_digits'])\n         orig_dv = value[-2:]\n \n-        new_1dv = sum([i * int(value[idx]) for idx, i in enumerate(range(5, 1, -1) + range(9, 1, -1))])\n+        new_1dv = sum([i * int(value[idx]) for idx, i in enumerate(list(range(5, 1, -1)) + list(range(9, 1, -1)))])\n         new_1dv = DV_maker(new_1dv % 11)\n         value = value[:-2] + str(new_1dv) + value[-1]\n-        new_2dv = sum([i * int(value[idx]) for idx, i in enumerate(range(6, 1, -1) + range(9, 1, -1))])\n+        new_2dv = sum([i * int(value[idx]) for idx, i in enumerate(list(range(6, 1, -1)) + list(range(9, 1, -1)))])\n         new_2dv = DV_maker(new_2dv % 11)\n         value = value[:-1] + str(new_2dv)\n         if value[-2:] != orig_dv:"
        },
        {
            "sha": "4ebfb06c2bb4b1091fcf923bdc866540dc435b95",
            "filename": "django/contrib/localflavor/ca/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fca%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fca%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fca%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, CharField, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -53,7 +53,7 @@ def clean(self, value):\n         super(CAPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\(|\\)|\\s+)', '', smart_unicode(value))\n+        value = re.sub('(\\(|\\)|\\s+)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s-%s-%s' % (m.group(1), m.group(2), m.group(3))"
        },
        {
            "sha": "bf71eeea322cb9e86b498a3de3baf737f45988fa",
            "filename": "django/contrib/localflavor/ch/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fch%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fch%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fch%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -41,7 +41,7 @@ def clean(self, value):\n         super(CHPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\.|\\s|/|-)', '', smart_unicode(value))\n+        value = re.sub('(\\.|\\s|/|-)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s %s %s %s' % (value[0:3], value[3:6], value[6:8], value[8:10])"
        },
        {
            "sha": "a5340141ce4cb6840a39eaeea2fdb51961b3d46c",
            "filename": "django/contrib/localflavor/cl/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fcl%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fcl%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fcl%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.forms import ValidationError\n from django.forms.fields import RegexField, Select\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n from .cl_regions import REGION_CHOICES\n \n@@ -75,7 +75,7 @@ def _canonify(self, rut):\n         Turns the RUT into one normalized format. Returns a (rut, verifier)\n         tuple.\n         \"\"\"\n-        rut = smart_unicode(rut).replace(' ', '').replace('.', '').replace('-', '')\n+        rut = smart_text(rut).replace(' ', '').replace('.', '').replace('-', '')\n         return rut[:-1], rut[-1].upper()\n \n     def _format(self, code, verifier=None):"
        },
        {
            "sha": "8b841fff5fe416b44e0d4aed488d22f149f13751",
            "filename": "django/contrib/localflavor/fr/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Ffr%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Ffr%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Ffr%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import CharField, RegexField, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -43,7 +43,7 @@ def clean(self, value):\n         super(FRPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\.|\\s)', '', smart_unicode(value))\n+        value = re.sub('(\\.|\\s)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s %s %s %s %s' % (value[0:2], value[2:4], value[4:6], value[6:8], value[8:10])"
        },
        {
            "sha": "ab4f70f1939628c94ae5c68d37dace98c9e8a807",
            "filename": "django/contrib/localflavor/hk/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fhk%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fhk%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fhk%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import CharField\n from django.forms import ValidationError\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -53,7 +53,7 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n \n-        value = re.sub('(\\(|\\)|\\s+|\\+)', '', smart_unicode(value))\n+        value = re.sub('(\\(|\\)|\\s+|\\+)', '', smart_text(value))\n         m = hk_phone_digits_re.search(value)\n         if not m:\n             raise ValidationError(self.error_messages['invalid'])"
        },
        {
            "sha": "b935fd8a3a9f59ec7f89f6f1af74c7a0004b6a0b",
            "filename": "django/contrib/localflavor/hr/forms.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fhr%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fhr%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fhr%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, Select, RegexField\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -159,7 +159,7 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n \n-        value = re.sub(r'[\\s\\-]+', '', smart_unicode(value.strip())).upper()\n+        value = re.sub(r'[\\s\\-]+', '', smart_text(value.strip())).upper()\n \n         matches = plate_re.search(value)\n         if matches is None:\n@@ -225,7 +225,7 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n \n-        value = re.sub(r'[\\-\\s\\(\\)]', '', smart_unicode(value))\n+        value = re.sub(r'[\\-\\s\\(\\)]', '', smart_text(value))\n \n         matches = phone_re.search(value)\n         if matches is None:"
        },
        {
            "sha": "2005dbc75c4713a386082337788834aa0baca481",
            "filename": "django/contrib/localflavor/id/forms.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fid%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fid%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fid%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,7 +11,7 @@\n from django.forms import ValidationError\n from django.forms.fields import Field, Select\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n \n postcode_re = re.compile(r'^[1-9]\\d{4}$')\n@@ -77,10 +77,10 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n \n-        phone_number = re.sub(r'[\\-\\s\\(\\)]', '', smart_unicode(value))\n+        phone_number = re.sub(r'[\\-\\s\\(\\)]', '', smart_text(value))\n \n         if phone_re.search(phone_number):\n-            return smart_unicode(value)\n+            return smart_text(value)\n \n         raise ValidationError(self.error_messages['invalid'])\n \n@@ -120,7 +120,7 @@ def clean(self, value):\n             return ''\n \n         plate_number = re.sub(r'\\s+', ' ',\n-            smart_unicode(value.strip())).upper()\n+            smart_text(value.strip())).upper()\n \n         matches = plate_re.search(plate_number)\n         if matches is None:\n@@ -181,7 +181,7 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n \n-        value = re.sub(r'[\\s.]', '', smart_unicode(value))\n+        value = re.sub(r'[\\s.]', '', smart_text(value))\n \n         if not nik_re.search(value):\n             raise ValidationError(self.error_messages['invalid'])"
        },
        {
            "sha": "5c1d009ef4d1ccfab64c00757c59dae30e98bff3",
            "filename": "django/contrib/localflavor/in_/forms.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fin_%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, CharField, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -74,7 +74,7 @@ def clean(self, value):\n             pass\n         else:\n             try:\n-                return smart_unicode(STATES_NORMALIZED[value.strip().lower()])\n+                return smart_text(STATES_NORMALIZED[value.strip().lower()])\n             except KeyError:\n                 pass\n         raise ValidationError(self.error_messages['invalid'])\n@@ -107,7 +107,7 @@ def clean(self, value):\n         super(INPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = smart_unicode(value)\n+        value = smart_text(value)\n         m = phone_digits_re.match(value)\n         if m:\n             return '%s' % (value)"
        },
        {
            "sha": "1ae3e012a10a2676c1145e8eb214804c4e31875c",
            "filename": "django/contrib/localflavor/is_/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fis_%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fis_%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fis_%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.forms import ValidationError\n from django.forms.fields import RegexField\n from django.forms.widgets import Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -58,7 +58,7 @@ def _format(self, value):\n         Takes in the value in canonical form and returns it in the common\n         display format.\n         \"\"\"\n-        return smart_unicode(value[:6]+'-'+value[6:])\n+        return smart_text(value[:6]+'-'+value[6:])\n \n class ISPhoneNumberField(RegexField):\n     \"\"\""
        },
        {
            "sha": "916ce9bb3df3b3b61a02f89fb43eafb2d7add783",
            "filename": "django/contrib/localflavor/it/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fit%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fit%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fit%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -13,7 +13,7 @@\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n \n class ITZipCodeField(RegexField):\n@@ -85,4 +85,4 @@ def clean(self, value):\n         check_digit = vat_number_check_digit(vat_number[0:10])\n         if not vat_number[10] == check_digit:\n             raise ValidationError(self.error_messages['invalid'])\n-        return smart_unicode(vat_number)\n+        return smart_text(vat_number)"
        },
        {
            "sha": "e1aa9c04199d8883c48195c90e7ab8bd232cb3f1",
            "filename": "django/contrib/localflavor/it/util.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fit%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fit%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fit%2Futil.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,4 +1,4 @@\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n def ssn_check_digit(value):\n     \"Calculate Italian social security number check digit.\"\n@@ -34,11 +34,11 @@ def ssn_check_digit(value):\n \n def vat_number_check_digit(vat_number):\n     \"Calculate Italian VAT number check digit.\"\n-    normalized_vat_number = smart_unicode(vat_number).zfill(10)\n+    normalized_vat_number = smart_text(vat_number).zfill(10)\n     total = 0\n     for i in range(0, 10, 2):\n         total += int(normalized_vat_number[i])\n     for i in range(1, 11, 2):\n         quotient , remainder = divmod(int(normalized_vat_number[i]) * 2, 10)\n         total += quotient + remainder\n-    return smart_unicode((10 - total % 10) % 10)\n+    return smart_text((10 - total % 10) % 10)"
        },
        {
            "sha": "a05dd38f7f1ca4df21ae019d0339d813a8ede829",
            "filename": "django/contrib/localflavor/nl/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fnl%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fnl%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fnl%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, Select\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -61,7 +61,7 @@ def clean(self, value):\n         if value in EMPTY_VALUES:\n             return ''\n \n-        phone_nr = re.sub('[\\-\\s\\(\\)]', '', smart_unicode(value))\n+        phone_nr = re.sub('[\\-\\s\\(\\)]', '', smart_text(value))\n \n         if len(phone_nr) == 10 and numeric_re.search(phone_nr):\n             return value"
        },
        {
            "sha": "01cdd101b27d4af63d54c4a160ae24083c6f4942",
            "filename": "django/contrib/localflavor/pt/forms.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fpt%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fpt%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fpt%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n phone_digits_re = re.compile(r'^(\\d{9}|(00|\\+)\\d*)$')\n@@ -29,7 +29,7 @@ def clean(self,value):\n            return '%s-%s' % (cleaned[:4],cleaned[4:])\n         else:\n            return cleaned\n-        \n+\n class PTPhoneNumberField(Field):\n     \"\"\"\n     Validate local Portuguese phone number (including international ones)\n@@ -43,7 +43,7 @@ def clean(self, value):\n         super(PTPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\.|\\s)', '', smart_unicode(value))\n+        value = re.sub('(\\.|\\s)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s' % value"
        },
        {
            "sha": "bab35935fd855821923f95a55252f866e2decffc",
            "filename": "django/contrib/localflavor/si/forms.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fsi%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fsi%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fsi%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -41,7 +41,7 @@ def clean(self, value):\n         # Validate EMSO\n         s = 0\n         int_values = [int(i) for i in value]\n-        for a, b in zip(int_values, range(7, 1, -1) * 2):\n+        for a, b in zip(int_values, list(range(7, 1, -1)) * 2):\n             s += a * b\n         chk = s % 11\n         if chk == 0:"
        },
        {
            "sha": "c4f928e670b480d8cf4333fda83a8c8778787633",
            "filename": "django/contrib/localflavor/tr/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Ftr%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Ftr%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Ftr%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select, CharField\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -46,7 +46,7 @@ def clean(self, value):\n         super(TRPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\(|\\)|\\s+)', '', smart_unicode(value))\n+        value = re.sub('(\\(|\\)|\\s+)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s%s' % (m.group(2), m.group(4))"
        },
        {
            "sha": "437bb7c466f164a427a4c2b55c4b1f757cd854e8",
            "filename": "django/contrib/localflavor/us/forms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fus%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Flocalflavor%2Fus%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Flocalflavor%2Fus%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.core.validators import EMPTY_VALUES\n from django.forms import ValidationError\n from django.forms.fields import Field, RegexField, Select, CharField\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.translation import ugettext_lazy as _\n \n \n@@ -34,7 +34,7 @@ def clean(self, value):\n         super(USPhoneNumberField, self).clean(value)\n         if value in EMPTY_VALUES:\n             return ''\n-        value = re.sub('(\\(|\\)|\\s+)', '', smart_unicode(value))\n+        value = re.sub('(\\(|\\)|\\s+)', '', smart_text(value))\n         m = phone_digits_re.search(value)\n         if m:\n             return '%s-%s-%s' % (m.group(1), m.group(2), m.group(3))"
        },
        {
            "sha": "af9c842f4230245f9c1d2d9fcc2917e0db53d289",
            "filename": "django/contrib/markup/templatetags/markup.py",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmarkup%2Ftemplatetags%2Fmarkup.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -13,7 +13,7 @@\n \n from django import template\n from django.conf import settings\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import smart_bytes, force_text\n from django.utils.safestring import mark_safe\n \n register = template.Library()\n@@ -25,9 +25,9 @@ def textile(value):\n     except ImportError:\n         if settings.DEBUG:\n             raise template.TemplateSyntaxError(\"Error in 'textile' filter: The Python textile library isn't installed.\")\n-        return force_unicode(value)\n+        return force_text(value)\n     else:\n-        return mark_safe(force_unicode(textile.textile(smart_str(value), encoding='utf-8', output='utf-8')))\n+        return mark_safe(force_text(textile.textile(smart_bytes(value), encoding='utf-8', output='utf-8')))\n \n @register.filter(is_safe=True)\n def markdown(value, arg=''):\n@@ -52,23 +52,23 @@ def markdown(value, arg=''):\n     except ImportError:\n         if settings.DEBUG:\n             raise template.TemplateSyntaxError(\"Error in 'markdown' filter: The Python markdown library isn't installed.\")\n-        return force_unicode(value)\n+        return force_text(value)\n     else:\n         markdown_vers = getattr(markdown, \"version_info\", 0)\n         if markdown_vers < (2, 1):\n             if settings.DEBUG:\n                 raise template.TemplateSyntaxError(\n                     \"Error in 'markdown' filter: Django does not support versions of the Python markdown library < 2.1.\")\n-            return force_unicode(value)\n+            return force_text(value)\n         else:\n             extensions = [e for e in arg.split(\",\") if e]\n             if extensions and extensions[0] == \"safe\":\n                 extensions = extensions[1:]\n                 return mark_safe(markdown.markdown(\n-                    force_unicode(value), extensions, safe_mode=True, enable_attributes=False))\n+                    force_text(value), extensions, safe_mode=True, enable_attributes=False))\n             else:\n                 return mark_safe(markdown.markdown(\n-                    force_unicode(value), extensions, safe_mode=False))\n+                    force_text(value), extensions, safe_mode=False))\n \n @register.filter(is_safe=True)\n def restructuredtext(value):\n@@ -77,8 +77,8 @@ def restructuredtext(value):\n     except ImportError:\n         if settings.DEBUG:\n             raise template.TemplateSyntaxError(\"Error in 'restructuredtext' filter: The Python docutils library isn't installed.\")\n-        return force_unicode(value)\n+        return force_text(value)\n     else:\n         docutils_settings = getattr(settings, \"RESTRUCTUREDTEXT_FILTER_SETTINGS\", {})\n-        parts = publish_parts(source=smart_str(value), writer_name=\"html4css1\", settings_overrides=docutils_settings)\n-        return mark_safe(force_unicode(parts[\"fragment\"]))\n+        parts = publish_parts(source=smart_bytes(value), writer_name=\"html4css1\", settings_overrides=docutils_settings)\n+        return mark_safe(force_text(parts[\"fragment\"]))"
        },
        {
            "sha": "5433bbff28e2897400a04ab22b2e9b636bfd6e7d",
            "filename": "django/contrib/messages/storage/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fmessages%2Fstorage%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fmessages%2Fstorage%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Fstorage%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,7 +1,7 @@\n from __future__ import unicode_literals\n \n from django.conf import settings\n-from django.utils.encoding import force_unicode, StrAndUnicode\n+from django.utils.encoding import force_text, StrAndUnicode\n from django.contrib.messages import constants, utils\n \n \n@@ -26,22 +26,22 @@ def _prepare(self):\n         and ``extra_tags`` to unicode in case they are lazy translations.\n \n         Known \"safe\" types (None, int, etc.) are not converted (see Django's\n-        ``force_unicode`` implementation for details).\n+        ``force_text`` implementation for details).\n         \"\"\"\n-        self.message = force_unicode(self.message, strings_only=True)\n-        self.extra_tags = force_unicode(self.extra_tags, strings_only=True)\n+        self.message = force_text(self.message, strings_only=True)\n+        self.extra_tags = force_text(self.extra_tags, strings_only=True)\n \n     def __eq__(self, other):\n         return isinstance(other, Message) and self.level == other.level and \\\n                                               self.message == other.message\n \n     def __unicode__(self):\n-        return force_unicode(self.message)\n+        return force_text(self.message)\n \n     def _get_tags(self):\n-        label_tag = force_unicode(LEVEL_TAGS.get(self.level, ''),\n+        label_tag = force_text(LEVEL_TAGS.get(self.level, ''),\n                                   strings_only=True)\n-        extra_tags = force_unicode(self.extra_tags, strings_only=True)\n+        extra_tags = force_text(self.extra_tags, strings_only=True)\n         if extra_tags and label_tag:\n             return ' '.join([extra_tags, label_tag])\n         elif extra_tags:"
        },
        {
            "sha": "5f64ccd0c5d1a02df6afb38741e04ce2d8868561",
            "filename": "django/contrib/messages/storage/cookie.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fmessages%2Fstorage%2Fcookie.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fmessages%2Fstorage%2Fcookie.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fmessages%2Fstorage%2Fcookie.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,6 +4,7 @@\n from django.contrib.messages.storage.base import BaseStorage, Message\n from django.http import SimpleCookie\n from django.utils.crypto import salted_hmac, constant_time_compare\n+from django.utils import six\n \n \n class MessageEncoder(json.JSONEncoder):\n@@ -33,7 +34,7 @@ def process_messages(self, obj):\n             return [self.process_messages(item) for item in obj]\n         if isinstance(obj, dict):\n             return dict([(key, self.process_messages(value))\n-                         for key, value in obj.iteritems()])\n+                         for key, value in six.iteritems(obj)])\n         return obj\n \n     def decode(self, s, **kwargs):"
        },
        {
            "sha": "0cc17b44c31602dde04f7415ee8af1ade237c6cb",
            "filename": "django/contrib/sessions/backends/db.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fdb.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,7 +1,7 @@\n from django.contrib.sessions.backends.base import SessionBase, CreateError\n from django.core.exceptions import SuspiciousOperation\n from django.db import IntegrityError, transaction, router\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils import timezone\n \n \n@@ -18,7 +18,7 @@ def load(self):\n                 session_key = self.session_key,\n                 expire_date__gt=timezone.now()\n             )\n-            return self.decode(force_unicode(s.session_data))\n+            return self.decode(force_text(s.session_data))\n         except (Session.DoesNotExist, SuspiciousOperation):\n             self.create()\n             return {}"
        },
        {
            "sha": "7de2941122fd91e0885dead7bf627fd19bad2ee2",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -16,6 +16,7 @@\n from django.http import HttpResponse\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n+from django.utils import six\n from django.utils import timezone\n from django.utils import unittest\n \n@@ -86,16 +87,16 @@ def test_has_key(self):\n         self.assertFalse(self.session.modified)\n \n     def test_values(self):\n-        self.assertEqual(self.session.values(), [])\n+        self.assertEqual(list(self.session.values()), [])\n         self.assertTrue(self.session.accessed)\n         self.session['some key'] = 1\n-        self.assertEqual(self.session.values(), [1])\n+        self.assertEqual(list(self.session.values()), [1])\n \n     def test_iterkeys(self):\n         self.session['x'] = 1\n         self.session.modified = False\n         self.session.accessed = False\n-        i = self.session.iterkeys()\n+        i = six.iterkeys(self.session)\n         self.assertTrue(hasattr(i, '__iter__'))\n         self.assertTrue(self.session.accessed)\n         self.assertFalse(self.session.modified)\n@@ -105,7 +106,7 @@ def test_itervalues(self):\n         self.session['x'] = 1\n         self.session.modified = False\n         self.session.accessed = False\n-        i = self.session.itervalues()\n+        i = six.itervalues(self.session)\n         self.assertTrue(hasattr(i, '__iter__'))\n         self.assertTrue(self.session.accessed)\n         self.assertFalse(self.session.modified)\n@@ -115,7 +116,7 @@ def test_iteritems(self):\n         self.session['x'] = 1\n         self.session.modified = False\n         self.session.accessed = False\n-        i = self.session.iteritems()\n+        i = six.iteritems(self.session)\n         self.assertTrue(hasattr(i, '__iter__'))\n         self.assertTrue(self.session.accessed)\n         self.assertFalse(self.session.modified)\n@@ -125,9 +126,9 @@ def test_clear(self):\n         self.session['x'] = 1\n         self.session.modified = False\n         self.session.accessed = False\n-        self.assertEqual(self.session.items(), [('x', 1)])\n+        self.assertEqual(list(self.session.items()), [('x', 1)])\n         self.session.clear()\n-        self.assertEqual(self.session.items(), [])\n+        self.assertEqual(list(self.session.items()), [])\n         self.assertTrue(self.session.accessed)\n         self.assertTrue(self.session.modified)\n \n@@ -154,10 +155,10 @@ def test_cycle(self):\n         self.session['a'], self.session['b'] = 'c', 'd'\n         self.session.save()\n         prev_key = self.session.session_key\n-        prev_data = self.session.items()\n+        prev_data = list(self.session.items())\n         self.session.cycle_key()\n         self.assertNotEqual(self.session.session_key, prev_key)\n-        self.assertEqual(self.session.items(), prev_data)\n+        self.assertEqual(list(self.session.items()), prev_data)\n \n     def test_invalid_key(self):\n         # Submitting an invalid session key (either by guessing, or if the db has"
        },
        {
            "sha": "cfe3aa66a9261aad25b3a35254030438afd179b0",
            "filename": "django/contrib/sitemaps/views.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsitemaps%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsitemaps%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsitemaps%2Fviews.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,6 +3,7 @@\n from django.core.paginator import EmptyPage, PageNotAnInteger\n from django.http import Http404\n from django.template.response import TemplateResponse\n+from django.utils import six\n \n def index(request, sitemaps,\n           template_name='sitemap_index.xml', mimetype='application/xml',\n@@ -35,7 +36,7 @@ def sitemap(request, sitemaps, section=None,\n             raise Http404(\"No sitemap available for section: %r\" % section)\n         maps = [sitemaps[section]]\n     else:\n-        maps = sitemaps.values()\n+        maps = list(six.itervalues(sitemaps))\n     page = request.GET.get(\"p\", 1)\n \n     urls = []"
        },
        {
            "sha": "9b06c2cf60c9a2d3c89a25b5e1ab64ec1836a618",
            "filename": "django/contrib/staticfiles/finders.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Ffinders.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Ffinders.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Ffinders.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,6 +6,7 @@\n from django.utils.functional import empty, memoize, LazyObject\n from django.utils.importlib import import_module\n from django.utils._os import safe_join\n+from django.utils import six\n \n from django.contrib.staticfiles import utils\n from django.contrib.staticfiles.storage import AppStaticStorage\n@@ -132,7 +133,7 @@ def list(self, ignore_patterns):\n         \"\"\"\n         List all files in all app storages.\n         \"\"\"\n-        for storage in self.storages.itervalues():\n+        for storage in six.itervalues(self.storages):\n             if storage.exists(''):  # check if storage location exists\n                 for path in utils.get_files(storage, ignore_patterns):\n                     yield path, storage"
        },
        {
            "sha": "7dac0ffb4cbbf95212d82405087d58691076e097",
            "filename": "django/contrib/staticfiles/management/commands/collectstatic.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Fcollectstatic.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,8 +6,9 @@\n \n from django.core.files.storage import FileSystemStorage\n from django.core.management.base import CommandError, NoArgsCommand\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.datastructures import SortedDict\n+from django.utils.six.moves import input\n \n from django.contrib.staticfiles import finders, storage\n \n@@ -148,7 +149,7 @@ def handle_noargs(self, **options):\n             clear_display = 'This will overwrite existing files!'\n \n         if self.interactive:\n-            confirm = raw_input(\"\"\"\n+            confirm = input(\"\"\"\n You have requested to collect static files at the destination\n location as specified in your settings%s\n \n@@ -198,9 +199,9 @@ def clear_dir(self, path):\n             fpath = os.path.join(path, f)\n             if self.dry_run:\n                 self.log(\"Pretending to delete '%s'\" %\n-                         smart_unicode(fpath), level=1)\n+                         smart_text(fpath), level=1)\n             else:\n-                self.log(\"Deleting '%s'\" % smart_unicode(fpath), level=1)\n+                self.log(\"Deleting '%s'\" % smart_text(fpath), level=1)\n                 self.storage.delete(fpath)\n         for d in dirs:\n             self.clear_dir(os.path.join(path, d))"
        },
        {
            "sha": "dc1e88d778019cf7e5370975b4595582a02184da",
            "filename": "django/contrib/staticfiles/management/commands/findstatic.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Ffindstatic.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Ffindstatic.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fmanagement%2Fcommands%2Ffindstatic.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n import os\n from optparse import make_option\n from django.core.management.base import LabelCommand\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n \n from django.contrib.staticfiles import finders\n \n@@ -19,12 +19,12 @@ class Command(LabelCommand):\n     def handle_label(self, path, **options):\n         verbosity = int(options.get('verbosity', 1))\n         result = finders.find(path, all=options['all'])\n-        path = smart_unicode(path)\n+        path = smart_text(path)\n         if result:\n             if not isinstance(result, (list, tuple)):\n                 result = [result]\n             output = '\\n  '.join(\n-                (smart_unicode(os.path.realpath(path)) for path in result))\n+                (smart_text(os.path.realpath(path)) for path in result))\n             self.stdout.write(\"Found '%s' here:\\n  %s\" % (path, output))\n         else:\n             if verbosity >= 1:"
        },
        {
            "sha": "2ca54dde71f57bb1985056215d42860451290212",
            "filename": "django/contrib/staticfiles/storage.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fstaticfiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fstaticfiles%2Fstorage.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -16,7 +16,7 @@\n from django.core.files.base import ContentFile\n from django.core.files.storage import FileSystemStorage, get_storage_class\n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import force_unicode, smart_str\n+from django.utils.encoding import force_text, smart_bytes\n from django.utils.functional import LazyObject\n from django.utils.importlib import import_module\n \n@@ -112,7 +112,7 @@ def hashed_name(self, name, content=None):\n         return urlunsplit(unparsed_name)\n \n     def cache_key(self, name):\n-        return 'staticfiles:%s' % hashlib.md5(smart_str(name)).hexdigest()\n+        return 'staticfiles:%s' % hashlib.md5(smart_bytes(name)).hexdigest()\n \n     def url(self, name, force=False):\n         \"\"\"\n@@ -248,17 +248,17 @@ def post_process(self, paths, dry_run=False, **options):\n                     if hashed_file_exists:\n                         self.delete(hashed_name)\n                     # then save the processed result\n-                    content_file = ContentFile(smart_str(content))\n+                    content_file = ContentFile(smart_bytes(content))\n                     saved_name = self._save(hashed_name, content_file)\n-                    hashed_name = force_unicode(saved_name.replace('\\\\', '/'))\n+                    hashed_name = force_text(saved_name.replace('\\\\', '/'))\n                     processed = True\n                 else:\n                     # or handle the case in which neither processing nor\n                     # a change to the original file happened\n                     if not hashed_file_exists:\n                         processed = True\n                         saved_name = self._save(hashed_name, original_file)\n-                        hashed_name = force_unicode(saved_name.replace('\\\\', '/'))\n+                        hashed_name = force_text(saved_name.replace('\\\\', '/'))\n \n                 # and then set the cache accordingly\n                 hashed_paths[self.cache_key(name)] = hashed_name"
        },
        {
            "sha": "bce7ef7cfb894e0b21d65823ac63fec253407da5",
            "filename": "django/contrib/syndication/views.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcontrib%2Fsyndication%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsyndication%2Fviews.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,7 +6,7 @@\n from django.http import HttpResponse, Http404\n from django.template import loader, TemplateDoesNotExist, RequestContext\n from django.utils import feedgenerator, tzinfo\n-from django.utils.encoding import force_unicode, iri_to_uri, smart_unicode\n+from django.utils.encoding import force_text, iri_to_uri, smart_text\n from django.utils.html import escape\n from django.utils.timezone import is_naive\n \n@@ -43,10 +43,10 @@ def __call__(self, request, *args, **kwargs):\n \n     def item_title(self, item):\n         # Titles should be double escaped by default (see #6533)\n-        return escape(force_unicode(item))\n+        return escape(force_text(item))\n \n     def item_description(self, item):\n-        return force_unicode(item)\n+        return force_text(item)\n \n     def item_link(self, item):\n         try:\n@@ -154,9 +154,9 @@ def get_feed(self, obj, request):\n             enc_url = self.__get_dynamic_attr('item_enclosure_url', item)\n             if enc_url:\n                 enc = feedgenerator.Enclosure(\n-                    url = smart_unicode(enc_url),\n-                    length = smart_unicode(self.__get_dynamic_attr('item_enclosure_length', item)),\n-                    mime_type = smart_unicode(self.__get_dynamic_attr('item_enclosure_mime_type', item))\n+                    url = smart_text(enc_url),\n+                    length = smart_text(self.__get_dynamic_attr('item_enclosure_length', item)),\n+                    mime_type = smart_text(self.__get_dynamic_attr('item_enclosure_mime_type', item))\n                 )\n             author_name = self.__get_dynamic_attr('item_author_name', item)\n             if author_name is not None:"
        },
        {
            "sha": "d527e44d8b37a7b6da07de76dc990a40d9a54d46",
            "filename": "django/core/cache/backends/base.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fcache%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcache%2Fbackends%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n import warnings\n \n from django.core.exceptions import ImproperlyConfigured, DjangoRuntimeWarning\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils.importlib import import_module\n \n class InvalidCacheBackendError(ImproperlyConfigured):\n@@ -23,7 +23,7 @@ def default_key_func(key, key_prefix, version):\n     the `key_prefix'. KEY_FUNCTION can be used to specify an alternate\n     function with custom key making behavior.\n     \"\"\"\n-    return ':'.join([key_prefix, str(version), smart_str(key)])\n+    return ':'.join([key_prefix, str(version), smart_bytes(key)])\n \n def get_key_func(key_func):\n     \"\"\"\n@@ -62,7 +62,7 @@ def __init__(self, params):\n         except (ValueError, TypeError):\n             self._cull_frequency = 3\n \n-        self.key_prefix = smart_str(params.get('KEY_PREFIX', ''))\n+        self.key_prefix = smart_bytes(params.get('KEY_PREFIX', ''))\n         self.version = params.get('VERSION', 1)\n         self.key_func = get_key_func(params.get('KEY_FUNCTION', None))\n "
        },
        {
            "sha": "a503270cf4aca66600ae5332e84673f6c2e71b30",
            "filename": "django/core/context_processors.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcontext_processors.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n \n from django.conf import settings\n from django.middleware.csrf import get_token\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils.functional import lazy\n \n def csrf(request):\n@@ -25,7 +25,7 @@ def _get_val():\n             # instead of returning an empty dict.\n             return b'NOTPROVIDED'\n         else:\n-            return smart_str(token)\n+            return smart_bytes(token)\n     _get_val = lazy(_get_val, str)\n \n     return {'csrf_token': _get_val() }"
        },
        {
            "sha": "f0f14cffda3a6cff792eed10c92363e80b7777ee",
            "filename": "django/core/exceptions.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fexceptions.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fexceptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fexceptions.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -43,7 +43,7 @@ class ValidationError(Exception):\n     \"\"\"An error while validating data.\"\"\"\n     def __init__(self, message, code=None, params=None):\n         import operator\n-        from django.utils.encoding import force_unicode\n+        from django.utils.encoding import force_text\n         \"\"\"\n         ValidationError can be passed any object that can be printed (usually\n         a string), a list of objects or a dictionary.\n@@ -54,11 +54,11 @@ def __init__(self, message, code=None, params=None):\n             message = reduce(operator.add, message.values())\n \n         if isinstance(message, list):\n-            self.messages = [force_unicode(msg) for msg in message]\n+            self.messages = [force_text(msg) for msg in message]\n         else:\n             self.code = code\n             self.params = params\n-            message = force_unicode(message)\n+            message = force_text(message)\n             self.messages = [message]\n \n     def __str__(self):"
        },
        {
            "sha": "d0b25250a5afc2b2e66643dca9d1e874b7bc0407",
            "filename": "django/core/files/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n import os\n from io import BytesIO\n \n-from django.utils.encoding import smart_str, smart_unicode\n+from django.utils.encoding import smart_bytes, smart_text\n from django.core.files.utils import FileProxyMixin\n \n class File(FileProxyMixin):\n@@ -18,16 +18,17 @@ def __init__(self, file, name=None):\n             self.mode = file.mode\n \n     def __str__(self):\n-        return smart_str(self.name or '')\n+        return smart_bytes(self.name or '')\n \n     def __unicode__(self):\n-        return smart_unicode(self.name or '')\n+        return smart_text(self.name or '')\n \n     def __repr__(self):\n         return \"<%s: %s>\" % (self.__class__.__name__, self or \"None\")\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         return bool(self.name)\n+    __nonzero__ = __bool__ # Python 2\n \n     def __len__(self):\n         return self.size\n@@ -135,8 +136,9 @@ def __init__(self, content, name=None):\n     def __str__(self):\n         return 'Raw content'\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         return True\n+    __nonzero__ = __bool__ # Python 2\n \n     def open(self, mode=None):\n         self.seek(0)"
        },
        {
            "sha": "7d7eac65db934e40e8784cc86460d983be0b6795",
            "filename": "django/core/files/images.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fimages.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fimages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fimages.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -47,13 +47,18 @@ def get_image_dimensions(file_or_path, close=False):\n         file = open(file_or_path, 'rb')\n         close = True\n     try:\n+        # Most of the time PIL only needs a small chunk to parse the image and\n+        # get the dimensions, but with some TIFF files PIL needs to parse the\n+        # whole file.\n+        chunk_size = 1024\n         while 1:\n-            data = file.read(1024)\n+            data = file.read(chunk_size)\n             if not data:\n                 break\n             p.feed(data)\n             if p.image:\n                 return p.image.size\n+            chunk_size = chunk_size*2\n         return None\n     finally:\n         if close:"
        },
        {
            "sha": "7542dcda46dd44ab2c920ce97ddf42b619ca6ca5",
            "filename": "django/core/files/storage.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fstorage.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fstorage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fstorage.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,7 +11,7 @@\n from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.core.files import locks, File\n from django.core.files.move import file_move_safe\n-from django.utils.encoding import force_unicode, filepath_to_uri\n+from django.utils.encoding import force_text, filepath_to_uri\n from django.utils.functional import LazyObject\n from django.utils.importlib import import_module\n from django.utils.text import get_valid_filename\n@@ -48,7 +48,7 @@ def save(self, name, content):\n         name = self._save(name, content)\n \n         # Store filenames with forward slashes, even on Windows\n-        return force_unicode(name.replace('\\\\', '/'))\n+        return force_text(name.replace('\\\\', '/'))\n \n     # These methods are part of the public API, with default implementations.\n "
        },
        {
            "sha": "3a6c63297598efb90e5e948f5c2bd2161051809b",
            "filename": "django/core/files/uploadedfile.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fuploadedfile.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Ffiles%2Fuploadedfile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Ffiles%2Fuploadedfile.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.conf import settings\n from django.core.files.base import File\n from django.core.files import temp as tempfile\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n \n __all__ = ('UploadedFile', 'TemporaryUploadedFile', 'InMemoryUploadedFile',\n            'SimpleUploadedFile')\n@@ -30,7 +30,7 @@ def __init__(self, file=None, name=None, content_type=None, size=None, charset=N\n         self.charset = charset\n \n     def __repr__(self):\n-        return smart_str(\"<%s: %s (%s)>\" % (\n+        return smart_bytes(\"<%s: %s (%s)>\" % (\n             self.__class__.__name__, self.name, self.content_type))\n \n     def _get_name(self):"
        },
        {
            "sha": "5a6825f0a798ca3b521b45f7fb53074dd6b91a1c",
            "filename": "django/core/handlers/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fhandlers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fhandlers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,7 +4,7 @@\n \n from django import http\n from django.core import signals\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.importlib import import_module\n from django.utils.log import getLogger\n from django.utils import six\n@@ -250,7 +250,7 @@ def get_script_name(environ):\n     \"\"\"\n     from django.conf import settings\n     if settings.FORCE_SCRIPT_NAME is not None:\n-        return force_unicode(settings.FORCE_SCRIPT_NAME)\n+        return force_text(settings.FORCE_SCRIPT_NAME)\n \n     # If Apache's mod_rewrite had a whack at the URL, Apache set either\n     # SCRIPT_URL or REDIRECT_URL to the full resource URL before applying any\n@@ -261,5 +261,5 @@ def get_script_name(environ):\n     if not script_url:\n         script_url = environ.get('REDIRECT_URL', '')\n     if script_url:\n-        return force_unicode(script_url[:-len(environ.get('PATH_INFO', ''))])\n-    return force_unicode(environ.get('SCRIPT_NAME', ''))\n+        return force_text(script_url[:-len(environ.get('PATH_INFO', ''))])\n+    return force_text(environ.get('SCRIPT_NAME', ''))"
        },
        {
            "sha": "70b23f851544c12e5891227b2c6a8d1cb7190e65",
            "filename": "django/core/handlers/wsgi.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fhandlers%2Fwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fhandlers%2Fwsgi.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.core.handlers import base\n from django.core.urlresolvers import set_script_prefix\n from django.utils import datastructures\n-from django.utils.encoding import force_unicode, smart_str, iri_to_uri\n+from django.utils.encoding import force_text, smart_bytes, iri_to_uri\n from django.utils.log import getLogger\n \n logger = getLogger('django.request')\n@@ -127,7 +127,7 @@ def readline(self, size=None):\n class WSGIRequest(http.HttpRequest):\n     def __init__(self, environ):\n         script_name = base.get_script_name(environ)\n-        path_info = force_unicode(environ.get('PATH_INFO', '/'))\n+        path_info = force_text(environ.get('PATH_INFO', '/'))\n         if not path_info or path_info == script_name:\n             # Sometimes PATH_INFO exists, but is empty (e.g. accessing\n             # the SCRIPT_NAME URL without a trailing slash). We really need to\n@@ -245,6 +245,6 @@ def __call__(self, environ, start_response):\n         status = '%s %s' % (response.status_code, status_text)\n         response_headers = [(str(k), str(v)) for k, v in response.items()]\n         for c in response.cookies.values():\n-            response_headers.append((b'Set-Cookie', str(c.output(header=''))))\n-        start_response(smart_str(status), response_headers)\n+            response_headers.append((str('Set-Cookie'), str(c.output(header=''))))\n+        start_response(smart_bytes(status), response_headers)\n         return response"
        },
        {
            "sha": "b332ffba04fa7fbdb4fa7e8af2a78ff3b0599479",
            "filename": "django/core/mail/message.py",
            "status": "modified",
            "additions": 19,
            "deletions": 19,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmail%2Fmessage.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmail%2Fmessage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmail%2Fmessage.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,11 +11,10 @@\n from email.mime.base import MIMEBase\n from email.header import Header\n from email.utils import formatdate, getaddresses, formataddr, parseaddr\n-from io import BytesIO\n \n from django.conf import settings\n from django.core.mail.utils import DNS_NAME\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import force_text\n from django.utils import six\n \n \n@@ -79,38 +78,38 @@ def make_msgid(idstring=None):\n def forbid_multi_line_headers(name, val, encoding):\n     \"\"\"Forbids multi-line headers, to prevent header injection.\"\"\"\n     encoding = encoding or settings.DEFAULT_CHARSET\n-    val = force_unicode(val)\n+    val = force_text(val)\n     if '\\n' in val or '\\r' in val:\n         raise BadHeaderError(\"Header values can't contain newlines (got %r for header %r)\" % (val, name))\n     try:\n-        val = val.encode('ascii')\n+        val.encode('ascii')\n     except UnicodeEncodeError:\n         if name.lower() in ADDRESS_HEADERS:\n             val = ', '.join(sanitize_address(addr, encoding)\n                 for addr in getaddresses((val,)))\n         else:\n-            val = str(Header(val, encoding))\n+            val = Header(val, encoding).encode()\n     else:\n         if name.lower() == 'subject':\n-            val = Header(val)\n-    return smart_str(name), val\n+            val = Header(val).encode()\n+    return str(name), val\n \n \n def sanitize_address(addr, encoding):\n     if isinstance(addr, six.string_types):\n-        addr = parseaddr(force_unicode(addr))\n+        addr = parseaddr(force_text(addr))\n     nm, addr = addr\n-    nm = str(Header(nm, encoding))\n+    nm = Header(nm, encoding).encode()\n     try:\n-        addr = addr.encode('ascii')\n+        addr.encode('ascii')\n     except UnicodeEncodeError:  # IDN\n         if '@' in addr:\n             localpart, domain = addr.split('@', 1)\n             localpart = str(Header(localpart, encoding))\n-            domain = domain.encode('idna')\n+            domain = domain.encode('idna').decode('ascii')\n             addr = '@'.join([localpart, domain])\n         else:\n-            addr = str(Header(addr, encoding))\n+            addr = Header(addr, encoding).encode()\n     return formataddr((nm, addr))\n \n \n@@ -132,7 +131,7 @@ def as_string(self, unixfrom=False):\n         This overrides the default as_string() implementation to not mangle\n         lines that begin with 'From '. See bug #13433 for details.\n         \"\"\"\n-        fp = BytesIO()\n+        fp = six.StringIO()\n         g = Generator(fp, mangle_from_ = False)\n         g.flatten(self, unixfrom=unixfrom)\n         return fp.getvalue()\n@@ -156,7 +155,7 @@ def as_string(self, unixfrom=False):\n         This overrides the default as_string() implementation to not mangle\n         lines that begin with 'From '. See bug #13433 for details.\n         \"\"\"\n-        fp = BytesIO()\n+        fp = six.StringIO()\n         g = Generator(fp, mangle_from_ = False)\n         g.flatten(self, unixfrom=unixfrom)\n         return fp.getvalue()\n@@ -210,8 +209,7 @@ def get_connection(self, fail_silently=False):\n \n     def message(self):\n         encoding = self.encoding or settings.DEFAULT_CHARSET\n-        msg = SafeMIMEText(smart_str(self.body, encoding),\n-                           self.content_subtype, encoding)\n+        msg = SafeMIMEText(self.body, self.content_subtype, encoding)\n         msg = self._create_message(msg)\n         msg['Subject'] = self.subject\n         msg['From'] = self.extra_headers.get('From', self.from_email)\n@@ -293,7 +291,7 @@ def _create_mime_attachment(self, content, mimetype):\n         basetype, subtype = mimetype.split('/', 1)\n         if basetype == 'text':\n             encoding = self.encoding or settings.DEFAULT_CHARSET\n-            attachment = SafeMIMEText(smart_str(content, encoding), subtype, encoding)\n+            attachment = SafeMIMEText(content, subtype, encoding)\n         else:\n             # Encode non-text attachments with base64.\n             attachment = MIMEBase(basetype, subtype)\n@@ -313,9 +311,11 @@ def _create_attachment(self, filename, content, mimetype=None):\n         attachment = self._create_mime_attachment(content, mimetype)\n         if filename:\n             try:\n-                filename = filename.encode('ascii')\n+                filename.encode('ascii')\n             except UnicodeEncodeError:\n-                filename = ('utf-8', '', filename.encode('utf-8'))\n+                if not six.PY3:\n+                    filename = filename.encode('utf-8')\n+                filename = ('utf-8', '', filename)\n             attachment.add_header('Content-Disposition', 'attachment',\n                                   filename=filename)\n         return attachment"
        },
        {
            "sha": "268cd63c38816c4d8ddf02fc6c0c83a295c1257c",
            "filename": "django/core/management/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,6 +8,7 @@\n from django.core.management.base import BaseCommand, CommandError, handle_default_options\n from django.core.management.color import color_style\n from django.utils.importlib import import_module\n+from django.utils import six\n \n # For backwards compatibility: get_version() used to be in this module.\n from django import get_version\n@@ -228,7 +229,7 @@ def main_help_text(self, commands_only=False):\n                 \"Available subcommands:\",\n             ]\n             commands_dict = collections.defaultdict(lambda: [])\n-            for name, app in get_commands().iteritems():\n+            for name, app in six.iteritems(get_commands()):\n                 if app == 'django.core':\n                     app = 'django'\n                 else:\n@@ -294,7 +295,7 @@ def autocomplete(self):\n         except IndexError:\n             curr = ''\n \n-        subcommands = get_commands().keys() + ['help']\n+        subcommands = list(get_commands()) + ['help']\n         options = [('--help', None)]\n \n         # subcommand"
        },
        {
            "sha": "5e630d520708fc52166750a4033513ad6c5b57aa",
            "filename": "django/core/management/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,14 +6,14 @@\n import os\n import sys\n \n-from io import BytesIO\n from optparse import make_option, OptionParser\n import traceback\n \n import django\n from django.core.exceptions import ImproperlyConfigured\n from django.core.management.color import color_style\n from django.utils.encoding import smart_str\n+from django.utils.six import StringIO\n \n \n class CommandError(Exception):\n@@ -273,7 +273,7 @@ def validate(self, app=None, display_num_errors=False):\n \n         \"\"\"\n         from django.core.management.validation import get_validation_errors\n-        s = BytesIO()\n+        s = StringIO()\n         num_errors = get_validation_errors(s, app)\n         if num_errors:\n             s.seek(0)"
        },
        {
            "sha": "b7392b9173302719925d41bd21534a1c1010333e",
            "filename": "django/core/management/commands/compilemessages.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcompilemessages.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,3 +1,5 @@\n+from __future__ import unicode_literals\n+\n import codecs\n import os\n import sys\n@@ -7,7 +9,7 @@\n def has_bom(fn):\n     with open(fn, 'rb') as f:\n         sample = f.read(4)\n-    return sample[:3] == '\\xef\\xbb\\xbf' or \\\n+    return sample[:3] == b'\\xef\\xbb\\xbf' or \\\n             sample.startswith(codecs.BOM_UTF16_LE) or \\\n             sample.startswith(codecs.BOM_UTF16_BE)\n "
        },
        {
            "sha": "411042ee764cc2cd1382171fcb418d9d107ee851",
            "filename": "django/core/management/commands/createcachetable.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fcreatecachetable.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fcreatecachetable.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fcreatecachetable.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,7 +4,7 @@\n from django.core.management.base import LabelCommand, CommandError\n from django.db import connections, router, transaction, models, DEFAULT_DB_ALIAS\n from django.db.utils import DatabaseError\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n \n class Command(LabelCommand):\n@@ -60,7 +60,7 @@ def handle_label(self, tablename, **options):\n             transaction.rollback_unless_managed(using=db)\n             raise CommandError(\n                 \"Cache table '%s' could not be created.\\nThe error was: %s.\" %\n-                    (tablename, force_unicode(e)))\n+                    (tablename, force_text(e)))\n         for statement in index_output:\n             curs.execute(statement)\n         transaction.commit_unless_managed(using=db)"
        },
        {
            "sha": "aa7395e5eea0bea4fbbcd6e782992ac5cfac2745",
            "filename": "django/core/management/commands/diffsettings.py",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fdiffsettings.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fdiffsettings.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fdiffsettings.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -22,9 +22,7 @@ def handle_noargs(self, **options):\n         default_settings = module_to_dict(global_settings)\n \n         output = []\n-        keys = user_settings.keys()\n-        keys.sort()\n-        for key in keys:\n+        for key in sorted(user_settings.keys()):\n             if key not in default_settings:\n                 output.append(\"%s = %s  ###\" % (key, user_settings[key]))\n             elif user_settings[key] != default_settings[key]:"
        },
        {
            "sha": "b8b78434ceb8500e1dbba8171a7818059df8bd81",
            "filename": "django/core/management/commands/flush.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fflush.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Fflush.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fflush.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,6 +7,7 @@\n from django.core.management.color import no_style\n from django.core.management.sql import sql_flush, emit_post_sync_signal\n from django.utils.importlib import import_module\n+from django.utils.six.moves import input\n \n \n class Command(NoArgsCommand):\n@@ -45,7 +46,7 @@ def handle_noargs(self, **options):\n         sql_list = sql_flush(self.style, connection, only_django=True, reset_sequences=reset_sequences)\n \n         if interactive:\n-            confirm = raw_input(\"\"\"You have requested a flush of the database.\n+            confirm = input(\"\"\"You have requested a flush of the database.\n This will IRREVERSIBLY DESTROY all data currently in the %r database,\n and return each table to the state it was in after syncdb.\n Are you sure you want to do this?"
        },
        {
            "sha": "1896e53cee7798c67d533b17f5cc44a5e02f5fc1",
            "filename": "django/core/management/commands/loaddata.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Floaddata.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -14,7 +14,7 @@\n from django.db import (connections, router, transaction, DEFAULT_DB_ALIAS,\n       IntegrityError, DatabaseError)\n from django.db.models import get_apps\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from itertools import product\n \n try:\n@@ -189,7 +189,7 @@ def read(self):\n                                                         'app_label': obj.object._meta.app_label,\n                                                         'object_name': obj.object._meta.object_name,\n                                                         'pk': obj.object.pk,\n-                                                        'error_msg': force_unicode(e)\n+                                                        'error_msg': force_text(e)\n                                                     },)\n                                                 raise\n "
        },
        {
            "sha": "cf7e66190f4490e0f7b039318656d9b3b318eece",
            "filename": "django/core/serializers/__init__.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -18,6 +18,7 @@\n \n from django.conf import settings\n from django.utils import importlib\n+from django.utils import six\n from django.core.serializers.base import SerializerDoesNotExist\n \n # Built-in serializers\n@@ -75,12 +76,12 @@ def get_serializer(format):\n def get_serializer_formats():\n     if not _serializers:\n         _load_serializers()\n-    return _serializers.keys()\n+    return list(_serializers)\n \n def get_public_serializer_formats():\n     if not _serializers:\n         _load_serializers()\n-    return [k for k, v in _serializers.iteritems() if not v.Serializer.internal_use_only]\n+    return [k for k, v in six.iteritems(_serializers) if not v.Serializer.internal_use_only]\n \n def get_deserializer(format):\n     if not _serializers:"
        },
        {
            "sha": "bdb43db9f364b947f63f0680055bed7a8bd1621a",
            "filename": "django/core/serializers/base.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n from io import BytesIO\n \n from django.db import models\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils import six\n \n class SerializerDoesNotExist(KeyError):\n@@ -136,10 +136,12 @@ def __init__(self, stream_or_string, **options):\n     def __iter__(self):\n         return self\n \n-    def next(self):\n+    def __next__(self):\n         \"\"\"Iteration iterface -- return the next item in the stream\"\"\"\n         raise NotImplementedError\n \n+    next = __next__             # Python 2 compatibility\n+\n class DeserializedObject(object):\n     \"\"\"\n     A deserialized model."
        },
        {
            "sha": "3bac24d33ad94624397cac5beb5fdfd9d00a6fd6",
            "filename": "django/core/serializers/json.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fjson.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fjson.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fjson.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n from django.core.serializers.base import DeserializationError\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils import six\n from django.utils.timezone import is_aware\n "
        },
        {
            "sha": "a1fff6f9bbc37517e4dfa893e31883579f94e819",
            "filename": "django/core/serializers/python.py",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fpython.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fpython.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpython.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,8 @@\n from django.conf import settings\n from django.core.serializers import base\n from django.db import models, DEFAULT_DB_ALIAS\n-from django.utils.encoding import smart_unicode, is_protected_type\n+from django.utils.encoding import smart_text, is_protected_type\n+from django.utils import six\n \n class Serializer(base.Serializer):\n     \"\"\"\n@@ -33,8 +34,8 @@ def end_object(self, obj):\n \n     def get_dump_object(self, obj):\n         return {\n-            \"pk\": smart_unicode(obj._get_pk_val(), strings_only=True),\n-            \"model\": smart_unicode(obj._meta),\n+            \"pk\": smart_text(obj._get_pk_val(), strings_only=True),\n+            \"model\": smart_text(obj._meta),\n             \"fields\": self._current\n         }\n \n@@ -64,7 +65,7 @@ def handle_m2m_field(self, obj, field):\n             if self.use_natural_keys and hasattr(field.rel.to, 'natural_key'):\n                 m2m_value = lambda value: value.natural_key()\n             else:\n-                m2m_value = lambda value: smart_unicode(value._get_pk_val(), strings_only=True)\n+                m2m_value = lambda value: smart_text(value._get_pk_val(), strings_only=True)\n             self._current[field.name] = [m2m_value(related)\n                                for related in getattr(obj, field.name).iterator()]\n \n@@ -87,29 +88,29 @@ def Deserializer(object_list, **options):\n         m2m_data = {}\n \n         # Handle each field\n-        for (field_name, field_value) in d[\"fields\"].iteritems():\n+        for (field_name, field_value) in six.iteritems(d[\"fields\"]):\n             if isinstance(field_value, str):\n-                field_value = smart_unicode(field_value, options.get(\"encoding\", settings.DEFAULT_CHARSET), strings_only=True)\n+                field_value = smart_text(field_value, options.get(\"encoding\", settings.DEFAULT_CHARSET), strings_only=True)\n \n             field = Model._meta.get_field(field_name)\n \n             # Handle M2M relations\n             if field.rel and isinstance(field.rel, models.ManyToManyRel):\n                 if hasattr(field.rel.to._default_manager, 'get_by_natural_key'):\n                     def m2m_convert(value):\n-                        if hasattr(value, '__iter__'):\n+                        if hasattr(value, '__iter__') and not isinstance(value, six.text_type):\n                             return field.rel.to._default_manager.db_manager(db).get_by_natural_key(*value).pk\n                         else:\n-                            return smart_unicode(field.rel.to._meta.pk.to_python(value))\n+                            return smart_text(field.rel.to._meta.pk.to_python(value))\n                 else:\n-                    m2m_convert = lambda v: smart_unicode(field.rel.to._meta.pk.to_python(v))\n+                    m2m_convert = lambda v: smart_text(field.rel.to._meta.pk.to_python(v))\n                 m2m_data[field.name] = [m2m_convert(pk) for pk in field_value]\n \n             # Handle FK fields\n             elif field.rel and isinstance(field.rel, models.ManyToOneRel):\n                 if field_value is not None:\n                     if hasattr(field.rel.to._default_manager, 'get_by_natural_key'):\n-                        if hasattr(field_value, '__iter__'):\n+                        if hasattr(field_value, '__iter__') and not isinstance(field_value, six.text_type):\n                             obj = field.rel.to._default_manager.db_manager(db).get_by_natural_key(*field_value)\n                             value = getattr(obj, field.rel.field_name)\n                             # If this is a natural foreign key to an object that"
        },
        {
            "sha": "9be1ea44925ead029126c2b0d8b7f3c266ee8864",
            "filename": "django/core/serializers/pyyaml.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fpyyaml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fpyyaml.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n from django.core.serializers.base import DeserializationError\n from django.core.serializers.python import Serializer as PythonSerializer\n from django.core.serializers.python import Deserializer as PythonDeserializer\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils import six\n \n "
        },
        {
            "sha": "666587dc776afbcaa3da440d756e27f368365b51",
            "filename": "django/core/serializers/xml_serializer.py",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fxml_serializer.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fserializers%2Fxml_serializer.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fserializers%2Fxml_serializer.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.core.serializers import base\n from django.db import models, DEFAULT_DB_ALIAS\n from django.utils.xmlutils import SimplerXMLGenerator\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from xml.dom import pulldom\n \n class Serializer(base.Serializer):\n@@ -46,11 +46,11 @@ def start_object(self, obj):\n         self.indent(1)\n         obj_pk = obj._get_pk_val()\n         if obj_pk is None:\n-            attrs = {\"model\": smart_unicode(obj._meta),}\n+            attrs = {\"model\": smart_text(obj._meta),}\n         else:\n             attrs = {\n-                \"pk\": smart_unicode(obj._get_pk_val()),\n-                \"model\": smart_unicode(obj._meta),\n+                \"pk\": smart_text(obj._get_pk_val()),\n+                \"model\": smart_text(obj._meta),\n             }\n \n         self.xml.startElement(\"object\", attrs)\n@@ -96,10 +96,10 @@ def handle_fk_field(self, obj, field):\n                 # Iterable natural keys are rolled out as subelements\n                 for key_value in related:\n                     self.xml.startElement(\"natural\", {})\n-                    self.xml.characters(smart_unicode(key_value))\n+                    self.xml.characters(smart_text(key_value))\n                     self.xml.endElement(\"natural\")\n             else:\n-                self.xml.characters(smart_unicode(related_att))\n+                self.xml.characters(smart_text(related_att))\n         else:\n             self.xml.addQuickElement(\"None\")\n         self.xml.endElement(\"field\")\n@@ -120,13 +120,13 @@ def handle_m2m(value):\n                     self.xml.startElement(\"object\", {})\n                     for key_value in natural:\n                         self.xml.startElement(\"natural\", {})\n-                        self.xml.characters(smart_unicode(key_value))\n+                        self.xml.characters(smart_text(key_value))\n                         self.xml.endElement(\"natural\")\n                     self.xml.endElement(\"object\")\n             else:\n                 def handle_m2m(value):\n                     self.xml.addQuickElement(\"object\", attrs={\n-                        'pk' : smart_unicode(value._get_pk_val())\n+                        'pk' : smart_text(value._get_pk_val())\n                     })\n             for relobj in getattr(obj, field.name).iterator():\n                 handle_m2m(relobj)\n@@ -141,7 +141,7 @@ def _start_relational_field(self, field):\n         self.xml.startElement(\"field\", {\n             \"name\" : field.name,\n             \"rel\"  : field.rel.__class__.__name__,\n-            \"to\"   : smart_unicode(field.rel.to._meta),\n+            \"to\"   : smart_text(field.rel.to._meta),\n         })\n \n class Deserializer(base.Deserializer):\n@@ -154,13 +154,15 @@ def __init__(self, stream_or_string, **options):\n         self.event_stream = pulldom.parse(self.stream)\n         self.db = options.pop('using', DEFAULT_DB_ALIAS)\n \n-    def next(self):\n+    def __next__(self):\n         for event, node in self.event_stream:\n             if event == \"START_ELEMENT\" and node.nodeName == \"object\":\n                 self.event_stream.expandNode(node)\n                 return self._handle_object(node)\n         raise StopIteration\n \n+    next = __next__             # Python 2 compatibility\n+\n     def _handle_object(self, node):\n         \"\"\"\n         Convert an <object> node to a DeserializedObject."
        },
        {
            "sha": "9ab8c5b8b0d8f934bf1bb615f3052caa3a69d39c",
            "filename": "django/core/signing.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fsigning.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fsigning.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fsigning.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -41,7 +41,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.utils import baseconv\n from django.utils.crypto import constant_time_compare, salted_hmac\n-from django.utils.encoding import force_unicode, smart_str\n+from django.utils.encoding import force_text, smart_bytes\n from django.utils.importlib import import_module\n \n \n@@ -135,7 +135,7 @@ def loads(s, key=None, salt='django.core.signing', serializer=JSONSerializer, ma\n     \"\"\"\n     Reverse of dumps(), raises BadSignature if signature fails\n     \"\"\"\n-    base64d = smart_str(\n+    base64d = smart_bytes(\n         TimestampSigner(key, salt=salt).unsign(s, max_age=max_age))\n     decompress = False\n     if base64d[0] == '.':\n@@ -159,16 +159,16 @@ def signature(self, value):\n         return base64_hmac(self.salt + 'signer', value, self.key)\n \n     def sign(self, value):\n-        value = smart_str(value)\n+        value = smart_bytes(value)\n         return '%s%s%s' % (value, self.sep, self.signature(value))\n \n     def unsign(self, signed_value):\n-        signed_value = smart_str(signed_value)\n+        signed_value = smart_bytes(signed_value)\n         if not self.sep in signed_value:\n             raise BadSignature('No \"%s\" found in value' % self.sep)\n         value, sig = signed_value.rsplit(self.sep, 1)\n         if constant_time_compare(sig, self.signature(value)):\n-            return force_unicode(value)\n+            return force_text(value)\n         raise BadSignature('Signature \"%s\" does not match' % sig)\n \n \n@@ -178,7 +178,7 @@ def timestamp(self):\n         return baseconv.base62.encode(int(time.time()))\n \n     def sign(self, value):\n-        value = smart_str('%s%s%s' % (value, self.sep, self.timestamp()))\n+        value = smart_bytes('%s%s%s' % (value, self.sep, self.timestamp()))\n         return '%s%s%s' % (value, self.sep, self.signature(value))\n \n     def unsign(self, value, max_age=None):"
        },
        {
            "sha": "2fe744e8eb450d43f72b2cbf7bd800124d33f0ba",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -14,7 +14,7 @@\n from django.http import Http404\n from django.core.exceptions import ImproperlyConfigured, ViewDoesNotExist\n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import iri_to_uri, force_unicode, smart_str\n+from django.utils.encoding import iri_to_uri, force_text, smart_bytes\n from django.utils.functional import memoize, lazy\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n@@ -163,7 +163,7 @@ def regex(self):\n             if isinstance(self._regex, six.string_types):\n                 regex = self._regex\n             else:\n-                regex = force_unicode(self._regex)\n+                regex = force_text(self._regex)\n             try:\n                 compiled_regex = re.compile(regex, re.UNICODE)\n             except re.error as e:\n@@ -190,7 +190,7 @@ def __init__(self, regex, callback, default_args=None, name=None):\n         self.name = name\n \n     def __repr__(self):\n-        return smart_str('<%s %s %s>' % (self.__class__.__name__, self.name, self.regex.pattern))\n+        return smart_bytes('<%s %s %s>' % (self.__class__.__name__, self.name, self.regex.pattern))\n \n     def add_prefix(self, prefix):\n         \"\"\"\n@@ -240,7 +240,7 @@ def __init__(self, regex, urlconf_name, default_kwargs=None, app_name=None, name\n         self._app_dict = {}\n \n     def __repr__(self):\n-        return smart_str('<%s %s (%s:%s) %s>' % (self.__class__.__name__, self.urlconf_name, self.app_name, self.namespace, self.regex.pattern))\n+        return smart_bytes('<%s %s (%s:%s) %s>' % (self.__class__.__name__, self.urlconf_name, self.app_name, self.namespace, self.regex.pattern))\n \n     def _populate(self):\n         lookups = MultiValueDict()\n@@ -373,10 +373,10 @@ def _reverse_with_prefix(self, lookup_view, _prefix, *args, **kwargs):\n                 if args:\n                     if len(args) != len(params) + len(prefix_args):\n                         continue\n-                    unicode_args = [force_unicode(val) for val in args]\n+                    unicode_args = [force_text(val) for val in args]\n                     candidate =  (prefix_norm + result) % dict(zip(prefix_args + params, unicode_args))\n                 else:\n-                    if set(kwargs.keys() + defaults.keys()) != set(params + defaults.keys() + prefix_args):\n+                    if set(kwargs.keys()) | set(defaults.keys()) != set(params) | set(defaults.keys()) | set(prefix_args):\n                         continue\n                     matches = True\n                     for k, v in defaults.items():\n@@ -385,7 +385,7 @@ def _reverse_with_prefix(self, lookup_view, _prefix, *args, **kwargs):\n                             break\n                     if not matches:\n                         continue\n-                    unicode_kwargs = dict([(k, force_unicode(v)) for (k, v) in kwargs.items()])\n+                    unicode_kwargs = dict([(k, force_text(v)) for (k, v) in kwargs.items()])\n                     candidate = (prefix_norm + result) % unicode_kwargs\n                 if re.search('^%s%s' % (_prefix, pattern), candidate, re.UNICODE):\n                     return candidate"
        },
        {
            "sha": "456fa3cec53a569a99e5ed1166642842d82f683e",
            "filename": "django/core/validators.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fvalidators.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fcore%2Fvalidators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fvalidators.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n \n from django.core.exceptions import ValidationError\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.ipv6 import is_valid_ipv6_address\n from django.utils import six\n \n@@ -36,7 +36,7 @@ def __call__(self, value):\n         \"\"\"\n         Validates that the input matches the regular expression.\n         \"\"\"\n-        if not self.regex.search(smart_unicode(value)):\n+        if not self.regex.search(smart_text(value)):\n             raise ValidationError(self.message, code=self.code)\n \n class URLValidator(RegexValidator):\n@@ -54,7 +54,7 @@ def __call__(self, value):\n         except ValidationError as e:\n             # Trivial case failed. Try for possible IDN domain\n             if value:\n-                value = smart_unicode(value)\n+                value = smart_text(value)\n                 scheme, netloc, path, query, fragment = urlsplit(value)\n                 try:\n                     netloc = netloc.encode('idna') # IDN -> ACE\n@@ -138,7 +138,7 @@ def ip_address_validators(protocol, unpack_ipv4):\n         return ip_address_validator_map[protocol.lower()]\n     except KeyError:\n         raise ValueError(\"The protocol '%s' is unknown. Supported: %s\"\n-                         % (protocol, ip_address_validator_map.keys()))\n+                         % (protocol, list(ip_address_validator_map)))\n \n comma_separated_int_list_re = re.compile('^[\\d,]+$')\n validate_comma_separated_integer_list = RegexValidator(comma_separated_int_list_re, _('Enter only digits separated by commas.'), 'invalid')"
        },
        {
            "sha": "5719f5144519615755a328516de4f8ab7d16552c",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -621,16 +621,16 @@ def last_executed_query(self, cursor, sql, params):\n         exists for database backends to provide a better implementation\n         according to their own quoting schemes.\n         \"\"\"\n-        from django.utils.encoding import smart_unicode, force_unicode\n+        from django.utils.encoding import smart_text, force_text\n \n         # Convert params to contain Unicode values.\n-        to_unicode = lambda s: force_unicode(s, strings_only=True, errors='replace')\n+        to_unicode = lambda s: force_text(s, strings_only=True, errors='replace')\n         if isinstance(params, (list, tuple)):\n             u_params = tuple([to_unicode(val) for val in params])\n         else:\n             u_params = dict([(to_unicode(k), to_unicode(v)) for k, v in params.items()])\n \n-        return smart_unicode(sql) % u_params\n+        return smart_text(sql) % u_params\n \n     def last_insert_id(self, cursor, table_name, pk_name):\n         \"\"\"\n@@ -814,8 +814,8 @@ def tablespace_sql(self, tablespace, inline=False):\n \n     def prep_for_like_query(self, x):\n         \"\"\"Prepares a value for use in a LIKE query.\"\"\"\n-        from django.utils.encoding import smart_unicode\n-        return smart_unicode(x).replace(\"\\\\\", \"\\\\\\\\\").replace(\"%\", \"\\%\").replace(\"_\", \"\\_\")\n+        from django.utils.encoding import smart_text\n+        return smart_text(x).replace(\"\\\\\", \"\\\\\\\\\").replace(\"%\", \"\\%\").replace(\"_\", \"\\_\")\n \n     # Same as prep_for_like_query(), but called for \"iexact\" matches, which\n     # need not necessarily be implemented using \"LIKE\" in the backend."
        },
        {
            "sha": "0cc01cc8769a0dca5eb7246c5cfd99ef092450b7",
            "filename": "django/db/backends/creation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fcreation.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,6 +3,7 @@\n \n from django.conf import settings\n from django.db.utils import load_backend\n+from django.utils.six.moves import input\n \n # The prefix to put on the default database name when creating\n # the test database.\n@@ -331,7 +332,7 @@ def _create_test_db(self, verbosity, autoclobber):\n             sys.stderr.write(\n                 \"Got an error creating the test database: %s\\n\" % e)\n             if not autoclobber:\n-                confirm = raw_input(\n+                confirm = input(\n                     \"Type 'yes' if you would like to try deleting the test \"\n                     \"database '%s', or 'no' to cancel: \" % test_database_name)\n             if autoclobber or confirm == 'yes':"
        },
        {
            "sha": "6aab0b99ab0902a5823a02d0c61783f5b40495eb",
            "filename": "django/db/backends/mysql/introspection.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fintrospection.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,4 +1,5 @@\n from django.db.backends import BaseDatabaseIntrospection\n+from django.utils import six\n from MySQLdb import ProgrammingError, OperationalError\n from MySQLdb.constants import FIELD_TYPE\n import re\n@@ -79,7 +80,7 @@ def get_primary_key_column(self, cursor, table_name):\n         \"\"\"\n         Returns the name of the primary key column for the given table\n         \"\"\"\n-        for column in self.get_indexes(cursor, table_name).iteritems():\n+        for column in six.iteritems(self.get_indexes(cursor, table_name)):\n             if column[1]['primary_key']:\n                 return column[0]\n         return None"
        },
        {
            "sha": "89cad12b6ceeee61ca28194d480c4d6fbb1862d9",
            "filename": "django/db/backends/oracle/base.py",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Foracle%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -53,7 +53,7 @@ def _setup_environment(environ):\n from django.db.backends.oracle.client import DatabaseClient\n from django.db.backends.oracle.creation import DatabaseCreation\n from django.db.backends.oracle.introspection import DatabaseIntrospection\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import smart_bytes, force_text\n from django.utils import six\n from django.utils import timezone\n \n@@ -64,9 +64,9 @@ def _setup_environment(environ):\n # Check whether cx_Oracle was compiled with the WITH_UNICODE option.  This will\n # also be True in Python 3.0.\n if int(Database.version.split('.', 1)[0]) >= 5 and not hasattr(Database, 'UNICODE'):\n-    convert_unicode = force_unicode\n+    convert_unicode = force_text\n else:\n-    convert_unicode = smart_str\n+    convert_unicode = smart_bytes\n \n \n class DatabaseFeatures(BaseDatabaseFeatures):\n@@ -162,7 +162,7 @@ def convert_values(self, value, field):\n         if isinstance(value, Database.LOB):\n             value = value.read()\n             if field and field.get_internal_type() == 'TextField':\n-                value = force_unicode(value)\n+                value = force_text(value)\n \n         # Oracle stores empty strings as null. We need to undo this in\n         # order to adhere to the Django convention of using the empty\n@@ -245,7 +245,7 @@ def prep_for_iexact_query(self, x):\n     def process_clob(self, value):\n         if value is None:\n             return ''\n-        return force_unicode(value.read())\n+        return force_text(value.read())\n \n     def quote_name(self, name):\n         # SQL92 requires delimited (quoted) names to be case-sensitive.  When\n@@ -595,9 +595,9 @@ def __init__(self, param, cursor, strings_only=False):\n             param = param.astimezone(timezone.utc).replace(tzinfo=None)\n \n         if hasattr(param, 'bind_parameter'):\n-            self.smart_str = param.bind_parameter(cursor)\n+            self.smart_bytes = param.bind_parameter(cursor)\n         else:\n-            self.smart_str = convert_unicode(param, cursor.charset,\n+            self.smart_bytes = convert_unicode(param, cursor.charset,\n                                              strings_only)\n         if hasattr(param, 'input_size'):\n             # If parameter has `input_size` attribute, use that.\n@@ -676,7 +676,7 @@ def _guess_input_sizes(self, params_list):\n         self.setinputsizes(*sizes)\n \n     def _param_generator(self, params):\n-        return [p.smart_str for p in params]\n+        return [p.smart_bytes for p in params]\n \n     def execute(self, query, params=None):\n         if params is None:\n@@ -774,9 +774,11 @@ def __init__(self, cursor):\n     def __iter__(self):\n         return self\n \n-    def next(self):\n+    def __next__(self):\n         return _rowfactory(next(self.iter), self.cursor)\n \n+    next = __next__             # Python 2 compatibility\n+\n \n def _rowfactory(row, cursor):\n     # Cast numeric values as the appropriate Python type based upon the\n@@ -831,7 +833,7 @@ def to_unicode(s):\n     unchanged).\n     \"\"\"\n     if isinstance(s, six.string_types):\n-        return force_unicode(s)\n+        return force_text(s)\n     return s\n \n "
        },
        {
            "sha": "d9bf3dfea2c6a5c6009e14ae62578f15d27451d9",
            "filename": "django/db/backends/oracle/creation.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Foracle%2Fcreation.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,6 +1,7 @@\n import sys\n import time\n from django.db.backends.creation import BaseDatabaseCreation\n+from django.utils.six.moves import input\n \n TEST_DATABASE_PREFIX = 'test_'\n PASSWORD = 'Im_a_lumberjack'\n@@ -65,7 +66,7 @@ def _create_test_db(self, verbosity=1, autoclobber=False):\n             except Exception as e:\n                 sys.stderr.write(\"Got an error creating the test database: %s\\n\" % e)\n                 if not autoclobber:\n-                    confirm = raw_input(\"It appears the test database, %s, already exists. Type 'yes' to delete it, or 'no' to cancel: \" % TEST_NAME)\n+                    confirm = input(\"It appears the test database, %s, already exists. Type 'yes' to delete it, or 'no' to cancel: \" % TEST_NAME)\n                 if autoclobber or confirm == 'yes':\n                     try:\n                         if verbosity >= 1:\n@@ -87,7 +88,7 @@ def _create_test_db(self, verbosity=1, autoclobber=False):\n             except Exception as e:\n                 sys.stderr.write(\"Got an error creating the test user: %s\\n\" % e)\n                 if not autoclobber:\n-                    confirm = raw_input(\"It appears the test user, %s, already exists. Type 'yes' to delete it, or 'no' to cancel: \" % TEST_USER)\n+                    confirm = input(\"It appears the test user, %s, already exists. Type 'yes' to delete it, or 'no' to cancel: \" % TEST_USER)\n                 if autoclobber or confirm == 'yes':\n                     try:\n                         if verbosity >= 1:"
        },
        {
            "sha": "088007918981ae0271385aabf3554b166a026771",
            "filename": "django/db/backends/sqlite3/base.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -54,15 +54,15 @@ def adapt_datetime_with_timezone_support(value):\n             default_timezone = timezone.get_default_timezone()\n             value = timezone.make_aware(value, default_timezone)\n         value = value.astimezone(timezone.utc).replace(tzinfo=None)\n-    return value.isoformat(b\" \")\n-\n-Database.register_converter(b\"bool\", lambda s: str(s) == '1')\n-Database.register_converter(b\"time\", parse_time)\n-Database.register_converter(b\"date\", parse_date)\n-Database.register_converter(b\"datetime\", parse_datetime_with_timezone_support)\n-Database.register_converter(b\"timestamp\", parse_datetime_with_timezone_support)\n-Database.register_converter(b\"TIMESTAMP\", parse_datetime_with_timezone_support)\n-Database.register_converter(b\"decimal\", util.typecast_decimal)\n+    return value.isoformat(str(\" \"))\n+\n+Database.register_converter(str(\"bool\"), lambda s: str(s) == '1')\n+Database.register_converter(str(\"time\"), parse_time)\n+Database.register_converter(str(\"date\"), parse_date)\n+Database.register_converter(str(\"datetime\"), parse_datetime_with_timezone_support)\n+Database.register_converter(str(\"timestamp\"), parse_datetime_with_timezone_support)\n+Database.register_converter(str(\"TIMESTAMP\"), parse_datetime_with_timezone_support)\n+Database.register_converter(str(\"decimal\"), util.typecast_decimal)\n Database.register_adapter(datetime.datetime, adapt_datetime_with_timezone_support)\n Database.register_adapter(decimal.Decimal, util.rev_typecast_decimal)\n if Database.version_info >= (2, 4, 1):"
        },
        {
            "sha": "c022b56c858cebe7aa2b6a5ccf6b7bf2ee0d763a",
            "filename": "django/db/backends/sqlite3/creation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fsqlite3%2Fcreation.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,6 +1,7 @@\n import os\n import sys\n from django.db.backends.creation import BaseDatabaseCreation\n+from django.utils.six.moves import input\n \n class DatabaseCreation(BaseDatabaseCreation):\n     # SQLite doesn't actually support most of these types, but it \"does the right\n@@ -53,7 +54,7 @@ def _create_test_db(self, verbosity, autoclobber):\n                 print(\"Destroying old test database '%s'...\" % self.connection.alias)\n             if os.access(test_database_name, os.F_OK):\n                 if not autoclobber:\n-                    confirm = raw_input(\"Type 'yes' if you would like to try deleting the test database '%s', or 'no' to cancel: \" % test_database_name)\n+                    confirm = input(\"Type 'yes' if you would like to try deleting the test database '%s', or 'no' to cancel: \" % test_database_name)\n                 if autoclobber or confirm == 'yes':\n                   try:\n                       os.remove(test_database_name)"
        },
        {
            "sha": "569b8e876c8482b9865446d1458c3bf27439bbaa",
            "filename": "django/db/models/base.py",
            "status": "modified",
            "additions": 33,
            "deletions": 32,
            "changes": 65,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -23,11 +23,35 @@\n from django.db.models.loading import register_models, get_model\n from django.utils.translation import ugettext_lazy as _\n from django.utils.functional import curry\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import smart_bytes, force_text\n from django.utils import six\n from django.utils.text import get_text_list, capfirst\n \n \n+def subclass_exception(name, parents, module, attached_to=None):\n+    \"\"\"\n+    Create exception subclass. Used by ModelBase below.\n+\n+    If 'attached_to' is supplied, the exception will be created in a way that\n+    allows it to be pickled, assuming the returned exception class will be added\n+    as an attribute to the 'attached_to' class.\n+    \"\"\"\n+    class_dict = {'__module__': module}\n+    if attached_to is not None:\n+        def __reduce__(self):\n+            # Exceptions are special - they've got state that isn't\n+            # in self.__dict__. We assume it is all in self.args.\n+            return (unpickle_inner_exception, (attached_to, name), self.args)\n+\n+        def __setstate__(self, args):\n+            self.args = args\n+\n+        class_dict['__reduce__'] = __reduce__\n+        class_dict['__setstate__'] = __setstate__\n+\n+    return type(name, parents, class_dict)\n+\n+\n class ModelBase(type):\n     \"\"\"\n     Metaclass for all models.\n@@ -63,12 +87,12 @@ def __new__(cls, name, bases, attrs):\n \n         new_class.add_to_class('_meta', Options(meta, **kwargs))\n         if not abstract:\n-            new_class.add_to_class('DoesNotExist', subclass_exception(b'DoesNotExist',\n+            new_class.add_to_class('DoesNotExist', subclass_exception(str('DoesNotExist'),\n                     tuple(x.DoesNotExist\n                           for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n                     or (ObjectDoesNotExist,),\n                     module, attached_to=new_class))\n-            new_class.add_to_class('MultipleObjectsReturned', subclass_exception(b'MultipleObjectsReturned',\n+            new_class.add_to_class('MultipleObjectsReturned', subclass_exception(str('MultipleObjectsReturned'),\n                     tuple(x.MultipleObjectsReturned\n                           for x in parents if hasattr(x, '_meta') and not x._meta.abstract)\n                     or (MultipleObjectsReturned,),\n@@ -364,14 +388,14 @@ def __init__(self, *args, **kwargs):\n                 setattr(self, field.attname, val)\n \n         if kwargs:\n-            for prop in kwargs.keys():\n+            for prop in list(kwargs):\n                 try:\n                     if isinstance(getattr(self.__class__, prop), property):\n                         setattr(self, prop, kwargs.pop(prop))\n                 except AttributeError:\n                     pass\n             if kwargs:\n-                raise TypeError(\"'%s' is an invalid keyword argument for this function\" % kwargs.keys()[0])\n+                raise TypeError(\"'%s' is an invalid keyword argument for this function\" % list(kwargs)[0])\n         super(Model, self).__init__()\n         signals.post_init.send(sender=self.__class__, instance=self)\n \n@@ -380,11 +404,11 @@ def __repr__(self):\n             u = six.text_type(self)\n         except (UnicodeEncodeError, UnicodeDecodeError):\n             u = '[Bad Unicode data]'\n-        return smart_str('<%s: %s>' % (self.__class__.__name__, u))\n+        return smart_bytes('<%s: %s>' % (self.__class__.__name__, u))\n \n     def __str__(self):\n         if hasattr(self, '__unicode__'):\n-            return force_unicode(self).encode('utf-8')\n+            return force_text(self).encode('utf-8')\n         return '%s object' % self.__class__.__name__\n \n     def __eq__(self, other):\n@@ -605,14 +629,14 @@ def delete(self, using=None):\n \n     def _get_FIELD_display(self, field):\n         value = getattr(self, field.attname)\n-        return force_unicode(dict(field.flatchoices).get(value, value), strings_only=True)\n+        return force_text(dict(field.flatchoices).get(value, value), strings_only=True)\n \n     def _get_next_or_previous_by_FIELD(self, field, is_next, **kwargs):\n         if not self.pk:\n             raise ValueError(\"get_next/get_previous cannot be used on unsaved objects.\")\n         op = is_next and 'gt' or 'lt'\n         order = not is_next and '-' or ''\n-        param = smart_str(getattr(self, field.attname))\n+        param = smart_bytes(getattr(self, field.attname))\n         q = Q(**{'%s__%s' % (field.name, op): param})\n         q = q|Q(**{field.name: param, 'pk__%s' % op: self.pk})\n         qs = self.__class__._default_manager.using(self._state.db).filter(**kwargs).filter(q).order_by('%s%s' % (order, field.name), '%spk' % order)\n@@ -929,29 +953,6 @@ def model_unpickle(model, attrs):\n     return cls.__new__(cls)\n model_unpickle.__safe_for_unpickle__ = True\n \n-def subclass_exception(name, parents, module, attached_to=None):\n-    \"\"\"\n-    Create exception subclass.\n-\n-    If 'attached_to' is supplied, the exception will be created in a way that\n-    allows it to be pickled, assuming the returned exception class will be added\n-    as an attribute to the 'attached_to' class.\n-    \"\"\"\n-    class_dict = {'__module__': module}\n-    if attached_to is not None:\n-        def __reduce__(self):\n-            # Exceptions are special - they've got state that isn't\n-            # in self.__dict__. We assume it is all in self.args.\n-            return (unpickle_inner_exception, (attached_to, name), self.args)\n-\n-        def __setstate__(self, args):\n-            self.args = args\n-\n-        class_dict['__reduce__'] = __reduce__\n-        class_dict['__setstate__'] = __setstate__\n-\n-    return type(name, parents, class_dict)\n-\n def unpickle_inner_exception(klass, exception_name):\n     # Get the exception class from the class it is attached to:\n     exception = getattr(klass, exception_name)"
        },
        {
            "sha": "4449b75a81896fe6bac8a8ab9e06742d7d171d68",
            "filename": "django/db/models/deletion.py",
            "status": "modified",
            "additions": 13,
            "deletions": 12,
            "changes": 25,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fdeletion.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fdeletion.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fdeletion.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,6 +4,7 @@\n from django.db import connections, transaction, IntegrityError\n from django.db.models import signals, sql\n from django.utils.datastructures import SortedDict\n+from django.utils import six\n \n \n class ProtectedError(IntegrityError):\n@@ -157,7 +158,7 @@ def collect(self, objs, source=None, nullable=False, collect_related=True,\n         # Recursively collect concrete model's parent models, but not their\n         # related objects. These will be found by meta.get_all_related_objects()\n         concrete_model = model._meta.concrete_model\n-        for ptr in concrete_model._meta.parents.itervalues():\n+        for ptr in six.itervalues(concrete_model._meta.parents):\n             if ptr:\n                 parent_objs = [getattr(obj, ptr.name) for obj in new_objs]\n                 self.collect(parent_objs, source=model,\n@@ -199,14 +200,14 @@ def related_objects(self, related, objs):\n         )\n \n     def instances_with_model(self):\n-        for model, instances in self.data.iteritems():\n+        for model, instances in six.iteritems(self.data):\n             for obj in instances:\n                 yield model, obj\n \n     def sort(self):\n         sorted_models = []\n         concrete_models = set()\n-        models = self.data.keys()\n+        models = list(self.data)\n         while len(sorted_models) < len(models):\n             found = False\n             for model in models:\n@@ -241,24 +242,24 @@ def delete(self):\n                 )\n \n         # update fields\n-        for model, instances_for_fieldvalues in self.field_updates.iteritems():\n+        for model, instances_for_fieldvalues in six.iteritems(self.field_updates):\n             query = sql.UpdateQuery(model)\n-            for (field, value), instances in instances_for_fieldvalues.iteritems():\n+            for (field, value), instances in six.iteritems(instances_for_fieldvalues):\n                 query.update_batch([obj.pk for obj in instances],\n                                    {field.name: value}, self.using)\n \n         # reverse instance collections\n-        for instances in self.data.itervalues():\n+        for instances in six.itervalues(self.data):\n             instances.reverse()\n \n         # delete batches\n-        for model, batches in self.batches.iteritems():\n+        for model, batches in six.iteritems(self.batches):\n             query = sql.DeleteQuery(model)\n-            for field, instances in batches.iteritems():\n+            for field, instances in six.iteritems(batches):\n                 query.delete_batch([obj.pk for obj in instances], self.using, field)\n \n         # delete instances\n-        for model, instances in self.data.iteritems():\n+        for model, instances in six.iteritems(self.data):\n             query = sql.DeleteQuery(model)\n             pk_list = [obj.pk for obj in instances]\n             query.delete_batch(pk_list, self.using)\n@@ -271,10 +272,10 @@ def delete(self):\n                 )\n \n         # update collected instances\n-        for model, instances_for_fieldvalues in self.field_updates.iteritems():\n-            for (field, value), instances in instances_for_fieldvalues.iteritems():\n+        for model, instances_for_fieldvalues in six.iteritems(self.field_updates):\n+            for (field, value), instances in six.iteritems(instances_for_fieldvalues):\n                 for obj in instances:\n                     setattr(obj, field.attname, value)\n-        for model, instances in self.data.iteritems():\n+        for model, instances in six.iteritems(self.data):\n             for instance in instances:\n                 setattr(instance, model._meta.pk.attname, None)"
        },
        {
            "sha": "d07851bbf579d26e7d7acd57f51f3fcdb32ca6b9",
            "filename": "django/db/models/fields/__init__.py",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Ffields%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -19,7 +19,7 @@\n from django.utils.text import capfirst\n from django.utils import timezone\n from django.utils.translation import ugettext_lazy as _\n-from django.utils.encoding import smart_unicode, force_unicode\n+from django.utils.encoding import smart_text, force_text\n from django.utils.ipv6 import clean_ipv6_address\n from django.utils import six\n \n@@ -135,6 +135,8 @@ def __lt__(self, other):\n             return self.creation_counter < other.creation_counter\n         return NotImplemented\n \n+    __hash__ = object.__hash__\n+\n     def __deepcopy__(self, memodict):\n         # We don't have to deepcopy very much here, since most things are not\n         # intended to be altered after initial creation.\n@@ -179,7 +181,8 @@ def validate(self, value, model_instance):\n         if not self.editable:\n             # Skip validation for non-editable fields.\n             return\n-        if self._choices and value:\n+\n+        if self._choices and value not in validators.EMPTY_VALUES:\n             for option_key, option_value in self.choices:\n                 if isinstance(option_value, (list, tuple)):\n                     # This is an optgroup, so look inside the group for\n@@ -385,7 +388,7 @@ def get_default(self):\n         if self.has_default():\n             if callable(self.default):\n                 return self.default()\n-            return force_unicode(self.default, strings_only=True)\n+            return force_text(self.default, strings_only=True)\n         if (not self.empty_strings_allowed or (self.null and\n                    not connection.features.interprets_empty_strings_as_nulls)):\n             return None\n@@ -403,11 +406,11 @@ def get_choices(self, include_blank=True, blank_choice=BLANK_CHOICE_DASH):\n         rel_model = self.rel.to\n         if hasattr(self.rel, 'get_related_field'):\n             lst = [(getattr(x, self.rel.get_related_field().attname),\n-                        smart_unicode(x))\n+                        smart_text(x))\n                    for x in rel_model._default_manager.complex_filter(\n                        self.rel.limit_choices_to)]\n         else:\n-            lst = [(x._get_pk_val(), smart_unicode(x))\n+            lst = [(x._get_pk_val(), smart_text(x))\n                    for x in rel_model._default_manager.complex_filter(\n                        self.rel.limit_choices_to)]\n         return first_choice + lst\n@@ -434,7 +437,7 @@ def value_to_string(self, obj):\n         Returns a string value of this field from the passed obj.\n         This is used by the serialization framework.\n         \"\"\"\n-        return smart_unicode(self._get_val_from_obj(obj))\n+        return smart_text(self._get_val_from_obj(obj))\n \n     def bind(self, fieldmapping, original, bound_field_class):\n         return bound_field_class(self, fieldmapping, original)\n@@ -486,7 +489,7 @@ def formfield(self, form_class=forms.CharField, **kwargs):\n             # Many of the subclass-specific formfield arguments (min_value,\n             # max_value) don't apply for choice fields, so be sure to only pass\n             # the values that TypedChoiceField will understand.\n-            for k in kwargs.keys():\n+            for k in list(kwargs):\n                 if k not in ('coerce', 'empty_value', 'choices', 'required',\n                              'widget', 'label', 'initial', 'help_text',\n                              'error_messages', 'show_hidden_initial'):\n@@ -628,7 +631,7 @@ def get_internal_type(self):\n     def to_python(self, value):\n         if isinstance(value, six.string_types) or value is None:\n             return value\n-        return smart_unicode(value)\n+        return smart_text(value)\n \n     def get_prep_value(self, value):\n         return self.to_python(value)\n@@ -1188,7 +1191,7 @@ def get_internal_type(self):\n     def get_prep_value(self, value):\n         if isinstance(value, six.string_types) or value is None:\n             return value\n-        return smart_unicode(value)\n+        return smart_text(value)\n \n     def formfield(self, **kwargs):\n         defaults = {'widget': forms.Textarea}"
        },
        {
            "sha": "ad4c36ca0d10e00d9575a062cef64912b67dc9c4",
            "filename": "django/db/models/fields/files.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Ffiles.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.core.files.storage import default_storage\n from django.core.files.images import ImageFile\n from django.db.models import signals\n-from django.utils.encoding import force_unicode, smart_str\n+from django.utils.encoding import force_text, smart_bytes\n from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n \n@@ -280,7 +280,7 @@ def contribute_to_class(self, cls, name):\n         setattr(cls, self.name, self.descriptor_class(self))\n \n     def get_directory_name(self):\n-        return os.path.normpath(force_unicode(datetime.datetime.now().strftime(smart_str(self.upload_to))))\n+        return os.path.normpath(force_text(datetime.datetime.now().strftime(smart_bytes(self.upload_to))))\n \n     def get_filename(self, filename):\n         return os.path.normpath(self.storage.get_valid_name(os.path.basename(filename)))"
        },
        {
            "sha": "08cc0a747f3bb1bf3fb0778240982474e50788f9",
            "filename": "django/db/models/fields/related.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Ffields%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Ffields%2Frelated.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.db.models.query import QuerySet\n from django.db.models.query_utils import QueryWrapper\n from django.db.models.deletion import CASCADE\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils import six\n from django.utils.translation import ugettext_lazy as _, string_concat\n from django.utils.functional import curry, cached_property\n@@ -241,7 +241,7 @@ def get_prefetch_query_set(self, instances):\n         rel_obj_attr = attrgetter(self.related.field.attname)\n         instance_attr = lambda obj: obj._get_pk_val()\n         instances_dict = dict((instance_attr(inst), inst) for inst in instances)\n-        params = {'%s__pk__in' % self.related.field.name: instances_dict.keys()}\n+        params = {'%s__pk__in' % self.related.field.name: list(instances_dict)}\n         qs = self.get_query_set(instance=instances[0]).filter(**params)\n         # Since we're going to assign directly in the cache,\n         # we must manage the reverse relation cache manually.\n@@ -335,9 +335,9 @@ def get_prefetch_query_set(self, instances):\n         instance_attr = attrgetter(self.field.attname)\n         instances_dict = dict((instance_attr(inst), inst) for inst in instances)\n         if other_field.rel:\n-            params = {'%s__pk__in' % self.field.rel.field_name: instances_dict.keys()}\n+            params = {'%s__pk__in' % self.field.rel.field_name: list(instances_dict)}\n         else:\n-            params = {'%s__in' % self.field.rel.field_name: instances_dict.keys()}\n+            params = {'%s__in' % self.field.rel.field_name: list(instances_dict)}\n         qs = self.get_query_set(instance=instances[0]).filter(**params)\n         # Since we're going to assign directly in the cache,\n         # we must manage the reverse relation cache manually.\n@@ -488,7 +488,7 @@ def get_prefetch_query_set(self, instances):\n                 instance_attr = attrgetter(attname)\n                 instances_dict = dict((instance_attr(inst), inst) for inst in instances)\n                 db = self._db or router.db_for_read(self.model, instance=instances[0])\n-                query = {'%s__%s__in' % (rel_field.name, attname): instances_dict.keys()}\n+                query = {'%s__%s__in' % (rel_field.name, attname): list(instances_dict)}\n                 qs = super(RelatedManager, self).get_query_set().using(db).filter(**query)\n                 # Since we just bypassed this class' get_query_set(), we must manage\n                 # the reverse relation manually.\n@@ -999,7 +999,7 @@ def value_to_string(self, obj):\n             if not self.blank and self.choices:\n                 choice_list = self.get_choices_default()\n                 if len(choice_list) == 2:\n-                    return smart_unicode(choice_list[1][0])\n+                    return smart_text(choice_list[1][0])\n         return Field.value_to_string(self, obj)\n \n     def contribute_to_class(self, cls, name):\n@@ -1205,7 +1205,7 @@ def value_to_string(self, obj):\n                 choices_list = self.get_choices_default()\n                 if len(choices_list) == 1:\n                     data = [choices_list[0][0]]\n-        return smart_unicode(data)\n+        return smart_text(data)\n \n     def contribute_to_class(self, cls, name):\n         # To support multiple relations to self, it's useful to have a non-None"
        },
        {
            "sha": "7a9cb2cb415ba8fc2ad5e25238fcde2521842d92",
            "filename": "django/db/models/loading.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Floading.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Floading.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Floading.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,6 +5,7 @@\n from django.utils.datastructures import SortedDict\n from django.utils.importlib import import_module\n from django.utils.module_loading import module_has_submodule\n+from django.utils import six\n \n import imp\n import sys\n@@ -193,9 +194,9 @@ def get_models(self, app_mod=None,\n         else:\n             if only_installed:\n                 app_list = [self.app_models.get(app_label, SortedDict())\n-                            for app_label in self.app_labels.iterkeys()]\n+                            for app_label in six.iterkeys(self.app_labels)]\n             else:\n-                app_list = self.app_models.itervalues()\n+                app_list = six.itervalues(self.app_models)\n         model_list = []\n         for app in app_list:\n             model_list.extend("
        },
        {
            "sha": "2e8ccb49ce7e181ffc76a9890067e4d4084f96a3",
            "filename": "django/db/models/options.py",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Foptions.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,7 +8,7 @@\n from django.db.models.fields.proxy import OrderWrt\n from django.db.models.loading import get_models, app_cache_ready\n from django.utils.translation import activate, deactivate_all, get_language, string_concat\n-from django.utils.encoding import force_unicode, smart_str\n+from django.utils.encoding import force_text, smart_bytes\n from django.utils.datastructures import SortedDict\n from django.utils import six\n \n@@ -127,7 +127,7 @@ def _prepare(self, model):\n             if self.parents:\n                 # Promote the first parent link in lieu of adding yet another\n                 # field.\n-                field = next(self.parents.itervalues())\n+                field = next(six.itervalues(self.parents))\n                 # Look for a local field with the same name as the\n                 # first parent link. If a local field has already been\n                 # created, use it instead of promoting the parent\n@@ -147,13 +147,13 @@ def _prepare(self, model):\n         # self.duplicate_targets will map each duplicate field column to the\n         # columns it duplicates.\n         collections = {}\n-        for column, target in self.duplicate_targets.iteritems():\n+        for column, target in six.iteritems(self.duplicate_targets):\n             try:\n                 collections[target].add(column)\n             except KeyError:\n                 collections[target] = set([column])\n         self.duplicate_targets = {}\n-        for elt in collections.itervalues():\n+        for elt in six.itervalues(collections):\n             if len(elt) == 1:\n                 continue\n             for column in elt:\n@@ -199,7 +199,7 @@ def __repr__(self):\n         return '<Options for %s>' % self.object_name\n \n     def __str__(self):\n-        return \"%s.%s\" % (smart_str(self.app_label), smart_str(self.module_name))\n+        return \"%s.%s\" % (smart_bytes(self.app_label), smart_bytes(self.module_name))\n \n     def verbose_name_raw(self):\n         \"\"\"\n@@ -209,7 +209,7 @@ def verbose_name_raw(self):\n         \"\"\"\n         lang = get_language()\n         deactivate_all()\n-        raw = force_unicode(self.verbose_name)\n+        raw = force_text(self.verbose_name)\n         activate(lang)\n         return raw\n     verbose_name_raw = property(verbose_name_raw)\n@@ -258,7 +258,7 @@ def _many_to_many(self):\n             self._m2m_cache\n         except AttributeError:\n             self._fill_m2m_cache()\n-        return self._m2m_cache.keys()\n+        return list(self._m2m_cache)\n     many_to_many = property(_many_to_many)\n \n     def get_m2m_with_model(self):\n@@ -269,7 +269,7 @@ def get_m2m_with_model(self):\n             self._m2m_cache\n         except AttributeError:\n             self._fill_m2m_cache()\n-        return self._m2m_cache.items()\n+        return list(six.iteritems(self._m2m_cache))\n \n     def _fill_m2m_cache(self):\n         cache = SortedDict()\n@@ -326,8 +326,7 @@ def get_all_field_names(self):\n             cache = self._name_map\n         except AttributeError:\n             cache = self.init_name_map()\n-        names = cache.keys()\n-        names.sort()\n+        names = sorted(cache.keys())\n         # Internal-only names end with \"+\" (symmetrical m2m related names being\n         # the main example). Trim them.\n         return [val for val in names if not val.endswith('+')]\n@@ -417,7 +416,7 @@ def get_all_related_many_to_many_objects(self, local_only=False):\n             cache = self._fill_related_many_to_many_cache()\n         if local_only:\n             return [k for k, v in cache.items() if not v]\n-        return cache.keys()\n+        return list(cache)\n \n     def get_all_related_m2m_objects_with_model(self):\n         \"\"\"\n@@ -428,7 +427,7 @@ def get_all_related_m2m_objects_with_model(self):\n             cache = self._related_many_to_many_cache\n         except AttributeError:\n             cache = self._fill_related_many_to_many_cache()\n-        return cache.items()\n+        return list(six.iteritems(cache))\n \n     def _fill_related_many_to_many_cache(self):\n         cache = SortedDict()"
        },
        {
            "sha": "e8d6ae2a7b3b034747e93b4497ad7950af5dab85",
            "filename": "django/db/models/query.py",
            "status": "modified",
            "additions": 12,
            "deletions": 11,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -120,7 +120,7 @@ def _result_iter(self):\n             if len(self._result_cache) <= pos:\n                 self._fill_cache()\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         if self._prefetch_related_lookups and not self._prefetch_done:\n             # We need all the results in order to be able to do the prefetch\n             # in one go. To minimize code duplication, we use the __len__\n@@ -134,6 +134,7 @@ def __nonzero__(self):\n         except StopIteration:\n             return False\n         return True\n+    __nonzero__ = __bool__ # Python 2\n \n     def __contains__(self, val):\n         # The 'in' operator works without this method, due to __iter__. This\n@@ -245,8 +246,8 @@ def iterator(self):\n             requested = None\n         max_depth = self.query.max_depth\n \n-        extra_select = self.query.extra_select.keys()\n-        aggregate_select = self.query.aggregate_select.keys()\n+        extra_select = list(self.query.extra_select)\n+        aggregate_select = list(self.query.aggregate_select)\n \n         only_load = self.query.get_loaded_field_names()\n         if not fill_cache:\n@@ -593,7 +594,7 @@ def values_list(self, *fields, **kwargs):\n         flat = kwargs.pop('flat', False)\n         if kwargs:\n             raise TypeError('Unexpected keyword arguments to values_list: %s'\n-                    % (kwargs.keys(),))\n+                    % (list(kwargs),))\n         if flat and len(fields) > 1:\n             raise TypeError(\"'flat' is not valid when values_list is called with more than one field.\")\n         return self._clone(klass=ValuesListQuerySet, setup=True, flat=flat,\n@@ -693,7 +694,7 @@ def select_related(self, *fields, **kwargs):\n         depth = kwargs.pop('depth', 0)\n         if kwargs:\n             raise TypeError('Unexpected keyword arguments to select_related: %s'\n-                    % (kwargs.keys(),))\n+                    % (list(kwargs),))\n         obj = self._clone()\n         if fields:\n             if depth:\n@@ -751,7 +752,7 @@ def annotate(self, *args, **kwargs):\n \n         obj = self._clone()\n \n-        obj._setup_aggregate_query(kwargs.keys())\n+        obj._setup_aggregate_query(list(kwargs))\n \n         # Add the aggregates to the query\n         for (alias, aggregate_expr) in kwargs.items():\n@@ -966,9 +967,9 @@ def __init__(self, *args, **kwargs):\n \n     def iterator(self):\n         # Purge any extra columns that haven't been explicitly asked for\n-        extra_names = self.query.extra_select.keys()\n+        extra_names = list(self.query.extra_select)\n         field_names = self.field_names\n-        aggregate_names = self.query.aggregate_select.keys()\n+        aggregate_names = list(self.query.aggregate_select)\n \n         names = extra_names + field_names + aggregate_names\n \n@@ -1097,9 +1098,9 @@ def iterator(self):\n             # When extra(select=...) or an annotation is involved, the extra\n             # cols are always at the start of the row, and we need to reorder\n             # the fields to match the order in self._fields.\n-            extra_names = self.query.extra_select.keys()\n+            extra_names = list(self.query.extra_select)\n             field_names = self.field_names\n-            aggregate_names = self.query.aggregate_select.keys()\n+            aggregate_names = list(self.query.aggregate_select)\n \n             names = extra_names + field_names + aggregate_names\n \n@@ -1527,7 +1528,7 @@ def __iter__(self):\n             # Associate fields to values\n             if skip:\n                 model_init_kwargs = {}\n-                for attname, pos in model_init_field_names.iteritems():\n+                for attname, pos in six.iteritems(model_init_field_names):\n                     model_init_kwargs[attname] = values[pos]\n                 instance = model_cls(**model_init_kwargs)\n             else:"
        },
        {
            "sha": "c1a690a524e5f4492ef10dd5d8a2840fa2e0bc0a",
            "filename": "django/db/models/query_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fquery_utils.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fquery_utils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fquery_utils.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,6 +8,7 @@\n from __future__ import unicode_literals\n \n from django.db.backends import util\n+from django.utils import six\n from django.utils import tree\n \n \n@@ -40,7 +41,7 @@ class Q(tree.Node):\n     default = AND\n \n     def __init__(self, *args, **kwargs):\n-        super(Q, self).__init__(children=list(args) + kwargs.items())\n+        super(Q, self).__init__(children=list(args) + list(six.iteritems(kwargs)))\n \n     def _combine(self, other, conn):\n         if not isinstance(other, Q):\n@@ -114,7 +115,7 @@ def __set__(self, instance, value):\n \n     def _check_parent_chain(self, instance, name):\n         \"\"\"\n-        Check if the field value can be fetched from a parent field already \n+        Check if the field value can be fetched from a parent field already\n         loaded in the instance. This can be done if the to-be fetched\n         field is a primary key field.\n         \"\"\""
        },
        {
            "sha": "a0dcec71328dd93128b9fbde0c625c3f3ab7f900",
            "filename": "django/db/models/related.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Frelated.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Frelated.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Frelated.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,4 +1,4 @@\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.db.models.fields import BLANK_CHOICE_DASH\n \n class BoundRelatedObject(object):\n@@ -34,9 +34,9 @@ def get_choices(self, include_blank=True, blank_choice=BLANK_CHOICE_DASH,\n         if limit_to_currently_related:\n             queryset = queryset.complex_filter(\n                 {'%s__isnull' % self.parent_model._meta.module_name: False})\n-        lst = [(x._get_pk_val(), smart_unicode(x)) for x in queryset]\n+        lst = [(x._get_pk_val(), smart_text(x)) for x in queryset]\n         return first_choice + lst\n-        \n+\n     def get_db_prep_lookup(self, lookup_type, value, connection, prepared=False):\n         # Defer to the actual field definition for db prep\n         return self.field.get_db_prep_lookup(lookup_type, value,"
        },
        {
            "sha": "1311ea546ccf3ea19a2f3f5e1511eb912a30e5cf",
            "filename": "django/db/models/sql/compiler.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fcompiler.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,6 +9,7 @@\n from django.db.models.sql.expressions import SQLEvaluator\n from django.db.models.sql.query import get_order_dir, Query\n from django.db.utils import DatabaseError\n+from django.utils import six\n \n \n class SQLCompiler(object):\n@@ -82,7 +83,7 @@ def as_sql(self, with_limits=True, with_col_aliases=False):\n         where, w_params = self.query.where.as_sql(qn=qn, connection=self.connection)\n         having, h_params = self.query.having.as_sql(qn=qn, connection=self.connection)\n         params = []\n-        for val in self.query.extra_select.itervalues():\n+        for val in six.itervalues(self.query.extra_select):\n             params.extend(val[1])\n \n         result = ['SELECT']\n@@ -177,7 +178,7 @@ def get_columns(self, with_aliases=False):\n         \"\"\"\n         qn = self.quote_name_unless_alias\n         qn2 = self.connection.ops.quote_name\n-        result = ['(%s) AS %s' % (col[0], qn2(alias)) for alias, col in self.query.extra_select.iteritems()]\n+        result = ['(%s) AS %s' % (col[0], qn2(alias)) for alias, col in six.iteritems(self.query.extra_select)]\n         aliases = set(self.query.extra_select.keys())\n         if with_aliases:\n             col_aliases = aliases.copy()\n@@ -553,7 +554,7 @@ def get_grouping(self):\n             group_by = self.query.group_by or []\n \n             extra_selects = []\n-            for extra_select, extra_params in self.query.extra_select.itervalues():\n+            for extra_select, extra_params in six.itervalues(self.query.extra_select):\n                 extra_selects.append(extra_select)\n                 params.extend(extra_params)\n             cols = (group_by + self.query.select +"
        },
        {
            "sha": "be257a54106f2d8b86756fc5346b7bd53559e365",
            "filename": "django/db/models/sql/query.py",
            "status": "modified",
            "additions": 15,
            "deletions": 14,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fsql%2Fquery.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fquery.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,8 +10,9 @@\n import copy\n \n from django.utils.datastructures import SortedDict\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.tree import Node\n+from django.utils import six\n from django.db import connections, DEFAULT_DB_ALIAS\n from django.db.models import signals\n from django.db.models.expressions import ExpressionNode\n@@ -602,22 +603,22 @@ def deferred_to_data(self, target, callback):\n             # slight complexity here is handling fields that exist on parent\n             # models.\n             workset = {}\n-            for model, values in seen.iteritems():\n+            for model, values in six.iteritems(seen):\n                 for field, m in model._meta.get_fields_with_model():\n                     if field in values:\n                         continue\n                     add_to_dict(workset, m or model, field)\n-            for model, values in must_include.iteritems():\n+            for model, values in six.iteritems(must_include):\n                 # If we haven't included a model in workset, we don't add the\n                 # corresponding must_include fields for that model, since an\n                 # empty set means \"include all fields\". That's why there's no\n                 # \"else\" branch here.\n                 if model in workset:\n                     workset[model].update(values)\n-            for model, values in workset.iteritems():\n+            for model, values in six.iteritems(workset):\n                 callback(target, model, values)\n         else:\n-            for model, values in must_include.iteritems():\n+            for model, values in six.iteritems(must_include):\n                 if model in seen:\n                     seen[model].update(values)\n                 else:\n@@ -631,7 +632,7 @@ def deferred_to_data(self, target, callback):\n             for model in orig_opts.get_parent_list():\n                 if model not in seen:\n                     seen[model] = set()\n-            for model, values in seen.iteritems():\n+            for model, values in six.iteritems(seen):\n                 callback(target, model, values)\n \n \n@@ -770,7 +771,7 @@ def change_aliases(self, change_map):\n         for k, aliases in self.join_map.items():\n             aliases = tuple([change_map.get(a, a) for a in aliases])\n             self.join_map[k] = aliases\n-        for old_alias, new_alias in change_map.iteritems():\n+        for old_alias, new_alias in six.iteritems(change_map):\n             alias_data = self.alias_map[old_alias]\n             alias_data = alias_data._replace(rhs_alias=new_alias)\n             self.alias_refcount[new_alias] = self.alias_refcount[old_alias]\n@@ -792,7 +793,7 @@ def change_aliases(self, change_map):\n                 self.included_inherited_models[key] = change_map[alias]\n \n         # 3. Update any joins that refer to the old alias.\n-        for alias, data in self.alias_map.iteritems():\n+        for alias, data in six.iteritems(self.alias_map):\n             lhs = data.lhs_alias\n             if lhs in change_map:\n                 data = data._replace(lhs_alias=change_map[lhs])\n@@ -842,7 +843,7 @@ def count_active_tables(self):\n         count. Note that after execution, the reference counts are zeroed, so\n         tables added in compiler will not be seen by this method.\n         \"\"\"\n-        return len([1 for count in self.alias_refcount.itervalues() if count])\n+        return len([1 for count in six.itervalues(self.alias_refcount) if count])\n \n     def join(self, connection, always_create=False, exclusions=(),\n             promote=False, outer_if_first=False, nullable=False, reuse=None):\n@@ -1302,7 +1303,7 @@ def setup_joins(self, names, opts, alias, dupe_multis, allow_many=True,\n                         field, model, direct, m2m = opts.get_field_by_name(f.name)\n                         break\n                 else:\n-                    names = opts.get_all_field_names() + self.aggregate_select.keys()\n+                    names = opts.get_all_field_names() + list(self.aggregate_select)\n                     raise FieldError(\"Cannot resolve keyword %r into field. \"\n                             \"Choices are: %s\" % (name, \", \".join(names)))\n \n@@ -1571,7 +1572,7 @@ def split_exclude(self, filter_expr, prefix, can_reuse):\n         # Tag.objects.exclude(parent__parent__name='t1'), a tag with no parent\n         # would otherwise be overlooked).\n         active_positions = [pos for (pos, count) in\n-                enumerate(query.alias_refcount.itervalues()) if count]\n+                enumerate(six.itervalues(query.alias_refcount)) if count]\n         if active_positions[-1] > 1:\n             self.add_filter(('%s__isnull' % prefix, False), negate=True,\n                     trim=True, can_reuse=can_reuse)\n@@ -1660,8 +1661,8 @@ def add_fields(self, field_names, allow_m2m=True):\n                 # from the model on which the lookup failed.\n                 raise\n             else:\n-                names = sorted(opts.get_all_field_names() + self.extra.keys()\n-                               + self.aggregate_select.keys())\n+                names = sorted(opts.get_all_field_names() + list(self.extra)\n+                               + list(self.aggregate_select))\n                 raise FieldError(\"Cannot resolve keyword %r into field. \"\n                                  \"Choices are: %s\" % (name, \", \".join(names)))\n         self.remove_inherited_models()\n@@ -1775,7 +1776,7 @@ def add_extra(self, select, select_params, where, params, tables, order_by):\n             else:\n                 param_iter = iter([])\n             for name, entry in select.items():\n-                entry = force_unicode(entry)\n+                entry = force_text(entry)\n                 entry_params = []\n                 pos = entry.find(\"%s\")\n                 while pos != -1:"
        },
        {
            "sha": "937505b9b0f1c3b1b9fb9b476b21b76d9b334ff1",
            "filename": "django/db/models/sql/subqueries.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fmodels%2Fsql%2Fsubqueries.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,8 @@\n from django.db.models.sql.where import AND, Constraint\n from django.utils.datastructures import SortedDict\n from django.utils.functional import Promise\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n+from django.utils import six\n \n \n __all__ = ['DeleteQuery', 'UpdateQuery', 'InsertQuery', 'DateQuery',\n@@ -87,7 +88,7 @@ def add_update_values(self, values):\n         querysets.\n         \"\"\"\n         values_seq = []\n-        for name, val in values.iteritems():\n+        for name, val in six.iteritems(values):\n             field, model, direct, m2m = self.model._meta.get_field_by_name(name)\n             if not direct or m2m:\n                 raise FieldError('Cannot update model field %r (only non-relations and foreign keys permitted).' % field)\n@@ -104,7 +105,7 @@ def add_update_fields(self, values_seq):\n         saving models.\n         \"\"\"\n         # Check that no Promise object passes to the query. Refs #10498.\n-        values_seq = [(value[0], value[1], force_unicode(value[2]))\n+        values_seq = [(value[0], value[1], force_text(value[2]))\n                       if isinstance(value[2], Promise) else value\n                       for value in values_seq]\n         self.values.extend(values_seq)\n@@ -129,7 +130,7 @@ def get_related_updates(self):\n         if not self.related_updates:\n             return []\n         result = []\n-        for model, values in self.related_updates.iteritems():\n+        for model, values in six.iteritems(self.related_updates):\n             query = UpdateQuery(model)\n             query.values = values\n             if self.related_ids is not None:\n@@ -170,7 +171,7 @@ def insert_values(self, fields, objs, raw=False):\n             for obj in objs:\n                 value = getattr(obj, field.attname)\n                 if isinstance(value, Promise):\n-                    setattr(obj, field.attname, force_unicode(value))\n+                    setattr(obj, field.attname, force_text(value))\n         self.objs = objs\n         self.raw = raw\n "
        },
        {
            "sha": "d8728e219a4948868423321d78f4b6f66117506b",
            "filename": "django/dispatch/saferef.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdispatch%2Fsaferef.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fdispatch%2Fsaferef.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdispatch%2Fsaferef.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -152,9 +152,10 @@ def __str__(self):\n     \n     __repr__ = __str__\n     \n-    def __nonzero__( self ):\n+    def __bool__( self ):\n         \"\"\"Whether we are still a valid reference\"\"\"\n         return self() is not None\n+    __nonzero__ = __bool__ # Python 2\n \n     def __eq__(self, other):\n         \"\"\"Compare with another reference\"\"\""
        },
        {
            "sha": "c5ca1424c803be7ddb5510b9b95378c18b135110",
            "filename": "django/forms/extras/widgets.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fextras%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fextras%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fextras%2Fwidgets.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -79,7 +79,7 @@ def render(self, name, value, attrs=None):\n                         year_val, month_val, day_val = [int(v) for v in match.groups()]\n         choices = [(i, i) for i in self.years]\n         year_html = self.create_select(name, self.year_field, value, year_val, choices)\n-        choices = MONTHS.items()\n+        choices = list(six.iteritems(MONTHS))\n         month_html = self.create_select(name, self.month_field, value, month_val, choices)\n         choices = [(i, i) for i in range(1, 32)]\n         day_html = self.create_select(name, self.day_field, value, day_val,  choices)"
        },
        {
            "sha": "7f0d26d1aa799b076ad7d650632c02bf82036e2d",
            "filename": "django/forms/fields.py",
            "status": "modified",
            "additions": 14,
            "deletions": 24,
            "changes": 38,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Ffields.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -23,7 +23,7 @@\n     NullBooleanSelect, SelectMultiple, DateInput, DateTimeInput, TimeInput,\n     SplitDateTimeWidget, SplitHiddenDateTimeWidget, FILE_INPUT_CONTRADICTION)\n from django.utils import formats\n-from django.utils.encoding import smart_unicode, force_unicode\n+from django.utils.encoding import smart_text, force_text\n from django.utils.ipv6 import clean_ipv6_address\n from django.utils import six\n from django.utils.translation import ugettext_lazy as _\n@@ -78,13 +78,13 @@ def __init__(self, required=True, widget=None, label=None, initial=None,\n         # validators -- List of addtional validators to use\n         # localize -- Boolean that specifies if the field should be localized.\n         if label is not None:\n-            label = smart_unicode(label)\n+            label = smart_text(label)\n         self.required, self.label, self.initial = required, label, initial\n         self.show_hidden_initial = show_hidden_initial\n         if help_text is None:\n             self.help_text = ''\n         else:\n-            self.help_text = smart_unicode(help_text)\n+            self.help_text = smart_text(help_text)\n         widget = widget or self.widget\n         if isinstance(widget, type):\n             widget = widget()\n@@ -195,7 +195,7 @@ def to_python(self, value):\n         \"Returns a Unicode object.\"\n         if value in validators.EMPTY_VALUES:\n             return ''\n-        return smart_unicode(value)\n+        return smart_text(value)\n \n     def widget_attrs(self, widget):\n         attrs = super(CharField, self).widget_attrs(widget)\n@@ -288,7 +288,7 @@ def to_python(self, value):\n             return None\n         if self.localize:\n             value = formats.sanitize_separators(value)\n-        value = smart_unicode(value).strip()\n+        value = smart_text(value).strip()\n         try:\n             value = Decimal(value)\n         except DecimalException:\n@@ -333,7 +333,7 @@ def __init__(self, input_formats=None, *args, **kwargs):\n \n     def to_python(self, value):\n         # Try to coerce the value to unicode.\n-        unicode_value = force_unicode(value, strings_only=True)\n+        unicode_value = force_text(value, strings_only=True)\n         if isinstance(unicode_value, six.text_type):\n             value = unicode_value.strip()\n         # If unicode, try to strptime against each input format.\n@@ -560,20 +560,10 @@ def to_python(self, data):\n                 file = BytesIO(data['content'])\n \n         try:\n-            # load() is the only method that can spot a truncated JPEG,\n-            #  but it cannot be called sanely after verify()\n-            trial_image = Image.open(file)\n-            trial_image.load()\n-\n-            # Since we're about to use the file again we have to reset the\n-            # file object if possible.\n-            if hasattr(file, 'seek') and callable(file.seek):\n-                file.seek(0)\n-\n-            # verify() is the only method that can spot a corrupt PNG,\n-            #  but it must be called immediately after the constructor\n-            trial_image = Image.open(file)\n-            trial_image.verify()\n+            # load() could spot a truncated JPEG, but it loads the entire\n+            # image in memory, which is a DoS vector. See #3848 and #18520.\n+            # verify() must be called immediately after the constructor.\n+            Image.open(file).verify()\n         except ImportError:\n             # Under PyPy, it is possible to import PIL. However, the underlying\n             # _imaging C module isn't available, so an ImportError will be\n@@ -702,7 +692,7 @@ def to_python(self, value):\n         \"Returns a Unicode object.\"\n         if value in validators.EMPTY_VALUES:\n             return ''\n-        return smart_unicode(value)\n+        return smart_text(value)\n \n     def validate(self, value):\n         \"\"\"\n@@ -718,10 +708,10 @@ def valid_value(self, value):\n             if isinstance(v, (list, tuple)):\n                 # This is an optgroup, so look inside the group for options\n                 for k2, v2 in v:\n-                    if value == smart_unicode(k2):\n+                    if value == smart_text(k2):\n                         return True\n             else:\n-                if value == smart_unicode(k):\n+                if value == smart_text(k):\n                     return True\n         return False\n \n@@ -762,7 +752,7 @@ def to_python(self, value):\n             return []\n         elif not isinstance(value, (list, tuple)):\n             raise ValidationError(self.error_messages['invalid_list'])\n-        return [smart_unicode(val) for val in value]\n+        return [smart_text(val) for val in value]\n \n     def validate(self, value):\n         \"\"\""
        },
        {
            "sha": "45b758202a185769fa8d0b0321a3871910fa4e38",
            "filename": "django/forms/forms.py",
            "status": "modified",
            "additions": 13,
            "deletions": 15,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n from django.forms.widgets import Media, media_property, TextInput, Textarea\n from django.utils.datastructures import SortedDict\n from django.utils.html import conditional_escape, format_html\n-from django.utils.encoding import StrAndUnicode, smart_unicode, force_unicode\n+from django.utils.encoding import StrAndUnicode, smart_text, force_text\n from django.utils.safestring import mark_safe\n from django.utils import six\n \n@@ -38,7 +38,7 @@ def get_declared_fields(bases, attrs, with_base_fields=True):\n     used. The distinction is useful in ModelForm subclassing.\n     Also integrates any additional media definitions\n     \"\"\"\n-    fields = [(field_name, attrs.pop(field_name)) for field_name, obj in attrs.items() if isinstance(obj, Field)]\n+    fields = [(field_name, attrs.pop(field_name)) for field_name, obj in list(six.iteritems(attrs)) if isinstance(obj, Field)]\n     fields.sort(key=lambda x: x[1].creation_counter)\n \n     # If this class is subclassing another Form, add that Form's fields.\n@@ -47,11 +47,11 @@ def get_declared_fields(bases, attrs, with_base_fields=True):\n     if with_base_fields:\n         for base in bases[::-1]:\n             if hasattr(base, 'base_fields'):\n-                fields = base.base_fields.items() + fields\n+                fields = list(six.iteritems(base.base_fields)) + fields\n     else:\n         for base in bases[::-1]:\n             if hasattr(base, 'declared_fields'):\n-                fields = base.declared_fields.items() + fields\n+                fields = list(six.iteritems(base.declared_fields)) + fields\n \n     return SortedDict(fields)\n \n@@ -150,7 +150,7 @@ def _html_output(self, normal_row, error_row, row_ender, help_text_html, errors_\n             bf_errors = self.error_class([conditional_escape(error) for error in bf.errors]) # Escape and cache in local variable.\n             if bf.is_hidden:\n                 if bf_errors:\n-                    top_errors.extend(['(Hidden field %s) %s' % (name, force_unicode(e)) for e in bf_errors])\n+                    top_errors.extend(['(Hidden field %s) %s' % (name, force_text(e)) for e in bf_errors])\n                 hidden_fields.append(six.text_type(bf))\n             else:\n                 # Create a 'class=\"...\"' atribute if the row should have any\n@@ -160,10 +160,10 @@ def _html_output(self, normal_row, error_row, row_ender, help_text_html, errors_\n                     html_class_attr = ' class=\"%s\"' % css_classes\n \n                 if errors_on_separate_row and bf_errors:\n-                    output.append(error_row % force_unicode(bf_errors))\n+                    output.append(error_row % force_text(bf_errors))\n \n                 if bf.label:\n-                    label = conditional_escape(force_unicode(bf.label))\n+                    label = conditional_escape(force_text(bf.label))\n                     # Only add the suffix if the label does not end in\n                     # punctuation.\n                     if self.label_suffix:\n@@ -174,20 +174,20 @@ def _html_output(self, normal_row, error_row, row_ender, help_text_html, errors_\n                     label = ''\n \n                 if field.help_text:\n-                    help_text = help_text_html % force_unicode(field.help_text)\n+                    help_text = help_text_html % force_text(field.help_text)\n                 else:\n                     help_text = ''\n \n                 output.append(normal_row % {\n-                    'errors': force_unicode(bf_errors),\n-                    'label': force_unicode(label),\n+                    'errors': force_text(bf_errors),\n+                    'label': force_text(label),\n                     'field': six.text_type(bf),\n                     'help_text': help_text,\n                     'html_class_attr': html_class_attr\n                 })\n \n         if top_errors:\n-            output.insert(0, error_row % force_unicode(top_errors))\n+            output.insert(0, error_row % force_text(top_errors))\n \n         if hidden_fields: # Insert any hidden fields in the last row.\n             str_hidden = ''.join(hidden_fields)\n@@ -271,8 +271,6 @@ def full_clean(self):\n         self._clean_fields()\n         self._clean_form()\n         self._post_clean()\n-        if self._errors:\n-            del self.cleaned_data\n \n     def _clean_fields(self):\n         for name, field in self.fields.items():\n@@ -537,8 +535,8 @@ def _auto_id(self):\n         associated Form has specified auto_id. Returns an empty string otherwise.\n         \"\"\"\n         auto_id = self.form.auto_id\n-        if auto_id and '%s' in smart_unicode(auto_id):\n-            return smart_unicode(auto_id) % self.html_name\n+        if auto_id and '%s' in smart_text(auto_id):\n+            return smart_text(auto_id) % self.html_name\n         elif auto_id:\n             return self.html_name\n         return ''"
        },
        {
            "sha": "4ea8dc4ca92036f5fa37d2caecb71506393bdb65",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -65,9 +65,10 @@ def __getitem__(self, index):\n     def __len__(self):\n         return len(self.forms)\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         \"\"\"All formsets have a management form which is not included in the length\"\"\"\n         return True\n+    __nonzero__ = __bool__ # Python 2\n \n     def _management_form(self):\n         \"\"\"Returns the ManagementForm instance for this FormSet.\"\"\"\n@@ -365,7 +366,7 @@ def formset_factory(form, formset=BaseFormSet, extra=1, can_order=False,\n     attrs = {'form': form, 'extra': extra,\n              'can_order': can_order, 'can_delete': can_delete,\n              'max_num': max_num}\n-    return type(form.__name__ + b'FormSet', (formset,), attrs)\n+    return type(form.__name__ + str('FormSet'), (formset,), attrs)\n \n def all_valid(formsets):\n     \"\"\"Returns true if every formset in formsets is valid.\"\"\""
        },
        {
            "sha": "0b07d31d9a43f6ffcb9665f645f82f938a4b0c94",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 22,
            "deletions": 22,
            "changes": 44,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -13,11 +13,12 @@\n from django.forms.util import ErrorList\n from django.forms.widgets import (SelectMultiple, HiddenInput,\n     MultipleHiddenInput, media_property)\n-from django.utils.encoding import smart_unicode, force_unicode\n+from django.utils.encoding import smart_text, force_text\n from django.utils.datastructures import SortedDict\n from django.utils import six\n from django.utils.text import get_text_list, capfirst\n from django.utils.translation import ugettext_lazy as _, ugettext\n+from django.utils import six\n \n \n __all__ = (\n@@ -206,7 +207,7 @@ def __new__(cls, name, bases, attrs):\n             fields = fields_for_model(opts.model, opts.fields,\n                                       opts.exclude, opts.widgets, formfield_callback)\n             # make sure opts.fields doesn't specify an invalid field\n-            none_model_fields = [k for k, v in fields.iteritems() if not v]\n+            none_model_fields = [k for k, v in six.iteritems(fields) if not v]\n             missing_fields = set(none_model_fields) - \\\n                              set(declared_fields.keys())\n             if missing_fields:\n@@ -389,10 +390,10 @@ def modelform_factory(model, form=ModelForm, fields=None, exclude=None,\n     parent = (object,)\n     if hasattr(form, 'Meta'):\n         parent = (form.Meta, object)\n-    Meta = type(b'Meta', parent, attrs)\n+    Meta = type(str('Meta'), parent, attrs)\n \n     # Give this new form class a reasonable name.\n-    class_name = model.__name__ + b'Form'\n+    class_name = model.__name__ + str('Form')\n \n     # Class attributes for the new form class.\n     form_class_attrs = {\n@@ -506,7 +507,7 @@ def validate_unique(self):\n         all_unique_checks = set()\n         all_date_checks = set()\n         for form in self.forms:\n-            if not hasattr(form, 'cleaned_data'):\n+            if not form.is_valid():\n                 continue\n             exclude = form._get_validation_exclusions()\n             unique_checks, date_checks = form.instance._get_unique_checks(exclude=exclude)\n@@ -518,31 +519,29 @@ def validate_unique(self):\n         for uclass, unique_check in all_unique_checks:\n             seen_data = set()\n             for form in self.forms:\n-                # if the form doesn't have cleaned_data then we ignore it,\n-                # it's already invalid\n-                if not hasattr(form, \"cleaned_data\"):\n+                if not form.is_valid():\n                     continue\n                 # get data for each field of each of unique_check\n                 row_data = tuple([form.cleaned_data[field] for field in unique_check if field in form.cleaned_data])\n                 if row_data and not None in row_data:\n-                    # if we've aready seen it then we have a uniqueness failure\n+                    # if we've already seen it then we have a uniqueness failure\n                     if row_data in seen_data:\n                         # poke error messages into the right places and mark\n                         # the form as invalid\n                         errors.append(self.get_unique_error_message(unique_check))\n                         form._errors[NON_FIELD_ERRORS] = self.error_class([self.get_form_error()])\n-                        del form.cleaned_data\n-                        break\n+                        # remove the data from the cleaned_data dict since it was invalid\n+                        for field in unique_check:\n+                            if field in form.cleaned_data:\n+                                del form.cleaned_data[field]\n                     # mark the data as seen\n                     seen_data.add(row_data)\n         # iterate over each of the date checks now\n         for date_check in all_date_checks:\n             seen_data = set()\n             uclass, lookup, field, unique_for = date_check\n             for form in self.forms:\n-                # if the form doesn't have cleaned_data then we ignore it,\n-                # it's already invalid\n-                if not hasattr(self, 'cleaned_data'):\n+                if not form.is_valid():\n                     continue\n                 # see if we have data for both fields\n                 if (form.cleaned_data and form.cleaned_data[field] is not None\n@@ -556,14 +555,15 @@ def validate_unique(self):\n                     else:\n                         date_data = (getattr(form.cleaned_data[unique_for], lookup),)\n                     data = (form.cleaned_data[field],) + date_data\n-                    # if we've aready seen it then we have a uniqueness failure\n+                    # if we've already seen it then we have a uniqueness failure\n                     if data in seen_data:\n                         # poke error messages into the right places and mark\n                         # the form as invalid\n                         errors.append(self.get_date_error_message(date_check))\n                         form._errors[NON_FIELD_ERRORS] = self.error_class([self.get_form_error()])\n-                        del form.cleaned_data\n-                        break\n+                        # remove the data from the cleaned_data dict since it was invalid\n+                        del form.cleaned_data[field]\n+                    # mark the data as seen\n                     seen_data.add(data)\n         if errors:\n             raise ValidationError(errors)\n@@ -875,7 +875,7 @@ def clean(self, value):\n             orig = getattr(self.parent_instance, self.to_field)\n         else:\n             orig = self.parent_instance.pk\n-        if force_unicode(value) != force_unicode(orig):\n+        if force_text(value) != force_text(orig):\n             raise ValidationError(self.error_messages['invalid_choice'])\n         return self.parent_instance\n \n@@ -953,7 +953,7 @@ def label_from_instance(self, obj):\n         generate the labels for the choices presented by this object. Subclasses\n         can override this method to customize the display of the choices.\n         \"\"\"\n-        return smart_unicode(obj)\n+        return smart_text(obj)\n \n     def _get_choices(self):\n         # If self._choices is set, then somebody must have manually set\n@@ -1025,16 +1025,16 @@ def clean(self, value):\n             except ValueError:\n                 raise ValidationError(self.error_messages['invalid_pk_value'] % pk)\n         qs = self.queryset.filter(**{'%s__in' % key: value})\n-        pks = set([force_unicode(getattr(o, key)) for o in qs])\n+        pks = set([force_text(getattr(o, key)) for o in qs])\n         for val in value:\n-            if force_unicode(val) not in pks:\n+            if force_text(val) not in pks:\n                 raise ValidationError(self.error_messages['invalid_choice'] % val)\n         # Since this overrides the inherited ModelChoiceField.clean\n         # we run custom validators here\n         self.run_validators(value)\n         return qs\n \n     def prepare_value(self, value):\n-        if hasattr(value, '__iter__'):\n+        if hasattr(value, '__iter__') and not isinstance(value, six.text_type):\n             return [super(ModelMultipleChoiceField, self).prepare_value(v) for v in value]\n         return super(ModelMultipleChoiceField, self).prepare_value(value)"
        },
        {
            "sha": "cd6b52df6fbfe40cf4d2a9031ede83c66e2469bd",
            "filename": "django/forms/util.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Futil.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -2,7 +2,7 @@\n \n from django.conf import settings\n from django.utils.html import format_html, format_html_join\n-from django.utils.encoding import StrAndUnicode, force_unicode\n+from django.utils.encoding import StrAndUnicode, force_text\n from django.utils.safestring import mark_safe\n from django.utils import timezone\n from django.utils.translation import ugettext_lazy as _\n@@ -35,12 +35,12 @@ def as_ul(self):\n         if not self: return ''\n         return format_html('<ul class=\"errorlist\">{0}</ul>',\n                            format_html_join('', '<li>{0}{1}</li>',\n-                                            ((k, force_unicode(v))\n+                                            ((k, force_text(v))\n                                              for k, v in self.items())\n                            ))\n \n     def as_text(self):\n-        return '\\n'.join(['* %s\\n%s' % (k, '\\n'.join(['  * %s' % force_unicode(i) for i in v])) for k, v in self.items()])\n+        return '\\n'.join(['* %s\\n%s' % (k, '\\n'.join(['  * %s' % force_text(i) for i in v])) for k, v in self.items()])\n \n class ErrorList(list, StrAndUnicode):\n     \"\"\"\n@@ -53,16 +53,16 @@ def as_ul(self):\n         if not self: return ''\n         return format_html('<ul class=\"errorlist\">{0}</ul>',\n                            format_html_join('', '<li>{0}</li>',\n-                                            ((force_unicode(e),) for e in self)\n+                                            ((force_text(e),) for e in self)\n                                             )\n                            )\n \n     def as_text(self):\n         if not self: return ''\n-        return '\\n'.join(['* %s' % force_unicode(e) for e in self])\n+        return '\\n'.join(['* %s' % force_text(e) for e in self])\n \n     def __repr__(self):\n-        return repr([force_unicode(e) for e in self])\n+        return repr([force_text(e) for e in self])\n \n # Utilities for time zone support in DateTimeField et al.\n "
        },
        {
            "sha": "be9ac8eb8f90f1515489ef506acd04283537cde2",
            "filename": "django/forms/widgets.py",
            "status": "modified",
            "additions": 26,
            "deletions": 26,
            "changes": 52,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fwidgets.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fforms%2Fwidgets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fwidgets.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -17,7 +17,7 @@\n from django.utils.datastructures import MultiValueDict, MergeDict\n from django.utils.html import conditional_escape, format_html, format_html_join\n from django.utils.translation import ugettext, ugettext_lazy\n-from django.utils.encoding import StrAndUnicode, force_unicode\n+from django.utils.encoding import StrAndUnicode, force_text\n from django.utils.safestring import mark_safe\n from django.utils import six\n from django.utils import datetime_safe, formats\n@@ -63,8 +63,7 @@ def render_js(self):\n     def render_css(self):\n         # To keep rendering order consistent, we can't just iterate over items().\n         # We need to sort the keys, and iterate over the sorted list.\n-        media = self._css.keys()\n-        media.sort()\n+        media = sorted(self._css.keys())\n         return chain(*[\n                 [format_html('<link href=\"{0}\" type=\"text/css\" media=\"{1}\" rel=\"stylesheet\" />', self.absolute_path(path), medium)\n                     for path in self._css[medium]]\n@@ -110,9 +109,10 @@ def __add__(self, other):\n def media_property(cls):\n     def _media(self):\n         # Get the media property of the superclass, if it exists\n-        if hasattr(super(cls, self), 'media'):\n-            base = super(cls, self).media\n-        else:\n+        sup_cls = super(cls, self)\n+        try:\n+            base = sup_cls.media\n+        except AttributeError:\n             base = Media()\n \n         # Get the media definition for this class\n@@ -223,7 +223,7 @@ def _has_changed(self, initial, data):\n             initial_value = ''\n         else:\n             initial_value = initial\n-        if force_unicode(initial_value) != force_unicode(data_value):\n+        if force_text(initial_value) != force_text(data_value):\n             return True\n         return False\n \n@@ -257,7 +257,7 @@ def render(self, name, value, attrs=None):\n         final_attrs = self.build_attrs(attrs, type=self.input_type, name=name)\n         if value != '':\n             # Only add the 'value' attribute if a value is non-empty.\n-            final_attrs['value'] = force_unicode(self._format_value(value))\n+            final_attrs['value'] = force_text(self._format_value(value))\n         return format_html('<input{0} />', flatatt(final_attrs))\n \n class TextInput(Input):\n@@ -294,7 +294,7 @@ def render(self, name, value, attrs=None, choices=()):\n         id_ = final_attrs.get('id', None)\n         inputs = []\n         for i, v in enumerate(value):\n-            input_attrs = dict(value=force_unicode(v), **final_attrs)\n+            input_attrs = dict(value=force_text(v), **final_attrs)\n             if id_:\n                 # An ID attribute was given. Add a numeric index as a suffix\n                 # so that the inputs don't all have the same ID attribute.\n@@ -361,7 +361,7 @@ def render(self, name, value, attrs=None):\n             template = self.template_with_initial\n             substitutions['initial'] = format_html('<a href=\"{0}\">{1}</a>',\n                                                    value.url,\n-                                                   force_unicode(value))\n+                                                   force_text(value))\n             if not self.is_required:\n                 checkbox_name = self.clear_checkbox_name(name)\n                 checkbox_id = self.clear_checkbox_id(checkbox_name)\n@@ -398,7 +398,7 @@ def render(self, name, value, attrs=None):\n         final_attrs = self.build_attrs(attrs, name=name)\n         return format_html('<textarea{0}>{1}</textarea>',\n                            flatatt(final_attrs),\n-                           force_unicode(value))\n+                           force_text(value))\n \n class DateInput(Input):\n     input_type = 'text'\n@@ -515,7 +515,7 @@ def render(self, name, value, attrs=None):\n             final_attrs['checked'] = 'checked'\n         if not (value is True or value is False or value is None or value == ''):\n             # Only add the 'value' attribute if a value is non-empty.\n-            final_attrs['value'] = force_unicode(value)\n+            final_attrs['value'] = force_text(value)\n         return format_html('<input{0} />', flatatt(final_attrs))\n \n     def value_from_datadict(self, data, files, name):\n@@ -556,7 +556,7 @@ def render(self, name, value, attrs=None, choices=()):\n         return mark_safe('\\n'.join(output))\n \n     def render_option(self, selected_choices, option_value, option_label):\n-        option_value = force_unicode(option_value)\n+        option_value = force_text(option_value)\n         if option_value in selected_choices:\n             selected_html = mark_safe(' selected=\"selected\"')\n             if not self.allow_multiple_selected:\n@@ -567,15 +567,15 @@ def render_option(self, selected_choices, option_value, option_label):\n         return format_html('<option value=\"{0}\"{1}>{2}</option>',\n                            option_value,\n                            selected_html,\n-                           force_unicode(option_label))\n+                           force_text(option_label))\n \n     def render_options(self, choices, selected_choices):\n         # Normalize to strings.\n-        selected_choices = set(force_unicode(v) for v in selected_choices)\n+        selected_choices = set(force_text(v) for v in selected_choices)\n         output = []\n         for option_value, option_label in chain(self.choices, choices):\n             if isinstance(option_label, (list, tuple)):\n-                output.append(format_html('<optgroup label=\"{0}\">', force_unicode(option_value)))\n+                output.append(format_html('<optgroup label=\"{0}\">', force_text(option_value)))\n                 for option in option_label:\n                     output.append(self.render_option(selected_choices, *option))\n                 output.append('</optgroup>')\n@@ -643,8 +643,8 @@ def _has_changed(self, initial, data):\n             data = []\n         if len(initial) != len(data):\n             return True\n-        initial_set = set([force_unicode(value) for value in initial])\n-        data_set = set([force_unicode(value) for value in data])\n+        initial_set = set([force_text(value) for value in initial])\n+        data_set = set([force_text(value) for value in data])\n         return data_set != initial_set\n \n class RadioInput(SubWidget):\n@@ -656,8 +656,8 @@ class RadioInput(SubWidget):\n     def __init__(self, name, value, attrs, choice, index):\n         self.name, self.value = name, value\n         self.attrs = attrs\n-        self.choice_value = force_unicode(choice[0])\n-        self.choice_label = force_unicode(choice[1])\n+        self.choice_value = force_text(choice[0])\n+        self.choice_label = force_text(choice[1])\n         self.index = index\n \n     def __unicode__(self):\n@@ -671,7 +671,7 @@ def render(self, name=None, value=None, attrs=None, choices=()):\n             label_for = format_html(' for=\"{0}_{1}\"', self.attrs['id'], self.index)\n         else:\n             label_for = ''\n-        choice_label = force_unicode(self.choice_label)\n+        choice_label = force_text(self.choice_label)\n         return format_html('<label{0}>{1} {2}</label>', label_for, self.tag(), choice_label)\n \n     def is_checked(self):\n@@ -709,7 +709,7 @@ def render(self):\n         \"\"\"Outputs a <ul> for this set of radio fields.\"\"\"\n         return format_html('<ul>\\n{0}\\n</ul>',\n                            format_html_join('\\n', '<li>{0}</li>',\n-                                            [(force_unicode(w),) for w in self]\n+                                            [(force_text(w),) for w in self]\n                                             ))\n \n class RadioSelect(Select):\n@@ -729,7 +729,7 @@ def subwidgets(self, name, value, attrs=None, choices=()):\n     def get_renderer(self, name, value, attrs=None, choices=()):\n         \"\"\"Returns an instance of the renderer.\"\"\"\n         if value is None: value = ''\n-        str_value = force_unicode(value) # Normalize to string.\n+        str_value = force_text(value) # Normalize to string.\n         final_attrs = self.build_attrs(attrs)\n         choices = list(chain(self.choices, choices))\n         return self.renderer(name, str_value, final_attrs, choices)\n@@ -753,7 +753,7 @@ def render(self, name, value, attrs=None, choices=()):\n         final_attrs = self.build_attrs(attrs, name=name)\n         output = ['<ul>']\n         # Normalize to strings\n-        str_values = set([force_unicode(v) for v in value])\n+        str_values = set([force_text(v) for v in value])\n         for i, (option_value, option_label) in enumerate(chain(self.choices, choices)):\n             # If an ID attribute was given, add a numeric index as a suffix,\n             # so that the checkboxes don't all have the same ID attribute.\n@@ -764,9 +764,9 @@ def render(self, name, value, attrs=None, choices=()):\n                 label_for = ''\n \n             cb = CheckboxInput(final_attrs, check_test=lambda value: value in str_values)\n-            option_value = force_unicode(option_value)\n+            option_value = force_text(option_value)\n             rendered_cb = cb.render(name, option_value)\n-            option_label = force_unicode(option_label)\n+            option_label = force_text(option_label)\n             output.append(format_html('<li><label{0}>{1} {2}</label></li>',\n                                       label_for, rendered_cb, option_label))\n         output.append('</ul>')"
        },
        {
            "sha": "05824ad1d9d93b402652c26243dc4f0efb0f985b",
            "filename": "django/http/__init__.py",
            "status": "modified",
            "additions": 35,
            "deletions": 26,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fhttp%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fhttp%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,18 +11,18 @@\n from io import BytesIO\n from pprint import pformat\n try:\n-    from urllib.parse import quote, parse_qsl, urlencode, urljoin\n+    from urllib.parse import quote, parse_qsl, urlencode, urljoin, urlparse\n except ImportError:     # Python 2\n     from urllib import quote, urlencode\n-    from urlparse import parse_qsl, urljoin\n+    from urlparse import parse_qsl, urljoin, urlparse\n \n from django.utils.six.moves import http_cookies\n # Some versions of Python 2.7 and later won't need this encoding bug fix:\n _cookie_encodes_correctly = http_cookies.SimpleCookie().value_encode(';') == (';', '\"\\\\073\"')\n # See ticket #13007, http://bugs.python.org/issue2193 and http://trac.edgewall.org/ticket/2256\n _tc = http_cookies.SimpleCookie()\n try:\n-    _tc.load(b'foo:bar=1')\n+    _tc.load(str('foo:bar=1'))\n     _cookie_allows_colon_in_names = True\n except http_cookies.CookieError:\n     _cookie_allows_colon_in_names = False\n@@ -61,14 +61,14 @@ def value_encode(self, val):\n         if not _cookie_allows_colon_in_names:\n             def load(self, rawdata):\n                 self.bad_cookies = set()\n-                super(SimpleCookie, self).load(smart_str(rawdata))\n+                super(SimpleCookie, self).load(smart_bytes(rawdata))\n                 for key in self.bad_cookies:\n                     del self[key]\n \n             # override private __set() method:\n             # (needed for using our Morsel, and for laxness with CookieError\n             def _BaseCookie__set(self, key, real_value, coded_value):\n-                key = smart_str(key)\n+                key = smart_bytes(key)\n                 try:\n                     M = self.get(key, Morsel())\n                     M.set(key, real_value, coded_value)\n@@ -80,12 +80,12 @@ def _BaseCookie__set(self, key, real_value, coded_value):\n \n from django.conf import settings\n from django.core import signing\n-from django.core.exceptions import ImproperlyConfigured\n+from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.core.files import uploadhandler\n from django.http.multipartparser import MultiPartParser\n from django.http.utils import *\n from django.utils.datastructures import MultiValueDict, ImmutableList\n-from django.utils.encoding import smart_str, iri_to_uri, force_unicode\n+from django.utils.encoding import smart_bytes, iri_to_uri, force_text\n from django.utils.http import cookie_date\n from django.utils import six\n from django.utils import timezone\n@@ -137,7 +137,7 @@ def build_request_repr(request, path_override=None, GET_override=None,\n     except:\n         meta = '<could not parse>'\n     path = path_override if path_override is not None else request.path\n-    return smart_str('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n+    return smart_bytes('<%s\\npath:%s,\\nGET:%s,\\nPOST:%s,\\nCOOKIES:%s,\\nMETA:%s>' %\n                      (request.__class__.__name__,\n                       path,\n                       six.text_type(get),\n@@ -385,8 +385,8 @@ def __init__(self, query_string, mutable=False, encoding=None):\n             encoding = settings.DEFAULT_CHARSET\n         self.encoding = encoding\n         for key, value in parse_qsl((query_string or ''), True): # keep_blank_values=True\n-            self.appendlist(force_unicode(key, encoding, errors='replace'),\n-                            force_unicode(value, encoding, errors='replace'))\n+            self.appendlist(force_text(key, encoding, errors='replace'),\n+                            force_text(value, encoding, errors='replace'))\n         self._mutable = mutable\n \n     def _get_encoding(self):\n@@ -481,13 +481,13 @@ def urlencode(self, safe=None):\n         \"\"\"\n         output = []\n         if safe:\n-            safe = smart_str(safe, self.encoding)\n+            safe = smart_bytes(safe, self.encoding)\n             encode = lambda k, v: '%s=%s' % ((quote(k, safe), quote(v, safe)))\n         else:\n             encode = lambda k, v: urlencode({k: v})\n         for k, list_ in self.lists():\n-            k = smart_str(k, self.encoding)\n-            output.extend([encode(k, smart_str(v, self.encoding))\n+            k = smart_bytes(k, self.encoding)\n+            output.extend([encode(k, smart_bytes(v, self.encoding))\n                            for v in list_])\n         return '&'.join(output)\n \n@@ -549,7 +549,12 @@ def _convert_to_ascii(self, *values):\n         for value in values:\n             if isinstance(value, six.text_type):\n                 try:\n-                    value = value.encode('us-ascii')\n+                    if not six.PY3:\n+                        value = value.encode('us-ascii')\n+                    else:\n+                        # In Python 3, use a string in headers,\n+                        # but ensure in only contains ASCII characters.\n+                        value.encode('us-ascii')\n                 except UnicodeError as e:\n                     e.reason += ', HTTP response headers must be in US-ASCII format'\n                     raise\n@@ -648,10 +653,10 @@ def delete_cookie(self, key, path='/', domain=None):\n     def _get_content(self):\n         if self.has_header('Content-Encoding'):\n             return b''.join([str(e) for e in self._container])\n-        return b''.join([smart_str(e, self._charset) for e in self._container])\n+        return b''.join([smart_bytes(e, self._charset) for e in self._container])\n \n     def _set_content(self, value):\n-        if hasattr(value, '__iter__'):\n+        if hasattr(value, '__iter__') and not isinstance(value, (bytes, six.text_type)):\n             self._container = value\n             self._base_content_is_iter = True\n         else:\n@@ -664,12 +669,14 @@ def __iter__(self):\n         self._iterator = iter(self._container)\n         return self\n \n-    def next(self):\n+    def __next__(self):\n         chunk = next(self._iterator)\n         if isinstance(chunk, six.text_type):\n             chunk = chunk.encode(self._charset)\n         return str(chunk)\n \n+    next = __next__             # Python 2 compatibility\n+\n     def close(self):\n         if hasattr(self._container, 'close'):\n             self._container.close()\n@@ -689,19 +696,21 @@ def tell(self):\n             raise Exception(\"This %s instance cannot tell its position\" % self.__class__)\n         return sum([len(chunk) for chunk in self])\n \n-class HttpResponseRedirect(HttpResponse):\n-    status_code = 302\n+class HttpResponseRedirectBase(HttpResponse):\n+    allowed_schemes = ['http', 'https', 'ftp']\n \n     def __init__(self, redirect_to):\n-        super(HttpResponseRedirect, self).__init__()\n+        parsed = urlparse(redirect_to)\n+        if parsed.scheme and parsed.scheme not in self.allowed_schemes:\n+            raise SuspiciousOperation(\"Unsafe redirect to URL with protocol '%s'\" % parsed.scheme)\n+        super(HttpResponseRedirectBase, self).__init__()\n         self['Location'] = iri_to_uri(redirect_to)\n \n-class HttpResponsePermanentRedirect(HttpResponse):\n-    status_code = 301\n+class HttpResponseRedirect(HttpResponseRedirectBase):\n+    status_code = 302\n \n-    def __init__(self, redirect_to):\n-        super(HttpResponsePermanentRedirect, self).__init__()\n-        self['Location'] = iri_to_uri(redirect_to)\n+class HttpResponsePermanentRedirect(HttpResponseRedirectBase):\n+    status_code = 301\n \n class HttpResponseNotModified(HttpResponse):\n     status_code = 304\n@@ -733,7 +742,7 @@ def get_host(request):\n     return request.get_host()\n \n # It's neither necessary nor appropriate to use\n-# django.utils.encoding.smart_unicode for parsing URLs and form inputs. Thus,\n+# django.utils.encoding.smart_text for parsing URLs and form inputs. Thus,\n # this slightly more restricted function.\n def str_to_unicode(s, encoding):\n     \"\"\""
        },
        {
            "sha": "9c66827cbb8403fbb4fd69630d510102adb5ea0d",
            "filename": "django/http/multipartparser.py",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fhttp%2Fmultipartparser.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fhttp%2Fmultipartparser.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fhttp%2Fmultipartparser.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.conf import settings\n from django.core.exceptions import SuspiciousOperation\n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils import six\n from django.utils.text import unescape_entities\n from django.core.files.uploadhandler import StopUpload, SkipFile, StopFutureHandlers\n@@ -151,7 +151,7 @@ def parse(self):\n                 transfer_encoding = meta_data.get('content-transfer-encoding')\n                 if transfer_encoding is not None:\n                     transfer_encoding = transfer_encoding[0].strip()\n-                field_name = force_unicode(field_name, encoding, errors='replace')\n+                field_name = force_text(field_name, encoding, errors='replace')\n \n                 if item_type == FIELD:\n                     # This is a post field, we can just set it in the post\n@@ -165,13 +165,13 @@ def parse(self):\n                         data = field_stream.read()\n \n                     self._post.appendlist(field_name,\n-                                          force_unicode(data, encoding, errors='replace'))\n+                                          force_text(data, encoding, errors='replace'))\n                 elif item_type == FILE:\n                     # This is a file, use the handler...\n                     file_name = disposition.get('filename')\n                     if not file_name:\n                         continue\n-                    file_name = force_unicode(file_name, encoding, errors='replace')\n+                    file_name = force_text(file_name, encoding, errors='replace')\n                     file_name = self.IE_sanitize(unescape_entities(file_name))\n \n                     content_type = meta_data.get('content-type', ('',))[0].strip()\n@@ -245,7 +245,7 @@ def handle_file_complete(self, old_field_name, counters):\n             file_obj = handler.file_complete(counters[i])\n             if file_obj:\n                 # If it returns a file object, then set the files dict.\n-                self._files.appendlist(force_unicode(old_field_name,\n+                self._files.appendlist(force_text(old_field_name,\n                                                      self._encoding,\n                                                      errors='replace'),\n                                        file_obj)\n@@ -305,7 +305,7 @@ def parts():\n         out = b''.join(parts())\n         return out\n \n-    def next(self):\n+    def __next__(self):\n         \"\"\"\n         Used when the exact number of bytes to read is unimportant.\n \n@@ -322,6 +322,8 @@ def next(self):\n         self.position += len(output)\n         return output\n \n+    next = __next__             # Python 2 compatibility\n+\n     def close(self):\n         \"\"\"\n         Used to invalidate/disable this lazy stream.\n@@ -376,7 +378,7 @@ def __init__(self, flo, chunk_size=64 * 1024):\n         self.flo = flo\n         self.chunk_size = chunk_size\n \n-    def next(self):\n+    def __next__(self):\n         try:\n             data = self.flo.read(self.chunk_size)\n         except InputStreamExhausted:\n@@ -386,6 +388,8 @@ def next(self):\n         else:\n             raise StopIteration()\n \n+    next = __next__             # Python 2 compatibility\n+\n     def __iter__(self):\n         return self\n \n@@ -400,12 +404,14 @@ def __init__(self, stream, boundary):\n     def __iter__(self):\n         return self\n \n-    def next(self):\n+    def __next__(self):\n         try:\n             return LazyStream(BoundaryIter(self._stream, self._boundary))\n         except InputStreamExhausted:\n             raise StopIteration()\n \n+    next = __next__             # Python 2 compatibility\n+\n class BoundaryIter(object):\n     \"\"\"\n     A Producer that is sensitive to boundaries.\n@@ -441,7 +447,7 @@ def __init__(self, stream, boundary):\n     def __iter__(self):\n         return self\n \n-    def next(self):\n+    def __next__(self):\n         if self._done:\n             raise StopIteration()\n \n@@ -482,6 +488,8 @@ def next(self):\n                 stream.unget(chunk[-rollback:])\n                 return chunk[:-rollback]\n \n+    next = __next__             # Python 2 compatibility\n+\n     def _find_boundary(self, data, eof = False):\n         \"\"\"\n         Finds a multipart boundary in data."
        },
        {
            "sha": "661d8c092ad27e53ecc3aca2a6c720c1e811041d",
            "filename": "django/template/base.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,7 +11,7 @@\n from django.utils.itercompat import is_iterable\n from django.utils.text import (smart_split, unescape_string_literal,\n     get_text_list)\n-from django.utils.encoding import smart_unicode, force_unicode, smart_str\n+from django.utils.encoding import smart_text, force_text, smart_bytes\n from django.utils.translation import ugettext_lazy, pgettext_lazy\n from django.utils.safestring import (SafeData, EscapeData, mark_safe,\n     mark_for_escaping)\n@@ -89,7 +89,7 @@ def __str__(self):\n         return six.text_type(self).encode('utf-8')\n \n     def __unicode__(self):\n-        return self.msg % tuple([force_unicode(p, errors='replace')\n+        return self.msg % tuple([force_text(p, errors='replace')\n                                  for p in self.params])\n \n class InvalidTemplateLibrary(Exception):\n@@ -117,7 +117,7 @@ class Template(object):\n     def __init__(self, template_string, origin=None,\n                  name='<Unknown Template>'):\n         try:\n-            template_string = smart_unicode(template_string)\n+            template_string = smart_text(template_string)\n         except UnicodeDecodeError:\n             raise TemplateEncodingError(\"Templates can only be constructed \"\n                                         \"from unicode or UTF-8 strings.\")\n@@ -831,7 +831,7 @@ def render(self, context):\n                 bit = self.render_node(node, context)\n             else:\n                 bit = node\n-            bits.append(force_unicode(bit))\n+            bits.append(force_text(bit))\n         return mark_safe(''.join(bits))\n \n     def get_nodes_by_type(self, nodetype):\n@@ -849,7 +849,7 @@ def __init__(self, s):\n         self.s = s\n \n     def __repr__(self):\n-        return \"<Text Node: '%s'>\" % smart_str(self.s[:25], 'ascii',\n+        return \"<Text Node: '%s'>\" % smart_bytes(self.s[:25], 'ascii',\n                 errors='replace')\n \n     def render(self, context):\n@@ -863,7 +863,7 @@ def _render_value_in_context(value, context):\n     \"\"\"\n     value = template_localtime(value, use_tz=context.use_tz)\n     value = localize(value, use_l10n=context.use_l10n)\n-    value = force_unicode(value)\n+    value = force_text(value)\n     if ((context.autoescape and not isinstance(value, SafeData)) or\n             isinstance(value, EscapeData)):\n         return escape(value)\n@@ -961,7 +961,7 @@ def parse_bits(parser, bits, params, varargs, varkw, defaults,\n         kwarg = token_kwargs([bit], parser)\n         if kwarg:\n             # The kwarg was successfully extracted\n-            param, value = kwarg.items()[0]\n+            param, value = list(six.iteritems(kwarg))[0]\n             if param not in params and varkw is None:\n                 # An unexpected keyword argument was supplied\n                 raise TemplateSyntaxError("
        },
        {
            "sha": "c7ac007b48caf0671b29a606b79e78423f5a3ce9",
            "filename": "django/template/debug.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdebug.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,5 +1,5 @@\n from django.template.base import Lexer, Parser, tag_re, NodeList, VariableNode, TemplateSyntaxError\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.html import escape\n from django.utils.safestring import SafeData, EscapeData\n from django.utils.formats import localize\n@@ -84,7 +84,7 @@ def render(self, context):\n             output = self.filter_expression.resolve(context)\n             output = template_localtime(output, use_tz=context.use_tz)\n             output = localize(output, use_l10n=context.use_l10n)\n-            output = force_unicode(output)\n+            output = force_text(output)\n         except UnicodeDecodeError:\n             return ''\n         except Exception as e:"
        },
        {
            "sha": "16801fd5736d63f040304622612a40d74db36ea0",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,7 +12,7 @@\n from django.conf import settings\n from django.utils import formats\n from django.utils.dateformat import format, time_format\n-from django.utils.encoding import force_unicode, iri_to_uri\n+from django.utils.encoding import force_text, iri_to_uri\n from django.utils.html import (conditional_escape, escapejs, fix_ampersands,\n     escape, urlize as urlize_impl, linebreaks, strip_tags)\n from django.utils.http import urlquote\n@@ -38,7 +38,7 @@ def stringfilter(func):\n     def _dec(*args, **kwargs):\n         if args:\n             args = list(args)\n-            args[0] = force_unicode(args[0])\n+            args[0] = force_text(args[0])\n             if (isinstance(args[0], SafeData) and\n                 getattr(_dec._decorated_function, 'is_safe', False)):\n                 return mark_safe(func(*args, **kwargs))\n@@ -139,15 +139,15 @@ def floatformat(text, arg=-1):\n     \"\"\"\n \n     try:\n-        input_val = force_unicode(text)\n+        input_val = force_text(text)\n         d = Decimal(input_val)\n     except UnicodeEncodeError:\n         return ''\n     except InvalidOperation:\n         if input_val in special_floats:\n             return input_val\n         try:\n-            d = Decimal(force_unicode(float(text)))\n+            d = Decimal(force_text(float(text)))\n         except (ValueError, InvalidOperation, TypeError, UnicodeEncodeError):\n             return ''\n     try:\n@@ -192,7 +192,7 @@ def floatformat(text, arg=-1):\n @stringfilter\n def iriencode(value):\n     \"\"\"Escapes an IRI value for use in a URL.\"\"\"\n-    return force_unicode(iri_to_uri(value))\n+    return force_text(iri_to_uri(value))\n \n @register.filter(is_safe=True, needs_autoescape=True)\n @stringfilter\n@@ -462,7 +462,7 @@ def safeseq(value):\n     individually, as safe, after converting them to unicode. Returns a list\n     with the results.\n     \"\"\"\n-    return [mark_safe(force_unicode(obj)) for obj in value]\n+    return [mark_safe(force_text(obj)) for obj in value]\n \n @register.filter(is_safe=True)\n @stringfilter\n@@ -521,7 +521,7 @@ def join(value, arg, autoescape=None):\n     \"\"\"\n     Joins a list with a string, like Python's ``str.join(list)``.\n     \"\"\"\n-    value = map(force_unicode, value)\n+    value = map(force_text, value)\n     if autoescape:\n         value = [conditional_escape(v) for v in value]\n     try:\n@@ -661,7 +661,7 @@ def _helper(list_, tabs=1):\n                 sublist = '\\n%s<ul>\\n%s\\n%s</ul>\\n%s' % (indent, sublist,\n                                                          indent, indent)\n             output.append('%s<li>%s%s</li>' % (indent,\n-                    escaper(force_unicode(title)), sublist))\n+                    escaper(force_text(title)), sublist))\n             i += 1\n         return '\\n'.join(output)\n     value, converted = convert_old_style_list(value)\n@@ -901,4 +901,4 @@ def pprint(value):\n     try:\n         return pformat(value)\n     except Exception as e:\n-        return \"Error in formatting: %s\" % force_unicode(e, errors=\"replace\")\n+        return \"Error in formatting: %s\" % force_text(e, errors=\"replace\")"
        },
        {
            "sha": "14391f08e1d0849c4244f352ee7e775a01f4f1fb",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -14,9 +14,10 @@\n     VARIABLE_ATTRIBUTE_SEPARATOR, get_library, token_kwargs, kwarg_re)\n from django.template.smartif import IfParser, Literal\n from django.template.defaultfilters import date\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.safestring import mark_safe\n from django.utils.html import format_html\n+from django.utils import six\n from django.utils import timezone\n \n register = Library()\n@@ -103,7 +104,7 @@ def render(self, context):\n         for var in self.vars:\n             value = var.resolve(context, True)\n             if value:\n-                return smart_unicode(value)\n+                return smart_text(value)\n         return ''\n \n class ForNode(Node):\n@@ -392,7 +393,7 @@ def __init__(self, view_name, args, kwargs, asvar):\n     def render(self, context):\n         from django.core.urlresolvers import reverse, NoReverseMatch\n         args = [arg.resolve(context) for arg in self.args]\n-        kwargs = dict([(smart_unicode(k, 'ascii'), v.resolve(context))\n+        kwargs = dict([(smart_text(k, 'ascii'), v.resolve(context))\n                        for k, v in self.kwargs.items()])\n \n         view_name = self.view_name.resolve(context)\n@@ -473,7 +474,7 @@ def __repr__(self):\n \n     def render(self, context):\n         values = dict([(key, val.resolve(context)) for key, val in\n-                       self.extra_context.iteritems()])\n+                       six.iteritems(self.extra_context)])\n         context.update(values)\n         output = self.nodelist.render(context)\n         context.pop()\n@@ -1188,7 +1189,7 @@ def templatetag(parser, token):\n     if tag not in TemplateTagNode.mapping:\n         raise TemplateSyntaxError(\"Invalid templatetag argument: '%s'.\"\n                                   \" Must be one of: %s\" %\n-                                  (tag, TemplateTagNode.mapping.keys()))\n+                                  (tag, list(TemplateTagNode.mapping)))\n     return TemplateTagNode(tag)\n \n @register.tag"
        },
        {
            "sha": "d295d058d0779fcd6aaaac92dff55fbdbcb97bf0",
            "filename": "django/template/loader_tags.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Floader_tags.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Floader_tags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floader_tags.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,6 +3,7 @@\n     token_kwargs, Variable\n from django.template.loader import get_template\n from django.utils.safestring import mark_safe\n+from django.utils import six\n \n register = Library()\n \n@@ -17,7 +18,7 @@ def __init__(self):\n         self.blocks = {}\n \n     def add_blocks(self, blocks):\n-        for name, block in blocks.iteritems():\n+        for name, block in six.iteritems(blocks):\n             if name in self.blocks:\n                 self.blocks[name].insert(0, block)\n             else:\n@@ -130,7 +131,7 @@ def __init__(self, *args, **kwargs):\n \n     def render_template(self, template, context):\n         values = dict([(name, var.resolve(context)) for name, var\n-                       in self.extra_context.iteritems()])\n+                       in six.iteritems(self.extra_context)])\n         if self.isolated_context:\n             return template.render(context.new(values))\n         context.update(values)"
        },
        {
            "sha": "887f8a0b729e333930b283db3075f87bcc1b3478",
            "filename": "django/template/loaders/app_directories.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Floaders%2Fapp_directories.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplate%2Floaders%2Fapp_directories.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Floaders%2Fapp_directories.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,9 +12,11 @@\n from django.template.loader import BaseLoader\n from django.utils._os import safe_join\n from django.utils.importlib import import_module\n+from django.utils import six\n \n # At compile time, cache the directories to search.\n-fs_encoding = sys.getfilesystemencoding() or sys.getdefaultencoding()\n+if not six.PY3:\n+    fs_encoding = sys.getfilesystemencoding() or sys.getdefaultencoding()\n app_template_dirs = []\n for app in settings.INSTALLED_APPS:\n     try:\n@@ -23,7 +25,9 @@\n         raise ImproperlyConfigured('ImportError %s: %s' % (app, e.args[0]))\n     template_dir = os.path.join(os.path.dirname(mod.__file__), 'templates')\n     if os.path.isdir(template_dir):\n-        app_template_dirs.append(template_dir.decode(fs_encoding))\n+        if not six.PY3:\n+            template_dir = template_dir.decode(fs_encoding)\n+        app_template_dirs.append(template_dir)\n \n # It won't change, so convert it to a tuple to save memory.\n app_template_dirs = tuple(app_template_dirs)"
        },
        {
            "sha": "30eb6b5f761fb0c870fba3f3aca9c3c910d3bbbb",
            "filename": "django/templatetags/i18n.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplatetags%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplatetags%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fi18n.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -425,7 +425,7 @@ def do_block_translate(parser, token):\n         options[option] = value\n \n     if 'count' in options:\n-        countervar, counter = options['count'].items()[0]\n+        countervar, counter = list(six.iteritems(options['count']))[0]\n     else:\n         countervar, counter = None, None\n     if 'context' in options:"
        },
        {
            "sha": "667de2470e4d38b9f203b6c1887defbb7681264f",
            "filename": "django/templatetags/l10n.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplatetags%2Fl10n.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftemplatetags%2Fl10n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplatetags%2Fl10n.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,7 +1,7 @@\n from django.template import Node\n from django.template import TemplateSyntaxError, Library\n from django.utils import formats\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n register = Library()\n \n@@ -11,15 +11,15 @@ def localize(value):\n     Forces a value to be rendered as a localized value,\n     regardless of the value of ``settings.USE_L10N``.\n     \"\"\"\n-    return force_unicode(formats.localize(value, use_l10n=True))\n+    return force_text(formats.localize(value, use_l10n=True))\n \n @register.filter(is_safe=False)\n def unlocalize(value):\n     \"\"\"\n     Forces a value to be rendered as a non-localized value,\n     regardless of the value of ``settings.USE_L10N``.\n     \"\"\"\n-    return force_unicode(value)\n+    return force_text(value)\n \n class LocalizeNode(Node):\n     def __init__(self, nodelist, use_l10n):"
        },
        {
            "sha": "82d4a6d08ef06256f90ac1095f15e99cc365c015",
            "filename": "django/test/_doctest.py",
            "status": "modified",
            "additions": 103,
            "deletions": 16,
            "changes": 119,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2F_doctest.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2F_doctest.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2F_doctest.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -105,7 +105,7 @@ def _test():\n import warnings\n \n from django.utils import six\n-from django.utils.six import StringIO\n+from django.utils.six.moves import StringIO, xrange\n \n if sys.platform.startswith('java'):\n     # On Jython, isclass() reports some modules as classes. Patch it.\n@@ -501,11 +501,31 @@ def __repr__(self):\n \n \n     # This lets us sort tests by name:\n+    def _cmpkey(self):\n+        return (self.name, self.filename, self.lineno, id(self))\n     def __cmp__(self, other):\n         if not isinstance(other, DocTest):\n             return -1\n-        return cmp((self.name, self.filename, self.lineno, id(self)),\n-                   (other.name, other.filename, other.lineno, id(other)))\n+        return cmp(self._cmpkey(), other._cmpkey())\n+\n+    def __lt__(self, other):\n+        return self._cmpkey() < other._cmpkey()\n+\n+    def __le__(self, other):\n+        return self._cmpkey() <= other._cmpkey()\n+\n+    def __gt__(self, other):\n+        return self._cmpkey() > other._cmpkey()\n+\n+    def __ge__(self, other):\n+        return self._cmpkey() >= other._cmpkey()\n+\n+    def __eq__(self, other):\n+        return self._cmpkey() == other._cmpkey()\n+\n+    def __ne__(self, other):\n+        return self._cmpkey() != other._cmpkey()\n+\n \n ######################################################################\n ## 3. DocTestParser\n@@ -1229,6 +1249,57 @@ def __run(self, test, compileflags, out):\n             # __patched_linecache_getlines).\n             filename = '<doctest %s[%d]>' % (test.name, examplenum)\n \n+            # Doctest and Py3 issue:\n+            # If the current example that we wish to run is going to fail\n+            # because it expects a leading u\"\", then use an alternate displayhook\n+            original_displayhook = sys.displayhook\n+\n+            if six.PY3:\n+                 # only set alternate displayhook if Python 3.x or after\n+                lines = []\n+                def py3_displayhook(value):\n+                    if value is None:\n+                        # None should not be considered at all\n+                        return original_displayhook(value)\n+\n+                    # Collect the repr output in one variable\n+                    s = repr(value)\n+                    # Strip b\"\" and u\"\" prefixes from the repr and expected output\n+                    # TODO: better way of stripping the prefixes?\n+                    expected = example.want\n+                    expected = expected.strip() # be wary of newlines\n+                    s = s.replace(\"u\", \"\")\n+                    s = s.replace(\"b\", \"\")\n+                    expected = expected.replace(\"u\", \"\")\n+                    expected = expected.replace(\"b\", \"\")\n+                    # single quote vs. double quote should not matter\n+                    # default all quote marks to double quote\n+                    s = s.replace(\"'\", '\"')\n+                    expected = expected.replace(\"'\", '\"')\n+\n+                    # In case of multi-line expected result\n+                    lines.append(s)\n+\n+                    # let them match\n+                    if s == expected: # be wary of false positives here\n+                        # they should be the same, print expected value\n+                        sys.stdout.write(\"%s\\n\" % example.want.strip())\n+\n+                    # multi-line expected output, doctest uses loop\n+                    elif len(expected.split(\"\\n\")) == len(lines):\n+                        if \"\\n\".join(lines) == expected:\n+                            sys.stdout.write(\"%s\\n\" % example.want.strip())\n+                        else:\n+                            sys.stdout.write(\"%s\\n\" % repr(value))\n+                    elif len(expected.split(\"\\n\")) != len(lines):\n+                        # we are not done looping yet, do not print anything!\n+                        pass\n+\n+                    else:\n+                        sys.stdout.write(\"%s\\n\" % repr(value))\n+\n+                sys.displayhook = py3_displayhook\n+\n             # Run the example in the given context (globs), and record\n             # any exception that gets raised.  (But don't intercept\n             # keyboard interrupts.)\n@@ -1243,9 +1314,14 @@ def __run(self, test, compileflags, out):\n             except:\n                 exception = sys.exc_info()\n                 self.debugger.set_continue() # ==== Example Finished ====\n+            finally:\n+                # restore the original displayhook\n+                sys.displayhook = original_displayhook\n \n             got = self._fakeout.getvalue()  # the actual output\n             self._fakeout.truncate(0)\n+            # Python 3.1 requires seek after truncate\n+            self._fakeout.seek(0)\n             outcome = FAILURE   # guilty until proved innocent or insane\n \n             # If the example executed without raising any exceptions,\n@@ -1256,10 +1332,21 @@ def __run(self, test, compileflags, out):\n \n             # The example raised an exception:  check if it was expected.\n             else:\n-                exc_info = sys.exc_info()\n-                exc_msg = traceback.format_exception_only(*exc_info[:2])[-1]\n+                exc_msg = traceback.format_exception_only(*exception[:2])[-1]\n+                if six.PY3:\n+                    # module name will be in group(1) and the expected\n+                    # exception message will be in group(2)\n+                    m = re.match(r'(.*)\\.(\\w+:.+\\s)', exc_msg)\n+                    # make sure there's a match\n+                    if m != None:\n+                        f_name = m.group(1)\n+                        # check to see if m.group(1) contains the module name\n+                        if f_name == exception[0].__module__:\n+                            # strip the module name from exc_msg\n+                            exc_msg = m.group(2)\n+\n                 if not quiet:\n-                    got += _exception_traceback(exc_info)\n+                    got += _exception_traceback(exception)\n \n                 # If `example.exc_msg` is None, then we weren't expecting\n                 # an exception.\n@@ -1289,7 +1376,7 @@ def __run(self, test, compileflags, out):\n             elif outcome is BOOM:\n                 if not quiet:\n                     self.report_unexpected_exception(out, test, example,\n-                                                     exc_info)\n+                                                     exception)\n                 failures += 1\n             else:\n                 assert False, (\"unknown outcome\", outcome)\n@@ -1629,8 +1716,8 @@ class DebugRunner(DocTestRunner):\n          ...                                    {}, 'foo', 'foo.py', 0)\n          >>> try:\n          ...     runner.run(test)\n-         ... except UnexpectedException as failure:\n-         ...     pass\n+         ... except UnexpectedException as e:\n+         ...     failure = e\n \n          >>> failure.test is test\n          True\n@@ -1657,8 +1744,8 @@ class DebugRunner(DocTestRunner):\n \n          >>> try:\n          ...    runner.run(test)\n-         ... except DocTestFailure as failure:\n-         ...    pass\n+         ... except DocTestFailure as e:\n+         ...    failure = e\n \n        DocTestFailure objects provide access to the test:\n \n@@ -2167,8 +2254,8 @@ def debug(self):\n              >>> case = DocTestCase(test)\n              >>> try:\n              ...     case.debug()\n-             ... except UnexpectedException as failure:\n-             ...     pass\n+             ... except UnexpectedException as e:\n+             ...     failure = e\n \n            The UnexpectedException contains the test, the example, and\n            the original exception:\n@@ -2196,8 +2283,8 @@ def debug(self):\n \n              >>> try:\n              ...    case.debug()\n-             ... except DocTestFailure as failure:\n-             ...    pass\n+             ... except DocTestFailure as e:\n+             ...    failure = e\n \n            DocTestFailure objects provide access to the test:\n \n@@ -2646,7 +2733,7 @@ def get(self):\n             \"whitespace normalization\": r\"\"\"\n                 If the whitespace normalization flag is used, then\n                 differences in whitespace are ignored.\n-                    >>> print(range(30)) #doctest: +NORMALIZE_WHITESPACE\n+                    >>> print(list(xrange(30))) #doctest: +NORMALIZE_WHITESPACE\n                     [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,\n                      15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26,\n                      27, 28, 29]"
        },
        {
            "sha": "a9ae7f5db1079e5457e14038fadf188dd3449104",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -19,7 +19,7 @@\n from django.template import TemplateDoesNotExist\n from django.test import signals\n from django.utils.functional import curry\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils.http import urlencode\n from django.utils.importlib import import_module\n from django.utils.itercompat import is_iterable\n@@ -108,7 +108,7 @@ def encode_multipart(boundary, data):\n     as an application/octet-stream; otherwise, str(value) will be sent.\n     \"\"\"\n     lines = []\n-    to_str = lambda s: smart_str(s, settings.DEFAULT_CHARSET)\n+    to_str = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n \n     # Not by any means perfect, but good enough for our purposes.\n     is_file = lambda thing: hasattr(thing, \"read\") and callable(thing.read)\n@@ -145,7 +145,7 @@ def encode_multipart(boundary, data):\n     return '\\r\\n'.join(lines)\n \n def encode_file(boundary, key, file):\n-    to_str = lambda s: smart_str(s, settings.DEFAULT_CHARSET)\n+    to_str = lambda s: smart_bytes(s, settings.DEFAULT_CHARSET)\n     content_type = mimetypes.guess_type(file.name)[0]\n     if content_type is None:\n         content_type = 'application/octet-stream'\n@@ -194,9 +194,9 @@ def _base_environ(self, **request):\n             'SERVER_NAME':       'testserver',\n             'SERVER_PORT':       '80',\n             'SERVER_PROTOCOL':   'HTTP/1.1',\n-            'wsgi.version':      (1,0),\n+            'wsgi.version':      (1, 0),\n             'wsgi.url_scheme':   'http',\n-            'wsgi.input':        FakePayload(''),\n+            'wsgi.input':        FakePayload(b''),\n             'wsgi.errors':       self.errors,\n             'wsgi.multiprocess': True,\n             'wsgi.multithread':  False,\n@@ -220,7 +220,7 @@ def _encode_data(self, data, content_type, ):\n                 charset = match.group(1)\n             else:\n                 charset = settings.DEFAULT_CHARSET\n-            return smart_str(data, encoding=charset)\n+            return smart_bytes(data, encoding=charset)\n \n     def _get_path(self, parsed):\n         # If there are parameters, add them\n@@ -291,7 +291,7 @@ def delete(self, path, data='', content_type='application/octet-stream',\n     def generic(self, method, path,\n                 data='', content_type='application/octet-stream', **extra):\n         parsed = urlparse(path)\n-        data = smart_str(data, settings.DEFAULT_CHARSET)\n+        data = smart_bytes(data, settings.DEFAULT_CHARSET)\n         r = {\n             'PATH_INFO':      self._get_path(parsed),\n             'QUERY_STRING':   parsed[4],"
        },
        {
            "sha": "acdb4ffd1412fa50aeef0af2255c65ca317a7ea0",
            "filename": "django/test/html.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fhtml.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n from __future__ import unicode_literals\n \n import re\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.html_parser import HTMLParser, HTMLParseError\n from django.utils import six\n \n@@ -25,7 +25,7 @@ def __init__(self, name, attributes):\n \n     def append(self, element):\n         if isinstance(element, six.string_types):\n-            element = force_unicode(element)\n+            element = force_text(element)\n             element = normalize_whitespace(element)\n             if self.children:\n                 if isinstance(self.children[-1], six.string_types):\n@@ -83,6 +83,8 @@ def __eq__(self, element):\n             return False\n         return True\n \n+    __hash__ = object.__hash__\n+\n     def __ne__(self, element):\n         return not self.__eq__(element)\n "
        },
        {
            "sha": "56ba56caf124acf7cac1ed2651e43b6efffd7d1f",
            "filename": "django/test/testcases.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2Ftestcases.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Ftest%2Ftestcases.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Ftestcases.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -41,7 +41,7 @@\n     override_settings)\n from django.test.utils import ContextList\n from django.utils import unittest as ut2\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import smart_bytes, force_text\n from django.utils import six\n from django.utils.unittest.util import safe_repr\n from django.views.static import serve\n@@ -398,7 +398,7 @@ def assertFieldOutput(self, fieldclass, valid, invalid, field_args=None,\n                 optional.clean(input)\n             self.assertEqual(context_manager.exception.messages, errors)\n         # test required inputs\n-        error_required = [force_unicode(required.error_messages['required'])]\n+        error_required = [force_text(required.error_messages['required'])]\n         for e in EMPTY_VALUES:\n             with self.assertRaises(ValidationError) as context_manager:\n                 required.clean(e)\n@@ -647,7 +647,7 @@ def assertContains(self, response, text, count=None, status_code=200,\n         self.assertEqual(response.status_code, status_code,\n             msg_prefix + \"Couldn't retrieve content: Response code was %d\"\n             \" (expected %d)\" % (response.status_code, status_code))\n-        enc_text = smart_str(text, response._charset)\n+        enc_text = smart_bytes(text, response._charset)\n         content = response.content\n         if html:\n             content = assert_and_parse_html(self, content, None,\n@@ -683,7 +683,7 @@ def assertNotContains(self, response, text, status_code=200,\n         self.assertEqual(response.status_code, status_code,\n             msg_prefix + \"Couldn't retrieve content: Response code was %d\"\n             \" (expected %d)\" % (response.status_code, status_code))\n-        enc_text = smart_str(text, response._charset)\n+        enc_text = smart_bytes(text, response._charset)\n         content = response.content\n         if html:\n             content = assert_and_parse_html(self, content, None,\n@@ -796,9 +796,10 @@ def assertTemplateNotUsed(self, response=None, template_name=None, msg_prefix=''\n             \" the response\" % template_name)\n \n     def assertQuerysetEqual(self, qs, values, transform=repr, ordered=True):\n+        items = six.moves.map(transform, qs)\n         if not ordered:\n-            return self.assertEqual(set(map(transform, qs)), set(values))\n-        return self.assertEqual(map(transform, qs), values)\n+            return self.assertEqual(set(items), set(values))\n+        return self.assertEqual(list(items), values)\n \n     def assertNumQueries(self, num, func=None, *args, **kwargs):\n         using = kwargs.pop(\"using\", DEFAULT_DB_ALIAS)"
        },
        {
            "sha": "9eb5e5e8ea2420e522d45aab7ea323fedddc47a7",
            "filename": "django/utils/_os.py",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2F_os.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2F_os.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2F_os.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,7 +1,8 @@\n import os\n import stat\n from os.path import join, normcase, normpath, abspath, isabs, sep\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n+from django.utils import six\n \n try:\n     WindowsError = WindowsError\n@@ -10,13 +11,12 @@ class WindowsError(Exception):\n         pass\n \n \n-# Define our own abspath function that can handle joining\n-# unicode paths to a current working directory that has non-ASCII\n-# characters in it.  This isn't necessary on Windows since the\n-# Windows version of abspath handles this correctly.  The Windows\n-# abspath also handles drive letters differently than the pure\n-# Python implementation, so it's best not to replace it.\n-if os.name == 'nt':\n+# Under Python 2, define our own abspath function that can handle joining\n+# unicode paths to a current working directory that has non-ASCII characters\n+# in it.  This isn't necessary on Windows since the Windows version of abspath\n+# handles this correctly. It also handles drive letters differently than the\n+# pure Python implementation, so it's best not to replace it.\n+if six.PY3 or os.name == 'nt':\n     abspathu = abspath\n else:\n     def abspathu(path):\n@@ -37,8 +37,8 @@ def safe_join(base, *paths):\n     The final path must be located inside of the base path component (otherwise\n     a ValueError is raised).\n     \"\"\"\n-    base = force_unicode(base)\n-    paths = [force_unicode(p) for p in paths]\n+    base = force_text(base)\n+    paths = [force_text(p) for p in paths]\n     final_path = abspathu(join(base, *paths))\n     base_path = abspathu(base)\n     base_path_len = len(base_path)"
        },
        {
            "sha": "829b55dd283d7a7bc99ed83bf78699d32526b97f",
            "filename": "django/utils/archive.py",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Farchive.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Farchive.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Farchive.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -23,7 +23,6 @@\n \"\"\"\n import os\n import shutil\n-import sys\n import tarfile\n import zipfile\n \n@@ -147,11 +146,11 @@ def extract(self, to_path):\n             else:\n                 try:\n                     extracted = self._archive.extractfile(member)\n-                except (KeyError, AttributeError):\n+                except (KeyError, AttributeError) as exc:\n                     # Some corrupt tar files seem to produce this\n                     # (specifically bad symlinks)\n-                    print (\"In the tar file %s the member %s is invalid: %s\" %\n-                           (name, member.name, sys.exc_info()[1]))\n+                    print(\"In the tar file %s the member %s is invalid: %s\" %\n+                            (name, member.name, exc))\n                 else:\n                     dirname = os.path.dirname(filename)\n                     if dirname and not os.path.exists(dirname):"
        },
        {
            "sha": "42b0de4ce6713c051011e55e40222f2386ea8cbf",
            "filename": "django/utils/cache.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcache.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -23,7 +23,7 @@\n \n from django.conf import settings\n from django.core.cache import get_cache\n-from django.utils.encoding import iri_to_uri, force_unicode\n+from django.utils.encoding import iri_to_uri, force_text\n from django.utils.http import http_date\n from django.utils.timezone import get_current_timezone_name\n from django.utils.translation import get_language\n@@ -169,7 +169,7 @@ def _i18n_cache_key_suffix(request, cache_key):\n         # Windows is known to use non-standard, locale-dependant names.\n         # User-defined tzinfo classes may return absolutely anything.\n         # Hence this paranoid conversion to create a valid cache key.\n-        tz_name = force_unicode(get_current_timezone_name(), errors='ignore')\n+        tz_name = force_text(get_current_timezone_name(), errors='ignore')\n         cache_key += '.%s' % tz_name.encode('ascii', 'ignore').replace(' ', '_')\n     return cache_key\n "
        },
        {
            "sha": "70a07e7fde4465ac9a35a6c8cc2819a7995c1c85",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -23,7 +23,7 @@\n     using_sysrandom = False\n \n from django.conf import settings\n-from django.utils.encoding import smart_str\n+from django.utils.encoding import smart_bytes\n from django.utils.six.moves import xrange\n \n \n@@ -50,7 +50,7 @@ def salted_hmac(key_salt, value, secret=None):\n     # line is redundant and could be replaced by key = key_salt + secret, since\n     # the hmac module does the same thing for keys longer than the block size.\n     # However, we need to ensure that we *always* do this.\n-    return hmac.new(key, msg=value, digestmod=hashlib.sha1)\n+    return hmac.new(key, msg=smart_bytes(value), digestmod=hashlib.sha1)\n \n \n def get_random_string(length=12,\n@@ -99,7 +99,7 @@ def _bin_to_long(x):\n \n     This is a clever optimization for fast xor vector math\n     \"\"\"\n-    return int(x.encode('hex'), 16)\n+    return int(binascii.hexlify(x), 16)\n \n \n def _long_to_bin(x, hex_format_string):\n@@ -112,13 +112,14 @@ def _long_to_bin(x, hex_format_string):\n \n def _fast_hmac(key, msg, digest):\n     \"\"\"\n-    A trimmed down version of Python's HMAC implementation\n+    A trimmed down version of Python's HMAC implementation.\n+\n+    This function operates on bytes.\n     \"\"\"\n     dig1, dig2 = digest(), digest()\n-    key = smart_str(key)\n     if len(key) > dig1.block_size:\n         key = digest(key).digest()\n-    key += chr(0) * (dig1.block_size - len(key))\n+    key += b'\\x00' * (dig1.block_size - len(key))\n     dig1.update(key.translate(_trans_36))\n     dig1.update(msg)\n     dig2.update(key.translate(_trans_5c))\n@@ -141,8 +142,8 @@ def pbkdf2(password, salt, iterations, dklen=0, digest=None):\n     assert iterations > 0\n     if not digest:\n         digest = hashlib.sha256\n-    password = smart_str(password)\n-    salt = smart_str(salt)\n+    password = smart_bytes(password)\n+    salt = smart_bytes(salt)\n     hlen = digest().digest_size\n     if not dklen:\n         dklen = hlen"
        },
        {
            "sha": "ad175731045ef986bf0b34a5bd840823072051a9",
            "filename": "django/utils/datastructures.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdatastructures.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdatastructures.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdatastructures.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -129,7 +129,7 @@ def __init__(self, data=None):\n             data = list(data)\n         super(SortedDict, self).__init__(data)\n         if isinstance(data, dict):\n-            self.keyOrder = list(six.iterkeys(data))\n+            self.keyOrder = list(data)\n         else:\n             self.keyOrder = []\n             seen = set()"
        },
        {
            "sha": "6a91a370e5b0219f18159eb117cf92226cb91d9d",
            "filename": "django/utils/dateformat.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdateformat.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdateformat.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdateformat.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -20,7 +20,7 @@\n from django.utils.dates import MONTHS, MONTHS_3, MONTHS_ALT, MONTHS_AP, WEEKDAYS, WEEKDAYS_ABBR\n from django.utils.tzinfo import LocalTimezone\n from django.utils.translation import ugettext as _\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils import six\n from django.utils.timezone import is_aware, is_naive\n \n@@ -30,9 +30,9 @@\n class Formatter(object):\n     def format(self, formatstr):\n         pieces = []\n-        for i, piece in enumerate(re_formatchars.split(force_unicode(formatstr))):\n+        for i, piece in enumerate(re_formatchars.split(force_text(formatstr))):\n             if i % 2:\n-                pieces.append(force_unicode(getattr(self, piece)()))\n+                pieces.append(force_text(getattr(self, piece)()))\n             elif piece:\n                 pieces.append(re_escaped.sub(r'\\1', piece))\n         return ''.join(pieces)"
        },
        {
            "sha": "032eb493b62b08e297ca15f5cf361f0599e5fc0a",
            "filename": "django/utils/dateparse.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdateparse.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdateparse.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdateparse.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,6 +7,7 @@\n \n import datetime\n import re\n+from django.utils import six\n from django.utils.timezone import utc\n from django.utils.tzinfo import FixedOffset\n \n@@ -34,7 +35,7 @@ def parse_date(value):\n     \"\"\"\n     match = date_re.match(value)\n     if match:\n-        kw = dict((k, int(v)) for k, v in match.groupdict().iteritems())\n+        kw = dict((k, int(v)) for k, v in six.iteritems(match.groupdict()))\n         return datetime.date(**kw)\n \n def parse_time(value):\n@@ -53,7 +54,7 @@ def parse_time(value):\n         kw = match.groupdict()\n         if kw['microsecond']:\n             kw['microsecond'] = kw['microsecond'].ljust(6, '0')\n-        kw = dict((k, int(v)) for k, v in kw.iteritems() if v is not None)\n+        kw = dict((k, int(v)) for k, v in six.iteritems(kw) if v is not None)\n         return datetime.time(**kw)\n \n def parse_datetime(value):\n@@ -80,6 +81,6 @@ def parse_datetime(value):\n             if tzinfo[0] == '-':\n                 offset = -offset\n             tzinfo = FixedOffset(offset)\n-        kw = dict((k, int(v)) for k, v in kw.iteritems() if v is not None)\n+        kw = dict((k, int(v)) for k, v in six.iteritems(kw) if v is not None)\n         kw['tzinfo'] = tzinfo\n         return datetime.datetime(**kw)"
        },
        {
            "sha": "c7b39819b59d913b60490dd0aa93a734a631d159",
            "filename": "django/utils/dictconfig.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdictconfig.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fdictconfig.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fdictconfig.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -363,7 +363,7 @@ def configure(self):\n                 #which were in the previous configuration but\n                 #which are not in the new configuration.\n                 root = logging.root\n-                existing = root.manager.loggerDict.keys()\n+                existing = list(root.manager.loggerDict)\n                 #The list needs to be sorted so that we can\n                 #avoid disabling child loggers of explicitly\n                 #named loggers. With a sorted list it is easier"
        },
        {
            "sha": "eb60cfde8bd61b198e728af6af8b383c426e9c7a",
            "filename": "django/utils/encoding.py",
            "status": "modified",
            "additions": 43,
            "deletions": 25,
            "changes": 68,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fencoding.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fencoding.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fencoding.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -24,9 +24,13 @@ def __str__(self):\n \n class StrAndUnicode(object):\n     \"\"\"\n-    A class whose __str__ returns its __unicode__ as a UTF-8 bytestring.\n+    A class that derives __str__ from __unicode__.\n \n-    Useful as a mix-in.\n+    On Python 2, __str__ returns the output of __unicode__ encoded as a UTF-8\n+    bytestring. On Python 3, __str__ returns the output of __unicode__.\n+\n+    Useful as a mix-in. If you support Python 2 and 3 with a single code base,\n+    you can inherit this mix-in and just define __unicode__.\n     \"\"\"\n     if six.PY3:\n         def __str__(self):\n@@ -35,37 +39,36 @@ def __str__(self):\n         def __str__(self):\n             return self.__unicode__().encode('utf-8')\n \n-def smart_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n+def smart_text(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n-    Returns a unicode object representing 's'. Treats bytestrings using the\n-    'encoding' codec.\n+    Returns a text object representing 's' -- unicode on Python 2 and str on\n+    Python 3. Treats bytestrings using the 'encoding' codec.\n \n     If strings_only is True, don't convert (some) non-string-like objects.\n     \"\"\"\n     if isinstance(s, Promise):\n         # The input is the result of a gettext_lazy() call.\n         return s\n-    return force_unicode(s, encoding, strings_only, errors)\n+    return force_text(s, encoding, strings_only, errors)\n \n def is_protected_type(obj):\n     \"\"\"Determine if the object instance is of a protected type.\n \n     Objects of protected types are preserved as-is when passed to\n-    force_unicode(strings_only=True).\n+    force_text(strings_only=True).\n     \"\"\"\n     return isinstance(obj, six.integer_types + (type(None), float, Decimal,\n         datetime.datetime, datetime.date, datetime.time))\n \n-def force_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n+def force_text(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n-    Similar to smart_unicode, except that lazy instances are resolved to\n+    Similar to smart_text, except that lazy instances are resolved to\n     strings, rather than kept as lazy objects.\n \n     If strings_only is True, don't convert (some) non-string-like objects.\n     \"\"\"\n-    # Handle the common case first, saves 30-40% in performance when s\n-    # is an instance of unicode. This function gets called often in that\n-    # setting.\n+    # Handle the common case first, saves 30-40% when s is an instance of\n+    # six.text_type. This function gets called often in that setting.\n     if isinstance(s, six.text_type):\n         return s\n     if strings_only and is_protected_type(s):\n@@ -92,9 +95,9 @@ def force_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n                     # without raising a further exception. We do an\n                     # approximation to what the Exception's standard str()\n                     # output should be.\n-                    s = ' '.join([force_unicode(arg, encoding, strings_only,\n+                    s = ' '.join([force_text(arg, encoding, strings_only,\n                             errors) for arg in s])\n-        elif not isinstance(s, six.text_type):\n+        else:\n             # Note: We use .decode() here, instead of six.text_type(s, encoding,\n             # errors), so that if s is a SafeString, it ends up being a\n             # SafeUnicode at the end.\n@@ -108,21 +111,26 @@ def force_unicode(s, encoding='utf-8', strings_only=False, errors='strict'):\n             # working unicode method. Try to handle this without raising a\n             # further exception by individually forcing the exception args\n             # to unicode.\n-            s = ' '.join([force_unicode(arg, encoding, strings_only,\n+            s = ' '.join([force_text(arg, encoding, strings_only,\n                     errors) for arg in s])\n     return s\n \n-def smart_str(s, encoding='utf-8', strings_only=False, errors='strict'):\n+def smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict'):\n     \"\"\"\n     Returns a bytestring version of 's', encoded as specified in 'encoding'.\n \n     If strings_only is True, don't convert (some) non-string-like objects.\n     \"\"\"\n+    if isinstance(s, bytes):\n+        if encoding == 'utf-8':\n+            return s\n+        else:\n+            return s.decode('utf-8', errors).encode(encoding, errors)\n     if strings_only and (s is None or isinstance(s, int)):\n         return s\n     if isinstance(s, Promise):\n         return six.text_type(s).encode(encoding, errors)\n-    elif not isinstance(s, six.string_types):\n+    if not isinstance(s, six.string_types):\n         try:\n             if six.PY3:\n                 return six.text_type(s).encode(encoding)\n@@ -133,15 +141,25 @@ def smart_str(s, encoding='utf-8', strings_only=False, errors='strict'):\n                 # An Exception subclass containing non-ASCII data that doesn't\n                 # know how to print itself properly. We shouldn't raise a\n                 # further exception.\n-                return ' '.join([smart_str(arg, encoding, strings_only,\n+                return ' '.join([smart_bytes(arg, encoding, strings_only,\n                         errors) for arg in s])\n             return six.text_type(s).encode(encoding, errors)\n-    elif isinstance(s, six.text_type):\n-        return s.encode(encoding, errors)\n-    elif s and encoding != 'utf-8':\n-        return s.decode('utf-8', errors).encode(encoding, errors)\n     else:\n-        return s\n+        return s.encode(encoding, errors)\n+\n+if six.PY3:\n+    smart_str = smart_text\n+else:\n+    smart_str = smart_bytes\n+    # backwards compatibility for Python 2\n+    smart_unicode = smart_text\n+    force_unicode = force_text\n+\n+smart_str.__doc__ = \"\"\"\\\n+Apply smart_text in Python 3 and smart_bytes in Python 2.\n+\n+This is suitable for writing to sys.stdout (for instance).\n+\"\"\"\n \n def iri_to_uri(iri):\n     \"\"\"\n@@ -168,7 +186,7 @@ def iri_to_uri(iri):\n     # converted.\n     if iri is None:\n         return iri\n-    return quote(smart_str(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n+    return quote(smart_bytes(iri), safe=b\"/#%[]=:;$&()+,!?*@'~\")\n \n def filepath_to_uri(path):\n     \"\"\"Convert an file system path to a URI portion that is suitable for\n@@ -187,7 +205,7 @@ def filepath_to_uri(path):\n         return path\n     # I know about `os.sep` and `os.altsep` but I want to leave\n     # some flexibility for hardcoding separators.\n-    return quote(smart_str(path).replace(\"\\\\\", \"/\"), safe=b\"/~!*()'\")\n+    return quote(smart_bytes(path).replace(\"\\\\\", \"/\"), safe=b\"/~!*()'\")\n \n # The encoding of the default system locale but falls back to the\n # given fallback encoding if the encoding is unsupported by python or could"
        },
        {
            "sha": "f9126a67829c10dd43384c57ccb528f2572446c1",
            "filename": "django/utils/feedgenerator.py",
            "status": "modified",
            "additions": 21,
            "deletions": 16,
            "changes": 37,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ffeedgenerator.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ffeedgenerator.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffeedgenerator.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -29,8 +29,10 @@\n except ImportError:     # Python 2\n     from urlparse import urlparse\n from django.utils.xmlutils import SimplerXMLGenerator\n-from django.utils.encoding import force_unicode, iri_to_uri\n+from django.utils.encoding import force_text, iri_to_uri\n from django.utils import datetime_safe\n+from django.utils import six\n+from django.utils.six import StringIO\n from django.utils.timezone import is_aware\n \n def rfc2822_date(date):\n@@ -44,25 +46,29 @@ def rfc2822_date(date):\n     dow = days[date.weekday()]\n     month = months[date.month - 1]\n     time_str = date.strftime('%s, %%d %s %%Y %%H:%%M:%%S ' % (dow, month))\n+    if not six.PY3:             # strftime returns a byte string in Python 2\n+        time_str = time_str.decode('utf-8')\n     if is_aware(date):\n         offset = date.tzinfo.utcoffset(date)\n         timezone = (offset.days * 24 * 60) + (offset.seconds // 60)\n         hour, minute = divmod(timezone, 60)\n-        return time_str + \"%+03d%02d\" % (hour, minute)\n+        return time_str + '%+03d%02d' % (hour, minute)\n     else:\n         return time_str + '-0000'\n \n def rfc3339_date(date):\n     # Support datetime objects older than 1900\n     date = datetime_safe.new_datetime(date)\n+    time_str = date.strftime('%Y-%m-%dT%H:%M:%S')\n+    if not six.PY3:             # strftime returns a byte string in Python 2\n+        time_str = time_str.decode('utf-8')\n     if is_aware(date):\n-        time_str = date.strftime('%Y-%m-%dT%H:%M:%S')\n         offset = date.tzinfo.utcoffset(date)\n         timezone = (offset.days * 24 * 60) + (offset.seconds // 60)\n         hour, minute = divmod(timezone, 60)\n-        return time_str + \"%+03d:%02d\" % (hour, minute)\n+        return time_str + '%+03d:%02d' % (hour, minute)\n     else:\n-        return date.strftime('%Y-%m-%dT%H:%M:%SZ')\n+        return time_str + 'Z'\n \n def get_tag_uri(url, date):\n     \"\"\"\n@@ -81,12 +87,12 @@ class SyndicationFeed(object):\n     def __init__(self, title, link, description, language=None, author_email=None,\n             author_name=None, author_link=None, subtitle=None, categories=None,\n             feed_url=None, feed_copyright=None, feed_guid=None, ttl=None, **kwargs):\n-        to_unicode = lambda s: force_unicode(s, strings_only=True)\n+        to_unicode = lambda s: force_text(s, strings_only=True)\n         if categories:\n-            categories = [force_unicode(c) for c in categories]\n+            categories = [force_text(c) for c in categories]\n         if ttl is not None:\n             # Force ints to unicode\n-            ttl = force_unicode(ttl)\n+            ttl = force_text(ttl)\n         self.feed = {\n             'title': to_unicode(title),\n             'link': iri_to_uri(link),\n@@ -114,12 +120,12 @@ def add_item(self, title, link, description, author_email=None,\n         objects except pubdate, which is a datetime.datetime object, and\n         enclosure, which is an instance of the Enclosure class.\n         \"\"\"\n-        to_unicode = lambda s: force_unicode(s, strings_only=True)\n+        to_unicode = lambda s: force_text(s, strings_only=True)\n         if categories:\n             categories = [to_unicode(c) for c in categories]\n         if ttl is not None:\n             # Force ints to unicode\n-            ttl = force_unicode(ttl)\n+            ttl = force_text(ttl)\n         item = {\n             'title': to_unicode(title),\n             'link': iri_to_uri(link),\n@@ -178,8 +184,7 @@ def writeString(self, encoding):\n         \"\"\"\n         Returns the feed in the given encoding as a string.\n         \"\"\"\n-        from io import BytesIO\n-        s = BytesIO()\n+        s = StringIO()\n         self.write(s, encoding)\n         return s.getvalue()\n \n@@ -237,7 +242,7 @@ def add_root_elements(self, handler):\n             handler.addQuickElement(\"category\", cat)\n         if self.feed['feed_copyright'] is not None:\n             handler.addQuickElement(\"copyright\", self.feed['feed_copyright'])\n-        handler.addQuickElement(\"lastBuildDate\", rfc2822_date(self.latest_post_date()).decode('utf-8'))\n+        handler.addQuickElement(\"lastBuildDate\", rfc2822_date(self.latest_post_date()))\n         if self.feed['ttl'] is not None:\n             handler.addQuickElement(\"ttl\", self.feed['ttl'])\n \n@@ -271,7 +276,7 @@ def add_item_elements(self, handler, item):\n             handler.addQuickElement(\"dc:creator\", item[\"author_name\"], {\"xmlns:dc\": \"http://purl.org/dc/elements/1.1/\"})\n \n         if item['pubdate'] is not None:\n-            handler.addQuickElement(\"pubDate\", rfc2822_date(item['pubdate']).decode('utf-8'))\n+            handler.addQuickElement(\"pubDate\", rfc2822_date(item['pubdate']))\n         if item['comments'] is not None:\n             handler.addQuickElement(\"comments\", item['comments'])\n         if item['unique_id'] is not None:\n@@ -314,7 +319,7 @@ def add_root_elements(self, handler):\n         if self.feed['feed_url'] is not None:\n             handler.addQuickElement(\"link\", \"\", {\"rel\": \"self\", \"href\": self.feed['feed_url']})\n         handler.addQuickElement(\"id\", self.feed['id'])\n-        handler.addQuickElement(\"updated\", rfc3339_date(self.latest_post_date()).decode('utf-8'))\n+        handler.addQuickElement(\"updated\", rfc3339_date(self.latest_post_date()))\n         if self.feed['author_name'] is not None:\n             handler.startElement(\"author\", {})\n             handler.addQuickElement(\"name\", self.feed['author_name'])\n@@ -340,7 +345,7 @@ def add_item_elements(self, handler, item):\n         handler.addQuickElement(\"title\", item['title'])\n         handler.addQuickElement(\"link\", \"\", {\"href\": item['link'], \"rel\": \"alternate\"})\n         if item['pubdate'] is not None:\n-            handler.addQuickElement(\"updated\", rfc3339_date(item['pubdate']).decode('utf-8'))\n+            handler.addQuickElement(\"updated\", rfc3339_date(item['pubdate']))\n \n         # Author information.\n         if item['author_name'] is not None:"
        },
        {
            "sha": "085ec40b638c09c9a012f4407987b900eb949ac0",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 40,
            "deletions": 24,
            "changes": 64,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -93,13 +93,19 @@ def __prepare_class__(cls):\n                         if hasattr(cls, k):\n                             continue\n                         setattr(cls, k, meth)\n-            cls._delegate_str = bytes in resultclasses\n-            cls._delegate_unicode = six.text_type in resultclasses\n-            assert not (cls._delegate_str and cls._delegate_unicode), \"Cannot call lazy() with both str and unicode return types.\"\n-            if cls._delegate_unicode:\n-                cls.__unicode__ = cls.__unicode_cast\n-            elif cls._delegate_str:\n-                cls.__str__ = cls.__str_cast\n+            cls._delegate_bytes = bytes in resultclasses\n+            cls._delegate_text = six.text_type in resultclasses\n+            assert not (cls._delegate_bytes and cls._delegate_text), \"Cannot call lazy() with both bytes and text return types.\"\n+            if cls._delegate_text:\n+                if six.PY3:\n+                    cls.__str__ = cls.__text_cast\n+                else:\n+                    cls.__unicode__ = cls.__text_cast\n+            elif cls._delegate_bytes:\n+                if six.PY3:\n+                    cls.__bytes__ = cls.__bytes_cast\n+                else:\n+                    cls.__str__ = cls.__bytes_cast\n         __prepare_class__ = classmethod(__prepare_class__)\n \n         def __promise__(cls, klass, funcname, method):\n@@ -120,17 +126,17 @@ def __wrapper__(self, *args, **kw):\n             return __wrapper__\n         __promise__ = classmethod(__promise__)\n \n-        def __unicode_cast(self):\n+        def __text_cast(self):\n             return func(*self.__args, **self.__kw)\n \n-        def __str_cast(self):\n-            return str(func(*self.__args, **self.__kw))\n+        def __bytes_cast(self):\n+            return bytes(func(*self.__args, **self.__kw))\n \n         def __cast(self):\n-            if self._delegate_str:\n-                return self.__str_cast()\n-            elif self._delegate_unicode:\n-                return self.__unicode_cast()\n+            if self._delegate_bytes:\n+                return self.__bytes_cast()\n+            elif self._delegate_text:\n+                return self.__text_cast()\n             else:\n                 return func(*self.__args, **self.__kw)\n \n@@ -144,10 +150,12 @@ def __lt__(self, other):\n                 other = other.__cast()\n             return self.__cast() < other\n \n+        __hash__ = object.__hash__\n+\n         def __mod__(self, rhs):\n-            if self._delegate_str:\n-                return str(self) % rhs\n-            elif self._delegate_unicode:\n+            if self._delegate_bytes and not six.PY3:\n+                return bytes(self) % rhs\n+            elif self._delegate_text:\n                 return six.text_type(self) % rhs\n             else:\n                 raise AssertionError('__mod__ not supported for non-string types')\n@@ -178,7 +186,7 @@ def allow_lazy(func, *resultclasses):\n     \"\"\"\n     @wraps(func)\n     def wrapper(*args, **kwargs):\n-        for arg in list(args) + kwargs.values():\n+        for arg in list(args) + list(six.itervalues(kwargs)):\n             if isinstance(arg, Promise):\n                 break\n         else:\n@@ -234,6 +242,9 @@ def _setup(self):\n     __dir__ = new_method_proxy(dir)\n \n \n+# Workaround for http://bugs.python.org/issue12370\n+_super = super\n+\n class SimpleLazyObject(LazyObject):\n     \"\"\"\n     A lazy object initialised from any function.\n@@ -251,13 +262,17 @@ def __init__(self, func):\n         value.\n         \"\"\"\n         self.__dict__['_setupfunc'] = func\n-        super(SimpleLazyObject, self).__init__()\n+        _super(SimpleLazyObject, self).__init__()\n \n     def _setup(self):\n         self._wrapped = self._setupfunc()\n \n-    __str__ = new_method_proxy(bytes)\n-    __unicode__ = new_method_proxy(six.text_type)\n+    if six.PY3:\n+        __bytes__ = new_method_proxy(bytes)\n+        __str__ = new_method_proxy(str)\n+    else:\n+        __str__ = new_method_proxy(str)\n+        __unicode__ = new_method_proxy(unicode)\n \n     def __deepcopy__(self, memo):\n         if self._wrapped is empty:\n@@ -284,7 +299,8 @@ def __getstate__(self):\n     __class__ = property(new_method_proxy(operator.attrgetter(\"__class__\")))\n     __eq__ = new_method_proxy(operator.eq)\n     __hash__ = new_method_proxy(hash)\n-    __nonzero__ = new_method_proxy(bool)\n+    __bool__ = new_method_proxy(bool)       # Python 3\n+    __nonzero__ = __bool__                  # Python 2\n \n \n class lazy_property(property):\n@@ -312,8 +328,8 @@ def partition(predicate, values):\n     Splits the values into two sets, based on the return value of the function\n     (True/False). e.g.:\n \n-        >>> partition(lambda: x > 3, range(5))\n-        [1, 2, 3], [4]\n+        >>> partition(lambda x: x > 3, range(5))\n+        [0, 1, 2, 3], [4]\n     \"\"\"\n     results = ([], [])\n     for item in values:"
        },
        {
            "sha": "7dd53a1353edb86818a00e322449f884b9496532",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 13,
            "deletions": 13,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,7 +11,7 @@\n     from urlparse import urlsplit, urlunsplit\n \n from django.utils.safestring import SafeData, mark_safe\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import smart_bytes, force_text\n from django.utils.functional import allow_lazy\n from django.utils import six\n from django.utils.text import normalize_newlines\n@@ -33,13 +33,13 @@\n html_gunk_re = re.compile(r'(?:<br clear=\"all\">|<i><\\/i>|<b><\\/b>|<em><\\/em>|<strong><\\/strong>|<\\/?smallcaps>|<\\/?uppercase>)', re.IGNORECASE)\n hard_coded_bullets_re = re.compile(r'((?:<p>(?:%s).*?[a-zA-Z].*?</p>\\s*)+)' % '|'.join([re.escape(x) for x in DOTS]), re.DOTALL)\n trailing_empty_content_re = re.compile(r'(?:<p>(?:&nbsp;|\\s|<br \\/>)*?</p>\\s*)+\\Z')\n-del x # Temporary variable\n+\n \n def escape(text):\n     \"\"\"\n     Returns the given text with ampersands, quotes and angle brackets encoded for use in HTML.\n     \"\"\"\n-    return mark_safe(force_unicode(text).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('\"', '&quot;').replace(\"'\", '&#39;'))\n+    return mark_safe(force_text(text).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('\"', '&quot;').replace(\"'\", '&#39;'))\n escape = allow_lazy(escape, six.text_type)\n \n _base_js_escapes = (\n@@ -63,7 +63,7 @@ def escape(text):\n def escapejs(value):\n     \"\"\"Hex encodes characters for use in JavaScript strings.\"\"\"\n     for bad, good in _js_escapes:\n-        value = mark_safe(force_unicode(value).replace(bad, good))\n+        value = mark_safe(force_text(value).replace(bad, good))\n     return value\n escapejs = allow_lazy(escapejs, six.text_type)\n \n@@ -84,7 +84,7 @@ def format_html(format_string, *args, **kwargs):\n     \"\"\"\n     args_safe = map(conditional_escape, args)\n     kwargs_safe = dict([(k, conditional_escape(v)) for (k, v) in\n-                        kwargs.iteritems()])\n+                        six.iteritems(kwargs)])\n     return mark_safe(format_string.format(*args_safe, **kwargs_safe))\n \n def format_html_join(sep, format_string, args_generator):\n@@ -120,22 +120,22 @@ def linebreaks(value, autoescape=False):\n \n def strip_tags(value):\n     \"\"\"Returns the given HTML with all tags stripped.\"\"\"\n-    return re.sub(r'<[^>]*?>', '', force_unicode(value))\n+    return re.sub(r'<[^>]*?>', '', force_text(value))\n strip_tags = allow_lazy(strip_tags)\n \n def strip_spaces_between_tags(value):\n     \"\"\"Returns the given HTML with spaces between tags removed.\"\"\"\n-    return re.sub(r'>\\s+<', '><', force_unicode(value))\n+    return re.sub(r'>\\s+<', '><', force_text(value))\n strip_spaces_between_tags = allow_lazy(strip_spaces_between_tags, six.text_type)\n \n def strip_entities(value):\n     \"\"\"Returns the given HTML with all entities (&something;) stripped.\"\"\"\n-    return re.sub(r'&(?:\\w+|#\\d+);', '', force_unicode(value))\n+    return re.sub(r'&(?:\\w+|#\\d+);', '', force_text(value))\n strip_entities = allow_lazy(strip_entities, six.text_type)\n \n def fix_ampersands(value):\n     \"\"\"Returns the given HTML with all unencoded ampersands encoded correctly.\"\"\"\n-    return unencoded_ampersands_re.sub('&amp;', force_unicode(value))\n+    return unencoded_ampersands_re.sub('&amp;', force_text(value))\n fix_ampersands = allow_lazy(fix_ampersands, six.text_type)\n \n def smart_urlquote(url):\n@@ -153,9 +153,9 @@ def smart_urlquote(url):\n     # contains a % not followed by two hexadecimal digits. See #9655.\n     if '%' not in url or unquoted_percents_re.search(url):\n         # See http://bugs.python.org/issue2637\n-        url = quote(smart_str(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n+        url = quote(smart_bytes(url), safe=b'!*\\'();:@&=+$,/?#[]~')\n \n-    return force_unicode(url)\n+    return force_text(url)\n \n def urlize(text, trim_url_limit=None, nofollow=False, autoescape=False):\n     \"\"\"\n@@ -176,7 +176,7 @@ def urlize(text, trim_url_limit=None, nofollow=False, autoescape=False):\n     \"\"\"\n     trim_url = lambda x, limit=trim_url_limit: limit is not None and (len(x) > limit and ('%s...' % x[:max(0, limit - 3)])) or x\n     safe_input = isinstance(text, SafeData)\n-    words = word_split_re.split(force_unicode(text))\n+    words = word_split_re.split(force_text(text))\n     for i, word in enumerate(words):\n         match = None\n         if '.' in word or '@' in word or ':' in word:\n@@ -245,7 +245,7 @@ def clean_html(text):\n           bottom of the text.\n     \"\"\"\n     from django.utils.text import normalize_newlines\n-    text = normalize_newlines(force_unicode(text))\n+    text = normalize_newlines(force_text(text))\n     text = re.sub(r'<(/?)\\s*b\\s*>', '<\\\\1strong>', text)\n     text = re.sub(r'<(/?)\\s*i\\s*>', '<\\\\1em>', text)\n     text = fix_ampersands(text)"
        },
        {
            "sha": "22e81a33d7ca2091c90c5b8484f1fe3b3f995c21",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -13,7 +13,7 @@\n from email.utils import formatdate\n \n from django.utils.datastructures import MultiValueDict\n-from django.utils.encoding import smart_str, force_unicode\n+from django.utils.encoding import force_text, smart_str\n from django.utils.functional import allow_lazy\n from django.utils import six\n \n@@ -37,7 +37,7 @@ def urlquote(url, safe='/'):\n     can safely be used as part of an argument to a subsequent iri_to_uri() call\n     without double-quoting occurring.\n     \"\"\"\n-    return force_unicode(urllib_parse.quote(smart_str(url), smart_str(safe)))\n+    return force_text(urllib_parse.quote(smart_str(url), smart_str(safe)))\n urlquote = allow_lazy(urlquote, six.text_type)\n \n def urlquote_plus(url, safe=''):\n@@ -47,23 +47,23 @@ def urlquote_plus(url, safe=''):\n     returned string can safely be used as part of an argument to a subsequent\n     iri_to_uri() call without double-quoting occurring.\n     \"\"\"\n-    return force_unicode(urllib_parse.quote_plus(smart_str(url), smart_str(safe)))\n+    return force_text(urllib_parse.quote_plus(smart_str(url), smart_str(safe)))\n urlquote_plus = allow_lazy(urlquote_plus, six.text_type)\n \n def urlunquote(quoted_url):\n     \"\"\"\n     A wrapper for Python's urllib.unquote() function that can operate on\n     the result of django.utils.http.urlquote().\n     \"\"\"\n-    return force_unicode(urllib_parse.unquote(smart_str(quoted_url)))\n+    return force_text(urllib_parse.unquote(smart_str(quoted_url)))\n urlunquote = allow_lazy(urlunquote, six.text_type)\n \n def urlunquote_plus(quoted_url):\n     \"\"\"\n     A wrapper for Python's urllib.unquote_plus() function that can operate on\n     the result of django.utils.http.urlquote_plus().\n     \"\"\"\n-    return force_unicode(urllib_parse.unquote_plus(smart_str(quoted_url)))\n+    return force_text(urllib_parse.unquote_plus(smart_str(quoted_url)))\n urlunquote_plus = allow_lazy(urlunquote_plus, six.text_type)\n \n def urlencode(query, doseq=0):\n@@ -167,8 +167,9 @@ def base36_to_int(s):\n     if len(s) > 13:\n         raise ValueError(\"Base36 input too large\")\n     value = int(s, 36)\n-    # ... then do a final check that the value will fit into an int.\n-    if value > sys.maxint:\n+    # ... then do a final check that the value will fit into an int to avoid\n+    # returning a long (#15067). The long type was removed in Python 3.\n+    if not six.PY3 and value > sys.maxint:\n         raise ValueError(\"Base36 input too large\")\n     return value\n \n@@ -178,8 +179,13 @@ def int_to_base36(i):\n     \"\"\"\n     digits = \"0123456789abcdefghijklmnopqrstuvwxyz\"\n     factor = 0\n-    if not 0 <= i <= sys.maxint:\n-        raise ValueError(\"Base36 conversion input too large or incorrect type.\")\n+    if i < 0:\n+        raise ValueError(\"Negative base36 conversion input.\")\n+    if not six.PY3:\n+        if not isinstance(i, six.integer_types):\n+            raise TypeError(\"Non-integer base36 conversion input.\")\n+        if i > sys.maxint:\n+            raise ValueError(\"Base36 conversion input too large.\")\n     # Find starting factor\n     while True:\n         factor += 1"
        },
        {
            "sha": "7b40d141def87717ba91d004b0f7b26743dee5f6",
            "filename": "django/utils/regex_helper.py",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fregex_helper.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fregex_helper.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fregex_helper.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,6 +8,7 @@\n from __future__ import unicode_literals\n \n from django.utils import six\n+from django.utils.six.moves import zip\n \n # Mapping of an escape character to a representative of that class. So, e.g.,\n # \"\\w\" is replaced by \"x\" in a reverse URL. A value of None means to ignore\n@@ -44,8 +45,8 @@ class NonCapture(list):\n \n def normalize(pattern):\n     \"\"\"\n-    Given a reg-exp pattern, normalizes it to a list of forms that suffice for\n-    reverse matching. This does the following:\n+    Given a reg-exp pattern, normalizes it to an iterable of forms that\n+    suffice for reverse matching. This does the following:\n \n     (1) For any repeating sections, keeps the minimum number of occurrences\n         permitted (this means zero for optional groups).\n@@ -80,7 +81,7 @@ def normalize(pattern):\n     try:\n         ch, escaped = next(pattern_iter)\n     except StopIteration:\n-        return zip([''],  [[]])\n+        return [('', [])]\n \n     try:\n         while True:\n@@ -193,9 +194,9 @@ def normalize(pattern):\n         pass\n     except NotImplementedError:\n         # A case of using the disjunctive form. No results for you!\n-        return zip([''],  [[]])\n+        return [('', [])]\n \n-    return zip(*flatten_result(result))\n+    return list(zip(*flatten_result(result)))\n \n def next_char(input_iter):\n     \"\"\""
        },
        {
            "sha": "bfaefd07eea1e2d6a4593d6fcc1aa7b9d4ea9a89",
            "filename": "django/utils/safestring.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fsafestring.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fsafestring.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsafestring.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -96,7 +96,7 @@ def mark_safe(s):\n     \"\"\"\n     if isinstance(s, SafeData):\n         return s\n-    if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_str):\n+    if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_bytes):\n         return SafeString(s)\n     if isinstance(s, (six.text_type, Promise)):\n         return SafeUnicode(s)\n@@ -112,7 +112,7 @@ def mark_for_escaping(s):\n     \"\"\"\n     if isinstance(s, (SafeData, EscapeData)):\n         return s\n-    if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_str):\n+    if isinstance(s, bytes) or (isinstance(s, Promise) and s._delegate_bytes):\n         return EscapeString(s)\n     if isinstance(s, (six.text_type, Promise)):\n         return EscapeUnicode(s)"
        },
        {
            "sha": "ceb5d70e58f671e10c8e71fbec193e3e6276706d",
            "filename": "django/utils/six.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fsix.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Fsix.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fsix.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -113,6 +113,7 @@ class _MovedItems(types.ModuleType):\n _moved_attributes = [\n     MovedAttribute(\"cStringIO\", \"cStringIO\", \"io\", \"StringIO\"),\n     MovedAttribute(\"filter\", \"itertools\", \"builtins\", \"ifilter\", \"filter\"),\n+    MovedAttribute(\"input\", \"__builtin__\", \"builtins\", \"raw_input\", \"input\"),\n     MovedAttribute(\"map\", \"itertools\", \"builtins\", \"imap\", \"map\"),\n     MovedAttribute(\"reload_module\", \"__builtin__\", \"imp\", \"reload\"),\n     MovedAttribute(\"reduce\", \"__builtin__\", \"functools\"),"
        },
        {
            "sha": "4f74b564a5a5139dbf7e8df0a854f93549ef85be",
            "filename": "django/utils/termcolors.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftermcolors.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftermcolors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftermcolors.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -2,6 +2,8 @@\n termcolors.py\n \"\"\"\n \n+from django.utils import six\n+\n color_names = ('black', 'red', 'green', 'yellow', 'blue', 'magenta', 'cyan', 'white')\n foreground = dict([(color_names[x], '3%s' % x) for x in range(8)])\n background = dict([(color_names[x], '4%s' % x) for x in range(8)])\n@@ -41,7 +43,7 @@ def colorize(text='', opts=(), **kwargs):\n     code_list = []\n     if text == '' and len(opts) == 1 and opts[0] == 'reset':\n         return '\\x1b[%sm' % RESET\n-    for k, v in kwargs.iteritems():\n+    for k, v in six.iteritems(kwargs):\n         if k == 'fg':\n             code_list.append(foreground[v])\n         elif k == 'bg':"
        },
        {
            "sha": "0838d79c652410225c4fd45234e2c6eb6977e304",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,13 +7,13 @@\n from django.utils.six.moves import html_entities\n from io import BytesIO\n \n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.functional import allow_lazy, SimpleLazyObject\n from django.utils import six\n from django.utils.translation import ugettext_lazy, ugettext as _, pgettext\n \n # Capitalizes the first letter of a string.\n-capfirst = lambda x: x and force_unicode(x)[0].upper() + force_unicode(x)[1:]\n+capfirst = lambda x: x and force_text(x)[0].upper() + force_text(x)[1:]\n capfirst = allow_lazy(capfirst, six.text_type)\n \n # Set up regular expressions\n@@ -26,7 +26,7 @@ def wrap(text, width):\n     A word-wrap function that preserves existing line breaks and most spaces in\n     the text. Expects that existing line breaks are posix newlines.\n     \"\"\"\n-    text = force_unicode(text)\n+    text = force_text(text)\n     def _generator():\n         it = iter(text.split(' '))\n         word = next(it)\n@@ -55,14 +55,14 @@ class Truncator(SimpleLazyObject):\n     An object used to truncate text, either by characters or words.\n     \"\"\"\n     def __init__(self, text):\n-        super(Truncator, self).__init__(lambda: force_unicode(text))\n+        super(Truncator, self).__init__(lambda: force_text(text))\n \n     def add_truncation_text(self, text, truncate=None):\n         if truncate is None:\n             truncate = pgettext(\n                 'String to return when truncating text',\n                 '%(truncated_text)s...')\n-        truncate = force_unicode(truncate)\n+        truncate = force_text(truncate)\n         if '%(truncated_text)s' in truncate:\n             return truncate % {'truncated_text': text}\n         # The truncation text didn't contain the %(truncated_text)s string\n@@ -226,7 +226,7 @@ def get_valid_filename(s):\n     >>> get_valid_filename(\"john's portrait in 2004.jpg\")\n     'johns_portrait_in_2004.jpg'\n     \"\"\"\n-    s = force_unicode(s).strip().replace(' ', '_')\n+    s = force_text(s).strip().replace(' ', '_')\n     return re.sub(r'(?u)[^-\\w.]', '', s)\n get_valid_filename = allow_lazy(get_valid_filename, six.text_type)\n \n@@ -244,20 +244,20 @@ def get_text_list(list_, last_word=ugettext_lazy('or')):\n     ''\n     \"\"\"\n     if len(list_) == 0: return ''\n-    if len(list_) == 1: return force_unicode(list_[0])\n+    if len(list_) == 1: return force_text(list_[0])\n     return '%s %s %s' % (\n         # Translators: This string is used as a separator between list elements\n-        _(', ').join([force_unicode(i) for i in list_][:-1]),\n-        force_unicode(last_word), force_unicode(list_[-1]))\n+        _(', ').join([force_text(i) for i in list_][:-1]),\n+        force_text(last_word), force_text(list_[-1]))\n get_text_list = allow_lazy(get_text_list, six.text_type)\n \n def normalize_newlines(text):\n-    return force_unicode(re.sub(r'\\r\\n|\\r|\\n', '\\n', text))\n+    return force_text(re.sub(r'\\r\\n|\\r|\\n', '\\n', text))\n normalize_newlines = allow_lazy(normalize_newlines, six.text_type)\n \n def recapitalize(text):\n     \"Recapitalizes text, placing caps after end-of-sentence punctuation.\"\n-    text = force_unicode(text).lower()\n+    text = force_text(text).lower()\n     capsRE = re.compile(r'(?:^|(?<=[\\.\\?\\!] ))([a-z])')\n     text = capsRE.sub(lambda x: x.group(1).upper(), text)\n     return text\n@@ -330,7 +330,7 @@ def smart_split(text):\n     >>> list(smart_split(r'A \"\\\"funky\\\" style\" test.'))\n     ['A', '\"\\\\\"funky\\\\\" style\"', 'test.']\n     \"\"\"\n-    text = force_unicode(text)\n+    text = force_text(text)\n     for bit in smart_split_re.finditer(text):\n         yield bit.group(0)\n smart_split = allow_lazy(smart_split, six.text_type)"
        },
        {
            "sha": "febde404a528c729e947da277dddb93c4548f548",
            "filename": "django/utils/translation/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftranslation%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftranslation%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2F__init__.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n \"\"\"\n from __future__ import unicode_literals\n \n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.functional import lazy\n from django.utils import six\n \n@@ -139,7 +139,7 @@ def _string_concat(*strings):\n     Lazy variant of string concatenation, needed for translations that are\n     constructed from multiple parts.\n     \"\"\"\n-    return ''.join([force_unicode(s) for s in strings])\n+    return ''.join([force_text(s) for s in strings])\n string_concat = lazy(_string_concat, six.text_type)\n \n def get_language_info(lang_code):"
        },
        {
            "sha": "5c5146820483772879549622e79f82b82280bb8a",
            "filename": "django/utils/translation/trans_null.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftranslation%2Ftrans_null.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftranslation%2Ftrans_null.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_null.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n # settings.USE_I18N = False can use this module rather than trans_real.py.\n \n from django.conf import settings\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.safestring import mark_safe, SafeData\n \n def ngettext(singular, plural, number):\n@@ -12,7 +12,7 @@ def ngettext(singular, plural, number):\n ngettext_lazy = ngettext\n \n def ungettext(singular, plural, number):\n-    return force_unicode(ngettext(singular, plural, number))\n+    return force_text(ngettext(singular, plural, number))\n \n def pgettext(context, message):\n     return ugettext(message)\n@@ -44,7 +44,7 @@ def gettext(message):\n     return result\n \n def ugettext(message):\n-    return force_unicode(gettext(message))\n+    return force_text(gettext(message))\n \n gettext_noop = gettext_lazy = _ = gettext\n "
        },
        {
            "sha": "9e6eadcd4891559104400caaf9a559427a037d71",
            "filename": "django/utils/translation/trans_real.py",
            "status": "modified",
            "additions": 24,
            "deletions": 17,
            "changes": 41,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftranslation%2Ftrans_real.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftranslation%2Ftrans_real.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,9 @@\n from threading import local\n \n from django.utils.importlib import import_module\n+from django.utils.encoding import smart_str, smart_text\n from django.utils.safestring import mark_safe, SafeData\n+from django.utils import six\n from django.utils.six import StringIO\n \n \n@@ -259,12 +261,14 @@ def do_translate(message, translation_function):\n def gettext(message):\n     return do_translate(message, 'gettext')\n \n-def ugettext(message):\n-    return do_translate(message, 'ugettext')\n+if six.PY3:\n+    ugettext = gettext\n+else:\n+    def ugettext(message):\n+        return do_translate(message, 'ugettext')\n \n def pgettext(context, message):\n-    result = do_translate(\n-        \"%s%s%s\" % (context, CONTEXT_SEPARATOR, message), 'ugettext')\n+    result = ugettext(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, message))\n     if CONTEXT_SEPARATOR in result:\n         # Translation not found\n         result = message\n@@ -297,20 +301,23 @@ def ngettext(singular, plural, number):\n     \"\"\"\n     return do_ntranslate(singular, plural, number, 'ngettext')\n \n-def ungettext(singular, plural, number):\n-    \"\"\"\n-    Returns a unicode strings of the translation of either the singular or\n-    plural, based on the number.\n-    \"\"\"\n-    return do_ntranslate(singular, plural, number, 'ungettext')\n+if six.PY3:\n+    ungettext = ngettext\n+else:\n+    def ungettext(singular, plural, number):\n+        \"\"\"\n+        Returns a unicode strings of the translation of either the singular or\n+        plural, based on the number.\n+        \"\"\"\n+        return do_ntranslate(singular, plural, number, 'ungettext')\n \n def npgettext(context, singular, plural, number):\n-    result = do_ntranslate(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, singular),\n-                           \"%s%s%s\" % (context, CONTEXT_SEPARATOR, plural),\n-                           number, 'ungettext')\n+    result = ungettext(\"%s%s%s\" % (context, CONTEXT_SEPARATOR, singular),\n+                       \"%s%s%s\" % (context, CONTEXT_SEPARATOR, plural),\n+                        number)\n     if CONTEXT_SEPARATOR in result:\n         # Translation not found\n-        result = do_ntranslate(singular, plural, number, 'ungettext')\n+        result = ungettext(singular, plural, number)\n     return result\n \n def all_locale_paths():\n@@ -440,7 +447,7 @@ def templatize(src, origin=None):\n     from django.conf import settings\n     from django.template import (Lexer, TOKEN_TEXT, TOKEN_VAR, TOKEN_BLOCK,\n             TOKEN_COMMENT, TRANSLATOR_COMMENT_MARK)\n-    src = src.decode(settings.FILE_CHARSET)\n+    src = smart_text(src, settings.FILE_CHARSET)\n     out = StringIO()\n     message_context = None\n     intrans = False\n@@ -455,7 +462,7 @@ def templatize(src, origin=None):\n                 content = ''.join(comment)\n                 translators_comment_start = None\n                 for lineno, line in enumerate(content.splitlines(True)):\n-                    if line.lstrip().startswith(TRANSLATOR_COMMENT_MARK):\n+                    if line.lstrip().startswith(smart_text(TRANSLATOR_COMMENT_MARK)):\n                         translators_comment_start = lineno\n                 for lineno, line in enumerate(content.splitlines(True)):\n                     if translators_comment_start is not None and lineno >= translators_comment_start:\n@@ -570,7 +577,7 @@ def templatize(src, origin=None):\n                 out.write(' # %s' % t.contents)\n             else:\n                 out.write(blankout(t.contents, 'X'))\n-    return out.getvalue().encode('utf-8')\n+    return smart_str(out.getvalue())\n \n def parse_accept_lang_header(lang_string):\n     \"\"\""
        },
        {
            "sha": "717181d2b99f9c5aab9026dbcc1e79020272aa69",
            "filename": "django/utils/tree.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftree.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftree.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftree.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -68,11 +68,12 @@ def __len__(self):\n         \"\"\"\n         return len(self.children)\n \n-    def __nonzero__(self):\n+    def __bool__(self):\n         \"\"\"\n         For truth value testing.\n         \"\"\"\n         return bool(self.children)\n+    __nonzero__ = __bool__ # Python 2\n \n     def __contains__(self, other):\n         \"\"\""
        },
        {
            "sha": "208b7e7191b64047191e8a893d78573bdbc714d1",
            "filename": "django/utils/tzinfo.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftzinfo.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Futils%2Ftzinfo.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftzinfo.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n import time\n from datetime import timedelta, tzinfo\n \n-from django.utils.encoding import smart_unicode, smart_str, DEFAULT_LOCALE_ENCODING\n+from django.utils.encoding import smart_text, smart_str, DEFAULT_LOCALE_ENCODING\n \n # Python's doc say: \"A tzinfo subclass must have an __init__() method that can\n # be called with no arguments\". FixedOffset and LocalTimezone don't honor this\n@@ -72,7 +72,7 @@ def dst(self, dt):\n \n     def tzname(self, dt):\n         try:\n-            return smart_unicode(time.tzname[self._isdst(dt)],\n+            return smart_text(time.tzname[self._isdst(dt)],\n                                  DEFAULT_LOCALE_ENCODING)\n         except UnicodeDecodeError:\n             return None"
        },
        {
            "sha": "b275ef9e73d318afff236134116d2df5d034b487",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -14,7 +14,7 @@\n from django.template.defaultfilters import force_escape, pprint\n from django.utils.html import escape\n from django.utils.importlib import import_module\n-from django.utils.encoding import smart_unicode, smart_str\n+from django.utils.encoding import smart_text, smart_bytes\n from django.utils import six\n \n HIDDEN_SETTINGS = re.compile('API|TOKEN|KEY|SECRET|PASS|PROFANITIES_LIST|SIGNATURE')\n@@ -111,7 +111,7 @@ def get_post_parameters(self, request):\n             return request.POST\n \n     def get_traceback_frame_variables(self, request, tb_frame):\n-        return tb_frame.f_locals.items()\n+        return list(six.iteritems(tb_frame.f_locals))\n \n class SafeExceptionReporterFilter(ExceptionReporterFilter):\n     \"\"\"\n@@ -256,7 +256,7 @@ def get_traceback_data(self):\n             end = getattr(self.exc_value, 'end', None)\n             if start is not None and end is not None:\n                 unicode_str = self.exc_value.args[1]\n-                unicode_hint = smart_unicode(unicode_str[max(start-5, 0):min(end+5, len(unicode_str))], 'ascii', errors='replace')\n+                unicode_hint = smart_text(unicode_str[max(start-5, 0):min(end+5, len(unicode_str))], 'ascii', errors='replace')\n         from django import get_version\n         c = {\n             'is_email': self.is_email,\n@@ -278,7 +278,7 @@ def get_traceback_data(self):\n         if self.exc_type:\n             c['exception_type'] = self.exc_type.__name__\n         if self.exc_value:\n-            c['exception_value'] = smart_unicode(self.exc_value, errors='replace')\n+            c['exception_value'] = smart_text(self.exc_value, errors='replace')\n         if frames:\n             c['lastframe'] = frames[-1]\n         return c\n@@ -440,7 +440,7 @@ def technical_404_response(request, exception):\n         'root_urlconf': settings.ROOT_URLCONF,\n         'request_path': request.path_info[1:], # Trim leading slash\n         'urlpatterns': tried,\n-        'reason': smart_str(exception, errors='replace'),\n+        'reason': smart_bytes(exception, errors='replace'),\n         'request': request,\n         'settings': get_safe_settings(),\n     })"
        },
        {
            "sha": "6554e898cafb6bca0e852ef41d744bb707638f13",
            "filename": "django/views/generic/base.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fgeneric%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fgeneric%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fbase.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,6 +6,7 @@\n from django.template.response import TemplateResponse\n from django.utils.log import getLogger\n from django.utils.decorators import classonlymethod\n+from django.utils import six\n \n logger = getLogger('django.request')\n \n@@ -35,7 +36,7 @@ def __init__(self, **kwargs):\n         \"\"\"\n         # Go through keyword arguments, and either save their values to our\n         # instance, or raise an error.\n-        for key, value in kwargs.iteritems():\n+        for key, value in six.iteritems(kwargs):\n             setattr(self, key, value)\n \n     @classonlymethod"
        },
        {
            "sha": "08b7318738f51cda95eb9e12883b6450a986fd39",
            "filename": "django/views/generic/dates.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fgeneric%2Fdates.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fgeneric%2Fdates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Fdates.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n from django.db import models\n from django.core.exceptions import ImproperlyConfigured\n from django.http import Http404\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils.functional import cached_property\n from django.utils.translation import ugettext as _\n from django.utils import timezone\n@@ -365,7 +365,7 @@ def get_dated_queryset(self, ordering=None, **lookup):\n             is_empty = len(qs) == 0 if paginate_by is None else not qs.exists()\n             if is_empty:\n                 raise Http404(_(\"No %(verbose_name_plural)s available\") % {\n-                        'verbose_name_plural': force_unicode(qs.model._meta.verbose_name_plural)\n+                        'verbose_name_plural': force_text(qs.model._meta.verbose_name_plural)\n                 })\n \n         return qs\n@@ -380,7 +380,7 @@ def get_date_list(self, queryset, date_type):\n \n         date_list = queryset.dates(date_field, date_type)[::-1]\n         if date_list is not None and not date_list and not allow_empty:\n-            name = force_unicode(queryset.model._meta.verbose_name_plural)\n+            name = force_text(queryset.model._meta.verbose_name_plural)\n             raise Http404(_(\"No %(verbose_name_plural)s available\") %\n                           {'verbose_name_plural': name})\n "
        },
        {
            "sha": "00ef224254e5be797969b1850109980f5d78ad5c",
            "filename": "django/views/i18n.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/django%2Fviews%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fi18n.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -6,7 +6,7 @@\n from django.utils import importlib\n from django.utils.translation import check_for_language, activate, to_locale, get_language\n from django.utils.text import javascript_quote\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.formats import get_format_modules, get_format\n from django.utils import six\n \n@@ -54,9 +54,9 @@ def get_formats():\n     src = []\n     for k, v in result.items():\n         if isinstance(v, (six.string_types, int)):\n-            src.append(\"formats['%s'] = '%s';\\n\" % (javascript_quote(k), javascript_quote(smart_unicode(v))))\n+            src.append(\"formats['%s'] = '%s';\\n\" % (javascript_quote(k), javascript_quote(smart_text(v))))\n         elif isinstance(v, (tuple, list)):\n-            v = [javascript_quote(smart_unicode(value)) for value in v]\n+            v = [javascript_quote(smart_text(value)) for value in v]\n             src.append(\"formats['%s'] = ['%s'];\\n\" % (javascript_quote(k), \"', '\".join(v)))\n     return ''.join(src)\n "
        },
        {
            "sha": "b7281946ee70f87a303f14388092a026df19e3ee",
            "filename": "docs/faq/index.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ffaq%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ffaq%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Findex.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -11,4 +11,5 @@ Django FAQ\n    help\n    models\n    admin\n-   contributing\n\\ No newline at end of file\n+   contributing\n+   troubleshooting\n\\ No newline at end of file"
        },
        {
            "sha": "f984be4bf5f635414fbfa0dfe1f50b7751935d39",
            "filename": "docs/faq/troubleshooting.txt",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ffaq%2Ftroubleshooting.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ffaq%2Ftroubleshooting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ffaq%2Ftroubleshooting.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -0,0 +1,16 @@\n+===============\n+Troubleshooting\n+===============\n+\n+This page contains some advice about errors and problems commonly encountered\n+during the development of Django applications.\n+\n+\"command not found: django-admin.py\"\n+------------------------------------\n+\n+:doc:`django-admin.py </ref/django-admin>` should be on your system path if you\n+installed Django via ``python setup.py``. If it's not on your path, you can\n+find it in ``site-packages/django/bin``, where ``site-packages`` is a directory\n+within your Python installation. Consider symlinking to :doc:`django-admin.py\n+</ref/django-admin>` from some place on your path, such as\n+:file:`/usr/local/bin`.\n\\ No newline at end of file"
        },
        {
            "sha": "e73ef9aa42be96daa4272d8383f4c61c183f790d",
            "filename": "docs/howto/custom-model-fields.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fhowto%2Fcustom-model-fields.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fhowto%2Fcustom-model-fields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fhowto%2Fcustom-model-fields.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -688,7 +688,7 @@ smoothly:\n 2. Put a :meth:`__str__` or :meth:`__unicode__` method on the class you're\n    wrapping up as a field. There are a lot of places where the default\n    behavior of the field code is to call\n-   :func:`~django.utils.encoding.force_unicode` on the value. (In our\n+   :func:`~django.utils.encoding.force_text` on the value. (In our\n    examples in this document, ``value`` would be a ``Hand`` instance, not a\n    ``HandField``). So if your :meth:`__unicode__` method automatically\n    converts to the string form of your Python object, you can save yourself"
        },
        {
            "sha": "011ecdb0bc96229c914b773022a6a8c3566aa47b",
            "filename": "docs/index.txt",
            "status": "modified",
            "additions": 105,
            "deletions": 36,
            "changes": 141,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Findex.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -34,6 +34,8 @@ Having trouble? We'd like to help!\n First steps\n ===========\n \n+Are you new to Django or to programming? This is the place to start!\n+\n * **From scratch:**\n   :doc:`Overview <intro/overview>` |\n   :doc:`Installation <intro/install>`\n@@ -47,6 +49,9 @@ First steps\n The model layer\n ===============\n \n+Django provides an abstraction layer (the \"models\") for structuring and\n+manipulating the data of your Web application. Learn more about it below:\n+\n * **Models:**\n   :doc:`Model syntax <topics/db/models>` |\n   :doc:`Field types <ref/models/fields>` |\n@@ -74,20 +79,13 @@ The model layer\n   :doc:`Providing initial data <howto/initial-data>` |\n   :doc:`Optimize database access <topics/db/optimization>`\n \n-The template layer\n-==================\n-\n-* **For designers:**\n-  :doc:`Syntax overview <topics/templates>` |\n-  :doc:`Built-in tags and filters <ref/templates/builtins>`\n-\n-* **For programmers:**\n-  :doc:`Template API <ref/templates/api>` |\n-  :doc:`Custom tags and filters <howto/custom-template-tags>`\n-\n The view layer\n ==============\n \n+Django has the concept of \"views\" to encapsulate the logic responsible for\n+processing a user's request and for returning the response. Find all you need\n+to know about views via the links below:\n+\n * **The basics:**\n   :doc:`URLconfs <topics/http/urls>` |\n   :doc:`View functions <topics/http/views>` |\n@@ -118,9 +116,29 @@ The view layer\n   :doc:`Overview <topics/http/middleware>` |\n   :doc:`Built-in middleware classes <ref/middleware>`\n \n+The template layer\n+==================\n+\n+The template layer provides a designer-friendly syntax for rendering the\n+information to be presented to the user. Learn how this syntax can be used by\n+designers and how it can be extended by programmers:\n+\n+* **For designers:**\n+  :doc:`Syntax overview <topics/templates>` |\n+  :doc:`Built-in tags and filters <ref/templates/builtins>` |\n+  :doc:`Web design helpers <ref/contrib/webdesign>` |\n+  :doc:`Humanization <ref/contrib/humanize>`\n+\n+* **For programmers:**\n+  :doc:`Template API <ref/templates/api>` |\n+  :doc:`Custom tags and filters <howto/custom-template-tags>`\n+\n Forms\n =====\n \n+Django provides a rich framework to facilitate the creation of forms and the\n+manipulation of form data.\n+\n * **The basics:**\n   :doc:`Overview <topics/forms/index>` |\n   :doc:`Form API <ref/forms/api>` |\n@@ -140,6 +158,9 @@ Forms\n The development process\n =======================\n \n+Learn about the various components and tools to help you in the development and\n+testing of Django applications:\n+\n * **Settings:**\n   :doc:`Overview <topics/settings>` |\n   :doc:`Full list of settings <ref/settings>`\n@@ -161,51 +182,99 @@ The development process\n   :doc:`Handling static files <howto/static-files>` |\n   :doc:`Tracking code errors by email <howto/error-reporting>`\n \n-Other batteries included\n-========================\n+The admin\n+=========\n \n-* :doc:`Admin site <ref/contrib/admin/index>` | :doc:`Admin actions <ref/contrib/admin/actions>` | :doc:`Admin documentation generator<ref/contrib/admin/admindocs>`\n-* :doc:`Authentication <topics/auth>`\n-* :doc:`Cache system <topics/cache>`\n+Find all you need to know about the automated admin interface, one of Django's\n+most popular features:\n+\n+* :doc:`Admin site <ref/contrib/admin/index>`\n+* :doc:`Admin actions <ref/contrib/admin/actions>`\n+* :doc:`Admin documentation generator<ref/contrib/admin/admindocs>`\n+\n+Security\n+========\n+\n+Security is a topic of paramount importance in the development of Web\n+applications and Django provides multiple protection tools and mechanisms:\n+\n+* :doc:`Security overview <topics/security>`\n * :doc:`Clickjacking protection <ref/clickjacking>`\n-* :doc:`Comments <ref/contrib/comments/index>` | :doc:`Moderation <ref/contrib/comments/moderation>` | :doc:`Custom comments <ref/contrib/comments/custom>`\n-* :doc:`Conditional content processing <topics/conditional-view-processing>`\n-* :doc:`Content types and generic relations <ref/contrib/contenttypes>`\n * :doc:`Cross Site Request Forgery protection <ref/contrib/csrf>`\n * :doc:`Cryptographic signing <topics/signing>`\n-* :doc:`Databrowse <ref/contrib/databrowse>`\n-* :doc:`E-mail (sending) <topics/email>`\n-* :doc:`Flatpages <ref/contrib/flatpages>`\n-* :doc:`GeoDjango <ref/contrib/gis/index>`\n-* :doc:`Humanize <ref/contrib/humanize>`\n+\n+Internationalization and localization\n+=====================================\n+\n+Django offers a robust internationalization and localization framework to\n+assist you in the development of applications for multiple languages and world\n+regions:\n+\n * :doc:`Internationalization <topics/i18n/index>`\n-* :doc:`Jython support <howto/jython>`\n * :doc:`\"Local flavor\" <ref/contrib/localflavor>`\n+\n+Python compatibility\n+====================\n+\n+Django aims to be compatible with multiple different flavors and versions of\n+Python:\n+\n+* :doc:`Jython support <howto/jython>`\n+* :doc:`Python 3 compatibility <topics/python3>`\n+\n+Geographic framework\n+====================\n+\n+:doc:`GeoDjango <ref/contrib/gis/index>` intends to be a world-class geographic\n+Web framework. Its goal is to make it as easy as possible to build GIS Web\n+applications and harness the power of spatially enabled data.\n+\n+Common Web application tools\n+============================\n+\n+Django offers multiple tools commonly needed in the development of Web\n+applications:\n+\n+* :doc:`Authentication <topics/auth>`\n+* :doc:`Caching <topics/cache>`\n * :doc:`Logging <topics/logging>`\n-* :doc:`Messages <ref/contrib/messages>`\n+* :doc:`Sending e-mails <topics/email>`\n+* :doc:`Syndication feeds (RSS/Atom) <ref/contrib/syndication>`\n+* :doc:`Comments <ref/contrib/comments/index>`, :doc:`comment moderation <ref/contrib/comments/moderation>` and :doc:`custom comments <ref/contrib/comments/custom>`\n * :doc:`Pagination <topics/pagination>`\n-* :doc:`Python 3 compatibility <topics/python3>`\n-* :doc:`Redirects <ref/contrib/redirects>`\n-* :doc:`Security <topics/security>`\n+* :doc:`Messages framework <ref/contrib/messages>`\n * :doc:`Serialization <topics/serialization>`\n * :doc:`Sessions <topics/http/sessions>`\n-* :doc:`Signals <topics/signals>`\n * :doc:`Sitemaps <ref/contrib/sitemaps>`\n-* :doc:`Sites <ref/contrib/sites>`\n-* :doc:`Static Files <ref/contrib/staticfiles>`\n-* :doc:`Syndication feeds (RSS/Atom) <ref/contrib/syndication>`\n+* :doc:`Static files management <ref/contrib/staticfiles>`\n+* :doc:`Data validation <ref/validators>`\n+\n+Other core functionalities\n+==========================\n+\n+Learn about some other core functionalities of the Django framework:\n+\n+* :doc:`Conditional content processing <topics/conditional-view-processing>`\n+* :doc:`Content types and generic relations <ref/contrib/contenttypes>`\n+* :doc:`Databrowse <ref/contrib/databrowse>`\n+* :doc:`Flatpages <ref/contrib/flatpages>`\n+* :doc:`Redirects <ref/contrib/redirects>`\n+* :doc:`Signals <topics/signals>`\n+* :doc:`The sites framework <ref/contrib/sites>`\n * :doc:`Unicode in Django <ref/unicode>`\n-* :doc:`Web design helpers <ref/contrib/webdesign>`\n-* :doc:`Validators <ref/validators>`\n \n The Django open-source project\n ==============================\n \n+Learn about the development process for the Django project itself and about how\n+you can contribute:\n+\n * **Community:**\n   :doc:`How to get involved <internals/contributing/index>` |\n   :doc:`The release process <internals/release-process>` |\n   :doc:`Team of committers <internals/committers>` |\n-  :doc:`The Django source code repository <internals/git>`\n+  :doc:`The Django source code repository <internals/git>` |\n+  :doc:`Security policies <internals/security>`\n \n * **Design philosophies:**\n   :doc:`Overview <misc/design-philosophies>`"
        },
        {
            "sha": "5567c26fa1cb8749289f4922da26b45cd0b2d7d4",
            "filename": "docs/internals/committers.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Fcommitters.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Fcommitters.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcommitters.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -149,6 +149,7 @@ Joseph Kocherhans\n .. _brian rosner: http://brosner.com/\n .. _eldarion: http://eldarion.com/\n .. _django dose: http://djangodose.com/\n+.. _pinax: http://pinaxproject.com/\n \n `Gary Wilson`_\n     Gary starting contributing patches to Django in 2006 while developing Web\n@@ -174,7 +175,7 @@ Justin Bronn\n     implementing GeoDjango, Justin obtained a deep knowledge of Django's\n     internals including the ORM, the admin, and Oracle support.\n \n-    Justin lives in Houston, Texas.\n+    Justin lives in San Francisco, CA.\n \n .. _GeoDjango: http://geodjango.org/\n "
        },
        {
            "sha": "91a078cbc0e8283f63b1f0ac7d45658a1767566b",
            "filename": "docs/internals/contributing/bugs-and-features.txt",
            "status": "modified",
            "additions": 10,
            "deletions": 35,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Fcontributing%2Fbugs-and-features.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Fcontributing%2Fbugs-and-features.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fcontributing%2Fbugs-and-features.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -2,7 +2,16 @@\n Reporting bugs and requesting features\n ======================================\n \n-Before reporting a bug or requesting a new feature, please consider these\n+.. Important::\n+\n+    Please report security issues **only** to\n+    security@djangoproject.com.  This is a private list only open to\n+    long-time, highly trusted Django developers, and its archives are\n+    not public. For further details, please see :doc:`our security\n+    policies </internals/security>`.\n+\n+\n+Otherwise, before reporting a bug or requesting a new feature, please consider these\n general points:\n \n * Check that someone hasn't already filed the bug or feature request by\n@@ -55,40 +64,6 @@ To understand the lifecycle of your ticket once you have created it, refer to\n \n .. _reporting-security-issues:\n \n-Reporting security issues\n--------------------------\n-\n-.. Important::\n-\n-    Please report security issues **only** to security@djangoproject.com.\n-    This is a private list only open to long-time, highly trusted Django\n-    developers, and its archives are not publicly readable.\n-\n-In the event of a confirmed vulnerability in Django itself, we will take the\n-following actions:\n-\n-* Acknowledge to the reporter that we've received the report and that a\n-  fix is forthcoming. We'll give a rough timeline and ask the reporter\n-  to keep the issue confidential until we announce it.\n-\n-* Focus on developing a fix as quickly as possible and produce patches\n-  against the current and two previous releases.\n-\n-* Determine a go-public date for announcing the vulnerability and the fix.\n-  To try to mitigate a possible \"arms race\" between those applying the\n-  patch and those trying to exploit the hole, we will not announce\n-  security problems immediately.\n-\n-* Pre-notify third-party distributors of Django (\"vendors\"). We will send\n-  these vendor notifications through private email which will include\n-  documentation of the vulnerability, links to the relevant patch(es), and\n-  a request to keep the vulnerability confidential until the official\n-  go-public date.\n-\n-* Publicly announce the vulnerability and the fix on the pre-determined\n-  go-public date. This will probably mean a new release of Django, but\n-  in some cases it may simply be patches against current releases.\n-\n Reporting user interface bugs and features\n ------------------------------------------\n "
        },
        {
            "sha": "3ff4eb62d038980736da9a9b23f17fcdbe0136d3",
            "filename": "docs/internals/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Findex.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -18,6 +18,7 @@ the hood\".\n \n    contributing/index\n    committers\n+   security\n    release-process\n    deprecation\n    git"
        },
        {
            "sha": "8affddb5e011f7a1f87f0872fdddf95476905634",
            "filename": "docs/internals/release-process.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Frelease-process.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Frelease-process.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Frelease-process.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -31,10 +31,14 @@ Since version 1.0, Django's release numbering works as follows:\n   These are of the form ``A.B alpha/beta/rc N``, which means the ``Nth``\n   alpha/beta/release candidate of version ``A.B``.\n \n-In Subversion, each Django release will be tagged under ``tags/releases``.  If\n-it's necessary to release a bug fix release or a security release that doesn't\n-come from the trunk, we'll copy that tag to ``branches/releases`` to make the\n-bug fix release.\n+In git, each Django release will have a tag indicating its version\n+number, signed with the Django release key. Additionally, each release\n+series (X.Y) has its own branch, and bugfix/security releases will be\n+issued from those branches.\n+\n+For more information about how the Django project issues new releases\n+for security purposes, please see :doc:`our security policies\n+<security>`.\n \n Major releases\n --------------"
        },
        {
            "sha": "7121ff31ecae94f3f11432d19a579a798a0f3369",
            "filename": "docs/internals/security.txt",
            "status": "added",
            "additions": 215,
            "deletions": 0,
            "changes": 215,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Fsecurity.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Finternals%2Fsecurity.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fsecurity.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -0,0 +1,215 @@\n+==========================\n+Django's security policies\n+==========================\n+\n+Django's development team is strongly committed to responsible\n+reporting and disclosure of security-related issues. As such, we've\n+adopted and follow a set of policies which conform to that ideal and\n+are geared toward allowing us to deliver timely security updates to\n+the official distribution of Django, as well as to third-party\n+distributions.\n+\n+.. _reporting-security-issues:\n+\n+Reporting security issues\n+=========================\n+\n+**Short version: please report security issues by emailing\n+security@djangoproject.com**.\n+\n+Most normal bugs in Django are reported to `our public Trac\n+instance`_, but due to the sensitive nature of security issues, we ask\n+that they *not* be publicly reported in this fashion.\n+\n+Instead, if you believe you've found something in Django which has\n+security implications, please send a description of the issue via\n+email to ``security@djangoproject.com``. Mail sent to that address\n+reaches a subset of the core development team, who can forward\n+security issues into the private committers' mailing list for broader\n+discussion if needed.\n+\n+You can send encrypted email to this address; the public key ID for\n+``security@djangoproject.com`` is ``0xfcb84b8d1d17f80b``, and this\n+public key is available from most commonly-used keyservers.\n+\n+Once you've submitted an issue via email, you should receive an\n+acknowledgment from a member of the Django development team within 48\n+hours, and depending on the action to be taken, you may receive\n+further followup emails.\n+\n+.. _our public Trac instance: https://code.djangoproject.com/query\n+\n+.. _security-support:\n+\n+Supported versions\n+==================\n+\n+At any given time, the Django team provides official security support\n+for several versions of Django:\n+\n+* The `master development branch`_, hosted on GitHub, which will\n+  become the next release of Django, receives security support.\n+\n+* The two most recent Django release series receive security\n+  support. For example, during the development cycle leading to the\n+  release of Django 1.5, support will be provided for Django 1.4 and\n+  Django 1.3. Upon the release of Django 1.5, Django 1.3's security\n+  support will end.\n+\n+When new releases are issued for security reasons, the accompanying\n+notice will include a list of affected versions. This list is\n+comprised solely of *supported* versions of Django: older versions may\n+also be affected, but we do not investigate to determine that, and\n+will not issue patches or new releases for those versions.\n+\n+.. _master development branch: https://github.com/django/django/\n+\n+.. _security-disclosure:\n+\n+How Django discloses security issues\n+====================================\n+\n+Our process for taking a security issue from private discussion to\n+public disclosure involves multiple steps.\n+\n+Approximately one week before full public disclosure, we will send\n+advance notification of the issue to a list of people and\n+organizations, primarily composed of operating-system vendors and\n+other distributors of Django. This notification will consist of an\n+email message, signed with the Django release key, containing:\n+\n+* A full description of the issue and the affected versions of Django.\n+\n+* The steps we will be taking to remedy the issue.\n+\n+* The patch(es), if any, that will be applied to Django.\n+\n+* The date on which the Django team will apply these patches, issue\n+  new releases and publicy disclose the issue.\n+\n+Simultaneously, the reporter of the issue will receive notification of\n+the date on which we plan to take the issue public.\n+\n+On the day of disclosure, we will take the following steps:\n+\n+1. Apply the relevant patch(es) to Django's codebase. The commit\n+   messages for these patches will indicate that they are for security\n+   issues, but will not describe the issue in any detail; instead,\n+   they will warn of upcoming disclosure.\n+\n+2. Issue the relevant release(s), by placing new packages on `the\n+   Python Package Index`_ and on the Django website, and tagging the\n+   new release(s) in Django's git repository.\n+\n+3. Post a public entry on `the official Django development blog`_,\n+   describing the issue and its resolution in detail, pointing to the\n+   relevant patches and new releases, and crediting the reporter of\n+   the issue (if the reporter wishes to be publicly identified).\n+\n+.. _the Python Package Index: http://pypi.python.org/pypi\n+.. _the official Django development blog: https://www.djangoproject.com/weblog/\n+\n+If a reported issue is believed to be particularly time-sensitive --\n+due to a known exploit in the wild, for example -- the time between\n+advance notification and public disclosure may be shortened\n+considerably.\n+\n+Additionally, if we have reason to believe that an issue reported to\n+us affects other frameworks or tools in the Python/web ecosystem, we\n+may privately contact and discuss those issues with the appropriate\n+maintainers, and coordinate our own disclosure and resolution with\n+theirs.\n+\n+.. _security-notifications:\n+\n+Who receives advance notification\n+=================================\n+\n+The full list of people and organizations who receive advance\n+notification of security issues is not and will not be made public.\n+\n+We also aim to keep this list as small as effectively possible, in\n+order to better manage the flow of confidential information prior to\n+disclosure. As such, our notification list is *not* simply a list of\n+users of Django, and merely being a user of Django is not sufficient\n+reason to be placed on the notification list.\n+\n+In broad terms, recipients of security notifications fall into three\n+groups:\n+\n+1. Operating-system vendors and other distributors of Django who\n+   provide a suitably-generic (i.e., *not* an individual's personal\n+   email address) contact address for reporting issues with their\n+   Django package, or for general security reporting. In either case,\n+   such addresses **must not** forward to public mailing lists or bug\n+   trackers. Addresses which forward to the private email of an\n+   individual maintainer or security-response contact are acceptable,\n+   although private security trackers or security-response groups are\n+   strongly preferred.\n+\n+2. On a case-by-case basis, individual package maintainers who have\n+   demonstrated a commitment to responding to and responsibly acting\n+   on these notifications.\n+\n+3. On a case-by-case basis, other entities who, in the judgment of the\n+   Django development team, need to be made aware of a pending\n+   security issue. Typically, membership in this group will consist of\n+   some of the largest and/or most likely to be severely impacted\n+   known users or distributors of Django, and will require a\n+   demonstrated ability to responsibly receive, keep confidential and\n+   act on these notifications.\n+\n+Additionally, a maximum of six days prior to disclosure, notification\n+will be sent to the ``distros@vs.openwall.org`` mailing list, whose\n+membership includes representatives of most major open-source\n+operating system vendors.\n+\n+Requesting notifications\n+========================\n+\n+If you believe that you, or an organization you are authorized to\n+represent, fall into one of the groups listed above, you can ask to be\n+added to Django's notification list by emailing\n+``security@djangoproject.com``. Please use the subject line \"Security\n+notification request\".\n+\n+Your request **must** include the following information:\n+\n+* Your full, real name and the name of the organization you represent,\n+  if applicable, as well as your role within that organization.\n+\n+* A detailed explanation of how you or your organization fit at least\n+  one set of criteria listed above.\n+\n+* A detailed explanation of why you are requesting security\n+  notifications. Again, please keep in mind that this is *not* simply\n+  a list for users of Django, and the overwhelming majority of users\n+  of Django should not request notifications and will not be added to\n+  our notification list if they do.\n+\n+* The email address you would like to have added to our notification\n+  list.\n+\n+* An explanation of who will be receiving/reviewing mail sent to that\n+  address, as well as information regarding any automated actions that\n+  will be taken (i.e., filing of a confidential issue in a bug\n+  tracker).\n+\n+* For individuals, the ID of a public key associated with your address\n+  which can be used to verify email received from you and encrypt\n+  email sent to you, as needed.\n+\n+Once submitted, your request will be considered by the Django\n+development team; you will receive a reply notifying you of the result\n+of your request within 30 days.\n+\n+Please also bear in mind that for any individual or organization,\n+receiving security notifications is a privilege granted at the sole\n+discretion of the Django development team, and that this privilege can\n+be revoked at any time, with or without explanation.\n+\n+If you are added to the notification list, security-related emails\n+will be sent to you by Django's release manager, and all notification\n+emails will be signed with the same key used to sign Django releases;\n+that key has the ID ``0x3684C0C08C8B2AE1``, and is available from most\n+commonly-used keyservers.\n\\ No newline at end of file"
        },
        {
            "sha": "999d0519fb59c8cb64cc41d9912a9b5886feec86",
            "filename": "docs/intro/_images/admin15t.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2F_images%2Fadmin15t.png",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2F_images%2Fadmin15t.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2F_images%2Fadmin15t.png?ref=184cf9ab798d5b25d855649ddb2ca580949778df"
        },
        {
            "sha": "70c8034c5d71423039e790f59e8339d7594e7681",
            "filename": "docs/intro/install.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Finstall.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -84,8 +84,9 @@ Then at the Python prompt, try to import Django::\n \n     >>> import django\n     >>> print(django.get_version())\n-    1.4\n+    1.5\n \n+You may have another version of Django installed.\n \n That's it!\n ----------"
        },
        {
            "sha": "1e2231d1e057ac994b0ea299b70c49b38ef74ae6",
            "filename": "docs/intro/tutorial01.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial01.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial01.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial01.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -52,7 +52,8 @@ code, then run the following command:\n \n    django-admin.py startproject mysite\n \n-This will create a ``mysite`` directory in your current directory.\n+This will create a ``mysite`` directory in your current directory.  If it didn't \n+work, see :doc:`Troubleshooting </faq/troubleshooting>`.\n \n .. admonition:: Script name may differ in distribution packages\n \n@@ -78,13 +79,6 @@ This will create a ``mysite`` directory in your current directory.\n     ``django`` (which will conflict with Django itself) or ``test`` (which\n     conflicts with a built-in Python package).\n \n-:doc:`django-admin.py </ref/django-admin>` should be on your system path if you\n-installed Django via ``python setup.py``. If it's not on your path, you can find\n-it in ``site-packages/django/bin``, where ``site-packages`` is a directory\n-within your Python installation. Consider symlinking to :doc:`django-admin.py\n-</ref/django-admin>` from some place on your path, such as\n-:file:`/usr/local/bin`.\n-\n .. admonition:: Where should this code live?\n \n     If your background is in PHP, you're probably used to putting code under the"
        },
        {
            "sha": "fd13230c8b92fd5b3722a141b110d1a64a32e04c",
            "filename": "docs/intro/tutorial02.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial02.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial02.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial02.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -311,6 +311,14 @@ It works like this: There are three slots for related Choices -- as specified\n by ``extra`` -- and each time you come back to the \"Change\" page for an\n already-created object, you get another three extra slots.\n \n+At the end of the three current slots you will find an \"Add another Choice\"\n+link.  If you click on it, a new slot will be added. If you want to remove the\n+added slot, you can click on the X to the top right of the added slot. Note\n+that you can't remove the original three slots. This image shows an added slot:\n+\n+.. image:: _images/admin15t.png\n+   :alt: Additional slot added dynamically\n+\n One small problem, though. It takes a lot of screen space to display all the\n fields for entering related ``Choice`` objects. For that reason, Django offers a\n tabular way of displaying inline related objects; you just need to change"
        },
        {
            "sha": "d15b2f43ae0fbe6d05db8a1e52bbe5626ca37b54",
            "filename": "docs/intro/tutorial03.txt",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial03.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial03.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial03.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -533,5 +533,22 @@ under \"/content/polls/\", or any other path root, and the app will still work.\n \n All the poll app cares about is its relative path, not its absolute path.\n \n+Removing hardcoded URLs in templates\n+------------------------------------\n+\n+Remember, when we wrote the link to a poll in our template, the link was\n+partially hardcoded like this:\n+\n+.. code-block:: html+django\n+\n+    <li><a href=\"/polls/{{ poll.id }}/\">{{ poll.question }}</a></li>\n+\n+To use the decoupled URLs we've just introduced, replace the hardcoded link\n+with the :ttag:`url` template tag:\n+\n+.. code-block:: html+django\n+\n+    <li><a href=\"{% url 'polls.views.detail' poll.id %}\">{{ poll.question }}</a></li>\n+\n When you're comfortable with writing views, read :doc:`part 4 of this tutorial\n </intro/tutorial04>` to learn about simple form processing and generic views."
        },
        {
            "sha": "31680ea5e576b79a6f51843bbd5b3ae10141eead",
            "filename": "docs/intro/tutorial04.txt",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial04.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fintro%2Ftutorial04.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fintro%2Ftutorial04.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -18,7 +18,7 @@ tutorial, so that the template contains an HTML ``<form>`` element:\n \n     {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}\n \n-    <form action=\"/polls/{{ poll.id }}/vote/\" method=\"post\">\n+    <form action=\"{% url 'polls.views.vote' poll.id %}\" method=\"post\">\n     {% csrf_token %}\n     {% for choice in poll.choice_set.all %}\n         <input type=\"radio\" name=\"choice\" id=\"choice{{ forloop.counter }}\" value=\"{{ choice.id }}\" />\n@@ -35,7 +35,7 @@ A quick rundown:\n   selects one of the radio buttons and submits the form, it'll send the\n   POST data ``choice=3``. This is HTML Forms 101.\n \n-* We set the form's ``action`` to ``/polls/{{ poll.id }}/vote/``, and we\n+* We set the form's ``action`` to ``{% url 'polls.views.vote' poll.id %}``, and we\n   set ``method=\"post\"``. Using ``method=\"post\"`` (as opposed to\n   ``method=\"get\"``) is very important, because the act of submitting this\n   form will alter data server-side. Whenever you create a form that alters\n@@ -172,7 +172,7 @@ Now, create a ``results.html`` template:\n     {% endfor %}\n     </ul>\n \n-    <a href=\"/polls/{{ poll.id }}/\">Vote again?</a>\n+    <a href=\"{% url 'polls.views.detail' poll.id %}\">Vote again?</a>\n \n Now, go to ``/polls/1/`` in your browser and vote in the poll. You should see a\n results page that gets updated each time you vote. If you submit the form\n@@ -238,11 +238,13 @@ Change it like so::\n             ListView.as_view(\n                 queryset=Poll.objects.order_by('-pub_date')[:5],\n                 context_object_name='latest_poll_list',\n-                template_name='polls/index.html')),\n+                template_name='polls/index.html'),\n+            name='poll_index'),\n         url(r'^(?P<pk>\\d+)/$',\n             DetailView.as_view(\n                 model=Poll,\n-                template_name='polls/detail.html')),\n+                template_name='polls/detail.html'),\n+            name='poll_detail'),\n         url(r'^(?P<pk>\\d+)/results/$',\n             DetailView.as_view(\n                 model=Poll,\n@@ -265,8 +267,8 @@ two views abstract the concepts of \"display a list of objects\" and\n   ``\"pk\"``, so we've changed ``poll_id`` to ``pk`` for the generic\n   views.\n \n-* We've added a name, ``poll_results``, to the results view so\n-  that we have a way to refer to its URL later on (see the\n+* We've added the ``name`` argument to the views (e.g. ``name='poll_results'``)\n+  so that we have a way to refer to their URL later on (see the\n   documentation about :ref:`naming URL patterns\n   <naming-url-patterns>` for information). We're also using the\n   :func:`~django.conf.urls.url` function from\n@@ -317,6 +319,13 @@ function anymore -- generic views can be (and are) used multiple times\n \n     return HttpResponseRedirect(reverse('poll_results', args=(p.id,)))\n \n+The same rule apply for the :ttag:`url` template tag. For example in the\n+``results.html`` template:\n+\n+.. code-block:: html+django\n+\n+    <a href=\"{% url 'poll_detail' poll.id %}\">Vote again?</a>\n+\n Run the server, and use your new polling app based on generic views.\n \n For full details on generic views, see the :doc:`generic views documentation"
        },
        {
            "sha": "a65a59bc8be92e67e36c4fbe92ec9148a56d4569",
            "filename": "docs/ref/class-based-views/generic-editing.txt",
            "status": "modified",
            "additions": 114,
            "deletions": 4,
            "changes": 118,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fgeneric-editing.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -2,7 +2,28 @@\n Generic editing views\n =====================\n \n-The views described here provide a foundation for editing content.\n+The following views are described on this page and provide a foundation for \n+editing content:\n+\n+* :class:`django.views.generic.edit.FormView`\n+* :class:`django.views.generic.edit.CreateView`\n+* :class:`django.views.generic.edit.UpdateView`\n+* :class:`django.views.generic.edit.DeleteView`\n+\n+.. note::\n+\n+    Some of the examples on this page assume that a model titled 'Author'\n+    has been defined. For these cases we assume the following has been defined \n+    in `myapp/models.py`::\n+\n+        from django import models\n+        from django.core.urlresolvers import reverse\n+\n+        class Author(models.Model):\n+            name = models.CharField(max_length=200)\n+\n+            def get_absolute_url(self):\n+                return reverse('author-detail', kwargs={'pk': self.pk})\n \n .. class:: django.views.generic.edit.FormView\n \n@@ -11,20 +32,53 @@ The views described here provide a foundation for editing content.\n \n     **Ancestors (MRO)**\n \n+    This view inherits methods and attributes from the following views:\n+\n     * :class:`django.views.generic.edit.FormView`\n     * :class:`django.views.generic.base.TemplateResponseMixin`\n     * :class:`django.views.generic.edit.BaseFormView`\n     * :class:`django.views.generic.edit.FormMixin`\n     * :class:`django.views.generic.edit.ProcessFormView`\n     * :class:`django.views.generic.base.View`\n \n+    **Example forms.py**::\n+\n+        from django import forms\n+\n+        class ContactForm(forms.Form):\n+            name = forms.CharField()\n+            message = forms.CharField(widget=forms.Textarea)\n+\n+            def send_email(self):\n+                # send email using the self.cleaned_data dictionary\n+                pass\n+\n+    **Example views.py**::\n+\n+        from myapp.forms import ContactForm\n+        from django.views.generic.edit import FormView\n+\n+        class ContactView(FormView):\n+            template_name = 'contact.html'\n+            form_class = ContactForm\n+            success_url = '/thanks/'\n+\n+            def form_valid(self, form):\n+                # This method is called when valid form data has been POSTed.\n+                # It should return an HttpResponse.\n+                form.send_email()\n+                return super(ContactView, self).form_valid(form)\n+\n+\n .. class:: django.views.generic.edit.CreateView\n \n     A view that displays a form for creating an object, redisplaying the form\n     with validation errors (if there are any) and saving the object.\n \n     **Ancestors (MRO)**\n \n+    This view inherits methods and attributes from the following views:\n+\n     * :class:`django.views.generic.edit.CreateView`\n     * :class:`django.views.generic.detail.SingleObjectTemplateResponseMixin`\n     * :class:`django.views.generic.base.TemplateResponseMixin`\n@@ -35,6 +89,24 @@ The views described here provide a foundation for editing content.\n     * :class:`django.views.generic.edit.ProcessFormView`\n     * :class:`django.views.generic.base.View`\n \n+    **Attributes**\n+\n+    .. attribute:: template_name_suffix\n+\n+        The CreateView page displayed to a GET request uses a\n+        ``template_name_suffix`` of ``'_form.html'``. For \n+        example, changing this attribute to ``'_create_form.html'`` for a view\n+        creating objects for the the example `Author` model would cause the the\n+        default `template_name` to be ``'myapp/author_create_form.html'``.\n+\n+    **Example views.py**::\n+\n+        from django.views.generic.edit import CreateView\n+        from myapp.models import Author\n+\n+        class AuthorCreate(CreateView):\n+            model = Author\n+\n .. class:: django.views.generic.edit.UpdateView\n \n     A view that displays a form for editing an existing object, redisplaying\n@@ -44,6 +116,8 @@ The views described here provide a foundation for editing content.\n \n     **Ancestors (MRO)**\n \n+    This view inherits methods and attributes from the following views:\n+\n     * :class:`django.views.generic.edit.UpdateView`\n     * :class:`django.views.generic.detail.SingleObjectTemplateResponseMixin`\n     * :class:`django.views.generic.base.TemplateResponseMixin`\n@@ -54,6 +128,24 @@ The views described here provide a foundation for editing content.\n     * :class:`django.views.generic.edit.ProcessFormView`\n     * :class:`django.views.generic.base.View`\n \n+    **Attributes**\n+\n+    .. attribute:: template_name_suffix\n+\n+        The UpdateView page displayed to a GET request uses a\n+        ``template_name_suffix`` of ``'_form.html'``. For \n+        example, changing this attribute to ``'_update_form.html'`` for a view\n+        updating objects for the the example `Author` model would cause the the\n+        default `template_name` to be ``'myapp/author_update_form.html'``.        \n+\n+    **Example views.py**::\n+\n+        from django.views.generic.edit import UpdateView\n+        from myapp.models import Author\n+\n+        class AuthorUpdate(UpdateView):\n+            model = Author\n+\n .. class:: django.views.generic.edit.DeleteView\n \n     A view that displays a confirmation page and deletes an existing object.\n@@ -63,6 +155,8 @@ The views described here provide a foundation for editing content.\n \n     **Ancestors (MRO)**\n \n+    This view inherits methods and attributes from the following views:\n+\n     * :class:`django.views.generic.edit.DeleteView`\n     * :class:`django.views.generic.detail.SingleObjectTemplateResponseMixin`\n     * :class:`django.views.generic.base.TemplateResponseMixin`\n@@ -72,7 +166,23 @@ The views described here provide a foundation for editing content.\n     * :class:`django.views.generic.detail.SingleObjectMixin`\n     * :class:`django.views.generic.base.View`\n \n-    **Notes**\n+    **Attributes**\n+\n+    .. attribute:: template_name_suffix\n+\n+        The DeleteView page displayed to a GET request uses a\n+        ``template_name_suffix`` of ``'_confirm_delete.html'``. For \n+        example, changing this attribute to ``'_check_delete.html'`` for a view\n+        deleting objects for the the example `Author` model would cause the the\n+        default `template_name` to be ``'myapp/author_check_delete.html'``.        \n+\n+\n+    **Example views.py**::\n+\n+        from django.views.generic.edit import DeleteView\n+        from django.core.urlresolvers import reverse_lazy\n+        from myapp.models import Author\n \n-    * The delete confirmation page displayed to a GET request uses a\n-      ``template_name_suffix`` of ``'_confirm_delete'``.\n+        class AuthorDelete(DeleteView):\n+            model = Author\n+            success_url = reverse_lazy('author-list')        "
        },
        {
            "sha": "f2271d2506d5587a4da6b093b57811c9995d69e7",
            "filename": "docs/ref/class-based-views/index.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Findex.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -32,9 +32,9 @@ A class-based view is deployed into a URL pattern using the\n \n     Arguments passed to a view are shared between every instance of a view.\n     This means that you shoudn't use a list, dictionary, or any other\n-    variable object as an argument to a view. If you did, the actions of\n-    one user visiting your view could have an effect on subsequent users\n-    visiting the same view.\n+    mutable object as an argument to a view. If you do and the shared object\n+    is modified, the actions of one user visiting your view could have an\n+    effect on subsequent users visiting the same view.\n \n Any argument passed into :meth:`~View.as_view()` will be assigned onto the\n instance that is used to service a request. Using the previous example,"
        },
        {
            "sha": "89610889dbe0b6be7fdebd86628f0d00d5bf670a",
            "filename": "docs/ref/class-based-views/mixins-editing.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fclass-based-views%2Fmixins-editing.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fclass-based-views%2Fmixins-editing.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fclass-based-views%2Fmixins-editing.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -2,6 +2,18 @@\n Editing mixins\n ==============\n \n+The following mixins are used to construct Django's editing views:\n+\n+* :class:`django.views.generic.edit.FormMixin`\n+* :class:`django.views.generic.edit.ModelFormMixin`\n+* :class:`django.views.generic.edit.ProcessFormView`\n+* :class:`django.views.generic.edit.DeletionMixin`\n+\n+.. note::\n+\n+    Examples of how these are combined into editing views can be found at\n+    the documentation on ``Generic editing views``.\n+\n .. class:: django.views.generic.edit.FormMixin\n \n     A mixin class that provides facilities for creating and displaying forms."
        },
        {
            "sha": "1d35e60e5d620d2fe115073f9f624c418fd75c93",
            "filename": "docs/ref/contrib/admin/_images/article_actions.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Farticle_actions.png",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Farticle_actions.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Farticle_actions.png?ref=184cf9ab798d5b25d855649ddb2ca580949778df"
        },
        {
            "sha": "16a2d0e197a97bd3c3820533868e8028e6992b5f",
            "filename": "docs/ref/contrib/admin/_images/article_actions_message.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Farticle_actions_message.png",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Farticle_actions_message.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Farticle_actions_message.png?ref=184cf9ab798d5b25d855649ddb2ca580949778df"
        },
        {
            "sha": "22d40e0181e5ec0acfacb709b878aa982fc72f3e",
            "filename": "docs/ref/contrib/admin/_images/user_actions.png",
            "status": "modified",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Fuser_actions.png",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Fuser_actions.png",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2F_images%2Fuser_actions.png?ref=184cf9ab798d5b25d855649ddb2ca580949778df"
        },
        {
            "sha": "4d39981a4d483bb0b808eeaad11d09f752f92cd3",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1266,11 +1266,11 @@ provided some extra mapping data that would not otherwise be available::\n             # ...\n             pass\n \n-        def change_view(self, request, object_id, extra_context=None):\n+        def change_view(self, request, object_id, form_url='', extra_context=None):\n             extra_context = extra_context or {}\n             extra_context['osm_data'] = self.get_osm_info()\n             return super(MyModelAdmin, self).change_view(request, object_id,\n-                extra_context=extra_context)\n+                form_url, extra_context=extra_context)\n \n .. versionadded:: 1.4\n "
        },
        {
            "sha": "0ef37a9a0bbcad6a2452380baa5438eabb2a2e6e",
            "filename": "docs/ref/contrib/comments/custom.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fcomments%2Fcustom.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fcomments%2Fcustom.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fcomments%2Fcustom.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -51,9 +51,9 @@ To make this kind of customization, we'll need to do three things:\n    custom :setting:`COMMENTS_APP`.\n \n So, carrying on the example above, we're dealing with a typical app structure in\n-the ``my_custom_app`` directory::\n+the ``my_comment_app`` directory::\n \n-    my_custom_app/\n+    my_comment_app/\n         __init__.py\n         models.py\n         forms.py\n@@ -98,11 +98,11 @@ Django provides a couple of \"helper\" classes to make writing certain types of\n custom comment forms easier; see :mod:`django.contrib.comments.forms` for\n more.\n \n-Finally, we'll define a couple of methods in ``my_custom_app/__init__.py`` to\n+Finally, we'll define a couple of methods in ``my_comment_app/__init__.py`` to\n point Django at these classes we've created::\n \n-    from my_comments_app.models import CommentWithTitle\n-    from my_comments_app.forms import CommentFormWithTitle\n+    from my_comment_app.models import CommentWithTitle\n+    from my_comment_app.forms import CommentFormWithTitle\n \n     def get_model():\n         return CommentWithTitle"
        },
        {
            "sha": "f4e706d27579781811cc6407c2b84a6095a8dbdb",
            "filename": "docs/ref/contrib/gis/geos.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Fgeos.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -75,6 +75,17 @@ return a :class:`GEOSGeometry` object from an input string or a file::\n     >>> pnt = fromfile('/path/to/pnt.wkt')\n     >>> pnt = fromfile(open('/path/to/pnt.wkt'))\n \n+.. _geos-exceptions-in-logfile:\n+\n+.. admonition:: My logs are filled with GEOS-related errors\n+\n+    You find many ``TypeError`` or ``AttributeError`` exceptions filling your\n+    Web server's log files. This generally means that you are creating GEOS\n+    objects at the top level of some of your Python modules. Then, due to a race\n+    condition in the garbage collector, your module is garbage collected before\n+    the GEOS object. To prevent this, create :class:`GEOSGeometry` objects\n+    inside the local scope of your functions/methods.\n+\n Geometries are Pythonic\n -----------------------\n :class:`GEOSGeometry` objects are 'Pythonic', in other words components may"
        },
        {
            "sha": "72bd72a6f81e0ffb309db7e4d62de4722b7e1c68",
            "filename": "docs/ref/contrib/gis/install.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fgis%2Finstall.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -191,6 +191,8 @@ GEOS C library.  For example:\n     The setting must be the *full* path to the **C** shared library; in\n     other words you want to use ``libgeos_c.so``, not ``libgeos.so``.\n \n+See also :ref:`My logs are filled with GEOS-related errors <geos-exceptions-in-logfile>`.\n+\n .. _proj4:\n \n PROJ.4"
        },
        {
            "sha": "57978288b1dc2a46cdb28c54a9ebb163645c64c7",
            "filename": "docs/ref/contrib/humanize.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fhumanize.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fhumanize.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fhumanize.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -103,9 +103,9 @@ naturaltime\n .. versionadded:: 1.4\n \n For datetime values, returns a string representing how many seconds,\n-minutes or hours ago it was -- falling back to a longer date format if the\n-value is more than a day old. In case the datetime value is in the future\n-the return value will automatically use an appropriate phrase.\n+minutes or hours ago it was -- falling back to the :tfilter:`timesince` \n+format if the value is more than a day old. In case the datetime value is in\n+the future the return value will automatically use an appropriate phrase.\n \n Examples (when 'now' is 17 Feb 2007 16:30:00):\n \n@@ -115,13 +115,14 @@ Examples (when 'now' is 17 Feb 2007 16:30:00):\n * ``17 Feb 2007 16:25:35`` becomes ``4 minutes ago``.\n * ``17 Feb 2007 15:30:29`` becomes ``an hour ago``.\n * ``17 Feb 2007 13:31:29`` becomes ``2 hours ago``.\n-* ``16 Feb 2007 13:31:29`` becomes ``1 day ago``.\n+* ``16 Feb 2007 13:31:29`` becomes ``1 day, 3 hours ago``.\n * ``17 Feb 2007 16:30:30`` becomes ``29 seconds from now``.\n * ``17 Feb 2007 16:31:00`` becomes ``a minute from now``.\n * ``17 Feb 2007 16:34:35`` becomes ``4 minutes from now``.\n * ``17 Feb 2007 16:30:29`` becomes ``an hour from now``.\n * ``17 Feb 2007 18:31:29`` becomes ``2 hours from now``.\n * ``18 Feb 2007 16:31:29`` becomes ``1 day from now``.\n+* ``26 Feb 2007 18:31:29`` becomes ``1 week, 2 days from now``.\n \n .. templatefilter:: ordinal\n "
        },
        {
            "sha": "4cf90ee38107496cbf09a5960079e5c70509d041",
            "filename": "docs/ref/contrib/messages.txt",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fmessages.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fcontrib%2Fmessages.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fmessages.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,12 +5,14 @@ The messages framework\n .. module:: django.contrib.messages\n    :synopsis: Provides cookie- and session-based temporary message storage.\n \n-Django provides full support for cookie- and session-based messaging, for\n-both anonymous and authenticated clients. The messages framework allows you\n-to temporarily store messages in one request and retrieve them for display\n-in a subsequent request (usually the next one). Every message is tagged\n-with a specific ``level`` that determines its priority (e.g., ``info``,\n-``warning``, or ``error``).\n+Quite commonly in web applications, you may need to display a one-time\n+notification message (also know as \"flash message\") to the user after\n+processing a form or some other types of user input. For this, Django provides\n+full support for cookie- and session-based messaging, for both anonymous and\n+authenticated users. The messages framework allows you to temporarily store\n+messages in one request and retrieve them for display in a subsequent request\n+(usually the next one). Every message is tagged with a specific ``level`` that\n+determines its priority (e.g., ``info``, ``warning``, or ``error``).\n \n Enabling messages\n ================="
        },
        {
            "sha": "92b5665beac420298b791607c882f2a1f031f8f8",
            "filename": "docs/ref/databases.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fdatabases.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fdatabases.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdatabases.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -238,7 +238,7 @@ to you, the developer, to handle the fact that you will receive bytestrings if\n you configure your table(s) to use ``utf8_bin`` collation. Django itself should\n mostly work smoothly with such columns (except for the ``contrib.sessions``\n ``Session`` and ``contrib.admin`` ``LogEntry`` tables described below), but\n-your code must be prepared to call ``django.utils.encoding.smart_unicode()`` at\n+your code must be prepared to call ``django.utils.encoding.smart_text()`` at\n times if it really wants to work with consistent data -- Django will not do\n this for you (the database backend layer and the model population layer are\n separated internally so the database layer doesn't know it needs to make this"
        },
        {
            "sha": "5ff7ecba2c7367069a79985fad2303274b826540",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -747,7 +747,7 @@ use the ``--plain`` option, like so::\n \n If you would like to specify either IPython or bpython as your interpreter if\n you have both installed you can specify an alternative interpreter interface\n-with the ``-i`` or ``--interface`` options like so::\n+with the ``-i`` or ``--interface`` options like so:\n \n IPython::\n "
        },
        {
            "sha": "777d73e0150de7ff64c436138b281f8e558bb95b",
            "filename": "docs/ref/forms/api.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fforms%2Fapi.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fforms%2Fapi.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fapi.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -199,8 +199,8 @@ Note that any text-based field -- such as ``CharField`` or ``EmailField`` --\n always cleans the input into a Unicode string. We'll cover the encoding\n implications later in this document.\n \n-If your data does *not* validate, your ``Form`` instance will not have a\n-``cleaned_data`` attribute::\n+If your data does *not* validate, the ``cleaned_data`` dictionary contains\n+only the valid fields::\n \n     >>> data = {'subject': '',\n     ...         'message': 'Hi there',\n@@ -210,9 +210,12 @@ If your data does *not* validate, your ``Form`` instance will not have a\n     >>> f.is_valid()\n     False\n     >>> f.cleaned_data\n-    Traceback (most recent call last):\n-    ...\n-    AttributeError: 'ContactForm' object has no attribute 'cleaned_data'\n+    {'cc_myself': True, 'message': u'Hi there'}\n+\n+.. versionchanged:: 1.5\n+\n+Until Django 1.5, the ``cleaned_data`` attribute wasn't defined at all when\n+the ``Form`` didn't validate.\n \n ``cleaned_data`` will always *only* contain a key for fields defined in the\n ``Form``, even if you pass extra data when you define the ``Form``. In this\n@@ -232,9 +235,9 @@ but ``cleaned_data`` contains only the form's fields::\n     >>> f.cleaned_data # Doesn't contain extra_field_1, etc.\n     {'cc_myself': True, 'message': u'Hi there', 'sender': u'foo@example.com', 'subject': u'hello'}\n \n-``cleaned_data`` will include a key and value for *all* fields defined in the\n-``Form``, even if the data didn't include a value for fields that are not\n-required. In this example, the data dictionary doesn't include a value for the\n+When the ``Form`` is valid, ``cleaned_data`` will include a key and value for\n+*all* its fields, even if the data didn't include a value for some optional\n+fields. In this example, the data dictionary doesn't include a value for the\n ``nick_name`` field, but ``cleaned_data`` includes it, with an empty value::\n \n     >>> class OptionalPersonForm(Form):\n@@ -583,7 +586,7 @@ lazy developers -- they're not the only way a form object can be displayed.\n \n    Used to display HTML or access attributes for a single field of a\n    :class:`Form` instance.\n-   \n+\n    The :meth:`__unicode__` and :meth:`__str__` methods of this object displays\n    the HTML for this field.\n "
        },
        {
            "sha": "95424d0cd0deaa08b70fb7c154eac631277d3070",
            "filename": "docs/ref/forms/validation.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fforms%2Fvalidation.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fforms%2Fvalidation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fforms%2Fvalidation.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -362,7 +362,9 @@ Secondly, once we have decided that the combined data in the two fields we are\n considering aren't valid, we must remember to remove them from the\n ``cleaned_data``.\n \n-In fact, Django will currently completely wipe out the ``cleaned_data``\n-dictionary if there are any errors in the form. However, this behavior may\n-change in the future, so it's not a bad idea to clean up after yourself in the\n-first place.\n+.. versionchanged:: 1.5\n+\n+Django used to remove the ``cleaned_data`` attribute entirely if there were\n+any errors in the form. Since version 1.5, ``cleaned_data`` is present even if\n+the form doesn't validate, but it contains only field values that did\n+validate."
        },
        {
            "sha": "a6ea9a6c4157bc3f595b441edbd87f539079cf0b",
            "filename": "docs/ref/middleware.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fmiddleware.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fmiddleware.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmiddleware.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -146,7 +146,7 @@ Locale middleware\n \n Enables language selection based on data from the request. It customizes\n content for each user. See the :doc:`internationalization documentation\n-</topics/i18n/index>`.\n+</topics/i18n/translation>`.\n \n Message middleware\n ------------------"
        },
        {
            "sha": "a43163c5e9b3581cea4d34eaa102ae668b9779ee",
            "filename": "docs/ref/models/fields.txt",
            "status": "modified",
            "additions": 35,
            "deletions": 26,
            "changes": 61,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fmodels%2Ffields.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fmodels%2Ffields.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Ffields.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -86,42 +86,43 @@ field.\n If this is given, Django's admin will use a select box instead of the standard\n text field and will limit choices to the choices given.\n \n-A choices list looks like this::\n+A choices list is an iterable of 2-tuples; the first element in each\n+tuple is the actual value to be stored, and the second element is the\n+human-readable name. For example::\n \n     YEAR_IN_SCHOOL_CHOICES = (\n         ('FR', 'Freshman'),\n         ('SO', 'Sophomore'),\n         ('JR', 'Junior'),\n         ('SR', 'Senior'),\n-        ('GR', 'Graduate'),\n     )\n \n-The first element in each tuple is the actual value to be stored. The second\n-element is the human-readable name for the option.\n+Generally, it's best to define choices inside a model class, and to\n+define a suitably-named constant for each value::\n \n-The choices list can be defined either as part of your model class::\n-\n-    class Foo(models.Model):\n+    class Student(models.Model):\n+        FRESHMAN = 'FR'\n+        SOPHOMORE = 'SO'\n+        JUNIOR = 'JR'\n+        SENIOR = 'SR'\n         YEAR_IN_SCHOOL_CHOICES = (\n-            ('FR', 'Freshman'),\n-            ('SO', 'Sophomore'),\n-            ('JR', 'Junior'),\n-            ('SR', 'Senior'),\n-            ('GR', 'Graduate'),\n+            (FRESHMAN, 'Freshman'),\n+            (SOPHOMORE, 'Sophomore'),\n+            (JUNIOR, 'Junior'),\n+            (SENIOR, 'Senior'),\n         )\n-        year_in_school = models.CharField(max_length=2, choices=YEAR_IN_SCHOOL_CHOICES)\n+        year_in_school = models.CharField(max_length=2,\n+                                          choices=YEAR_IN_SCHOOL_CHOICES,\n+                                          default=FRESHMAN)\n \n-or outside your model class altogether::\n+        def is_upperclass(self):\n+\t    return self.year_in_school in (self.JUNIOR, self.SENIOR)\n \n-    YEAR_IN_SCHOOL_CHOICES = (\n-        ('FR', 'Freshman'),\n-        ('SO', 'Sophomore'),\n-        ('JR', 'Junior'),\n-        ('SR', 'Senior'),\n-        ('GR', 'Graduate'),\n-    )\n-    class Foo(models.Model):\n-        year_in_school = models.CharField(max_length=2, choices=YEAR_IN_SCHOOL_CHOICES)\n+Though you can define a choices list outside of a model class and then\n+refer to it, defining the choices and names for each choice inside the\n+model class keeps all of that information with the class that uses it,\n+and makes the choices easy to reference (e.g, ``Student.SOPHOMORE``\n+will work anywhere that the ``Student`` model has been imported).\n \n You can also collect your available choices into named groups that can\n be used for organizational purposes::\n@@ -1002,9 +1003,10 @@ define the details of how the relation works.\n     <abstract-base-classes>`; and when you do so\n     :ref:`some special syntax <abstract-related-name>` is available.\n \n-    If you'd prefer Django didn't create a backwards relation, set ``related_name``\n-    to ``'+'``. For example, this will ensure that the ``User`` model won't get a\n-    backwards relation to this model::\n+    If you'd prefer Django not to create a backwards relation, set\n+    ``related_name`` to ``'+'`` or end it with ``'+'``. For example, this will\n+    ensure that the ``User`` model won't have a backwards relation to this\n+    model::\n \n         user = models.ForeignKey(User, related_name='+')\n \n@@ -1095,6 +1097,13 @@ that control how the relationship functions.\n \n     Same as :attr:`ForeignKey.related_name`.\n \n+    If you have more than one ``ManyToManyField`` pointing to the same model\n+    and want to suppress the backwards relations, set each ``related_name``\n+    to a unique value ending with ``'+'``::\n+\n+        users = models.ManyToManyField(User, related_name='u+')\n+        referents = models.ManyToManyField(User, related_name='ref+')\n+\n .. attribute:: ManyToManyField.limit_choices_to\n \n     Same as :attr:`ForeignKey.limit_choices_to`."
        },
        {
            "sha": "14541ad0d1c150b1f0a044ad06796943a473adaa",
            "filename": "docs/ref/models/instances.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fmodels%2Finstances.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fmodels%2Finstances.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fmodels%2Finstances.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -453,9 +453,9 @@ using ``__str__()`` like this::\n         last_name = models.CharField(max_length=50)\n \n         def __str__(self):\n-            # Note use of django.utils.encoding.smart_str() here because\n+            # Note use of django.utils.encoding.smart_bytes() here because\n             # first_name and last_name will be unicode strings.\n-            return smart_str('%s %s' % (self.first_name, self.last_name))\n+            return smart_bytes('%s %s' % (self.first_name, self.last_name))\n \n ``get_absolute_url``\n --------------------"
        },
        {
            "sha": "531ff33da2e0e89ea604bb4f17b8d95729767344",
            "filename": "docs/ref/settings.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fsettings.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Fsettings.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fsettings.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -183,7 +183,7 @@ compose a prefix, version and key into a final cache key. The default\n implementation is equivalent to the function::\n \n     def make_key(key, key_prefix, version):\n-        return ':'.join([key_prefix, str(version), smart_str(key)])\n+        return ':'.join([key_prefix, str(version), smart_bytes(key)])\n \n You may use any key function you want, as long as it has the same\n argument signature."
        },
        {
            "sha": "072eebf69fbd9e34c48d3ad2db19c3b56df2c797",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1184,7 +1184,7 @@ Removes all values of arg from the given string.\n \n For example::\n \n-    {{ value|cut:\" \"}}\n+    {{ value|cut:\" \" }}\n \n If ``value`` is ``\"String with spaces\"``, the output will be\n ``\"Stringwithspaces\"``."
        },
        {
            "sha": "ffab647379e5392c77867152f9d734614632a0b9",
            "filename": "docs/ref/unicode.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Funicode.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Funicode.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Funicode.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -129,7 +129,7 @@ Conversion functions\n The ``django.utils.encoding`` module contains a few functions that are handy\n for converting back and forth between Unicode and bytestrings.\n \n-* ``smart_unicode(s, encoding='utf-8', strings_only=False, errors='strict')``\n+* ``smart_text(s, encoding='utf-8', strings_only=False, errors='strict')``\n   converts its input to a Unicode string. The ``encoding`` parameter\n   specifies the input encoding. (For example, Django uses this internally\n   when processing form input data, which might not be UTF-8 encoded.) The\n@@ -139,27 +139,27 @@ for converting back and forth between Unicode and bytestrings.\n   that are accepted by Python's ``unicode()`` function for its error\n   handling.\n \n-  If you pass ``smart_unicode()`` an object that has a ``__unicode__``\n+  If you pass ``smart_text()`` an object that has a ``__unicode__``\n   method, it will use that method to do the conversion.\n \n-* ``force_unicode(s, encoding='utf-8', strings_only=False,\n-  errors='strict')`` is identical to ``smart_unicode()`` in almost all\n+* ``force_text(s, encoding='utf-8', strings_only=False,\n+  errors='strict')`` is identical to ``smart_text()`` in almost all\n   cases. The difference is when the first argument is a :ref:`lazy\n-  translation <lazy-translations>` instance. While ``smart_unicode()``\n-  preserves lazy translations, ``force_unicode()`` forces those objects to a\n+  translation <lazy-translations>` instance. While ``smart_text()``\n+  preserves lazy translations, ``force_text()`` forces those objects to a\n   Unicode string (causing the translation to occur). Normally, you'll want\n-  to use ``smart_unicode()``. However, ``force_unicode()`` is useful in\n+  to use ``smart_text()``. However, ``force_text()`` is useful in\n   template tags and filters that absolutely *must* have a string to work\n   with, not just something that can be converted to a string.\n \n-* ``smart_str(s, encoding='utf-8', strings_only=False, errors='strict')``\n-  is essentially the opposite of ``smart_unicode()``. It forces the first\n+* ``smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict')``\n+  is essentially the opposite of ``smart_text()``. It forces the first\n   argument to a bytestring. The ``strings_only`` parameter has the same\n-  behavior as for ``smart_unicode()`` and ``force_unicode()``. This is\n+  behavior as for ``smart_text()`` and ``force_text()``. This is\n   slightly different semantics from Python's builtin ``str()`` function,\n   but the difference is needed in a few places within Django's internals.\n \n-Normally, you'll only need to use ``smart_unicode()``. Call it as early as\n+Normally, you'll only need to use ``smart_text()``. Call it as early as\n possible on any input data that might be either Unicode or a bytestring, and\n from then on, you can treat the result as always being Unicode.\n \n@@ -324,7 +324,7 @@ A couple of tips to remember when writing your own template tags and filters:\n * Always return Unicode strings from a template tag's ``render()`` method\n   and from template filters.\n \n-* Use ``force_unicode()`` in preference to ``smart_unicode()`` in these\n+* Use ``force_text()`` in preference to ``smart_text()`` in these\n   places. Tag rendering and filter calls occur as the template is being\n   rendered, so there is no advantage to postponing the conversion of lazy\n   translation objects into strings. It's easier to work solely with Unicode"
        },
        {
            "sha": "b6cb1035d3d081d92f8f43247aa363e712a0fd60",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 43,
            "deletions": 13,
            "changes": 56,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -178,40 +178,68 @@ The functions defined in this module share the following properties:\n \n .. class:: StrAndUnicode\n \n-    A class whose ``__str__`` returns its ``__unicode__`` as a UTF-8\n-    bytestring. Useful as a mix-in.\n+    A class that derives ``__str__`` from ``__unicode__``.\n \n-.. function:: smart_unicode(s, encoding='utf-8', strings_only=False, errors='strict')\n+    On Python 2, ``__str__`` returns the output of ``__unicode__`` encoded as\n+    a UTF-8 bytestring. On Python 3, ``__str__`` returns the output of\n+    ``__unicode__``.\n+\n+    Useful as a mix-in. If you support Python 2 and 3 with a single code base,\n+    you can inherit this mix-in and just define ``__unicode__``.\n+\n+.. function:: smart_text(s, encoding='utf-8', strings_only=False, errors='strict')\n \n-    Returns a ``unicode`` object representing ``s``. Treats bytestrings using\n-    the 'encoding' codec.\n+    .. versionadded:: 1.5\n+\n+    Returns a text object representing ``s`` -- ``unicode`` on Python 2 and\n+    ``str`` on Python 3. Treats bytestrings using the ``encoding`` codec.\n \n     If ``strings_only`` is ``True``, don't convert (some) non-string-like\n     objects.\n \n+.. function:: smart_unicode(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    Historical name of :func:`smart_text`. Only available under Python 2.\n+\n .. function:: is_protected_type(obj)\n \n     Determine if the object instance is of a protected type.\n \n     Objects of protected types are preserved as-is when passed to\n-    ``force_unicode(strings_only=True)``.\n+    ``force_text(strings_only=True)``.\n \n-.. function:: force_unicode(s, encoding='utf-8', strings_only=False, errors='strict')\n+.. function:: force_text(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    .. versionadded:: 1.5\n \n-    Similar to ``smart_unicode``, except that lazy instances are resolved to\n+    Similar to ``smart_text``, except that lazy instances are resolved to\n     strings, rather than kept as lazy objects.\n \n     If ``strings_only`` is ``True``, don't convert (some) non-string-like\n     objects.\n \n-.. function:: smart_str(s, encoding='utf-8', strings_only=False, errors='strict')\n+.. function:: force_unicode(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    Historical name of :func:`force_text`. Only available under Python 2.\n+\n+.. function:: smart_bytes(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    .. versionadded:: 1.5\n \n     Returns a bytestring version of ``s``, encoded as specified in\n     ``encoding``.\n \n     If ``strings_only`` is ``True``, don't convert (some) non-string-like\n     objects.\n \n+.. function:: smart_str(s, encoding='utf-8', strings_only=False, errors='strict')\n+\n+    Alias of :func:`smart_bytes` on Python 2 and :func:`smart_text` on Python\n+    3. This function always returns a :class:`str`.\n+\n+    For instance, this is  suitable for writing to :attr:`sys.stdout` on\n+    Python 2 and 3.\n+\n .. function:: iri_to_uri(iri)\n \n     Convert an Internationalized Resource Identifier (IRI) portion to a URI\n@@ -406,7 +434,7 @@ escaping HTML.\n \n     Returns the given text with ampersands, quotes and angle brackets encoded\n     for use in HTML. The input is first passed through\n-    :func:`~django.utils.encoding.force_unicode` and the output has\n+    :func:`~django.utils.encoding.force_text` and the output has\n     :func:`~django.utils.safestring.mark_safe` applied.\n \n .. function:: conditional_escape(text)\n@@ -448,7 +476,7 @@ escaping HTML.\n     interpolation, some of the formatting options provided by `str.format`_\n     (e.g. number formatting) will not work, since all arguments are passed\n     through :func:`conditional_escape` which (ultimately) calls\n-    :func:`~django.utils.encoding.force_unicode` on the values.\n+    :func:`~django.utils.encoding.force_text` on the values.\n \n \n .. _str.format: http://docs.python.org/library/stdtypes.html#str.format\n@@ -504,11 +532,13 @@ escaping HTML.\n \n .. function:: base36_to_int(s)\n \n-    Converts a base 36 string to an integer.\n+    Converts a base 36 string to an integer. On Python 2 the output is\n+    guaranteed to be an :class:`int` and not a :class:`long`.\n \n .. function:: int_to_base36(i)\n \n-    Converts a positive integer less than sys.maxint to a base 36 string.\n+    Converts a positive integer to a base 36 string. On Python 2 ``i`` must be\n+    smaller than :attr:`sys.maxint`.\n \n ``django.utils.safestring``\n ==========================="
        },
        {
            "sha": "f789ebde40deaf3f80aae27e9a78bcfe00511405",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -107,7 +107,7 @@ Django 1.5 also includes several smaller improvements worth noting:\n   connect to more than one signal by supplying a list of signals.\n \n * :meth:`QuerySet.bulk_create()\n-  <django.db.models.query.QuerySet.bulk_create>` has now a batch_size\n+  <django.db.models.query.QuerySet.bulk_create>` now has a batch_size\n   argument. By default the batch_size is unlimited except for SQLite where\n   single batch is limited so that 999 parameters per query isn't exceeded.\n \n@@ -161,7 +161,7 @@ If you have written a :ref:`custom password hasher <auth_password_storage>`,\n your ``encode()``, ``verify()`` or ``safe_summary()`` methods should accept\n Unicode parameters (``password``, ``salt`` or ``encoded``). If any of the\n hashing methods need byte strings, you can use the\n-:func:`~django.utils.encoding.smart_str` utility to encode the strings.\n+:func:`~django.utils.encoding.smart_bytes` utility to encode the strings.\n \n Validation of previous_page_number and next_page_number\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n@@ -239,11 +239,24 @@ database state behind or unit tests that rely on some form of state being\n preserved after the execution of other tests. Such tests are already very\n fragile, and must now be changed to be able to run independently.\n \n+`cleaned_data` dictionary kept for invalid forms\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+The :attr:`~django.forms.Form.cleaned_data` dictionary is now always present\n+after form validation. When the form doesn't validate, it contains only the\n+fields that passed validation. You should test the success of the validation\n+with the :meth:`~django.forms.Form.is_valid()` method and not with the\n+presence or absence of the :attr:`~django.forms.Form.cleaned_data` attribute\n+on the form.\n+\n Miscellaneous\n ~~~~~~~~~~~~~\n \n * GeoDjango dropped support for GDAL < 1.5\n \n+* :func:`~django.utils.http.int_to_base36` properly raises a :exc:`TypeError`\n+  instead of :exc:`ValueError` for non-integer inputs.\n+\n Features deprecated in 1.5\n ==========================\n "
        },
        {
            "sha": "307691bd4ae8d263185725e645edbbe88265c53f",
            "filename": "docs/topics/auth.txt",
            "status": "modified",
            "additions": 50,
            "deletions": 34,
            "changes": 84,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fauth.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fauth.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fauth.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -98,12 +98,13 @@ Fields\n \n         This doesn't necessarily control whether or not the user can log in.\n         Authentication backends aren't required to check for the ``is_active``\n-        flag, so if you want to reject a login based on ``is_active`` being\n-        ``False``, it's up to you to check that in your own login view.\n-        However, the :class:`~django.contrib.auth.forms.AuthenticationForm`\n-        used by the :func:`~django.contrib.auth.views.login` view *does*\n-        perform this check, as do the permission-checking methods such as\n-        :meth:`~models.User.has_perm` and the authentication in the Django\n+        flag, and the default backends do not. If you want to reject a login\n+        based on ``is_active`` being ``False``, it's up to you to check that in\n+        your own login view or a custom authentication backend. However, the\n+        :class:`~django.contrib.auth.forms.AuthenticationForm` used by the\n+        :func:`~django.contrib.auth.views.login` view (which is the default)\n+        *does* perform this check, as do the permission-checking methods such\n+        as :meth:`~models.User.has_perm` and the authentication in the Django\n         admin. All of those functions/methods will return ``False`` for\n         inactive users.\n \n@@ -1447,10 +1448,10 @@ The permission_required decorator\n \n .. currentmodule:: django.contrib.auth\n \n-Limiting access to generic views\n---------------------------------\n+Applying permissions to generic views\n+-------------------------------------\n \n-To limit access to a :doc:`class-based generic view \n+To apply a permission to a :doc:`class-based generic view\n </ref/class-based-views/index>`, decorate the :meth:`View.dispatch\n <django.views.generic.base.View.dispatch>` method on the class. See\n :ref:`decorating-class-based-views` for details.\n@@ -1476,12 +1477,13 @@ The Django admin site uses permissions as follows:\n * Access to delete an object is limited to users with the \"delete\"\n   permission for that type of object.\n \n-Permissions are set globally per type of object, not per specific object\n-instance. For example, it's possible to say \"Mary may change news stories,\" but\n-it's not currently possible to say \"Mary may change news stories, but only the\n-ones she created herself\" or \"Mary may only change news stories that have a\n-certain status, publication date or ID.\" The latter functionality is something\n-Django developers are currently discussing.\n+Permissions can be set not only per type of object, but also per specific\n+object instance. By using the\n+:meth:`~django.contrib.admin.ModelAdmin.has_add_permission`,\n+:meth:`~django.contrib.admin.ModelAdmin.has_change_permission` and\n+:meth:`~django.contrib.admin.ModelAdmin.has_delete_permission` methods provided\n+by the :class:`~django.contrib.admin.ModelAdmin` class, it is possible to\n+customize permissions for different object instances of the same type.\n \n Default permissions\n -------------------\n@@ -1747,7 +1749,11 @@ By default, :setting:`AUTHENTICATION_BACKENDS` is set to::\n \n     ('django.contrib.auth.backends.ModelBackend',)\n \n-That's the basic authentication scheme that checks the Django users database.\n+That's the basic authentication backend that checks the Django users database\n+and queries the builtin permissions. It does not provide protection against\n+brute force attacks via any rate limiting mechanism. You may either implement\n+your own rate limiting mechanism in a custom auth backend, or use the\n+mechanisms provided by most Web servers.\n \n The order of :setting:`AUTHENTICATION_BACKENDS` matters, so if the same\n username and password is valid in multiple backends, Django will stop\n@@ -1767,8 +1773,9 @@ processing at the first positive match.\n Writing an authentication backend\n ---------------------------------\n \n-An authentication backend is a class that implements two methods:\n-``get_user(user_id)`` and ``authenticate(**credentials)``.\n+An authentication backend is a class that implements two required methods:\n+``get_user(user_id)`` and ``authenticate(**credentials)``, as well as a set of\n+optional permission related :ref:`authorization methods <authorization_methods>`.\n \n The ``get_user`` method takes a ``user_id`` -- which could be a username,\n database ID or whatever -- and returns a ``User`` object.\n@@ -1837,6 +1844,8 @@ object the first time a user authenticates::\n             except User.DoesNotExist:\n                 return None\n \n+.. _authorization_methods:\n+\n Handling authorization in custom backends\n -----------------------------------------\n \n@@ -1867,13 +1876,16 @@ fairly simply::\n                 return False\n \n This gives full permissions to the user granted access in the above example.\n-Notice that the backend auth functions all take the user object as an argument,\n-and they also accept the same arguments given to the associated\n-:class:`django.contrib.auth.models.User` functions.\n+Notice that in addition to the same arguments given to the associated\n+:class:`django.contrib.auth.models.User` functions, the backend auth functions\n+all take the user object, which may be an anonymous user, as an argument.\n \n-A full authorization implementation can be found in\n-`django/contrib/auth/backends.py`_, which is the default backend and queries\n-the ``auth_permission`` table most of the time.\n+A full authorization implementation can be found in the ``ModelBackend`` class\n+in `django/contrib/auth/backends.py`_, which is the default backend and queries\n+the ``auth_permission`` table most of the time. If you wish to provide\n+custom behavior for only part of the backend API, you can take advantage of\n+Python inheritence and subclass ``ModelBackend`` instead of implementing the\n+complete API in a custom backend.\n \n .. _django/contrib/auth/backends.py: https://github.com/django/django/blob/master/django/contrib/auth/backends.py\n \n@@ -1889,35 +1901,39 @@ authorize anonymous users to browse most of the site, and many allow anonymous\n posting of comments etc.\n \n Django's permission framework does not have a place to store permissions for\n-anonymous users. However, it has a foundation that allows custom authentication\n-backends to specify authorization for anonymous users. This is especially useful\n-for the authors of re-usable apps, who can delegate all questions of authorization\n-to the auth backend, rather than needing settings, for example, to control\n-anonymous access.\n+anonymous users. However, the user object passed to an authentication backend\n+may be an :class:`django.contrib.auth.models.AnonymousUser` object, allowing\n+the backend to specify custom authorization behavior for anonymous users. This\n+is especially useful for the authors of re-usable apps, who can delegate all\n+questions of authorization to the auth backend, rather than needing settings,\n+for example, to control anonymous access.\n \n+.. _inactive_auth:\n \n Authorization for inactive users\n ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n-.. versionadded:: 1.3\n+.. versionchanged:: 1.3\n \n An inactive user is a one that is authenticated but has its attribute\n ``is_active`` set to ``False``. However this does not mean they are not\n authorized to do anything. For example they are allowed to activate their\n account.\n \n-The support for anonymous users in the permission system allows for\n-anonymous users to have permissions to do something while inactive\n+The support for anonymous users in the permission system allows for a scenario\n+where anonymous users have permissions to do something while inactive\n authenticated users do not.\n \n Do not forget to test for the ``is_active`` attribute of the user in your own\n backend permission methods.\n \n \n Handling object permissions\n----------------------------\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n Django's permission framework has a foundation for object permissions, though\n there is no implementation for it in the core. That means that checking for\n object permissions will always return ``False`` or an empty list (depending on\n-the check performed).\n+the check performed). An authentication backend will receive the keyword\n+parameters ``obj`` and ``user_obj`` for each object related authorization\n+method and can return the object level permission as appropriate."
        },
        {
            "sha": "219b6c77957c503cec4187dc98e26e10f4043909",
            "filename": "docs/topics/cache.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fcache.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fcache.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fcache.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -595,7 +595,8 @@ the ``cache`` template tag. To give your template access to this tag, put\n \n The ``{% cache %}`` template tag caches the contents of the block for a given\n amount of time. It takes at least two arguments: the cache timeout, in seconds,\n-and the name to give the cache fragment. For example:\n+and the name to give the cache fragment. The name will be taken as is, do not\n+use a variable. For example:\n \n .. code-block:: html+django\n \n@@ -863,7 +864,7 @@ key version to provide a final cache key. By default, the three parts\n are joined using colons to produce a final string::\n \n     def make_key(key, key_prefix, version):\n-        return ':'.join([key_prefix, str(version), smart_str(key)])\n+        return ':'.join([key_prefix, str(version), smart_bytes(key)])\n \n If you want to combine the parts in different ways, or apply other\n processing to the final key (e.g., taking a hash digest of the key"
        },
        {
            "sha": "1ac70e6938c610c774f7f2ea2754f1468f9db23c",
            "filename": "docs/topics/class-based-views/index.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fclass-based-views%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fclass-based-views%2Findex.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -87,7 +87,7 @@ Where class based views shine is when you want to do the same thing many times.\n Suppose you're writing an API, and every view should return JSON instead of\n rendered HTML.\n \n-We can use create a mixin class to use in all of our views, handling the\n+We can create a mixin class to use in all of our views, handling the\n conversion to JSON once.\n \n For example, a simple JSON mixin might look something like this::"
        },
        {
            "sha": "772792d39d98dd2e3d8ccf605d1c468c70584e81",
            "filename": "docs/topics/db/optimization.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fdb%2Foptimization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fdb%2Foptimization.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -230,7 +230,7 @@ It is optimal because:\n #. Use of :ttag:`with` means that we store ``user.emails.all`` in a variable\n    for later use, allowing its cache to be re-used.\n \n-#. The line ``{% if emails %}`` causes ``QuerySet.__nonzero__()`` to be called,\n+#. The line ``{% if emails %}`` causes ``QuerySet.__bool__()`` to be called,\n    which causes the ``user.emails.all()`` query to be run on the database, and\n    at the least the first line to be turned into an ORM object. If there aren't\n    any results, it will return False, otherwise True."
        },
        {
            "sha": "0ca37745c7c140dc1ba4788a9b64544061a9f013",
            "filename": "docs/topics/forms/modelforms.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmodelforms.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -437,6 +437,10 @@ parameter when declaring the form field::\n             class Meta:\n                 model = Article\n \n+    You must ensure that the type of the form field can be used to set the\n+    contents of the corresponding model field. When they are not compatible,\n+    you will get a ``ValueError`` as no implicit conversion takes place.\n+\n     See the :doc:`form field documentation </ref/forms/fields>` for more information\n     on fields and their arguments.\n "
        },
        {
            "sha": "b09164769e41fe5dff4140101dc08d3d287590d5",
            "filename": "docs/topics/i18n/formatting.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fi18n%2Fformatting.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fi18n%2Fformatting.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Fformatting.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -21,7 +21,10 @@ necessary to set :setting:`USE_L10N = True <USE_L10N>` in your settings file.\n \n     The default :file:`settings.py` file created by :djadmin:`django-admin.py\n     startproject <startproject>` includes :setting:`USE_L10N = True <USE_L10N>`\n-    for convenience.\n+    for convenience.  Note, however, that to enable number formatting with\n+    thousand separators it is necessary to set :setting:`USE_THOUSAND_SEPARATOR\n+    = True <USE_THOUSAND_SEPARATOR>` in your settings file. Alternatively, you\n+    could use :tfilter:`intcomma` to format numbers in your template.\n \n .. note::\n "
        },
        {
            "sha": "bdbb04823d51a9b7295d5744a791a2e51d804dd3",
            "filename": "docs/topics/i18n/translation.txt",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fi18n%2Ftranslation.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fi18n%2Ftranslation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fi18n%2Ftranslation.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1247,6 +1247,12 @@ Activate this view by adding the following line to your URLconf::\n \n (Note that this example makes the view available at ``/i18n/setlang/``.)\n \n+.. warning::\n+\n+    Make sure that you don't include the above URL within\n+    :func:`~django.conf.urls.i18n.i18n_patterns` - it needs to be\n+    language-independent itself to work correctly.\n+\n The view expects to be called via the ``POST`` method, with a ``language``\n parameter set in request. If session support is enabled, the view\n saves the language choice in the user's session. Otherwise, it saves the\n@@ -1266,7 +1272,7 @@ Here's example HTML template code:\n \n .. code-block:: html+django\n \n-    <form action=\"/i18n/setlang/\" method=\"post\">\n+    <form action=\"{% url 'set_language' %}\" method=\"post\">\n     {% csrf_token %}\n     <input name=\"next\" type=\"hidden\" value=\"{{ redirect_to }}\" />\n     <select name=\"language\">"
        },
        {
            "sha": "b09c1d23478314ea0aa7cc66395b65e399eda749",
            "filename": "docs/topics/python3.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fpython3.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fpython3.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fpython3.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -36,6 +36,11 @@ In order to enable the same behavior in Python 2, every module must import\n     my_string = \"This is an unicode literal\"\n     my_bytestring = b\"This is a bytestring\"\n \n+If you need a byte string under Python 2 and a unicode string under Python 3,\n+use the :func:`str` builtin::\n+\n+    str('my string')\n+\n Be cautious if you have to `slice bytestrings`_.\n \n .. _slice bytestrings: http://docs.python.org/py3k/howto/pyporting.html#bytes-literals"
        },
        {
            "sha": "ac1a77ed98776c8044f91dd2a2df6f11e83db783",
            "filename": "docs/topics/serialization.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fserialization.txt",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/docs%2Ftopics%2Fserialization.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fserialization.txt?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -173,12 +173,12 @@ In particular, :ref:`lazy translation objects <lazy-translations>` need a\n \n     import json\n     from django.utils.functional import Promise\n-    from django.utils.encoding import force_unicode\n+    from django.utils.encoding import force_text\n \n     class LazyEncoder(json.JSONEncoder):\n         def default(self, obj):\n             if isinstance(obj, Promise):\n-                return force_unicode(obj)\n+                return force_text(obj)\n             return super(LazyEncoder, self).default(obj)\n \n .. _special encoder: http://docs.python.org/library/json.html#encoders-and-decoders"
        },
        {
            "sha": "0d4ff98aa76947d3cabf56960367cccbc17ef334",
            "filename": "tests/modeltests/field_subclassing/fields.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Ffields.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,7 @@\n import json\n \n from django.db import models\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.utils import six\n \n \n@@ -16,7 +16,7 @@ def __init__(self, first, second):\n         self.first, self.second = first, second\n \n     def __unicode__(self):\n-        return '%s%s' % (force_unicode(self.first), force_unicode(self.second))\n+        return '%s%s' % (force_text(self.first), force_text(self.second))\n \n     def __str__(self):\n         return six.text_type(self).encode('utf-8')\n@@ -46,9 +46,9 @@ def get_db_prep_save(self, value, connection):\n \n     def get_prep_lookup(self, lookup_type, value):\n         if lookup_type == 'exact':\n-            return force_unicode(value)\n+            return force_text(value)\n         if lookup_type == 'in':\n-            return [force_unicode(v) for v in value]\n+            return [force_text(v) for v in value]\n         if lookup_type == 'isnull':\n             return []\n         raise TypeError('Invalid lookup type: %r' % lookup_type)"
        },
        {
            "sha": "2df9664cdc04f6a78764c075f3aff5a86722b7fc",
            "filename": "tests/modeltests/field_subclassing/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ffield_subclassing%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ffield_subclassing%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffield_subclassing%2Fmodels.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,7 +5,7 @@\n from __future__ import absolute_import\n \n from django.db import models\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n from .fields import SmallField, SmallerField, JSONField\n \n@@ -15,7 +15,7 @@ class MyModel(models.Model):\n     data = SmallField('small field')\n \n     def __unicode__(self):\n-        return force_unicode(self.name)\n+        return force_text(self.name)\n \n class OtherModel(models.Model):\n     data = SmallerField()"
        },
        {
            "sha": "b3323484252e271f46a84ddff1a3124d2488c337",
            "filename": "tests/modeltests/fixtures/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ffixtures%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ffixtures%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,11 +1,10 @@\n from __future__ import absolute_import\n \n-import StringIO\n-\n from django.contrib.sites.models import Site\n from django.core import management\n from django.db import connection, IntegrityError\n from django.test import TestCase, TransactionTestCase, skipUnlessDBFeature\n+from django.utils.six import StringIO\n \n from .models import Article, Book, Spy, Tag, Visa\n \n@@ -26,7 +25,7 @@ class FixtureLoadingTests(TestCase):\n \n     def _dumpdata_assert(self, args, output, format='json', natural_keys=False,\n                          use_base_manager=False, exclude_list=[]):\n-        new_io = StringIO.StringIO()\n+        new_io = StringIO()\n         management.call_command('dumpdata', *args, **{'format':format,\n                                                       'stdout':new_io,\n                                                       'stderr':new_io,\n@@ -43,7 +42,7 @@ def test_initial_data(self):\n         ])\n \n     def test_loading_and_dumping(self):\n-        new_io = StringIO.StringIO()\n+        new_io = StringIO()\n \n         Site.objects.all().delete()\n         # Load fixture 1. Single JSON file, with two objects.\n@@ -293,7 +292,7 @@ def test_output_formats(self):\n \n class FixtureTransactionTests(TransactionTestCase):\n     def _dumpdata_assert(self, args, output, format='json'):\n-        new_io = StringIO.StringIO()\n+        new_io = StringIO()\n         management.call_command('dumpdata', *args, **{'format':format, 'stdout':new_io})\n         command_output = new_io.getvalue().strip()\n         self.assertEqual(command_output, output)"
        },
        {
            "sha": "1da7f583be4df3e7990f5bebbc444767ec8e44c6",
            "filename": "tests/modeltests/model_forms/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fmodel_forms%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -638,8 +638,7 @@ def test_with_data(self):\n         f = BaseCategoryForm({'name': '', 'slug': 'not a slug!', 'url': 'foo'})\n         self.assertEqual(f.errors['name'], ['This field is required.'])\n         self.assertEqual(f.errors['slug'], [\"Enter a valid 'slug' consisting of letters, numbers, underscores or hyphens.\"])\n-        with self.assertRaises(AttributeError):\n-            f.cleaned_data\n+        self.assertEqual(f.cleaned_data, {'url': 'foo'})\n         with self.assertRaises(ValueError):\n             f.save()\n         f = BaseCategoryForm({'name': '', 'slug': '', 'url': 'foo'})"
        },
        {
            "sha": "ec3cc132db4bad14d29170b229f75557392b8c93",
            "filename": "tests/modeltests/serializers/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fserializers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fserializers%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,13 +4,13 @@\n import json\n from datetime import datetime\n from xml.dom import minidom\n-from StringIO import StringIO\n \n from django.conf import settings\n from django.core import serializers\n from django.db import transaction, connection\n from django.test import TestCase, TransactionTestCase, Approximate\n from django.utils import six\n+from django.utils.six import StringIO\n from django.utils import unittest\n \n from .models import (Category, Author, Article, AuthorProfile, Actor, Movie,"
        },
        {
            "sha": "a38e4b3f753f4ce2150b5cea43aadbd03227d22b",
            "filename": "tests/modeltests/timezones/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Ftimezones%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Ftimezones%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -20,6 +20,7 @@\n from django.template import Context, RequestContext, Template, TemplateSyntaxError\n from django.test import TestCase, skipIfDBFeature, skipUnlessDBFeature\n from django.test.utils import override_settings\n+from django.utils import six\n from django.utils import timezone\n from django.utils.tzinfo import FixedOffset\n from django.utils.unittest import skipIf, skipUnless\n@@ -690,8 +691,8 @@ def t(*result):\n             }\n         }\n \n-        for k1, dt in datetimes.iteritems():\n-            for k2, tpl in templates.iteritems():\n+        for k1, dt in six.iteritems(datetimes):\n+            for k2, tpl in six.iteritems(templates):\n                 ctx = Context({'dt': dt, 'ICT': ICT})\n                 actual = tpl.render(ctx)\n                 expected = results[k1][k2]\n@@ -703,8 +704,8 @@ def t(*result):\n         results['ict']['notag'] = t('ict', 'eat', 'utc', 'ict')\n \n         with self.settings(USE_TZ=False):\n-            for k1, dt in datetimes.iteritems():\n-                for k2, tpl in templates.iteritems():\n+            for k1, dt in six.iteritems(datetimes):\n+                for k2, tpl in six.iteritems(templates):\n                     ctx = Context({'dt': dt, 'ICT': ICT})\n                     actual = tpl.render(ctx)\n                     expected = results[k1][k2]"
        },
        {
            "sha": "d25911c09fc9a9342552c353e142c0179624a602",
            "filename": "tests/modeltests/user_commands/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fuser_commands%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fuser_commands%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fuser_commands%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,10 +1,10 @@\n import sys\n-from StringIO import StringIO\n \n from django.core import management\n from django.core.management.base import CommandError\n from django.test import TestCase\n from django.utils import translation\n+from django.utils.six import StringIO\n \n \n class CommandTests(TestCase):"
        },
        {
            "sha": "26fff4b8638cf96f2db9773d4f4874a582bc00df",
            "filename": "tests/modeltests/validation/models.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fvalidation%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fmodeltests%2Fvalidation%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Fvalidation%2Fmodels.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -101,6 +101,6 @@ class GenericIPAddrUnpackUniqueTest(models.Model):\n     class MultipleAutoFields(models.Model):\n         auto1 = models.AutoField(primary_key=True)\n         auto2 = models.AutoField(primary_key=True)\n-except AssertionError as assertion_error:\n-    pass # Fail silently\n+except AssertionError as exc:\n+    assertion_error = exc\n assert str(assertion_error) == \"A model can't have more than one AutoField.\""
        },
        {
            "sha": "b92c2f4c8bdddd2cfe20d682656389e594196e62",
            "filename": "tests/regressiontests/admin_filters/tests.py",
            "status": "modified",
            "additions": 30,
            "deletions": 30,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_filters%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -10,7 +10,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n from .models import Book, Department, Employee\n \n@@ -160,7 +160,7 @@ def test_datefieldlistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][4]\n-        self.assertEqual(force_unicode(filterspec.title), 'date registered')\n+        self.assertEqual(force_text(filterspec.title), 'date registered')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"Today\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?date_registered__gte=%s'\n@@ -181,7 +181,7 @@ def test_datefieldlistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][4]\n-        self.assertEqual(force_unicode(filterspec.title), 'date registered')\n+        self.assertEqual(force_text(filterspec.title), 'date registered')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"This month\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?date_registered__gte=%s'\n@@ -202,7 +202,7 @@ def test_datefieldlistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][4]\n-        self.assertEqual(force_unicode(filterspec.title), 'date registered')\n+        self.assertEqual(force_text(filterspec.title), 'date registered')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"This year\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?date_registered__gte=%s'\n@@ -219,7 +219,7 @@ def test_datefieldlistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][4]\n-        self.assertEqual(force_unicode(filterspec.title), 'date registered')\n+        self.assertEqual(force_text(filterspec.title), 'date registered')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"Past 7 days\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?date_registered__gte=%s'\n@@ -243,7 +243,7 @@ def test_allvaluesfieldlistfilter(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'year')\n+        self.assertEqual(force_text(filterspec.title), 'year')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?year__isnull=True')\n@@ -253,7 +253,7 @@ def test_allvaluesfieldlistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'year')\n+        self.assertEqual(force_text(filterspec.title), 'year')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[2]['selected'], True)\n         self.assertEqual(choices[2]['query_string'], '?year=2002')\n@@ -270,7 +270,7 @@ def test_relatedfieldlistfilter_foreignkey(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'Verbose Author')\n+        self.assertEqual(force_text(filterspec.title), 'Verbose Author')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?author__isnull=True')\n@@ -280,7 +280,7 @@ def test_relatedfieldlistfilter_foreignkey(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'Verbose Author')\n+        self.assertEqual(force_text(filterspec.title), 'Verbose Author')\n         # order of choices depends on User model, which has no order\n         choice = select_by(filterspec.choices(changelist), \"display\", \"alfred\")\n         self.assertEqual(choice['selected'], True)\n@@ -298,7 +298,7 @@ def test_relatedfieldlistfilter_manytomany(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][2]\n-        self.assertEqual(force_unicode(filterspec.title), 'Verbose Contributors')\n+        self.assertEqual(force_text(filterspec.title), 'Verbose Contributors')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?contributors__isnull=True')\n@@ -308,7 +308,7 @@ def test_relatedfieldlistfilter_manytomany(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][2]\n-        self.assertEqual(force_unicode(filterspec.title), 'Verbose Contributors')\n+        self.assertEqual(force_text(filterspec.title), 'Verbose Contributors')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"bob\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?contributors__id__exact=%d' % self.bob.pk)\n@@ -326,7 +326,7 @@ def test_relatedfieldlistfilter_reverse_relationships(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'book')\n+        self.assertEqual(force_text(filterspec.title), 'book')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?books_authored__isnull=True')\n@@ -336,7 +336,7 @@ def test_relatedfieldlistfilter_reverse_relationships(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'book')\n+        self.assertEqual(force_text(filterspec.title), 'book')\n         choice = select_by(filterspec.choices(changelist), \"display\", self.bio_book.title)\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?books_authored__id__exact=%d' % self.bio_book.pk)\n@@ -351,7 +351,7 @@ def test_relatedfieldlistfilter_reverse_relationships(self):\n \n         # Make sure the last choice is None and is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'book')\n+        self.assertEqual(force_text(filterspec.title), 'book')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[-1]['selected'], True)\n         self.assertEqual(choices[-1]['query_string'], '?books_contributed__isnull=True')\n@@ -361,7 +361,7 @@ def test_relatedfieldlistfilter_reverse_relationships(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'book')\n+        self.assertEqual(force_text(filterspec.title), 'book')\n         choice = select_by(filterspec.choices(changelist), \"display\", self.django_book.title)\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?books_contributed__id__exact=%d' % self.django_book.pk)\n@@ -387,7 +387,7 @@ def verify_booleanfieldlistfilter(self, modeladmin):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][3]\n-        self.assertEqual(force_unicode(filterspec.title), 'is best seller')\n+        self.assertEqual(force_text(filterspec.title), 'is best seller')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"No\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?is_best_seller__exact=0')\n@@ -401,7 +401,7 @@ def verify_booleanfieldlistfilter(self, modeladmin):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][3]\n-        self.assertEqual(force_unicode(filterspec.title), 'is best seller')\n+        self.assertEqual(force_text(filterspec.title), 'is best seller')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"Yes\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?is_best_seller__exact=1')\n@@ -415,7 +415,7 @@ def verify_booleanfieldlistfilter(self, modeladmin):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][3]\n-        self.assertEqual(force_unicode(filterspec.title), 'is best seller')\n+        self.assertEqual(force_text(filterspec.title), 'is best seller')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"Unknown\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?is_best_seller__isnull=True')\n@@ -434,7 +434,7 @@ def test_simplelistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[0]['display'], 'All')\n         self.assertEqual(choices[0]['selected'], True)\n@@ -451,7 +451,7 @@ def test_simplelistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[1]['display'], 'the 1980\\'s')\n         self.assertEqual(choices[1]['selected'], True)\n@@ -468,7 +468,7 @@ def test_simplelistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[2]['display'], 'the 1990\\'s')\n         self.assertEqual(choices[2]['selected'], True)\n@@ -485,7 +485,7 @@ def test_simplelistfilter(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[3]['display'], 'the 2000\\'s')\n         self.assertEqual(choices[3]['selected'], True)\n@@ -502,14 +502,14 @@ def test_simplelistfilter(self):\n \n         # Make sure the correct choices are selected\n         filterspec = changelist.get_filters(request)[0][1]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[3]['display'], 'the 2000\\'s')\n         self.assertEqual(choices[3]['selected'], True)\n         self.assertEqual(choices[3]['query_string'], '?publication-decade=the+00s&author__id__exact=%s' % self.alfred.pk)\n \n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'Verbose Author')\n+        self.assertEqual(force_text(filterspec.title), 'Verbose Author')\n         choice = select_by(filterspec.choices(changelist), \"display\", \"alfred\")\n         self.assertEqual(choice['selected'], True)\n         self.assertEqual(choice['query_string'], '?publication-decade=the+00s&author__id__exact=%s' % self.alfred.pk)\n@@ -561,7 +561,7 @@ def test_simplelistfilter_with_queryset_based_lookups(self):\n         changelist = self.get_changelist(request, Book, modeladmin)\n \n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(len(choices), 3)\n \n@@ -591,7 +591,7 @@ def test_two_characters_long_field(self):\n         self.assertEqual(list(queryset), [self.bio_book])\n \n         filterspec = changelist.get_filters(request)[0][-1]\n-        self.assertEqual(force_unicode(filterspec.title), 'number')\n+        self.assertEqual(force_text(filterspec.title), 'number')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[2]['selected'], True)\n         self.assertEqual(choices[2]['query_string'], '?no=207')\n@@ -614,7 +614,7 @@ def test_parameter_ends_with__in__or__isnull(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[2]['display'], 'the 1990\\'s')\n         self.assertEqual(choices[2]['selected'], True)\n@@ -631,7 +631,7 @@ def test_parameter_ends_with__in__or__isnull(self):\n \n         # Make sure the correct choice is selected\n         filterspec = changelist.get_filters(request)[0][0]\n-        self.assertEqual(force_unicode(filterspec.title), 'publication decade')\n+        self.assertEqual(force_text(filterspec.title), 'publication decade')\n         choices = list(filterspec.choices(changelist))\n         self.assertEqual(choices[2]['display'], 'the 1990\\'s')\n         self.assertEqual(choices[2]['selected'], True)\n@@ -657,7 +657,7 @@ def test_fk_with_to_field(self):\n         self.assertEqual(list(queryset), [jack, john])\n \n         filterspec = changelist.get_filters(request)[0][-1]\n-        self.assertEqual(force_unicode(filterspec.title), 'department')\n+        self.assertEqual(force_text(filterspec.title), 'department')\n         choices = list(filterspec.choices(changelist))\n \n         self.assertEqual(choices[0]['display'], 'All')\n@@ -682,7 +682,7 @@ def test_fk_with_to_field(self):\n         self.assertEqual(list(queryset), [john])\n \n         filterspec = changelist.get_filters(request)[0][-1]\n-        self.assertEqual(force_unicode(filterspec.title), 'department')\n+        self.assertEqual(force_text(filterspec.title), 'department')\n         choices = list(filterspec.choices(changelist))\n \n         self.assertEqual(choices[0]['display'], 'All')"
        },
        {
            "sha": "293ddfebf6a70825ee471638cbc87889bbefcadb",
            "filename": "tests/regressiontests/admin_views/admin.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_views%2Fadmin.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -630,7 +630,7 @@ def change_view(self, *args, **kwargs):\n #     related OneToOne object registered in admin\n #     related OneToOne object not registered in admin\n # when deleting Book so as exercise all four troublesome (w.r.t escaping\n-# and calling force_unicode to avoid problems on Python 2.3) paths through\n+# and calling force_text to avoid problems on Python 2.3) paths through\n # contrib.admin.util's get_deleted_objects function.\n site.register(Book, inlines=[ChapterInline])\n site.register(Promo)"
        },
        {
            "sha": "e24eb43b87c9e56bd1136ec6857e01da1cb977dc",
            "filename": "tests/regressiontests/aggregation_regress/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Faggregation_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Faggregation_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Faggregation_regress%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -8,6 +8,7 @@\n from django.core.exceptions import FieldError\n from django.db.models import Count, Max, Avg, Sum, StdDev, Variance, F, Q\n from django.test import TestCase, Approximate, skipUnlessDBFeature\n+from django.utils import six\n \n from .models import Author, Book, Publisher, Clues, Entries, HardbackBook\n \n@@ -16,7 +17,7 @@ class AggregationTests(TestCase):\n     fixtures = [\"aggregation_regress.json\"]\n \n     def assertObjectAttrs(self, obj, **kwargs):\n-        for attr, value in kwargs.iteritems():\n+        for attr, value in six.iteritems(kwargs):\n             self.assertEqual(getattr(obj, attr), value)\n \n     def test_aggregates_in_where_clause(self):"
        },
        {
            "sha": "ed8cedf1ab5511b9099d9b177f7e9a1e4a662c9f",
            "filename": "tests/regressiontests/bash_completion/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fbash_completion%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fbash_completion%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbash_completion%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,11 +3,11 @@\n \"\"\"\n import os\n import sys\n-import StringIO\n \n from django.conf import settings\n from django.core.management import ManagementUtility\n from django.utils import unittest\n+from django.utils.six import StringIO\n \n \n class BashCompletionTests(unittest.TestCase):\n@@ -20,7 +20,7 @@ class BashCompletionTests(unittest.TestCase):\n     def setUp(self):\n         self.old_DJANGO_AUTO_COMPLETE = os.environ.get('DJANGO_AUTO_COMPLETE')\n         os.environ['DJANGO_AUTO_COMPLETE'] = '1'\n-        self.output = StringIO.StringIO()\n+        self.output = StringIO()\n         self.old_stdout = sys.stdout\n         sys.stdout = self.output\n "
        },
        {
            "sha": "4a3b44176bcc02fb72cc81ecb183f5b376a38fd3",
            "filename": "tests/regressiontests/builtin_server/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fbuiltin_server%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fbuiltin_server%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fbuiltin_server%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,6 +1,5 @@\n-from StringIO import StringIO\n-\n from django.core.servers.basehttp import ServerHandler\n+from django.utils.six import StringIO\n from django.utils.unittest import TestCase\n \n #"
        },
        {
            "sha": "8fc749aaa27a67d8817fb095f56ee5e212f52fc7",
            "filename": "tests/regressiontests/cache/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fcache%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcache%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -28,7 +28,7 @@\n from django.utils import timezone, translation, unittest\n from django.utils.cache import (patch_vary_headers, get_cache_key,\n     learn_cache_key, patch_cache_control, patch_response_headers)\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n from django.views.decorators.cache import cache_page\n \n from .models import Poll, expensive_calculation\n@@ -1307,7 +1307,7 @@ def test_cache_key_i18n_timezone(self):\n         request = self._get_request()\n         # This is tightly coupled to the implementation,\n         # but it's the most straightforward way to test the key.\n-        tz = force_unicode(timezone.get_current_timezone_name(), errors='ignore')\n+        tz = force_text(timezone.get_current_timezone_name(), errors='ignore')\n         tz = tz.encode('ascii', 'ignore').replace(' ', '_')\n         response = HttpResponse()\n         key = learn_cache_key(request, response)\n@@ -1319,7 +1319,7 @@ def test_cache_key_i18n_timezone(self):\n     def test_cache_key_no_i18n (self):\n         request = self._get_request()\n         lang = translation.get_language()\n-        tz = force_unicode(timezone.get_current_timezone_name(), errors='ignore')\n+        tz = force_text(timezone.get_current_timezone_name(), errors='ignore')\n         tz = tz.encode('ascii', 'ignore').replace(' ', '_')\n         response = HttpResponse()\n         key = learn_cache_key(request, response)"
        },
        {
            "sha": "7303b1f2e7993cdfed969b16d26fa940add48b3d",
            "filename": "tests/regressiontests/createsuperuser/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fcreatesuperuser%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fcreatesuperuser%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcreatesuperuser%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,9 +1,8 @@\n-from StringIO import StringIO\n-\n from django.contrib.auth import models\n from django.contrib.auth.management.commands import changepassword\n from django.core.management import call_command\n from django.test import TestCase\n+from django.utils.six import StringIO\n \n \n class MultiDBChangepasswordManagementCommandTestCase(TestCase):"
        },
        {
            "sha": "2cf835d94e996e04f88b4d0bb9313ffd03524b8b",
            "filename": "tests/regressiontests/db_typecasts/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fdb_typecasts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fdb_typecasts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdb_typecasts%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,6 +3,7 @@\n import datetime\n \n from django.db.backends import util as typecasts\n+from django.utils import six\n from django.utils import unittest\n \n \n@@ -49,7 +50,7 @@\n \n class DBTypeCasts(unittest.TestCase):\n     def test_typeCasts(self):\n-        for k, v in TEST_CASES.iteritems():\n+        for k, v in six.iteritems(TEST_CASES):\n             for inpt, expected in v:\n                 got = getattr(typecasts, k)(inpt)\n                 self.assertEqual(got, expected, \"In %s: %r doesn't match %r. Got %r instead.\" % (k, inpt, expected, got))"
        },
        {
            "sha": "d2362d71978e7c167897547c622e81ba5199b193",
            "filename": "tests/regressiontests/file_uploads/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ffile_uploads%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,12 +7,12 @@\n import json\n import os\n import shutil\n-from StringIO import StringIO\n \n from django.core.files import temp as tempfile\n from django.core.files.uploadedfile import SimpleUploadedFile\n from django.http.multipartparser import MultiPartParser\n from django.test import TestCase, client\n+from django.utils.six import StringIO\n from django.utils import unittest\n \n from . import uploadhandler"
        },
        {
            "sha": "e0e62858d0241c702b43efdde1f45dbc8df8fa1b",
            "filename": "tests/regressiontests/forms/tests/extra.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fextra.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -9,7 +9,7 @@\n from django.forms.util import ErrorList\n from django.test import TestCase\n from django.utils import translation\n-from django.utils.encoding import force_unicode, smart_unicode\n+from django.utils.encoding import force_text, smart_text\n \n from .error_messages import AssertFormErrorsMixin\n \n@@ -551,7 +551,7 @@ def test_generic_ipaddress_normalization(self):\n         f = GenericIPAddressField(unpack_ipv4=True)\n         self.assertEqual(f.clean('::ffff:0a0a:0a0a'), '10.10.10.10')\n \n-    def test_smart_unicode(self):\n+    def test_smart_text(self):\n         class Test:\n             def __str__(self):\n                return 'ลฤฤลฝฤลพลกฤ'.encode('utf-8')\n@@ -562,10 +562,10 @@ def __str__(self):\n             def __unicode__(self):\n                return '\\u0160\\u0110\\u0106\\u017d\\u0107\\u017e\\u0161\\u0111'\n \n-        self.assertEqual(smart_unicode(Test()), '\\u0160\\u0110\\u0106\\u017d\\u0107\\u017e\\u0161\\u0111')\n-        self.assertEqual(smart_unicode(TestU()), '\\u0160\\u0110\\u0106\\u017d\\u0107\\u017e\\u0161\\u0111')\n-        self.assertEqual(smart_unicode(1), '1')\n-        self.assertEqual(smart_unicode('foo'), 'foo')\n+        self.assertEqual(smart_text(Test()), '\\u0160\\u0110\\u0106\\u017d\\u0107\\u017e\\u0161\\u0111')\n+        self.assertEqual(smart_text(TestU()), '\\u0160\\u0110\\u0106\\u017d\\u0107\\u017e\\u0161\\u0111')\n+        self.assertEqual(smart_text(1), '1')\n+        self.assertEqual(smart_text('foo'), 'foo')\n \n     def test_accessing_clean(self):\n         class UserForm(Form):\n@@ -591,7 +591,7 @@ def __unicode__(self):\n \n             def as_divs(self):\n                 if not self: return ''\n-                return '<div class=\"errorlist\">%s</div>' % ''.join(['<div class=\"error\">%s</div>' % force_unicode(e) for e in self])\n+                return '<div class=\"errorlist\">%s</div>' % ''.join(['<div class=\"error\">%s</div>' % force_text(e) for e in self])\n \n         class CommentForm(Form):\n             name = CharField(max_length=50, required=False)"
        },
        {
            "sha": "a8a28ba8060e834bcf28875f12afabe607986b12",
            "filename": "tests/regressiontests/forms/tests/forms.py",
            "status": "modified",
            "additions": 4,
            "deletions": 20,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fforms%2Ftests%2Fforms.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -82,11 +82,7 @@ def test_empty_dict(self):\n         self.assertEqual(p.errors['last_name'], ['This field is required.'])\n         self.assertEqual(p.errors['birthday'], ['This field is required.'])\n         self.assertFalse(p.is_valid())\n-        try:\n-            p.cleaned_data\n-            self.fail('Attempts to access cleaned_data when validation fails should fail.')\n-        except AttributeError:\n-            pass\n+        self.assertEqual(p.cleaned_data, {})\n         self.assertHTMLEqual(str(p), \"\"\"<tr><th><label for=\"id_first_name\">First name:</label></th><td><ul class=\"errorlist\"><li>This field is required.</li></ul><input type=\"text\" name=\"first_name\" id=\"id_first_name\" /></td></tr>\n <tr><th><label for=\"id_last_name\">Last name:</label></th><td><ul class=\"errorlist\"><li>This field is required.</li></ul><input type=\"text\" name=\"last_name\" id=\"id_last_name\" /></td></tr>\n <tr><th><label for=\"id_birthday\">Birthday:</label></th><td><ul class=\"errorlist\"><li>This field is required.</li></ul><input type=\"text\" name=\"birthday\" id=\"id_birthday\" /></td></tr>\"\"\")\n@@ -145,11 +141,7 @@ def test_unicode_values(self):\n   * This field is required.\n * birthday\n   * This field is required.\"\"\")\n-        try:\n-            p.cleaned_data\n-            self.fail('Attempts to access cleaned_data when validation fails should fail.')\n-        except AttributeError:\n-            pass\n+        self.assertEqual(p.cleaned_data, {'last_name': 'Lennon'})\n         self.assertEqual(p['first_name'].errors, ['This field is required.'])\n         self.assertHTMLEqual(p['first_name'].errors.as_ul(), '<ul class=\"errorlist\"><li>This field is required.</li></ul>')\n         self.assertEqual(p['first_name'].errors.as_text(), '* This field is required.')\n@@ -1678,11 +1670,7 @@ class SongForm(Form):\n         form = SongForm(data, empty_permitted=False)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.errors, {'name': ['This field is required.'], 'artist': ['This field is required.']})\n-        try:\n-            form.cleaned_data\n-            self.fail('Attempts to access cleaned_data when validation fails should fail.')\n-        except AttributeError:\n-            pass\n+        self.assertEqual(form.cleaned_data, {})\n \n         # Now let's show what happens when empty_permitted=True and the form is empty.\n         form = SongForm(data, empty_permitted=True)\n@@ -1696,11 +1684,7 @@ class SongForm(Form):\n         form = SongForm(data, empty_permitted=False)\n         self.assertFalse(form.is_valid())\n         self.assertEqual(form.errors, {'name': ['This field is required.']})\n-        try:\n-            form.cleaned_data\n-            self.fail('Attempts to access cleaned_data when validation fails should fail.')\n-        except AttributeError:\n-            pass\n+        self.assertEqual(form.cleaned_data, {'artist': 'The Doors'})\n \n         # If a field is not given in the data then None is returned for its data. Lets\n         # make sure that when checking for empty_permitted that None is treated"
        },
        {
            "sha": "0f61c2d840228d45d26dea0ad6a327bf746b045d",
            "filename": "tests/regressiontests/httpwrappers/tests.py",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fhttpwrappers%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,8 +4,11 @@\n import copy\n import pickle\n \n-from django.http import (QueryDict, HttpResponse, SimpleCookie, BadHeaderError,\n-        parse_cookie)\n+from django.core.exceptions import SuspiciousOperation\n+from django.http import (QueryDict, HttpResponse, HttpResponseRedirect,\n+                         HttpResponsePermanentRedirect,\n+                         SimpleCookie, BadHeaderError,\n+                         parse_cookie)\n from django.utils import unittest\n \n \n@@ -309,6 +312,18 @@ def test_file_interface(self):\n         r = HttpResponse(['abc'])\n         self.assertRaises(Exception, r.write, 'def')\n \n+    def test_unsafe_redirect(self):\n+        bad_urls = [\n+            'data:text/html,<script>window.alert(\"xss\")</script>',\n+            'mailto:test@example.com',\n+            'file:///etc/passwd',\n+        ]\n+        for url in bad_urls:\n+            self.assertRaises(SuspiciousOperation,\n+                              HttpResponseRedirect, url)\n+            self.assertRaises(SuspiciousOperation,\n+                              HttpResponsePermanentRedirect, url)\n+\n \n class CookieTests(unittest.TestCase):\n     def test_encode(self):"
        },
        {
            "sha": "b6119cf43d4e58201306b6fa9788abe0da29556b",
            "filename": "tests/regressiontests/i18n/commands/compilation.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fcompilation.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,10 +1,10 @@\n import os\n-from io import BytesIO\n \n from django.core.management import call_command, CommandError\n from django.test import TestCase\n from django.test.utils import override_settings\n from django.utils import translation\n+from django.utils.six import StringIO\n \n test_dir = os.path.abspath(os.path.dirname(__file__))\n \n@@ -26,7 +26,7 @@ def test_bom_rejection(self):\n         os.chdir(test_dir)\n         with self.assertRaisesRegexp(CommandError,\n                 \"file has a BOM \\(Byte Order Mark\\)\"):\n-            call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n+            call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n         self.assertFalse(os.path.exists(self.MO_FILE))\n \n \n@@ -42,7 +42,7 @@ def setUp(self):\n \n     def test_percent_symbol_in_po_file(self):\n         os.chdir(test_dir)\n-        call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n+        call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n         self.assertTrue(os.path.exists(self.MO_FILE))\n \n \n@@ -57,7 +57,7 @@ class PercentRenderingTests(MessageCompilationTests):\n     def test_percent_symbol_escaping(self):\n         from django.template import Template, Context\n         os.chdir(test_dir)\n-        call_command('compilemessages', locale=self.LOCALE, stderr=BytesIO())\n+        call_command('compilemessages', locale=self.LOCALE, stderr=StringIO())\n         with translation.override(self.LOCALE):\n             t = Template('{% load i18n %}{% trans \"Looks like a str fmt spec %% o but shouldn\\'t be interpreted as such\" %}')\n             rendered = t.render(Context({}))"
        },
        {
            "sha": "29d9e277ff1cc9df9a765d081ba5efdde4b4cffd",
            "filename": "tests/regressiontests/i18n/commands/extraction.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fi18n%2Fcommands%2Fextraction.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,10 +3,10 @@\n import os\n import re\n import shutil\n-from StringIO import StringIO\n \n from django.core import management\n from django.test import TestCase\n+from django.utils.six import StringIO\n \n \n LOCALE='de'"
        },
        {
            "sha": "aae7bc5cc7bb668668b3990d0af088e9fa9caf67",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,7 +1,6 @@\n-from StringIO import StringIO\n-\n from django.core.management import call_command\n from django.test import TestCase, skipUnlessDBFeature\n+from django.utils.six import StringIO\n \n \n class InspectDBTestCase(TestCase):"
        },
        {
            "sha": "c948662bc34bb830a76491abee69a89a2cfbc8d3",
            "filename": "tests/regressiontests/mail/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 25,
            "changes": 54,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmail%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmail%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -7,7 +7,6 @@\n import shutil\n import smtpd\n import sys\n-from StringIO import StringIO\n import tempfile\n import threading\n \n@@ -18,6 +17,7 @@\n from django.core.mail.message import BadHeaderError\n from django.test import TestCase\n from django.test.utils import override_settings\n+from django.utils.six import PY3, StringIO\n from django.utils.translation import ugettext_lazy\n \n \n@@ -29,15 +29,15 @@ class MailTests(TestCase):\n     def test_ascii(self):\n         email = EmailMessage('Subject', 'Content', 'from@example.com', ['to@example.com'])\n         message = email.message()\n-        self.assertEqual(message['Subject'].encode(), 'Subject')\n+        self.assertEqual(message['Subject'], 'Subject')\n         self.assertEqual(message.get_payload(), 'Content')\n         self.assertEqual(message['From'], 'from@example.com')\n         self.assertEqual(message['To'], 'to@example.com')\n \n     def test_multiple_recipients(self):\n         email = EmailMessage('Subject', 'Content', 'from@example.com', ['to@example.com', 'other@example.com'])\n         message = email.message()\n-        self.assertEqual(message['Subject'].encode(), 'Subject')\n+        self.assertEqual(message['Subject'], 'Subject')\n         self.assertEqual(message.get_payload(), 'Content')\n         self.assertEqual(message['From'], 'from@example.com')\n         self.assertEqual(message['To'], 'to@example.com, other@example.com')\n@@ -77,9 +77,10 @@ def test_space_continuation(self):\n         \"\"\"\n         Test for space continuation character in long (ascii) subject headers (#7747)\n         \"\"\"\n-        email = EmailMessage('Long subject lines that get wrapped should use a space continuation character to get expected behavior in Outlook and Thunderbird', 'Content', 'from@example.com', ['to@example.com'])\n+        email = EmailMessage('Long subject lines that get wrapped should contain a space continuation character to get expected behavior in Outlook and Thunderbird', 'Content', 'from@example.com', ['to@example.com'])\n         message = email.message()\n-        self.assertEqual(message['Subject'], 'Long subject lines that get wrapped should use a space continuation\\n character to get expected behavior in Outlook and Thunderbird')\n+        # Note that in Python 3, maximum line length has increased from 76 to 78\n+        self.assertEqual(message['Subject'].encode(), b'Long subject lines that get wrapped should contain a space continuation\\n character to get expected behavior in Outlook and Thunderbird')\n \n     def test_message_header_overrides(self):\n         \"\"\"\n@@ -88,7 +89,7 @@ def test_message_header_overrides(self):\n         \"\"\"\n         headers = {\"date\": \"Fri, 09 Nov 2001 01:08:47 -0000\", \"Message-ID\": \"foo\"}\n         email = EmailMessage('subject', 'content', 'from@example.com', ['to@example.com'], headers=headers)\n-        self.assertEqual(email.message().as_string(), b'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: subject\\nFrom: from@example.com\\nTo: to@example.com\\ndate: Fri, 09 Nov 2001 01:08:47 -0000\\nMessage-ID: foo\\n\\ncontent')\n+        self.assertEqual(email.message().as_string(), 'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: subject\\nFrom: from@example.com\\nTo: to@example.com\\ndate: Fri, 09 Nov 2001 01:08:47 -0000\\nMessage-ID: foo\\n\\ncontent')\n \n     def test_from_header(self):\n         \"\"\"\n@@ -160,7 +161,7 @@ def test_safe_mime_multipart(self):\n         msg.attach_alternative(html_content, \"text/html\")\n         msg.encoding = 'iso-8859-1'\n         self.assertEqual(msg.message()['To'], '=?iso-8859-1?q?S=FCrname=2C_Firstname?= <to@example.com>')\n-        self.assertEqual(msg.message()['Subject'].encode(), '=?iso-8859-1?q?Message_from_Firstname_S=FCrname?=')\n+        self.assertEqual(msg.message()['Subject'], '=?iso-8859-1?q?Message_from_Firstname_S=FCrname?=')\n \n     def test_encoding(self):\n         \"\"\"\n@@ -170,7 +171,7 @@ def test_encoding(self):\n         email = EmailMessage('Subject', 'Firstname Sรผrname is a great guy.', 'from@example.com', ['other@example.com'])\n         email.encoding = 'iso-8859-1'\n         message = email.message()\n-        self.assertTrue(message.as_string().startswith(b'Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\nSubject: Subject\\nFrom: from@example.com\\nTo: other@example.com'))\n+        self.assertTrue(message.as_string().startswith('Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\nSubject: Subject\\nFrom: from@example.com\\nTo: other@example.com'))\n         self.assertEqual(message.get_payload(), 'Firstname S=FCrname is a great guy.')\n \n         # Make sure MIME attachments also works correctly with other encodings than utf-8\n@@ -179,8 +180,8 @@ def test_encoding(self):\n         msg = EmailMultiAlternatives('Subject', text_content, 'from@example.com', ['to@example.com'])\n         msg.encoding = 'iso-8859-1'\n         msg.attach_alternative(html_content, \"text/html\")\n-        self.assertEqual(msg.message().get_payload(0).as_string(), b'Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\nFirstname S=FCrname is a great guy.')\n-        self.assertEqual(msg.message().get_payload(1).as_string(), b'Content-Type: text/html; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\n<p>Firstname S=FCrname is a <strong>great</strong> guy.</p>')\n+        self.assertEqual(msg.message().get_payload(0).as_string(), 'Content-Type: text/plain; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\nFirstname S=FCrname is a great guy.')\n+        self.assertEqual(msg.message().get_payload(1).as_string(), 'Content-Type: text/html; charset=\"iso-8859-1\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: quoted-printable\\n\\n<p>Firstname S=FCrname is a <strong>great</strong> guy.</p>')\n \n     def test_attachments(self):\n         \"\"\"Regression test for #9367\"\"\"\n@@ -291,31 +292,31 @@ def test_dont_mangle_from_in_body(self):\n         # Regression for #13433 - Make sure that EmailMessage doesn't mangle\n         # 'From ' in message body.\n         email = EmailMessage('Subject', 'From the future', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n-        self.assertFalse(b'>From the future' in email.message().as_string())\n+        self.assertFalse('>From the future' in email.message().as_string())\n \n     def test_dont_base64_encode(self):\n         # Ticket #3472\n         # Shouldn't use Base64 encoding at all\n         msg = EmailMessage('Subject', 'UTF-8 encoded body', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n-        self.assertFalse(b'Content-Transfer-Encoding: base64' in msg.message().as_string())\n+        self.assertFalse('Content-Transfer-Encoding: base64' in msg.message().as_string())\n \n         # Ticket #11212\n         # Shouldn't use quoted printable, should detect it can represent content with 7 bit data\n         msg = EmailMessage('Subject', 'Body with only ASCII characters.', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n         s = msg.message().as_string()\n-        self.assertFalse(b'Content-Transfer-Encoding: quoted-printable' in s)\n-        self.assertTrue(b'Content-Transfer-Encoding: 7bit' in s)\n+        self.assertFalse('Content-Transfer-Encoding: quoted-printable' in s)\n+        self.assertTrue('Content-Transfer-Encoding: 7bit' in s)\n \n         # Shouldn't use quoted printable, should detect it can represent content with 8 bit data\n         msg = EmailMessage('Subject', 'Body with latin characters: รรกรค.', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n         s = msg.message().as_string()\n-        self.assertFalse(b'Content-Transfer-Encoding: quoted-printable' in s)\n-        self.assertTrue(b'Content-Transfer-Encoding: 8bit' in s)\n+        self.assertFalse(str('Content-Transfer-Encoding: quoted-printable') in s)\n+        self.assertTrue(str('Content-Transfer-Encoding: 8bit') in s)\n \n         msg = EmailMessage('Subject', 'Body with non latin characters: ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ ะ.', 'bounce@example.com', ['to@example.com'], headers={'From': 'from@example.com'})\n         s = msg.message().as_string()\n-        self.assertFalse(b'Content-Transfer-Encoding: quoted-printable' in s)\n-        self.assertTrue(b'Content-Transfer-Encoding: 8bit' in s)\n+        self.assertFalse(str('Content-Transfer-Encoding: quoted-printable') in s)\n+        self.assertTrue(str('Content-Transfer-Encoding: 8bit') in s)\n \n \n class BaseEmailBackendTests(object):\n@@ -440,7 +441,7 @@ def test_message_cc_header(self):\n         email = EmailMessage('Subject', 'Content', 'from@example.com', ['to@example.com'], cc=['cc@example.com'])\n         mail.get_connection().send_messages([email])\n         message = self.get_the_message()\n-        self.assertStartsWith(message.as_string(), b'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: Subject\\nFrom: from@example.com\\nTo: to@example.com\\nCc: cc@example.com\\nDate: ')\n+        self.assertStartsWith(message.as_string(), 'Content-Type: text/plain; charset=\"utf-8\"\\nMIME-Version: 1.0\\nContent-Transfer-Encoding: 7bit\\nSubject: Subject\\nFrom: from@example.com\\nTo: to@example.com\\nCc: cc@example.com\\nDate: ')\n \n     def test_idn_send(self):\n         \"\"\"\n@@ -519,9 +520,9 @@ def flush_mailbox(self):\n     def get_mailbox_content(self):\n         messages = []\n         for filename in os.listdir(self.tmp_dir):\n-            with open(os.path.join(self.tmp_dir, filename), 'rb') as fp:\n-                session = fp.read().split(b'\\n' + (b'-' * 79) + b'\\n')\n-            messages.extend(email.message_from_string(m) for m in session if m)\n+            with open(os.path.join(self.tmp_dir, filename), 'r') as fp:\n+                session = fp.read().split('\\n' + ('-' * 79) + '\\n')\n+            messages.extend(email.message_from_string(str(m)) for m in session if m)\n         return messages\n \n     def test_file_sessions(self):\n@@ -571,8 +572,8 @@ def flush_mailbox(self):\n         self.stream = sys.stdout = StringIO()\n \n     def get_mailbox_content(self):\n-        messages = self.stream.getvalue().split(b'\\n' + (b'-' * 79) + b'\\n')\n-        return [email.message_from_string(m) for m in messages if m]\n+        messages = self.stream.getvalue().split('\\n' + ('-' * 79) + '\\n')\n+        return [email.message_from_string(str(m)) for m in messages if m]\n \n     def test_console_stream_kwarg(self):\n         \"\"\"\n@@ -600,7 +601,10 @@ def __init__(self, *args, **kwargs):\n \n     def process_message(self, peer, mailfrom, rcpttos, data):\n         m = email.message_from_string(data)\n-        maddr = email.Utils.parseaddr(m.get('from'))[1]\n+        if PY3:\n+            maddr = email.utils.parseaddr(m.get('from'))[1]\n+        else:\n+            maddr = email.Utils.parseaddr(m.get('from'))[1]\n         if mailfrom != maddr:\n             return \"553 '%s' != '%s'\" % (mailfrom, maddr)\n         with self.sink_lock:"
        },
        {
            "sha": "08a385e6cfd5c2ad482a9d3c02f70d1ad0059a84",
            "filename": "tests/regressiontests/middleware/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmiddleware%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmiddleware%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,7 +3,6 @@\n import gzip\n import re\n import random\n-import StringIO\n \n from django.conf import settings\n from django.core import mail\n@@ -16,6 +15,7 @@\n from django.test import TestCase, RequestFactory\n from django.test.utils import override_settings\n from django.utils.six.moves import xrange\n+from django.utils.six import StringIO\n \n class CommonMiddlewareTest(TestCase):\n     def setUp(self):\n@@ -526,7 +526,7 @@ def setUp(self):\n \n     @staticmethod\n     def decompress(gzipped_string):\n-        return gzip.GzipFile(mode='rb', fileobj=StringIO.StringIO(gzipped_string)).read()\n+        return gzip.GzipFile(mode='rb', fileobj=StringIO(gzipped_string)).read()\n \n     def test_compress_response(self):\n         \"\"\""
        },
        {
            "sha": "7d6071accc3057e5d11ae64379a3d9c841bdca73",
            "filename": "tests/regressiontests/model_fields/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmodel_fields%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmodel_fields%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_fields%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -274,6 +274,10 @@ def test_integerfield_raises_error_on_empty_input(self):\n         self.assertRaises(ValidationError, f.clean, None, None)\n         self.assertRaises(ValidationError, f.clean, '', None)\n \n+    def test_integerfield_validates_zero_against_choices(self):\n+        f = models.IntegerField(choices=((1, 1),))\n+        self.assertRaises(ValidationError, f.clean, '0', None)\n+\n     def test_charfield_raises_error_on_empty_input(self):\n         f = models.CharField(null=False)\n         self.assertRaises(ValidationError, f.clean, None, None)"
        },
        {
            "sha": "74a5f2f550fdff5b346fcfe4d1a4d071597fe92e",
            "filename": "tests/regressiontests/multiple_database/tests.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmultiple_database%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fmultiple_database%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmultiple_database%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -2,7 +2,7 @@\n \n import datetime\n import pickle\n-from StringIO import StringIO\n+from operator import attrgetter\n \n from django.conf import settings\n from django.contrib.auth.models import User\n@@ -11,6 +11,7 @@\n from django.db import connections, router, DEFAULT_DB_ALIAS\n from django.db.models import signals\n from django.test import TestCase\n+from django.utils.six import StringIO\n \n from .models import Book, Person, Pet, Review, UserProfile\n \n@@ -873,10 +874,10 @@ def test_raw(self):\n         dive = Book.objects.using('other').create(title=\"Dive into Python\",\n             published=datetime.date(2009, 5, 4))\n         val = Book.objects.db_manager(\"other\").raw('SELECT id FROM multiple_database_book')\n-        self.assertEqual(map(lambda o: o.pk, val), [dive.pk])\n+        self.assertQuerysetEqual(val, [dive.pk], attrgetter(\"pk\"))\n \n         val = Book.objects.raw('SELECT id FROM multiple_database_book').using('other')\n-        self.assertEqual(map(lambda o: o.pk, val), [dive.pk])\n+        self.assertQuerysetEqual(val, [dive.pk], attrgetter(\"pk\"))\n \n     def test_select_related(self):\n         \"Database assignment is retained if an object is retrieved with select_related()\""
        },
        {
            "sha": "f1924592468659776a0bd701fb35de86aa72aadb",
            "filename": "tests/regressiontests/requests/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Frequests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Frequests%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -3,14 +3,14 @@\n import time\n import warnings\n from datetime import datetime, timedelta\n-from StringIO import StringIO\n \n from django.conf import settings\n from django.core.handlers.wsgi import WSGIRequest, LimitedStream\n from django.http import HttpRequest, HttpResponse, parse_cookie, build_request_repr, UnreadablePostError\n from django.test.utils import str_prefix\n from django.utils import unittest\n from django.utils.http import cookie_date\n+from django.utils.six import StringIO\n from django.utils.timezone import utc\n \n "
        },
        {
            "sha": "2368405060e6930dd1e7716f4e59f5aad6f7e6e6",
            "filename": "tests/regressiontests/signing/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fsigning%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fsigning%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fsigning%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -4,7 +4,7 @@\n \n from django.core import signing\n from django.test import TestCase\n-from django.utils.encoding import force_unicode\n+from django.utils.encoding import force_text\n \n \n class TestSigner(TestCase):\n@@ -48,7 +48,7 @@ def test_sign_unsign(self):\n         )\n         for example in examples:\n             self.assertNotEqual(\n-                force_unicode(example), force_unicode(signer.sign(example)))\n+                force_text(example), force_text(signer.sign(example)))\n             self.assertEqual(example, signer.unsign(signer.sign(example)))\n \n     def unsign_detects_tampering(self):"
        },
        {
            "sha": "19951f100ba06605104a7e425a88c2ad5fd0326e",
            "filename": "tests/regressiontests/staticfiles_tests/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fstaticfiles_tests%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -17,7 +17,7 @@\n from django.core.management import call_command\n from django.test import TestCase\n from django.test.utils import override_settings\n-from django.utils.encoding import smart_unicode\n+from django.utils.encoding import smart_text\n from django.utils.functional import empty\n from django.utils._os import rmtree_errorhandler\n from django.utils import six\n@@ -80,7 +80,7 @@ def tearDown(self):\n         os.unlink(self._backup_filepath)\n \n     def assertFileContains(self, filepath, text):\n-        self.assertIn(text, self._get_file(smart_unicode(filepath)),\n+        self.assertIn(text, self._get_file(smart_text(filepath)),\n                         \"'%s' not in '%s'\" % (text, filepath))\n \n     def assertFileNotFound(self, filepath):\n@@ -199,7 +199,7 @@ def _get_file(self, filepath):\n         out.seek(0)\n         lines = [l.strip() for l in out.readlines()]\n         contents = codecs.open(\n-            smart_unicode(lines[1].strip()), \"r\", \"utf-8\").read()\n+            smart_text(lines[1].strip()), \"r\", \"utf-8\").read()\n         return contents\n \n     def test_all_files(self):"
        },
        {
            "sha": "6b635c8f239d9302846eba39cee95d115133f046",
            "filename": "tests/regressiontests/templates/loaders.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftemplates%2Floaders.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftemplates%2Floaders.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Floaders.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -12,13 +12,13 @@\n import sys\n import pkg_resources\n import imp\n-import StringIO\n import os.path\n \n from django.template import TemplateDoesNotExist, Context\n from django.template.loaders.eggs import Loader as EggLoader\n from django.template import loader\n from django.utils import unittest\n+from django.utils.six import StringIO\n \n \n # Mock classes and objects for pkg_resources functions.\n@@ -61,8 +61,8 @@ def setUp(self):\n \n         self.empty_egg = create_egg(\"egg_empty\", {})\n         self.egg_1 = create_egg(\"egg_1\", {\n-            os.path.normcase('templates/y.html') : StringIO.StringIO(\"y\"),\n-            os.path.normcase('templates/x.txt') : StringIO.StringIO(\"x\"),\n+            os.path.normcase('templates/y.html') : StringIO(\"y\"),\n+            os.path.normcase('templates/x.txt') : StringIO(\"x\"),\n         })\n         self._old_installed_apps = settings.INSTALLED_APPS\n         settings.INSTALLED_APPS = []"
        },
        {
            "sha": "3f513538801c1525e746b08e7a40b98d119c603a",
            "filename": "tests/regressiontests/templates/templatetags/custom.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fcustom.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fcustom.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftemplatetags%2Fcustom.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -70,7 +70,7 @@ def simple_only_unlimited_args(*args):\n def simple_unlimited_args_kwargs(one, two='hi', *args, **kwargs):\n     \"\"\"Expected simple_unlimited_args_kwargs __doc__\"\"\"\n     # Sort the dictionary by key to guarantee the order for testing.\n-    sorted_kwarg = sorted(kwargs.iteritems(), key=operator.itemgetter(0))\n+    sorted_kwarg = sorted(six.iteritems(kwargs), key=operator.itemgetter(0))\n     return \"simple_unlimited_args_kwargs - Expected result: %s / %s\" % (\n         ', '.join([six.text_type(arg) for arg in [one, two] + list(args)]),\n         ', '.join(['%s=%s' % (k, v) for (k, v) in sorted_kwarg])\n@@ -221,7 +221,7 @@ def inclusion_tag_use_l10n(context):\n def inclusion_unlimited_args_kwargs(one, two='hi', *args, **kwargs):\n     \"\"\"Expected inclusion_unlimited_args_kwargs __doc__\"\"\"\n     # Sort the dictionary by key to guarantee the order for testing.\n-    sorted_kwarg = sorted(kwargs.iteritems(), key=operator.itemgetter(0))\n+    sorted_kwarg = sorted(six.iteritems(kwargs), key=operator.itemgetter(0))\n     return {\"result\": \"inclusion_unlimited_args_kwargs - Expected result: %s / %s\" % (\n         ', '.join([six.text_type(arg) for arg in [one, two] + list(args)]),\n         ', '.join(['%s=%s' % (k, v) for (k, v) in sorted_kwarg])\n@@ -292,7 +292,7 @@ def assignment_only_unlimited_args(*args):\n def assignment_unlimited_args_kwargs(one, two='hi', *args, **kwargs):\n     \"\"\"Expected assignment_unlimited_args_kwargs __doc__\"\"\"\n     # Sort the dictionary by key to guarantee the order for testing.\n-    sorted_kwarg = sorted(kwargs.iteritems(), key=operator.itemgetter(0))\n+    sorted_kwarg = sorted(six.iteritems(kwargs), key=operator.itemgetter(0))\n     return \"assignment_unlimited_args_kwargs - Expected result: %s / %s\" % (\n         ', '.join([six.text_type(arg) for arg in [one, two] + list(args)]),\n         ', '.join(['%s=%s' % (k, v) for (k, v) in sorted_kwarg])"
        },
        {
            "sha": "edbb21b6bd81aefc6fba1e281909ba93296404bf",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -30,6 +30,7 @@\n from django.utils.formats import date_format\n from django.utils.translation import activate, deactivate, ugettext as _\n from django.utils.safestring import mark_safe\n+from django.utils import six\n from django.utils.tzinfo import LocalTimezone\n \n from .callables import CallableVariablesTests\n@@ -402,7 +403,7 @@ def test_templates(self):\n         template_tests.update(filter_tests)\n \n         cache_loader = setup_test_template_loader(\n-            dict([(name, t[0]) for name, t in template_tests.iteritems()]),\n+            dict([(name, t[0]) for name, t in six.iteritems(template_tests)]),\n             use_cached_loader=True,\n         )\n "
        },
        {
            "sha": "f43a855a5900dffeb818587d4b9d8eea9c182985",
            "filename": "tests/regressiontests/test_utils/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Ftest_utils%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_utils%2Ftests.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -493,7 +493,7 @@ class MyCustomField(IntegerField):\n # Standard doctests do fairly\n >>> import json\n >>> from django.utils.xmlutils import SimplerXMLGenerator\n->>> from StringIO import StringIO\n+>>> from django.utils.six import StringIO\n \n >>> def produce_long():\n ...     return 42L"
        },
        {
            "sha": "cc413b4e8e0f47533f417bfb7267f004fca6ca2a",
            "filename": "tests/regressiontests/utils/baseconv.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fbaseconv.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fbaseconv.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fbaseconv.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,10 +1,11 @@\n from unittest import TestCase\n from django.utils.baseconv import base2, base16, base36, base56, base62, base64, BaseConverter\n+from django.utils.six.moves import xrange\n \n class TestBaseConv(TestCase):\n \n     def test_baseconv(self):\n-        nums = [-10 ** 10, 10 ** 10] + range(-100, 100)\n+        nums = [-10 ** 10, 10 ** 10] + list(xrange(-100, 100))\n         for converter in [base2, base16, base36, base56, base62, base64]:\n             for i in nums:\n                 self.assertEqual(i, converter.decode(converter.encode(i)))"
        },
        {
            "sha": "52a286cb27e03e9699427f51f3b21ad864474717",
            "filename": "tests/regressiontests/utils/crypto.py",
            "status": "modified",
            "additions": 16,
            "deletions": 12,
            "changes": 28,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fcrypto.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,4 +1,6 @@\n+from __future__ import unicode_literals\n \n+import binascii\n import math\n import timeit\n import hashlib\n@@ -108,28 +110,30 @@ class TestUtilsCryptoPBKDF2(unittest.TestCase):\n                        \"c4007d5298f9033c0241d5ab69305e7b64eceeb8d\"\n                        \"834cfec\"),\n         },\n-        # Check leading zeros are not stripped (#17481) \n+        # Check leading zeros are not stripped (#17481)\n         {\n-            \"args\": { \n-                \"password\": chr(186), \n-                \"salt\": \"salt\", \n-                \"iterations\": 1, \n-                \"dklen\": 20, \n-                \"digest\": hashlib.sha1, \n-            }, \n+            \"args\": {\n+                \"password\": b'\\xba',\n+                \"salt\": \"salt\",\n+                \"iterations\": 1,\n+                \"dklen\": 20,\n+                \"digest\": hashlib.sha1,\n+            },\n             \"result\": '0053d3b91a7f1e54effebd6d68771e8a6e0b2c5b',\n         },\n     ]\n \n     def test_public_vectors(self):\n         for vector in self.rfc_vectors:\n             result = pbkdf2(**vector['args'])\n-            self.assertEqual(result.encode('hex'), vector['result'])\n+            self.assertEqual(binascii.hexlify(result).decode('ascii'),\n+                             vector['result'])\n \n     def test_regression_vectors(self):\n         for vector in self.regression_vectors:\n             result = pbkdf2(**vector['args'])\n-            self.assertEqual(result.encode('hex'), vector['result'])\n+            self.assertEqual(binascii.hexlify(result).decode('ascii'),\n+                             vector['result'])\n \n     def test_performance_scalability(self):\n         \"\"\"\n@@ -140,11 +144,11 @@ def test_performance_scalability(self):\n         # to run the test suite and false positives caused by imprecise\n         # measurement.\n         n1, n2 = 200000, 800000\n-        elapsed = lambda f: timeit.Timer(f, \n+        elapsed = lambda f: timeit.Timer(f,\n                     'from django.utils.crypto import pbkdf2').timeit(number=1)\n         t1 = elapsed('pbkdf2(\"password\", \"salt\", iterations=%d)' % n1)\n         t2 = elapsed('pbkdf2(\"password\", \"salt\", iterations=%d)' % n2)\n         measured_scale_exponent = math.log(t2 / t1, n2 / n1)\n-        # This should be less than 1. We allow up to 1.2 so that tests don't \n+        # This should be less than 1. We allow up to 1.2 so that tests don't\n         # fail nondeterministically too often.\n         self.assertLess(measured_scale_exponent, 1.2)"
        },
        {
            "sha": "4d503df026a4dc24d986820098936f06aa509e33",
            "filename": "tests/regressiontests/utils/decorators.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fdecorators.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fdecorators.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fdecorators.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -105,4 +105,4 @@ def template_response_view(request):\n         response.render()\n         self.assertTrue(getattr(request, 'process_response_reached', False))\n         # Check that process_response saw the rendered content\n-        self.assertEqual(request.process_response_content, \"Hello world\")\n+        self.assertEqual(request.process_response_content, b\"Hello world\")"
        },
        {
            "sha": "f22e05496da541b34a91ac3f48a3f834b5dc0f5d",
            "filename": "tests/regressiontests/utils/http.py",
            "status": "modified",
            "additions": 14,
            "deletions": 12,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fhttp.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -1,10 +1,11 @@\n import sys\n \n-from django.utils import http\n-from django.utils import unittest\n-from django.utils.datastructures import MultiValueDict\n from django.http import HttpResponse, utils\n from django.test import RequestFactory\n+from django.utils.datastructures import MultiValueDict\n+from django.utils import http\n+from django.utils import six\n+from django.utils import unittest\n \n class TestUtilsHttp(unittest.TestCase):\n \n@@ -110,22 +111,23 @@ def no_content_response_with_unsafe_content_type():\n \n     def test_base36(self):\n         # reciprocity works\n-        for n in [0, 1, 1000, 1000000, sys.maxint]:\n+        for n in [0, 1, 1000, 1000000]:\n             self.assertEqual(n, http.base36_to_int(http.int_to_base36(n)))\n+        if not six.PY3:\n+            self.assertEqual(sys.maxint, http.base36_to_int(http.int_to_base36(sys.maxint)))\n \n         # bad input\n-        for n in [-1, sys.maxint+1, '1', 'foo', {1:2}, (1,2,3)]:\n-            self.assertRaises(ValueError, http.int_to_base36, n)\n-        \n+        self.assertRaises(ValueError, http.int_to_base36, -1)\n+        if not six.PY3:\n+            self.assertRaises(ValueError, http.int_to_base36, sys.maxint + 1)\n+        for n in ['1', 'foo', {1: 2}, (1, 2, 3), 3.141]:\n+            self.assertRaises(TypeError, http.int_to_base36, n)\n+\n         for n in ['#', ' ']:\n             self.assertRaises(ValueError, http.base36_to_int, n)\n-\n-        for n in [123, {1:2}, (1,2,3)]:\n+        for n in [123, {1: 2}, (1, 2, 3), 3.141]:\n             self.assertRaises(TypeError, http.base36_to_int, n)\n \n-        # non-integer input\n-        self.assertRaises(TypeError, http.int_to_base36, 3.141)\n-        \n         # more explicit output testing\n         for n, b36 in [(0, '0'), (1, '1'), (42, '16'), (818469960, 'django')]:\n             self.assertEqual(http.int_to_base36(n), b36)"
        },
        {
            "sha": "3f81e8f6081cd082b2dc832941ca36ea6507b465",
            "filename": "tests/regressiontests/utils/simplelazyobject.py",
            "status": "modified",
            "additions": 18,
            "deletions": 8,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fsimplelazyobject.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Futils%2Fsimplelazyobject.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fsimplelazyobject.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -19,17 +19,27 @@ def __eq__(self, other):\n     def __hash__(self):\n         return hash(self.name)\n \n-    def __str__(self):\n-        return \"I am _ComplexObject(%r)\" % self.name\n+    if six.PY3:\n+        def __bytes__(self):\n+            return (\"I am _ComplexObject(%r)\" % self.name).encode(\"utf-8\")\n \n-    def __unicode__(self):\n-        return six.text_type(self.name)\n+        def __str__(self):\n+            return self.name\n+\n+    else:\n+        def __str__(self):\n+            return b\"I am _ComplexObject(%r)\" % str(self.name)\n+\n+        def __unicode__(self):\n+            return self.name\n \n     def __repr__(self):\n         return \"_ComplexObject(%r)\" % self.name\n \n+\n complex_object = lambda: _ComplexObject(\"joe\")\n \n+\n class TestUtilsSimpleLazyObject(TestCase):\n     \"\"\"\n     Tests for SimpleLazyObject\n@@ -54,11 +64,11 @@ def test_repr(self):\n         # proxy __repr__\n         self.assertTrue(\"SimpleLazyObject\" in repr(SimpleLazyObject(complex_object)))\n \n-    def test_str(self):\n-        self.assertEqual(str_prefix(\"I am _ComplexObject(%(_)s'joe')\"),\n-            str(SimpleLazyObject(complex_object)))\n+    def test_bytes(self):\n+        self.assertEqual(b\"I am _ComplexObject('joe')\",\n+                bytes(SimpleLazyObject(complex_object)))\n \n-    def test_unicode(self):\n+    def test_text(self):\n         self.assertEqual(\"joe\", six.text_type(SimpleLazyObject(complex_object)))\n \n     def test_class(self):"
        },
        {
            "sha": "cb580267d2c981f32cfe24489bdcfa32aed421b4",
            "filename": "tests/regressiontests/views/tests/i18n.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "raw_url": "https://github.com/django/django/raw/184cf9ab798d5b25d855649ddb2ca580949778df/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fi18n.py?ref=184cf9ab798d5b25d855649ddb2ca580949778df",
            "patch": "@@ -5,6 +5,7 @@\n from os import path\n \n from django.conf import settings\n+from django.core.urlresolvers import reverse\n from django.test import TestCase\n from django.utils.translation import override, activate, get_language\n from django.utils.text import javascript_quote\n@@ -23,6 +24,9 @@ def test_setlang(self):\n             self.assertRedirects(response, 'http://testserver/views/')\n             self.assertEqual(self.client.session['django_language'], lang_code)\n \n+    def test_setlang_reversal(self):\n+        self.assertEqual(reverse('set_language'), '/views/i18n/setlang/')\n+\n     def test_jsi18n(self):\n         \"\"\"The javascript_catalog can be deployed with language settings\"\"\"\n         saved_lang = get_language()"
        }
    ],
    "stats": {
        "total": 4270,
        "additions": 2523,
        "deletions": 1747
    }
}