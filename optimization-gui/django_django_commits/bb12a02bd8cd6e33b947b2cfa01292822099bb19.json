{
    "author": "spookylukey",
    "message": "Deprecated legacy ways of calling cache_page\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16338 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "bb12a02bd8cd6e33b947b2cfa01292822099bb19",
    "files": [
        {
            "sha": "a39cc54e3319afced08622d3282b45ecdd444803",
            "filename": "django/views/decorators/cache.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/bb12a02bd8cd6e33b947b2cfa01292822099bb19/django%2Fviews%2Fdecorators%2Fcache.py",
            "raw_url": "https://github.com/django/django/raw/bb12a02bd8cd6e33b947b2cfa01292822099bb19/django%2Fviews%2Fdecorators%2Fcache.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdecorators%2Fcache.py?ref=bb12a02bd8cd6e33b947b2cfa01292822099bb19",
            "patch": "@@ -39,8 +39,16 @@ def cache_page(*args, **kwargs):\n     cache_alias = kwargs.pop('cache', None)\n     key_prefix = kwargs.pop('key_prefix', None)\n     assert not kwargs, \"The only keyword arguments are cache and key_prefix\"\n+    def warn():\n+        import warnings\n+        warnings.warn('The cache_page decorator must be called like: '\n+                      'cache_page(timeout, [cache=cache name], [key_prefix=key prefix]). '\n+                      'All other ways are deprecated.',\n+                      PendingDeprecationWarning)\n+\n     if len(args) > 1:\n         assert len(args) == 2, \"cache_page accepts at most 2 arguments\"\n+        warn()\n         if callable(args[0]):\n             return decorator_from_middleware_with_args(CacheMiddleware)(cache_timeout=args[1], cache_alias=cache_alias, key_prefix=key_prefix)(args[0])\n         elif callable(args[1]):\n@@ -49,10 +57,13 @@ def cache_page(*args, **kwargs):\n             assert False, \"cache_page must be passed a view function if called with two arguments\"\n     elif len(args) == 1:\n         if callable(args[0]):\n+            warn()\n             return decorator_from_middleware_with_args(CacheMiddleware)(cache_alias=cache_alias, key_prefix=key_prefix)(args[0])\n         else:\n+            # The One True Way\n             return decorator_from_middleware_with_args(CacheMiddleware)(cache_timeout=args[0], cache_alias=cache_alias, key_prefix=key_prefix)\n     else:\n+        warn()\n         return decorator_from_middleware_with_args(CacheMiddleware)(cache_alias=cache_alias, key_prefix=key_prefix)\n \n "
        },
        {
            "sha": "131f813f83b3445a4437b95413c7945350d205c5",
            "filename": "docs/internals/deprecation.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/bb12a02bd8cd6e33b947b2cfa01292822099bb19/docs%2Finternals%2Fdeprecation.txt",
            "raw_url": "https://github.com/django/django/raw/bb12a02bd8cd6e33b947b2cfa01292822099bb19/docs%2Finternals%2Fdeprecation.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Finternals%2Fdeprecation.txt?ref=bb12a02bd8cd6e33b947b2cfa01292822099bb19",
            "patch": "@@ -207,6 +207,9 @@ their deprecation, as per the :ref:`Django deprecation policy\n           refactored to use class based views with pluggable backends in 1.4.\n           The previous implementation will be deprecated.\n \n+        * Legacy ways of calling\n+          :func:`~django.views.decorators.cache.cache_page` will be removed.\n+\n     * 2.0\n         * ``django.views.defaults.shortcut()``. This function has been moved\n           to ``django.contrib.contenttypes.views.shortcut()`` as part of the"
        },
        {
            "sha": "83ebaa738bd42dd3df7c05dedee27d22c0bbb17a",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/django/django/blob/bb12a02bd8cd6e33b947b2cfa01292822099bb19/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/bb12a02bd8cd6e33b947b2cfa01292822099bb19/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=bb12a02bd8cd6e33b947b2cfa01292822099bb19",
            "patch": "@@ -8,10 +8,14 @@ up-to-date information for those who are following trunk.\n \n Django 1.4 includes various `new features`_ and some minor `backwards\n incompatible changes`_. There are also some features that have been dropped,\n-which are detailed in :doc:`our deprecation plan </internals/deprecation>`.\n+which are detailed in :doc:`our deprecation plan </internals/deprecation>`, and\n+we've `begun the deprecation process for some features`_.\n+\n+\n \n .. _new features: `What's new in Django 1.4`_\n .. _backwards incompatible changes: backwards-incompatible-changes-1.4_\n+.. _begun the deprecation process for some features: deprecated-features-1.4_\n \n What's new in Django 1.4\n ========================\n@@ -283,4 +287,16 @@ If you using PUT or DELETE methods in AJAX applications, please see the\n \n This was an alias to ``django.template.loader`` since 2005, it has been removed\n without emitting a warning due to the length of the deprecation. If your code\n-still referenced this please use ``django.template.loader`` instead.\n\\ No newline at end of file\n+still referenced this please use ``django.template.loader`` instead.\n+\n+.. _deprecated-features-1.4:\n+\n+Features deprecated in 1.4\n+==========================\n+\n+Old styles of calling ``cache_page`` decorator\n+~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Some legacy ways of calling :func:`~django.views.decorators.cache.cache_page`\n+have been deprecated, please see the docs for the correct way to use this\n+decorator."
        },
        {
            "sha": "839e03d1e35c734c3681fa2dffd6733531dcfd0f",
            "filename": "docs/topics/cache.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/bb12a02bd8cd6e33b947b2cfa01292822099bb19/docs%2Ftopics%2Fcache.txt",
            "raw_url": "https://github.com/django/django/raw/bb12a02bd8cd6e33b947b2cfa01292822099bb19/docs%2Ftopics%2Fcache.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fcache.txt?ref=bb12a02bd8cd6e33b947b2cfa01292822099bb19",
            "patch": "@@ -494,7 +494,7 @@ __ `Controlling cache: Using other headers`_\n The per-view cache\n ==================\n \n-.. function ``django.views.decorators.cache.cache_page``\n+.. function:: django.views.decorators.cache.cache_page\n \n A more granular way to use the caching framework is by caching the output of\n individual views. ``django.views.decorators.cache`` defines a ``cache_page``\n@@ -571,7 +571,7 @@ Here's the same thing, with ``my_view`` wrapped in ``cache_page``::\n     from django.views.decorators.cache import cache_page\n \n     urlpatterns = ('',\n-        (r'^foo/(\\d{1,2})/$', cache_page(my_view, 60 * 15)),\n+        (r'^foo/(\\d{1,2})/$', cache_page(60 * 15)(my_view)),\n     )\n \n If you take this approach, don't forget to import ``cache_page`` within your"
        },
        {
            "sha": "f1d1c1097582bc07f87b1e828136d5ce5d68fe5b",
            "filename": "tests/regressiontests/decorators/tests.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/bb12a02bd8cd6e33b947b2cfa01292822099bb19/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/bb12a02bd8cd6e33b947b2cfa01292822099bb19/tests%2Fregressiontests%2Fdecorators%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fdecorators%2Ftests.py?ref=bb12a02bd8cd6e33b947b2cfa01292822099bb19",
            "patch": "@@ -1,8 +1,10 @@\n from functools import wraps\n+import warnings\n \n from django.contrib.auth.decorators import login_required, permission_required, user_passes_test\n from django.contrib.admin.views.decorators import staff_member_required\n from django.http import HttpResponse, HttpRequest, HttpResponseNotAllowed\n+from django.test.utils import get_warnings_state, restore_warnings_state\n from django.utils.decorators import method_decorator\n from django.utils.functional import allow_lazy, lazy, memoize\n from django.utils.unittest import TestCase\n@@ -65,6 +67,14 @@ def _inner(*args, **kwargs):\n \n class DecoratorsTest(TestCase):\n \n+    def setUp(self):\n+        self.warning_state = get_warnings_state()\n+        warnings.filterwarnings('ignore', category=PendingDeprecationWarning,\n+                                module='django.views.decorators.cache')\n+\n+    def tearDown(self):\n+        restore_warnings_state(self.warning_state)\n+\n     def test_attributes(self):\n         \"\"\"\n         Tests that django decorators set certain attributes of the wrapped"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 44,
        "deletions": 4
    }
}