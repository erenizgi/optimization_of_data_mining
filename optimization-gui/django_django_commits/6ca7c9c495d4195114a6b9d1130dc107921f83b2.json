{
    "author": "alex",
    "message": "Fixed a security issue in the file session backend.  Disclosure and new release forthcoming.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15467 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "6ca7c9c495d4195114a6b9d1130dc107921f83b2",
    "files": [
        {
            "sha": "2c4e40dbc7ae2779a0938c7559ef3638e006bac8",
            "filename": "django/contrib/sessions/backends/file.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/6ca7c9c495d4195114a6b9d1130dc107921f83b2/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "raw_url": "https://github.com/django/django/raw/6ca7c9c495d4195114a6b9d1130dc107921f83b2/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Ffile.py?ref=6ca7c9c495d4195114a6b9d1130dc107921f83b2",
            "patch": "@@ -26,6 +26,8 @@ def __init__(self, session_key=None):\n         self.file_prefix = settings.SESSION_COOKIE_NAME\n         super(SessionStore, self).__init__(session_key)\n \n+    VALID_KEY_CHARS = set(\"abcdef0123456789\")\n+\n     def _key_to_file(self, session_key=None):\n         \"\"\"\n         Get the file associated with this session key.\n@@ -36,9 +38,9 @@ def _key_to_file(self, session_key=None):\n         # Make sure we're not vulnerable to directory traversal. Session keys\n         # should always be md5s, so they should never contain directory\n         # components.\n-        if os.path.sep in session_key:\n+        if not set(session_key).issubset(self.VALID_KEY_CHARS):\n             raise SuspiciousOperation(\n-                \"Invalid characters (directory components) in session key\")\n+                \"Invalid characters in session key\")\n \n         return os.path.join(self.storage_path, self.file_prefix + session_key)\n "
        },
        {
            "sha": "afdb76181689a6a3152d7fe9ccd5930ddea9226b",
            "filename": "django/contrib/sessions/tests.py",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/6ca7c9c495d4195114a6b9d1130dc107921f83b2/django%2Fcontrib%2Fsessions%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/6ca7c9c495d4195114a6b9d1130dc107921f83b2/django%2Fcontrib%2Fsessions%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Ftests.py?ref=6ca7c9c495d4195114a6b9d1130dc107921f83b2",
            "patch": "@@ -11,7 +11,7 @@\n from django.contrib.sessions.backends.file import SessionStore as FileSession\n from django.contrib.sessions.models import Session\n from django.contrib.sessions.middleware import SessionMiddleware\n-from django.core.exceptions import ImproperlyConfigured\n+from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation\n from django.http import HttpResponse\n from django.test import TestCase, RequestFactory\n from django.utils import unittest\n@@ -322,6 +322,16 @@ def test_configuration_check(self):\n         settings.SESSION_FILE_PATH = \"/if/this/directory/exists/you/have/a/weird/computer\"\n         self.assertRaises(ImproperlyConfigured, self.backend)\n \n+    def test_invalid_key_backslash(self):\n+        # Ensure we don't allow directory-traversal\n+        self.assertRaises(SuspiciousOperation,\n+                          self.backend(\"a\\\\b\\\\c\").load)\n+\n+    def test_invalid_key_forwardslash(self):\n+        # Ensure we don't allow directory-traversal\n+        self.assertRaises(SuspiciousOperation,\n+                          self.backend(\"a/b/c\").load)\n+\n \n class CacheSessionTests(SessionTestsMixin, unittest.TestCase):\n "
        }
    ],
    "stats": {
        "total": 18,
        "additions": 15,
        "deletions": 3
    }
}