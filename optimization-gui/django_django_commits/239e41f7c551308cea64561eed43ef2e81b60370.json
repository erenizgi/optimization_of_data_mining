{
    "author": "PaulMcMillan",
    "message": "Cleanup to use get_random_string consistently.\n\nRemoves several ad hoc implementations of get_random_string()\nand removes an innapropriate use of settings.SECRET_KEY.\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17580 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "239e41f7c551308cea64561eed43ef2e81b60370",
    "files": [
        {
            "sha": "5a637e24d23ffa06d6781be94d461ca344d8438e",
            "filename": "django/contrib/sessions/backends/base.py",
            "status": "modified",
            "additions": 8,
            "deletions": 21,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/239e41f7c551308cea64561eed43ef2e81b60370/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/239e41f7c551308cea64561eed43ef2e81b60370/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fsessions%2Fbackends%2Fbase.py?ref=239e41f7c551308cea64561eed43ef2e81b60370",
            "patch": "@@ -1,7 +1,4 @@\n import base64\n-import hashlib\n-import os\n-import random\n import time\n from datetime import datetime, timedelta\n try:\n@@ -11,16 +8,11 @@\n \n from django.conf import settings\n from django.core.exceptions import SuspiciousOperation\n-from django.utils.crypto import constant_time_compare, salted_hmac\n+from django.utils.crypto import constant_time_compare\n+from django.utils.crypto import get_random_string\n+from django.utils.crypto import salted_hmac\n from django.utils import timezone\n \n-# Use the system (hardware-based) random number generator if it exists.\n-if hasattr(random, 'SystemRandom'):\n-    randrange = random.SystemRandom().randrange\n-else:\n-    randrange = random.randrange\n-MAX_SESSION_KEY = 18446744073709551616L     # 2 << 63\n-\n class CreateError(Exception):\n     \"\"\"\n     Used internally as a consistent exception type to catch from save (see the\n@@ -138,17 +130,12 @@ def clear(self):\n \n     def _get_new_session_key(self):\n         \"Returns session key that isn't being used.\"\n-        # The random module is seeded when this Apache child is created.\n-        # Use settings.SECRET_KEY as added salt.\n-        try:\n-            pid = os.getpid()\n-        except AttributeError:\n-            # No getpid() in Jython, for example\n-            pid = 1\n+        # Todo: move to 0-9a-z charset in 1.5\n+        hex_chars = '1234567890abcdef'\n+        # session_key should not be case sensitive because some backends\n+        # can store it on case insensitive file systems.\n         while True:\n-            session_key = hashlib.md5(\"%s%s%s%s\"\n-                    % (randrange(0, MAX_SESSION_KEY), pid, time.time(),\n-                       settings.SECRET_KEY)).hexdigest()\n+            session_key = get_random_string(32, hex_chars)\n             if not self.exists(session_key):\n                 break\n         return session_key"
        },
        {
            "sha": "a1a9b33a439d811b1c5bffe940ae60174aa1e1ff",
            "filename": "django/core/management/commands/startproject.py",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/django/django/blob/239e41f7c551308cea64561eed43ef2e81b60370/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py",
            "raw_url": "https://github.com/django/django/raw/239e41f7c551308cea64561eed43ef2e81b60370/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fstartproject.py?ref=239e41f7c551308cea64561eed43ef2e81b60370",
            "patch": "@@ -1,7 +1,6 @@\n-from random import choice\n-\n from django.core.management.base import CommandError\n from django.core.management.templates import TemplateCommand\n+from django.utils.crypto import get_random_string\n from django.utils.importlib import import_module\n \n \n@@ -27,6 +26,6 @@ def handle(self, project_name=None, target=None, *args, **options):\n \n         # Create a random SECRET_KEY hash to put it in the main settings.\n         chars = 'abcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*(-_=+)'\n-        options['secret_key'] = ''.join([choice(chars) for i in range(50)])\n+        options['secret_key'] = get_random_string(50, chars)\n \n         super(Command, self).handle('project', project_name, target, **options)"
        },
        {
            "sha": "a54c455e1bb81d8cd6321f7774551ced0aaff736",
            "filename": "django/utils/crypto.py",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/239e41f7c551308cea64561eed43ef2e81b60370/django%2Futils%2Fcrypto.py",
            "raw_url": "https://github.com/django/django/raw/239e41f7c551308cea64561eed43ef2e81b60370/django%2Futils%2Fcrypto.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fcrypto.py?ref=239e41f7c551308cea64561eed43ef2e81b60370",
            "patch": "@@ -7,6 +7,13 @@\n import hashlib\n import binascii\n import operator\n+\n+import random\n+try:\n+    random = random.SystemRandom()\n+except NotImplementedError:\n+    pass\n+\n from django.conf import settings\n \n \n@@ -43,13 +50,8 @@ def get_random_string(length=12,\n     Returns a random string of length characters from the set of a-z, A-Z, 0-9.\n \n     The default length of 12 with the a-z, A-Z, 0-9 character set returns\n-    a 71-bit salt. log_2((26+26+10)^12) =~ 71 bits\n+    a 71-bit value. log_2((26+26+10)^12) =~ 71 bits\n     \"\"\"\n-    import random\n-    try:\n-        random = random.SystemRandom()\n-    except NotImplementedError:\n-        pass\n     return ''.join([random.choice(allowed_chars) for i in range(length)])\n \n "
        }
    ],
    "stats": {
        "total": 48,
        "additions": 18,
        "deletions": 30
    }
}