{
    "author": "ramiro",
    "message": "Fixed #7836 -- Modified strategy used by the test client to check for session functionality so it is useful in environments where the DB-based session backend isn't being used. Thanks trevor for the report.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16386 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "84c71148e37235396436fa4b03de137766a15c02",
    "files": [
        {
            "sha": "4335f21224e7792d8219f3afbf85ca7e1981ae4a",
            "filename": "django/test/client.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/84c71148e37235396436fa4b03de137766a15c02/django%2Ftest%2Fclient.py",
            "raw_url": "https://github.com/django/django/raw/84c71148e37235396436fa4b03de137766a15c02/django%2Ftest%2Fclient.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftest%2Fclient.py?ref=84c71148e37235396436fa4b03de137766a15c02",
            "patch": "@@ -356,7 +356,7 @@ def _session(self):\n         \"\"\"\n         Obtains the current session variables.\n         \"\"\"\n-        if 'django.contrib.sessions' in settings.INSTALLED_APPS:\n+        if 'django.contrib.sessions.middleware.SessionMiddleware' in settings.MIDDLEWARE_CLASSES:\n             engine = import_module(settings.SESSION_ENGINE)\n             cookie = self.cookies.get(settings.SESSION_COOKIE_NAME, None)\n             if cookie:\n@@ -504,7 +504,7 @@ def login(self, **credentials):\n         \"\"\"\n         user = authenticate(**credentials)\n         if user and user.is_active \\\n-                and 'django.contrib.sessions' in settings.INSTALLED_APPS:\n+                and 'django.contrib.sessions.middleware.SessionMiddleware' in settings.MIDDLEWARE_CLASSES:\n             engine = import_module(settings.SESSION_ENGINE)\n \n             # Create a fake request to store login details."
        },
        {
            "sha": "57ed618ea37dca2a674c7e3e71ee690f43201aa7",
            "filename": "tests/regressiontests/test_client_regress/models.py",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/django/django/blob/84c71148e37235396436fa4b03de137766a15c02/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/84c71148e37235396436fa4b03de137766a15c02/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fmodels.py?ref=84c71148e37235396436fa4b03de137766a15c02",
            "patch": "@@ -13,7 +13,7 @@\n import django.template.context\n from django.test import Client, TestCase\n from django.test.client import encode_file, RequestFactory\n-from django.test.utils import ContextList\n+from django.test.utils import ContextList, override_settings\n \n \n class AssertContainsTests(TestCase):\n@@ -518,6 +518,19 @@ def test_login(self):\n         self.assertEqual(response.status_code, 200)\n         self.assertEqual(response.context['user'].username, 'testclient')\n \n+\n+# Remove the 'session' contrib app from INSTALLED_APPS\n+@override_settings(INSTALLED_APPS=tuple(filter(lambda a: a!='django.contrib.sessions', settings.INSTALLED_APPS)))\n+class NoSessionsAppInstalled(SessionEngineTests):\n+    \"\"\"#7836 - Test client can exercise sessions even when 'django.contrib.sessions' isn't installed.\"\"\"\n+\n+    def test_session(self):\n+        # This request sets a session variable.\n+        response = self.client.get('/test_client_regress/set_session/')\n+        self.assertEqual(response.status_code, 200)\n+        self.assertEqual(self.client.session['session_var'], 'YES')\n+\n+\n class URLEscapingTests(TestCase):\n     def test_simple_argument_get(self):\n         \"Get a view that has a simple string argument\""
        },
        {
            "sha": "070584d32df1059fa01da88f388e6e1e0f54fb30",
            "filename": "tests/regressiontests/test_client_regress/session.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/84c71148e37235396436fa4b03de137766a15c02/tests%2Fregressiontests%2Ftest_client_regress%2Fsession.py",
            "raw_url": "https://github.com/django/django/raw/84c71148e37235396436fa4b03de137766a15c02/tests%2Fregressiontests%2Ftest_client_regress%2Fsession.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftest_client_regress%2Fsession.py?ref=84c71148e37235396436fa4b03de137766a15c02",
            "patch": "@@ -2,7 +2,7 @@\n \n class SessionStore(SessionBase):\n     \"\"\"\n-    A simple cookie-based session storage implemenation.\n+    A simple cookie-based session storage implementation.\n \n     The session key is actually the session data, pickled and encoded.\n     This means that saving the session will change the session key.\n@@ -27,4 +27,4 @@ def load(self):\n             return self.decode(self.session_key)\n         except:\n             self.modified = True\n-            return {}\n\\ No newline at end of file\n+            return {}"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 18,
        "deletions": 5
    }
}