{
    "author": "alex",
    "message": "Removed legacy handing for `settings.DATABAS_*` and using short-form references to the included database backends.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15959 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "9b3aaae255fad098e801e4813f646492a8a29e57",
    "files": [
        {
            "sha": "2148cf05233e46ea5fead8e71116386cf264fa5c",
            "filename": "django/db/__init__.py",
            "status": "modified",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/django/django/blob/9b3aaae255fad098e801e4813f646492a8a29e57/django%2Fdb%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/9b3aaae255fad098e801e4813f646492a8a29e57/django%2Fdb%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2F__init__.py?ref=9b3aaae255fad098e801e4813f646492a8a29e57",
            "patch": "@@ -8,59 +8,9 @@\n     'IntegrityError', 'DEFAULT_DB_ALIAS')\n \n \n-# For backwards compatibility - Port any old database settings over to\n-# the new values.\n-if not settings.DATABASES:\n-    if settings.DATABASE_ENGINE:\n-        import warnings\n-        warnings.warn(\n-            \"settings.DATABASE_* is deprecated; use settings.DATABASES instead.\",\n-            DeprecationWarning\n-        )\n-\n-    settings.DATABASES[DEFAULT_DB_ALIAS] = {\n-        'ENGINE': settings.DATABASE_ENGINE,\n-        'HOST': settings.DATABASE_HOST,\n-        'NAME': settings.DATABASE_NAME,\n-        'OPTIONS': settings.DATABASE_OPTIONS,\n-        'PASSWORD': settings.DATABASE_PASSWORD,\n-        'PORT': settings.DATABASE_PORT,\n-        'USER': settings.DATABASE_USER,\n-        'TEST_CHARSET': settings.TEST_DATABASE_CHARSET,\n-        'TEST_COLLATION': settings.TEST_DATABASE_COLLATION,\n-        'TEST_NAME': settings.TEST_DATABASE_NAME,\n-    }\n-\n if DEFAULT_DB_ALIAS not in settings.DATABASES:\n     raise ImproperlyConfigured(\"You must define a '%s' database\" % DEFAULT_DB_ALIAS)\n \n-for alias, database in settings.DATABASES.items():\n-    if 'ENGINE' not in database:\n-        raise ImproperlyConfigured(\"You must specify a 'ENGINE' for database '%s'\" % alias)\n-    if database['ENGINE'] in (\"postgresql\", \"postgresql_psycopg2\", \"sqlite3\", \"mysql\", \"oracle\"):\n-        import warnings\n-        if 'django.contrib.gis' in settings.INSTALLED_APPS:\n-            warnings.warn(\n-                \"django.contrib.gis is now implemented as a full database backend. \"\n-                \"Modify ENGINE in the %s database configuration to select \"\n-                \"a backend from 'django.contrib.gis.db.backends'\" % alias,\n-                DeprecationWarning\n-            )\n-            if database['ENGINE'] == 'postgresql_psycopg2':\n-                full_engine = 'django.contrib.gis.db.backends.postgis'\n-            elif database['ENGINE'] == 'sqlite3':\n-                full_engine = 'django.contrib.gis.db.backends.spatialite'\n-            else:\n-                full_engine = 'django.contrib.gis.db.backends.%s' % database['ENGINE']\n-        else:\n-            warnings.warn(\n-                \"Short names for ENGINE in database configurations are deprecated. \"\n-                \"Prepend %s.ENGINE with 'django.db.backends.'\" % alias,\n-                DeprecationWarning\n-            )\n-            full_engine = \"django.db.backends.%s\" % database['ENGINE']\n-        database['ENGINE'] = full_engine\n-\n connections = ConnectionHandler(settings.DATABASES)\n \n router = ConnectionRouter(settings.DATABASE_ROUTERS)"
        },
        {
            "sha": "1d7994b33688b99d2158a0e1d6ec7fcbf1ca6937",
            "filename": "django/db/utils.py",
            "status": "modified",
            "additions": 24,
            "deletions": 36,
            "changes": 60,
            "blob_url": "https://github.com/django/django/blob/9b3aaae255fad098e801e4813f646492a8a29e57/django%2Fdb%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/9b3aaae255fad098e801e4813f646492a8a29e57/django%2Fdb%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Futils.py?ref=9b3aaae255fad098e801e4813f646492a8a29e57",
            "patch": "@@ -1,4 +1,3 @@\n-import inspect\n import os\n \n from django.conf import settings\n@@ -19,38 +18,29 @@ class IntegrityError(DatabaseError):\n \n \n def load_backend(backend_name):\n+    # Look for a fully qualified database backend name\n     try:\n-        module = import_module('.base', 'django.db.backends.%s' % backend_name)\n-        import warnings\n-        warnings.warn(\n-            \"Short names for DATABASE_ENGINE are deprecated; prepend with 'django.db.backends.'\",\n-            DeprecationWarning\n-        )\n-        return module\n-    except ImportError, e:\n-        # Look for a fully qualified database backend name\n+        return import_module('.base', backend_name)\n+    except ImportError, e_user:\n+        # The database backend wasn't found. Display a helpful error message\n+        # listing all possible (built-in) database backends.\n+        backend_dir = os.path.join(os.path.dirname(__file__), 'backends')\n         try:\n-            return import_module('.base', backend_name)\n-        except ImportError, e_user:\n-            # The database backend wasn't found. Display a helpful error message\n-            # listing all possible (built-in) database backends.\n-            backend_dir = os.path.join(os.path.dirname(__file__), 'backends')\n-            try:\n-                available_backends = [f for f in os.listdir(backend_dir)\n-                        if os.path.isdir(os.path.join(backend_dir, f))\n-                        and not f.startswith('.')]\n-            except EnvironmentError:\n-                available_backends = []\n-            if backend_name.startswith('django.db.backends.'):\n-                backend_name = backend_name[19:] # See #15621.\n-            if backend_name not in available_backends:\n-                error_msg = (\"%r isn't an available database backend. \\n\" +\n-                    \"Try using django.db.backends.XXX, where XXX is one of:\\n    %s\\n\" +\n-                    \"Error was: %s\") % \\\n-                    (backend_name, \", \".join(map(repr, sorted(available_backends))), e_user)\n-                raise ImproperlyConfigured(error_msg)\n-            else:\n-                raise # If there's some other error, this must be an error in Django itself.\n+            available_backends = [f for f in os.listdir(backend_dir)\n+                    if os.path.isdir(os.path.join(backend_dir, f))\n+                    and not f.startswith('.')]\n+        except EnvironmentError:\n+            available_backends = []\n+        if backend_name.startswith('django.db.backends.'):\n+            backend_name = backend_name[19:] # See #15621.\n+        if backend_name not in available_backends:\n+            error_msg = (\"%r isn't an available database backend. \\n\" +\n+                \"Try using django.db.backends.XXX, where XXX is one of:\\n    %s\\n\" +\n+                \"Error was: %s\") % \\\n+                (backend_name, \", \".join(map(repr, sorted(available_backends))), e_user)\n+            raise ImproperlyConfigured(error_msg)\n+        else:\n+            raise # If there's some other error, this must be an error in Django itself.\n \n \n class ConnectionDoesNotExist(Exception):\n@@ -76,13 +66,11 @@ def ensure_defaults(self, alias):\n         if conn['ENGINE'] == 'django.db.backends.' or not conn['ENGINE']:\n             conn['ENGINE'] = 'django.db.backends.dummy'\n         conn.setdefault('OPTIONS', {})\n-        conn.setdefault('TEST_CHARSET', None)\n-        conn.setdefault('TEST_COLLATION', None)\n-        conn.setdefault('TEST_NAME', None)\n-        conn.setdefault('TEST_MIRROR', None)\n         conn.setdefault('TIME_ZONE', settings.TIME_ZONE)\n-        for setting in ('NAME', 'USER', 'PASSWORD', 'HOST', 'PORT'):\n+        for setting in ['NAME', 'USER', 'PASSWORD', 'HOST', 'PORT']:\n             conn.setdefault(setting, '')\n+        for setting in ['TEST_CHARSET', 'TEST_COLLATION', 'TEST_NAME', 'TEST_MIRROR']:\n+            conn.setdefault(setting, None)\n \n     def __getitem__(self, alias):\n         if alias in self._connections:"
        }
    ],
    "stats": {
        "total": 110,
        "additions": 24,
        "deletions": 86
    }
}