{
    "author": "claudep",
    "message": "Fixed #19354 -- Do not assume usermodel.pk == usermodel.id\n\nThanks markteisman at hotmail.com for the report.",
    "sha": "0eeae15056edf07f786d3be5b47c14ab62eacd31",
    "files": [
        {
            "sha": "c48ffa6ca3833b165e642818e30bf977e44d11a0",
            "filename": "django/contrib/admin/options.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fadmin%2Foptions.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fadmin%2Foptions.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Foptions.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -552,7 +552,7 @@ def log_deletion(self, request, object, object_repr):\n         \"\"\"\n         from django.contrib.admin.models import LogEntry, DELETION\n         LogEntry.objects.log_action(\n-            user_id         = request.user.id,\n+            user_id         = request.user.pk,\n             content_type_id = ContentType.objects.get_for_model(self.model).pk,\n             object_id       = object.pk,\n             object_repr     = object_repr,"
        },
        {
            "sha": "99348d3ae525241dfd814ea7d1ecded5196f3569",
            "filename": "django/contrib/auth/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2F__init__.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -84,14 +84,14 @@ def login(request, user):\n         user = request.user\n     # TODO: It would be nice to support different login methods, like signed cookies.\n     if SESSION_KEY in request.session:\n-        if request.session[SESSION_KEY] != user.id:\n+        if request.session[SESSION_KEY] != user.pk:\n             # To avoid reusing another user's session, create a new, empty\n             # session if the existing session corresponds to a different\n             # authenticated user.\n             request.session.flush()\n     else:\n         request.session.cycle_key()\n-    request.session[SESSION_KEY] = user.id\n+    request.session[SESSION_KEY] = user.pk\n     request.session[BACKEND_SESSION_KEY] = user.backend\n     if hasattr(request, 'user'):\n         request.user = user"
        },
        {
            "sha": "10d9eca3c3d0a812dc7bdb218fe25624044b9804",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -241,7 +241,7 @@ def save(self, domain_override=None,\n                 'email': user.email,\n                 'domain': domain,\n                 'site_name': site_name,\n-                'uid': int_to_base36(user.id),\n+                'uid': int_to_base36(user.pk),\n                 'user': user,\n                 'token': token_generator.make_token(user),\n                 'protocol': use_https and 'https' or 'http',"
        },
        {
            "sha": "dc4c6b17c1f56f0838274bc82f9b0a795735c070",
            "filename": "django/contrib/auth/tests/templates/context_processors/auth_attrs_user.html",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_user.html",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_user.html",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Ftemplates%2Fcontext_processors%2Fauth_attrs_user.html?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -1,4 +1,4 @@\n unicode: {{ user }}\n-id: {{ user.id }}\n+id: {{ user.pk }}\n username: {{ user.username }}\n url: {% url 'userpage' user %}"
        },
        {
            "sha": "6e5bfe7d9daf9719f957fdbb242f7384b19096c2",
            "filename": "django/contrib/auth/tokens.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Ftokens.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Ftokens.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftokens.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -58,7 +58,7 @@ def _make_token_with_timestamp(self, user, timestamp):\n         # Ensure results are consistent across DB backends\n         login_timestamp = user.last_login.replace(microsecond=0, tzinfo=None)\n \n-        value = (six.text_type(user.id) + user.password +\n+        value = (six.text_type(user.pk) + user.password +\n                 six.text_type(login_timestamp) + six.text_type(timestamp))\n         hash = salted_hmac(key_salt, value).hexdigest()[::2]\n         return \"%s-%s\" % (ts_b36, hash)"
        },
        {
            "sha": "2562a639b7abdcf5e7dda057bea7b35cef4ef8a9",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -206,7 +206,7 @@ def password_reset_confirm(request, uidb36=None, token=None,\n         post_reset_redirect = reverse('django.contrib.auth.views.password_reset_complete')\n     try:\n         uid_int = base36_to_int(uidb36)\n-        user = UserModel.objects.get(id=uid_int)\n+        user = UserModel.objects.get(pk=uid_int)\n     except (ValueError, OverflowError, UserModel.DoesNotExist):\n         user = None\n "
        },
        {
            "sha": "57ef0cfb274e9433672191423d756c9867d3f425",
            "filename": "docs/ref/templates/builtins.txt",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/docs%2Fref%2Ftemplates%2Fbuiltins.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Ftemplates%2Fbuiltins.txt?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -618,7 +618,7 @@ Output the contents of the block if the two arguments equal each other.\n \n Example::\n \n-    {% ifequal user.id comment.user_id %}\n+    {% ifequal user.pk comment.user_id %}\n         ...\n     {% endifequal %}\n "
        },
        {
            "sha": "8cadcfc409c154bb4473cc9cbb7eaaabb81d2691",
            "filename": "tests/regressiontests/model_formsets_regress/tests.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -351,7 +351,7 @@ class Meta:\n \n         def should_delete(self):\n             \"\"\" delete form if odd PK \"\"\"\n-            return self.instance.id % 2 != 0\n+            return self.instance.pk % 2 != 0\n \n     NormalFormset = modelformset_factory(User, form=CustomDeleteUserForm, can_delete=True)\n     DeleteFormset = modelformset_factory(User, form=CustomDeleteUserForm, formset=BaseCustomDeleteModelFormSet)\n@@ -392,7 +392,7 @@ def test_no_delete(self):\n         data = dict(self.data)\n         data['form-INITIAL_FORMS'] = 4\n         data.update(dict(\n-            ('form-%d-id' % i, user.id)\n+            ('form-%d-id' % i, user.pk)\n             for i,user in enumerate(User.objects.all())\n         ))\n         formset = self.NormalFormset(data, queryset=User.objects.all())\n@@ -409,7 +409,7 @@ def test_all_delete(self):\n         data = dict(self.data)\n         data['form-INITIAL_FORMS'] = 4\n         data.update(dict(\n-            ('form-%d-id' % i, user.id)\n+            ('form-%d-id' % i, user.pk)\n             for i,user in enumerate(User.objects.all())\n         ))\n         data.update(self.delete_all_ids)\n@@ -428,7 +428,7 @@ def test_custom_delete(self):\n         data = dict(self.data)\n         data['form-INITIAL_FORMS'] = 4\n         data.update(dict(\n-            ('form-%d-id' % i, user.id)\n+            ('form-%d-id' % i, user.pk)\n             for i,user in enumerate(User.objects.all())\n         ))\n         data.update(self.delete_all_ids)\n@@ -440,5 +440,5 @@ def test_custom_delete(self):\n         self.assertEqual(len(User.objects.all()), 2)\n \n         # verify no \"odd\" PKs left\n-        odd_ids = [user.id for user in User.objects.all() if user.id % 2]\n+        odd_ids = [user.pk for user in User.objects.all() if user.pk % 2]\n         self.assertEqual(len(odd_ids), 0)"
        },
        {
            "sha": "5d1ab2c6f685d2ae7f22445d2700a7d7d758dd06",
            "filename": "tests/regressiontests/transactions_regress/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/0eeae15056edf07f786d3be5b47c14ab62eacd31/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/0eeae15056edf07f786d3be5b47c14ab62eacd31/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftransactions_regress%2Ftests.py?ref=0eeae15056edf07f786d3be5b47c14ab62eacd31",
            "patch": "@@ -140,7 +140,7 @@ def create_system_user():\n             \"Create a user in a transaction\"\n             user = User.objects.create_user(username='system', password='iamr00t', email='root@SITENAME.com')\n             # Redundant, just makes sure the user id was read back from DB\n-            Mod.objects.create(fld=user.id)\n+            Mod.objects.create(fld=user.pk)\n \n         # Create a user\n         create_system_user()"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 14,
        "deletions": 14
    }
}