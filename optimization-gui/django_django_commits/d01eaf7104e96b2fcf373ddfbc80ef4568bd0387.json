{
    "author": "aaugustin",
    "message": "[py3] Removed uses of sys.maxint under Python 3.\n\nAlso fixed #18706: improved exceptions raised by int_to_base36.",
    "sha": "d01eaf7104e96b2fcf373ddfbc80ef4568bd0387",
    "files": [
        {
            "sha": "272e73f190263f9791f7383286f1d94557718f65",
            "filename": "django/utils/http.py",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/django/django/blob/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/django%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/django%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhttp.py?ref=d01eaf7104e96b2fcf373ddfbc80ef4568bd0387",
            "patch": "@@ -167,8 +167,9 @@ def base36_to_int(s):\n     if len(s) > 13:\n         raise ValueError(\"Base36 input too large\")\n     value = int(s, 36)\n-    # ... then do a final check that the value will fit into an int.\n-    if value > sys.maxint:\n+    # ... then do a final check that the value will fit into an int to avoid\n+    # returning a long (#15067). The long type was removed in Python 3.\n+    if not six.PY3 and value > sys.maxint:\n         raise ValueError(\"Base36 input too large\")\n     return value\n \n@@ -178,8 +179,13 @@ def int_to_base36(i):\n     \"\"\"\n     digits = \"0123456789abcdefghijklmnopqrstuvwxyz\"\n     factor = 0\n-    if not 0 <= i <= sys.maxint:\n-        raise ValueError(\"Base36 conversion input too large or incorrect type.\")\n+    if i < 0:\n+        raise ValueError(\"Negative base36 conversion input.\")\n+    if not six.PY3:\n+        if not isinstance(i, six.integer_types):\n+            raise TypeError(\"Non-integer base36 conversion input.\")\n+        if i > sys.maxint:\n+            raise ValueError(\"Base36 conversion input too large.\")\n     # Find starting factor\n     while True:\n         factor += 1"
        },
        {
            "sha": "5157c399da73f8f28a72d648dcc78a38d96eb3ef",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=d01eaf7104e96b2fcf373ddfbc80ef4568bd0387",
            "patch": "@@ -504,11 +504,13 @@ escaping HTML.\n \n .. function:: base36_to_int(s)\n \n-    Converts a base 36 string to an integer.\n+    Converts a base 36 string to an integer. On Python 2 the output is\n+    guaranteed to be an :class:`int` and not a :class:`long`.\n \n .. function:: int_to_base36(i)\n \n-    Converts a positive integer less than sys.maxint to a base 36 string.\n+    Converts a positive integer to a base 36 string. On Python 2 ``i`` must be\n+    smaller than :attr:`sys.maxint`.\n \n ``django.utils.safestring``\n ==========================="
        },
        {
            "sha": "968d63e1f36fea70e742924fea913980f8b62f5c",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=d01eaf7104e96b2fcf373ddfbc80ef4568bd0387",
            "patch": "@@ -244,6 +244,9 @@ Miscellaneous\n \n * GeoDjango dropped support for GDAL < 1.5\n \n+* :func:`~django.utils.http.int_to_base36` properly raises a :exc:`TypeError`\n+  instead of :exc:`ValueError` for non-integer inputs.\n+\n Features deprecated in 1.5\n ==========================\n "
        },
        {
            "sha": "f22e05496da541b34a91ac3f48a3f834b5dc0f5d",
            "filename": "tests/regressiontests/utils/http.py",
            "status": "modified",
            "additions": 14,
            "deletions": 12,
            "changes": 26,
            "blob_url": "https://github.com/django/django/blob/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "raw_url": "https://github.com/django/django/raw/d01eaf7104e96b2fcf373ddfbc80ef4568bd0387/tests%2Fregressiontests%2Futils%2Fhttp.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fhttp.py?ref=d01eaf7104e96b2fcf373ddfbc80ef4568bd0387",
            "patch": "@@ -1,10 +1,11 @@\n import sys\n \n-from django.utils import http\n-from django.utils import unittest\n-from django.utils.datastructures import MultiValueDict\n from django.http import HttpResponse, utils\n from django.test import RequestFactory\n+from django.utils.datastructures import MultiValueDict\n+from django.utils import http\n+from django.utils import six\n+from django.utils import unittest\n \n class TestUtilsHttp(unittest.TestCase):\n \n@@ -110,22 +111,23 @@ def no_content_response_with_unsafe_content_type():\n \n     def test_base36(self):\n         # reciprocity works\n-        for n in [0, 1, 1000, 1000000, sys.maxint]:\n+        for n in [0, 1, 1000, 1000000]:\n             self.assertEqual(n, http.base36_to_int(http.int_to_base36(n)))\n+        if not six.PY3:\n+            self.assertEqual(sys.maxint, http.base36_to_int(http.int_to_base36(sys.maxint)))\n \n         # bad input\n-        for n in [-1, sys.maxint+1, '1', 'foo', {1:2}, (1,2,3)]:\n-            self.assertRaises(ValueError, http.int_to_base36, n)\n-        \n+        self.assertRaises(ValueError, http.int_to_base36, -1)\n+        if not six.PY3:\n+            self.assertRaises(ValueError, http.int_to_base36, sys.maxint + 1)\n+        for n in ['1', 'foo', {1: 2}, (1, 2, 3), 3.141]:\n+            self.assertRaises(TypeError, http.int_to_base36, n)\n+\n         for n in ['#', ' ']:\n             self.assertRaises(ValueError, http.base36_to_int, n)\n-\n-        for n in [123, {1:2}, (1,2,3)]:\n+        for n in [123, {1: 2}, (1, 2, 3), 3.141]:\n             self.assertRaises(TypeError, http.base36_to_int, n)\n \n-        # non-integer input\n-        self.assertRaises(TypeError, http.int_to_base36, 3.141)\n-        \n         # more explicit output testing\n         for n, b36 in [(0, '0'), (1, '1'), (42, '16'), (818469960, 'django')]:\n             self.assertEqual(http.int_to_base36(n), b36)"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 31,
        "deletions": 18
    }
}